"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5877],{67087:(e,t,i)=>{i.d(t,{s:()=>h});var s=i(84318),o=i(58095),r=i(72208),n=i(18737),a=i(7968),c=i(58697),l=i(60604),h=function(){function e(e,t,i){void 0===e&&(e=!0),void 0===t&&(t=10),void 0===i&&(i=CANNON),this._useDeltaForWorldStep=e,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=1/60,this._physicsBodysToRemoveAfterStep=new Array,this._firstFrame=!0,this._tmpQuaternion=new o._f,this._minus90X=new o._f(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new o._f(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=o.P.Zero(),this._tmpDeltaPosition=o.P.Zero(),this._tmpUnityRotation=new o._f,this.BJSCANNON=i,this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=t,this._cannonRaycastResult=new this.BJSCANNON.RaycastResult,this._raycastResult=new l.d):s.Y.Error("CannonJS is not available. Please make sure you included the js file.")}return e.prototype.setGravity=function(e){var t=e;this.world.gravity.set(t.x,t.y,t.z)},e.prototype.setTimeStep=function(e){this._fixedTimeStep=e},e.prototype.getTimeStep=function(){return this._fixedTimeStep},e.prototype.executeStep=function(e,t){if(this._firstFrame){this._firstFrame=!1;for(var i=0,s=t;i<s.length;i++){var o=s[i];o.type!=n.Q.HeightmapImpostor&&o.type!==n.Q.PlaneImpostor&&o.beforeStep()}}this.world.step(this._useDeltaForWorldStep?e:this._fixedTimeStep),this._removeMarkedPhysicsBodiesFromWorld()},e.prototype._removeMarkedPhysicsBodiesFromWorld=function(){var e=this;this._physicsBodysToRemoveAfterStep.length>0&&(this._physicsBodysToRemoveAfterStep.forEach((function(t){"function"==typeof e.world.removeBody?e.world.removeBody(t):e.world.remove(t)})),this._physicsBodysToRemoveAfterStep=[])},e.prototype.applyImpulse=function(e,t,i){var s=new this.BJSCANNON.Vec3(i.x,i.y,i.z),o=new this.BJSCANNON.Vec3(t.x,t.y,t.z);e.physicsBody.applyImpulse(o,s)},e.prototype.applyForce=function(e,t,i){var s=new this.BJSCANNON.Vec3(i.x,i.y,i.z),o=new this.BJSCANNON.Vec3(t.x,t.y,t.z);e.physicsBody.applyForce(o,s)},e.prototype.generatePhysicsBody=function(e){if(this._removeMarkedPhysicsBodiesFromWorld(),e.parent)e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate());else{if(e.isBodyInitRequired()){var t=this._createShape(e);if(!t)return void s.Y.Warn("It was not possible to create a physics body for this object.");var i=e.physicsBody;i&&this.removePhysicsBody(e);var o=this._addMaterial("mat-"+e.uniqueId,e.getParam("friction"),e.getParam("restitution")),r={mass:e.getParam("mass"),material:o},n=e.getParam("nativeOptions");for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a]);e.physicsBody=new this.BJSCANNON.Body(r),e.physicsBody.addEventListener("collide",e.onCollide),this.world.addEventListener("preStep",e.beforeStep),this.world.addEventListener("postStep",e.afterStep),e.physicsBody.addShape(t),"function"==typeof this.world.addBody?this.world.addBody(e.physicsBody):this.world.add(e.physicsBody),i&&["force","torque","velocity","angularVelocity"].forEach((function(t){var s=i[t];e.physicsBody[t].set(s.x,s.y,s.z)})),this._processChildMeshes(e)}this._updatePhysicsBodyTransformation(e)}},e.prototype._processChildMeshes=function(e){var t=this,i=e.object.getChildMeshes?e.object.getChildMeshes(!0):[],s=e.object.rotationQuaternion;if(s?s.conjugateToRef(this._tmpQuaternion):this._tmpQuaternion.set(0,0,0,1),i.length){var o=function(i){if(i.rotationQuaternion){var s=i.getPhysicsImpostor();if(s)if(s.parent!==e&&i.parent){var r=i.getAbsolutePosition().subtract(i.parent.getAbsolutePosition()),n=i.rotationQuaternion.multiply(t._tmpQuaternion);s.physicsBody&&(t.removePhysicsBody(s),s.physicsBody=null),s.parent=e,s.resetUpdateFlags(),e.physicsBody.addShape(t._createShape(s),new t.BJSCANNON.Vec3(r.x,r.y,r.z),new t.BJSCANNON.Quaternion(n.x,n.y,n.z,n.w)),e.physicsBody.mass+=s.getParam("mass")}i.getChildMeshes(!0).filter((function(e){return!!e.physicsImpostor})).forEach(o)}};i.filter((function(e){return!!e.physicsImpostor})).forEach(o)}},e.prototype.removePhysicsBody=function(e){e.physicsBody.removeEventListener("collide",e.onCollide),this.world.removeEventListener("preStep",e.beforeStep),this.world.removeEventListener("postStep",e.afterStep),-1===this._physicsBodysToRemoveAfterStep.indexOf(e.physicsBody)&&this._physicsBodysToRemoveAfterStep.push(e.physicsBody)},e.prototype.generateJoint=function(e){var t=e.mainImpostor.physicsBody,i=e.connectedImpostor.physicsBody;if(t&&i){var s,o=e.joint.jointData,r={pivotA:o.mainPivot?(new this.BJSCANNON.Vec3).set(o.mainPivot.x,o.mainPivot.y,o.mainPivot.z):null,pivotB:o.connectedPivot?(new this.BJSCANNON.Vec3).set(o.connectedPivot.x,o.connectedPivot.y,o.connectedPivot.z):null,axisA:o.mainAxis?(new this.BJSCANNON.Vec3).set(o.mainAxis.x,o.mainAxis.y,o.mainAxis.z):null,axisB:o.connectedAxis?(new this.BJSCANNON.Vec3).set(o.connectedAxis.x,o.connectedAxis.y,o.connectedAxis.z):null,maxForce:o.nativeParams.maxForce,collideConnected:!!o.collision};switch(e.joint.type){case a.q7.HingeJoint:case a.q7.Hinge2Joint:s=new this.BJSCANNON.HingeConstraint(t,i,r);break;case a.q7.DistanceJoint:s=new this.BJSCANNON.DistanceConstraint(t,i,o.maxDistance||2);break;case a.q7.SpringJoint:var n=o;s=new this.BJSCANNON.Spring(t,i,{restLength:n.length,stiffness:n.stiffness,damping:n.damping,localAnchorA:r.pivotA,localAnchorB:r.pivotB});break;case a.q7.LockJoint:s=new this.BJSCANNON.LockConstraint(t,i,r);break;case a.q7.PointToPointJoint:case a.q7.BallAndSocketJoint:default:s=new this.BJSCANNON.PointToPointConstraint(t,r.pivotA,i,r.pivotB,r.maxForce)}s.collideConnected=!!o.collision,e.joint.physicsJoint=s,e.joint.type!==a.q7.SpringJoint?this.world.addConstraint(s):(e.joint.jointData.forceApplicationCallback=e.joint.jointData.forceApplicationCallback||function(){s.applyForce()},e.mainImpostor.registerAfterPhysicsStep(e.joint.jointData.forceApplicationCallback))}},e.prototype.removeJoint=function(e){e.joint.type!==a.q7.SpringJoint?this.world.removeConstraint(e.joint.physicsJoint):e.mainImpostor.unregisterAfterPhysicsStep(e.joint.jointData.forceApplicationCallback)},e.prototype._addMaterial=function(e,t,i){var s,o;for(s=0;s<this._physicsMaterials.length;s++)if((o=this._physicsMaterials[s]).friction===t&&o.restitution===i)return o;var r=new this.BJSCANNON.Material(e);return r.friction=t,r.restitution=i,this._physicsMaterials.push(r),r},e.prototype._checkWithEpsilon=function(e){return e<c.T.Epsilon?c.T.Epsilon:e},e.prototype._createShape=function(e){var t,i=e.object,a=e.getObjectExtendSize();switch(e.type){case n.Q.SphereImpostor:var c=a.x,l=a.y,h=a.z;t=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(c),this._checkWithEpsilon(l),this._checkWithEpsilon(h))/2);break;case n.Q.CylinderImpostor:var p=e.getParam("nativeOptions");p||(p={});var u=void 0!==p.radiusTop?p.radiusTop:this._checkWithEpsilon(a.x)/2,d=void 0!==p.radiusBottom?p.radiusBottom:this._checkWithEpsilon(a.x)/2,f=void 0!==p.height?p.height:this._checkWithEpsilon(a.y),g=void 0!==p.numSegments?p.numSegments:16;t=new this.BJSCANNON.Cylinder(u,d,f,g);var _=new this.BJSCANNON.Quaternion;_.setFromAxisAngle(new this.BJSCANNON.Vec3(1,0,0),-Math.PI/2);var P=new this.BJSCANNON.Vec3(0,0,0);t.transformAllPoints(P,_);break;case n.Q.BoxImpostor:var y=a.scale(.5);t=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(y.x),this._checkWithEpsilon(y.y),this._checkWithEpsilon(y.z)));break;case n.Q.PlaneImpostor:s.Y.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),t=new this.BJSCANNON.Plane;break;case n.Q.MeshImpostor:var m=i.getVerticesData?i.getVerticesData(r.o.PositionKind):[],b=i.getIndices?i.getIndices():[];if(!m)return void s.Y.Warn("Tried to create a MeshImpostor for an object without vertices. This will fail.");var v=i.position.clone(),S=i.rotation&&i.rotation.clone(),E=i.rotationQuaternion&&i.rotationQuaternion.clone();i.position.copyFromFloats(0,0,0),i.rotation&&i.rotation.copyFromFloats(0,0,0),i.rotationQuaternion&&i.rotationQuaternion.copyFrom(e.getParentsRotation()),i.rotationQuaternion&&i.parent&&i.rotationQuaternion.conjugateInPlace();var x=i.computeWorldMatrix(!0),C=new Array,O=void 0;for(O=0;O<m.length;O+=3)o.P.TransformCoordinates(o.P.FromArray(m,O),x).toArray(C,O);s.Y.Warn("MeshImpostor only collides against spheres."),t=new this.BJSCANNON.Trimesh(C,b),i.position.copyFrom(v),S&&i.rotation&&i.rotation.copyFrom(S),E&&i.rotationQuaternion&&i.rotationQuaternion.copyFrom(E);break;case n.Q.HeightmapImpostor:var A=i.position.clone(),R=i.rotation&&i.rotation.clone(),T=i.rotationQuaternion&&i.rotationQuaternion.clone();i.position.copyFromFloats(0,0,0),i.rotation&&i.rotation.copyFromFloats(0,0,0),i.rotationQuaternion&&i.rotationQuaternion.copyFrom(e.getParentsRotation()),i.rotationQuaternion&&i.parent&&i.rotationQuaternion.conjugateInPlace(),i.rotationQuaternion&&i.rotationQuaternion.multiplyInPlace(this._minus90X),t=this._createHeightmap(i),i.position.copyFrom(A),R&&i.rotation&&i.rotation.copyFrom(R),T&&i.rotationQuaternion&&i.rotationQuaternion.copyFrom(T),i.computeWorldMatrix(!0);break;case n.Q.ParticleImpostor:t=new this.BJSCANNON.Particle;break;case n.Q.NoImpostor:t=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0,0,0))}return t},e.prototype._createHeightmap=function(e,t){var i,s=e.getVerticesData(r.o.PositionKind),n=e.computeWorldMatrix(!0),a=new Array;for(i=0;i<s.length;i+=3)o.P.TransformCoordinates(o.P.FromArray(s,i),n).toArray(a,i);s=a;for(var c=new Array,l=t||~~(Math.sqrt(s.length/3)-1),h=e.getBoundingInfo(),p=Math.min(h.boundingBox.extendSizeWorld.x,h.boundingBox.extendSizeWorld.y),u=h.boundingBox.extendSizeWorld.z,d=2*p/l,f=0;f<s.length;f+=3){var g=Math.round(s[f+0]/d+l/2),_=Math.round(-1*(s[f+1]/d-l/2)),P=-s[f+2]+u;c[g]||(c[g]=[]),c[g][_]||(c[g][_]=P),c[g][_]=Math.max(P,c[g][_])}for(g=0;g<=l;++g){if(!c[g]){for(var y=1;!c[(g+y)%l];)y++;c[g]=c[(g+y)%l].slice()}for(_=0;_<=l;++_)if(!c[g][_]){y=1;for(var m=void 0;void 0===m;)m=c[g][(_+y++)%l];c[g][_]=m}}var b=new this.BJSCANNON.Heightfield(c,{elementSize:d});return b.minY=u,b},e.prototype._updatePhysicsBodyTransformation=function(e){var t=e.object;if(t.computeWorldMatrix&&t.computeWorldMatrix(!0),t.getBoundingInfo()){var i=e.getObjectCenter();this._tmpDeltaPosition.copyFrom(t.getAbsolutePivotPoint().subtract(i)),this._tmpDeltaPosition.divideInPlace(e.object.scaling),this._tmpPosition.copyFrom(i);var s=t.rotationQuaternion;if(s){if(e.type!==n.Q.PlaneImpostor&&e.type!==n.Q.HeightmapImpostor||(s=s.multiply(this._minus90X),e.setDeltaRotation(this._plus90X)),e.type===n.Q.HeightmapImpostor){var r=t,a=r.getBoundingInfo(),c=r.rotationQuaternion;r.rotationQuaternion=this._tmpUnityRotation,r.computeWorldMatrix(!0);var l=i.clone(),h=r.getPivotMatrix();h=h?h.clone():o.y3.Identity();var p=o.y3.Translation(a.boundingBox.extendSizeWorld.x,0,-a.boundingBox.extendSizeWorld.z);r.setPreTransformMatrix(p),r.computeWorldMatrix(!0);var u=(a=r.getBoundingInfo()).boundingBox.centerWorld.subtract(i).subtract(r.position).negate();this._tmpPosition.copyFromFloats(u.x,u.y-a.boundingBox.extendSizeWorld.y,u.z),this._tmpDeltaPosition.copyFrom(a.boundingBox.centerWorld.subtract(l)),this._tmpDeltaPosition.y+=a.boundingBox.extendSizeWorld.y,r.rotationQuaternion=c,r.setPreTransformMatrix(h),r.computeWorldMatrix(!0)}else e.type===n.Q.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);e.setDeltaPosition(this._tmpDeltaPosition),e.physicsBody.position.set(this._tmpPosition.x,this._tmpPosition.y,this._tmpPosition.z),e.physicsBody.quaternion.set(s.x,s.y,s.z,s.w)}}},e.prototype.setTransformationFromPhysicsBody=function(e){if(e.object.position.set(e.physicsBody.position.x,e.physicsBody.position.y,e.physicsBody.position.z),e.object.rotationQuaternion){var t=e.physicsBody.quaternion;e.object.rotationQuaternion.set(t.x,t.y,t.z,t.w)}},e.prototype.setPhysicsBodyTransformation=function(e,t,i){e.physicsBody.position.set(t.x,t.y,t.z),e.physicsBody.quaternion.set(i.x,i.y,i.z,i.w)},e.prototype.isSupported=function(){return void 0!==this.BJSCANNON},e.prototype.setLinearVelocity=function(e,t){e.physicsBody.velocity.set(t.x,t.y,t.z)},e.prototype.setAngularVelocity=function(e,t){e.physicsBody.angularVelocity.set(t.x,t.y,t.z)},e.prototype.getLinearVelocity=function(e){var t=e.physicsBody.velocity;return t?new o.P(t.x,t.y,t.z):null},e.prototype.getAngularVelocity=function(e){var t=e.physicsBody.angularVelocity;return t?new o.P(t.x,t.y,t.z):null},e.prototype.setBodyMass=function(e,t){e.physicsBody.mass=t,e.physicsBody.updateMassProperties()},e.prototype.getBodyMass=function(e){return e.physicsBody.mass},e.prototype.getBodyFriction=function(e){return e.physicsBody.material.friction},e.prototype.setBodyFriction=function(e,t){e.physicsBody.material.friction=t},e.prototype.getBodyRestitution=function(e){return e.physicsBody.material.restitution},e.prototype.setBodyRestitution=function(e,t){e.physicsBody.material.restitution=t},e.prototype.sleepBody=function(e){e.physicsBody.sleep()},e.prototype.wakeUpBody=function(e){e.physicsBody.wakeUp()},e.prototype.updateDistanceJoint=function(e,t){e.physicsJoint.distance=t},e.prototype.setMotor=function(e,t,i,s){s||(e.physicsJoint.enableMotor(),e.physicsJoint.setMotorSpeed(t),i&&this.setLimit(e,i))},e.prototype.setLimit=function(e,t,i){e.physicsJoint.motorEquation.maxForce=t,e.physicsJoint.motorEquation.minForce=void 0===i?-t:i},e.prototype.syncMeshWithImpostor=function(e,t){var i=t.physicsBody;e.position.x=i.position.x,e.position.y=i.position.y,e.position.z=i.position.z,e.rotationQuaternion&&(e.rotationQuaternion.x=i.quaternion.x,e.rotationQuaternion.y=i.quaternion.y,e.rotationQuaternion.z=i.quaternion.z,e.rotationQuaternion.w=i.quaternion.w)},e.prototype.getRadius=function(e){return e.physicsBody.shapes[0].boundingSphereRadius},e.prototype.getBoxSizeToRef=function(e,t){var i=e.physicsBody.shapes[0];t.x=2*i.halfExtents.x,t.y=2*i.halfExtents.y,t.z=2*i.halfExtents.z},e.prototype.dispose=function(){},e.prototype._extendNamespace=function(){var e=new this.BJSCANNON.Vec3,t=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(i,s,o){if(o=o||10,0===(s=s||0))this.internalStep(i),this.time+=i;else{var r=Math.floor((this.time+s)/i)-Math.floor(this.time/i);r=Math.min(r,o)||1;for(var n=performance.now(),a=0;a!==r&&(this.internalStep(i),!(performance.now()-n>1e3*i));a++);this.time+=s;for(var c=this.time%i/i,l=e,h=this.bodies,p=0;p!==h.length;p++){var u=h[p];u.type!==t.Body.STATIC&&u.sleepState!==t.Body.SLEEPING?(u.position.vsub(u.previousPosition,l),l.scale(c,l),u.position.vadd(l,u.interpolatedPosition)):(u.interpolatedPosition.set(u.position.x,u.position.y,u.position.z),u.interpolatedQuaternion.set(u.quaternion.x,u.quaternion.y,u.quaternion.z,u.quaternion.w))}}}},e.prototype.raycast=function(e,t){return this._cannonRaycastResult.reset(),this.world.raycastClosest(e,t,{},this._cannonRaycastResult),this._raycastResult.reset(e,t),this._cannonRaycastResult.hasHit&&(this._raycastResult.setHitData({x:this._cannonRaycastResult.hitNormalWorld.x,y:this._cannonRaycastResult.hitNormalWorld.y,z:this._cannonRaycastResult.hitNormalWorld.z},{x:this._cannonRaycastResult.hitPointWorld.x,y:this._cannonRaycastResult.hitPointWorld.y,z:this._cannonRaycastResult.hitPointWorld.z}),this._raycastResult.setHitDistance(this._cannonRaycastResult.distance)),this._raycastResult},e}();c.T.DefaultPluginFactory=function(){return new h}},86671:(e,t,i)=>{i.d(t,{A:()=>l});var s=i(18737),o=i(7968),r=i(58697),n=i(58095),a=i(84318),c=i(60604),l=function(){function e(e,t,i){void 0===e&&(e=!0),void 0===i&&(i=OIMO),this._useDeltaForWorldStep=e,this.name="OimoJSPlugin",this._fixedTimeStep=1/60,this._tmpImpostorsArray=[],this._tmpPositionVector=n.P.Zero(),this.BJSOIMO=i,this.world=new this.BJSOIMO.World({iterations:t}),this.world.clear(),this._raycastResult=new c.d}return e.prototype.setGravity=function(e){this.world.gravity.set(e.x,e.y,e.z)},e.prototype.setTimeStep=function(e){this.world.timeStep=e},e.prototype.getTimeStep=function(){return this.world.timeStep},e.prototype.executeStep=function(e,t){var i=this;t.forEach((function(e){e.beforeStep()})),this.world.timeStep=this._useDeltaForWorldStep?e:this._fixedTimeStep,this.world.step(),t.forEach((function(e){e.afterStep(),i._tmpImpostorsArray[e.uniqueId]=e}));for(var s=this.world.contacts;null!==s;)if(!s.touching||s.body1.sleeping||s.body2.sleeping){var o=this._tmpImpostorsArray[+s.body1.name],r=this._tmpImpostorsArray[+s.body2.name];o&&r?(o.onCollide({body:r.physicsBody,point:null}),r.onCollide({body:o.physicsBody,point:null}),s=s.next):s=s.next}else s=s.next},e.prototype.applyImpulse=function(e,t,i){var s=e.physicsBody.mass;e.physicsBody.applyImpulse(i.scale(this.world.invScale),t.scale(this.world.invScale*s))},e.prototype.applyForce=function(e,t,i){a.Y.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(e,t,i)},e.prototype.generatePhysicsBody=function(e){var t=this;if(e.parent)e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate());else{if(e.isBodyInitRequired()){var i={name:e.uniqueId,config:[e.getParam("mass")||.001,e.getParam("friction"),e.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:0!==e.getParam("mass"),density:e.getParam("mass"),friction:e.getParam("friction"),restitution:e.getParam("restitution"),world:this.world},o=[e];(h=e.object).getChildMeshes&&h.getChildMeshes().forEach((function(e){e.physicsImpostor&&o.push(e.physicsImpostor)}));var c=function(e){return Math.max(e,r.T.Epsilon)},l=new n._f;o.forEach((function(o){if(o.object.rotationQuaternion){var r=o.object.rotationQuaternion;l.copyFrom(r),o.object.rotationQuaternion.set(0,0,0,1),o.object.computeWorldMatrix(!0);var n=l.toEulerAngles(),h=o.getObjectExtendSize(),p=57.29577951308232;if(o===e){var u=e.getObjectCenter();e.object.getAbsolutePivotPoint().subtractToRef(u,t._tmpPositionVector),t._tmpPositionVector.divideInPlace(e.object.scaling),i.pos.push(u.x),i.pos.push(u.y),i.pos.push(u.z),i.posShape.push(0,0,0),i.rotShape.push(0,0,0)}else{var d=o.object.position.clone();i.posShape.push(d.x),i.posShape.push(d.y),i.posShape.push(d.z),i.rotShape.push(n.x*p,n.y*p,n.z*p)}switch(o.object.rotationQuaternion.copyFrom(l),o.type){case s.Q.ParticleImpostor:a.Y.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case s.Q.SphereImpostor:var f=h.x,g=h.y,_=h.z,P=Math.max(c(f),c(g),c(_))/2;i.type.push("sphere"),i.size.push(P),i.size.push(P),i.size.push(P);break;case s.Q.CylinderImpostor:var y=c(h.x)/2,m=c(h.y);i.type.push("cylinder"),i.size.push(y),i.size.push(m),i.size.push(m);break;case s.Q.PlaneImpostor:case s.Q.BoxImpostor:default:y=c(h.x),m=c(h.y);var b=c(h.z);i.type.push("box"),i.size.push(y),i.size.push(m),i.size.push(b)}o.object.rotationQuaternion=r}})),e.physicsBody=this.world.add(i),e.physicsBody.resetQuaternion(l),e.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);var h;e.setDeltaPosition(this._tmpPositionVector)}},e.prototype.removePhysicsBody=function(e){this.world.removeRigidBody(e.physicsBody)},e.prototype.generateJoint=function(e){var t=e.mainImpostor.physicsBody,i=e.connectedImpostor.physicsBody;if(t&&i){var s,r=e.joint.jointData,n=r.nativeParams||{},c={body1:t,body2:i,axe1:n.axe1||(r.mainAxis?r.mainAxis.asArray():null),axe2:n.axe2||(r.connectedAxis?r.connectedAxis.asArray():null),pos1:n.pos1||(r.mainPivot?r.mainPivot.asArray():null),pos2:n.pos2||(r.connectedPivot?r.connectedPivot.asArray():null),min:n.min,max:n.max,collision:n.collision||r.collision,spring:n.spring,world:this.world};switch(e.joint.type){case o.q7.BallAndSocketJoint:s="jointBall";break;case o.q7.SpringJoint:a.Y.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var l=r;c.min=l.length||c.min,c.max=Math.max(c.min,c.max);case o.q7.DistanceJoint:s="jointDistance",c.max=r.maxDistance;break;case o.q7.PrismaticJoint:s="jointPrisme";break;case o.q7.SliderJoint:s="jointSlide";break;case o.q7.WheelJoint:s="jointWheel";break;case o.q7.HingeJoint:default:s="jointHinge"}c.type=s,e.joint.physicsJoint=this.world.add(c)}},e.prototype.removeJoint=function(e){try{this.world.removeJoint(e.joint.physicsJoint)}catch(e){a.Y.Warn(e)}},e.prototype.isSupported=function(){return void 0!==this.BJSOIMO},e.prototype.setTransformationFromPhysicsBody=function(e){if(!e.physicsBody.sleeping){if(e.physicsBody.shapes.next){for(var t=e.physicsBody.shapes;t.next;)t=t.next;e.object.position.set(t.position.x,t.position.y,t.position.z)}else{var i=e.physicsBody.getPosition();e.object.position.set(i.x,i.y,i.z)}if(e.object.rotationQuaternion){var s=e.physicsBody.getQuaternion();e.object.rotationQuaternion.set(s.x,s.y,s.z,s.w)}}},e.prototype.setPhysicsBodyTransformation=function(e,t,i){var s=e.physicsBody;e.physicsBody.shapes.next||(s.position.set(t.x,t.y,t.z),s.orientation.set(i.x,i.y,i.z,i.w),s.syncShapes(),s.awake())},e.prototype.setLinearVelocity=function(e,t){e.physicsBody.linearVelocity.set(t.x,t.y,t.z)},e.prototype.setAngularVelocity=function(e,t){e.physicsBody.angularVelocity.set(t.x,t.y,t.z)},e.prototype.getLinearVelocity=function(e){var t=e.physicsBody.linearVelocity;return t?new n.P(t.x,t.y,t.z):null},e.prototype.getAngularVelocity=function(e){var t=e.physicsBody.angularVelocity;return t?new n.P(t.x,t.y,t.z):null},e.prototype.setBodyMass=function(e,t){var i=0===t;e.physicsBody.shapes.density=i?1:t,e.physicsBody.setupMass(i?2:1)},e.prototype.getBodyMass=function(e){return e.physicsBody.shapes.density},e.prototype.getBodyFriction=function(e){return e.physicsBody.shapes.friction},e.prototype.setBodyFriction=function(e,t){e.physicsBody.shapes.friction=t},e.prototype.getBodyRestitution=function(e){return e.physicsBody.shapes.restitution},e.prototype.setBodyRestitution=function(e,t){e.physicsBody.shapes.restitution=t},e.prototype.sleepBody=function(e){e.physicsBody.sleep()},e.prototype.wakeUpBody=function(e){e.physicsBody.awake()},e.prototype.updateDistanceJoint=function(e,t,i){e.physicsJoint.limitMotor.upperLimit=t,void 0!==i&&(e.physicsJoint.limitMotor.lowerLimit=i)},e.prototype.setMotor=function(e,t,i,s){void 0!==i?a.Y.Warn("OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"):i=1e6,t*=-1;var o=s?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;o&&o.setMotor(t,i)},e.prototype.setLimit=function(e,t,i,s){var o=s?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;o&&o.setLimit(t,void 0===i?-t:i)},e.prototype.syncMeshWithImpostor=function(e,t){var i=t.physicsBody;e.position.x=i.position.x,e.position.y=i.position.y,e.position.z=i.position.z,e.rotationQuaternion&&(e.rotationQuaternion.x=i.orientation.x,e.rotationQuaternion.y=i.orientation.y,e.rotationQuaternion.z=i.orientation.z,e.rotationQuaternion.w=i.orientation.w)},e.prototype.getRadius=function(e){return e.physicsBody.shapes.radius},e.prototype.getBoxSizeToRef=function(e,t){var i=e.physicsBody.shapes;t.x=2*i.halfWidth,t.y=2*i.halfHeight,t.z=2*i.halfDepth},e.prototype.dispose=function(){this.world.clear()},e.prototype.raycast=function(e,t){return a.Y.Warn("raycast is not currently supported by the Oimo physics plugin"),this._raycastResult.reset(e,t),this._raycastResult},e}()},96627:(e,t,i)=>{i.d(t,{be:()=>R.b,sz:()=>A.s,mN:()=>l.mN,OT:()=>l.OT,yr:()=>l.yr,$Q:()=>l.$Q,AE:()=>T.A,T2:()=>s.T,UU:()=>u,G8:()=>y,Q0:()=>O.Q,q7:()=>l.q7,Vf:()=>E,JD:()=>h,gf:()=>x,o4:()=>p,aj:()=>C});i(78740);var s=i(58697),o=i(84318),r=i(62897),n=i(71419),a=i(85627),c=i(65273),l=i(7968);c.x.prototype.getPhysicsEngine=function(){return this._physicsEngine},c.x.prototype.enablePhysics=function(e,t){if(void 0===e&&(e=null),this._physicsEngine)return!0;var i=this._getComponent(a.l.NAME_PHYSICSENGINE);i||(i=new u(this),this._addComponent(i));try{return this._physicsEngine=new s.T(e,t),this._physicsTimeAccumulator=0,!0}catch(e){return o.Y.Error(e.message),!1}},c.x.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},c.x.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},c.x.prototype.deleteCompoundImpostor=function(e){var t=e.parts[0].mesh;t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)},c.x.prototype._advancePhysicsEngineStep=function(e){if(this._physicsEngine){var t=this._physicsEngine.getSubTimeStep();if(t>0)for(this._physicsTimeAccumulator+=e;this._physicsTimeAccumulator>t;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=t;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(e/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}},Object.defineProperty(n.x.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(e){var t=this;this._physicsImpostor!==e&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=e,e&&(this._disposePhysicsObserver=this.onDisposeObservable.add((function(){t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)}))))},enumerable:!0,configurable:!0}),n.x.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},n.x.prototype.applyImpulse=function(e,t){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(e,t),this):this},n.x.prototype.setPhysicsLinkWith=function(e,t,i,s){return this.physicsImpostor&&e.physicsImpostor?(this.physicsImpostor.createJoint(e.physicsImpostor,l.q7.HingeJoint,{mainPivot:t,connectedPivot:i,nativeParams:s}),this):this};var h,p,u=function(){function e(e){var t=this;this.name=a.l.NAME_PHYSICSENGINE,this.scene=e,this.scene.onBeforePhysicsObservable=new r.y$,this.scene.onAfterPhysicsObservable=new r.y$,this.scene.getDeterministicFrameTime=function(){return t.scene._physicsEngine?1e3*t.scene._physicsEngine.getTimeStep():1e3/60}}return e.prototype.register=function(){},e.prototype.rebuild=function(){},e.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},e}(),d=i(31191),f=i(58095),g=i(48087),_=i(62845),P=i(1316),y=function(){function e(e){this._scene=e,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||o.Y.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return e.prototype.applyRadialExplosionImpulse=function(e,t,i,s){if(!this._physicsEngine)return o.Y.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var r=this._physicsEngine.getImpostors();if(0===r.length)return null;"number"==typeof t&&((t=new E).radius=t,t.strength=i||t.strength,t.falloff=s||t.falloff);var n=new m(this._scene,t),a=Array();return r.forEach((function(t){var i=n.getImpostorHitData(t,e);i&&(t.applyImpulse(i.force,i.contactPoint),a.push({impostor:t,hitData:i}))})),n.triggerAffectedImpostorsCallback(a),n.dispose(!1),n},e.prototype.applyRadialExplosionForce=function(e,t,i,s){if(!this._physicsEngine)return o.Y.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var r=this._physicsEngine.getImpostors();if(0===r.length)return null;"number"==typeof t&&((t=new E).radius=t,t.strength=i||t.strength,t.falloff=s||t.falloff);var n=new m(this._scene,t),a=Array();return r.forEach((function(t){var i=n.getImpostorHitData(t,e);i&&(t.applyForce(i.force,i.contactPoint),a.push({impostor:t,hitData:i}))})),n.triggerAffectedImpostorsCallback(a),n.dispose(!1),n},e.prototype.gravitationalField=function(e,t,i,s){if(!this._physicsEngine)return o.Y.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof t&&((t=new E).radius=t,t.strength=i||t.strength,t.falloff=s||t.falloff);var r=new b(this,this._scene,e,t);return r.dispose(!1),r},e.prototype.updraft=function(e,t,i,s,r){if(!this._physicsEngine)return o.Y.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof t&&((t=new x).radius=t,t.strength=i||t.strength,t.height=s||t.height,t.updraftMode=r||t.updraftMode);var n=new v(this._scene,e,t);return n.dispose(!1),n},e.prototype.vortex=function(e,t,i,s){if(!this._physicsEngine)return o.Y.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof t&&((t=new C).radius=t,t.strength=i||t.strength,t.height=s||t.height);var r=new S(this._scene,e,t);return r.dispose(!1),r},e}(),m=function(){function e(e,t){this._scene=e,this._options=t,this._dataFetched=!1,this._options=(0,d.pi)((0,d.pi)({},new E),this._options)}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.getImpostorHitData=function(e,t){if(0===e.mass)return null;if(!this._intersectsWithSphere(e,t,this._options.radius))return null;if("Mesh"!==e.object.getClassName()&&"InstancedMesh"!==e.object.getClassName())return null;var i=e.getObjectCenter().subtract(t),s=new P.z(t,i,this._options.radius).intersectsMesh(e.object).pickedPoint;if(!s)return null;var o=f.P.Distance(t,s);if(o>this._options.radius)return null;var r=this._options.falloff===h.Constant?this._options.strength:this._options.strength*(1-o/this._options.radius);return{force:i.multiplyByFloats(r,r,r),contactPoint:s,distanceFromOrigin:o}},e.prototype.triggerAffectedImpostorsCallback=function(e){this._options.affectedImpostorsCallback&&this._options.affectedImpostorsCallback(e)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._sphere.dispose():setTimeout((function(){t._dataFetched||t._sphere.dispose()}),0)},e.prototype._prepareSphere=function(){this._sphere||(this._sphere=(0,g.Qk)("radialExplosionEventSphere",this._options.sphere,this._scene),this._sphere.isVisible=!1)},e.prototype._intersectsWithSphere=function(e,t,i){var s=e.object;return this._prepareSphere(),this._sphere.position=t,this._sphere.scaling=new f.P(2*i,2*i,2*i),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(s,!0)},e}(),b=function(){function e(e,t,i,s){this._physicsHelper=e,this._scene=t,this._origin=i,this._options=s,this._dataFetched=!1,this._options=(0,d.pi)((0,d.pi)({},new E),this._options),this._tickCallback=this._tick.bind(this),this._options.strength=-1*this._options.strength}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._sphere.dispose():setTimeout((function(){t._dataFetched||t._sphere.dispose()}),0)},e.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);else{var e=this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);e&&(this._sphere=e.getData().sphere.clone("radialExplosionEventSphereClone"))}},e}(),v=function(){function e(e,t,i){this._scene=e,this._origin=t,this._options=i,this._originTop=f.P.Zero(),this._originDirection=f.P.Zero(),this._cylinderPosition=f.P.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=(0,d.pi)((0,d.pi)({},new x),this._options),this._origin.addToRef(new f.P(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new f.P(0,this._options.height,0),this._originTop),this._options.updraftMode===p.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return e.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),this._cylinder&&(e?this._cylinder.dispose():setTimeout((function(){t._dataFetched||t._cylinder.dispose()}),0))},e.prototype._getImpostorHitData=function(e){if(0===e.mass)return null;if(!this._intersectsWithCylinder(e))return null;var t,i=e.getObjectCenter();t=this._options.updraftMode===p.Perpendicular?this._originDirection:i.subtract(this._originTop);var s=f.P.Distance(this._origin,i),o=-1*this._options.strength;return{force:t.multiplyByFloats(o,o,o),contactPoint:i,distanceFromOrigin:s}},e.prototype._tick=function(){var e=this;this._physicsEngine.getImpostors().forEach((function(t){var i=e._getImpostorHitData(t);i&&t.applyForce(i.force,i.contactPoint)}))},e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=(0,_.wf)("updraftEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},e.prototype._intersectsWithCylinder=function(e){var t=e.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(t,!0)},e}(),S=function(){function e(e,t,i){this._scene=e,this._origin=t,this._options=i,this._originTop=f.P.Zero(),this._cylinderPosition=f.P.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=(0,d.pi)((0,d.pi)({},new C),this._options),this._origin.addToRef(new f.P(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new f.P(0,this._options.height,0),this._originTop),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return e.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._cylinder.dispose():setTimeout((function(){t._dataFetched||t._cylinder.dispose()}),0)},e.prototype._getImpostorHitData=function(e){if(0===e.mass)return null;if(!this._intersectsWithCylinder(e))return null;if("Mesh"!==e.object.getClassName()&&"InstancedMesh"!==e.object.getClassName())return null;var t=e.getObjectCenter(),i=new f.P(this._origin.x,t.y,this._origin.z),s=t.subtract(i),o=new P.z(i,s,this._options.radius).intersectsMesh(e.object),r=o.pickedPoint;if(!r)return null;var n,a,c,l=o.distance/this._options.radius,h=r.normalize();if(l>this._options.centripetalForceThreshold&&(h=h.negate()),l>this._options.centripetalForceThreshold)n=h.x*this._options.centripetalForceMultiplier,a=h.y*this._options.updraftForceMultiplier,c=h.z*this._options.centripetalForceMultiplier;else{var p=f.P.Cross(i,t).normalize();n=(p.x+h.x)*this._options.centrifugalForceMultiplier,a=this._originTop.y*this._options.updraftForceMultiplier,c=(p.z+h.z)*this._options.centrifugalForceMultiplier}var u=new f.P(n,a,c);return{force:u=u.multiplyByFloats(this._options.strength,this._options.strength,this._options.strength),contactPoint:t,distanceFromOrigin:l}},e.prototype._tick=function(){var e=this;this._physicsEngine.getImpostors().forEach((function(t){var i=e._getImpostorHitData(t);i&&t.applyForce(i.force,i.contactPoint)}))},e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=(0,_.wf)("vortexEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},e.prototype._intersectsWithCylinder=function(e){var t=e.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(t,!0)},e}(),E=function(){this.radius=5,this.strength=10,this.falloff=h.Constant,this.sphere={segments:32,diameter:1}},x=function(){this.radius=5,this.strength=10,this.height=10,this.updraftMode=p.Center},C=function(){this.radius=5,this.strength=10,this.height=10,this.centripetalForceThreshold=.7,this.centripetalForceMultiplier=5,this.centrifugalForceMultiplier=.5,this.updraftForceMultiplier=.02};!function(e){e[e.Constant=0]="Constant",e[e.Linear=1]="Linear"}(h||(h={})),function(e){e[e.Center=0]="Center",e[e.Perpendicular=1]="Perpendicular"}(p||(p={}));var O=i(18737),A=i(67087),R=i(35731),T=i(86671)},58697:(e,t,i)=>{i.d(t,{T:()=>r});var s=i(58095),o=i(77851),r=function(){function e(t,i){if(void 0===i&&(i=e.DefaultPluginFactory()),this._physicsPlugin=i,this._impostors=[],this._joints=[],this._subTimeStep=0,this._uniqueIdCounter=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");t=t||new s.P(0,-9.807,0),this.setGravity(t),this.setTimeStep()}return e.DefaultPluginFactory=function(){throw(0,o.S)("CannonJSPlugin")},e.prototype.setGravity=function(e){this.gravity=e,this._physicsPlugin.setGravity(this.gravity)},e.prototype.setTimeStep=function(e){void 0===e&&(e=1/60),this._physicsPlugin.setTimeStep(e)},e.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},e.prototype.setSubTimeStep=function(e){void 0===e&&(e=0),this._subTimeStep=e},e.prototype.getSubTimeStep=function(){return this._subTimeStep},e.prototype.dispose=function(){this._impostors.forEach((function(e){e.dispose()})),this._physicsPlugin.dispose()},e.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},e.prototype.addImpostor=function(e){this._impostors.push(e),e.uniqueId=this._uniqueIdCounter++,e.parent||this._physicsPlugin.generatePhysicsBody(e)},e.prototype.removeImpostor=function(e){var t=this._impostors.indexOf(e);t>-1&&(this._impostors.splice(t,1).length&&this.getPhysicsPlugin().removePhysicsBody(e))},e.prototype.addJoint=function(e,t,i){var s={mainImpostor:e,connectedImpostor:t,joint:i};i.physicsPlugin=this._physicsPlugin,this._joints.push(s),this._physicsPlugin.generateJoint(s)},e.prototype.removeJoint=function(e,t,i){var s=this._joints.filter((function(s){return s.connectedImpostor===t&&s.joint===i&&s.mainImpostor===e}));s.length&&this._physicsPlugin.removeJoint(s[0])},e.prototype._step=function(e){var t=this;this._impostors.forEach((function(e){e.isBodyInitRequired()&&t._physicsPlugin.generatePhysicsBody(e)})),e>.1?e=.1:e<=0&&(e=1/60),this._physicsPlugin.executeStep(e,this._impostors)},e.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},e.prototype.getImpostors=function(){return this._impostors},e.prototype.getImpostorForPhysicsObject=function(e){for(var t=0;t<this._impostors.length;++t)if(this._impostors[t].object===e)return this._impostors[t];return null},e.prototype.getImpostorWithPhysicsBody=function(e){for(var t=0;t<this._impostors.length;++t)if(this._impostors[t].physicsBody===e)return this._impostors[t];return null},e.prototype.raycast=function(e,t){return this._physicsPlugin.raycast(e,t)},e.Epsilon=.001,e}()},18737:(e,t,i)=>{i.d(t,{Q:()=>h});var s=i(84318),o=i(48939),r=i(58095),n=i(71419),a=i(91243),c=i(7968),l=i(43048);a.Kj._PhysicsImpostorParser=function(e,t,i){return new h(t,i.physicsImpostor,{mass:i.physicsMass,friction:i.physicsFriction,restitution:i.physicsRestitution},e)};var h=function(){function e(e,t,i,o){void 0===i&&(i={mass:0});var n=this;this.object=e,this.type=t,this._options=i,this._scene=o,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=r.P.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new r._f,this._tmpQuat2=new r._f,this.beforeStep=function(){n._physicsEngine&&(n.object.translate(n._deltaPosition,-1),n._deltaRotationConjugated&&n.object.rotationQuaternion&&n.object.rotationQuaternion.multiplyToRef(n._deltaRotationConjugated,n.object.rotationQuaternion),n.object.computeWorldMatrix(!1),n.object.parent&&n.object.rotationQuaternion?(n.getParentsRotation(),n._tmpQuat.multiplyToRef(n.object.rotationQuaternion,n._tmpQuat)):n._tmpQuat.copyFrom(n.object.rotationQuaternion||new r._f),n._options.disableBidirectionalTransformation||n.object.rotationQuaternion&&n._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(n,n.object.getAbsolutePosition(),n._tmpQuat),n._onBeforePhysicsStepCallbacks.forEach((function(e){e(n)})))},this.afterStep=function(){n._physicsEngine&&(n._onAfterPhysicsStepCallbacks.forEach((function(e){e(n)})),n._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(n),n.object.parent&&n.object.rotationQuaternion&&(n.getParentsRotation(),n._tmpQuat.conjugateInPlace(),n._tmpQuat.multiplyToRef(n.object.rotationQuaternion,n.object.rotationQuaternion)),n.object.setAbsolutePosition(n.object.position),n._deltaRotation&&n.object.rotationQuaternion&&n.object.rotationQuaternion.multiplyToRef(n._deltaRotation,n.object.rotationQuaternion),n.object.translate(n._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(e){if((n._onPhysicsCollideCallbacks.length||n.onCollideEvent)&&n._physicsEngine){var t=n._physicsEngine.getImpostorWithPhysicsBody(e.body);t&&(n.onCollideEvent&&n.onCollideEvent(n,t),n._onPhysicsCollideCallbacks.filter((function(e){return-1!==e.otherImpostors.indexOf(t)})).forEach((function(i){i.callback(n,t,e.point)})))}},this.object?(this.object.parent&&0!==i.mass&&s.Y.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&e.getScene&&(this._scene=e.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=r._f.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new r._f),this._options.mass=void 0===i.mass?0:i.mass,this._options.friction=void 0===i.friction?.2:i.friction,this._options.restitution=void 0===i.restitution?.2:i.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=void 0===i.pressure?200:i.pressure,this._options.stiffness=void 0===i.stiffness?1:i.stiffness,this._options.velocityIterations=void 0===i.velocityIterations?20:i.velocityIterations,this._options.positionIterations=void 0===i.positionIterations?20:i.positionIterations,this._options.fixedPoints=void 0===i.fixedPoints?0:i.fixedPoints,this._options.margin=void 0===i.margin?0:i.margin,this._options.damping=void 0===i.damping?0:i.damping,this._options.path=void 0===i.path?null:i.path,this._options.shape=void 0===i.shape?null:i.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&s.Y.Warn("You must affect impostors to children before affecting impostor to parent.")):s.Y.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):s.Y.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(e){this.setMass(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var e=this._physicsEngine.getPhysicsPlugin();return e.setBodyPressure?e.getBodyPressure(this):0},set:function(e){if(this._physicsEngine){var t=this._physicsEngine.getPhysicsPlugin();t.setBodyPressure&&t.setBodyPressure(this,e)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var e=this._physicsEngine.getPhysicsPlugin();return e.getBodyStiffness?e.getBodyStiffness(this):0},set:function(e){if(this._physicsEngine){var t=this._physicsEngine.getPhysicsPlugin();t.setBodyStiffness&&t.setBodyStiffness(this,e)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var e=this._physicsEngine.getPhysicsPlugin();return e.getBodyVelocityIterations?e.getBodyVelocityIterations(this):0},set:function(e){if(this._physicsEngine){var t=this._physicsEngine.getPhysicsPlugin();t.setBodyVelocityIterations&&t.setBodyVelocityIterations(this,e)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var e=this._physicsEngine.getPhysicsPlugin();return e.getBodyPositionIterations?e.getBodyPositionIterations(this):0},set:function(e){if(this._physicsEngine){var t=this._physicsEngine.getPhysicsPlugin();t.setBodyPositionIterations&&t.setBodyPositionIterations(this,e)}},enumerable:!1,configurable:!0}),e.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},e.prototype._getPhysicsParent=function(){return this.object.parent instanceof n.x?this.object.parent.physicsImpostor:null},e.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&(!this._parent||!!this._options.ignoreParent)},e.prototype.setScalingUpdated=function(){this.forceUpdate()},e.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(e.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(e){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=e,this.resetUpdateFlags()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(e){this._parent=e},enumerable:!1,configurable:!0}),e.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},e.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var t=this.object.rotationQuaternion,i=this.object.scaling.clone();this.object.rotationQuaternion=e.IDENTITY_QUATERNION;var s=this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);s&&s.decompose(i,void 0,void 0);var o=this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiplyInPlace(i);return o.x=Math.abs(o.x),o.y=Math.abs(o.y),o.z=Math.abs(o.z),this.object.rotationQuaternion=t,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),o}return e.DEFAULT_OBJECT_SIZE},e.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},e.prototype.getParam=function(e){return this._options[e]},e.prototype.setParam=function(e,t){this._options[e]=t,this._bodyUpdateRequired=!0},e.prototype.setMass=function(e){this.getParam("mass")!==e&&this.setParam("mass",e),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,e)},e.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):r.P.Zero()},e.prototype.setLinearVelocity=function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,e)},e.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):r.P.Zero()},e.prototype.setAngularVelocity=function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,e)},e.prototype.executeNativeFunction=function(e){this._physicsEngine&&e(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},e.prototype.registerBeforePhysicsStep=function(e){this._onBeforePhysicsStepCallbacks.push(e)},e.prototype.unregisterBeforePhysicsStep=function(e){var t=this._onBeforePhysicsStepCallbacks.indexOf(e);t>-1?this._onBeforePhysicsStepCallbacks.splice(t,1):s.Y.Warn("Function to remove was not found")},e.prototype.registerAfterPhysicsStep=function(e){this._onAfterPhysicsStepCallbacks.push(e)},e.prototype.unregisterAfterPhysicsStep=function(e){var t=this._onAfterPhysicsStepCallbacks.indexOf(e);t>-1?this._onAfterPhysicsStepCallbacks.splice(t,1):s.Y.Warn("Function to remove was not found")},e.prototype.registerOnPhysicsCollide=function(e,t){var i=e instanceof Array?e:[e];this._onPhysicsCollideCallbacks.push({callback:t,otherImpostors:i})},e.prototype.unregisterOnPhysicsCollide=function(e,t){var i=e instanceof Array?e:[e],o=-1;this._onPhysicsCollideCallbacks.some((function(e,s){if(e.callback===t&&e.otherImpostors.length===i.length){var r=e.otherImpostors.every((function(e){return i.indexOf(e)>-1}));return r&&(o=s),r}return!1}))?this._onPhysicsCollideCallbacks.splice(o,1):s.Y.Warn("Function to remove was not found")},e.prototype.getParentsRotation=function(){var e=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);e;)e.rotationQuaternion?this._tmpQuat2.copyFrom(e.rotationQuaternion):r._f.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,e.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),e=e.parent;return this._tmpQuat},e.prototype.applyForce=function(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,e,t),this},e.prototype.applyImpulse=function(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,e,t),this},e.prototype.createJoint=function(e,t,i){var s=new c.q7(t,i);return this.addJoint(e,s),this},e.prototype.addJoint=function(e,t){return this._joints.push({otherImpostor:e,joint:t}),this._physicsEngine&&this._physicsEngine.addJoint(this,e,t),this},e.prototype.addAnchor=function(e,t,i,s,o){if(!this._physicsEngine)return this;var r=this._physicsEngine.getPhysicsPlugin();return r.appendAnchor?(this._physicsEngine&&r.appendAnchor(this,e,t,i,s,o),this):this},e.prototype.addHook=function(e,t,i,s){if(!this._physicsEngine)return this;var o=this._physicsEngine.getPhysicsPlugin();return o.appendAnchor?(this._physicsEngine&&o.appendHook(this,e,t,i,s),this):this},e.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},e.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},e.prototype.clone=function(t){return t?new e(t,this.type,this._options,this._scene):null},e.prototype.dispose=function(){var e=this;this._physicsEngine&&(this._joints.forEach((function(t){e._physicsEngine&&e._physicsEngine.removeJoint(e,t.otherImpostor,t.joint)})),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},e.prototype.setDeltaPosition=function(e){this._deltaPosition.copyFrom(e)},e.prototype.setDeltaRotation=function(e){this._deltaRotation||(this._deltaRotation=new r._f),this._deltaRotation.copyFrom(e),this._deltaRotationConjugated=this._deltaRotation.conjugate()},e.prototype.getBoxSizeToRef=function(e){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,e),this},e.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},e.prototype.syncBoneWithImpostor=function(t,i,s,o,r){var n=e._TmpVecs[0],a=this.object;if(a.rotationQuaternion)if(r){var c=e._TmpQuat;a.rotationQuaternion.multiplyToRef(r,c),t.setRotationQuaternion(c,l.T.WORLD,i)}else t.setRotationQuaternion(a.rotationQuaternion,l.T.WORLD,i);n.x=0,n.y=0,n.z=0,s&&(n.x=s.x,n.y=s.y,n.z=s.z,t.getDirectionToRef(n,i,n),null==o&&(o=s.length()),n.x*=o,n.y*=o,n.z*=o),t.getParent()?(n.addInPlace(a.getAbsolutePosition()),t.setAbsolutePosition(n,i)):(i.setAbsolutePosition(a.getAbsolutePosition()),i.position.x-=n.x,i.position.y-=n.y,i.position.z-=n.z)},e.prototype.syncImpostorWithBone=function(t,i,s,o,r,n){var a=this.object;if(a.rotationQuaternion)if(r){var c=e._TmpQuat;t.getRotationQuaternionToRef(l.T.WORLD,i,c),c.multiplyToRef(r,a.rotationQuaternion)}else t.getRotationQuaternionToRef(l.T.WORLD,i,a.rotationQuaternion);var h=e._TmpVecs[0],p=e._TmpVecs[1];n||((n=e._TmpVecs[2]).x=0,n.y=1,n.z=0),t.getDirectionToRef(n,i,p),t.getAbsolutePositionToRef(i,h),null==o&&s&&(o=s.length()),null!=o&&(h.x+=p.x*o,h.y+=p.y*o,h.z+=p.z*o),a.setAbsolutePosition(h)},e.DEFAULT_OBJECT_SIZE=new r.P(1,1,1),e.IDENTITY_QUATERNION=r._f.Identity(),e._TmpVecs=o.B.BuildArray(3,r.P.Zero),e._TmpQuat=r._f.Identity(),e.NoImpostor=0,e.SphereImpostor=1,e.BoxImpostor=2,e.PlaneImpostor=3,e.MeshImpostor=4,e.CapsuleImpostor=6,e.CylinderImpostor=7,e.ParticleImpostor=8,e.HeightmapImpostor=9,e.ConvexHullImpostor=10,e.CustomImpostor=100,e.RopeImpostor=101,e.ClothImpostor=102,e.SoftbodyImpostor=103,e}()},7968:(e,t,i)=>{i.d(t,{$Q:()=>n,OT:()=>c,mN:()=>r,q7:()=>o,yr:()=>a});var s=i(31191),o=function(){function e(e,t){this.type=e,this.jointData=t,t.nativeParams=t.nativeParams||{}}return Object.defineProperty(e.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(e){this._physicsJoint,this._physicsJoint=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"physicsPlugin",{set:function(e){this._physicsPlugin=e},enumerable:!1,configurable:!0}),e.prototype.executeNativeFunction=function(e){e(this._physicsPlugin.world,this._physicsJoint)},e.DistanceJoint=0,e.HingeJoint=1,e.BallAndSocketJoint=2,e.WheelJoint=3,e.SliderJoint=4,e.PrismaticJoint=5,e.UniversalJoint=6,e.Hinge2Joint=e.WheelJoint,e.PointToPointJoint=8,e.SpringJoint=9,e.LockJoint=10,e}(),r=function(e){function t(t){return e.call(this,o.DistanceJoint,t)||this}return(0,s.ZT)(t,e),t.prototype.updateDistance=function(e,t){this._physicsPlugin.updateDistanceJoint(this,e,t)},t}(o),n=function(e){function t(t,i){return e.call(this,t,i)||this}return(0,s.ZT)(t,e),t.prototype.setMotor=function(e,t){this._physicsPlugin.setMotor(this,e||0,t)},t.prototype.setLimit=function(e,t){this._physicsPlugin.setLimit(this,e,t)},t}(o),a=function(e){function t(t){return e.call(this,o.HingeJoint,t)||this}return(0,s.ZT)(t,e),t.prototype.setMotor=function(e,t){this._physicsPlugin.setMotor(this,e||0,t)},t.prototype.setLimit=function(e,t){this._physicsPlugin.setLimit(this,e,t)},t}(n),c=function(e){function t(t){return e.call(this,o.Hinge2Joint,t)||this}return(0,s.ZT)(t,e),t.prototype.setMotor=function(e,t,i){void 0===i&&(i=0),this._physicsPlugin.setMotor(this,e||0,t,i)},t.prototype.setLimit=function(e,t,i){void 0===i&&(i=0),this._physicsPlugin.setLimit(this,e,t,i)},t}(n)},60604:(e,t,i)=>{i.d(t,{d:()=>o});var s=i(58095),o=function(){function e(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=s.P.Zero(),this._hitPointWorld=s.P.Zero(),this._rayFromWorld=s.P.Zero(),this._rayToWorld=s.P.Zero()}return Object.defineProperty(e.prototype,"hasHit",{get:function(){return this._hasHit},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hitNormalWorld",{get:function(){return this._hitNormalWorld},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hitPointWorld",{get:function(){return this._hitPointWorld},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rayFromWorld",{get:function(){return this._rayFromWorld},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rayToWorld",{get:function(){return this._rayToWorld},enumerable:!1,configurable:!0}),e.prototype.setHitData=function(e,t){this._hasHit=!0,this._hitNormalWorld=new s.P(e.x,e.y,e.z),this._hitPointWorld=new s.P(t.x,t.y,t.z)},e.prototype.setHitDistance=function(e){this._hitDistance=e},e.prototype.calculateHitDistance=function(){this._hitDistance=s.P.Distance(this._rayFromWorld,this._hitPointWorld)},e.prototype.reset=function(e,t){void 0===e&&(e=s.P.Zero()),void 0===t&&(t=s.P.Zero()),this._rayFromWorld=e,this._rayToWorld=t,this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=s.P.Zero(),this._hitPointWorld=s.P.Zero()},e}()},92151:(e,t,i)=>{i.d(t,{k:()=>n});var s=i(31191),o=i(16142),r=(i(41209),i(48620)),n=function(e){function t(t,i,s,o,r,n){var a=e.call(this,t,"anaglyph",null,["leftSampler"],i,s[1],o,r,n)||this;return a._passedProcess=s[0]._rigPostProcess,a.onApplyObservable.add((function(e){e.setTextureFromPostProcess("leftSampler",a._passedProcess)})),a}return(0,s.ZT)(t,e),t.prototype.getClassName=function(){return"AnaglyphPostProcess"},t}(o.D);(0,r.H)("BABYLON.AnaglyphPostProcess",n)},442:(e,t,i)=>{i.d(t,{i:()=>c});var s=i(31191),o=i(16142),r=i(73803),n=(i(14315),i(36312),i(48620)),a=i(96969),c=function(e){function t(t,i,s,o,n,a,c,l,h,p,u){void 0===a&&(a=r.x.BILINEAR_SAMPLINGMODE),void 0===h&&(h=0),void 0===p&&(p=""),void 0===u&&(u=!1);var d=e.call(this,t,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],o,n,a,c,l,null,h,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return d._blockCompilation=u,d._packedFloat=!1,d._staticDefines="",d._staticDefines=p,d.direction=i,d.onApplyObservable.add((function(e){d._outputTexture?e.setFloat2("delta",1/d._outputTexture.width*d.direction.x,1/d._outputTexture.height*d.direction.y):e.setFloat2("delta",1/d.width*d.direction.x,1/d.height*d.direction.y)})),d.kernel=s,d}return(0,s.ZT)(t,e),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._idealKernel},set:function(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this._blockCompilation||this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(e){this._packedFloat!==e&&(this._packedFloat=e,this._blockCompilation||this._updateParameters())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"BlurPostProcess"},t.prototype.updateEffect=function(e,t,i,s,o,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===i&&(i=null),this._updateParameters(o,r)},t.prototype._updateParameters=function(t,i){for(var s=this._kernel,o=(s-1)/2,r=[],n=[],a=0,c=0;c<s;c++){var l=c/(s-1),h=this._gaussianWeight(2*l-1);r[c]=c-o,n[c]=h,a+=h}for(c=0;c<n.length;c++)n[c]/=a;var p=[],u=[],d=[];for(c=0;c<=o;c+=2){var f=Math.min(c+1,Math.floor(o));if(c===f)d.push({o:r[c],w:n[c]});else{var g=f===o,_=n[c]+n[f]*(g?.5:1),P=r[c]+1/(1+n[c]/n[f]);0===P?(d.push({o:r[c],w:n[c]}),d.push({o:r[c+1],w:n[c+1]})):(d.push({o:P,w:_}),d.push({o:-P,w:_}))}}for(c=0;c<d.length;c++)u[c]=d[c].o,p[c]=d[c].w;r=u,n=p;var y=this.getEngine().getCaps().maxVaryingVectors,m=Math.max(y,0)-1,b=Math.min(r.length,m),v="";v+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(v+="#define CENTER_WEIGHT ".concat(this._glslFloat(n[b-1]),"\r\n"),b--);for(c=0;c<b;c++)v+="#define KERNEL_OFFSET".concat(c," ").concat(this._glslFloat(r[c]),"\r\n"),v+="#define KERNEL_WEIGHT".concat(c," ").concat(this._glslFloat(n[c]),"\r\n");var S=0;for(c=m;c<r.length;c++)v+="#define KERNEL_DEP_OFFSET".concat(S," ").concat(this._glslFloat(r[c]),"\r\n"),v+="#define KERNEL_DEP_WEIGHT".concat(S," ").concat(this._glslFloat(n[c]),"\r\n"),S++;this.packedFloat&&(v+="#define PACKEDFLOAT 1"),this._blockCompilation=!1,e.prototype.updateEffect.call(this,v,null,null,{varyingCount:b,depCount:S},t,i)},t.prototype._nearestBestKernel=function(e){for(var t=Math.round(e),i=0,s=[t,t-1,t+1,t-2,t+2];i<s.length;i++){var o=s[i];if(o%2!=0&&Math.floor(o/2)%2==0&&o>0)return Math.max(o,3)}return Math.max(t,3)},t.prototype._gaussianWeight=function(e){var t=1/3,i=-e*e/(2*t*t);return 1/(Math.sqrt(2*Math.PI)*t)*Math.exp(i)},t.prototype._glslFloat=function(e,t){return void 0===t&&(t=8),e.toFixed(t).replace(/0+$/,"")},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.direction,e.kernel,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.reusable,e.textureType,void 0,!1)}),e,s,o)},(0,s.gn)([(0,a.qC)("kernel")],t.prototype,"_kernel",void 0),(0,s.gn)([(0,a.qC)("packedFloat")],t.prototype,"_packedFloat",void 0),(0,s.gn)([(0,a.QC)()],t.prototype,"direction",void 0),t}(o.D);(0,n.H)("BABYLON.BlurPostProcess",c)},30374:(e,t,i)=>{i.d(t,{P:()=>c});var s=i(31191),o=i(73803),r=i(16142),n=(i(94245),i(67495),i(48620)),a=i(96969),c=function(e){function t(t,i,s,r,n,a,c){void 0===s&&(s=null),void 0===c&&(c=0);var l=e.call(this,t,"fxaa",["texelSize"],null,i,s,r||o.x.BILINEAR_SAMPLINGMODE,n,a,null,c,"fxaa",void 0,!0)||this,h=l._getDefines();return l.updateEffect(h),l.onApplyObservable.add((function(e){var t=l.texelSize;e.setFloat2("texelSize",t.x,t.y)})),l}return(0,s.ZT)(t,e),t.prototype.getClassName=function(){return"FxaaPostProcess"},t.prototype._getDefines=function(){var e=this.getEngine();if(!e)return null;var t=e.getGlInfo();return t&&t.renderer&&t.renderer.toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.reusable)}),e,s,o)},t}(r.D);(0,n.H)("BABYLON.FxaaPostProcess",c)},90216:(e,t,i)=>{i.d(t,{z:()=>c});var s=i(31191),o=i(96969),r=i(90622),n=i(16142),a=i(15210),c=(i(37328),i(80196),function(e){function t(t,i,s,o,r,n,a,c){void 0===s&&(s=null),void 0===a&&(a=0);var l=e.call(this,t,"imageProcessing",[],[],i,s,o,r,n,null,a,"postprocess",null,!0)||this;return l._fromLinearSpace=!0,l._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,TONEMAPPING_ACES:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1,SKIPFINALCOLORCLAMP:!1},c?(c.applyByPostProcess=!0,l._attachImageProcessingConfiguration(c,!0),l._updateParameters()):(l._attachImageProcessingConfiguration(null,!0),l.imageProcessingConfiguration.applyByPostProcess=!0),l.onApply=function(e){l.imageProcessingConfiguration.bind(e,l.aspectRatio)},l}return(0,s.ZT)(t,e),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){e.applyByPostProcess=!0,this._attachImageProcessingConfiguration(e)},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e,t){var i=this;if(void 0===t&&(t=!1),e!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e)this._imageProcessingConfiguration=e;else{var s=null,o=this.getEngine(),n=this.getCamera();if(n)s=n.getScene();else if(o&&o.scenes){var c=o.scenes;s=c[c.length-1]}else s=a.l.LastCreatedScene;this._imageProcessingConfiguration=s?s.imageProcessingConfiguration:new r.$}this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){i._updateParameters()}))),t||this._updateParameters()}},Object.defineProperty(t.prototype,"isSupported",{get:function(){var e=this.getEffect();return!e||e.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(e){this.imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingType",{get:function(){return this._imageProcessingConfiguration.toneMappingType},set:function(e){this._imageProcessingConfiguration.toneMappingType=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(e){this.imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(e){this.imageProcessingConfiguration.vignetteStretch=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(e){this.imageProcessingConfiguration.vignetteCentreX=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(e){this.imageProcessingConfiguration.vignetteCentreY=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(e){this.imageProcessingConfiguration.vignetteWeight=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(e){this.imageProcessingConfiguration.vignetteColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(e){this.imageProcessingConfiguration.vignetteCameraFov=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(e){this.imageProcessingConfiguration.vignetteBlendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(e){this.imageProcessingConfiguration.vignetteEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(e){this._fromLinearSpace!==e&&(this._fromLinearSpace=e,this._updateParameters())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"ImageProcessingPostProcess"},t.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var e="";for(var t in this._defines)this._defines[t]&&(e+="#define ".concat(t,";\r\n"));var i=["textureSampler"],s=["scale"];r.$&&(r.$.PrepareSamplers(i,this._defines),r.$.PrepareUniforms(s,this._defines)),this.updateEffect(e,s,i)},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration&&(this.imageProcessingConfiguration.applyByPostProcess=!1)},(0,s.gn)([(0,o.qC)()],t.prototype,"_fromLinearSpace",void 0),t}(n.D))},52432:(e,t,i)=>{i.d(t,{kT:()=>s.k,Oy:()=>c,rk:()=>P,GV:()=>f,ik:()=>d.i,nE:()=>y,NF:()=>b,y6:()=>v,mt:()=>S,ei:()=>Z,Tp:()=>E,Jy:()=>A,zm:()=>x,fH:()=>O,SW:()=>C,X_:()=>R,mn:()=>u,nR:()=>T,PT:()=>B.P,pt:()=>M,SL:()=>w,z8:()=>F.z,pX:()=>X,bh:()=>L,ZU:()=>N.Z,Qm:()=>N.Q,Ds:()=>r.D,OX:()=>j.O,L7:()=>h,$g:()=>V,aL:()=>Q,LK:()=>U,Zz:()=>H,LC:()=>ee,V0:()=>te,lt:()=>Se,Gl:()=>oe,VL:()=>z,pJ:()=>re,VB:()=>ae.J,i1:()=>ae.i,uB:()=>ce,lA:()=>ne,TM:()=>be.T,Ec:()=>ve.E,GM:()=>me});var s=i(92151),o=i(31191),r=i(16142),n=(i(62620),i(48620)),a=i(96969),c=function(e){function t(t,i,s,o,r,n){var a=e.call(this,t,"blackAndWhite",["degree"],null,i,s,o,r,n)||this;return a.degree=1,a.onApplyObservable.add((function(e){e.setFloat("degree",a.degree)})),a}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"BlackAndWhitePostProcess"},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.reusable)}),e,s,o)},(0,o.gn)([(0,a.qC)()],t.prototype,"degree",void 0),t}(r.D);(0,n.H)("BABYLON.BlackAndWhitePostProcess",c);var l=i(13514),h=function(){function e(e,t,i,s){this._name=t,this._singleInstance=s||!0,this._getPostProcesses=i,this._cameras={},this._indicesForCamera={},this._postProcesses={}}return Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var e in this._postProcesses)if(Object.prototype.hasOwnProperty.call(this._postProcesses,e))for(var t=this._postProcesses[e],i=0;i<t.length;i++)if(!t[i].isSupported)return!1;return!0},enumerable:!1,configurable:!0}),e.prototype._update=function(){},e.prototype._attachCameras=function(e){var t,i=this,s=l.w1.MakeArray(e||this._cameras);if(s)for(var o=function(e){var o=s[e];if(!o)return"continue";var n=o.name;if(t=r._singleInstance?0:n,!r._postProcesses[t]){var a=r._getPostProcesses();a&&(r._postProcesses[t]=Array.isArray(a)?a:[a])}r._indicesForCamera[n]||(r._indicesForCamera[n]=[]),r._postProcesses[t].forEach((function(e){var t=o.attachPostProcess(e);i._indicesForCamera[n].push(t)})),r._cameras[n]||(r._cameras[n]=o)},r=this,n=0;n<s.length;n++)o(n)},e.prototype._detachCameras=function(e){var t=l.w1.MakeArray(e||this._cameras);if(t)for(var i=function(e){var i=t[e],o=i.name,r=s._postProcesses[s._singleInstance?0:o];r&&r.forEach((function(e){i.detachPostProcess(e)})),s._cameras[o]&&(s._cameras[o]=null)},s=this,o=0;o<t.length;o++)i(o)},e.prototype._enable=function(e){var t=this,i=l.w1.MakeArray(e||this._cameras);if(i)for(var s=function(e){for(var s=i[e],r=s.name,n=function(n){void 0!==s._postProcesses[o._indicesForCamera[r][n]]&&null!==s._postProcesses[o._indicesForCamera[r][n]]||o._postProcesses[o._singleInstance?0:r].forEach((function(s){i[e].attachPostProcess(s,t._indicesForCamera[r][n])}))},a=0;a<o._indicesForCamera[r].length;a++)n(a)},o=this,r=0;r<i.length;r++)s(r)},e.prototype._disable=function(e){var t=l.w1.MakeArray(e||this._cameras);if(t)for(var i=function(e){var i=t[e],o=i.name;s._postProcesses[s._singleInstance?0:o].forEach((function(e){i.detachPostProcess(e)}))},s=this,o=0;o<t.length;o++)i(o)},e.prototype.getPostProcesses=function(e){return this._singleInstance?this._postProcesses[0]:e?this._postProcesses[e.name]:null},e}(),p=i(48154),u=(i(25655),function(e){function t(t,i,s,o,r,n,a,c){void 0===a&&(a=0),void 0===c&&(c=!1);var l=e.call(this,t,"extractHighlights",["threshold","exposure"],null,i,s,o,r,n,null,a,void 0,null,c)||this;return l.threshold=.9,l._exposure=1,l._inputPostProcess=null,l.onApplyObservable.add((function(e){l.externalTextureSamplerBinding=!!l._inputPostProcess,l._inputPostProcess&&e.setTextureFromPostProcess("textureSampler",l._inputPostProcess),e.setFloat("threshold",Math.pow(l.threshold,p.zp)),e.setFloat("exposure",l._exposure)})),l}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"ExtractHighlightsPostProcess"},(0,o.gn)([(0,a.qC)()],t.prototype,"threshold",void 0),t}(r.D));(0,n.H)("BABYLON.ExtractHighlightsPostProcess",u);var d=i(442),f=(i(89055),function(e){function t(t,i,s,o,r,n,a,c,l,h,p){void 0===h&&(h=0),void 0===p&&(p=!1);var u=e.call(this,t,"bloomMerge",["bloomWeight"],["bloomBlur"],r,n,a,c,l,null,h,void 0,null,!0)||this;return u.weight=1,u.weight=o,u.externalTextureSamplerBinding=!0,u.onApplyObservable.add((function(e){e.setTextureFromPostProcess("textureSampler",i),e.setTextureFromPostProcessOutput("bloomBlur",s),e.setFloat("bloomWeight",u.weight)})),p||u.updateEffect(),u}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"BloomMergePostProcess"},(0,o.gn)([(0,a.qC)()],t.prototype,"weight",void 0),t}(r.D));(0,n.H)("BABYLON.BloomMergePostProcess",f);var g=i(58095),_=i(73803),P=function(e){function t(t,i,s,o,r,n){void 0===r&&(r=0),void 0===n&&(n=!1);var a=e.call(this,t.getEngine(),"bloom",(function(){return a._effects}),!0)||this;return a._bloomScale=i,a._effects=[],a._downscale=new u("highlights",1,null,_.x.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,r,n),a._blurX=new d.i("horizontal blur",new g.FM(1,0),10,i,null,_.x.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,r,void 0,n),a._blurX.alwaysForcePOT=!0,a._blurX.autoClear=!1,a._blurY=new d.i("vertical blur",new g.FM(0,1),10,i,null,_.x.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,r,void 0,n),a._blurY.alwaysForcePOT=!0,a._blurY.autoClear=!1,a.kernel=o,a._effects=[a._downscale,a._blurX,a._blurY],a._merge=new f("bloomMerge",a._downscale,a._blurY,s,i,null,_.x.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,r,n),a._merge.autoClear=!1,a._effects.push(a._merge),a}return(0,o.ZT)(t,e),Object.defineProperty(t.prototype,"threshold",{get:function(){return this._downscale.threshold},set:function(e){this._downscale.threshold=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"weight",{get:function(){return this._merge.weight},set:function(e){this._merge.weight=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._blurX.kernel/this._bloomScale},set:function(e){this._blurX.kernel=e*this._bloomScale,this._blurY.kernel=e*this._bloomScale},enumerable:!1,configurable:!0}),t.prototype.disposeEffects=function(e){for(var t=0;t<this._effects.length;t++)this._effects[t].dispose(e)},t.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[e].updateEffect()},t.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[e].isReady())return!1;return!0},t}(h),y=(i(95217),function(e){function t(t,i,s,o,r,n,a,c,l,h){void 0===l&&(l=0),void 0===h&&(h=!1);var p=e.call(this,t,"chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],o,r,n,a,c,null,l,void 0,null,h)||this;return p.aberrationAmount=30,p.radialIntensity=0,p.direction=new g.FM(.707,.707),p.centerPosition=new g.FM(.5,.5),p.screenWidth=i,p.screenHeight=s,p.onApplyObservable.add((function(e){e.setFloat("chromatic_aberration",p.aberrationAmount),e.setFloat("screen_width",i),e.setFloat("screen_height",s),e.setFloat("radialIntensity",p.radialIntensity),e.setFloat2("direction",p.direction.x,p.direction.y),e.setFloat2("centerPosition",p.centerPosition.x,p.centerPosition.y)})),p}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"ChromaticAberrationPostProcess"},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.screenWidth,e.screenHeight,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.reusable,e.textureType,!1)}),e,s,o)},(0,o.gn)([(0,a.qC)()],t.prototype,"aberrationAmount",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"radialIntensity",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"direction",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"centerPosition",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"screenWidth",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"screenHeight",void 0),t}(r.D));(0,n.H)("BABYLON.ChromaticAberrationPostProcess",y);var m=i(84318),b=(i(6603),function(e){function t(t,i,s,o,r,n,a,c,l){void 0===c&&(c=0),void 0===l&&(l=!1);var h=e.call(this,t,"circleOfConfusion",["cameraMinMaxZ","focusDistance","cocPrecalculation"],["depthSampler"],s,o,r,n,a,null,c,void 0,null,l)||this;return h.lensSize=50,h.fStop=1.4,h.focusDistance=2e3,h.focalLength=50,h._depthTexture=null,h._depthTexture=i,h.onApplyObservable.add((function(e){if(h._depthTexture){e.setTexture("depthSampler",h._depthTexture);var t=h.lensSize/h.fStop*h.focalLength/(h.focusDistance-h.focalLength);e.setFloat("focusDistance",h.focusDistance),e.setFloat("cocPrecalculation",t),e.setFloat2("cameraMinMaxZ",h._depthTexture.activeCamera.minZ,h._depthTexture.activeCamera.maxZ)}else m.Y.Warn("No depth texture set on CircleOfConfusionPostProcess")})),h}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"CircleOfConfusionPostProcess"},Object.defineProperty(t.prototype,"depthTexture",{set:function(e){this._depthTexture=e},enumerable:!1,configurable:!0}),(0,o.gn)([(0,a.qC)()],t.prototype,"lensSize",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"fStop",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"focusDistance",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"focalLength",void 0),t}(r.D));(0,n.H)("BABYLON.CircleOfConfusionPostProcess",b);i(58907);var v=function(e){function t(t,i,s,o,r,n,a){var c=e.call(this,t,"colorCorrection",null,["colorTable"],s,o,r,n,a)||this;return c._colorTableTexture=new _.x(i,o.getScene(),!0,!1,_.x.TRILINEAR_SAMPLINGMODE),c._colorTableTexture.anisotropicFilteringLevel=1,c._colorTableTexture.wrapU=_.x.CLAMP_ADDRESSMODE,c._colorTableTexture.wrapV=_.x.CLAMP_ADDRESSMODE,c.colorTableUrl=i,c.onApply=function(e){e.setTexture("colorTable",c._colorTableTexture)},c}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"ColorCorrectionPostProcess"},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.colorTableUrl,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.reusable)}),e,s,o)},(0,o.gn)([(0,a.qC)()],t.prototype,"colorTableUrl",void 0),t}(r.D);(0,n.H)("BABYLON.ColorCorrectionPostProcess",v);i(94132);var S=function(e){function t(t,i,s,o,r,n,a,c){void 0===c&&(c=0);var l=e.call(this,t,"convolution",["kernel","screenSize"],null,s,o,r,n,a,null,c)||this;return l.kernel=i,l.onApply=function(e){e.setFloat2("screenSize",l.width,l.height),e.setArray("kernel",l.kernel)},l}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"ConvolutionPostProcess"},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.kernel,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.reusable,e.textureType)}),e,s,o)},t.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],t.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],t.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],t.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],t.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],t.GaussianKernel=[0,1,0,1,1,1,0,1,0],(0,o.gn)([(0,a.qC)()],t.prototype,"kernel",void 0),t}(r.D);(0,n.H)("BABYLON.ConvolutionPostProcess",S);var E=function(e){function t(t,i,s,o,r,n,a,c,l,h,p,u,d){void 0===c&&(c=null),void 0===l&&(l=_.x.BILINEAR_SAMPLINGMODE),void 0===u&&(u=0),void 0===d&&(d=!1);var f=e.call(this,t,s,o,r,n,l=2,h,p,u,"#define DOF 1\r\n",d)||this;return f.direction=s,f.externalTextureSamplerBinding=!!c,f.onApplyObservable.add((function(e){null!=c&&e.setTextureFromPostProcess("textureSampler",c),e.setTextureFromPostProcessOutput("circleOfConfusionSampler",a),i.activeCamera&&e.setFloat2("cameraMinMaxZ",i.activeCamera.minZ,i.activeCamera.maxZ)})),f}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"DepthOfFieldBlurPostProcess"},(0,o.gn)([(0,a.qC)()],t.prototype,"direction",void 0),t}(d.i);(0,n.H)("BABYLON.DepthOfFieldBlurPostProcess",E);i(99594);var x,C=function(){},O=function(e){function t(t,i,s,o,r,n,a,c,l,h,p){void 0===h&&(h=0),void 0===p&&(p=!1);var u=e.call(this,t,"depthOfFieldMerge",[],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"],r,n,a,c,l,null,h,void 0,null,!0)||this;return u._blurSteps=o,u.externalTextureSamplerBinding=!0,u.onApplyObservable.add((function(e){e.setTextureFromPostProcess("textureSampler",i),e.setTextureFromPostProcessOutput("circleOfConfusionSampler",s),o.forEach((function(t,i){e.setTextureFromPostProcessOutput("blurStep"+(o.length-i-1),t)}))})),p||u.updateEffect(),u}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"DepthOfFieldMergePostProcess"},t.prototype.updateEffect=function(t,i,s,o,r,n){void 0===t&&(t=null),void 0===i&&(i=null),void 0===s&&(s=null),t||(t="",t+="#define BLUR_LEVEL "+(this._blurSteps.length-1)+"\n"),e.prototype.updateEffect.call(this,t,i,s,o,r,n)},t}(r.D);!function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(x||(x={}));var A=function(e){function t(t,i,s,o,r){void 0===s&&(s=x.Low),void 0===o&&(o=0),void 0===r&&(r=!1);var n=e.call(this,t.getEngine(),"depth of field",(function(){return n._effects}),!0)||this;n._effects=[],n._circleOfConfusion=new b("circleOfConfusion",i,1,null,_.x.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,o,r),n._depthOfFieldBlurY=[],n._depthOfFieldBlurX=[];var a=1,c=15;switch(s){case x.High:a=3,c=51;break;case x.Medium:a=2,c=31;break;default:c=15,a=1}for(var l=c/Math.pow(2,a-1),h=1,p=0;p<a;p++){var u=new E("vertical blur",t,new g.FM(0,1),l,h,null,n._circleOfConfusion,0==p?n._circleOfConfusion:null,_.x.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,o,r);u.autoClear=!1,h=.75/Math.pow(2,p);var d=new E("horizontal blur",t,new g.FM(1,0),l,h,null,n._circleOfConfusion,null,_.x.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,o,r);d.autoClear=!1,n._depthOfFieldBlurY.push(u),n._depthOfFieldBlurX.push(d)}n._effects=[n._circleOfConfusion];for(p=0;p<n._depthOfFieldBlurX.length;p++)n._effects.push(n._depthOfFieldBlurY[p]),n._effects.push(n._depthOfFieldBlurX[p]);return n._dofMerge=new O("dofMerge",n._circleOfConfusion,n._circleOfConfusion,n._depthOfFieldBlurX,h,null,_.x.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,o,r),n._dofMerge.autoClear=!1,n._effects.push(n._dofMerge),n}return(0,o.ZT)(t,e),Object.defineProperty(t.prototype,"focalLength",{get:function(){return this._circleOfConfusion.focalLength},set:function(e){this._circleOfConfusion.focalLength=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fStop",{get:function(){return this._circleOfConfusion.fStop},set:function(e){this._circleOfConfusion.fStop=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"focusDistance",{get:function(){return this._circleOfConfusion.focusDistance},set:function(e){this._circleOfConfusion.focusDistance=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lensSize",{get:function(){return this._circleOfConfusion.lensSize},set:function(e){this._circleOfConfusion.lensSize=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"DepthOfFieldEffect"},Object.defineProperty(t.prototype,"depthTexture",{set:function(e){this._circleOfConfusion.depthTexture=e},enumerable:!1,configurable:!0}),t.prototype.disposeEffects=function(e){for(var t=0;t<this._effects.length;t++)this._effects[t].dispose(e)},t.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[e].updateEffect()},t.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[e].isReady())return!1;return!0},t}(h),R=(i(31548),function(e){function t(t,i,s,o,r,n){return e.call(this,t,"displayPass",["passSampler"],["passSampler"],i,s,o,r,n)||this}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"DisplayPassPostProcess"},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.reusable)}),e,s,o)},t}(r.D));(0,n.H)("BABYLON.DisplayPassPostProcess",R);i(66583);var T=function(e){function t(t,i,s,o,r,n,a){var c=e.call(this,t,"filter",["kernelMatrix"],null,s,o,r,n,a)||this;return c.kernelMatrix=i,c.onApply=function(e){e.setMatrix("kernelMatrix",c.kernelMatrix)},c}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"FilterPostProcess"},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.kernelMatrix,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.reusable)}),e,s,o)},(0,o.gn)([(0,a.oQ)()],t.prototype,"kernelMatrix",void 0),t}(r.D);(0,n.H)("BABYLON.FilterPostProcess",T);var B=i(30374),M=(i(67362),function(e){function t(t,i,s,o,r,n,a,c){void 0===a&&(a=0),void 0===c&&(c=!1);var l=e.call(this,t,"grain",["intensity","animatedSeed"],[],i,s,o,r,n,null,a,void 0,null,c)||this;return l.intensity=30,l.animated=!1,l.onApplyObservable.add((function(e){e.setFloat("intensity",l.intensity),e.setFloat("animatedSeed",l.animated?Math.random()+1:1)})),l}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"GrainPostProcess"},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.reusable)}),e,s,o)},(0,o.gn)([(0,a.qC)()],t.prototype,"intensity",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"animated",void 0),t}(r.D));(0,n.H)("BABYLON.GrainPostProcess",M);i(12926);var w=function(e){function t(t,i,s,o,r,n,a){return void 0===a&&(a=0),e.call(this,t,"highlights",null,null,i,s,o,r,n,null,a)||this}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"HighlightsPostProcess"},t}(r.D),F=i(90216),I=i(28638),D=i(219),L=(i(83534),i(91085),i(39255),function(e){function t(t,i,s,o,r,n,a,c,l,h){void 0===c&&(c=0),void 0===l&&(l=!1),void 0===h&&(h=!1);var p=e.call(this,t,"motionBlur",["motionStrength","motionScale","screenSize","inverseViewProjection","prevViewProjection"],["velocitySampler"],s,o,r,n,a,"#define GEOMETRY_SUPPORTED\n#define SAMPLES 64.0\n#define OBJECT_BASED",c,void 0,null,l)||this;return p.motionStrength=1,p._motionBlurSamples=32,p._isObjectBased=!0,p._forceGeometryBuffer=!1,p._invViewProjection=null,p._previousViewProjection=null,p._forceGeometryBuffer=h,p._forceGeometryBuffer?(i.enableGeometryBufferRenderer(),p._geometryBufferRenderer&&(p._geometryBufferRenderer.enableVelocity=!0)):(i.enablePrePassRenderer(),p._prePassRenderer&&(p._prePassRenderer.markAsDirty(),p._prePassEffectConfiguration=new D.p)),p._applyMode(),p}return(0,o.ZT)(t,e),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this._motionBlurSamples=e,this._updateEffect()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isObjectBased",{get:function(){return this._isObjectBased},set:function(e){this._isObjectBased!==e&&(this._isObjectBased=e,this._applyMode())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_geometryBufferRenderer",{get:function(){return this._forceGeometryBuffer?this._scene.geometryBufferRenderer:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_prePassRenderer",{get:function(){return this._forceGeometryBuffer?null:this._scene.prePassRenderer},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"MotionBlurPostProcess"},t.prototype.excludeSkinnedMesh=function(e){if(e.skeleton){var t=void 0;if(this._geometryBufferRenderer)t=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity;else{if(!this._prePassRenderer)return;t=this._prePassRenderer.excludedSkinnedMesh}t.push(e)}},t.prototype.removeExcludedSkinnedMesh=function(e){if(e.skeleton){var t=void 0;if(this._geometryBufferRenderer)t=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity;else{if(!this._prePassRenderer)return;t=this._prePassRenderer.excludedSkinnedMesh}var i=t.indexOf(e);-1!==i&&t.splice(i,1)}},t.prototype.dispose=function(t){this._geometryBufferRenderer&&(this._geometryBufferRenderer._previousTransformationMatrices={},this._geometryBufferRenderer._previousBonesTransformationMatrices={},this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity=[]),e.prototype.dispose.call(this,t)},t.prototype._applyMode=function(){var e=this;if(!this._geometryBufferRenderer&&!this._prePassRenderer)return m.Y.Warn("Multiple Render Target support needed to compute object based motion blur"),this.updateEffect();this._updateEffect(),this._invViewProjection=null,this._previousViewProjection=null,this.isObjectBased?(this._prePassRenderer&&this._prePassEffectConfiguration&&(this._prePassEffectConfiguration.texturesRequired[0]=2),this.onApply=function(t){return e._onApplyObjectBased(t)}):(this._invViewProjection=g.y3.Identity(),this._previousViewProjection=g.y3.Identity(),this._prePassRenderer&&this._prePassEffectConfiguration&&(this._prePassEffectConfiguration.texturesRequired[0]=5),this.onApply=function(t){return e._onApplyScreenBased(t)})},t.prototype._onApplyObjectBased=function(e){if(e.setVector2("screenSize",new g.FM(this.width,this.height)),e.setFloat("motionScale",this._scene.getAnimationRatio()),e.setFloat("motionStrength",this.motionStrength),this._geometryBufferRenderer){var t=this._geometryBufferRenderer.getTextureIndex(I.m.VELOCITY_TEXTURE_TYPE);e.setTexture("velocitySampler",this._geometryBufferRenderer.getGBuffer().textures[t])}else if(this._prePassRenderer){t=this._prePassRenderer.getIndex(2);e.setTexture("velocitySampler",this._prePassRenderer.getRenderTarget().textures[t])}},t.prototype._onApplyScreenBased=function(e){var t=this._scene.getProjectionMatrix().multiply(this._scene.getViewMatrix());if(t.invertToRef(this._invViewProjection),e.setMatrix("inverseViewProjection",this._invViewProjection),e.setMatrix("prevViewProjection",this._previousViewProjection),this._previousViewProjection=t,e.setVector2("screenSize",new g.FM(this.width,this.height)),e.setFloat("motionScale",this._scene.getAnimationRatio()),e.setFloat("motionStrength",this.motionStrength),this._geometryBufferRenderer){var i=this._geometryBufferRenderer.getTextureIndex(I.m.DEPTH_TEXTURE_TYPE);e.setTexture("depthSampler",this._geometryBufferRenderer.getGBuffer().textures[i])}else if(this._prePassRenderer){i=this._prePassRenderer.getIndex(5);e.setTexture("depthSampler",this._prePassRenderer.getRenderTarget().textures[i])}},t.prototype._updateEffect=function(){if(this._geometryBufferRenderer||this._prePassRenderer){var e=["#define GEOMETRY_SUPPORTED","#define SAMPLES "+this._motionBlurSamples.toFixed(1),this._isObjectBased?"#define OBJECT_BASED":"#define SCREEN_BASED"];this.updateEffect(e.join("\n"))}},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,s,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.reusable,e.textureType,!1)}),e,s,o)},(0,o.gn)([(0,a.qC)()],t.prototype,"motionStrength",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"motionBlurSamples",null),(0,o.gn)([(0,a.qC)()],t.prototype,"isObjectBased",null),t}(r.D));(0,n.H)("BABYLON.MotionBlurPostProcess",L);var N=i(89815),j=i(1421),H=(i(84243),function(e){function t(t,i,s,o,r,n,a,c,l,h){var p=e.call(this,t,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],n,a,c,l,h)||this;return p._ownRefractionTexture=!0,p.color=s,p.depth=o,p.colorLevel=r,p.refractionTextureUrl=i,p.onActivateObservable.add((function(e){p._refTexture=p._refTexture||new _.x(i,e.getScene())})),p.onApplyObservable.add((function(e){e.setColor3("baseColor",p.color),e.setFloat("depth",p.depth),e.setFloat("colorLevel",p.colorLevel),e.setTexture("refractionSampler",p._refTexture)})),p}return(0,o.ZT)(t,e),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this._refTexture},set:function(e){this._refTexture&&this._ownRefractionTexture&&this._refTexture.dispose(),this._refTexture=e,this._ownRefractionTexture=!1},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"RefractionPostProcess"},t.prototype.dispose=function(t){this._refTexture&&this._ownRefractionTexture&&(this._refTexture.dispose(),this._refTexture=null),e.prototype.dispose.call(this,t)},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.refractionTextureUrl,e.color,e.depth,e.colorLevel,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.reusable)}),e,s,o)},(0,o.gn)([(0,a.qC)()],t.prototype,"color",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"depth",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"colorLevel",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"refractionTextureUrl",void 0),t}(r.D));(0,n.H)("BABYLON.RefractionPostProcess",H);var k=i(62897),W=i(19442),z=(i(56861),function(e){function t(t,i,s,o,r,n,a,c){void 0===a&&(a=0),void 0===c&&(c=!1);var l=e.call(this,t,"sharpen",["sharpnessAmounts","screenSize"],null,i,s,o,r,n,null,a,void 0,null,c)||this;return l.colorAmount=1,l.edgeAmount=.3,l.onApply=function(e){e.setFloat2("screenSize",l.width,l.height),e.setFloat2("sharpnessAmounts",l.edgeAmount,l.colorAmount)},l}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"SharpenPostProcess"},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.textureType,e.reusable)}),e,s,o)},(0,o.gn)([(0,a.qC)()],t.prototype,"colorAmount",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"edgeAmount",void 0),t}(r.D));(0,n.H)("BABYLON.SharpenPostProcess",z);var V=function(){function e(e,t){this._engine=e,this._name=t,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array,this._cameras=[]}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameras",{get:function(){return this._cameras},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var e in this._renderEffects)if(Object.prototype.hasOwnProperty.call(this._renderEffects,e)&&!this._renderEffects[e].isSupported)return!1;return!0},enumerable:!1,configurable:!0}),e.prototype.addEffect=function(e){this._renderEffects[e._name]=e},e.prototype._rebuild=function(){},e.prototype._enableEffect=function(e,t){var i=this._renderEffects[e];i&&i._enable(l.w1.MakeArray(t||this._cameras))},e.prototype._disableEffect=function(e,t){var i=this._renderEffects[e];i&&i._disable(l.w1.MakeArray(t||this._cameras))},e.prototype._attachCameras=function(e,t){var i=l.w1.MakeArray(e||this._cameras);if(i){var s,o=[];for(s=0;s<i.length;s++){var r=i[s];if(r){var n=r.name;-1===this._cameras.indexOf(r)?this._cameras[n]=r:t&&o.push(s)}}for(s=0;s<o.length;s++)i.splice(o[s],1);for(var a in this._renderEffects)Object.prototype.hasOwnProperty.call(this._renderEffects,a)&&this._renderEffects[a]._attachCameras(i)}},e.prototype._detachCameras=function(e){var t=l.w1.MakeArray(e||this._cameras);if(t){for(var i in this._renderEffects)Object.prototype.hasOwnProperty.call(this._renderEffects,i)&&this._renderEffects[i]._detachCameras(t);for(var s=0;s<t.length;s++)this._cameras.splice(this._cameras.indexOf(t[s]),1)}},e.prototype._update=function(){for(var e in this._renderEffects)Object.prototype.hasOwnProperty.call(this._renderEffects,e)&&this._renderEffects[e]._update();for(var t=0;t<this._cameras.length;t++)if(this._cameras[t]){var i=this._cameras[t].name;this._renderEffectsForIsolatedPass[i]&&this._renderEffectsForIsolatedPass[i]._update()}},e.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array},e.prototype._enableMSAAOnFirstPostProcess=function(e){if(!this._engine._features.supportMSAA)return!1;var t=Object.keys(this._renderEffects);if(t.length>0){var i=this._renderEffects[t[0]].getPostProcesses();i&&(i[0].samples=e)}return!0},e.prototype.setPrePassRenderer=function(e){return!1},e.prototype.dispose=function(){},(0,o.gn)([(0,a.qC)()],e.prototype,"_name",void 0),e}(),G=i(15210),q=i(85627),Q=function(){function e(){this._renderPipelines={}}return Object.defineProperty(e.prototype,"supportedPipelines",{get:function(){var e=[];for(var t in this._renderPipelines)if(Object.prototype.hasOwnProperty.call(this._renderPipelines,t)){var i=this._renderPipelines[t];i.isSupported&&e.push(i)}return e},enumerable:!1,configurable:!0}),e.prototype.addPipeline=function(e){this._renderPipelines[e._name]=e},e.prototype.attachCamerasToRenderPipeline=function(e,t,i){void 0===i&&(i=!1);var s=this._renderPipelines[e];s&&s._attachCameras(t,i)},e.prototype.detachCamerasFromRenderPipeline=function(e,t){var i=this._renderPipelines[e];i&&i._detachCameras(t)},e.prototype.enableEffectInPipeline=function(e,t,i){var s=this._renderPipelines[e];s&&s._enableEffect(t,i)},e.prototype.disableEffectInPipeline=function(e,t,i){var s=this._renderPipelines[e];s&&s._disableEffect(t,i)},e.prototype.update=function(){for(var e in this._renderPipelines)if(Object.prototype.hasOwnProperty.call(this._renderPipelines,e)){var t=this._renderPipelines[e];t.isSupported?t._update():(t.dispose(),delete this._renderPipelines[e])}},e.prototype._rebuild=function(){for(var e in this._renderPipelines){if(Object.prototype.hasOwnProperty.call(this._renderPipelines,e))this._renderPipelines[e]._rebuild()}},e.prototype.dispose=function(){for(var e in this._renderPipelines){if(Object.prototype.hasOwnProperty.call(this._renderPipelines,e))this._renderPipelines[e].dispose()}},e}(),J=i(65273);Object.defineProperty(J.x.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){var e=this._getComponent(q.l.NAME_POSTPROCESSRENDERPIPELINEMANAGER);e||(e=new U(this),this._addComponent(e)),this._postProcessRenderPipelineManager=new Q}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});var U=function(){function e(e){this.name=q.l.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(q.l.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()},e.prototype.dispose=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()},e.prototype._gatherRenderTargets=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()},e}(),Z=function(e){function t(t,i,s,o,r){void 0===t&&(t=""),void 0===i&&(i=!0),void 0===s&&(s=G.l.LastCreatedScene),void 0===r&&(r=!0);var n=e.call(this,s.getEngine(),t)||this;n._camerasToBeAttached=[],n.SharpenPostProcessId="SharpenPostProcessEffect",n.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",n.FxaaPostProcessId="FxaaPostProcessEffect",n.ChromaticAberrationPostProcessId="ChromaticAberrationPostProcessEffect",n.GrainPostProcessId="GrainPostProcessEffect",n._glowLayer=null,n.animations=[],n._imageProcessingConfigurationObserver=null,n._sharpenEnabled=!1,n._bloomEnabled=!1,n._depthOfFieldEnabled=!1,n._depthOfFieldBlurLevel=x.Low,n._fxaaEnabled=!1,n._imageProcessingEnabled=!0,n._bloomScale=.5,n._chromaticAberrationEnabled=!1,n._grainEnabled=!1,n._buildAllowed=!0,n.onBuildObservable=new k.y$,n._resizeObserver=null,n._hardwareScaleLevel=1,n._bloomKernel=64,n._bloomWeight=.15,n._bloomThreshold=.9,n._samples=1,n._hasCleared=!1,n._prevPostProcess=null,n._prevPrevPostProcess=null,n._depthOfFieldSceneObserver=null,n._cameras=o||s.cameras,n._cameras=n._cameras.slice(),n._camerasToBeAttached=n._cameras.slice(),n._buildAllowed=r,n._scene=s;var a=n._scene.getEngine().getCaps();n._hdr=i&&(a.textureHalfFloatRender||a.textureFloatRender),n._hdr?a.textureHalfFloatRender?n._defaultPipelineTextureType=2:a.textureFloatRender&&(n._defaultPipelineTextureType=1):n._defaultPipelineTextureType=0,s.postProcessRenderPipelineManager.addPipeline(n);var c=n._scene.getEngine();return n.sharpen=new z("sharpen",1,null,_.x.BILINEAR_SAMPLINGMODE,c,!1,n._defaultPipelineTextureType,!0),n._sharpenEffect=new h(c,n.SharpenPostProcessId,(function(){return n.sharpen}),!0),n.depthOfField=new A(n._scene,null,n._depthOfFieldBlurLevel,n._defaultPipelineTextureType,!0),n.bloom=new P(n._scene,n._bloomScale,n._bloomWeight,n.bloomKernel,n._defaultPipelineTextureType,!0),n.chromaticAberration=new y("ChromaticAberration",c.getRenderWidth(),c.getRenderHeight(),1,null,_.x.BILINEAR_SAMPLINGMODE,c,!1,n._defaultPipelineTextureType,!0),n._chromaticAberrationEffect=new h(c,n.ChromaticAberrationPostProcessId,(function(){return n.chromaticAberration}),!0),n.grain=new M("Grain",1,null,_.x.BILINEAR_SAMPLINGMODE,c,!1,n._defaultPipelineTextureType,!0),n._grainEffect=new h(c,n.GrainPostProcessId,(function(){return n.grain}),!0),n._resizeObserver=c.onResizeObservable.add((function(){n._hardwareScaleLevel=c.getHardwareScalingLevel(),n.bloomKernel=n._bloomKernel})),n._imageProcessingConfigurationObserver=n._scene.imageProcessingConfiguration.onUpdateParameters.add((function(){n.bloom._downscale._exposure=n._scene.imageProcessingConfiguration.exposure,n.imageProcessingEnabled!==n._scene.imageProcessingConfiguration.isEnabled&&(n._imageProcessingEnabled=n._scene.imageProcessingConfiguration.isEnabled,n._buildPipeline())})),n._buildPipeline(),n}return(0,o.ZT)(t,e),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sharpenEnabled",{get:function(){return this._sharpenEnabled},set:function(e){this._sharpenEnabled!==e&&(this._sharpenEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomKernel",{get:function(){return this._bloomKernel},set:function(e){this._bloomKernel=e,this.bloom.kernel=e/this._hardwareScaleLevel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(e){this._bloomWeight!==e&&(this.bloom.weight=e,this._bloomWeight=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(e){this._bloomThreshold!==e&&(this.bloom.threshold=e,this._bloomThreshold=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(e){this._bloomScale!==e&&(this._bloomScale=e,this._rebuildBloom(),this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),t.prototype._rebuildBloom=function(){var e=this.bloom;this.bloom=new P(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1),this.bloom.threshold=e.threshold;for(var t=0;t<this._cameras.length;t++)e.disposeEffects(this._cameras[t])},Object.defineProperty(t.prototype,"depthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthOfFieldBlurLevel",{get:function(){return this._depthOfFieldBlurLevel},set:function(e){if(this._depthOfFieldBlurLevel!==e){this._depthOfFieldBlurLevel=e;var t=this.depthOfField;this.depthOfField=new A(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1),this.depthOfField.focalLength=t.focalLength,this.depthOfField.focusDistance=t.focusDistance,this.depthOfField.fStop=t.fStop,this.depthOfField.lensSize=t.lensSize;for(var i=0;i<this._cameras.length;i++)t.disposeEffects(this._cameras[i]);this._buildPipeline()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(e){this._imageProcessingEnabled!==e&&(this._scene.imageProcessingConfiguration.isEnabled=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowLayerEnabled",{get:function(){return null!=this._glowLayer},set:function(e){e&&!this._glowLayer?this._glowLayer=new W.c("",this._scene):!e&&this._glowLayer&&(this._glowLayer.dispose(),this._glowLayer=null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowLayer",{get:function(){return this._glowLayer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberrationEnabled",{get:function(){return this._chromaticAberrationEnabled},set:function(e){this._chromaticAberrationEnabled!==e&&(this._chromaticAberrationEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grainEnabled",{get:function(){return this._grainEnabled},set:function(e){this._grainEnabled!==e&&(this._grainEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"DefaultRenderingPipeline"},t.prototype.prepare=function(){var e=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=e},t.prototype._setAutoClearAndTextureSharing=function(e,t){void 0===t&&(t=!1),this._hasCleared?e.autoClear=!1:(e.autoClear=!0,this._scene.autoClear=!1,this._hasCleared=!0),t||(this._prevPrevPostProcess?e.shareOutputWith(this._prevPrevPostProcess):e.useOwnOutput(),this._prevPostProcess&&(this._prevPrevPostProcess=this._prevPostProcess),this._prevPostProcess=e)},t.prototype._buildPipeline=function(){var e=this;if(this._buildAllowed){this._scene.autoClear=!0;var t=this._scene.getEngine();if(this._disposePostProcesses(),null!==this._cameras&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._prevPostProcess=null,this._prevPrevPostProcess=null,this._hasCleared=!1,this.depthOfFieldEnabled){if(this._cameras.length>1){for(var i=0,s=this._cameras;i<s.length;i++){var o=s[i];(r=this._scene.enableDepthRenderer(o)).useOnlyInActiveCamera=!0}this._depthOfFieldSceneObserver=this._scene.onAfterRenderTargetsRenderObservable.add((function(t){e._cameras.indexOf(t.activeCamera)>-1&&(e.depthOfField.depthTexture=t.enableDepthRenderer(t.activeCamera).getDepthMap())}))}else{this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);var r=this._scene.enableDepthRenderer(this._cameras[0]);this.depthOfField.depthTexture=r.getDepthMap()}this.depthOfField._isReady()||this.depthOfField._updateEffects(),this.addEffect(this.depthOfField),this._setAutoClearAndTextureSharing(this.depthOfField._effects[0],!0)}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);this.bloomEnabled&&(this.bloom._isReady()||this.bloom._updateEffects(),this.addEffect(this.bloom),this._setAutoClearAndTextureSharing(this.bloom._effects[0],!0)),this._imageProcessingEnabled&&(this.imageProcessing=new F.z("imageProcessing",1,null,_.x.BILINEAR_SAMPLINGMODE,t,!1,this._defaultPipelineTextureType,this.scene.imageProcessingConfiguration),this._hdr?(this.addEffect(new h(t,this.ImageProcessingPostProcessId,(function(){return e.imageProcessing}),!0)),this._setAutoClearAndTextureSharing(this.imageProcessing)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1,this.cameras&&0!==this.cameras.length||(this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.imageProcessing.getEffect()||this.imageProcessing._updateParameters()),this.sharpenEnabled&&(this.sharpen.isReady()||this.sharpen.updateEffect(),this.addEffect(this._sharpenEffect),this._setAutoClearAndTextureSharing(this.sharpen)),this.grainEnabled&&(this.grain.isReady()||this.grain.updateEffect(),this.addEffect(this._grainEffect),this._setAutoClearAndTextureSharing(this.grain)),this.chromaticAberrationEnabled&&(this.chromaticAberration.isReady()||this.chromaticAberration.updateEffect(),this.addEffect(this._chromaticAberrationEffect),this._setAutoClearAndTextureSharing(this.chromaticAberration)),this.fxaaEnabled&&(this.fxaa=new B.P("fxaa",1,null,_.x.BILINEAR_SAMPLINGMODE,t,!1,this._defaultPipelineTextureType),this.addEffect(new h(t,this.FxaaPostProcessId,(function(){return e.fxaa}),!0)),this._setAutoClearAndTextureSharing(this.fxaa,!0)),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),this._scene.activeCameras&&this._scene.activeCameras.length>1&&(this._scene.autoClear=!0),!this._enableMSAAOnFirstPostProcess(this.samples)&&this.samples>1&&m.Y.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0"),this.onBuildObservable.notifyObservers(this)}},t.prototype._disposePostProcesses=function(e){void 0===e&&(e=!1);for(var t=0;t<this._cameras.length;t++){var i=this._cameras[t];this.imageProcessing&&this.imageProcessing.dispose(i),this.fxaa&&this.fxaa.dispose(i),e&&(this.sharpen&&this.sharpen.dispose(i),this.depthOfField&&(this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),this.depthOfField.disposeEffects(i)),this.bloom&&this.bloom.disposeEffects(i),this.chromaticAberration&&this.chromaticAberration.dispose(i),this.grain&&this.grain.dispose(i),this._glowLayer&&this._glowLayer.dispose())}this.imageProcessing=null,this.fxaa=null,e&&(this.sharpen=null,this._sharpenEffect=null,this.depthOfField=null,this.bloom=null,this.chromaticAberration=null,this._chromaticAberrationEffect=null,this.grain=null,this._grainEffect=null,this._glowLayer=null)},t.prototype.addCamera=function(e){this._camerasToBeAttached.push(e),this._buildPipeline()},t.prototype.removeCamera=function(e){var t=this._camerasToBeAttached.indexOf(e);this._camerasToBeAttached.splice(t,1),this._buildPipeline()},t.prototype.dispose=function(){this.onBuildObservable.clear(),this._disposePostProcesses(!0),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._scene.autoClear=!0,this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver),e.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=a.p4.Serialize(this);return e.customType="DefaultRenderingPipeline",e},t.Parse=function(e,i,s){return a.p4.Parse((function(){return new t(e._name,e._name._hdr,i)}),e,i,s)},(0,o.gn)([(0,a.qC)()],t.prototype,"sharpenEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"bloomKernel",null),(0,o.gn)([(0,a.qC)()],t.prototype,"_bloomWeight",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"_bloomThreshold",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"_hdr",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"bloomWeight",null),(0,o.gn)([(0,a.qC)()],t.prototype,"bloomThreshold",null),(0,o.gn)([(0,a.qC)()],t.prototype,"bloomScale",null),(0,o.gn)([(0,a.qC)()],t.prototype,"bloomEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"depthOfFieldEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"depthOfFieldBlurLevel",null),(0,o.gn)([(0,a.qC)()],t.prototype,"fxaaEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"samples",null),(0,o.gn)([(0,a.qC)()],t.prototype,"imageProcessingEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"glowLayerEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"chromaticAberrationEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"grainEnabled",null),t}(V);(0,n.H)("BABYLON.DefaultRenderingPipeline",Z);var Y=i(93980),X=(i(75883),i(50940),function(e){function t(t,i,s,o,r){void 0===o&&(o=1);var n=e.call(this,s.getEngine(),t)||this;return n.LensChromaticAberrationEffect="LensChromaticAberrationEffect",n.HighlightsEnhancingEffect="HighlightsEnhancingEffect",n.LensDepthOfFieldEffect="LensDepthOfFieldEffect",n._pentagonBokehIsEnabled=!1,n._scene=s,n._depthTexture=s.enableDepthRenderer().getDepthMap(),i.grain_texture?n._grainTexture=i.grain_texture:n._createGrainTexture(),n._edgeBlur=i.edge_blur?i.edge_blur:0,n._grainAmount=i.grain_amount?i.grain_amount:0,n._chromaticAberration=i.chromatic_aberration?i.chromatic_aberration:0,n._distortion=i.distortion?i.distortion:0,n._highlightsGain=void 0!==i.dof_gain?i.dof_gain:-1,n._highlightsThreshold=i.dof_threshold?i.dof_threshold:1,n._dofDistance=void 0!==i.dof_focus_distance?i.dof_focus_distance:-1,n._dofAperture=i.dof_aperture?i.dof_aperture:1,n._dofDarken=i.dof_darken?i.dof_darken:0,n._dofPentagon=void 0===i.dof_pentagon||i.dof_pentagon,n._blurNoise=void 0===i.blur_noise||i.blur_noise,n._createChromaticAberrationPostProcess(o),n._createHighlightsPostProcess(o),n._createDepthOfFieldPostProcess(o/4),n.addEffect(new h(s.getEngine(),n.LensChromaticAberrationEffect,(function(){return n._chromaticAberrationPostProcess}),!0)),n.addEffect(new h(s.getEngine(),n.HighlightsEnhancingEffect,(function(){return n._highlightsPostProcess}),!0)),n.addEffect(new h(s.getEngine(),n.LensDepthOfFieldEffect,(function(){return n._depthOfFieldPostProcess}),!0)),-1===n._highlightsGain&&n._disableEffect(n.HighlightsEnhancingEffect,null),s.postProcessRenderPipelineManager.addPipeline(n),r&&s.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t,r),n}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"LensRenderingPipeline"},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edgeBlur",{get:function(){return this._edgeBlur},set:function(e){this.setEdgeBlur(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grainAmount",{get:function(){return this._grainAmount},set:function(e){this.setGrainAmount(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberration",{get:function(){return this._chromaticAberration},set:function(e){this.setChromaticAberration(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dofAperture",{get:function(){return this._dofAperture},set:function(e){this.setAperture(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edgeDistortion",{get:function(){return this._distortion},set:function(e){this.setEdgeDistortion(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dofDistortion",{get:function(){return this._dofDistance},set:function(e){this.setFocusDistance(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"darkenOutOfFocus",{get:function(){return this._dofDarken},set:function(e){this.setDarkenOutOfFocus(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurNoise",{get:function(){return this._blurNoise},set:function(e){this._blurNoise=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pentagonBokeh",{get:function(){return this._pentagonBokehIsEnabled},set:function(e){e?this.enablePentagonBokeh():this.disablePentagonBokeh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightsGain",{get:function(){return this._highlightsGain},set:function(e){this.setHighlightsGain(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightsThreshold",{get:function(){return this._highlightsThreshold},set:function(e){this.setHighlightsThreshold(e)},enumerable:!1,configurable:!0}),t.prototype.setEdgeBlur=function(e){this._edgeBlur=e},t.prototype.disableEdgeBlur=function(){this._edgeBlur=0},t.prototype.setGrainAmount=function(e){this._grainAmount=e},t.prototype.disableGrain=function(){this._grainAmount=0},t.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},t.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},t.prototype.setEdgeDistortion=function(e){this._distortion=e},t.prototype.disableEdgeDistortion=function(){this._distortion=0},t.prototype.setFocusDistance=function(e){this._dofDistance=e},t.prototype.disableDepthOfField=function(){this._dofDistance=-1},t.prototype.setAperture=function(e){this._dofAperture=e},t.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},t.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect("#define PENTAGON\n"),this._pentagonBokehIsEnabled=!0},t.prototype.disablePentagonBokeh=function(){this._pentagonBokehIsEnabled=!1,this._highlightsPostProcess.updateEffect()},t.prototype.enableNoiseBlur=function(){this._blurNoise=!0},t.prototype.disableNoiseBlur=function(){this._blurNoise=!1},t.prototype.setHighlightsGain=function(e){this._highlightsGain=e},t.prototype.setHighlightsThreshold=function(e){-1===this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},t.prototype.disableHighlights=function(){this._highlightsGain=-1},t.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},t.prototype._createChromaticAberrationPostProcess=function(e){var t=this;this._chromaticAberrationPostProcess=new r.D("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],e,null,_.x.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat("chromatic_aberration",t._chromaticAberration),e.setFloat("screen_width",t._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",t._scene.getEngine().getRenderHeight()),e.setFloat("radialIntensity",1),e.setFloat2("direction",17,17),e.setFloat2("centerPosition",.5,.5)}},t.prototype._createHighlightsPostProcess=function(e){var t=this;this._highlightsPostProcess=new r.D("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],e,null,_.x.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":""),this._highlightsPostProcess.externalTextureSamplerBinding=!0,this._highlightsPostProcess.onApply=function(e){e.setFloat("gain",t._highlightsGain),e.setFloat("threshold",t._highlightsThreshold),e.setTextureFromPostProcess("textureSampler",t._chromaticAberrationPostProcess),e.setFloat("screen_width",t._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",t._scene.getEngine().getRenderHeight())}},t.prototype._createDepthOfFieldPostProcess=function(e){var t=this;this._depthOfFieldPostProcess=new r.D("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],e,null,_.x.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.externalTextureSamplerBinding=!0,this._depthOfFieldPostProcess.onApply=function(e){e.setTexture("depthSampler",t._depthTexture),e.setTexture("grainSampler",t._grainTexture),e.setTextureFromPostProcess("textureSampler",t._highlightsPostProcess),e.setTextureFromPostProcess("highlightsSampler",t._depthOfFieldPostProcess),e.setFloat("grain_amount",t._grainAmount),e.setBool("blur_noise",t._blurNoise),e.setFloat("screen_width",t._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",t._scene.getEngine().getRenderHeight()),e.setFloat("distortion",t._distortion),e.setBool("dof_enabled",-1!==t._dofDistance),e.setFloat("screen_distance",1/(.1-1/t._dofDistance)),e.setFloat("aperture",t._dofAperture),e.setFloat("darken",t._dofDarken),e.setFloat("edge_blur",t._edgeBlur),e.setBool("highlights",-1!==t._highlightsGain),t._scene.activeCamera&&(e.setFloat("near",t._scene.activeCamera.minZ),e.setFloat("far",t._scene.activeCamera.maxZ))}},t.prototype._createGrainTexture=function(){this._grainTexture=new Y.c("LensNoiseTexture",512,this._scene,!1,_.x.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=_.x.WRAP_ADDRESSMODE,this._grainTexture.wrapV=_.x.WRAP_ADDRESSMODE;for(var e,t,i,s=this._grainTexture.getContext(),o=0;o<512;o++)for(var r=0;r<512;r++)e=Math.floor(255*(t=.42,i=.58,Math.random()*(i-t)+t)),s.fillStyle="rgb("+e+", "+e+", "+e+")",s.fillRect(o,r,1,1);this._grainTexture.update(!1)},t}(V)),K=i(2055),$=i(11563),ee=(i(23866),i(42115),function(e){function t(t,i,s,o,r,n){void 0===r&&(r=!1),void 0===n&&(n=0);var a=e.call(this,i.getEngine(),t)||this;if(a.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",a.SSAORenderEffect="SSAORenderEffect",a.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",a.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",a.SSAOCombineRenderEffect="SSAOCombineRenderEffect",a.totalStrength=1,a.maxZ=100,a.minZAspect=.2,a._samples=8,a._textureSamples=1,a._forceGeometryBuffer=!1,a._expensiveBlur=!0,a.radius=2,a.base=0,a._bits=new Uint32Array(1),a._scene=i,a._ratio=s,a._forceGeometryBuffer=r,!a.isSupported)return m.Y.Error("The current engine does not support SSAO 2."),a;var c=a._ratio.ssaoRatio||s,l=a._ratio.blurRatio||s;return a._forceGeometryBuffer?i.enableGeometryBufferRenderer():i.enablePrePassRenderer(),a._createRandomTexture(),a._originalColorPostProcess=new N.Q("SSAOOriginalSceneColor",1,null,_.x.BILINEAR_SAMPLINGMODE,i.getEngine(),void 0,n),a._originalColorPostProcess.samples=a.textureSamples,a._createSSAOPostProcess(1,n),a._createBlurPostProcess(c,l,n),a._createSSAOCombinePostProcess(l,n),a.addEffect(new h(i.getEngine(),a.SSAOOriginalSceneColorEffect,(function(){return a._originalColorPostProcess}),!0)),a.addEffect(new h(i.getEngine(),a.SSAORenderEffect,(function(){return a._ssaoPostProcess}),!0)),a.addEffect(new h(i.getEngine(),a.SSAOBlurHRenderEffect,(function(){return a._blurHPostProcess}),!0)),a.addEffect(new h(i.getEngine(),a.SSAOBlurVRenderEffect,(function(){return a._blurVPostProcess}),!0)),a.addEffect(new h(i.getEngine(),a.SSAOCombineRenderEffect,(function(){return a._ssaoCombinePostProcess}),!0)),i.postProcessRenderPipelineManager.addPipeline(a),o&&i.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t,o),a}return(0,o.ZT)(t,e),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e,this._ssaoPostProcess.updateEffect(this._getDefinesForSSAO()),this._sampleSphere=this._generateHemisphere()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureSamples",{get:function(){return this._textureSamples},set:function(e){this._textureSamples=e,this._prePassRenderer?this._prePassRenderer.samples=e:this._originalColorPostProcess.samples=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_geometryBufferRenderer",{get:function(){return this._forceGeometryBuffer?this._scene.geometryBufferRenderer:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_prePassRenderer",{get:function(){return this._forceGeometryBuffer?null:this._scene.prePassRenderer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(e){this._blurHPostProcess.updateEffect("#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(e?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._blurVPostProcess.updateEffect("#define BILATERAL_BLUR\n#define SAMPLES 16\n#define EXPENSIVE "+(e?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._expensiveBlur=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsSupported",{get:function(){var e=G.l.LastCreatedEngine;return!!e&&e._features.supportSSAO2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"SSAO2RenderingPipeline"},t.prototype.dispose=function(t){void 0===t&&(t=!1);for(var i=0;i<this._scene.cameras.length;i++){var s=this._scene.cameras[i];this._originalColorPostProcess.dispose(s),this._ssaoPostProcess.dispose(s),this._blurHPostProcess.dispose(s),this._blurVPostProcess.dispose(s),this._ssaoCombinePostProcess.dispose(s)}this._randomTexture.dispose(),t&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),e.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(e,t,i){var s=this;this._samplerOffsets=[];for(var o=this.expensiveBlur,n=-8;n<8;n++)this._samplerOffsets.push(2*n+.5);this._blurHPostProcess=new r.D("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],e,null,_.x.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(o?"1":"0")+"\n",i),this._blurHPostProcess.onApply=function(e){s._scene.activeCamera&&(e.setFloat("outSize",s._ssaoCombinePostProcess.width>0?s._ssaoCombinePostProcess.width:s._originalColorPostProcess.width),e.setFloat("near",s._scene.activeCamera.minZ),e.setFloat("far",s._scene.activeCamera.maxZ),e.setFloat("radius",s.radius),s._geometryBufferRenderer?e.setTexture("depthSampler",s._geometryBufferRenderer.getGBuffer().textures[0]):s._prePassRenderer&&e.setTexture("depthSampler",s._prePassRenderer.getRenderTarget().textures[s._prePassRenderer.getIndex(5)]),e.setArray("samplerOffsets",s._samplerOffsets))},this._blurVPostProcess=new r.D("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],t,null,_.x.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_V\n#define SAMPLES 16\n#define EXPENSIVE "+(o?"1":"0")+"\n",i),this._blurVPostProcess.onApply=function(e){s._scene.activeCamera&&(e.setFloat("outSize",s._ssaoCombinePostProcess.height>0?s._ssaoCombinePostProcess.height:s._originalColorPostProcess.height),e.setFloat("near",s._scene.activeCamera.minZ),e.setFloat("far",s._scene.activeCamera.maxZ),e.setFloat("radius",s.radius),s._geometryBufferRenderer?e.setTexture("depthSampler",s._geometryBufferRenderer.getGBuffer().textures[0]):s._prePassRenderer&&e.setTexture("depthSampler",s._prePassRenderer.getRenderTarget().textures[s._prePassRenderer.getIndex(5)]),e.setArray("samplerOffsets",s._samplerOffsets))},this._blurHPostProcess.samples=this.textureSamples,this._blurVPostProcess.samples=this.textureSamples},t.prototype._rebuild=function(){e.prototype._rebuild.call(this)},t.prototype._radicalInverse_VdC=function(e){return this._bits[0]=e,this._bits[0]=(this._bits[0]<<16|this._bits[0]>>16)>>>0,this._bits[0]=(1431655765&this._bits[0])<<1|(2863311530&this._bits[0])>>>1>>>0,this._bits[0]=(858993459&this._bits[0])<<2|(3435973836&this._bits[0])>>>2>>>0,this._bits[0]=(252645135&this._bits[0])<<4|(4042322160&this._bits[0])>>>4>>>0,this._bits[0]=(16711935&this._bits[0])<<8|(4278255360&this._bits[0])>>>8>>>0,2.3283064365386963e-10*this._bits[0]},t.prototype._hammersley=function(e,t){return[e/t,this._radicalInverse_VdC(e)]},t.prototype._hemisphereSample_uniform=function(e,t){var i=2*t*Math.PI,s=1-(.85*e+.15),o=Math.sqrt(1-s*s);return new g.P(Math.cos(i)*o,Math.sin(i)*o,s)},t.prototype._generateHemisphere=function(){for(var e,t=this.samples,i=[],s=0;s<t;){if(t<16)e=this._hemisphereSample_uniform(Math.random(),Math.random());else{var o=this._hammersley(s,t);e=this._hemisphereSample_uniform(o[0],o[1])}i.push(e.x,e.y,e.z),s++}return i},t.prototype._getDefinesForSSAO=function(){return"#define SAMPLES "+this.samples+"\n#define SSAO"},t.prototype._createSSAOPostProcess=function(e,i){var s=this;this._sampleSphere=this._generateHemisphere();var o=this._getDefinesForSSAO();this._ssaoPostProcess=new r.D("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect","depthProjection"],["randomSampler","depthSampler","normalSampler"],e,null,_.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o,i),this._ssaoPostProcess.onApply=function(e){var i,o,r,n;if(s._scene.activeCamera){if(e.setArray3("sampleSphere",s._sampleSphere),e.setFloat("randTextureTiles",32),e.setFloat("samplesFactor",1/s.samples),e.setFloat("totalStrength",s.totalStrength),e.setFloat2("texelSize",1/s._ssaoPostProcess.width,1/s._ssaoPostProcess.height),e.setFloat("radius",s.radius),e.setFloat("maxZ",s.maxZ),e.setFloat("minZAspect",s.minZAspect),e.setFloat("base",s.base),e.setFloat("near",s._scene.activeCamera.minZ),e.setFloat("far",s._scene.activeCamera.maxZ),s._scene.activeCamera.mode===K.V.PERSPECTIVE_CAMERA)e.setMatrix3x3("depthProjection",t.PERSPECTIVE_DEPTH_PROJECTION),e.setFloat("xViewport",Math.tan(s._scene.activeCamera.fov/2)*s._scene.getEngine().getAspectRatio(s._scene.activeCamera,!0)),e.setFloat("yViewport",Math.tan(s._scene.activeCamera.fov/2));else{var a=s._scene.getEngine().getRenderWidth()/2,c=s._scene.getEngine().getRenderHeight()/2,l=null!==(i=s._scene.activeCamera.orthoLeft)&&void 0!==i?i:-a,h=null!==(o=s._scene.activeCamera.orthoRight)&&void 0!==o?o:a,p=null!==(r=s._scene.activeCamera.orthoBottom)&&void 0!==r?r:-c,u=null!==(n=s._scene.activeCamera.orthoTop)&&void 0!==n?n:c;e.setMatrix3x3("depthProjection",t.ORTHO_DEPTH_PROJECTION),e.setFloat("xViewport",.5*(h-l)),e.setFloat("yViewport",.5*(u-p))}e.setMatrix("projection",s._scene.getProjectionMatrix()),s._geometryBufferRenderer?(e.setTexture("depthSampler",s._geometryBufferRenderer.getGBuffer().textures[0]),e.setTexture("normalSampler",s._geometryBufferRenderer.getGBuffer().textures[1])):s._prePassRenderer&&(e.setTexture("depthSampler",s._prePassRenderer.getRenderTarget().textures[s._prePassRenderer.getIndex(5)]),e.setTexture("normalSampler",s._prePassRenderer.getRenderTarget().textures[s._prePassRenderer.getIndex(6)])),e.setTexture("randomSampler",s._randomTexture)}},this._ssaoPostProcess.samples=this.textureSamples,this._forceGeometryBuffer||(this._ssaoPostProcess._prePassEffectConfiguration=new $.M)},t.prototype._createSSAOCombinePostProcess=function(e,t){var i=this;this._ssaoCombinePostProcess=new r.D("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],e,null,_.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,void 0,t),this._ssaoCombinePostProcess.onApply=function(e){var t=i._scene.activeCamera.viewport;e.setVector4("viewport",g.jp.Vector4[0].copyFromFloats(t.x,t.y,t.width,t.height)),e.setTextureFromPostProcessOutput("originalColor",i._originalColorPostProcess)},this._ssaoCombinePostProcess.samples=this.textureSamples},t.prototype._createRandomTexture=function(){this._randomTexture=new Y.c("SSAORandomTexture",128,this._scene,!1,_.x.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=_.x.WRAP_ADDRESSMODE,this._randomTexture.wrapV=_.x.WRAP_ADDRESSMODE;for(var e=this._randomTexture.getContext(),t=function(e,t){return Math.random()*(t-e)+e},i=g.P.Zero(),s=0;s<128;s++)for(var o=0;o<128;o++)i.x=t(0,1),i.y=t(0,1),i.z=0,i.normalize(),i.scaleInPlace(255),i.x=Math.floor(i.x),i.y=Math.floor(i.y),e.fillStyle="rgb("+i.x+", "+i.y+", "+i.z+")",e.fillRect(s,o,1,1);this._randomTexture.update(!1)},t.prototype.serialize=function(){var e=a.p4.Serialize(this);return e.customType="SSAO2RenderingPipeline",e},t.Parse=function(e,i,s){return a.p4.Parse((function(){return new t(e._name,i,e._ratio)}),e,i,s)},t.ORTHO_DEPTH_PROJECTION=[1,0,0,0,1,0,0,0,1],t.PERSPECTIVE_DEPTH_PROJECTION=[0,0,0,0,0,0,1,1,1],(0,o.gn)([(0,a.qC)()],t.prototype,"totalStrength",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"maxZ",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"minZAspect",void 0),(0,o.gn)([(0,a.qC)("samples")],t.prototype,"_samples",void 0),(0,o.gn)([(0,a.qC)("textureSamples")],t.prototype,"_textureSamples",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"_ratio",void 0),(0,o.gn)([(0,a.qC)("expensiveBlur")],t.prototype,"_expensiveBlur",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"radius",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"base",void 0),t}(V));(0,n.H)("BABYLON.SSAO2RenderingPipeline",ee);i(80969);var te=function(e){function t(t,i,s,o){var r=e.call(this,i.getEngine(),t)||this;r.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",r.SSAORenderEffect="SSAORenderEffect",r.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",r.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",r.SSAOCombineRenderEffect="SSAOCombineRenderEffect",r.totalStrength=1,r.radius=1e-4,r.area=.0075,r.fallOff=1e-6,r.base=.5,r._firstUpdate=!0,r._scene=i,r._createRandomTexture();var n=s.ssaoRatio||s,a=s.combineRatio||s;return r._originalColorPostProcess=new N.Q("SSAOOriginalSceneColor",a,null,_.x.BILINEAR_SAMPLINGMODE,i.getEngine(),!1),r._createSSAOPostProcess(n),r._createBlurPostProcess(n),r._createSSAOCombinePostProcess(a),r.addEffect(new h(i.getEngine(),r.SSAOOriginalSceneColorEffect,(function(){return r._originalColorPostProcess}),!0)),r.addEffect(new h(i.getEngine(),r.SSAORenderEffect,(function(){return r._ssaoPostProcess}),!0)),r.addEffect(new h(i.getEngine(),r.SSAOBlurHRenderEffect,(function(){return r._blurHPostProcess}),!0)),r.addEffect(new h(i.getEngine(),r.SSAOBlurVRenderEffect,(function(){return r._blurVPostProcess}),!0)),r.addEffect(new h(i.getEngine(),r.SSAOCombineRenderEffect,(function(){return r._ssaoCombinePostProcess}),!0)),i.postProcessRenderPipelineManager.addPipeline(r),o&&i.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t,o),r}return(0,o.ZT)(t,e),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),t.prototype._attachCameras=function(t,i){e.prototype._attachCameras.call(this,t,i);for(var s=0,o=this._cameras;s<o.length;s++){var r=o[s];this._scene.enableDepthRenderer(r).getDepthMap()}},t.prototype.getClassName=function(){return"SSAORenderingPipeline"},t.prototype.dispose=function(t){void 0===t&&(t=!1);for(var i=0;i<this._scene.cameras.length;i++){var s=this._scene.cameras[i];this._originalColorPostProcess.dispose(s),this._ssaoPostProcess.dispose(s),this._blurHPostProcess.dispose(s),this._blurVPostProcess.dispose(s),this._ssaoCombinePostProcess.dispose(s)}this._randomTexture.dispose(),t&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),e.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(e){var t=this;this._blurHPostProcess=new d.i("BlurH",new g.FM(1,0),16,e,null,_.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,0),this._blurVPostProcess=new d.i("BlurV",new g.FM(0,1),16,e,null,_.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,0),this._blurHPostProcess.onActivateObservable.add((function(){var e=t._blurHPostProcess.width/t._scene.getEngine().getRenderWidth();t._blurHPostProcess.kernel=16*e})),this._blurVPostProcess.onActivateObservable.add((function(){var e=t._blurVPostProcess.height/t._scene.getEngine().getRenderHeight();t._blurVPostProcess.kernel=16*e}))},t.prototype._rebuild=function(){this._firstUpdate=!0,e.prototype._rebuild.call(this)},t.prototype._createSSAOPostProcess=function(e){var t=this,i=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new r.D("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],e,null,_.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES 16\n#define SSAO"),this._ssaoPostProcess.externalTextureSamplerBinding=!0,this._ssaoPostProcess.onApply=function(e){t._firstUpdate&&(e.setArray3("sampleSphere",i),e.setFloat("samplesFactor",.0625),e.setFloat("randTextureTiles",4)),e.setFloat("totalStrength",t.totalStrength),e.setFloat("radius",t.radius),e.setFloat("area",t.area),e.setFloat("fallOff",t.fallOff),e.setFloat("base",t.base),e.setTexture("textureSampler",t._scene.enableDepthRenderer(t._scene.activeCamera).getDepthMap()),e.setTexture("randomSampler",t._randomTexture)}},t.prototype._createSSAOCombinePostProcess=function(e){var t=this;this._ssaoCombinePostProcess=new r.D("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],e,null,_.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setVector4("viewport",g.jp.Vector4[0].copyFromFloats(0,0,1,1)),e.setTextureFromPostProcess("originalColor",t._originalColorPostProcess)}},t.prototype._createRandomTexture=function(){this._randomTexture=new Y.c("SSAORandomTexture",512,this._scene,!1,_.x.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=_.x.WRAP_ADDRESSMODE,this._randomTexture.wrapV=_.x.WRAP_ADDRESSMODE;for(var e=this._randomTexture.getContext(),t=function(e,t){return Math.random()*(t-e)+e},i=g.P.Zero(),s=0;s<512;s++)for(var o=0;o<512;o++)i.x=Math.floor(255*t(-1,1)),i.y=Math.floor(255*t(-1,1)),i.z=Math.floor(255*t(-1,1)),e.fillStyle="rgb("+i.x+", "+i.y+", "+i.z+")",e.fillRect(s,o,1,1);this._randomTexture.update(!1)},(0,o.gn)([(0,a.qC)()],t.prototype,"totalStrength",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"radius",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"area",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"fallOff",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"base",void 0),t}(V),ie=i(72739),se=i(74405),oe=(i(47613),function(e){function t(t,i,s,o,r,n,a,c,l,h){void 0===c&&(c=0),void 0===l&&(l=!1),void 0===h&&(h=!1);var p=e.call(this,t,"screenSpaceReflection",["projection","view","threshold","reflectionSpecularFalloffExponent","strength","stepSize","roughnessFactor"],["textureSampler","normalSampler","positionSampler","reflectivitySampler"],s,o,r,n,a,"#define SSR_SUPPORTED\n#define REFLECTION_SAMPLES 64\n#define SMOOTH_STEPS 5\n",c,void 0,null,l)||this;if(p.threshold=1.2,p.strength=1,p.reflectionSpecularFalloffExponent=3,p.step=1,p.roughnessFactor=.2,p._forceGeometryBuffer=!1,p._enableSmoothReflections=!1,p._reflectionSamples=64,p._smoothSteps=5,p._forceGeometryBuffer=h,p._forceGeometryBuffer){var u=i.enableGeometryBufferRenderer();u&&u.isSupported&&(u.enablePosition=!0,u.enableReflectivity=!0)}else{var d=i.enablePrePassRenderer();null==d||d.markAsDirty(),p._prePassEffectConfiguration=new se.y}return p._updateEffectDefines(),p.onApply=function(e){var t=p._geometryBufferRenderer,s=p._prePassRenderer;if(s||t){if(t){var o=t.getTextureIndex(I.m.POSITION_TEXTURE_TYPE),r=t.getTextureIndex(I.m.REFLECTIVITY_TEXTURE_TYPE);e.setTexture("normalSampler",t.getGBuffer().textures[1]),e.setTexture("positionSampler",t.getGBuffer().textures[o]),e.setTexture("reflectivitySampler",t.getGBuffer().textures[r])}else if(s){o=s.getIndex(1),r=s.getIndex(3);var n=s.getIndex(6);e.setTexture("normalSampler",s.getRenderTarget().textures[n]),e.setTexture("positionSampler",s.getRenderTarget().textures[o]),e.setTexture("reflectivitySampler",s.getRenderTarget().textures[r])}var a=i.activeCamera;if(a){var c=a.getViewMatrix(!0),l=a.getProjectionMatrix(!0);e.setMatrix("projection",l),e.setMatrix("view",c),e.setFloat("threshold",p.threshold),e.setFloat("reflectionSpecularFalloffExponent",p.reflectionSpecularFalloffExponent),e.setFloat("strength",p.strength),e.setFloat("stepSize",p.step),e.setFloat("roughnessFactor",p.roughnessFactor)}}},p._isSceneRightHanded=i.useRightHandedSystem,p}return(0,o.ZT)(t,e),Object.defineProperty(t.prototype,"_geometryBufferRenderer",{get:function(){return this._forceGeometryBuffer?this._scene.geometryBufferRenderer:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_prePassRenderer",{get:function(){return this._forceGeometryBuffer?null:this._scene.prePassRenderer},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"ScreenSpaceReflectionPostProcess"},Object.defineProperty(t.prototype,"enableSmoothReflections",{get:function(){return this._enableSmoothReflections},set:function(e){e!==this._enableSmoothReflections&&(this._enableSmoothReflections=e,this._updateEffectDefines())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionSamples",{get:function(){return this._reflectionSamples},set:function(e){e!==this._reflectionSamples&&(this._reflectionSamples=e,this._updateEffectDefines())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"smoothSteps",{get:function(){return this._smoothSteps},set:function(e){e!==this._smoothSteps&&(this._smoothSteps=e,this._updateEffectDefines())},enumerable:!1,configurable:!0}),t.prototype._updateEffectDefines=function(){var e=[];(this._geometryBufferRenderer||this._prePassRenderer)&&e.push("#define SSR_SUPPORTED"),this._enableSmoothReflections&&e.push("#define ENABLE_SMOOTH_REFLECTIONS"),this._isSceneRightHanded&&e.push("#define RIGHT_HANDED_SCENE"),e.push("#define REFLECTION_SAMPLES "+(this._reflectionSamples>>0)),e.push("#define SMOOTH_STEPS "+(this._smoothSteps>>0)),this.updateEffect(e.join("\n"))},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,s,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.textureType,e.reusable)}),e,s,o)},(0,o.gn)([(0,a.qC)()],t.prototype,"threshold",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"strength",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"reflectionSpecularFalloffExponent",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"step",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"roughnessFactor",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"enableSmoothReflections",null),(0,o.gn)([(0,a.qC)()],t.prototype,"reflectionSamples",null),(0,o.gn)([(0,a.qC)()],t.prototype,"smoothSteps",null),t}(r.D));(0,n.H)("BABYLON.ScreenSpaceReflectionPostProcess",oe);i(82298);var re=function(e){function t(t,i,s,o,r){void 0===o&&(o=null);var n=e.call(this,i.getEngine(),t)||this;return n.downSampleX4PostProcess=null,n.brightPassPostProcess=null,n.blurHPostProcesses=[],n.blurVPostProcesses=[],n.textureAdderPostProcess=null,n.volumetricLightPostProcess=null,n.volumetricLightSmoothXPostProcess=null,n.volumetricLightSmoothYPostProcess=null,n.volumetricLightMergePostProces=null,n.volumetricLightFinalPostProcess=null,n.luminancePostProcess=null,n.luminanceDownSamplePostProcesses=[],n.hdrPostProcess=null,n.textureAdderFinalPostProcess=null,n.lensFlareFinalPostProcess=null,n.hdrFinalPostProcess=null,n.lensFlarePostProcess=null,n.lensFlareComposePostProcess=null,n.motionBlurPostProcess=null,n.depthOfFieldPostProcess=null,n.fxaaPostProcess=null,n.screenSpaceReflectionPostProcess=null,n.brightThreshold=1,n.blurWidth=512,n.horizontalBlur=!1,n.lensTexture=null,n.volumetricLightCoefficient=.2,n.volumetricLightPower=4,n.volumetricLightBlurScale=64,n.sourceLight=null,n.hdrMinimumLuminance=1,n.hdrDecreaseRate=.5,n.hdrIncreaseRate=.5,n.lensColorTexture=null,n.lensFlareStrength=20,n.lensFlareGhostDispersal=1.4,n.lensFlareHaloWidth=.7,n.lensFlareDistortionStrength=16,n.lensFlareBlurWidth=512,n.lensStarTexture=null,n.lensFlareDirtTexture=null,n.depthOfFieldDistance=10,n.depthOfFieldBlurWidth=64,n.animations=[],n._currentDepthOfFieldSource=null,n._fixedExposure=1,n._currentExposure=1,n._hdrAutoExposure=!1,n._hdrCurrentLuminance=1,n._motionStrength=1,n._isObjectBasedMotionBlur=!1,n._camerasToBeAttached=[],n._bloomEnabled=!1,n._depthOfFieldEnabled=!1,n._vlsEnabled=!1,n._lensFlareEnabled=!1,n._hdrEnabled=!1,n._motionBlurEnabled=!1,n._fxaaEnabled=!1,n._screenSpaceReflectionsEnabled=!1,n._motionBlurSamples=64,n._volumetricLightStepsCount=50,n._samples=1,n._cameras=r||i.cameras,n._cameras=n._cameras.slice(),n._camerasToBeAttached=n._cameras.slice(),n._scene=i,n._basePostProcess=o,n._ratio=s,n._floatTextureType=i.getEngine().getCaps().textureFloatRender?1:2,i.postProcessRenderPipelineManager.addPipeline(n),n._buildPipeline(),n}return(0,o.ZT)(t,e),Object.defineProperty(t.prototype,"exposure",{get:function(){return this._fixedExposure},set:function(e){this._fixedExposure=e,this._currentExposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hdrAutoExposure",{get:function(){return this._hdrAutoExposure},set:function(e){if(this._hdrAutoExposure=e,this.hdrPostProcess){var t=["#define HDR"];e&&t.push("#define AUTO_EXPOSURE"),this.hdrPostProcess.updateEffect(t.join("\n"))}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"motionStrength",{get:function(){return this._motionStrength},set:function(e){this._motionStrength=e,this._isObjectBasedMotionBlur&&this.motionBlurPostProcess&&(this.motionBlurPostProcess.motionStrength=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"objectBasedMotionBlur",{get:function(){return this._isObjectBasedMotionBlur},set:function(e){var t=this._isObjectBasedMotionBlur!==e;this._isObjectBasedMotionBlur=e,t&&this._buildPipeline()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(e){this._lensFlareEnabled!==e&&(this._lensFlareEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(e){this._hdrEnabled!==e&&(this._hdrEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(e){if(this._vlsEnabled!==e){if(e)if(!this._scene.enableGeometryBufferRenderer())return void m.Y.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline");this._vlsEnabled=e,this._buildPipeline()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(e){this._motionBlurEnabled!==e&&(this._motionBlurEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screenSpaceReflectionsEnabled",{get:function(){return this._screenSpaceReflectionsEnabled},set:function(e){this._screenSpaceReflectionsEnabled!==e&&(this._screenSpaceReflectionsEnabled=e,this._buildPipeline())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(e){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect("#define VLS\n#define NB_STEPS "+e.toFixed(1)),this._volumetricLightStepsCount=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this.motionBlurPostProcess&&(this._isObjectBasedMotionBlur?this.motionBlurPostProcess.motionBlurSamples=e:this.motionBlurPostProcess.updateEffect("#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+e.toFixed(1))),this._motionBlurSamples=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!1,configurable:!0}),t.prototype._buildPipeline=function(){var e=this,t=this._ratio,i=this._scene;this._disposePostProcesses(),null!==this._cameras&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._screenSpaceReflectionsEnabled&&(this.screenSpaceReflectionPostProcess=new oe("HDRPass",i,t,null,_.x.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,this._floatTextureType),this.screenSpaceReflectionPostProcess.onApplyObservable.add((function(){e._currentDepthOfFieldSource=e.screenSpaceReflectionPostProcess})),this.addEffect(new h(i.getEngine(),"HDRScreenSpaceReflections",(function(){return e.screenSpaceReflectionPostProcess}),!0))),this._basePostProcess?this.originalPostProcess=this._basePostProcess:this.originalPostProcess=new r.D("HDRPass","standard",[],[],t,null,_.x.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.autoClear=!this.screenSpaceReflectionPostProcess,this.originalPostProcess.onApplyObservable.add((function(){e._currentDepthOfFieldSource=e.originalPostProcess})),this.addEffect(new h(i.getEngine(),"HDRPassPostProcess",(function(){return e.originalPostProcess}),!0)),this._bloomEnabled&&(this._createDownSampleX4PostProcess(i,t/4),this._createBrightPassPostProcess(i,t/4),this._createBlurPostProcesses(i,t/4,1),this._createTextureAdderPostProcess(i,t),this.textureAdderFinalPostProcess=new r.D("HDRDepthOfFieldSource","standard",[],[],t,null,_.x.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define PASS_POST_PROCESS",0),this.addEffect(new h(i.getEngine(),"HDRBaseDepthOfFieldSource",(function(){return e.textureAdderFinalPostProcess}),!0))),this._vlsEnabled&&(this._createVolumetricLightPostProcess(i,t),this.volumetricLightFinalPostProcess=new r.D("HDRVLSFinal","standard",[],[],t,null,_.x.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define PASS_POST_PROCESS",0),this.addEffect(new h(i.getEngine(),"HDRVLSFinal",(function(){return e.volumetricLightFinalPostProcess}),!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(i,t),this.lensFlareFinalPostProcess=new r.D("HDRPostLensFlareDepthOfFieldSource","standard",[],[],t,null,_.x.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define PASS_POST_PROCESS",0),this.addEffect(new h(i.getEngine(),"HDRPostLensFlareDepthOfFieldSource",(function(){return e.lensFlareFinalPostProcess}),!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(i,this._floatTextureType),this._createHdrPostProcess(i,t),this.hdrFinalPostProcess=new r.D("HDRPostHDReDepthOfFieldSource","standard",[],[],t,null,_.x.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define PASS_POST_PROCESS",0),this.addEffect(new h(i.getEngine(),"HDRPostHDReDepthOfFieldSource",(function(){return e.hdrFinalPostProcess}),!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(i,t/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(i,t)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(i,t),this._fxaaEnabled&&(this.fxaaPostProcess=new B.P("fxaa",1,null,_.x.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,0),this.addEffect(new h(i.getEngine(),"HDRFxaa",(function(){return e.fxaaPostProcess}),!0))),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this._samples)&&this._samples>1&&m.Y.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")},t.prototype._createDownSampleX4PostProcess=function(e,t){var i=this,s=new Array(32);this.downSampleX4PostProcess=new r.D("HDRDownSampleX4","standard",["dsOffsets"],[],t,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define DOWN_SAMPLE_X4",this._floatTextureType),this.downSampleX4PostProcess.onApply=function(e){for(var t=0,o=i.downSampleX4PostProcess.width,r=i.downSampleX4PostProcess.height,n=-2;n<2;n++)for(var a=-2;a<2;a++)s[t]=(n+.5)*(1/o),s[t+1]=(a+.5)*(1/r),t+=2;e.setArray2("dsOffsets",s)},this.addEffect(new h(e.getEngine(),"HDRDownSampleX4",(function(){return i.downSampleX4PostProcess}),!0))},t.prototype._createBrightPassPostProcess=function(e,t){var i=this,s=new Array(8);this.brightPassPostProcess=new r.D("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],t,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define BRIGHT_PASS",this._floatTextureType),this.brightPassPostProcess.onApply=function(e){var t=1/i.brightPassPostProcess.width,o=1/i.brightPassPostProcess.height;s[0]=-.5*t,s[1]=.5*o,s[2]=.5*t,s[3]=.5*o,s[4]=-.5*t,s[5]=-.5*o,s[6]=.5*t,s[7]=-.5*o,e.setArray2("dsOffsets",s),e.setFloat("brightThreshold",i.brightThreshold)},this.addEffect(new h(e.getEngine(),"HDRBrightPass",(function(){return i.brightPassPostProcess}),!0))},t.prototype._createBlurPostProcesses=function(e,t,i,s){var o=this;void 0===s&&(s="blurWidth");var r=e.getEngine(),n=new d.i("HDRBlurH_"+i,new g.FM(1,0),this[s],t,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,this._floatTextureType),a=new d.i("HDRBlurV_"+i,new g.FM(0,1),this[s],t,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,this._floatTextureType);n.onActivateObservable.add((function(){var e=n.width/r.getRenderWidth();n.kernel=o[s]*e})),a.onActivateObservable.add((function(){var e=a.height/r.getRenderHeight();a.kernel=o.horizontalBlur?64*e:o[s]*e})),this.addEffect(new h(e.getEngine(),"HDRBlurH"+i,(function(){return n}),!0)),this.addEffect(new h(e.getEngine(),"HDRBlurV"+i,(function(){return a}),!0)),this.blurHPostProcesses.push(n),this.blurVPostProcesses.push(a)},t.prototype._createTextureAdderPostProcess=function(e,t){var i=this;this.textureAdderPostProcess=new r.D("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],t,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define TEXTURE_ADDER",this._floatTextureType),this.textureAdderPostProcess.onApply=function(e){e.setTextureFromPostProcess("otherSampler",i._vlsEnabled?i._currentDepthOfFieldSource:i.originalPostProcess),e.setTexture("lensSampler",i.lensTexture),e.setFloat("exposure",i._currentExposure),i._currentDepthOfFieldSource=i.textureAdderFinalPostProcess},this.addEffect(new h(e.getEngine(),"HDRTextureAdder",(function(){return i.textureAdderPostProcess}),!0))},t.prototype._createVolumetricLightPostProcess=function(e,t){var i=this,s=e.enableGeometryBufferRenderer();s.enablePosition=!0;var o=s.getGBuffer();this.volumetricLightPostProcess=new r.D("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],t/8,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define VLS\n#define NB_STEPS "+this._volumetricLightStepsCount.toFixed(1));var n=g.FM.Zero();this.volumetricLightPostProcess.onApply=function(e){if(i.sourceLight&&i.sourceLight.getShadowGenerator()&&i._scene.activeCamera){var t=i.sourceLight.getShadowGenerator();e.setTexture("shadowMapSampler",t.getShadowMap()),e.setTexture("positionSampler",o.textures[2]),e.setColor3("sunColor",i.sourceLight.diffuse),e.setVector3("sunDirection",i.sourceLight.getShadowDirection()),e.setVector3("cameraPosition",i._scene.activeCamera.globalPosition),e.setMatrix("shadowViewProjection",t.getTransformMatrix()),e.setFloat("scatteringCoefficient",i.volumetricLightCoefficient),e.setFloat("scatteringPower",i.volumetricLightPower),n.x=i.sourceLight.getDepthMinZ(i._scene.activeCamera),n.y=i.sourceLight.getDepthMaxZ(i._scene.activeCamera),e.setVector2("depthValues",n)}},this.addEffect(new h(e.getEngine(),"HDRVLS",(function(){return i.volumetricLightPostProcess}),!0)),this._createBlurPostProcesses(e,t/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new r.D("HDRVLSMerge","standard",[],["originalSampler"],t,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(e){e.setTextureFromPostProcess("originalSampler",i._bloomEnabled?i.textureAdderFinalPostProcess:i.originalPostProcess),i._currentDepthOfFieldSource=i.volumetricLightFinalPostProcess},this.addEffect(new h(e.getEngine(),"HDRVLSMerge",(function(){return i.volumetricLightMergePostProces}),!0))},t.prototype._createLuminancePostProcesses=function(e,i){var s=this,o=Math.pow(3,t.LuminanceSteps);this.luminancePostProcess=new r.D("HDRLuminance","standard",["lumOffsets"],[],{width:o,height:o},null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LUMINANCE",i);var n=[];this.luminancePostProcess.onApply=function(e){var t=1/s.luminancePostProcess.width,i=1/s.luminancePostProcess.height;n[0]=-.5*t,n[1]=.5*i,n[2]=.5*t,n[3]=.5*i,n[4]=-.5*t,n[5]=-.5*i,n[6]=.5*t,n[7]=-.5*i,e.setArray2("lumOffsets",n)},this.addEffect(new h(e.getEngine(),"HDRLuminance",(function(){return s.luminancePostProcess}),!0));for(var a=t.LuminanceSteps-1;a>=0;a--){o=Math.pow(3,a);var c="#define LUMINANCE_DOWN_SAMPLE\n";0===a&&(c+="#define FINAL_DOWN_SAMPLER");var l=new r.D("HDRLuminanceDownSample"+a,"standard",["dsOffsets","halfDestPixelSize"],[],{width:o,height:o},null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,c,i);this.luminanceDownSamplePostProcesses.push(l)}var p=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach((function(t,i){var o=new Array(18);t.onApply=function(e){if(p){for(var r=0,n=-1;n<2;n++)for(var a=-1;a<2;a++)o[r]=n/p.width,o[r+1]=a/p.height,r+=2;e.setArray2("dsOffsets",o),e.setFloat("halfDestPixelSize",.5/p.width),p=i===s.luminanceDownSamplePostProcesses.length-1?s.luminancePostProcess:t}},i===s.luminanceDownSamplePostProcesses.length-1&&(t.onAfterRender=function(){var t=e.getEngine().readPixels(0,0,1,1),i=new g.Lt(1/16581375,1/65025,1/255,1);t.then((function(e){var t=new Uint8Array(e.buffer);s._hdrCurrentLuminance=(t[0]*i.x+t[1]*i.y+t[2]*i.z+t[3]*i.w)/100}))}),s.addEffect(new h(e.getEngine(),"HDRLuminanceDownSample"+i,(function(){return t}),!0))}))},t.prototype._createHdrPostProcess=function(e,t){var i=this,s=["#define HDR"];this._hdrAutoExposure&&s.push("#define AUTO_EXPOSURE"),this.hdrPostProcess=new r.D("HDR","standard",["averageLuminance"],["textureAdderSampler"],t,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,s.join("\n"),0);var o=1,n=0,a=0;this.hdrPostProcess.onApply=function(t){if(t.setTextureFromPostProcess("textureAdderSampler",i._currentDepthOfFieldSource),n+=e.getEngine().getDeltaTime(),o<0)o=i._hdrCurrentLuminance;else{var s=(a-n)/1e3;i._hdrCurrentLuminance<o+i.hdrDecreaseRate*s?o+=i.hdrDecreaseRate*s:i._hdrCurrentLuminance>o-i.hdrIncreaseRate*s?o-=i.hdrIncreaseRate*s:o=i._hdrCurrentLuminance}i.hdrAutoExposure?i._currentExposure=i._fixedExposure/o:(o=ie.R.Clamp(o,i.hdrMinimumLuminance,1e20),t.setFloat("averageLuminance",o)),a=n,i._currentDepthOfFieldSource=i.hdrFinalPostProcess},this.addEffect(new h(e.getEngine(),"HDR",(function(){return i.hdrPostProcess}),!0))},t.prototype._createLensFlarePostProcess=function(e,t){var i=this;this.lensFlarePostProcess=new r.D("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],t/2,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LENS_FLARE",0),this.addEffect(new h(e.getEngine(),"HDRLensFlare",(function(){return i.lensFlarePostProcess}),!0)),this._createBlurPostProcesses(e,t/4,2,"lensFlareBlurWidth"),this.lensFlareComposePostProcess=new r.D("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],t,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LENS_FLARE_COMPOSE",0),this.addEffect(new h(e.getEngine(),"HDRLensFlareCompose",(function(){return i.lensFlareComposePostProcess}),!0));var s=new g.FM(0,0);this.lensFlarePostProcess.externalTextureSamplerBinding=!0,this.lensFlarePostProcess.onApply=function(e){e.setTextureFromPostProcess("textureSampler",i._bloomEnabled?i.blurHPostProcesses[0]:i.originalPostProcess),e.setTexture("lensColorSampler",i.lensColorTexture),e.setFloat("strength",i.lensFlareStrength),e.setFloat("ghostDispersal",i.lensFlareGhostDispersal),e.setFloat("haloWidth",i.lensFlareHaloWidth),s.x=i.lensFlarePostProcess.width,s.y=i.lensFlarePostProcess.height,e.setVector2("resolution",s),e.setFloat("distortionStrength",i.lensFlareDistortionStrength)};var o=g.y3.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),n=g.y3.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(e){if(i._scene.activeCamera){e.setTextureFromPostProcess("otherSampler",i.lensFlarePostProcess),e.setTexture("lensDirtSampler",i.lensFlareDirtTexture),e.setTexture("lensStarSampler",i.lensStarTexture);var t=i._scene.activeCamera.getViewMatrix().getRow(0),s=i._scene.activeCamera.getViewMatrix().getRow(2),r=g.P.Dot(t.toVector3(),new g.P(1,0,0))+g.P.Dot(s.toVector3(),new g.P(0,0,1));r*=4;var a=g.y3.FromValues(.5*Math.cos(r),-Math.sin(r),0,0,Math.sin(r),.5*Math.cos(r),0,0,0,0,1,0,0,0,0,1),c=n.multiply(a).multiply(o);e.setMatrix("lensStarMatrix",c),i._currentDepthOfFieldSource=i.lensFlareFinalPostProcess}}},t.prototype._createDepthOfFieldPostProcess=function(e,t){var i=this;this.depthOfFieldPostProcess=new r.D("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],t,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define DEPTH_OF_FIELD",0),this.depthOfFieldPostProcess.onApply=function(e){e.setTextureFromPostProcess("otherSampler",i._currentDepthOfFieldSource),e.setTexture("depthSampler",i._getDepthTexture()),e.setFloat("distance",i.depthOfFieldDistance)},this.addEffect(new h(e.getEngine(),"HDRDepthOfField",(function(){return i.depthOfFieldPostProcess}),!0))},t.prototype._createMotionBlurPostProcess=function(e,t){var i=this;if(this._isObjectBasedMotionBlur){var s=new L("HDRMotionBlur",e,t,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,0);s.motionStrength=this.motionStrength,s.motionBlurSamples=this.motionBlurSamples,this.motionBlurPostProcess=s}else{this.motionBlurPostProcess=new r.D("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],t,null,_.x.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+this.motionBlurSamples.toFixed(1),0);var o=0,n=g.y3.Identity(),a=g.y3.Identity(),c=g.y3.Identity(),l=g.FM.Zero();this.motionBlurPostProcess.onApply=function(t){(c=e.getProjectionMatrix().multiply(e.getViewMatrix())).invertToRef(a),t.setMatrix("inverseViewProjection",a),t.setMatrix("prevViewProjection",n),n=c,l.x=i.motionBlurPostProcess.width,l.y=i.motionBlurPostProcess.height,t.setVector2("screenSize",l),o=e.getEngine().getFps()/60,t.setFloat("motionScale",o),t.setFloat("motionStrength",i.motionStrength),t.setTexture("depthSampler",i._getDepthTexture())}}this.addEffect(new h(e.getEngine(),"HDRMotionBlur",(function(){return i.motionBlurPostProcess}),!0))},t.prototype._getDepthTexture=function(){return this._scene.getEngine().getCaps().drawBuffersExtension?this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]:this._scene.enableDepthRenderer().getDepthMap()},t.prototype._disposePostProcesses=function(){for(var e=0;e<this._cameras.length;e++){var t=this._cameras[e];this.originalPostProcess&&this.originalPostProcess.dispose(t),this.screenSpaceReflectionPostProcess&&this.screenSpaceReflectionPostProcess.dispose(t),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(t),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(t),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(t),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(t),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(t),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(t),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(t),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(t),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(t),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(t);for(var i=0;i<this.luminanceDownSamplePostProcesses.length;i++)this.luminanceDownSamplePostProcesses[i].dispose(t);this.luminancePostProcess&&this.luminancePostProcess.dispose(t),this.hdrPostProcess&&this.hdrPostProcess.dispose(t),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(t),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(t),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(t),this.fxaaPostProcess&&this.fxaaPostProcess.dispose(t);for(i=0;i<this.blurHPostProcesses.length;i++)this.blurHPostProcesses[i].dispose(t);for(i=0;i<this.blurVPostProcesses.length;i++)this.blurVPostProcesses[i].dispose(t)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.fxaaPostProcess=null,this.screenSpaceReflectionPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},t.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),e.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=a.p4.Serialize(this);return this.sourceLight&&(e.sourceLightId=this.sourceLight.id),this.screenSpaceReflectionPostProcess&&(e.screenSpaceReflectionPostProcess=a.p4.Serialize(this.screenSpaceReflectionPostProcess)),e.customType="StandardRenderingPipeline",e},t.Parse=function(e,i,s){var o=a.p4.Parse((function(){return new t(e._name,i,e._ratio)}),e,i,s);return e.sourceLightId&&(o.sourceLight=i.getLightById(e.sourceLightId)),e.screenSpaceReflectionPostProcess&&a.p4.Parse((function(){return o.screenSpaceReflectionPostProcess}),e.screenSpaceReflectionPostProcess,i,s),o},t.LuminanceSteps=6,(0,o.gn)([(0,a.qC)()],t.prototype,"brightThreshold",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"blurWidth",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"horizontalBlur",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"exposure",null),(0,o.gn)([(0,a.oU)("lensTexture")],t.prototype,"lensTexture",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"volumetricLightCoefficient",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"volumetricLightPower",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"volumetricLightBlurScale",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"hdrMinimumLuminance",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"hdrDecreaseRate",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"hdrIncreaseRate",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"hdrAutoExposure",null),(0,o.gn)([(0,a.oU)("lensColorTexture")],t.prototype,"lensColorTexture",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"lensFlareStrength",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"lensFlareGhostDispersal",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"lensFlareHaloWidth",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"lensFlareDistortionStrength",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"lensFlareBlurWidth",void 0),(0,o.gn)([(0,a.oU)("lensStarTexture")],t.prototype,"lensStarTexture",void 0),(0,o.gn)([(0,a.oU)("lensFlareDirtTexture")],t.prototype,"lensFlareDirtTexture",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"depthOfFieldDistance",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"depthOfFieldBlurWidth",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"motionStrength",null),(0,o.gn)([(0,a.qC)()],t.prototype,"objectBasedMotionBlur",null),(0,o.gn)([(0,a.qC)()],t.prototype,"_ratio",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"BloomEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"DepthOfFieldEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"LensFlareEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"HDREnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"VLSEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"MotionBlurEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"fxaaEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"screenSpaceReflectionsEnabled",null),(0,o.gn)([(0,a.qC)()],t.prototype,"volumetricLightStepsCount",null),(0,o.gn)([(0,a.qC)()],t.prototype,"motionBlurSamples",null),(0,o.gn)([(0,a.qC)()],t.prototype,"samples",null),t}(V);(0,n.H)("BABYLON.StandardRenderingPipeline",re);var ne,ae=i(280);i(74295);!function(e){e[e.Hable=0]="Hable",e[e.Reinhard=1]="Reinhard",e[e.HejiDawson=2]="HejiDawson",e[e.Photographic=3]="Photographic"}(ne||(ne={}));var ce=function(e){function t(t,i,s,o,r,n,a,c){void 0===r&&(r=2),void 0===a&&(a=0);var l=e.call(this,t,"tonemap",["_ExposureAdjustment"],null,1,o,r,n,c,null,a)||this;l._operator=i,l.exposureAdjustment=s;var h="#define ";return l._operator===ne.Hable?h+="HABLE_TONEMAPPING":l._operator===ne.Reinhard?h+="REINHARD_TONEMAPPING":l._operator===ne.HejiDawson?h+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":l._operator===ne.Photographic&&(h+="PHOTOGRAPHIC_TONEMAPPING"),l.updateEffect(h),l.onApply=function(e){e.setFloat("_ExposureAdjustment",l.exposureAdjustment)},l}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"TonemapPostProcess"},t}(r.D),le=i(72208),he=i(71419),pe=i(98163),ue=i(90360),de=i(3085),fe=i(63784),ge=i(46719),_e=(i(4902),i(44327),i(94864),i(88228),i(15631)),Pe=i(66513),ye=i(67759),me=function(e){function t(i,s,o,r,n,a,c,l,h){void 0===n&&(n=100),void 0===a&&(a=_.x.BILINEAR_SAMPLINGMODE);var p,u=this;return(u=e.call(this,i,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],s.postProcessRatio||s,o,a,c,l,"#define NUM_SAMPLES "+n)||this)._screenCoordinates=g.FM.Zero(),u.customMeshPosition=g.P.Zero(),u.useCustomMeshPosition=!1,u.invert=!0,u.excludedMeshes=new Array,u.exposure=.3,u.decay=.96815,u.weight=.58767,u.density=.926,c=(h=null!==(p=null==o?void 0:o.getScene())&&void 0!==p?p:h).getEngine(),u._viewPort=new Pe.l(0,0,1,1).toGlobal(c.getRenderWidth(),c.getRenderHeight()),u.mesh=null!=r?r:t.CreateDefaultMesh("VolumetricLightScatteringMesh",h),u._volumetricLightScatteringPass=new ye.q(c),u._createPass(h,s.passRatio||s),u.onActivate=function(e){u.isSupported||u.dispose(e),u.onActivate=null},u.onApplyObservable.add((function(e){u._updateMeshScreenCoordinates(h),e.setTexture("lightScatteringSampler",u._volumetricLightScatteringRTT),e.setFloat("exposure",u.exposure),e.setFloat("decay",u.decay),e.setFloat("weight",u.weight),e.setFloat("density",u.density),e.setVector2("meshPositionOnScreen",u._screenCoordinates)})),u}return(0,o.ZT)(t,e),Object.defineProperty(t.prototype,"useDiffuseColor",{get:function(){return m.Y.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(e){m.Y.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},t.prototype._isReady=function(e,t){var i=e.getMesh();if(i===this.mesh&&i.material)return i.material.isReady(i);var s=[],o=[le.o.PositionKind],r=e.getMaterial();r&&(r.needAlphaTesting()&&s.push("#define ALPHATEST"),i.isVerticesDataPresent(le.o.UVKind)&&(o.push(le.o.UVKind),s.push("#define UV1")),i.isVerticesDataPresent(le.o.UV2Kind)&&(o.push(le.o.UV2Kind),s.push("#define UV2"))),i.useBones&&i.computeBonesUsingShaders?(o.push(le.o.MatricesIndicesKind),o.push(le.o.MatricesWeightsKind),s.push("#define NUM_BONE_INFLUENCERS "+i.numBoneInfluencers),s.push("#define BonesPerMesh "+(i.skeleton?i.skeleton.bones.length+1:0))):s.push("#define NUM_BONE_INFLUENCERS 0"),t&&(s.push("#define INSTANCES"),ue.G.PushAttributesForInstances(o),e.getRenderingMesh().hasThinInstances&&s.push("#define THIN_INSTANCES"));var n=s.join("\n");return this._cachedDefines!==n&&(this._cachedDefines=n,this._volumetricLightScatteringPass.effect=i.getScene().getEngine().createEffect("volumetricLightScatteringPass",o,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],n,void 0,void 0,void 0,{maxSimultaneousMorphTargets:i.numBoneInfluencers})),this._volumetricLightScatteringPass.effect.isReady()},t.prototype.setCustomMeshPosition=function(e){this.customMeshPosition=e},t.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},t.prototype.dispose=function(t){var i=t.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==i&&t.getScene().customRenderTargets.splice(i,1),this._volumetricLightScatteringRTT.dispose(),e.prototype.dispose.call(this,t)},t.prototype.getPass=function(){return this._volumetricLightScatteringRTT},t.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)},t.prototype._createPass=function(e,t){var i=this,s=e.getEngine();this._volumetricLightScatteringRTT=new fe._("volumetricLightScatteringMap",{width:s.getRenderWidth()*t,height:s.getRenderHeight()*t},e,!1,!0,0),this._volumetricLightScatteringRTT.wrapU=_.x.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=_.x.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,this._volumetricLightScatteringRTT.ignoreCameraViewport=!0;var o=this.getCamera();o?o.customRenderTargets.push(this._volumetricLightScatteringRTT):e.customRenderTargets.push(this._volumetricLightScatteringRTT);var r,n=function(e){var t=e.getRenderingMesh(),s=e.getEffectiveMesh();if(!i._meshExcluded(t)){s._internalAbstractMeshDataInfo._isActiveIntermediate=!1;var o=e.getMaterial();if(o){var r=t.getScene(),n=r.getEngine();n.setState(o.backFaceCulling,void 0,void 0,void 0,o.cullBackFaces);var a=t._getInstancesRenderList(e._id,!!e.getReplacementMesh());if(!a.mustReturn){var c=n.getCaps().instancedArrays&&(null!==a.visibleInstances[e._id]||t.hasThinInstances);if(i._isReady(e,c)){var l=i._volumetricLightScatteringPass;t===i.mesh&&(l=e.effect?e._drawWrapper:o._getDrawWrapper());var h=l.effect;if(n.enableEffect(l),c||t._bind(e,h,o.fillMode),t===i.mesh)o.bind(s.getWorldMatrix(),t);else{if(h.setMatrix("viewProjection",r.getTransformMatrix()),o&&o.needAlphaTesting()){var p=o.getAlphaTestTexture();h.setTexture("diffuseSampler",p),p&&h.setMatrix("diffuseMatrix",p.getTextureMatrix())}t.useBones&&t.computeBonesUsingShaders&&t.skeleton&&h.setMatrices("mBones",t.skeleton.getTransformMatrices(t))}c&&t.hasThinInstances&&h.setMatrix("world",s.getWorldMatrix()),t._processRendering(s,e,h,pe.F.TriangleFillMode,a,c,(function(e,t){e||h.setMatrix("world",t)}))}}}}},a=new _e.HE(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add((function(){r=e.clearColor,e.clearColor=a})),this._volumetricLightScatteringRTT.onAfterRenderObservable.add((function(){e.clearColor=r})),this._volumetricLightScatteringRTT.customIsReadyFunction=function(e,t){if(!e.isReady(!1))return!1;if(0===t&&e.subMeshes)for(var o=0;o<e.subMeshes.length;++o){var r=e.subMeshes[o],n=r.getMaterial(),a=r.getRenderingMesh();if(n){var c=a._getInstancesRenderList(r._id,!!r.getReplacementMesh()),l=s.getCaps().instancedArrays&&(null!==c.visibleInstances[r._id]||a.hasThinInstances);if(!i._isReady(r,l))return!1}}return!0},this._volumetricLightScatteringRTT.customRenderFunction=function(t,i,s,o){var r,a=e.getEngine();if(o.length){for(a.setColorWrite(!1),r=0;r<o.length;r++)n(o.data[r]);a.setColorWrite(!0)}for(r=0;r<t.length;r++)n(t.data[r]);for(r=0;r<i.length;r++)n(i.data[r]);if(s.length){for(r=0;r<s.length;r++){var c=s.data[r],l=c.getBoundingInfo();l&&e.activeCamera&&(c._alphaIndex=c.getMesh().alphaIndex,c._distanceToCamera=l.boundingSphere.centerWorld.subtract(e.activeCamera.position).length())}var h=s.data.slice(0,s.length);for(h.sort((function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0})),a.setAlphaMode(2),r=0;r<h.length;r++)n(h[r]);a.setAlphaMode(0)}}},t.prototype._updateMeshScreenCoordinates=function(e){var t,i=e.getTransformMatrix();t=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var s=g.P.Project(t,g.y3.Identity(),i,this._viewPort);this._screenCoordinates.x=s.x/this._viewPort.width,this._screenCoordinates.y=s.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},t.CreateDefaultMesh=function(e,t){var i=(0,ge.pT)(e,{size:1},t);i.billboardMode=he.x.BILLBOARDMODE_ALL;var s=new de.K(e+"Material",t);return s.emissiveColor=new _e.Wo(1,1,1),i.material=s,i},(0,o.gn)([(0,a.hd)()],t.prototype,"customMeshPosition",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"useCustomMeshPosition",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"invert",void 0),(0,o.gn)([(0,a.RR)()],t.prototype,"mesh",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"excludedMeshes",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"exposure",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"decay",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"weight",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"density",void 0),t}(r.D);(0,n.H)("BABYLON.VolumetricLightScatteringPostProcess",me);var be=i(16325),ve=i(43792),Se=(i(35802),function(e){function t(t,i,s,o,r,n,a,c,l){void 0===c&&(c=0),void 0===l&&(l=!1);var h=e.call(this,t,"screenSpaceCurvature",["curvature_ridge","curvature_valley"],["textureSampler","normalSampler"],s,o,r,n,a,void 0,c,void 0,null,l)||this;return h.ridge=1,h.valley=1,h._geometryBufferRenderer=i.enableGeometryBufferRenderer(),h._geometryBufferRenderer?h.onApply=function(e){e.setFloat("curvature_ridge",.5/Math.max(h.ridge*h.ridge,1e-4)),e.setFloat("curvature_valley",.7/Math.max(h.valley*h.valley,1e-4));var t=h._geometryBufferRenderer.getGBuffer().textures[1];e.setTexture("normalSampler",t)}:m.Y.Error("Multiple Render Target support needed for screen space curvature post process. Please use IsSupported test first."),h}return(0,o.ZT)(t,e),t.prototype.getClassName=function(){return"ScreenSpaceCurvaturePostProcess"},Object.defineProperty(t,"IsSupported",{get:function(){var e=G.l.LastCreatedEngine;return!!e&&e.getCaps().drawBuffersExtension},enumerable:!1,configurable:!0}),t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,s,e.options,i,e.renderTargetSamplingMode,s.getEngine(),e.textureType,e.reusable)}),e,s,o)},(0,o.gn)([(0,a.qC)()],t.prototype,"ridge",void 0),(0,o.gn)([(0,a.qC)()],t.prototype,"valley",void 0),t}(r.D));(0,n.H)("BABYLON.ScreenSpaceCurvaturePostProcess",Se)},89815:(e,t,i)=>{i.d(t,{Q:()=>c,Z:()=>l});var s=i(31191),o=i(16142),r=i(37290),n=(i(38731),i(91465),i(48620)),a=i(96969),c=function(e){function t(t,i,s,o,r,n,a,c){return void 0===s&&(s=null),void 0===a&&(a=0),void 0===c&&(c=!1),e.call(this,t,"pass",null,null,i,s,o,r,n,void 0,a,void 0,null,c)||this}return(0,s.ZT)(t,e),t.prototype.getClassName=function(){return"PassPostProcess"},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.options,i,e.renderTargetSamplingMode,e._engine,e.reusable)}),e,s,o)},t}(o.D);(0,n.H)("BABYLON.PassPostProcess",c);var l=function(e){function t(t,i,s,o,r,n,a,c){void 0===s&&(s=null),void 0===a&&(a=0),void 0===c&&(c=!1);var l=e.call(this,t,"passCube",null,null,i,s,o,r,n,"#define POSITIVEX",a,void 0,null,c)||this;return l._face=0,l}return(0,s.ZT)(t,e),Object.defineProperty(t.prototype,"face",{get:function(){return this._face},set:function(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PassCubePostProcess"},t._Parse=function(e,i,s,o){return a.p4.Parse((function(){return new t(e.name,e.options,i,e.renderTargetSamplingMode,e._engine,e.reusable)}),e,s,o)},t}(o.D);r.D._RescalePostProcessFactory=function(e){return new c("rescale",1,null,2,e,!1,0)}},16142:(e,t,i)=>{i.d(t,{D:()=>p});var s=i(31191),o=i(7788),r=i(62897),n=i(58095),a=(i(80196),i(37290)),c=(i(13534),i(96969)),l=i(48620),h=i(67759),p=function(){function e(e,t,i,s,a,c,l,p,u,d,f,g,_,P,y){void 0===l&&(l=1),void 0===d&&(d=null),void 0===f&&(f=0),void 0===g&&(g="postprocess"),void 0===P&&(P=!1),void 0===y&&(y=5),this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.alphaMode=0,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new o.t(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new n.FM(1,1),this._texelSize=n.FM.Zero(),this.onActivateObservable=new r.y$,this.onSizeChangedObservable=new r.y$,this.onApplyObservable=new r.y$,this.onBeforeRenderObservable=new r.y$,this.onAfterRenderObservable=new r.y$,this.name=e,null!=c?(this._camera=c,this._scene=c.getScene(),c.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):p&&(this._engine=p,this._engine.postProcesses.push(this)),this._options=a,this.renderTargetSamplingMode=l||1,this._reusable=u||!1,this._textureType=f,this._textureFormat=y,this._samplers=s||[],this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=g,this._parameters=i||[],this._parameters.push("scale"),this._indexParameters=_,this._drawWrapper=new h.q(this._engine),P||this.updateEffect(d)}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){var t=this;this._samples=Math.min(e,this._engine.getCaps().maxMSAASamples),this._textures.forEach((function(e){e.samples!==t._samples&&t._engine.updateRenderTargetTextureSampleCount(e,t._samples)}))},enumerable:!1,configurable:!0}),e.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(e.prototype,"onActivate",{set:function(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSizeChanged",{set:function(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onApply",{set:function(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(e){this._forcedOutputTexture=e},enumerable:!1,configurable:!0}),e.prototype.restoreDefaultInputTexture=function(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())},e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"PostProcess"},e.prototype.getEngine=function(){return this._engine},e.prototype.getEffect=function(){return this._drawWrapper.effect},e.prototype.shareOutputWith=function(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this},e.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new o.t(2)),this._shareOutputWithPostProcess=null},e.prototype.updateEffect=function(e,t,i,s,o,r,n,a){void 0===e&&(e=null),void 0===t&&(t=null),void 0===i&&(i=null),this._postProcessDefines=e,this._drawWrapper.effect=this._engine.createEffect({vertex:null!=n?n:this._vertexUrl,fragment:null!=a?a:this._fragmentUrl},["position"],t||this._parameters,i||this._samplers,null!==e?e:"",void 0,o,r,s||this._indexParameters)},e.prototype.isReusable=function(){return this._reusable},e.prototype.markTextureDirty=function(){this.width=-1},e.prototype._createRenderTargetTexture=function(e,t,i){void 0===i&&(i=0);for(var s=0;s<this._textureCache.length;s++)if(this._textureCache[s].texture.width===e.width&&this._textureCache[s].texture.height===e.height&&this._textureCache[s].postProcessChannel===i&&this._textureCache[s].texture._generateDepthBuffer===t.generateDepthBuffer)return this._textureCache[s].texture;var o=this._engine.createRenderTargetTexture(e,t);return this._textureCache.push({texture:o,postProcessChannel:i,lastUsedRenderId:-1}),o},e.prototype._flushTextureCache=function(){for(var e=this._renderId,t=this._textureCache.length-1;t>=0;t--)if(e-this._textureCache[t].lastUsedRenderId>100){for(var i=!1,s=0;s<this._textures.length;s++)if(this._textures.data[s]===this._textureCache[t].texture){i=!0;break}i||(this._textureCache[t].texture.dispose(),this._textureCache.splice(t,1))}},e.prototype._resize=function(e,t,i,s,o){this._textures.length>0&&this._textures.reset(),this.width=e,this.height=t;for(var r=null,n=0;n<i._postProcesses.length;n++)if(null!==i._postProcesses[n]){r=i._postProcesses[n];break}var a={width:this.width,height:this.height},c={generateMipMaps:s,generateDepthBuffer:o||r===this,generateStencilBuffer:(o||r===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._createRenderTargetTexture(a,c,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(a,c,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)},e.prototype.activate=function(e,t,i){var s,o,r=this;void 0===t&&(t=null);var n=(e=e||this._camera).getScene(),c=n.getEngine(),l=c.getCaps().maxTextureSize,h=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,p=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0,u=e.parent;!u||u.leftCamera!=e&&u.rightCamera!=e||(h/=2);var d,f=this._options.width||h,g=this._options.height||p,_=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var P=c.currentViewport;P&&(f*=P.width,g*=P.height)}(_||this.alwaysForcePOT)&&(this._options.width||(f=c.needPOTTextures?a.D.GetExponentOfTwo(f,l,this.scaleMode):f),this._options.height||(g=c.needPOTTextures?a.D.GetExponentOfTwo(g,l,this.scaleMode):g)),this.width===f&&this.height===g||this._resize(f,g,e,_,i),this._textures.forEach((function(e){e.samples!==r.samples&&r._engine.updateRenderTargetTextureSampleCount(e,r.samples)})),this._flushTextureCache(),this._renderId++}if(this._shareOutputWithPostProcess)d=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)d=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{d=this.inputTexture;for(var y=void 0,m=0;m<this._textureCache.length;m++)if(this._textureCache[m].texture===d){y=this._textureCache[m];break}y&&(y.lastUsedRenderId=this._renderId)}return this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(h/f,p/g),this._engine.bindFramebuffer(d,0,h,p,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(d,0,void 0,void 0,this.forceFullscreenViewport)),null===(o=(s=this._engine)._debugInsertMarker)||void 0===o||o.call(s,"post process ".concat(this.name," input")),this.onActivateObservable.notifyObservers(e),this.autoClear&&0===this.alphaMode&&this._engine.clear(this.clearColor?this.clearColor:n.clearColor,n._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),d},Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._drawWrapper.effect.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!1,configurable:!0}),e.prototype.isReady=function(){var e,t;return null!==(t=null===(e=this._drawWrapper.effect)||void 0===e?void 0:e.isReady())&&void 0!==t&&t},e.prototype.apply=function(){var e,t;return(null===(e=this._drawWrapper.effect)||void 0===e?void 0:e.isReady())?(this._engine.enableEffect(this._drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),t=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding||this._drawWrapper.effect._bindTexture("textureSampler",null==t?void 0:t.texture),this._drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._drawWrapper.effect),this._drawWrapper.effect):null},e.prototype._disposeTextures=function(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())},e.prototype._disposeTextureCache=function(){for(var e=this._textureCache.length-1;e>=0;e--)this._textureCache[e].texture.dispose();this._textureCache.length=0},e.prototype.setPrePassRenderer=function(e){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=e.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)},e.prototype.dispose=function(e){var t;if(e=e||this._camera,this._disposeTextures(),this._scene&&-1!==(t=this._scene.postProcesses.indexOf(this))&&this._scene.postProcesses.splice(t,1),this._parentContainer){var i=this._parentContainer.postProcesses.indexOf(this);i>-1&&this._parentContainer.postProcesses.splice(i,1),this._parentContainer=null}if(-1!==(t=this._engine.postProcesses.indexOf(this))&&this._engine.postProcesses.splice(t,1),e){if(e.detachPostProcess(this),0===(t=e._postProcesses.indexOf(this))&&e._postProcesses.length>0){var s=this._camera._getFirstPostProcess();s&&s.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},e.prototype.serialize=function(){var e=c.p4.Serialize(this),t=this.getCamera()||this._scene&&this._scene.activeCamera;return e.customType="BABYLON."+this.getClassName(),e.cameraId=t?t.id:null,e.reusable=this._reusable,e.textureType=this._textureType,e.fragmentUrl=this._fragmentUrl,e.parameters=this._parameters,e.samplers=this._samplers,e.options=this._options,e.defines=this._postProcessDefines,e.textureFormat=this._textureFormat,e.vertexUrl=this._vertexUrl,e.indexParameters=this._indexParameters,e},e.prototype.clone=function(){var t=this.serialize();t._engine=this._engine,t.cameraId=null;var i=e.Parse(t,this._scene,"");return i?(i.onActivateObservable=this.onActivateObservable.clone(),i.onSizeChangedObservable=this.onSizeChangedObservable.clone(),i.onApplyObservable=this.onApplyObservable.clone(),i.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),i.onAfterRenderObservable=this.onAfterRenderObservable.clone(),i._prePassEffectConfiguration=this._prePassEffectConfiguration,i):null},e.Parse=function(e,t,i){var s=(0,l.q)(e.customType);if(!s||!s._Parse)return null;var o=t?t.getCameraById(e.cameraId):null;return s._Parse(e,o,t,i)},e._Parse=function(t,i,s,o){return c.p4.Parse((function(){return new e(t.name,t.fragmentUrl,t.parameters,t.samplers,t.options,i,t.renderTargetSamplingMode,t._engine,t.reusable,t.defines,t.textureType,t.vertexUrl,t.indexParameters,!1,t.textureFormat)}),t,s,o)},(0,s.gn)([(0,c.qC)()],e.prototype,"uniqueId",void 0),(0,s.gn)([(0,c.qC)()],e.prototype,"name",void 0),(0,s.gn)([(0,c.qC)()],e.prototype,"width",void 0),(0,s.gn)([(0,c.qC)()],e.prototype,"height",void 0),(0,s.gn)([(0,c.qC)()],e.prototype,"renderTargetSamplingMode",void 0),(0,s.gn)([(0,c.XX)()],e.prototype,"clearColor",void 0),(0,s.gn)([(0,c.qC)()],e.prototype,"autoClear",void 0),(0,s.gn)([(0,c.qC)()],e.prototype,"alphaMode",void 0),(0,s.gn)([(0,c.qC)()],e.prototype,"alphaConstants",void 0),(0,s.gn)([(0,c.qC)()],e.prototype,"enablePixelPerfectMode",void 0),(0,s.gn)([(0,c.qC)()],e.prototype,"forceFullscreenViewport",void 0),(0,s.gn)([(0,c.qC)()],e.prototype,"scaleMode",void 0),(0,s.gn)([(0,c.qC)()],e.prototype,"alwaysForcePOT",void 0),(0,s.gn)([(0,c.qC)("samples")],e.prototype,"_samples",void 0),(0,s.gn)([(0,c.qC)()],e.prototype,"adaptScaleToCurrentViewport",void 0),e}();(0,l.H)("BABYLON.PostProcess",p)},1421:(e,t,i)=>{i.d(t,{O:()=>o});var s=i(72208),o=function(){function e(e){this._vertexBuffers={},this._scene=e}return e.prototype._prepareBuffers=function(){if(!this._vertexBuffers[s.o.PositionKind]){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[s.o.PositionKind]=new s.o(this._scene.getEngine(),e,s.o.PositionKind,!1,!1,2),this._buildIndexBuffer()}},e.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},e.prototype._rebuild=function(){var e=this._vertexBuffers[s.o.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())},e.prototype._prepareFrame=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var i=this._scene.activeCamera;return!!i&&(!(!(t=t||i._postProcesses.filter((function(e){return null!=e})))||0===t.length||!this._scene.postProcessesEnabled)&&(t[0].activate(i,e,null!=t),!0))},e.prototype.directRender=function(e,t,i,s,o,r){var n;void 0===t&&(t=null),void 0===i&&(i=!1),void 0===s&&(s=0),void 0===o&&(o=0),void 0===r&&(r=!1);for(var a=this._scene.getEngine(),c=0;c<e.length;c++){c<e.length-1?e[c+1].activate(this._scene.activeCamera,null==t?void 0:t.texture):(t?a.bindFramebuffer(t,s,void 0,void 0,i,o):r||a.restoreDefaultFramebuffer(),null===(n=a._debugInsertMarker)||void 0===n||n.call(a,"post process ".concat(e[c].name," output")));var l=e[c],h=l.apply();h&&(l.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,h),a.drawElementsType(0,0,6),l.onAfterRenderObservable.notifyObservers(h))}a.setDepthBuffer(!0),a.setDepthWrite(!0)},e.prototype._finalizeFrame=function(e,t,i,s,o){var r;void 0===o&&(o=!1);var n=this._scene.activeCamera;if(n&&(s=s||n._postProcesses.filter((function(e){return null!=e})),0!==s.length&&this._scene.postProcessesEnabled)){for(var a=this._scene.getEngine(),c=0,l=s.length;c<l;c++){var h=s[c];if(c<l-1?h._outputTexture=s[c+1].activate(n,null==t?void 0:t.texture):(t?(a.bindFramebuffer(t,i,void 0,void 0,o),h._outputTexture=t):(a.restoreDefaultFramebuffer(),h._outputTexture=null),null===(r=a._debugInsertMarker)||void 0===r||r.call(a,"post process ".concat(s[c].name," output"))),e)break;var p=h.apply();p&&(h.onBeforeRenderObservable.notifyObservers(p),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,p),a.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(p))}a.setDepthBuffer(!0),a.setDepthWrite(!0),a.setAlphaMode(0)}},e.prototype.dispose=function(){var e=this._vertexBuffers[s.o.PositionKind];e&&(e.dispose(),this._vertexBuffers[s.o.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},e}()},280:(e,t,i)=>{i.d(t,{J:()=>a,i:()=>n});var s=i(31191),o=i(58095),r=i(16142),n=(i(36190),function(e){function t(t,i,s,r,n,a,c){var l=e.call(this,t,"stereoscopicInterlace",["stepSize"],["camASampler"],1,i[1],n,a,c,r?"#define IS_STEREOSCOPIC_INTERLACED 1":s?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return l._passedProcess=i[0]._rigPostProcess,l._stepSize=new o.FM(1/l.width,1/l.height),l.onSizeChangedObservable.add((function(){l._stepSize=new o.FM(1/l.width,1/l.height)})),l.onApplyObservable.add((function(e){e.setTextureFromPostProcess("camASampler",l._passedProcess),e.setFloat2("stepSize",l._stepSize.x,l._stepSize.y)})),l}return(0,s.ZT)(t,e),t.prototype.getClassName=function(){return"StereoscopicInterlacePostProcessI"},t}(r.D)),a=function(e){function t(t,i,s,r,n,a){var c=e.call(this,t,"stereoscopicInterlace",["stepSize"],["camASampler"],1,i[1],r,n,a,s?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return c._passedProcess=i[0]._rigPostProcess,c._stepSize=new o.FM(1/c.width,1/c.height),c.onSizeChangedObservable.add((function(){c._stepSize=new o.FM(1/c.width,1/c.height)})),c.onApplyObservable.add((function(e){e.setTextureFromPostProcess("camASampler",c._passedProcess),e.setFloat2("stepSize",c._stepSize.x,c._stepSize.y)})),c}return(0,s.ZT)(t,e),t.prototype.getClassName=function(){return"StereoscopicInterlacePostProcess"},t}(r.D)},46340:(e,t,i)=>{i.d(t,{J:()=>a});var s=i(31191),o=i(73803),r=i(16142),n=i(84318),a=(i(37328),i(81959),i(80196),function(e){function t(t,i,s,r,a,c,l,h){void 0===r&&(r=null),void 0===h&&(h=0);var p=e.call(this,t,"subSurfaceScattering",["texelSize","viewportSize","metersPerUnit"],["diffusionS","diffusionD","filterRadii","irradianceSampler","depthSampler","albedoSampler"],s,r,a||o.x.BILINEAR_SAMPLINGMODE,c,l,null,h,"postprocess",void 0,!0)||this;return p._scene=i,p.updateEffect(),p.onApplyObservable.add((function(e){if(i.prePassRenderer&&i.subSurfaceConfiguration){var t=p.texelSize;e.setFloat("metersPerUnit",i.subSurfaceConfiguration.metersPerUnit),e.setFloat2("texelSize",t.x,t.y),e.setTexture("irradianceSampler",i.prePassRenderer.getRenderTarget().textures[i.prePassRenderer.getIndex(0)]),e.setTexture("depthSampler",i.prePassRenderer.getRenderTarget().textures[i.prePassRenderer.getIndex(5)]),e.setTexture("albedoSampler",i.prePassRenderer.getRenderTarget().textures[i.prePassRenderer.getIndex(7)]),e.setFloat2("viewportSize",Math.tan(i.activeCamera.fov/2)*i.getEngine().getAspectRatio(i.activeCamera,!0),Math.tan(i.activeCamera.fov/2)),e.setArray3("diffusionS",i.subSurfaceConfiguration.ssDiffusionS),e.setArray("diffusionD",i.subSurfaceConfiguration.ssDiffusionD),e.setArray("filterRadii",i.subSurfaceConfiguration.ssFilterRadii)}else n.Y.Error("PrePass and subsurface configuration needs to be enabled for subsurface scattering.")})),p}return(0,s.ZT)(t,e),t.prototype.getClassName=function(){return"SubSurfaceScatteringPostProcess"},t}(r.D))},16325:(e,t,i)=>{i.d(t,{T:()=>a});var s=i(31191),o=i(58095),r=i(73803),n=i(16142),a=(i(80208),function(e){function t(t,i,s,n){var a=e.call(this,t,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,n.postProcessScaleFactor,i,r.x.BILINEAR_SAMPLINGMODE)||this;return a._isRightEye=s,a._distortionFactors=n.distortionK,a._postProcessScaleFactor=n.postProcessScaleFactor,a._lensCenterOffset=n.lensCenterOffset,a.adaptScaleToCurrentViewport=!0,a.onSizeChangedObservable.add((function(){a._scaleIn=new o.FM(2,2/a.aspectRatio),a._scaleFactor=new o.FM(1/a._postProcessScaleFactor*.5,1/a._postProcessScaleFactor*.5*a.aspectRatio),a._lensCenter=new o.FM(a._isRightEye?.5-.5*a._lensCenterOffset:.5+.5*a._lensCenterOffset,.5)})),a.onApplyObservable.add((function(e){e.setFloat2("LensCenter",a._lensCenter.x,a._lensCenter.y),e.setFloat2("Scale",a._scaleFactor.x,a._scaleFactor.y),e.setFloat2("ScaleIn",a._scaleIn.x,a._scaleIn.y),e.setFloat4("HmdWarpParam",a._distortionFactors[0],a._distortionFactors[1],a._distortionFactors[2],a._distortionFactors[3])})),a}return(0,s.ZT)(t,e),t.prototype.getClassName=function(){return"VRDistortionCorrectionPostProcess"},t}(n.D))},43792:(e,t,i)=>{i.d(t,{E:()=>n});var s=i(31191),o=i(73803),r=i(16142),n=(i(52377),i(74649),function(e){function t(t,i,s){var r=e.call(this,t,"vrMultiviewToSingleview",["imageIndex"],["multiviewSampler"],s,i,o.x.BILINEAR_SAMPLINGMODE)||this;return r.onSizeChangedObservable.add((function(){})),r.onApplyObservable.add((function(e){i._scene.activeCamera&&i._scene.activeCamera.isLeftCamera?e.setInt("imageIndex",0):e.setInt("imageIndex",1),e.setTexture("multiviewSampler",i._multiviewTexture)})),r}return(0,s.ZT)(t,e),t.prototype.getClassName=function(){return"VRMultiviewToSingleviewPostProcess"},t}(r.D))}}]);