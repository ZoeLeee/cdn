(()=>{"use strict";var e,t,i,r,n={65492:(e,t,i)=>{i.d(t,{KT:()=>S,P2:()=>A,YZ:()=>P,aP:()=>T,yD:()=>C,yk:()=>w});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(61799),l=i.n(o),h=i(26117),c=i.n(h),u=i(5996),d=i.n(u),p=i(20658),f=i.n(p),m=i(3434),_=i.n(m),g=i(97828),y=i.n(g),v=i(93213),b=i(6475),E=i(29115);function x(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=l()(r).call(r,(function(t){return c()(e,t).enumerable}))),i.push.apply(i,r)}return i}async function C({name:e,pic_key:t,jsonData:i,resources:r,projectId:n}){return await(0,E.qu)(b.yy.upload,{name:e,pic_key:t,json_data:i,resources:r,status:1,project_id:n,project_type:"3d"})}async function w(e,t){const i=await(0,E.ZL)(b.yy.list,{params:{projectId:e,name:t}});return i.code===E.Mx.Ok?i.data:null}async function S(e){const t=await(0,E.pz)(b.yy.update,function(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?d()(i=x(Object(n),!0)).call(i,(function(t){(0,v.Z)(e,t,n[t])})):f()?_()(e,f()(n)):d()(r=x(Object(n))).call(r,(function(t){y()(e,t,c()(n,t))}))}return e}({},e));return t}async function T(e,t){const i=await t();return(await(0,E.qu)(b.yy.pic,{id:e,data:i})).code!==E.Mx.Ok}async function P(e){const t=await(0,E.ZL)(b.yy.detail+"/"+e);return t.code===E.Mx.Ok?t.data?.info:null}async function A(e){return(await(0,E.QO)(b.yy.delete,{data:{id:e}})).code===E.Mx.Ok}},89487:(e,t,i)=>{i.d(t,{Cq:()=>R,Dd:()=>S,_I:()=>P,cT:()=>w,fD:()=>T,hr:()=>M,jv:()=>A,py:()=>I,zs:()=>O});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(61799),l=i.n(o),h=i(26117),c=i.n(h),u=i(5996),d=i.n(u),p=i(20658),f=i.n(p),m=i(3434),_=i.n(m),g=i(97828),y=i.n(g),v=i(93213),b=(i(13567),i(6475)),E=i(29115);function x(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=l()(r).call(r,(function(t){return c()(e,t).enumerable}))),i.push.apply(i,r)}return i}function C(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?d()(i=x(Object(n),!0)).call(i,(function(t){(0,v.Z)(e,t,n[t])})):f()?_()(e,f()(n)):d()(r=x(Object(n))).call(r,(function(t){y()(e,t,c()(n,t))}))}return e}async function w({name:e,jsonData:t,sourceType:i,moduleIds:r,projectId:n,pid:s}){return await(0,E.qu)(b.au.create,{name:e,pic_key:"icon.png",source_type:i,node_type:"file",json_data:t,resources:r,project_id:n,pid:s,status:1,project_type:"3d"})}async function S(e){return await(0,E.pz)(b.au.update,C({},e))}async function T(e,t=0,i){const r=await(0,E.ZL)(b.au.list,{params:{source_type:e,pid:t,project_type:"3d",name:i,status:1}});return r.code===E.Mx.Ok?r.data??[]:null}async function P(e){return(await E.GH.delete(b.au.delete,{data:{id:e}})).code===E.Mx.Ok}async function A(e,t){try{const i=await t();return(await(0,E.qu)(b.au.pic,{id:e,data:i})).code!==E.Mx.Ok}catch(e){return!1}}async function R(e){const t=await(0,E.ZL)(b.au.detail+"/"+e);return t.code===E.Mx.Ok?t.data?.info?.json_data:null}async function M(e){const t=await(0,E.ZL)(b.au.detail+"/"+e);return t.code===E.Mx.Ok?t.data?.info:null}async function O({name:e,sourceType:t}){return await E.GH.post(b.au.create,{name:e,pid:0,source_type:t,node_type:"dir",status:1,project_type:"3d"})}async function I(e){return await E.GH.put(b.au.update,C({},e))}},6475:(e,t,i)=>{let r;i.d(t,{CY:()=>d,Lc:()=>u,ND:()=>c,U:()=>l,Ym:()=>s,ZQ:()=>h,au:()=>a,fL:()=>r,yy:()=>o,zp:()=>n}),function(e){e.Model="models",e.Component="components",e.Files="files",e.GlobalVariables="globalVariables",e.Particles="particles"}(r||(r={}));const n="iot.gkiiot.com:8080",s={upload:"/editor/file/upload",uploadMulti:"/editor/fileUploadAndDownload/uploadMulti"},a={create:"/editor/file/upload",list:"/editor/file/private/list",update:"/editor/file/edit",delete:"/editor/file/delete",pic:"/editor/file/upload/pic",detail:"/editor/file/detail",detail2:"/editor/file/detail/id/",publicList:"/editor/file/public/list"},o={upload:"/editor/app/upload",list:"/editor/app/list",prefix:"/editor/file/prefix",update:"/editor/app/edit",pic:"/editor/app/upload/pic",detail:"/editor/app/detail",detail2:"/editor/app/detail/uuid/",delete:"/editor/app/delete",preview:"/editor/app/set/preview",cancelPreview:"/editor/app/cancel/preview",copy:"/editor/app/copy",share:"/editor/app/share",checkShare:"/editor/app/share/check"},l={list:"/editor/project/list",detail:"/editor/project/detail/",edit:"/editor/project/edit"},h={category:"/portal/market/category",list:"/portal/market/listEx",detail:"/portal/market/detail",detailEx:"/portal/market/detailEx",buy:"/trade/buy",buyList:"/trade/boughten/list",trade:"/portal/market/trade",pull:"/editor/opus/pull",preview:"/editor/opus/preview/",collections:"/editor/appcollection/list",collect:"/editor/appcollection/edit",cancelCollect:"/editor/appcollection/delete/",isBuy:"/trade/bought"},c={publish:"/editor/opus/publish"},u={delete:"/editor/cloudauth/delete",detail:"/editor/cloudauth/detail",edit:"/editor/cloudauth/edit",list:"/editor/cloudauth/list",sign:"/editor/cloudauth/sign"},d={prodList:"/openapi/sign/prod/list",funList:"/openapi/sign/prod/fun/list",cmdList:"/openapi/sign/prod/cmd/list",devList:"/openapi/sign/dev/prod/dev"}},99394:(e,t,i)=>{i.d(t,{SI:()=>n,XD:()=>s,mn:()=>o,s7:()=>a});var r=i(29115);function n(e,t){return(0,r.GH)({url:e,method:"post",data:t})}function s(e,t,i){return(0,r.GH)({url:e,method:i,data:t})}function a(e,t){return(0,r.GH)({url:e,method:"get",params:t})}function o(e,t){return r.GH.delete(e,{data:t})}},84199:(e,t,i)=>{let r;i.d(t,{d:()=>r}),function(e){e.Delete="DELETE",e.Model2Zero="MODEL2ZERO",e.SelectAll="SELECTALL",e.Copy="COPY",e.Paste="PASTE",e.Group="GROUP"}(r||(r={}))},46600:(e,t,i)=>{i.d(t,{Z:()=>c});var r=i(97539),n=i.n(r),s=i(32735),a=i(42792),o=i(3450);const l=(0,o.ZP)(a.Z)((({theme:e})=>({fontSize:"20px",color:"#333"}))),h=(0,o.ZP)("i")((({theme:e})=>({cursor:"pointer",fontSize:"18px",color:"#333"}))),c=({type:e,sx:t,onClick:i})=>(()=>{if(!e)return null;let r=t||{};return-1===n()(e).call(e,"icon-")?s.createElement(l,{sx:r,onClick:e=>i&&i(e)},e):s.createElement(h,{sx:r,className:"iconfont "+e,onClick:e=>i&&i(e)})})()},2361:(e,t,i)=>{i.d(t,{V4:()=>n,fl:()=>r,tu:()=>s});const r="class CustomComponent extends HC.Component {\n    //\u7ec4\u4ef6\u5c5e\u6027\n    getData() {\n        return {\n            \n        };\n    }\n    //\u7ec4\u4ef6\u5305\u542b\u5b9e\u4f53\n    initComponents(){\n        return [\n            \n        ]\n    }\n}\n",n=e=>`class CustomComponent extends HC.Component {\n        //\u7ec4\u4ef6\u5c5e\u6027\n        getData() {\n            return {\n                \n            };\n        }\n        //\u7ec4\u4ef6\u5305\u542b\u5b9e\u4f53\n        initComponents(){\n            return [\n               ${e} \n            ]\n        }\n    }\n    `,s='class ComponentName extends HC.Component {\n    getData() {\n        return {\n            status:""\n        };\n    }\n    initComponents(){\n        return [\n            new HC.ImportEntity({url:location.origin+"/static/models/Xbot.glb"})\n        ]\n    }\n    play() {\n        const robot=this.entitys[0];\n        robot.stopAnimates();\n        switch (this.data.status) {\n            case "walk":\n                robot.startAnimates(this.data.status);\n                robot.moveAnimate({\n                    path: [\n                    { x: 0, y: 0, z: 0 },\n                    { x: 2, y: 0, z: 0 },\n                    { x: 2, y: 0, z: 2 },\n                    { x: 0, y: 0, z: 2 },\n                    { x: 0, y: 0, z: 0 },\n                    ],\n                    loop:true,\n                    time: 3,\n                }).start();\n                break;\n            case "run":\n                robot.startAnimates(this.data.status);\n                robot.rotateAnimate({\n                    angle: Math.PI * 2,\n                });\n                break;\n            default:\n            break;\n        }\n    }\n}\n'},18442:(e,t,i)=>{i.d(t,{Z:()=>l});var r=i(74857),n=i(21092),s=i(91993),a=i(32735);const o=["children","onClose"],l=e=>{let{children:t,onClose:i}=e,l=(0,n.Z)(e,o);return a.createElement(s.ZP,(0,r.Z)({onBlur:e=>{let t=e.relatedTarget;const r=e.currentTarget;let n=!1;do{if(t===r){n=!0;break}t=t?.parentElement}while(t);n||i()},sx:{pointerEvents:"none","& .MuiPaper-root":{zIndex:9999,pointerEvents:"auto"}},hideBackdrop:!0,onClose:i},l),t)}},73983:(e,t,i)=>{i.d(t,{Z:()=>A});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(61799),l=i.n(o),h=i(26117),c=i.n(h),u=i(5996),d=i.n(u),p=i(20658),f=i.n(p),m=i(3434),_=i.n(m),g=i(97828),y=i.n(g),v=i(93213),b=i(32735),E=i(73764),x=i(94063),C=i(46567);const w=({onClick:e,zIndex:t})=>b.createElement("div",{onClick:e,style:{position:"fixed",left:0,right:0,bottom:0,top:0,margin:"auto",width:"100%",height:"100%",zIndex:t}});function S(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=l()(r).call(r,(function(t){return c()(e,t).enumerable}))),i.push.apply(i,r)}return i}function T(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?d()(i=S(Object(n),!0)).call(i,(function(t){(0,v.Z)(e,t,n[t])})):f()?_()(e,f()(n)):d()(r=S(Object(n))).call(r,(function(t){y()(e,t,c()(n,t))}))}return e}const P=C.xS,A=({color:e,onChange:t,InputProps:i,value:r,sx:n={}})=>{const[s,a]=(0,b.useState)(!1),o=()=>{a(!1)};let l=r;return 7!==l?.length&&(l="object"==typeof e?`rgba(${e.r},${e.g},${e.b},${e.a})`:e),b.createElement(x.Z,{sx:T({position:"relative",width:165},n)},b.createElement(E.Z,{size:"small",onFocus:()=>{a(!0)},value:r||e,sx:{background:l,borderRadius:1},onChange:e=>t({hex:e.target.value}),InputProps:{sx:{height:24,borderRadius:1,border:0}}}),s&&b.createElement(b.Fragment,null,b.createElement(x.Z,{sx:{position:"absolute",right:0,zIndex:10}},b.createElement(b.Fragment,null,b.createElement(P,{color:e,onChange:t,presetColors:["#33334C","#D0021B","#F5A623","#F8E71C","#8B572A","#7ED321","#417505","#BD10E0","#9013FE","#4A90E2","#50E3C2","#B8E986","#000000","#4A4A4A","#9B9B9B","#FFFFFF"],disableAlpha:!1,onBlur:o}))),b.createElement(w,{onClick:o,zIndex:9})))}},9742:(e,t,i)=>{i.d(t,{D:()=>z,d:()=>N});var r=i(93213),n=i(74857),s=i(21092),a=i(51463),o=i.n(a),l=i(61799),h=i.n(l),c=i(32849),u=i.n(c),d=i(20246),p=i.n(d),f=i(39831),m=i.n(f),_=i(26117),g=i.n(_),y=i(5996),v=i.n(y),b=i(20658),E=i.n(b),x=i(3434),C=i.n(x),w=i(97828),S=i.n(w),T=i(57055),P=i(22997),A=i(94063),R=i(11528),M=i(73764),O=i(46269),I=i(32735),D=i(54056),F=i(49431);const L=["value","onChange","objKey","label","hasPage","openSelect"];function k(e,t){var i=p()(e);if(m()){var r=m()(e);t&&(r=h()(r).call(r,(function(t){return g()(e,t).enumerable}))),i.push.apply(i,r)}return i}function B(e){for(var t=1;t<arguments.length;t++){var i,n,s=null!=arguments[t]?arguments[t]:{};t%2?v()(i=k(Object(s),!0)).call(i,(function(t){(0,r.Z)(e,t,s[t])})):E()?C()(e,E()(s)):v()(n=k(Object(s))).call(n,(function(t){S()(e,t,g()(s,t))}))}return e}const N=e=>{var t,i;let{value:r,onChange:a,objKey:l="objectId",label:c,hasPage:d,openSelect:p}=e,f=(0,s.Z)(e,L);const m=o()(t=h()(i=D.gV.intance.Database.ModelSpace.Entitys).call(i,(e=>!e.IsErase))).call(t,(e=>({label:e.Name,value:e.Id})));d&&m.unshift({label:"\u9875\u9762",value:0});const _=(e,t,i)=>{"selectOption"===i&&(a?a?.(e,t,i):F.FQ.updateState((()=>{r[l]=D.gV.intance.Database.getObjectId(t.value)})))};return I.createElement(O.Qj,null,(()=>I.createElement(P.Z,{id:"select-entity-list",sx:{width:300},options:m,autoHighlight:!0,size:"small",isOptionEqualToValue:(e,t)=>-1===t||e.value===t,getOptionLabel:e=>-1===e?"\u8bf7\u9009\u62e9":u()(m).call(m,(t=>t.value===e))?.label??e?.label??e,onChange:_,value:r instanceof T.ObjectId?r.Index:r?.[l]?.Index??-1,renderOption:(e,t)=>I.createElement(A.Z,(0,n.Z)({component:"li"},e,{key:t.value}),t.label),renderInput:e=>I.createElement(M.Z,(0,n.Z)({},e,{label:c??"\u9009\u62e9\u76ee\u6807",inputProps:B({},e.inputProps)},f))})))},z=({value:e,onChange:t,variables:i})=>I.createElement(M.Z,{size:"small",fullWidth:!0,select:!0,value:e,label:"\u53d8\u91cf",sx:{my:1},onChange:t},o()(i).call(i,(e=>I.createElement(R.Z,{key:e.key,value:e.key},e.key))))},32616:(e,t,i)=>{i.d(t,{Z:()=>c});var r=i(75393),n=i(68867),s=i(37211),a=i(58181),o=i(8096),l=i(32735),h=i(6512);const c=({open:e,onOk:t,onCancel:i,title:c,content:u})=>l.createElement(n.Z,{sx:{"& .MuiDialog-paper":{width:"80%",maxHeight:435}},maxWidth:"xs",open:e,keepMounted:!0},l.createElement(h.Z,{title:c,onClose:i}),l.createElement(a.Z,{dividers:!0},"string"==typeof u?l.createElement(o.Z,{id:"confirm-dialog-description"},u):u),l.createElement(s.Z,{sx:{justifyContent:"space-around"}},l.createElement(r.Z,{autoFocus:!0,onClick:t,variant:"contained",sx:{width:"30%"}},"\u786e\u8ba4"),l.createElement(r.Z,{sx:{width:"30%"},color:"inherit",variant:"contained",onClick:i},"\u53d6\u6d88")))},6512:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(74857),n=i(21092),s=i(75393),a=i(57426),o=i(56622),l=i(45709),h=i(32735),c=i(44700);const u=["onClose","title","sx"],d=e=>{let{onClose:t,title:i,sx:d}=e,p=(0,n.Z)(e,u);return h.createElement(a.Z,{sx:d},h.createElement(o.Z,(0,r.Z)({flexDirection:"row",justifyContent:"space-between"},p),h.createElement(l.Z,{variant:"h5"},i),h.createElement(s.Z,{onClick:t,size:"large",startIcon:h.createElement(c.Z,null)})))}},8578:(e,t,i)=>{i.d(t,{Z:()=>a});var r=i(94063),n=i(45709),s=i(32735);const a=({title:e="\u6682\u65e0\u6570\u636e"})=>s.createElement(r.Z,{sx:{width:"100%",textAlign:"center"}},s.createElement("img",{src:"/static/images/nodata.svg"}),"string"==typeof e?s.createElement(n.Z,null,e):e)},52802:(e,t,i)=>{i.d(t,{Z:()=>u});var r=i(74857),n=i(21092),s=i(32735),a=i(73764),o=i(65503),l=i(3450);const h=["title","defaultValue","onBlur","id","height","startAdornment","placeholder"],c=(0,l.ZP)(a.Z)`
  .MuiInputLabel-shrink {
    top: 0px;
  }
`,u=e=>{let{title:t,defaultValue:i,onBlur:a,id:l,height:u,startAdornment:d,placeholder:p}=e,f=(0,n.Z)(e,h);const m=e=>{if(13===e.keyCode)document.getElementById(l||"filled-hidden-label-small").blur()};return s.createElement(s.Fragment,null,s.createElement(c,(0,r.Z)({defaultValue:i,label:t,id:l||"filled-hidden-label-small",variant:"outlined",placeholder:p,onBlur:e=>{a?.(e),window.removeEventListener("keydown",m)},onFocus:e=>{e.target.select(),window.addEventListener("keydown",m)},fullWidth:!0,autoComplete:"off",InputLabelProps:{sx:{top:"-10px"}},InputProps:{startAdornment:d&&s.createElement(o.Z,{position:"start"},d),sx:{height:u||35,border:0}},inputProps:{height:0}},f)))}},43966:(e,t,i)=>{i.d(t,{Z:()=>s});var r=i(32735),n=i(42792);const s=({name:e,color:t,fontSize:i})=>r.createElement(n.Z,{className:"iconfont "+e,sx:{fontSize:i||18,color:t||"#000"}})},48155:(e,t,i)=>{i.d(t,{Z:()=>o});var r=i(56622),n=i(73764),s=i(45709),a=i(32735);const o=({label:e,onChange:t,placeholder:i,value:o,defaultValue:l,sx:h={marginBottom:.1},onBlur:c,endElement:u,name:d})=>a.createElement(r.Z,{direction:"row",sx:h,spacing:2,alignItems:"center"},a.createElement(s.Z,{sx:{marginRight:.1,minWidth:"45px",fontSize:14}},e),a.createElement(n.Z,{defaultValue:l,value:o,placeholder:i,hiddenLabel:!0,variant:"outlined",size:"small",onChange:t,onBlur:c,sx:{padding:"2px"},name:d}),u)},39829:(e,t,i)=>{i.d(t,{Z:()=>p});var r=i(51463),n=i.n(r),s=i(45709),a=i(46561),o=i(52015),l=i(37360),h=i(32735),c=i(6475),u=i(29115),d=i(81284);const p=({onClick:e,disableId:t,selectId:i})=>{const[r,p]=h.useState([]),[f,m]=h.useState({page:1,limit:20,project_type:"3d"});return h.useEffect((()=>{(async()=>{const e=await(0,u.ZL)(c.U.list,{params:f});e.code===u.Mx.Ok?p(e.data.list):p([])})()}),[f]),h.createElement(a.Z,{sx:{pt:0,width:500,maxHeight:300,overflow:"auto",outline:"1px solid #ccc",p:"14px"},subheader:h.createElement(s.Z,null,"\u9879\u76ee\u5217\u8868")},n()(r).call(r,(r=>h.createElement(o.ZP,{disabled:t===r.id,autoFocus:!0,button:!0,key:r.id,onClick:()=>e(r.id),sx:{"&:hover":{backgroundColor:"#ccc"},backgroundColor:i===r.id?"#ccc":void 0}},h.createElement(d.Z,{sx:{mr:2,color:"#df9c26"}}),h.createElement(l.Z,{primary:r.name})))))}},54671:(e,t,i)=>{i.d(t,{Z:()=>M});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(61799),l=i.n(o),h=i(26117),c=i.n(h),u=i(5996),d=i.n(u),p=i(20658),f=i.n(p),m=i(3434),_=i.n(m),g=i(97828),y=i.n(g),v=i(74857),b=i(93213),E=i(21092),x=i(67970),C=i(5385),w=i(61241),S=i(32735),T=i(89044);const P=["value","onChange","sx"];function A(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=l()(r).call(r,(function(t){return c()(e,t).enumerable}))),i.push.apply(i,r)}return i}function R(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?d()(i=A(Object(n),!0)).call(i,(function(t){(0,b.Z)(e,t,n[t])})):f()?_()(e,f()(n)):d()(r=A(Object(n))).call(r,(function(t){y()(e,t,c()(n,t))}))}return e}const M=e=>{let{value:t,onChange:i,sx:r={}}=e,n=(0,E.Z)(e,P);return S.createElement(w.Z,{sx:R({display:"flex",alignItems:"center",width:"100%"},r)},S.createElement(C.ZP,(0,v.Z)({value:t,onChange:i,sx:{flex:1}},n)),S.createElement(x.Z,null,S.createElement(T.Z,{fontSize:"small"})))}},83361:(e,t,i)=>{i.d(t,{Z:()=>u});var r=i(74857),n=i(21092),s=i(51463),a=i.n(s),o=i(11528),l=i(73764),h=i(32735);const c=["options","value","onChange"],u=e=>{let{options:t,value:i,onChange:s}=e,u=(0,n.Z)(e,c);return h.createElement(l.Z,(0,r.Z)({select:!0,size:"small",onChange:s,value:i},u),a()(t).call(t,(e=>{let t="object"==typeof e?e.label:e,i="object"==typeof e?e.value:e;return h.createElement(o.Z,{key:i,value:i},t)})))}},5224:(e,t,i)=>{i.d(t,{Z:()=>U});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(26117),l=i.n(o),h=i(5996),c=i.n(h),u=i(20658),d=i.n(u),p=i(3434),f=i.n(p),m=i(97828),_=i.n(m),g=i(93213),y=i(61799),v=i.n(y),b=i(51463),E=i.n(b),x=i(57055),C=i(10728),w=i(81284),S=i(37394),T=i(73764),P=i(45709),A=i(46561),R=i(52015),M=i(37360),O=i(32735),I=i(6475),D=i(89487),F=i(29115),L=i(40652),k=i(73554);function B(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=v()(r).call(r,(function(t){return l()(e,t).enumerable}))),i.push.apply(i,r)}return i}function N(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?c()(i=B(Object(n),!0)).call(i,(function(t){(0,g.Z)(e,t,n[t])})):d()?f()(e,d()(n)):c()(r=B(Object(n))).call(r,(function(t){_()(e,t,l()(n,t))}))}return e}let z=!1;const U=({onClick:e,disableId:t,selectId:i,sourceType:r,projectId:n})=>{const[s,a]=O.useState([]),[o,l]=O.useState({page:1,limit:20,project_type:"3d"}),h=async()=>{var e;const t=await(0,D.fD)(r);a(v()(e=t??[]).call(e,(e=>"dir"===e.node_type)))},c=async e=>{if("code"in e&&e.code!==x.Utils.KeyCode.Enter)return;if(z)return void(z=!1);z=!0;const t=e.target.value;if(!t)return k.y.error("\u76ee\u5f55\u4e0d\u80fd\u4e3a\u7a7a"),s.pop(),void a([...s]);(await(0,D.zs)({name:t,sourceType:r})).code===F.Mx.Ok&&(r===I.fL.Model&&L.G.trigger({type:"ApplyModel",target:null}),h())};return O.useEffect((()=>{h()}),[o]),O.createElement(A.Z,{sx:{pt:0,width:500,maxHeight:300,overflow:"auto",outline:"1px solid #ccc",p:"14px"},subheader:O.createElement(P.Z,null,"\u6587\u4ef6\u76ee\u5f55\u5217\u8868")},E()(s).call(s,(r=>O.createElement(R.ZP,{disabled:t===r.id,autoFocus:!0,button:!0,key:r.id,onClick:()=>e(r.id),sx:{"&:hover":{backgroundColor:"#ccc"},backgroundColor:i===r.id?"#ccc":void 0}},O.createElement(w.Z,{sx:{mr:2,color:"#df9c26"}}),r.editor?O.createElement(T.Z,{size:"small",value:r.name,onChange:e=>((e,t)=>{t.name=e.target.value,a([...s])})(e,r),onFocus:e=>e.target.select(),onBlur:c,onKeyDown:c}):O.createElement(M.Z,{primary:r.name})))),O.createElement(S.Z,{onClick:()=>{a([...s,N(N({},s[0]),{},{id:-1,name:"\u65b0\u5efa\u76ee\u5f55",editor:!0})])}},O.createElement(M.Z,{primary:"\u65b0\u5efa\u76ee\u5f55"}),O.createElement(C.Z,null)))}},3360:(e,t,i)=>{i.d(t,{Z:()=>o});var r=i(13697),n=i(45709),s=i(32735),a=i(23002);const o=({onClick:e,title:t})=>s.createElement(r.Z,{sx:{textAlign:"center",pt:1,border:"2px dashed #ccc",p:2,m:1},onClick:e},s.createElement(a.Z,{sx:{fontSize:60}}),s.createElement(n.Z,{variant:"subtitle2"},t))},23920:(e,t,i)=>{i.d(t,{U:()=>n});var r=i(56622);const n=(0,i(69430).Z)(r.Z)((e=>({flexDirection:"row"})))},23122:(e,t,i)=>{i.d(t,{P:()=>l,x:()=>h});var r=i(74857),n=i(21092),s=i(32735),a=i(94063);const o=["children","value","currentValue"];function l(e){return{id:`simple-tab-${e}`,"aria-controls":`simple-tabpanel-${e}`}}function h(e){const{children:t,value:i,currentValue:l}=e,h=(0,n.Z)(e,o);return s.createElement("div",(0,r.Z)({role:"tabpanel",hidden:i!==l,id:`simple-tabpanel-${l}`,"aria-labelledby":`simple-tab-${l}`},h),i===l&&s.createElement(a.Z,{sx:{display:"flex",flexWrap:"wrap",height:"100%",padding:1}},t))}},90762:(e,t,i)=>{i.d(t,{Z:()=>s});var r=i(32735),n=i(45709);const s=({title:e,mt:t,tip:i})=>r.createElement(n.Z,{sx:{mr:2,mt:t||0,color:"#424B54",width:60,minWidth:60,fontSize:14,textAlign:"left"},title:i},e)},49867:(e,t,i)=>{i.d(t,{Z:()=>c});var r=i(74857),n=i(21092),s=i(32735),a=i(73764),o=i(90762),l=i(46269);const h=["title","defaultValue","onBlur","id"],c=e=>{let{title:t,defaultValue:i,onBlur:c,id:u}=e,d=(0,n.Z)(e,h);return s.createElement(l.Qj,null,(()=>s.createElement(s.Fragment,null,s.createElement(o.Z,{title:t}),s.createElement(a.Z,(0,r.Z)({id:u||"filled-hidden-label-small",size:"small",variant:"filled",defaultValue:i,onBlur:c,sx:{width:165,border:0},autoComplete:"off",InputProps:{sx:{height:24,borderRadius:1,background:"#F4F4F4",border:0}},inputProps:{sx:{pt:1,height:24}}},d)))))}},33796:(e,t,i)=>{i.d(t,{Z:()=>T});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(61799),l=i.n(o),h=i(26117),c=i.n(h),u=i(5996),d=i.n(u),p=i(20658),f=i.n(p),m=i(3434),_=i.n(m),g=i(97828),y=i.n(g),v=i(93213),b=i(32735),E=i(56622),x=i(46269),C=i(52802);function w(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=l()(r).call(r,(function(t){return c()(e,t).enumerable}))),i.push.apply(i,r)}return i}function S(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?d()(i=w(Object(n),!0)).call(i,(function(t){(0,v.Z)(e,t,n[t])})):f()?_()(e,f()(n)):d()(r=w(Object(n))).call(r,(function(t){y()(e,t,c()(n,t))}))}return e}const T=(0,x.Pi)((({vector:e,sx:t={},onBlur:i,onChange:r,name:n})=>{if(!e)return null;const s=S(S({},t),{},{width:"47%",mt:.5,mr:.5});return b.createElement(E.Z,{direction:"row",alignItems:"center",flexWrap:"wrap"},b.createElement(C.Z,{value:e.x,onBlur:i,name:n,startAdornment:void 0===e.y?"":"x:",sx:s,onChange:e=>r("x",e.target.value,n)}),void 0!==e.y&&b.createElement(C.Z,{value:e.y,onBlur:i,startAdornment:"y:",sx:s,name:n,onChange:e=>r("y",e.target.value,n)}),void 0!==e.z&&b.createElement(C.Z,{value:e.z,onBlur:i,startAdornment:"z:",sx:s,name:n,onChange:e=>r("z",e.target.value,n)}))}))},47107:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(97539),n=i.n(r),s=i(17349),a=i.n(s),o=i(51463),l=i.n(o),h=i(42211),c=i(32735),u=i(2361);h._m.config({paths:{vs:"/static/libs/monaco-editor/vs"}});const d=({updateProperyty:e,onChange:t,getEditor:i,onMount:r,code:s})=>{const o=(0,c.useRef)(null),d=(0,c.useRef)(null);return c.createElement(h.ZP,{onMount:(t,n)=>{i(t),o.current=t,d.current=n,t.addCommand(n.KeyMod.CtrlCmd|n.KeyCode.KeyS,(function(t){e()})),r()},height:"100%",defaultLanguage:"javascript",defaultValue:s??u.fl,options:{minimap:{enabled:!1}},onValidate:e=>{t(l()(e).call(e,(e=>e.message)))},beforeMount:async e=>{const t=e.languages.typescript;t.javascriptDefaults.setCompilerOptions({noLib:!1,allowNonTsExtensions:!0});let i=await fetch("https://hc3dol.gkiiot.com/hc.d.ts").then((e=>e.text()));const r=n()(i).call(i,"declare");i="declare module HC { \n"+a()(i).call(i,r)+"\n}",t.javascriptDefaults.addExtraLib(i,"hc.d.ts")}})}},19957:(e,t,i)=>{i.d(t,{Z:()=>R});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(61799),l=i.n(o),h=i(26117),c=i.n(h),u=i(5996),d=i.n(u),p=i(20658),f=i.n(p),m=i(3434),_=i.n(m),g=i(97828),y=i.n(g),v=i(74857),b=i(93213),E=i(21092),x=i(32735),C=i(78991),w=i(73764),S=i(45709);const T=["value","defaultValue","onChange","onBlur","onFocus","sx","name","editor"];function P(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=l()(r).call(r,(function(t){return c()(e,t).enumerable}))),i.push.apply(i,r)}return i}function A(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?d()(i=P(Object(n),!0)).call(i,(function(t){(0,b.Z)(e,t,n[t])})):f()?_()(e,f()(n)):d()(r=P(Object(n))).call(r,(function(t){y()(e,t,c()(n,t))}))}return e}const R=e=>{let{value:t,defaultValue:i,onChange:r,onBlur:n,onFocus:s,sx:a={},name:o,editor:l=!1}=e,h=(0,E.Z)(e,T);const[c,u]=(0,x.useState)(l);return x.createElement(C.Z,(0,v.Z)({onDoubleClick:()=>{u(!0)},sx:A({minHeight:10,height:"100%",width:100},a)},h),c?x.createElement(w.Z,{sx:{height:24,width:"100%"},defaultValue:i,value:t,inputProps:{sx:{padding:"0 8px"}},onBlur:e=>{u(!1),n?.(e)},onChange:r,autoFocus:!0,onFocus:s,name:o}):x.createElement(S.Z,null,t||i))}},59263:(e,t,i)=>{i.d(t,{l:()=>de,Z:()=>fe});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(61799),l=i.n(o),h=i(26117),c=i.n(h),u=i(20658),d=i.n(u),p=i(3434),f=i.n(p),m=i(97828),_=i.n(m),g=i(93213),y=i(13567),v=i.n(y),b=i(91946),E=i.n(b),x=i(5996),C=i.n(x),w=i(29405),S=i.n(w),T=i(32735),P=i(57055),A=i(30268),R=i(38235),M=i(94063),O=i(54056),I=i(75393),D=i(5212),F=i(56622),L=i(45709),k=i(46269),B=i(83228),N=i(537);const z=()=>{const[e,t]=(0,T.useState)("");return(0,T.useEffect)((()=>{const e=[(0,P.end)(P.CMD.commandManager,P.CMD.commandManager.CommandStart,(e=>{t("\u6267\u884c:"+e)})),(0,P.end)(P.CMD.commandManager,P.CMD.commandManager.CommandEnd,(()=>{(0,N.N)((()=>{t("")}),1e3)}))];return()=>{C()(e).call(e,(e=>e()))}}),[]),T.createElement(M.Z,null,e)};var U=i(31025);const G=()=>{const[e,t]=(0,T.useState)("60");return(0,T.useEffect)((()=>{let e;return(0,U.gx)((()=>!!O.gV.intance),(()=>{e=E()((()=>t(O.gV.intance.Viewer.FPS.toFixed(0))),1e3)})),()=>{e&&clearInterval(e)}}),[O.gV.intance]),T.createElement(L.Z,null,e," fps")},j=({vector:e,process:t})=>{const i=()=>{O.gV.intance.Viewer.sceneControl.debugger({globalRoot:document.getElementById("editor"),overlay:!0})};return T.createElement(k.Qj,null,(()=>T.createElement(F.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{height:30,color:"#ccc",background:"#1d1d1d"}},T.createElement(F.Z,{direction:"row",alignItems:"center",spacing:2,sx:{flex:1}},T.createElement(L.Z,{sx:{ml:2}},"x: ",e.x.toFixed(3)),T.createElement(L.Z,null,"y: ",e.y.toFixed(3)),T.createElement(L.Z,null,"z: ",e.z.toFixed(3))),T.createElement(z,null),T.createElement(F.Z,{direction:"row",alignItems:"center",justifyContent:"flex-end",sx:{flex:1}},t.loading&&T.createElement(M.Z,{sx:{height:10,display:"flex",width:"50%",alignItems:"center"}},T.createElement(L.Z,{sx:{mr:2}},"\u52a0\u8f7d\u8d44\u6e90"),T.createElement(D.Z,{sx:{width:"50%",height:10},variant:"determinate",value:t.value})),T.createElement(G,null),(0,B.SW)()&&T.createElement(I.Z,{size:"small",onClick:i},"\u8c03\u8bd5")))))};var V,Z,W=i(16802),H=i(73231),K=i(29556),q=i(69326),X=i(71722),Y=i.n(X),Q=i(42977);let $=(0,P.Factory)(((Z=class extends P.BaseTextureRecord{constructor(e){super(),this._source=e,this.graphView=void 0,this.hcNode=void 0,this._dataBindings=void 0,this.texture=void 0,this.timer=void 0,this.load=e=>{if(!e)return;const t="object"==typeof e.width?e.width.value:e.width,i="object"==typeof e.height?e.height.value:e.height;this._dataBindings=e.dataBindings;const r=this.graphView.getView();r.style.cssText=`position:fixed;left:0;top:0;width:${t}px;height:${i}px;visibility:hidden`,this.graphView.getCanvas().width=t,this.graphView.getCanvas().height=i,document.body.append(r),this.texture&&this.texture.update(),S()((()=>{r.remove()}),2e3)}}get Texture(){return this.texture||this.update(),this.texture}get Source(){return this._source}set Source(e){e!==this._source&&(this._source=e,this.update())}initTexture(){const e=(0,Q.yD)();let t;return e.addViewListener((e=>{this.timer&&clearTimeout(this.timer),"validate"===e?.kind&&(this.timer=S()((()=>{let e=!1;const i=this.graphView.__htmlOrderList?.[0];if("VIDEO"===i?.nodeName)this.texture?i.src!==this.texture.video.src&&(e=!0,this.texture.updateURL(i.src)):(this.texture=P.Utils.getVideoTexture("video"+v()(),i.src,P.AppStore.MainScene),t(this));else{let r;i&&i instanceof HTMLElement&&(r=i.getElementsByTagName("canvas")[0]),r||(r=this.graphView.getCanvas()),r&&(this.texture?(e=!0,this.texture._canvas=r,this.texture._context=r.getContext("2d")):(this.texture=P.Utils.getCanvasTexture("canvas"+v()(),r,P.AppStore.MainScene),t(this)))}e&&(this.graphView.fitContent(!1,0),this.texture.update())}),100))})),this.graphView=e,new(Y())((e=>{(0,Q.Tt)(this.graphView.dm(),this._source).then((i=>{this.hcNode=i;const r=(0,Q.Er)(i.getImage());this.load(r),t=e}))}))}update(){super.update(),this.graphView}writeFile(e){super.writeFile(e),e.write(1),e.write(this._source)}readFile(e){super.readFile(e),e.read(),this._source=e.read(),this.initTexture()}}).type="HC2DTexture",V=Z))||V;var J=i(73554),ee=i(89122),te=i(93765),ie=i(40652),re=i(6475),ne=i(29115),se=i(19970),ae=i(70995),oe=i(32616),le=i(90546),he=i(84199);function ce(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=l()(r).call(r,(function(t){return c()(e,t).enumerable}))),i.push.apply(i,r)}return i}function ue(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?C()(i=ce(Object(n),!0)).call(i,(function(t){(0,g.Z)(e,t,n[t])})):d()?f()(e,d()(n)):C()(r=ce(Object(n))).call(r,(function(t){_()(e,t,c()(n,t))}))}return e}let de,pe;(0,B.SW)()&&Promise.all([i.e(8739),i.e(4326),i.e(8274),i.e(6471),i.e(8737),i.e(3336),i.e(4480),i.e(1461),i.e(6499),i.e(729),i.e(2338),i.e(4906),i.e(9669),i.e(3919),i.e(5877),i.e(2658),i.e(6133),i.e(9478),i.e(2617),i.e(8166),i.e(7911),i.e(1801),i.e(4637),i.e(7621),i.e(6023),i.e(3018),i.e(2386),i.e(5933),i.e(3714),i.e(8692),i.e(6405),i.e(7011),i.e(4848),i.e(3577),i.e(9560),i.e(6170),i.e(2429),i.e(7695),i.e(5623),i.e(7798),i.e(9057),i.e(103),i.e(6769),i.e(4868),i.e(3991),i.e(5557)]).then(i.t.bind(i,14440,23));const fe=()=>{const e=(0,T.useRef)(null),{fileStore:t}=(0,W.m)(),[i,r]=(0,T.useState)({x:0,y:0,z:0}),[n,s]=(0,T.useState)({open:!1,shop:null}),{dispatch:a,editorState:o}=(0,A._i)(),l=e=>{const t=e.real_type;t!==se.f.Project?(0,ne.qu)(re.ZQ.pull,t===se.f.File?{project_id:te.U.projectId,name:e.product_name+v()(),id:e.real_code}:{pid:-1,name:e.product_name+v()(),id:e.real_code}).then((e=>{e.code===ne.Mx.Ok&&h(t,e?.data?.id)})):J.y.warn("\u9879\u76ee\u7d20\u6750\u4e0d\u652f\u6301\u76f4\u63a5\u5e94\u7528\u5230\u573a\u666f")},h=(e,i)=>{i&&(e===se.f.Model?(i&&(0,ae.D4)(i,de,{position:pe}),J.y.success("\u5e94\u7528\u6a21\u578b\u6210\u529f")):e===se.f.Component?(i&&(0,ae.$)(i,de,{position:pe}),J.y.success("\u5e94\u7528\u6a21\u578b\u6210\u529f")):e===se.f.File&&t.loadFileList().then((e=>{i&&(t.load(i),(0,ae.sA)(i),J.y.success("\u62c9\u53d6\u5e94\u7528\u6210\u529f"))})))},c=(e,i)=>{if(i){if(pe=e,"shop"===i.key){const e=i.shop;return void(e.isBuy?l(e):s({open:!0,shop:e}))}const r={type:i.key,url:i.url,position:e,loading:void 0,complete:void 0,name:i.name};if("particle"===i.key){const e=i.json,t=(0,ee.K)(e);return de.Database.ParticleSystemSpace.append(t),!te.U.particleDisplay&&t.stop(),null}if("background"===i.key){de.Viewer.sceneControl.Skybox=i.url,te.U.BgType=de.Viewer.sceneControl.Mode=P.SkyboxMode.Image,t.setLoadProcess(!0);let e=0,r=10,n=E()((()=>{e+=r,e>=90&&(r=1),e>=98?clearInterval(n):t.setLoadProcess(!0,e)}),1e3);return de.Viewer.sceneControl.LoadObserable.addOnce((e=>{clearInterval(n),t.setLoadProcess(!1)})),null}return i.url&&"ImportEntity"===i.key&&t.setLoadProcess(!0),i.modelId&&t.addUseModel(i.modelId),i?.component&&t.componentIds.add(i.id),"2D"===i.key?u(r):de.create(r)}},u=e=>{let t="";switch(o.render2DType){case"dom":{t="HC2DDom";const i=new q.E(e);if(e.position){const t=de.Viewer.world2screen(e.position);i.Position=t}return i.Name=e.name,de.Database.DomSpace.append(i),i}case"gui":{t="HC2DGui";const i=new K.v(e);if(e.position){const t=de.Viewer.world2screen(e.position);t.x=t.x-de.Viewer.Width/2,t.y=t.y-de.Viewer.Height/2,i.Position=t}return i.Name=e.name,de.SelectEntitys[0]&&i.attachEntity(de.SelectEntitys[0].ObjectId),de.Database.GuiSpace.append(i),i}case"texture":{if(t="HC2DTexture",0===de.SelectEntitys.length)return J.y.warn("\u8bf7\u5148\u9009\u62e9\u8981\u8d34\u7684\u5b9e\u4f53"),null;const i=new $(e.url);return de.Database.TextureTable.append(i),i.initTexture().then((()=>{de.SelectEntitys[0]&&(de.SelectEntitys[0].DiffuseTexture=i.ObjectId)})),null}}return t?(e.type=t,de.create(e)):null},d=()=>{s({open:!1,shop:null})};(0,T.useEffect)((()=>(e.current&&(de=new P.Application({canvas:e.current,editor:!0,debug:(0,B.SW)(),cameraRadius:100}),(0,O.Xf)(de),window.app=de),()=>{de.destory(),t.reset()})),[]),(0,T.useEffect)((()=>{if(!de)return;const e=[de.Editor.selectControl.on((e=>{"select"===e.type&&(e.entitys?.[0]instanceof P.BaseGui?a({type:R.E$,gui:e.entitys?.[0]}):e.entitys?.[0]instanceof P.BaseDom?a({type:R.bn,dom:e.entitys?.[0]}):e.entitys?.[0]instanceof P.Entity?a({type:R.pr,entity:e.entitys?.[0]}):a({type:R.EO}))})),de.Editor.mouseCtrl.on("pointerMove",(e=>{e.worldPoint&&r(e.worldPoint)})),de.Editor.mouseCtrl.on("pointerDown",(e=>{if(J.Q.has("freeCamera")){de.Viewer.cameraManager.Type=P.CameraType.FreeCamera;const t=e.worldPoint;t&&(de.Viewer.cameraManager.Control.Position=t,de.Viewer.cameraManager.Control.Target=ue(ue({},t),{},{z:t.z-10})),J.y.close("freeCamera")}})),de.Editor.mouseCtrl.on("pointerDoubleTap",(e=>{de.Viewer.cameraManager.zoomAll()}))];return()=>{C()(e).call(e,(e=>e()))}}),[a]),(0,T.useEffect)((()=>{if(!de)return;let e;const i=[de.on("update",(t=>{t.target&&(e&&clearTimeout(e),e=S()((()=>{t.target instanceof P.BaseDom?a({type:R.z7}):t.target instanceof P.BaseGui?a({type:R.WB}):t.target?.isLight||a({type:R.Xl})}),100))})),de.on("loading",(e=>{t.setLoadProcess(!0,e.percentage)})),de.on("load",(e=>{e?.error&&J.y.error(e?.target?.Name+"\u52a0\u8f7d\u51fa\u9519",{preventDuplicate:!0}),t.setLoadProcess(!1)})),de.on("error",(e=>{(0,H.lk)(e.error?.stack,"\u53d1\u751f\u9519\u8bef")})),de.on("loadFile",(e=>{a({type:R.EO})})),de.on("newFile",(e=>{a({type:R.EO})})),ie.G.on("Delete-File",(e=>{a({type:R.EO})}))];return()=>{C()(i).call(i,(e=>e()))}}),[a]);const p=e=>{switch(e.code){case P.Utils.KeyCode.Delete:P.CMD.commandManager.ExecCommand(he.d.Delete);break;case P.Utils.KeyCode.KeyA:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),e.preventDefault(),P.CMD.commandManager.ExecCommand(he.d.SelectAll))}},f=e=>{switch(e.code){case P.Utils.KeyCode.KeyZ:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),e.preventDefault(),P.CMD.commandManager.ExecCommand("UNDO"));break;case P.Utils.KeyCode.KeyY:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),e.preventDefault(),P.CMD.commandManager.ExecCommand("REDO"));break;case P.Utils.KeyCode.KeyC:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),P.CMD.commandManager.ExecCommand(he.d.Copy));break;case P.Utils.KeyCode.KeyV:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),P.CMD.commandManager.ExecCommand(he.d.Paste));break;case P.Utils.KeyCode.KeyS:(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),e.preventDefault(),t.save().then((e=>e&&J.y.success("\u4fdd\u5b58\u6210\u529f"))))}};return(0,T.useEffect)((()=>(e.current&&e.current.addEventListener("keydown",f),()=>{e.current&&e.current.removeEventListener("keydown",f)})),[]),(0,T.useEffect)((()=>{if(de)return document.addEventListener("keydown",p),()=>{document.removeEventListener("keydown",p)}}),[]),T.createElement(M.Z,{sx:{flex:1,position:"relative",display:"flex",flexDirection:"column"}},T.createElement("div",{onDrop:e=>{const{offsetX:i,offsetY:r}=e.nativeEvent,n=de.Viewer.screen2World({x:i,y:r}),s=(0,U.ZN)(t.SelectedModels);let a;P.CMD.CommandWrap((()=>{if(s.length<1){const t=e.dataTransfer.getData("text/plain");a=c(n,JSON.parse(t))}else C()(s).call(s,(e=>{a=c(n,e.data)}));a instanceof P.Entity&&(de.Editor.selectControl.SelectEntitys=[a])}),"\u521b\u5efa"),t.SelectedModels=[]},onDragOver:e=>e.preventDefault(),onDragEnd:e=>e.preventDefault(),style:{flex:1,minHeight:0,position:"relative",overflow:"hidden"}},T.createElement("canvas",{style:{outline:"none",width:"100%",height:"100%"},ref:e}),T.createElement("div",{id:"2d"}),de&&de.Viewer.cameraManager.Type!==P.CameraType.ArcRotate&&T.createElement(M.Z,{id:"roamClose",style:{right:"20px",bottom:"0px",position:"absolute",pointerEvents:"none",textAlign:"center"}},T.createElement(M.Z,{style:{color:"#FCFCFC",opacity:.8,marginBottom:"5px"}},"\u9000\u51fa\u6f2b\u6e38"),T.createElement(M.Z,{style:{cursor:"pointer",pointerEvents:"all"},onClick:()=>{de.Viewer.cameraManager.Type=P.CameraType.ArcRotate,document.getElementById("roamClose").style.display="none"}},T.createElement("img",{src:"/static/images/close.png",width:50})))),T.createElement(j,{process:t.loadingEntity,vector:i}),n.open&&T.createElement(oe.Z,{open:n.open,onOk:()=>{(0,ne.qu)(re.ZQ.buy,{productCode:n.shop.product_code}).then((e=>{e.code===ne.Mx.Ok&&(J.y.success("\u5546\u54c1\u8d2d\u4e70\u6210\u529f"),ie.G.trigger({type:"BuySuccess",target:null}),l(n.shop))})),d()},onCancel:d,content:T.createElement(le.Z,{shop:n.shop}),title:"\u60a8\u5373\u5c06\u8d2d\u4e70"}))}},32138:(e,t,i)=>{i.d(t,{Z:()=>c});var r=i(74857),n=i(73764),s=i(46269),a=i(32735),o=i(9742),l=i(83361),h=i(27679);const c=(0,s.Pi)((({onChange:e,widgetValue:t,variables:i,Container:s=a.Fragment,selectProps:c={},onChangeValue:u,bool:d})=>{const p=a.useMemo((()=>(0,h.Uc)(t)),[t.type,t.entityKey]);return a.createElement(s,null,a.createElement(l.Z,(0,r.Z)({options:h.jG,fullWidth:!0,value:p,sx:{my:1},onChange:e},c)),(()=>{switch(t.type){case"value":return d?a.createElement(l.Z,{options:[{label:"\u771f",value:1},{label:"\u5047",value:0}],value:t.value?1:0,onChange:u}):a.createElement(n.Z,{size:"small",label:"\u503c",value:t.value,onChange:u});case"param":return a.createElement(o.D,{value:t.value,variables:i,onChange:u});case"entity":return a.createElement(o.d,{value:t,key:"value",onChange:u});default:return null}})())}))},53189:(e,t,i)=>{i.d(t,{gJ:()=>Re,W1:()=>Ae});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(26117),l=i.n(o),h=i(5996),c=i.n(h),u=i(20658),d=i.n(u),p=i(3434),f=i.n(p),m=i(97828),_=i.n(m),g=i(93213),y=i(51463),v=i.n(y),b=i(52069),E=i.n(b),x=i(61799),C=i.n(x),w=i(57055),S=i(32735),T=i(94063),P=i(65503),A=i(73764),R=i(46269),M=i(9742),O=i(83361),I=i(33796),D=i(67341);let F;!function(e){e[e.Offset=0]="Offset",e[e.To=1]="To"}(F||(F={}));const L=[{label:"\u5230\u8fbe",value:F.To},{label:"\u7ecf\u8fc7",value:F.Offset}],k=(0,R.Pi)((e=>{const t=(0,D.Y)(),i=t.CurrentActionDetail;return S.createElement(T.Z,null,S.createElement(M.d,{value:i}),S.createElement(O.Z,{label:"\u79fb\u52a8",options:L,value:i.type,onChange:e=>{t.updateState((()=>{i[e.target.name]=e.target.value}))},name:"type",sx:{my:1}}),S.createElement(I.Z,{sx:{flex:1},vector:i.target,onChange:(e,r)=>{t.updateState((()=>{i.target[e]=r}))}}),S.createElement(A.Z,{value:i.time,hiddenLabel:!0,variant:"outlined",size:"small",name:"time",onChange:e=>{t.updateState((()=>{i[e.target.name]=e.target.value}))},InputProps:{startAdornment:S.createElement(P.Z,{position:"start"},"\u65f6\u95f4"),endAdornment:S.createElement(P.Z,{position:"start"},"\u6beb\u79d2")}}))}));var B=i(45709),N=i(23920);const z=(0,R.Pi)((()=>{const e=(0,D.Y)();if(!e.CurrentActionDetail)return null;const t=e.CurrentActionDetail,i=i=>{e.updateState((()=>{t[i.target.name]=i.target.value}))},r=i=>{e.updateState((()=>{t[i.target.name]=i.target.value}))};return S.createElement(T.Z,null,S.createElement(M.d,{value:t}),S.createElement(N.U,{sx:{my:2}},S.createElement(O.Z,{options:[{label:"\u9006\u65f6\u9488",value:1},{label:"\u987a\u65f6\u9488",value:0}],value:t.dir,sx:{flex:1},name:"dir",onChange:r}),S.createElement(O.Z,{options:L,value:t.type,name:"type",sx:{flex:1},onChange:r}),S.createElement(A.Z,{hiddenLabel:!0,variant:"outlined",size:"small",value:t.angle,sx:{flex:1},name:"angle",onChange:i,InputProps:{endAdornment:S.createElement(P.Z,{position:"start"},"\u5ea6")}})),S.createElement(A.Z,{value:t.time,hiddenLabel:!0,variant:"outlined",size:"small",label:"\u65f6\u95f4",name:"time",onChange:i,InputProps:{startAdornment:S.createElement(P.Z,{position:"start"},"\u65f6\u95f4"),endAdornment:S.createElement(P.Z,{position:"start"},"\u6beb\u79d2")}}),S.createElement(B.Z,{variant:"subtitle1"},"\u951a\u70b9"),S.createElement(I.Z,{sx:{flex:1},vector:t.pivot,onChange:(i,r)=>{e.updateState((()=>{t.pivot[i]=r}))}}),S.createElement(B.Z,{variant:"subtitle1"},"\u65cb\u8f6c\u8f74"),S.createElement(I.Z,{sx:{flex:1},vector:t.axis,onChange:(i,r)=>{e.updateState((()=>{t.axis[i]=r}))}}))}));var U=i(59548),G=i(32138);const j=(0,R.Pi)((e=>{const t=(0,D.Y)(),{globalVarStore:i}=(0,U.R)(),r=t.CurrentActionDetail;return S.createElement(T.Z,null,S.createElement(M.D,{value:r.key,variables:i.variables}),S.createElement(G.Z,{widgetValue:r.value,onChange:e=>{t.updateState((()=>{r.value.type=e.target.value}))},variables:i.variables,selectProps:{fullWidth:!0,label:"\u8bbe\u7f6e\u4e3a",sx:{my:1}},onChangeValue:e=>{t.updateState((()=>{r.value.value=e.target.value}))}}))}));var V=i(24729),Z=i(31025),W=i(73983);const H=(0,R.Pi)((()=>{const e=(0,D.Y)(),t=e.CurrentActionDetail;return S.createElement(T.Z,null,S.createElement(M.d,{value:t}),S.createElement(B.Z,null,"\u989c\u8272"),S.createElement(W.Z,{color:t.color,onChange:i=>{e.updateState((()=>{t.color=i.hex}))}}))})),K=(0,R.Pi)((()=>{const e=(0,D.Y)();if(!e.CurrentActionDetail)return null;const t=e.CurrentActionDetail;return S.createElement(T.Z,null,S.createElement(A.Z,{variant:"outlined",size:"small",name:"time",label:"\u7b49\u5f85",value:t.time,onChange:i=>[e.updateState((()=>{t.time=i.target.value}))],InputProps:{endAdornment:S.createElement(P.Z,{position:"start"},"\u6beb\u79d2")}}))}));var q=i(58044),X=i.n(q),Y=i(75393),Q=i(67970),$=i(46561),J=i(52015),ee=i(10800),te=i(11528),ie=i(54056),re=i(40334),ne=i(27679),se=i(73443);let ae=0;const oe=[];for(const e of re.h_)for(const t of e.list)oe.push({label:t.label,value:t.type});const le=[];for(const e of re.qF)for(const t of e.list)le.push({label:t.label,value:t.type});const he=(0,R.Pi)((()=>{var e,t;const[i,r]=S.useState(null),n=Boolean(i),s=()=>{r(null)},a=e=>{const t=e.target.getAttribute("data-value"),i=e.target.getAttribute("data-label");o.updateState((()=>{h.triggerNames.push({type:t,label:i,id:ae++})})),s()},o=(0,D.Y)(),l=(0,S.useMemo)((()=>(0,ne.IZ)(!0)),[]),h=o.CurrentActionDetail;return S.createElement(T.Z,null,S.createElement(O.Z,{options:l,onChange:e=>[o.updateState((()=>{const t=e.target.value;h.objectId=ie.gV.intance.Database.getObjectId(Number(t))}))],value:h.objectId?.Index??"0"}),S.createElement($.Z,null,v()(e=h.triggerNames).call(e,((e,t)=>S.createElement(J.ZP,{key:e.id},S.createElement(B.Z,null,e.label),S.createElement(Q.Z,{onClick:()=>(e=>{o.updateState((()=>{var t;X()(t=h.triggerNames).call(t,e,1)}))})(t)},S.createElement(se.Z,null)))))),S.createElement(Y.Z,{onClick:e=>{r(e.currentTarget)}},"\u6dfb\u52a0\u4e8b\u4ef6"),S.createElement(ee.Z,{id:"event-list",MenuListProps:{"aria-labelledby":"long-button"},anchorEl:i,open:n,onClose:s,PaperProps:{style:{maxHeight:450,width:"20ch"}}},v()(t=h.objectId?oe:le).call(t,(e=>S.createElement(te.Z,{key:e.value,onClick:a,"data-value":e.value,"data-label":e.label},e.label)))))}));var ce=i(14549),ue=i.n(ce),de=i(28926),pe=i(90946),fe=i(50215);const me=(0,R.Pi)((()=>{const e=(0,D.Y)(),t=e.CurrentActionDetail;return S.createElement(T.Z,null,S.createElement(M.d,{value:t}),S.createElement(fe.Z,{row:!0,"aria-labelledby":"demo-controlled-radio-buttons-group",name:"bySize",value:t.bySize?"1":"2",onChange:i=>{e.updateState((()=>{t[i.target.name]="1"===i.target.value;const e=t.objectId?.Object;e&&ue()(t.scale,Ae(t.objectId,"1"===i.target.value))}))}},S.createElement(de.Z,{value:"1",control:S.createElement(pe.Z,null),label:"\u6309\u5c3a\u5bf8"}),S.createElement(de.Z,{value:"2",control:S.createElement(pe.Z,null),label:"\u6309\u6bd4\u4f8b"})),S.createElement(I.Z,{sx:{flex:1},vector:t.scale,onChange:(i,r)=>{e.updateState((()=>{t.scale[i]=r}))}}),S.createElement(B.Z,{variant:"subtitle1"},"\u951a\u70b9"),S.createElement(I.Z,{sx:{flex:1},vector:t.pivot,onChange:(i,r)=>{e.updateState((()=>{t.pivot[i]=r}))}}),S.createElement(A.Z,{value:t.time,hiddenLabel:!0,variant:"outlined",size:"small",name:"time",onChange:i=>{e.updateState((()=>{t[i.target.name]=i.target.value}))},InputProps:{startAdornment:S.createElement(P.Z,{position:"start"},"\u65f6\u95f4"),endAdornment:S.createElement(P.Z,{position:"start"},"\u6beb\u79d2")}}))}));var _e=i(56622),ge=i(16802);const ye=(0,R.Pi)((()=>{const e=(0,D.Y)(),{fileStore:t,rootStore:i}=(0,ge.m)(),r=e.CurrentActionDetail,n=t=>{e.updateState((()=>{r[t.target.name]=t.target.value}))},s=()=>S.createElement(O.Z,{options:[{label:"\u65b0\u7a97\u53e3",value:"_blank"},{label:"\u5f53\u524d\u7a97\u53e3",value:"_self"}],label:"\u6253\u5f00\u5728",name:"target",value:r.target??"",onChange:n});return S.createElement(_e.Z,{spacing:2},S.createElement(O.Z,{options:[{label:"\u94fe\u63a5\u5230url",value:"url"},{label:"\u94fe\u63a5\u5230\u573a\u666f",value:"file"},{label:"\u91cd\u65b0\u52a0\u8f7d",value:"reload"},{label:"\u8fd4\u56de\u4e0a\u4e00\u9875",value:"back"}],value:r.type,name:"type",onChange:n}),(()=>{var e;switch(r.type){case"url":return S.createElement(S.Fragment,null,S.createElement(A.Z,{label:"\u8f93\u5165\u8981\u6253\u5f00\u7684\u5730\u5740",name:"value",value:r.value,onChange:n}),S.createElement(s,null));case"file":return S.createElement(S.Fragment,null,S.createElement(O.Z,{options:v()(e=t.fileList).call(e,(e=>({label:e.title,value:e.id}))),label:"\u9009\u62e9\u9875\u9762",value:r.value,name:"value",onChange:n}),S.createElement(s,null));case"reload":case"back":return null}return null})())})),ve=(0,R.Pi)((()=>{const e=(0,D.Y)(),t=e.CurrentActionDetail;return S.createElement(T.Z,null,S.createElement(M.d,{value:t}),S.createElement(fe.Z,{row:!0,onChange:i=>{e.updateState((()=>{t.type=i.target.value}))},value:t.type},S.createElement(de.Z,{value:"Show",control:S.createElement(pe.Z,null),label:"\u663e\u793a"}),S.createElement(de.Z,{value:"Hidden",control:S.createElement(pe.Z,null),label:"\u9690\u85cf"}),S.createElement(de.Z,{value:"Toggle",control:S.createElement(pe.Z,null),label:"\u5207\u6362"})))})),be=(0,R.Pi)((()=>{const e=(0,D.Y)(),t=e.CurrentActionDetail,i=i=>{e.updateState((()=>{t[i.target.name]=i.target.value}))};return S.createElement(T.Z,null,S.createElement(M.d,{value:t}),S.createElement(B.Z,null,"\u4e0d\u900f\u660e\u5ea6"),S.createElement(A.Z,{name:"opacity",value:t.opacity,onChange:i,InputProps:{endAdornment:S.createElement(P.Z,{position:"start"},"%")}}),S.createElement(A.Z,{value:t.time,hiddenLabel:!0,variant:"outlined",size:"small",name:"time",onChange:i,InputProps:{startAdornment:S.createElement(P.Z,{position:"start"},"\u65f6\u95f4"),endAdornment:S.createElement(P.Z,{position:"start"},"\u6beb\u79d2")}}))}));var Ee=i(48155),xe=i(83228);const Ce=(0,R.Pi)((()=>{var e;const t=(0,D.Y)(),[i,r]=(0,S.useState)(!1),n=t.CurrentActionDetail,s=e=>{t.updateState((()=>{n[e.target.name]=e.target.value}))};return S.createElement(T.Z,null,S.createElement(Y.Z,{onClick:e=>{const i=ie.gV.intance.Viewer.cameraManager.Control;t.updateState((()=>{n.alpha=(0,xe.P3)(w.Utils.rad2Deg(i.Alpha),2),n.beta=(0,xe.P3)(w.Utils.rad2Deg(i.Beta),2),n.radius=(0,xe.P3)(i.Radius,2),n.target.x=(0,xe.P3)(i.Target.x,2),n.target.y=(0,xe.P3)(i.Target.y,2),n.target.z=(0,xe.P3)(i.Target.z,2)}))},variant:"contained"},"\u4f7f\u7528\u5f53\u524d\u76f8\u673a\u4f4d\u7f6e"),S.createElement(B.Z,null,"\u76f8\u673a\u76ee\u6807\u4f4d\u7f6e"),v()(e=[{label:"\u6a2a\u5411\u65cb\u8f6c",key:"alpha"},{label:"\u7eb5\u5411\u65cb\u8f6c",key:"beta"},{label:"\u89c2\u5bdf\u534a\u5f84",key:"radius"}]).call(e,(e=>S.createElement(Ee.Z,{label:e.label,name:e.key,key:e.key,value:n[e.key],onChange:s}))),S.createElement(B.Z,null,"\u671d\u5411"),S.createElement(I.Z,{vector:n.target,onChange:(e,i)=>{t.updateState((()=>{n.target[e]=i}))},sx:{flex:1}}),S.createElement(A.Z,{value:n.time,hiddenLabel:!0,variant:"outlined",size:"small",name:"time",onChange:s,InputProps:{startAdornment:S.createElement(P.Z,{position:"start"},"\u65f6\u95f4"),endAdornment:S.createElement(P.Z,{position:"start"},"\u6beb\u79d2")}}))}));var we=i(92513);function Se(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=C()(r).call(r,(function(t){return l()(e,t).enumerable}))),i.push.apply(i,r)}return i}function Te(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?c()(i=Se(Object(n),!0)).call(i,(function(t){(0,g.Z)(e,t,n[t])})):d()?f()(e,d()(n)):c()(r=Se(Object(n))).call(r,(function(t){_()(e,t,l()(n,t))}))}return e}const Pe=e=>e?.Object?.Name??"",Ae=(e,t)=>{const i=e.Object;if(!i)return{x:"x",y:"Y",z:"Z"};if(t){const e=i.BoundingBox.Size;return{x:(2*e.x).toString(),y:(2*e.y).toString(),z:(2*e.z).toString()}}return(0,V.eR)(i.Scale)},Re={[w.Interaction.Move.type]:{detail:S.createElement(k,null),schema:{label:w.Interaction.Move.schema.label},defaultData:e=>({objectId:e,target:{x:"0",y:"0",z:"0"},time:"1000",type:w.MoveType.To}),handleData:e=>v()(e).call(e,(e=>({objectId:e.objectId,time:E()(e.time)/1e3,target:(0,V.l)(e.target),type:e.type,animationType:""}))),loadWidgetData(e){const t=[];for(const i of e.List)t.push({objectId:i.objectId,type:i.type,animationType:i.animationType,time:(1e3*i.time).toString(),target:(0,V.eR)(i.target)});return t},getDesc:e=>{const t=Pe(e.objectId);return t?`${t} ${e.type===w.MoveType.Offset?"\u7ecf\u8fc7":"\u5230\u8fbe"} ${e.target.x},${e.target.y},${e.target.z} \u79fb\u52a8 ${e.time}\u6beb\u79d2`:"\u672a\u9009\u62e9\u5143\u4ef6"}},[w.Interaction.Rotate.type]:{detail:S.createElement(z,null),schema:{label:w.Interaction.Rotate.schema.label},defaultData:e=>({objectId:e,pivot:{x:"0",y:"0",z:"0"},axis:{x:"0",y:"1",z:"0"},time:"1000",type:w.MoveType.To,dir:1,angle:"90"}),handleData:e=>v()(e).call(e,(e=>({objectId:e.objectId,time:E()(e.time)/1e3,angle:w.Utils.deg2rad(E()(e.angle))||0,type:e.type,pivot:Te({},e.pivot),axis:Te({},e.axis),animationType:"",dir:e.dir}))),loadWidgetData(e){const t=[];for(const i of e.List)t.push({objectId:i.objectId,type:i.type,angle:w.Utils.rad2Deg(i.angle).toString(),animationType:i.animationType,time:(1e3*i.time).toString(),pivot:i.pivot,axis:i.axis||{x:"0",y:"1",z:"0"},dir:i.dir});return t},getDesc:e=>Pe(e.objectId)?(e.axis||(e.axis={x:0,y:1,z:0}),`${Pe(e.objectId)} \u7ed5${e.axis?.x},${e.axis?.y},${e.axis?.z},\u57fa\u4e8e\u70b9${e.pivot?.x},${e.pivot?.y},${e.pivot?.z} ${e.type===w.MoveType.Offset?"\u7ecf\u8fc7":"\u5230\u8fbe"} ${e.angle}\xb0 \u65cb\u8f6c ${e.time}\u6beb\u79d2`):"\u672a\u9009\u62e9\u5143\u4ef6"},[w.Interaction.Scale.type]:{detail:S.createElement(me,null),schema:{label:w.Interaction.Scale.schema.label},defaultData:e=>({objectId:e,bySize:!0,scale:Ae(e,!0),pivot:{x:"0",y:"0",z:"0"},time:"1000"}),handleData:e=>v()(e).call(e,(e=>({objectId:e.objectId,bySize:e.bySize,time:E()(e.time)/1e3,scale:Te({},e.scale),pivot:Te({},e.pivot),animationType:""}))),loadWidgetData(e){const t=[];for(const i of e.List)t.push({objectId:i.objectId,type:i.type,bySize:i.bySize,scale:i.scale,pivot:i.pivot,animationType:i.animationType,time:(1e3*i.time).toString()});return t},getDesc:e=>Pe(e.objectId)?`${Pe(e.objectId)} ${e.bySize?"\u6309\u5c3a\u5bf8":"\u6309\u6bd4\u4f8b"}\u57fa\u4e8e\u951a\u70b9${e.pivot.x},${e.pivot.y},${e.pivot.z} \u7f29\u653e\u5230${e.scale.x},${e.scale.y},${e.scale.z} \u7f29\u653e ${e.time}\u6beb\u79d2`:"\u672a\u9009\u62e9\u5143\u4ef6"},[w.Interaction.Select.type]:{detail:null,schema:{label:w.Interaction.Select.schema.label},defaultData:e=>({objectId:e,type:"select"}),loadWidgetData(e){const t=[];for(const i of e.List)t.push({objectId:i.objectId,type:i.type});return t}},[w.Interaction.SetVariable.type]:{detail:S.createElement(j,null),schema:{label:w.Interaction.SetVariable.schema.label},defaultData:e=>({key:e,value:{type:"value",value:""}}),handleData:e=>(0,Z.ZN)(e),loadWidgetData:e=>e.List,getDesc:e=>`${e.key}\u4e3a${e.value.value}`},[w.Interaction.MoveCamera.type]:{detail:S.createElement(Ce,null),schema:{label:w.Interaction.MoveCamera.schema.label},defaultData:null,handleData:e=>{const t=e[0];if(t)return{alpha:t.alpha?w.Utils.deg2rad(E()(t.alpha)):void 0,beta:t.beta?w.Utils.deg2rad(E()(t.beta)):void 0,radius:t.radius?E()(t.radius):void 0,target:t.target?(0,V.l)(t.target):void 0,time:t.time?E()(t.time)/1e3:void 0}},defaultActionData:()=>[{alpha:"180",beta:"0",radius:"100",target:{x:"",y:"",z:""},time:"1000",current:!1}],getDesc:e=>`\u76f8\u673a\u6a2a\u5411\u65cb\u8f6c${e.alpha},\u7eb5\u5411\u65cb\u8f6c${e.beta},\u79fb\u52a8\u8ddd\u79bb${e.radius},\u671d\u5411${e.target.x},${e.target.y},${e.target.z} \u79fb\u52a8 ${e.time}\u6beb\u79d2`,loadWidgetData:e=>[{alpha:w.Utils.rad2Deg(e._alpha),beta:w.Utils.rad2Deg(e._beta),radius:e._radius.toString(),target:(0,V.eR)(e._target),time:e._time,current:!1}]},[w.Interaction.Open.type]:{detail:S.createElement(ye,null),schema:{label:w.Interaction.Open.schema.label},defaultData:null,loadWidgetData:e=>[Te({},e.data)],defaultActionData:()=>[{type:"url",value:"",target:"_blank"}],handleData:e=>{const t=e[0];if(t)return Te({},t)},getDesc:e=>"url"===e.type?e.value?`\u6253\u5f00${e.value}`:"\u672a\u8f93\u5165\u5730\u5740":"\u6253\u5f00\u94fe\u63a5"},[w.Interaction.Highlight.type]:{detail:S.createElement(H,null),schema:{label:w.Interaction.Highlight.schema.label},defaultData:e=>({objectId:e,color:"#ffffff"}),loadWidgetData:e=>e.List,getDesc:e=>`\u9ad8\u4eae${Pe(e.objectId)}\uff0c\u989c\u8272\u4e3a ${e.color}`},[w.Interaction.Display.type]:{detail:S.createElement(ve,null),schema:{label:w.Interaction.Display.schema.label},defaultData:e=>({objectId:e,type:"Show"}),loadWidgetData:e=>e.List,getDesc(e){if(!Pe(e.objectId))return"\u672a\u9009\u62e9\u5143\u4ef6";let t="";return t="Show"===e.type?"\u663e\u793a":"Hidden"===e.type?"\u9690\u85cf":"\u5207\u6362",`${t} ${Pe(e.objectId)}`}},[w.Interaction.Wait.type]:{detail:S.createElement(K,null),schema:{label:w.Interaction.Wait.schema.label},handleData:e=>{const t=e[0];if(t)return{time:E()(t.time)}},defaultActionData:()=>[{time:"1000"}],getDesc:e=>`\u7b49\u5f85${e.time}\u6beb\u79d2`,loadWidgetData:e=>[{time:e._time.toString()}]},[w.Interaction.Dispatch.type]:{detail:S.createElement(he,null),schema:{label:w.Interaction.Dispatch.schema.label},defaultData:e=>({objectId:e,triggerNames:[]}),handleData:e=>v()(e).call(e,(e=>{var t;return{objectId:e.objectId,triggerNames:v()(t=e.triggerNames).call(t,(e=>e.type))}})),getDesc:e=>{var t;const i=C()(t=e.triggerNames).call(t,(e=>!!e));return`\u89e6\u53d1${e.objectId?Pe(e.objectId):"\u9875\u9762"}\u7684${v()(i).call(i,(e=>e.label)).join(",")}\u4e8b\u4ef6`},loadWidgetData(e){var t;return v()(t=e.List).call(t,(e=>{var t;return{objectId:e.objectId,triggerNames:v()(t=e.triggerNames).call(t,(e=>({type:e,label:re.o[e],id:(0,we.F)()})))}}))}},[w.Interaction.Opacity.type]:{detail:S.createElement(be,null),schema:{label:w.Interaction.Opacity.schema.label},defaultData:e=>({objectId:e,opacity:"100",time:"1000",animationType:""}),handleData:e=>v()(e).call(e,(e=>Te(Te({},e),{},{objectId:e.objectId,opacity:e.opacity/100,time:e.time/1e3}))),loadWidgetData(e){const t=[];for(const i of e.List)t.push({objectId:i.objectId,animationType:i.animationType,time:(1e3*i.time).toString(),opacity:(100*i.opacity).toString()});return t},getDesc:e=>Pe(e.objectId)?`\u8bbe\u7f6e${Pe(e.objectId)} \u7684\u900f\u660e\u5ea6\u4e3a${e.opacity}% \u7528\u65f6 ${e.time}\u6beb\u79d2`:"\u672a\u9009\u62e9\u5143\u4ef6"}}},40334:(e,t,i)=>{i.d(t,{S0:()=>o,h_:()=>c,o:()=>l,qF:()=>h});var r,n=i(51463),s=i.n(n),a=i(57055);const o=[{label:"\u94fe\u63a5",list:[{label:a.Interaction.Open.schema.label,type:a.Interaction.Open.type}]},{label:"\u5143\u4ef6",list:[{label:a.Interaction.Move.schema.label,type:a.Interaction.Move.type,target:!0},{label:a.Interaction.Rotate.schema.label,type:a.Interaction.Rotate.type,target:!0},{label:a.Interaction.Scale.schema.label,type:a.Interaction.Scale.type,target:!0},{label:a.Interaction.Display.schema.label,type:a.Interaction.Display.type,target:!0},{label:a.Interaction.Highlight.schema.label,type:a.Interaction.Highlight.type,target:!0},{label:a.Interaction.Opacity.schema.label,type:a.Interaction.Opacity.type,target:!0}]},{label:"\u89c6\u56fe",list:[{label:a.Interaction.MoveCamera.schema.label,type:a.Interaction.MoveCamera.type}]},{label:"\u6570\u636e",list:[{label:a.Interaction.SetVariable.schema.label,type:a.Interaction.SetVariable.type,param:!0}]},{label:"\u5176\u4ed6",list:[{label:a.Interaction.Wait.schema.label,type:a.Interaction.Wait.type},{label:a.Interaction.Dispatch.schema.label,type:a.Interaction.Dispatch.type,target:!0}]}],l={Click:"\u5355\u51fb\u65f6",DoubleClick:"\u53cc\u51fb\u65f6",RightClick:"\u9f20\u6807\u53f3\u51fb\u65f6",KeyDown:"\u6309\u952e\u6309\u4e0b\u65f6",KeyUp:"\u6309\u952e\u677e\u5f00\u65f6",Load:"\u8f7d\u5165\u65f6",DataChange:"\u6570\u636e\u6539\u53d8\u65f6",pointerPick:"\u5355\u51fb\u65f6",pointerDown:"\u9f20\u6807\u6309\u4e0b\u65f6",pointerUp:"\u9f20\u6807\u677e\u5f00\u65f6",pointerMove:"\u9f20\u6807\u79fb\u52a8\u65f6",pointerOver:"\u9f20\u6807\u79fb\u5165\u65f6",pointerOut:"\u9f20\u6807\u79fb\u51fa\u65f6",pointerHover:"\u9f20\u6807\u505c\u653e\u65f6",pointerLongPress:"\u9f20\u6807\u957f\u6309\u65f6",pointerDoubleTap:"\u53cc\u51fb\u65f6"},h=[{label:"\u9f20\u6807",list:[{label:l.Click,type:"Click"},{label:l.DoubleClick,type:"DoubleClick"},{label:l.RightClick,type:"RightClick"}]},{label:"\u952e\u76d8",list:[{label:l.KeyDown,type:"KeyDown"},{label:l.KeyUp,type:"KeyUp"}]},{label:"\u9875\u9762",list:[{label:l.Load,type:"Load"},{label:l.DataChange,type:"Update"}]}],c=[{label:"\u9f20\u6807",list:[...s()(r=["pointerPick","RightClick","pointerDoubleTap","pointerDown","pointerUp","pointerMove","pointerOver","pointerOut","pointerLongPress"]).call(r,(e=>({label:l[e],type:e})))]},{label:"\u5b9e\u4f53",list:[{label:"\u8f7d\u5165\u65f6",type:"Load"}]}]},27679:(e,t,i)=>{i.d(t,{IZ:()=>a,Uc:()=>s,jG:()=>n});var r=i(54056);const n=[{label:"\u503c",value:"value"},{label:"\u53d8\u91cf",value:"param"},{label:"\u7ec4\u4ef6\u6587\u672c",value:"entity"}],s=e=>{const t=[e.type];return e.entityKey&&t.push(e.entityKey),t.join("-")};function a(e=!1){const t=[];e&&t.push({label:"\u9875\u9762",value:"0"});for(const e of r.gV.intance.Database.ModelSpace.Entitys)e.IsErase||t.push({label:e.Name,value:e.Id.toString(),objectId:e.ObjectId});return t}},4675:(e,t,i)=>{i.d(t,{Z:()=>Lr});var r=i(32735),n=i(20246),s=i.n(n),a=i(39831),o=i.n(a),l=i(61799),h=i.n(l),c=i(26117),u=i.n(c),d=i(5996),p=i.n(d),f=i(20658),m=i.n(f),_=i(3434),g=i.n(_),y=i(97828),v=i.n(y),b=i(93213),E=i(6488),x=i.n(E),C=i(32849),w=i.n(C),S=i(11528),T=i(61241),P=i(56622),A=i(3450),R=i(46269),M=i(16802),O=i(17871),I=i(73554),D=i(19853),F=i(74857),L=i(51463),k=i.n(L),B=i(62750),N=i.n(B),z=i(29405),U=i.n(z),G=i(66989),j=i.n(G),V=i(94063),Z=i(96433),W=i(95279),H=i(94010),K=i(45709),q=i(35600),X=i(91946),Y=i.n(X),Q=i(57055),$=i(54056),J=i(89122),ee=i(43553),te=i(5212);const ie=e=>r.createElement(V.Z,{sx:{position:"relative",display:"inline-flex"}},r.createElement(ee.Z,(0,F.Z)({variant:"determinate"},e)),r.createElement(V.Z,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"}},r.createElement(K.Z,{variant:"caption",component:"div",color:"text.secondary"},e.label,`${Math.round(e.value)}%`)));function re(e){return r.createElement(V.Z,{sx:{width:200,height:30,position:"relative"}},r.createElement(te.Z,(0,F.Z)({variant:"determinate"},e)),r.createElement(K.Z,{sx:{position:"absolute",top:3,left:"10%",color:"#FCFCFC"}},e.label))}function ne(e,t){var i=s()(e);if(o()){var r=o()(e);t&&(r=h()(r).call(r,(function(t){return u()(e,t).enumerable}))),i.push.apply(i,r)}return i}function se(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?p()(i=ne(Object(n),!0)).call(i,(function(t){(0,b.Z)(e,t,n[t])})):m()?g()(e,m()(n)):p()(r=ne(Object(n))).call(r,(function(t){v()(e,t,u()(n,t))}))}return e}let ae,oe,le,he,ce,ue,de=!1;const pe=({sx:e={width:"100%",height:"100%"},getViewer:t,data:i})=>{const n=(0,r.useRef)(null),[s,a]=(0,r.useState)({start:!1,value:0}),o=()=>{ue&&clearInterval(ue),a({start:!1,value:0})};return(0,r.useEffect)((()=>(n.current&&(de=!0,ae&&ae.destory(),ae=$.gV.intance.createView(n.current,{defaultLight:!0}),t?.(ae)),()=>{de=!1,U()((()=>{de?de=!1:ae&&ae.destory(),he&&clearTimeout(he),ue&&clearTimeout(ue)}),100)})),[]),(0,r.useEffect)((()=>{ce&&clearTimeout(ce),ce=U()((()=>{(()=>{if(a({start:!0,value:0}),i&&ae){var e,t;if(p()(e=ae.Scene.particleSystems).call(e,(e=>e.dispose())),"particle"===i?.key){const e=i.json;(0,J.K)(e).Intance.start(),a({start:!1,value:0})}if("2D"===i.key)return null;const r=Q.HCFactory.CreateObject(i.key,i);le=r,p()(t=ae.Scene.meshes).call(t,(e=>e.dispose())),r instanceof Q.Entity&&(ue=Y()((()=>{a((e=>{let t=e.value;return t<90?t+=5:t<99&&(t+=1),{start:!0,value:t}}))}),800),ae.sceneControl&&ae.sceneControl.createDefaultEnv(),r.RenderObject,r instanceof Q.Component?r.watchLoad().then((()=>{ae.zoomAll(),ae.cameraManager.ArcRotateControl.Alpha=Math.PI/4,ae.cameraManager.ArcRotateControl.Beta=Math.PI/3,o()})):oe=r.once("load",(()=>{he=U()((()=>{ae.zoomAll(),ae.cameraManager.ArcRotateControl.Alpha=Math.PI/4,ae.cameraManager.ArcRotateControl.Beta=Math.PI/3}),0),o()})))}})()}),100)}),[i]),r.createElement(V.Z,{sx:se(se({},e),{},{position:"relative"})},r.createElement("canvas",{ref:n}),s.start&&r.createElement(V.Z,{sx:{position:"absolute",left:0,right:0,top:0,bottom:0,margin:"auto",width:"50px",height:"50px"}},r.createElement(ie,{value:s.value,label:""})))},fe=(0,r.memo)(pe,((e,t)=>e.data.key===t.data.key&&e.data.url===t.data.url&&e.data.json===t.data.json));var me=i(18442),_e=i(52802);function ge(e,t){var i=s()(e);if(o()){var r=o()(e);t&&(r=h()(r).call(r,(function(t){return u()(e,t).enumerable}))),i.push.apply(i,r)}return i}function ye(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?p()(i=ge(Object(n),!0)).call(i,(function(t){(0,b.Z)(e,t,n[t])})):m()?g()(e,m()(n)):p()(r=ge(Object(n))).call(r,(function(t){v()(e,t,u()(n,t))}))}return e}const ve={width:"100%",textAlign:"center",height:"auto",minHeight:124},be={width:"100%",height:0,paddingTop:"100%",backgroundSize:"100%"},Ee={width:"100%",height:120,backgroundSize:"100%"};let xe;const Ce=({list:e,onContextMenu:t,component:i,componentProps:n,onAddData:s,editorId:a,onChangeEnd:o,onClick:l,loading:h,canPreview:c,PreviewContainer:u="div",onDoubleClick:d,onMouseDown:p,xs:f=6,addTitle:m,selectId:_})=>{const[g,y]=(0,r.useState)(null),[v,b]=(0,r.useState)(null);if(h)return r.createElement(R.Qj,null,(()=>{var e;return r.createElement(W.ZP,{container:!0,flexWrap:"wrap",spacing:1,alignContent:"baseline"},k()(e=N()({length:4})).call(e,((e,t)=>r.createElement(W.ZP,{item:!0,key:t,xs:f},r.createElement(H.Z,{variant:"rectangular",width:"100%",height:100})))))}));const E=()=>{y(null)},x=e=>"background"===e.data.key?Q.AppConfig.Texture_URL+e.preview:$.gV.prefix+e.preview;return r.createElement(R.Qj,null,(()=>r.createElement(r.Fragment,null,r.createElement(W.ZP,{container:!0,flexWrap:"wrap",spacing:1,onContextMenu:t,alignContent:"baseline"},s&&r.createElement(W.ZP,{item:!0,xs:f},r.createElement(V.Z,{component:i||"div",sx:ye(ye({},ve),{},{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",border:"2px dashed #ccc",boxShadow:"none"}),onClick:s},r.createElement(Z.Z,{component:"img",src:D.q$+"space.png",sx:{width:"50%"}}),m&&r.createElement(K.Z,{sx:{color:"#69aaff"}},m))),k()(e).call(e,(e=>r.createElement(W.ZP,{item:!0,xs:f,key:e.id},r.createElement(V.Z,(0,F.Z)({component:i||"div",data:e.data?j()(e.data):void 0,sx:_===e.id?ye(ye({},ve),{},{border:"1px solid #399ad7",boxShadow:"none",color:"#399ad7"}):ve},n?n(e):{},{onClick:t=>((e,t)=>{if(a)return;const i=e.currentTarget;xe&&clearTimeout(xe),xe=U()((()=>{!c||e.ctrlKey||e.metaKey||(y(i),b(t)),l?.(t)}),d&&(l||c)?200:0)})(t,e),onDoubleClick:()=>{return t=e,xe&&clearTimeout(xe),void d?.(t);var t},onMouseDown:t=>((e,t)=>{p?.(e,t)})(e,t),draggable:!a}),e.preview?r.createElement(Z.Z,{image:x(e),sx:12===f?Ee:be}):r.createElement(q.Z,{sx:{fontSize:80}}),a===e.id?r.createElement(_e.Z,{size:"small",defaultValue:e.title,onBlur:o,InputProps:{sx:{height:30}},autoFocus:!0}):r.createElement(K.Z,{title:e.title,variant:_===e.id?"h6":"subtitle1",sx:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},e.title)))))),c&&r.createElement(me.Z,{open:Boolean(g),anchorEl:g,onClose:E,anchorOrigin:{vertical:"bottom",horizontal:"right"},onContextMenu:e=>{e.stopPropagation(),e.preventDefault()}},r.createElement(V.Z,{component:u,sx:{p:1,width:300,height:300}},r.createElement(fe,{data:v?.data}))))))};var we=i(75393),Se=i(86191),Te=i(37211),Pe=i(58181),Ae=i(28926),Re=i(68867),Me=i(57426),Oe=i(6475),Ie=i(93765),De=i(29115),Fe=i(39829);const Le=({onClose:e,open:t,target:i})=>{const{fileStore:n}=(0,M.m)(),[s,a]=r.useState({page:1,limit:20,project_type:"3d"}),[o,l]=r.useState(!1),[h,c]=r.useState([]),[u,d]=r.useState(null);return r.useEffect((()=>{(async()=>{const e=await(0,De.ZL)(Oe.U.list,{params:s});e.code===De.Mx.Ok?c(e.data.list):c([])})()}),[s]),r.createElement(Re.Z,{onClose:e,open:t},r.createElement(Me.Z,null,"\u79fb\u52a8\u5230"),r.createElement(Pe.Z,null,r.createElement(K.Z,null,"\u9879\u76ee"),r.createElement(Fe.Z,{onClick:e=>{d(e)},disableId:Ie.U.projectId,selectId:u}),r.createElement(Ae.Z,{label:"\u521b\u5efa\u5e76\u79fb\u52a8\u526f\u672c",checked:o,control:r.createElement(Se.Z,null),onChange:(e,t)=>l(t)})),r.createElement(Te.Z,null,r.createElement(we.Z,{variant:"contained",onClick:async()=>{if(!u)return;e();await n.move(u,i,o)&&(I.y.success("\u5e94\u7528\u79fb\u52a8\u6210\u529f"),o||n.loadFileList())}},"\u786e\u5b9a"),r.createElement(we.Z,{color:"secondary",variant:"contained",onClick:e},"\u53d6\u6d88")))};var ke=i(50717),Be=i(25661),Ne=i(19970),ze=i(54671),Ue=i(537);function Ge(e,t){var i=s()(e);if(o()){var r=o()(e);t&&(r=h()(r).call(r,(function(t){return u()(e,t).enumerable}))),i.push.apply(i,r)}return i}function je(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?p()(i=Ge(Object(n),!0)).call(i,(function(t){(0,b.Z)(e,t,n[t])})):m()?g()(e,m()(n)):p()(r=Ge(Object(n))).call(r,(function(t){v()(e,t,u()(n,t))}))}return e}const Ve=(0,A.ZP)(T.Z)((({theme:e})=>je(je({},e.typography.body2),{},{height:100,textAlign:"center",width:"100%",color:e.palette.text.secondary,cursor:"pointer"}))),Ze=(0,R.Pi)((()=>{var e;const[t,i]=(0,r.useState)(""),{fileStore:n}=(0,M.m)(),[s,a]=(0,r.useState)(!1),[o,l]=(0,r.useState)(!1),[h,c]=(0,r.useState)(!1),[u,d,p]=(0,O.Z)((e=>{const t=m(e.target);n.SelectFile=t?{id:t[0],name:t[1]}:{id:0,name:""}})),f=()=>{n.openModal(),d()};(0,r.useEffect)((()=>{(0,Ue.N)((()=>{n.loadFileList(t)}),500)}),[t]);const m=e=>{let t=e.getAttribute("data-id"),i=e.getAttribute("data-name");if(t)return[Number(t),i];for(;e&&!e.hasAttribute("data-id");)if("leftPanel"===(e=e.parentElement).id)return null;return t=e.getAttribute("data-id"),i=e.getAttribute("data-name"),t?[Number(t),i]:void 0},_=()=>{a(!0)},g=()=>{l(!0)};return r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(P.Z,{flexDirection:"row",sx:{height:"28px"}},r.createElement(ze.Z,{value:t,onChange:e=>{i(e.target.value)},placeholder:"\u641c\u7d22\u573a\u666f",sx:{flex:1}})),r.createElement(Ce,{list:n.fileList,component:Ve,onContextMenu:u,onAddData:()=>{n.SelectFile={id:0,name:""},f()},onDoubleClick:e=>(e=>{if(e===n.currentFileId)return;n.setLoadProcess(!1),n.load(e);const t=(0,D.GW)(location.href,"id",e.toString());history.replaceState({path:t},"",t),I.y.success("\u52a0\u8f7d\u6210\u529f",{preventDuplicate:!0})})(e.id),selectId:n.currentFileId,componentProps:e=>({elevation:n.getIsSelect(e.id)?5:0,"data-id":e.id,"data-name":e.title}),loading:n.loading,xs:12,addTitle:"\u65b0\u5efa\u573a\u666f"})),!!n.selectFile.id&&r.createElement(p,null,r.createElement(S.Z,{onClick:f},"\u91cd\u547d\u540d"),r.createElement(S.Z,{onClick:()=>{d();const e=(()=>{const e=new(x())(location.search);return e.set("id",n.selectFile.id.toString()),e.toString()})();window.open("/preview.html?"+e,"_blank")}},"\u9884\u89c8"),r.createElement(S.Z,{onClick:async()=>{d();await n.copy(n.selectFile.id)&&n.loadFileList()}},"\u62f7\u8d1d"),r.createElement(S.Z,{onClick:()=>{_(),d()}},"\u79fb\u52a8"),r.createElement(S.Z,{onClick:()=>{d(),g()}},"\u5206\u4eab"),r.createElement(S.Z,{onClick:()=>{d(),c(!0)}},"\u53d1\u5e03"),r.createElement(S.Z,{onClick:()=>{n.selectFile.id&&n.deleteFile(n.selectFile.id),d()}},"\u5220\u9664")),s&&r.createElement(Le,{target:n.selectFile.id,open:s,onClose:()=>{a(!1)}}),o&&r.createElement(ke.Z,{target:n.selectFile.id,open:o,onClose:()=>{l(!1)}}),h&&r.createElement(Be.Z,{target:n.selectFile.id,onClose:()=>{c(!1)},type:"app",category:Ne.f.File,targetObj:w()(e=n.fileList).call(e,(e=>e.id===n.selectFile.id))}))}));var We=i(43966),He=i(39282),Ke=i.n(He),qe=i(27566),Xe=i.n(qe),Ye=i(12625),Qe=i.n(Ye),$e=i(38591),Je=i(25783),et=i(1193),tt=i(90946),it=i(50215),rt=i(36717),nt=i(26095),st=i(30268),at=i(38235),ot=i(37394),lt=i(37360),ht=i(68242),ct=i(32690),ut=i(31763);const dt=({children:e,target:t,onExpand:i,open:n,title:s,editor:a,onBlur:o,select:l})=>{const h=(0,r.useRef)(null);return(0,r.useEffect)((()=>{h.current&&a&&U()((()=>{h.current.focus()}),0)}),[a]),r.createElement(r.Fragment,null,r.createElement(ot.Z,{onMouseDown:e=>{i(t,e)},sx:l?{background:"#ebf2fa",color:" #0084FF",height:32,border:"1px solid #0084FF",mt:1}:{background:"#FCFCFC",color:"#666",height:32,border:"1px solid #F8F8F8;",mt:1}},a?r.createElement(_e.Z,{inputRef:h,defaultValue:s,size:"small",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onBlur:o}):r.createElement(r.Fragment,null,r.createElement(lt.Z,{primary:s}),n?r.createElement(ct.Z,null):r.createElement(ut.Z,null))),r.createElement(ht.Z,{in:n,timeout:"auto",unmountOnExit:!0},e))};var pt=i(21092),ft=i(13697);const mt=["children","data","sx","onDoubleClick","draggable"];function _t(e,t){var i=s()(e);if(o()){var r=o()(e);t&&(r=h()(r).call(r,(function(t){return u()(e,t).enumerable}))),i.push.apply(i,r)}return i}function gt(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?p()(i=_t(Object(n),!0)).call(i,(function(t){(0,b.Z)(e,t,n[t])})):m()?g()(e,m()(n)):p()(r=_t(Object(n))).call(r,(function(t){v()(e,t,u()(n,t))}))}return e}const yt=e=>{let{children:t,data:i,sx:n={},onDoubleClick:s,draggable:a}=e,o=(0,pt.Z)(e,mt);return n=gt(gt({},n),{},{cursor:"pointer"}),r.createElement(ft.Z,(0,F.Z)({"data-data":i,onDragStart:e=>{const t=e.currentTarget.getAttribute("data-data");e.dataTransfer.setData("text/plain",t)},sx:n,draggable:void 0===a||a,onDoubleClick:s},o),t)};var vt=i(23122);const bt=[{value:0,label:"\u56fe\u6807"},{value:1,label:"\u8bbe\u8ba1"}],Et=()=>{const{editorState:e,dispatch:t}=(0,st._i)(),[i,n]=(0,r.useState)(!1),[s,a]=(0,r.useState)([]),[o,l]=(0,r.useState)(""),[h,c]=(0,r.useState)(new(Ke())),[u,d]=(0,r.useState)(null),[p,f]=(0,r.useState)(0),m=async(e,t)=>{t.stopPropagation(),0===t.button&&(h.has(e)?h.delete(e):(h.add(e),g(e)),c(new(Ke())(h))),d(e)},_=async(e=0,t)=>0===p?await(0,De.ZL)(Oe.au.publicList,{params:{pid:e,source_type:"unsymbol",status:1,name:t}}):await(0,De.ZL)(Oe.au.list,{params:{source_type:"symbol",pid:e,status:1}}),g=async(e,t=s)=>{Xe()(e)||(e=[e]);const i=new(Qe());for(const t of e){const e=await _(t);e.code===De.Mx.Ok&&e.data&&i.set(t,e.data)}for(const e of t)if(i.has(e.id)){var r;e.children=k()(r=i.get(e.id)).call(r,(e=>({title:e.name.split(".")[0]??e.file_key,data:{key:"2D",url:(0,D.qm)(e),name:e.name.split(".")[0]??e.file_key,modelId:e.uuid},preview:(0,D.qm)(e,!0),id:e.id})));break}a([...t])};return(0,r.useEffect)((()=>{(async()=>{n(!0);const e=await _(0,o);if(e.code===De.Mx.Ok&&e.data){const t=e.data;g(N()(h),t)}else a([]);n(!1)})()}),[p,o]),r.createElement(r.Fragment,null,r.createElement(nt.Z,{sx:{height:"50px",width:"100%"},value:p,indicatorColor:"secondary",textColor:"inherit",onChange:(e,t)=>{f(t)},variant:"fullWidth"},k()(bt).call(bt,(e=>r.createElement(rt.Z,(0,F.Z)({key:e.value,label:e.label,value:e.value},(0,vt.P)(e.value)))))),r.createElement(P.Z,{sx:{height:"calc(100% - 50px)"}},r.createElement(P.Z,{flexDirection:"row",sx:{height:50}},r.createElement(ze.Z,{value:o,onChange:e=>{l(e.target.value)},placeholder:"\u641c\u7d22\u56fe\u6807",sx:{flex:1}})),r.createElement(V.Z,{sx:{flex:1,overflow:"auto"}},k()(s).call(s,(e=>"dir"===e.node_type&&r.createElement(dt,{title:e.name,open:h.has(e.id),onExpand:m,target:e.id,key:e.id,select:e.id===u},r.createElement(Ce,{list:e.children??[],component:yt,componentProps:e=>({"data-nodeid":e.id,"data-nodetype":"file"}),canPreview:!0}))))),r.createElement(Je.Z,{sx:{height:60}},r.createElement(et.Z,null,"\u56fe\u6807\u7c7b\u578b"),r.createElement(it.Z,{"aria-labelledby":"\u56fe\u6807\u7c7b\u578b",value:e.render2DType,row:!0,onChange:(e,i)=>{t({type:at.NE,render2DType:i})},sx:{"&>label":{mr:"8px"}}},r.createElement(Ae.Z,{value:"dom",control:r.createElement(tt.Z,null),label:"\u56fe\u6807"}),r.createElement(Ae.Z,{value:"gui",control:r.createElement(tt.Z,null),label:"\u6807\u6ce8"})))),r.createElement($e.Z,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:i,onClick:()=>n(!1)},r.createElement(ee.Z,{color:"inherit"})))};var xt=i(89487),Ct=i(97539),wt=i.n(Ct),St=i(58044),Tt=i.n(St),Pt=i(20151),At=i(73764),Rt=i(83228),Mt=i(6512),Ot=i(83361),It=i(23920),Dt=i(59263),Ft=i(9456),Lt=i.n(Ft),kt=i(45285),Bt=i.n(kt),Nt=i(52069),zt=i.n(Nt),Ut=i(95719),Gt=i.n(Ut),jt=i(76373),Vt=i(46561),Zt=i(52015),Wt=i(24729),Ht=i(73983);const Kt={sx:{height:24,borderRadius:1,background:"#F4F4F4",border:0,width:80}},qt=({range:e,onChange:t,name:i})=>r.createElement(It.U,null,r.createElement(At.Z,{size:"small",value:e?.min,InputProps:Kt,onChange:e=>t("min",e.target.value,i)}),"~",r.createElement(At.Z,{size:"small",value:e?.max,InputProps:Kt,onChange:e=>t("max",e.target.value,i)}));var Xt=i(90762),Yt=i(49867),Qt=i(33796),$t=i(45608),Jt=i(48460),ei=i(67970),ti=i(73443);function ii(e,t){var i=s()(e);if(o()){var r=o()(e);t&&(r=h()(r).call(r,(function(t){return u()(e,t).enumerable}))),i.push.apply(i,r)}return i}function ri(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?p()(i=ii(Object(n),!0)).call(i,(function(t){(0,b.Z)(e,t,n[t])})):m()?g()(e,m()(n)):p()(r=ii(Object(n))).call(r,(function(t){v()(e,t,u()(n,t))}))}return e}const ni=({gradient:e,onChange:t,onDelete:i})=>{const n=(i,r)=>{const n=ri({},e);"min"===i?n.value=r:n.otherValue=r,t(n)},s=(i,r)=>{const n=ri({},e);let s=i.hex;if(i.rgb){s=Q.Utils.Color4.FromArray([i.rgb.r/255,i.rgb.g/255,i.rgb.b/255,i.rgb.a]).toHexString()}n[r]=s,t(n)};return r.createElement(It.U,{alignItems:"center"},r.createElement(K.Z,{sx:{mr:"2%"}},"\u6e10\u53d8\u8303\u56f4:"),(()=>{switch(e.key){case"Size":return r.createElement(qt,{range:{min:e.value,max:e.otherValue},onChange:n});case"Color":return r.createElement(It.U,null,r.createElement(Ht.Z,{value:e.value,color:(0,Rt.HY)(e.value),onChange:e=>s(e,"value")}),r.createElement(Ht.Z,{value:e.otherValue,color:(0,Rt.HY)(e.otherValue),onChange:e=>s(e,"otherValue")}))}})(),r.createElement(It.U,{alignItems:"center",sx:{width:"50%",ml:"2%"}},r.createElement(K.Z,{sx:{mr:"5%"}},"\u751f\u547d\u5468\u671f:"),r.createElement(K.Z,null,"0"),r.createElement(Jt.ZP,{size:"small","aria-label":"Small",min:0,max:1,step:.01,sx:{width:"50%",mx:"2%"},valueLabelDisplay:"auto",value:e.period,onChange:(i,r)=>{t(ri(ri({},e),{},{period:r}))}}),r.createElement(K.Z,null,"1"),r.createElement(ei.Z,{onClick:i},r.createElement(ti.Z,null))))};var si=i(10728);function ai(e,t){var i=s()(e);if(o()){var r=o()(e);t&&(r=h()(r).call(r,(function(t){return u()(e,t).enumerable}))),i.push.apply(i,r)}return i}function oi(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?p()(i=ai(Object(n),!0)).call(i,(function(t){(0,b.Z)(e,t,n[t])})):m()?g()(e,m()(n)):p()(r=ai(Object(n))).call(r,(function(t){v()(e,t,u()(n,t))}))}return e}let li=!1,hi=0;const ci=({pcs:e,sx:t,isSub:i=!1})=>{var n,a,o,l,h;const[c,u]=(0,r.useState)({}),[d,p]=(0,r.useState)(new(Ke())(["basic"])),[f,m]=(0,r.useState)(!1),[_,g]=(0,r.useState)(null),y=()=>{m(!f)},v=()=>{var t;li=!0,Lt()(t=e.SubParticleSystems).call(t,(e=>{var t;return Bt()(t=c.SubParticleSystems).call(t,(t=>t===e))}))?e.start():e.SubParticleSystems=[...c.SubParticleSystems]},b=(t,i,r)=>{const n=oi(oi({},c),{},{[r]:oi(oi({},c[r]),{},{[t]:i})});u(n),i&&(0,Ue.N)((()=>{e[r]="AngularSpeed"===r?(0,Wt.QT)(n[r],Q.Utils.deg2rad):(0,Wt.QT)(n[r])}))},E=(e,t,i)=>{u(oi(oi({},c),{},{[i]:oi(oi({},c[i]),{},{[e]:t})}))},x=t=>{const i=t.target.name;e[i]=(0,Wt.l)(c[i])},C=e=>{const t=e.target.name.split(".");if(1===t.length)u(oi(oi({},c),{},{[t[0]]:e.target.value}));else if(2===t.length){const i=t[0],r=t[1];u(oi(oi({},c),{},{[i]:oi(oi({},c[i]),{},{[r]:e.target.value})}))}},S=t=>{const i=t.target.name,r=t.target.value;e[i]=r,u(oi(oi({},c),{},"EmiterShape"===i?{[i]:r,Emiter:e.Emiter?e.Emiter.toJSON():{}}:{[i]:r}))},T=(t,i)=>{let r=t.hex;if(t.rgb){const e=Q.Utils.Color4.FromArray([t.rgb.r/255,t.rgb.g/255,t.rgb.b/255,t.rgb.a]);r=e.toHexString()}u(oi(oi({},c),{},{[i]:r})),(0,Ue.N)((()=>{e[i]=r}))},P=t=>{const i=t.target.name.split("."),r=i[0],n=i[1];let s=t.target.value,a=e[r];if(n&&(a=a[n]),r in e&&"number"==typeof a){if(!s)return;s=zt()(s)}n?"Emiter"===r?e.Emiter[n]=s:e[r]=oi(oi({},e[r]),{},{[n]:s}):e[r]=s},A=t=>{const i=t.target.name.split("."),r=t.target.checked;1===i.length?(u(oi(oi({},c),{},{[i[0]]:r})),e[i[0]]=r):2===i.length&&(u(oi(oi({},c),{},{[i[0]]:oi(oi({},c[i[0]]),{},{[i[1]]:r})})),e[i[0]]=(0,Wt.QT)(oi(oi({},c[i[0]]),{},{[i[1]]:r})))},R=e=>{d.has(e)?d.delete(e):d.add(e),p(new(Ke())(d))},M=e=>{const t=Q.Utils.Color4.FromHexString(e);return{r:255*t.r,g:255*t.g,b:255*t.b,a:t.a}},O=e=>k()(e).call(e,(e=>({key:e.key,value:Number(e.value)||0,otherValue:Number(e.otherValue)||void 0,period:Number(e.period)||0}))),I=(t,i)=>{const r=[...c.Gradients];r[i]=t,u(oi(oi({},c),{},{Gradients:r})),(0,Ue.N)((()=>{e.Gradients=O(r)}))},D=(t,i)=>{const r=[...c.Gradients];r[i]=t,u(oi(oi({},c),{},{Gradients:r})),(0,Ue.N)((()=>{e.Gradients=r}))};return(0,r.useEffect)((()=>{(e=>{var t;e&&u({Name:e.Name,Capacity:e.Capacity,Rate:e.Rate,Color1:e.Color1,Color2:e.Color2,ColorDead:e.ColorDead,Image:e.Image,EmiterPosition:e.EmiterPosition,Pivot:e.Pivot,EmiterType:e.EmiterType,EmiterShape:e.EmiterShape,Size:e.Size,Scale:e.Scale,LifeTime:e.LifeTime,TargetStopDuration:e.TargetStopDuration,SpriteOption:e.SpriteOption,AngularSpeed:(0,Wt.eR)(e.AngularSpeed,(e=>Q.Utils.rad2Deg(e).toString())),MinEmitBox:e.MinEmitBox,MaxEmitBox:e.MaxEmitBox,Direction1:e.Direction1,Direction2:e.Direction2,Gravity:e.Gravity,EmitPower:e.EmitPower,BlendMode:e.BlendMode,UpdateSpeed:e.UpdateSpeed,SubParticleSystems:e.SubParticleSystems,ManualEmitCount:e.ManualEmitCount,Emiter:e.Emiter?e.Emiter.toJSON():{},Gradients:k()(t=e.Gradients).call(t,(e=>oi(oi({},e),{},{id:hi++})))})})(e)}),[e]),r.createElement(V.Z,{sx:t},0!==s()(c).length&&r.createElement(Vt.Z,{sx:{height:"100%",overflow:"auto"}},r.createElement(dt,{title:"\u57fa\u7840",open:d.has("basic"),onExpand:R,target:"basic"},r.createElement(Vt.Z,{component:"div",disablePadding:!0},r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u540d\u79f0",value:c.Name,name:"Name",onChange:C,onBlur:P})),r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u7c92\u5b50\u56fe\u7247",value:c.Image,name:"Image",onChange:C,onBlur:P})),r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u7c92\u5b50\u6570\u91cf",value:c.Capacity,name:"Capacity",onChange:C,onBlur:P})),r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u66f4\u65b0\u901f\u5ea6",value:c.UpdateSpeed,name:"UpdateSpeed",onChange:C,onBlur:P})),r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u6df7\u5408\u6a21\u5f0f"}),r.createElement(Ot.Z,{value:c.BlendMode,options:[{label:"\u9ed8\u8ba4",value:0},{label:"STANDARD",value:1},{label:"ADD",value:2},{label:"MULTIPLY",value:3},{label:"MULTIPLYADD",value:4}],name:"BlendMode",onChange:S})),r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u91cd\u529b"}),r.createElement(Qt.Z,{onChange:E,onBlur:x,vector:c.Gravity,name:"Gravity"})),r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u7c92\u5b50\u951a\u70b9"}),r.createElement(Qt.Z,{onChange:E,onBlur:x,vector:c.Pivot,name:"Pivot"})),r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u5355\u6b21\u7c92\u5b50\u6570",value:c.ManualEmitCount,name:"ManualEmitCount",onChange:C,onBlur:P})))),r.createElement(dt,{title:"\u7c92\u5b50\u989c\u8272\u5c5e\u6027",open:d.has("color"),onExpand:R,target:"color"},r.createElement(Vt.Z,{component:"div",disablePadding:!0},!w()(n=c.Gradients).call(n,(e=>"Color"===e.key))&&r.createElement(r.Fragment,null,r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u7c92\u5b50\u989c\u82721"}),r.createElement(Ht.Z,{value:c.Color1,color:M(c.Color1),onChange:e=>T(e,"Color1")})),r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u7c92\u5b50\u989c\u82722"}),r.createElement(Ht.Z,{value:c.Color2,color:M(c.Color2),onChange:e=>T(e,"Color2")})),r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u7c92\u5b50\u6d88\u5931\u989c\u8272"}),r.createElement(Ht.Z,{value:c.ColorDead,color:M(c.ColorDead),onChange:e=>T(e,"ColorDead")}))),k()(a=c.Gradients).call(a,((t,i)=>"Color"===t.key&&r.createElement(ni,{onChange:e=>D(e,i),gradient:t,key:t.id,onDelete:()=>(t=>{const i=[...c.Gradients],r=Gt()(i).call(i,(e=>e.id===t));Tt()(i).call(i,r,1),u(oi(oi({},c),{},{Gradients:i})),e.removeGradient(r)})(t.id)}))))),r.createElement(dt,{title:"\u53d1\u5c04\u5668\u5c5e\u6027",open:d.has("emiter"),onExpand:R,target:"emiter"},r.createElement(Vt.Z,{component:"div",disablePadding:!0},r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u53d1\u5c04\u4f4d\u7f6e\u7c7b\u578b"}),r.createElement(Ot.Z,{value:c.EmiterType,options:[{label:"\u70b9",value:Q.EmiterType.Point},{label:"\u5b9e\u4f53",value:Q.EmiterType.Entity},{label:"\u76f8\u673a",value:Q.EmiterType.Camera}],name:"EmiterType",onChange:S})),c.EmiterType===Q.EmiterType.Point&&r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u53d1\u5c04\u4f4d\u7f6e"}),r.createElement(Qt.Z,{onChange:E,onBlur:x,vector:c.EmiterPosition,name:"EmiterPosition"})),r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u53d1\u5c04\u5f62\u72b6"}),r.createElement(Ot.Z,{value:c.EmiterShape,options:[{label:"\u70b9",value:Q.EmiterShape.Point},{label:"\u76d2\u5b50",value:Q.EmiterShape.Box},{label:"\u7403",value:Q.EmiterShape.Sphere},{label:"\u534a\u7403",value:Q.EmiterShape.Hemisphere},{label:"\u9525\u5f62",value:Q.EmiterShape.Cone},{label:"\u5706\u67f1",value:Q.EmiterShape.Cylinder},{label:"\u65b9\u5411\u5706\u67f1",value:Q.EmiterShape.DirctedCylinder}],name:"EmiterShape",onChange:S})),c.EmiterShape===Q.EmiterShape.Box&&r.createElement(r.Fragment,null,r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u53d1\u5c04\u5668\u6700\u5c0f\u70b9"}),r.createElement(Qt.Z,{onChange:E,onBlur:x,vector:c.MinEmitBox,name:"MinEmitBox"})),r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u53d1\u5c04\u5668\u6700\u5927\u70b9"}),r.createElement(Qt.Z,{onChange:E,onBlur:x,vector:c.MaxEmitBox,name:"MaxEmitBox"}))),(c.EmiterShape===Q.EmiterShape.Box||c.EmiterShape===Q.EmiterShape.Point)&&r.createElement(r.Fragment,null,r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u53d1\u5c04\u65b9\u54111"}),r.createElement(Qt.Z,{onChange:E,onBlur:x,vector:c.Direction1,name:"Direction1"})),r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u53d1\u5c04\u65b9\u54112"}),r.createElement(Qt.Z,{onChange:E,onBlur:x,vector:c.Direction2,name:"Direction2"}))),c.EmiterShape===Q.EmiterShape.Sphere&&r.createElement(r.Fragment,null,r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u53d1\u5c04\u534a\u5f84",value:c.Emiter.Radius,name:"Emiter.Radius",onChange:C,onBlur:P})),r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u53d1\u5c04\u7403\u8303\u56f4",value:c.Emiter.RadiusRange,name:"Emiter.RadiusRange",onChange:C,onBlur:P}))))),r.createElement(dt,{title:"\u53d1\u5c04\u5c5e\u6027",open:d.has("emission"),onExpand:R,target:"emission"},r.createElement(Vt.Z,{component:"div",disablePadding:!0},r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u7c92\u5b50\u53d1\u5c04\u6570\u91cf",value:c.Rate,name:"Rate",onChange:C,onBlur:P})),r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u53d1\u5c04\u901f\u5ea6\u8303\u56f4"}),r.createElement(qt,{range:c.EmitPower,onChange:b,name:"EmitPower"})))),r.createElement(dt,{title:"\u7c92\u5b50\u5c3a\u5bf8",open:d.has("size"),onExpand:R,target:"size"},r.createElement(Vt.Z,{component:"div",disablePadding:!0},!w()(o=c.Gradients).call(o,(e=>"Size"===e.key))&&r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u7c92\u5b50\u5c3a\u5bf8\u8303\u56f4"}),r.createElement(qt,{range:c.Size,onChange:b,name:"Size"})),r.createElement(ot.Z,{onClick:()=>{const t=[...c.Gradients,{key:"Size",period:0===c.Gradients.length?0:1,value:1,otherValue:1,id:hi++}];u(oi(oi({},c),{},{Gradients:t})),e.Gradients=O(t)}},r.createElement(lt.Z,{primary:"\u6dfb\u52a0\u5c3a\u5bf8\u6e10\u53d8"}),r.createElement(si.Z,null)),k()(l=c.Gradients).call(l,((t,i)=>"Size"===t.key&&r.createElement(ni,{onChange:e=>I(e,i),gradient:t,key:t.id,onDelete:()=>(t=>{const i=[...c.Gradients],r=Gt()(i).call(i,(e=>e.id===t));Tt()(i).call(i,r,1),u(oi(oi({},c),{},{Gradients:i})),e.removeGradient(r)})(t.id)}))))),r.createElement(dt,{title:"\u7c92\u5b50\u751f\u547d\u5468\u671f",open:d.has("lifetime"),onExpand:R,target:"lifetime"},r.createElement(Vt.Z,{component:"div",disablePadding:!0},r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u7c92\u5b50\u751f\u547d\u5468\u671f"}),r.createElement(qt,{range:c.LifeTime,onChange:b,name:"LifeTime"})),r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u6301\u7eed\u65f6\u95f4",name:"TargetStopDuration",value:c.TargetStopDuration,onChange:C})))),r.createElement(dt,{title:"\u7c92\u5b50\u65cb\u8f6c\u5c5e\u6027",open:d.has("rotation"),onExpand:R,target:"rotation"},r.createElement(Vt.Z,{component:"div",disablePadding:!0},r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u89d2\u901f\u5ea6"}),r.createElement(qt,{range:c.AngularSpeed,onChange:b,name:"AngularSpeed"})))),r.createElement(dt,{title:"\u7cbe\u7075\u56fe\u5c5e\u6027",open:d.has("sprite"),onExpand:R,target:"sprite"},r.createElement(Vt.Z,{component:"div",disablePadding:!0},r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u4f7f\u7528\u7cbe\u7075\u56fe"}),r.createElement(Se.Z,{name:"SpriteOption.isAnimationSheetEnabled",checked:c.SpriteOption?.isAnimationSheetEnabled,onChange:A})),c.SpriteOption?.isAnimationSheetEnabled&&r.createElement(r.Fragment,null,r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{name:"SpriteOption.spriteCellWidth",title:"\u7cbe\u7075\u5bbd",value:c.SpriteOption?.spriteCellWidth,onChange:C})),r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u7cbe\u7075\u9ad8",name:"SpriteOption.spriteCellHeight",value:c.SpriteOption?.spriteCellHeight,onChange:C})),r.createElement(Zt.ZP,null,r.createElement(Xt.Z,{title:"\u968f\u673a\u7cbe\u7075"}),r.createElement(Se.Z,{name:"SpriteOption.spriteRandomStartCell",checked:c.SpriteOption?.spriteRandomStartCell,onChange:A})),r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u8d77\u59cb\u7cbe\u7075\u7d22\u5f15",name:"SpriteOption.startSpriteCellID",value:c.SpriteOption?.startSpriteCellID,onChange:C})),r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u7ed3\u675f\u7cbe\u7075\u7d22\u5f15",name:"SpriteOption.endSpriteCellID",value:c.SpriteOption?.endSpriteCellID,onChange:C})),r.createElement(Zt.ZP,null,r.createElement(Yt.Z,{title:"\u7cbe\u7075\u5207\u6362\u901f\u5ea6",name:"SpriteOption.spriteCellChangeSpeed",value:c.SpriteOption?.spriteCellChangeSpeed,onChange:C}))))),!i&&r.createElement(r.Fragment,null,r.createElement(ot.Z,{onClick:y,sx:{background:"#ccc",outline:"1px solid #444"}},r.createElement(lt.Z,{primary:`\u5b50\u7c92\u5b50\u89e6\u53d1\u5668(${c.SubParticleSystems.length})`}),r.createElement($t.Z,null)),r.createElement(jt.ZP,{anchor:"left",open:f,onClose:y,variant:"persistent",PaperProps:{sx:{width:"40%"}}},r.createElement(K.Z,{sx:{textAlign:"center"}},"\u5b50\u7c92\u5b50\u89e6\u53d1\u5668"),r.createElement(It.U,null,r.createElement(we.Z,{onClick:()=>{const e=new Q.ParticleSystem({image:"textures/flare.png",capacity:100,manualEmitCount:100});e.Name="\u5b50\u7c92\u5b50\u7279\u6548";const t=new Q.SubEmitter(e);t.ObjectId=new Q.ObjectId(hi++),g(t),u(oi(oi({},c),{},{SubParticleSystems:[...c.SubParticleSystems,t]}))}},"\u6dfb\u52a0"),r.createElement(we.Z,{onClick:()=>{var e,t;if(!_)return;const i=wt()(e=c.SubParticleSystems).call(e,_);Tt()(t=c.SubParticleSystems).call(t,i,1),_.destory(),g(c.SubParticleSystems[0]),u(oi(oi({},c),{},{SubParticleSystems:[...c.SubParticleSystems]}))}},"\u5220\u9664"),r.createElement(we.Z,{onClick:v},"\u5e94\u7528"),r.createElement(we.Z,{onClick:()=>{li?li=!1:v(),y()}},"\u786e\u5b9a"),r.createElement(we.Z,{onClick:y},"\u53d6\u6d88")),r.createElement(It.U,{flexWrap:"wrap"},k()(h=c.SubParticleSystems).call(h,((e,t)=>r.createElement(we.Z,{color:_===e?"secondary":"primary",variant:"outlined",key:e.Id??t,onClick:()=>g(e)},e.Name)))),_&&r.createElement(ci,{isSub:!0,pcs:_.particleSystem})))))},ui=ci,di={snow:{Name:"\u4e0b\u96ea",Capacity:1e4,Rate:1e3,BlendMode:1,Color1:"#FFFFFF",Color2:"#FFFFFF",ColorDead:"#FFFFFF00",Image:"textures/snow.png",Pivot:{x:0,y:10},Size:{min:.1,max:2},LifeTime:{min:1,max:10},EmiterType:Q.EmiterType.Camera,SpriteOption:{isAnimationSheetEnabled:!0,spriteCellHeight:32,spriteCellWidth:32,spriteRandomStartCell:!0,startSpriteCellID:0,endSpriteCellID:3,spriteCellChangeSpeed:0},AngularSpeed:{min:0,max:Math.PI/4},MinEmitBox:{x:-100,y:50,z:-100},MaxEmitBox:{x:100,y:50,z:100},Direction1:{x:-.5,y:-1,z:0},Direction2:{x:5,y:-1,z:0},Gravity:{x:0,y:-9.81,z:-1},EmitPower:{min:.01,max:10}},fireworks:{Name:"\u70df\u82b1",Capacity:10,Rate:2,Image:"textures/flare.png",LifeTime:{min:.1,max:.5},Size:{min:.1,max:.4},UpdateSpeed:.005,EmitPower:{min:5,max:8},SubParticleSystems:[{Name:"\u5b50\u70df\u82b1",Capacity:100,Image:"textures/flare.png",UpdateSpeed:.005,EmitPower:{min:5,max:6},Size:{min:.2,max:.5},LifeTime:{min:.2,max:.5},ManualEmitCount:100}]},rain:[{Name:"\u96e8",Capacity:3e3,Rate:600,BlendMode:1,UpdateSpeed:.033,Color1:"#FFFFFF",Color2:"#FFFFFF",ColorDead:"#FFFFFF00",Image:"textures/Rain.png",EmiterPosition:{x:0,y:30,z:0},Size:{min:1,max:1},LifeTime:{min:3,max:3},EmiterType:Q.EmiterType.Point,SpriteOption:{isAnimationSheetEnabled:!0,spriteCellHeight:512,spriteCellWidth:128,spriteRandomStartCell:!0,startSpriteCellID:0,endSpriteCellID:3,spriteCellChangeSpeed:0},AngularSpeed:{min:0,max:0},MinEmitBox:{x:-100,y:0,z:-100},MaxEmitBox:{x:100,y:0,z:100},Direction1:{x:0,y:-1,z:0},Direction2:{x:0,y:-1,z:0},EmitPower:{min:10,max:12}},{Name:"\u6e85\u6c34\u82b1",UpdateSpeed:.033,Capacity:100,Rate:50,BlendMode:1,Color1:"#FFFFFF",Color2:"#FFFFFF",ColorDead:"#FFFFFF00",Image:"textures/Rain.png",EmiterPosition:{x:0,y:30,z:0},Size:{min:1,max:1},LifeTime:{min:2.95,max:2.95},EmiterType:Q.EmiterType.Point,SpriteOption:{isAnimationSheetEnabled:!0,spriteCellHeight:512,spriteCellWidth:128,spriteRandomStartCell:!0,startSpriteCellID:0,endSpriteCellID:3,spriteCellChangeSpeed:0},AngularSpeed:{min:0,max:0},MinEmitBox:{x:-20,y:0,z:-20},MaxEmitBox:{x:50,y:0,z:50},Direction1:{x:0,y:-1,z:0},Direction2:{x:0,y:-1,z:0},EmitPower:{min:10,max:10},SubParticleSystems:[{Name:"\u6c34\u82b1",Capacity:200,TargetStopDuration:.3,Image:"textures/Rain.png",UpdateSpeed:.033,EmiterShape:Q.EmiterShape.Cone,Emiter:{Radius:.2,Angle:3},Rate:60,BlendMode:1,Color1:"#FFFFFF",Color2:"#FFFFFF",ColorDead:"#FFFFFF00",EmiterPosition:{x:0,y:30,z:0},Size:{min:.05,max:.12},LifeTime:{min:.2,max:.4},SpriteOption:{isAnimationSheetEnabled:!0,spriteCellHeight:512,spriteCellWidth:128,spriteRandomStartCell:!0,startSpriteCellID:0,endSpriteCellID:3,spriteCellChangeSpeed:0},AngularSpeed:{min:0,max:0},EmitPower:{min:1,max:2}}]}]};let pi;const fi=({open:e,onClose:t,onUpdate:i,current:n,projectId:s,dirId:a})=>{const o=(0,r.useRef)(null),[l,h]=(0,r.useState)(null),[c,u]=(0,r.useState)(!1),[d,p]=(0,r.useState)("\u7c92\u5b50\u7279\u6548\u7ec4"),[f,m]=(0,r.useState)([]),_=(e=!0)=>{let t=new Q.ParticleSystem({image:"textures/flare.png",capacity:100});return e&&t.Intance.start(),t};return(0,r.useEffect)((()=>(U()((()=>{o.current&&(window.vw=pi=$.gV.intance.createView(o.current,{defaultLight:!0}),(()=>{if(n){const e=n.data.json,t=(0,J.K)(e);t instanceof Q.ParticleSystemGroup?(u(!0),p(t.Name),m([...t.systems]),h(t.systems[0])):h(t),t.Intance.start()}else{let e=_();h(e)}})())}),0),()=>{pi&&pi.destory()})),[]),r.createElement(Re.Z,{PaperProps:{sx:{height:"80vh"}},maxWidth:"lg",fullWidth:!0,onClose:t,open:e},r.createElement(Mt.Z,{onClose:t,title:"\u6dfb\u52a0\u7279\u6548",className:"draggable-dialog-title"}),r.createElement(Pe.Z,null,r.createElement(It.U,{sx:{height:"10%",alignItems:"center"}},r.createElement(Ae.Z,{checked:c,control:r.createElement(Se.Z,null),onChange:(e,t)=>{m([l]),u(t)},label:"\u7c92\u5b50\u7ec4"}),c&&r.createElement(r.Fragment,null,r.createElement(At.Z,{size:"small",label:"\u7ec4\u540d\u79f0",InputProps:{sx:{height:30,width:120}},value:d,onChange:e=>p(e.target.value)}),k()(f).call(f,((e,t)=>r.createElement(we.Z,{variant:"outlined",size:"small",sx:{height:30,lineHeight:"30px"},key:t,color:e===l?"secondary":"primary",onClick:()=>h(e)},e.Name))),r.createElement(we.Z,{onClick:()=>{const e=_();m([...f,e]),h(e)}},"\u6dfb\u52a0"),r.createElement(we.Z,{onClick:()=>{const e=wt()(f).call(f,l);-1!==e&&(l.destory(),Tt()(f).call(f,e,1),m([...f]),h(f[0]))}},"\u5220\u9664"))),r.createElement(It.U,{sx:{height:"90%"}},l?r.createElement(ui,{pcs:l,sx:{width:"60%",height:"100%"}}):r.createElement(V.Z,{sx:{width:"60%",height:"100%"}}),r.createElement(Pt.Z,{orientation:"vertical"}),r.createElement(V.Z,{sx:{flex:1}},r.createElement("canvas",{ref:o})))),r.createElement(Te.Z,null,r.createElement(Ot.Z,{defaultValue:"default",options:[{label:"\u9ed8\u8ba4\u6a21\u677f",value:"default"},{label:"\u4e0b\u96ea",value:"snow"},{label:"\u70df\u82b1",value:"fireworks"},{label:"\u4e0b\u96e8",value:"rain"}],onChange:e=>{const t=e.target.value;l&&l.destory();for(const e of f)e.destory();if(t){const e=di[t];if(Xe()(e)){u(!0);let t=new Q.ParticleSystemGroup;t.fromJSON(e),m(t.systems),h(t.systems[0]),t.Intance.start()}else{let t=_(!1);e&&t.fromJSON(e),t.Intance.start(),u(!1),m([]),h(t)}}}}),r.createElement(we.Z,{onClick:()=>{if(c&&f.length>1){const e=new Q.ParticleSystemGroup;e.systems=k()(f).call(f,(e=>e.clone())),Dt.l.Database.ParticleSystemSpace.append(e)}else l&&Dt.l.Database.ParticleSystemSpace.append(l.clone());t()}},"\u5e94\u7528"),r.createElement(we.Z,{onClick:async()=>{const e=(()=>{const e=new Q.HCFiler;if(c){if(0===f.length)return null;const t=new Q.ParticleSystemGroup;t.Name=d,t.systems.push(...f),t.writeFile(e)}else{if(!l)return null;l.writeFile(e)}return j()({version:1,isGroup:c,data:e.Data})})();if(!e)return void I.y.error("\u7279\u6548\u6570\u636e\u6709\u8bef");let r;if(r=n?await(0,xt.Dd)({id:n.id,name:c?d:l.Name,json_data:e,sourceType:Oe.fL.Particles,resources:"",pid:a}):await(0,xt.cT)({name:c?d:l.Name,jsonData:e,sourceType:Oe.fL.Particles,moduleIds:"",projectId:s,pid:a}),r.code===De.Mx.Ok){let e=n?.id??r.data?.[0]?.id;await(0,xt.jv)(e,(()=>pi.getPreviewUrl(!0))),i()}t()}},n?"\u66f4\u65b0":"\u4fdd\u5b58"),(0,Rt.SW)()&&r.createElement(we.Z,{size:"small",onClick:()=>{l&&l.Intance.getScene().debugLayer.show({embedMode:!0})}},"\u8c03\u8bd5")))};var mi=i(3360);const _i=()=>{const{rootStore:e}=(0,M.m)(),[t,i]=(0,r.useState)(!1),[n,s,a]=(0,O.Z)(),[o,l]=(0,r.useState)(null),[c,u]=(0,r.useState)(!1),[d,p]=(0,r.useState)([]),[f,m]=(0,r.useState)(null),[_,g]=(0,r.useState)(new(Ke())),[y,v]=(0,r.useState)(""),b=()=>{i(!0)},E=async()=>{u(!0);let e=await(0,xt.fD)(Oe.fL.Particles,0);e&&(e=h()(e).call(e,(e=>"dir"===e.node_type))),e&&x(N()(_),e),p(e),u(!1)},x=async(e,t=d)=>{Xe()(e)||(e=[e]);const i=[],r=[];for(const e of t)0===e.pid?i.push(e):r.push(e);if(y){for(const e of r){const t=w()(i).call(i,(t=>t.id===e.pid));if(t){t.children||(t.children=[]);const i=(await(0,xt.hr)(e.id)).json_data,r=JSON.parse(i);t.children.push({title:e.name,data:{key:"particle",json:r},preview:(0,D.qm)(e,!0,!0),id:e.id})}}p(i)}else{const i=new(Qe());for(const t of e){let e=await(0,xt.fD)(Oe.fL.Particles,t,y);e||(e=[]),i.set(t,h()(e).call(e,(e=>0!==e.pid)))}for(const e of t)if(i.has(e.id)){const t=[];for(const r of i.get(e.id)){const e=(await(0,xt.hr)(r.id)).json_data,i=JSON.parse(e);t.push({title:r.name,data:{key:"particle",json:i},preview:(0,D.qm)(r,!0,!0),id:r.id})}e.children=t}p([...t])}},C=()=>{s(),p((e=>[...e,{name:"\u65b0\u5efa\u76ee\u5f55",node_type:"dir",id:-1,editor:!0}]))},T=async(e,t)=>{t.stopPropagation(),0===t.button&&(_.has(e)?_.delete(e):(_.add(e),E()),g(new(Ke())(_))),m(e)},A=(e,t)=>{t.stopPropagation(),l(e)};return(0,r.useEffect)((()=>{E()}),[]),r.createElement(P.Z,{sx:{width:"100%"}},0===d.length&&r.createElement(mi.Z,{onClick:C,title:"\u65b0\u5efa\u76ee\u5f55\u5f00\u59cb\u521b\u5efa"}),r.createElement(V.Z,{sx:{height:"100%",overflow:"auto"},onContextMenu:n,onMouseDown:()=>{l(null)}},k()(d).call(d,(e=>"dir"===e.node_type&&r.createElement(dt,{title:e.name,open:_.has(e.id),onExpand:T,target:e.id,key:e.id,editor:e.editor,onBlur:t=>{t.target.value&&(e.name=t.target.value),(async e=>{let t;t=-1===e.id?await(0,xt.zs)({name:e.name,sourceType:Oe.fL.Particles}):await(0,xt.py)(e),t.code===De.Mx.Ok&&E()})(e)},select:e.id===f},r.createElement(Ce,{component:yt,onContextMenu:n,list:e.children??[],componentProps:e=>({"data-id":e.id}),canPreview:!0,onMouseDown:A,onAddData:b,onDoubleClick:e=>(l(e),void b())}))))),t&&f&&r.createElement(fi,{open:t,current:o,onClose:()=>{i(!1),l(null)},onUpdate:E,projectId:e.projectId,dirId:f}),r.createElement(a,null,!o&&r.createElement(S.Z,{key:"new",onClick:C},"\u65b0\u5efa\u76ee\u5f55"),!!f&&!o&&r.createElement(S.Z,{key:"rename",onClick:()=>{if(s(),!f)return;const e=w()(d).call(d,(e=>e.id===f));e&&(e.editor=!0),p([...d])}},"\u91cd\u547d\u540d"),!!f&&!o&&r.createElement(S.Z,{key:"delete-dir",onClick:async()=>{if(s(),!f)return;(await(0,De.QO)(Oe.au.delete,{data:{id:f}})).code===De.Mx.Ok&&(m(0),E())}},"\u5220\u9664\u76ee\u5f55"),o&&r.createElement(S.Z,{onClick:async()=>{await(0,xt._I)(o.id)&&(I.y.success("\u5220\u9664\u7279\u6548\u6210\u529f"),l(null),E()),s()}},"\u5220\u9664")))};var gi=i(31025);let yi=0;const vi=[{data:{key:"background",url:"background/skyboxes/surface/"},title:"\u6c34\u9762",id:yi++,preview:"background/skyboxes/surface/cover.jpg"},{data:{key:"background",url:"background/skyboxes/sunny/"},title:"\u591a\u4e91",id:yi++,preview:"background/skyboxes/sunny/cover.png"},{data:{key:"background",url:"background/skyboxes/starrySky/"},title:"\u661f\u7a7a",id:yi++,preview:"background/skyboxes/starrySky/cover.jpg"},{data:{key:"background",url:"background/skyboxes/space/"},title:"\u7a7a\u95f4",id:yi++,preview:"background/skyboxes/space/cover.jpg"},{data:{key:"background",url:"background/skyboxes/sky/"},title:"\u5929\u7a7a",id:yi++,preview:"background/skyboxes/sky/cover.jpg"},{data:{key:"background",url:"background/skyboxes/NightCityEdge/"},title:"\u591c\u665a",id:yi++,preview:"background/skyboxes/NightCityEdge/cover.jpg"},{data:{key:"background",url:"background/skyboxes/darkNight/"},title:"\u9ed1\u6697",id:yi++,preview:"background/skyboxes/darkNight/cover.jpg"},{data:{key:"background",url:"background/skyboxes/ClearSky/"},title:"\u84dd\u5929",id:yi++,preview:"background/skyboxes/ClearSky/cover.jpg"},{data:{key:"background",url:"background/skyboxes/blueSky/"},title:"\u6674\u7a7a",id:yi++,preview:"background/skyboxes/blueSky/cover.jpg"},{data:{key:"background",url:"background/skyboxes/BlueGrayGradient/"},title:"\u84dd\u7070",id:yi++,preview:"background/skyboxes/BlueGrayGradient/cover.jpg"}];let bi=0;const Ei=[{data:{key:"background",url:"background/bgPic/StreetLamp/pic.jpg"},title:"\u8def\u706f",id:bi++,preview:"background/bgPic/StreetLamp/cover.jpg"},{data:{key:"background",url:"background/bgPic/starrySky/pic.jpg"},title:"\u661f\u7a7a",id:bi++,preview:"background/bgPic/starrySky/cover.jpg"},{data:{key:"background",url:"background/bgPic/gradient/pic.jpg"},title:"\u6e10\u53d8",id:bi++,preview:"background/bgPic/gradient/cover.jpg"},{data:{key:"background",url:"background/bgPic/fuzzy/pic.jpg"},title:"\u6a21\u7cca",id:bi++,preview:"background/bgPic/fuzzy/cover.jpg"},{data:{key:"background",url:"background/bgPic/DeepBlue/pic.jpg"},title:"\u6df1\u84dd",id:bi++,preview:"background/bgPic/DeepBlue/cover.jpg"},{data:{key:"background",url:"background/bgPic/dark/pic.jpg"},title:"\u9ed1\u6697",id:bi++,preview:"background/bgPic/dark/cover.jpg"},{data:{key:"background",url:"background/bgPic/BlueScience/pic.jpg"},title:"\u84dd\u8272",id:bi++,preview:"background/bgPic/BlueScience/cover.jpg"},{data:{key:"background",url:"background/bgPic/abstract/pic.jpg"},title:"\u62bd\u8c61",id:bi++,preview:"background/bgPic/abstract/cover.jpg"}],xi=["children","value","index"],Ci=["tabs","value","bgColor","variant"];function wi(e){const{children:t,value:i,index:n}=e,s=(0,pt.Z)(e,xi);return r.createElement("div",(0,F.Z)({role:"tabpanel",hidden:i!==n,id:`simple-tabpanel-${n}`,"aria-labelledby":`simple-tab-${n}`,style:{height:"calc(100% - 50px)"}},s),i===n&&r.createElement(V.Z,{sx:{width:"100%",display:"flex",flexWrap:"wrap",height:"100%",padding:1}},t))}const Si=e=>{let{tabs:t,value:i,bgColor:n,variant:s}=e,a=(0,pt.Z)(e,Ci);const o=(0,A.ZP)(rt.Z)`
    background: #ffffff;
    min-height: 34px;
  `,l=(0,A.ZP)(nt.Z)`
    min-height: 34px;
    & .MuiTabs-indicator {
      background: #0084ff;
    }
    & .MuiTabs-flexContainer {
      background: ${n||"#f5f5f5"};
      height: 34px;
    }
  `;return r.createElement(r.Fragment,null,r.createElement(l,(0,F.Z)({value:i,indicatorColor:"secondary",textColor:"inherit",variant:s||"standard"},a),k()(t).call(t,(e=>{return r.createElement(o,(0,F.Z)({key:e.index,label:e.label},{id:`simple-tab-${t=e.index}`,"aria-controls":`simple-tabpanel-${t}`}));var t}))),k()(t).call(t,(e=>r.createElement(wi,{key:e.index,value:i,index:e.index},e.children))))};$.gV.intance;function Ti(){const{fileStore:e}=(0,M.m)(),[t,i]=r.useState(0),n=t=>{$.gV.intance.Viewer.sceneControl.Skybox=t.data.url,Ie.U.BgType=$.gV.intance.Viewer.sceneControl.Mode=Q.SkyboxMode.Image,e.setLoadProcess(!0);let i=0,r=10,n=Y()((()=>{i+=r,i>=90&&(r=1),i>=98?clearInterval(n):e.setLoadProcess(!0,i)}),1e3);return $.gV.intance.Viewer.sceneControl.LoadObserable.addOnce((t=>{clearInterval(n),e.setLoadProcess(!1)})),null};(0,r.useEffect)((()=>{(0,gi.gx)((()=>!!$.gV.intance),(()=>{$.gV.intance}))}),[]);const s=[{children:r.createElement(V.Z,{sx:{flex:1}},r.createElement(Ce,{component:yt,list:vi,onDoubleClick:n})),index:0,value:0,label:"\u5929\u7a7a\u76d2"},{children:r.createElement(V.Z,{sx:{flex:1}},r.createElement(Ce,{component:yt,list:Ei,onDoubleClick:n})),index:1,value:1,label:"\u56fe\u7247"}];return r.createElement(r.Fragment,null,r.createElement(V.Z,{sx:{bgcolor:"background.paper",width:500}},r.createElement(Si,{tabs:s,value:t,onChange:(e,t)=>{i(t)},variant:"fullWidth"})))}var Pi=i(59753),Ai=i(71722),Ri=i.n(Ai),Mi=i(18578),Oi=i.n(Mi),Ii=i(33591),Di=i.n(Ii),Fi=i(13567),Li=i.n(Fi),ki=i(43223),Bi=i(92509),Ni=i(62211),zi=i(40652);const Ui=(0,A.ZP)("input")({display:"none"});var Gi=i(5224),ji=i(2361);function Vi(e,t){var i=s()(e);if(o()){var r=o()(e);t&&(r=h()(r).call(r,(function(t){return u()(e,t).enumerable}))),i.push.apply(i,r)}return i}function Zi(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?p()(i=Vi(Object(n),!0)).call(i,(function(t){(0,b.Z)(e,t,n[t])})):m()?g()(e,m()(n)):p()(r=Vi(Object(n))).call(r,(function(t){v()(e,t,u()(n,t))}))}return e}let Wi,Hi,Ki;const qi=["obj","gltf","glb","STL"];let Xi,Yi,Qi,$i;let Ji;const er=()=>new(Ri())((e=>{Ji=e}));let tr,ir=!1;const rr=new(Qe()),nr=({readonly:e=!1,toEditComponent:t})=>{const[i,n]=(0,r.useState)([]),[s,a]=(0,r.useState)(null),[o,l]=(0,r.useState)([]),[c,u]=(0,r.useState)(!1),[d,f]=(0,r.useState)(""),[m,_]=(0,r.useState)({loading:!1}),[g,y]=(0,r.useState)(new(Ke())),{fileStore:v}=(0,M.m)(),[b,E]=(0,r.useState)(""),[x,C]=(0,r.useState)(!1),[T,A,R]=(0,O.Z)(),{changeLeftTab:F}=(0,Bi.M)(),{commonStore:L}=(0,Ni.j)(),[B,z]=(0,r.useState)(null),[U,G]=(0,r.useState)(!1),j=async(e,t)=>{t.stopPropagation(),0===t.button&&(g.has(e)?g.delete(e):(g.add(e),K(N()(g),!1)),y(new(Ke())(g))),v.SelectedModels=[],a(e)},Z=async e=>{if(Ki=N()(e.target.files),Bt()(Ki).call(Ki,(e=>{var t;return Oi()(t=e.name).call(t,".zip")})))return await(async()=>{ir=!0;for(const e of Ki){const t=new FormData;t.append("pid",s.toString()),t.append("pic_key","icon.png"),t.append("source_type",Oe.fL.Model),t.append("node_type","file"),t.append("status","1"),t.append("files",e),t.append("name",e.name),t.append("project_type","3d"),_({loading:!0,value:0,label:`\u5f00\u59cb\u4e0a\u4f20\u6a21\u578b\u8d44\u6e90${e.name}`});const i=await(0,De.qu)(Oe.Ym.upload,t,{headers:{"Content-Type":"multipart/form-data"},transformRequest:[function(e){return e}],onUploadProgress:t=>{const i=t.loaded/t.total*100;_(100===i?t=>Zi(Zi({},t),{},{value:i,label:`${e.name}\u4e0a\u4f20\u6210\u529f`}):e=>Zi(Zi({},e),{},{value:i}))}});if(i.code===De.Mx.Ok&&i.data)for(const e of i.data)_({loading:!0,value:0,label:`\u5f00\u59cb\u751f\u6210${e.file_key}\u9884\u89c8`}),await Wi.loadFile($.gV.prefix+(0,D.qm)(e)),tr=e.id,await(0,xt.jv)(e.id,(async()=>Wi.getPreviewUrl(200))),_({loading:!0,value:100,label:`${e.file_key}\u9884\u89c8\u5df2\u66f4\u65b0`})}_({loading:!1}),rr.delete(s),K(),ir=!1})(),void(e.target.value=null);Xi=[],Yi=[];for(const e of Ki){if(e.size>31457280)return void I.y.error(e.name+"\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc720M\uff0c\u76ee\u524d\u5355\u4e2a\u4e0a\u4f20\u6587\u4ef6\u4f53\u79ef\u4e0d\u8d85\u8fc720M");Bt()(qi).call(qi,(t=>{var i;return Oi()(i=e.name).call(i,t)}))?Xi.push(e):Yi.push(e)}if(Xi.length>0){if(Wi){Qi=[],$i=[],Wi.loadLocalFile({target:{files:[Xi[0],...Yi]}}),_({loading:!0,value:0,label:"\u9884\u5904\u7406"+Xi[0].name}),await er();for(let e=1;e<Xi.length;e++)Wi.loadLocalFile({target:{files:[Xi[e]]}}),_({loading:!0,value:0,label:"\u9884\u5904\u7406"+Xi[e].name}),await er()}}else I.y.warn("\u8bf7\u4e0a\u4f20\u6b63\u786e\u7684\u6a21\u578b\u6587\u4ef6\u548c\u5176\u4f9d\u8d56\u6587\u4ef6\uff0c\u76ee\u524d\u652f\u6301OBJ,GLTF,GLB 3\u79cd",{autoHideDuration:2e3});e.target.value=null},W=()=>{A(),l((e=>[...e,{name:"\u65b0\u5efa\u76ee\u5f55",node_type:"dir",id:-1,editor:!0}]))},H=e=>{var t;return!!w()(t=v.SelectedModels).call(t,(t=>t.id===e))},K=async(e,t=!0)=>{t&&u(!0);let i=t?await(0,xt.fD)(Oe.fL.Model,0,b):o;i&&(async(e,t=o)=>{Xe()(e)||(e=[e]);const i=[],r=[];for(const e of t)0===e.pid?i.push(e):r.push(e);if(b){for(const e of r){const t=w()(i).call(i,(t=>t.id===e.pid));t&&(t.children||(t.children=[]),t.children.push({title:e.name.split(".")[0]??e.file_key,data:{key:"ImportEntity",url:(0,D.qm)(e),name:e.name.split(".")[0]??e.file_key,modelId:e.uuid},preview:(0,D.qm)(e,!0),id:e.id}))}l(i)}else{const i=new(Qe());for(const t of e){let e;rr.has(t)?e=rr.get(t):(e=await(0,xt.fD)(Oe.fL.Model,t,b),e&&rr.set(t,e)),e||(e=[]),i.set(t,h()(e).call(e,(e=>0!==e.pid)))}for(const e of t){var n;i.has(e.id)&&(e.children=k()(n=i.get(e.id)).call(n,(e=>({title:e.name.split(".")[0]??e.file_key,data:{key:"ImportEntity",url:(0,D.qm)(e),name:e.name.split(".")[0]??e.file_key,modelId:e.uuid},preview:(0,D.qm)(e,!0,!1),id:e.id}))))}l([...t])}})(e??N()(g),i),l(i??[]),u(!1)},q=[],X=e=>async t=>{const i=Number(d);if(f(""),!i||!t.target.value)return;(await(0,xt.Dd)({id:i,name:t.target.value,pid:e})).code===De.Mx.Ok&&(rr.delete(e),K())},Y=async()=>{if(Qi.length+$i.length===Xi.length){if(0===Qi.length)return I.y.warn("\u6a21\u578b\u4e0a\u4f20\u5931\u8d25\uff0c\u68c0\u67e5\u6a21\u578b\u662f\u5426\u5b58\u5728\u95ee\u9898",{autoHideDuration:2e3}),void _({loading:!1});let e=new FormData,t=0;const i=Li()(),r=[],n=[...Qi,...Ki];let a=Math.ceil(n.length/50);for(let s=0;s<n.length;s++){const o=n[s];if(!Di()($i).call($i,o)&&(e.append(o.name,o),t++,t>=50||s===n.length-1)){_({loading:!0,value:0,label:"\u5f00\u59cb\u4e0a\u4f20\u6a21\u578b\u8d44\u6e90"+(a>1?"("+a+")":"")});const n=await(0,De.qu)(Oe.Ym.uploadMulti+"?p="+i,e,{headers:{"Content-Type":"multipart/form-data"},transformRequest:[function(e){return e}],onUploadProgress:e=>{const t=e.loaded/e.total*100;_(100===t?e=>Zi(Zi({},e),{},{value:t,label:"\u4e0a\u4f20\u7ed3\u675f\uff0c\u7b49\u5f85\u7ed3\u679c"}):e=>Zi(Zi({},e),{},{value:t}))}});n.code===De.Mx.Ok&&r.push(...n.data.files),e=new FormData,t=0,a--}}(e=>{const t=t=>{for(const i of e)if("png"===i.tag&&i.name===t+".png")return i},i=[];for(const r of e)if(Di()(qi).call(qi,r.tag)){const e=t(r.name);i.push((0,De.qu)(Oe.au.create,{name:r.name,pId:s||0,source_type:Oe.fL.Model,node_type:"file",fileId:r.ID,picId:e.ID}))}Ri().all(i).then((e=>{I.y.success(`\u6210\u529f\u4e0a\u4f20${Qi.length}\u4e2a\u6a21\u578b,\u5931\u8d25${$i.length}\u4e2a`,{autoHideDuration:5e3})})).then((e=>{K()})).finally((()=>{_({loading:!1})}))})(r)}},J=()=>{G(!1)};(0,r.useEffect)((()=>{Hi||(Hi=document.createElement("canvas"),Hi.width=400,Hi.height=400,window.filePreview=Wi=new Q.FilePreviewer(Hi,!0))}),[]),(0,r.useEffect)((()=>{const e=Wi.onProgress((e=>{const t=e.loaded/e.total*100;_((e=>Zi(Zi({},e),{},{value:t})))}));return()=>{e()}}),[]),(0,r.useEffect)((()=>()=>{v.SelectedModels=[]}),[]),(0,r.useEffect)((()=>{const e=[];return e.push(Wi.onLoaded((async e=>{if(!e&&ir&&tr)return;const t=await Wi.getBlob(),i=new File([t],e.name+".png");Qi.push(i),Ji&&(Ji(!0),Ji=null),await Y()})),Wi.onError((({file:e,message:t})=>{$i.push(e),Ji&&(Ji(!0),Ji=null),Y()}))),()=>{p()(e).call(e,(e=>e()))}}),[s]);const te=e=>{e.ctrlKey&&"KeyA"===e.code&&(e.preventDefault(),e.stopPropagation(),v.SelectedModels=[...i])};(0,r.useEffect)((()=>{(0,Ue.N)((()=>{K()}),500)}),[b]),(0,r.useEffect)((()=>{const e=zi.G.on("ApplyModel",(()=>{K()}));return()=>{e()}}),[]),(0,r.useEffect)((()=>(document.addEventListener("keydown",te),()=>{document.removeEventListener("keydown",te)})));const ie=(e,t)=>{t.stopPropagation(),H(e.id)||(t.ctrlKey?v.SelectedModels=[...v.SelectedModels,e]:v.SelectedModels=[e])};return r.createElement(r.Fragment,null,r.createElement(P.Z,{sx:{width:"100%",height:"100%"}},r.createElement(P.Z,{flexDirection:"row",sx:{height:"28px"}},r.createElement(ze.Z,{value:b,onChange:e=>{E(e.target.value)},placeholder:"\u641c\u7d22\u6a21\u578b",sx:{flex:1}}),r.createElement(ei.Z,{onClick:W,"aria-label":"delete",color:"primary",sx:{width:28,ml:1}},r.createElement(We.Z,{name:"icon-3Da-tianjia3x",fontSize:28}))),r.createElement(V.Z,{sx:{height:"90%",overflow:"auto"},onContextMenu:T,onMouseDown:()=>{a(0),v.SelectedModels=[]}},k()(o).call(o,(e=>"dir"===e.node_type&&r.createElement(dt,{title:e.name,open:g.has(e.id),onExpand:j,target:e.id,key:e.id,editor:e.editor,onBlur:t=>{t.target.value&&(e.name=t.target.value),(async e=>{let t;t=-1===e.id?await(0,xt.zs)({name:e.name,sourceType:Oe.fL.Model}):await(0,xt.py)(e),t.code===De.Mx.Ok&&K()})(e)},select:e.id===s},r.createElement(Ce,{onContextMenu:T,list:e.children??[],component:yt,componentProps:e=>({elevation:H(e.id)?5:1,"data-nodeid":e.id,"data-nodetype":"file"}),editorId:Number(d),onChangeEnd:X(e.id),canPreview:!0,onMouseDown:ie}))))),!e&&r.createElement(V.Z,null,r.createElement("label",{htmlFor:"contained-button-file"},r.createElement(Ui,{id:"contained-button-file",multiple:!0,type:"file",accept:".zip",onChange:e=>Z(e),disabled:!s}),r.createElement(ki.Z,{disabled:!s,variant:"contained",fullWidth:!0,component:"span",loading:m.loading,loadingIndicator:r.createElement(re,{value:m.value,label:m.label,sx:{height:"100%"}})},"\u6a21\u578b\u4e0a\u4f20")),r.createElement(Pt.Z,{sx:{mt:1}})),r.createElement($e.Z,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:c,onClick:()=>u(!1)},r.createElement(ee.Z,{color:"inherit"}))),!e&&r.createElement(R,null,v.SelectedModels.length<1&&r.createElement(S.Z,{key:"newDir",onClick:W},"\u65b0\u5efa\u76ee\u5f55"),v.SelectedModels.length<1&&null!=s&&0!==s&&r.createElement(S.Z,{key:"rename",onClick:()=>{if(A(),!s)return;const e=w()(o).call(o,(e=>e.id===s));e&&(e.editor=!0),l([...o])}},"\u91cd\u547d\u540d"),v.SelectedModels.length<1&&null!=s&&0!==s&&r.createElement(S.Z,{key:"delete",onClick:async()=>{if(A(),!s)return;(await(0,De.QO)(Oe.au.delete,{data:{id:Number(s)}})).code===De.Mx.Ok&&(a(0),K())}},"\u5220\u9664\u76ee\u5f55"),1===v.SelectedModels.length&&r.createElement(S.Z,{key:"renameModel",onClick:()=>{A(),f(String(v.SelectedModels[0].id))}},"\u91cd\u547d\u540d\u6a21\u578b"),v.SelectedModels.length>0&&r.createElement(S.Z,{key:"deleteModel",onClick:()=>{var e;(A(),v.SelectedModels.length<1)||(rr.clear(),p()(e=v.SelectedModels).call(e,(e=>{q.push((0,De.QO)(Oe.au.delete,{data:{id:e.id}}).then((e=>e)))})),Ri().all(q)).then((e=>{K()}))}},"\u5220\u9664\u6a21\u578b"),v.SelectedModels.length>0&&r.createElement(S.Z,{key:"copyUrl",onClick:()=>{A(),v.SelectedModels.length>0&&G(!0)}},"\u5c01\u88c5\u6a21\u578b"),v.SelectedModels.length>0&&r.createElement(S.Z,{key:"publish",onClick:()=>{A(),C(!0)}},"\u53d1\u5e03")),!e&&x&&r.createElement(Be.Z,{target:v.SelectedModels[0].id,onClose:()=>{C(!1)},type:"file",category:Ne.f.Model,targetObj:v.SelectedModels[0]}),U&&r.createElement(Re.Z,{open:U,onClose:J,maxWidth:"md",fullWidth:!0},r.createElement(Mt.Z,{onClose:J,title:"\u9009\u62e9\u7269\u6a21\u578b\u76ee\u5f55"}),r.createElement(Pe.Z,{sx:{overflow:"initial"}},r.createElement(Gi.Z,{sourceType:Oe.fL.Component,projectId:Ie.U.projectId,onClick:e=>{z(e)},selectId:B})),r.createElement(Te.Z,null,r.createElement(we.Z,{disabled:!B,onClick:()=>{var e;J();const i=k()(e=v.SelectedModels).call(e,(e=>(L.assetMap.set(e.data.url,e.data.modelId),`new HC.ImportEntity({url:"${e.data.url}"})`)));t?t():F(Pi.V.Component),L.startEditor(B,(0,ji.V4)(i.join(",\r")))}},"\u524d\u5f80\u5c01\u88c5"),r.createElement(we.Z,{onClick:J},"\u53d6\u6d88"))))};var sr=i(14549),ar=i.n(sr),or=i(66914),lr=i(52681),hr=i(44700),cr=i(12117),ur=i(47107),dr=i(54603),pr=i(72448),fr=i(78991),mr=i(29143),_r=i(82295),gr=i(32048),yr=i(19957);function vr(e,t){var i=s()(e);if(o()){var r=o()(e);t&&(r=h()(r).call(r,(function(t){return u()(e,t).enumerable}))),i.push.apply(i,r)}return i}function br(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?p()(i=vr(Object(n),!0)).call(i,(function(t){(0,b.Z)(e,t,n[t])})):m()?g()(e,m()(n)):p()(r=vr(Object(n))).call(r,(function(t){v()(e,t,u()(n,t))}))}return e}let Er,xr=0,Cr=(Li()(),new(Ke()));const wr=new Q.HCFiler,Sr=({getAst:e,getCode:t,generateDemo:i,propertys:n,onClose:s,current:a,format:o,hasErrror:l,updatePropName:h,getView:c,apply:u})=>{const[d,p]=(0,r.useState)(a?.title||"\u672a\u547d\u540d"+xr++),f=(0,r.useRef)(null),{commonStore:m}=(0,Ni.j)(),[_,g]=(0,r.useState)(!1),y=()=>{g(!1)},v=()=>{g(!0)},b=e=>{p(e.target.value)},E=e=>{const i=new((0,cr.Xr)(t()));Cr.clear();for(const e of i.entitys)if(e instanceof Q.ImportEntity){const t=e.url;if(m.assetMap.has(t))Cr.add(m.assetMap.get(t));else{var r;const e=t.split("/")[0];e&&a.moduleIds&&Di()(r=a.moduleIds).call(r,e)&&Cr.add(e)}}return i.entitys.length>0},x=()=>{wr.clear(),Er.cameraManager.ArcRotateControl.writeFile(wr),u(wr.Data)},C=()=>{l()?I.y.error("\u4ee3\u7801\u5b58\u5728\u9519\u8bef,\u8bf7\u5148\u4fee\u590d"):a?.id?(async()=>{if(!d)return void I.y.error("\u8bf7\u8f93\u5165\u7269\u6a21\u578b\u540d\u79f0");const i=e();if(!i)return void I.y.error("\u4ee3\u7801\u6709\u8bef");E(i.program)?(wr.clear(),Er.cameraManager.ArcRotateControl.writeFile(wr),await m.updateComponent(br(br({},a),{},{code:t(),title:d,propertys:[...n],moduleIds:N()(Cr).join(",")}),wr.Data)&&(await(0,xt.jv)(a.id,(()=>Er.getPreviewUrl(!0))),I.y.success("\u7269\u6a21\u578b\u66f4\u65b0\u6210\u529f"),m.load()),s()):I.y.error("\u7269\u6a21\u578b\u90e8\u4ef6\u4e3a\u7a7a")})():w()},w=async()=>{if(!d)return void I.y.error("\u8bf7\u8f93\u5165\u7269\u6a21\u578b\u540d\u79f0");const i=e();if(!i)return void I.y.error("\u4ee3\u7801\u6709\u8bef");if(E(i.program)){const e={title:d,id:-1,code:t(),propertys:[...n]};wr.clear(),Er.cameraManager.ArcRotateControl.writeFile(wr);const i=await m.addComponent(e,N()(Cr).join(","),wr.Data);i&&(await(0,xt.jv)(i,(()=>Er.getPreviewUrl(!0))),m.load(),I.y.success("\u7269\u6a21\u578b\u521b\u5efa\u6210\u529f")),s()}else I.y.error("\u7269\u6a21\u578b\u90e8\u4ef6\u4e3a\u7a7a")};return(0,r.useEffect)((()=>(f.current&&(Er=Dt.l.createView(f.current,{defaultLight:!0}),Er.sceneControl.createDefaultEnv(),c(Er)),()=>{Er&&Er.destory()})),[]),r.createElement(R.Qj,null,(()=>r.createElement(r.Fragment,null,r.createElement(_e.Z,{id:"name",title:"\u540d\u79f0",value:d,placeholder:"\u8bf7\u8f93\u5165\u6a21\u578b\u540d\u79f0",onChange:b}),r.createElement(mr.Z,{component:T.Z,sx:{marginTop:5,minHeight:200}},r.createElement(dr.Z,{size:"small","aria-label":"property"},r.createElement(_r.Z,null,r.createElement(gr.Z,null,r.createElement(fr.Z,null,"\u5c5e\u6027"),r.createElement(fr.Z,null,"\u503c\u7c7b\u578b"),r.createElement(fr.Z,null,"\u9ed8\u8ba4\u503c"),r.createElement(fr.Z,null,"\u540d\u79f0"),r.createElement(fr.Z,null,"\u5907\u6ce8"))),r.createElement(pr.Z,null,k()(n).call(n,(e=>r.createElement(gr.Z,{key:e.name,sx:{"&:last-child td, &:last-child th":{border:0}}},r.createElement(fr.Z,{component:"th",scope:"row"},e.prop),r.createElement(fr.Z,null,e.type),r.createElement(fr.Z,null,e.value.toString()),r.createElement(yr.Z,{defaultValue:e.name,onBlur:t=>{return i=br(br({},e),{},{name:t.target.value}),void h(i);var i}}),r.createElement(fr.Z,null,e.remark))))))),r.createElement(V.Z,{sx:{height:"40%",outline:"1px solid #ccc"}},r.createElement("canvas",{ref:f})),r.createElement(P.Z,{direction:"row",spacing:1,alignItems:"center",sx:{marginTop:5}},r.createElement(we.Z,{variant:"contained",onClick:C},a?.id?"\u66f4\u65b0":"\u4fdd\u5b58"),r.createElement(we.Z,{variant:"contained",onClick:x},"\u5e94\u7528<Ctrl+S>"),r.createElement(we.Z,{variant:"contained",onClick:i},"\u751f\u6210\u6a21\u578b\u4ee3\u7801"),r.createElement(we.Z,{variant:"contained",onClick:v},"\u9009\u62e9\u6a21\u578b")),r.createElement(jt.ZP,{open:_,onClose:y,anchor:"right",PaperProps:{sx:{width:320,p:1}},sx:{width:0},ModalProps:{disableAutoFocus:!0,disableEnforceFocus:!0},variant:"persistent"},r.createElement(It.U,{justifyContent:"space-between",alignItems:"center"},r.createElement(K.Z,{variant:"h6"},"\u9009\u62e9\u6a21\u578b"),r.createElement(we.Z,{onClick:y,size:"large",startIcon:r.createElement(hr.Z,null)})),r.createElement(Pt.Z,{sx:{my:1}}),r.createElement(nr,{readonly:!0})))))};var Tr=i(4454);let Pr,Ar=!0,Rr=null;const Mr=({onClose:e,current:t})=>{const i=(0,r.useRef)(null),[n,s]=(0,r.useState)([]),a=(0,r.useRef)([]),o=(0,r.useRef)(null),{commonStore:l}=(0,Ni.j)(),h=(e,r)=>{try{const n=i.current.getValue(),a=(0,or.Qc)(n),l=c(a.program);if(e)for(const t of l){const i=w()(e).call(e,(e=>e.prop===t.prop));i&&(t.name=i.name)}s(l);const h=(0,cr.Xr)(n);if(Rr&&Rr.destory(),Rr=new h,!Rr.entitys?.length)return;Rr.RenderObject,Rr.watchLoad().then((()=>{if(r){const e=new Q.HCFiler(r);o.current.cameraManager.ArcRotateControl.readFile(e)}else if(t.camera){const e=new Q.HCFiler(t.camera);o.current.cameraManager.ArcRotateControl.readFile(e)}else o.current.zoomAll(),o.current.cameraManager.ArcRotateControl.Alpha=Math.PI/4}))}catch(e){I.y.error("\u4ee3\u7801\u5b58\u5728\u9519\u8bef")}},c=e=>{try{const t=[],i=e.body?.[0].body.body;for(const e of i)if("ClassMethod"===e.type&&"getData"===e.key.name){const i=e.body.body[0];if("ReturnStatement"===i?.type){const e=i.argument;for(const i of e.properties)t.push({name:i.key.name??i.key.value,prop:i.key.name??i.key.value,value:i.value.value,type:typeof i.value.value})}break}return t}catch(e){return[]}};return r.createElement(Re.Z,{fullWidth:!0,maxWidth:"xl",onClose:e,open:!0,PaperProps:{sx:{height:"90vh"}},onContextMenu:e=>e.stopPropagation()},r.createElement(Me.Z,{className:"draggable-dialog-title",sx:{display:"flex",justifyContent:"space-between",cursor:"move"}},r.createElement(K.Z,null,"\u6a21\u578b\u5c01\u88c5"),r.createElement(ei.Z,{"aria-label":"close",size:"small",onClick:e},r.createElement(hr.Z,{fontSize:"small"}))),r.createElement(Pe.Z,{sx:{display:"flex",overflow:"hidden"}},r.createElement(V.Z,{sx:{width:"60%"},onDrop:e=>{try{const r=e.dataTransfer.getData("text/plain"),n=JSON.parse(r),s=i.current.getValue(),a=(0,or.Qc)(s);l.assetMap.set(n.url,n.modelId);const o=a.program.body?.[0].body.body;for(const e of o)if("ClassMethod"===e.type&&"initComponents"===e.key.name){var t;const r=w()(t=e.body.body).call(t,(e=>"ReturnStatement"===e.type));if("ArrayExpression"===r?.argument?.type){r.argument.elements.push((0,lr.newExpression)((0,lr.memberExpression)((0,lr.identifier)("HC"),(0,lr.identifier)("ImportEntity")),[(0,lr.objectExpression)([(0,lr.objectProperty)((0,lr.identifier)("url"),(0,lr.stringLiteral)(n.url))])]));const e=(0,Tr.ZP)(a,{});i.current.setValue(e.code)}break}}catch(e){}},onDragOver:e=>e.preventDefault(),onDragEnd:e=>e.preventDefault()},r.createElement(ur.Z,{updateProperyty:h,onChange:e=>{Ar=!0,a.current=e},getEditor:e=>i.current=e,onMount:()=>{t&&i.current&&(i.current?.setValue(t.code),h(t.propertys))}})),r.createElement(V.Z,{sx:{flex:1,padding:2}},r.createElement(Sr,{getAst:()=>{try{if(Ar){Ar=!1;const e=i.current.getValue();Pr=(0,or.Qc)(e)}return Pr}catch(e){return null}},getCode:()=>i.current?.getValue(),generateDemo:()=>{i.current.setValue(ji.tu),h()},propertys:n,onClose:e,current:t,format:()=>{i.current.getAction("editor.action.formatDocument").run()},hasErrror:()=>a.current.length>0,updatePropName:e=>{s((t=>{for(const i of t)i.prop===e.prop&&ar()(i,e);return[...t]}))},getView:e=>{o.current=e},apply:e=>{i.current.getAction("editor.action.formatDocument").run(),h(n,e)}}))))};let Or;const Ir=(0,R.Pi)((()=>{const{commonStore:e}=(0,Ni.j)(),[t,i]=(0,r.useState)(!1),[n,s]=(0,r.useState)(""),[a,o,l]=(0,O.Z)((e=>{Or=f(e.target)})),h=(t,i)=>{"backdropClick"!==i&&(e.open=!1)},c=()=>{o(),i(!0)},u=()=>{i(!1)},d=(t,i)=>{e.open=!0,e.selectId=i};(0,r.useEffect)((()=>{(0,Ue.N)((()=>{e.load(n)}),500)}),[n]);const p=e=>{s(e.target.value)},f=e=>{let t=e.getAttribute("data-data");if(t)return JSON.parse(t);for(;e&&!e.hasAttribute("data-data");)if(!(e=e.parentElement)||"leftPanel"===e.id)return null;return t=e.getAttribute("data-data"),t?JSON.parse(t):void 0},m=()=>{Or&&(e.deleteComponent(Or),o())},_=(t,i)=>{i.stopPropagation(),0===i.button&&e.toggleExpand(t),e.selectId=t,e.current=null},g=t=>{2===t.button&&(e.selectId=0,e.current=null)},y=()=>{o(),e.addDir()},v=()=>{o(),e.startRenameDir()},b=()=>{o(),e.deleteDir()},E=(t,i)=>{i.stopPropagation(),e.current=t},x=()=>{d(e.current,e.selectId),o()};return r.createElement(R.Qj,null,(()=>{var i;return r.createElement(r.Fragment,null,r.createElement(P.Z,{flexDirection:"row",sx:{height:"28px"}},r.createElement(ze.Z,{value:n,onChange:p,placeholder:"\u641c\u7d22\u7ec4\u4ef6",sx:{flex:1}}),r.createElement(ei.Z,{onClick:y,"aria-label":"delete",color:"primary",sx:{width:28,ml:1}},r.createElement(We.Z,{name:"icon-3Da-tianjia3x",fontSize:28}))),r.createElement(Vt.Z,{sx:{height:"90%",width:"100%",overflow:"auto",paddingTop:"0px"},onContextMenu:a,onMouseDown:g},k()(i=e.dirList).call(i,(t=>"dir"===t.node_type&&r.createElement(dt,{title:t.name,open:e.isExpand(t.id),onExpand:_,target:t.id,key:t.id,editor:t.editor,onBlur:i=>{i.target.value&&(t.name=i.target.value),e.handleDir(t)},select:t.id===e.selectId},r.createElement(Ce,{onContextMenu:a,list:t.children??[],component:yt,componentProps:e=>({"data-nodeid":e.id,"data-nodetype":"file"}),canPreview:!0,onMouseDown:E,onAddData:()=>(t=>{e.startEditor(t)})(t.id),onDoubleClick:e=>d(0,t.id)})))),e.open&&r.createElement(Mr,{onClose:h,current:e.current}),t&&r.createElement(Be.Z,{target:e.current&&e.current.id,onClose:u,type:"file",category:Ne.f.Component,targetObj:e.current}),r.createElement(l,null,!e.current&&r.createElement(S.Z,{key:"new",onClick:y},"\u65b0\u5efa\u76ee\u5f55"),!!e.selectId&&!e.current&&r.createElement(S.Z,{key:"rename",onClick:v},"\u91cd\u547d\u540d"),!!e.selectId&&!e.current&&r.createElement(S.Z,{key:"delete-dir",onClick:b},"\u5220\u9664\u76ee\u5f55"),e.current&&r.createElement(S.Z,{key:"delete",onClick:m},"\u5220\u9664"),e.current&&r.createElement(S.Z,{key:"publish",onClick:c},"\u53d1\u5e03"),e.current&&r.createElement(S.Z,{key:"edit",onClick:x},"\u7f16\u8f91"))))}))})),Dr=Ir,Fr=()=>{const[e,t]=r.useState(0),i=[{children:r.createElement(nr,{toEditComponent:()=>t(1)}),index:0,value:0,label:"\u6a21\u578b"},{children:r.createElement(Dr,null),index:1,value:1,label:"\u7ec4\u4ef6"}];return r.createElement(r.Fragment,null,r.createElement(V.Z,{sx:{bgcolor:"background.paper",width:"100%",height:"100%"}},r.createElement(Si,{tabs:i,value:e,onChange:(e,i)=>{t(i)},variant:"fullWidth"})))},Lr=[{id:Pi.V.Scene,title:"\u573a\u666f",icon:We.Z,iconName:"icon-3Dchangjing",component:r.createElement(Ze,null)},{id:Pi.V.AllResource,title:"\u6a21\u578b",icon:We.Z,iconName:"icon-3Dziyuan",component:r.createElement(Fr,null)},{id:Pi.V.Background,title:"\u80cc\u666f",icon:We.Z,iconName:"icon-3Dbeijingse",component:r.createElement(Ti,null)},{id:Pi.V.Effect,title:"\u7279\u6548",icon:We.Z,iconName:"icon-3Dtexiao1",component:r.createElement(_i,null)},{id:Pi.V.D2,title:"\u56fe\u6807",icon:We.Z,iconName:"icon-3Dtubiao1",component:r.createElement(Et,null)}]},59753:(e,t,i)=>{let r;i.d(t,{V:()=>r}),function(e){e[e.Scene=1]="Scene",e[e.Component=2]="Component",e[e.Background=3]="Background",e[e.Effect=4]="Effect",e[e.Model=5]="Model",e[e.D2=6]="D2",e[e.AllResource=7]="AllResource"}(r||(r={}))},25661:(e,t,i)=>{i.d(t,{Z:()=>ee});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(61799),l=i.n(o),h=i(26117),c=i.n(h),u=i(5996),d=i.n(u),p=i(20658),f=i.n(p),m=i(3434),_=i.n(m),g=i(97828),y=i.n(g),v=i(93213),b=i(75425),E=i.n(b),x=i(51463),C=i.n(x),w=i(32735),S=i(11528),T=i(73764),P=i(61241),A=i(95279),R=i(96433),M=i(68867),O=i(94063),I=i(75393),D=i(37211),F=i(58181),L=i(57426),k=i(25783),B=i(15855),N=i(92491),z=i(3450),U=i(6475),G=i(29115),j=i(73554),V=i(57055),Z=i(74857),W=i(36649),H=i(22997),K=i(56622);function q({onChange:e}){return w.createElement(K.Z,{spacing:3,sx:{width:500}},w.createElement(H.Z,{onChange:(t,i)=>e(i),multiple:!0,id:"tags-filled",options:C()(X).call(X,(e=>e.title)),freeSolo:!0,renderTags:(e,t)=>C()(e).call(e,((e,i)=>w.createElement(W.Z,(0,Z.Z)({key:e+i,variant:"outlined",label:e},t({index:i}))))),renderInput:e=>w.createElement(T.Z,(0,Z.Z)({},e,{placeholder:"\u8f93\u5165\u540e\u56de\u8f66\u521b\u5efa\u6807\u7b7e"}))}))}const X=[];function Y(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=l()(r).call(r,(function(t){return c()(e,t).enumerable}))),i.push.apply(i,r)}return i}function Q(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?d()(i=Y(Object(n),!0)).call(i,(function(t){(0,v.Z)(e,t,n[t])})):f()?_()(e,f()(n)):d()(r=Y(Object(n))).call(r,(function(t){y()(e,t,c()(n,t))}))}return e}const $=(0,z.ZP)(P.Z)((({theme:e})=>Q(Q({},e.typography.body2),{},{textAlign:"center",color:e.palette.text.secondary,height:135,lineHeight:"128px",cursor:"pointer"}))),J={width:"100%",height:135,backgroundSize:"100%"},ee=({target:e,onClose:t,type:i,category:r,targetObj:n})=>{const[s,a]=w.useState(n?n.title:""),[o,l]=w.useState(""),[h,c]=w.useState(""),[u,d]=w.useState(""),[p,f]=w.useState(""),[m,_]=w.useState(""),[g,y]=w.useState(""),[v,b]=w.useState(""),[x,P]=w.useState([]),[z,Z]=w.useState(0),[W,H]=w.useState("image/png, image/jpeg"),[K,X]=w.useState([]),Y=()=>{(async()=>{(await(0,G.qu)(U.ND.publish,{name:s,opus_type:"3d",source_id:"M0001"===r?K:[e],source_type:i,pic_key:m,pic_data:g,tags:u,remark:p,industry_id:v,category:r,score:z})).code===G.Mx.Ok&&(j.y.success("\u53d1\u5e03\u6210\u529f"),t())})()};(0,w.useEffect)((()=>{(async()=>{const e=await(0,G.ZL)(U.ZQ.trade);if(e.code===G.Mx.Ok){let t=e.data&&e.data.list;P([...t]),b(t[0].value)}})();const t=new Image;t.crossOrigin="",t.src=V.AppConfig.assetURL+n.preview,t.onload=function(){const e=function(e){var t;const i=document.createElement("canvas");i.width=e.width,i.height=e.height;i.getContext("2d").drawImage(e,0,0,e.width,e.height);const r=e.src.substring(E()(t=e.src).call(t,".")+1).toLowerCase();return i.toDataURL("image/"+r)}(t);_(n.title),y(e)},"M0001"===r&&(async e=>{let t=Q({project_type:"3d"},e);const i=await(0,G.ZL)(U.yy.list,{params:t});if(i.code===G.Mx.Ok){let e=i.data||[],t=[];for(let i of e)t.push(i.id);X(t)}})({project_id:e})}),[]);return w.createElement(M.Z,{open:!0,onClose:t},w.createElement(L.Z,null,"\u53d1\u5e03"),w.createElement(F.Z,null,w.createElement(O.Z,{sx:{m:1}},w.createElement(B.Z,{htmlFor:"component-simple"},"\u540d\u79f0"),w.createElement(T.Z,{sx:{width:"500px"},id:"outlined-multiline-static",size:"small",value:s,onChange:e=>{a(e.target.value)}})),w.createElement(A.ZP,{container:!0,sx:{ml:1,width:"500px"}},w.createElement(A.ZP,{item:!0,xs:6},w.createElement(B.Z,{id:"demo-simple-select-autowidth-label"},"\u884c\u4e1a"),w.createElement(k.Z,{sx:{width:"240px"}},w.createElement(N.Z,{labelId:"demo-simple-select-autowidth-label",id:"demo-simple-select-autowidth",value:v,onChange:e=>{b(e.target.value)},autoWidth:!0,size:"small"},C()(x).call(x,(e=>w.createElement(S.Z,{key:e.id,value:e.value,sx:{width:"240px"}},e.label)))))),w.createElement(A.ZP,{item:!0,xs:6},w.createElement(B.Z,{htmlFor:"component-simple"},"\u5f15\u7528\u79ef\u5206"),w.createElement(T.Z,{sx:{width:"250px"},id:"outlined-multiline-static",size:"small",value:z,onChange:e=>{Z(Number(e.target.value))},type:"number"}))),w.createElement(O.Z,{sx:{m:1}},w.createElement(B.Z,{htmlFor:"component-simple"},"\u6807\u7b7e"),w.createElement(q,{onChange:e=>{d(e.join(","))}})),w.createElement(O.Z,{sx:{m:1}},w.createElement(B.Z,{htmlFor:"component-simple"},"\u63cf\u8ff0"),w.createElement(T.Z,{sx:{width:"500px"},id:"outlined-multiline-static",multiline:!0,rows:3,value:p,onChange:e=>{f(e.target.value)}})),w.createElement(O.Z,{sx:{m:1}},w.createElement(B.Z,{htmlFor:"component-simple"},"\u5c01\u9762"),w.createElement(O.Z,{sx:{display:"flex","& > :not(style)":{m:1,width:240,height:135}}},w.createElement("label",{style:{cursor:"pointer",opacity:0,position:"absolute"}},w.createElement("input",{type:"file",onChange:e=>{const t=e.target.files[0];if(!t)return;_(t.name);const i=new FileReader;i.readAsDataURL(t),i.onload=function(e){"string"==typeof e.target.result&&y(e.target.result)}},accept:W,style:{display:"none"}})),w.createElement($,{elevation:3},!g&&"\u6587\u4ef6\u4e0a\u4f20",g&&w.createElement(R.Z,{image:g,sx:J}))))),w.createElement(D.Z,null,w.createElement(I.Z,{color:"primary",onClick:()=>{t()}},"\u53d6\u6d88"),w.createElement(I.Z,{color:"primary",onClick:Y},"\u786e\u8ba4\u53d1\u5e03")))}},20913:(e,t,i)=>{i.d(t,{Z:()=>x});var r=i(86191),n=i(68867),s=i(37211),a=i(58181),o=i(28926),l=i(73764),h=i(75393),c=i(32735),u=i(6475),d=i(54056),p=i(29115),f=i(40652),m=i(70995),_=i(73554),g=i(6512),y=i(39829),v=i(5224),b=i(23920),E=i(19970);const x=({open:e,onClose:t,shop:i,defaultProjectId:x,fileStore:C,commonStore:w,onCloseMark:S,needProject:T,onSuccess:P})=>{const[A,R]=(0,c.useState)(!0),[M,O]=(0,c.useState)(i?.product_name),[I,D]=(0,c.useState)(null),[F,L]=(0,c.useState)(null),k=async(e=!1)=>{if(!i)return;if(i?.real_type!==E.f.Project&&(T&&!F&&!x||!(i?.real_type!==E.f.Component&&i?.real_type!==E.f.Model||I)))return void _.y.error("\u8bf7\u5148\u9009\u62e9\u9879\u76ee\u6216\u8005\u76ee\u5f55!");if(!M)return void _.y.error("\u8bf7\u8f93\u5165\u540d\u79f0!");const t={name:M,id:i.real_code,projectId:F??x};let r;if(i?.real_type===E.f.File)r=t=>{C.loadFileList().then((i=>{t&&e?(C.load(t),(0,m.sA)(t),S?.(),_.y.success("\u65b0\u5efa\u573a\u666f\u5e94\u7528\u5e76\u6253\u5f00\u6210\u529f!")):_.y.success("\u5e94\u7528\u65b0\u5efa\u6210\u529f\uff0c\u8bf7\u5230\u573a\u666f\u5217\u8868\u67e5\u770b")}))};else if(i?.real_type===E.f.Project)t.projectId=void 0,r=t=>{e&&t?location.search="?projectId="+t:_.y.success("\u9879\u76ee\u521b\u5efa\u6210\u529f,\u8bf7\u5230\u9879\u76ee\u5217\u8868\u67e5\u770b")};else{if(!I)return void _.y.error("\u8bf7\u5148\u9009\u62e9\u76ee\u5f55");t.pid=I,r=i?.real_type===E.f.Component?t=>{t&&e?((0,m.$)(t,d.gV.intance),S?.(),_.y.success("\u65b0\u5efa\u7ec4\u4ef6\u5e76\u5e94\u7528\u5230\u573a\u666f")):_.y.success("\u65b0\u5efa\u7ec4\u4ef6\u6210\u529f\uff0c\u8bf7\u5230\u6a21\u578b\u8d44\u6e90\u4e0b\u67e5\u770b"),w.load()}:t=>{t&&e?((0,m.D4)(t,d.gV.intance),S?.(),_.y.success("\u5e94\u7528\u6a21\u578b\u5e76\u5e94\u7528\u5230\u573a\u666f\u6210\u529f")):_.y.success("\u5e94\u7528\u6a21\u578b\u6210\u529f,\u8bf7\u5230\u6a21\u578b\u8d44\u6e90\u67e5\u770b"),f.G.trigger({type:"ApplyModel",target:null})}}const n=await(0,p.qu)(u.ZQ.pull,t);n.code===p.Mx.Ok&&(r(n.data?.id),P?.(F))},B=e=>{D(e)};return(0,c.useEffect)((()=>{O(i?.product_name??"")}),[i]),c.createElement(n.Z,{open:e,onClose:t,maxWidth:"md",fullWidth:!0},c.createElement(g.Z,{onClose:t,title:"\u5e94\u7528\u7d20\u6750"}),c.createElement(a.Z,{sx:{overflow:"initial"}},c.createElement(b.U,null,i?.real_type===E.f.File&&c.createElement(o.Z,{label:"\u4f7f\u7528\u5f53\u524d\u9879\u76ee",checked:A,control:c.createElement(r.Z,null),onChange:(e,t)=>R(t)}),c.createElement(l.Z,{value:M,onChange:e=>O(e.target.value),label:"\u65b0\u540d\u79f0",size:"small"})),(!A||T)&&i?.real_type!==E.f.Project&&c.createElement(y.Z,{selectId:F,onClick:e=>{L(e)}}),i?.real_type===E.f.Component&&c.createElement(v.Z,{sourceType:u.fL.Component,projectId:F??x,onClick:B,selectId:I}),i?.real_type===E.f.Model&&c.createElement(v.Z,{sourceType:u.fL.Model,projectId:F??x,onClick:B,selectId:I})),c.createElement(s.Z,null,c.createElement(h.Z,{onClick:()=>k(!1)},"\u5e94\u7528"),c.createElement(h.Z,{onClick:()=>k(!0)},i?.real_type===E.f.Project?"\u5e94\u7528\u5e76\u6253\u5f00":"\u5e94\u7528\u5e76\u6dfb\u52a0\u5230\u573a\u666f")))}},90546:(e,t,i)=>{i.d(t,{Z:()=>o});var r=i(94063),n=i(45709),s=i(32735),a=i(19853);const o=({shop:e})=>s.createElement(r.Z,{textAlign:"center"},s.createElement(n.Z,{sx:{color:"#222",mb:2},variant:"h6"},"\u5f53\u524d\u7d20\u6750: ",e.product_name),s.createElement(r.Z,{sx:{backgroundImage:`url(${a.q$}coin.svg)`,backgroundSize:"50%",backgroundRepeat:"no-repeat",backgroundPositionX:"center",display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center"},height:"150px"},s.createElement(n.Z,{sx:{color:"#744400"},variant:"h4"},e.score),s.createElement(n.Z,{sx:{color:"#744400"},variant:"h6"},"\u672c\u6b21\u6d88\u8017\u79ef\u5206")))},19970:(e,t,i)=>{let r,n;i.d(t,{I:()=>n,f:()=>r}),function(e){e.Project="M0001",e.File="M0002",e.Component="M0003",e.Model="M0004"}(r||(r={})),function(e){e[e.Coll=0]="Coll",e[e.Buyed=1]="Buyed",e[e.Shop=2]="Shop"}(n||(n={}))},50717:(e,t,i)=>{i.d(t,{Z:()=>g});var r=i(75393),n=i(58181),s=i(57426),a=i(28926),o=i(42854),l=i(73764),h=i(45709),c=i(68867),u=i(32735),d=i(6475),p=i(29115),f=i(73554),m=i(83228),_=i(23920);const g=({onClose:e,open:t,target:i})=>{const[g,y]=(0,u.useState)(!1),[v,b]=(0,u.useState)(""),[E,x]=(0,u.useState)(""),C=async()=>{const e=await(0,p.qu)(d.yy.share,{id:i,secret:g?v:""});if(e.code===p.Mx.Ok){const t=e.data.key;x(t)}},w=(e=E)=>{let t=location.origin+"/share.html";return e&&(t+=`?k=${e}`),t};return(0,u.useEffect)((()=>{C()}),[]),u.createElement(c.Z,{open:!0,onClose:e},u.createElement(s.Z,null,"\u5206\u4eab"),u.createElement(n.Z,null,u.createElement(_.U,{alignItems:"center",sx:{mb:2}},u.createElement(h.Z,{sx:{mr:2}},"\u94fe\u63a5"),u.createElement(l.Z,{value:w(),size:"small",sx:{flex:1}})),u.createElement(_.U,{alignItems:"center"},u.createElement(a.Z,{label:"\u52a0\u5bc6",checked:g,control:u.createElement(o.Z,null),onChange:(e,t)=>y(t)}),u.createElement(_.U,{alignItems:"center"},u.createElement(h.Z,{sx:{mr:2}},"\u8bbe\u7f6e\u5bc6\u7801"),u.createElement(l.Z,{value:v,disabled:!g,size:"small",onChange:e=>b(e.target.value),onBlur:C})),u.createElement(r.Z,{variant:"contained",onClick:()=>{(0,m.zp)(w(E)).then((e=>{f.y.success("\u5df2\u590d\u5236\u5206\u4eab\u94fe\u63a5!")})),e()},sx:{ml:2}},"\u590d\u5236\u94fe\u63a5"))))}},30268:(e,t,i)=>{i.d(t,{_i:()=>a,rU:()=>n,y1:()=>s});var r=i(32735);const n=(0,r.createContext)(null),s={entity:null,gui:null,dom:null,position:{x:"",y:"",z:""},rotation:{x:"",y:"",z:""},scale:{x:"",y:"",z:""},name:"",visiable:!0,pickable:!0,enableShadow:!0,type:"",render2DType:"dom"},a=()=>(0,r.useContext)(n)},92509:(e,t,i)=>{i.d(t,{M:()=>s,T:()=>n});var r=i(32735);const n=(0,r.createContext)(null),s=()=>(0,r.useContext)(n)},67341:(e,t,i)=>{i.d(t,{D:()=>n,Y:()=>s});var r=i(32735);const n=r.createContext(null),s=()=>r.useContext(n)},62211:(e,t,i)=>{i.d(t,{j:()=>s,k:()=>n});var r=i(32735);const n=r.createContext(null),s=()=>r.useContext(n)},59548:(e,t,i)=>{i.d(t,{O:()=>n,R:()=>s});var r=i(32735);const n=r.createContext(null),s=()=>r.useContext(n)},16802:(e,t,i)=>{i.d(t,{m:()=>s,x:()=>n});var r=i(32735);const n=r.createContext(null),s=()=>r.useContext(n)},69326:(e,t,i)=>{i.d(t,{E:()=>m});var r,n,s=i(29405),a=i.n(s),o=i(20246),l=i.n(o),h=i(14549),c=i.n(h),u=i(66989),d=i.n(u),p=i(57055),f=i(42977);let m=(0,p.Factory)(((n=class extends p.BaseDom{constructor(e){super(),this._source=void 0,this.graphView=void 0,this.hcNode=void 0,this._dataBindings=void 0,this._setAttr={},this.load=e=>{if(!e)return;const t="object"==typeof e.width?e.width.value:e.width,i="object"==typeof e.height?e.height.value:e.height;this._width||(this._width=t),this._height||(this._height=i),this._dataBindings=e.dataBindings;const r=this.graphView.getView();r.style.cssText=`\n    position:absolute;\n    left:${this._position.x}px;\n    top:${this._position.y}px;\n    width:${this._width}px;\n    height:${this._height}px;\n    outline:none;\n    `,this.Visiable||(r.style.visibility="hidden"),a()((()=>{r.style.visibility="visible",r.style.display=this.Visiable&&!this.IsErase?"block":"none"}),0),this.graphView.fitContent(!1,0),this.update()},e?.url&&(this._source=e.url),window.gui=this}get DataBindings(){return this._dataBindings??[]}get Attr(){return this._setAttr}setProp(e,t){this.updateAttr({[e]:t})}updateAttr(e){0!==l()(e).length&&this.graphView&&this.hcNode&&(c()(this._setAttr,e),this.hcNode.a(e))}initDrawObject(){const e=(0,f.yD)();return this.graphView=e,(0,f.Tt)(e.dm(),this._source).then((e=>{if(!e)return;this.hcNode=e,e.target3d=this;const t=(0,f.Er)(e.getImage());this.load(t)})),e.getView()}updateDrawObject(e){super.updateDrawObject(e);const t=this.convertValue(this._width,p.AppStore.MainViewer.Width),i=this.convertValue(this._height,p.AppStore.MainViewer.Height);this.graphView.setWidth(t),this.hcNode.setWidth(t),this.graphView.setHeight(i),this.hcNode.setHeight(i),this.graphView.fitContent(!1,0),this.updateAttr(this._setAttr)}getTexture(){return null}writeFile(e){super.writeFile(e),e.write(2),e.write(this._source),e.write(d()(this._setAttr))}readFile(e){super.readFile(e);const t=e.read();this._source=e.read(),t>1&&(this._setAttr=JSON.parse(e.read())),this.update()}}).type="HC2DDom",r=n))||r},29556:(e,t,i)=>{i.d(t,{v:()=>g});var r,n,s=i(29405),a=i.n(s),o=i(20246),l=i.n(o),h=i(14549),c=i.n(h),u=i(32849),d=i.n(u),p=i(66989),f=i.n(p),m=i(57055),_=i(42977);let g=(0,m.Factory)(((n=class extends m.BaseGui{constructor(e){super(),this._source=void 0,this.graphView=void 0,this.hcNode=void 0,this._dataBindings=void 0,this._setAttr={},this.timer=void 0,this.load=e=>{if(!e)return;const t="object"==typeof e.width?e.width.value:e.width,i="object"==typeof e.height?e.height.value:e.height;this._dataBindings=e.dataBindings;const r=this.graphView.getView();this._width=t+"px",this._height=i+"px",r.style.cssText=`position:fixed;left:0;top:0;width:${t}px;height:${i}px;visibility:hidden`,this.graphView.getCanvas().width=t,this.graphView.getCanvas().height=i,document.body.append(r),a()((()=>{r.remove()}),2e3)},e?.url&&(this._source=e.url)}get DataBindings(){return this._dataBindings??[]}get Attr(){return this._setAttr}setProp(e,t){this.updateAttr({[e]:t})}updateAttr(e){if(0===l()(e).length||!this.graphView||!this.hcNode)return;const t=this.graphView.getView();document.body.append(t),this.timer&&clearTimeout(this.timer),this.timer=a()((()=>{t.remove()}),2e3),c()(this._setAttr,e),this.hcNode.a(e)}initDrawObject(){const e=(0,_.yD)(),t=m.Utils.getGuiContainer(this.UniqueName);return t.horizontalAlignment=0,t.verticalAlignment=0,e.addViewListener((e=>{"validate"===e?.kind&&this.updateDrawObject(t)})),this.graphView=e,(0,_.Tt)(e.dm(),this._source).then((e=>{if(!e)return;this.hcNode=e;const i=(0,_.Er)(e.getImage());this.load(i),this.generateLinkLine(t,100)})),t}updateDrawObject(e){let t,i;super.updateDrawObject(e),this.linkEntity?e.linkWithMesh(this.linkEntity.Object.DrawObject):e.linkWithMesh(null),this.graphView.fitContent(!1,0);const r=this.graphView.__htmlOrderList?.[0];if(r&&r instanceof HTMLElement?(t=this.graphView.__htmlOrderList[0].getElementsByTagName("canvas")[0],"VIDEO"===r.nodeName&&(i=r)):t=this.graphView.getCanvas(),t||(t=this.graphView.getCanvas()),0===e.children.length)if(i){d()(this.DataBindings);const t=new m.Video(this.UniqueName+"_video",i.src,this._width,this._height,m.AppStore.MainScene);e.addControl(t),t.width=this._width,t.height=this._height}else{const i=new m.CanvasControl(this.UniqueName,t,m.AppStore.MainScene);e.addControl(i),i.width=this._width,i.height=this._height}else{const r=e.children[0];i?r.source=i.src:r.CanvasDom=t}e.width=this._width,e.height=this._height,this.updateAttr(this._setAttr)}getTexture(){return null}get IsSelect(){return this._isSelect}set IsSelect(e){if(this._isSelect=e,!this._drawObject)return;const t=this._drawObject;t.background=e?"#9595d8":""}writeFile(e){super.writeFile(e),e.write(1),e.write(this._source),e.write(f()(this._setAttr))}readFile(e){super.readFile(e),e.read(),this._source=e.read(),this._setAttr=JSON.parse(e.read()),this.update()}}).type="HC2DGui",r=n))||r},42977:(e,t,i)=>{i.d(t,{Er:()=>y,Tt:()=>g,yD:()=>_});var r=i(39282),n=i.n(r),s=i(13567),a=i.n(s),o=i(71722),l=i.n(o),h=i(57055),c=i(54056),u=i(73554),d=i(84199),p=i(92513);const f=window.ht;window.storagePrefix=h.AppConfig.assetURL,f.Default.convertURL=function(e){let t=h.AppConfig.assetURL;return!t||!e||/^data:image/.test(e)||/^http/.test(e)||/^https/.test(e)||(e=t+"/"+e),e};new(n());const m=a()();function _(){const e=new f.DataModel,t=new f.graph.GraphView(e);return t.getSelectWidth=()=>0,t.setMovableFunc((e=>!1)),t.setPannable(!1),t.setRectSelectable(!1),t.setScrollBarVisible(!1),t.handleScroll=()=>!1,t.onDataClicked=(e,t)=>{if(!e)return;h.AppEvent.trigger({type:"click",target:e.target3d,event:t});const i=e.target3d;i.trigger({type:"click",target:e.target3d,event:t}),h.AppStore.PreviewMode||(i.start(t.clientX,t.clientY),c.gV.intance.Editor.selectControl&&(c.gV.intance.Editor.selectControl.SelectDOM=i))},t.getView().addEventListener("keydown",(e=>{"Delete"===e.key?(h.CMD.commandManager.ExecCommand(d.d.Delete),e.stopPropagation()):"KeyC"===e.code&&e.ctrlKey?(h.CMD.commandManager.ExecCommand(d.d.Copy),e.stopPropagation()):"KeyV"===e.code&&e.ctrlKey&&(h.CMD.commandManager.ExecCommand(d.d.Paste),e.stopPropagation())})),t}async function g(e,t){t=(e=>e+"?timestap="+m)(t);const i=new f.Node;e.add(i);const r=(0,p.F)();return new(l())((e=>{f.Default.xhrLoad(t,(function(t){t?(f.Default.setImage(r,f.Default.parse(t)),i.setImage(r),e(i)):(u.y.error("2d\u8d44\u6e90\u672a\u627e\u5230"),e(null))}))}))}function y(e){return f.Default.getImage(e)}},17871:(e,t,i)=>{i.d(t,{Z:()=>s});var r=i(10800),n=i(32735);const s=e=>{const[t,i]=(0,n.useState)(null),s=()=>{i(null)};return[r=>{r.preventDefault(),i(null===t?{mouseX:r.clientX-2,mouseY:r.clientY-4}:null),e?.(r)},s,({children:e})=>n.createElement(r.Z,{open:null!==t,onClose:s,anchorReference:"anchorPosition",anchorPosition:null!==t?{top:t.mouseY,left:t.mouseX}:void 0},e)]}},96796:(e,t,i)=>{var r=i(32735),n=i(44645),s=i(89861),a=i(86157),o=i(18613),l=i(35901),h=i(60530),c=i(51463),u=i.n(c),d=i(3346),p=i(74857),f=i(94063),m=i(56622),_=i(36717),g=i(26095),y=i(23122),v=i(32849),b=i.n(v),E=i(74898),x=i(18713),C=i(3450),w=i(46269),S=i(61799),T=i.n(S),P=i(29405),A=i.n(P),R=i(10800),M=i(11528),O=i(16802),I=i(45709),D=i(29115),F=i(6475),L=i(31025);const k=(0,w.Pi)((e=>{const t=(0,d.s0)(),[i,n]=r.useState(null),[s,a]=r.useState([]),{rootStore:o}=(0,O.m)(),l=Boolean(i),[h,c]=r.useState({page:1,limit:20,project_type:"3d"}),p=async()=>{const e=await(0,D.ZL)(F.U.list,{params:h});if(e.code===D.Mx.Ok){var t;let i=T()(t=e.data.list).call(t,(e=>e.id!==o.projectId));a(i)}else a([])};let f;(0,r.useEffect)((()=>{(0,L.U5)((()=>o.projectId),(()=>{p()}))}),[h]),(0,r.useEffect)((()=>{p()}),[h]);return r.createElement(r.Fragment,null,r.createElement(I.Z,{onMouseEnter:e=>{let t=e.currentTarget;f=A()((()=>{n(t)}),500)},onMouseLeave:()=>{clearTimeout(f)},variant:"h6",noWrap:!0,component:"div",sx:{mr:2,color:"#444",display:{xs:"none",md:"flex"},cursor:"pointer"}},o.projectName||"Untitled"),r.createElement(R.Z,{id:"basic-menu",anchorEl:i,open:l,onClose:()=>{n(null)},MenuListProps:{"aria-labelledby":"basic-button"},sx:{cursor:"pointer"}},r.createElement(M.Z,{sx:{fontSize:"12px"},onClick:()=>{t("/list/project")}},"\u5168\u90e8\u9879\u76ee"),u()(s).call(s,(e=>r.createElement(M.Z,{key:e.id,sx:{fontSize:"12px"},onClick:()=>{t("/editor"),window.location.search="?projectId="+e.id}},e.name)))))}));var B=i(25661),N=i(19970),z=i(50717),U=i(73554),G=i(58181),j=i(57426),V=i(73764),Z=i(68867),W=i(70485);const H=({onClose:e,open:t})=>{const[i,n]=(0,r.useState)("");return r.createElement(Z.Z,{open:!0,onClose:e},r.createElement(j.Z,null,"\u547d\u4ee4\u6846"),r.createElement(G.Z,null,r.createElement(V.Z,{value:i,onChange:e=>n(e.target.value),onKeyDown:t=>{"Enter"===t.code&&((()=>{switch(i.toUpperCase()){case"EXPORT":W.T.exportFile();break;case"IMPORT":W.T.importFile();break;case"DEBUGSCRIPT":localStorage.setItem("DEBUGSCRIPT","1"),location.reload();break;case"DEBUGBBL":localStorage.setItem("DEBUGBBL","1"),location.reload()}})(),e())}})))};var K=i(20246),q=i.n(K),X=i(39831),Y=i.n(X),Q=i(26117),$=i.n(Q),J=i(5996),ee=i.n(J),te=i(20658),ie=i.n(te),re=i(3434),ne=i.n(re),se=i(97828),ae=i.n(se),oe=i(93213),le=i(43966);function he(e,t){var i=q()(e);if(Y()){var r=Y()(e);t&&(r=T()(r).call(r,(function(t){return $()(e,t).enumerable}))),i.push.apply(i,r)}return i}function ce(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?ee()(i=he(Object(n),!0)).call(i,(function(t){(0,oe.Z)(e,t,n[t])})):ie()?ne()(e,ie()(n)):ee()(r=he(Object(n))).call(r,(function(t){ae()(e,t,$()(n,t))}))}return e}const ue=({iconName:e,title:t,sx:i,onClick:n,color:s,disabled:a})=>{const[o,l]=(0,r.useState)(12);void 0===a&&(a=!1);let h=a?"rgba(0, 0, 0, 0.26);":s??"#000";return r.createElement(f.Z,{onClick:a?()=>{}:n,sx:ce(ce({},i),{},{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pr:1,pl:1,cursor:a?"not-allowed":"pointer","&:hover":{background:"rgba(7, 177, 77, 0.1)"},color:h,borderRadius:"10%",outline:s?"1px solid "+s:void 0})},"string"==typeof e?r.createElement(le.Z,{name:e,color:h}):r.createElement(e,{sx:{fontSize:20}}),r.createElement(I.Z,{sx:{m:0,p:0,fontSize:o}},t))};var de=i(57055),pe=i(64496);const fe=(0,r.createContext)(null);var me=i(54056);const _e=[{title:"\u51e0\u4f55\u5b9e\u4f53",key:"geometry",children:[{title:"\u76d2\u5b50",key:"Box",icon:le.Z,iconName:"icon-3Dhezi"},{title:"\u7403",key:"Sphere",icon:le.Z,iconName:"icon-3Dqiuti"},{title:"\u5e73\u9762",key:"Plane",icon:le.Z,iconName:"icon-3Dqiangmian"},{title:"\u5706\u67f1",key:"Cylinder",icon:le.Z,iconName:"icon-3Dyuanzhu"},{title:"\u80f6\u56ca",key:"Capsule",icon:le.Z,iconName:"icon-3Dziyuan1"},{title:"\u5730\u9762",key:"Ground",icon:le.Z,iconName:"icon-3Ddimian"}]},{title:"\u706f\u5149",key:"light",children:[{title:"\u70b9\u5149\u6e90",key:"PointLight",icon:le.Z,iconName:"icon-3Ddianguangyuan"},{title:"\u5c04\u706f",key:"SpotLight",icon:le.Z,iconName:"icon-3Dshedeng"},{title:"\u65b9\u5411\u5149",key:"DirectionalLight",icon:le.Z,iconName:"icon-3Dfangxiangdeng"}]},{title:"\u6750\u8d28",key:"material",children:[{title:"PRB\u6750\u8d28",key:"PBRMaterialRecord",icon:le.Z,iconName:"icon-3Dkujialeqiyezhan_caizhishua"}]}];var ge=i(44700),ye=i(25467),ve=i(40417),be=i(13126),Ee=i(79621),xe=i(41363),Ce=i(13892),we=i(75393),Se=i(76373),Te=i(67970),Pe=i(76344),Ae=i(54671),Re=i(23920),Me=i(97965),Oe=i.n(Me),Ie=i(95279),De=i(20151),Fe=i(25783),Le=i(92491),ke=i(33591),Be=i.n(ke),Ne=i(27660),ze=i(93765),Ue=i(17665),Ge=i(40652),je=i(1453),Ve=i(537),Ze=i(8578),We=i(20913),He=i(66989),Ke=i.n(He),qe=i(97245),Xe=i(35851),Ye=i(93557),Qe=i(11881),$e=i(13697),Je=i(47513),et=i(96433),tt=i(32616),it=i(90546);let rt;!function(e){e[e.True=0]="True",e[e.False=1]="False",e[e.Disable=2]="Disable",e[e.None=3]="None"}(rt||(rt={}));let nt=!1;const st=({shop:e,applyStart:t,update:i,isCollect:n,isBuy:s})=>{const[a,o]=(0,r.useState)(!1),[l,h]=(0,r.useState)(!1),c=async()=>{if(n===rt.True){(await(0,D.QO)(F.ZQ.cancelCollect+e.product_code)).code===D.Mx.Ok&&(U.y.success("\u53d6\u6d88\u6536\u85cf\u6210\u529f"),i())}else if(n===rt.False){(await(0,D.qu)(F.ZQ.collect,{productCode:e.product_code})).code===D.Mx.Ok&&(U.y.success("\u5546\u54c1\u6536\u85cf\u6210\u529f"),i())}};return r.createElement($e.Z,{sx:{position:"relative"},onMouseEnter:()=>{o(!0)},onMouseLeave:()=>{o(!1)},onDragStart:t=>{e.isBuy="boolean"!=typeof s||s,t.dataTransfer.setData("text/plain",Ke()({key:"shop",shop:e}))}},r.createElement(Xe.Z,null,r.createElement(et.Z,{component:"img",height:"140",image:e.pic?me.gV.prefix+e.real_code+"/"+e.pic:"https://mui.com/static/images/cards/contemplative-reptile.jpg",alt:"green iguana"}),r.createElement(Je.Z,null,r.createElement(I.Z,{gutterBottom:!0,variant:"subtitle1",component:"div"},e.product_name||"\u65e0\u6548\u7d20\u6750"),r.createElement(I.Z,{variant:"body2"},e.possessor_code))),r.createElement(Ye.Z,{sx:{justifyContent:"space-between"}},r.createElement(I.Z,{sx:{color:"#424B54"}},"\u79ef\u5206:",r.createElement("span",{style:{color:"#FF6600",marginLeft:5}},e.score)),r.createElement(Re.U,null,(()=>{if(n!==rt.None)return r.createElement(Qe.Z,{title:n===rt.True?"\u53d6\u6d88\u6536\u85cf":"\u6536\u85cf",placement:"bottom"},r.createElement("span",null,r.createElement(Te.Z,{disabled:n===rt.Disable,style:n===rt.Disable?{pointerEvents:"none"}:{},onClick:c},n===rt.True?r.createElement(qe.Z,{color:"error"}):r.createElement(be.Z,null))))})(),("boolean"!=typeof s||!s)&&r.createElement(Qe.Z,{title:"\u8d2d\u4e70",placement:"bottom"},r.createElement("span",null,r.createElement(Te.Z,{onClick:()=>{h(!0),nt=!0},sx:{color:"#FF6600"},disabled:null===s},r.createElement(xe.Z,null)))))),a&&r.createElement(f.Z,{sx:{position:"absolute",left:0,right:0,bottom:0,top:20,margin:"auto",width:"20%",height:30,display:"flex",justifyContent:"center"}},r.createElement(we.Z,{variant:"contained",sx:{mr:1},onClick:()=>(e=>{if(!e)return void U.y.error("\u786e\u5b9e\u5546\u54c1\u6570\u636e");const t=(window.screen.availHeight-30-800)/2,i=(window.screen.availWidth-10-800)/2,r=window.open("about:blank",`menubar=0,scrollbars=1, resizable=1,status=1,titlebar=0,toolbar=0,location=no,width=800,height=800,left=${i},top=${t}`);r.location.href="/shop.html?code="+e;const n=e=>{"close_preview"===e?.data.type&&(r.close(),je.h.removeEventListener("message",n))};je.h.addEventListener("message",n)})(e.product_code)},"\u9884\u89c8"),r.createElement(we.Z,{variant:"contained",onClick:async()=>{s?t(e):(nt=!1,h(!0))}},"\u5e94\u7528")),l&&r.createElement(tt.Z,{open:l,onOk:async()=>{await(async()=>(await(0,D.qu)(F.ZQ.buy,{productCode:e.product_code})).code===D.Mx.Ok&&(U.y.success("\u5546\u54c1\u8d2d\u4e70\u6210\u529f"),i(),!0))()&&(h(!1),nt||t(e))},onCancel:()=>{h(!1)},content:r.createElement(it.Z,{shop:e}),title:"\u60a8\u5373\u5c06\u8d2d\u4e70"}))},at=({trade:e,category:t,xs:i=4,api:n,type:s,query:a})=>{const[o,l]=(0,r.useState)([]),[h,c]=(0,r.useState)({open:!1,info:null}),[d,p]=(0,r.useState)([]),[f,m]=(0,r.useState)([]),{closeMarket:_}=(0,r.useContext)(fe),g=async(i="")=>{let r="0"===e?{category:t,name:i,limit:100,page:1,Size:100,Current:1}:{category:t,trade:e,name:i,limit:100,page:1,Size:100,Current:1},s=await(0,D.ZL)(n,{params:r});s.code===D.Mx.Ok&&s.data?.list?(l(s.data.list),p(s.data.Boughten??[]),m(s.data.Collects??[])):(l([]),p([]),m([]))},y=e=>s===N.I.Coll?rt.True:s===N.I.Buyed?rt.None:e.possessor_code===Ue.H.userCode?rt.Disable:f&&Be()(f).call(f,e.product_code)?rt.True:rt.False,v=e=>{c({open:!0,info:e})};return(0,r.useEffect)((()=>{g(a)}),[e]),(0,r.useEffect)((()=>{(0,Ve.N)((()=>{g(a)}),300)}),[n,a]),(0,r.useEffect)((()=>{const e=Ge.G.on("BuySuccess",(()=>{g()}));return()=>{e()}}),[]),(0,r.useEffect)((()=>{const e=e=>{"update-list"===e?.data.type?g():"apply-shop"===e?.data.type&&v(e?.data.shop)};return je.h.addEventListener("message",e),()=>{je.h.removeEventListener("message",e)}}),[]),r.createElement(r.Fragment,null,0===o.length&&r.createElement(Ze.Z,null),r.createElement(Ie.ZP,{container:!0,spacing:1},u()(o).call(o,((e,t)=>{return r.createElement(Ie.ZP,{item:!0,xs:i,key:e.record_id||t},r.createElement(st,{shop:e,applyStart:v,update:g,isBuy:(n=e,s===N.I.Buyed||(n.possessor_code===Ue.H.userCode?null:d&&Be()(d).call(d,n.product_code)||!!n.is_bought)),isCollect:y(e)}));var n}))),r.createElement(We.Z,{open:h.open,shop:h?.info,onClose:()=>{c({open:!1,info:null})},onCloseMark:_,fileStore:W.T,commonStore:Ne.l,defaultProjectId:ze.U.projectId}))};function ot(e,t){var i=q()(e);if(Y()){var r=Y()(e);t&&(r=T()(r).call(r,(function(t){return $()(e,t).enumerable}))),i.push.apply(i,r)}return i}function lt(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?ee()(i=ot(Object(n),!0)).call(i,(function(t){(0,oe.Z)(e,t,n[t])})):ie()?ne()(e,ie()(n)):ee()(r=ot(Object(n))).call(r,(function(t){ae()(e,t,$()(n,t))}))}return e}const ht=({type:e,contentType:t,query:i,sx:n={}})=>{const[s,a]=(0,r.useState)([]),[o,l]=(0,r.useState)(-1),[h,c]=(0,r.useState)(""),[d,f]=r.useState([]),v=()=>{switch(e){case N.I.Coll:return F.ZQ.collections;case N.I.Buyed:return F.ZQ.buyList;case N.I.Shop:return F.ZQ.list;default:return""}};(0,r.useEffect)((()=>{(async()=>{const e=await(0,D.ZL)(F.ZQ.trade);if(e.code===D.Mx.Ok){let t=e.data&&e.data.list;f([...t]),c("0")}})(),(async()=>{const e=await(0,D.ZL)(F.ZQ.category);if(e.code===D.Mx.Ok&&e.data?.list){var t;const i=T()(t=e.data.list).call(t,(e=>"\u7269\u6a21\u578b"!==e.label));Oe()(i).call(i),a(i),l(i[0]?.id)}else a([])})()}),[]);return r.createElement(r.Fragment,null,r.createElement(m.Z,{sx:lt({borderBottom:1,borderColor:"divider"},n)},r.createElement(g.Z,{value:o,onChange:(e,t)=>{l(t)},"aria-label":"resource list",centered:!0},u()(s).call(s,(e=>r.createElement(_.Z,(0,p.Z)({key:e.id,label:e.label,value:e.id},(0,y.P)(e.id)))))),r.createElement(De.Z,null),r.createElement(Ie.ZP,{container:!0,sx:{ml:1,mt:1,mb:.5,width:"300px"}},r.createElement(Ie.ZP,null,r.createElement(Fe.Z,{sx:{width:"300px"}},r.createElement(Le.Z,{labelId:"demo-simple-select-autowidth-label",id:"demo-simple-select-autowidth",value:h,onChange:e=>{c(e.target.value)},autoWidth:!0,size:"small"},r.createElement(M.Z,{key:0,value:"0",sx:{width:"300px"}},"\u5168\u90e8\u884c\u4e1a"),u()(d).call(d,(e=>r.createElement(M.Z,{key:e.id,value:e.value,sx:{width:"300px"}},e.label))))))),u()(s).call(s,((n,s)=>r.createElement(y.x,{key:n.id,value:o,currentValue:n.id,style:{flex:1,overflowY:"auto"}},r.createElement(at,{trade:h,api:v(),category:"M0004"===n.value?"M0003,M0004":n.value,xs:0===t||1===t?3:12,type:e,query:i}))))))},ct=[{label:"\u5df2\u6536\u85cf",value:N.I.Coll,icon:r.createElement(be.Z,null)},{label:"\u5df2\u8d2d\u4e70",value:N.I.Buyed,icon:r.createElement(xe.Z,null)},{label:"\u6240\u6709\u7d20\u6750",value:N.I.Shop,icon:r.createElement(Ce.Z,null)}],ut=r.forwardRef((function(e,t){return r.createElement(Pe.Z,(0,p.Z)({direction:"up",ref:t},e))})),dt=({onClose:e,open:t})=>{const[i,n]=(0,r.useState)(!1),[s,a]=(0,r.useState)(!0),[o,l]=(0,r.useState)(N.I.Shop),[h,c]=(0,r.useState)(""),d=()=>{a(!s)},p=e=>{c(e.target.value)},f=e=>{l(e)};return s?r.createElement(Se.ZP,{anchor:"right",open:t,onClose:e,ModalProps:{hideBackdrop:!0},PaperProps:{sx:{width:320}},sx:{width:0},disableAutoFocus:!0,disableEnforceFocus:!0},r.createElement(E.Z,{sx:{position:"relative",width:"100%"}},r.createElement(x.Z,null,r.createElement(I.Z,{sx:{ml:2,flex:1},variant:"h6",component:"div"},"\u5e02\u573a"),r.createElement(Te.Z,{edge:"start",color:"inherit",onClick:d,"aria-label":"close",sx:{ml:"5px"}},r.createElement(ve.Z,null)),r.createElement(Te.Z,{edge:"start",color:"inherit",onClick:e,"aria-label":"close",sx:{ml:"5px"}},r.createElement(ge.Z,null)))),r.createElement(Re.U,null,r.createElement(Ae.Z,{value:h,onChange:p,sx:{ml:1}}),r.createElement(Re.U,null,u()(ct).call(ct,(e=>r.createElement(Qe.Z,{key:e.value,title:e.label,placement:"bottom"},r.createElement(Te.Z,{color:o===e.value?"primary":"inherit",onClick:()=>f(e.value),sx:{mr:1}},e.icon)))))),r.createElement(ht,{query:h,type:o,contentType:2,sx:{height:"calc(100% - 110px)"}})):r.createElement(Z.Z,{fullScreen:i,open:t,onClose:e,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"100%"}},TransitionComponent:ut},r.createElement(E.Z,{sx:{position:"relative"}},r.createElement(x.Z,null,r.createElement(I.Z,{sx:{ml:2,flex:1},variant:"h6",component:"div"},"\u5e02\u573a"),i?r.createElement(Te.Z,{edge:"start",color:"inherit",onClick:()=>{n(!1)},"aria-label":"close"},r.createElement(Ee.Z,null)):r.createElement(Te.Z,{edge:"start",color:"inherit",onClick:()=>{n(!0)},"aria-label":"close"},r.createElement(ye.Z,null)),r.createElement(Te.Z,{edge:"start",color:"inherit",onClick:d,"aria-label":"close",sx:{ml:"5px"}},r.createElement(ve.Z,null)),r.createElement(Te.Z,{edge:"start",color:"inherit",onClick:e,"aria-label":"close",sx:{ml:"5px"}},r.createElement(ge.Z,null)))),r.createElement(G.Z,{sx:{p:2}},r.createElement(Re.U,null,r.createElement(Re.U,null,u()(ct).call(ct,(e=>r.createElement(we.Z,{key:e.value,variant:"contained",size:"small",startIcon:e.icon,color:o===e.value?"primary":"inherit",onClick:()=>f(e.value),sx:{mr:2,backgroundColor:o!==e.value?"#fff":void 0}},e.label)))),r.createElement(Ae.Z,{value:h,onChange:p,sx:{flex:1}})),r.createElement(ht,{query:h,type:o,contentType:0,sx:{height:"calc(100% - 36px)"}})))};var pt=i(52069),ft=i.n(pt),mt=i(37211),_t=i(6512);function gt(e,t){var i=q()(e);if(Y()){var r=Y()(e);t&&(r=T()(r).call(r,(function(t){return $()(e,t).enumerable}))),i.push.apply(i,r)}return i}function yt(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?ee()(i=gt(Object(n),!0)).call(i,(function(t){(0,oe.Z)(e,t,n[t])})):ie()?ne()(e,ie()(n)):ee()(r=gt(Object(n))).call(r,(function(t){ae()(e,t,$()(n,t))}))}return e}const vt=({onClose:e,open:t})=>{const[i,n]=(0,r.useState)({cx:"",cy:"",cz:"",sx:"",sy:"",sz:""}),s=e=>{n(yt(yt({},i),{},{[e.target.name]:e.target.value}))},a=()=>{e()},o=(e,t,i)=>{const r=me.gV.intance.SelectEntitys;for(let n=0;n<e;n++)for(const e of r){const r=e.clone(),s=r.Position;s[i]+=t*(n+1),r.Position=s,me.gV.intance.Database.ModelSpace.append(r)}};return r.createElement(Z.Z,{open:t,maxWidth:"md",PaperProps:{sx:{height:"300px"}}},r.createElement(_t.Z,{onClose:a,title:"\u9635\u5217"}),r.createElement(G.Z,null,r.createElement(I.Z,null,"\u6570\u91cf"),r.createElement(Re.U,null,r.createElement(V.Z,{label:"x",name:"cx",value:i.cx,onChange:s}),r.createElement(V.Z,{label:"y",name:"cy",value:i.cy,onChange:s}),r.createElement(V.Z,{label:"z",name:"cz",value:i.cz,onChange:s})),r.createElement(I.Z,null,"\u95f4\u8ddd"),r.createElement(Re.U,null,r.createElement(V.Z,{label:"x",name:"sx",value:i.sx,onChange:s}),r.createElement(V.Z,{label:"y",name:"sy",value:i.sy,onChange:s}),r.createElement(V.Z,{label:"z",name:"sz",value:i.sz,onChange:s}))),r.createElement(mt.Z,null,r.createElement(Re.U,null,r.createElement(we.Z,{onClick:()=>{const e=ft()(i.cx),t=ft()(i.cy),r=ft()(i.cz),n=ft()(i.sx),s=ft()(i.sy),l=ft()(i.sz);me.gV.intance.SelectEntitys.length>0?de.CMD.CommandWrap((()=>{e&&n&&o(e,n,"x"),t&&s&&o(t,s,"y"),r&&l&&o(r,l,"z")}),"\u9635\u5217"):U.y.warn("\u8bf7\u5148\u9009\u62e9\u8981\u9635\u5217\u7684\u5b9e\u4f53\uff01"),a()},autoFocus:!0,variant:"contained",sx:{mr:2}},"\u786e\u5b9a"),r.createElement(we.Z,{autoFocus:!0,onClick:a,variant:"contained",color:"error"},"\u53d6\u6d88"))))};var bt=i(58044),Et=i.n(bt),xt=i(61241),Ct=i(43156),wt=i(54603),St=i(72448),Tt=i(78991),Pt=i(29143),At=i(82295),Rt=i(32048),Mt=i(19957),Ot=i(9742);let It=0;const Dt=({onClose:e,open:t})=>{const[i,n]=(0,r.useState)([]),[s,a]=(0,r.useState)(null),o=()=>{e()},l=(e,t)=>{t[e.target.name]=e.target.value,n([...i])};return r.createElement(Z.Z,{open:t,maxWidth:"md",PaperProps:{sx:{height:"522px"}}},r.createElement(_t.Z,{onClose:o,title:"\u6dfb\u52a0\u6807\u6ce8"}),r.createElement(G.Z,null,r.createElement(Re.U,null,r.createElement(we.Z,{onClick:()=>{const e=It++;n([...i,{id:e,label:"\u672a\u547d\u540d",key:"key"+e,value:"",unit:""}])}},"\u6dfb\u52a0")),r.createElement(Pt.Z,{component:xt.Z,sx:{height:"calc(100% - 40px)"}},r.createElement(wt.Z,{sx:{minWidth:650},"aria-label":"simple table",stickyHeader:!0},r.createElement(At.Z,null,r.createElement(Rt.Z,null,r.createElement(Tt.Z,{width:"22.5%",align:"center"},"\u5c5e\u6027\u540d\u79f0"),r.createElement(Tt.Z,{width:"22.5%",align:"center"},"\u5c5e\u6027\u952e"),r.createElement(Tt.Z,{width:"22.5%",align:"center"},"\u503c"),r.createElement(Tt.Z,{width:"22.5%",align:"center"},"\u5355\u4f4d"),r.createElement(Tt.Z,{width:"10%",align:"center"},"\u64cd\u4f5c"))),r.createElement(St.Z,null,u()(i).call(i,((e,t)=>r.createElement(Rt.Z,{key:e.id},r.createElement(Mt.Z,{size:"small",align:"center",name:"label",value:e.label,onChange:t=>{l(t,e)}}),r.createElement(Mt.Z,{size:"small",align:"center",value:e.key,name:"key",onChange:t=>{l(t,e)}}),r.createElement(Mt.Z,{size:"small",align:"center",name:"value",value:"boolean"==typeof e.value?String(e.value):e.value,onChange:t=>{l(t,e)}}),r.createElement(Mt.Z,{size:"small",align:"center",name:"unit",value:e.unit,onChange:t=>{l(t,e)}}),r.createElement(Tt.Z,{size:"small",align:"center"},r.createElement(Te.Z,{onClick:()=>{(e=>{n((t=>(Et()(t).call(t,e,1),[...t])))})(t)}},r.createElement(Ct.Z,null)))))))))),r.createElement(mt.Z,{sx:{justifyContent:"space-between"}},r.createElement(Ot.d,{value:s,label:"\u7ed1\u5b9a\u5230\u5b9e\u4f53",onChange:(e,t)=>{a(me.gV.intance.Database.getObjectId(t.value))}}),r.createElement(Re.U,null,r.createElement(we.Z,{onClick:()=>{0!==i.length?(de.CMD.CommandWrap((()=>{const e=new de.StackPanelGui;e.DataList=i,s&&e.attachEntity(s),me.gV.intance.Database.GuiSpace.append(e)}),"\u521b\u5efa\u6807\u6ce8"),o()):o()},autoFocus:!0,variant:"contained",sx:{mr:2}},"\u786e\u5b9a"),r.createElement(we.Z,{autoFocus:!0,onClick:o,variant:"contained",color:"error"},"\u53d6\u6d88"))))},Ft=[{label:"\u4e0d\u53ef\u64cd\u4f5c",value:de.TransformMode.None,icon:"icon-3Dbukecaozuo"},{label:"\u79fb\u52a8",value:de.TransformMode.Translate,icon:"icon-3Dyidong"},{label:"\u65cb\u8f6c",value:de.TransformMode.Rotate,icon:"icon-3Dxuanzhuan"},{label:"\u7f29\u653e",value:de.TransformMode.Scale,icon:"icon-3Dsuofang"},{label:"\u8f6c\u6362",value:de.TransformMode.All,icon:"icon-3Dzhuanhuan"}],Lt=e=>{var t;const[i,n]=(0,r.useState)(de.TransformMode.Translate),[s,a]=(0,r.useState)(!1),[o,l]=(0,r.useState)(!1),[h,c]=(0,r.useState)(!1),[d,p]=r.useState(null),f=()=>{p(null)},m=()=>{l(!1)},_=e=>{const t=e.currentTarget.getAttribute("data-key");t&&de.CMD.CommandWrap((()=>{const e=me.gV.intance.create({type:t});me.gV.intance.Editor.selectControl.SelectEntitys=[e]}),"\u521b\u5efa\u7269\u4f53"),f()},g=Boolean(d);return r.createElement(fe.Provider,{value:{closeMarket:m}},r.createElement(x.Z,{disableGutters:!0,variant:"dense"},u()(Ft).call(Ft,(e=>r.createElement(ue,{key:e.value,iconName:e.icon,title:e.label,color:i===e.value?"#075FB8":void 0,onClick:()=>(e=>{me.gV.intance.Editor.transformControl.Mode=e,n(e)})(e.value),sx:{ml:1,mr:1}}))),r.createElement(ue,{iconName:"icon-3Dquanxuan1",title:"\u5168\u9009",onClick:()=>de.CMD.commandManager.ExecCommand("SELECTALL"),sx:{ml:1,mr:1}}),r.createElement(ue,{iconName:"icon-3Dicon_yingyongguanli",title:"\u9635\u5217",onClick:()=>{me.gV.intance.SelectEntitys.length?c(!0):U.y.warn("\u8bf7\u5148\u9009\u62e9\u8981\u9635\u5217\u7684\u5b9e\u4f53")},sx:{ml:1,mr:1}}),r.createElement(ue,{iconName:"icon-3Dbiaozhu",title:"\u6807\u6ce8",onClick:()=>{a(!0)},sx:{ml:1,mr:1}}),r.createElement(ue,{iconName:"icon-3Dsheji",title:"\u7269\u4f53",onClick:e=>{p(e.currentTarget)},sx:{ml:1,mr:1}}),r.createElement(ue,{iconName:"icon-3Dsucai",title:"\u5e02\u573a",onClick:()=>{l(!0)},sx:{ml:1,mr:1}}),s&&r.createElement(Dt,{onClose:()=>{a(!1)},open:s}),r.createElement(dt,{onClose:m,open:o}),g&&r.createElement(R.Z,{id:"long-menu",MenuListProps:{"aria-labelledby":"long-button"},anchorEl:d,open:g,onClose:f},u()(t=_e[0].children).call(t,(e=>r.createElement(M.Z,{key:e.key,onClick:_,"data-key":e.key},r.createElement(pe.Z,null,r.createElement(e.icon,{name:e.iconName})),r.createElement(I.Z,{variant:"inherit",noWrap:!0},e.title))))),r.createElement(vt,{open:h,onClose:()=>c(!1)})))};var kt=i(21092);const Bt=["children","onClose"];function Nt(e,t){var i=q()(e);if(Y()){var r=Y()(e);t&&(r=T()(r).call(r,(function(t){return $()(e,t).enumerable}))),i.push.apply(i,r)}return i}function zt(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?ee()(i=Nt(Object(n),!0)).call(i,(function(t){(0,oe.Z)(e,t,n[t])})):ie()?ne()(e,ie()(n)):ee()(r=Nt(Object(n))).call(r,(function(t){ae()(e,t,$()(n,t))}))}return e}const Ut=(0,C.ZP)(Z.Z)((({theme:e})=>({"& .MuiDialogContent-root":{padding:e.spacing(2)},"& .MuiDialogActions-root":{padding:e.spacing(1)}}))),Gt=e=>{const{children:t,onClose:i}=e,n=(0,kt.Z)(e,Bt);return r.createElement(j.Z,(0,p.Z)({sx:{m:0,p:2,width:"850px"}},n),t,i?r.createElement(Te.Z,{"aria-label":"close",onClick:i,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]}},r.createElement(ge.Z,null)):null)},jt=(0,C.ZP)(xt.Z)((({theme:e})=>zt(zt({},e.typography.body2),{},{padding:e.spacing(2),margin:e.spacing(1),border:"1px solid rgba(0,0,0,0.05)"}))),Vt=({open:e,title:t,footerName:i,handleClose:n})=>r.createElement("div",null,r.createElement(Ut,{onClose:n,"aria-labelledby":"customized-dialog-title",open:e,fullWidth:!1,maxWidth:"md"},r.createElement(Gt,{id:"customized-dialog-title",onClose:n},t),r.createElement(G.Z,{dividers:!0,sx:{height:"450px"}},r.createElement(f.Z,{sx:{height:"350px"}},r.createElement(m.Z,{mb:1},"\u9f20\u6807",r.createElement(jt,{elevation:0},r.createElement(m.Z,{direction:"row",justifyContent:"space-between",spacing:2},r.createElement("div",null,"\u70b9\u51fb\u5de6\u952e\u62d6\u62fd\uff1a\u6846\u9009\u573a\u666f\u8282\u70b9"),r.createElement("div",null,"\u6309\u4f4f\u4e2d\u95f4\u952e\u79fb\u52a8\uff1a\u65cb\u8f6c\u573a\u666f"),r.createElement("div",null,"\u6eda\u52a8\u4e2d\u95f4\u952e\uff1a\u7f29\u653e\u573a\u666f")))),r.createElement(m.Z,{mb:1},"\u952e\u76d8",r.createElement(jt,{elevation:0},"\u6f2b\u6e38\u89c6\u89d2:",r.createElement(jt,{elevation:0},r.createElement(m.Z,{direction:"column",justifyContent:"space-between",spacing:2},r.createElement(m.Z,{direction:"row",spacing:2},r.createElement("div",{style:{width:"200px"}},"\u2191\uff1a\u5411\u4e0a\u79fb\u52a8"),r.createElement("div",null,"\u2193\uff1a\u5411\u4e0b\u79fb\u52a8")),r.createElement(m.Z,{direction:"row",justifyContent:"space-between",spacing:2},r.createElement("div",null,"W\uff1a\u5411\u524d\u79fb\u52a8"),r.createElement("div",null,"S\uff1a\u5411\u540e\u79fb\u52a8"),r.createElement("div",null,"A\uff1a\u5411\u5de6\u79fb\u52a8"),r.createElement("div",null,"D\uff1a\u5411\u53f3\u79fb\u52a8")))),r.createElement(m.Z,{direction:"row",justifyContent:"space-between",spacing:2},r.createElement("div",null,"Delete\uff1a\u5220\u9664"),r.createElement("div",null,"Ctrl+Z\uff1a\u64a4\u9500"),r.createElement("div",null,"Ctrl+Y\uff1a\u6062\u590d"),r.createElement("div",null,"Ctrl+A\uff1a\u5168\u9009"),r.createElement("div",null,"F11\uff1a\u5168\u5c4f\u7f29\u653e")))),r.createElement(m.Z,{mb:1},"\u9f20\u6807 + \u952e\u76d8",r.createElement(jt,{elevation:0},r.createElement(m.Z,{direction:"row",justifyContent:"space-between",spacing:2},r.createElement("div",null,"Alt+\u9f20\u6807\u4e2d\u95f4\u952e\uff1a\u79fb\u52a8\u573a\u666f")))))),r.createElement(mt.Z,null,r.createElement(we.Z,{autoFocus:!0,onClick:n},i))));var Zt=i(17349),Wt=i.n(Zt),Ht=i(9456),Kt=i.n(Ht),qt=i(69236),Xt=i.n(qt),Yt=i(34682),Qt=i.n(Yt),$t=i(85231),Jt=i(46561),ei=i(52015),ti=i(60707),ii=i(37360);let ri;const ni=({onClose:e})=>{const[t,i]=(0,r.useState)([]);return(0,r.useEffect)((()=>{var e;ri?i(ri):Be()(e=location.host).call(e,"localhost")||fetch("/log.txt").then((e=>e.text())).then((e=>{var t;const r=Wt()(t=e.split(/[\r\n]/)).call(t,0,50);ri||(ri=r),i(r)}))}),[]),r.createElement(Z.Z,{onClose:e,open:!0,maxWidth:"md"},r.createElement(j.Z,null,"\u66f4\u65b0\u65e5\u5fd7"),r.createElement(Jt.Z,{sx:{width:"400px",bgcolor:"background.paper"}},u()(t).call(t,(e=>{var t;const i=e.split(",");if(i[1]&&!Kt()(t=["fix","feat","refactor"]).call(t,(e=>{var t,r;return!Xt()(t=Qt()(r=i[1]).call(r)).call(t,e)})))return r.createElement(ei.ZP,{key:i[2]},r.createElement(ti.Z,null,r.createElement($t.Z,null,i[0])),r.createElement(ii.Z,{primary:i[1],secondary:i[2]?new Date(i[2]).toLocaleString():""}))}))))},si=e=>{var t;const[i,n]=r.useState(null),[s,a]=(0,r.useState)(!1),[o,l]=(0,r.useState)(!1),h=Boolean(i),c=()=>{n(null)};return r.createElement(r.Fragment,null,r.createElement(ue,{iconName:"icon-3Dbangzhu",title:"\u5e2e\u52a9",onClick:e=>{n(e.currentTarget)}}),r.createElement(R.Z,{id:"basic-menu",anchorEl:i,open:h,onClose:c,MenuListProps:{"aria-labelledby":"basic-button"}},r.createElement(M.Z,{onClick:()=>{l(!0),c()},sx:{fontSize:"12px"}},"\u5feb\u6377\u952e\u8bf4\u660e"),!Be()(t=location.host).call(t,"localhost")&&r.createElement(M.Z,{onClick:()=>{a(!0),c()},sx:{fontSize:"12px"}},"\u66f4\u65b0\u65e5\u5fd7")),r.createElement(Vt,{open:o,title:"\u5feb\u6377\u952e\u8bf4\u660e",footerName:"\u6211\u77e5\u9053\u4e86",handleClose:()=>{l(!1),c()}}),s&&r.createElement(ni,{onClose:()=>a(!1)}))},ai=e=>{const[t,i]=(0,r.useState)(null),n=Boolean(t);return r.createElement(r.Fragment,null,r.createElement(ue,{iconName:"icon-3Duser",title:"\u7528\u6237",onClick:e=>{i(e.currentTarget)}}),r.createElement(R.Z,{id:"basic-menu",anchorEl:t,open:n,onClose:()=>{i(null)},MenuListProps:{"aria-labelledby":"basic-button"}},r.createElement(M.Z,{sx:{fontSize:"12px"}},Ue.H.UserName),r.createElement(M.Z,{sx:{fontSize:"12px"},onClick:Ue.H.logOut},"\u9000\u51fa\u767b\u5f55")))},oi=(0,C.ZP)("div")((({theme:e})=>({display:"flex",height:"46px",justifyContent:"center",alignItems:"center",fontSize:"18px",fontWeight:"bold",left:"5px",marginRight:"20px",marginLeft:"10px"}))),li=(0,w.Pi)((()=>{var e;const{fileStore:t}=(0,O.m)(),i=(0,d.s0)(),[n,s]=(0,r.useState)(!1),[a,o]=(0,r.useState)(!1),[l,h]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const e=e=>{"Backquote"===e.code&&e.altKey&&e.ctrlKey&&h(!0)};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[]),r.createElement(E.Z,{position:"static",sx:{background:"#fff",color:"#424B54",height:48,zIndex:9}},r.createElement(x.Z,{disableGutters:!0,variant:"dense",sx:{justifyContent:"space-between"}},r.createElement(m.Z,{flexDirection:"row",alignItems:"center"},r.createElement(oi,null,r.createElement("img",{src:"/static/images/zhc.png"})),r.createElement(k,null)),r.createElement(Lt,null),r.createElement(f.Z,{sx:{display:"flex",justifyContent:"flex-end",marginRight:"10px"}},r.createElement(si,null),r.createElement(ue,{iconName:"icon-3Dpingtaituihui",title:"\u8fd4\u56de",onClick:()=>{i("/list/project")}}),r.createElement(ue,{iconName:"icon-3Dfenxiang",title:"\u5206\u4eab",onClick:()=>{s(!0)},disabled:!t.currentFileId}),r.createElement(ue,{iconName:"icon-3Dfabu",title:"\u53d1\u5e03",onClick:()=>{o(!0)},disabled:!t.currentFileId}),r.createElement(ue,{iconName:"icon-3Dbaocun",title:"\u4fdd\u5b58",onClick:()=>{t.save().then((e=>{e&&U.y.success("\u4fdd\u5b58\u6210\u529f")}))}}),r.createElement(ue,{iconName:"icon-3Dyulan",title:"\u9884\u89c8",disabled:!t.currentFileId,onClick:()=>{window.open("about:blank").location.href="/preview.html"+location.search}}),r.createElement(ai,null),n&&r.createElement(z.Z,{target:t.currentFileId,open:n,onClose:()=>{s(!1)}}),a&&r.createElement(B.Z,{target:t.currentFileId,onClose:()=>{o(!1)},type:"app",category:N.f.File,targetObj:b()(e=t.fileList).call(e,(e=>e.id===t.currentFileId))}),l&&r.createElement(H,{open:l,onClose:()=>h(!1)}))))}));var hi=i(4675),ci=i(92509),ui=i(59753);const di=e=>{const[t,i]=(0,r.useState)(ui.V.Scene);return r.createElement(ci.T.Provider,{value:{leftTabIndex:t,changeLeftTab:e=>i(e)}},r.createElement(m.Z,{flexDirection:"column",sx:{height:"100%"}},r.createElement(li,null),r.createElement(m.Z,{flexDirection:"row",sx:{height:"calc(100% - 48px)"}},r.createElement(f.Z,{sx:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:"#FCFCFC",alignItems:"center"}},r.createElement(g.Z,{orientation:"vertical",variant:"scrollable",value:t,onChange:(e,t)=>{i(t)},"aria-label":"basic tabs example",sx:{width:50,background:"#FCFCFC"},TabIndicatorProps:{sx:{color:"red"}}},u()(hi.Z).call(hi.Z,(e=>!e.isHide&&r.createElement(_.Z,(0,p.Z)({value:e.id,key:e.id,icon:r.createElement(e.icon,{name:e.iconName,fontSize:21,color:t===e.id?"#0084FF":"#424B54"}),label:e.title},(0,y.P)(e.id),{sx:{padding:"12px 0",minWidth:"50px",maxWidth:"initial"}})))))),r.createElement(f.Z,{flex:1,sx:{display:"flex",flexDirection:"column",height:"100%"},onContextMenu:e=>e.preventDefault()},e.children))))};var pi=i(5212);const fi=e=>r.createElement(f.Z,{sx:{"&":{alignItems:"center",display:"flex",flexDirection:"column",height:"100%",justifyContent:"center",minHeight:"100%"}}},r.createElement(f.Z,{width:400},r.createElement(pi.Z,null)));var mi=i(12519),_i=i(598);const gi=[{href:"https://hc3d-portal.histron.cn/material.html",label:"\u7d20\u6750\u5e02\u573a"},{href:"",label:"\u5f00\u53d1\u4e2d\u5fc3"},{href:"https://normdoc.histron.cn/",label:"\u5e2e\u52a9\u4e2d\u5fc3"}];var yi=i(46600),vi=i(81215);const bi=(0,C.ZP)(x.Z)((({theme:e})=>({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"}))),Ei=(0,C.ZP)("div")((({theme:e})=>({display:"flex",justifyContent:"space-around",alignItems:"center","& .TopMenuItem":{padding:"10px 20px","& a":{color:"#fff",textDecoration:"none"}}}))),xi=(0,C.ZP)(M.Z)((({theme:e})=>({fontSize:"13px",width:"300px","&:hover":{backgroundColor:"rgba(25, 118, 210, 0.2)"}}))),Ci=(0,C.ZP)(f.Z)((({theme:e})=>({display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer","& .vip-img":{width:"18px",height:"18px",borderRadius:"50%",position:"absolute",bottom:0,right:0}}))),wi=(0,C.ZP)("img")((({theme:e})=>({width:"36px",height:"36px",borderRadius:"50%",marginRight:"5px"}))),Si=(0,C.ZP)(f.Z)((({theme:e})=>({display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"12px",fontFamily:"Source Han Sans CN",color:"#424B54",marginBottom:"10px",width:"100%",padding:"6px 16px",userSelect:"none","& .avatar":{display:"flex","& p":{margin:0},"& .user-id":{color:"#999"}},"& .score":{color:"#FF6600"}})));const Ti=function(e){const[t,i]=r.useState(null),[n,s]=r.useState({}),a=Boolean(t),o=()=>{i(null)},l=()=>{o(),Ue.H.logOut()};return(0,r.useEffect)((()=>{(async()=>{const e=await(0,D.ZL)("trade/account");e.code===D.Mx.Ok&&s(e.data)})()}),[]),r.createElement(E.Z,{sx:{background:"#0066cc",position:"unset"}},r.createElement(mi.Z,{maxWidth:!1,sx:{minHeight:"30px"}},r.createElement(bi,{disableGutters:!0,variant:"dense"},r.createElement(I.Z,{variant:"h6",noWrap:!0,component:"div",sx:{mr:2,color:"#fff",display:{xs:"none",md:"flex"},fontSize:"16px",fontFamily:"Source Han Sans CN",fontWeight:"bold",alignItems:"center",justifyContent:"center"}},r.createElement("img",{style:{marginRight:"10px"},src:"/static/images/logo-white.png"})),r.createElement(Ei,null,gi&&u()(gi).call(gi,((e,t)=>r.createElement("span",{key:t,className:"TopMenuItem"},r.createElement(_i.Z,{href:e.href},e.label))))),e.children?r.createElement(f.Z,{sx:{flex:1,display:"flex",justifyContent:"flex-end"}},e.children):Ue.H.UserName?r.createElement(r.Fragment,null,r.createElement(f.Z,{onMouseEnter:e=>{i(e.currentTarget)},onMouseLeave:o},r.createElement(Ci,null,r.createElement(f.Z,{sx:{marginRight:"5px",position:"relative"}},r.createElement(wi,{src:"/static/images/avatar.jpeg"}),r.createElement("img",{className:"vip-img",src:"/static/images/member.png"})),r.createElement(yi.Z,{type:"icon-3Dxiajiantou",sx:{color:"#fff",fontSize:"12px",fontWeight:"bold"}})),r.createElement(R.Z,{id:"basic-menu",anchorEl:t,open:a,onClose:o,sx:{"& a":{color:"#333",textDecoration:"none"}}},r.createElement(Si,null,r.createElement(f.Z,{className:"avatar"},r.createElement(wi,{src:"/static/images/avatar.jpeg"}),r.createElement(f.Z,null,r.createElement("p",null,Ue.H.UserName),r.createElement("p",{className:"user-id"},"ID: ",n.account_num))),r.createElement("div",{className:"score"},"\u79ef\u5206\uff1a",n.balance)),r.createElement(xi,{onClick:()=>{return e="https://hc3d-portal.histron.cn/personal-center.html",void window.open(e,t);var e,t}},r.createElement(yi.Z,{type:"icon-3Dkehufenxi"}),"\u4e2a\u4eba\u4e3b\u9875"),r.createElement(xi,{onClick:()=>{(0,vi.i)({title:"\u63d0\u793a",content:"\u786e\u5b9a\u9000\u51fa\u767b\u5f55\u5417\uff1f",onOk:()=>{l()}})}},r.createElement(yi.Z,{type:"icon-3Dtuichu1"}),"\u9000\u51fa\u767b\u5f55")))):null)))};var Pi=i(97539),Ai=i.n(Pi),Ri=i(97892),Mi=i(87075),Oi=i(31763),Ii=i(37054);const Di={fontSize:"14px",height:"40px",width:"100%",display:"flex",alignItems:"center"},Fi=(0,C.ZP)(Mi.Z)((({theme:e})=>({"& .Mui-focused, & .Mui-selected, & .Mui-selected.Mui-focused":{backgroundColor:"#fff"},"&.active, & .MuiTreeItem-content:hover":{backgroundColor:"#fff",color:"#1890ff"},"& .MuiTreeItem-content":{padding:"0 15px"}})));class Li extends r.Component{constructor(e){super(e),this.renderMenuItem=e=>{var t;let{handleClick:i,itemStyle:n,selected:s}=this.props,a=r.createElement("div",{style:n||Di},e.title),o=e.name;return r.createElement(Fi,{className:s===o?"active":"",key:o,nodeId:"string"==typeof o?o:String(o),label:a,icon:e.icon?this.renderMenuIcon(e.icon):null,onClick:()=>{i&&i(e)}},e.children&&u()(t=e.children).call(t,(e=>this.renderMenuItem(e))))},this.renderMenuIcon=e=>r.createElement("i",{className:"iconfont "+e}),this.onNodeToggle=(e,t)=>{let{onNodeToggle:i}=this.props;i&&i(e,t)},this.isPermission=e=>{let t=Ue.H.UserRole;for(let i of t)if(-1!==Ai()(e).call(e,i))return!0}}render(){let{dataList:e,sx:t,defaultExpanded:i,expanded:n}=this.props,s=e?T()(e).call(e,(e=>!e.role||this.isPermission(e.role))):[];return r.createElement(Ri.Z,{"aria-label":"file system navigator",defaultCollapseIcon:r.createElement(Oi.Z,null),defaultExpandIcon:r.createElement(Ii.Z,null),sx:t||{height:"100%",flexGrow:1,maxWidth:400,overflowY:"auto"},defaultExpanded:i,expanded:n,onNodeToggle:this.onNodeToggle},u()(s).call(s,(e=>this.renderMenuItem(e))))}}const ki=Li,Bi=window.location.pathname.split("/"),Ni=Bi[Bi.length-1],zi=[{path:"/project",name:"project",title:"\u9879\u76ee",icon:"icon-3Dicon_yingyongguanli"},{path:"/model",name:"model",title:"\u6a21\u578b",icon:"icon-3Ddici"},{path:"/component",name:"component",title:"\u7ec4\u4ef6",icon:"icon-3Dwumoxing"},{path:"/collect",name:"collect",title:"\u6536\u85cf\u5217\u8868",icon:"icon-3Dshoucang"},{path:"/works",name:"works",title:"\u4f5c\u54c1",icon:"icon-3Dicon_24_wodezuopin"},{path:"/purchased",name:"purchased",title:"\u5df2\u8d2d\u4e70",icon:"icon-3Dgouwuche"},{path:"/deploy",name:"deploy",title:"\u9879\u76ee\u90e8\u7f72",icon:"icon-3Dweb1"},{path:"/examine",name:"examine",title:"\u90e8\u7f72\u5ba1\u6838",role:"A000001",icon:"icon-3Dshenhetongguo"}],Ui=(0,C.ZP)(Ie.ZP)((({theme:e})=>({display:"flex",justifyContent:"center",alignItems:"center",height:"70%","& .logo":{width:"140px"},"& .pane-list":{width:"30%",display:"flex",padding:"10px 20px",flexDirection:"column","& p":{width:"66px",height:"16px",fontSize:"15px",fontFamily:"Source Han Sans CN",fontWeight:"bold",color:"#424b54"},"& a":{fontSize:"12px",fontFamily:"Source Han Sans CN",fontWeight:"400",color:"#424b54",textDecoration:"none",marginTop:"10px"}},"& .code-pane":{width:"34%",display:"grid",gridTemplateColumns:"repeat(auto-fill, calc(100% / 2))","& span":{fontSize:"12px",fontFamily:"Source Han Sans CN",color:"#424854",margin:"8px 0"},"& img":{width:"100px",height:"100px"}}}))),Gi=(0,C.ZP)(we.Z)((({theme:e})=>({height:"30px",background:"#1890ff",fontSize:"14px"}))),ji=[{path:"/",parent:!0,routes:[{path:"/list",parent:!0,layout:e=>{const t=(0,d.s0)(),[i,n]=(0,r.useState)(Ni);return r.createElement(f.Z,{sx:{flexGrow:1}},r.createElement(Ie.ZP,{item:!0,xs:12},r.createElement(Ti,null)),r.createElement(Ie.ZP,{columns:11,container:!0,spacing:0,sx:{height:"calc(100vh - 48px)",overflowY:"auto"}},r.createElement(Ie.ZP,{item:!0,xs:1,sx:{borderRight:"1px solid #eee",height:"100%"}},r.createElement(I.Z,{sx:{fontSize:"15px",fontWeight:"bold",padding:"10px 15px"}},"\u5f00\u53d1\u4e2d\u5fc3"),r.createElement(ki,{sx:{height:"auto"},dataList:zi,selected:i,handleClick:e=>{const{path:i,name:r}=e;n(r),t(`/list${i}`)}})),r.createElement(Ie.ZP,{item:!0,xs:10,sx:{height:"100%"}},e.children)),r.createElement(Ie.ZP,{container:!0,spacing:0,sx:{height:280,boxShadow:"0px 0px 18px 0px rgba(0, 0, 0, 0.3)"}},r.createElement(Ui,{item:!0,xs:4,direction:"column",container:!0},r.createElement("img",{className:"logo",src:"/static/images/logo.png"}),r.createElement(Gi,{sx:{margin:"20px 0 15px"},variant:"contained",startIcon:r.createElement("i",{className:"iconfont icon-3Dkefu"})},"\u70b9\u6211\u4ea4\u6d41"),r.createElement(Gi,{variant:"contained",startIcon:r.createElement("i",{className:"iconfont icon-3Dkefuxiaoxi"})},"\u6211\u8981\u7559\u8a00")),r.createElement(Ui,{item:!0,xs:4,sx:{justifyContent:"center"}},r.createElement("div",{className:"pane-list"},r.createElement("p",null,"\u5173\u4e8e\u6211\u4eec"),r.createElement("a",{href:"/"},"\u5173\u4e8e\u6211\u4eec"),r.createElement("a",{href:"/"},"\u7528\u6237\u534f\u8bae"),r.createElement("a",{href:"/"},"\u4f1a\u5458\u4e2d\u5fc3"),r.createElement("a",{href:"/"},"\u8054\u7cfb\u6211\u4eec")),r.createElement("div",{className:"pane-list"},r.createElement("p",null,"\u5e38\u89c1\u95ee\u9898"),r.createElement("a",{href:"/"},"\u8d2d\u4e70/\u652f\u4ed8"),r.createElement("a",{href:"/"},"\u4f7f\u7528\u95ee\u9898"),r.createElement("a",{href:"/"},"\u5173\u4e8e\u8d26\u53f7"),r.createElement("a",{href:"/"},"\u5e2e\u52a9\u4e2d\u5fc3")),r.createElement("div",{className:"pane-list"},r.createElement("p",null,"\u53cb\u60c5\u94fe\u63a5"),r.createElement("a",{href:"/"},"\u6d77\u521b\u5fae\u8054"),r.createElement("a",{href:"/"},"\u91c7\u96c6\u63a5\u5165"),r.createElement("a",{href:"/"},"\u4e91\u5e73\u53f0"),r.createElement("a",{href:"/"},"\u4e91\u7ec4\u6001"))),r.createElement(Ui,{direction:"column",item:!0,xs:4,container:!0},r.createElement("p",null,"\u5fae\u4fe1\u626b\u7801\u5173\u6ce8\u6211\u4eec"),r.createElement("div",{className:"code-pane"},r.createElement("div",null,r.createElement("span",null,"\u516c\u4f17\u53f7-\u60ca\u559c\u4e0d\u65ad"),r.createElement("img",{src:"/static/images/img-web.jpg"})),r.createElement("div",null,r.createElement("span",null,"\u670d\u52a1\u53f7-\u5546\u52a1\u5408\u4f5c"),r.createElement("img",{src:"/static/images/img-job.jpg"})))),r.createElement(Ui,{container:!0,direction:"column",sx:{height:"30%",justifyContent:"center",fontSize:"12px"},item:!0,xs:12},r.createElement("p",{style:{margin:0}},"\u7248\u6743\u6240\u6709\xa92021 \u4e2d\u6d77\u521b\u79d1\u6280\uff08\u798f\u5efa\uff09\u96c6\u56e2\u6709\u9650\u516c\u53f8 Copyright\xa9 2021 Fujian HISTRON Technology Co., Ltd. All rights reserved"),r.createElement("p",{style:{margin:0}},"\u5730\u5740\uff1a\u798f\u5efa\u7701\u798f\u5dde\u5e02\u6d77\u897f\u9ad8\u65b0\u6280\u672f\u521b\u4e1a\u56ed\u4e8c\u671f18\u53f7\u697c"))))},routes:[{index:!0,path:"project",component:r.lazy((()=>Promise.all([i.e(8739),i.e(4326),i.e(8274),i.e(6471),i.e(8737),i.e(3336),i.e(4480),i.e(1461),i.e(6499),i.e(729),i.e(2338),i.e(4906),i.e(9669),i.e(3919),i.e(5877),i.e(2658),i.e(6133),i.e(9478),i.e(2617),i.e(8166),i.e(7911),i.e(1801),i.e(4637),i.e(7621),i.e(6023),i.e(3018),i.e(2386),i.e(5933),i.e(3714),i.e(8692),i.e(6405),i.e(7011),i.e(4848),i.e(3577),i.e(9560),i.e(6170),i.e(2429),i.e(7695),i.e(5623),i.e(7798),i.e(9057),i.e(103),i.e(6769),i.e(4868),i.e(3991),i.e(5557),i.e(6244)]).then(i.bind(i,86244))))},{path:"model",component:r.lazy((()=>Promise.all([i.e(8739),i.e(4326),i.e(8274),i.e(6471),i.e(8737),i.e(3336),i.e(4480),i.e(1461),i.e(6499),i.e(729),i.e(2338),i.e(4906),i.e(9669),i.e(3919),i.e(5877),i.e(2658),i.e(6133),i.e(9478),i.e(2617),i.e(8166),i.e(7911),i.e(1801),i.e(4637),i.e(7621),i.e(6023),i.e(3018),i.e(2386),i.e(5933),i.e(3714),i.e(8692),i.e(6405),i.e(7011),i.e(4848),i.e(3577),i.e(9560),i.e(6170),i.e(2429),i.e(7695),i.e(5623),i.e(7798),i.e(9057),i.e(103),i.e(6769),i.e(4868),i.e(3991),i.e(5557),i.e(1743)]).then(i.bind(i,81743))))},{path:"component",component:r.lazy((()=>Promise.all([i.e(8739),i.e(4326),i.e(8274),i.e(6471),i.e(8737),i.e(3336),i.e(4480),i.e(1461),i.e(6499),i.e(729),i.e(2338),i.e(4906),i.e(9669),i.e(3919),i.e(5877),i.e(2658),i.e(6133),i.e(9478),i.e(2617),i.e(8166),i.e(7911),i.e(1801),i.e(4637),i.e(7621),i.e(6023),i.e(3018),i.e(2386),i.e(5933),i.e(3714),i.e(8692),i.e(6405),i.e(7011),i.e(4848),i.e(3577),i.e(9560),i.e(6170),i.e(2429),i.e(7695),i.e(5623),i.e(7798),i.e(9057),i.e(103),i.e(6769),i.e(4868),i.e(3991),i.e(5557),i.e(9469)]).then(i.bind(i,59469))))},{path:"collect",component:r.lazy((()=>Promise.all([i.e(8739),i.e(4326),i.e(8274),i.e(6471),i.e(8737),i.e(3336),i.e(4480),i.e(1461),i.e(6499),i.e(729),i.e(2338),i.e(4906),i.e(9669),i.e(3919),i.e(5877),i.e(2658),i.e(6133),i.e(9478),i.e(2617),i.e(8166),i.e(7911),i.e(1801),i.e(4637),i.e(7621),i.e(6023),i.e(3018),i.e(2386),i.e(5933),i.e(3714),i.e(8692),i.e(6405),i.e(7011),i.e(4848),i.e(3577),i.e(9560),i.e(6170),i.e(2429),i.e(7695),i.e(5623),i.e(7798),i.e(9057),i.e(103),i.e(6769),i.e(4868),i.e(3991),i.e(5557),i.e(225)]).then(i.bind(i,50225))))},{path:"works",component:r.lazy((()=>Promise.all([i.e(8739),i.e(4326),i.e(8274),i.e(6471),i.e(8737),i.e(3336),i.e(4480),i.e(1461),i.e(6499),i.e(729),i.e(2338),i.e(4906),i.e(9669),i.e(3919),i.e(5877),i.e(2658),i.e(6133),i.e(9478),i.e(2617),i.e(8166),i.e(7911),i.e(1801),i.e(4637),i.e(7621),i.e(6023),i.e(3018),i.e(2386),i.e(5933),i.e(3714),i.e(8692),i.e(6405),i.e(7011),i.e(4848),i.e(3577),i.e(9560),i.e(6170),i.e(2429),i.e(7695),i.e(5623),i.e(7798),i.e(9057),i.e(103),i.e(6769),i.e(4868),i.e(3991),i.e(5557),i.e(6037)]).then(i.bind(i,36037))))},{path:"purchased",component:r.lazy((()=>Promise.all([i.e(8739),i.e(4326),i.e(8274),i.e(6471),i.e(8737),i.e(3336),i.e(4480),i.e(1461),i.e(6499),i.e(729),i.e(2338),i.e(4906),i.e(9669),i.e(3919),i.e(5877),i.e(2658),i.e(6133),i.e(9478),i.e(2617),i.e(8166),i.e(7911),i.e(1801),i.e(4637),i.e(7621),i.e(6023),i.e(3018),i.e(2386),i.e(5933),i.e(3714),i.e(8692),i.e(6405),i.e(7011),i.e(4848),i.e(3577),i.e(9560),i.e(6170),i.e(2429),i.e(7695),i.e(5623),i.e(7798),i.e(9057),i.e(103),i.e(6769),i.e(4868),i.e(3991),i.e(5557),i.e(4584)]).then(i.bind(i,8702))))},{path:"deploy",component:r.lazy((()=>Promise.all([i.e(8739),i.e(4326),i.e(8274),i.e(6471),i.e(8737),i.e(3336),i.e(4480),i.e(1461),i.e(6499),i.e(729),i.e(2338),i.e(4906),i.e(9669),i.e(3919),i.e(5877),i.e(2658),i.e(6133),i.e(9478),i.e(2617),i.e(8166),i.e(7911),i.e(1801),i.e(4637),i.e(7621),i.e(6023),i.e(3018),i.e(2386),i.e(5933),i.e(3714),i.e(8692),i.e(6405),i.e(7011),i.e(4848),i.e(3577),i.e(9560),i.e(6170),i.e(2429),i.e(7695),i.e(5623),i.e(7798),i.e(9057),i.e(103),i.e(6769),i.e(4868),i.e(3991),i.e(5557),i.e(6011)]).then(i.bind(i,96011))))},{path:"examine",component:r.lazy((()=>Promise.all([i.e(8739),i.e(4326),i.e(8274),i.e(6471),i.e(8737),i.e(3336),i.e(4480),i.e(1461),i.e(6499),i.e(729),i.e(2338),i.e(4906),i.e(9669),i.e(3919),i.e(5877),i.e(2658),i.e(6133),i.e(9478),i.e(2617),i.e(8166),i.e(7911),i.e(1801),i.e(4637),i.e(7621),i.e(6023),i.e(3018),i.e(2386),i.e(5933),i.e(3714),i.e(8692),i.e(6405),i.e(7011),i.e(4848),i.e(3577),i.e(9560),i.e(6170),i.e(2429),i.e(7695),i.e(5623),i.e(7798),i.e(9057),i.e(103),i.e(6769),i.e(4868),i.e(3991),i.e(5557),i.e(6104)]).then(i.bind(i,16104))))},{path:"recycle",component:r.lazy((()=>Promise.all([i.e(8739),i.e(4326),i.e(8274),i.e(6471),i.e(8737),i.e(3336),i.e(4480),i.e(1461),i.e(6499),i.e(729),i.e(2338),i.e(4906),i.e(9669),i.e(3919),i.e(5877),i.e(2658),i.e(6133),i.e(9478),i.e(2617),i.e(8166),i.e(7911),i.e(1801),i.e(4637),i.e(7621),i.e(6023),i.e(3018),i.e(2386),i.e(5933),i.e(3714),i.e(8692),i.e(6405),i.e(7011),i.e(4848),i.e(3577),i.e(9560),i.e(6170),i.e(2429),i.e(7695),i.e(5623),i.e(7798),i.e(9057),i.e(103),i.e(6769),i.e(4868),i.e(3991),i.e(5557),i.e(4740)]).then(i.bind(i,74740))))}]},{layout:di,path:"/editor",component:r.lazy((()=>Promise.all([i.e(8739),i.e(4326),i.e(8274),i.e(6471),i.e(8737),i.e(3336),i.e(4480),i.e(1461),i.e(6499),i.e(729),i.e(2338),i.e(4906),i.e(9669),i.e(3919),i.e(5877),i.e(2658),i.e(6133),i.e(9478),i.e(2617),i.e(8166),i.e(7911),i.e(1801),i.e(4637),i.e(7621),i.e(6023),i.e(3018),i.e(2386),i.e(5933),i.e(3714),i.e(8692),i.e(6405),i.e(7011),i.e(4848),i.e(3577),i.e(9560),i.e(6170),i.e(2429),i.e(7695),i.e(5623),i.e(7798),i.e(9057),i.e(103),i.e(6769),i.e(4868),i.e(3991),i.e(5557),i.e(2836)]).then(i.bind(i,52836))))}]},{path:"/login",component:r.lazy((()=>i.e(9188).then(i.bind(i,59188))))},{path:"*",component:r.lazy((()=>i.e(6395).then(i.bind(i,76395))))}],Vi=e=>u()(e).call(e,((e,t)=>{const i=e.guard||r.Fragment,n=e.layout||r.Fragment,s=e.component||r.Fragment;return r.createElement(d.AW,{key:t,path:e.path,index:e.index,element:r.createElement(i,null,r.createElement(n,null,r.createElement(s,null),e.parent&&r.createElement(d.j3,null)))},e.routes&&Vi(e.routes))})),Zi=({routes:e})=>r.createElement(r.Suspense,{fallback:r.createElement(fi,null)},r.createElement(d.Z5,null,Vi(e)));var Wi=i(92604);const Hi=function(){return(0,r.useEffect)((()=>{let{pathname:e}=location;if(!(0,Wi.LP)()&&"/login"!==e){let e=location.origin;location.href=e+"/login"}}),[]),r.createElement(h.VK,null,r.createElement(Zi,{routes:ji}))};var Ki=i(44874);function qi(e,t){var i=q()(e);if(Y()){var r=Y()(e);t&&(r=T()(r).call(r,(function(t){return $()(e,t).enumerable}))),i.push.apply(i,r)}return i}function Xi(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?ee()(i=qi(Object(n),!0)).call(i,(function(t){(0,oe.Z)(e,t,n[t])})):ie()?ne()(e,ie()(n)):ee()(r=qi(Object(n))).call(r,(function(t){ae()(e,t,$()(n,t))}))}return e}const Yi={vertical:"top",horizontal:"center"},Qi=e=>{const{enqueueSnackbar:t,closeSnackbar:i}=(0,Ki.Ds)();return(0,r.useEffect)((()=>{U.y.info=(e,i={})=>{U.Q.add(i.key),t(e,Xi({variant:"info",anchorOrigin:Yi},i))},U.y.warn=(e,i={})=>{U.Q.add(i.key),t(e,Xi({variant:"warning",anchorOrigin:Yi},i))},U.y.success=(e,i={})=>{U.Q.add(i.key),t(e,Xi({variant:"success",anchorOrigin:Yi},i))},U.y.error=(e,i={})=>{U.Q.add(i.key),t(e,Xi({variant:"error",anchorOrigin:Yi},i))},U.y.close=e=>{U.Q.delete(e),i(e)}}),[]),r.createElement(r.Fragment,null)};var $i=i(73231);class Ji extends r.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){(0,$i.lk)(t.componentStack,"\u7ec4\u4ef6\u9519\u8bef \r\n"+e?.message)}render(){return this.props.children}}const er=Ji,tr=(0,o.Z)({palette:{mode:"light"}}),ir=()=>r.createElement(er,null,r.createElement(O.x.Provider,{value:{fileStore:W.T,rootStore:ze.U}},r.createElement(l.Z,{theme:tr},r.createElement(Ki.wT,{maxSnack:3,autoHideDuration:1e3},r.createElement(s.ZP,null),r.createElement(a.Z,{styles:{"html,body,#app":{height:"100%"},"*::-webkit-scrollbar":{width:"0.4em"},"*::-webkit-scrollbar-track":{boxShadow:"inset 0 0 6px #e5e5e5",borderRadius:"0.5em"},"*::-webkit-scrollbar-thumb":{backgroundColor:"rgb(204,204,204)",borderRadius:"0.5em"}}}),r.createElement(Hi,null),r.createElement(Qi,null)))));var rr=i(83228);var nr=i(84199);let sr=0;const ar=[[nr.d.Delete,new class{exec(){var e;ee()(e=me.gV.intance.SelectObjects).call(e,(e=>e.erase()))}}],[nr.d.Model2Zero,new class{exec(){const e=me.gV.intance.SelectEntitys;if(e.length>0){const t=new de.Utils.Box3;for(const i of e)t.union(i.BoundingBox);const i=t.centerWorld.negate();i.y=0;for(const t of e)t.translate(i)}}}],[nr.d.SelectAll,new class{exec(){var e;me.gV.intance.Editor.selectControl.SelectEntitys=[...T()(e=me.gV.intance.Database.ModelSpace.Entitys).call(e,(e=>e.IsPickable&&e.Visiable))]}}],[nr.d.Copy,new class{exec(){const e=me.gV.intance.SelectObjects;if(e.length>0){const t=new de.HCFiler;t.write(e.length);for(const i of e)t.writeObject(i);const i=me.gV.intance.Editor.mouseCtrl.WorldPoint;(0,rr.zp)(Ke()({pt:{x:i?.x,y:i?.y,z:i?.z},data:t.Data}))}else(0,rr.zp)("")}}],[nr.d.Paste,new class{exec(){(0,rr.Vn)().then((e=>{if(e)try{const{data:t,pt:i}=JSON.parse(e),r=new de.HCFiler(t),n=r.read(),s=[],a=[],o=[];for(let e=0;e<n;e++){const e=r.readObject();e.ObjectId=null,e instanceof de.Entity?(s.push(e),me.gV.intance.Database.ModelSpace.append(e)):e instanceof de.BaseGui?(o.push(e),me.gV.intance.Database.GuiSpace.append(e)):e instanceof de.BaseDom&&(a.push(e),me.gV.intance.Database.DomSpace.append(e))}s.length>0?me.gV.intance.Editor.selectControl.SelectEntitys=s:a.length>0?me.gV.intance.Editor.selectControl.SelectDOM=a[0]:o.length>0&&(me.gV.intance.Editor.selectControl.SelectGui=o[0])}catch(e){}}))}}],[nr.d.Group,new class{exec(){const e=me.gV.intance.SelectEntitys;if(0===e.length)return void U.y.warn("\u672a\u9009\u62e9\u8981\u7f16\u7ec4\u7684\u5b9e\u4f53");if(1===e.length)return void U.y.warn("\u7f16\u7ec4\u81f3\u5c11\u9700\u89812\u4e2a\u5b9e\u4f53");const t=new de.GroupRecord;t.Name="\u7ec4"+sr++,me.gV.intance.Database.GroupTable.append(t);for(const i of e)t.entitys.push(i.ObjectId)}}]];var or=i(46266);const lr={init:e=>{let t=(0,Wi.LP)(),i=function(e){let t=document.location.toString().split("#");if(t.length>1){let i,r=t[1].split("&");for(let t=0;t<r.length;t++)if(i=r[t].split("="),null!==i&&i[0]===e)return i[1];return""}return""}("access_token");t?hr(e):i?((0,Wi.o4)(i),function(){let e=document.location.origin+"/list/project";document.location.href=e}(),hr(e)):or.Z.signinRedirect()}};function hr(e){const t=window.location.href,i=Ai()(t).call(t,"#");let r="";-1!==i&&(r=t.substring(0,i)),"/"===window.location.pathname&&(window.location.href=r+"list/project"),Ue.H.getUserInfo(),Ne.l.getPrefix(),e()}const cr=lr;window.EDITOR_VERSION="1657437749843",de.AppConfig.assetURL="https://objectmem.histron.cn/",de.AppConfig.Texture_URL="https://am-img.gkiiot.com/editor/",de.AppConfig.SkyBox_URL="https://am-img.gkiiot.com/editor/",(()=>{if(!$i.l_.test(window.location.hostname)){let e=new Headers;e.append("pragma","no-cache"),e.append("cache-control","no-cache");let t={method:"GET",headers:e};fetch(location.origin+"/ver.txt",t).then((e=>{e.ok&&e.text().then((t=>{e.status&&t&&"1657437749843"!==t&&alert("\u60a8\u672c\u5730\u7f13\u5b58\u7248\u672c\u5df2\u8fc7\u671f,\u8bf7\u5f3a\u5236\u5237\u65b0\u6d4f\u89c8\u5668(Shift+F5)")}))}))}})(),window.addEventListener("mousewheel",(function(e){(!0===e.ctrlKey||e.metaKey)&&e.preventDefault()}),{passive:!1}),new $i.r2,de.CMD.registerCommand(ar);const ur=(0,n.s)(document.getElementById("app"));cr.init((()=>{ur.render(r.createElement(ir,null))}))},54056:(e,t,i)=>{i.d(t,{$_:()=>h,Xf:()=>l,gV:()=>o});var r=i(57055),n=i(31025),s=i(6475),a=i(29115);const o=(0,n.LO)({intance:null,prefix:""}),l=(0,n.aD)((e=>{o.intance=e})),h=(0,n.aD)((async()=>{if(o.prefix)return;const e=await(0,a.ZL)(s.yy.prefix);e.code===a.Mx.Ok&&(o.prefix=e.data.prefix,r.AppConfig.assetURL=e.data.prefix)}))},38235:(e,t,i)=>{i.d(t,{E$:()=>F,EO:()=>U,Em:()=>O,MI:()=>M,NE:()=>k,WB:()=>L,Xl:()=>R,bn:()=>B,d9:()=>G,dI:()=>N,pr:()=>P,qN:()=>I,wb:()=>A,wn:()=>D,z7:()=>z});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(61799),l=i.n(o),h=i(26117),c=i.n(h),u=i(5996),d=i.n(u),p=i(20658),f=i.n(p),m=i(3434),_=i.n(m),g=i(97828),y=i.n(g),v=i(93213),b=i(21092),E=i(57055),x=i(24729),C=i(83228);const w=["type"];function S(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=l()(r).call(r,(function(t){return c()(e,t).enumerable}))),i.push.apply(i,r)}return i}function T(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?d()(i=S(Object(n),!0)).call(i,(function(t){(0,v.Z)(e,t,n[t])})):f()?_()(e,f()(n)):d()(r=S(Object(n))).call(r,(function(t){y()(e,t,c()(n,t))}))}return e}const P="SELECt_ENTITY",A="UPDATE_POSITION",R="UPDATE",M="UPDATE_NAME",O="TOGGLE_VISIABLE",I="TOGGLE_PICKABLE",D="TOGGLE_SHADOW",F="SELECT_GUI",L="UPDATE_GUI",k="SET_2D_TYPE",B="SELECT_DOM",N="UPDATE_OTHER",z="UPDATE_DOM",U="CLEAR";function G(e,t){const{type:i}=t,r=(0,b.Z)(t,w);switch(i){case P:{const i=t.entity;if(!i)return T(T({},e),{},{entity:null,gui:null,dom:null});const r=i.Position,n=i.Rotation,s=i.Scale;return T(T({},e),{},{entity:t.entity,gui:null,position:(0,x.eR)(r,(e=>(0,C.P3)(e,2))),rotation:(0,x.eR)(n,(e=>(0,C.P3)(E.Utils.rad2Deg(e),2))),scale:(0,x.eR)(s,(e=>(0,C.P3)(e,2))),name:i.Name,visiable:i.Visiable,pickable:i.IsPickable,enableShadow:i.EnableShadow,type:i.constructor.type})}case R:{const t=e.entity;if(!t)return e;const i=t.Position,r=t.Rotation,n=t.Scale;return T(T({},e),{},{position:(0,x.eR)(i,(e=>(0,C.P3)(e,2))),rotation:(0,x.eR)(r,(e=>(0,C.P3)(E.Utils.rad2Deg(e),2))),scale:(0,x.eR)(n,(e=>(0,C.P3)(e,2)))})}case A:return T(T({},e),r);case M:return T(T({},e),{},{name:r.name});case O:return T(T({},e),{},{visiable:!e.visiable});case I:return T(T({},e),{},{pickable:!e.pickable});case D:return T(T({},e),{},{enableShadow:!e.enableShadow});case F:{const i=t.gui;if(!i)return T(T({},e),{},{entity:null,gui:null});const r=i.Position,n={x:i.Rotation},s=i.Scale;return T(T({},e),{},{entity:null,dom:null,gui:i,name:i.Name,position:r,rotation:(0,x.eR)(n,(e=>(0,C.P3)(E.Utils.rad2Deg(e),2))),scale:(0,x.eR)(s),type:i.constructor.type,other:{Width:i.Width,Height:i.Height}})}case L:{const t=e.gui;if(!t)return e;const i=t.Position,r={x:t.Rotation},n=t.Scale;return T(T({},e),{},{gui:t,name:t.Name,position:i,rotation:(0,x.eR)(r,(e=>(0,C.P3)(E.Utils.rad2Deg(e),2))),scale:(0,x.eR)(n)})}case k:return T(T({},e),{},{render2DType:r.render2DType});case B:{const i=t.dom;if(!i)return T(T({},e),{},{entity:null,gui:null,dom:null});const r=i.Position,n={x:i.Rotation},s=i.Scale;return T(T({},e),{},{entity:null,gui:null,dom:i,name:i.Name,position:r,rotation:(0,x.eR)(n),scale:(0,x.eR)(s),type:i.constructor.type,other:{width:i.Width,height:i.Height,HorAlign:i.HorAlign,VerAlign:i.VerAlign}})}case z:{const t=e.dom;if(!t)return e;const i=t.Position;return T(T({},e),{},{dom:t,name:t.Name,position:i,other:{width:t.Width,height:t.Height,HorAlign:t.HorAlign,VerAlign:t.VerAlign}})}case N:return T(T({},e),{},{other:t.other});case U:return T(T({},e),{},{entity:null,dom:null,gui:null})}return e}},49431:(e,t,i)=>{i.d(t,{Ee:()=>P,FQ:()=>M});var r,n=i(41843),s=i(14549),a=i.n(s),o=i(58044),l=i.n(o),h=i(6395),c=i.n(h),u=i(20795),d=i.n(u),p=i(61799),f=i.n(p),m=i(51463),_=i.n(m),g=i(32849),y=i.n(g),v=i(26117),b=i.n(v),E=i(57055),x=i(31025),C=i(53189),w=i(40334),S=i(54056),T=i(70485);let P,A=0,R=0;!function(e){e[e.Modal=1]="Modal",e[e.List=2]="List"}(P||(P={}));const M=new(r=class{constructor(){this.tabIndex=0,this.interactions=[],this.realInteractions=[],this.entityInteractions={},this.currentEventIndex=-1,this.currentActionIndex=-1,this.currentActionDetailIndex=-1,this.currentConditionIndex=-1,this.currentCompareIndex=-1,this.tempCondition={isAll:!0,name:"\u60c5\u5f62",conditions:[],actions:[],id:"-1"},this.newAddActionId="",this.mode=P.List,this.selectEntity=null,this.useReal=!0,this._step=0,this._portalContainer=null,this._portalContainer3=null,this._isEditor=!1,(0,x.ky)(this,{Id:!1,mode:!1}),(0,x.gx)((()=>!!S.gV.intance),(()=>{S.gV.intance.on("loadFile",(()=>{const e=S.gV.intance.Database.InteractionTable.objects;this.load(e)})),S.gV.intance.on("newFile",(()=>{this.reset()})),S.gV.intance.Editor.selectControl.on((e=>{"select"===e.type&&(0,x.z)((()=>{1===e.entitys?.length&&e.entitys[0]instanceof E.Entity?this.selectEntity=e.entitys[0]:this.selectEntity=null}))}))}))}get step(){return this._step}set step(e){this._step=e}get isEditor(){return this._isEditor}set isEditor(e){this._isEditor=e}get portalContainer(){return this._portalContainer}set portalContainer(e){this._portalContainer=e}get portalContainer3(){return this._portalContainer3}set portalContainer3(e){this._portalContainer3=e}get Id(){return(A++).toString()}get RealInteractionList(){if(this.SelectEntity){let e=this.entityInteractions[this.SelectEntity.Id];return e||(e=[],this.entityInteractions[this.SelectEntity.Id]=e),this.entityInteractions[this.SelectEntity.Id]}return this.realInteractions}get InteractionList(){return this.useReal||this.mode===P.List?this.RealInteractionList:this.interactions}get SelectEntity(){return this.selectEntity}get CurrentActionDetail(){return this.CurrentAction?.data[this.currentActionDetailIndex]}get CurrentInteraction(){return this.InteractionList[this.currentEventIndex]}get CurrentAction(){if(!this.CurrentInteraction)return;const e=this.CurrentCondition;return e?e.actions[this.currentActionIndex]:this.CurrentInteraction.actions[this.currentActionIndex]}get CurrentCondition(){return this.CurrentInteraction?.conditions?.[this.currentConditionIndex]}set UseReal(e){this.useReal=e}get NewAddActionId(){return this.newAddActionId}set NewAddActionId(e){this.newAddActionId=e}changeTabIndex(e){this.tabIndex=e}addInteraction(e){this.mode===P.List?this.currentEventIndex=this.RealInteractionList.push({label:e.label,type:e.type,id:this.Id,actions:[],conditions:[],objectId:null})-1:this.currentEventIndex=this.interactions.push({label:e.label,type:e.type,id:this.Id,actions:[],conditions:[],objectId:null})-1,this.currentActionIndex=-1,this.currentActionDetailIndex=-1}addActionItem(e){if(this.CurrentInteraction){let t=[];C.gJ[e.type]?.defaultActionData?(t=C.gJ[e.type].defaultActionData(),this.currentActionDetailIndex=0):this.currentActionDetailIndex=-1;const i=this.Id;this.currentActionIndex=(this.CurrentCondition??this.CurrentInteraction).actions.push({label:e.label,type:e.type,target:e.target,param:e.param,id:i,data:t})-1,(e.target||e.param)&&this.mode===P.Modal&&(this.newAddActionId=i)}}addActionDataItem(e){const t=this.CurrentAction;if(!t)return;let i=C.gJ[t.type]?.defaultData?.(e);return i.id=this.Id,i&&(this.currentActionDetailIndex=this.CurrentAction.data.push(i)-1),i}removeActionDataItem(e){E.Utils.arrayRemoveIf(this.CurrentAction.data,(t=>t.objectId===e)),this.currentActionDetailIndex=this.CurrentAction.data.length>0?0:-1}addParamItem(e){const t=this.CurrentAction;t&&(this.currentActionDetailIndex=t.data.push({id:this.Id,key:e,value:{type:"value",value:""}})-1)}addNewCondition(){a()(this.tempCondition,{isAll:!0,name:"\u60c5\u5f62"+R++,conditions:[],actions:[]})}addNewCompare(e){const t={value1:{type:"value",value:""},value2:{type:"value",value:""},type:E.CompareType.Equal,id:this.Id};var i;void 0!==e?(l()(i=this.tempCondition.conditions).call(i,e+1,0,t),this.currentCompareIndex=e+1):this.currentCompareIndex=this.tempCondition.conditions.push(t)-1}removeCompare(e){var t;l()(t=this.tempCondition.conditions).call(t,e,1),this.currentCompareIndex=0===this.tempCondition.conditions.length?-1:0}saveConditions(){return this.CurrentInteraction.actions.length>0&&((0,x.LO)(this.tempCondition.actions).replace(this.CurrentInteraction.actions),this.CurrentInteraction.actions.length=0),this.tempCondition.id=this.Id,this.CurrentCondition?a()(this.CurrentCondition,(0,x.ZN)(this.tempCondition)):(this.currentConditionIndex=this.CurrentInteraction.conditions.push((0,x.ZN)(this.tempCondition))-1,this.currentActionIndex=-1,this.currentActionDetailIndex=-1),this.mode===P.List&&this.updateDatabase(),this.tempCondition.id}editorCondition(){const e=this.CurrentCondition;e&&a()(this.tempCondition,(0,x.ZN)(e))}removeParamItem(e){E.Utils.arrayRemoveIf(this.CurrentAction.data,(t=>t.key===e)),this.currentActionDetailIndex=this.CurrentAction.data.length>0?0:-1}remove(){let e=!1;var t;if(this.currentActionDetailIndex>=0)l()(t=this.CurrentAction.data).call(t,this.currentActionDetailIndex,1),this.currentActionDetailIndex=this.getArray0Index(this.CurrentAction.data),-1===this.currentActionDetailIndex&&this.remove(),e=!0;else if(this.currentActionIndex>=0){var i,r;if(this.CurrentCondition)l()(i=this.CurrentCondition.actions).call(i,this.currentActionIndex,1),this.currentActionIndex=this.getArray0Index(this.CurrentCondition.actions),e=!0;else l()(r=this.CurrentInteraction.actions).call(r,this.currentActionIndex,1),this.currentActionIndex=this.getArray0Index(this.CurrentInteraction.actions),e=!0}else if(this.currentConditionIndex>=0){var n;l()(n=this.CurrentInteraction.conditions).call(n,this.currentConditionIndex,1),this.currentConditionIndex=this.getArray0Index(this.CurrentInteraction.conditions),e=!0}else if(this.currentEventIndex>=0){var s;if(this.mode===P.Modal)l()(s=this.interactions).call(s,this.currentEventIndex,1),this.currentEventIndex=this.getArray0Index(this.interactions);else this.removeRealList();e=!0}this.mode===P.List&&e&&this.updateDatabase()}setAllIndex(e,t,i,r){this.currentActionDetailIndex=void 0!==e?e:-1,this.currentActionIndex=void 0!==t?t:-1,this.currentConditionIndex=void 0!==i?i:-1,this.currentEventIndex=void 0!==r?r:void 0,-1!==this.currentEventIndex&&(this.tabIndex=1),void 0!==e&&this.mode===P.List&&(this.step=3,this.isEditor=!0)}removeRealList(){if(this.SelectEntity){const e=this.entityInteractions[this.SelectEntity.Id];l()(e).call(e,this.currentEventIndex,1),this.entityInteractions[this.SelectEntity.Id]=[...e],this.currentEventIndex=this.getArray0Index(e)}else{var e;l()(e=this.realInteractions).call(e,this.currentEventIndex,1),this.currentEventIndex=this.getArray0Index(this.realInteractions)}}handleUp(e,t){if(0===t)return;let i=e[t-1];e[t-1]=e[t],e[t]=i,2===this.mode&&this.updateDatabase()}handleDown(e,t){if(t===e.length-1)return;let i=e[t+1];e[t+1]=e[t],e[t]=i,2===this.mode&&this.updateDatabase()}save(){this.save2RealInteractions(),this.updateDatabase()}save2VsInteractions(){if(this.SelectEntity){const e=this.entityInteractions[this.SelectEntity.Id]??[];(0,x.LO)(this.interactions).replace((0,x.ZN)(e))}else(0,x.LO)(this.interactions).replace((0,x.ZN)(this.realInteractions))}save2RealInteractions(){this.SelectEntity?this.entityInteractions[this.SelectEntity.Id]=(0,x.ZN)(this.interactions):(0,x.LO)(this.realInteractions).replace((0,x.ZN)(this.interactions))}updateState(e){e()}updateDatabase(){var e;const t=S.gV.intance.Database.InteractionTable,i=new(c()),r=[...(0,x.ZN)(this.realInteractions)];for(const[,e]of d()(this.entityInteractions))r.push(...(0,x.ZN)(e));for(const e of r){let r;if(e.objectId?(r=e.objectId.Object,r.List=[]):(r=new E.Interaction.Interaction(e.type,this.SelectEntity?.ObjectId),t.append(r),e.objectId=r.ObjectId),e.conditions.length>0)for(const t of e.conditions){const e=new E.Interaction.Condition;e.isAll=t.isAll;for(const i of t.conditions){const t=new E.Interaction.Compare;t.value1=(0,x.ZN)(i.value1),t.value2=(0,x.ZN)(i.value2),t.type=i.type,e.addCompare(t)}for(const i of t.actions){if(!i.type)continue;const t=this.addWidget(i);t&&e.add(t)}r.add(e)}else for(const t of e.actions){if(!t.type)continue;const e=this.addWidget(t);e&&r.add(e)}i.add(r.ObjectId)}t.remove(f()(e=t.objects).call(e,(e=>!i.has(e.ObjectId)))),T.T.save(!1)}addWidget(e){const t=C.gJ[e.type]?.handleData;let i=t?t(e.data):(0,x.ZN)(e.data);const r=E.HCFactory.CreateObject(e.type);return r&&r.fromJSON(i),r}reset(){this.interactions.length=0,this.realInteractions.length=0,this.tempCondition.actions.length=0,this.entityInteractions={},this.resetIndexs()}resetIndexs(){this.currentEventIndex=-1,this.currentActionIndex=-1,this.currentActionDetailIndex=-1,this.currentCompareIndex=-1,this.currentConditionIndex=-1,this.tabIndex=0}load(e){this.reset();for(const i of e){let e=this.realInteractions;i.Target&&(e=this.entityInteractions[i.Target.Index],e||(e=[]));let r=[],n=[];var t;if(i.List[0]?.IsContainer)r=_()(t=i.List).call(t,(e=>({name:e.Name,isAll:e.isAll,id:this.Id,conditions:this.loadCompares(e.compares),actions:this.loadActions(e.list)})));else n=this.loadActions(i.List);e.push({label:w.o[i.TriggerType],type:i.TriggerType,id:this.Id,conditions:r,actions:n,objectId:i.ObjectId}),i.Target&&(this.entityInteractions[i.Target.Index]=e)}}loadActions(e){return _()(e).call(e,(e=>{const t=e.constructor;return{label:t.schema.label,type:t.type,target:!0,id:this.Id,data:C.gJ[t.type].loadWidgetData?.(e)??[]}}))}loadCompares(e){return _()(e).call(e,(e=>({value1:e.value1,value2:e.value2,type:e.type,id:this.Id})))}getActionAllIds(e){const t=[e.id],i=e=>{for(const i of e)t.push(i.id)};if(e.conditions.length>0)for(const r of e.conditions)t.push(r.id),i(r.actions);else i(e.actions);return t}isUsedEvent(e){var t;return!!y()(t=this.RealInteractionList).call(t,(t=>t.type===e))}getExpnadIds(e){const t=[e.id];for(const i of e.actions)t.push(i.id);for(const i of e.conditions){t.push(i.id);for(const e of i.actions)t.push(e.id)}return t}isUsedEntity(e){var t;return!!this.CurrentAction&&!!y()(t=this.CurrentAction.data).call(t,(t=>t.objectId===e))}getArray0Index(e){return e.length>0?0:-1}},(0,n.Z)(r.prototype,"RealInteractionList",[x.Fl],b()(r.prototype,"RealInteractionList"),r.prototype),(0,n.Z)(r.prototype,"changeTabIndex",[x.aD],b()(r.prototype,"changeTabIndex"),r.prototype),(0,n.Z)(r.prototype,"addInteraction",[x.aD],b()(r.prototype,"addInteraction"),r.prototype),(0,n.Z)(r.prototype,"addActionDataItem",[x.aD],b()(r.prototype,"addActionDataItem"),r.prototype),(0,n.Z)(r.prototype,"removeActionDataItem",[x.aD],b()(r.prototype,"removeActionDataItem"),r.prototype),(0,n.Z)(r.prototype,"addParamItem",[x.aD],b()(r.prototype,"addParamItem"),r.prototype),(0,n.Z)(r.prototype,"addNewCondition",[x.aD],b()(r.prototype,"addNewCondition"),r.prototype),(0,n.Z)(r.prototype,"addNewCompare",[x.aD],b()(r.prototype,"addNewCompare"),r.prototype),(0,n.Z)(r.prototype,"removeParamItem",[x.aD],b()(r.prototype,"removeParamItem"),r.prototype),(0,n.Z)(r.prototype,"setAllIndex",[x.aD],b()(r.prototype,"setAllIndex"),r.prototype),(0,n.Z)(r.prototype,"removeRealList",[x.aD],b()(r.prototype,"removeRealList"),r.prototype),(0,n.Z)(r.prototype,"handleUp",[x.aD],b()(r.prototype,"handleUp"),r.prototype),(0,n.Z)(r.prototype,"handleDown",[x.aD],b()(r.prototype,"handleDown"),r.prototype),(0,n.Z)(r.prototype,"reset",[x.aD],b()(r.prototype,"reset"),r.prototype),r)},93765:(e,t,i)=>{i.d(t,{U:()=>l});var r=i(31025),n=i(57055),s=i(6475),a=i(29115),o=i(93187);const l=new class{constructor(){this._projectId=0,this.particleDisplay=!0,this.bgType=n.SkyboxMode.None,this._appIndexId=void 0,this._projectName="",(0,r.ky)(this)}get projectId(){return this._projectId}set projectId(e){this._projectId=e}get BgType(){return this.bgType}set BgType(e){this.bgType=e}get appIndexId(){return this._appIndexId}set appIndexId(e){this._appIndexId=e}get projectName(){return this._projectName}set projectName(e){this._projectName=e}async loadProject(e){if(this.projectId=e,!e)return;const t=await(0,a.ZL)(s.U.detail+e);if(t.code===a.Mx.Ok&&t.data?.info){this.appIndexId=t.data.info.preview_app_id,this.projectName=t.data.info.name;const e=t.data.info.variable;e&&o.E.globalVarStore.setVariable(JSON.parse(e))}}}},17665:(e,t,i)=>{i.d(t,{H:()=>u});var r,n=i(41843),s=i(26117),a=i.n(s),o=i(31025),l=i(92604),h=i(99394),c=i(46266);const u=new(r=class{constructor(){this.userName="",this.userCode="",this.userId="",this.userRole=[],(0,o.ky)(this,{userCode:!1})}get UserName(){return this.userName}set UserName(e){this.userName=e}get UserId(){return this.userId}set UserId(e){this.userId=e}get UserRole(){return this.userRole}set UserRole(e){this.userRole=e}logOut(){(0,l.gy)(),c.Z.signoutRedirect()}getUserInfo(){(0,h.s7)("editor/user/detail",{}).then((e=>{if(e&&e.data&&e.data.info){this.userId=e.data.info.user_code,this.userName=e.data.info.user_name,this.userCode=e.data.info.user_code;let t=[];if(e.data.info.Role&&e.data.info.Role.length>0)for(let i of e.data.info.Role)t.push(i.role_code);this.userRole=t}}))}},(0,n.Z)(r.prototype,"getUserInfo",[o.aD],a()(r.prototype,"getUserInfo"),r.prototype),r)},27660:(e,t,i)=>{i.d(t,{l:()=>$});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(61799),l=i.n(o),h=i(5996),c=i.n(h),u=i(20658),d=i.n(u),p=i(3434),f=i.n(p),m=i(97828),_=i.n(m),g=i(93213),y=i(41843),v=i(12625),b=i.n(v),E=i(39282),x=i.n(E),C=i(51463),w=i.n(C),S=i(14549),T=i.n(S),P=i(27566),A=i.n(P),R=i(62750),M=i.n(R),O=i(66989),I=i.n(O),D=i(26117),F=i.n(D),L=i(2361),k=i(93765),B=i(73554),N=i(6475),z=i(29115),U=i(31025),G=i(12117),j=i(71722),V=i.n(j);let Z;!function(e){e.Component="component",e.Files="files"}(Z||(Z={}));const W=[Z.Component,Z.Files];class H{static async getIdb(){return await this.iDb.open(),this.iDb}constructor(){this.opening=!1,this._db=void 0,this.resFunctionList=[]}open(){return new(V())(((e,t)=>{if(this._db)return void e(!0);if(this.resFunctionList.push(e),this.opening)return;this.opening=!0;const i=indexedDB.open("HC",W.length);i.onerror=function(e){t(!1)},i.onsuccess=e=>{var t;this._db=e.target.result,this._db.onclose=e=>{this._db=null,this.opening=!1},c()(t=this.resFunctionList).call(t,(e=>e())),this.resFunctionList.length=0},i.onupgradeneeded=e=>{this._db=e.target.result;for(let t=e.oldVersion;t<W.length;t++)this._db.createObjectStore(W[t])}}))}put(e,t,i){this._db.transaction(e,"readwrite").objectStore(e).put(i,t)}get(e,t){const i=this._db.transaction(e,"readwrite");return new(V())((r=>{i.objectStore(e).get(t).onsuccess=function(e){r(e.target.result)}}))}getAll(e){const t=this._db.transaction(e,"readwrite");return new(V())((i=>{t.objectStore(e).getAll().onsuccess=function(e){i(e.target.result)}}))}clear(e){this._db.transaction(e,"readwrite").objectStore(e).clear()}delete(e,t){this._db.transaction(e,"readwrite").objectStore(e).delete(t)}}H.iDb=new H;var K,q=i(89487),X=i(19853);function Y(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=l()(r).call(r,(function(t){return F()(e,t).enumerable}))),i.push.apply(i,r)}return i}function Q(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?c()(i=Y(Object(n),!0)).call(i,(function(t){(0,g.Z)(e,t,n[t])})):d()?f()(e,d()(n)):c()(r=Y(Object(n))).call(r,(function(t){_()(e,t,F()(n,t))}))}return e}const $=new(K=class{constructor(){this.dirList=[],this.assetMap=new(b()),this.usedAssets=new(x()),this._open=!1,this._current=null,this._selectId=0,this.collKeys=new(x()),this._prefix="",this.loadLocal=async()=>{const e=await H.getIdb(),t=await e.getAll(Z.Component);return w()(t).call(t,(e=>(0,G.RM)(e))),t},(0,U.ky)(this,{assetMap:!1,usedAssets:!1})}get selectId(){return this._selectId}set selectId(e){this._selectId=e}get open(){return this._open}set open(e){this._open=e}get current(){return this._current}set current(e){e?this._current?T()(this._current,e):this._current=(0,U.ZN)(e):this._current=null}startEditor(e,t){this.open=!0,this.current={code:t??L.fl,id:void 0,title:void 0,propertys:[]},this.selectId=e}toggleExpand(e){this.collKeys.has(e)?this.collKeys.delete(e):(this.collKeys.add(e),this.updateDirList(e)),this.collKeys=new(x())((0,U.ZN)(this.collKeys))}isExpand(e){return this.collKeys.has(e)}get prefix(){return this._prefix}set prefix(e){this._prefix=e}async updateDirList(e,t=this.dirList){A()(e)||(e=[e]);const i=new(b());for(const t of e){let e=await(0,q.fD)(N.fL.Component,t);e||(e=[]),i.set(t,e)}for(const e of t)if(i.has(e.id)){const t=[];for(const r of i.get(e.id)){const e=await(0,q.hr)(r.id),i=e.json_data;let n={};if(i){const e=JSON.parse(i);n=e.data,n.camera=e.camera,(0,G.RM)(Q(Q({},n),{},{id:r.id}))}t.push(Q(Q({},n),{},{id:r.id,title:r.name,preview:(0,X.qm)(r,!0,!0),data:{id:r.id,component:!0,key:(0,G.d1)(r.id),name:r.name,modelId:r.uuid},moduleIds:e?.resources??""}))}(0,U.z)((()=>{e.children=t}))}(0,U.z)((()=>{this.dirList=t}))}getComponents(e=[]){return e?w()(e).call(e,(e=>{const t=JSON.parse(e.data.jsonData),i=t?.version?t.data:t;return(0,G.RM)(Q(Q({},i),{},{id:e.data.ID})),Q(Q({},i),{},{id:e.data.ID,title:e.title,preview:e.data.picUrl,data:{id:e.data.ID,component:!0,key:(0,G.d1)(e.data.ID),name:e.title}})})):[]}async loadUsedComponent(e=[]){for(const t of e){if((0,G.zJ)(t))continue;const e=await(0,q.Cq)(t);if(e){const i=JSON.parse(e).data;(0,G.RM)(Q(Q({},i),{},{id:t}))}}}addDir(){this.dirList.push({name:"\u65b0\u5efa\u76ee\u5f55",node_type:"dir",id:-1,editor:!0})}async handleDir(e){let t;t=-1===e.id?await(0,q.zs)({name:e.name,sourceType:N.fL.Component}):await(0,q.py)(e),t.code===z.Mx.Ok&&this.load()}startRenameDir(){for(const e of this.dirList)if(e.id===this._selectId)return void(e.editor=!0)}async deleteDir(){(await(0,z.QO)(N.au.delete,{data:{id:this._selectId}})).code===z.Mx.Ok&&(this.selectId=0,this.load())}async load(e){const t=await(0,q.fD)(N.fL.Component,0,e);t&&await this.updateDirList(M()(this.collKeys),t)}async addComponent(e,t,i){if(!this._selectId)return void B.y.error("\u6ca1\u9009\u62e9\u76ee\u5f55");(0,G.RM)(e);const r=await(0,q.cT)({name:e.title,jsonData:I()({version:1,data:this.getCompontData(e),camera:i}),sourceType:N.fL.Component,moduleIds:t,projectId:k.U.projectId,pid:this._selectId});return r.code===z.Mx.Ok?r.data?.[0]?.id:void 0}updateComponent(e,t){return(0,U.z)((async()=>{(0,G.RM)((0,U.ZN)(e));return(await(0,q.Dd)({id:e.id,name:e.title,sourceType:N.fL.Component,resources:e.moduleIds,json_data:I()({version:1,data:this.getCompontData(e),camera:t}),pid:this._selectId})).code===z.Mx.Ok}))}async deleteComponent(e){(0,G.jz)(e);(await(0,z.QO)(N.au.delete,{data:{id:e.id}})).code===z.Mx.Ok&&(this.load(),B.y.success("\u5220\u9664\u6210\u529f"))}getCompontData(e){return{code:e.code,propertys:e.propertys}}async getPrefix(){const e=await(0,z.ZL)(N.yy.prefix);e.code===z.Mx.Ok&&(this.prefix=e.data.prefix)}},(0,y.Z)(K.prototype,"isExpand",[U.Fl],F()(K.prototype,"isExpand"),K.prototype),K)},70485:(e,t,i)=>{i.d(t,{T:()=>O});var r,n=i(41843),s=i(39282),a=i.n(s),o=i(62750),l=i.n(o),h=i(14549),c=i.n(h),u=i(66989),d=i.n(u),p=i(13567),f=i.n(p),m=i(5996),_=i.n(m),g=i(26117),y=i.n(g),v=i(537),b=i(29115),E=i(57055),x=i(31025),C=i(6475),w=i(65492),S=i(54056),T=i(73554),P=i(19853),A=i(27660),R=i(93765),M=i(40652);const O=new(r=class{constructor(){this.isOpenModal=!1,this.fileList=[],this.currentFileId=0,this.currentFileName="\u672a\u547d\u540d\u573a\u666f",this.loadingEntity={loading:!1,value:0},this.selectedModels=[],this.modelIds=new(a()),this.componentIds=new(a()),this.saveNewFile=null,this.selectFile={id:0,name:""},this.codeList=[],this.url2d="",this._editorScriptId=0,this._loading=!1,(0,x.ky)(this,{modelIds:!1,componentIds:!1,saveNewFile:!1});const e=new BroadcastChannel("preview_channel");e.addEventListener("message",(t=>{"load"===t.data&&e.postMessage({type:"data",data:S.gV.intance?.saveFile?.(),components:l()(this.componentIds)})}))}get Url2d(){return this.url2d}set Url2d(e){this.url2d=e}get loading(){return this._loading}set loading(e){this._loading=e}set SelectFile(e){c()(this.selectFile,e)}get editorScriptId(){return this._editorScriptId}set editorScriptId(e){this._editorScriptId=e}addUseModel(e){e&&this.modelIds.add(e)}async addFile(e,t){this.currentFileName=e;const i={title:e,id:-1,preview:"",data:{key:"file"}};this.saveNewFile?(t=this.saveNewFile,this.saveNewFile=null):(this.reset(),t||S.gV.intance.new());const r=await(0,w.yD)({name:e,pic_key:"icon.png",jsonData:d()({version:1,data:t,componentIds:l()(this.componentIds)}),sourceType:C.fL.Files,resources:l()(this.modelIds).join(","),projectId:R.U.projectId});return r.code===b.Mx.Ok?(i.id=r.data.id,i.preview=r.data.uuid+"/icon.png",await(0,w.aP)(r.data.id,(()=>S.gV.intance.Viewer.getPreviewUrl())),this.fileList.push(i),1===this.fileList.length&&this.setAppIndex(r.data.id),this.currentFileId=r.data.id,this.currentFileId):r.code===b.Mx.Error&&r.error?(T.y.error(r.error[0]),!1):void 0}async save(e=!0){const t=S.gV.intance.saveFile(),i={version:1,data:t,components:l()(this.componentIds),scripts:(0,x.ZN)(this.codeList),url2d:this.url2d};if(e&&this.currentFileId&&await(0,w.aP)(this.currentFileId,(()=>S.gV.intance.Viewer.getPreviewUrl())),this.currentFileId){for(const e of this.fileList)if(e.id===this.currentFileId)return(0,x.z)((async()=>{c()(e,{data:i,preview:e.preview+"?t="+f()()});return(await(0,w.KT)({id:this.currentFileId,jsonData:d()(i),name:this.currentFileName,resources:l()(this.modelIds).join(","),project_id:R.U.projectId})).code===b.Mx.Ok}))}else this.saveNewFile=t,this.isOpenModal=!0;return!1}async updateFileName(e,t=this.currentFileId){this.currentFileName=e;for(const i of this.fileList)if(i.id===t)return c()(i,{title:e}),(0,v.N)((async()=>(await(0,w.KT)({id:t,name:e,project_id:R.U.projectId})).code===b.Mx.Ok),300),!0;return!1}async load(e){this.reset(),this.currentFileId=e;const t=await(0,w.YZ)(e);if(t?.json_data){var i;this.currentFileName=t.name;const e=JSON.parse(t.json_data);this.url2d=e.url2d,this.componentIds=e.components?new(a())((0,x.ZN)(e.components)):new(a()),(0,x.LO)(this.codeList).replace(e.scripts??[]),_()(i=t.resources.split(",")).call(i,(e=>this.modelIds.add(e))),await A.l.loadUsedComponent(e.components),S.gV.intance.loadFile(e?.data??null)}}getIsSelect(e){return this.currentFileId===e}async loadFileList(e){this.fileList.length=0,this.loading=!0,await(0,x.gx)((()=>!!R.U.projectId));const t=await(0,w.yk)(R.U.projectId,e);if(this.loading=!1,t)return(0,x.z)((()=>{for(const e of t)e.file_key||this.fileList.push({id:e.id,title:e.name,preview:(0,P.qm)(e,!0),data:{key:"file"}})}))}async deleteFile(e){E.Utils.arrayRemoveIf(this.fileList,(t=>t.id===e)),this.currentFileId===e&&(this.currentFileId=void 0,(0,P.HY)("id",""),M.G.trigger({type:"Delete-File",target:null}));await(0,w.P2)(e)&&(this.SelectFile={id:0,name:""},T.y.success("\u5220\u9664\u6587\u4ef6\u6210\u529f"))}exportFile(){const e=S.gV.intance.saveFile();E.Utils.FileSystem.writeFile(this.currentFileName+".hc3d",d()({version:1,components:l()(this.componentIds),data:e,type:"hc3d"}))}importFile(){E.Utils.FileSystem.chooseFile({filter:"hc3d",callback:e=>{if(e[0]){const t=new FileReader;t.readAsText(e[0]),t.onload=e=>{try{const e=JSON.parse(t.result);"hc3d"===e.type&&(S.gV.intance.loadFile(e.data),this.componentIds=new(a())(e.components??[]))}catch(e){}}}}})}openModal(e=!1){e&&(this.currentFileId=void 0),this.isOpenModal=!0}closeModal(){this.isOpenModal=!1}setLoadProcess(e,t=0){c()(this.loadingEntity,{loading:e,value:t})}async copy(e,t){return(await(0,b.qu)(C.yy.copy,{src_id:e,project_id:t??R.U.projectId})).code===b.Mx.Ok}async move(e,t,i){if(i)return await this.copy(t,e);return(await(0,b.pz)(C.yy.update,{id:t,project_id:e})).code===b.Mx.Ok}async setAppIndex(e){(0,b.qu)(C.yy.preview,{id:e}).then((t=>{R.U.appIndexId=e}))}set SelectedModels(e){this.selectedModels=e}get SelectedModels(){return this.selectedModels}reset(){this.currentFileId=void 0,this.modelIds.clear(),this.codeList.length=0}appendCodeScript(e){this.codeList.push(e)}updateCodeScript(e){for(const t of this.codeList)t.id===e.id&&c()(t,e)}deleteScript(e){E.Utils.arrayRemoveIf(this.codeList,(t=>t.id===e))}},(0,n.Z)(r.prototype,"save",[x.aD],y()(r.prototype,"save"),r.prototype),(0,n.Z)(r.prototype,"load",[x.aD],y()(r.prototype,"load"),r.prototype),(0,n.Z)(r.prototype,"getIsSelect",[x.Fl],y()(r.prototype,"getIsSelect"),r.prototype),(0,n.Z)(r.prototype,"openModal",[x.aD],y()(r.prototype,"openModal"),r.prototype),(0,n.Z)(r.prototype,"setLoadProcess",[x.aD],y()(r.prototype,"setLoadProcess"),r.prototype),r)},93187:(e,t,i)=>{i.d(t,{E:()=>b});var r=i(31025);class n{constructor(){(0,r.ky)(this)}}var s=i(32849),a=i.n(s),o=i(58044),l=i.n(o),h=i(14549),c=i.n(h),u=i(66989),d=i.n(u),p=i(6475),f=i(29115),m=i(73554),_=i(93765);let g=1;class y{constructor(){this._open=!1,this.variables=[],this.oldOvariables=[],this.globalId=void 0,this.currentIndex=-1,(0,r.ky)(this,{oldOvariables:!1,globalId:!1})}get Open(){return this._open}set Open(e){e&&(this.oldOvariables=(0,r.ZN)(this.variables)),this._open=e}get CurrentIndex(){return this.currentIndex}set CurrentIndex(e){this.currentIndex=e}setVariable(e){(0,r.LO)(this.variables).replace(e)}add(){var e;let t="newVar"+g++;a()(e=this.variables).call(e,(e=>e.key===t))&&(t+="(1)"),this.currentIndex=this.variables.push({key:t,value:"",desc:""})-1}delete(){var e;this.currentIndex>=0&&(l()(e=this.variables).call(e,this.currentIndex,1),this.currentIndex=this.currentIndex-1<0?0:this.currentIndex-1)}update(e,t){var i;const r=a()(i=this.variables).call(i,(t=>t.key===e));r&&c()(r,t)}up(){const e=this.currentIndex;e>0&&([this.variables[e],this.variables[e-1]]=[this.variables[e-1],this.variables[e]],this.currentIndex-=1)}down(){const e=this.currentIndex;e<this.variables.length-1&&([this.variables[e],this.variables[e+1]]=[this.variables[e+1],this.variables[e]],this.currentIndex+=1)}confirm(){this._open=!1,this.save()}async load(e){const t=await(0,f.ZL)(p.U.detail+e);if(t.code===f.Mx.Ok&&t.data?.info){const e=t.data.info.variable;e&&(this.variables=JSON.parse(e))}}async save(){(await(0,f.pz)(p.U.edit,{id:_.U.projectId,variable:d()((0,r.ZN)(this.variables))})).code===f.Mx.Ok&&m.y.success("\u53d8\u91cf\u4fdd\u5b58\u6210\u529f")}cancel(){this.reset(),this._open=!1}reset(){(0,r.LO)(this.variables).replace(this.oldOvariables)}}new y;class v{constructor(){this._open=!1,this.cloudServices=void 0,this.currentIndex=-1,(0,r.ky)(this)}get Open(){return this._open}set Open(e){this._open=e}get CurrentIndex(){return this.currentIndex}set CurrentIndex(e){this.currentIndex=e}getCloudServices(){}add(){}delete(){}batchDelete(){}update(){}confirm(){this._open=!1}cancel(){this.reset(),this._open=!1}reset(){}}const b=new class{constructor(){this.globalVarStore=new y,this.dataBindStore=new n,this.cloudServicesStore=new v,(0,r.ky)(this)}}},24729:(e,t,i)=>{i.d(t,{QT:()=>o,eR:()=>s,l:()=>a});var r=i(52069),n=i.n(r);function s(e,t){const i={};for(const r in e)e.hasOwnProperty(r)&&("number"==typeof e[r]?i[r]=t?t(e[r]):e[r].toString():i[r]=e[r]);return i}function a({x:e,y:t,z:i},r){return r||(r=e=>e),{x:r(n()(e)||0),y:void 0===t?void 0:r(n()(t)||0),z:void 0===i?void 0:r(n()(i)||0)}}function o(e,t){t||(t=e=>e);const i={};for(const r in e)"string"==typeof e[r]?i[r]=t(n()(e[r])):i[r]=e[r];return i}},92604:(e,t,i)=>{i.d(t,{LP:()=>s,gy:()=>o,o4:()=>a});i(97539),i(5996);var r=i(19082);const n="Admin-Token";function s(){return r.Z.get(n)}function a(e){return r.Z.set(n,e)}function o(){return r.Z.remove(n)}},29115:(e,t,i)=>{i.d(t,{GH:()=>O,Mx:()=>M,QO:()=>B,ZL:()=>F,pz:()=>k,qu:()=>L});var r=i(93213),n=i(71722),s=i.n(n),a=i(29405),o=i.n(a),l=i(20246),h=i.n(l),c=i(39831),u=i.n(c),d=i(61799),p=i.n(d),f=i(26117),m=i.n(f),_=i(5996),g=i.n(_),y=i(20658),v=i.n(y),b=i(3434),E=i.n(b),x=i(97828),C=i.n(x),w=i(73554),S=i(43653),T=i.n(S),P=i(92604);function A(e,t){var i=h()(e);if(u()){var r=u()(e);t&&(r=p()(r).call(r,(function(t){return m()(e,t).enumerable}))),i.push.apply(i,r)}return i}function R(e){for(var t=1;t<arguments.length;t++){var i,n,s=null!=arguments[t]?arguments[t]:{};t%2?g()(i=A(Object(s),!0)).call(i,(function(t){(0,r.Z)(e,t,s[t])})):v()?E()(e,v()(s)):g()(n=A(Object(s))).call(n,(function(t){C()(e,t,m()(s,t))}))}return e}let M;!function(e){e[e.Ok=0]="Ok",e[e.InvalidToken=61]="InvalidToken",e[e.Error=50]="Error"}(M||(M={}));const O=T().create({baseURL:"https://hc3d-core.histron.cn"});O.interceptors.request.use((e=>{let t=(0,P.LP)();return t&&(e.headers.Authorization="Bearer "+t),e}),(e=>s().reject(e)));const I={code:-1,data:null};O.interceptors.response.use((function(e){return e.data.code===M.InvalidToken&&(w.y.error("\u767b\u5f55\u5df2\u8fc7\u671f",{preventDuplicate:!0}),window.IGNORE_INVAILID_TOKEN||o()((()=>{(0,P.gy)(),window.location.reload()}),1e3)),e.data.code===M.Error&&e.data.error&&w.y.error(e.data.error?.[0]),s().resolve(e.data)}),(function(e){return s().reject(I)}));const D=async e=>(w.y.error("\u8bf7\u6c42\u53d1\u751f\u9519\u8bef"),R(R({},I),{},{msg:e?.message??"\u8bf7\u6c42\u53d1\u751f\u9519\u8bef"}));async function F(e,t){return O.get(e,t).catch(D)}async function L(e,t,i){return O.post(e,t,i).catch(D)}async function k(e,t,i){return O.put(e,t,i).catch(D)}async function B(e,t){return O.delete(e,t).catch(D)}},40652:(e,t,i)=>{i.d(t,{G:()=>r});const r=new(i(57055).EventDispatcher)},92513:(e,t,i)=>{i.d(t,{F:()=>r});const r=function(){var e=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy-]/g,(function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)}))}},12117:(e,t,i)=>{i.d(t,{RM:()=>h,Xr:()=>o,d1:()=>a,jz:()=>c,uf:()=>u,zJ:()=>l});var r=i(34682),n=i.n(r),s=i(57055);function a(e){return`CustomComponent_${e}`}function o(e){if(e)try{return new Function("HC","return "+n()(e).call(e))(s)}catch(e){return null}}function l(e){const t=a(e);return s.HCFactory.isRegister(t)}function h(e){const{code:t,id:i,propertys:r,title:n}=e;if(!t)return;const l=o(t);l.type=a(i),l.Schema={title:n,propertys:r},s.RegisterComponent(l)}function c(e){s.UnRegisterComponent(a(e.id))}function u(e){return new Function("return "+n()(e).call(e))}},81215:(e,t,i)=>{i.d(t,{i:()=>d});var r=i(32735),n=i(44645),s=i(75393),a=i(68867),o=i(37211),l=i(58181),h=i(8096),c=i(57426);const u=({title:e,content:t,onOk:i,onClose:n})=>{const[u,d]=r.useState(!0),p=()=>{d(!1)};return r.createElement("div",null,r.createElement(a.Z,{open:u,onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:"lg"},r.createElement(c.Z,{id:"alert-dialog-title",sx:{fontSize:"16px"}},e||"\u63d0\u793a"),r.createElement(l.Z,{sx:{width:400}},r.createElement(h.Z,{sx:{fontSize:"13px",color:"#333"},id:"alert-dialog-description"},t)),r.createElement(o.Z,null,r.createElement(s.Z,{onClick:()=>{p(),n&&n()}},"\u53d6\u6d88"),r.createElement(s.Z,{onClick:()=>{p(),i&&i()}},"\u786e\u5b9a"))))},d=({title:e,content:t,onOk:i,onClose:s})=>{const a=document.createElement("div");(0,n.s)(a).render(r.createElement(u,{title:e,content:t,onOk:i,onClose:s})),document.body.appendChild(a)}},73231:(e,t,i)=>{i.d(t,{r2:()=>u,l_:()=>p,lk:()=>m});var r=i(39282),n=i.n(r),s=i(66989),a=i.n(s),o=i(17665),l=i(70485);const h=document.createElement("canvas");let c=!1;window.addEventListener("unload",(()=>{c=!0}));class u{constructor(){window.addEventListener("error",(e=>{m(e.error?.stack??e)})),window.addEventListener("unhandledrejection",(e=>{m(e.reason?.stack??e)}))}}let d=new(n());const p=/^[\d.:(localhost)]+$/,f=function(){try{const e=h.getContext("experimental-webgl"),t=e.getExtension("WEBGL_debug_renderer_info");return e.getParameter(t.UNMASKED_RENDERER_WEBGL)}catch(e){return""}}();async function m(e,t="\u672a\u6355\u83b7\u7684\u9519\u8bef!"){try{if(c)return;if(p.test(window.location.hostname))return;if(d.has(e))return;d.add(e);let i=l.T.currentFileId,r=l.T.currentFileName;await fetch("https://cicd3d.gkiiot.com/report",{method:"POST",mode:"cors",body:a()({type:"error",stack:e,href:window.location.href,path:window.location.pathname,file:i,msg:t,version:"1657437749843",fileName:r,userAgent:navigator.userAgent,user:o.H.UserName,renderInfo:f}),headers:{"content-type":"application/json",origin:location.origin}})}catch(e){}}},70995:(e,t,i)=>{i.d(t,{$:()=>T,D4:()=>P,sA:()=>A});var r=i(20246),n=i.n(r),s=i(39831),a=i.n(s),o=i(61799),l=i.n(o),h=i(26117),c=i.n(h),u=i(5996),d=i.n(u),p=i(20658),f=i.n(p),m=i(3434),_=i.n(m),g=i(97828),y=i.n(g),v=i(93213),b=i(6475),E=i(29115),x=i(12117),C=i(19853);function w(e,t){var i=n()(e);if(a()){var r=a()(e);t&&(r=l()(r).call(r,(function(t){return c()(e,t).enumerable}))),i.push.apply(i,r)}return i}function S(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?d()(i=w(Object(n),!0)).call(i,(function(t){(0,v.Z)(e,t,n[t])})):f()?_()(e,f()(n)):d()(r=w(Object(n))).call(r,(function(t){y()(e,t,c()(n,t))}))}return e}async function T(e,t,i={}){const r=await(0,E.ZL)(b.au.detail+"/"+e);if(r.code===E.Mx.Ok){const n=r.data.info.json_data,s=JSON.parse(n).data;(0,x.RM)(S(S({},s),{},{id:e}));const a=t.create(S({type:(0,x.d1)(e)},i));return t.Editor.selectControl.SelectEntitys=[a],!0}return!1}async function P(e,t,i={}){const r=await(0,E.ZL)(b.au.detail+"/"+e);if(r.code===E.Mx.Ok){const e=r.data.info,n=e?.uuid+"/"+e.file_key,s=t.create(S({type:"ImportEntity",url:n},i));return t.Editor.selectControl.SelectEntitys=[s],!0}return!1}function A(e){const t=(0,C.GW)(location.href,"id",e.toString());history.replaceState({path:t},"",t)}},73554:(e,t,i)=>{i.d(t,{Q:()=>n,y:()=>s});var r=i(39282);const n=new(i.n(r)());class s{}s.info=(e,t={})=>{},s.warn=(e,t={})=>{},s.success=(e,t={})=>{},s.error=(e,t={})=>{},s.close=e=>{}},46266:(e,t,i)=>{i.d(t,{Z:()=>a});var r=i(6232),n=i.n(r);const s=window.location.origin+window.location.pathname,a=new(n().UserManager)({authority:"https://auth-trial.histron.cn/authcenter/oidc",client_id:"product-app",client_secret:"xyz",post_logout_redirect_uri:`${s}`,redirect_uri:s,response_type:"id_token token",scope:"email phone realname post",automaticSilentRenew:!0,accessTokenExpiringNotificationTime:10})},89122:(e,t,i)=>{i.d(t,{K:()=>n});var r=i(57055);function n(e){const t=e.data;if(!t)return;const i=new r.HCFiler(t);if(e.isGroup){const e=new r.ParticleSystemGroup;return e.readFile(i),e}{const e=new r.ParticleSystem;return e.readFile(i),e}}},1453:(e,t,i)=>{i.d(t,{h:()=>r});const r=new BroadcastChannel("preview_channel")},537:(e,t,i)=>{i.d(t,{N:()=>a});var r=i(29405),n=i.n(r);let s;function a(e,t=100){s&&clearTimeout(s),s=n()((()=>{e()}),t)}},19853:(e,t,i)=>{i.d(t,{$6:()=>p,GW:()=>c,HY:()=>d,q$:()=>h,qm:()=>u});var r=i(97539),n=i.n(r),s=i(13567),a=i.n(s),o=i(96867),l=i.n(o);const h="https://am-img.gkiiot.com/editor/static/images/";function c(e,t,i){if(void 0===i)return e;const r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),s=-1!==n()(e).call(e,"?")?"&":"?";return e.match(r)?e.replace(r,"$1"+t+"="+i+"$2"):e+s+t+"="+i}function u(e,t=!1,i=!0){let r=t?e.pic_key:e.file_key;return e.uuid&&(r=e.uuid+"/"+r),t&&i&&(r=c(r,"t",a()().toString())),r}function d(e,t){const i=c(location.href,e,t);history.replaceState({path:i},"",i)}function p(e,t,i=!1){const r=new(l())(e);return r.searchParams.delete(t),i&&history.replaceState({path:r.href},"",r.href),r.href}},83228:(e,t,i)=>{i.d(t,{HY:()=>y,P3:()=>f,SW:()=>x,Vl:()=>E,Vn:()=>g,ap:()=>v,p6:()=>m,v5:()=>b,zp:()=>_});i(71722);var r=i(29405),n=i.n(r),s=i(52069),a=i.n(s),o=i(97539),l=i.n(o),h=i(17349),c=i.n(h),u=i(34682),d=i.n(u),p=i(57055);function f(e,t=0){if("string"==typeof e&&(e=a()(e)),isNaN(e))return"";if(function(e,t,i=1e-5){return Math.abs(e-t)<=i}(e,0))return"0";let i=e.toFixed(t),r=l()(i).call(i,".");if(-1!==r){let e=0,t=i.length;for(let r=t;r--&&"0"===i[r];)e++;if(e>0)return e===t-r-1&&e++,c()(i).call(i,0,t-e)}return i}function m(e,t){if(/^\d+(\.\d+)?$/.test(e)){let i=new Date(e),r={"M+":i.getMonth()+1,"d+":i.getDate(),"h+":i.getHours(),"m+":i.getMinutes(),"s+":i.getSeconds(),"q+":Math.floor((i.getMonth()+3)/3),S:i.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(i.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in r)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?r[e]:("00"+r[e]).substr((""+r[e]).length)));return t}return(e=d()(e).call(e)).substr(0,t.length)}async function _(e){if(navigator.clipboard)return navigator.clipboard.writeText(e);{const t=document.createElement("input");return t.style.position="fixed",document.body.appendChild(t),t.setAttribute("value",e),t.value=e,n()((()=>{t.select(),document.execCommand("copy"),document.body.removeChild(t)}),0),!0}}async function g(){return navigator.clipboard?navigator.clipboard.readText():""}const y=e=>{const t=p.Utils.Color4.FromHexString(e);return{r:255*t.r,g:255*t.g,b:255*t.b,a:t.a}},v=e=>{let t=new XMLHttpRequest;return t.open("Get",e,!1),t.send(),404!==t.status};function b(e){if(!e)return"";return f(p.Utils.rad2Deg(e))}function E(e){if(!e)return;const t=a()(e);return p.Utils.deg2rad(t)}function x(){return localStorage.getItem("DEBUGBBL")}},57055:(e,t,i)=>{i.r(t),i.d(t,{ActionManagerType:()=>pe,AppConfig:()=>me,AppEvent:()=>le,AppStore:()=>_e,Application:()=>Gn,ArcRotateCameraControl:()=>hn,BaseCamera:()=>on,BaseDom:()=>ve,BaseGui:()=>Ee,BaseObject:()=>L,BaseTextureRecord:()=>Ur,BaseWidget:()=>Nr,Box:()=>Wn,CMD:()=>os,CameraEnable:()=>q,CameraManager:()=>un,CameraType:()=>xr,CameraViewMode:()=>X,CanvasControl:()=>Us,Capsule:()=>Qn,CenterType:()=>Q,CesiumViewer:()=>l,CompareType:()=>ee,Component:()=>Br,ConeEmitter:()=>Qs,Control:()=>s.Control,CustomArcRotateCameraPointersInput:()=>ln,Cylinder:()=>Xn,CylinderEmitter:()=>Ys,DataBind:()=>Ls,DataBindType:()=>Ds,DataCondition:()=>hs,Database:()=>Fn,DirectedCylinder:()=>$s,DirectionalLight:()=>is,EConditionType:()=>$,Editor:()=>tn,Emiter:()=>Ws,EmiterShape:()=>Gs,EmiterType:()=>js,Entity:()=>fe,EventDispatcher:()=>I,Factory:()=>S,FilePreviewer:()=>Vn,FreeCameraControl:()=>cn,Ground:()=>Jn,GroupRecord:()=>ra,HCFactory:()=>w,HCFiler:()=>F,HemisphericEmiter:()=>Xs,HemisphericLight:()=>kn,HighlightManager:()=>rn,History:()=>Zs,ISPROXYKEY:()=>Dr,ImportEntity:()=>ye,Interaction:()=>Fs,Light:()=>Ln,Lines:()=>Kn,MoveAction:()=>cs,MoveType:()=>J,MultiLine2:()=>be,ObjectId:()=>D,PBRMaterialRecord:()=>zn,Particle:()=>bn,ParticleSystem:()=>Js,ParticleSystemGroup:()=>ia,Plane:()=>Yn,PointLight:()=>es,PointTypeEnum:()=>de,PointerEventTypes:()=>n.PointerEventTypes,RadiusEmiter:()=>Hs,RainParticleSystem:()=>ta,RegisterComponent:()=>T,RenderType:()=>u,SceneControl:()=>_n,SceneHelper:()=>yn,SelectType:()=>K,SkyboxMode:()=>te,SnowParticleSystem:()=>ea,Solid3D:()=>Zn,Sphere:()=>qn,SphereEmiter:()=>Ks,SpotLight:()=>ts,StackPanelGui:()=>ks,StandardMaterialRecord:()=>ls,SubEmitter:()=>qs,TextureRecord:()=>Un,Torus:()=>$n,TransformMode:()=>Y,UnRegisterComponent:()=>P,Utils:()=>ie,Video:()=>Ns,VideoGui:()=>zs,Viewer:()=>vn,autoRecord:()=>kr,autoUpdate:()=>Lr,begin:()=>Or,defineProperty:()=>Fr,end:()=>Ir,getFunctionName:()=>Rr});var r=i(64595),n=i(2851),s=i(17217),a=i(77889);i(58603),i(65301),i(5515);class o{constructor(e){this.show=!0,this.viewer=e.viewer,this.height=e.height,this.position=r.Cartesian3.fromDegrees(e.position[0],e.position[1],e.height),this.div||(this.div=document.createElement("div"),this.addLabel(e))}addLabel(e){this.div.id=e.id,this.div.style.position="absolute",this.div.style.width="100px",this.div.style.height="30px",e=`<div>${e.title}</div>`,this.div.innerHTML=e,this.viewer.cesiumWidget.container.appendChild(this.div),this.addPostRender()}addPostRender(){this.viewer.scene.postRender.addEventListener(this.postRender,this)}postRender(){var e=this.viewer.scene.canvas.height,t=new r.Cartesian2;r.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.position,t),this.div.style.bottom=e-t.y+100+"px",e=this.div.offsetWidth,this.div.style.left=t.x-e/2+"px",t=this.viewer.camera.position,e=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(t).height;e+=this.viewer.scene.globe.ellipsoid.maximumRadius,!(r.Cartesian3.distance(t,this.position)>e)&&this.viewer.camera.positionCartographic.height<5e7&&!0===this.show?this.div.style.display="block":this.div.style.display="none"}}class l{constructor(){this.open=!1}static getSurfaceArea(e){if(e.length<3)return 0;var[t,i,r]=[e[0].x,e[0].y,e[0].z],[n,s,a]=[e[1].x,e[1].y,e[1].z],[o,l,h]=[e[2].x,e[2].y,e[2].z];const c=Math.pow;var a,u=c((s-i)*(h-r)-(l-i)*(a-r),2)+c((o-t)*(a-r)-(n-t)*(h-r),2)+c((n-t)*(l-i)-(o-t)*(s-i),2),d=((s-i)*(h-r)-(l-i)*(a-r))/c(u,.5),p=((o-t)*(a-r)-(n-t)*(h-r))/c(u,.5),f=((n-t)*(l-i)-(o-t)*(s-i))/c(u,.5);let m=f*((a=e[e.length-1]).x*i-t*a.y)+d*(a.y*r-i*a.z)+p*(a.z*t-r*a.x);for(let t=0;t<e.length-1;t++){var _=e[t],g=e[t+1];m+=g=f*(_.x*g.y-g.x*_.y)+d*(_.y*g.z-g.y*_.z)+p*(_.z*g.x-g.z*_.x)}return Math.abs(m/2)}get CameraHeight(){return this.viewer.camera.positionCartographic.height}init(e){window.Cesium=r,this.open=!0,this.container=e;const t=this.viewer=new r.Viewer(this.container,{fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!0,navigationHelpButton:!1,shouldAnimate:!1,useDefaultRenderLoop:!0,baseLayerPicker:!1,animation:!0});t.scene.screenSpaceCameraController.lookEventTypes={eventType:r.CameraEventType.MIDDLE_DRAG,modifier:r.KeyboardEventModifier.ALT},t.cesiumWidget.creditContainer.remove(),this.register()}createDivLabel(e){return new o(e)}flyTo(e,t){this.viewer.camera.flyTo({destination:r.Cartesian3.fromDegrees(e.x,e.y,e.z),orientation:t})}openViewer(){this.open=!0,this.container&&(this.container.style.display="block")}close(){this.open&&(this.container.style.display="none",this.open=!1)}moveBackward(e){this.viewer.camera.moveBackward(e)}getFlyMaterial(e=0){var t=new r.Material({fabric:{uniforms:{color:r.Color.DEEPSKYBLUE,speed:70},source:"\n                vec4 getColor(){\n                    return color;\n                }\n                float getSpeed(){\n                   return speed;\n                }"}});return new r.PolylineMaterialAppearance({material:t,translucent:!0,vertexShaderSource:"\n#define CLIP_POLYLINE \nvoid clipLineSegmentToNearPlane(\n    vec3 p0,\n    vec3 p1,\n    out vec4 positionWC,\n    out bool clipped,\n    out bool culledByNearPlane,\n    out vec4 clippedPositionEC)\n{\n    culledByNearPlane = false;\n    clipped = false;\n    vec3 p0ToP1 = p1 - p0;\n    float magnitude = length(p0ToP1);\n    vec3 direction = normalize(p0ToP1);\n    float endPoint0Distance =  czm_currentFrustum.x + p0.z;\n    float denominator = -direction.z;\n    if (endPoint0Distance > 0.0 && abs(denominator) < czm_epsilon7)\n    {\n        culledByNearPlane = true;\n    }\n    else if (endPoint0Distance > 0.0)\n    {\n        float t = endPoint0Distance / denominator;\n        if (t < 0.0 || t > magnitude)\n        {\n            culledByNearPlane = true;\n        }\n        else\n        {\n            p0 = p0 + t * direction;\n            p0.z = min(p0.z, -czm_currentFrustum.x);\n            clipped = true;\n        }\n    }\n    clippedPositionEC = vec4(p0, 1.0);\n    positionWC = czm_eyeToWindowCoordinates(clippedPositionEC);\n}\nvec4 getPolylineWindowCoordinatesEC(vec4 positionEC, vec4 prevEC, vec4 nextEC, float expandDirection, float width, bool usePrevious, out float angle)\n{\n    #ifdef POLYLINE_DASH\n    vec4 positionWindow = czm_eyeToWindowCoordinates(positionEC);\n    vec4 previousWindow = czm_eyeToWindowCoordinates(prevEC);\n    vec4 nextWindow = czm_eyeToWindowCoordinates(nextEC);\n    vec2 lineDir;\n    if (usePrevious) {\n        lineDir = normalize(positionWindow.xy - previousWindow.xy);\n    }\n    else {\n        lineDir = normalize(nextWindow.xy - positionWindow.xy);\n    }\n    angle = atan(lineDir.x, lineDir.y) - 1.570796327;\n    angle = floor(angle / czm_piOverFour + 0.5) * czm_piOverFour;\n    #endif\n    vec4 clippedPrevWC, clippedPrevEC;\n    bool prevSegmentClipped, prevSegmentCulled;\n    clipLineSegmentToNearPlane(prevEC.xyz, positionEC.xyz, clippedPrevWC, prevSegmentClipped, prevSegmentCulled, clippedPrevEC);\n    vec4 clippedNextWC, clippedNextEC;\n    bool nextSegmentClipped, nextSegmentCulled;\n    clipLineSegmentToNearPlane(nextEC.xyz, positionEC.xyz, clippedNextWC, nextSegmentClipped, nextSegmentCulled, clippedNextEC);\n    bool segmentClipped, segmentCulled;\n    vec4 clippedPositionWC, clippedPositionEC;\n    clipLineSegmentToNearPlane(positionEC.xyz, usePrevious ? prevEC.xyz : nextEC.xyz, clippedPositionWC, segmentClipped, segmentCulled, clippedPositionEC);\n    if (segmentCulled)\n    {\n        return vec4(0.0, 0.0, 0.0, 1.0);\n    }\n    vec2 directionToPrevWC = normalize(clippedPrevWC.xy - clippedPositionWC.xy);\n    vec2 directionToNextWC = normalize(clippedNextWC.xy - clippedPositionWC.xy);\n    if (prevSegmentCulled)\n    {\n        directionToPrevWC = -directionToNextWC;\n    }\n    else if (nextSegmentCulled)\n    {\n        directionToNextWC = -directionToPrevWC;\n    }\n    vec2 thisSegmentForwardWC, otherSegmentForwardWC;\n    if (usePrevious)\n    {\n        thisSegmentForwardWC = -directionToPrevWC;\n        otherSegmentForwardWC = directionToNextWC;\n    }\n    else\n    {\n        thisSegmentForwardWC = directionToNextWC;\n        otherSegmentForwardWC =  -directionToPrevWC;\n    }\n    vec2 thisSegmentLeftWC = vec2(-thisSegmentForwardWC.y, thisSegmentForwardWC.x);\n    vec2 leftWC = thisSegmentLeftWC;\n    float expandWidth = width * 0.5;\n    if (!czm_equalsEpsilon(prevEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1) && !czm_equalsEpsilon(nextEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1))\n    {\n        vec2 otherSegmentLeftWC = vec2(-otherSegmentForwardWC.y, otherSegmentForwardWC.x);\n        vec2 leftSumWC = thisSegmentLeftWC + otherSegmentLeftWC;\n        float leftSumLength = length(leftSumWC);\n        leftWC = leftSumLength < czm_epsilon6 ? thisSegmentLeftWC : (leftSumWC / leftSumLength);\n        vec2 u = -thisSegmentForwardWC;\n        vec2 v = leftWC;\n        float sinAngle = abs(u.x * v.y - u.y * v.x);\n        expandWidth = clamp(expandWidth / sinAngle, 0.0, width * 2.0);\n    }\n    vec2 offset = leftWC * expandDirection * expandWidth * czm_pixelRatio;\n    return vec4(clippedPositionWC.xy + offset, -clippedPositionWC.z, 1.0) * (czm_projection * clippedPositionEC).w;\n}\nvec4 getPolylineWindowCoordinates(vec4 position, vec4 previous, vec4 next, float expandDirection, float width, bool usePrevious, out float angle)\n{\n    vec4 positionEC = czm_modelViewRelativeToEye * position;\n    vec4 prevEC = czm_modelViewRelativeToEye * previous;\n    vec4 nextEC = czm_modelViewRelativeToEye * next;\n    return getPolylineWindowCoordinatesEC(positionEC, prevEC, nextEC, expandDirection, width, usePrevious, angle);\n}\n\nattribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec2 expandAndWidth;\nattribute vec2 st;\n\nattribute float batchId;\n\nvarying float v_width;\nvarying vec2 v_st;\nvarying float v_polylineAngle;\n\nvarying vec4 v_positionEC;\nvarying vec3 v_normalEC;\n\n\n\nvoid main()\n{\nfloat expandDir = expandAndWidth.x;\nfloat width = abs(expandAndWidth.y) + 0.5;\nbool usePrev = expandAndWidth.y < 0.0;\n\nvec4 p = czm_computePosition();\nvec4 prev = czm_computePrevPosition();\nvec4 next = czm_computeNextPosition();\n\nfloat angle;\nvec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, angle);\ngl_Position = czm_viewportOrthographic * positionWC;\n\nv_width = width;\nv_st.s = st.s;\nv_st.t = st.t;\n// v_st.t = czm_writeNonPerspective(st.t, gl_Position.w);\nv_polylineAngle = angle;\n\n\n\nvec4 eyePosition = czm_modelViewRelativeToEye * p;\nv_positionEC =  czm_inverseModelView * eyePosition;      // position in eye coordinates\n//v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n}\n\n",fragmentShaderSource:1===(t=e)?"         \nvarying vec2 v_st;    \nvarying float v_width;    \nvarying float v_polylineAngle;\nvarying vec4 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\nvoid main()\n{\n    vec2 st = v_st;\n\n    float num = 4.0;\n    float speed=getSpeed();\n    vec4 color=getColor();\n    float xx = fract(st.s - czm_frameNumber/speed);\n    float r = color.r;\n    float g =color.g*xx;\n    float b = color.b*xx;\n    float a = xx*color.a;\n    if(fract(st.s*num/4.0 - czm_frameNumber/240.0)<0.75){\n        a=0.0;\n    }\n\n    gl_FragColor = vec4(r,g,b,a);\n}\n\n":2===t?"         \nvarying vec2 v_st;    \nvarying float v_width;    \nvarying float v_polylineAngle;\nvarying vec4 v_positionEC;\nvarying vec3 v_normalEC;\nvoid main()\n{\n    vec2 st = v_st;\n\n    // \u4e03\u5f69\u6e10\u53d8\u98de\u7ebf,\u5bbd\u5ea62\n    float xx = fract(st.s*2.0 - czm_frameNumber/60.0);\n    float r = xx;\n    float g = sin(czm_frameNumber/30.0);\n    float b = cos(czm_frameNumber/30.0);\n    float a = xx;\n\n    gl_FragColor = vec4(r,g,b,a);\n}":3===t?"\nvarying vec2 v_st;    \nvarying float v_width;    \nvarying float v_polylineAngle;\nvarying vec4 v_positionEC;\nvarying vec3 v_normalEC;\nvoid main()\n{\n    vec2 st = v_st;\n    \n    //\u5361\u5df4\u65af\u57fa\n    float xx = sin(st.s*6.0 -czm_frameNumber/5.0) - cos(st.t*6.0);\n    float r = 0.0;\n    float g = xx;\n    float b = xx;\n    float a = xx;\n\n    gl_FragColor = vec4(r,g,b,a);\n}\n":4===t?"\nvarying vec2 v_st;    \nvarying float v_width;    \nvarying float v_polylineAngle;d\nvarying vec4 v_positionEC;\nvarying vec3 v_normalEC;\nvoid main()\n{\n    vec2 st = v_st;\n    // \u7bad\u5934\u98de\u7ebf\uff0c\u5bbd\u5ea6 8\n    float xx = fract(st.s*10.0 + st.t  - czm_frameNumber/60.0);\n    if (st.t<0.5) {\n        xx = fract(st.s*10.0 - st.t - czm_frameNumber/60.0);\n    }\n\n    vec4 color=getColor();\n    float r = color.r;\n    float g =color.g*xx;\n    float b = color.b*xx;\n    float a = xx*color.a;\n\n    // \u98de\u7ebf\u8fb9\u6846\n    if (st.t>0.8||st.t<0.2) {\n        g = 1.0;\n        b = 1.0;\n        a = 0.4;\n    }\n\n    gl_FragColor = vec4(r,g,b,a);\n}\n":"         \n varying vec2 v_st;    \n varying float v_width;    \n varying float v_polylineAngle;\n varying vec4 v_positionEC;\n varying vec3 v_normalEC;\n\n void main()\n {\n     vec2 st = v_st;\n     float speed=getSpeed();\n     vec4 color=getColor();\n     float xx = fract(st.s - czm_frameNumber/speed);\n     float r = color.r;\n     float g =color.g*xx;\n     float b = color.b*xx;\n     float a = xx*color.a;\n\n     gl_FragColor = vec4(r,g,b,a);\n }\n\n"})}createPolyline(e,t,i){return e=new r.PolylineGeometry({positions:e,width:i}),i=Date.now(),e=new r.GeometryInstance({geometry:e,id:+i}),this.viewer.scene.primitives.add(new r.Primitive({geometryInstances:[e],appearance:t,releaseGeometryInstances:!1,compressVertices:!1}))}loadClounds(){var e=new r.Material({fabric:{type:"CloudMaterial",uniforms:{image:"https://am-img.gkiiot.com/editor/textures/map.png",speed:5e3,repeat:new r.Cartesian2(1,1),color:new r.Color(1,1,1,.5)},source:"\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n     czm_material material = czm_getDefaultMaterial(materialInput);\n     float t=czm_frameNumber/speed;\n     vec2 st = materialInput.st;\n     vec4 colorImage = texture2D(image,vec2(fract(st.s + t),fract(st.t)));\n     material.alpha = colorImage.a * color.a  ;\n     material.diffuse =    color.rgb  ;\n     return material;\n }"}});return e=this.viewer.scene.primitives.add(new r.Primitive({geometryInstances:new r.GeometryInstance({geometry:new r.RectangleGeometry({rectangle:r.Rectangle.fromDegrees(-180,-90,180,90),vertexFormat:r.EllipsoidSurfaceAppearance.VERTEX_FORMAT})}),appearance:new r.EllipsoidSurfaceAppearance({material:e,translucent:!0})}))}pa(){}render(){this.viewer&&this.open&&this.viewer.render()}destory(){this.viewer&&this.viewer.destroy()}wheelEvent(e,t){}readFile(e){e.read()}writeFile(e){e.write(1)}leftClickEvent(e,t){}register(){const e=new r.ScreenSpaceEventHandler(this.viewer.scene.canvas);e.setInputAction((e=>{r.Color.fromCssColorString;var t=this.viewer.camera.positionCartographic.height;this.wheelEvent(t,e)}),r.ScreenSpaceEventType.WHEEL),e.setInputAction((e=>{var t=this.viewer.scene.pick(e.position);this.leftClickEvent(t,e)}),r.ScreenSpaceEventType.LEFT_CLICK)}test(){const e=new r.Material({fabric:{type:"ColorMaterial",uniforms:{speed:5e3,repeat:new r.Cartesian2(1,1),color:new r.Color(0,1,0,.4),image:"https://am-img.gkiiot.com/editor/textures/colors1.png",time:1},source:"\n        czm_material czm_getMaterial(czm_materialInput materialInput)\n        {\n          czm_material material = czm_getDefaultMaterial(materialInput);\n          vec2 st = materialInput.st;\n          vec4 colorImage = texture2D(image, vec2(fract((st.s - czm_frameNumber/60.0)), fract((st.t - czm_frameNumber/60.0))));\n          vec4 fragColor;\n          fragColor.rgb = (colorImage.rgb+color.rgb) / 1.0;\n          fragColor = czm_gammaCorrect(fragColor);\n          material.alpha = colorImage.a * color.a;\n          material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n          material.emission = fragColor.rgb;\n          return material;\n          }"}});let t=new window.AMap.DistrictSearch({subdistrict:0,extensions:"all",level:"province"}),i=["\u4e2d\u56fd"];for(let n=0;n<i.length;n++)t.search(i[n],((t,i)=>{var n=i.districtList[0].boundaries.length;for(let t=0;t<n;t++){let n=[];i.districtList[0].boundaries[t].forEach((e=>{n.push(r.Cartesian3.fromDegrees(e.lng,e.lat,1e4))}));var s=new r.PolygonGeometry({polygonHierarchy:new r.PolygonHierarchy(n)});s=(r.PolygonGeometry.createGeometry(s),new r.GeometryInstance({geometry:s}));this.viewer.scene.primitives.add(new r.Primitive({geometryInstances:s,appearance:new r.EllipsoidSurfaceAppearance({material:e})}))}}))}}var h=function(e,t){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)};function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var u,d,p,f,m,_,g=function(){return(g=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function y(e,t,i,r){var n,s=arguments.length,a=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var o=e.length-1;0<=o;o--)(n=e[o])&&(a=(s<3?n(a):3<s?n(t,i,a):n(t,i))||a);return 3<s&&a&&Object.defineProperty(t,i,a),a}function v(e,t,i,r){return new(i=i||Promise)((function(n,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))}function b(e,t){var i,r,n,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},a={next:o(0),throw:o(1),return:o(2)};return"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){var l=[a,o];if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&l[0]?r.return:l[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,l[1])).done)return n;switch(r=0,(l=n?[2&l[0],n.value]:l)[0]){case 0:case 1:n=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,r=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!(n=0<(n=s.trys).length&&n[n.length-1])&&(6===l[0]||2===l[0])){s=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3])){s.label=l[1];break}if(6===l[0]&&s.label<n[1]){s.label=n[1],n=l;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(l);break}n[2]&&s.ops.pop(),s.trys.pop();continue}l=t.call(e,s)}catch(o){l=[6,o],r=0}finally{i=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}class E extends n.BoundingBox{static GetCenterFromPoints(e){if(e.length<=1)return e[0];var t=x(e[0],e[1]),i=C(e[0],e[1]);const r=new E(t,i);return 2<e.length&&r.setFromPoints(e.slice(2)),r.center}constructor(e=n.Vector3.Zero(),t=n.Vector3.Zero(),i){super(e,t,i)}union(e){const t=this.minimumWorld.clone();var i=e.minimumWorld.clone();t.set(Math.min(t.x,i.x),Math.min(t.y,i.y),Math.min(t.z,i.z));const r=this.maximumWorld.clone();return i=e.maximumWorld.clone(),r.set(Math.max(r.x,i.x),Math.max(r.y,i.y),Math.max(r.z,i.z)),this.reConstruct(t,r),this}get Size(){var e=this.extendSize;return{x:2*e.x,y:2*e.y,z:2*e.z}}expandByPoint(e){return this.min(this.minimum,e),this.max(this.maximum,e),this}setFromPoints(e){for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this.reConstruct(this.minimum,this.maximum,this.getWorldMatrix()),this}min(e,t){return e.x=Math.min(e.x,t.x),e.y=Math.min(e.y,t.y),e.z=Math.min(e.z,t.z),this}max(e,t){return e.x=Math.max(e.x,t.x),e.y=Math.max(e.y,t.y),e.z=Math.max(e.z,t.z),this}}function x(e,t){const i=new n.Vector3;return i.x=Math.min(e.x,t.x),i.y=Math.min(e.y,t.y),i.z=Math.min(e.z,t.z),i}function C(e,t){const i=new n.Vector3;return i.x=Math.max(e.x,t.x),i.y=Math.max(e.y,t.y),i.z=Math.max(e.z,t.z),i}class w{constructor(){this.objectNameMap=new Map}static RegisterObject(e){var t=e.type||e.name;this.factory.objectNameMap.has(t)||this.factory.objectNameMap.set(t,e)}static RegisterObjectAlias(e,t){this.factory.objectNameMap.set(t,e)}static CreateObject(e,t){let i=this.factory.objectNameMap.get(e);if(i)return new i(t)}static RegisterComponent(e){this.factory.objectNameMap.set(e.type,e)}static RemoveComponent(e){this.factory.objectNameMap.delete(e)}static isRegister(e){return this.factory.objectNameMap.has(e)}}function S(e){w.RegisterObject(e)}function T(e){w.RegisterComponent(e)}function P(e){w.RemoveComponent(e)}w.factory=new w;class A{constructor(e=!0){this.isErase=e}readFile(e){return this.isErase=e.read(),this}writeFile(e){return e.write(this.isErase),this}}function R(e){return e[e.length-1]}function M(e,t){let i=0;for(let r=0,n=e.length;r<n;r++)e[r]!==t&&(e[i++]=e[r]);return e.length=i,e}function O(e,t){let i=0;for(let r=0,n=e.length;r<n;r++)t(e[r])||(e[i++]=e[r]);return e.length=i,e}(_=u=u||{})[_.Wireframe=1]="Wireframe",_[_.Conceptual=2]="Conceptual",_[_.Physical=3]="Physical";class I{constructor(){this._listeners=new Map}on(e,t,i){let r=this._listeners.get(e);return r||(r=[],this._listeners.set(e,r)),-1===r.indexOf(t)&&(i&&(t.__customOption__=i),r.push(t)),()=>this.off(e,t)}once(e,t,i){return t.__isOnce__=!0,this.on(e,t,i)}hasEventListener(e,t){let i=this._listeners.get(e);return!!i&&-1!==i.indexOf(t)}off(e,t){let i=this._listeners.get(e);i&&-1!==(e=i.indexOf(t))&&i.splice(e,1)}trigger(e){var t;let i=this._listeners.get(e.type);if(i){e.target||(e.target=this);const n=i.slice(0);for(let i=0,s=n.length;i<s;i++){var r=n[i].__customOption__;r&&(r.userData&&(e.data=r.userData),null==(t=r.condition)||!t.call(r,e))||n[i].call(this,e)}O(i,(e=>e.__isOnce__))}}}class D{constructor(e=-1,t){this.index=e,this.object=t}get isErase(){return!this.object||this.object.IsErase}set Object(e){this.object=e}get Object(){return this.object}get Index(){return this.index}}class F{constructor(e=[]){this._datas=e,this.readIndex=0}get Data(){return this._datas}set Data(e){this._datas=e,this.reset()}clear(){return this._datas.length=0,this.reset()}reset(){return this.readIndex=0,this}write(e){return e instanceof D?this._datas.push(e.Index):this._datas.push(e),this}read(){return this._datas[this.readIndex++]}writeObjectId(e){return e?this.write(e.Index):this.write(0),this}readObjectId(){var e=this.read();if(this.database)return this.database.getObjectId(e)}writeObject(e){if(e)return this.writeString(e.constructor.type||e.constructor.name),e.writeFile(this),this;this.write("")}readObject(e){let t=this.readString();if(t)return void 0===e&&(!(e=w.CreateObject(t))&&t.startsWith("CustomComponent")&&(e=w.CreateObject("Component")),void 0!==this.database&&"_SetDefaultDb"in e&&e._SetDefaultDb(this.database)),e.readFile(this),e}writeString(e){return this._datas.push(e),this}readString(){return this._datas[this.readIndex++]}writeArray(e){this.write(e.length);for(const t of e)this.write(t)}readArray(e){var t=this._datas.slice(this.readIndex,this.readIndex+e);return this.readIndex+=e,t}writeAnyArray(e,t){this.write(e.length);for(const i of e)t.call(this,i)}readAnyArray(e){var t=this.read();for(let i=0;i<t;i++)e.call(this)}readAnyArrayAndPush(e,t){e.length=0;var i=this.read();for(let n=0;n<i;n++){var r=t.call(this);e.push(r)}}writeWidgetValue(e){this.write(null==e?void 0:e.type),"entity"===(null==e?void 0:e.type)?this.writeObjectId(null==e?void 0:e.value):this.write(null==e?void 0:e.value),this.write(null==e?void 0:e.entityKey)}readWidgetValue(e){e.type=this.read(),"entity"===e.type?e.value=this.readObjectId():e.value=this.read(),e.entityKey=this.read()}writeVector3(e){this.write(e.x),this.write(e.y),this.write(e.z)}readVector3(e){e.x=this.read(),e.y=this.read(),e.z=this.read()}}class L extends I{constructor(){super(...arguments),this._ver=1,this._erase=!1}set Owner(e){this._Owner=e}get Owner(){return this._Owner}get IsErase(){return this._erase}get ObjectId(){return this._id}set ObjectId(e){this._id=e}get Id(){var e;return null==(e=this._id)?void 0:e.Index}get DB(){return this._db}get Name(){return this._name}get Type(){return this.constructor.type}erase(e=!0){if(this._erase!==e){this._erase=e;const t=this.UndoRecord;t&&t.createEraseHistory(this,e)}}clone(){const e=new this.constructor;var t=new F;return this.writeFile(t),e.readFile(t),e._id=null,e}destory(){this._db=void 0}writeFile(e){e.write(this._ver),e.writeObjectId(this._id),e.write(this._erase),e.writeObjectId(this._Owner)}readFile(e){this._ver=e.read();var t=e.readObjectId();!this._id&&t&&(this._id=t,this._id.Object=this),this._erase=e.read(),this._Owner=e.readObjectId()}_SetOwnerDatabase(e){return this._db||(this._db=e,this._id=e.allocateId(),this._id.Object=this),this}_SetDefaultDb(e){return this._db||(this._db=e),this}_SetDatabase(e){this._db=e}_applyHistoryRecord(e){e instanceof A&&(this._erase=e.isErase)}get UndoRecord(){if(this._db)return this._db.HistoryManager.LastCmdRecord}writeSnapshoot(){const e=this.UndoRecord;e&&e.writeObjectSnapshoot(this)}}class k{constructor(e){this.filer=new F,e&&(this.filer.database=e.DB,e.writeFile(this.filer))}get Filer(){const e=new F(this.filer.Data);return e.database=this.filer.database,e}readFile(e){e.read(),this.filer.Data=e.read(),this.filer.reset()}writeFile(e){e.write(1),e.write(this.filer.Data)}}function B(e){for(var t,i;e&&(null==(t=e.metadata)||!t.Entity);)e=e.parent;return null==(i=null==e?void 0:e.metadata)?void 0:i.Entity}function N(e){for(;e.parent;)e=e.parent;return e}function z(e,t,i=1e-5){return Math.abs(e-t)<=i}function U(e){return new Promise((t=>setTimeout(t,e)))}function G(e){var t=e.split(",")[0].split(":")[1].split(";")[0];const i=atob(e.split(",")[1]);e=new ArrayBuffer(i.length);const r=new Uint8Array(e);for(let e=0;e<i.length;e++)r[e]=i.charCodeAt(e);return new Blob([r],{type:t})}function j(e,t){for(const i in e){if(!t.hasOwnProperty(i))return!1;if(e[i]!==t[i])return!1}return!0}function V(e,t,i){if(void 0===i)return e;var r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),n=-1!==e.indexOf("?")?"&":"?";return e.match(r)?e.replace(r,"$1"+t+"="+i+"$2"):e+n+t+"="+i}function Z(e){return n.Tools.ToRadians(e)}!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(d=d||{}),function(e){e[e.Digit1=49]="Digit1",e[e.Digit2=50]="Digit2",e[e.Digit3=51]="Digit3",e[e.Digit4=52]="Digit4",e[e.Digit5=53]="Digit5",e[e.Digit6=54]="Digit6",e[e.Digit7=55]="Digit7",e[e.Digit8=56]="Digit8",e[e.Digit9=57]="Digit9",e[e.Digit0=58]="Digit0",e[e.KeyA=65]="KeyA",e[e.KeyB=66]="KeyB",e[e.KeyC=67]="KeyC",e[e.KeyD=68]="KeyD",e[e.KeyE=69]="KeyE",e[e.KeyF=70]="KeyF",e[e.KeyG=71]="KeyG",e[e.KeyH=72]="KeyH",e[e.KeyI=73]="KeyI",e[e.KeyJ=74]="KeyJ",e[e.KeyK=75]="KeyK",e[e.KeyL=76]="KeyL",e[e.KeyM=77]="KeyM",e[e.KeyN=78]="KeyN",e[e.KeyO=79]="KeyO",e[e.KeyP=80]="KeyP",e[e.KeyQ=81]="KeyQ",e[e.KeyR=82]="KeyR",e[e.KeyS=83]="KeyS",e[e.KeyT=84]="KeyT",e[e.KeyU=85]="KeyU",e[e.KeyV=86]="KeyV",e[e.KeyW=87]="KeyW",e[e.KeyX=88]="KeyX",e[e.KeyY=89]="KeyY",e[e.KeyZ=90]="KeyZ",e[e.Comma=188]="Comma",e[e.CommaChrome=229]="CommaChrome",e[e.Period=190]="Period",e[e.Semicolon=186]="Semicolon",e[e.Quote=222]="Quote",e[e.BracketLeft=219]="BracketLeft",e[e.BracketRight=220]="BracketRight",e[e.Backquote=192]="Backquote",e[e.Backslash=220]="Backslash",e[e.Minus=189]="Minus",e[e.Equal=187]="Equal",e[e.IntlRo=193]="IntlRo",e[e.IntlYen=255]="IntlYen",e[e.Alt=18]="Alt",e[e.CapsLock=20]="CapsLock",e[e.Control=17]="Control",e[e.OSLeft=91]="OSLeft",e[e.OSRight=92]="OSRight",e[e.Shift=16]="Shift",e[e.ContextMenu=93]="ContextMenu",e[e.Enter=13]="Enter",e[e.Space=32]="Space",e[e.Backspace=8]="Backspace",e[e.Tab=9]="Tab",e[e.Delete=46]="Delete",e[e.End=35]="End",e[e.Home=36]="Home",e[e.Insert=45]="Insert",e[e.PageDown=34]="PageDown",e[e.PageUp=33]="PageUp",e[e.ArrowDown=40]="ArrowDown",e[e.ArrowLeft=37]="ArrowLeft",e[e.ArrowRight=39]="ArrowRight",e[e.ArrowUp=38]="ArrowUp",e[e.Escape=27]="Escape",e[e.PrintScreen=44]="PrintScreen",e[e.ScrollLock=145]="ScrollLock",e[e.Pause=19]="Pause",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NumLock=114]="NumLock",e[e.Numpad0=96]="Numpad0",e[e.Numpad1=97]="Numpad1",e[e.Numpad2=98]="Numpad2",e[e.Numpad3=99]="Numpad3",e[e.Numpad4=100]="Numpad4",e[e.Numpad5=101]="Numpad5",e[e.Numpad6=102]="Numpad6",e[e.Numpad7=103]="Numpad7",e[e.Numpad8=104]="Numpad8",e[e.Numpad9=105]="Numpad9",e[e.NumpadAdd=107]="NumpadAdd",e[e.NumpadDivide=111]="NumpadDivide",e[e.NumpadEqual=12]="NumpadEqual",e[e.NumpadMultiply=106]="NumpadMultiply",e[e.NumpadSubtract=109]="NumpadSubtract",e[e.NumpadDot=110]="NumpadDot",e[e.NumpadDot1=190]="NumpadDot1"}(p=p||{}),function(e){e.Digit1="Digit1",e.Digit2="Digit2",e.Digit3="Digit3",e.Digit4="Digit4",e.Digit5="Digit5",e.Digit6="Digit6",e.Digit7="Digit7",e.Digit8="Digit8",e.Digit9="Digit9",e.Digit0="Digit0",e.KeyA="KeyA",e.KeyB="KeyB",e.KeyC="KeyC",e.KeyD="KeyD",e.KeyE="KeyE",e.KeyF="KeyF",e.KeyG="KeyG",e.KeyH="KeyH",e.KeyI="KeyI",e.KeyJ="KeyJ",e.KeyK="KeyK",e.KeyL="KeyL",e.KeyM="KeyM",e.KeyN="KeyN",e.KeyO="KeyO",e.KeyP="KeyP",e.KeyQ="KeyQ",e.KeyR="KeyR",e.KeyS="KeyS",e.KeyT="KeyT",e.KeyU="KeyU",e.KeyV="KeyV",e.KeyW="KeyW",e.KeyX="KeyX",e.KeyY="KeyY",e.KeyZ="KeyZ",e.Comma="Comma",e.CommaChrome="CommaChrome",e.Period="Period",e.Semicolon="Semicolon",e.Quote="Quote",e.BracketLeft="BracketLeft",e.BracketRight="BracketRight",e.Backquote="Backquote",e.Backslash="Backslash",e.Minus="Minus",e.Equal="Equal",e.IntlRo="IntlRo",e.IntlYen="IntlYen",e.Alt="Alt",e.AltLeft="AltLeft",e.CapsLock="CapsLock",e.Control="Control",e.ControlLeft="ControlLeft",e.OSLeft="OSLeft",e.OSRight="OSRight",e.Shift="Shift",e.ShiftLeft="ShiftLeft",e.ShiftRight="ShiftRight",e.ContextMenu="ContextMenu",e.Enter="Enter",e.Space="Space",e.Backspace="Backspace",e.Tab="Tab",e.Delete="Delete",e.End="End",e.Home="Home",e.Insert="Insert",e.PageDown="PageDown",e.PageUp="PageUp",e.ArrowDown="ArrowDown",e.ArrowLeft="ArrowLeft",e.ArrowRight="ArrowRight",e.ArrowUp="ArrowUp",e.Escape="Escape",e.PrintScreen="PrintScreen",e.ScrollLock="ScrollLock",e.Pause="Pause",e.F1="F1",e.F2="F2",e.F3="F3",e.F5="F5",e.F6="F6",e.F7="F7",e.F8="F8",e.F9="F9",e.F10="F10",e.F11="F11",e.F12="F12",e.NumLock="NumLock",e.Numpad0="Numpad0",e.Numpad1="Numpad1",e.Numpad2="Numpad2",e.Numpad3="Numpad3",e.Numpad4="Numpad4",e.Numpad5="Numpad5",e.Numpad6="Numpad6",e.Numpad7="Numpad7",e.Numpad8="Numpad8",e.Numpad9="Numpad9",e.NumpadAdd="NumpadAdd",e.NumpadDivide="NumpadDivide",e.NumpadEqual="NumpadEqual",e.NumpadMultiply="NumpadMultiply",e.NumpadSubtract="NumpadSubtract",e.NumpadDot="NumpadDot",e.NumpadDot1="NumpadDot1"}(f=f||{}),function(e){let t;e.writeFile=function(e,t){t=new Blob([t],{type:"octet/stream"});let i=document.createElement("a");i.download=e,i.href=window.URL.createObjectURL(t),i.style.display="none",i.onclick=function(){document.body.removeChild(i)},document.body.appendChild(i),i.click()},e.chooseFile=function({filter:e,multiple:i=!1,callback:r}){t&&t.remove(),(t=document.createElement("input")).type="file",t.style.display="none",document.body.appendChild(t),t.accept=e,t.onchange=()=>{0<t.files.length&&r(t.files)},t.multiple=i,t.click()}}(m=m||{});const W=[[0,0,0,0],[255,0,0,255],[255,255,0,255],[0,255,0,255],[0,255,255,255],[0,0,255,255],[255,0,255,255],[255,255,255,255],[128,128,128,255],[192,192,192,255],[255,0,0,255],[255,127,127,255],[165,0,0,255],[165,82,82,255],[127,0,0,255],[127,63,63,255],[76,0,0,255],[76,38,38,255],[38,0,0,255],[38,19,19,255],[255,63,0,255],[255,159,127,255],[165,41,0,255],[165,103,82,255],[127,31,0,255],[127,79,63,255],[76,19,0,255],[76,47,38,255],[38,9,0,255],[38,23,19,255],[255,127,0,255],[255,191,127,255],[165,82,0,255],[165,124,82,255],[127,63,0,255],[127,95,63,255],[76,38,0,255],[76,57,38,255],[38,19,0,255],[38,28,19,255],[255,191,0,255],[255,223,127,255],[165,124,0,255],[165,145,82,255],[127,95,0,255],[127,111,63,255],[76,57,0,255],[76,66,38,255],[38,28,0,255],[38,33,19,255],[255,255,0,255],[255,255,127,255],[165,165,0,255],[165,165,82,255],[127,127,0,255],[127,127,63,255],[76,76,0,255],[76,76,38,255],[38,38,0,255],[38,38,19,255],[191,255,0,255],[223,255,127,255],[124,165,0,255],[145,165,82,255],[95,127,0,255],[111,127,63,255],[57,76,0,255],[66,76,38,255],[28,38,0,255],[33,38,19,255],[127,255,0,255],[191,255,127,255],[82,165,0,255],[124,165,82,255],[63,127,0,255],[95,127,63,255],[38,76,0,255],[57,76,38,255],[19,38,0,255],[28,38,19,255],[63,255,0,255],[159,255,127,255],[41,165,0,255],[103,165,82,255],[31,127,0,255],[79,127,63,255],[19,76,0,255],[47,76,38,255],[9,38,0,255],[23,38,19,255],[0,255,0,255],[127,255,127,255],[0,165,0,255],[82,165,82,255],[0,127,0,255],[63,127,63,255],[0,76,0,255],[38,76,38,255],[0,38,0,255],[19,38,19,255],[0,255,63,255],[127,255,159,255],[0,165,41,255],[82,165,103,255],[0,127,31,255],[63,127,79,255],[0,76,19,255],[38,76,47,255],[0,38,9,255],[19,38,23,255],[0,255,127,255],[127,255,191,255],[0,165,82,255],[82,165,124,255],[0,127,63,255],[63,127,95,255],[0,76,38,255],[38,76,57,255],[0,38,19,255],[19,38,28,255],[0,255,191,255],[127,255,223,255],[0,165,124,255],[82,165,145,255],[0,127,95,255],[63,127,111,255],[0,76,57,255],[38,76,66,255],[0,38,28,255],[19,38,33,255],[0,255,255,255],[127,255,255,255],[0,165,165,255],[82,165,165,255],[0,127,127,255],[63,127,127,255],[0,76,76,255],[38,76,76,255],[0,38,38,255],[19,38,38,255],[0,191,255,255],[127,223,255,255],[0,124,165,255],[82,145,165,255],[0,95,127,255],[63,111,127,255],[0,57,76,255],[38,66,76,255],[0,28,38,255],[19,33,38,255],[0,127,255,255],[127,191,255,255],[0,82,165,255],[82,124,165,255],[0,63,127,255],[63,95,127,255],[0,38,76,255],[38,57,76,255],[0,19,38,255],[19,28,38,255],[0,63,255,255],[127,159,255,255],[0,41,165,255],[82,103,165,255],[0,31,127,255],[63,79,127,255],[0,19,76,255],[38,47,76,255],[0,9,38,255],[19,23,38,255],[0,0,255,255],[127,127,255,255],[0,0,165,255],[82,82,165,255],[0,0,127,255],[63,63,127,255],[0,0,76,255],[38,38,76,255],[0,0,38,255],[19,19,38,255],[63,0,255,255],[159,127,255,255],[41,0,165,255],[103,82,165,255],[31,0,127,255],[79,63,127,255],[19,0,76,255],[47,38,76,255],[9,0,38,255],[23,19,38,255],[127,0,255,255],[191,127,255,255],[82,0,165,255],[124,82,165,255],[63,0,127,255],[95,63,127,255],[38,0,76,255],[57,38,76,255],[19,0,38,255],[28,19,38,255],[191,0,255,255],[223,127,255,255],[124,0,165,255],[145,82,165,255],[95,0,127,255],[111,63,127,255],[57,0,76,255],[66,38,76,255],[28,0,38,255],[33,19,38,255],[255,0,255,255],[255,127,255,255],[165,0,165,255],[165,82,165,255],[127,0,127,255],[127,63,127,255],[76,0,76,255],[76,38,76,255],[38,0,38,255],[38,19,38,255],[255,0,191,255],[255,127,223,255],[165,0,124,255],[165,82,145,255],[127,0,95,255],[127,63,111,255],[76,0,57,255],[76,38,66,255],[38,0,28,255],[38,19,33,255],[255,0,127,255],[255,127,191,255],[165,0,82,255],[165,82,124,255],[127,0,63,255],[127,63,95,255],[76,0,38,255],[76,38,57,255],[38,0,19,255],[38,19,28,255],[255,0,63,255],[255,127,159,255],[165,0,41,255],[165,82,103,255],[127,0,31,255],[127,63,79,255],[76,0,19,255],[76,38,47,255],[38,0,9,255],[38,19,23,255],[84,84,84,255],[118,118,118,255],[152,152,152,255],[186,186,186,255],[220,220,220,255],[255,255,255,255],[0,0,0,0]];function H(e){return"string"==typeof e?n.Color3.FromHexString(e):n.Color3.FromHexString(e.toString())}n.Effect.ShadersStore.myshaderVertexShader="\n         attribute vec3 position;                \n         uniform mat4 world;                    \n         uniform mat4 view;                    \n         uniform mat4 viewProjection;          \n         varying float fFogDistance;\n         void main(void) {\n                 vec4 worldPosition = world * vec4(position, 1.0);\n                 fFogDistance = (view * worldPosition).z;\n                 gl_Position =  viewProjection * worldPosition;\n         }",n.Effect.ShadersStore.myshaderFragmentShader='\n      #ifdef GL_ES\n  precision mediump float;\n  #endif\n  \n  uniform float time;\n  uniform vec2 mouse;\n  uniform vec2 resolution;\n  \n  // "Seascape" by Alexander Alekseev aka TDM - 2014\n  // License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\n  \n  const int NUM_STEPS = 12;\n  const float PI\t \t= 3.1415;\n  const float EPSILON\t= 1e-3;\n  float EPSILON_NRM\t= 0.;\n  \n  // sea\n  const int ITER_GEOMETRY = 3;\n  const int ITER_FRAGMENT = 5;\n  const float SEA_HEIGHT = 0.6;\n  const float SEA_CHOPPY = 4.0;\n  const float SEA_SPEED = 0.8;\n  const float SEA_FREQ = 0.16;\n  const vec3 SEA_BASE = vec3(0.1,0.19,0.22);\n  const vec3 SEA_WATER_COLOR = vec3(0.8,0.9,0.6);\n  float SEA_TIME = 0.;\n  mat2 octave_m = mat2(1.6,1.2,-1.2,1.6);\n  \n  // math\n  mat3 fromEuler(vec3 ang) {\n      vec2 a1 = vec2(sin(ang.x),cos(ang.x));\n      vec2 a2 = vec2(sin(ang.y),cos(ang.y));\n      vec2 a3 = vec2(sin(ang.z),cos(ang.z));\n      mat3 m;\n      m[0] = vec3(a1.y*a3.y+a1.x*a2.x*a3.x,a1.y*a2.x*a3.x+a3.y*a1.x,-a2.y*a3.x);\n      m[1] = vec3(-a2.y*a1.x,a1.y*a2.y,a2.x);\n      m[2] = vec3(a3.y*a1.x*a2.x+a1.y*a3.x,a1.x*a3.x-a1.y*a3.y*a2.x,a2.y*a3.y);\n      return m;\n  }\n  float hash( vec2 p ) {\n      float h = dot(p,vec2(127.1,311.7));\t\n      return fract(sin(h)*43758.5453123);\n  }\n  float noise( in vec2 p ) {\n      vec2 i = floor( p );\n      vec2 f = fract( p );\t\n      vec2 u = f*f*(3.0-2.0*f);\n      return -1.0+2.0*mix( mix( hash( i + vec2(0.0,0.0) ), \n                       hash( i + vec2(1.0,0.0) ), u.x),\n                  mix( hash( i + vec2(0.0,1.0) ), \n                       hash( i + vec2(1.0,1.0) ), u.x), u.y);\n  }\n  \n  // lighting\n  float diffuse(vec3 n,vec3 l,float p) {\n      return pow(dot(n,l) * 0.4 + 0.6,p);\n  }\n  float specular(vec3 n,vec3 l,vec3 e,float s) {    \n      float nrm = (s + 8.0) / (3.1415 * 8.0);\n      return pow(max(dot(reflect(e,n),l),0.0),s) * nrm;\n  }\n  \n  // sky\n  vec3 getSkyColor(vec3 e) {\n      e.y = max(e.y,0.0);\n      vec3 ret;\n      ret.x = pow(1.0-e.y,2.0);\n      ret.y = 1.0-e.y;\n      ret.z = 0.6+(1.0-e.y)*0.4;\n      return ret;\n  }\n  \n  // sea\n  float sea_octave(vec2 uv, float choppy) {\n      uv += noise(uv);        \n      vec2 wv = 1.0-abs(sin(uv));\n      vec2 swv = abs(cos(uv));    \n      wv = mix(wv,swv,wv);\n      return pow(1.0-pow(wv.x * wv.y,0.65),choppy);\n  }\n  \n  float map(vec3 p) {\n      float freq = SEA_FREQ;\n      float amp = SEA_HEIGHT;\n      float choppy = SEA_CHOPPY;\n      vec2 uv = p.xz; uv.x *= 0.75;\n      \n      float d, h = 0.0;    \n      for(int i = 0; i < ITER_GEOMETRY; i++) {        \n          d = sea_octave((uv+SEA_TIME)*freq,choppy);\n          d += sea_octave((uv-SEA_TIME)*freq,choppy);\n          h += d * amp;        \n          uv *= octave_m; freq *= 1.9; amp *= 0.22;\n          choppy = mix(choppy,1.0,0.2);\n      }\n      return p.y - h;\n  }\n  \n  float map_detailed(vec3 p) {\n      float freq = SEA_FREQ;\n      float amp = SEA_HEIGHT;\n      float choppy = SEA_CHOPPY;\n      vec2 uv = p.xz; uv.x *= 0.75;\n      \n      float d, h = 0.0;    \n      for(int i = 0; i < ITER_FRAGMENT; i++) {        \n          d = sea_octave((uv+SEA_TIME)*freq,choppy);\n          d += sea_octave((uv-SEA_TIME)*freq,choppy);\n          h += d * amp;        \n          uv *= octave_m; freq *= 1.9; amp *= 0.22;\n          choppy = mix(choppy,1.0,0.2);\n      }\n      return p.y - h;\n  }\n  \n  vec3 getSeaColor(vec3 p, vec3 n, vec3 l, vec3 eye, vec3 dist) {  \n      float fresnel = 1.0 - max(dot(n,-eye),0.0);\n      fresnel = pow(fresnel,3.0) * 0.65;\n          \n      vec3 reflected = getSkyColor(reflect(eye,n));    \n      vec3 refracted = SEA_BASE + diffuse(n,l,80.0) * SEA_WATER_COLOR * 0.12; \n      \n      vec3 color = mix(refracted,reflected,fresnel);\n      \n      float atten = max(1.0 - dot(dist,dist) * 0.001, 0.0);\n      color += SEA_WATER_COLOR * (p.y - SEA_HEIGHT) * 0.18 * atten;\n      \n      color += vec3(specular(n,l,eye,60.0));\n      \n      return color;\n  }\n  \n  // tracing\n  vec3 getNormal(vec3 p, float eps) {\n      vec3 n;\n      n.y = map_detailed(p);    \n      n.x = map_detailed(vec3(p.x+eps,p.y,p.z)) - n.y;\n      n.z = map_detailed(vec3(p.x,p.y,p.z+eps)) - n.y;\n      n.y = eps;\n      return normalize(n);\n  }\n  \n  float heightMapTracing(vec3 ori, vec3 dir, out vec3 p) {  \n      float tm = 0.0;\n      float tx = 1000.0;    \n      float hx = map(ori + dir * tx);\n      if(hx > 0.0) return tx;   \n      float hm = map(ori + dir * tm);    \n      float tmid = 0.0;\n      for(int i = 0; i < NUM_STEPS; i++) {\n          tmid = mix(tm,tx, hm/(hm-hx));                   \n          p = ori + dir * tmid;                   \n          float hmid = map(p);\n          if(hmid < 0.0) {\n              tx = tmid;\n              hx = hmid;\n          } else {\n              tm = tmid;\n              hm = hmid;\n          }\n      }\n      return tmid;\n  }\n  \n  // main\n  void main() {\n      EPSILON_NRM = 0.1 / resolution.x;\n      SEA_TIME = time * SEA_SPEED;\n      \n      vec2 uv = gl_FragCoord.xy / resolution.xy;\n      uv = uv * 2.0 - 1.0;\n      uv.x *= resolution.x / resolution.y;  \n      float time2 = 0.0;\n      time2 = time * 0.1 + (mouse.x*10.0);\n          \n      // ray\n      vec3 ang = vec3(sin(time2*3.0)*0.1,sin(time2)*0.2+0.3,time2);    \n      vec3 ori = vec3(0.0,3.5,time*5.0);\n      vec3 dir = normalize(vec3(uv.xy,-2.0)); \n      dir.z += length(uv) * 0.15;\n      dir = normalize(dir) * fromEuler(ang);\n      \n      // tracing\n      vec3 p;\n      heightMapTracing(ori,dir,p);\n      vec3 dist = p - ori;\n      vec3 n = getNormal(p, dot(dist,dist) * EPSILON_NRM);\n      vec3 light = normalize(vec3(0.0,1.0,0.8)); \n               \n      // color\n      vec3 color = mix(\n          getSkyColor(dir),\n          getSeaColor(p,n,light,dir,dist),\n          pow(smoothstep(0.0,-0.05,dir.y),0.3));\n          \n      // post\n      gl_FragColor = vec4(pow(color,vec3(0.75)), 1.0);\n  }';var K,q,X,Y,Q,$,J,ee,te,ie=Object.freeze({__proto__:null,showWorldAxis:function(e,t){n.MeshBuilder.CreateLines("axisX",{points:[n.Vector3.Zero(),new n.Vector3(e,0,0),new n.Vector3(.95*e,.05*e,0),new n.Vector3(e,0,0),new n.Vector3(.95*e,-.05*e,0)]},t).color=new n.Color3(1,0,0),n.MeshBuilder.CreateLines("axisY",{points:[n.Vector3.Zero(),new n.Vector3(0,e,0),new n.Vector3(-.05*e,.95*e,0),new n.Vector3(0,e,0),new n.Vector3(.05*e,.95*e,0)]},t).color=new n.Color3(0,1,0),n.MeshBuilder.CreateLines("axisZ",{points:[n.Vector3.Zero(),new n.Vector3(0,0,e),new n.Vector3(0,-.05*e,.95*e),new n.Vector3(0,0,e),new n.Vector3(0,.05*e,.95*e)]},t).color=new n.Color3(0,0,1)},getEntity:B,getRoot:N,isTextureAsset:function(e){var t=e.indexOf("?");return-1!==t&&(e=e.substring(0,t)),n.StringTools.EndsWith(e,".ktx")||n.StringTools.EndsWith(e,".ktx2")||n.StringTools.EndsWith(e,".png")||n.StringTools.EndsWith(e,".jpg")||n.StringTools.EndsWith(e,".jpeg")},equaln:z,sleep:U,b64toBlob:G,simpleObjectEqual:j,updateQueryStringParameter:V,isNone:function(e){return void 0===e||!e&&0!==e},get MouseKey(){return d},get KeyBoard(){return p},get KeyCode(){return f},arrayLast:R,removeOne:M,arrayRemoveIf:O,get FileSystem(){return m},deg2rad:Z,rad2Deg:function(e){return n.Tools.ToDegrees(e)},Box3:E,unionBoundbox:function(e,t){var i=e.minimum,r=t.minimum;return e.minimum.set(Math.min(i.x,r.x),Math.min(i.y,r.y),Math.min(i.z,r.z)),i=e.maximum,r=t.maximum,e.maximum.set(Math.max(i.x,r.x),Math.max(i.y,r.y),Math.max(i.z,r.z)),e},getMin:x,getMax:C,getCanvasTexture:function(e,t,i){return new n.DynamicTexture(e,t,i)},getVideoTexture:function(e,t,i){return new n.VideoTexture(e,t,i)},mirrorMaterial:function(e,t,i){const r=e.material;if(r){i.blockMaterialDirtyMechanism=!1;var s=e.getWorldMatrix(),a=e.getVerticesData("normal");a=new n.Vector3(a[0],a[1],a[2]);let o=n.Vector3.TransformNormal(a,s);a=n.Plane.FromPositionAndNormal(e.absolutePosition,o.scale(-1));const l=new n.MirrorTexture("mirror"+this.Id,1024,i,!0);(r.reflectionTexture=l).mirrorPlane=a,l.renderList=t,l.level=1,i.blockMaterialDirtyMechanism=!0}},Container:s.Container,getGuiContainer:function(e){return new s.Container(e)},Color4:n.Color4,Color3:n.Color3,ColorPalette:W,getColor3:H,getColor4:function(e){return"string"==typeof e?n.Color4.FromHexString(e):n.Color4.FromHexString(e.toString())},generateOcean:function(e,t){return v(this,void 0,void 0,(function*(){const i=n.MeshBuilder.CreateGround("ground",{width:1,height:1,subdivisions:128},e);i.scaling=new n.Vector3(t,t,t),i.position.y=-t/4;var r=yield n.NodeMaterial.ParseFromFileAsync("waterMaterial","https://am-img.gkiiot.com/editor/envs/water.json",e);i.material=r;const s=new n.DefaultRenderingPipeline("defaultPipeline",!1,e,[e.activeCamera]);return s.bloomEnabled=!0,s.bloomThreshold=0,s.bloomKernel=.35,s.bloomScale=.5,s.grainEnabled=!0,s.grain.intensity=8,s.grain.animated=!0,s.chromaticAberrationEnabled=!0,s.chromaticAberration.aberrationAmount=65.1,s.chromaticAberration.radialIntensity=2,s.sharpenEnabled=!0,s.sharpen.edgeAmount=.15,i}))},getOcean:function(e,t){e=n.MeshBuilder.CreateGround("ground",{width:e,height:e},t);var i=new n.ShaderMaterial("test",t,{vertex:"myshader",fragment:"myshader"},{needAlphaBlending:!0,attributes:["position"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","time","mouse","resolution"],samplers:[]});e.material=i;let r=.1;i.onBind=function(e){var t=i.getEffect();t.setFloat("time",r+=.001),t.setVector2("mouse",new n.Vector2(.8,.5)),t.setVector2("resolution",new n.Vector2(1024,1024))}},getWaterPlane:function(e,t,i=[]){const r=(0,n.CreateDisc)("waterMesh",{radius:t},e),s=(r.rotation.x=Math.PI/2,new a.WaterMaterial("water",e,new n.Vector2(512,512)));return s.backFaceCulling=!0,s.bumpTexture=new n.Texture("https://am-img.gkiiot.com/editor/textures/waterbump.png",e),s.windForce=-10,s.waveHeight=2,s.bumpHeight=.2,s.windDirection=new n.Vector2(1,0),s.waterColor=new n.Color3(.1,.1,.6),s.colorBlendFactor=0,i.forEach((e=>s.addToRenderList(e))),r.material=s,[r,s]}});new n.Vector3(1/0,1/0,1/0),new n.Vector3(-1/0,-1/0,-1/0);const re=new n.Vector3;function ne(e){var t;return n.Vector3.FromArray([null!=(t=e.x)?t:0,null!=(t=e.y)?t:0,null!=(t=e.z)?t:0])}function se(e,t){var i;e.x=null!=(i=t.x)?i:e.x,e.y=null!=(i=t.y)?i:e.y,"z"in e&&"z"in t&&(e.z=null!=(i=t.z)?i:e.z)}function ae(e,t){return z(e.x,t.x)&&z(e.y,t.y)&&z(e.z,t.z)}function oe(e){return{x:e.x,y:e.y,z:e.z}}const le=new I;class he{constructor(e){this._name="\u672a\u547d\u540d",this._speedRadio=1,this._time=1,this._loop=!1,this._frame=30,this._entity=e}get Animation(){return this._animation}get name(){return this._name}set name(e){this._name=e}init(){}start(){this._animatable=this._entity.Scene.beginAnimation(this._entity.RenderObject,0,this._time*this._frame,this._loop,this._speedRadio),this.completeCallback&&this._animatable.onAnimationEndObservable.add(this.completeCallback),this._loopCount&&this._loop&&this.setLoopCount(this._loopCount)}pause(){this._animatable&&this._animatable.pause()}restart(){this._animatable&&this._animatable.restart()}stop(){this._animatable&&this._animatable.stop()}reset(){this._animatable&&this._animatable.reset()}clear(){var e=null==(e=this._entity)?void 0:e.RenderObject;e&&M(e.animations,this._animation)}writeFile(e){e.write(1),e.write(this._name),e.write(this._time),e.write(this._loop),e.write(this._frame),e.write(this._speedRadio),e.write(this._loopCount)}readFile(e){e.read(),this._name=e.read(),this._time=e.read(),this._loop=e.read(),this._frame=e.read(),this._speedRadio=e.read(),this._loopCount=e.read()}setLoopCount(e){let t;if(e){let i=0;t=this._animatable.onAnimationLoopObservable.add((r=>{++i===e&&(r.stop(),this._animatable.onAnimationEndObservable.remove(t))}))}return()=>{t&&this._animatable.onAnimationEndObservable.remove(t)}}}let ce=class extends he{constructor(e,t){super(e),this._name="\u672a\u547d\u540d\u79fb\u52a8",this._points=[];var{path:e,time:i=1,loop:r=!1,frame:n=30,loopCount:s}=t;this._time=i,this._loop=r,this._frame=n,this._loopCount=s,this._points=Array.isArray(e)?e:e.Points,t.name&&(this._name=t.name),this.init()}init(){this._entity.removeAnimation(this._name);const e=this._entity.RenderObject,t=new n.Animation(this._name,"position",this._frame,n.Animation.ANIMATIONTYPE_VECTOR3),i=[];let r=0;var s=this._time/this._points.length;for(const e of this._points)i.push({frame:this._frame*s*r++,value:new n.Vector3(e.x,e.y,e.z)});t.setKeys(i),e.animations.push(t),this._animation=t}writeFile(e){super.writeFile(e),e.write(1),e.write(this._points.length);for(const t of this._points)e.write(t.x),e.write(t.y),e.write(t.z)}readFile(e){super.readFile(e),e.read();var t=e.read();for(let i=this._points.length=0;i<t;i++){const t={x:0,y:0,z:0};t.x=e.read(),t.y=e.read(),t.z=e.read(),this._points.push(t)}}},ue=(ce=y([S],ce),class extends he{constructor(e,t){super(e),this._name="\u672a\u547d\u540d\u65cb\u8f6c",this._from=0,this._angle=0,this._angles=[];var{angle:e,dir:i={x:0,y:1,z:0},time:r=1,frame:n=30,loop:s=!0,from:a=0,angles:o=[],loopCount:l,origin:h}=t;this._time=r,this._loop=s,this._frame=n,this._loopCount=l,this._dir=i,this._angle=e,this._from=a,t.name&&(this._name=t.name),this._origin=h,this._angles=o,this.init()}init(){this._entity.removeAnimation(this._name);const e=this._entity.RenderObject,t=new n.Animation(this._name,"rotationQuaternion",this._frame,n.Animation.ANIMATIONTYPE_QUATERNION);e.rotationQuaternion||(e.rotationQuaternion=e.rotation.toQuaternion(),e.rotation.setAll(0));var i,r=n.Vector3.FromArray(Object.values(this._dir)).normalize();const s=[];if(null!=(i=this._angles)&&i.length){var a=this._time/this._angles.length;for(let e=0;e<this._angles.length;e++)s.push({frame:this._frame*e*a,value:n.Quaternion.RotationAxis(r,this._angles[e])})}else s.push({frame:0,value:n.Quaternion.RotationAxis(r,this._from)}),Math.abs(this._from-this._angle)>=2*Math.PI-.001&&s.push({frame:this._frame*this._time*.5,value:n.Quaternion.RotationAxis(r,.5*(this._angle-this._from))}),s.push({frame:this._frame*this._time,value:n.Quaternion.RotationAxis(r,this._angle)});t.setKeys(s),this._origin&&(i=n.Vector3.FromArray(Object.values(this._origin)).negate(),i=ne(this._entity?this._entity.Position:n.Vector3.Zero()).add(i),e.setPivotMatrix(n.Matrix.Translation(i.x,i.y,i.z))),e.animations.push(t),this._animation=t}writeFile(e){super.writeFile(e),e.write(1)}readFile(e){super.readFile(e),e.read(),e.read()}});ue=y([S],ue),function(e){e[e.None=0]="None",e[e.C=1]="C",e[e.W=2]="W"}(K=K||{});const de={[n.PointerEventTypes.POINTERDOWN]:"pointerDown",[n.PointerEventTypes.POINTERUP]:"pointerUp",[n.PointerEventTypes.POINTERMOVE]:"pointerMove",[n.PointerEventTypes.POINTERPICK]:"pointerPick",[n.PointerEventTypes.POINTERWHEEL]:"pointerWheel",[n.PointerEventTypes.POINTERTAP]:"pointerTap",[n.PointerEventTypes.POINTERDOUBLETAP]:"pointerDoubleTap"},pe={pointerOver:n.ActionManager.OnPointerOverTrigger,pointerOut:n.ActionManager.OnPointerOutTrigger,pointerLongPress:n.ActionManager.OnLongPressTrigger};!function(e){e[e.None=0]="None",e[e.Pan=1]="Pan",e[e.Roate=2]="Roate",e[e.Zoom=4]="Zoom",e[e.All=7]="All"}(q=q||{}),function(e){e[e.Up=1]="Up",e[e.Down=2]="Down",e[e.Left=3]="Left",e[e.Right=4]="Right",e[e.Front=5]="Front",e[e.Back=6]="Back",e[e.SW=7]="SW"}(X=X||{}),function(e){e[e.None=0]="None",e[e.Translate=1]="Translate",e[e.Rotate=2]="Rotate",e[e.Scale=4]="Scale",e[e.All=7]="All"}(Y=Y||{}),function(e){e[e.Center=0]="Center",e[e.Bottom=1]="Bottom",e[e.Top=2]="Top",e[e.Left=3]="Left",e[e.Right=4]="Right",e[e.Front=5]="Front",e[e.Back=6]="Back",e[e.LFB=351]="LFB",e[e.RFB=451]="RFB",e[e.LBB=361]="LBB",e[e.RBB=461]="RBB"}(Q=Q||{}),function(e){e[e.Equal=0]="Equal",e[e.Greater=1]="Greater",e[e.Less=2]="Less",e[e.GreEqu=3]="GreEqu",e[e.LessEqu=4]="LessEqu"}($=$||{}),function(e){e[e.Offset=0]="Offset",e[e.To=1]="To"}(J=J||{}),function(e){e[e.Equal=0]="Equal",e[e.UnEqual=1]="UnEqual",e[e.Great=2]="Great",e[e.Less=3]="Less",e[e.GtEqual=4]="GtEqual",e[e.LessEqual=5]="LessEqual",e[e.Include=6]="Include",e[e.UnInclude=7]="UnInclude",e[e.Is=8]="Is",e[e.IsNot=9]="IsNot"}(ee=ee||{}),function(e){e[e.None=0]="None",e[e.Sun=1]="Sun",e[e.Image=2]="Image",e[e.Env=3]="Env"}(te=te||{});class fe extends L{constructor(){super(),this.isAsync=!1,this.isLight=!1,this.isPart=!1,this.IsSelect=!1,this._enableShadow=!0,this._matrix=n.Matrix.Identity(),this._scale=new n.Vector3(1,1,1),this._rotation=new n.Vector3,this._rotationQuaternion=new n.Quaternion,this._position=new n.Vector3,this._isVisiable=!0,this._colorIndex=9,this._cacheDrawObject=new Map,this._animations=[],this._isPickable=!0,this._highlight=!1,this._opacity=1,this._animationing=[]}get Material(){if(this._PBRID)return this._PBRID.Object}set Material(e){this._PBRID=e.ObjectId,this.updateMaterial()}get UniqueName(){return this.constructor.type+this.Id}get Name(){var e;return null!=(e=this._name)?e:this.UniqueName}set Name(e){this._name=e,le.trigger({type:"updateName",target:this})}get CanUpdate(){var e;return!(null==(e=this.ObjectId)||!e.Index||this._erase)}get RenderType(){var e;return null!=(e=this._renderType)?e:fe.renderType}get IsPickable(){return this._isPickable}set IsPickable(e){this._isPickable=e,this._drawObject.getChildMeshes().forEach((t=>t.isPickable=e))}get Highlight(){return this._highlight}get IsComponent(){return!1}highlight(e){const t=fe.Scene.getHighlightLayerByName("select-entity");this._drawObject.getChildMeshes().forEach((i=>e?t.addMesh(i,n.Color3.FromHexString(e)):t.removeMesh(i)))}get DrawObject(){var e;if(this._drawObject)return this._drawObject;const t=this.GetDrawObjectFromRenderType(null!=(e=this._renderType)?e:fe.renderType);return this._drawObject=new n.TransformNode(null!=(e=this.Name)?e:null==(e=this._id)?void 0:e.Index.toString(),fe.Scene,!1),this.isPart||(t.parent=this._drawObject,this._drawObject.metadata={Entity:this}),this._drawObject.setEnabled(this._isVisiable&&!this._erase),this.update(),this._drawObject}get Scene(){var e;return null==(e=this.RenderObject)?void 0:e.getScene()}get RenderObject(){return this.GetDrawObjectFromRenderType(this.RenderType)}get ColorIndex(){return this._colorIndex}set ColorIndex(e){this._colorIndex!==e&&(this.writeSnapshoot(),this._colorIndex=e,this.update())}get Matrix(){return this._matrix.clone()}set Matrix(e){this.writeSnapshoot(),this._matrix.copyFrom(e),this._matrix.decompose(this._scale,this._rotationQuaternion,this._position),this._rotationQuaternion.toEulerAnglesToRef(this._rotation),this.update()}get MatrixInv(){return this._matrix.invert()}get TransfromFromMtx(){var e=new n.Vector3;const t=new n.Quaternion;var i=new n.Vector3;return this._matrix.decompose(i,t,e),{position:e,rotation:t.toEulerAngles(),scale:i}}get BoundingVectors(){return this.DrawObject.getHierarchyBoundingVectors()}get BoundingBox(){const e=this.RenderObject.getBoundingInfo().boundingBox;return new E(e.minimum,e.maximum,e.getWorldMatrix())}get Opacity(){return this._opacity}set Opacity(e){e!==this._opacity&&(this.writeSnapshoot(),this._opacity=e,this.setPrivateMaterial(),this._standardMaterial.alpha=e)}get Color(){return this._color}set Color(e){e!==this._color&&(this.writeSnapshoot(),this._color=e,this.setPrivateMaterial(),this._standardMaterial.diffuseColor=n.Color3.FromHexString(e))}translate(e){this.writeSnapshoot(),this.Position=this._position.add(ne(e))}GetDrawObjectFromRenderType(e=u.Conceptual){if(this._cacheDrawObject.has(e)){const t=this._cacheDrawObject.get(e);return t.setEnabled(!0),t}var t=this.initDrawObject(e);if(t)return this._cacheDrawObject.set(e,t),t}get Position(){return{x:this._position.x,y:this._position.y,z:this._position.z}}set Position(e){this.writeSnapshoot(),se(this._position,e),this.updateMatrix(),this.update()}get Rotation(){return{x:this._rotation.x,y:this._rotation.y,z:this._rotation.z}}set Rotation(e){this.writeSnapshoot(),se(this._rotation,e),n.Quaternion.FromEulerAnglesToRef(this._rotation.x,this._rotation.y,this._rotation.z,this._rotationQuaternion),this.updateMatrix(),this.update()}get Scale(){return{x:this._scale.x,y:this._scale.y,z:this._scale.z}}set Scale(e){this.writeSnapshoot(),se(this._scale,e),this._scale.copyFromFloats(e.x,e.y,e.z),this.updateMatrix(),this.update()}get Visiable(){return this._isVisiable&&!this.IsErase}set Visiable(e){e!==this._isVisiable&&(this.writeSnapshoot(),this._isVisiable=e,this._drawObject.setEnabled(!this._erase&&this._isVisiable),this.trigger({type:"updateVisiable",target:this}),le.trigger({type:"updateVisiable",target:this}))}lookAt(e){this._drawObject.lookAt(ne(e)),this._drawObject.rotationQuaternion?(this._rotationQuaternion.copyFrom(this._drawObject.rotationQuaternion),this._rotation.copyFrom(this._rotationQuaternion.toEulerAngles())):(this._rotation.copyFrom(this._drawObject.rotation),this._rotationQuaternion.copyFrom(this._rotation.toQuaternion())),this.updateMatrix()}get AnimationNames(){const e=[];return this.modelAnimations&&this.modelAnimations.forEach((t=>e.push(t.name))),this._animations.forEach((t=>e.push(t.name))),e}get Animations(){var e;const t=[...this._animations];return null!=(e=this.modelAnimations)&&e.length&&t.push(...this.modelAnimations),t}get EnableShadow(){return this._enableShadow}set EnableShadow(e){this._enableShadow!==e&&(this._enableShadow=e,le.trigger({type:"update-shadow",target:this}))}get DiffuseTexutre(){return this.diffuseTexture}set DiffuseTexture(e){this.diffuseTexture=e,this.setPrivateMaterial();const t=this._standardMaterial;t.diffuseTexture=e.Object.Texture,t.ambientColor=n.Color3.White()}removeAnimation(e){const t=this._animations.find((t=>t.name===e));t&&(t.clear(),M(this._animations,t))}startAnimates(e,t=!0,i=1){for(const r of this.Animations)e===r.name&&r.start(t,i)}stopAnimates(e){for(const t of this.Animations)e&&!e.includes(t.name)||t.stop()}clearAnimatable(){this.RenderObject.animations.length=0;for(const e of this._animations)e.pause(),e.stop(),e.reset();this._animations.length=0,this.stopAnimates()}appendAnimation(e){this.writeSnapshoot(),this._animations.push(e),this.trigger({type:"addAnimation",target:this})}mirrorMaterial(e,t){const i=e.material;if(i){var r=e.getWorldMatrix(),s=e.getVerticesData("normal");s=new n.Vector3(s[0],s[1],s[2]);let a=n.Vector3.TransformNormal(s,r);s=n.Plane.FromPositionAndNormal(e.position,a.scale(-1));const o=new n.MirrorTexture("mirror"+this.Id,1024,fe.Scene,!0);(i.reflectionTexture=o).mirrorPlane=s,o.renderList=t,o.level=1}}moveAnimate(e){return e=new ce(this,e),this.appendAnimation(e),e}rotateAnimate(e){return e=new ue(this,e),this.appendAnimation(e),e}scaleAnimate(e){const{scale:t,time:i=1,frame:r=30,loop:s=!1,loopCount:a,complete:o}=e;e=n.Vector3.FromArray([null!=(e=t.x)?e:this._scale.x,null!=(e=t.y)?e:this._scale.y,null!=(e=t.z)?e:this._scale.z]);const l=this.RenderObject,h=l.getScene(),c=new n.Animation("rotate-animate","scaling",30,n.Animation.ANIMATIONTYPE_VECTOR3),u=(c.setKeys([{frame:0,value:this._scale.clone()},{frame:i*r,value:e}]),l.animations.push(c),h.beginAnimation(l,0,i*r,s));u.onAnimationEndObservable.addOnce((()=>{null!=o&&o()}));let d=this.setLoopCount(a,u);return{clear:()=>{u.stop(),null!=d&&d(),M(l.animations,c)},restart:()=>u.restart(),stop:()=>u.stop(),pause:()=>u.pause(),reset:()=>u.reset()}}setLoopCount(e,t){let i;if(e){let r=0;i=t.onAnimationLoopObservable.add((t=>{++r===e&&t.stop()}))}return()=>{i&&t.onAnimationEndObservable.remove(i)}}moveTo(e,t=!0,i){return new Promise((r=>{if(i){var{time:s=1,startTime:a}=i;const o=this._drawObject.position.clone(),l=[{frame:30*a,value:o},{frame:30*(s+a),value:t?o.clone().add(ne(e)):ne(e)}];if(ae(l[0].value,l[1].value))r(null);else{const e=new n.Animation("move-animate","position",30,n.Animation.ANIMATIONTYPE_VECTOR3);(e.setKeys(l),this._animationing.push(e),this._drawObject.animations.push(e),this._drawObject.getScene().beginDirectAnimation(this._drawObject,this._animationing,30*a,30*(s+a),!1)).onAnimationEndObservable.addOnce((()=>{M(this._drawObject.animations,e),M(this._animationing,e),this._position=l[1].value,r(null)}))}}else t?this.applyMatrix(n.Matrix.Translation(null!=(s=e.x)?s:0,null!=(a=e.y)?a:0,null!=(s=e.z)?s:0)):this.Position=e,r(null)}))}rotateTo(e){return new Promise((t=>{const{time:i=1,dir:r={x:0,y:1,z:0},angle:s,animation:a,isOffset:o,pivot:l,startTime:h=0}=e;var c=n.Vector3.FromArray(Object.values(r)).normalize();if(a){const e=this._drawObject.rotationQuaternion||n.Quaternion.FromEulerVector(this._drawObject.rotation),r=[{frame:30*h,value:e.clone()}];if(z(s%(2*Math.PI),0)){var u=Math.round(s/(2*Math.PI));for(let t=0;t<u;t++){var d=n.Quaternion.RotationAxis(c,2*Math.PI*t+Math.PI);r.push({frame:30*(h+i),value:o?e.clone().multiply(d):d})}}var p=n.Quaternion.RotationAxis(c,s);if(r.push({frame:30*(h+i),value:o?e.clone().multiply(p):p}),2===r.length&&ae(r[0].value,r[1].value))t(null);else{l&&this._drawObject.setPivotPoint(ne(l));const e=new n.Animation("rotate-animation","rotationQuaternion",30,n.Animation.ANIMATIONTYPE_QUATERNION);(this._animationing.push(e),e.setKeys(r),this._drawObject.animations.push(e),this._drawObject.getScene().beginDirectAnimation(this._drawObject,this._animationing,30*h,30*(h+i),!1)).onAnimationEndObservable.addOnce((()=>{M(this._drawObject.animations,e),M(this._animationing,e),this._rotation=r[1].value.toEulerAngles(),t(null)}))}}else p=n.Quaternion.RotationAxis(c,s).toEulerAngles(),o?this.applyMatrix(n.Matrix.RotationAxis(c,s)):this.Rotation=p,t(null)}))}scaleTo(e){const{scale:t,time:i,animation:r,isOffset:s,pivot:a,startTime:o}=e;return new Promise((e=>{if(r){const r=this.DrawObject,l=r.getScene(),h=[{frame:30*o,value:this._scale.clone()},{frame:30*(i+o),value:ne(s?this._scale.multiplyByFloats(t.x,t.y,t.z):t)}];if(ae(h[0].value,h[1].value))e(null);else{const t=new n.Animation("scale-animate","scaling",30,n.Animation.ANIMATIONTYPE_VECTOR3);(this._animationing.push(t),t.setKeys(h),r.animations.push(t),a&&r.setPivotPoint(ne(a)),l.beginDirectAnimation(r,this._animationing,30*o,30*(i+o),!1)).onAnimationEndObservable.addOnce((()=>{M(this._drawObject.animations,t),M(this._animationing,t),this._scale=h[1].value,e(null)}))}}else this.Scale=t,e(null)}))}opacityTo(e){return new Promise((t=>{this.setPrivateMaterial();var{opacity:i,time:r,startTime:s}=e;const a=[{frame:30*s,value:this._opacity},{frame:30*(s+r),value:i}];if(a[0].value===a[1].value)t(!1);else{const e=new n.Animation("opacity"+this.UniqueName,"alpha",30,n.Animation.ANIMATIONTYPE_FLOAT);(this._animationing.push(e),e.setKeys(a),this._standardMaterial.animations?this._standardMaterial.animations.push(e):this._standardMaterial.animations=[e],this.Scene.beginDirectAnimation(this._standardMaterial,this._animationing,30*s,30*(r+s))).onAnimationEndObservable.add((()=>{this._opacity=a[1].value,t(!0)}))}}))}updateRenderType(e){if(this._renderType!==e||0===this.DrawObject.getChildMeshes.length){this._drawObject.getChildren().forEach((e=>{e.setEnabled(!1)})),this._renderType=e;const t=this.GetDrawObjectFromRenderType(e);!t||t.parent||(t.parent=this._drawObject)}}updateMatrix(){this.CanUpdate&&(n.Matrix.ComposeToRef(this._scale,this._rotationQuaternion,this._position,this._matrix),this.trigger({type:"matrix",target:this}))}updatePart(){if(this.isPart){const e=this.RenderObject;e.position.copyFrom(this._position),e.rotation.copyFrom(this._rotation),e.scaling.copyFrom(this._scale)}}update(){var e;this.isPart?this.updatePart():this.CanUpdate&&this._drawObject&&(this._drawObject.position.copyFrom(this._position),this._drawObject.rotation.copyFrom(this._rotation),this._drawObject.scaling.copyFrom(this._scale),this._drawObject.setEnabled(this._isVisiable),this._drawObject.getChildMeshes().forEach((e=>e.isPickable=this._isPickable)),this.updateDrawObject(null!=(e=this._renderType)?e:fe.renderType,this.RenderObject),this.updateMaterial(),this.trigger({type:"update",target:this}),le.trigger({type:"update",target:this}))}applyMatrix(e){this._matrix.multiplyToRef(e,this._matrix);const t=new n.Quaternion;this._matrix.decompose(this._scale,t,this._scale),t.toEulerAnglesToRef(this._rotation),this.update()}initDrawObject(e){return null}updateDrawObject(e,t){}updateMaterial(){}erase(e=!0){e!==this._erase&&(super.erase(e),this._drawObject.setEnabled(!e),le.trigger({type:"remove",target:this}),this.trigger({type:"remove",target:this}))}destory(){for(var[e,t]of(super.destory(),this._cacheDrawObject))t.dispose(void 0,!0);this._cacheDrawObject.clear(),this._drawObject&&this._drawObject.dispose(void 0,!0),this._drawObject=null}registerAction(e,t){e=pe[e];let i=this.RenderObject;if(i instanceof n.Mesh){if(!i.geometry){let e=i.getChildren().find((e=>"actionHelper"===e.name));if(!e){let t=i.getHierarchyBoundingVectors();t.min.divideToRef(this._scale,t.min),t.max.divideToRef(this._scale,t.max);var r=t.max.y-t.min.y;(e=n.MeshBuilder.CreateBox("actionHelper",{width:t.max.x-t.min.x,height:r,depth:t.max.z-t.min.z},fe.Scene)).visibility=0,e.parent=i,e.position.y=r/2}i=e}i.actionManager||(i.actionManager=new n.ActionManager(this.Scene));const s=i.actionManager.registerAction(new n.ExecuteCodeAction({trigger:e,parameter:"r"},t));return()=>{i.actionManager.unregisterAction(s)}}}move2Zero(e){const t=this.RenderObject;e=e||t.getHierarchyBoundingVectors().min,e=this._position.clone().subtract(e),this.Position=e}renderEdge(e=10,t="#ffffff"){if(this._drawObject)for(const i of this._drawObject.getChildMeshes())i.geometry&&(i.enableEdgesRendering(),i.edgesWidth=e,i.edgesColor=n.Color4.FromHexString(t))}cloneMaterial(){if(this._drawObject)for(const e of this._drawObject.getChildMeshes())e.material&&(e.material=e.material.clone(e.material.name+Date.now()))}emissive(e){if(this._drawObject){var t=e?n.Color3.FromHexString(e):n.Color3.Black;for(const e of this._drawObject.getChildMeshes())e.material&&"emissiveColor"in e.material&&(e.material.emissiveColor=t)}}disabledRenderEdge(){if(this._drawObject)for(const e of this._drawObject.getChildMeshes())e.geometry&&e.disableEdgesRendering()}writeFile(e){super.writeFile(e),e.write(2),e.write(this._name),e.write(this._colorIndex),e.writeArray(this._position.asArray()),e.writeArray(this._rotation.asArray()),e.writeArray(this._scale.asArray()),e.write(this._isPickable),e.write(this._isVisiable),e.write(this._color),e.writeObjectId(this.GroupId)}readFile(e){super.readFile(e);var t=e.read(),i=(this._name=e.read(),this._colorIndex=e.read(),e.read()),r=e.readArray(i);this._position.fromArray(r),i=e.read(),r=e.readArray(i),this._rotation.fromArray(r),n.Quaternion.FromEulerVectorToRef(this._rotation,this._rotationQuaternion),i=e.read(),r=e.readArray(i),this._scale.fromArray(r),this._isPickable=e.read(),this._isVisiable=e.read(),this._color=e.read(),1<t&&(this.GroupId=e.readObjectId()),this.updateMatrix()}_applyHistoryRecord(e){super._applyHistoryRecord(e),e instanceof A?this._drawObject.setEnabled(!this._erase):e instanceof k&&this.readFile(e.Filer)}setPrivateMaterial(){this._standardMaterial||(this._standardMaterial=this.defaultMaterial.clone("material"+this.UniqueName),this.RenderObject.material=this._standardMaterial)}}fe.renderType=u.Conceptual;const me={debugger:!1,loadPlugins:new Set,assetURL:"",Texture_URL:"",SkyBox_URL:""};class _e{static get MainViewer(){return this._MainViewer}static set MainViewer(e){this._MainViewer=e,this._MainScene=e.Scene}static get MainScene(){return this._MainScene}static get Scene(){return this._Scene}static set Scene(e){this._Scene=e,fe.Scene=e}static StartWait(){this.waiting=!0}static Wait(){if(!this.waiting)return()=>{};let e;var t=new Promise((t=>{e=t}));return this.waitList.push(t),e}static WaitComplete(){return v(this,void 0,void 0,(function*(){return Promise.all(this.waitList).then((e=>(this.waiting=!1,this.waitList.length=0,e)))}))}static getLastPromise(){return R(this.waitList)}}_e.waitList=[],_e.waiting=!1,_e.PreviewMode=!1,_e.Reading=!1,_e.GlobalVariables=[];const ge=new class{constructor(){this.assestPromiseCache=new Map}getAssetPromise(e){return this.assestPromiseCache.get(e)}setAssetPromise(e,t){this.assestPromiseCache.set(e,t)}clear(){this.assestPromiseCache.clear()}};let ye=class extends fe{constructor(e={url:""}){super(),this.isAsync=!0,this.isRead=!1,this.uvs=[],this.count=0,this.tessNb=64,this.url=null!=(e=null==e?void 0:e.url)?e:""}move2Zero(e){const t=this.RenderObject;var i;return e||(i=this.BoundingVectors,(e=n.Vector3.Center(i.min,i.max).negate()).y=0),this.Position=t.position.add(e),e}get BoundingBox(){var{min:e,max:t}=this.BoundingVectors;return new E(e,t)}initDrawObject(e){const t=new n.Mesh("import"+this.Id,fe.Scene);if(t.doNotSyncBoundingInfo=!0,this.url){var i=this.url.startsWith("http")?this.url:me.assetURL+this.url,r=(this.Name||(this.Name=R(this.url.split("/")).split(".")[0]),i+"&"+fe.Scene.uid);const s=ge.getAssetPromise(r);if(s)s.then((e=>{const i=this.handleAssetContainer(e);this.model2Zero(i),i.parent=t,this.trigger({type:"load",target:this}),le.trigger({type:"load",target:this})}));else{const s=_e.Wait();ge.setAssetPromise(r,_e.getLastPromise()),r=n.SceneLoader.LoadAssetContainer(i,void 0,fe.Scene,(i=>{if(this.isPart||this._db||fe.Scene!==_e.MainScene){for(const e of i.materials)e instanceof n.StandardMaterial&&(e.diffuseColor=n.Color3.White(),e.ambientColor=n.Color3.White(),e.backFaceCulling=!1),e.transparencyMode=n.Material.MATERIAL_ALPHABLEND,e.alpha=this._opacity;var r=t;i.textures.length=0,i.meshes.forEach((e=>e instanceof n.Mesh&&(e.receiveShadows=!0)));const a=this.handleAssetContainer(i);e===u.Wireframe&&i.materials.forEach((e=>e.wireframe=!0)),this.model2Zero(a),this.trigger({type:"load",target:this}),le.trigger({type:"load",target:this}),s(i),a.parent=r}}),(e=>{e=e.lengthComputable?Math.floor(e.loaded/e.total*100):0,this.trigger({type:"loading",target:this,percentage:e}),le.trigger({type:"loading",target:this,percentage:e})}),((e,t)=>{(this.isPart||this._db||fe.Scene!==_e.MainScene)&&(this.trigger({type:"load",target:this,error:t}),le.trigger({type:"load",target:this,error:t}))})),me.loadPlugins.add(r)}}return t}uvOffset(e){fe.Scene.registerBeforeRender((()=>{e.bumpTexture.uOffset=e.bumpTexture.uOffset+.001}))}updateMaterial(){}writeFile(e){super.writeFile(e),e.write(1),e.write(this.url)}readFile(e){this.isRead=!0,super.readFile(e),e.read(),this.url=e.read(),this.update()}model2Zero(e){var t=e.getHierarchyBoundingVectors();const i=n.Vector3.Center(t.min,t.max),r=(i.y=t.min.y,i.negate());e.position=r,this.isRead||(this.Position=r.negate(),this.isRead=!1)}handleAssetContainer(e){let t=e.instantiateModelsToScene((e=>e+this.Id));if(this.modelAnimations=t.animationGroups,1===t.rootNodes.length)return t.rootNodes[0];{const e=new n.TransformNode("assetContainerRootMesh",fe.Scene);return t.rootNodes.forEach((t=>{t.parent||(t.parent=e)})),e}}get Opacity(){return this._opacity}set Opacity(e){if(e!==this._opacity){this.writeSnapshoot(),this._opacity=e;for(const t of this._drawObject.getChildMeshes())t.material&&(t.material.transparencyMode=n.Material.MATERIAL_ALPHABLEND,t.material.alpha=e)}}};ye.type="ImportEntity",ye=y([S],ye);class ve extends L{constructor(){super(...arguments),this._position={x:"0",y:"0"},this._rotation=0,this._scale={x:1,y:1},this.isSelect=!1,this._isVisiable=!0,this._horAlign=0,this._verAlign=0,this._isPickable=!0,this._hasTransition=!1}get Name(){var e;return null!=(e=this._name)?e:"\u56fe\u6807"+this.Id}set Name(e){this._name=e,le.trigger({type:"updateName",target:this})}get DrawObject(){return this._drawObject||(this._drawObject=this.initDrawObject(),this._drawObject.metadata={entity:this},this._drawObject.style.display=this._isVisiable&&!this._erase?"block":"none",this._drawObject)}get Visiable(){return this._isVisiable}set Visiable(e){e!==this._isVisiable&&(this.writeSnapshoot(),this._isVisiable=e,this.update())}get IsPickable(){return this._isPickable}set IsPickable(e){this._isPickable=e,this.update()}get Position(){return Object.assign({},this._position)}set Position(e){j(this._position,e)||(this.writeSnapshoot(),this._position.x=e.x,this._position.y=e.y,this.update())}get Rotation(){return this._rotation}set Rotation(e){e!==this._rotation&&(this.writeSnapshoot(),this._rotation=e,this.update())}get Scale(){return this._scale}set Scale(e){j(this._scale,e)||(this.writeSnapshoot(),this._scale=e,this.update())}get IsSelect(){return this.isSelect}set IsSelect(e){e!==this.isSelect&&(this.isSelect=e,this._drawObject&&(this._drawObject.style.outline=e?"2px solid #cccccc":"none"))}get Draging(){return!!this._start}get Width(){return this._width}set Width(e){e!==this._width&&(this.writeSnapshoot(),this._width=e,this.update())}get Height(){return this._height}set Height(e){e!==this._height&&(this.writeSnapshoot(),this._height=e,this.update())}get HorAlign(){return this._horAlign}set HorAlign(e){e!==this._horAlign&&(this.writeSnapshoot(),this._horAlign=e,this.update())}get VerAlign(){return this._verAlign}set VerAlign(e){e!==this._verAlign&&(this.writeSnapshoot(),this._verAlign=e,this.update())}get HasTransition(){return this._hasTransition}set HasTransition(e){e!==this._hasTransition&&(this.writeSnapshoot(),this._hasTransition=e,this.update())}start(e,t){this._db&&this._db.HistoryManager.startCmd("\u62d6\u62fdDOM"),this.writeSnapshoot(),this._start=new n.Vector2(e,t)}end(){this._start=null,this._db&&this._db.HistoryManager.endCmd()}move(e,t,i=this._drawObject){var r,n,s;i&&(i=e-this._start.x,r=t-this._start.y,s=this.convertValue(this._position.x,_e.MainViewer.Width),n=this.convertValue(this._position.y,_e.MainViewer.Height),s=2===this._horAlign?s-i:s+i,this._verAlign,i=n+r,this.Position={x:s/_e.MainViewer.Width*100+"%",y:i/_e.MainViewer.Height*100+"%"},this._start.set(e,t))}initDrawObject(){return null}updateDrawObject(e){e.style.width=this.convertValue(this._width,_e.MainViewer.Width)+"px",e.style.height=this.convertValue(this._height,_e.MainViewer.Height)+"px",this.setPosition(e),e.style.zIndex="2",e.style.overflow="hidden",e.style.transform=`rotate(${this._rotation}deg) scale(${this._scale.x},${this._scale.y})`,e.style.transition=this._hasTransition?"all .1s":"",e.style.display=this._isVisiable?"block":"none",e.style.pointerEvents=this._isPickable?"auto":"none"}update(){this._drawObject&&(this.updateDrawObject(this._drawObject),this.trigger({type:"update",target:this}),le.trigger({type:"update",target:this}))}erase(e=!0){e!==this._erase&&(super.erase(e),this._drawObject.style.display=e?"none":"block",le.trigger({type:"remove",target:this}),this.trigger({type:"remove",target:this}))}destory(){super.destory(),this._drawObject&&this._drawObject.remove(),this._drawObject=null}writeFile(e){super.writeFile(e),e.write(5),e.write(this._position.x),e.write(this._position.y),e.write(this._rotation),e.write(this._scale.x),e.write(this._scale.y),e.write(this._width),e.write(this._height),e.write(this._isVisiable),e.write(this._name),e.write(this._horAlign),e.write(this._verAlign),e.write(this._isPickable),e.write(this._hasTransition)}readFile(e){super.readFile(e);var t=e.read();this._position.x=e.read(),this._position.y=e.read(),this._rotation=e.read(),this._scale.x=e.read(),this._scale.y=e.read(),this._width=e.read(),this._height=e.read(),this._isVisiable=e.read(),1<t&&(this._name=e.read()),2<t&&(this._horAlign=e.read(),this._verAlign=e.read()),3<t&&(this._isPickable=e.read()),4<t&&(this._hasTransition=e.read())}_applyHistoryRecord(e){super._applyHistoryRecord(e),e instanceof A?this._drawObject.style.display=this._erase?"none":"block":e instanceof k&&this.readFile(e.Filer)}convertValue(e,t){return"string"==typeof e?e.endsWith("%")?parseFloat(e)/100*t:parseFloat(e):e}setPosition(e){var t=this.convertValue(this._position.x,_e.MainViewer.Width),i=this.convertValue(this._position.y,_e.MainViewer.Height),r=this.convertValue(this._width,_e.MainViewer.Width),n=this.convertValue(this._height,_e.MainViewer.Height);0===this._horAlign?(e.style.left=t+"px",e.style.right="auto"):2===this._horAlign?(e.style.right=t+"px",e.style.left="auto"):(e.style.left=_e.MainViewer.Width/2-r/2+"px",e.style.right="auto"),0===this._verAlign?(e.style.top=i+"px",e.style.bottom="auto"):2===this._verAlign?(e.style.bottom=i+"px",e.style.top="auto"):(e.style.top=_e.MainViewer.Height/2-n/2+"px",e.style.bottom="auto")}}class be extends s.MultiLine{_draw(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this.color,e.lineWidth=this.lineWidth,e.setLineDash(this.dash),e.beginPath();let t,i=!0,r=this._points.slice();var s,a,o;2===r.length&&(s=r[0]._point,a=r[1]._point,z(s.x,a.x)||z(s.y,a.y)||(o=n.Vector3.Center(s,a),r=[r[0],{_point:{x:s.x,y:o.y,z:o.z}},{_point:{x:a.x,y:o.y,z:o.z}},r[1]])),r.forEach((r=>{r&&(i?(e.moveTo(r._point.x,r._point.y),i=!1):r._point.z<1&&t.z<1?e.lineTo(r._point.x,r._point.y):e.moveTo(r._point.x,r._point.y),t=r._point)})),e.stroke(),e.restore()}}class Ee extends L{constructor(){super(...arguments),this.Is3D=!1,this._color="#000000",this._fontSize="12px",this._width="200px",this._height="30px",this._rotation=0,this._scale={x:1,y:1},this._zIndex=0,this._alpha=.9,this._end=new n.Vector2,this._position={x:"0",y:"0"},this._isSelect=!1,this._name="",this.dataList=[],this._isVisiable=!0,this._isPickable=!0,this.lines=[],this.drag=e=>{var t;this._start&&([e,t]=[-(e=this._start.subtract(new n.Vector2(e.x,e.y))).x+this._end.x,-e.y+this._end.y],this.move({x:e,y:t}))}}get DataList(){return[...this.dataList]}set DataList(e){this.dataList=e}get UniqueName(){return this.constructor.type+this.Id}get Name(){return this._name||this.UniqueName}set Name(e){this._name=e,le.trigger({type:"updateName",target:this})}get Position(){return Object.assign({},this._position)}set Position(e){this.writeSnapshoot(),this._position.x=e.x,this._position.y=e.y,this.move(e)}get Rotation(){return this._rotation}set Rotation(e){this.writeSnapshoot(),this._rotation=e,this._drawObject.rotation=e}get Scale(){return Object.assign({},this._scale)}set Scale(e){this.writeSnapshoot(),Object.assign(this._scale,e),this._drawObject.scaleX=e.x,this._drawObject.scaleY=e.y}get Width(){return this._width}set Width(e){e!==this._width&&(this.writeSnapshoot(),this._width=e,this.update())}get Height(){return this._height}set Height(e){e!==this._height&&(this.writeSnapshoot(),this._height=e,this.update())}get DrawObject(){return this._drawObject||(this._drawObject=this.initDrawObject(),this._drawObject.metadata={entity:this},this._drawObject.isVisible=this._isVisiable&&!this._erase,this.supportDrag(),this._drawObject)}get Draging(){return!!this._start}get IsSelect(){return this._isSelect}set IsSelect(e){this._isSelect=e,this._drawObject&&(this._drawObject.shadowColor=e?"#000000":"#168df8")}get Visiable(){return this._isVisiable}set Visiable(e){e!==this._isVisiable&&(this.writeSnapshoot(),this._isVisiable=e,this.update())}get IsPickable(){return this._isPickable}set IsPickable(e){this._isPickable=e}attachEntity(e){this.linkEntity=e}initDrawObject(){return null}setProp(e,t){for(const i of this.dataList)i.key===e&&(i.value=t)}updateDrawObject(e){e.width=this._width,e.color=this._color,e.rotation=this._rotation,e.scaleX=this._scale.x,e.scaleY=this._scale.y,e.zIndex=this._zIndex,e.fontSize=this._fontSize,e.alpha=this._alpha,e.isVisible=this._isVisiable,this.lines.forEach((e=>e.isVisible=this._isVisiable)),this.move(this._position,e)}update(){this._drawObject&&(this.updateDrawObject(this._drawObject),this.trigger({type:"update",target:this}),le.trigger({type:"update",target:this}))}move(e,t=this._drawObject){var i,r;t&&(i=_e.MainViewer.Width,r=_e.MainViewer.Height,this.linkEntity?(t.linkOffsetX=e.x,t.linkOffsetY=e.y,this._position.x=e.x.toString(),this._position.y=e.y.toString()):("number"==typeof e.x?(t.left=e.x/i*100+"%",this._position.x=e.x/i*100+"%"):(t.left=e.x,this._position.x=e.x),"number"==typeof e.y?(t.top=e.y/r*100+"%",this._position.y=e.y/r*100+"%"):(t.top=e.y,this._position.y=e.y)),le.trigger({type:"update",target:this}),this.trigger({type:"update",target:this}))}erase(e=!0){e!==this._erase&&(super.erase(e),this._drawObject.isVisible=!e,this.lines.forEach((t=>t.isVisible=!e)),le.trigger({type:"remove",target:this}),this.trigger({type:"remove",target:this}))}destory(){super.destory(),this._drawObject&&this._drawObject.dispose(),this._drawObject=null,this.lines.forEach((e=>e.dispose())),this.lines.length=0}writeFile(e){super.writeFile(e),e.write(2),e.write(this._position.x),e.write(this._position.y),e.write(this._rotation),e.write(this._scale.x),e.write(this._scale.y),e.write(this._name),e.write(this._width),e.write(this._height),e.write(this._color),e.write(this._zIndex),e.write(this._fontSize),e.write(this._alpha),e.writeObjectId(this.linkEntity),e.writeAnyArray(this.dataList,(t=>{e.write(t.key),e.write(t.label),e.write(t.value),e.write(t.unit)})),e.write(this._isVisiable)}readFile(e){super.readFile(e);var t=e.read();this._position.x=e.read(),this._position.y=e.read(),this._rotation=e.read(),this._scale.x=e.read(),this._scale.y=e.read(),this._name=e.read(),this._width=e.read(),this._height=e.read(),this._color=e.read(),this._zIndex=e.read(),this._fontSize=e.read(),this._alpha=e.read(),this.linkEntity=e.readObjectId(),this.dataList.length=0,e.readAnyArray((()=>{const t={};t.key=e.read(),t.label=e.read(),t.value=e.read(),t.unit=e.read(),this.dataList.push(t)})),1<t&&(this._isVisiable=e.read())}_applyHistoryRecord(e){super._applyHistoryRecord(e),e instanceof A?this._drawObject.isVisible=!this._erase:e instanceof k&&this.readFile(e.Filer)}getPositionValue(e,t){return"string"==typeof e?e.endsWith("%")?parseFloat(e)/100*t:parseFloat(e):e}supportDrag(){this._drawObject.isPointerBlocker=!0,this._drawObject.onPointerDownObservable.add((e=>{if(this._isPickable&&(le.trigger({type:"pointerDownGui",target:this,point:e}),!_e.PreviewMode)){this._db&&this._db.HistoryManager.startCmd("\u62d6\u62fdGUI"),this.writeSnapshoot(),this._start=new n.Vector2(e.x,e.y);let i=this._drawObject.left,r=this._drawObject.top;this.linkEntity&&(i=this._drawObject.linkOffsetX,r=this._drawObject.linkOffsetY);e=_e.MainViewer.Width;var t=_e.MainViewer.Height;e=this.getPositionValue(i,e),t=this.getPositionValue(r,t);this._end=new n.Vector2(e,t),this._drawObject.isPointerBlocker=!1}})),this._drawObject.onPointerUpObservable.add((e=>{le.trigger({type:"pointerUpGui",target:this,point:e}),this._start=null,this._drawObject.isPointerBlocker=!0,this._db&&this._db.HistoryManager.endCmd()}))}generateLinkLine(e,t=0){setTimeout((()=>{var t;if(null!=(t=this.linkEntity)&&t.Object){const t=new be("linkLine"+this.Id);(t.color="#697d93",t.lineWidth=3,t.add(e),t.getAt(1)).mesh=this.linkEntity.Object.RenderObject,e.zIndex=1,e.parent.addControl(t),e.linkWithMesh(this.linkEntity.Object.DrawObject),e.linkOffsetY=-parseFloat(this._height)+"px",this.move(this.Position,e),this.lines.push(t)}}),t)}}var xe=function(){function e(e,t,i,r){this.initialize(e,t=void 0!==t&&t,i,r)}return e.prototype.initialize=function(e,t,i,r){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=r,this},e}(),Ce=function(e,t,i){void 0===i&&(i=null),this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},we=function(){function e(e){this._observers=new Array,this._eventState=new xe(0),e&&(this._onObserverAdded=e)}return e.FromPromise=function(t,i){var r=new e;return t.then((function(e){r.notifyObservers(e)})).catch((function(e){if(!i)throw e;i.notifyObservers(e)})),r},Object.defineProperty(e.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),e.prototype.add=function(e,t,i,r,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),e?((e=new Ce(e,t=void 0===t?-1:t,r=void 0===r?null:r)).unregisterOnNextCall=n,i?this._observers.unshift(e):this._observers.push(e),this._onObserverAdded&&this._onObserverAdded(e),e):null},e.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},e.prototype.remove=function(e){return!!e&&-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)},e.prototype.removeCallback=function(e,t){for(var i=0;i<this._observers.length;i++){var r=this._observers[i];if(!(r._willBeUnregistered||r.callback!==e||t&&t!==r.scope))return this._deferUnregister(r),!0}return!1},e.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((function(){t._remove(e)}),0)},e.prototype._remove=function(e){return!!e&&(-1!==(e=this._observers.indexOf(e))&&(this._observers.splice(e,1),!0))},e.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},e.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},e.prototype.notifyObservers=function(e,t,i,r,n){if(!this._observers.length)return!0;var s=this._eventState;s.mask=t=void 0===t?-1:t,s.target=i,s.currentTarget=r,s.skipNextObservers=!1,s.lastReturnValue=e,s.userInfo=n;for(var a=0,o=this._observers;a<o.length;a++){var l=o[a];if(!l._willBeUnregistered&&(l.mask&t&&(l.scope?s.lastReturnValue=l.callback.apply(l.scope,[e,s]):s.lastReturnValue=l.callback(e,s),l.unregisterOnNextCall&&this._deferUnregister(l)),s.skipNextObservers))return!1}return!0},e.prototype.notifyObserversWithPromise=function(e,t,i,r,n){var s=this,a=(void 0===t&&(t=-1),Promise.resolve(e));if(!this._observers.length)return a;var o=this._eventState;return o.mask=t,o.target=i,o.currentTarget=r,o.skipNextObservers=!1,o.userInfo=n,this._observers.forEach((function(i){o.skipNextObservers||i._willBeUnregistered||i.mask&t&&(a=i.scope?a.then((function(t){return o.lastReturnValue=t,i.callback.apply(i.scope,[e,o])})):a.then((function(t){return o.lastReturnValue=t,i.callback(e,o)})),i.unregisterOnNextCall&&s._deferUnregister(i))})),a.then((function(){return e}))},e.prototype.notifyObserver=function(e,t,i){var r;void 0===i&&(i=-1),e._willBeUnregistered||((r=this._eventState).mask=i,r.skipNextObservers=!1,e.callback(t,r),e.unregisterOnNextCall&&this._deferUnregister(e))},e.prototype.hasObservers=function(){return 0<this._observers.length},e.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},e.prototype.clone=function(){var t=new e;return t._observers=this._observers.slice(0),t},e.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,i=this._observers;t<i.length;t++){var r=i[t];if(r.mask&e||r.mask===e)return!0}return!1},e}();function Se(){return"undefined"!=typeof window}function Te(){return"undefined"!=typeof navigator}function Pe(){return"undefined"!=typeof document}function Ae(e){for(var t="",i=e.firstChild;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t}var Re={IsWindowObjectExist:Se,IsNavigatorAvailable:Te,IsDocumentAvailable:Pe,GetDOMTextContent:Ae},Me=function(){function e(){}return e._CheckLimit=function(t,i){var r=e._LogLimitOutputs[t];return r?r.current++:e._LogLimitOutputs[t]=r={limit:i,current:1},r.current<=r.limit},e._GenerateLimitMessage=function(t,i){var r=e._LogLimitOutputs[t];if(r&&e.MessageLimitReached&&r.current===r.limit)switch(i){case 0:e.Log(e.MessageLimitReached.replace(/%LIMIT%/g,""+r.limit).replace(/%TYPE%/g,"log"));break;case 1:e.Warn(e.MessageLimitReached.replace(/%LIMIT%/g,""+r.limit).replace(/%TYPE%/g,"warning"));break;case 2:e.Error(e.MessageLimitReached.replace(/%LIMIT%/g,""+r.limit).replace(/%TYPE%/g,"error"))}},e._AddLogEntry=function(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)},e._FormatMessage=function(e){function t(e){return e<10?"0"+e:""+e}var i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e},e._LogDisabled=function(e,t){},e._LogEnabled=function(t,i){void 0!==i&&!e._CheckLimit(t,i)||(i=e._FormatMessage(t),e._AddLogEntry("<div style='color:white'>"+i+"</div><br>"),e._GenerateLimitMessage(t,0))},e._WarnDisabled=function(e,t){},e._WarnEnabled=function(t,i){void 0!==i&&!e._CheckLimit(t,i)||(i=e._FormatMessage(t),e._AddLogEntry("<div style='color:orange'>"+t+"</div><br>"),e._GenerateLimitMessage(t,1))},e._ErrorDisabled=function(e,t){},e._ErrorEnabled=function(t,i){void 0!==i&&!e._CheckLimit(t,i)||(i=e._FormatMessage(t),e.errorsCount++,e._AddLogEntry("<div style='color:red'>"+i+"</div><br>"),e._GenerateLimitMessage(t,2))},Object.defineProperty(e,"LogCache",{get:function(){return e._LogCache},enumerable:!1,configurable:!0}),e.ClearLogCache=function(){e._LogCache="",e._LogLimitOutputs={},e.errorsCount=0},Object.defineProperty(e,"LogLevels",{set:function(t){e.Log=(t&e.MessageLogLevel)===e.MessageLogLevel?e._LogEnabled:e._LogDisabled,e.Warn=(t&e.WarningLogLevel)===e.WarningLogLevel?e._WarnEnabled:e._WarnDisabled,e.Error=(t&e.ErrorLogLevel)===e.ErrorLogLevel?e._ErrorEnabled:e._ErrorDisabled},enumerable:!1,configurable:!0}),e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",e._LogCache="",e._LogLimitOutputs={},e.errorsCount=0,e.Log=e._LogEnabled,e.Warn=e._WarnEnabled,e.Error=e._ErrorEnabled,e}(),Oe=function(e,t){return!e||e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&"SubMesh"===e.getClassName()?e.clone(t):e.clone?e.clone():null};var Ie=function(){function e(){}return e.DeepCopy=function(e,t,i,r){for(var n=0,s=function(e){for(var t=[];Object.getOwnPropertyNames(e).forEach((function(e){-1===t.indexOf(e)&&t.push(e)})),e=Object.getPrototypeOf(e););return t}(e);n<s.length;n++){var a=s[n];if(("_"!==a[0]||r&&-1!==r.indexOf(a))&&!(a.endsWith("Observable")||i&&-1!==i.indexOf(a))){var o=e[a],l=typeof o;if("function"!=l)try{if("object"==l)if(o instanceof Array){if(t[a]=[],0<o.length)if("object"==typeof o[0])for(var h=0;h<o.length;h++){var c=Oe(o[h],t);-1===t[a].indexOf(c)&&t[a].push(c)}else t[a]=o.slice(0)}else t[a]=Oe(o,t);else t[a]=o}catch(e){Me.Warn(e.message)}}}},e}(),De=function(){function e(){}return Object.defineProperty(e,"Now",{get:function(){return(Re.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance:Date).now()},enumerable:!1,configurable:!0}),e}();function Fe(e){return"".concat(e," needs to be imported before as it contains a side-effect required by your code.")}var Le,ke,Be=function(){function e(){this._xhr=new("undefined"!=typeof _native&&_native.XMLHttpRequest?_native.XMLHttpRequest:XMLHttpRequest),this._requestURL=""}return e.prototype._injectCustomRequestHeaders=function(){if(!this._shouldSkipRequestModifications(this._requestURL))for(var t in e.CustomRequestHeaders){var i=e.CustomRequestHeaders[t];i&&this._xhr.setRequestHeader(t,i)}},e.prototype._shouldSkipRequestModifications=function(t){return e.SkipRequestModificationForBabylonCDN&&(t.includes("preview.babylonjs.com")||t.includes("cdn.babylonjs.com"))},Object.defineProperty(e.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeout",{get:function(){return this._xhr.timeout},set:function(e){this._xhr.timeout=e},enumerable:!1,configurable:!0}),e.prototype.addEventListener=function(e,t,i){this._xhr.addEventListener(e,t,i)},e.prototype.removeEventListener=function(e,t,i){this._xhr.removeEventListener(e,t,i)},e.prototype.abort=function(){this._xhr.abort()},e.prototype.send=function(t){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)},e.prototype.open=function(t,i){for(var r=0,n=e.CustomRequestModifiers;r<n.length;r++){var s=n[r];if(this._shouldSkipRequestModifications(i))return;s(this._xhr,i)}return i=(i=i.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=i,this._xhr.open(t,i,!0)},e.prototype.setRequestHeader=function(e,t){this._xhr.setRequestHeader(e,t)},e.prototype.getResponseHeader=function(e){return this._xhr.getResponseHeader(e)},e.CustomRequestHeaders={},e.CustomRequestModifiers=new Array,e.SkipRequestModificationForBabylonCDN=!0,e}(),Ne=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),e.Instances=new Array,e._LastCreatedScene=null,e.UseFallbackTexture=!0,e.FallbackTexture="",e}(),ze=function(){function e(){}return e.FilesToLoad={},e}(),Ue=function(){function e(){}return e.ExponentialBackoff=function(e,t){return void 0===e&&(e=3),void 0===t&&(t=500),function(i,r,n){return 0!==r.status||e<=n||-1!==i.indexOf("file:")?-1:Math.pow(2,n)*t}},e}(),Ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t._setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t}(Error),je=4e3,Ve=4001,Ze=4002,We=function(e){function t(i,r,n){return(i=e.call(this,i)||this).errorCode=r,i.innerError=n,i.name="RuntimeError",Ge._setPrototypeOf(i,t.prototype),i}return c(t,e),t}(Ge),He=function(e){return atob(e)},Ke=function(){function e(){this.children=[]}return e.prototype.isValid=function(e){return!0},e.prototype.process=function(e,t){var i,r,n="";return this.line&&(i=this.line,(r=t.processor)&&(r.lineProcessor&&(i=r.lineProcessor(i,t.isFragment,t.processingContext)),r.attributeProcessor&&this.line.startsWith("attribute")?i=r.attributeProcessor(this.line,e,t.processingContext):r.varyingProcessor&&this.line.startsWith("varying")?i=r.varyingProcessor(this.line,t.isFragment,e,t.processingContext):r.uniformProcessor&&r.uniformRegexp&&r.uniformRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(i=r.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):r.uniformBufferProcessor&&r.uniformBufferRegexp&&r.uniformBufferRegexp.test(this.line)?t.lookForClosingBracketForUniformBuffer||(i=r.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0):r.textureProcessor&&r.textureRegexp&&r.textureRegexp.test(this.line)?i=r.textureProcessor(this.line,t.isFragment,e,t.processingContext):(r.uniformProcessor||r.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?r.uniformProcessor&&(i=r.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):r.uniformBufferProcessor&&(i=r.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)),t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,r.endOfUniformBufferProcessor&&(i=r.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))),n+=i+"\r\n"),this.children.forEach((function(i){n+=i.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),n},e}(),qe=function(){function e(){}return Object.defineProperty(e.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,i=e;t<i.length;t++){var r=i[t];if("#"===r[0])this._lines.push(r);else if(r.trim().startsWith("//"))this._lines.push(r);else for(var n=r.split(";"),s=0;s<n.length;s++){var a=n[s];(a=a.trim())&&this._lines.push(a+(s!==n.length-1?";":""))}}},enumerable:!1,configurable:!0}),e}(),Xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.process=function(e,t){for(var i=0;i<this.children.length;i++){var r=this.children[i];if(r.isValid(e))return r.process(e,t)}return""},t}(Ke),Ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.isValid=function(e){return this.testExpression.isTrue(e)},t}(Ke),Qe=function(){function e(){}return e.prototype.isTrue=function(e){return!0},e.postfixToInfix=function(t){for(var i=[],r=0,n=t;r<n.length;r++){var s,a,o=n[r];void 0===e._OperatorPriority[o]?i.push(o):(s=i[i.length-1],a=i[i.length-2],i.length-=2,i.push("(".concat(a).concat(o).concat(s,")")))}return i[i.length-1]},e.infixToPostfix=function(t){function i(){""!==(h=h.trim())&&(a.push(h),h="")}function r(t){o<e._Stack.length-1&&(e._Stack[++o]=t)}function n(){return e._Stack[o]}function s(){return-1===o?"!!INVALID EXPRESSION!!":e._Stack[o--]}for(var a=[],o=-1,l=0,h="";l<t.length;){var c=t.charAt(l),u=l<t.length-1?t.substr(l,2):"";if("("===c)h="",r(c);else if(")"===c){for(i();-1!==o&&"("!==n();)a.push(s());s()}else if(1<e._OperatorPriority[u]){for(i();-1!==o&&e._OperatorPriority[n()]>=e._OperatorPriority[u];)a.push(s());r(u),l++}else h+=c;l++}for(i();-1!==o;)"("===n()?s():a.push(s());return a},e._OperatorPriority={")":0,"(":1,"||":2,"&&":3},e._Stack=["","","","","","","","","","","","","","","","","","","",""],e}(),$e=function(e){function t(t,i){void 0===i&&(i=!1);var r=e.call(this)||this;return r.define=t,r.not=i,r}return c(t,e),t.prototype.isTrue=function(e){return e=void 0!==e[this.define],this.not?!e:e},t}(Qe),Je=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)},t}(Qe),et=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)},t}(Qe),tt=function(e){function t(t,i,r){var n=e.call(this)||this;return n.define=t,n.operand=i,n.testValue=r,n}return c(t,e),t.prototype.isTrue=function(e){var t=(void 0===(e=e[this.define])&&(e=this.define),!1),i=parseInt(e),r=parseInt(this.testValue);switch(this.operand){case">":t=r<i;break;case"<":t=i<r;break;case"<=":t=i<=r;break;case">=":t=r<=i;break;case"==":t=i===r}return t},t}(Qe),it=(function(e){e[e.GLSL=0]="GLSL",e[e.WGSL=1]="WGSL"}(Le=Le||{}),/defined\s*?\((.+?)\)/g),rt=/defined\s*?\[(.+?)\]/g,nt=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,st=function(){function e(){}return e.Initialize=function(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)},e.Process=function(e,t,i,r){var n,s=this;null!=(n=t.processor)&&n.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,(function(e){t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e)),e=s._ProcessShaderConversion(e,t,r),i(e)}))},e.PreProcess=function(e,t,i,r){var n,s=this;null!=(n=t.processor)&&n.preProcessShaderCode&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,(function(e){t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e)),e=s._ApplyPreProcessing(e,t,r),i(e)}))},e.Finalize=function(e,t,i){return i.processor&&i.processor.finalizeShaders?i.processor.finalizeShaders(e,t,i.processingContext):{vertexCode:e,fragmentCode:t}},e._ProcessPrecision=function(e,t){if(null!=(i=t.processor)&&i.noPrecision)return e;var i=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=i?"precision highp float;\n"+e:"precision mediump float;\n"+e:i||(e=e.replace("precision highp float","precision mediump float")),e},e._ExtractOperation=function(e){if((s=/defined\((.+)\)/.exec(e))&&s.length)return new $e(s[1].trim(),"!"===e[0]);for(var t="",i=0,r=0,n=["==",">=","<=","<",">"];r<n.length&&!(-1<(i=e.indexOf(t=n[r])));r++);if(-1===i)return new $e(e);var s=e.substring(0,i).trim(),a=e.substring(i+t.length).trim();return new tt(s,t,a)},e._BuildSubExpression=function(e){e=e.replace(it,"defined[$1]");for(var t=[],i=0,r=Qe.infixToPostfix(e);i<r.length;i++){var n,s,a=r[i];"||"!==a&&"&&"!==a?t.push(a):2<=t.length&&(n=t[t.length-1],s=t[t.length-2],t.length-=2,a=new("&&"==a?et:Je),"string"==typeof n&&(n=n.replace(rt,"defined($1)")),"string"==typeof s&&(s=s.replace(rt,"defined($1)")),a.leftOperand="string"==typeof s?this._ExtractOperation(s):s,a.rightOperand="string"==typeof n?this._ExtractOperation(n):n,t.push(a))}return"string"==typeof(e="string"==typeof(e=t[t.length-1])?e.replace(rt,"defined($1)"):e)?this._ExtractOperation(e):e},e._BuildExpression=function(e,t){var i=new Ye,r=e.substring(0,t);e=(e=e.substring(t)).substring(0,(e.indexOf("//")+1||e.length+1)-1).trim();return i.testExpression="#ifdef"===r?new $e(e):"#ifndef"===r?new $e(e,!0):this._BuildSubExpression(e),i},e._MoveCursorWithinIf=function(e,t,i){for(var r=e.currentLine;this._MoveCursor(e,i);){var n,s=(r=e.currentLine).substring(0,5).toLowerCase();if("#else"===s)return n=new Ke,t.children.push(n),void this._MoveCursor(e,n);"#elif"===s&&(n=this._BuildExpression(r,5),t.children.push(n),i=n)}},e._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var i,r,n=e.currentLine;if((r=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(n))&&r.length)switch(r[0]){case"#ifdef":var s=new Xe,a=(t.children.push(s),this._BuildExpression(n,6));s.children.push(a),this._MoveCursorWithinIf(e,s,a);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":s=new Xe,t.children.push(s),a=this._BuildExpression(n,7),s.children.push(a),this._MoveCursorWithinIf(e,s,a);break;case"#if":s=new Xe,a=this._BuildExpression(n,3),t.children.push(s),s.children.push(a),this._MoveCursorWithinIf(e,s,a)}else(r=new Ke).line=n,t.children.push(r),"#"===n[0]&&"d"===n[1]&&(i=n.replace(";","").split(" "),r.additionalDefineKey=i[1],3===i.length&&(r.additionalDefineValue=i[2]))}return!1},e._EvaluatePreProcessors=function(e,t,i){var r=new Ke,n=new qe;return n.lineIndex=-1,n.lines=e.split("\n"),this._MoveCursor(n,r),r.process(t,i)},e._PreparePreProcessors=function(e,t){for(var i,r={},n=0,s=e.defines;n<s.length;n++){var a=s[n].replace("#define","").replace(";","").trim().split(" ");r[a[0]]=1<a.length?a[1]:""}return(null==(i=e.processor)?void 0:i.shaderLanguage)===Le.GLSL&&(r.GL_ES="true"),r.__VERSION__=e.version,r[e.platformName]="true",t._getGlobalDefines(r),r},e._ProcessShaderConversion=function(e,t,i){if(e=this._ProcessPrecision(e,t),!t.processor)return e;if(t.processor.shaderLanguage===Le.GLSL&&-1!==e.indexOf("#version 3"))return e.replace("#version 300 es","");var r=t.defines,n=this._PreparePreProcessors(t,i);return t.processor.preProcessor&&(e=t.processor.preProcessor(e,r,t.isFragment,t.processingContext)),e=this._EvaluatePreProcessors(e,n,t),t.processor.postProcessor&&(e=t.processor.postProcessor(e,r,t.isFragment,t.processingContext,i)),i._features.needShaderCodeInlining?i.inlineShaderCode(e):e},e._ApplyPreProcessing=function(e,t,i){var r,n=t.defines,s=this._PreparePreProcessors(t,i);return null!=(r=t.processor)&&r.preProcessor&&(e=t.processor.preProcessor(e,n,t.isFragment,t.processingContext)),e=this._EvaluatePreProcessors(e,s,t),null!=(r=t.processor)&&r.postProcessor&&(e=t.processor.postProcessor(e,n,t.isFragment,t.processingContext,i)),i._features.needShaderCodeInlining?i.inlineShaderCode(e):e},e._ProcessIncludes=function(t,i,r){for(var n=this,s=nt.exec(t),a=new String(t),o=!1;null!=s;){var l=function(){var l=s[1];if(-1!==l.indexOf("__decl__")&&(l=l.replace(/__decl__/,""),i.supportsUniformBuffers&&(l=(l=l.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),l+="Declaration"),!i.includesShadersStore[l])return f=i.shadersRepository+"ShadersInclude/"+l+".fx",e._FileToolsLoadFile(f,(function(e){i.includesShadersStore[l]=e,n._ProcessIncludes(a,i,r)})),{value:void 0};var h=i.includesShadersStore[l];if(s[2])for(var c=s[3].split(","),u=0;u<c.length;u+=2){var d=new RegExp(c[u],"g"),p=c[u+1];h=h.replace(d,p)}if(s[4]){var f=s[5];if(-1!==f.indexOf("..")){var m=f.split(".."),_=parseInt(m[0]),g=parseInt(m[1]),y=h.slice(0);h="",isNaN(g)&&(g=i.indexParameters[m[1]]);for(var v=_;v<g;v++)h+=(y=i.supportsUniformBuffers?y:y.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))).replace(/\{X\}/g,v.toString())+"\n"}else h=(h=i.supportsUniformBuffers?h:h.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))).replace(/\{X\}/g,f)}a=a.replace(s[0],h),o=o||0<=h.indexOf("#include<")||0<=h.indexOf("#include <"),s=nt.exec(t)}();if("object"==typeof l)return l.value}o?this._ProcessIncludes(a.toString(),i,r):r(a)},e._FileToolsLoadFile=function(e,t,i,r,n,s){throw Fe("FileTools")},e}(),at=function(){function e(){}return e.GetShadersRepository=function(t){return(t=void 0===t?Le.GLSL:t)===Le.GLSL?e.ShadersRepository:e.ShadersRepositoryWGSL},e.GetShadersStore=function(t){return(t=void 0===t?Le.GLSL:t)===Le.GLSL?e.ShadersStore:e.ShadersStoreWGSL},e.GetIncludesShadersStore=function(t){return(t=void 0===t?Le.GLSL:t)===Le.GLSL?e.IncludesShadersStore:e.IncludesShadersStoreWGSL},e.ShadersRepository="src/Shaders/",e.ShadersStore={},e.IncludesShadersStore={},e.ShadersRepositoryWGSL="src/ShadersWGSL/",e.ShadersStoreWGSL={},e.IncludesShadersStoreWGSL={},e}(),ot=function(){function e(t,i,r,n,s,a,o,l,h,c,u,d){void 0===n&&(n=null),void 0===a&&(a=null),void 0===o&&(o=null),void 0===l&&(l=null),void 0===h&&(h=null),void 0===u&&(u=""),void 0===d&&(d=Le.GLSL);var p=this,f=(u=(this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new we,this.onErrorObservable=new we,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._isDisposed=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this.name=t,void(this._key=u)),null);if(i.attributes){var m=i;if(this._engine=r,this._attributesNames=m.attributes,this._uniformsNames=m.uniformsNames.concat(m.samplers),this._samplerList=m.samplers.slice(),this.defines=m.defines,this.onError=m.onError,this.onCompiled=m.onCompiled,this._fallbacks=m.fallbacks,this._indexParameters=m.indexParameters,this._transformFeedbackVaryings=m.transformFeedbackVaryings||null,this._multiTarget=!!m.multiTarget,this._shaderLanguage=null!=(y=m.shaderLanguage)?y:Le.GLSL,m.uniformBuffersNames){this._uniformBuffersNamesList=m.uniformBuffersNames.slice();for(var _=0;_<m.uniformBuffersNames.length;_++)this._uniformBuffersNames[m.uniformBuffersNames[_]]=_}f=null!=(y=m.processFinalCode)?y:null,u=null!=(y=m.processCodeAfterIncludes)?y:void 0}else this._engine=s,this.defines=null==a?"":a,this._uniformsNames=r.concat(n),this._samplerList=n?n.slice():[],this._attributesNames=i,this._uniformBuffersNamesList=[],this._shaderLanguage=d,this.onError=h,this.onCompiled=l,this._indexParameters=c,this._fallbacks=o;function g(){var e,i;x[0]&&x[1]&&(E.isFragment=!0,e=x[0],i=x[1],st.Process(i,E,(function(i){f&&(i=f("fragment",i)),i=st.Finalize(e,i,E),p._useFinalCode(i.vertexCode,i.fragmentCode,t)}),p._engine))}this._attributeLocationByName={},this.uniqueId=e._UniqueIdSeed++;var y=Se()?this._engine.getHostDocument():null,v=t.vertexSource?"source:"+t.vertexSource:t.vertexElement?(v=y?y.getElementById(t.vertexElement):null)||t.vertexElement:t.vertex||t,b=t.fragmentSource?"source:"+t.fragmentSource:t.fragmentElement?(b=y?y.getElementById(t.fragmentElement):null)||t.fragmentElement:t.fragment||t,E=(this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage),{defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:at.GetShadersRepository(this._shaderLanguage),includesShadersStore:at.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:u}),x=[void 0,void 0];this._loadShader(v,"Vertex","",(function(e){st.Initialize(E),st.Process(e,E,(function(t){p._rawVertexSourceCode=e,f&&(t=f("vertex",t)),x[0]=t,g()}),p._engine)})),this._loadShader(b,"Fragment","Pixel",(function(e){p._rawFragmentSourceCode=e,x[1]=e,g()}))}return Object.defineProperty(e,"ShadersRepository",{get:function(){return at.ShadersRepository},set:function(e){at.ShadersRepository=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new we),this._onBindObservable},enumerable:!1,configurable:!0}),e.prototype._useFinalCode=function(e,t,i){var r;i?(r=i.vertexElement||i.vertex||i.spectorName||i,i=i.fragmentElement||i.fragment||i.spectorName||i,this._vertexSourceCode=(this._shaderLanguage===Le.WGSL?"//":"")+"#define SHADER_NAME vertex:"+r+"\n"+e,this._fragmentSourceCode=(this._shaderLanguage===Le.WGSL?"//":"")+"#define SHADER_NAME fragment:"+i+"\n"+t):(this._vertexSourceCode=e,this._fragmentSourceCode=t),this._prepareEffect()},Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),e.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},e.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},e.prototype.getEngine=function(){return this._engine},e.prototype.getPipelineContext=function(){return this._pipelineContext},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(e){return this._attributes[e]},e.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},e.prototype.getAttributesCount=function(){return this._attributes.length},e.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},e.prototype.getUniform=function(e){return this._uniforms[e]},e.prototype.getSamplers=function(){return this._samplerList},e.prototype.getUniformNames=function(){return this._uniformsNames},e.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},e.prototype.getIndexParameters=function(){return this._indexParameters},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},e.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add((function(t){e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){t._checkIsReady(null)}),16))},e.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(t){return void this._processCompilationErrors(t,e)}this._isDisposed||setTimeout((function(){t._checkIsReady(e)}),16)},e.prototype._loadShader=function(e,t,i,r){var n;"undefined"!=typeof HTMLElement&&e instanceof HTMLElement?r(Ae(e)):"source:"===e.substr(0,7)?r(e.substr(7)):"base64:"===e.substr(0,7)?r(window.atob(e.substr(7))):(n=at.GetShadersStore(this._shaderLanguage))[e+t+"Shader"]?r(n[e+t+"Shader"]):i&&n[e+i+"Shader"]?r(n[e+i+"Shader"]):(n="."===e[0]||"/"===e[0]||-1<e.indexOf("http")?e:at.GetShadersRepository(this._shaderLanguage)+e,this._engine._loadFile(n+"."+t.toLowerCase()+".fx",r))},Object.defineProperty(e.prototype,"vertexSourceCode",{get:function(){var e;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!=(e=null==(e=this._pipelineContext)?void 0:e._getVertexShaderCode())?e:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fragmentSourceCode",{get:function(){var e;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!=(e=null==(e=this._pipelineContext)?void 0:e._getFragmentShaderCode())?e:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),e.prototype._rebuildProgram=function(e,t,i,r){var n=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){r&&r(t)},this.onCompiled=function(){var e=n.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);n._pipelineContext._handlesSpectorRebuildCallback(i)},this._fallbacks=null,this._prepareEffect()},e.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,i=this.defines,r=this._pipelineContext;this._isReady=!1;try{var n=this._engine,s=(this._pipelineContext=n.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key,this._rebuildProgram.bind(this));this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?n._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,s,null,this._transformFeedbackVaryings,this._key):n._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,s,i,this._transformFeedbackVaryings,this._key),n._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(e._attributes=[],e._pipelineContext._fillEffectInformation(e,e._uniformBuffersNames,e._uniformsNames,e._uniforms,e._samplerList,e._samplers,t,e._attributes),t)for(var i=0;i<t.length;i++){var s=t[i];e._attributeLocationByName[s]=e._attributes[i]}n.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),r&&e.getEngine()._deletePipelineContext(r)})),this._pipelineContext.isAsync&&this._checkIsReady(r)}catch(i){this._processCompilationErrors(i,r)}},e.prototype._getShaderCodeAndErrorLine=function(e,t,i){var r,n=null;return t&&e&&(t=t.match(i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/))&&2===t.length&&(t=parseInt(t[1]),(r=e.split("\n",-1)).length>=t&&(n="Offending line [".concat(t,"] in ").concat(i?"fragment":"vertex"," code: ").concat(r[t-1]))),[e,n]},e.prototype._processCompilationErrors=function(t,i){void 0===i&&(i=null),this._compilationError=t.message;t=this._attributesNames;var r,n,s,a=this._fallbacks;Me.Error("Unable to compile effect:"),Me.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),Me.Error("Attributes: "+t.map((function(e){return" "+e}))),Me.Error("Defines:\r\n"+this.defines),e.LogShaderCodeOnCompilationError&&((s=n=t=null)!=(r=this._pipelineContext)&&r._getVertexShaderCode()&&(s=(r=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],t=r[1],s&&(Me.Error("Vertex code:"),Me.Error(s))),null!=(r=this._pipelineContext)&&r._getFragmentShaderCode()&&(s=(r=this._getShaderCodeAndErrorLine(null==(r=this._pipelineContext)?void 0:r._getFragmentShaderCode(),this._compilationError,!0))[0],n=r[1],s&&(Me.Error("Fragment code:"),Me.Error(s))),t&&Me.Error(t),n&&Me.Error(n)),Me.Error("Error: "+this._compilationError),i&&(this._pipelineContext=i,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),a?(this._pipelineContext=null,a.hasMoreFallbacks?(this._allFallbacksProcessed=!1,Me.Error("Trying next fallback."),this.defines=a.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!1,configurable:!0}),e.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t,e)},e.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)},e.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)},e.prototype.setTextureArray=function(e,t){var i=e+"Ex";if(-1===this._samplerList.indexOf(i+"0")){for(var r=this._samplerList.indexOf(e),n=1;n<t.length;n++){var s=i+(n-1).toString();this._samplerList.splice(r+n,0,s)}for(var a=0,o=0,l=this._samplerList;o<l.length;o++){var h=l[o];this._samplers[h]=a,a+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)},e.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)},e.prototype.bindUniformBuffer=function(t,i){var r=this._uniformBuffersNames[i];void 0===r||e._BaseCache[r]===t&&this._engine._features.useUBOBindingCache||(e._BaseCache[r]=t,this._engine.bindUniformBufferBase(t,r,i))},e.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},e.prototype.setInt=function(e,t){return this._pipelineContext.setInt(e,t),this},e.prototype.setInt2=function(e,t,i){return this._pipelineContext.setInt2(e,t,i),this},e.prototype.setInt3=function(e,t,i,r){return this._pipelineContext.setInt3(e,t,i,r),this},e.prototype.setInt4=function(e,t,i,r,n){return this._pipelineContext.setInt4(e,t,i,r,n),this},e.prototype.setIntArray=function(e,t){return this._pipelineContext.setIntArray(e,t),this},e.prototype.setIntArray2=function(e,t){return this._pipelineContext.setIntArray2(e,t),this},e.prototype.setIntArray3=function(e,t){return this._pipelineContext.setIntArray3(e,t),this},e.prototype.setIntArray4=function(e,t){return this._pipelineContext.setIntArray4(e,t),this},e.prototype.setFloatArray=function(e,t){return this._pipelineContext.setArray(e,t),this},e.prototype.setFloatArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},e.prototype.setFloatArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},e.prototype.setFloatArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},e.prototype.setArray=function(e,t){return this._pipelineContext.setArray(e,t),this},e.prototype.setArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},e.prototype.setArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},e.prototype.setArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},e.prototype.setMatrices=function(e,t){return this._pipelineContext.setMatrices(e,t),this},e.prototype.setMatrix=function(e,t){return this._pipelineContext.setMatrix(e,t),this},e.prototype.setMatrix3x3=function(e,t){return this._pipelineContext.setMatrix3x3(e,t),this},e.prototype.setMatrix2x2=function(e,t){return this._pipelineContext.setMatrix2x2(e,t),this},e.prototype.setFloat=function(e,t){return this._pipelineContext.setFloat(e,t),this},e.prototype.setBool=function(e,t){return this._pipelineContext.setInt(e,t?1:0),this},e.prototype.setVector2=function(e,t){return this._pipelineContext.setVector2(e,t),this},e.prototype.setFloat2=function(e,t,i){return this._pipelineContext.setFloat2(e,t,i),this},e.prototype.setVector3=function(e,t){return this._pipelineContext.setVector3(e,t),this},e.prototype.setFloat3=function(e,t,i,r){return this._pipelineContext.setFloat3(e,t,i,r),this},e.prototype.setVector4=function(e,t){return this._pipelineContext.setVector4(e,t),this},e.prototype.setQuaternion=function(e,t){return this._pipelineContext.setQuaternion(e,t),this},e.prototype.setFloat4=function(e,t,i,r,n){return this._pipelineContext.setFloat4(e,t,i,r,n),this},e.prototype.setColor3=function(e,t){return this._pipelineContext.setColor3(e,t),this},e.prototype.setColor4=function(e,t,i){return this._pipelineContext.setColor4(e,t,i),this},e.prototype.setDirectColor4=function(e,t){return this._pipelineContext.setDirectColor4(e,t),this},e.prototype.dispose=function(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseEffect(this),this._isDisposed=!0},e.RegisterShader=function(e,t,i,r){void 0===r&&(r=Le.GLSL),t&&(at.GetShadersStore(r)["".concat(e,"PixelShader")]=t),i&&(at.GetShadersStore(r)["".concat(e,"VertexShader")]=i)},e.ResetCache=function(){e._BaseCache={}},e.LogShaderCodeOnCompilationError=!0,e._UniqueIdSeed=0,e._BaseCache={},e.ShadersStore=at.ShadersStore,e.IncludesShadersStore=at.IncludesShadersStore,e}(),lt=function(){function e(e){void 0===e&&(e=!0),this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zOffsetUnits",{get:function(){return this._zOffsetUnits},set:function(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},e}(),ht=function(){function e(){this.reset()}return e.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=e.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=e.KEEP,this.opDepthFail=e.KEEP,this.opStencilDepthPass=e.REPLACE},Object.defineProperty(e.prototype,"stencilFunc",{get:function(){return this.func},set:function(e){this.func=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncRef",{get:function(){return this.funcRef},set:function(e){this.funcRef=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncMask",{get:function(){return this.funcMask},set:function(e){this.funcMask=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilFail",{get:function(){return this.opStencilFail},set:function(e){this.opStencilFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpDepthFail",{get:function(){return this.opDepthFail},set:function(e){this.opDepthFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilDepthPass",{get:function(){return this.opStencilDepthPass},set:function(e){this.opStencilDepthPass=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilMask",{get:function(){return this.mask},set:function(e){this.mask=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilTest",{get:function(){return this.enabled},set:function(e){this.enabled=e},enumerable:!1,configurable:!0}),e.ALWAYS=519,e.KEEP=7680,e.REPLACE=7681,e}(),ct=function(){function e(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.setAlphaBlendConstants=function(e,t,i,r){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===r||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)},e.prototype.setAlphaBlendFunctionParameters=function(e,t,i,r){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===r||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)},e.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},e}(),ut=function(){function e(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}return Object.defineProperty(e.prototype,"wrapU",{get:function(){return this._cachedWrapU},set:function(e){this._cachedWrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapV",{get:function(){return this._cachedWrapV},set:function(e){this._cachedWrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapR",{get:function(){return this._cachedWrapR},set:function(e){this._cachedWrapR=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anisotropicFilteringLevel",{get:function(){return this._cachedAnisotropicFilteringLevel},set:function(e){this._cachedAnisotropicFilteringLevel=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"comparisonFunction",{get:function(){return this._comparisonFunction},set:function(e){this._comparisonFunction=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useMipMaps",{get:function(){return this._useMipMaps},set:function(e){this._useMipMaps=e},enumerable:!1,configurable:!0}),e.prototype.setParameters=function(e,t,i,r,n,s){return void 0===t&&(t=1),void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=2),void 0===s&&(s=0),this._cachedWrapU=e=void 0===e?1:e,this._cachedWrapV=t,this._cachedWrapR=i,this._cachedAnisotropicFilteringLevel=r,this.samplingMode=n,this._comparisonFunction=s,this},e.prototype.compareSampler=function(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps},e}(),dt=(function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.DepthStencil=12]="DepthStencil",e[e.CubeRawRGBD=13]="CubeRawRGBD",e[e.Depth=14]="Depth"}(ke=ke||{}),function(e){function t(i,r,n){void 0===n&&(n=!1);var s=e.call(this)||this;return s.isReady=!1,s.isCube=!1,s.is3D=!1,s.is2DArray=!1,s.isMultiview=!1,s.url="",s.generateMipMaps=!1,s.samples=0,s.type=-1,s.format=-1,s.onLoadedObservable=new we,s.onErrorObservable=new we,s.onRebuildCallback=null,s.width=0,s.height=0,s.depth=0,s.baseWidth=0,s.baseHeight=0,s.baseDepth=0,s.invertY=!1,s._invertVScale=!1,s._associatedChannel=-1,s._source=ke.Unknown,s._buffer=null,s._bufferView=null,s._bufferViewArray=null,s._bufferViewArrayArray=null,s._size=0,s._extension="",s._files=null,s._workingCanvas=null,s._workingContext=null,s._cachedCoordinatesMode=null,s._isDisabled=!1,s._compression=null,s._sphericalPolynomial=null,s._sphericalPolynomialPromise=null,s._sphericalPolynomialComputed=!1,s._lodGenerationScale=0,s._lodGenerationOffset=0,s._useSRGBBuffer=!1,s._lodTextureHigh=null,s._lodTextureMid=null,s._lodTextureLow=null,s._isRGBD=!1,s._linearSpecularLOD=!1,s._irradianceTexture=null,s._hardwareTexture=null,s._maxLodLevel=null,s._references=1,s._gammaSpace=null,s._engine=i,s._source=r,s._uniqueId=t._Counter++,n||(s._hardwareTexture=i._createHardwareTexture()),s}return c(t,e),Object.defineProperty(t.prototype,"useMipMaps",{get:function(){return this.generateMipMaps},set:function(e){this.generateMipMaps=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),t.prototype.getEngine=function(){return this._engine},Object.defineProperty(t.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),t.prototype.incrementReferences=function(){this._references++},t.prototype.updateSize=function(e,t,i){this._engine.updateTextureDimensions(this,e,t,i=void 0===i?1:i),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i},t.prototype._rebuild=function(){var e,t,i,r,n=this;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback)return i=function(e){e._swapAndDie(n,!1),n.isReady=t.isReady},void((t=this.onRebuildCallback(this)).isAsync?t.proxy.then(i):i(t.proxy));switch(this.source){case ke.Temp:break;case ke.Url:return void(r=this._engine.createTexture(null!=(e=this._originalUrl)?e:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){r._swapAndDie(n,!1),n.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case ke.Raw:(r=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,void 0,this._useSRGBBuffer))._swapAndDie(this,!1),this.isReady=!0;break;case ke.Raw3D:(r=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case ke.Raw2DArray:(r=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case ke.Dynamic:(r=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this,!1),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);break;case ke.Cube:return void(r=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){r._swapAndDie(n,!1),n.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer));case ke.CubeRaw:(r=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this,!1),this.isReady=!0;break;case ke.CubeRawRGBD:return;case ke.CubePrefiltered:return void((r=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(e){e&&e._swapAndDie(n,!1),n.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},t.prototype._swapAndDie=function(e,t){void 0===t&&(t=!0),null!=(i=this._hardwareTexture)&&i.setUsage(e._source,this.generateMipMaps,this.isCube,this.width,this.height),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var i=this._engine.getLoadedTexturesCache();-1!==(t=i.indexOf(this))&&i.splice(t,1),-1===(t=i.indexOf(e))&&i.push(e)},t.prototype.dispose=function(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null)},t._Counter=0,t}(ut)),pt=function(){function e(){this.shaderLanguage=Le.GLSL}return e.prototype.postProcessor=function(e,t,i,r,n){return n.getCaps().drawBuffersExtension||(e=e.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")),e},e}(),ft=function(){function e(){this.shaderLanguage=Le.GLSL}return e.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},e.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},e.prototype.postProcessor=function(e,t,i){var r=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),i)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(r?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e},e}(),mt=function(){function e(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=e._Counter++}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),e._Counter=0,e}(),_t=function(e){function t(t){var i=e.call(this)||this;return i._buffer=t,i}return c(t,e),Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),t}(mt),gt=function(){function e(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!1,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},e.prototype._fillEffectInformation=function(e,t,i,r,n,s,a,o){var l,h=this.engine;if(h.supportsUniformBuffers)for(var c in t)e.bindUniformBlock(c,t[c]);for(this.engine.getUniforms(this,i).forEach((function(e,t){r[i[t]]=e})),this._uniforms=r,l=0;l<n.length;l++)null==e.getUniform(n[l])&&(n.splice(l,1),l--);n.forEach((function(e,t){s[e]=t}));for(var u=0,d=h.getAttributes(this,a);u<d.length;u++){var p=d[u];o.push(p)}},e.prototype.dispose=function(){this._uniforms={}},e.prototype._cacheMatrix=function(e,t){var i=this._valueCache[e];t=t.updateFlag;return(void 0===i||i!==t)&&(this._valueCache[e]=t,!0)},e.prototype._cacheFloat2=function(e,t,i){var r=this._valueCache[e];return r&&2===r.length?(e=!1,r[0]!==t&&(r[0]=t,e=!0),r[1]!==i&&(r[1]=i,e=!0),e):(this._valueCache[e]=r=[t,i],!0)},e.prototype._cacheFloat3=function(e,t,i,r){var n=this._valueCache[e];return n&&3===n.length?(e=!1,n[0]!==t&&(n[0]=t,e=!0),n[1]!==i&&(n[1]=i,e=!0),n[2]!==r&&(n[2]=r,e=!0),e):(this._valueCache[e]=n=[t,i,r],!0)},e.prototype._cacheFloat4=function(e,t,i,r,n){var s=this._valueCache[e];return s&&4===s.length?(e=!1,s[0]!==t&&(s[0]=t,e=!0),s[1]!==i&&(s[1]=i,e=!0),s[2]!==r&&(s[2]=r,e=!0),s[3]!==n&&(s[3]=n,e=!0),e):(this._valueCache[e]=s=[t,i,r,n],!0)},e.prototype.setInt=function(e,t){var i=this._valueCache[e];void 0!==i&&i===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)},e.prototype.setInt2=function(e,t,i){!this._cacheFloat2(e,t,i)||this.engine.setInt2(this._uniforms[e],t,i)||(this._valueCache[e]=null)},e.prototype.setInt3=function(e,t,i,r){!this._cacheFloat3(e,t,i,r)||this.engine.setInt3(this._uniforms[e],t,i,r)||(this._valueCache[e]=null)},e.prototype.setInt4=function(e,t,i,r,n){!this._cacheFloat4(e,t,i,r,n)||this.engine.setInt4(this._uniforms[e],t,i,r,n)||(this._valueCache[e]=null)},e.prototype.setIntArray=function(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)},e.prototype.setIntArray2=function(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)},e.prototype.setIntArray3=function(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)},e.prototype.setIntArray4=function(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)},e.prototype.setArray=function(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)},e.prototype.setArray2=function(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)},e.prototype.setArray3=function(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)},e.prototype.setArray4=function(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)},e.prototype.setMatrices=function(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))},e.prototype.setMatrix=function(e,t){!this._cacheMatrix(e,t)||this.engine.setMatrices(this._uniforms[e],t.toArray())||(this._valueCache[e]=null)},e.prototype.setMatrix3x3=function(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)},e.prototype.setMatrix2x2=function(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)},e.prototype.setFloat=function(e,t){var i=this._valueCache[e];void 0!==i&&i===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)},e.prototype.setVector2=function(e,t){!this._cacheFloat2(e,t.x,t.y)||this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null)},e.prototype.setFloat2=function(e,t,i){!this._cacheFloat2(e,t,i)||this.engine.setFloat2(this._uniforms[e],t,i)||(this._valueCache[e]=null)},e.prototype.setVector3=function(e,t){!this._cacheFloat3(e,t.x,t.y,t.z)||this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null)},e.prototype.setFloat3=function(e,t,i,r){!this._cacheFloat3(e,t,i,r)||this.engine.setFloat3(this._uniforms[e],t,i,r)||(this._valueCache[e]=null)},e.prototype.setVector4=function(e,t){!this._cacheFloat4(e,t.x,t.y,t.z,t.w)||this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null)},e.prototype.setQuaternion=function(e,t){!this._cacheFloat4(e,t.x,t.y,t.z,t.w)||this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null)},e.prototype.setFloat4=function(e,t,i,r,n){!this._cacheFloat4(e,t,i,r,n)||this.engine.setFloat4(this._uniforms[e],t,i,r,n)||(this._valueCache[e]=null)},e.prototype.setColor3=function(e,t){!this._cacheFloat3(e,t.r,t.g,t.b)||this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null)},e.prototype.setColor4=function(e,t,i){!this._cacheFloat4(e,t.r,t.g,t.b,i)||this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i)||(this._valueCache[e]=null)},e.prototype.setDirectColor4=function(e,t){!this._cacheFloat4(e,t.r,t.g,t.b,t.a)||this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null)},e.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},e.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},e}(),yt=function(){function e(){}return e.SetMatrixPrecision=function(t){if(e.MatrixTrackPrecisionChange=!1,t&&!e.MatrixUse64Bits&&e.MatrixTrackedMatrices)for(var i=0;i<e.MatrixTrackedMatrices.length;++i){var r=e.MatrixTrackedMatrices[i],n=r._m;r._m=new Array(16);for(var s=0;s<16;++s)r._m[s]=n[s]}e.MatrixCurrentType=(e.MatrixUse64Bits=t)?Array:Float32Array,e.MatrixTrackedMatrices=null},e.MatrixUse64Bits=!1,e.MatrixTrackPrecisionChange=!0,e.MatrixCurrentType=Float32Array,e.MatrixTrackedMatrices=[],e}(),vt=function(){function e(e,t){if(void 0===e&&(e=null),this._MSAARenderBuffer=null,this._context=t,!e&&!(e=t.createTexture()))throw new Error("Unable to create webGL texture");this.set(e)}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return this._webGLTexture},enumerable:!1,configurable:!0}),e.prototype.setUsage=function(){},e.prototype.set=function(e){this._webGLTexture=e},e.prototype.reset=function(){this._webGLTexture=null,this._MSAARenderBuffer=null},e.prototype.release=function(){this._MSAARenderBuffer&&(this._context.deleteRenderbuffer(this._MSAARenderBuffer),this._MSAARenderBuffer=null),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()},e}(),bt=function(){function e(e,t){void 0===t&&(t=!0),this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}return e.IsWrapper=function(e){return void 0===e.getPipelineContext},e.GetEffect=function(e){return void 0===e.getPipelineContext?e.effect:e},e.prototype.setEffect=function(e,t,i){void 0===i&&(i=!0),this.effect=e,void 0!==t&&(this.defines=t),i&&null!=(e=this.drawContext)&&e.reset()},e.prototype.dispose=function(){var e;null!=(e=this.drawContext)&&e.dispose()},e}(),Et=function(){function e(e){void 0===e&&(e=!0),this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"func",{get:function(){return this._func},set:function(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcRef",{get:function(){return this._funcRef},set:function(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcMask",{get:function(){return this._funcMask},set:function(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var e;this.stencilMaterial=void 0,null!=(e=this.stencilGlobal)&&e.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},e.prototype.apply=function(e){var t;e&&(t=!this.useStencilGlobalOnly&&!(null==(t=this.stencilMaterial)||!t.enabled),this.enabled=(t?this.stencilMaterial:this.stencilGlobal).enabled,this.func=(t?this.stencilMaterial:this.stencilGlobal).func,this.funcRef=(t?this.stencilMaterial:this.stencilGlobal).funcRef,this.funcMask=(t?this.stencilMaterial:this.stencilGlobal).funcMask,this.opStencilFail=(t?this.stencilMaterial:this.stencilGlobal).opStencilFail,this.opDepthFail=(t?this.stencilMaterial:this.stencilGlobal).opDepthFail,this.opStencilDepthPass=(t?this.stencilMaterial:this.stencilGlobal).opStencilDepthPass,this.mask=(t?this.stencilMaterial:this.stencilGlobal).mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1)))},e}(),xt=function(){},Ct=function(){function e(t,i,r,n){var s=this,a=(this._name="WebGL",this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=null,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this.disableUniformBuffers=!1,this.onDisposeObservable=new we,this._frameId=0,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new we,this.onContextRestoredObservable=new we,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new lt,this._stencilStateComposer=new Et,this._stencilState=new ht,this._alphaState=new ct,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._renderTargetWrapperCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._activeRequests=new Array,this._adaptToDeviceRatio=!1,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new we,this._isWebGPU=!1,this._snapshotRenderingMode=0,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},null);if(this._creationOptions=r=r||{},this._adaptToDeviceRatio=null!=n&&n,this._stencilStateComposer.stencilGlobal=this._stencilState,yt.SetMatrixPrecision(!!r.useHighPrecisionMatrix),t){if(n=n||r.adaptToDeviceRatio||!1,t.getContext){if(this._renderingCanvas=a=t,void 0!==i&&(r.antialias=i),void 0===r.deterministicLockstep&&(r.deterministicLockstep=!1),void 0===r.lockstepMaxSteps&&(r.lockstepMaxSteps=4),void 0===r.timeStep&&(r.timeStep=1/60),void 0===r.preserveDrawingBuffer&&(r.preserveDrawingBuffer=!1),void 0===r.audioEngine&&(r.audioEngine=!0),void 0!==r.audioEngineOptions&&void 0!==r.audioEngineOptions.audioContext&&(this._audioContext=r.audioEngineOptions.audioContext),void 0!==r.audioEngineOptions&&void 0!==r.audioEngineOptions.audioDestination&&(this._audioDestination=r.audioEngineOptions.audioDestination),void 0===r.stencil&&(r.stencil=!0),!1===r.premultipliedAlpha&&(this.premultipliedAlpha=!1),void 0===r.xrCompatible&&(r.xrCompatible=!0),this._doNotHandleContextLost=!!r.doNotHandleContextLost,navigator&&navigator.userAgent){this._checkForMobile=function(){var e=navigator.userAgent;s.hostInformation.isMobile=-1!==e.indexOf("Mobile")||-1!==e.indexOf("Mac")&&Pe()&&"ontouchend"in document},this._checkForMobile(),Se()&&window.addEventListener("resize",this._checkForMobile);for(var o=navigator.userAgent,l=0,h=e.ExceptionList;l<h.length;l++){var c=h[l],u=c.key,d=c.targets;if(new RegExp(u).test(o)){if(c.capture&&c.captureConstraint&&(u=c.capture,c=c.captureConstraint,(u=new RegExp(u).exec(o))&&0<u.length&&c<=parseInt(u[u.length-1])))continue;for(var p=0,f=d;p<f.length;p++)switch(f[p]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":r.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),s._contextWasLost=!0,Me.Warn("WebGL context lost."),s.onContextLostObservable.notifyObservers(s)},this._onContextRestored=function(){s._restoreEngineAfterContextLost(s._initGLContext.bind(s))},a.addEventListener("webglcontextlost",this._onContextLost,!1),a.addEventListener("webglcontextrestored",this._onContextRestored,!1),r.powerPreference="high-performance"),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._badDesktopOS&&(r.xrCompatible=!1),!r.disableWebGL2Support)try{this._gl=a.getContext("webgl2",r)||a.getContext("experimental-webgl2",r),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(t){}if(!this._gl){if(!a)throw new Error("The provided canvas is null or undefined.");try{this._gl=a.getContext("webgl",r)||a.getContext("experimental-webgl",r)}catch(t){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1",(i=this._gl.getContextAttributes())&&(r.stencil=i.stencil);this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==r.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=r.useHighPrecisionFloats),a=Se()&&window.devicePixelRatio||1,t=r.limitDeviceRatio||a,this._hardwareScalingLevel=n?1/Math.min(t,a):1,this.resize(),this._isStencilEnable=!!r.stencil,this._initGLContext(),this._initFeatures();for(var m=0;m<this._caps.maxVertexAttribs;m++)this._currentBufferPointers[m]=new xt;this._shaderProcessor=new(1<this.webGLVersion?ft:pt),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),i="Babylon.js v".concat(e.Version),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",i)}}return Object.defineProperty(e,"NpmPackage",{get:function(){return"babylonjs@5.11.0"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return"5.11.0"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){var e=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ShadersRepository",{get:function(){return ot.ShadersRepository},set:function(e){ot.ShadersRepository=e},enumerable:!1,configurable:!0}),e.prototype._getShaderProcessor=function(e){return this._shaderProcessor},Object.defineProperty(e.prototype,"useReverseDepthBuffer",{get:function(){return this._useReverseDepthBuffer},set:function(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,this._depthCullingState.depthFunc=e?518:515)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameId",{get:function(){return this._frameId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsUniformBuffers",{get:function(){return 1<this.webGLVersion&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),e.prototype.getCreationOptions=function(){return this._creationOptions},Object.defineProperty(e.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeRenderLoops",{get:function(){return this._activeRenderLoops},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyCubeTexture",{get:function(){var e;return this._emptyCubeTexture||(e=new Uint8Array(4),this._emptyCubeTexture=this.createRawCubeTexture([e,e,e,e,e,e],1,5,0,!1,!1,1)),this._emptyCubeTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isWebGPU",{get:function(){return this._isWebGPU},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shaderPlatformName",{get:function(){return this._shaderPlatformName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"snapshotRendering",{get:function(){return!1},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"snapshotRenderingMode",{get:function(){return this._snapshotRenderingMode},set:function(e){this._snapshotRenderingMode=e},enumerable:!1,configurable:!0}),e.prototype.snapshotRenderingReset=function(){this.snapshotRendering=!1},e._CreateCanvas=function(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);var i=document.createElement("canvas");return i.width=e,i.height=t,i},e.prototype.createCanvas=function(t,i){return e._CreateCanvas(t,i)},e.prototype.createCanvasImage=function(){return document.createElement("img")},e.prototype._restoreEngineAfterContextLost=function(e){var t=this;setTimeout((function(){return v(t,void 0,void 0,(function(){var t,i,r,n,s;return b(this,(function(a){switch(a.label){case 0:return this._dummyFramebuffer=null,t=this._depthCullingState.depthTest,i=this._depthCullingState.depthFunc,r=this._depthCullingState.depthMask,n=this._stencilState.stencilTest,[4,e()];case 1:return a.sent(),this._rebuildEffects(),null!=(s=this._rebuildComputeEffects)&&s.call(this),this._rebuildInternalTextures(),this._rebuildRenderTargetWrappers(),this._rebuildBuffers(),this.wipeCaches(!0),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=i,this._depthCullingState.depthMask=r,this._stencilState.stencilTest=n,Me.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1,[2]}}))}))}),0)},e.prototype._sharedInit=function(e,t,i){this._renderingCanvas=e},e.prototype._getShaderProcessingContext=function(e){return null},e.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++)t[e]._rebuild()},e.prototype._rebuildRenderTargetWrappers=function(){for(var e=0,t=this._renderTargetWrapperCache.slice();e<t.length;e++)t[e]._rebuild()},e.prototype._rebuildEffects=function(){for(var e in this._compiledEffects)(e=this._compiledEffects[e])._pipelineContext=null,e._wasPreviouslyReady=!1,e._prepareEffect();ot.ResetCache()},e.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0},e.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++)t[e]._rebuild();for(var i=0,r=this._storageBuffers;i<r.length;i++)r[i]._rebuild()},e.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:1<this._webGLVersion?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:1<this._webGLVersion||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:1<this._webGLVersion||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:1<this._webGLVersion||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:1<this._webGLVersion,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(1<this._webGLVersion&&this._gl.getExtension("EXT_color_buffer_float")),textureFloat:!!(1<this._webGLVersion||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(1<this._webGLVersion||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(1<this._webGLVersion||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:1<this._webGLVersion,canUseGLVertexID:1<this._webGLVersion,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:1<this._webGLVersion,textureMaxLevel:1<this._webGLVersion,texture2DArrayMaxLayerCount:1<this._webGLVersion?256:128},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e,t=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=t&&(this._glRenderer=this._gl.getParameter(t.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(t.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=0<this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(1<this._webGLVersion||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),1<this._webGLVersion&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),1<this._webGLVersion)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{var i=this._gl.getExtension("WEBGL_draw_buffers");if(null!==i){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=i.drawBuffersWEBGL.bind(i),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var r=0;r<16;r++)this._gl["COLOR_ATTACHMENT"+r+"_WEBGL"]=i["COLOR_ATTACHMENT"+r+"_WEBGL"]}}1<this._webGLVersion?this._caps.depthTextureExtension=!0:null!=(t=this._gl.getExtension("WEBGL_depth_texture"))&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=t.UNSIGNED_INT_24_8_WEBGL),this.disableVertexArrayObjects?this._caps.vertexArrayObject=!1:1<this._webGLVersion?this._caps.vertexArrayObject=!0:null!=(t=this._gl.getExtension("OES_vertex_array_object"))&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=t.createVertexArrayOES.bind(t),this._gl.bindVertexArray=t.bindVertexArrayOES.bind(t),this._gl.deleteVertexArray=t.deleteVertexArrayOES.bind(t)),1<this._webGLVersion?this._caps.instancedArrays=!0:null!=(t=this._gl.getExtension("ANGLE_instanced_arrays"))?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=t.drawArraysInstancedANGLE.bind(t),this._gl.drawElementsInstanced=t.drawElementsInstancedANGLE.bind(t),this._gl.vertexAttribDivisor=t.vertexAttribDivisorANGLE.bind(t)):this._caps.instancedArrays=!1,this._gl.getShaderPrecisionFormat&&(t=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),e=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT),t&&e&&(this._caps.highPrecisionShaderSupported=0!==t.precision&&0!==e.precision)),1<this._webGLVersion?this._caps.blendMinMax=!0:null!=(t=this._gl.getExtension("EXT_blend_minmax"))&&(this._caps.blendMinMax=!0,this._gl.MAX=t.MAX_EXT,this._gl.MIN=t.MIN_EXT),this._caps.supportSRGBBuffers||(1<this._webGLVersion?this._caps.supportSRGBBuffers=!0:null!=(e=this._gl.getExtension("EXT_sRGB"))&&(this._caps.supportSRGBBuffers=!0,this._gl.SRGB=e.SRGB_EXT,this._gl.SRGB8=e.SRGB_ALPHA_EXT,this._gl.SRGB8_ALPHA8=e.SRGB_ALPHA_EXT),this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!(!this._creationOptions||!this._creationOptions.forceSRGBBufferSupportState)),this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var n=0;n<this._maxSimultaneousTextures;n++)this._nextFreeTextureSlots.push(n)},e.prototype._initFeatures=function(){this._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,_collectUbosUpdatedInFrame:!1}},Object.defineProperty(e.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(e.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),e.prototype._prepareWorkingCanvas=function(){var e;this._workingCanvas||(this._workingCanvas=this.createCanvas(1,1),(e=this._workingCanvas.getContext("2d"))&&(this._workingContext=e))},e.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},e.prototype.getInfo=function(){return this.getGlInfo()},e.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},e.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},e.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},e.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},e.prototype.getCaps=function(){return this._caps},e.prototype.stopRenderLoop=function(e){e?0<=(e=this._activeRenderLoops.indexOf(e))&&this._activeRenderLoops.splice(e,1):this._activeRenderLoops=[]},e.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(e=!(!this.renderEvenInBackground&&this._windowIsBackground)&&e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++)(0,this._activeRenderLoops[t])();this.endFrame()}}0<this._activeRenderLoops.length?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},e.prototype.getRenderingCanvas=function(){return this._renderingCanvas},e.prototype.getAudioContext=function(){return this._audioContext},e.prototype.getAudioDestination=function(){return this._audioDestination},e.prototype.getHostWindow=function(){return Se()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},e.prototype.getRenderWidth=function(e){return!(e=void 0!==e&&e)&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},e.prototype.getRenderHeight=function(e){return!(e=void 0!==e&&e)&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},e.prototype._queueNewFrame=function(t,i){return e.QueueNewFrame(t,i)},e.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},e.prototype.clear=function(e,t,i,r){void 0===r&&(r=!1);var n=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=n,n=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT),i&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),r&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)},e.prototype._viewport=function(e,t,i,r){e===this._viewportCached.x&&t===this._viewportCached.y&&i===this._viewportCached.z&&r===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=r,this._gl.viewport(e,t,i,r))},e.prototype.setViewport=function(e,t,i){t=t||this.getRenderWidth(),i=i||this.getRenderHeight();var r=e.x||0,n=e.y||0;this._cachedViewport=e,this._viewport(r*t,n*i,t*e.width,i*e.height)},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._frameId++},e.prototype.resize=function(e){var t,i,r;void 0===e&&(e=!1),this._adaptToDeviceRatio&&(i=Se()&&window.devicePixelRatio||1,r=this._creationOptions.limitDeviceRatio||i,this._hardwareScalingLevel=this._adaptToDeviceRatio?1/Math.min(r,i):1),r=Se()?(t=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(t=this._renderingCanvas?this._renderingCanvas.width:100,this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(t/this._hardwareScalingLevel,r/this._hardwareScalingLevel,e)},e.prototype.setSize=function(e,t,i){return!(!this._renderingCanvas||(e|=0,t|=0,!(i=void 0!==i&&i)&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t||(this._renderingCanvas.width=e,this._renderingCanvas.height=t,0)))},e.prototype.bindFramebuffer=function(e,t,i,r,n,s,a){void 0===t&&(t=0),void 0===s&&(s=0),void 0===a&&(a=0);var o,l,h=e,c=(h=(this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(h._MSAAFramebuffer||h._framebuffer),this._gl),e.is2DArray?h.framebufferTextureLayer(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,null==(c=e.texture._hardwareTexture)?void 0:c.underlyingResource,s,a):e.isCube&&h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+t,null==(c=e.texture._hardwareTexture)?void 0:c.underlyingResource,s),e._depthStencilTexture);c&&(l=e._depthStencilTextureWithStencil?h.DEPTH_STENCIL_ATTACHMENT:h.DEPTH_ATTACHMENT,e.is2DArray?h.framebufferTextureLayer(h.FRAMEBUFFER,l,null==(o=c._hardwareTexture)?void 0:o.underlyingResource,s,a):e.isCube?h.framebufferTexture2D(h.FRAMEBUFFER,l,h.TEXTURE_CUBE_MAP_POSITIVE_X+t,null==(o=c._hardwareTexture)?void 0:o.underlyingResource,s):h.framebufferTexture2D(h.FRAMEBUFFER,l,h.TEXTURE_2D,null==(a=c._hardwareTexture)?void 0:a.underlyingResource,s)),this._cachedViewport&&!n?this.setViewport(this._cachedViewport,i,r):(i||(i=e.width,s&&(i/=Math.pow(2,s))),r||(r=e.height,s&&(r/=Math.pow(2,s))),this._viewport(0,0,i,r)),this.wipeCaches()},e.prototype.setState=function(e,t,i,r,n,s,a){void 0===t&&(t=0),void 0===r&&(r=!1),void 0===a&&(a=0),this._depthCullingState.cull===e&&!i||(this._depthCullingState.cull=e),n=null==(e=null!=(e=this.cullBackFaces)?e:n)||e?this._gl.BACK:this._gl.FRONT,this._depthCullingState.cullFace===n&&!i||(this._depthCullingState.cullFace=n),this.setZOffset(t),this.setZOffsetUnits(a),e=r?this._gl.CW:this._gl.CCW,this._depthCullingState.frontFace===e&&!i||(this._depthCullingState.frontFace=e),this._stencilStateComposer.stencilMaterial=s},e.prototype.setZOffset=function(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e},e.prototype.getZOffset=function(){var e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e},e.prototype.setZOffsetUnits=function(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e},e.prototype.getZOffsetUnits=function(){var e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e},e.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},e.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return null===this._currentFramebuffer},e.prototype.generateMipmaps=function(e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)},e.prototype.unBindFramebuffer=function(e,t,i){void 0===t&&(t=!1);var r=e,n=(this._currentRenderTarget=null,this._gl);if(r._MSAAFramebuffer){if(e.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(e,t,i);n.bindFramebuffer(n.READ_FRAMEBUFFER,r._MSAAFramebuffer),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,r._framebuffer),n.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,n.COLOR_BUFFER_BIT,n.NEAREST)}null==(n=e.texture)||!n.generateMipMaps||t||e.isCube||this.generateMipmaps(e.texture),i&&(r._MSAAFramebuffer&&this._bindUnboundFramebuffer(r._framebuffer),i()),this._bindUnboundFramebuffer(null)},e.prototype.flushFramebuffer=function(){this._gl.flush()},e.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},e.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},e.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},e.prototype._createVertexBuffer=function(e,t){var i=this._gl.createBuffer();if(!i)throw new Error("Unable to create vertex buffer");return i=new _t(i),this.bindArrayBuffer(i),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),this._resetVertexBufferBinding(),i.references=1,i},e.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},e.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},e.prototype.createIndexBuffer=function(e,t){var i=this._gl.createBuffer(),r=new _t(i);if(!i)throw new Error("Unable to create index buffer");return this.bindIndexBuffer(r),i=this._normalizeIndexData(e),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),r.references=1,r.is32Bits=4===i.BYTES_PER_ELEMENT,r},e.prototype._normalizeIndexData=function(e){if(2===e.BYTES_PER_ELEMENT)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(65535<=e[t])return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},e.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)},e.prototype.bindUniformBlock=function(e,t,i){e=e.program,t=this._gl.getUniformBlockIndex(e,t),this._gl.uniformBlockBinding(e,t,i)},e.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},e.prototype._bindBuffer=function(e,t){!this._vaoRecordInProgress&&this._currentBoundBuffer[t]===e||(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},e.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},e.prototype._vertexAttribPointer=function(e,t,i,r,n,s,a){var o,l=this._currentBufferPointers[t];l&&(o=!1,l.active?(l.buffer!==e&&(l.buffer=e,o=!0),l.size!==i&&(l.size=i,o=!0),l.type!==r&&(l.type=r,o=!0),l.normalized!==n&&(l.normalized=n,o=!0),l.stride!==s&&(l.stride=s,o=!0),l.offset!==a&&(l.offset=a,o=!0)):(l.active=o=!0,l.index=t,l.size=i,l.type=r,l.normalized=n,l.stride=s,l.offset=a,l.buffer=e),(o||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,i,r,n,s,a)))},e.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},e.prototype._bindVertexBuffersAttributes=function(e,t,i){var r=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var n=0;n<r.length;n++){var s,a,o=t.getAttributeLocation(n);0<=o&&(s=r[n],a=null,(a=(a=i?i[s]:a)||e[s])&&(this._gl.enableVertexAttribArray(o),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[o]=!0),(s=a.getBuffer())&&(this._vertexAttribPointer(s,o,a.getSize(),a.type,a.normalized,a.byteStride,a.byteOffset),a.getIsInstanced()&&(this._gl.vertexAttribDivisor(o,a.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(o),this._currentInstanceBuffers.push(s))))))}},e.prototype.recordVertexArrayObject=function(e,t,i,r){var n=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(n),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i,r),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),n},e.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},e.prototype.bindBuffersDirectly=function(e,t,i,r,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e;for(var s,a=(this._cachedEffectForVertexBuffers=n).getAttributesCount(),o=(this._unbindVertexArrayObject(),this.unbindAllAttributes(),0),l=0;l<a;l++)l<i.length&&(0<=(s=n.getAttributeLocation(l))&&(this._gl.enableVertexAttribArray(s),this._vertexAttribArraysEnabled[s]=!0,this._vertexAttribPointer(e,s,i[l],this._gl.FLOAT,!1,r,o)),o+=4*i[l])}this._bindIndexBufferWithCache(t)},e.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},e.prototype.bindBuffers=function(e,t,i,r){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===i||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i,r)),this._bindIndexBufferWithCache(t)},e.prototype.unbindInstanceAttributes=function(){for(var e,t=0,i=this._currentInstanceLocations.length;t<i;t++){var r=(e!=(r=this._currentInstanceBuffers[t])&&r.references&&this.bindArrayBuffer(e=r),this._currentInstanceLocations[t]);this._gl.vertexAttribDivisor(r,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},e.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},e.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)},e.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},e.prototype.updateAndBindInstancesBuffer=function(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==i[0].index)this.bindInstancesBuffer(e,i,!0);else for(var r=0;r<4;r++){var n=i[r];this._vertexAttribArraysEnabled[n]||(this._gl.enableVertexAttribArray(n),this._vertexAttribArraysEnabled[n]=!0),this._vertexAttribPointer(e,n,4,this._gl.FLOAT,!1,64,16*r),this._gl.vertexAttribDivisor(n,1),this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(e)}},e.prototype.bindInstancesBuffer=function(e,t,i){void 0===i&&(i=!0),this.bindArrayBuffer(e);var r=0;if(i)for(var n=0;n<t.length;n++)r+=4*(s=t[n]).attributeSize;var s;for(n=0;n<t.length;n++)void 0===(s=t[n]).index&&(s.index=this._currentEffect.getAttributeLocationByName(s.attributeName)),s.index<0||(this._vertexAttribArraysEnabled[s.index]||(this._gl.enableVertexAttribArray(s.index),this._vertexAttribArraysEnabled[s.index]=!0),this._vertexAttribPointer(e,s.index,s.attributeSize,s.attributeType||this._gl.FLOAT,s.normalized||!1,r,s.offset),this._gl.vertexAttribDivisor(s.index,void 0===s.divisor?1:s.divisor),this._currentInstanceLocations.push(s.index),this._currentInstanceBuffers.push(e))},e.prototype.disableInstanceAttributeByName=function(e){this._currentEffect&&(e=this._currentEffect.getAttributeLocationByName(e),this.disableInstanceAttribute(e))},e.prototype.disableInstanceAttribute=function(e){for(var t,i=!1;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),i=!0,this._currentInstanceLocations.indexOf(e);i&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},e.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},e.prototype.draw=function(e,t,i,r){this.drawElementsType(e?0:1,t,i,r)},e.prototype.drawPointClouds=function(e,t,i){this.drawArraysType(2,e,t,i)},e.prototype.drawUnIndexed=function(e,t,i,r){this.drawArraysType(e?0:1,t,i,r)},e.prototype.drawElementsType=function(e,t,i,r){this.applyStates(),this._reportDrawCall();e=this._drawMode(e);var n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,s=this._uintIndicesCurrentlySet?4:2;r?this._gl.drawElementsInstanced(e,i,n,t*s,r):this._gl.drawElements(e,i,n,t*s)},e.prototype.drawArraysType=function(e,t,i,r){this.applyStates(),this._reportDrawCall(),e=this._drawMode(e),r?this._gl.drawArraysInstanced(e,t,i,r):this._gl.drawArrays(e,t,i)},e.prototype._drawMode=function(e){switch(e){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}},e.prototype._reportDrawCall=function(){},e.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],(e=e.getPipelineContext())&&this._deletePipelineContext(e))},e.prototype._deletePipelineContext=function(e){e&&e.program&&(e.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(e.program))},e.prototype._getGlobalDefines=function(e){var t;if(!e)return t="",this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+="\n"),t+="#define USE_REVERSE_DEPTHBUFFER"),t;this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER},e.prototype.createEffect=function(e,t,i,r,n,s,a,o,l,h){void 0===h&&(h=Le.GLSL);var c=e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e,u=e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e,d=this._getGlobalDefines(),p=null!=(p=null!=n?n:t.defines)?p:"";d&&(p+=d),d=c+"+"+u+"@"+p;return this._compiledEffects[d]?(c=this._compiledEffects[d],a&&c.isReady()&&a(c),c):(u=new ot(e,t,i,r,this,n,s,a,o,l,d,h),this._compiledEffects[d]=u)},e._ConcatenateShader=function(e,t,i){return(i=void 0===i?"":i)+(t?t+"\n":"")+e},e.prototype._compileShader=function(t,i,r,n){return this._compileRawShader(e._ConcatenateShader(t,r,n),i)},e.prototype._compileRawShader=function(e,t){var i=this._gl,r=i.createShader("vertex"===t?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(r)return i.shaderSource(r,e),i.compileShader(r),r;var n,s=i.NO_ERROR;for(i.NO_ERROR;(n=i.getError())!==i.NO_ERROR;)s=n;throw new Error("Something went wrong while creating a gl ".concat(t," shader object. gl error=").concat(s,", gl isContextLost=").concat(i.isContextLost(),", _contextWasLost=").concat(this._contextWasLost))},e.prototype._getShaderSource=function(e){return this._gl.getShaderSource(e)},e.prototype.createRawShaderProgram=function(e,t,i,r,n){return void 0===n&&(n=null),r=r||this._gl,t=this._compileRawShader(t,"vertex"),i=this._compileRawShader(i,"fragment"),this._createShaderProgram(e,t,i,r,n)},e.prototype.createShaderProgram=function(e,t,i,r,n,s){void 0===s&&(s=null),n=n||this._gl;var a=1<this._webGLVersion?"#version 300 es\n#define WEBGL2 \n":"";t=this._compileShader(t,"vertex",r,a),i=this._compileShader(i,"fragment",r,a);return this._createShaderProgram(e,t,i,n,s)},e.prototype.inlineShaderCode=function(e){return e},e.prototype.createPipelineContext=function(e){var t=new gt;return(t.engine=this)._caps.parallelShaderCompile&&(t.isParallelCompiled=!0),t},e.prototype.createMaterialContext=function(){},e.prototype.createDrawContext=function(){},e.prototype._createShaderProgram=function(e,t,i,r,n){var s=r.createProgram();if(e.program=s)return r.attachShader(s,t),r.attachShader(s,i),r.linkProgram(s),e.context=r,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),s;throw new Error("Unable to create program")},e.prototype._finalizePipelineContext=function(e){var t,i=e.context,r=e.vertexShader,n=e.fragmentShader,s=e.program;if(!i.getProgramParameter(s,i.LINK_STATUS)){if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS)&&(t=this._gl.getShaderInfoLog(r)))throw e.vertexCompilationError=t,new Error("VERTEX SHADER "+t);if(!this._gl.getShaderParameter(n,this._gl.COMPILE_STATUS)&&(t=this._gl.getShaderInfoLog(n)))throw e.fragmentCompilationError=t,new Error("FRAGMENT SHADER "+t);if(t=i.getProgramInfoLog(s))throw e.programLinkError=t,new Error(t)}if(this.validateShaderPrograms&&(i.validateProgram(s),!i.getProgramParameter(s,i.VALIDATE_STATUS)&&(t=i.getProgramInfoLog(s))))throw e.programValidationError=t,new Error(t);i.deleteShader(r),i.deleteShader(n),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},e.prototype._preparePipelineContext=function(e,t,i,r,n,s,a,o,l,h){e.program=r?this.createRawShaderProgram(e,t,i,void 0,l):this.createShaderProgram(e,t,i,o,void 0,l),e.program.__SPECTOR_rebuildProgram=a},e.prototype._isRenderingStateCompiled=function(e){return!!this._gl.getProgramParameter(e.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(e),!0)},e.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var i;e.isParallelCompiled?(i=e.onCompiled,e.onCompiled=i?function(){i(),t()}:t):t()},e.prototype.getUniforms=function(e,t){for(var i=new Array,r=e,n=0;n<t.length;n++)i.push(this._gl.getUniformLocation(r.program,t[n]));return i},e.prototype.getAttributes=function(e,t){for(var i=[],r=e,n=0;n<t.length;n++)try{i.push(this._gl.getAttribLocation(r.program,t[n]))}catch(e){i.push(-1)}return i},e.prototype.enableEffect=function(e){(e=null!==e&&bt.IsWrapper(e)?e.effect:e)&&e!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(e),(this._currentEffect=e).onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},e.prototype.setInt=function(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)},e.prototype.setInt2=function(e,t,i){return!!e&&(this._gl.uniform2i(e,t,i),!0)},e.prototype.setInt3=function(e,t,i,r){return!!e&&(this._gl.uniform3i(e,t,i,r),!0)},e.prototype.setInt4=function(e,t,i,r,n){return!!e&&(this._gl.uniform4i(e,t,i,r,n),!0)},e.prototype.setIntArray=function(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)},e.prototype.setIntArray2=function(e,t){return!(!e||t.length%2!=0||(this._gl.uniform2iv(e,t),0))},e.prototype.setIntArray3=function(e,t){return!(!e||t.length%3!=0||(this._gl.uniform3iv(e,t),0))},e.prototype.setIntArray4=function(e,t){return!(!e||t.length%4!=0||(this._gl.uniform4iv(e,t),0))},e.prototype.setArray=function(e,t){return!(!e||t.length<1||(this._gl.uniform1fv(e,t),0))},e.prototype.setArray2=function(e,t){return!(!e||t.length%2!=0||(this._gl.uniform2fv(e,t),0))},e.prototype.setArray3=function(e,t){return!(!e||t.length%3!=0||(this._gl.uniform3fv(e,t),0))},e.prototype.setArray4=function(e,t){return!(!e||t.length%4!=0||(this._gl.uniform4fv(e,t),0))},e.prototype.setMatrices=function(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)},e.prototype.setMatrix3x3=function(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)},e.prototype.setMatrix2x2=function(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)},e.prototype.setFloat=function(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)},e.prototype.setFloat2=function(e,t,i){return!!e&&(this._gl.uniform2f(e,t,i),!0)},e.prototype.setFloat3=function(e,t,i,r){return!!e&&(this._gl.uniform3f(e,t,i,r),!0)},e.prototype.setFloat4=function(e,t,i,r,n){return!!e&&(this._gl.uniform4f(e,t,i,r,n),!0)},e.prototype.applyStates=function(){var e;this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged&&(this._colorWriteChanged=!1,e=this._colorWrite,this._gl.colorMask(e,e,e,e))},e.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},e.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(e.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilStateComposer",{get:function(){return this._stencilStateComposer},enumerable:!1,configurable:!0}),e.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},e.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},e.prototype._getSamplingParameters=function(e,t){var i=this._gl,r=i.NEAREST,n=i.NEAREST;switch(e){case 11:r=i.LINEAR,n=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 3:r=i.LINEAR,n=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 8:r=i.NEAREST,n=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 4:r=i.NEAREST,n=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 5:r=i.NEAREST,n=t?i.LINEAR_MIPMAP_NEAREST:i.LINEAR;break;case 6:r=i.NEAREST,n=t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR;break;case 7:r=i.NEAREST,n=i.LINEAR;break;case 1:r=i.NEAREST,n=i.NEAREST;break;case 9:r=i.LINEAR,n=t?i.NEAREST_MIPMAP_NEAREST:i.NEAREST;break;case 10:r=i.LINEAR,n=t?i.NEAREST_MIPMAP_LINEAR:i.NEAREST;break;case 2:r=i.LINEAR,n=i.LINEAR;break;case 12:r=i.LINEAR,n=i.NEAREST}return{min:n,mag:r}},e.prototype._createTexture=function(){var e=this._gl.createTexture();if(e)return e;throw new Error("Unable to create texture")},e.prototype._createHardwareTexture=function(){return new vt(this._createTexture(),this._gl)},e.prototype._createInternalTexture=function(e,t,i,r){void 0===r&&(r=ke.Unknown);var n={},s=(t=(void 0!==t&&"object"==typeof t?(n.generateMipMaps=t.generateMipMaps,n.type=void 0===t.type?0:t.type,n.samplingMode=void 0===t.samplingMode?3:t.samplingMode,n.format=void 0===t.format?5:t.format,n.useSRGBBuffer=void 0!==t.useSRGBBuffer&&t.useSRGBBuffer):(n.generateMipMaps=t,n.type=0,n.samplingMode=3,n.format=5,n.useSRGBBuffer=!1),n.useSRGBBuffer=n.useSRGBBuffer&&this._caps.supportSRGBBuffers&&(1<this.webGLVersion||this.isWebGPU),(1!==n.type||this._caps.textureFloatLinearFiltering)&&(2!==n.type||this._caps.textureHalfFloatLinearFiltering)||(n.samplingMode=1),1!==n.type||this._caps.textureFloat||(n.type=0,Me.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE")),this._gl),(r=new dt(this,r))._useSRGBBuffer=!!n.useSRGBBuffer,e.width||e),a=e.height||e,o=(e=e.layers||0,this._getSamplingParameters(n.samplingMode,!!n.generateMipMaps)),l=0!==e?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D,h=this._getRGBABufferInternalSizedFormat(n.type,n.format,n.useSRGBBuffer),c=this._getInternalFormat(n.format),u=this._getWebGLTextureType(n.type);return this._bindTextureDirectly(l,r),0!==e?(r.is2DArray=!0,t.texImage3D(l,0,h,s,a,e,0,c,u,null)):t.texImage2D(l,0,h,s,a,0,c,u,null),t.texParameteri(l,t.TEXTURE_MAG_FILTER,o.mag),t.texParameteri(l,t.TEXTURE_MIN_FILTER,o.min),t.texParameteri(l,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(l,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n.generateMipMaps&&this._gl.generateMipmap(l),this._bindTextureDirectly(l,null),r.baseWidth=s,r.baseHeight=a,r.width=s,r.height=a,r.depth=e,r.isReady=!0,r.samples=1,r.generateMipMaps=!!n.generateMipMaps,r.samplingMode=n.samplingMode,r.type=n.type,r.format=n.format,this._internalTexturesCache.push(r),r},e.prototype._getUseSRGBBuffer=function(e,t){return e&&this._caps.supportSRGBBuffers&&(1<this.webGLVersion||this.isWebGPU||t)},e.prototype._createTextureBase=function(t,i,r,n,s,a,o,l,h,c,u,d,p,f,m,_){var g=this,y=(void 0===s&&(s=3),void 0===a&&(a=null),void 0===o&&(o=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===d&&(d=null),void 0===p&&(p=null),"data:"===(t=t||"").substr(0,5)),v="blob:"===t.substr(0,5),b=y&&-1!==t.indexOf(";base64,"),E=u||new dt(this,ke.Url),x=t,C=(!this._transformTextureUrl||b||u||c||(t=this._transformTextureUrl(t)),x!==t&&(E._originalUrl=x),t.lastIndexOf(".")),w=p||(-1<C?t.substring(C).toLowerCase():""),S=null;-1<w.indexOf("?")&&(w=w.split("?")[0]);for(var T=0,P=e._TextureLoaders;T<P.length;T++){var A=P[T];if(A.canLoad(w,f)){S=A;break}}n&&n._addPendingData(E),E.url=t,E.generateMipMaps=!i,E.samplingMode=s,E.invertY=r,E._useSRGBBuffer=this._getUseSRGBBuffer(!!_,i),this._doNotHandleContextLost||(E._buffer=c);var R,M=null,O=(a&&!u&&(M=E.onLoadedObservable.add(a)),u||this._internalTexturesCache.push(E),function(e,r){n&&n._removePendingData(E),t===x?(M&&E.onLoadedObservable.remove(M),Ne.UseFallbackTexture&&g._createTextureBase(Ne.FallbackTexture,i,E.invertY,n,s,null,o,l,h,c,E),e=(e||"Unknown error")+(Ne.UseFallbackTexture?" - Fallback texture was used":""),E.onErrorObservable.notifyObservers({message:e,exception:r}),o&&o(e,r)):(Me.Warn("Failed to load ".concat(t,", falling back to ").concat(x)),g._createTextureBase(x,i,E.invertY,n,s,a,o,l,h,c,E,d,p,f,m,_))});return S?(R=function(e){S.loadData(e,E,(function(e,t,i,r,a,o){o?O("TextureLoader failed to load data"):l(E,w,n,{width:e,height:t},E.invertY,!i,r,(function(){return a(),!1}),s)}),m)},c?c instanceof ArrayBuffer?R(new Uint8Array(c)):ArrayBuffer.isView(c)?R(c):o&&o("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(t,(function(e){return R(new Uint8Array(e))}),void 0,n?n.offlineProvider:void 0,!0,(function(e,t){O("Unable to load "+(e&&e.responseURL,t))}))):(C=function(e){v&&!g._doNotHandleContextLost&&(E._buffer=e),l(E,w,n,e,E.invertY,i,!1,h,s)},!y||b?c&&("string"==typeof c.decoding||c.close)?C(c):e._FileToolsLoadImage(t,C,O,n?n.offlineProvider:null,f,E.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"==typeof c||c instanceof ArrayBuffer||ArrayBuffer.isView(c)||c instanceof Blob?e._FileToolsLoadImage(c,C,O,n?n.offlineProvider:null,f,E.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):c&&C(c)),E},e.prototype.createTexture=function(e,t,i,r,n,s,a,o,l,h,c,u,d,p,f){var m=this;return void 0===o&&(o=null),void 0===l&&(l=null),void 0===h&&(h=null),void 0===c&&(c=null),this._createTextureBase(e,t,i,r,n=void 0===n?3:n,s=void 0===s?null:s,a=void 0===a?null:a,this._prepareWebGLTexture.bind(this),(function(e,t,i,n,s,a){var o=m._gl,l=i.width===e&&i.height===t,c=h?m._getInternalFormat(h,s._useSRGBBuffer):".jpg"!==n||s._useSRGBBuffer?s._useSRGBBuffer?o.SRGB8_ALPHA8:o.RGBA:o.RGB;n=h?m._getInternalFormat(h):".jpg"!==n||s._useSRGBBuffer?o.RGBA:o.RGB;if(s._useSRGBBuffer&&1===m.webGLVersion&&(n=c),l)return o.texImage2D(o.TEXTURE_2D,0,c,n,o.UNSIGNED_BYTE,i),!1;if(l=m._caps.maxTextureSize,i.width>l||i.height>l||!m._supportsHardwareTextureRescaling)return m._prepareWorkingCanvas(),m._workingCanvas&&m._workingContext&&(m._workingCanvas.width=e,m._workingCanvas.height=t,m._workingContext.drawImage(i,0,0,i.width,i.height,0,0,e,t),o.texImage2D(o.TEXTURE_2D,0,c,n,o.UNSIGNED_BYTE,m._workingCanvas),s.width=e,s.height=t),!1;var u=new dt(m,ke.Temp);return m._bindTextureDirectly(o.TEXTURE_2D,u,!0),o.texImage2D(o.TEXTURE_2D,0,c,n,o.UNSIGNED_BYTE,i),m._rescaleTexture(u,s,r,c,(function(){m._releaseTexture(u),m._bindTextureDirectly(o.TEXTURE_2D,s,!0),a()})),!0}),o,l,h,c,u,d,f)},e._FileToolsLoadImage=function(e,t,i,r,n,s){throw Fe("FileTools")},e.prototype._rescaleTexture=function(e,t,i,r,n){},e.prototype.createRawTexture=function(e,t,i,r,n,s,a,o,l,h,c){throw Fe("Engine.RawTexture")},e.prototype.createRawCubeTexture=function(e,t,i,r,n,s,a,o){throw Fe("Engine.RawTexture")},e.prototype.createRawTexture3D=function(e,t,i,r,n,s,a,o,l,h){throw Fe("Engine.RawTexture")},e.prototype.createRawTexture2DArray=function(e,t,i,r,n,s,a,o,l,h){throw Fe("Engine.RawTexture")},e.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},e.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},e.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},e.prototype.updateTextureSamplingMode=function(e,t,i){void 0===i&&(i=!1);var r=this._getTextureTarget(t),n=this._getSamplingParameters(e,t.generateMipMaps||i);this._setTextureParameterInteger(r,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(r,this._gl.TEXTURE_MIN_FILTER,n.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(r)),this._bindTextureDirectly(r,null),t.samplingMode=e},e.prototype.updateTextureDimensions=function(e,t,i,r){},e.prototype.updateTextureWrappingMode=function(e,t,i,r){void 0===i&&(i=null),void 0===r&&(r=null);var n=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==i&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&null!==r&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(r),e),e._cachedWrapR=r),this._bindTextureDirectly(n,null)},e.prototype._setupDepthStencilTexture=function(e,t,i,r,n,s){void 0===s&&(s=1);var a=t.width||t,o=t.height||t;t=t.layers||0,e.baseWidth=a,e.baseHeight=o,e.width=a,e.height=o,e.is2DArray=0<t,e.depth=t,e.isReady=!0,e.samples=s,e.generateMipMaps=!1,e.samplingMode=r?2:1,e.type=0,e._comparisonFunction=n,a=this._gl,o=this._getTextureTarget(e),t=this._getSamplingParameters(e.samplingMode,!1);a.texParameteri(o,a.TEXTURE_MAG_FILTER,t.mag),a.texParameteri(o,a.TEXTURE_MIN_FILTER,t.min),a.texParameteri(o,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(o,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),0===n?(a.texParameteri(o,a.TEXTURE_COMPARE_FUNC,515),a.texParameteri(o,a.TEXTURE_COMPARE_MODE,a.NONE)):(a.texParameteri(o,a.TEXTURE_COMPARE_FUNC,n),a.texParameteri(o,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE))},e.prototype._uploadCompressedDataToTextureDirectly=function(e,t,i,r,n,s,a){void 0===s&&(s=0),void 0===a&&(a=0);var o=this._gl,l=o.TEXTURE_2D;if(e.isCube&&(l=o.TEXTURE_CUBE_MAP_POSITIVE_X+s),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=o.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1}this._gl.compressedTexImage2D(l,a,t,i,r,0,n)},e.prototype._uploadDataToTextureDirectly=function(e,t,i,r,n,s){void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=!1);var a=this._gl,o=this._getWebGLTextureType(e.type),l=this._getInternalFormat(e.format),h=(n=void 0===n?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(n,e._useSRGBBuffer),this._unpackFlipY(e.invertY),a.TEXTURE_2D),c=(i=(e.isCube&&(h=a.TEXTURE_CUBE_MAP_POSITIVE_X+i),Math.round(Math.log(e.width)*Math.LOG2E)),Math.round(Math.log(e.height)*Math.LOG2E));i=s?e.width:Math.pow(2,Math.max(i-r,0)),s=s?e.height:Math.pow(2,Math.max(c-r,0));a.texImage2D(h,r,n,i,s,0,l,o,t)},e.prototype.updateTextureData=function(e,t,i,r,n,s,a,o,l){void 0===a&&(a=0),void 0===o&&(o=0),void 0===l&&(l=!1);var h=this._gl,c=this._getWebGLTextureType(e.type),u=this._getInternalFormat(e.format),d=(this._unpackFlipY(e.invertY),h.TEXTURE_2D);e.isCube&&(d=h.TEXTURE_CUBE_MAP_POSITIVE_X+a),this._bindTextureDirectly(d,e,!0),h.texSubImage2D(d,o,i,r,n,s,u,c,t),l&&this._gl.generateMipmap(d),this._bindTextureDirectly(d,null)},e.prototype._uploadArrayBufferViewToTexture=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=this._gl;n=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(n,e,!0),this._uploadDataToTextureDirectly(e,t,i,r),this._bindTextureDirectly(n,null,!0)},e.prototype._prepareWebGLTextureContinuation=function(e,t,i,r,n){var s=this._gl;s&&(n=this._getSamplingParameters(n,!i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,n.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,n.min),i||r||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear())},e.prototype._prepareWebGLTexture=function(t,i,r,n,s,a,o,l,h){var c=this,u=(void 0===h&&(h=3),this.getCaps().maxTextureSize),d=Math.min(u,this.needPOTTextures?e.GetExponentOfTwo(n.width,u):n.width),p=(u=Math.min(u,this.needPOTTextures?e.GetExponentOfTwo(n.height,u):n.height),this._gl);p&&(t._hardwareTexture?(this._bindTextureDirectly(p.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===s||!!s),t.baseWidth=n.width,t.baseHeight=n.height,t.width=d,t.height=u,t.isReady=!0,l(d,u,n,i,t,(function(){c._prepareWebGLTextureContinuation(t,r,a,o,h)}))||this._prepareWebGLTextureContinuation(t,r,a,o,h)):r&&r._removePendingData(t))},e.prototype._setupFramebufferDepthAttachments=function(e,t,i,r,n){void 0===n&&(n=1);var s=this._gl;return e&&t?this._createRenderBuffer(i,r,n,s.DEPTH_STENCIL,s.DEPTH24_STENCIL8,s.DEPTH_STENCIL_ATTACHMENT):t?(t=s.DEPTH_COMPONENT16,1<this._webGLVersion&&(t=s.DEPTH_COMPONENT32F),this._createRenderBuffer(i,r,n,t,t,s.DEPTH_ATTACHMENT)):e?this._createRenderBuffer(i,r,n,s.STENCIL_INDEX8,s.STENCIL_INDEX8,s.STENCIL_ATTACHMENT):null},e.prototype._createRenderBuffer=function(e,t,i,r,n,s,a){void 0===a&&(a=!0);var o=this._gl,l=o.createRenderbuffer();return o.bindRenderbuffer(o.RENDERBUFFER,l),1<i&&o.renderbufferStorageMultisample?o.renderbufferStorageMultisample(o.RENDERBUFFER,i,n,e,t):o.renderbufferStorage(o.RENDERBUFFER,r,e,t),o.framebufferRenderbuffer(o.FRAMEBUFFER,s,o.RENDERBUFFER,l),a&&o.bindRenderbuffer(o.RENDERBUFFER,null),l},e.prototype._releaseTexture=function(e){this._deleteTexture(null==(t=e._hardwareTexture)?void 0:t.underlyingResource),this.unbindAllTextures();var t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},e.prototype._releaseRenderTargetWrapper=function(e){-1!==(e=this._renderTargetWrapperCache.indexOf(e))&&this._renderTargetWrapperCache.splice(e,1)},e.prototype._deleteTexture=function(e){e&&this._gl.deleteTexture(e)},e.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},e.prototype.bindSamplers=function(e){for(var t=e.getPipelineContext(),i=(this._setProgram(t.program),e.getSamplers()),r=0;r<i.length;r++){var n=e.getUniform(i[r]);n&&(this._boundUniforms[r]=n)}this._currentEffect=null},e.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},e.prototype._bindTextureDirectly=function(e,t,i,r){void 0===r&&(r=!1);var n=!1,s=t&&-1<t._associatedChannel;if((i=void 0!==i&&i)&&s&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||r){if(this._activateCurrentTexture(),t&&t.isMultiview)throw"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,null!=(e=null==(r=null==t?void 0:t._hardwareTexture)?void 0:r.underlyingResource)?e:null),(this._boundTexturesCache[this._activeChannel]=t)&&(t._associatedChannel=this._activeChannel)}else i&&(n=!0,this._activateCurrentTexture());return s&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),n},e.prototype._bindTexture=function(e,t,i){void 0!==e&&(t&&(t._associatedChannel=e),this._activeChannel=e,e=t?this._getTextureTarget(t):this._gl.TEXTURE_2D,this._bindTextureDirectly(e,t))},e.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),1<this.webGLVersion&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},e.prototype.setTexture=function(e,t,i,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))},e.prototype._bindSamplerUniformToChannel=function(e,t){(e=this._boundUniforms[e])&&e._currentState!==t&&(this._gl.uniform1i(e,t),e._currentState=t)},e.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},e.prototype._setTexture=function(e,t,i,r,n){if(void 0===i&&(i=!1),void 0===r&&(r=!1),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),1<this.webGLVersion&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;r=r?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture;var s=(!i&&r&&(r._associatedChannel=e),!0);this._boundTexturesCache[e]===r&&(i||this._bindSamplerUniformToChannel(r._associatedChannel,e),s=!1),this._activeChannel=e,e=this._getTextureTarget(r);return s&&this._bindTextureDirectly(e,r,i),r&&!r.isMultiview&&(r.isCube&&r._cachedCoordinatesMode!==t.coordinatesMode&&(r._cachedCoordinatesMode=t.coordinatesMode,s=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0,t.wrapU=s,t.wrapV=s),r._cachedWrapU!==t.wrapU&&(r._cachedWrapU=t.wrapU,this._setTextureParameterInteger(e,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),r)),r._cachedWrapV!==t.wrapV&&(r._cachedWrapV=t.wrapV,this._setTextureParameterInteger(e,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),r)),r.is3D&&r._cachedWrapR!==t.wrapR&&(r._cachedWrapR=t.wrapR,this._setTextureParameterInteger(e,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),r)),this._setAnisotropicLevel(e,r,t.anisotropicFilteringLevel)),!0},e.prototype.setTextureArray=function(e,t,i,r){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===i.length||(this._textureUnits=new Int32Array(i.length));for(var n=0;n<i.length;n++){var s=i[n].getInternalTexture();s?(this._textureUnits[n]=e+n,s._associatedChannel=e+n):this._textureUnits[n]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var a=0;a<i.length;a++)this._setTexture(this._textureUnits[a],i[a],!0)}},e.prototype._setAnisotropicLevel=function(e,t,i){var r=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(i=1),r&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)},e.prototype._setTextureParameterFloat=function(e,t,i,r){this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameterf(e,t,i)},e.prototype._setTextureParameterInteger=function(e,t,i,r){r&&this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameteri(e,t,i)},e.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}},e.prototype.releaseEffects=function(){for(var e in this._compiledEffects)e=this._compiledEffects[e].getPipelineContext(),this._deletePipelineContext(e);this._compiledEffects={}},e.prototype.dispose=function(){var e;this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),null!=(e=this.releaseComputeEffects)&&e.call(this),this.unbindAllAttributes(),this._boundUniforms=[],Se()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),window.removeEventListener("resize",this._checkForMobile)),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,ot.ResetCache();for(var t=0,i=this._activeRequests;t<i.length;t++)i[t].abort();this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},e.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},e.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},e.prototype.getError=function(){return this._gl.getError()},e.prototype._canRenderToFloatFramebuffer=function(){return 1<this._webGLVersion?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},e.prototype._canRenderToHalfFloatFramebuffer=function(){return 1<this._webGLVersion?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},e.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var i,r,n=!0,s=t.createTexture(),a=(e=(t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.createFramebuffer()),t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.checkFramebufferStatus(t.FRAMEBUFFER));for((n=(n=n&&a===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),n=n&&t.getError()===t.NO_ERROR),n&&(t.bindFramebuffer(t.FRAMEBUFFER,null),a=t.RGBA,i=t.UNSIGNED_BYTE,r=new Uint8Array(4),t.readPixels(0,0,1,1,a,i,r),n=n&&t.getError()===t.NO_ERROR),t.deleteTexture(s),t.deleteFramebuffer(e),t.bindFramebuffer(t.FRAMEBUFFER,null);!n&&t.getError()!==t.NO_ERROR;);return n},e.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},e.prototype._getInternalFormat=function(e,t){var i=(t=void 0!==t&&t)?this._gl.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:i=this._gl.ALPHA;break;case 1:i=this._gl.LUMINANCE;break;case 2:i=this._gl.LUMINANCE_ALPHA;break;case 6:i=this._gl.RED;break;case 7:i=this._gl.RG;break;case 4:i=t?this._gl.SRGB:this._gl.RGB;break;case 5:i=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA}if(1<this._webGLVersion)switch(e){case 8:i=this._gl.RED_INTEGER;break;case 9:i=this._gl.RG_INTEGER;break;case 10:i=this._gl.RGB_INTEGER;break;case 11:i=this._gl.RGBA_INTEGER}return i},e.prototype._getRGBABufferInternalSizedFormat=function(e,t,i){if(void 0===i&&(i=!1),1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return i?this._gl.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return i?this._gl.SRGB8:this._gl.RGB8;case 5:return i?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return i?this._gl.SRGB8_ALPHA8:this._gl.RGBA8},e.prototype._getRGBAMultiSampleBufferFormat=function(e){return 1===e?this._gl.RGBA32F:2===e?this._gl.RGBA16F:this._gl.RGBA8},e.prototype._loadFile=function(t,i,r,n,s,a){var o=this;t=e._FileToolsLoadFile(t,i,r,n,s,a);return this._activeRequests.push(t),t.onCompleteObservable.add((function(e){o._activeRequests.splice(o._activeRequests.indexOf(e),1)})),t},e._FileToolsLoadFile=function(e,t,i,r,n,s){throw Fe("FileTools")},e.prototype.readPixels=function(e,t,i,r,n,s){void 0===s&&(s=!0);var a=(n=void 0===n||n)?this._gl.RGBA:this._gl.RGB;n=new Uint8Array(r*i*(n?4:3));return s&&this.flushFramebuffer(),this._gl.readPixels(e,t,i,r,a,this._gl.UNSIGNED_BYTE,n),Promise.resolve(n)},Object.defineProperty(e,"IsSupportedAsync",{get:function(){return Promise.resolve(this.isSupported())},enumerable:!1,configurable:!0}),Object.defineProperty(e,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),e.isSupported=function(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(e,"HasMajorPerformanceCaveat",{get:function(){if(null===this._HasMajorPerformanceCaveat)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(e){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),e.CeilingPOT=function(e){return e--,e=(e=(e=(e=(e|=e>>1)|e>>2)|e>>4)|e>>8)|e>>16,++e},e.FloorPOT=function(e){return(e=(e=(e=(e=(e|=e>>1)|e>>2)|e>>4)|e>>8)|e>>16)-(e>>1)},e.NearestPOT=function(t){var i=e.CeilingPOT(t),r=e.FloorPOT(t);return t-r<i-t?r:i},e.GetExponentOfTwo=function(t,i,r){var n;switch(r=void 0===r?2:r){case 1:n=e.FloorPOT(t);break;case 2:n=e.NearestPOT(t);break;default:n=e.CeilingPOT(t)}return Math.min(n,i)},e.QueueNewFrame=function(e,t){return Se()?(t=t||window).requestPostAnimationFrame?t.requestPostAnimationFrame(e):t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,16)},e.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:Pe()?document:null},e.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],e._TextureLoaders=[],e.CollisionsEpsilon=.001,e._IsSupported=null,e._HasMajorPerformanceCaveat=null,e}(),wt=function(){function e(){}return e.SetImmediate=function(e){Se()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)},e}(),St=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),Tt=function(e){function t(i,r){return(i=e.call(this,i,je)||this).name="LoadFileError",Ge._setPrototypeOf(i,t.prototype),r instanceof Be?i.request=r:i.file=r,i}return c(t,e),t}(We),Pt=function(e){function t(i,r){return(i=e.call(this,i,Ve)||this).request=r,i.name="RequestFileError",Ge._setPrototypeOf(i,t.prototype),i}return c(t,e),t}(We),At=function(e){function t(i,r){return(i=e.call(this,i,Ze)||this).file=r,i.name="ReadFileError",Ge._setPrototypeOf(i,t.prototype),i}return c(t,e),t}(We),Rt={DefaultRetryStrategy:Ue.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:function(e){return e}},Mt=function(e){return e.replace(/#/gm,"%23")},Ot=function(e,t){e&&0===e.indexOf("data:")||Rt.CorsBehavior&&("string"==typeof Rt.CorsBehavior||Rt.CorsBehavior instanceof String?t.crossOrigin=Rt.CorsBehavior:(e=Rt.CorsBehavior(e))&&(t.crossOrigin=e))},It=function(e,t,i,r,n,s){void 0===n&&(n="");var a,o=!1,l=(e instanceof ArrayBuffer||ArrayBuffer.isView(e)?"undefined"!=typeof Blob?(a=URL.createObjectURL(new Blob([e],{type:n})),o=!0):a="data:".concat(n,";base64,")+function(e){for(var t,i,r,n,s,a,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",h=0,c=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);h<c.length;)r=(t=c[h++])>>2,n=(3&t)<<4|(t=h<c.length?c[h++]:Number.NaN)>>4,s=(15&t)<<2|(i=h<c.length?c[h++]:Number.NaN)>>6,a=63&i,isNaN(t)?s=a=64:isNaN(i)&&(a=64),l+=o.charAt(r)+o.charAt(n)+o.charAt(s)+o.charAt(a);return l}(e):e instanceof Blob?(a=URL.createObjectURL(e),o=!0):(a=Mt(e),a=Rt.PreprocessUrl(e)),Ne.LastCreatedEngine),h=function(t){var r;i&&(r=a||e.toString(),i("Error while trying to load image: ".concat(0===r.indexOf("http")||r.length<=128?r:r.slice(0,128)+"..."),t))};if("undefined"==typeof Image||null!=(f=null==l?void 0:l._features.forceBitmapOverHTMLImageElement)&&f)return Ft(a,(function(r){l.createImageBitmap(new Blob([r],{type:n}),g({premultiplyAlpha:"none"},s)).then((function(e){t(e),o&&URL.revokeObjectURL(a)})).catch((function(t){i&&i("Error while trying to load image: "+e,t)}))}),void 0,r||void 0,!0,(function(e,t){h(t)})),null;function c(){u.src=a}var u=new Image,d=(Ot(a,u),function(){u.removeEventListener("load",d),u.removeEventListener("error",p),t(u),o&&u.src&&URL.revokeObjectURL(u.src)}),p=function(e){u.removeEventListener("load",d),u.removeEventListener("error",p),h(e),o&&u.src&&URL.revokeObjectURL(u.src)};if(u.addEventListener("load",d),u.addEventListener("error",p),"blob:"!==a.substr(0,5)&&"data:"!==a.substr(0,5)&&r&&r.enableTexturesOffline)r.open((function(){r&&r.loadImage(a,u)}),c);else{if(-1!==a.indexOf("file:")){var f=decodeURIComponent(a.substring(5).toLowerCase());if(ze.FilesToLoad[f]){try{var m=void 0;try{m=URL.createObjectURL(ze.FilesToLoad[f])}catch(r){m=URL.createObjectURL(ze.FilesToLoad[f])}u.src=m,o=!0}catch(r){u.src=""}return u}}c()}return u},Dt=function(e,t,i,r,n){var s=new FileReader,a={onCompleteObservable:new we,abort:function(){return s.abort()}};return s.onloadend=function(){return a.onCompleteObservable.notifyObservers(a)},n&&(s.onerror=function(){n(new At("Unable to read ".concat(e.name),e))}),s.onload=function(e){t(e.target.result)},i&&(s.onprogress=i),r?s.readAsArrayBuffer(e):s.readAsText(e),a},Ft=function(e,t,i,r,n,s,a){if(e.name)return Dt(e,t,i,n,s?function(e){s(void 0,e)}:void 0);var o;if(-1!==e.indexOf("file:")&&(o=(0===(o=decodeURIComponent(e.substring(5).toLowerCase())).indexOf("./")&&(o=o.substring(2)),ze.FilesToLoad[o])))return Dt(o,t,i,n,s?function(e){return s(void 0,new Tt(e.message,e.file))}:void 0);if(Bt(e)){var l={onCompleteObservable:new we,abort:function(){return function(){}}};try{t((n?Nt:Ut)(e))}catch(e){s?s(void 0,e):Me.Error(e.message||"Failed to parse the Data URL")}return wt.SetImmediate((function(){l.onCompleteObservable.notifyObservers(l)})),l}return Lt(e,(function(e,i){t(e,i?i.responseURL:void 0)}),i,r,n,s?function(e){s(e.request,new Tt(e.message,e.request))}:void 0,a)},Lt=function(e,t,i,r,n,s,a){e=Mt(e),e=Rt.PreprocessUrl(e);var o,l=Rt.BaseUrl+e,h=!1,c={onCompleteObservable:new we,abort:function(){return h=!0}},u=function(){function e(){u&&(i&&u.removeEventListener("progress",i),o&&u.removeEventListener("readystatechange",o),u.removeEventListener("loadend",p))}function r(e){e=e.message||"Unknown error",s&&u?s(new Pt(e,u)):Me.Error(e)}var o,u=new Be,d=null,p=function(){e(),c.onCompleteObservable.notifyObservers(c),c.onCompleteObservable.clear(),p=o=null,t=a=s=i=void 0};c.abort=function(){h=!0,p&&p(),u&&u.readyState!==(XMLHttpRequest.DONE||4)&&u.abort(),null!==d&&(clearTimeout(d),d=null),u=null},function c(f){if(u){if(u.open("GET",l),a)try{a(u)}catch(e){return void r(e)}n&&(u.responseType="arraybuffer"),i&&u.addEventListener("progress",i),p&&u.addEventListener("loadend",p),o=function(){if(!h&&u&&u.readyState===(XMLHttpRequest.DONE||4))if(o&&u.removeEventListener("readystatechange",o),200<=u.status&&u.status<300||0===u.status&&(!Se()||kt()))try{t&&t(n?u.response:u.responseText,u)}catch(i){r(i)}else{var i=Rt.DefaultRetryStrategy;if(i&&-1!==(i=i(l,u,f)))return e(),u=new Be,void(d=setTimeout((function(){return c(f+1)}),i));i=new Pt("Error status: "+u.status+" "+u.statusText+" - Unable to load "+l,u),s&&s(i)}},u.addEventListener("readystatechange",o),u.send()}}(0)};return r&&r.enableSceneOffline?r.open((function(){r&&r.loadFile(Rt.BaseUrl+e,(function(e){!h&&t&&t(e),c.onCompleteObservable.notifyObservers(c)}),i?function(e){!h&&i&&i(e)}:void 0,o,n)}),o=function(e){e&&400<e.status?s&&s(e):u()}):u(),c},kt=function(){return"undefined"!=typeof location&&"file:"===location.protocol},Bt=function(e){return St.test(e)};function Nt(e){return function(e){for(var t=He(e),i=t.length,r=new Uint8Array(new ArrayBuffer(i)),n=0;n<i;n++)r[n]=t.charCodeAt(n);return r.buffer}(e.split(",")[1])}var zt,Ut=function(e){return He(e.split(",")[1])},Gt=(Ct._FileToolsLoadImage=It,Ct._FileToolsLoadFile=Ft,st._FileToolsLoadFile=Ft,function(e,t,i,r,n,s,a,o,l,h){zt={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:t,DefaultRetryStrategy:i.DefaultRetryStrategy,BaseUrl:i.BaseUrl,CorsBehavior:i.CorsBehavior,PreprocessUrl:i.PreprocessUrl,IsBase64DataUrl:r,IsFileURL:n,LoadFile:s,LoadImage:a,ReadFile:o,RequestFile:l,SetCorsBehavior:h},Object.defineProperty(zt,"DefaultRetryStrategy",{get:function(){return i.DefaultRetryStrategy},set:function(e){i.DefaultRetryStrategy=e}}),Object.defineProperty(zt,"BaseUrl",{get:function(){return i.BaseUrl},set:function(e){i.BaseUrl=e}}),Object.defineProperty(zt,"PreprocessUrl",{get:function(){return i.PreprocessUrl},set:function(e){i.PreprocessUrl=e}}),Object.defineProperty(zt,"CorsBehavior",{get:function(){return i.CorsBehavior},set:function(e){i.CorsBehavior=e}})}),jt=(Gt(Nt,Ut,Rt,Bt,kt,Ft,It,Dt,Lt,Ot),{});function Vt(e,t){jt[e]=t}var Zt=function(){function e(){}return e.Instantiate=function(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];var t=function(e){return jt[e]}(e);if(t)return t;Me.Warn(e+" not found, you may have missed an import.");for(var i=e.split("."),r=window||this,n=0,s=i.length;n<s;n++)r=r[i[n]];return"function"!=typeof r?null:r},e.RegisteredExternalClasses={},e}();var Wt=function(){function e(){}return Object.defineProperty(e,"BaseUrl",{get:function(){return Rt.BaseUrl},set:function(e){Rt.BaseUrl=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DefaultRetryStrategy",{get:function(){return Rt.DefaultRetryStrategy},set:function(e){Rt.DefaultRetryStrategy=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"CorsBehavior",{get:function(){return Rt.CorsBehavior},set:function(e){Rt.CorsBehavior=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"UseFallbackTexture",{get:function(){return Ne.UseFallbackTexture},set:function(e){Ne.UseFallbackTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"RegisteredExternalClasses",{get:function(){return Zt.RegisteredExternalClasses},set:function(e){Zt.RegisteredExternalClasses=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"fallbackTexture",{get:function(){return Ne.FallbackTexture},set:function(e){Ne.FallbackTexture=e},enumerable:!1,configurable:!0}),e.FetchToRef=function(e,t,i,r,n,s){e=4*((Math.abs(e)*i%i|0)+(Math.abs(t)*r%r|0)*i),s.r=n[e]/255,s.g=n[1+e]/255,s.b=n[2+e]/255,s.a=n[3+e]/255},e.Mix=function(e,t,i){return e*(1-i)+t*i},e.Instantiate=function(e){return Zt.Instantiate(e)},e.SetImmediate=function(e){wt.SetImmediate(e)},e.IsExponentOfTwo=function(e){for(var t=1;(t*=2)<e;);return t===e},e.FloatRound=function(t){return Math.fround?Math.fround(t):(e._TmpFloatArray[0]=t,e._TmpFloatArray[0])},e.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},e.GetFolderPath=function(e,t){void 0===t&&(t=!1);var i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)},e.ToDegrees=function(e){return 180*e/Math.PI},e.ToRadians=function(e){return e*Math.PI/180},e.MakeArray=function(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null},e.GetPointerPrefix=function(e){var t="pointer";return Se()&&!window.PointerEvent&&(t="mouse"),!e._badDesktopOS||e._badOS||document&&"ontouchend"in document?t:"mouse"},e.SetCorsBehavior=function(e,t){Ot(e,t)},e.CleanUrl=function(e){return e.replace(/#/gm,"%23")},Object.defineProperty(e,"PreprocessUrl",{get:function(){return Rt.PreprocessUrl},set:function(e){Rt.PreprocessUrl=e},enumerable:!1,configurable:!0}),e.LoadImage=function(e,t,i,r,n,s){return It(e,t,i,r,n,s)},e.LoadFile=function(e,t,i,r,n,s){return Ft(e,t,i,r,n,s)},e.LoadFileAsync=function(e,t){return void 0===t&&(t=!0),new Promise((function(i,r){Ft(e,(function(e){i(e)}),void 0,void 0,t,(function(e,t){r(t)}))}))},e.LoadScript=function(e,t,i,r){var n,s;Se()&&(n=document.getElementsByTagName("head")[0],(s=document.createElement("script")).setAttribute("type","text/javascript"),s.setAttribute("src",e),r&&(s.id=r),s.onload=function(){t&&t()},s.onerror=function(t){i&&i("Unable to load script '".concat(e,"'"),t)},n.appendChild(s))},e.LoadScriptAsync=function(e){var t=this;return new Promise((function(i,r){t.LoadScript(e,(function(){i()}),(function(e,t){r(t)}))}))},e.ReadFileAsDataURL=function(e,t,i){var r=new FileReader,n={onCompleteObservable:new we,abort:function(){return r.abort()}};return r.onloadend=function(){n.onCompleteObservable.notifyObservers(n)},r.onload=function(e){t(e.target.result)},r.onprogress=i,r.readAsDataURL(e),n},e.ReadFile=function(e,t,i,r,n){return Dt(e,t,i,r,n)},e.FileAsURL=function(e){return e=new Blob([e]),(window.URL||window.webkitURL).createObjectURL(e)},e.Format=function(e,t){return e.toFixed(t=void 0===t?2:t)},e.DeepCopy=function(e,t,i,r){Ie.DeepCopy(e,t,i,r)},e.IsEmpty=function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},e.RegisterTopRootEvents=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];e.addEventListener(r.name,r.handler,!1);try{window.parent&&window.parent.addEventListener(r.name,r.handler,!1)}catch(e){}}},e.UnregisterTopRootEvents=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];e.removeEventListener(r.name,r.handler);try{e.parent&&e.parent.removeEventListener(r.name,r.handler)}catch(e){}}},e.DumpFramebuffer=function(t,i,r,n,s,a){return void 0===s&&(s="image/png"),v(this,void 0,void 0,(function(){var o;return b(this,(function(l){switch(l.label){case 0:return[4,r.readPixels(0,0,t,i)];case 1:return o=l.sent(),o=new Uint8Array(o.buffer),e.DumpData(t,i,o,n,s,a,!0),[2]}}))}))},e.DumpData=function(t,i,r,n,s,a,o,l,h){if(void 0===s&&(s="image/png"),void 0===o&&(o=!1),void 0===l&&(l=!1),(e._ScreenshotCanvas=e._ScreenshotCanvas?e._ScreenshotCanvas:document.createElement("canvas")).width=t,e._ScreenshotCanvas.height=i,f=e._ScreenshotCanvas.getContext("2d")){if(r instanceof Float32Array){for(var c=new Uint8Array(r.length),u=r.length;u--;){var d=r[u];c[u]=d<0?0:1<d?1:Math.round(255*d)}r=c}var p=f.createImageData(t,i),f=(p.data.set(r),f.putImageData(p,0,0),e._ScreenshotCanvas);if(o){if((p=document.createElement("canvas")).width=t,p.height=i,!(o=p.getContext("2d")))return;o.translate(0,i),o.scale(1,-1),o.drawImage(e._ScreenshotCanvas,0,0),f=p}l?e.ToBlob(f,(function(e){var t=new FileReader;t.onload=function(e){e=e.target.result,n&&n(e)},t.readAsArrayBuffer(e)}),s,h):e.EncodeScreenshotCanvasData(n,s,a,f,h)}},e.DumpDataAsync=function(t,i,r,n,s,a,o,l){return void 0===n&&(n="image/png"),void 0===a&&(a=!1),void 0===o&&(o=!1),new Promise((function(h){e.DumpData(t,i,r,(function(e){return h(e)}),n,s,a,o,l)}))},e.ToBlob=function(e,t,i,r){void 0===i&&(i="image/png"),e.toBlob||(e.toBlob=function(e,t,i){var r=this;setTimeout((function(){for(var n=atob(r.toDataURL(t,i).split(",")[1]),s=n.length,a=new Uint8Array(s),o=0;o<s;o++)a[o]=n.charCodeAt(o);e(new Blob([a]))}))}),e.toBlob((function(e){t(e)}),i,r)},e.EncodeScreenshotCanvasData=function(t,i,r,n,s){void 0===i&&(i="image/png"),t?t((null!=n?n:e._ScreenshotCanvas).toDataURL(i,s)):this.ToBlob(null!=n?n:e._ScreenshotCanvas,(function(t){var i,n;"download"in document.createElement("a")?(r||(n=((n=new Date).getFullYear()+"-"+(n.getMonth()+1)).slice(2)+"-"+n.getDate()+"_"+n.getHours()+"-"+("0"+n.getMinutes()).slice(-2),r="screenshot_"+n+".png"),e.Download(t,r)):t&&(i=URL.createObjectURL(t),(n=window.open(""))&&((t=n.document.createElement("img")).onload=function(){URL.revokeObjectURL(i)},t.src=i,n.document.body.appendChild(t)))}),i,s)},e.Download=function(e,t){var i;navigator&&navigator.msSaveBlob?navigator.msSaveBlob(e,t):(e=window.URL.createObjectURL(e),i=document.createElement("a"),document.body.appendChild(i),i.style.display="none",i.href=e,i.download=t,i.addEventListener("click",(function(){i.parentElement&&i.parentElement.removeChild(i)})),i.click(),window.URL.revokeObjectURL(e))},e.BackCompatCameraNoPreventDefault=function(e){return"boolean"==typeof e[0]?e[0]:"boolean"==typeof e[1]&&e[1]},e.CreateScreenshot=function(e,t,i,r,n){throw Fe("ScreenshotTools")},e.CreateScreenshotAsync=function(e,t,i,r){throw Fe("ScreenshotTools")},e.CreateScreenshotUsingRenderTarget=function(e,t,i,r,n,s,a,o){throw Fe("ScreenshotTools")},e.CreateScreenshotUsingRenderTargetAsync=function(e,t,i,r,n,s,a){throw Fe("ScreenshotTools")},e.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},e.IsBase64=function(e){return Bt(e)},e.DecodeBase64=function(e){return Nt(e)},Object.defineProperty(e,"errorsCount",{get:function(){return Me.errorsCount},enumerable:!1,configurable:!0}),e.Log=function(e){Me.Log(e)},e.Warn=function(e){Me.Warn(e)},e.Error=function(e){Me.Error(e)},Object.defineProperty(e,"LogCache",{get:function(){return Me.LogCache},enumerable:!1,configurable:!0}),e.ClearLogCache=function(){Me.ClearLogCache()},Object.defineProperty(e,"LogLevels",{set:function(e){Me.LogLevels=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"PerformanceLogLevel",{set:function(t){return(t&e.PerformanceUserMarkLogLevel)===e.PerformanceUserMarkLogLevel?(e.StartPerformanceCounter=e._StartUserMark,void(e.EndPerformanceCounter=e._EndUserMark)):(t&e.PerformanceConsoleLogLevel)===e.PerformanceConsoleLogLevel?(e.StartPerformanceCounter=e._StartPerformanceConsole,void(e.EndPerformanceCounter=e._EndPerformanceConsole)):(e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,void(e.EndPerformanceCounter=e._EndPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),e._StartPerformanceCounterDisabled=function(e,t){},e._EndPerformanceCounterDisabled=function(e,t){},e._StartUserMark=function(t,i){if(void 0===i&&(i=!0),!e._Performance){if(!Se())return;e._Performance=window.performance}i&&e._Performance.mark&&e._Performance.mark(t+"-Begin")},e._EndUserMark=function(t,i){(i=void 0===i||i)&&e._Performance.mark&&(e._Performance.mark(t+"-End"),e._Performance.measure(t,t+"-Begin",t+"-End"))},e._StartPerformanceConsole=function(t,i){(i=void 0===i||i)&&(e._StartUserMark(t,i),console.time)},e._EndPerformanceConsole=function(t,i){(i=void 0===i||i)&&e._EndUserMark(t,i)},Object.defineProperty(e,"Now",{get:function(){return De.Now},enumerable:!1,configurable:!0}),e.GetClassName=function(e,t){var i=null;return!(t=void 0!==t&&t)&&e.getClassName?e.getClassName():(i=e instanceof Object?(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__:i)||typeof e},e.First=function(e,t){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t(n))return n}return null},e.getFullClassName=function(e,t){var i=null,r=null;return(i=!(t=void 0!==t&&t)&&e.getClassName?e.getClassName():(e instanceof Object&&(i=(t=t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__,r=t.constructor.__bjsmoduleName__),i||typeof e))?(null!=r?r+".":"")+i:null},e.DelayAsync=function(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))},e.IsSafari=function(){return!!Te()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},e.UseCustomRequestHeaders=!1,e.CustomRequestHeaders=Be.CustomRequestHeaders,e._TmpFloatArray=new Float32Array(1),e.GetDOMTextContent=Ae,e.GetAbsoluteUrl="object"==typeof document?function(e){var t=document.createElement("a");return t.href=e,t.href}:"function"==typeof URL&&"object"==typeof location?function(e){return new URL(e,location.origin).href}:function(){throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},e.NoneLogLevel=Me.NoneLogLevel,e.MessageLogLevel=Me.MessageLogLevel,e.WarningLogLevel=Me.WarningLogLevel,e.ErrorLogLevel=Me.ErrorLogLevel,e.AllLogLevel=Me.AllLogLevel,e.IsWindowObjectExist=Se,e.PerformanceNoneLogLevel=0,e.PerformanceUserMarkLogLevel=1,e.PerformanceConsoleLogLevel=2,e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,e.EndPerformanceCounter=e._EndPerformanceCounterDisabled,e}(),Ht=(Ne.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",function(){function e(t){this.length=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)},e.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this.data[t])},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0},e.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.indexOf=function(e){return(e=this.data.indexOf(e))>=this.length?-1:e},e.prototype.contains=function(e){return-1!==this.indexOf(e)},e._GlobalId=0,e}()),Kt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._duplicateId=0,t}return c(t,e),t.prototype.push=function(t){e.prototype.push.call(this,t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId},t.prototype.pushNoDuplicate=function(e){return!(e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||(this.push(e),0))},t.prototype.reset=function(){e.prototype.reset.call(this),this._duplicateId++},t.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[t];this.pushNoDuplicate(i)}}},t}(Ht),qt=function(){function e(){this._count=0,this._data={}}return e.prototype.copyFrom=function(e){var t=this;this.clear(),e.forEach((function(e,i){return t.add(e,i)}))},e.prototype.get=function(e){if(void 0!==(e=this._data[e]))return e},e.prototype.getOrAddWithFactory=function(e,t){var i=this.get(e);return void 0!==i||(i=t(e))&&this.add(e,i),i},e.prototype.getOrAdd=function(e,t){var i=this.get(e);return void 0!==i?i:(this.add(e,t),t)},e.prototype.contains=function(e){return void 0!==this._data[e]},e.prototype.add=function(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)},e.prototype.set=function(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)},e.prototype.getAndRemove=function(e){var t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null},e.prototype.remove=function(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)},e.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),e.prototype.forEach=function(e){for(var t in this._data)e(t,this._data[t])},e.prototype.first=function(e){for(var t in this._data)if(t=e(t,this._data[t]))return t;return null},e}(),Xt=function(){function e(){}return e.Eval=function(t,i){return"true"===(t=t.match(/\([^()]*\)/g)?t.replace(/\([^()]*\)/g,(function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,i)})):e._HandleParenthesisContent(t,i))||"false"!==t&&e.Eval(t,i)},e._HandleParenthesisContent=function(t,i){i=i||function(e){return"true"===e};var r,n=t.split("||");for(r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var s=e._SimplifyNegation(n[r].trim()),a=s.split("&&");if(1<a.length)for(var o=0;o<a.length;++o){var l,h=e._SimplifyNegation(a[o].trim());if(!(l="true"!==h&&"false"!==h?"!"===h[0]?!i(h.substring(1)):i(h):"true"===h)){s="false";break}}if(l||"true"===s){l=!0;break}l="true"!==s&&"false"!==s?"!"===s[0]?!i(s.substring(1)):i(s):"true"===s}return l?"true":"false"},e._SimplifyNegation=function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,(function(e){return(e=e.replace(/[\s]/g,(function(){return""}))).length%2?"!":""}))).trim())?e="false":"!false"===e&&(e="true"),e},e}(),Yt=function(){function e(){}return e.EnableFor=function(t){t._tags=t._tags||{},t.hasTags=function(){return e.HasTags(t)},t.addTags=function(i){return e.AddTagsTo(t,i)},t.removeTags=function(i){return e.RemoveTagsFrom(t,i)},t.matchesTagsQuery=function(i){return e.MatchesQuery(t,i)}},e.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},e.HasTags=function(e){if(!e._tags)return!1;var t,i=e._tags;for(t in i)if(Object.prototype.hasOwnProperty.call(i,t))return!0;return!1},e.GetTags=function(e,t){if(!e._tags)return null;if(t=void 0===t||t){var i,r=[];for(i in e._tags)Object.prototype.hasOwnProperty.call(e._tags,i)&&!0===e._tags[i]&&r.push(i);return r.join(" ")}return e._tags},e.AddTagsTo=function(t,i){i&&"string"==typeof i&&i.split(" ").forEach((function(i){e._AddTagTo(t,i)}))},e._AddTagTo=function(t,i){""===(i=i.trim())||"true"===i||"false"===i||i.match(/[\s]/)||i.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(t),t._tags[i]=!0)},e.RemoveTagsFrom=function(t,i){if(e.HasTags(t)){var r,n=i.split(" ");for(r in n)e._RemoveTagFrom(t,n[r])}},e._RemoveTagFrom=function(e,t){delete e._tags[t]},e.MatchesQuery=function(t,i){return void 0===i||(""===i?e.HasTags(t):Xt.Eval(i,(function(i){return e.HasTags(t)&&t._tags[i]})))},e}(),Qt=function(){function e(){}return e.WithinEpsilon=function(e,t,i){return void 0===i&&(i=1401298e-51),Math.abs(e-t)<=i},e.ToHex=function(e){var t=e.toString(16);return(e<=15?"0"+t:t).toUpperCase()},e.Sign=function(e){return 0==(e=+e)||isNaN(e)?e:0<e?1:-1},e.Clamp=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.min(i,Math.max(t,e))},e.Log2=function(e){return Math.log(e)*Math.LOG2E},e.ILog2=function(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;var t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(1<e)for(;1<e;)t++,e=Math.floor(e/2);return t},e.Repeat=function(e,t){return e-Math.floor(e/t)*t},e.Normalize=function(e,t,i){return(e-t)/(i-t)},e.Denormalize=function(e,t,i){return e*(i-t)+t},e.DeltaAngle=function(t,i){return 180<(i=e.Repeat(i-t,360))&&(i-=360),i},e.PingPong=function(t,i){return t=e.Repeat(t,2*i),i-Math.abs(t-i)},e.SmoothStep=function(t,i,r){return i*(r=-2*(r=e.Clamp(r))*r*r+3*r*r)+t*(1-r)},e.MoveTowards=function(t,i,r){return Math.abs(i-t)<=r?i:t+e.Sign(i-t)*r},e.MoveTowardsAngle=function(t,i,r){var n=e.DeltaAngle(t,i);return-r<n&&n<r?i:e.MoveTowards(t,i=t+n,r)},e.Lerp=function(e,t,i){return e+(t-e)*i},e.LerpAngle=function(t,i,r){return 180<(i=e.Repeat(i-t,360))&&(i-=360),t+i*e.Clamp(r)},e.InverseLerp=function(t,i,r){return t!=i?e.Clamp((r-t)/(i-t)):0},e.Hermite=function(e,t,i,r,n){var s=n*n,a=n*s;return e*(2*a-3*s+1)+i*(-2*a+3*s)+t*(a-2*s+n)+r*(a-s)},e.Hermite1stDerivative=function(e,t,i,r,n){var s=n*n;return 6*(s-n)*e+(3*s-4*n+1)*t+6*(-s+n)*i+(3*s-2*n)*r},e.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},e.RangeToPercent=function(e,t,i){return(e-t)/(i-t)},e.PercentToRange=function(e,t,i){return(i-t)*e+t},e.NormalizeRadians=function(t){return t-e.TwoPi*Math.floor((t+Math.PI)/e.TwoPi)},e.HCF=function(t,i){return 0==(t%=i)?i:e.HCF(i,t)},e.TwoPi=2*Math.PI,e}(),$t=1/2.2,Jt=2.2,ei=.001,ti=function(){function e(){}return e.BuildArray=function(e,t){for(var i=[],r=0;r<e;++r)i.push(t());return i},e.BuildTuple=function(t,i){return e.BuildArray(t,i)},e}(),ii=function(e){return parseInt(e.toString().replace(/\W/g,""))},ri=function(){function e(e,t){void 0===t&&(t=0),this.x=e=void 0===e?0:e,this.y=t}return e.prototype.toString=function(){return"{X: ".concat(this.x," Y: ").concat(this.y,"}")},e.prototype.getClassName=function(){return"Vector2"},e.prototype.getHashCode=function(){return 397*ii(this.x)^ii(this.y)},e.prototype.toArray=function(e,t){return e[t=void 0===t?0:t]=this.x,e[t+1]=this.y,this},e.prototype.fromArray=function(t,i){return e.FromArrayToRef(t,i=void 0===i?0:i,this),this},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},e.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},e.prototype.set=function(e,t){return this.copyFromFloats(e,t)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.addVector3=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},e.prototype.multiplyByFloats=function(t,i){return new e(this.x*t,this.y*i)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.negate=function(){return new e(-this.x,-this.y)},e.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},e.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this.x,-1*this.y)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},e.prototype.scale=function(t){var i=new e(0,0);return this.scaleToRef(t,i),i},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,this},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=ei),e&&Qt.WithinEpsilon(this.x,e.x,t)&&Qt.WithinEpsilon(this.y,e.y,t)},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},e.prototype.rotateToRef=function(e,t){var i=Math.cos(e);e=Math.sin(e);return t.x=i*this.x-e*this.y,t.y=e*this.x+i*this.y,this},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},e.prototype.normalize=function(){return e.NormalizeToRef(this,this),this},e.prototype.clone=function(){return new e(this.x,this.y)},e.Zero=function(){return new e(0,0)},e.One=function(){return new e(1,1)},e.FromArray=function(t,i){return new e(t[i=void 0===i?0:i],t[i+1])},e.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1]},e.CatmullRom=function(t,i,r,n,s){var a=s*s,o=s*a;return new e(.5*(2*i.x+(-t.x+r.x)*s+(2*t.x-5*i.x+4*r.x-n.x)*a+(-t.x+3*i.x-3*r.x+n.x)*o),.5*(2*i.y+(-t.y+r.y)*s+(2*t.y-5*i.y+4*r.y-n.y)*a+(-t.y+3*i.y-3*r.y+n.y)*o))},e.Clamp=function(t,i,r){var n=t.x;n=(n=n>r.x?r.x:n)<i.x?i.x:n,t=t.y;return new e(n,t=(t=t>r.y?r.y:t)<i.y?i.y:t)},e.Hermite=function(t,i,r,n,s){var a=s*s,o=2*(h=s*a)-3*a+1,l=-2*h+3*a,h=(s=h-2*a+s,h-a);return new e(t.x*o+r.x*l+i.x*s+n.x*h,t.y*o+r.y*l+i.y*s+n.y*h)},e.Hermite1stDerivative=function(t,i,r,n,s){var a=e.Zero();return this.Hermite1stDerivativeToRef(t,i,r,n,s,a),a},e.Hermite1stDerivativeToRef=function(e,t,i,r,n,s){var a=n*n;s.x=6*(a-n)*e.x+(3*a-4*n+1)*t.x+6*(-a+n)*i.x+(3*a-2*n)*r.x,s.y=6*(a-n)*e.y+(3*a-4*n+1)*t.y+6*(-a+n)*i.y+(3*a-2*n)*r.y},e.Lerp=function(t,i,r){return new e(t.x+(i.x-t.x)*r,t.y+(i.y-t.y)*r)},e.Dot=function(e,t){return e.x*t.x+e.y*t.y},e.Normalize=function(t){var i=e.Zero();return this.NormalizeToRef(t,i),i},e.NormalizeToRef=function(e,t){var i=e.length();0!==i&&(t.x=e.x/i,t.y=e.y/i)},e.Minimize=function(t,i){return new e((t.x<i.x?t:i).x,(t.y<i.y?t:i).y)},e.Maximize=function(t,i){return new e((t.x>i.x?t:i).x,(t.y>i.y?t:i).y)},e.Transform=function(t,i){var r=e.Zero();return e.TransformToRef(t,i,r),r},e.TransformToRef=function(e,t,i){t=t.m;var r=e.x*t[0]+e.y*t[4]+t[12];e=e.x*t[1]+e.y*t[5]+t[13];i.x=r,i.y=e},e.PointInTriangle=function(e,t,i,r){var n=.5*(-i.y*r.x+t.y*(-i.x+r.x)+t.x*(i.y-r.y)+i.x*r.y),s=n<0?-1:1;r=(t.y*r.x-t.x*r.y+(r.y-t.y)*e.x+(t.x-r.x)*e.y)*s,i=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*s;return 0<r&&0<i&&r+i<2*n*s},e.Distance=function(t,i){return Math.sqrt(e.DistanceSquared(t,i))},e.DistanceSquared=function(e,t){var i=e.x-t.x;return i*i+(e=e.y-t.y)*e},e.Center=function(t,i){return e.CenterToRef(t,i,e.Zero())},e.CenterToRef=function(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2)},e.DistanceOfPointFromSegment=function(t,i,r){var n=e.DistanceSquared(i,r);return 0===n||(r=r.subtract(i),n=Math.max(0,Math.min(1,e.Dot(t.subtract(i),r)/n)),i=i.add(r.multiplyByFloats(n,n))),e.Distance(t,i)},e}(),ni=function(){function e(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this._isDirty=!0,this._x=e,this._y=t,this._z=i}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._isDirty=!0},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z,"}")},e.prototype.getClassName=function(){return"Vector3"},e.prototype.getHashCode=function(){return 397*(397*ii(this._x)^ii(this._y))^ii(this._z)},e.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return e[t=void 0===t?0:t]=this._x,e[t+1]=this._y,e[t+2]=this._z,this},e.prototype.fromArray=function(t,i){return e.FromArrayToRef(t,i=void 0===i?0:i,this),this},e.prototype.toQuaternion=function(){return ai.RotationYawPitchRoll(this._y,this._x,this._z)},e.prototype.addInPlace=function(e){return this.addInPlaceFromFloats(e._x,e._y,e._z)},e.prototype.addInPlaceFromFloats=function(e,t,i){return this.x+=e,this.y+=t,this.z+=i,this},e.prototype.add=function(t){return new e(this._x+t._x,this._y+t._y,this._z+t._z)},e.prototype.addToRef=function(e,t){return t.copyFromFloats(this._x+e._x,this._y+e._y,this._z+e._z)},e.prototype.subtractInPlace=function(e){return this.x-=e._x,this.y-=e._y,this.z-=e._z,this},e.prototype.subtract=function(t){return new e(this._x-t._x,this._y-t._y,this._z-t._z)},e.prototype.subtractToRef=function(e,t){return this.subtractFromFloatsToRef(e._x,e._y,e._z,t)},e.prototype.subtractFromFloats=function(t,i,r){return new e(this._x-t,this._y-i,this._z-r)},e.prototype.subtractFromFloatsToRef=function(e,t,i,r){return r.copyFromFloats(this._x-e,this._y-t,this._z-i)},e.prototype.negate=function(){return new e(-this._x,-this._y,-this._z)},e.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this._x,-1*this._y,-1*this._z)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.prototype.scale=function(t){return new e(this._x*t,this._y*t,this._z*t)},e.prototype.scaleToRef=function(e,t){return t.copyFromFloats(this._x*e,this._y*e,this._z*e)},e.prototype.applyRotationQuaternionToRef=function(e,t){var i=e.w*this.x+e.y*this.z-e.z*this.y,r=e.w*this.y+e.z*this.x-e.x*this.z,n=e.w*this.z+e.x*this.y-e.y*this.x,s=-e.x*this.x-e.y*this.y-e.z*this.z;return t.x=i*e.w+s*-e.x+r*-e.z-n*-e.y,t.y=r*e.w+s*-e.y+n*-e.x-i*-e.z,t.z=n*e.w+s*-e.z+i*-e.y-r*-e.x,t},e.prototype.applyRotationQuaternionInPlace=function(e){return this.applyRotationQuaternionToRef(e,this)},e.prototype.applyRotationQuaternion=function(t){return this.applyRotationQuaternionToRef(t,e.Zero())},e.prototype.scaleAndAddToRef=function(e,t){return t.addInPlaceFromFloats(this._x*e,this._y*e,this._z*e)},e.prototype.projectOnPlane=function(t,i){var r=e.Zero();return this.projectOnPlaneToRef(t,i,r),r},e.prototype.projectOnPlaneToRef=function(t,i,r){var n=t.normal,s=(t=t.d,li.Vector3[0]),a=(this.subtractToRef(i,s),s.normalize(),e.Dot(s,n));n=-(e.Dot(i,n)+t)/a,t=s.scaleInPlace(n);i.addToRef(t,r)},e.prototype.equals=function(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=ei),e&&Qt.WithinEpsilon(this._x,e._x,t)&&Qt.WithinEpsilon(this._y,e._y,t)&&Qt.WithinEpsilon(this._z,e._z,t)},e.prototype.equalsToFloats=function(e,t,i){return this._x===e&&this._y===t&&this._z===i},e.prototype.multiplyInPlace=function(e){return this.x*=e._x,this.y*=e._y,this.z*=e._z,this},e.prototype.multiply=function(e){return this.multiplyByFloats(e._x,e._y,e._z)},e.prototype.multiplyToRef=function(e,t){return t.copyFromFloats(this._x*e._x,this._y*e._y,this._z*e._z)},e.prototype.multiplyByFloats=function(t,i,r){return new e(this._x*t,this._y*i,this._z*r)},e.prototype.divide=function(t){return new e(this._x/t._x,this._y/t._y,this._z/t._z)},e.prototype.divideToRef=function(e,t){return t.copyFromFloats(this._x/e._x,this._y/e._y,this._z/e._z)},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.minimizeInPlace=function(e){return this.minimizeInPlaceFromFloats(e._x,e._y,e._z)},e.prototype.maximizeInPlace=function(e){return this.maximizeInPlaceFromFloats(e._x,e._y,e._z)},e.prototype.minimizeInPlaceFromFloats=function(e,t,i){return e<this._x&&(this.x=e),t<this._y&&(this.y=t),i<this._z&&(this.z=i),this},e.prototype.maximizeInPlaceFromFloats=function(e,t,i){return e>this._x&&(this.x=e),t>this._y&&(this.y=t),i>this._z&&(this.z=i),this},e.prototype.isNonUniformWithinEpsilon=function(e){var t=Math.abs(this._x),i=Math.abs(this._y);if(!Qt.WithinEpsilon(t,i,e))return!0;var r=Math.abs(this._z);return!Qt.WithinEpsilon(t,r,e)||!Qt.WithinEpsilon(i,r,e)},Object.defineProperty(e.prototype,"isNonUniform",{get:function(){var e=Math.abs(this._x);return e!==Math.abs(this._y)||e!==Math.abs(this._z)},enumerable:!1,configurable:!0}),e.prototype.floor=function(){return new e(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},e.prototype.fract=function(){return new e(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},e.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},e.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},Object.defineProperty(e.prototype,"hasAZeroComponent",{get:function(){return this._x*this._y*this._z==0},enumerable:!1,configurable:!0}),e.prototype.normalize=function(){return this.normalizeFromLength(this.length())},e.prototype.reorderInPlace=function(e){var t=this;return"xyz"===(e=e.toLowerCase())||(li.Vector3[0].copyFrom(this),["x","y","z"].forEach((function(i,r){t[i]=li.Vector3[0][e[r]]}))),this},e.prototype.rotateByQuaternionToRef=function(t,i){return t.toRotationMatrix(li.Matrix[0]),e.TransformCoordinatesToRef(this,li.Matrix[0],i),i},e.prototype.rotateByQuaternionAroundPointToRef=function(e,t,i){return this.subtractToRef(t,li.Vector3[0]),li.Vector3[0].rotateByQuaternionToRef(e,li.Vector3[0]),t.addToRef(li.Vector3[0],i),i},e.prototype.cross=function(t){return e.Cross(this,t)},e.prototype.normalizeFromLength=function(e){return 0===e||1===e?this:this.scaleInPlace(1/e)},e.prototype.normalizeToNew=function(){var t=new e(0,0,0);return this.normalizeToRef(t),t},e.prototype.normalizeToRef=function(e){var t=this.length();return 0===t||1===t?e.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/t,e)},e.prototype.clone=function(){return new e(this._x,this._y,this._z)},e.prototype.copyFrom=function(e){return this.copyFromFloats(e._x,e._y,e._z)},e.prototype.copyFromFloats=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},e.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},e.prototype.setAll=function(e){return this.x=this.y=this.z=e,this},e.GetClipFactor=function(t,i,r,n){return(t=e.Dot(t,r)-n)/(t-(e.Dot(i,r)-n))},e.GetAngleBetweenVectors=function(t,i,r){t=t.normalizeToRef(li.Vector3[1]),i=i.normalizeToRef(li.Vector3[2]);var n=e.Dot(t,i),s=(n=Qt.Clamp(n,-1,1),Math.acos(n)),a=li.Vector3[3];return e.CrossToRef(t,i,a),0<e.Dot(a,r)?isNaN(s)?0:s:isNaN(s)?-Math.PI:-Math.acos(n)},e.GetAngleBetweenVectorsOnPlane=function(t,i,r){li.Vector3[0].copyFrom(t);t=li.Vector3[0],li.Vector3[1].copyFrom(i),i=li.Vector3[1],li.Vector3[2].copyFrom(r),r=li.Vector3[2];var n=li.Vector3[3],s=li.Vector3[4];t.normalize(),i.normalize(),r.normalize(),e.CrossToRef(r,t,n),e.CrossToRef(n,r,s),t=Math.atan2(e.Dot(i,n),e.Dot(i,s));return Qt.NormalizeRadians(t)},e.SlerpToRef=function(t,i,r,n){r=Qt.Clamp(r,0,1);var s,a,o=li.Vector3[0],l=li.Vector3[1],h=(t=(o.copyFrom(t),o.length()),i=(o.normalizeFromLength(t),l.copyFrom(i),l.length()),l.normalizeFromLength(i),e.Dot(o,l));h=h<.999?(h=Math.acos(h),s=1/Math.sin(h),a=Math.sin((1-r)*h)*s,Math.sin(r*h)*s):(a=1-r,r),o.scaleInPlace(a),l.scaleInPlace(h),n.copyFrom(o).addInPlace(l),n.scaleInPlace(Qt.Lerp(t,i,r))},e.SmoothToRef=function(t,i,r,n,s){e.SlerpToRef(t,i,0===n?1:r/n,s)},e.FromArray=function(t,i){return new e(t[i=void 0===i?0:i],t[i+1],t[i+2])},e.FromFloatArray=function(t,i){return e.FromArray(t,i)},e.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2]},e.FromFloatArrayToRef=function(t,i,r){return e.FromArrayToRef(t,i,r)},e.FromFloatsToRef=function(e,t,i,r){r.copyFromFloats(e,t,i)},e.Zero=function(){return new e(0,0,0)},e.One=function(){return new e(1,1,1)},e.Up=function(){return new e(0,1,0)},Object.defineProperty(e,"UpReadOnly",{get:function(){return e._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"RightReadOnly",{get:function(){return e._RightReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LeftReadOnly",{get:function(){return e._LeftReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LeftHandedForwardReadOnly",{get:function(){return e._LeftHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"RightHandedForwardReadOnly",{get:function(){return e._RightHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ZeroReadOnly",{get:function(){return e._ZeroReadOnly},enumerable:!1,configurable:!0}),e.Down=function(){return new e(0,-1,0)},e.Forward=function(t){return new e(0,0,(t=void 0!==t&&t)?-1:1)},e.Backward=function(t){return new e(0,0,(t=void 0!==t&&t)?1:-1)},e.Right=function(){return new e(1,0,0)},e.Left=function(){return new e(-1,0,0)},e.TransformCoordinates=function(t,i){var r=e.Zero();return e.TransformCoordinatesToRef(t,i,r),r},e.TransformCoordinatesToRef=function(t,i,r){e.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,i,r)},e.TransformCoordinatesFromFloatsToRef=function(e,t,i,r,n){var s=e*(r=r.m)[0]+t*r[4]+i*r[8]+r[12],a=e*r[1]+t*r[5]+i*r[9]+r[13],o=e*r[2]+t*r[6]+i*r[10]+r[14];e=1/(e*r[3]+t*r[7]+i*r[11]+r[15]);n.x=s*e,n.y=a*e,n.z=o*e},e.TransformNormal=function(t,i){var r=e.Zero();return e.TransformNormalToRef(t,i,r),r},e.TransformNormalToRef=function(e,t,i){this.TransformNormalFromFloatsToRef(e._x,e._y,e._z,t,i)},e.TransformNormalFromFloatsToRef=function(e,t,i,r,n){r=r.m,n.x=e*r[0]+t*r[4]+i*r[8],n.y=e*r[1]+t*r[5]+i*r[9],n.z=e*r[2]+t*r[6]+i*r[10]},e.CatmullRom=function(t,i,r,n,s){var a=s*s,o=s*a;return new e(.5*(2*i._x+(-t._x+r._x)*s+(2*t._x-5*i._x+4*r._x-n._x)*a+(-t._x+3*i._x-3*r._x+n._x)*o),.5*(2*i._y+(-t._y+r._y)*s+(2*t._y-5*i._y+4*r._y-n._y)*a+(-t._y+3*i._y-3*r._y+n._y)*o),.5*(2*i._z+(-t._z+r._z)*s+(2*t._z-5*i._z+4*r._z-n._z)*a+(-t._z+3*i._z-3*r._z+n._z)*o))},e.Clamp=function(t,i,r){var n=new e;return e.ClampToRef(t,i,r,n),n},e.ClampToRef=function(e,t,i,r){var n=e._x,s=(n=(n=n>i._x?i._x:n)<t._x?t._x:n,e._y);e=(e=(e=(s=(s=s>i._y?i._y:s)<t._y?t._y:s,e._z))>i._z?i._z:e)<t._z?t._z:e,r.copyFromFloats(n,s,e)},e.CheckExtends=function(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)},e.Hermite=function(t,i,r,n,s){var a=s*s,o=2*(h=s*a)-3*a+1,l=-2*h+3*a,h=(s=h-2*a+s,h-a);return new e(t._x*o+r._x*l+i._x*s+n._x*h,t._y*o+r._y*l+i._y*s+n._y*h,t._z*o+r._z*l+i._z*s+n._z*h)},e.Hermite1stDerivative=function(t,i,r,n,s){var a=e.Zero();return this.Hermite1stDerivativeToRef(t,i,r,n,s,a),a},e.Hermite1stDerivativeToRef=function(e,t,i,r,n,s){var a=n*n;s.x=6*(a-n)*e.x+(3*a-4*n+1)*t.x+6*(-a+n)*i.x+(3*a-2*n)*r.x,s.y=6*(a-n)*e.y+(3*a-4*n+1)*t.y+6*(-a+n)*i.y+(3*a-2*n)*r.y,s.z=6*(a-n)*e.z+(3*a-4*n+1)*t.z+6*(-a+n)*i.z+(3*a-2*n)*r.z},e.Lerp=function(t,i,r){var n=new e(0,0,0);return e.LerpToRef(t,i,r,n),n},e.LerpToRef=function(e,t,i,r){r.x=e._x+(t._x-e._x)*i,r.y=e._y+(t._y-e._y)*i,r.z=e._z+(t._z-e._z)*i},e.Dot=function(e,t){return e._x*t._x+e._y*t._y+e._z*t._z},e.Cross=function(t,i){var r=e.Zero();return e.CrossToRef(t,i,r),r},e.CrossToRef=function(e,t,i){var r=e._y*t._z-e._z*t._y,n=e._z*t._x-e._x*t._z;e=e._x*t._y-e._y*t._x;i.copyFromFloats(r,n,e)},e.Normalize=function(t){var i=e.Zero();return e.NormalizeToRef(t,i),i},e.NormalizeToRef=function(e,t){e.normalizeToRef(t)},e.Project=function(t,i,r,n){var s=new e;return e.ProjectToRef(t,i,r,n,s),s},e.ProjectToRef=function(t,i,r,n,s){var a=n.width,o=n.height,l=n.x,h=(n=n.y,li.Matrix[1]);oi.FromValuesToRef(a/2,0,0,0,0,-o/2,0,0,0,0,.5,0,l+a/2,o/2+n,.5,1,h),l=li.Matrix[0];return i.multiplyToRef(r,l),l.multiplyToRef(h,l),e.TransformCoordinatesToRef(t,l,s),s},e._UnprojectFromInvertedMatrixToRef=function(t,i,r){e.TransformCoordinatesToRef(t,i,r),i=i.m,t=t._x*i[3]+t._y*i[7]+t._z*i[11]+i[15],Qt.WithinEpsilon(t,1)&&r.scaleInPlace(1/t)},e.UnprojectFromTransform=function(e,t,i,r,n){return this.Unproject(e,t,i,r,n,oi.IdentityReadOnly)},e.Unproject=function(t,i,r,n,s,a){var o=e.Zero();return e.UnprojectToRef(t,i,r,n,s,a,o),o},e.UnprojectToRef=function(t,i,r,n,s,a,o){e.UnprojectFloatsToRef(t._x,t._y,t._z,i,r,n,s,a,o)},e.UnprojectFloatsToRef=function(t,i,r,n,s,a,o,l,h){var c=li.Matrix[0];(a=(a.multiplyToRef(o,c),c.multiplyToRef(l,c),c.invert(),li.Vector3[0])).x=t/n*2-1,a.y=-(i/s*2-1),null!=(o=Ne.LastCreatedEngine)&&o.isNDCHalfZRange?a.z=r:a.z=2*r-1,e._UnprojectFromInvertedMatrixToRef(a,c,h)},e.Minimize=function(e,t){return(e=e.clone()).minimizeInPlace(t),e},e.Maximize=function(e,t){return(e=e.clone()).maximizeInPlace(t),e},e.Distance=function(t,i){return Math.sqrt(e.DistanceSquared(t,i))},e.DistanceSquared=function(e,t){var i=e._x-t._x,r=e._y-t._y;return i*i+r*r+(e=e._z-t._z)*e},e.ProjectOnTriangleToRef=function(t,i,r,n,s){var a=li.Vector3[0],o=li.Vector3[1],l=li.Vector3[2],h=li.Vector3[3],c=li.Vector3[4],u=(r.subtractToRef(i,a),n.subtractToRef(i,o),n.subtractToRef(r,l),a.length()),d=o.length(),p=l.length();if(u<ei||d<ei||p<ei)return s.copyFrom(i),e.Distance(t,i);t.subtractToRef(i,c),e.CrossToRef(a,o,h);var f=h.length();if(f<ei)return s.copyFrom(i),e.Distance(t,i);if(h.normalizeFromLength(f),(f=c.length())<ei)return s.copyFrom(i),0;c.normalizeFromLength(f);c=e.Dot(h,c);var m,_=li.Vector3[5],g=li.Vector3[6],y=(_=(_.copyFrom(h).scaleInPlace(-f*c),g.copyFrom(t).addInPlace(_),li.Vector3[4]),li.Vector3[5]),v=li.Vector3[7],b=li.Vector3[8];(u=(_.copyFrom(a).scaleInPlace(1/u),b.copyFrom(o).scaleInPlace(1/d),_.addInPlace(b).scaleInPlace(-1),y.copyFrom(a).scaleInPlace(-1/u),b.copyFrom(l).scaleInPlace(1/p),y.addInPlace(b).scaleInPlace(-1),v.copyFrom(l).scaleInPlace(-1/p),b.copyFrom(o).scaleInPlace(-1/d),v.addInPlace(b).scaleInPlace(-1),li.Vector3[9])).copyFrom(g).subtractInPlace(i),e.CrossToRef(_,u,b),p=e.Dot(b,h),u.copyFrom(g).subtractInPlace(r),e.CrossToRef(y,u,b),d=e.Dot(b,h),u.copyFrom(g).subtractInPlace(n),e.CrossToRef(v,u,b),_=e.Dot(b,h),y=li.Vector3[10],v=0<p&&d<0?(y.copyFrom(a),m=i,r):0<d&&_<0?(y.copyFrom(l),m=r,n):(y.copyFrom(o).scaleInPlace(-1),m=n,i),u=li.Vector3[9],p=li.Vector3[4];return m.subtractToRef(g,b),v.subtractToRef(g,u),e.CrossToRef(b,u,p),e.Dot(p,h)<0?(a=li.Vector3[5],e.CrossToRef(y,p,a),a.normalize(),(d=li.Vector3[9]).copyFrom(m).subtractInPlace(g),(_=d.length())<ei?(s.copyFrom(m),e.Distance(t,m)):(d.normalizeFromLength(_),l=e.Dot(a,d),(r=li.Vector3[7]).copyFrom(g).addInPlace(a.scaleInPlace(_*l)),b.copyFrom(r).subtractInPlace(m),f=y.length(),y.normalizeFromLength(f),o=e.Dot(b,y)/Math.max(f,ei),o=Qt.Clamp(o,0,1),r.copyFrom(m).addInPlace(y.scaleInPlace(o*f)),s.copyFrom(r),e.Distance(t,r))):(s.copyFrom(g),Math.abs(f*c))},e.Center=function(t,i){return e.CenterToRef(t,i,e.Zero())},e.CenterToRef=function(e,t,i){return i.copyFromFloats((e._x+t._x)/2,(e._y+t._y)/2,(e._z+t._z)/2)},e.RotationFromAxis=function(t,i,r){var n=e.Zero();return e.RotationFromAxisToRef(t,i,r,n),n},e.RotationFromAxisToRef=function(e,t,i,r){var n=li.Quaternion[0];ai.RotationQuaternionFromAxisToRef(e,t,i,n),n.toEulerAnglesToRef(r)},e._UpReadOnly=e.Up(),e._LeftHandedForwardReadOnly=e.Forward(!1),e._RightHandedForwardReadOnly=e.Forward(!0),e._RightReadOnly=e.Right(),e._LeftReadOnly=e.Left(),e._ZeroReadOnly=e.Zero(),e}(),si=function(){function e(e,t,i,r){this.x=e,this.y=t,this.z=i,this.w=r}return e.prototype.toString=function(){return"{X: ".concat(this.x," Y: ").concat(this.y," Z: ").concat(this.z," W: ").concat(this.w,"}")},e.prototype.getClassName=function(){return"Vector4"},e.prototype.getHashCode=function(){return 397*(397*(397*ii(this.x)^ii(this.y))^ii(this.z))^ii(this.w)},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return e[t=void 0===t?0:t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},e.prototype.fromArray=function(t,i){return e.FromArrayToRef(t,i=void 0===i?0:i,this),this},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},e.prototype.subtractFromFloats=function(t,i,r,n){return new e(this.x-t,this.y-i,this.z-r,this.w-n)},e.prototype.subtractFromFloatsToRef=function(e,t,i,r,n){return n.x=this.x-e,n.y=this.y-t,n.z=this.z-i,n.w=this.w-r,this},e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z,-this.w)},e.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},e.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=ei),e&&Qt.WithinEpsilon(this.x,e.x,t)&&Qt.WithinEpsilon(this.y,e.y,t)&&Qt.WithinEpsilon(this.z,e.z,t)&&Qt.WithinEpsilon(this.w,e.w,t)},e.prototype.equalsToFloats=function(e,t,i,r){return this.x===e&&this.y===t&&this.z===i&&this.w===r},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},e.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},e.prototype.multiplyByFloats=function(t,i,r,n){return new e(this.x*t,this.y*i,this.z*r,this.w*n)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},e.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.minimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},e.prototype.maximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.prototype.normalize=function(){var e=this.length();return 0===e?this:this.scaleInPlace(1/e)},e.prototype.toVector3=function(){return new ni(this.x,this.y,this.z)},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.copyFromFloats=function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},e.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},e.prototype.setAll=function(e){return this.x=this.y=this.z=this.w=e,this},e.FromArray=function(t,i){return new e(t[i=i||0],t[i+1],t[i+2],t[i+3])},e.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},e.FromFloatArrayToRef=function(t,i,r){e.FromArrayToRef(t,i,r)},e.FromFloatsToRef=function(e,t,i,r,n){n.x=e,n.y=t,n.z=i,n.w=r},e.Zero=function(){return new e(0,0,0,0)},e.One=function(){return new e(1,1,1,1)},e.Normalize=function(t){var i=e.Zero();return e.NormalizeToRef(t,i),i},e.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},e.Minimize=function(e,t){return(e=e.clone()).minimizeInPlace(t),e},e.Maximize=function(e,t){return(e=e.clone()).maximizeInPlace(t),e},e.Distance=function(t,i){return Math.sqrt(e.DistanceSquared(t,i))},e.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z;return i*i+r*r+n*n+(e=e.w-t.w)*e},e.Center=function(t,i){return e.CenterToRef(t,i,e.Zero())},e.CenterToRef=function(e,t,i){return i.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2,(e.w+t.w)/2)},e.TransformCoordinates=function(t,i){var r=e.Zero();return e.TransformCoordinatesToRef(t,i,r),r},e.TransformCoordinatesToRef=function(t,i,r){e.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,i,r)},e.TransformCoordinatesFromFloatsToRef=function(e,t,i,r,n){var s=e*(r=r.m)[0]+t*r[4]+i*r[8]+r[12],a=e*r[1]+t*r[5]+i*r[9]+r[13],o=e*r[2]+t*r[6]+i*r[10]+r[14];e=e*r[3]+t*r[7]+i*r[11]+r[15];n.x=s,n.y=a,n.z=o,n.w=e},e.TransformNormal=function(t,i){var r=e.Zero();return e.TransformNormalToRef(t,i,r),r},e.TransformNormalToRef=function(e,t,i){t=t.m;var r=e.x*t[0]+e.y*t[4]+e.z*t[8],n=e.x*t[1]+e.y*t[5]+e.z*t[9];t=e.x*t[2]+e.y*t[6]+e.z*t[10];i.x=r,i.y=n,i.z=t,i.w=e.w},e.TransformNormalFromFloatsToRef=function(e,t,i,r,n,s){n=n.m,s.x=e*n[0]+t*n[4]+i*n[8],s.y=e*n[1]+t*n[5]+i*n[9],s.z=e*n[2]+t*n[6]+i*n[10],s.w=r},e.FromVector3=function(t,i){return new e(t._x,t._y,t._z,i=void 0===i?0:i)},e}(),ai=function(){function e(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),this._isDirty=!0,this._x=e,this._y=t,this._z=i,this._w=r}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"w",{get:function(){return this._w},set:function(e){this._w=e,this._isDirty=!0},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z," W: ").concat(this._w,"}")},e.prototype.getClassName=function(){return"Quaternion"},e.prototype.getHashCode=function(){return 397*(397*(397*ii(this._x)^ii(this._y))^ii(this._z))^ii(this._w)},e.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},e.prototype.equals=function(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z&&this._w===e._w},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=ei),e&&Qt.WithinEpsilon(this._x,e._x,t)&&Qt.WithinEpsilon(this._y,e._y,t)&&Qt.WithinEpsilon(this._z,e._z,t)&&Qt.WithinEpsilon(this._w,e._w,t)},e.prototype.clone=function(){return new e(this._x,this._y,this._z,this._w)},e.prototype.copyFrom=function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this.w=e._w,this},e.prototype.copyFromFloats=function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},e.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},e.prototype.add=function(t){return new e(this._x+t._x,this._y+t._y,this._z+t._z,this._w+t._w)},e.prototype.addInPlace=function(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this},e.prototype.subtract=function(t){return new e(this._x-t._x,this._y-t._y,this._z-t._z,this._w-t._w)},e.prototype.subtractInPlace=function(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._w-=e._w,this},e.prototype.scale=function(t){return new e(this._x*t,this._y*t,this._z*t,this._w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this._x*e,t.y=this._y*e,t.z=this._z*e,t.w=this._w*e,this},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this._x*e,t.y+=this._y*e,t.z+=this._z*e,t.w+=this._w*e,this},e.prototype.multiply=function(t){var i=new e(0,0,0,1);return this.multiplyToRef(t,i),i},e.prototype.multiplyToRef=function(e,t){var i=this._x*e._w+this._y*e._z-this._z*e._y+this._w*e._x,r=-this._x*e._z+this._y*e._w+this._z*e._x+this._w*e._y,n=this._x*e._y-this._y*e._x+this._z*e._w+this._w*e._z;e=-this._x*e._x-this._y*e._y-this._z*e._z+this._w*e._w;return t.copyFromFloats(i,r,n,e),this},e.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},e.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},e.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.conjugate=function(){return new e(-this._x,-this._y,-this._z,this._w)},e.prototype.invert=function(){var e=this.conjugate(),t=this.lengthSquared();return 0==t||1==t||e.scaleInPlace(1/t),e},e.prototype.invertInPlace=function(){this.conjugateInPlace();var e=this.lengthSquared();return 0==e||1==e||this.scaleInPlace(1/e),this},e.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},e.prototype.length=function(){return Math.sqrt(this.lengthSquared())},e.prototype.normalize=function(){var e=this.length();return 0===e||this.scaleInPlace(1/e),this},e.prototype.normalizeToNew=function(){var e=this.length();return 0===e?this.clone():this.scale(1/e)},e.prototype.toEulerAngles=function(){var e=ni.Zero();return this.toEulerAnglesToRef(e),e},e.prototype.toEulerAnglesToRef=function(e){var t,i,r,n,s=this._z,a=this._x,o=this._y,l=this._w,h=o*s-a*l;return h<-.4999999?(e.y=2*Math.atan2(o,l),e.x=Math.PI/2,e.z=0):.4999999<h?(e.y=2*Math.atan2(o,l),e.x=-Math.PI/2,e.z=0):(t=l*l,i=s*s,r=a*a,n=o*o,e.z=Math.atan2(2*(a*o+s*l),-i-r+n+t),e.x=Math.asin(-2*h),e.y=Math.atan2(2*(s*a+o*l),i-r-n+t)),this},e.prototype.toRotationMatrix=function(e){return oi.FromQuaternionToRef(this,e),this},e.prototype.fromRotationMatrix=function(t){return e.FromRotationMatrixToRef(t,this),this},e.FromRotationMatrix=function(t){var i=new e;return e.FromRotationMatrixToRef(t,i),i},e.FromRotationMatrixToRef=function(e,t){var i,r=(e=e.m)[0],n=e[4],s=e[8],a=e[1],o=e[5],l=e[9],h=e[2],c=e[6],u=r+o+(e=e[10]);0<u?(i=.5/Math.sqrt(u+1),t.w=.25/i,t.x=(c-l)*i,t.y=(s-h)*i,t.z=(a-n)*i):o<r&&e<r?(i=2*Math.sqrt(1+r-o-e),t.w=(c-l)/i,t.x=.25*i,t.y=(n+a)/i,t.z=(s+h)/i):e<o?(i=2*Math.sqrt(1+o-r-e),t.w=(s-h)/i,t.x=(n+a)/i,t.y=.25*i,t.z=(l+c)/i):(i=2*Math.sqrt(1+e-r-o),t.w=(a-n)/i,t.x=(s+h)/i,t.y=(l+c)/i,t.z=.25*i)},e.Dot=function(e,t){return e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w},e.AreClose=function(t,i){return 0<=e.Dot(t,i)},e.SmoothToRef=function(t,i,r,n,s){r=Qt.Clamp(0===n?1:r/n,0,1),e.SlerpToRef(t,i,r,s)},e.Zero=function(){return new e(0,0,0,0)},e.Inverse=function(t){return new e(-t._x,-t._y,-t._z,t._w)},e.InverseToRef=function(e,t){return t.set(-e._x,-e._y,-e._z,e._w),t},e.Identity=function(){return new e(0,0,0,1)},e.IsIdentity=function(e){return e&&0===e._x&&0===e._y&&0===e._z&&1===e._w},e.RotationAxis=function(t,i){return e.RotationAxisToRef(t,i,new e)},e.RotationAxisToRef=function(e,t,i){var r=Math.sin(t/2);return e.normalize(),i.w=Math.cos(t/2),i.x=e._x*r,i.y=e._y*r,i.z=e._z*r,i},e.FromArray=function(t,i){return new e(t[i=i||0],t[i+1],t[i+2],t[i+3])},e.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},e.FromEulerAngles=function(t,i,r){var n=new e;return e.RotationYawPitchRollToRef(i,t,r,n),n},e.FromEulerAnglesToRef=function(t,i,r,n){return e.RotationYawPitchRollToRef(i,t,r,n),n},e.FromEulerVector=function(t){var i=new e;return e.RotationYawPitchRollToRef(t._y,t._x,t._z,i),i},e.FromEulerVectorToRef=function(t,i){return e.RotationYawPitchRollToRef(t._y,t._x,t._z,i),i},e.FromUnitVectorsToRef=function(e,t,i){var r=ni.Dot(e,t)+1;return r<ei?Math.abs(e.x)>Math.abs(e.z)?i.set(-e.y,e.x,0,0):i.set(0,-e.z,e.y,0):(ni.CrossToRef(e,t,hi.Vector3[0]),i.set(hi.Vector3[0].x,hi.Vector3[0].y,hi.Vector3[0].z,r)),i.normalize()},e.RotationYawPitchRoll=function(t,i,r){var n=new e;return e.RotationYawPitchRollToRef(t,i,r,n),n},e.RotationYawPitchRollToRef=function(e,t,i,r){i*=.5,t*=.5,e*=.5;var n=Math.sin(i),s=(i=Math.cos(i),Math.sin(t)),a=(t=Math.cos(t),Math.sin(e));e=Math.cos(e);r.x=e*s*i+a*t*n,r.y=a*t*i-e*s*n,r.z=e*t*n-a*s*i,r.w=e*t*i+a*s*n},e.RotationAlphaBetaGamma=function(t,i,r){var n=new e;return e.RotationAlphaBetaGammaToRef(t,i,r,n),n},e.RotationAlphaBetaGammaToRef=function(e,t,i,r){var n=.5*(i+e);i=.5*(i-e),e=.5*t;r.x=Math.cos(i)*Math.sin(e),r.y=Math.sin(i)*Math.sin(e),r.z=Math.sin(n)*Math.cos(e),r.w=Math.cos(n)*Math.cos(e)},e.RotationQuaternionFromAxis=function(t,i,r){var n=new e(0,0,0,0);return e.RotationQuaternionFromAxisToRef(t,i,r,n),n},e.RotationQuaternionFromAxisToRef=function(t,i,r,n){var s=li.Matrix[0];oi.FromXYZAxesToRef(t.normalize(),i.normalize(),r.normalize(),s),e.FromRotationMatrixToRef(s,n)},e.FromLookDirectionLH=function(t,i){var r=new e;return e.FromLookDirectionLHToRef(t,i,r),r},e.FromLookDirectionLHToRef=function(t,i,r){var n=li.Matrix[0];oi.LookDirectionLHToRef(t,i,n),e.FromRotationMatrixToRef(n,r)},e.FromLookDirectionRH=function(t,i){var r=new e;return e.FromLookDirectionRHToRef(t,i,r),r},e.FromLookDirectionRHToRef=function(t,i,r){var n=li.Matrix[0];return oi.LookDirectionRHToRef(t,i,n),e.FromRotationMatrixToRef(n,r)},e.Slerp=function(t,i,r){var n=e.Identity();return e.SlerpToRef(t,i,r,n),n},e.SlerpToRef=function(e,t,i,r){var n,s,a=e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w,o=!1;a<0&&(o=!0,a=-a),o=.999999<a?(s=1-i,o?-i:i):(a=Math.acos(a),n=1/Math.sin(a),s=Math.sin((1-i)*a)*n,o?-Math.sin(i*a)*n:Math.sin(i*a)*n),r.x=s*e._x+o*t._x,r.y=s*e._y+o*t._y,r.z=s*e._z+o*t._z,r.w=s*e._w+o*t._w},e.Hermite=function(t,i,r,n,s){var a=s*s,o=2*(h=s*a)-3*a+1,l=-2*h+3*a,h=(s=h-2*a+s,h-a);return new e(t._x*o+r._x*l+i._x*s+n._x*h,t._y*o+r._y*l+i._y*s+n._y*h,t._z*o+r._z*l+i._z*s+n._z*h,t._w*o+r._w*l+i._w*s+n._w*h)},e.Hermite1stDerivative=function(t,i,r,n,s){var a=e.Zero();return this.Hermite1stDerivativeToRef(t,i,r,n,s,a),a},e.Hermite1stDerivativeToRef=function(e,t,i,r,n,s){var a=n*n;s.x=6*(a-n)*e.x+(3*a-4*n+1)*t.x+6*(-a+n)*i.x+(3*a-2*n)*r.x,s.y=6*(a-n)*e.y+(3*a-4*n+1)*t.y+6*(-a+n)*i.y+(3*a-2*n)*r.y,s.z=6*(a-n)*e.z+(3*a-4*n+1)*t.z+6*(-a+n)*i.z+(3*a-2*n)*r.z,s.w=6*(a-n)*e.w+(3*a-4*n+1)*t.w+6*(-a+n)*i.w+(3*a-2*n)*r.w},e}(),oi=function(){function e(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,yt.MatrixTrackPrecisionChange&&yt.MatrixTrackedMatrices.push(this),this._m=new yt.MatrixCurrentType(16),this.markAsUpdated()}return Object.defineProperty(e,"Use64Bits",{get:function(){return yt.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),e.prototype.markAsUpdated=function(){this.updateFlag=e._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},e.prototype._updateIdentityStatus=function(e,t,i,r){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=!0),this._isIdentity=e,this._isIdentity3x2=e||i,this._isIdentityDirty=!this._isIdentity&&t,this._isIdentity3x2Dirty=!this._isIdentity3x2&&r},e.prototype.isIdentity=function(){var e;return this._isIdentityDirty&&(this._isIdentityDirty=!1,e=this._m,this._isIdentity=1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]),this._isIdentity},e.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},e.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var e,t=(e=this._m)[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8],c=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],_=u*(e=e[15])-m*d,g=c*e-f*d,y=c*m-f*u;return t*(a*_-o*g+l*y)+i*-(s*_-o*(e=h*e-p*d)+l*(d=h*m-u*p))+r*(s*g-a*e+l*(m=h*f-p*c))+n*-(s*y-a*d+o*m)},e.prototype.toArray=function(){return this._m},e.prototype.asArray=function(){return this._m},e.prototype.invert=function(){return this.invertToRef(this),this},e.prototype.reset=function(){return e.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},e.prototype.add=function(t){var i=new e;return this.addToRef(t,i),i},e.prototype.addToRef=function(e,t){for(var i=this._m,r=t._m,n=e.m,s=0;s<16;s++)r[s]=i[s]+n[s];return t.markAsUpdated(),this},e.prototype.addToSelf=function(e){for(var t=this._m,i=e.m,r=0;r<16;r++)t[r]+=i[r];return this.markAsUpdated(),this},e.prototype.invertToRef=function(t){if(!0===this._isIdentity)return e.IdentityToRef(t),this;var i=(O=this._m)[0],r=O[1],n=O[2],s=O[3],a=O[4],o=O[5],l=O[6],h=O[7],c=O[8],u=O[9],d=O[10],p=O[11],f=O[12],m=O[13],_=O[14],g=d*(O=O[15])-_*p,y=u*O-m*p,v=u*_-m*d,b=c*O-f*p,E=c*_-d*f,x=c*m-f*u,C=o*g-l*y+h*v,w=-(a*g-l*b+h*E),S=a*y-o*b+h*x,T=-(a*v-o*E+l*x);if(0==(P=i*C+r*w+n*S+s*T))return t.copyFrom(this),this;var P=1/P,A=l*O-_*h,R=o*O-m*h,M=o*_-m*l,O=a*O-f*h,I=(_=a*_-f*l,m=a*m-f*o,f=l*p-d*h,o*p-u*h),D=o*d-u*l;p=a*p-c*h,h=a*d-c*l,d=a*u-c*o;return e.FromValuesToRef(C*P,-(r*g-n*y+s*v)*P,(r*A-n*R+s*M)*P,-(r*f-n*I+s*D)*P,w*P,(i*g-n*b+s*E)*P,-(i*A-n*O+s*_)*P,(i*f-n*p+s*h)*P,S*P,-(i*y-r*b+s*x)*P,(i*R-r*O+s*m)*P,-(i*I-r*p+s*d)*P,T*P,(i*v-r*E+n*x)*P,-(i*M-r*_+n*m)*P,(i*D-r*h+n*d)*P,t),this},e.prototype.addAtIndex=function(e,t){return this._m[e]+=t,this.markAsUpdated(),this},e.prototype.multiplyAtIndex=function(e,t){return this._m[e]*=t,this.markAsUpdated(),this},e.prototype.setTranslationFromFloats=function(e,t,i){return this._m[12]=e,this._m[13]=t,this._m[14]=i,this.markAsUpdated(),this},e.prototype.addTranslationFromFloats=function(e,t,i){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=i,this.markAsUpdated(),this},e.prototype.setTranslation=function(e){return this.setTranslationFromFloats(e._x,e._y,e._z)},e.prototype.getTranslation=function(){return new ni(this._m[12],this._m[13],this._m[14])},e.prototype.getTranslationToRef=function(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],this},e.prototype.removeRotationAndScaling=function(){var t=this.m;return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t[12],t[13],t[14],t[15],this),this._updateIdentityStatus(0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]),this},e.prototype.multiply=function(t){var i=new e;return this.multiplyToRef(t,i),i},e.prototype.copyFrom=function(e){return e.copyToArray(this._m),this.updateFlag=e.updateFlag,this._updateIdentityStatus(e._isIdentity,e._isIdentityDirty,e._isIdentity3x2,e._isIdentity3x2Dirty),this},e.prototype.copyToArray=function(e,t){var i=this._m;return e[t=void 0===t?0:t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],this},e.prototype.multiplyToRef=function(e,t){return this._isIdentity?t.copyFrom(e):e._isIdentity?t.copyFrom(this):(this.multiplyToArray(e,t._m,0),t.markAsUpdated()),this},e.prototype.multiplyToArray=function(e,t,i){var r=this._m,n=(e=e.m,r[0]),s=r[1],a=r[2],o=r[3],l=r[4],h=r[5],c=r[6],u=r[7],d=r[8],p=r[9],f=r[10],m=r[11],_=r[12],g=r[13],y=r[14],v=(r=r[15],e[0]),b=e[1],E=e[2],x=e[3],C=e[4],w=e[5],S=e[6],T=e[7],P=e[8],A=e[9],R=e[10],M=e[11],O=e[12],I=e[13],D=e[14];e=e[15];return t[i]=n*v+s*C+a*P+o*O,t[i+1]=n*b+s*w+a*A+o*I,t[i+2]=n*E+s*S+a*R+o*D,t[i+3]=n*x+s*T+a*M+o*e,t[i+4]=l*v+h*C+c*P+u*O,t[i+5]=l*b+h*w+c*A+u*I,t[i+6]=l*E+h*S+c*R+u*D,t[i+7]=l*x+h*T+c*M+u*e,t[i+8]=d*v+p*C+f*P+m*O,t[i+9]=d*b+p*w+f*A+m*I,t[i+10]=d*E+p*S+f*R+m*D,t[i+11]=d*x+p*T+f*M+m*e,t[i+12]=_*v+g*C+y*P+r*O,t[i+13]=_*b+g*w+y*A+r*I,t[i+14]=_*E+g*S+y*R+r*D,t[i+15]=_*x+g*T+y*M+r*e,this},e.prototype.equals=function(e){if(!e)return!1;if((this._isIdentity||e._isIdentity)&&!this._isIdentityDirty&&!e._isIdentityDirty)return this._isIdentity&&e._isIdentity;var t=this.m;e=e.m;return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.getClassName=function(){return"Matrix"},e.prototype.getHashCode=function(){for(var e=ii(this._m[0]),t=1;t<16;t++)e=397*e^ii(this._m[t]);return e},e.prototype.decomposeToTransformNode=function(e){return e.rotationQuaternion=e.rotationQuaternion||new ai,this.decompose(e.scaling,e.rotationQuaternion,e.position)},e.prototype.decompose=function(t,i,r,n){if(this._isIdentity)return r&&r.setAll(0),t&&t.setAll(1),i&&i.copyFromFloats(0,0,0,1),!0;var s,a=this._m;return r&&r.copyFromFloats(a[12],a[13],a[14]),(t=t||li.Vector3[0]).x=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),t.y=Math.sqrt(a[4]*a[4]+a[5]*a[5]+a[6]*a[6]),t.z=Math.sqrt(a[8]*a[8]+a[9]*a[9]+a[10]*a[10]),n?(r=n.scaling.x<0?-1:1,s=n.scaling.y<0?-1:1,n=n.scaling.z<0?-1:1,t.x*=r,t.y*=s,t.z*=n):this.determinant()<=0&&(t.y*=-1),0===t._x||0===t._y||0===t._z?(i&&i.copyFromFloats(0,0,0,1),!1):(i&&(r=1/t._x,s=1/t._y,n=1/t._z,e.FromValuesToRef(a[0]*r,a[1]*r,a[2]*r,0,a[4]*s,a[5]*s,a[6]*s,0,a[8]*n,a[9]*n,a[10]*n,0,0,0,0,1,li.Matrix[0]),ai.FromRotationMatrixToRef(li.Matrix[0],i)),!0)},e.prototype.getRow=function(e){return e<0||3<e?null:(e*=4,new si(this._m[0+e],this._m[1+e],this._m[2+e],this._m[3+e]))},e.prototype.setRow=function(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)},e.prototype.transpose=function(){return e.Transpose(this)},e.prototype.transposeToRef=function(t){return e.TransposeToRef(this,t),this},e.prototype.setRowFromFloats=function(e,t,i,r,n){return e<0||3<e||(e*=4,this._m[0+e]=t,this._m[1+e]=i,this._m[2+e]=r,this._m[3+e]=n,this.markAsUpdated()),this},e.prototype.scale=function(t){var i=new e;return this.scaleToRef(t,i),i},e.prototype.scaleToRef=function(e,t){for(var i=0;i<16;i++)t._m[i]=this._m[i]*e;return t.markAsUpdated(),this},e.prototype.scaleAndAddToRef=function(e,t){for(var i=0;i<16;i++)t._m[i]+=this._m[i]*e;return t.markAsUpdated(),this},e.prototype.toNormalMatrix=function(t){var i=li.Matrix[0];this.invertToRef(i),i.transposeToRef(t),i=t._m;e.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,t)},e.prototype.getRotationMatrix=function(){var t=new e;return this.getRotationMatrixToRef(t),t},e.prototype.getRotationMatrixToRef=function(t){var i=li.Vector3[0];if(!this.decompose(i))return e.IdentityToRef(t),this;var r=this._m,n=1/i._x,s=1/i._y;i=1/i._z;return e.FromValuesToRef(r[0]*n,r[1]*n,r[2]*n,0,r[4]*s,r[5]*s,r[6]*s,0,r[8]*i,r[9]*i,r[10]*i,0,0,0,0,1,t),this},e.prototype.toggleModelMatrixHandInPlace=function(){var e=this._m;e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this.markAsUpdated()},e.prototype.toggleProjectionMatrixHandInPlace=function(){var e=this._m;e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this.markAsUpdated()},e.FromArray=function(t,i){void 0===i&&(i=0);var r=new e;return e.FromArrayToRef(t,i,r),r},e.FromArrayToRef=function(e,t,i){for(var r=0;r<16;r++)i._m[r]=e[r+t];i.markAsUpdated()},e.FromFloat32ArrayToRefScaled=function(e,t,i,r){for(var n=0;n<16;n++)r._m[n]=e[n+t]*i;r.markAsUpdated()},Object.defineProperty(e,"IdentityReadOnly",{get:function(){return e._IdentityReadOnly},enumerable:!1,configurable:!0}),e.FromValuesToRef=function(e,t,i,r,n,s,a,o,l,h,c,u,d,p,f,m,_){var g=_._m;g[0]=e,g[1]=t,g[2]=i,g[3]=r,g[4]=n,g[5]=s,g[6]=a,g[7]=o,g[8]=l,g[9]=h,g[10]=c,g[11]=u,g[12]=d,g[13]=p,g[14]=f,g[15]=m,_.markAsUpdated()},e.FromValues=function(t,i,r,n,s,a,o,l,h,c,u,d,p,f,m,_){var g=new e,y=g._m;return y[0]=t,y[1]=i,y[2]=r,y[3]=n,y[4]=s,y[5]=a,y[6]=o,y[7]=l,y[8]=h,y[9]=c,y[10]=u,y[11]=d,y[12]=p,y[13]=f,y[14]=m,y[15]=_,g.markAsUpdated(),g},e.Compose=function(t,i,r){var n=new e;return e.ComposeToRef(t,i,r,n),n},e.ComposeToRef=function(e,t,i,r){var n=r._m,s=(o=t._x)*(u=o+o),a=o*(d=(h=t._y)+h),o=o*(p=(c=t._z)+c),l=h*d,h=h*p,c=c*p,u=(t=t._w)*u,d=t*d,p=(t=t*p,e._x),f=e._y;e=e._z;n[0]=(1-(l+c))*p,n[1]=(a+t)*p,n[2]=(o-d)*p,n[3]=0,n[4]=(a-t)*f,n[5]=(1-(s+c))*f,n[6]=(h+u)*f,n[7]=0,n[8]=(o+d)*e,n[9]=(h-u)*e,n[10]=(1-(s+l))*e,n[11]=0,n[12]=i._x,n[13]=i._y,n[14]=i._z,n[15]=1,r.markAsUpdated()},e.Identity=function(){var t=e.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return t._updateIdentityStatus(!0),t},e.IdentityToRef=function(t){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(!0)},e.Zero=function(){var t=e.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return t._updateIdentityStatus(!1),t},e.RotationX=function(t){var i=new e;return e.RotationXToRef(t,i),i},e.Invert=function(t){var i=new e;return t.invertToRef(i),i},e.RotationXToRef=function(t,i){var r=Math.sin(t);t=Math.cos(t);e.FromValuesToRef(1,0,0,0,0,t,r,0,0,-r,t,0,0,0,0,1,i),i._updateIdentityStatus(1===t&&0===r)},e.RotationY=function(t){var i=new e;return e.RotationYToRef(t,i),i},e.RotationYToRef=function(t,i){var r=Math.sin(t);t=Math.cos(t);e.FromValuesToRef(t,0,-r,0,0,1,0,0,r,0,t,0,0,0,0,1,i),i._updateIdentityStatus(1===t&&0===r)},e.RotationZ=function(t){var i=new e;return e.RotationZToRef(t,i),i},e.RotationZToRef=function(t,i){var r=Math.sin(t);t=Math.cos(t);e.FromValuesToRef(t,r,0,0,-r,t,0,0,0,0,1,0,0,0,0,1,i),i._updateIdentityStatus(1===t&&0===r)},e.RotationAxis=function(t,i){var r=new e;return e.RotationAxisToRef(t,i,r),r},e.RotationAxisToRef=function(e,t,i){var r=Math.sin(-t),n=1-(t=Math.cos(-t)),s=(e.normalize(),i._m);s[0]=e._x*e._x*n+t,s[1]=e._x*e._y*n-e._z*r,s[2]=e._x*e._z*n+e._y*r,s[3]=0,s[4]=e._y*e._x*n+e._z*r,s[5]=e._y*e._y*n+t,s[6]=e._y*e._z*n-e._x*r,s[7]=0,s[8]=e._z*e._x*n-e._y*r,s[9]=e._z*e._y*n+e._x*r,s[10]=e._z*e._z*n+t,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,i.markAsUpdated()},e.RotationAlignToRef=function(e,t,i){var r=ni.Dot(t,e),n=i._m;r<-.999?(n[0]=-1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1):(t=ni.Cross(t,e),n[0]=t._x*t._x*(e=1/(1+r))+r,n[1]=t._y*t._x*e-t._z,n[2]=t._z*t._x*e+t._y,n[3]=0,n[4]=t._x*t._y*e+t._z,n[5]=t._y*t._y*e+r,n[6]=t._z*t._y*e-t._x,n[7]=0,n[8]=t._x*t._z*e-t._y,n[9]=t._y*t._z*e+t._x,n[10]=t._z*t._z*e+r),n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,i.markAsUpdated()},e.RotationYawPitchRoll=function(t,i,r){var n=new e;return e.RotationYawPitchRollToRef(t,i,r,n),n},e.RotationYawPitchRollToRef=function(e,t,i,r){ai.RotationYawPitchRollToRef(e,t,i,li.Quaternion[0]),li.Quaternion[0].toRotationMatrix(r)},e.Scaling=function(t,i,r){var n=new e;return e.ScalingToRef(t,i,r,n),n},e.ScalingToRef=function(t,i,r,n){e.FromValuesToRef(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1,n),n._updateIdentityStatus(1===t&&1===i&&1===r)},e.Translation=function(t,i,r){var n=new e;return e.TranslationToRef(t,i,r,n),n},e.TranslationToRef=function(t,i,r,n){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,i,r,1,n),n._updateIdentityStatus(0===t&&0===i&&0===r)},e.Lerp=function(t,i,r){var n=new e;return e.LerpToRef(t,i,r,n),n},e.LerpToRef=function(e,t,i,r){for(var n=r._m,s=e.m,a=t.m,o=0;o<16;o++)n[o]=s[o]*(1-i)+a[o]*i;r.markAsUpdated()},e.DecomposeLerp=function(t,i,r){var n=new e;return e.DecomposeLerpToRef(t,i,r,n),n},e.DecomposeLerpToRef=function(t,i,r,n){var s=li.Vector3[0],a=li.Quaternion[0],o=li.Vector3[1],l=(t=(t.decompose(s,a,o),li.Vector3[2]),li.Quaternion[1]),h=li.Vector3[3];i.decompose(t,l,h),i=li.Vector3[4],ni.LerpToRef(s,t,r,i),s=li.Quaternion[2],ai.SlerpToRef(a,l,r,s),t=li.Vector3[5];ni.LerpToRef(o,h,r,t),e.ComposeToRef(i,s,t,n)},e.LookAtLH=function(t,i,r){var n=new e;return e.LookAtLHToRef(t,i,r,n),n},e.LookAtLHToRef=function(t,i,r,n){var s=li.Vector3[0],a=li.Vector3[1],o=li.Vector3[2];0===(i=(i.subtractToRef(t,o),o.normalize(),ni.CrossToRef(r,o,s),s.lengthSquared()))?s.x=1:s.normalizeFromLength(Math.sqrt(i)),ni.CrossToRef(o,s,a),a.normalize(),r=-ni.Dot(s,t),i=-ni.Dot(a,t),t=-ni.Dot(o,t);e.FromValuesToRef(s._x,a._x,o._x,0,s._y,a._y,o._y,0,s._z,a._z,o._z,0,r,i,t,1,n)},e.LookAtRH=function(t,i,r){var n=new e;return e.LookAtRHToRef(t,i,r,n),n},e.LookAtRHToRef=function(t,i,r,n){var s=li.Vector3[0],a=li.Vector3[1],o=li.Vector3[2];0===(i=(t.subtractToRef(i,o),o.normalize(),ni.CrossToRef(r,o,s),s.lengthSquared()))?s.x=1:s.normalizeFromLength(Math.sqrt(i)),ni.CrossToRef(o,s,a),a.normalize(),r=-ni.Dot(s,t),i=-ni.Dot(a,t),t=-ni.Dot(o,t);e.FromValuesToRef(s._x,a._x,o._x,0,s._y,a._y,o._y,0,s._z,a._z,o._z,0,r,i,t,1,n)},e.LookDirectionLH=function(t,i){var r=new e;return e.LookDirectionLHToRef(t,i,r),r},e.LookDirectionLHToRef=function(t,i,r){var n=li.Vector3[0];n.copyFrom(t),n.scaleInPlace(-1),t=li.Vector3[1];ni.CrossToRef(i,n,t),e.FromValuesToRef(t._x,t._y,t._z,0,i._x,i._y,i._z,0,n._x,n._y,n._z,0,0,0,0,1,r)},e.LookDirectionRH=function(t,i){var r=new e;return e.LookDirectionRHToRef(t,i,r),r},e.LookDirectionRHToRef=function(t,i,r){var n=li.Vector3[2];ni.CrossToRef(i,t,n),e.FromValuesToRef(n._x,n._y,n._z,0,i._x,i._y,i._z,0,t._x,t._y,t._z,0,0,0,0,1,r)},e.OrthoLH=function(t,i,r,n,s){var a=new e;return e.OrthoLHToRef(t,i,r,n,a,s),a},e.OrthoLHToRef=function(t,i,r,n,s,a){t=2/t,i=2/i;var o=2/(n-r);n=-(n+r)/(n-r);e.FromValuesToRef(t,0,0,0,0,i,0,0,0,0,o,0,0,0,n,1,s),a&&s.multiplyToRef(ci,s),s._updateIdentityStatus(1==t&&1==i&&1==o&&0==n)},e.OrthoOffCenterLH=function(t,i,r,n,s,a,o){var l=new e;return e.OrthoOffCenterLHToRef(t,i,r,n,s,a,l,o),l},e.OrthoOffCenterLHToRef=function(t,i,r,n,s,a,o,l){e.FromValuesToRef(2/(i-t),0,0,0,0,2/(n-r),0,0,0,0,2/(a-s),0,(t+i)/(t-i),(n+r)/(r-n),-(a+s)/(a-s),1,o),l&&o.multiplyToRef(ci,o),o.markAsUpdated()},e.OrthoOffCenterRH=function(t,i,r,n,s,a,o){var l=new e;return e.OrthoOffCenterRHToRef(t,i,r,n,s,a,l,o),l},e.OrthoOffCenterRHToRef=function(t,i,r,n,s,a,o,l){e.OrthoOffCenterLHToRef(t,i,r,n,s,a,o,l),o._m[10]*=-1},e.PerspectiveLH=function(t,i,r,n,s,a){void 0===a&&(a=0);var o=new e,l=(t=2*r/t,i=2*r/i,(n+r)/(n-r));n=-2*n*r/(n-r),r=Math.tan(a);return e.FromValuesToRef(t,0,0,0,0,i,0,r,0,0,l,1,0,0,n,0,o),s&&o.multiplyToRef(ci,o),o._updateIdentityStatus(!1),o},e.PerspectiveFovLH=function(t,i,r,n,s,a,o){void 0===a&&(a=0),void 0===o&&(o=!1);var l=new e;return e.PerspectiveFovLHToRef(t,i,r,n,l,!0,s,a,o),l},e.PerspectiveFovLHToRef=function(t,i,r,n,s,a,o,l,h){void 0===a&&(a=!0),void 0===l&&(l=0),void 0===h&&(h=!1);t=1/Math.tan(.5*t);var c=a?t/i:t;a=a?t:t*i,t=h&&0===r?-1:0!==n?(n+r)/(n-r):1,i=h&&0===r?2*n:0!==n?-2*n*r/(n-r):-2*r,h=Math.tan(l);e.FromValuesToRef(c,0,0,0,0,a,0,h,0,0,t,1,0,0,i,0,s),o&&s.multiplyToRef(ci,s),s._updateIdentityStatus(!1)},e.PerspectiveFovReverseLHToRef=function(t,i,r,n,s,a,o,l){void 0===a&&(a=!0),void 0===l&&(l=0);t=1/Math.tan(.5*t);var h=a?t/i:t;a=a?t:t*i,t=Math.tan(l);e.FromValuesToRef(h,0,0,0,0,a,0,t,0,0,-r,1,0,0,1,0,s),o&&s.multiplyToRef(ci,s),s._updateIdentityStatus(!1)},e.PerspectiveFovRH=function(t,i,r,n,s,a,o){void 0===a&&(a=0),void 0===o&&(o=!1);var l=new e;return e.PerspectiveFovRHToRef(t,i,r,n,l,!0,s,a,o),l},e.PerspectiveFovRHToRef=function(t,i,r,n,s,a,o,l,h){void 0===a&&(a=!0),void 0===l&&(l=0),void 0===h&&(h=!1);t=1/Math.tan(.5*t);var c=a?t/i:t;a=a?t:t*i,t=h&&0===r?1:0!==n?-(n+r)/(n-r):-1,i=h&&0===r?2*n:0!==n?-2*n*r/(n-r):-2*r,h=Math.tan(l);e.FromValuesToRef(c,0,0,0,0,a,0,h,0,0,t,-1,0,0,i,0,s),o&&s.multiplyToRef(ci,s),s._updateIdentityStatus(!1)},e.PerspectiveFovReverseRHToRef=function(t,i,r,n,s,a,o,l){void 0===a&&(a=!0),void 0===l&&(l=0);t=1/Math.tan(.5*t);var h=a?t/i:t;a=a?t:t*i,t=Math.tan(l);e.FromValuesToRef(h,0,0,0,0,a,0,t,0,0,-r,-1,0,0,-1,0,s),o&&s.multiplyToRef(ci,s),s._updateIdentityStatus(!1)},e.PerspectiveFovWebVRToRef=function(e,t,i,r,n,s,a){void 0===a&&(a=0);n=(n=void 0!==n&&n)?-1:1;var o=Math.tan(e.upDegrees*Math.PI/180),l=Math.tan(e.downDegrees*Math.PI/180),h=Math.tan(e.leftDegrees*Math.PI/180),c=2/(h+(e=Math.tan(e.rightDegrees*Math.PI/180))),u=2/(o+l),d=(a=Math.tan(a),r._m);d[0]=c,d[1]=d[2]=d[3]=d[4]=0,d[5]=u,d[6]=0,d[7]=a,d[8]=(h-e)*c*.5,d[9]=-(o-l)*u*.5,d[10]=-i/(t-i),d[11]=n,d[12]=d[13]=d[15]=0,d[14]=-2*i*t/(i-t),s&&r.multiplyToRef(ci,r),r.markAsUpdated()},e.GetFinalMatrix=function(t,i,r,n,s,a){var o=t.width,l=t.height,h=t.x;t=t.y,a=e.FromValues(o/2,0,0,0,0,-l/2,0,0,0,0,a-s,0,h+o/2,l/2+t,s,1),h=li.Matrix[0];return i.multiplyToRef(r,h),h.multiplyToRef(n,h),h.multiply(a)},e.GetAsMatrix2x2=function(e){return e=[(e=e.m)[0],e[1],e[4],e[5]],yt.MatrixUse64Bits?e:new Float32Array(e)},e.GetAsMatrix3x3=function(e){return e=[(e=e.m)[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]],yt.MatrixUse64Bits?e:new Float32Array(e)},e.Transpose=function(t){var i=new e;return e.TransposeToRef(t,i),i},e.TransposeToRef=function(e,t){var i=t._m,r=e.m;i[0]=r[0],i[1]=r[4],i[2]=r[8],i[3]=r[12],i[4]=r[1],i[5]=r[5],i[6]=r[9],i[7]=r[13],i[8]=r[2],i[9]=r[6],i[10]=r[10],i[11]=r[14],i[12]=r[3],i[13]=r[7],i[14]=r[11],i[15]=r[15],t.markAsUpdated(),t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty)},e.Reflection=function(t){var i=new e;return e.ReflectionToRef(t,i),i},e.ReflectionToRef=function(t,i){t.normalize();var r=t.normal.x,n=t.normal.y,s=t.normal.z,a=-2*r,o=-2*n,l=-2*s;e.FromValuesToRef(a*r+1,o*r,l*r,0,a*n,o*n+1,l*n,0,a*s,o*s,l*s+1,0,a*t.d,o*t.d,l*t.d,1,i)},e.FromXYZAxesToRef=function(t,i,r,n){e.FromValuesToRef(t._x,t._y,t._z,0,i._x,i._y,i._z,0,r._x,r._y,r._z,0,0,0,0,1,n)},e.FromQuaternionToRef=function(e,t){var i=e._x*e._x,r=e._y*e._y,n=e._z*e._z,s=e._x*e._y,a=e._z*e._w,o=e._z*e._x,l=e._y*e._w,h=e._y*e._z;e=e._x*e._w;t._m[0]=1-2*(r+n),t._m[1]=2*(s+a),t._m[2]=2*(o-l),t._m[3]=0,t._m[4]=2*(s-a),t._m[5]=1-2*(n+i),t._m[6]=2*(h+e),t._m[7]=0,t._m[8]=2*(o+l),t._m[9]=2*(h-e),t._m[10]=1-2*(r+i),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t.markAsUpdated()},e._UpdateFlagSeed=0,e._IdentityReadOnly=e.Identity(),e}(),li=function(){function e(){}return e.Vector3=ti.BuildTuple(11,ni.Zero),e.Matrix=ti.BuildTuple(2,oi.Identity),e.Quaternion=ti.BuildTuple(3,ai.Zero),e}(),hi=function(){function e(){}return e.Vector2=ti.BuildTuple(3,ri.Zero),e.Vector3=ti.BuildTuple(13,ni.Zero),e.Vector4=ti.BuildTuple(3,si.Zero),e.Quaternion=ti.BuildTuple(2,ai.Zero),e.Matrix=ti.BuildTuple(8,oi.Identity),e}(),ci=(Vt("BABYLON.Vector2",ri),Vt("BABYLON.Vector3",ni),Vt("BABYLON.Vector4",si),Vt("BABYLON.Matrix",oi),oi.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)),ui=function(){function e(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return e.AddParser=function(e,t){this._BabylonFileParsers[e]=t},e.GetParser=function(e){return this._BabylonFileParsers[e]||null},e.AddIndividualParser=function(e,t){this._IndividualBabylonFileParsers[e]=t},e.GetIndividualParser=function(e){return this._IndividualBabylonFileParsers[e]||null},e.Parse=function(e,t,i,r){for(var n in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,n)&&this._BabylonFileParsers[n](e,t,i,r)},Object.defineProperty(e.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture=e},enumerable:!1,configurable:!0}),e.prototype.getNodes=function(){var e=new Array;return e=(e=(e=(e=e.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach((function(t){return e=e.concat(t.bones)})),e},e._BabylonFileParsers={},e._IndividualBabylonFileParsers={},e}(),di=function(){function e(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.r=e=void 0===e?0:e,this.g=t,this.b=i}return e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},e.prototype.getClassName=function(){return"Color3"},e.prototype.getHashCode=function(){return 397*(397*(255*this.r|0)^(255*this.g|0))^(255*this.b|0)},e.prototype.toArray=function(e,t){return e[t=void 0===t?0:t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},e.prototype.fromArray=function(t,i){return e.FromArrayToRef(t,i=void 0===i?0:i,this),this},e.prototype.toColor4=function(e){return new pi(this.r,this.g,this.b,e=void 0===e?1:e)},e.prototype.asArray=function(){return[this.r,this.g,this.b]},e.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},e.prototype.equalsFloats=function(e,t,i){return this.r===e&&this.g===t&&this.b===i},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this},e.prototype.clampToRef=function(e,t,i){return i.r=Qt.Clamp(this.r,e=void 0===e?0:e,t=void 0===t?1:t),i.g=Qt.Clamp(this.g,e,t),i.b=Qt.Clamp(this.b,e,t),this},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b)},e.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},e.prototype.clone=function(){return new e(this.r,this.g,this.b)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},e.prototype.copyFromFloats=function(e,t,i){return this.r=e,this.g=t,this.b=i,this},e.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},e.prototype.toHexString=function(){var e=Math.round(255*this.r),t=Math.round(255*this.g),i=Math.round(255*this.b);return"#"+Qt.ToHex(e)+Qt.ToHex(t)+Qt.ToHex(i)},e.prototype.toLinearSpace=function(){var t=new e;return this.toLinearSpaceToRef(t),t},e.prototype.toHSV=function(){var t=new e;return this.toHSVToRef(t),t},e.prototype.toHSVToRef=function(e){var t=this.r,i=this.g,r=this.b,n=Math.max(t,i,r),s=Math.min(t,i,r),a=0,o=0,l=n,h=n-s;0!==n&&(o=h/n),n!=s&&(n==t?(a=(i-r)/h,i<r&&(a+=6)):n==i?a=(r-t)/h+2:n==r&&(a=(t-i)/h+4),a*=60),e.r=a,e.g=o,e.b=l},e.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,Jt),e.g=Math.pow(this.g,Jt),e.b=Math.pow(this.b,Jt),this},e.prototype.toGammaSpace=function(){var t=new e;return this.toGammaSpaceToRef(t),t},e.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,$t),e.g=Math.pow(this.g,$t),e.b=Math.pow(this.b,$t),this},e.HSVtoRGBToRef=function(e,t,i,r){e/=60;var n=(t=i*t)*(1-Math.abs(e%2-1)),s=0,a=0,o=0;0<=e&&e<=1?(s=t,a=n):1<=e&&e<=2?(s=n,a=t):2<=e&&e<=3?(a=t,o=n):3<=e&&e<=4?(a=n,o=t):4<=e&&e<=5?(s=n,o=t):5<=e&&e<=6&&(s=t,o=n),e=i-t;r.set(s+e,a+e,o+e)},e.FromHexString=function(t){if("#"!==t.substring(0,1)||7!==t.length)return new e(0,0,0);var i=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16);t=parseInt(t.substring(5,7),16);return e.FromInts(i,r,t)},e.FromArray=function(t,i){return new e(t[i=void 0===i?0:i],t[i+1],t[i+2])},e.FromArrayToRef=function(e,t,i){i.r=e[t=void 0===t?0:t],i.g=e[t+1],i.b=e[t+2]},e.FromInts=function(t,i,r){return new e(t/255,i/255,r/255)},e.Lerp=function(t,i,r){var n=new e(0,0,0);return e.LerpToRef(t,i,r,n),n},e.LerpToRef=function(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i},e.Hermite=function(t,i,r,n,s){var a=s*s,o=2*(h=s*a)-3*a+1,l=-2*h+3*a,h=(s=h-2*a+s,h-a);return new e(t.r*o+r.r*l+i.r*s+n.r*h,t.g*o+r.g*l+i.g*s+n.g*h,t.b*o+r.b*l+i.b*s+n.b*h)},e.Hermite1stDerivative=function(t,i,r,n,s){var a=e.Black();return this.Hermite1stDerivativeToRef(t,i,r,n,s,a),a},e.Hermite1stDerivativeToRef=function(e,t,i,r,n,s){var a=n*n;s.r=6*(a-n)*e.r+(3*a-4*n+1)*t.r+6*(-a+n)*i.r+(3*a-2*n)*r.r,s.g=6*(a-n)*e.g+(3*a-4*n+1)*t.g+6*(-a+n)*i.g+(3*a-2*n)*r.g,s.b=6*(a-n)*e.b+(3*a-4*n+1)*t.b+6*(-a+n)*i.b+(3*a-2*n)*r.b},e.Red=function(){return new e(1,0,0)},e.Green=function(){return new e(0,1,0)},e.Blue=function(){return new e(0,0,1)},e.Black=function(){return new e(0,0,0)},Object.defineProperty(e,"BlackReadOnly",{get:function(){return e._BlackReadOnly},enumerable:!1,configurable:!0}),e.White=function(){return new e(1,1,1)},e.Purple=function(){return new e(.5,0,.5)},e.Magenta=function(){return new e(1,0,1)},e.Yellow=function(){return new e(1,1,0)},e.Gray=function(){return new e(.5,.5,.5)},e.Teal=function(){return new e(0,1,1)},e.Random=function(){return new e(Math.random(),Math.random(),Math.random())},e._BlackReadOnly=e.Black(),e}(),pi=function(){function e(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),this.r=e=void 0===e?0:e,this.g=t,this.b=i,this.a=r}return e.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},e.prototype.asArray=function(){return[this.r,this.g,this.b,this.a]},e.prototype.toArray=function(e,t){return e[t=void 0===t?0:t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},e.prototype.fromArray=function(t,i){return e.FromArrayToRef(t,i=void 0===i?0:i,this),this},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this},e.prototype.clampToRef=function(e,t,i){return i.r=Qt.Clamp(this.r,e=void 0===e?0:e,t=void 0===t?1:t),i.g=Qt.Clamp(this.g,e,t),i.b=Qt.Clamp(this.b,e,t),i.a=Qt.Clamp(this.a,e,t),this},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},e.prototype.getClassName=function(){return"Color4"},e.prototype.getHashCode=function(){return 397*(397*(397*(255*this.r|0)^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},e.prototype.copyFromFloats=function(e,t,i,r){return this.r=e,this.g=t,this.b=i,this.a=r,this},e.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},e.prototype.toHexString=function(e){void 0===e&&(e=!1);var t=Math.round(255*this.r),i=Math.round(255*this.g),r=Math.round(255*this.b);return e?"#"+Qt.ToHex(t)+Qt.ToHex(i)+Qt.ToHex(r):(e=Math.round(255*this.a),"#"+Qt.ToHex(t)+Qt.ToHex(i)+Qt.ToHex(r)+Qt.ToHex(e))},e.prototype.toLinearSpace=function(){var t=new e;return this.toLinearSpaceToRef(t),t},e.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,Jt),e.g=Math.pow(this.g,Jt),e.b=Math.pow(this.b,Jt),e.a=this.a,this},e.prototype.toGammaSpace=function(){var t=new e;return this.toGammaSpaceToRef(t),t},e.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,$t),e.g=Math.pow(this.g,$t),e.b=Math.pow(this.b,$t),e.a=this.a,this},e.FromHexString=function(t){if("#"!==t.substring(0,1)||9!==t.length&&7!==t.length)return new e(0,0,0,0);var i=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16);t=9===t.length?parseInt(t.substring(7,9),16):255;return e.FromInts(i,r,n,t)},e.Lerp=function(t,i,r){var n=new e(0,0,0,0);return e.LerpToRef(t,i,r,n),n},e.LerpToRef=function(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i,r.a=e.a+(t.a-e.a)*i},e.Hermite=function(t,i,r,n,s){var a=s*s,o=2*(h=s*a)-3*a+1,l=-2*h+3*a,h=(s=h-2*a+s,h-a);return new e(t.r*o+r.r*l+i.r*s+n.r*h,t.g*o+r.g*l+i.g*s+n.g*h,t.b*o+r.b*l+i.b*s+n.b*h,t.a*o+r.a*l+i.a*s+n.a*h)},e.Hermite1stDerivative=function(t,i,r,n,s){var a=new e;return this.Hermite1stDerivativeToRef(t,i,r,n,s,a),a},e.Hermite1stDerivativeToRef=function(e,t,i,r,n,s){var a=n*n;s.r=6*(a-n)*e.r+(3*a-4*n+1)*t.r+6*(-a+n)*i.r+(3*a-2*n)*r.r,s.g=6*(a-n)*e.g+(3*a-4*n+1)*t.g+6*(-a+n)*i.g+(3*a-2*n)*r.g,s.b=6*(a-n)*e.b+(3*a-4*n+1)*t.b+6*(-a+n)*i.b+(3*a-2*n)*r.b,s.a=6*(a-n)*e.a+(3*a-4*n+1)*t.a+6*(-a+n)*i.a+(3*a-2*n)*r.a},e.FromColor3=function(t,i){return new e(t.r,t.g,t.b,i=void 0===i?1:i)},e.FromArray=function(t,i){return new e(t[i=void 0===i?0:i],t[i+1],t[i+2],t[i+3])},e.FromArrayToRef=function(e,t,i){i.r=e[t=void 0===t?0:t],i.g=e[t+1],i.b=e[t+2],i.a=e[t+3]},e.FromInts=function(t,i,r,n){return new e(t/255,i/255,r/255,n/255)},e.CheckColors4=function(e,t){if(e.length!==3*t)return e;for(var i=[],r=0;r<e.length;r+=3){var n=r/3*4;i[n]=e[r],i[1+n]=e[r+1],i[2+n]=e[r+2],i[3+n]=1}return i},e}(),fi=(ti.BuildArray(3,di.Black),ti.BuildArray(3,(function(){return new pi(0,0,0,0)})),Vt("BABYLON.Color3",di),Vt("BABYLON.Color4",pi),{}),mi={},_i=function(e,t,i){var r,n=e(),s=(Yt&&Yt.AddTagsTo(n,t.tags),gi(n));for(r in s){var a=s[r],o=t[r];a=a.type;if(null!=o&&("uniqueId"!==r||Ii.AllowLoadingUniqueId))switch(a){case 0:case 6:case 11:n[r]=o;break;case 1:n[r]=i||o.isRenderTarget?o:o.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:n[r]=i?o:o.clone()}}return n};function gi(e){var t=e.getClassName();if(mi[t])return mi[t];mi[t]={};for(var i=mi[t],r=e,n=t;n;){var s,a=fi[n];for(s in a)i[s]=a[s];var o=void 0,l=!1;do{if(!(o=Object.getPrototypeOf(r)).getClassName){l=!0;break}}while(o.getClassName()===n&&(r=o));if(l)break;n=o.getClassName(),r=o}return i}function yi(e,t){return function(i,r){(i=function(e){return e=e.getClassName(),fi[e]||(fi[e]={}),fi[e]}(i))[r]||(i[r]={type:e,sourceName:t})}}function vi(e){return yi(0,e)}function bi(e){return yi(1,e)}function Ei(e){return yi(7,e)}function xi(e){return yi(8,e)}var Ci,wi,Si,Ti,Pi,Ai,Ri,Mi,Oi,Ii=function(){function e(){}return e.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var i=0;i<e.animations.length;i++){var r=e.animations[i];t.animations.push(r.serialize())}}},e.Serialize=function(t,i){i=i||{},Yt&&(i.tags=Yt.GetTags(t));var r,n=gi(t);for(r in n){var s=(a=n[r]).sourceName||r,a=a.type,o=t[r];if(null!=o&&("uniqueId"!==r||e.AllowLoadingUniqueId))switch(a){case 0:i[s]=o;break;case 1:case 3:case 7:case 9:i[s]=o.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:i[s]=o.asArray();break;case 6:case 11:i[s]=o.id}}return i},e.Parse=function(t,i,r,n){void 0===n&&(n=null);var s,a=t(),o=(n=n||"",Yt&&Yt.AddTagsTo(a,i.tags),gi(a));for(s in o){var l=i[(h=o[s]).sourceName||s],h=h.type;if(null!=l&&("uniqueId"!==s||e.AllowLoadingUniqueId)){var c=a;switch(h){case 0:c[s]=l;break;case 1:r&&(c[s]=e._TextureParser(l,r,n));break;case 2:c[s]=di.FromArray(l);break;case 3:c[s]=e._FresnelParametersParser(l);break;case 4:c[s]=ri.FromArray(l);break;case 5:c[s]=ni.FromArray(l);break;case 6:r&&(c[s]=r.getLastMeshById(l));break;case 7:c[s]=e._ColorCurvesParser(l);break;case 8:c[s]=pi.FromArray(l);break;case 9:c[s]=e._ImageProcessingConfigurationParser(l);break;case 10:c[s]=ai.FromArray(l);break;case 11:r&&(c[s]=r.getCameraById(l));break;case 12:c[s]=oi.FromArray(l)}}}return a},e.Clone=function(e,t){return _i(e,t,!1)},e.Instanciate=function(e,t){return _i(e,t,!0)},e.AllowLoadingUniqueId=!1,e._ImageProcessingConfigurationParser=function(e){throw Fe("ImageProcessingConfiguration")},e._FresnelParametersParser=function(e){throw Fe("FresnelParameters")},e._ColorCurvesParser=function(e){throw Fe("ColorCurves")},e._TextureParser=function(e,t,i){throw Fe("Texture")},e}(),Di=function(){function e(e){if(this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&this._setDefaultValue(t)}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),e.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},e.prototype.markAsUnprocessed=function(){this._isDirty=!0},e.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsLightDirty=function(e){void 0===e&&(e=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0},e.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},e.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},e.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},e.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},e.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},e.prototype.rebuild=function(){this._keys=[];for(var e=0,t=Object.keys(this);e<t.length;e++){var i=t[e];"_"!==i[0]&&this._keys.push(i)}if(this._externalProperties)for(var r in this._externalProperties)-1===this._keys.indexOf(r)&&this._keys.push(r)},e.prototype.isEqual=function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var i=this._keys[t];if(this[i]!==e[i])return!1}return!0},e.prototype.cloneTo=function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var i=this._keys[t];e[i]=this[i]}},e.prototype.reset=function(){var e=this;this._keys.forEach((function(t){return e._setDefaultValue(t)}))},e.prototype._setDefaultValue=function(e){var t,i=null!=(i=null==(i=null==(i=this._externalProperties)?void 0:i[e])?void 0:i.type)?i:typeof this[e],r=null==(t=null==(t=this._externalProperties)?void 0:t[e])?void 0:t.default;switch(i){case"number":this[e]=null!=r?r:0;break;case"string":this[e]=null!=r?r:"";break;default:this[e]=null!=r&&r}},e.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var i=this._keys[t],r=this[i];switch(typeof r){case"number":case"string":e+="#define "+i+" "+r+"\n";break;default:r&&(e+="#define "+i+"\n")}}return e},e}(),Fi=function(){function e(){this._dirty=!0,this._tempColor=new pi(0,0,0,0),this._globalCurve=new pi(0,0,0,0),this._highlightsCurve=new pi(0,0,0,0),this._midtonesCurve=new pi(0,0,0,0),this._shadowsCurve=new pi(0,0,0,0),this._positiveCurve=new pi(0,0,0,0),this._negativeCurve=new pi(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(e.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"ColorCurves"},e.Bind=function(e,t,i,r,n){void 0===i&&(i="vCameraColorCurvePositive"),void 0===r&&(r="vCameraColorCurveNeutral"),void 0===n&&(n="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(r,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(n,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},e.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},e.prototype._getColorGradingDataToRef=function(t,i,r,n,s){null!=t&&(t=e._Clamp(t,0,360),i=e._Clamp(i,-100,100),r=e._Clamp(r,-100,100),n=e._Clamp(n,-100,100),i=e._ApplyColorGradingSliderNonlinear(i),i*=.5,n=e._ApplyColorGradingSliderNonlinear(n),i<0&&(i*=-1,t=(t+180)%360),e._FromHSBToRef(t,i,50+.25*n,s),s.scaleToRef(2,s),s.a=1+.01*r)},e._ApplyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);t=Math.pow(t,2);return e<0&&(t*=-1),100*t},e._FromHSBToRef=function(t,i,r,n){t=e._Clamp(t,0,360),i=e._Clamp(i/100,0,1);var s=e._Clamp(r/100,0,1);if(0===i)n.r=s,n.g=s,n.b=s;else{var a=s*(1-i),o=s*(1-i*(t=(t/=60)-(r=Math.floor(t)))),l=s*(1-i*(1-t));switch(r){case 0:n.r=s,n.g=l,n.b=a;break;case 1:n.r=o,n.g=s,n.b=a;break;case 2:n.r=a,n.g=s,n.b=l;break;case 3:n.r=a,n.g=o,n.b=s;break;case 4:n.r=l,n.g=a,n.b=s;break;default:n.r=s,n.g=a,n.b=o}}n.a=1},e._Clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},e.prototype.clone=function(){return Ii.Clone((function(){return new e}),this)},e.prototype.serialize=function(){return Ii.Serialize(this)},e.Parse=function(t){return Ii.Parse((function(){return new e}),t,null,null)},y([vi()],e.prototype,"_globalHue",void 0),y([vi()],e.prototype,"_globalDensity",void 0),y([vi()],e.prototype,"_globalSaturation",void 0),y([vi()],e.prototype,"_globalExposure",void 0),y([vi()],e.prototype,"_highlightsHue",void 0),y([vi()],e.prototype,"_highlightsDensity",void 0),y([vi()],e.prototype,"_highlightsSaturation",void 0),y([vi()],e.prototype,"_highlightsExposure",void 0),y([vi()],e.prototype,"_midtonesHue",void 0),y([vi()],e.prototype,"_midtonesDensity",void 0),y([vi()],e.prototype,"_midtonesSaturation",void 0),y([vi()],e.prototype,"_midtonesExposure",void 0),e}(),Li=(Ii._ColorCurvesParser=Fi.Parse,c((function(){var e=Oi.call(this)||this;return e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.SKIPFINALCOLORCLAMP=!1,e.rebuild(),e}),Oi=Di),function(){function e(){this.colorCurves=new Fi,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=e.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new pi(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=e.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new we}return Object.defineProperty(e.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skipFinalColorClamp",{get:function(){return this._skipFinalColorClamp},set:function(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),e.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},e.prototype.getClassName=function(){return"ImageProcessingConfiguration"},e.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),t.VIGNETTE&&(e.push("vInverseScreenSize"),e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&Fi.PrepareUniforms(e)},e.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},e.prototype.prepareDefines=function(t,i){if((i=void 0!==i&&i)!==this.applyByPostProcess||!this._isEnabled)return t.VIGNETTE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.IMAGEPROCESSING=!1,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===e._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,t.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType===e.TONEMAPPING_ACES?t.TONEMAPPING_ACES=!0:t.TONEMAPPING_ACES=!1,t.CONTRAST=1!==this.contrast,t.EXPOSURE=1!==this.exposure,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,t.IMAGEPROCESSING=t.VIGNETTE||t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING},e.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},e.prototype.bind=function(e,t){var i,r;this._colorCurvesEnabled&&this.colorCurves&&Fi.Bind(this.colorCurves,e),this._vignetteEnabled&&(r=1/e.getEngine().getRenderWidth(),i=1/e.getEngine().getRenderHeight(),e.setFloat2("vInverseScreenSize",r,i),t=null!=t?t:i/r,r=(i=Math.tan(.5*this.vignetteCameraFov))*t,t=Math.sqrt(r*i),r=Wt.Mix(r,t,this.vignetteStretch),i=Wt.Mix(i,t,this.vignetteStretch),e.setFloat4("vignetteSettings1",r,i,-r*this.vignetteCentreX,-i*this.vignetteCentreY),t=-2*this.vignetteWeight,e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,t)),e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture&&(e.setTexture("txColorTransform",this.colorGradingTexture),r=this.colorGradingTexture.getSize().height,e.setFloat4("colorTransformSettings",(r-1)/r,.5/r,r,this.colorGradingTexture.level))},e.prototype.clone=function(){return Ii.Clone((function(){return new e}),this)},e.prototype.serialize=function(){return Ii.Serialize(this)},e.Parse=function(t){return Ii.Parse((function(){return new e}),t,null,null)},Object.defineProperty(e,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),e.TONEMAPPING_STANDARD=0,e.TONEMAPPING_ACES=1,e._VIGNETTEMODE_MULTIPLY=0,e._VIGNETTEMODE_OPAQUE=1,y([Ei()],e.prototype,"colorCurves",void 0),y([vi()],e.prototype,"_colorCurvesEnabled",void 0),y([bi("colorGradingTexture")],e.prototype,"_colorGradingTexture",void 0),y([vi()],e.prototype,"_colorGradingEnabled",void 0),y([vi()],e.prototype,"_colorGradingWithGreenDepth",void 0),y([vi()],e.prototype,"_colorGradingBGR",void 0),y([vi()],e.prototype,"_exposure",void 0),y([vi()],e.prototype,"_toneMappingEnabled",void 0),y([vi()],e.prototype,"_toneMappingType",void 0),y([vi()],e.prototype,"_contrast",void 0),y([vi()],e.prototype,"vignetteStretch",void 0),y([vi()],e.prototype,"vignetteCentreX",void 0),y([vi()],e.prototype,"vignetteCentreY",void 0),y([vi()],e.prototype,"vignetteWeight",void 0),y([xi()],e.prototype,"vignetteColor",void 0),y([vi()],e.prototype,"vignetteCameraFov",void 0),y([vi()],e.prototype,"_vignetteBlendMode",void 0),y([vi()],e.prototype,"_vignetteEnabled",void 0),y([vi()],e.prototype,"_skipFinalColorClamp",void 0),y([vi()],e.prototype,"_applyByPostProcess",void 0),y([vi()],e.prototype,"_isEnabled",void 0),e}()),ki=(Ii._ImageProcessingConfigurationParser=Li.Parse,Ct.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");return t=new _t(t),this.bindUniformBuffer(t),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),t.references=1,t},Ct.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");return t=new _t(t),this.bindUniformBuffer(t),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),t.references=1,t},Ct.prototype.updateUniformBuffer=function(e,t,i,r){this.bindUniformBuffer(e),void 0===i&&(i=0),void 0===r?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(i,i+r)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(i,i+r)),this.bindUniformBuffer(null)},Ct.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},Ct.prototype.bindUniformBufferBase=function(e,t,i){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},Ct.prototype.bindUniformBlock=function(e,t,i){e=e.program,4294967295!==(t=this._gl.getUniformBlockIndex(e,t))&&this._gl.uniformBlockBinding(e,t,i)},function(){function e(e,t,i,r,n){void 0===n&&(n=!1),this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers||n,this._dynamic=i,this._name=null!=r?r:"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform)}return Object.defineProperty(e.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),e.prototype.isDynamic=function(){return void 0!==this._dynamic},e.prototype.getData=function(){return this._bufferData},e.prototype.getBuffer=function(){return this._buffer},e.prototype._fillAlignment=function(e){if(e=e<=2?e:4,this._uniformLocationPointer%e!=0)for(var t=this._uniformLocationPointer,i=(this._uniformLocationPointer+=e-this._uniformLocationPointer%e,this._uniformLocationPointer-t),r=0;r<i;r++)this._data.push(0)},e.prototype.addUniform=function(e,t,i){if(void 0===i&&(i=0),!this._noUBO&&void 0===this._uniformLocations[e]){if(0<i){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:i},16==t?t*=i:t=t*i+(4-t)*i;for(var r=[],n=0;n<t;n++)r.push(0)}else{if(t instanceof Array)t=(r=t).length;else for(r=[],n=0;n<t;n++)r.push(0);this._fillAlignment(t)}for(this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t,n=0;n<t;n++)this._data.push(r[n]);this._needSync=!0}},e.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},e.prototype.addFloat2=function(e,t,i){this.addUniform(e,[t,i])},e.prototype.addFloat3=function(e,t,i,r){this.addUniform(e,[t,i,r])},e.prototype.addColor3=function(e,t){t=[t.r,t.g,t.b],this.addUniform(e,t)},e.prototype.addColor4=function(e,t,i){t=[t.r,t.g,t.b,i],this.addUniform(e,t)},e.prototype.addVector3=function(e,t){t=[t.x,t.y,t.z],this.addUniform(e,t)},e.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},e.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},e.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},e.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))},Object.defineProperty(e.prototype,"_numBuffers",{get:function(){return this._buffers.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_indexBuffer",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),e.prototype._buffersEqual=function(e,t){for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0},e.prototype._copyBuffer=function(e,t){for(var i=0;i<e.length;++i)t[i]=e[i]},e.prototype.update=function(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&1<this._buffers.length&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(e._UpdatedUbosInFrame[this._name]||(e._UpdatedUbosInFrame[this._name]=0),e._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()},e.prototype._createNewBuffer=function(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()},e.prototype._checkNewFrame=function(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&0<this._buffers.length?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)},e.prototype.updateUniform=function(e,t,i){this._checkNewFrame();var r=this._uniformLocations[e];if(void 0===r){if(this._buffer)return void Me.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,i),r=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(s=0;s<i;s++)this._bufferData[r+s]=t[s];else{for(var n=!1,s=0;s<i;s++)(16!==i||this._engine._features.uniformBufferHardCheckMatrix)&&this._bufferData[r+s]===Wt.FloatRound(t[s])||(n=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[r+s]=t[s]);this._needSync=this._needSync||n}},e.prototype.updateUniformArray=function(e,t,i){this._checkNewFrame();var r=this._uniformLocations[e];if(void 0===r)Me.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform.");else{this._buffer||this.create();var n=this._uniformArraySizes[e];if(this._dynamic)for(l=0;l<i;l++)this._bufferData[r+l]=t[l];else{for(var s=!1,a=0,o=0,l=0;l<i;l++)if(this._bufferData[r+4*o+a]!==Wt.FloatRound(t[l])&&(s=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[r+4*o+a]=t[l]),++a===n.strideSize){for(;a<4;a++)this._bufferData[r+4*o+a]=0;a=0,o++}this._needSync=this._needSync||s}}},e.prototype._cacheMatrix=function(e,t){this._checkNewFrame();var i=this._valueCache[e];t=t.updateFlag;return(void 0===i||i!==t)&&(this._valueCache[e]=t,!0)},e.prototype._updateMatrix3x3ForUniform=function(t,i){for(var r=0;r<3;r++)e._TempBuffer[4*r]=i[3*r],e._TempBuffer[4*r+1]=i[3*r+1],e._TempBuffer[4*r+2]=i[3*r+2],e._TempBuffer[4*r+3]=0;this.updateUniform(t,e._TempBuffer,12)},e.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},e.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},e.prototype._updateMatrix2x2ForUniform=function(t,i){for(var r=0;r<2;r++)e._TempBuffer[4*r]=i[2*r],e._TempBuffer[4*r+1]=i[2*r+1],e._TempBuffer[4*r+2]=0,e._TempBuffer[4*r+3]=0;this.updateUniform(t,e._TempBuffer,8)},e.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},e.prototype._updateFloatForUniform=function(t,i){e._TempBuffer[0]=i,this.updateUniform(t,e._TempBuffer,1)},e.prototype._updateFloat2ForEffect=function(e,t,i,r){this._currentEffect.setFloat2(e+(r=void 0===r?"":r),t,i)},e.prototype._updateFloat2ForUniform=function(t,i,r){e._TempBuffer[0]=i,e._TempBuffer[1]=r,this.updateUniform(t,e._TempBuffer,2)},e.prototype._updateFloat3ForEffect=function(e,t,i,r,n){this._currentEffect.setFloat3(e+(n=void 0===n?"":n),t,i,r)},e.prototype._updateFloat3ForUniform=function(t,i,r,n){e._TempBuffer[0]=i,e._TempBuffer[1]=r,e._TempBuffer[2]=n,this.updateUniform(t,e._TempBuffer,3)},e.prototype._updateFloat4ForEffect=function(e,t,i,r,n,s){this._currentEffect.setFloat4(e+(s=void 0===s?"":s),t,i,r,n)},e.prototype._updateFloat4ForUniform=function(t,i,r,n,s){e._TempBuffer[0]=i,e._TempBuffer[1]=r,e._TempBuffer[2]=n,e._TempBuffer[3]=s,this.updateUniform(t,e._TempBuffer,4)},e.prototype._updateFloatArrayForEffect=function(e,t){this._currentEffect.setFloatArray(e,t)},e.prototype._updateFloatArrayForUniform=function(e,t){this.updateUniformArray(e,t,t.length)},e.prototype._updateArrayForEffect=function(e,t){this._currentEffect.setArray(e,t)},e.prototype._updateArrayForUniform=function(e,t){this.updateUniformArray(e,t,t.length)},e.prototype._updateIntArrayForEffect=function(e,t){this._currentEffect.setIntArray(e,t)},e.prototype._updateIntArrayForUniform=function(t,i){e._TempBufferInt32View.set(i),this.updateUniformArray(t,e._TempBuffer,i.length)},e.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},e.prototype._updateMatrixForUniform=function(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.toArray(),16)},e.prototype._updateMatricesForEffect=function(e,t){this._currentEffect.setMatrices(e,t)},e.prototype._updateMatricesForUniform=function(e,t){this.updateUniform(e,t,t.length)},e.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},e.prototype._updateVector3ForUniform=function(t,i){e._TempBuffer[0]=i.x,e._TempBuffer[1]=i.y,e._TempBuffer[2]=i.z,this.updateUniform(t,e._TempBuffer,3)},e.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},e.prototype._updateVector4ForUniform=function(t,i){e._TempBuffer[0]=i.x,e._TempBuffer[1]=i.y,e._TempBuffer[2]=i.z,e._TempBuffer[3]=i.w,this.updateUniform(t,e._TempBuffer,4)},e.prototype._updateColor3ForEffect=function(e,t,i){this._currentEffect.setColor3(e+(i=void 0===i?"":i),t)},e.prototype._updateColor3ForUniform=function(t,i){e._TempBuffer[0]=i.r,e._TempBuffer[1]=i.g,e._TempBuffer[2]=i.b,this.updateUniform(t,e._TempBuffer,3)},e.prototype._updateColor4ForEffect=function(e,t,i,r){this._currentEffect.setColor4(e+(r=void 0===r?"":r),t,i)},e.prototype._updateDirectColor4ForEffect=function(e,t,i){this._currentEffect.setDirectColor4(e+(i=void 0===i?"":i),t)},e.prototype._updateColor4ForUniform=function(t,i,r){e._TempBuffer[0]=i.r,e._TempBuffer[1]=i.g,e._TempBuffer[2]=i.b,e._TempBuffer[3]=r,this.updateUniform(t,e._TempBuffer,4)},e.prototype._updateDirectColor4ForUniform=function(t,i){e._TempBuffer[0]=i.r,e._TempBuffer[1]=i.g,e._TempBuffer[2]=i.b,e._TempBuffer[3]=i.a,this.updateUniform(t,e._TempBuffer,4)},e.prototype._updateIntForEffect=function(e,t,i){this._currentEffect.setInt(e+(i=void 0===i?"":i),t)},e.prototype._updateIntForUniform=function(t,i){e._TempBufferInt32View[0]=i,this.updateUniform(t,e._TempBuffer,1)},e.prototype._updateInt2ForEffect=function(e,t,i,r){this._currentEffect.setInt2(e+(r=void 0===r?"":r),t,i)},e.prototype._updateInt2ForUniform=function(t,i,r){e._TempBufferInt32View[0]=i,e._TempBufferInt32View[1]=r,this.updateUniform(t,e._TempBuffer,2)},e.prototype._updateInt3ForEffect=function(e,t,i,r,n){this._currentEffect.setInt3(e+(n=void 0===n?"":n),t,i,r)},e.prototype._updateInt3ForUniform=function(t,i,r,n){e._TempBufferInt32View[0]=i,e._TempBufferInt32View[1]=r,e._TempBufferInt32View[2]=n,this.updateUniform(t,e._TempBuffer,3)},e.prototype._updateInt4ForEffect=function(e,t,i,r,n,s){this._currentEffect.setInt4(e+(s=void 0===s?"":s),t,i,r,n)},e.prototype._updateInt4ForUniform=function(t,i,r,n,s){e._TempBufferInt32View[0]=i,e._TempBufferInt32View[1]=r,e._TempBufferInt32View[2]=n,e._TempBufferInt32View[3]=s,this.updateUniform(t,e._TempBuffer,4)},e.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},e.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},e.prototype.bindToEffect=function(e,t){this._currentEffect=e,this._currentEffectName=t},e.prototype.bindUniformBuffer=function(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)},e.prototype.unbindEffect=function(){this._currentEffect=void 0,this._currentEffectName=void 0},e.prototype.setDataBuffer=function(e){if(!this._buffers)return this._buffer===e;for(var t=0;t<this._buffers.length;++t)if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,!(this._currentEffect=void 0);return!1},e.prototype.dispose=function(){if(!this._noUBO){var e=this._engine._uniformBuffers,t=e.indexOf(this);if(-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(var i=0;i<this._buffers.length;++i){var r=this._buffers[i][0];this._engine._releaseBuffer(r)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},e._UpdatedUbosInFrame={},e._MAX_UNIFORM_SIZE=256,e._TempBuffer=new Float32Array(e._MAX_UNIFORM_SIZE),e._TempBufferInt32View=new Uint32Array(e._TempBuffer.buffer),e}()),Bi=function(){function e(e,t,i,r,n,s,a,o){void 0===r&&(r=0),void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),this._isAlreadyOwned=!1,e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=i,this._instanced=s,this._divisor=o||1,t instanceof mt?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=a?r:r*Float32Array.BYTES_PER_ELEMENT,n||this.create()}return e.prototype.createVertexBuffer=function(e,t,i,r,n,s,a){return t=(s=void 0!==s&&s)?t:t*Float32Array.BYTES_PER_ELEMENT,s=r?s?r:r*Float32Array.BYTES_PER_ELEMENT:this.byteStride,new Ni(this._engine,this,e,this._updatable,!0,s,void 0===n?this._instanced:n,t,i,void 0,void 0,!0,this._divisor||a)},e.prototype.isUpdatable=function(){return this._updatable},e.prototype.getData=function(){return this._data},e.prototype.getBuffer=function(){return this._buffer},e.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},e.prototype.create=function(e){!(e=void 0===e?null:e)&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},e.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},e.prototype.update=function(e){this.create(e)},e.prototype.updateDirectly=function(e,t,i,r){void 0===r&&(r=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,r?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=0===t&&void 0===i?e:null)},e.prototype._increaseReferences=function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)},e.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)},e}(),Ni=function(){function e(t,i,r,n,s,a,o,l,h,c,u,d,p,f){void 0===u&&(u=!1),void 0===d&&(d=!1),void 0===p&&(p=1),void 0===f&&(f=!1),i instanceof Bi?(this._buffer=i,this._ownsBuffer=f):(this._buffer=new Bi(t,i,n,a,s,o,d),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=r,null==c?(f=this.getData(),this.type=e.FLOAT,f instanceof Int8Array?this.type=e.BYTE:f instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:f instanceof Int16Array?this.type=e.SHORT:f instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:f instanceof Int32Array?this.type=e.INT:f instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)):this.type=c,t=e.GetTypeByteLength(this.type),d?(this._size=h||(a?a/t:e.DeduceStride(r)),this.byteStride=a||this._buffer.byteStride||this._size*t,this.byteOffset=l||0):(this._size=h||a||e.DeduceStride(r),this.byteStride=a?a*t:this._buffer.byteStride||this._size*t,this.byteOffset=(l||0)*t),this.normalized=u,this._instanced=void 0!==o&&o,this._instanceDivisor=o?p:0,this._computeHashCode()}return Object.defineProperty(e.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e,this._computeHashCode()},enumerable:!1,configurable:!0}),e.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},e.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getFloatData=function(t,i){var r=this.getData();if(!r)return null;var n,s=this.getSize()*e.GetTypeByteLength(this.type);t*=this.getSize();if(this.type!==e.FLOAT||this.byteStride!==s)return n=new Float32Array(t),this.forEach(t,(function(e,t){return n[t]=e})),n;if((r instanceof Array||r instanceof Float32Array)&&0===this.byteOffset&&r.length===t)return i?r.slice():r;if(r instanceof Array)return a=this.byteOffset/4,r.slice(a,a+t);if(r instanceof ArrayBuffer)return new Float32Array(r,this.byteOffset,t);var a=r.byteOffset+this.byteOffset;return i?(s=new Float32Array(t),i=new Float32Array(r.buffer,a,t),s.set(i),s):((i=a%4)&&(a=Math.max(0,a-i)),new Float32Array(r.buffer,a,t))},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this.byteStride/e.GetTypeByteLength(this.type)},e.prototype.getOffset=function(){return this.byteOffset/e.GetTypeByteLength(this.type)},e.prototype.getSize=function(t){return(t=void 0!==t&&t)?this._size*e.GetTypeByteLength(this.type):this._size},e.prototype.getIsInstanced=function(){return this._instanced},e.prototype.getInstanceDivisor=function(){return this._instanceDivisor},e.prototype.create=function(e){this._buffer.create(e)},e.prototype.update=function(e){this._buffer.update(e)},e.prototype.updateDirectly=function(e,t,i){this._buffer.updateDirectly(e,t,void 0,i=void 0!==i&&i)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},e.prototype.forEach=function(t,i){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,i)},e.DeduceStride=function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}},e.GetTypeByteLength=function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '".concat(t,"'"))}},e.ForEach=function(t,i,r,n,s,a,o,l){if(t instanceof Array)for(var h=i/4,c=r/4,u=0;u<a;u+=n){for(var d=0;d<n;d++)l(t[h+d],u+d);h+=c}else{var p=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),f=e.GetTypeByteLength(s);for(u=0;u<a;u+=n){var m=i;for(d=0;d<n;d++)l(e._GetFloatValue(p,s,m,o),u+d),m+=f;i+=r}}},e._GetFloatValue=function(t,i,r,n){switch(i){case e.BYTE:var s=t.getInt8(r);return n?Math.max(s/127,-1):s;case e.UNSIGNED_BYTE:return s=t.getUint8(r),n&&(s/=255),s;case e.SHORT:return s=t.getInt16(r,!0),n?Math.max(s/32767,-1):s;case e.UNSIGNED_SHORT:return s=t.getUint16(r,!0),n&&(s/=65535),s;case e.INT:return t.getInt32(r,!0);case e.UNSIGNED_INT:return t.getUint32(r,!0);case e.FLOAT:return t.getFloat32(r,!0);default:throw new Error("Invalid component type ".concat(i))}},e._Counter=0,e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.ColorInstanceKind="instanceColor",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e}(),zi=function(){function e(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}return e.prototype.getNormal=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(Ni.NormalKind))return null;var i,r,n=this.pickedMesh.getIndices();return n?(i=t?(t=this.pickedMesh.getVerticesData(Ni.NormalKind),i=ni.FromArray(t,3*n[3*this.faceId]),r=ni.FromArray(t,3*n[3*this.faceId+1]),t=ni.FromArray(t,3*n[3*this.faceId+2]),i=i.scale(this.bu),r=r.scale(this.bv),t=t.scale(1-this.bu-this.bv),new ni(i.x+r.x+t.x,i.y+r.y+t.y,i.z+r.z+t.z)):(i=this.pickedMesh.getVerticesData(Ni.PositionKind),r=ni.FromArray(i,3*n[3*this.faceId]),t=ni.FromArray(i,3*n[3*this.faceId+1]),i=ni.FromArray(i,3*n[3*this.faceId+2]),n=r.subtract(t),r=i.subtract(t),ni.Cross(n,r)),e&&(t=this.pickedMesh.getWorldMatrix(),this.pickedMesh.nonUniformScaling&&(hi.Matrix[0].copyFrom(t),(t=hi.Matrix[0]).setTranslationFromFloats(0,0,0),t.invert(),t.transposeToRef(hi.Matrix[1]),t=hi.Matrix[1]),i=ni.TransformNormal(i,t)),i.normalize(),i):null},e.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(Ni.UVKind))return null;var e=this.pickedMesh.getIndices();if(!e)return null;if(!(r=this.pickedMesh.getVerticesData(Ni.UVKind)))return null;var t=ri.FromArray(r,2*e[3*this.faceId]),i=ri.FromArray(r,2*e[3*this.faceId+1]),r=ri.FromArray(r,2*e[3*this.faceId+2]);t=t.scale(this.bu),i=i.scale(this.bv),r=r.scale(1-this.bu-this.bv);return new ri(t.x+i.x+r.x,t.y+i.y+r.y)},e}(),Ui=function(){function e(e,t,i,r,n,s){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=r,this.sourceEvent=n,this.additionalData=s}return e.CreateNew=function(t,i,r){var n=t.getScene();return new e(t,n.pointerX,n.pointerY,n.meshUnderPointer||t,i,r)},e.CreateNewFromSprite=function(t,i,r,n){return new e(t,i.pointerX,i.pointerY,i.meshUnderPointer,r,n)},e.CreateNewFromScene=function(t,i){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,i)},e.CreateNewFromPrimitive=function(t,i,r,n){return new e(t,i.x,i.y,null,r,n)},e}(),Gi=function(){function e(e){this._vertexBuffers={},this._scene=e}return e.prototype._prepareBuffers=function(){var e;this._vertexBuffers[Ni.PositionKind]||((e=[]).push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[Ni.PositionKind]=new Ni(this._scene.getEngine(),e,Ni.PositionKind,!1,!1,2),this._buildIndexBuffer())},e.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},e.prototype._rebuild=function(){var e=this._vertexBuffers[Ni.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())},e.prototype._prepareFrame=function(e,t){void 0===e&&(e=null);var i=this._scene.activeCamera;return!(!i||!(t=(t=void 0===t?null:t)||i._postProcesses.filter((function(e){return null!=e})))||0===t.length||!this._scene.postProcessesEnabled||(t[0].activate(i,e,null!=t),0))},e.prototype.directRender=function(e,t,i,r,n,s){void 0===t&&(t=null),void 0===i&&(i=!1),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=!1);for(var a=this._scene.getEngine(),o=0;o<e.length;o++){o<e.length-1?e[o+1].activate(this._scene.activeCamera,null==t?void 0:t.texture):(t?a.bindFramebuffer(t,r,void 0,void 0,i,n):s||a.restoreDefaultFramebuffer(),null!=(l=a._debugInsertMarker)&&l.call(a,"post process ".concat(e[o].name," output")));var l=e[o],h=l.apply();h&&(l.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,h),a.drawElementsType(0,0,6),l.onAfterRenderObservable.notifyObservers(h))}a.setDepthBuffer(!0),a.setDepthWrite(!0)},e.prototype._finalizeFrame=function(e,t,i,r,n){void 0===n&&(n=!1);var s=this._scene.activeCamera;if(s&&0!==(r=r||s._postProcesses.filter((function(e){return null!=e}))).length&&this._scene.postProcessesEnabled){for(var a=this._scene.getEngine(),o=0,l=r.length;o<l;o++){var h=r[o];if(o<l-1?h._outputTexture=r[o+1].activate(s,null==t?void 0:t.texture):(t?(a.bindFramebuffer(t,i,void 0,void 0,n),h._outputTexture=t):(a.restoreDefaultFramebuffer(),h._outputTexture=null),null!=(c=a._debugInsertMarker)&&c.call(a,"post process ".concat(r[o].name," output"))),e)break;var c=h.apply();c&&(h.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,c),a.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(c))}a.setDepthBuffer(!0),a.setDepthWrite(!0),a.setAlphaMode(0)}},e.prototype.dispose=function(){var e=this._vertexBuffers[Ni.PositionKind];e&&(e.dispose(),this._vertexBuffers[Ni.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},e}(),ji=function(){function e(e,t,i,r,n){void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null),this.index=e,this._opaqueSubMeshes=new Ht(256),this._transparentSubMeshes=new Ht(256),this._alphaTestSubMeshes=new Ht(256),this._depthOnlySubMeshes=new Ht(256),this._particleSystems=new Ht(256),this._spriteManagers=new Ht(256),this._empty=!0,this._edgesRenderers=new Kt(16),this._scene=t,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=r,this.transparentSortCompareFn=n}return Object.defineProperty(e.prototype,"opaqueSortCompareFn",{set:function(t){this._opaqueSortCompareFn=t||e.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaTestSortCompareFn",{set:function(t){this._alphaTestSortCompareFn=t||e.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transparentSortCompareFn",{set:function(t){this._transparentSortCompareFn=t||e.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted},enumerable:!1,configurable:!0}),e.prototype.render=function(e,t,i,r){if(e)e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{e=this._scene.getEngine();var n=(0!==this._depthOnlySubMeshes.length&&(e.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),e.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes),e.getStencilBuffer());if(e.setStencilBuffer(!1),t&&this._renderSprites(),i&&this._renderParticles(r),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0===this._transparentSubMeshes.length&&!this._scene.useOrderIndependentTransparency||(e.setStencilBuffer(n),this._scene.useOrderIndependentTransparency?(t=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes)).length&&this._renderTransparent(t):this._renderTransparent(this._transparentSubMeshes),e.setAlphaMode(0)),e.setStencilBuffer(!1),this._edgesRenderers.length){for(var s=0;s<this._edgesRenderers.length;s++)this._edgesRenderers.data[s].render();e.setAlphaMode(0)}e.setStencilBuffer(n)}},e.prototype._renderOpaqueSorted=function(t){return e._RenderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},e.prototype._renderAlphaTestSorted=function(t){return e._RenderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},e.prototype._renderTransparentSorted=function(t){return e._RenderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)},e._RenderSorted=function(t,i,r,n){var s=0,a=r?r.globalPosition:e._ZeroVector;if(n)for(;s<t.length;s++)(c=t.data[s])._alphaIndex=c.getMesh().alphaIndex,c._distanceToCamera=ni.Distance(c.getBoundingInfo().boundingSphere.centerWorld,a);var o=t.length===t.data.length?t.data:t.data.slice(0,t.length),l=(i&&o.sort(i),o[0].getMesh().getScene());for(s=0;s<o.length;s++){var h,c=o[s];l._activeMeshesFrozenButKeepClipping&&!c.isInFrustum(l._frustumPlanes)||(n&&(h=c.getMaterial())&&h.needDepthPrePass&&((h=h.getScene().getEngine()).setColorWrite(!1),h.setAlphaMode(0),c.render(!1),h.setColorWrite(!0)),c.render(n))}},e.defaultTransparentSortCompare=function(t,i){return t._alphaIndex>i._alphaIndex?1:t._alphaIndex<i._alphaIndex?-1:e.backToFrontSortCompare(t,i)},e.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},e.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},e.PainterSortCompare=function(e,t){return e=e.getMesh(),t=t.getMesh(),e.material&&t.material?e.material.uniqueId-t.material.uniqueId:e.uniqueId-t.uniqueId},e.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset(),this._empty=!0},e.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},e.prototype.dispatch=function(e,t,i){void 0===t&&(t=e.getMesh()),null!=(i=void 0===i?e.getMaterial():i)&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTesting()?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)},e.prototype.dispatchSprites=function(e){this._spriteManagers.push(e),this._empty=!1},e.prototype.dispatchParticles=function(e){this._particleSystems.push(e),this._empty=!1},e.prototype._renderParticles=function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var i=0;i<this._particleSystems.length;i++){var r,n=this._particleSystems.data[i];0!==(t&&t.layerMask&n.layerMask)&&((r=n.emitter).position&&e&&-1===e.indexOf(r)||this._scene._activeParticles.addCount(n.render(),!1))}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},e.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var i=this._spriteManagers.data[t];0!==(e&&e.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},e._ZeroVector=ni.Zero(),e}(),Vi=function(){},Zi=function(){function e(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Vi,this._scene=t;for(var i=e.MIN_RENDERINGGROUPS;i<e.MAX_RENDERINGGROUPS;i++)this._autoClearDepthStencil[i]={autoClear:!0,depth:!0,stencil:!0}}return e.prototype._clearDepthStencilBuffer=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)},e.prototype.render=function(t,i,r,n){var s=this._renderingGroupInfo;if(s.scene=this._scene,s.camera=this._scene.activeCamera,this._scene.spriteManagers&&n)for(var a=0;a<this._scene.spriteManagers.length;a++){var o=this._scene.spriteManagers[a];this.dispatchSprites(o)}for(a=e.MIN_RENDERINGGROUPS;a<e.MAX_RENDERINGGROUPS;a++){this._depthStencilBufferAlreadyCleaned=a===e.MIN_RENDERINGGROUPS;var l=this._renderingGroups[a];if(l&&!l._empty){var h,c=Math.pow(2,a);s.renderingGroupId=a,this._scene.onBeforeRenderingGroupObservable.notifyObservers(s,c),!e.AUTOCLEAR||(h=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(a):this._autoClearDepthStencil[a])&&h.autoClear&&this._clearDepthStencilBuffer(h.depth,h.stencil);for(var u=0,d=this._scene._beforeRenderingGroupDrawStage;u<d.length;u++)d[u].action(a);l.render(t,n,r,i);for(var p=0,f=this._scene._afterRenderingGroupDrawStage;p<f.length;p++)f[p].action(a);this._scene.onAfterRenderingGroupObservable.notifyObservers(s,c)}}},e.prototype.reset=function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var i=this._renderingGroups[t];i&&i.prepare()}},e.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},e.prototype.freeRenderingGroups=function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var i=this._renderingGroups[t];i&&i.dispose()}},e.prototype._prepareRenderingGroup=function(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new ji(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))},e.prototype.dispatchSprites=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchSprites(e)},e.prototype.dispatchParticles=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchParticles(e)},e.prototype.dispatch=function(e,t,i){var r=(t=void 0===t?e.getMesh():t).renderingGroupId||0;this._prepareRenderingGroup(r),this._renderingGroups[r].dispatch(e,t,i)},e.prototype.setRenderingOrder=function(e,t,i,r){void 0===i&&(i=null),void 0===r&&(r=null),this._customOpaqueSortCompareFn[e]=t=void 0===t?null:t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=r,this._renderingGroups[e]&&((t=this._renderingGroups[e]).opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],t.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],t.transparentSortCompareFn=this._customTransparentSortCompareFn[e])},e.prototype.setRenderingAutoClearDepthStencil=function(e,t,i,r){this._autoClearDepthStencil[e]={autoClear:t,depth:i=void 0===i||i,stencil:r=void 0===r||r}},e.prototype.getAutoClearDepthStencilSetup=function(e){return this._autoClearDepthStencil[e]},e.MAX_RENDERINGGROUPS=4,e.MIN_RENDERINGGROUPS=0,e.AUTOCLEAR=!0,e}(),Wi=function(e){function t(t){return e.apply(this,t)||this}return c(t,e),t.Create=function(){return Object.create(t.prototype)},t.prototype.registerStep=function(e,t,i){var r=0;for(Number.MAX_VALUE;r<this.length&&!(e<this[r].index);r++);this.splice(r,0,{index:e,component:t,action:i.bind(t)})},t.prototype.clear=function(){this.length=0},t}(Array),Hi=function(){function e(){}return e.POINTERDOWN=1,e.POINTERUP=2,e.POINTERMOVE=4,e.POINTERWHEEL=8,e.POINTERPICK=16,e.POINTERTAP=32,e.POINTERDOUBLETAP=64,e}(),Ki=function(e,t){this.type=e,this.event=t},qi=function(e){function t(t,i,r,n){return(t=e.call(this,t,i)||this).ray=null,t.skipOnPointerObservable=!1,t.localPosition=new ri(r,n),t}return c(t,e),t}(Ki),Xi=function(e){function t(t,i,r){return(t=e.call(this,t,i)||this).pickInfo=r,t}return c(t,e),t}(Ki),Yi=function(){function e(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(e,"HasTriggers",{get:function(){for(var t in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,t))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e,"HasPickTriggers",{get:function(){for(var t in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,t)&&1<=(t=parseInt(t))&&t<=7)return!0;return!1},enumerable:!1,configurable:!0}),e.HasSpecificTrigger=function(t){for(var i in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,i)&&parseInt(i)===t)return!0;return!1},e.Triggers={},e}(),Qi=function(){function e(){}return e.KEYDOWN=1,e.KEYUP=2,e}(),$i=function(e,t){this.type=e,this.event=t},Ji=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.type=t,r.event=i,r.skipOnKeyboardObservable=!1,r}return c(t,e),Object.defineProperty(t.prototype,"skipOnPointerObservable",{get:function(){return this.skipOnKeyboardObservable},set:function(e){this.skipOnKeyboardObservable=e},enumerable:!1,configurable:!0}),t}($i),er=(function(e){e[e.Generic=0]="Generic",e[e.Keyboard=1]="Keyboard",e[e.Mouse=2]="Mouse",e[e.Touch=3]="Touch",e[e.DualShock=4]="DualShock",e[e.Xbox=5]="Xbox",e[e.Switch=6]="Switch",e[e.DualSense=7]="DualSense"}(Ci=Ci||{}),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.Move=12]="Move"}(wi=wi||{}),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.DeltaHorizontal=10]="DeltaHorizontal",e[e.DeltaVertical=11]="DeltaVertical"}(Si=Si||{}),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Share=8]="Share",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(Ti=Ti||{}),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Create=8]="Create",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(Pi=Pi||{}),function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LB=4]="LB",e[e.RB=5]="RB",e[e.LT=6]="LT",e[e.RT=7]="RT",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.LStickXAxis=17]="LStickXAxis",e[e.LStickYAxis=18]="LStickYAxis",e[e.RStickXAxis=19]="RStickXAxis",e[e.RStickYAxis=20]="RStickYAxis"}(Ai=Ai||{}),function(e){e[e.B=0]="B",e[e.A=1]="A",e[e.Y=2]="Y",e[e.X=3]="X",e[e.L=4]="L",e[e.R=5]="R",e[e.ZL=6]="ZL",e[e.ZR=7]="ZR",e[e.Minus=8]="Minus",e[e.Plus=9]="Plus",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.Capture=17]="Capture",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(Ri=Ri||{}),function(e){e[e.PointerMove=0]="PointerMove",e[e.PointerDown=1]="PointerDown",e[e.PointerUp=2]="PointerUp"}(Mi=Mi||{}),function(){function e(){}return e.DOM_DELTA_PIXEL=0,e.DOM_DELTA_LINE=1,e.DOM_DELTA_PAGE=2,e}()),tr=function(){function e(){}return e.CreateDeviceEvent=function(e,t,i,r,n,s){switch(e){case Ci.Keyboard:return this._CreateKeyboardEvent(i,r,n,s);case Ci.Mouse:if(i===wi.MouseWheelX||i===wi.MouseWheelY||i===wi.MouseWheelZ)return this._CreateWheelEvent(e,t,i,r,n,s);case Ci.Touch:return this._CreatePointerEvent(e,t,i,r,n,s);default:throw"Unable to generate event for device ".concat(Ci[e])}},e._CreatePointerEvent=function(e,t,i,r,n,s){return n=this._CreateMouseEvent(e,t,i,r,n,s),e===Ci.Mouse?(n.deviceType=Ci.Mouse,n.pointerId=1,n.pointerType="mouse"):(n.deviceType=Ci.Touch,n.pointerId=t,n.pointerType="touch"),i===wi.Move?n.type="pointermove":i>=wi.LeftClick&&i<=wi.RightClick&&(n.type=1===r?"pointerdown":"pointerup",n.button=i-2),n},e._CreateWheelEvent=function(e,t,i,r,n,s){var a=this._CreateMouseEvent(e,t,i,r,n,s);switch(a.type="wheel",a.deltaMode=er.DOM_DELTA_PIXEL,a.deltaX=0,a.deltaY=0,a.deltaZ=0,i){case wi.MouseWheelX:a.deltaX=r;break;case wi.MouseWheelY:a.deltaY=r;break;case wi.MouseWheelZ:a.deltaZ=r}return a},e._CreateMouseEvent=function(e,t,i,r,n,s){var a=this._CreateEvent(s),o=n.pollInput(e,t,wi.Horizontal),l=n.pollInput(e,t,wi.Vertical);return s?(a.movementX=0,a.movementY=0,a.offsetX=a.movementX-s.getBoundingClientRect().x,a.offsetY=a.movementY-s.getBoundingClientRect().y):(a.movementX=n.pollInput(e,t,Si.DeltaHorizontal),a.movementY=n.pollInput(e,t,Si.DeltaVertical),a.offsetX=0,a.offsetY=0),this._CheckNonCharacterKeys(a,n),a.clientX=o,a.clientY=l,a.x=o,a.y=l,a.deviceType=e,a.deviceSlot=t,a.inputIndex=i,a},e._CreateKeyboardEvent=function(e,t,i,r){return r=this._CreateEvent(r),this._CheckNonCharacterKeys(r,i),r.deviceType=Ci.Keyboard,r.deviceSlot=0,r.inputIndex=e,r.type=1===t?"keydown":"keyup",r.key=String.fromCharCode(e),r.keyCode=e,r},e._CheckNonCharacterKeys=function(e,t){var i=(s=t.isDeviceAvailable(Ci.Keyboard))&&1===t.pollInput(Ci.Keyboard,0,18),r=s&&1===t.pollInput(Ci.Keyboard,0,17),n=s&&(1===t.pollInput(Ci.Keyboard,0,91)||1===t.pollInput(Ci.Keyboard,0,92)||1===t.pollInput(Ci.Keyboard,0,93)),s=s&&1===t.pollInput(Ci.Keyboard,0,16);e.altKey=i,e.ctrlKey=r,e.metaKey=n,e.shiftKey=s},e._CreateEvent=function(e){var t={preventDefault:function(){}};return t.target=e,t},e}(),ir=function(){function e(e,t,i){var r=this;this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(e,t,(function(e,t,n,s){n=tr.CreateDeviceEvent(e,t,n,s,r),i(e,t,n)})):this._createDummyNativeInput()}return e.prototype.pollInput=function(e,t,i){return this._nativeInput.pollInput(e,t,i)},e.prototype.isDeviceAvailable=function(e){return e===Ci.Mouse||e===Ci.Touch},e.prototype.dispose=function(){this._nativeInput.dispose()},e.prototype._createDummyNativeInput=function(){return{pollInput:function(){return 0},isDeviceAvailable:function(){return!1},dispose:function(){}}},e}(),rr=Object.keys(wi).length/2,nr=function(){function e(e,t,i,r){var n=this;this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=Wt.IsSafari(),this._keyboardDownEvent=function(e){},this._keyboardUpEvent=function(e){},this._keyboardBlurEvent=function(e){},this._pointerMoveEvent=function(e){},this._pointerDownEvent=function(e){},this._pointerUpEvent=function(e){},this._pointerCancelEvent=function(e){},this._pointerWheelEvent=function(e){},this._pointerBlurEvent=function(e){},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=Re.IsNavigatorAvailable()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=function(e){},this._gamepadDisconnectedEvent=function(e){},this._eventPrefix=Wt.GetPointerPrefix(e),this._engine=e,this._onDeviceConnected=t,this._onDeviceDisconnected=i,this._onInputChanged=r,this._enableEvents(),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=function(){n._enableEvents()})}return e.prototype.pollInput=function(e,t,i){var r=this._inputs[e][t];if(!r)throw"Unable to find device ".concat(Ci[e]);if(e>=Ci.DualShock&&e<=Ci.DualSense&&navigator.getGamepads&&this._updateDevice(e,t,i),void 0===(r=r[i]))throw"Unable to find input ".concat(i," for device ").concat(Ci[e]," in slot ").concat(t);return i===wi.Move&&Wt.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),r},e.prototype.isDeviceAvailable=function(e){return void 0!==this._inputs[e]},e.prototype.dispose=function(){this._onDeviceConnected=function(){},this._onDeviceDisconnected=function(){},this._onInputChanged=function(){},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()},e.prototype._enableEvents=function(){var e=null==this?void 0:this._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs)for(var t=0,i=this._inputs;t<i.length;t++){var r=i[t];if(r)for(var n in r){var s=r[+n];if(s)for(var a=0;a<s.length;a++)s[a]=0}}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}},e.prototype._disableEvents=function(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1},e.prototype._checkForConnectedDevices=function(){if(navigator.getGamepads)for(var e=0,t=navigator.getGamepads();e<t.length;e++){var i=t[e];i&&this._addGamePad(i)}"function"==typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(Ci.Mouse,0,0,0)},e.prototype._addGamePad=function(e){var t=this._getGamepadDeviceType(e.id),i=e.index;this._gamepads=this._gamepads||new Array(e.index+1),this._registerDevice(t,i,e.buttons.length+e.axes.length),this._gamepads[i]=t},e.prototype._addPointerDevice=function(e,t,i,r){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,rr),(e=this._inputs[e][t])[0]=i,e[1]=r},e.prototype._registerDevice=function(e,t,i){if(void 0===t)throw"Unable to register device ".concat(Ci[e]," to undefined slot.");if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){for(var r=new Array(i),n=0;n<i;n++)r[n]=0;this._inputs[e][t]=r,this._onDeviceConnected(e,t)}},e.prototype._unregisterDevice=function(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))},e.prototype._handleKeyActions=function(){var e=this;this._keyboardDownEvent=function(t){e._keyboardActive||(e._keyboardActive=!0,e._registerDevice(Ci.Keyboard,0,255));var i=e._inputs[Ci.Keyboard][0];i&&(i[t.keyCode]=1,(i=t).inputIndex=t.keyCode,e._onInputChanged(Ci.Keyboard,0,i))},this._keyboardUpEvent=function(t){e._keyboardActive||(e._keyboardActive=!0,e._registerDevice(Ci.Keyboard,0,255));var i=e._inputs[Ci.Keyboard][0];i&&(i[t.keyCode]=0,(i=t).inputIndex=t.keyCode,e._onInputChanged(Ci.Keyboard,0,i))},this._keyboardBlurEvent=function(){if(e._keyboardActive)for(var t,i=e._inputs[Ci.Keyboard][0],r=0;r<i.length;r++)0!==i[r]&&(i[r]=0,t=tr.CreateDeviceEvent(Ci.Keyboard,0,r,0,e,e._elementToAttachTo),e._onInputChanged(Ci.Keyboard,0,t))},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)},e.prototype._handlePointerActions=function(){var e=this;this._maxTouchPoints=Re.IsNavigatorAvailable()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(var t=0;t<this._maxTouchPoints;t++)this._activeTouchIds[t]=-1;function i(){}this._pointerMoveEvent=function(t){var i,r=e._getPointerType(t),n=r===Ci.Mouse?0:e._activeTouchIds.indexOf(t.pointerId),s=(e._inputs[r]||(e._inputs[r]={}),e._inputs[r][n]||e._addPointerDevice(r,n,t.clientX,t.clientY),e._inputs[r][n]);s&&(s[wi.Horizontal]=t.clientX,s[wi.Vertical]=t.clientY,(i=t).inputIndex=wi.Move,e._onInputChanged(r,n,i),e._usingSafari||-1===t.button||(i.inputIndex=t.button+2,s[t.button+2]=s[t.button+2]?0:1,e._onInputChanged(r,n,i)))},this._pointerDownEvent=function(t){var i=e._getPointerType(t),r=i===Ci.Mouse?0:t.pointerId;if(i===Ci.Touch){var n=e._activeTouchIds.indexOf(-1);if(!(0<=n))return void Wt.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(e._maxTouchPoints));e._activeTouchIds[r=n]=t.pointerId}if(e._inputs[i]||(e._inputs[i]={}),e._inputs[i][r]?i===Ci.Touch&&e._onDeviceConnected(i,r):e._addPointerDevice(i,r,t.clientX,t.clientY),n=e._inputs[i][r]){var s=n[wi.Horizontal],a=n[wi.Vertical];if(i===Ci.Mouse){if(-1===e._mouseId&&(void 0===t.pointerId?e._mouseId=e._isUsingFirefox?0:1:e._mouseId=t.pointerId),!document.pointerLockElement&&e._elementToAttachTo.hasPointerCapture)try{e._elementToAttachTo.setPointerCapture(e._mouseId)}catch(t){}}else if(t.pointerId&&!document.pointerLockElement&&e._elementToAttachTo.hasPointerCapture)try{e._elementToAttachTo.setPointerCapture(t.pointerId)}catch(t){}n[wi.Horizontal]=t.clientX,n[wi.Vertical]=t.clientY,n[t.button+2]=1,(n=t).inputIndex=t.button+2,e._onInputChanged(i,r,n),s===t.clientX&&a===t.clientY||(n.inputIndex=wi.Move,e._onInputChanged(i,r,n))}},this._pointerUpEvent=function(t){var i=e._getPointerType(t),r=i===Ci.Mouse?0:e._activeTouchIds.indexOf(t.pointerId);if(i===Ci.Touch){if(-1===r)return;e._activeTouchIds[r]=-1}var n,s,a=null==(a=e._inputs[i])?void 0:a[r];a&&0!==a[t.button+2]&&(n=a[wi.Horizontal],s=a[wi.Vertical],a[wi.Horizontal]=t.clientX,a[wi.Vertical]=t.clientY,a[t.button+2]=0,n===(a=t).clientX&&s===t.clientY||(a.inputIndex=wi.Move,e._onInputChanged(i,r,a)),a.inputIndex=t.button+2,i===Ci.Mouse&&0<=e._mouseId&&null!=(s=(n=e._elementToAttachTo).hasPointerCapture)&&s.call(n,e._mouseId)?e._elementToAttachTo.releasePointerCapture(e._mouseId):t.pointerId&&null!=(n=(s=e._elementToAttachTo).hasPointerCapture)&&n.call(s,t.pointerId)&&e._elementToAttachTo.releasePointerCapture(t.pointerId),e._onInputChanged(i,r,a),i===Ci.Touch&&e._onDeviceDisconnected(i,r))},this._pointerCancelEvent=function(t){var i,r;if("mouse"===t.pointerType){var n=e._inputs[Ci.Mouse][0];0<=e._mouseId&&null!=(a=(i=e._elementToAttachTo).hasPointerCapture)&&a.call(i,e._mouseId)&&e._elementToAttachTo.releasePointerCapture(e._mouseId);for(var s=wi.LeftClick;s<=wi.BrowserForward;s++)1===n[s]&&(n[s]=0,o=tr.CreateDeviceEvent(Ci.Mouse,0,s,0,e,e._elementToAttachTo),e._onInputChanged(Ci.Mouse,0,o))}else{var a=e._activeTouchIds.indexOf(t.pointerId),o=(null!=(r=(i=e._elementToAttachTo).hasPointerCapture)&&r.call(i,t.pointerId)&&e._elementToAttachTo.releasePointerCapture(t.pointerId),e._inputs[Ci.Touch][a][wi.LeftClick]=0,tr.CreateDeviceEvent(Ci.Touch,a,wi.LeftClick,0,e,e._elementToAttachTo));e._onInputChanged(Ci.Touch,a,o),e._activeTouchIds[a]=-1,e._onDeviceDisconnected(Ci.Touch,a)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";var r=!1;try{var n={passive:{get:function(){r=!0}}};this._elementToAttachTo.addEventListener("test",i,n),this._elementToAttachTo.removeEventListener("test",i,n)}catch(t){}this._pointerBlurEvent=function(){var t,i,r,n;if(e.isDeviceAvailable(Ci.Mouse)){var s=e._inputs[Ci.Mouse][0];0<=e._mouseId&&null!=(i=(t=e._elementToAttachTo).hasPointerCapture)&&i.call(t,e._mouseId)&&e._elementToAttachTo.releasePointerCapture(e._mouseId);for(var a=wi.LeftClick;a<=wi.BrowserForward;a++)1===s[a]&&(s[a]=0,l=tr.CreateDeviceEvent(Ci.Mouse,0,a,0,e,e._elementToAttachTo),e._onInputChanged(Ci.Mouse,0,l))}if(e.isDeviceAvailable(Ci.Touch)){s=e._inputs[Ci.Touch];for(var o=0;o<e._activeTouchIds.length;o++){var l,h=e._activeTouchIds[o];null!=(n=(r=e._elementToAttachTo).hasPointerCapture)&&n.call(r,h)&&e._elementToAttachTo.releasePointerCapture(h),-1!==h&&1===(null==(n=s[o])?void 0:n[wi.LeftClick])&&(s[o][wi.LeftClick]=0,l=tr.CreateDeviceEvent(Ci.Touch,o,wi.LeftClick,0,e,e._elementToAttachTo),e._onInputChanged(Ci.Touch,o,l),e._activeTouchIds[o]=-1,e._onDeviceDisconnected(Ci.Touch,o))}}},this._pointerWheelEvent=function(t){var i=Ci.Mouse,r=(e._inputs[i]||(e._inputs[i]=[]),e._inputs[i][0]||(e._pointerActive=!0,e._registerDevice(i,0,rr)),e._inputs[i][0]);r&&(r[wi.MouseWheelX]=t.deltaX||0,r[wi.MouseWheelY]=t.deltaY||t.wheelDelta||0,r[wi.MouseWheelZ]=t.deltaZ||0,0!==r[wi.MouseWheelX]&&(t.inputIndex=wi.MouseWheelX,e._onInputChanged(i,0,t)),0!==r[wi.MouseWheelY]&&(t.inputIndex=wi.MouseWheelY,e._onInputChanged(i,0,t)),0!==r[wi.MouseWheelZ]&&(t.inputIndex=wi.MouseWheelZ,e._onInputChanged(i,0,t)))},this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!r&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((function(){var t;e.isDeviceAvailable(Ci.Mouse)&&((t=e._inputs[Ci.Mouse][0])[wi.MouseWheelX]=0,t[wi.MouseWheelY]=0,t[wi.MouseWheelZ]=0)}))},e.prototype._handleGamepadActions=function(){var e=this;this._gamepadConnectedEvent=function(t){e._addGamePad(t.gamepad)},this._gamepadDisconnectedEvent=function(t){var i;e._gamepads&&(i=e._getGamepadDeviceType(t.gamepad.id),t=t.gamepad.index,e._unregisterDevice(i,t),delete e._gamepads[t])},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},e.prototype._updateDevice=function(e,t,i){var r=navigator.getGamepads()[t];r&&e===this._gamepads[t]&&(e=this._inputs[e][t],i>=r.buttons.length?e[i]=r.axes[i-r.buttons.length].valueOf():e[i]=r.buttons[i].value)},e.prototype._getGamepadDeviceType=function(e){return-1!==e.indexOf("054c")?-1!==e.indexOf("0ce6")?Ci.DualSense:Ci.DualShock:-1!==e.indexOf("Xbox One")||-1!==e.search("Xbox 360")||-1!==e.search("xinput")?Ci.Xbox:-1!==e.indexOf("057e")?Ci.Switch:Ci.Generic},e.prototype._getPointerType=function(e){var t=Ci.Mouse;return"touch"===e.pointerType||"pen"===e.pointerType||e.touches?Ci.Touch:t},e}(),sr=function(){function e(e,t,i){void 0===i&&(i=0),this.deviceType=t,this.deviceSlot=i,this.onInputChangedObservable=new we,this._deviceInputSystem=e}return e.prototype.getInput=function(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)},e}(),ar=function(){function e(e){function t(e,t){n._devices[e]||(n._devices[e]=new Array),n._devices[e][t]||(n._devices[e][t]=t);for(var i=0,r=n._registeredManagers;i<r.length;i++){var s=r[i],a=new sr(n._deviceInputSystem,e,t);s._addDevice(a)}}function i(e,t){var i;null!=(i=n._devices[e])&&i[t]&&delete n._devices[e][t];for(var r=0,s=n._registeredManagers;r<s.length;r++)s[r]._removeDevice(e,t)}function r(e,t,i){if(i)for(var r=0,s=n._registeredManagers;r<s.length;r++)s[r]._onInputChanged(e,t,i)}var n=this,s=(this._registeredManagers=new Array,this._refCount=0,this.registerManager=function(e){for(var t,i=0;i<n._devices.length;i++)for(t in n._devices[i])e._addDevice(new sr(n._deviceInputSystem,i,+t));n._registeredManagers.push(e)},this.unregisterManager=function(e){-1<(e=n._registeredManagers.indexOf(e))&&n._registeredManagers.splice(e,1)},Object.keys(Ci).length/2);this._devices=new Array(s),"undefined"!=typeof _native?this._deviceInputSystem=new ir(t,i,r):this._deviceInputSystem=new nr(e,t,i,r)}return e.prototype.dispose=function(){this._deviceInputSystem.dispose()},e}(),or=function(){function e(e){var t=this,i=Object.keys(Ci).length/2;this._devices=new Array(i),this._firstDevice=new Array(i),this._engine=e,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new ar(e)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new we((function(e){for(var i=0,r=t._devices;i<r.length;i++){var n=r[i];if(n)for(var s=0,a=n;s<a.length;s++){var o=a[s];o&&t.onDeviceConnectedObservable.notifyObserver(e,o)}}})),this.onDeviceDisconnectedObservable=new we,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=e.onDisposeObservable.add((function(){t.dispose()}))}return e.prototype.getDeviceSource=function(e,t){if(void 0===t){if(void 0===this._firstDevice[e])return null;t=this._firstDevice[e]}return this._devices[e]&&void 0!==this._devices[e][t]?this._devices[e][t]:null},e.prototype.getDeviceSources=function(e){return this._devices[e].filter((function(e){return!!e}))},e.prototype.dispose=function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)},e.prototype._addDevice=function(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=new Array),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)},e.prototype._removeDevice=function(e,t){var i=null==(i=this._devices[e])?void 0:i[t];this.onDeviceDisconnectedObservable.notifyObservers(i),null!=(i=this._devices[e])&&i[t]&&delete this._devices[e][t],this._updateFirstDevices(e)},e.prototype._onInputChanged=function(e,t,i){null!=(e=null==(e=this._devices[e])?void 0:e[t])&&e.onInputChangedObservable.notifyObservers(i)},e.prototype._updateFirstDevices=function(e){switch(e){case Ci.Keyboard:case Ci.Mouse:this._firstDevice[e]=0;break;case Ci.Touch:case Ci.DualSense:case Ci.DualShock:case Ci.Xbox:case Ci.Switch:case Ci.Generic:delete this._firstDevice[e];var t=this._devices[e];if(t)for(var i=0;i<t.length;i++)if(t[i]){this._firstDevice[e]=i;break}}},e}(),lr=function(){function e(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(e.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!1,configurable:!0}),e}(),hr=function(){function e(e){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new ri(0,0),this._previousStartingPointerPosition=new ri(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._deviceSourceManager=null,this._scene=e||Ne.LastCreatedScene,this._scene}return Object.defineProperty(e.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),e.prototype.getMeshUnderPointerByPointerId=function(e){return this._meshUnderPointerId[e]||null},Object.defineProperty(e.prototype,"unTranslatedPointer",{get:function(){return new ri(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerX",{get:function(){return this._pointerX},set:function(e){this._pointerX=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerY",{get:function(){return this._pointerY},set:function(e){this._pointerY=e},enumerable:!1,configurable:!0}),e.prototype._updatePointerPosition=function(e){var t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},e.prototype._processPointerMove=function(e,t){var i=this._scene,r=i.getEngine(),n=r.getInputElement(),s=(n&&(n.tabIndex=r.canvasTabIndex,i.doNotHandleCursors||(n.style.cursor=i.defaultCursor)),!!(e&&e.hit&&e.pickedMesh));s?(i.setPointerOverMesh(e.pickedMesh,t.pointerId,e),!i.doNotHandleCursors&&n&&this._pointerOverMesh&&(r=this._pointerOverMesh._getActionManagerForTrigger())&&r.hasPointerTriggers&&(n.style.cursor=r.hoverCursor||i.hoverCursor)):i.setPointerOverMesh(null,t.pointerId,e);for(var a=0,o=i._pointerMoveStage;a<o.length;a++)e=o[a].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,s,n);e&&(r="wheel"===t.type||"mousewheel"===t.type||"DOMMouseScroll"===t.type?Hi.POINTERWHEEL:Hi.POINTERMOVE,i.onPointerMove&&i.onPointerMove(t,e,r),i.onPointerObservable.hasObservers()&&(t=new Xi(r,t,e),this._setRayOnPointerInfo(t),i.onPointerObservable.notifyObservers(t,r)))},e.prototype._setRayOnPointerInfo=function(e){var t=this._scene;!e.pickInfo||e.pickInfo._pickingUnavailable||e.pickInfo.ray||(e.pickInfo.ray=t.createPickingRay(e.event.offsetX,e.event.offsetY,oi.Identity(),t.activeCamera))},e.prototype._checkPrePointerObservable=function(e,t,i){var r=this._scene;t=new qi(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(t.ray=e.ray,e.originMesh&&(t.nearInteractionPickingInfo=e)),r.onPrePointerObservable.notifyObservers(t,i),!!t.skipOnPointerObservable},e.prototype.simulatePointerMove=function(e,t){(t=new PointerEvent("pointermove",t)).inputIndex=wi.Move,this._checkPrePointerObservable(e,t,Hi.POINTERMOVE)||this._processPointerMove(e,t)},e.prototype.simulatePointerDown=function(e,t){(t=new PointerEvent("pointerdown",t)).inputIndex=t.button+2,this._checkPrePointerObservable(e,t,Hi.POINTERDOWN)||this._processPointerDown(e,t)},e.prototype._processPointerDown=function(t,i){var r,n,s=this,a=this._scene;if(t&&t.hit&&t.pickedMesh){this._pickedDownMesh=t.pickedMesh;var o=t.pickedMesh._getActionManagerForTrigger();if(o){if(o.hasPickTriggers)switch(o.processTrigger(5,Ui.CreateNew(t.pickedMesh,i)),i.button){case 0:o.processTrigger(2,Ui.CreateNew(t.pickedMesh,i));break;case 1:o.processTrigger(4,Ui.CreateNew(t.pickedMesh,i));break;case 2:o.processTrigger(3,Ui.CreateNew(t.pickedMesh,i))}o.hasSpecificTrigger(8)&&window.setTimeout((function(){var t=a.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,(function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===s._pickedDownMesh}),!1,a.cameraToUseForPointers);t&&t.hit&&t.pickedMesh&&o&&0!==s._totalPointersPressed&&Date.now()-s._startingPointerTime>e.LongPressDelay&&!s._isPointerSwiping()&&(s._startingPointerTime=0,o.processTrigger(8,Ui.CreateNew(t.pickedMesh,i)))}),e.LongPressDelay)}}else for(var l=0,h=a._pointerDownStage;l<h.length;l++)t=h[l].action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,i);t&&(r=Hi.POINTERDOWN,a.onPointerDown&&a.onPointerDown(i,t,r),a.onPointerObservable.hasObservers()&&(n=new Xi(r,i,t),this._setRayOnPointerInfo(n),a.onPointerObservable.notifyObservers(n,r)))},e.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>e.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>e.DragMovementThreshold},e.prototype.simulatePointerUp=function(e,t,i){var r=((t=new PointerEvent("pointerup",t)).inputIndex=wi.Move,new lr);i?r.doubleClick=!0:r.singleClick=!0,this._checkPrePointerObservable(e,t,Hi.POINTERUP)||this._processPointerUp(e,t,r)},e.prototype._processPointerUp=function(e,t,i){var r=this._scene;if(e&&e.hit&&e.pickedMesh)this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(r.onPointerPick&&r.onPointerPick(t,e),i.singleClick&&!i.ignore&&r.onPointerObservable.hasObservers()&&(o=Hi.POINTERPICK,a=new Xi(o,t,e),this._setRayOnPointerInfo(a),r.onPointerObservable.notifyObservers(a,o))),(o=e.pickedMesh._getActionManagerForTrigger())&&!i.ignore&&(o.processTrigger(7,Ui.CreateNew(e.pickedMesh,t,e)),!i.hasSwiped&&i.singleClick&&o.processTrigger(1,Ui.CreateNew(e.pickedMesh,t,e)),o=e.pickedMesh._getActionManagerForTrigger(6),i.doubleClick&&o&&o.processTrigger(6,Ui.CreateNew(e.pickedMesh,t,e)));else if(!i.ignore)for(var n=0,s=r._pointerUpStage;n<s.length;n++)e=s[n].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t);this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh&&(o=this._pickedDownMesh._getActionManagerForTrigger(16))&&o.processTrigger(16,Ui.CreateNew(this._pickedDownMesh,t));var a,o=0;r.onPointerObservable.hasObservers()&&(i.ignore||i.hasSwiped||(i.singleClick&&r.onPointerObservable.hasSpecificMask(Hi.POINTERTAP)?o=Hi.POINTERTAP:i.doubleClick&&r.onPointerObservable.hasSpecificMask(Hi.POINTERDOUBLETAP)&&(o=Hi.POINTERDOUBLETAP),o&&(a=new Xi(o,t,e),this._setRayOnPointerInfo(a),r.onPointerObservable.notifyObservers(a,o))),i.ignore||(o=Hi.POINTERUP,a=new Xi(o,t,e),this._setRayOnPointerInfo(a),r.onPointerObservable.notifyObservers(a,o))),r.onPointerUp&&!i.ignore&&r.onPointerUp(t,e,o)},e.prototype.isPointerCaptured=function(e){return this._pointerCaptures[e=void 0===e?0:e]},e.prototype.attachControl=function(t,i,r,n){var s=this,a=(void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===n&&(n=null),this._scene),o=a.getEngine();n=n||o.getInputElement(),this._alreadyAttached&&this.detachControl(),n&&(this._alreadyAttachedTo=n),this._deviceSourceManager=new or(o),this._initActionManager=function(e){var t;return s._meshPickProceed||(t=a.skipPointerUpPicking?null:a.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,a.pointerUpPredicate,!1,a.cameraToUseForPointers),(s._currentPickResult=t)&&(e=t.hit&&t.pickedMesh?t.pickedMesh._getActionManagerForTrigger():null),s._meshPickProceed=!0),e},this._delayedSimpleClick=function(t,i,r){(Date.now()-s._previousStartingPointerTime>e.DoubleClickDelay&&!s._doubleClickOccured||t!==s._previousButtonPressed)&&(s._doubleClickOccured=!1,i.singleClick=!0,i.ignore=!1,r(i,s._currentPickResult))},this._initClickEvent=function(t,i,r,n){var a=new lr,o=s._currentPickResult=null,l=t.hasSpecificMask(Hi.POINTERPICK)||i.hasSpecificMask(Hi.POINTERPICK)||t.hasSpecificMask(Hi.POINTERTAP)||i.hasSpecificMask(Hi.POINTERTAP)||t.hasSpecificMask(Hi.POINTERDOUBLETAP)||i.hasSpecificMask(Hi.POINTERDOUBLETAP),h=!1;(l=!l&&Yi&&(o=s._initActionManager(o,a))?o.hasPickTriggers:l)&&(l=r.button,a.hasSwiped=s._isPointerSwiping(),a.hasSwiped||((r=!e.ExclusiveDoubleClickMode)||(r=!t.hasSpecificMask(Hi.POINTERDOUBLETAP)&&!i.hasSpecificMask(Hi.POINTERDOUBLETAP))&&!Yi.HasSpecificTrigger(6)&&(o=s._initActionManager(o,a))&&(r=!o.hasSpecificTrigger(6)),r?(Date.now()-s._previousStartingPointerTime>e.DoubleClickDelay||l!==s._previousButtonPressed)&&(a.singleClick=!0,n(a,s._currentPickResult),h=!0):(s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,s._delayedSimpleClickTimeout=window.setTimeout(s._delayedSimpleClick.bind(s,l,a,n),e.DoubleClickDelay)),(r=!(r=t.hasSpecificMask(Hi.POINTERDOUBLETAP)||i.hasSpecificMask(Hi.POINTERDOUBLETAP))&&Yi.HasSpecificTrigger(6)&&(o=s._initActionManager(o,a))?o.hasSpecificTrigger(6):r)&&(l===s._previousButtonPressed&&Date.now()-s._previousStartingPointerTime<e.DoubleClickDelay&&!s._doubleClickOccured?(a.hasSwiped||s._isPointerSwiping()?(s._doubleClickOccured=!1,s._previousStartingPointerTime=s._startingPointerTime,s._previousStartingPointerPosition.x=s._startingPointerPosition.x,s._previousStartingPointerPosition.y=s._startingPointerPosition.y,s._previousButtonPressed=l,e.ExclusiveDoubleClickMode?(s._previousDelayedSimpleClickTimeout&&clearTimeout(s._previousDelayedSimpleClickTimeout),s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,n(a,s._previousPickResult)):n(a,s._currentPickResult)):(s._previousStartingPointerTime=0,s._doubleClickOccured=!0,a.doubleClick=!0,a.ignore=!1,e.ExclusiveDoubleClickMode&&s._previousDelayedSimpleClickTimeout&&clearTimeout(s._previousDelayedSimpleClickTimeout),s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,n(a,s._currentPickResult)),h=!0):(s._doubleClickOccured=!1,s._previousStartingPointerTime=s._startingPointerTime,s._previousStartingPointerPosition.x=s._startingPointerPosition.x,s._previousStartingPointerPosition.y=s._startingPointerPosition.y,s._previousButtonPressed=l)))),h||n(a,s._currentPickResult)},this._onPointerMove=function(e){var t;void 0===e.pointerId&&(e.pointerId=0),s._updatePointerPosition(e),s._checkPrePointerObservable(null,e,"wheel"===e.type||"mousewheel"===e.type||"DOMMouseScroll"===e.type?Hi.POINTERWHEEL:Hi.POINTERMOVE)||(a.cameraToUseForPointers||a.activeCamera)&&(a.skipPointerMovePicking?s._processPointerMove(new zi,e):(a.pointerMovePredicate||(a.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||a.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!a.cameraToUseForPointers||0!=(a.cameraToUseForPointers.layerMask&e.layerMask))}),t=a.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,a.pointerMovePredicate,!1,a.cameraToUseForPointers,a.pointerMoveTrianglePredicate),s._processPointerMove(t,e)))},this._onPointerDown=function(e){var t;s._totalPointersPressed++,s._pickedDownMesh=null,s._meshPickProceed=!1,void 0===e.pointerId&&(e.pointerId=0),s._updatePointerPosition(e),a.preventDefaultOnPointerDown&&n&&(e.preventDefault(),n.focus()),s._startingPointerPosition.x=s._pointerX,s._startingPointerPosition.y=s._pointerY,s._startingPointerTime=Date.now(),s._checkPrePointerObservable(null,e,Hi.POINTERDOWN)||(a.cameraToUseForPointers||a.activeCamera)&&(s._pointerCaptures[e.pointerId]=!0,a.pointerDownPredicate||(a.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!a.cameraToUseForPointers||0!=(a.cameraToUseForPointers.layerMask&e.layerMask))}),s._pickedDownMesh=null,t=a.skipPointerDownPicking?new zi:a.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,a.pointerDownPredicate,!1,a.cameraToUseForPointers),s._processPointerDown(t,e))},this._onPointerUp=function(e){0!==s._totalPointersPressed&&(s._totalPointersPressed--,s._pickedUpMesh=null,s._meshPickProceed=!1,void 0===e.pointerId&&(e.pointerId=0),s._updatePointerPosition(e),a.preventDefaultOnPointerUp&&n&&(e.preventDefault(),n.focus()),s._initClickEvent(a.onPrePointerObservable,a.onPointerObservable,e,(function(t,i){if(a.onPrePointerObservable.hasObservers()&&!t.ignore){if(!t.hasSwiped){if(t.singleClick&&a.onPrePointerObservable.hasSpecificMask(Hi.POINTERTAP)&&s._checkPrePointerObservable(null,e,Hi.POINTERTAP))return;if(t.doubleClick&&a.onPrePointerObservable.hasSpecificMask(Hi.POINTERDOUBLETAP)&&s._checkPrePointerObservable(null,e,Hi.POINTERDOUBLETAP))return}if(s._checkPrePointerObservable(null,e,Hi.POINTERUP))return}!s._pointerCaptures[e.pointerId]&&0<e.buttons||(s._pointerCaptures[e.pointerId]=!1,(a.cameraToUseForPointers||a.activeCamera)&&(a.pointerUpPredicate||(a.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!a.cameraToUseForPointers||0!=(a.cameraToUseForPointers.layerMask&e.layerMask))}),!s._meshPickProceed&&(Yi&&Yi.HasTriggers||a.onPointerObservable.hasObservers())&&s._initActionManager(null,t),i=i||s._currentPickResult,s._processPointerUp(i,e,t),s._previousPickResult=s._currentPickResult))})))},this._onKeyDown=function(e){var t=Qi.KEYDOWN;if(a.onPreKeyboardObservable.hasObservers()){var i=new Ji(t,e);if(a.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}a.onKeyboardObservable.hasObservers()&&(i=new $i(t,e),a.onKeyboardObservable.notifyObservers(i,t)),a.actionManager&&a.actionManager.processTrigger(14,Ui.CreateNewFromScene(a,e))},this._onKeyUp=function(e){var t=Qi.KEYUP;if(a.onPreKeyboardObservable.hasObservers()){var i=new Ji(t,e);if(a.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}a.onKeyboardObservable.hasObservers()&&(i=new $i(t,e),a.onKeyboardObservable.notifyObservers(i,t)),a.actionManager&&a.actionManager.processTrigger(15,Ui.CreateNewFromScene(a,e))},this._deviceSourceManager.onDeviceConnectedObservable.add((function(e){e.deviceType===Ci.Mouse?e.onInputChangedObservable.add((function(n){n.inputIndex===wi.LeftClick||n.inputIndex===wi.MiddleClick||n.inputIndex===wi.RightClick?i&&1===e.getInput(n.inputIndex)?s._onPointerDown(n):t&&0===e.getInput(n.inputIndex)&&s._onPointerUp(n):!r||n.inputIndex!==wi.Move&&n.inputIndex!==wi.MouseWheelX&&n.inputIndex!==wi.MouseWheelY&&n.inputIndex!==wi.MouseWheelZ||s._onPointerMove(n)})):e.deviceType===Ci.Touch?e.onInputChangedObservable.add((function(n){n.inputIndex===wi.LeftClick&&(i&&1===e.getInput(n.inputIndex)?s._onPointerDown(n):t&&0===e.getInput(n.inputIndex)&&s._onPointerUp(n)),r&&n.inputIndex===wi.Move&&s._onPointerMove(n)})):e.deviceType===Ci.Keyboard&&e.onInputChangedObservable.add((function(e){"keydown"===e.type?s._onKeyDown(e):"keyup"===e.type&&s._onKeyUp(e)}))})),this._alreadyAttached=!0},e.prototype.detachControl=function(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)},e.prototype.setPointerOverMesh=function(e,t,i){var r,n;this._meshUnderPointerId[t=void 0===t?0:t]!==e&&((r=this._meshUnderPointerId[t])&&(n=r._getActionManagerForTrigger(10))&&n.processTrigger(10,Ui.CreateNew(r,void 0,{pointerId:t})),e?(this._meshUnderPointerId[t]=e,(n=(this._pointerOverMesh=e)._getActionManagerForTrigger(9))&&n.processTrigger(9,Ui.CreateNew(e,void 0,{pointerId:t,pickResult:i}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null))},e.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},e.prototype._invalidateMesh=function(e){for(var t in this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null),this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]},e.DragMovementThreshold=10,e.LongPressDelay=500,e.DoubleClickDelay=300,e.ExclusiveDoubleClickMode=!1,e}(),cr=function(){function e(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),e.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},e.prototype.addCount=function(t,i){e.Enabled&&(this._current+=t,i&&this._fetchResult())},e.prototype.beginMonitoring=function(){e.Enabled&&(this._startMonitoringTime=De.Now)},e.prototype.endMonitoring=function(t){var i;void 0===t&&(t=!0),e.Enabled&&(t&&this.fetchNewFrame(),i=De.Now,this._current=i-this._startMonitoringTime,t&&this._fetchResult())},e.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=De.Now;1e3<e-this._lastSecTime&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},e.Enabled=!0,e}(),ur=function(){function e(e,t,i,r){this.normal=new ni(e,t,i),this.d=r}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.getClassName=function(){return"Plane"},e.prototype.getHashCode=function(){return 397*this.normal.getHashCode()^(0|this.d)},e.prototype.normalize=function(){var e=0!==(e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z))?1/e:0;return this.normal.x*=e,this.normal.y*=e,this.normal.z*=e,this.d*=e,this},e.prototype.transform=function(t){var i=e._TmpMatrix,r=(t=(t.invertToRef(i),i.m),i=this.normal.x,this.normal.y),n=this.normal.z,s=this.d;return new e(i*t[0]+r*t[1]+n*t[2]+s*t[3],i*t[4]+r*t[5]+n*t[6]+s*t[7],i*t[8]+r*t[9]+n*t[10]+s*t[11],i*t[12]+r*t[13]+n*t[14]+s*t[15])},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,i){var r=t.x-e.x,n=t.y-e.y,s=(t=t.z-e.z,i.x-e.x),a=i.y-e.y,o=n*(i=i.z-e.z)-t*a;t=t*s-r*i,i=r*a-n*s,a=0!==(r=Math.sqrt(o*o+t*t+i*i))?1/r:0;return this.normal.x=o*a,this.normal.y=t*a,this.normal.z=i*a,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){return ni.Dot(this.normal,e)<=t},e.prototype.signedDistanceTo=function(e){return ni.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,i,r){var n=new e(0,0,0,0);return n.copyFromPoints(t,i,r),n},e.FromPositionAndNormal=function(t,i){var r=new e(0,0,0,0);return i.normalize(),r.normal=i,r.d=-(i.x*t.x+i.y*t.y+i.z*t.z),r},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){return e=-(t.x*e.x+t.y*e.y+t.z*e.z),ni.Dot(i,t)+e},e._TmpMatrix=oi.Identity(),e}(),dr=function(){function e(){}return e.GetPlanes=function(t){for(var i=[],r=0;r<6;r++)i.push(new ur(0,0,0,0));return e.GetPlanesToRef(t,i),i},e.GetNearPlaneToRef=function(e,t){e=e.m,t.normal.x=e[3]+e[2],t.normal.y=e[7]+e[6],t.normal.z=e[11]+e[10],t.d=e[15]+e[14],t.normalize()},e.GetFarPlaneToRef=function(e,t){e=e.m,t.normal.x=e[3]-e[2],t.normal.y=e[7]-e[6],t.normal.z=e[11]-e[10],t.d=e[15]-e[14],t.normalize()},e.GetLeftPlaneToRef=function(e,t){e=e.m,t.normal.x=e[3]+e[0],t.normal.y=e[7]+e[4],t.normal.z=e[11]+e[8],t.d=e[15]+e[12],t.normalize()},e.GetRightPlaneToRef=function(e,t){e=e.m,t.normal.x=e[3]-e[0],t.normal.y=e[7]-e[4],t.normal.z=e[11]-e[8],t.d=e[15]-e[12],t.normalize()},e.GetTopPlaneToRef=function(e,t){e=e.m,t.normal.x=e[3]-e[1],t.normal.y=e[7]-e[5],t.normal.z=e[11]-e[9],t.d=e[15]-e[13],t.normalize()},e.GetBottomPlaneToRef=function(e,t){e=e.m,t.normal.x=e[3]+e[1],t.normal.y=e[7]+e[5],t.normal.z=e[11]+e[9],t.d=e[15]+e[13],t.normalize()},e.GetPlanesToRef=function(t,i){e.GetNearPlaneToRef(t,i[0]),e.GetFarPlaneToRef(t,i[1]),e.GetLeftPlaneToRef(t,i[2]),e.GetRightPlaneToRef(t,i[3]),e.GetTopPlaneToRef(t,i[4]),e.GetBottomPlaneToRef(t,i[5])},e}(),pr=function(){function e(){}return Object.defineProperty(e,"UniqueId",{get:function(){var e=this._UniqueIdCounter;return this._UniqueIdCounter++,e},enumerable:!1,configurable:!0}),e._UniqueIdCounter=1,e}(),fr=function(){function e(){}return e.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},e.FALLOFF_DEFAULT=0,e.FALLOFF_PHYSICAL=1,e.FALLOFF_GLTF=2,e.FALLOFF_STANDARD=3,e.LIGHTMAP_DEFAULT=0,e.LIGHTMAP_SPECULAR=1,e.LIGHTMAP_SHADOWSONLY=2,e.INTENSITYMODE_AUTOMATIC=0,e.INTENSITYMODE_LUMINOUSPOWER=1,e.INTENSITYMODE_LUMINOUSINTENSITY=2,e.INTENSITYMODE_ILLUMINANCE=3,e.INTENSITYMODE_LUMINANCE=4,e.LIGHTTYPEID_POINTLIGHT=0,e.LIGHTTYPEID_DIRECTIONALLIGHT=1,e.LIGHTTYPEID_SPOTLIGHT=2,e.LIGHTTYPEID_HEMISPHERICLIGHT=3,e}(),mr=function(){function e(t,i){e.IsAvailable&&(this._observer=new window.ComputePressureObserver(t,i))}return Object.defineProperty(e,"IsAvailable",{get:function(){return Se()&&"ComputePressureObserver"in window},enumerable:!1,configurable:!0}),e.prototype.observe=function(){var e;null!=(e=this._observer)&&e.observe&&null!=(e=this._observer)&&e.observe().catch((function(){}))},e.prototype.unobserve=function(){var e;null!=(e=this._observer)&&e.unobserve&&null!=(e=this._observer)&&e.unobserve()},e}(),_r=function(e){function t(i,r){var n=e.call(this)||this,s=(n._inputManager=new hr(n),n.cameraToUseForPointers=null,n._isScene=!0,n._blockEntityCollection=!1,n.autoClear=!0,n.autoClearDepthAndStencil=!0,n.clearColor=new pi(.2,.2,.3,1),n.ambientColor=new di(0,0,0),n.environmentIntensity=1,n._forceWireframe=!1,n._skipFrustumClipping=!1,n._forcePointsCloud=!1,n.animationsEnabled=!0,n._animationPropertiesOverride=null,n.useConstantAnimationDeltaTime=!1,n.constantlyUpdateMeshUnderPointer=!1,n.hoverCursor="pointer",n.defaultCursor="",n.doNotHandleCursors=!1,n.preventDefaultOnPointerDown=!0,n.preventDefaultOnPointerUp=!0,n.metadata=null,n.reservedDataStore=null,n.disableOfflineSupportExceptionRules=new Array,n.onDisposeObservable=new we,n._onDisposeObserver=null,n.onBeforeRenderObservable=new we,n._onBeforeRenderObserver=null,n.onAfterRenderObservable=new we,n.onAfterRenderCameraObservable=new we,n._onAfterRenderObserver=null,n.onBeforeAnimationsObservable=new we,n.onAfterAnimationsObservable=new we,n.onBeforeDrawPhaseObservable=new we,n.onAfterDrawPhaseObservable=new we,n.onReadyObservable=new we,n.onBeforeCameraRenderObservable=new we,n._onBeforeCameraRenderObserver=null,n.onAfterCameraRenderObservable=new we,n._onAfterCameraRenderObserver=null,n.onBeforeActiveMeshesEvaluationObservable=new we,n.onAfterActiveMeshesEvaluationObservable=new we,n.onBeforeParticlesRenderingObservable=new we,n.onAfterParticlesRenderingObservable=new we,n.onDataLoadedObservable=new we,n.onNewCameraAddedObservable=new we,n.onCameraRemovedObservable=new we,n.onNewLightAddedObservable=new we,n.onLightRemovedObservable=new we,n.onNewGeometryAddedObservable=new we,n.onGeometryRemovedObservable=new we,n.onNewTransformNodeAddedObservable=new we,n.onTransformNodeRemovedObservable=new we,n.onNewMeshAddedObservable=new we,n.onMeshRemovedObservable=new we,n.onNewSkeletonAddedObservable=new we,n.onSkeletonRemovedObservable=new we,n.onNewMaterialAddedObservable=new we,n.onNewMultiMaterialAddedObservable=new we,n.onMaterialRemovedObservable=new we,n.onMultiMaterialRemovedObservable=new we,n.onNewTextureAddedObservable=new we,n.onTextureRemovedObservable=new we,n.onBeforeRenderTargetsRenderObservable=new we,n.onAfterRenderTargetsRenderObservable=new we,n.onBeforeStepObservable=new we,n.onAfterStepObservable=new we,n.onActiveCameraChanged=new we,n.onBeforeRenderingGroupObservable=new we,n.onAfterRenderingGroupObservable=new we,n.onMeshImportedObservable=new we,n.onAnimationFileImportedObservable=new we,n._registeredForLateAnimationBindings=new Kt(256),n.skipPointerMovePicking=!1,n.skipPointerDownPicking=!1,n.skipPointerUpPicking=!1,n.onPrePointerObservable=new we,n.onPointerObservable=new we,n.onPreKeyboardObservable=new we,n.onKeyboardObservable=new we,n._useRightHandedSystem=!1,n._timeAccumulator=0,n._currentStepId=0,n._currentInternalStep=0,n._fogEnabled=!0,n._fogMode=t.FOGMODE_NONE,n.fogColor=new di(.2,.2,.3),n.fogDensity=.1,n.fogStart=0,n.fogEnd=1e3,n.needsPreviousWorldMatrices=!1,n._shadowsEnabled=!0,n._lightsEnabled=!0,n.activeCameras=new Array,n._texturesEnabled=!0,n.physicsEnabled=!0,n.particlesEnabled=!0,n.spritesEnabled=!0,n._skeletonsEnabled=!0,n.lensFlaresEnabled=!0,n.collisionsEnabled=!0,n.gravity=new ni(0,-9.807,0),n.postProcessesEnabled=!0,n.renderTargetsEnabled=!0,n.dumpNextRenderTargets=!1,n.customRenderTargets=new Array,n.importedMeshesFiles=new Array,n.probesEnabled=!0,n._meshesForIntersections=new Kt(256),n.proceduralTexturesEnabled=!0,n._totalVertices=new cr,n._activeIndices=new cr,n._activeParticles=new cr,n._activeBones=new cr,n._animationTime=0,n.animationTimeScale=1,n._renderId=0,n._frameId=0,n._executeWhenReadyTimeoutId=null,n._intermediateRendering=!1,n._defaultFrameBufferCleared=!1,n._viewUpdateFlag=-1,n._projectionUpdateFlag=-1,n._toBeDisposed=new Array(256),n._activeRequests=new Array,n._pendingData=new Array,n._isDisposed=!1,n.dispatchAllSubMeshesOfActiveMeshes=!1,n._activeMeshes=new Ht(256),n._processedMaterials=new Ht(256),n._renderTargets=new Kt(256),n._materialsRenderTargets=new Kt(256),n._activeParticleSystems=new Ht(256),n._activeSkeletons=new Kt(32),n._softwareSkinnedMeshes=new Kt(32),n._activeAnimatables=new Array,n._transformMatrix=oi.Zero(),n.requireLightSorting=!1,n._components=[],n._serializableComponents=[],n._transientComponents=[],n._beforeCameraUpdateStage=Wi.Create(),n._beforeClearStage=Wi.Create(),n._beforeRenderTargetClearStage=Wi.Create(),n._gatherRenderTargetsStage=Wi.Create(),n._gatherActiveCameraRenderTargetsStage=Wi.Create(),n._isReadyForMeshStage=Wi.Create(),n._beforeEvaluateActiveMeshStage=Wi.Create(),n._evaluateSubMeshStage=Wi.Create(),n._preActiveMeshStage=Wi.Create(),n._cameraDrawRenderTargetStage=Wi.Create(),n._beforeCameraDrawStage=Wi.Create(),n._beforeRenderTargetDrawStage=Wi.Create(),n._beforeRenderingGroupDrawStage=Wi.Create(),n._beforeRenderingMeshStage=Wi.Create(),n._afterRenderingMeshStage=Wi.Create(),n._afterRenderingGroupDrawStage=Wi.Create(),n._afterCameraDrawStage=Wi.Create(),n._afterRenderTargetDrawStage=Wi.Create(),n._afterRenderStage=Wi.Create(),n._pointerMoveStage=Wi.Create(),n._pointerDownStage=Wi.Create(),n._pointerUpStage=Wi.Create(),n._geometriesByUniqueId=null,n._defaultMeshCandidates={data:[],length:0},n._defaultSubMeshCandidates={data:[],length:0},n._preventFreeActiveMeshesAndRenderingGroups=!1,n._activeMeshesFrozen=!1,n._activeMeshesFrozenButKeepClipping=!1,n._skipEvaluateActiveMeshesCompletely=!1,n._allowPostProcessClearColor=!0,n.getDeterministicFrameTime=function(){return n._engine.getTimeStep()},n._blockMaterialDirtyMechanism=!1,n._perfCollector=null,n.onComputePressureChanged=new we,g({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},r));return n._engine=i||Ne.LastCreatedEngine,(s.virtual?n._engine._virtualScenes:(Ne._LastCreatedScene=n)._engine.scenes).push(n),n._uid=null,n._renderingManager=new Zi(n),Gi&&(n.postProcessManager=new Gi(n)),Se()&&n.attachControl(),n._createUbo(),Li&&(n._imageProcessingConfiguration=new Li),n.setDefaultCandidateProviders(),s.useGeometryUniqueIdsMap&&(n._geometriesByUniqueId={}),n.useMaterialMeshMap=s.useMaterialMeshMap,n.useClonedMeshMap=s.useClonedMeshMap,r&&r.virtual||n._engine.onNewSceneAddedObservable.notifyObservers(n),mr.IsAvailable&&(n._computePressureObserver=new mr((function(e){n.onComputePressureChanged.notifyObservers(e)}),{cpuUtilizationThresholds:[.25,.5,.75,.9],cpuSpeedThresholds:[.5]}),n._computePressureObserver.observe()),n}return c(t,e),t.DefaultMaterialFactory=function(e){throw Fe("StandardMaterial")},t.CollisionCoordinatorFactory=function(){throw Fe("DefaultCollisionCoordinator")},Object.defineProperty(t.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DragMovementThreshold",{get:function(){return hr.DragMovementThreshold},set:function(e){hr.DragMovementThreshold=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LongPressDelay",{get:function(){return hr.LongPressDelay},set:function(e){hr.LongPressDelay=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DoubleClickDelay",{get:function(){return hr.DoubleClickDelay},set:function(e){hr.DoubleClickDelay=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ExclusiveDoubleClickMode",{get:function(){return hr.ExclusiveDoubleClickMode},set:function(e){hr.ExclusiveDoubleClickMode=e},enumerable:!1,configurable:!0}),t.prototype.bindEyePosition=function(e,t,i){void 0===t&&(t="vEyePosition"),void 0===i&&(i=!1);var r=this._forcedViewPosition||this._mirroredCameraPosition||(null!=(r=this.activeCamera.globalPosition)?r:this.activeCamera.devicePosition),n=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return hi.Vector4[0].set(r.x,r.y,r.z,n?-1:1),e&&(i?e.setFloat3(t,hi.Vector4[0].x,hi.Vector4[0].y,hi.Vector4[0].z):e.setVector4(t,hi.Vector4[0])),hi.Vector4[0]},t.prototype.finalizeSceneUbo=function(){var e=this.getSceneUniformBuffer(),t=this.bindEyePosition(null);return e.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),e.update(),e},Object.defineProperty(t.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),t.prototype.setStepId=function(e){this._currentStepId=e},t.prototype.getStepId=function(){return this._currentStepId},t.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(t.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fogMode",{get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"prePass",{get:function(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=t.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=t.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),t.prototype._registerTransientComponents=function(){if(0<this._transientComponents.length){for(var e=0,t=this._transientComponents;e<t.length;e++)t[e].register();this._transientComponents=[]}},t.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e),e.addFromContainer&&e.serialize&&this._serializableComponents.push(e)},t.prototype._getComponent=function(e){for(var t=0,i=this._components;t<i.length;t++){var r=i[t];if(r.name===e)return r}return null},t.prototype.getClassName=function(){return"Scene"},t.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},t.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},t.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(e){this._inputManager.pointerX=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(e){this._inputManager.pointerY=e},enumerable:!1,configurable:!0}),t.prototype.getCachedMaterial=function(){return this._cachedMaterial},t.prototype.getCachedEffect=function(){return this._cachedEffect},t.prototype.getCachedVisibility=function(){return this._cachedVisibility},t.prototype.isCachedMaterialInvalid=function(e,t,i){return void 0===i&&(i=1),this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==i},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(t.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),t.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(t.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),t.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(t.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),t.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(t.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},t.prototype.getRenderId=function(){return this._renderId},t.prototype.getFrameId=function(){return this._frameId},t.prototype.incrementRenderId=function(){this._renderId++},t.prototype._createUbo=function(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())},t.prototype.simulatePointerMove=function(e,t){return this._inputManager.simulatePointerMove(e,t),this},t.prototype.simulatePointerDown=function(e,t){return this._inputManager.simulatePointerDown(e,t),this},t.prototype.simulatePointerUp=function(e,t,i){return this._inputManager.simulatePointerUp(e,t,i),this},t.prototype.isPointerCaptured=function(e){return this._inputManager.isPointerCaptured(e=void 0===e?0:e)},t.prototype.attachControl=function(e,t,i){this._inputManager.attachControl(e=void 0===e||e,t=void 0===t||t,i=void 0===i||i)},t.prototype.detachControl=function(){this._inputManager.detachControl()},t.prototype.isReady=function(e){if(void 0===e&&(e=!0),this._isDisposed)return!1;var t,i=this.getEngine(),r=!0;for(0<this._pendingData.length&&(r=!1),e&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),t=0;t<this.meshes.length;t++){var n=this.meshes[t];if(n.subMeshes&&0!==n.subMeshes.length)if(n.isReady(!0)){for(var s=n.hasThinInstances||"InstancedMesh"===n.getClassName()||"InstancedLinesMesh"===n.getClassName()||i.getCaps().instancedArrays&&0<n.instances.length,a=0,o=this._isReadyForMeshStage;a<o.length;a++)o[a].action(n,s)||(r=!1);if(e){var l=n.material||this.defaultMaterial;if(l)if(l._storeEffectOnSubMeshes)for(var h=0,c=n.subMeshes;h<c.length;h++){var u=c[h].getMaterial();u&&u.hasRenderTargetTextures&&null!=u.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(u)&&(this._processedMaterials.push(u),this._materialsRenderTargets.concatWithNoDuplicate(u.getRenderTargetTextures()))}else l.hasRenderTargetTextures&&null!=l.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(l)&&(this._processedMaterials.push(l),this._materialsRenderTargets.concatWithNoDuplicate(l.getRenderTargetTextures()))}}else r=!1}if(!r)return!1;if(!i.areAllEffectsReady())return!1;if(e)for(t=0;t<this._materialsRenderTargets.length;++t)if(!this._materialsRenderTargets.data[t].isReadyForRendering())return!1;for(t=0;t<this.geometries.length;t++)if(2===this.geometries[t].delayLoadState)return!1;if(this.activeCameras&&0<this.activeCameras.length){for(var d=0,p=this.activeCameras;d<p.length;d++)if(!p[d].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var f=0,m=this.particleSystems;f<m.length;f++)if(!m[f].isReady())return!1;return!0},t.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},t.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},t.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},t.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},t.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},t.prototype._executeOnceBeforeRender=function(e){var t=this;this.registerBeforeRender((function i(){e(),setTimeout((function(){t.unregisterBeforeRender(i)}))}))},t.prototype.executeOnceBeforeRender=function(e,t){var i=this;void 0!==t?setTimeout((function(){i._executeOnceBeforeRender(e)}),t):this._executeOnceBeforeRender(e)},t.prototype._addPendingData=function(e){this._pendingData.push(e)},t.prototype._removePendingData=function(e){var t=this.isLoading;-1!==(e=this._pendingData.indexOf(e))&&this._pendingData.splice(e,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(t.prototype,"isLoading",{get:function(){return 0<this._pendingData.length},enumerable:!1,configurable:!0}),t.prototype.executeWhenReady=function(e,t){void 0===t&&(t=!1),this.onReadyObservable.add(e),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(t)},t.prototype.whenReadyAsync=function(e){var t=this;return void 0===e&&(e=!1),new Promise((function(i){t.executeWhenReady((function(){i()}),e)}))},t.prototype._checkIsReady=function(e){var t=this;return void 0===e&&(e=!1),this._registerTransientComponents(),this.isReady(e)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((function(){t._checkIsReady(e)}),100))},Object.defineProperty(t.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),t.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=De.Now},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(e,t,i,r){i||r||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?dr.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=dr.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(i,r):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))},t.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo||this._sceneUbo},t.prototype.createSceneUniformBuffer=function(e){return(e=new ki(this._engine,void 0,!1,null!=e?e:"scene")).addUniform("viewProjection",16),e.addUniform("view",16),e.addUniform("projection",16),e.addUniform("vEyePosition",4),e},t.prototype.setSceneUniformBuffer=function(e){this._sceneUbo=e,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1},t.prototype.getUniqueId=function(){return pr.UniqueId},t.prototype.addMesh=function(e,t){var i=this;void 0===t&&(t=!1),this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((function(e){i.addMesh(e)})))},t.prototype.removeMesh=function(e,t){var i=this,r=(void 0===t&&(t=!1),this.meshes.indexOf(e));return-1!==r&&(this.meshes[r]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(e),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((function(e){i.removeMesh(e)})),r},t.prototype.addTransformNode=function(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneTransformNodesArray||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))},t.prototype.removeTransformNode=function(e){var t,i=e._indexInSceneTransformNodesArray;return-1!==i&&(i!==this.transformNodes.length-1&&(t=this.transformNodes[this.transformNodes.length-1],(this.transformNodes[i]=t)._indexInSceneTransformNodesArray=i),e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()),this.onTransformNodeRemovedObservable.notifyObservers(e),i},t.prototype.removeSkeleton=function(e){var t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e),this._executeActiveContainerCleanup(this._activeSkeletons)),t},t.prototype.removeMorphTargetManager=function(e){return-1!==(e=this.morphTargetManagers.indexOf(e))&&this.morphTargetManagers.splice(e,1),e},t.prototype.removeLight=function(e){var t=this.lights.indexOf(e);if(-1!==t){for(var i=0,r=this.meshes;i<r.length;i++)r[i]._removeLightSource(e,!1);this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t},t.prototype.removeCamera=function(e){var t,i=this.cameras.indexOf(e);return-1!==i&&(this.cameras.splice(i,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras&&-1!==(t=this.activeCameras.indexOf(e))&&this.activeCameras.splice(t,1),this.activeCamera===e&&(0<this.cameras.length?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),i},t.prototype.removeParticleSystem=function(e){return-1!==(e=this.particleSystems.indexOf(e))&&(this.particleSystems.splice(e,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),e},t.prototype.removeAnimation=function(e){return-1!==(e=this.animations.indexOf(e))&&this.animations.splice(e,1),e},t.prototype.stopAnimation=function(e,t,i){},t.prototype.removeAnimationGroup=function(e){return-1!==(e=this.animationGroups.indexOf(e))&&this.animationGroups.splice(e,1),e},t.prototype.removeMultiMaterial=function(e){var t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),t},t.prototype.removeMaterial=function(e){var t,i=e._indexInSceneMaterialArray;return-1!==i&&i<this.materials.length&&(i!==this.materials.length-1&&(t=this.materials[this.materials.length-1],(this.materials[i]=t)._indexInSceneMaterialArray=i),e._indexInSceneMaterialArray=-1,this.materials.pop()),this.onMaterialRemovedObservable.notifyObservers(e),i},t.prototype.removeActionManager=function(e){return-1!==(e=this.actionManagers.indexOf(e))&&this.actionManagers.splice(e,1),e},t.prototype.removeTexture=function(e){var t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t},t.prototype.addLight=function(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(var t=0,i=this.meshes;t<i.length;t++){var r=i[t];-1===r.lightSources.indexOf(e)&&(r.lightSources.push(e),r._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)}},t.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(fr.CompareLightsPriority)},t.prototype.addCamera=function(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())},t.prototype.addSkeleton=function(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))},t.prototype.addParticleSystem=function(e){this._blockEntityCollection||this.particleSystems.push(e)},t.prototype.addAnimation=function(e){this._blockEntityCollection||this.animations.push(e)},t.prototype.addAnimationGroup=function(e){this._blockEntityCollection||this.animationGroups.push(e)},t.prototype.addMultiMaterial=function(e){this._blockEntityCollection||(this.multiMaterials.push(e),this.onNewMultiMaterialAddedObservable.notifyObservers(e))},t.prototype.addMaterial=function(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneMaterialArray||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))},t.prototype.addMorphTargetManager=function(e){this._blockEntityCollection||this.morphTargetManagers.push(e)},t.prototype.addGeometry=function(e){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))},t.prototype.addActionManager=function(e){this.actionManagers.push(e)},t.prototype.addTexture=function(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))},t.prototype.switchActiveCamera=function(e,t){void 0===t&&(t=!0),this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,t&&e.attachControl())},t.prototype.setActiveCameraById=function(e){return(e=this.getCameraById(e))?this.activeCamera=e:null},t.prototype.setActiveCameraByName=function(e){return(e=this.getCameraByName(e))?this.activeCamera=e:null},t.prototype.getAnimationGroupByName=function(e){for(var t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null},t.prototype.getMaterialByUniqueID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].uniqueId===e)return this.materials[t];return null},t.prototype.getMaterialById=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},t.prototype.getLastMaterialById=function(e,t){void 0===t&&(t=!1);for(var i=this.materials.length-1;0<=i;i--)if(this.materials[i].id===e)return this.materials[i];if(t)for(i=this.multiMaterials.length-1;0<=i;i--)if(this.multiMaterials[i].id===e)return this.multiMaterials[i];return null},t.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},t.prototype.getTextureByUniqueId=function(e){for(var t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===e)return this.textures[t];return null},t.prototype.getTextureByName=function(e){for(var t=0;t<this.textures.length;t++)if(this.textures[t].name===e)return this.textures[t];return null},t.prototype.getCameraById=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},t.prototype.getCameraByUniqueId=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},t.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},t.prototype.getBoneById=function(e){for(var t=0;t<this.skeletons.length;t++)for(var i=this.skeletons[t],r=0;r<i.bones.length;r++)if(i.bones[r].id===e)return i.bones[r];return null},t.prototype.getBoneByName=function(e){for(var t=0;t<this.skeletons.length;t++)for(var i=this.skeletons[t],r=0;r<i.bones.length;r++)if(i.bones[r].name===e)return i.bones[r];return null},t.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},t.prototype.getLightById=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getLightByUniqueId=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},t.prototype.getParticleSystemById=function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null},t.prototype.getGeometryById=function(e){for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null},t.prototype._getGeometryByUniqueId=function(e){if(this._geometriesByUniqueId){if(void 0!==(t=this._geometriesByUniqueId[e]))return this.geometries[t]}else for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].uniqueId===e)return this.geometries[t];return null},t.prototype.pushGeometry=function(e,t){return!(!t&&this._getGeometryByUniqueId(e.uniqueId)||(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),0))},t.prototype.removeGeometry=function(e){var t,i;if(this._geometriesByUniqueId){if(void 0===(t=this._geometriesByUniqueId[e.uniqueId]))return!1}else if((t=this.geometries.indexOf(e))<0)return!1;return t!==this.geometries.length-1&&(i=this.geometries[this.geometries.length-1])&&(this.geometries[t]=i,this._geometriesByUniqueId&&(this._geometriesByUniqueId[i.uniqueId]=t,this._geometriesByUniqueId[e.uniqueId]=void 0)),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getMeshById=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getMeshesById=function(e){return this.meshes.filter((function(t){return t.id===e}))},t.prototype.getTransformNodeById=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null},t.prototype.getTransformNodeByUniqueId=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null},t.prototype.getTransformNodesById=function(e){return this.transformNodes.filter((function(t){return t.id===e}))},t.prototype.getMeshByUniqueId=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},t.prototype.getLastMeshById=function(e){for(var t=this.meshes.length-1;0<=t;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getLastEntryById=function(e){for(var t=this.meshes.length-1;0<=t;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;0<=t;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;0<=t;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;0<=t;t--)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getNodeById=function(e){var t=this.getMeshById(e);return t||((t=this.getTransformNodeById(e))||(t=this.getLightById(e))||(t=this.getCameraById(e))?t:(t=this.getBoneById(e))||null)},t.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);return t||((t=this.getTransformNodeByName(e))||(t=this.getLightByName(e))||(t=this.getCameraByName(e))?t:(t=this.getBoneByName(e))||null)},t.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},t.prototype.getTransformNodeByName=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null},t.prototype.getLastSkeletonById=function(e){for(var t=this.skeletons.length-1;0<=t;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByUniqueId=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null},t.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},t.prototype.getMorphTargetManagerById=function(e){for(var t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null},t.prototype.getMorphTargetById=function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var i=this.morphTargetManagers[t],r=0;r<i.numTargets;++r){var n=i.getTarget(r);if(n.id===e)return n}return null},t.prototype.getMorphTargetByName=function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var i=this.morphTargetManagers[t],r=0;r<i.numTargets;++r){var n=i.getTarget(r);if(n.name===e)return n}return null},t.prototype.getPostProcessByName=function(e){for(var t=0;t<this.postProcesses.length;++t){var i=this.postProcesses[t];if(i.name===e)return i}return null},t.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=Wt.RandomId()),this._uid},enumerable:!1,configurable:!0}),t.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new qt),this._externalData.add(e,t)},t.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},t.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new qt),this._externalData.getOrAddWithFactory(e,t)},t.prototype.removeExternalData=function(e){return this._externalData.remove(e)},t.prototype._evaluateSubMesh=function(e,t,i){if(i.hasInstances||i.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){for(var r=0,n=this._evaluateSubMeshStage;r<n.length;r++)n[r].action(t,e);null!=(i=e.getMaterial())&&(i.hasRenderTargetTextures&&null!=i.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._materialsRenderTargets.concatWithNoDuplicate(i.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,i))}},t.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(t.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)},enumerable:!1,configurable:!0}),t.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}},t.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}},t.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},t.prototype.freezeActiveMeshes=function(e,t,i,r,n){var s=this;return void 0===e&&(e=!1),void 0===r&&(r=!0),void 0===n&&(n=!1),this.executeWhenReady((function(){if(s.activeCamera){if(s._frustumPlanes||s.updateTransformMatrix(),s._evaluateActiveMeshes(),s._activeMeshesFrozen=!0,s._activeMeshesFrozenButKeepClipping=n,s._skipEvaluateActiveMeshesCompletely=e,r)for(var a=0;a<s._activeMeshes.length;a++)s._activeMeshes.data[a]._freeze();t&&t()}else i&&i("No active camera found")})),this},t.prototype.unfreezeActiveMeshes=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this},t.prototype._executeActiveContainerCleanup=function(e){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((function(){return e.dispose()}))},t.prototype._evaluateActiveMeshes=function(){var e;if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)0<this._activeMeshes.length&&(null!=(e=this.activeCamera)&&e._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset());else if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var t=this._activeMeshes.length,i=0;i<t;i++)(l=this._activeMeshes.data[i]).computeWorldMatrix();if(this._activeParticleSystems){var r=this._activeParticleSystems.length;for(i=0;i<r;i++)this._activeParticleSystems.data[i].animate()}}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(var n=0,s=this._beforeEvaluateActiveMeshStage;n<s.length;n++)s[n].action();var a=this.getActiveMeshCandidates(),o=a.length;for(i=0;i<o;i++){var l=a.data[i];if(l._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!l.isBlocked&&(this._totalVertices.addCount(l.getTotalVertices(),!1),l.isReady()&&l.isEnabled()&&!l.scaling.hasAZeroComponent)){l.computeWorldMatrix(),l.actionManager&&l.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(l);var h=this.customLODSelector?this.customLODSelector(l,this.activeCamera):l.getLOD(this.activeCamera);if(l._internalAbstractMeshDataInfo._currentLOD=h,l._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,null!=h&&(h!==l&&0!==h.billboardMode&&h.computeWorldMatrix(),l._preActivate(),l.isVisible&&0<l.visibility&&0!=(l.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||l.alwaysSelectAsActiveMesh||l.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(l),this.activeCamera._activeMeshes.push(l),h!==l&&h._activate(this._renderId,!1);for(var c=0,u=this._preActiveMeshStage;c<u.length;c++)u[c].action(l);l._activate(this._renderId,!1)&&(l.isAnInstance?l._internalAbstractMeshDataInfo._actAsRegularMesh&&(h=l):h._internalAbstractMeshDataInfo._onlyForInstances=!1,h._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(l,h)),l._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var d=0;d<this.particleSystems.length;d++){var p,f=this.particleSystems[d];f.isStarted()&&f.emitter&&((p=f.emitter).position&&!p.isEnabled()||(this._activeParticleSystems.push(f),f.animate(),this._renderingManager.dispatchParticles(f)))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},t.prototype._activeMesh=function(e,t){if(this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&(t.skeleton.prepare(),this._activeBones.addCount(t.skeleton.bones.length,!1)),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t)),t&&t.subMeshes&&0<t.subMeshes.length)for(var i=this.getActiveSubMeshCandidates(t),r=i.length,n=0;n<r;n++){var s=i.data[n];this._evaluateSubMesh(s,t,e)}},t.prototype.updateTransformMatrix=function(e){var t,i;this.activeCamera&&(this.activeCamera._renderingMultiview?(t=this.activeCamera._rigCameras[0],i=this.activeCamera._rigCameras[1],this.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(e),i.getViewMatrix(),i.getProjectionMatrix(e))):this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e)))},t.prototype._bindFrameBuffer=function(e,t){void 0===t&&(t=!0),e&&e._multiviewTexture?e._multiviewTexture._bindFrameBuffer():e&&e.outputRenderTarget?e.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),t&&this._clearFrameBuffer(e)},t.prototype._clearFrameBuffer=function(e){e&&e._multiviewTexture||(e&&e.outputRenderTarget?(e=e.outputRenderTarget).onClearObservable.hasObservers()?e.onClearObservable.notifyObservers(this._engine):e.skipInitialClear||(this._engine.clear(e.clearColor||this.clearColor,!e._cleared,!0,!0),e._cleared=!0):this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear()))},t.prototype._renderForCamera=function(e,t,i){if(void 0===i&&(i=!0),!e||!e._skipRendering){var r=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");r.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&i&&(i=!0,e._renderingMultiview&&e.outputRenderTarget&&(i=e.outputRenderTarget.skipInitialClear,this.autoClear&&(e.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),e._renderingMultiview&&e.outputRenderTarget&&(e.outputRenderTarget.skipInitialClear=i)),this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var n=0;n<this._softwareSkinnedMeshes.length;n++){var s=this._softwareSkinnedMeshes.data[n];s.applySkeleton(s.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),e.customRenderTargets&&0<e.customRenderTargets.length&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&0<t.customRenderTargets.length&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(var a=0,o=this._gatherActiveCameraRenderTargetsStage;a<o.length;a++)o[a].action(this._renderTargets);var l=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,0<this._renderTargets.length){Wt.StartPerformanceCounter("Render targets",0<this._renderTargets.length);for(var h=0;h<this._renderTargets.length;h++){var c,u=this._renderTargets.data[h];u._shouldRender()&&(this._renderId++,c=u.activeCamera&&u.activeCamera!==this.activeCamera,u.render(c,this.dumpNextRenderTargets),l=!0)}Wt.EndPerformanceCounter("Render targets",0<this._renderTargets.length),this._renderId++}for(var d=0,p=this._cameraDrawRenderTargetStage;d<p.length;d++)l=p[d].action(this.activeCamera)||l;this._intermediateRendering=!1}this._engine.currentRenderPassId=null!=(i=null!=(t=null==(i=e.outputRenderTarget)?void 0:i.renderPassId)?t:e.renderPassId)?i:0,l&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||e._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(var f=0,m=this._beforeCameraDrawStage;f<m.length;f++)m[f].action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),r.snapshotRendering&&1===r.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var _=0,g=this._afterCameraDrawStage;_<g.length;_++)g[_].action(this.activeCamera);this.postProcessManager&&!e._multiviewTexture&&(t=e.outputRenderTarget?e.outputRenderTarget.renderTarget:void 0,this.postProcessManager._finalizeFrame(e.isIntermediate,t)),this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},t.prototype._processSubCameras=function(e,t){if(void 0===t&&(t=!0),0===e.cameraRigMode||e._renderingMultiview)return e._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(e,void 0,t),void this.onAfterRenderCameraObservable.notifyObservers(e);if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else{this.onBeforeCameraRenderObservable.notifyObservers(e);for(var i=0;i<e._rigCameras.length;i++)this._renderForCamera(e._rigCameras[i],e)}this._activeCamera=e,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(e)},t.prototype._checkIntersections=function(){for(var e=0;e<this._meshesForIntersections.length;e++){var t=this._meshesForIntersections.data[e];if(t.actionManager)for(var i=0;t.actionManager&&i<t.actionManager.actions.length;i++)!function(e){var i,r,n;12!==(e=t.actionManager.actions[e]).trigger&&13!==e.trigger||(r=e.getTriggerParameter(),r=(i=r.mesh||r).intersectsMesh(t,r.usePreciseIntersection),n=t._intersectionsInProgress.indexOf(i),r&&-1===n?12===e.trigger?(e._executeCurrent(Ui.CreateNew(t,void 0,i)),t._intersectionsInProgress.push(i)):13===e.trigger&&t._intersectionsInProgress.push(i):!r&&-1<n&&(13===e.trigger&&e._executeCurrent(Ui.CreateNew(t,void 0,i)),t.actionManager.hasSpecificTrigger(13,(function(e){return e=e.mesh||e,i===e}))&&13!==e.trigger||t._intersectionsInProgress.splice(n,1)))}(i)}},t.prototype._advancePhysicsEngineStep=function(e){},t.prototype._animate=function(){},t.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var e=Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime))+this._timeAccumulator,i=this._engine.getTimeStep(),r=1e3/i/1e3,n=0,s=this._engine.getLockstepMaxSteps(),a=Math.floor(e/i);for(a=Math.min(a,s);0<e&&n<a;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=i*r,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(i),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,n++,e-=i;this._timeAccumulator=e<0?0:e}else e=this.useConstantAnimationDeltaTime?16:Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime)),this._animationRatio=.06*e,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(e)},t.prototype._clear=function(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)},t.prototype._checkCameraRenderTarget=function(e){var t;if(null==e||!e.outputRenderTarget||null!=e&&e.isRigCamera||(e.outputRenderTarget._cleared=!1),null!=(t=null==e?void 0:e.rigCameras)&&t.length)for(var i=0;i<e.rigCameras.length;++i){var r=e.rigCameras[i].outputRenderTarget;r&&(r._cleared=!1)}},t.prototype.resetDrawCache=function(e){if(this.meshes)for(var t=0,i=this.meshes;t<i.length;t++)i[t].resetDrawCache(e)},t.prototype.render=function(e,t){var i;if(void 0===e&&(e=!0),void 0===t&&(t=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!=(i=this.activeCameras)&&i.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),t||this.animate();for(var r=0,n=this._beforeCameraUpdateStage;r<n.length;r++)n[r].action();if(e)if(this.activeCameras&&0<this.activeCameras.length)for(var s=0;s<this.activeCameras.length;s++){var a=this.activeCameras[s];if(a.update(),0!==a.cameraRigMode)for(var o=0;o<a._rigCameras.length;o++)a._rigCameras[o].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(o=0;o<this.activeCamera._rigCameras.length;o++)this.activeCamera._rigCameras[o].update();this.onBeforeRenderObservable.notifyObservers(this);var l=this.getEngine(),h=(this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),null!=(i=this.activeCameras)&&i.length?this.activeCameras[0]:this.activeCamera);if(this.renderTargetsEnabled){Wt.StartPerformanceCounter("Custom render targets",0<this.customRenderTargets.length),this._intermediateRendering=!0;for(var c=0;c<this.customRenderTargets.length;c++){var u=this.customRenderTargets[c];if(u._shouldRender()){if(this._renderId++,this.activeCamera=u.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");l.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),u.render(h!==this.activeCamera,this.dumpNextRenderTargets)}}Wt.EndPerformanceCounter("Custom render targets",0<this.customRenderTargets.length),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=null!=(t=null==h?void 0:h.renderPassId)?t:0,this.activeCamera=h,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var d=0,p=this._beforeClearStage;d<p.length;d++)p[d].action();this._clearFrameBuffer(this.activeCamera);for(var f=0,m=this._gatherRenderTargetsStage;f<m.length;f++)m[f].action(this._renderTargets);if(this.activeCameras&&0<this.activeCameras.length)for(s=0;s<this.activeCameras.length;s++)this._processSubCameras(this.activeCameras[s],0<s);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(var _=0,g=this._afterRenderStage;_<g.length;_++)g[_].action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(o=0;o<this._toBeDisposed.length;o++){var y=this._toBeDisposed[o];y&&y.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}},t.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},t.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},t.prototype.dispose=function(){if(!this.isDisposed){this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var e=0,t=this._activeRequests.slice();e<t.length;e++)t[e].abort();if(this._activeRequests=[],this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onComputePressureChanged.clear(),null!=(r=this._computePressureObserver)&&r.unobserve(),this._computePressureObserver=void 0,this.detachControl(),this._engine.getInputElement())for(var i=0;i<this.cameras.length;i++)this.cameras[i].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(function(e){return e.dispose(!0)})),this._disposeList(this.transformNodes,(function(e){return e.dispose(!0)})),this._disposeList(this.cameras),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);var r=this._engine.scenes.indexOf(this);-1<r&&this._engine.scenes.splice(r,1),Ne._LastCreatedScene===this&&(0<this._engine.scenes.length?Ne._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:Ne._LastCreatedScene=null),-1<(r=this._engine._virtualScenes.indexOf(this))&&this._engine._virtualScenes.splice(r,1),this._engine.wipeCaches(!0),this._isDisposed=!0}},t.prototype._disposeList=function(e,t){t=null!=t?t:function(e){return e.dispose()};for(var i=0,r=e.slice(0);i<r.length;i++)t(r[i]);e.length=0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),t.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e].geometry;t&&t.clearCachedData()}},t.prototype.cleanCachedTextureBuffer=function(){for(var e=0,t=this.textures;e<t.length;e++){var i=t[e];i._buffer&&(i._buffer=null)}},t.prototype.getWorldExtends=function(e){var t=new ni(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new ni(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return this.meshes.filter(e=e||function(){return!0}).forEach((function(e){var r;e.computeWorldMatrix(!0),e.subMeshes&&0!==e.subMeshes.length&&!e.infiniteDistance&&(r=(e=e.getBoundingInfo()).boundingBox.minimumWorld,e=e.boundingBox.maximumWorld,ni.CheckExtends(r,t,i),ni.CheckExtends(e,t,i))})),{min:t,max:i}},t.prototype.createPickingRay=function(e,t,i,r,n){throw Fe("Ray")},t.prototype.createPickingRayToRef=function(e,t,i,r,n,s,a){throw Fe("Ray")},t.prototype.createPickingRayInCameraSpace=function(e,t,i){throw Fe("Ray")},t.prototype.createPickingRayInCameraSpaceToRef=function(e,t,i,r){throw Fe("Ray")},t.prototype.pick=function(e,t,i,r,n,s){var a=new zi;return a._pickingUnavailable=!0,a},t.prototype.pickWithBoundingInfo=function(e,t,i,r,n){var s=new zi;return s._pickingUnavailable=!0,s},t.prototype.pickWithRay=function(e,t,i,r){throw Fe("Ray")},t.prototype.multiPick=function(e,t,i,r,n){throw Fe("Ray")},t.prototype.multiPickWithRay=function(e,t,i){throw Fe("Ray")},t.prototype.setPointerOverMesh=function(e,t,i){this._inputManager.setPointerOverMesh(e,t,i)},t.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},t.prototype._rebuildGeometries=function(){for(var e=0,t=this.geometries;e<t.length;e++)t[e]._rebuild();for(var i=0,r=this.meshes;i<r.length;i++)r[i]._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(var n=0,s=this._components;n<s.length;n++)s[n].rebuild();for(var a=0,o=this.particleSystems;a<o.length;a++)o[a].rebuild();if(this.spriteManagers)for(var l=0,h=this.spriteManagers;l<h.length;l++)h[l].rebuild()},t.prototype._rebuildTextures=function(){for(var e=0,t=this.textures;e<t.length;e++)t[e]._rebuild();this.markAllMaterialsAsDirty(1)},t.prototype._getByTags=function(e,t,i){if(void 0===t)return e;var r,n=[];for(r in i=i||function(e){},e){var s=e[r];Yt&&Yt.MatchesQuery(s,t)&&(n.push(s),i(s))}return n},t.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},t.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},t.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},t.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},t.prototype.getTransformNodesByTags=function(e,t){return this._getByTags(this.transformNodes,e,t)},t.prototype.setRenderingOrder=function(e,t,i,r){this._renderingManager.setRenderingOrder(e,t=void 0===t?null:t,i=void 0===i?null:i,r=void 0===r?null:r)},t.prototype.setRenderingAutoClearDepthStencil=function(e,t,i,r){this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i=void 0===i||i,r=void 0===r||r)},t.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(t.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism===e||(this._blockMaterialDirtyMechanism=e)||this.markAllMaterialsAsDirty(63)},enumerable:!1,configurable:!0}),t.prototype.markAllMaterialsAsDirty=function(e,t){if(!this._blockMaterialDirtyMechanism)for(var i=0,r=this.materials;i<r.length;i++){var n=r[i];t&&!t(n)||n.markAsDirty(e)}},t.prototype._loadFile=function(e,t,i,r,n,s,a){var o=this;e=Ft(e,t,i,r?this.offlineProvider:void 0,n,s,a);return this._activeRequests.push(e),e.onCompleteObservable.add((function(e){o._activeRequests.splice(o._activeRequests.indexOf(e),1)})),e},t.prototype._loadFileAsync=function(e,t,i,r,n){var s=this;return new Promise((function(a,o){s._loadFile(e,(function(e){a(e)}),t,i,r,(function(e,t){o(t)}),n)}))},t.prototype._requestFile=function(e,t,i,r,n,s,a){var o=this;e=Lt(e,t,i,r?this.offlineProvider:void 0,n,s,a);return this._activeRequests.push(e),e.onCompleteObservable.add((function(e){o._activeRequests.splice(o._activeRequests.indexOf(e),1)})),e},t.prototype._requestFileAsync=function(e,t,i,r,n){var s=this;return new Promise((function(a,o){s._requestFile(e,(function(e){a(e)}),t,i,r,(function(e){o(e)}),n)}))},t.prototype._readFile=function(e,t,i,r,n){var s=this;e=Dt(e,t,i,r,n);return this._activeRequests.push(e),e.onCompleteObservable.add((function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)})),e},t.prototype._readFileAsync=function(e,t,i){var r=this;return new Promise((function(n,s){r._readFile(e,(function(e){n(e)}),t,i,(function(e){s(e)}))}))},t.prototype.getPerfCollector=function(){throw Fe("performanceViewerSceneExtension")},t.FOGMODE_NONE=0,t.FOGMODE_EXP=1,t.FOGMODE_EXP2=2,t.FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}(ui),gr=(_r.prototype.setActiveCameraByID=function(e){return this.setActiveCameraById(e)},_r.prototype.getLastMaterialByID=function(e){return this.getLastMaterialById(e)},_r.prototype.getMaterialByID=function(e){return this.getMaterialById(e)},_r.prototype.getTextureByUniqueID=function(e){return this.getTextureByUniqueId(e)},_r.prototype.getCameraByID=function(e){return this.getCameraById(e)},_r.prototype.getCameraByUniqueID=function(e){return this.getCameraByUniqueId(e)},_r.prototype.getBoneByID=function(e){return this.getBoneById(e)},_r.prototype.getLightByID=function(e){return this.getLightById(e)},_r.prototype.getLightByUniqueID=function(e){return this.getLightByUniqueId(e)},_r.prototype.getParticleSystemByID=function(e){return this.getParticleSystemById(e)},_r.prototype.getGeometryByID=function(e){return this.getGeometryById(e)},_r.prototype.getMeshByID=function(e){return this.getMeshById(e)},_r.prototype.getMeshesByID=function(e){return this.getMeshesById(e)},_r.prototype.getTransformNodeByID=function(e){return this.getTransformNodeById(e)},_r.prototype.getTransformNodeByUniqueID=function(e){return this.getTransformNodeByUniqueId(e)},_r.prototype.getTransformNodesByID=function(e){return this.getTransformNodesById(e)},_r.prototype.getMeshByUniqueID=function(e){return this.getMeshByUniqueId(e)},_r.prototype.getLastMeshByID=function(e){return this.getLastMeshById(e)},_r.prototype.getLastEntryByID=function(e){return this.getLastEntryById(e)},_r.prototype.getNodeByID=function(e){return this.getNodeById(e)},_r.prototype.getLastSkeletonByID=function(e){return this.getLastSkeletonById(e)},function(){function e(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new yr(e)}return e.prototype.sampleFrame=function(e){var t;void 0===e&&(e=De.Now),this._enabled&&(null!=this._lastFrameTimeMs&&(t=e-this._lastFrameTimeMs,this._rollingFrameTime.add(t)),this._lastFrameTimeMs=e)},Object.defineProperty(e.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._enabled=!0},e.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},e}()),yr=function(){function e(e){this._samples=new Array(e),this.reset()}return e.prototype.add=function(e){var t,i;this.isSaturated()?(i=(t=this._samples[this._pos])-this.average,this.average-=i/(this._sampleCount-1),this._m2-=i*(t-this.average)):this._sampleCount++,i=e-this.average,this.average+=i/this._sampleCount,this._m2+=i*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},e.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},e.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},e.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},e.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},e}();Ct.prototype.setAlphaConstants=function(e,t,i,r){this._alphaState.setAlphaBlendConstants(e,t,i,r)},Ct.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}},Ct.prototype.getAlphaMode=function(){return this._alphaMode},Ct.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=e}},Ct.prototype.getAlphaEquation=function(){return this._alphaEquation},Ct.prototype._readTexturePixelsSync=function(e,t,i,r,n,s,a,o,l,h){void 0===r&&(r=-1),void 0===n&&(n=0),void 0===s&&(s=null),void 0===a&&(a=!0),void 0===o&&(o=!1),void 0===l&&(l=0),void 0===h&&(h=0);var c=this._gl;if(!c)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var u=c.createFramebuffer();if(!u)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=u}return c.bindFramebuffer(c.FRAMEBUFFER,this._dummyFramebuffer),-1<r?c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_CUBE_MAP_POSITIVE_X+r,null==(u=e._hardwareTexture)?void 0:u.underlyingResource,n):c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,null==(r=e._hardwareTexture)?void 0:r.underlyingResource,n),u=void 0!==e.type?this._getWebGLTextureType(e.type):c.UNSIGNED_BYTE,o?s=s||function(e,t,i,r){switch(void 0===i&&(i=!1),e){case 3:ArrayBuffer;var n=new Int8Array(t);return r&&n.set(new Int8Array(r)),n;case 0:return ArrayBuffer,n=new Uint8Array(t),r&&n.set(new Uint8Array(r)),n;case 4:return n=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(i?t/2:t),r&&n.set(new Int16Array(r)),n;case 5:case 8:case 9:case 10:case 2:return n=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(i?t/2:t),r&&n.set(new Uint16Array(r)),n;case 6:return n=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(i?t/4:t),r&&n.set(new Int32Array(r)),n;case 7:case 11:case 12:case 13:case 14:case 15:return n=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(i?t/4:t),r&&n.set(new Uint32Array(r)),n;case 1:return n=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(i?t/4:t),r&&n.set(new Float32Array(r)),n}return ArrayBuffer,e=new Uint8Array(t),r&&e.set(new Uint8Array(r)),e}(e.type,4*t*i):u=u===c.UNSIGNED_BYTE?(s=s||new Uint8Array(4*t*i),c.UNSIGNED_BYTE):(s=s||new Float32Array(4*t*i),c.FLOAT),a&&this.flushFramebuffer(),c.readPixels(l,h,t,i,c.RGBA,u,s),c.bindFramebuffer(c.FRAMEBUFFER,this._currentFramebuffer),s},Ct.prototype._readTexturePixels=function(e,t,i,r,n,s,a,o,l,h){return void 0===r&&(r=-1),void 0===n&&(n=0),void 0===s&&(s=null),void 0===a&&(a=!0),void 0===o&&(o=!1),void 0===l&&(l=0),void 0===h&&(h=0),Promise.resolve(this._readTexturePixelsSync(e,t,i,r,n,s,a,o,l,h))},Ct.prototype.updateDynamicIndexBuffer=function(e,t,i){this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),e=e.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},Ct.prototype.updateDynamicVertexBuffer=function(e,t,i,r){this.bindArrayBuffer(e),void 0===i&&(i=0),e=t.byteLength||t.length,void 0===r||e<=r&&0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(i,i+r)):(t=t instanceof ArrayBuffer?new Uint8Array(t,i,r):new Uint8Array(t.buffer,t.byteOffset+i,r),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()};var vr,br,Er,xr,Cr,wr,Sr=function(e){function t(i,r,n,s){var a,o,l=e.call(this,i,r,n,s=void 0!==s&&s)||this;return l.enableOfflineSupport=!1,l.disableManifestCheck=!1,l.scenes=new Array,l._virtualScenes=new Array,l.onNewSceneAddedObservable=new we,l.postProcesses=new Array,l.isPointerLock=!1,l.onResizeObservable=new we,l.onCanvasBlurObservable=new we,l.onCanvasFocusObservable=new we,l.onCanvasPointerOutObservable=new we,l.onBeginFrameObservable=new we,l.customAnimationFrameRequester=null,l.onEndFrameObservable=new we,l.onBeforeShaderCompilationObservable=new we,l.onAfterShaderCompilationObservable=new we,l._deterministicLockstep=!1,l._lockstepMaxSteps=4,l._timeStep=1/60,l._fps=60,l._deltaTime=0,l._drawCalls=new cr,l.canvasTabIndex=1,l.disablePerformanceMonitorInBackground=!1,l._performanceMonitor=new gr,l._compatibilityMode=!0,l.currentRenderPassId=0,l._renderPassNames=["main"],t.Instances.push(l),i&&(l._features.supportRenderPasses=!0,n=l._creationOptions,i.getContext&&(l._sharedInit(a=i,!!n.doNotHandleTouchAction,n.audioEngine),Se()&&(o=document,l._onFullscreenChange=function(){void 0!==o.fullscreen?l.isFullscreen=o.fullscreen:void 0!==o.mozFullScreen?l.isFullscreen=o.mozFullScreen:void 0!==o.webkitIsFullScreen?l.isFullscreen=o.webkitIsFullScreen:void 0!==o.msIsFullScreen&&(l.isFullscreen=o.msIsFullScreen),l.isFullscreen&&l._pointerLockRequested&&a&&t._RequestPointerlock(a)},document.addEventListener("fullscreenchange",l._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",l._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",l._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",l._onFullscreenChange,!1),l._onPointerLockChange=function(){l.isPointerLock=o.mozPointerLockElement===a||o.webkitPointerLockElement===a||o.msPointerLockElement===a||o.pointerLockElement===a},document.addEventListener("pointerlockchange",l._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",l._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",l._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",l._onPointerLockChange,!1),!t.audioEngine&&n.audioEngine&&t.AudioEngineFactory&&(t.audioEngine=t.AudioEngineFactory(l.getRenderingCanvas(),l.getAudioContext(),l.getAudioDestination()))),l._connectVREvents(),l.enableOfflineSupport=void 0!==t.OfflineProviderFactory,l._deterministicLockstep=!!n.deterministicLockstep,l._lockstepMaxSteps=n.lockstepMaxSteps||0,l._timeStep=n.timeStep||1/60),l._prepareVRComponent(),n.autoEnableWebVR&&l.initWebVR()),l}return c(t,e),Object.defineProperty(t,"NpmPackage",{get:function(){return Ct.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Version",{get:function(){return Ct.Version},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Instances",{get:function(){return Ne.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LastCreatedEngine",{get:function(){return Ne.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LastCreatedScene",{get:function(){return Ne.LastCreatedScene},enumerable:!1,configurable:!0}),t.prototype._createImageBitmapFromSource=function(e,t){var i=this;return new Promise((function(r,n){var s=new Image;s.onload=function(){s.decode().then((function(){i.createImageBitmap(s,t).then((function(e){r(e)}))}))},s.onerror=function(){n("Error loading image ".concat(s.src))},s.src=e}))},t.prototype.createImageBitmap=function(e,t){return createImageBitmap(e,t)},t.prototype.resizeImageBitmap=function(e,t,i){var r=this.createCanvas(t,i).getContext("2d");if(r)return r.drawImage(e,0,0),r.getImageData(0,0,t,i).data;throw new Error("Unable to get 2d context for resizeImageBitmap")},t.MarkAllMaterialsAsDirty=function(e,i){for(var r=0;r<t.Instances.length;r++)for(var n=t.Instances[r],s=0;s<n.scenes.length;s++)n.scenes[s].markAllMaterialsAsDirty(e,i)},t.DefaultLoadingScreenFactory=function(e){throw Fe("LoadingScreen")},Object.defineProperty(t.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!t._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"compatibilityMode",{get:function(){return this._compatibilityMode},set:function(e){this._compatibilityMode=!0},enumerable:!1,configurable:!0}),t.prototype.getInputElement=function(){return this._renderingCanvas},t.prototype._sharedInit=function(i,r,n){var s,a=this;e.prototype._sharedInit.call(this,i,r,n),this._onCanvasFocus=function(){a.onCanvasFocusObservable.notifyObservers(a)},this._onCanvasBlur=function(){a.onCanvasBlurObservable.notifyObservers(a)},i.addEventListener("focus",this._onCanvasFocus),i.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){a.disablePerformanceMonitorInBackground&&a._performanceMonitor.disable(),a._windowIsBackground=!0},this._onFocus=function(){a.disablePerformanceMonitorInBackground&&a._performanceMonitor.enable(),a._windowIsBackground=!1},this._onCanvasPointerOut=function(e){document.elementFromPoint(e.clientX,e.clientY)!==i&&a.onCanvasPointerOutObservable.notifyObservers(e)},Se()&&(s=this.getHostWindow())&&(s.addEventListener("blur",this._onBlur),s.addEventListener("focus",this._onFocus)),i.addEventListener("pointerout",this._onCanvasPointerOut),r||this._disableTouchAction(),!t.audioEngine&&n&&t.AudioEngineFactory&&(t.audioEngine=t.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination()))},t.prototype.getAspectRatio=function(e,t){return e=e.viewport,this.getRenderWidth(t=void 0!==t&&t)*e.width/(this.getRenderHeight(t)*e.height)},t.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},t.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},t.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},t.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},t.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},t.prototype.getTimeStep=function(){return 1e3*this._timeStep},t.prototype.generateMipMapsForCubemap=function(e,t){var i;void 0===t&&(t=!0),e.generateMipMaps&&(i=this._gl,this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,e,!0),i.generateMipmap(i.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null))},t.prototype.getDepthBuffer=function(){return this._depthCullingState.depthTest},t.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},t.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},t.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},t.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},t.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},t.prototype.getStencilMask=function(){return this._stencilState.stencilMask},t.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},t.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},t.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},t.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},t.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},t.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},t.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},t.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},t.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},t.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},t.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},t.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},t.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},t.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},t.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},t.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},t.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},t.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},t.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},t.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},t.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},t.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},t.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},t.prototype.setDirectViewport=function(e,t,i,r){var n=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,i,r),n},t.prototype.scissorClear=function(e,t,i,r,n){this.enableScissor(e,t,i,r),this.clear(n,!0,!0,!0),this.disableScissor()},t.prototype.enableScissor=function(e,t,i,r){var n=this._gl;n.enable(n.SCISSOR_TEST),n.scissor(e,t,i,r)},t.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},t.prototype._reportDrawCall=function(e){this._drawCalls.addCount(e=void 0===e?1:e,!1)},t.prototype.initWebVR=function(){throw Fe("WebVRCamera")},t.prototype._prepareVRComponent=function(){},t.prototype._connectVREvents=function(e,t){},t.prototype._submitVRFrame=function(){},t.prototype.disableVR=function(){},t.prototype.isVRPresenting=function(){return!1},t.prototype._requestVRFrame=function(){},t.prototype._loadFileAsync=function(e,t,i){var r=this;return new Promise((function(n,s){r._loadFile(e,(function(e){n(e)}),void 0,t,i,(function(e,t){s(t)}))}))},t.prototype.getVertexShaderSource=function(e){return(e=this._gl.getAttachedShaders(e))?this._gl.getShaderSource(e[0]):null},t.prototype.getFragmentShaderSource=function(e){return(e=this._gl.getAttachedShaders(e))?this._gl.getShaderSource(e[1]):null},t.prototype.setDepthStencilTexture=function(e,t,i,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),i&&i.depthStencilTexture?this._setTexture(e,i,!1,!0,r):this._setTexture(e,null,void 0,void 0,r))},t.prototype.setTextureFromPostProcess=function(e,t,i){var r=null;t&&(t._textures.data[t._currentRenderTextureInd]?r=t._textures.data[t._currentRenderTextureInd]:t._forcedOutputTexture&&(r=t._forcedOutputTexture)),this._bindTexture(e,null!=(t=null==r?void 0:r.texture)?t:null,i)},t.prototype.setTextureFromPostProcessOutput=function(e,t,i){this._bindTexture(e,null!=(t=null==(e=null==t?void 0:t._outputTexture)?void 0:e.texture)?t:null,i)},t.prototype._rebuildBuffers=function(){for(var t=0,i=this.scenes;t<i.length;t++)(r=i[t]).resetCachedMaterial(),r._rebuildGeometries(),r._rebuildTextures();for(var r,n=0,s=this._virtualScenes;n<s.length;n++)(r=s[n]).resetCachedMaterial(),r._rebuildGeometries(),r._rebuildTextures();e.prototype._rebuildBuffers.call(this)},t.prototype._renderFrame=function(){for(var e=0;e<this._activeRenderLoops.length;e++)(0,this._activeRenderLoops[e])()},t.prototype._renderLoop=function(){var e;this._contextWasLost||(e=!0,(e=!(!this.renderEvenInBackground&&this._windowIsBackground)&&e)&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())),0<this._activeRenderLoops.length?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},t.prototype._renderViews=function(){return!1},t.prototype.switchFullscreen=function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)},t.prototype.enterFullscreen=function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&t._RequestFullscreen(this._renderingCanvas))},t.prototype.exitFullscreen=function(){this.isFullscreen&&t._ExitFullscreen()},t.prototype.enterPointerlock=function(){this._renderingCanvas&&t._RequestPointerlock(this._renderingCanvas)},t.prototype.exitPointerlock=function(){t._ExitPointerlock()},t.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),e.prototype.beginFrame.call(this)},t.prototype.endFrame=function(){e.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},t.prototype.resize=function(t){void 0===t&&(t=!1),this.isVRPresenting()||e.prototype.resize.call(this,t)},t.prototype.setSize=function(t,i,r){if(!this._renderingCanvas)return!1;if(!e.prototype.setSize.call(this,t,i,r=void 0!==r&&r))return!1;if(this.scenes){for(var n=0;n<this.scenes.length;n++)for(var s=this.scenes[n],a=0;a<s.cameras.length;a++)s.cameras[a]._currentRenderId=0;this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},t.prototype._deletePipelineContext=function(t){var i=t;i&&i.program&&i.transformFeedback&&(this.deleteTransformFeedback(i.transformFeedback),i.transformFeedback=null),e.prototype._deletePipelineContext.call(this,t)},t.prototype.createShaderProgram=function(t,i,r,n,s,a){return void 0===a&&(a=null),s=s||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this),t=e.prototype.createShaderProgram.call(this,t,i,r,n,s,a),this.onAfterShaderCompilationObservable.notifyObservers(this),t},t.prototype._createShaderProgram=function(e,t,i,r,n){void 0===n&&(n=null);var s,a=r.createProgram();if(e.program=a)return r.attachShader(a,t),r.attachShader(a,i),1<this.webGLVersion&&n&&(s=this.createTransformFeedback(),this.bindTransformFeedback(s),this.setTranformFeedbackVaryings(a,n),e.transformFeedback=s),r.linkProgram(a),1<this.webGLVersion&&n&&this.bindTransformFeedback(null),e.context=r,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),a;throw new Error("Unable to create program")},t.prototype._releaseTexture=function(t){e.prototype._releaseTexture.call(this,t)},t.prototype._releaseRenderTargetWrapper=function(t){e.prototype._releaseRenderTargetWrapper.call(this,t),this.scenes.forEach((function(e){e.postProcesses.forEach((function(e){e._outputTexture===t&&(e._outputTexture=null)})),e.cameras.forEach((function(e){e._postProcesses.forEach((function(e){e&&e._outputTexture===t&&(e._outputTexture=null)}))}))}))},t.prototype.getRenderPassNames=function(){return this._renderPassNames},t.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},t.prototype.createRenderPassId=function(e){var i=++t._RenderPassIdCounter;return this._renderPassNames[i]=null!=e?e:"NONAME",i},t.prototype.releaseRenderPassId=function(e){this._renderPassNames[e]=void 0;for(var t=0;t<this.scenes.length;++t)for(var i=this.scenes[t],r=0;r<i.meshes.length;++r){var n=i.meshes[r];if(n.subMeshes)for(var s=0;s<n.subMeshes.length;++s)n.subMeshes[s]._removeDrawWrapper(e)}},t.prototype._rescaleTexture=function(e,i,r,n,s){var a=this,o=(this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this.createRenderTargetTexture({width:i.width,height:i.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1}));!this._rescalePostProcess&&t._RescalePostProcessFactory&&(this._rescalePostProcess=t._RescalePostProcessFactory(this)),this._rescalePostProcess.externalTextureSamplerBinding=!0,this._rescalePostProcess.getEffect().executeWhenCompiled((function(){a._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)},(r||a.scenes[a.scenes.length-1]).postProcessManager.directRender([a._rescalePostProcess],o,!0),a._bindTextureDirectly(a._gl.TEXTURE_2D,i,!0),a._gl.copyTexImage2D(a._gl.TEXTURE_2D,0,n,0,0,i.width,i.height,0),a.unBindFramebuffer(o),o.dispose(),s&&s()}))},t.prototype.getFps=function(){return this._fps},t.prototype.getDeltaTime=function(){return this._deltaTime},t.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},t.prototype.wrapWebGLTexture=function(e){e=new vt(e,this._gl);var t=new dt(this,ke.Unknown,!0);return t._hardwareTexture=e,t.isReady=!0,t},t.prototype._uploadImageToTexture=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=this._gl,s=this._getWebGLTextureType(e.type),a=this._getInternalFormat(e.format),o=this._getRGBABufferInternalSizedFormat(e.type,a),l=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,h=(this._bindTextureDirectly(l,e,!0),this._unpackFlipY(e.invertY),n.TEXTURE_2D);e.isCube&&(h=n.TEXTURE_CUBE_MAP_POSITIVE_X+i),n.texImage2D(h,r,o,a,s,t),this._bindTextureDirectly(l,null,!0)},t.prototype.updateTextureComparisonFunction=function(e,t){var i;1===this.webGLVersion?Me.Error("WebGL 1 does not support texture comparison."):(i=this._gl,e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,515),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.NONE)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_FUNC,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t)},t.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");return(t=new _t(t)).capacity=e,this.bindArrayBuffer(t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t.references=1,t},t.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},t.prototype._clientWaitAsync=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=10);var r=this._gl;return new Promise((function(n,s){!function a(){var o=r.clientWaitSync(e,t,0);o==r.WAIT_FAILED?s():o==r.TIMEOUT_EXPIRED?setTimeout(a,i):n()}()}))},t.prototype._readPixelsAsync=function(e,t,i,r,n,s,a){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var o=this._gl,l=o.createBuffer(),h=(o.bindBuffer(o.PIXEL_PACK_BUFFER,l),o.bufferData(o.PIXEL_PACK_BUFFER,a.byteLength,o.STREAM_READ),o.readPixels(e,t,i,r,n,s,0),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0));return h?(o.flush(),this._clientWaitAsync(h,0,10).then((function(){return o.deleteSync(h),o.bindBuffer(o.PIXEL_PACK_BUFFER,l),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,a),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),o.deleteBuffer(l),a}))):null},t.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();1===t.Instances.length&&t.audioEngine&&(t.audioEngine.dispose(),t.audioEngine=null),this.disableVR(),Se()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),Pe()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),e.prototype.dispose.call(this);var i=t.Instances.indexOf(this);0<=i&&t.Instances.splice(i,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},t.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none",this._renderingCanvas.style.webkitTapHighlightColor="transparent")},t.prototype.displayLoadingUI=function(){var e;!Se()||(e=this.loadingScreen)&&e.displayLoadingUI()},t.prototype.hideLoadingUI=function(){var e;!Se()||(e=this._loadingScreen)&&e.hideLoadingUI()},Object.defineProperty(t.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=t.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!1,configurable:!0}),t.prototype.createVideoElement=function(e){return document.createElement("video")},t._RequestPointerlock=function(e){e.requestPointerLock=e.requestPointerLock||e.msRequestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock&&(e.requestPointerLock(),e.focus())},t._ExitPointerlock=function(){var e=document;document.exitPointerLock=document.exitPointerLock||e.msExitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},t._RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},t._ExitFullscreen=function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()},t.prototype.getFontOffset=function(e){var t=document.createElement("span"),i=((e=(t.innerHTML="Hg",t.setAttribute("style","font: ".concat(e," !important")),document.createElement("div"))).style.display="inline-block",e.style.width="1px",e.style.height="0px",e.style.verticalAlign="bottom",document.createElement("div")),r=(i.style.whiteSpace="nowrap",i.appendChild(t),i.appendChild(e),document.body.appendChild(i),0),n=0;try{n=e.getBoundingClientRect().top-t.getBoundingClientRect().top,e.style.verticalAlign="baseline",r=e.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(i)}return{ascent:r,height:n,descent:n-r}},t.ALPHA_DISABLE=0,t.ALPHA_ADD=1,t.ALPHA_COMBINE=2,t.ALPHA_SUBTRACT=3,t.ALPHA_MULTIPLY=4,t.ALPHA_MAXIMIZED=5,t.ALPHA_ONEONE=6,t.ALPHA_PREMULTIPLIED=7,t.ALPHA_PREMULTIPLIED_PORTERDUFF=8,t.ALPHA_INTERPOLATE=9,t.ALPHA_SCREENMODE=10,t.DELAYLOADSTATE_NONE=0,t.DELAYLOADSTATE_LOADED=1,t.DELAYLOADSTATE_LOADING=2,t.DELAYLOADSTATE_NOTLOADED=4,t.NEVER=512,t.ALWAYS=519,t.LESS=513,t.EQUAL=514,t.LEQUAL=515,t.GREATER=516,t.GEQUAL=518,t.NOTEQUAL=517,t.KEEP=7680,t.REPLACE=7681,t.INCR=7682,t.DECR=7683,t.INVERT=5386,t.INCR_WRAP=34055,t.DECR_WRAP=34056,t.TEXTURE_CLAMP_ADDRESSMODE=0,t.TEXTURE_WRAP_ADDRESSMODE=1,t.TEXTURE_MIRROR_ADDRESSMODE=2,t.TEXTUREFORMAT_ALPHA=0,t.TEXTUREFORMAT_LUMINANCE=1,t.TEXTUREFORMAT_LUMINANCE_ALPHA=2,t.TEXTUREFORMAT_RGB=4,t.TEXTUREFORMAT_RGBA=5,t.TEXTUREFORMAT_RED=6,t.TEXTUREFORMAT_R=6,t.TEXTUREFORMAT_RG=7,t.TEXTUREFORMAT_RED_INTEGER=8,t.TEXTUREFORMAT_R_INTEGER=8,t.TEXTUREFORMAT_RG_INTEGER=9,t.TEXTUREFORMAT_RGB_INTEGER=10,t.TEXTUREFORMAT_RGBA_INTEGER=11,t.TEXTURETYPE_UNSIGNED_BYTE=0,t.TEXTURETYPE_UNSIGNED_INT=0,t.TEXTURETYPE_FLOAT=1,t.TEXTURETYPE_HALF_FLOAT=2,t.TEXTURETYPE_BYTE=3,t.TEXTURETYPE_SHORT=4,t.TEXTURETYPE_UNSIGNED_SHORT=5,t.TEXTURETYPE_INT=6,t.TEXTURETYPE_UNSIGNED_INTEGER=7,t.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,t.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,t.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,t.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,t.TEXTURETYPE_UNSIGNED_INT_24_8=12,t.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,t.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,t.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,t.TEXTURE_NEAREST_SAMPLINGMODE=1,t.TEXTURE_BILINEAR_SAMPLINGMODE=2,t.TEXTURE_TRILINEAR_SAMPLINGMODE=3,t.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,t.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,t.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,t.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,t.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,t.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,t.TEXTURE_NEAREST_LINEAR=7,t.TEXTURE_NEAREST_NEAREST=1,t.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,t.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,t.TEXTURE_LINEAR_LINEAR=2,t.TEXTURE_LINEAR_NEAREST=12,t.TEXTURE_EXPLICIT_MODE=0,t.TEXTURE_SPHERICAL_MODE=1,t.TEXTURE_PLANAR_MODE=2,t.TEXTURE_CUBIC_MODE=3,t.TEXTURE_PROJECTION_MODE=4,t.TEXTURE_SKYBOX_MODE=5,t.TEXTURE_INVCUBIC_MODE=6,t.TEXTURE_EQUIRECTANGULAR_MODE=7,t.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,t.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,t.SCALEMODE_FLOOR=1,t.SCALEMODE_NEAREST=2,t.SCALEMODE_CEILING=3,t._RescalePostProcessFactory=null,t._RenderPassIdCounter=0,t}(Ct),Tr=(Object.defineProperty(_r.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new Tr(this)),this._debugLayer},enumerable:!0,configurable:!0}),function(e){e[e.Properties=0]="Properties",e[e.Debug=1]="Debug",e[e.Statistics=2]="Statistics",e[e.Tools=3]="Tools",e[e.Settings=4]="Settings"}(vr=vr||{}),function(){function e(e){var t=this;this.BJSINSPECTOR=this._getGlobalInspector(),this._scene=e||Ne.LastCreatedScene,this._scene&&this._scene.onDisposeObservable.add((function(){t._scene._debugLayer&&t._scene._debugLayer.hide()}))}return Object.defineProperty(e.prototype,"onPropertyChangedObservable",{get:function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector?this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable:(this._onPropertyChangedObservable||(this._onPropertyChangedObservable=new we),this._onPropertyChangedObservable)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSelectionChangedObservable",{get:function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector?this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable:(this._onSelectionChangedObservable||(this._onSelectionChangedObservable=new we),this._onSelectionChangedObservable)},enumerable:!1,configurable:!0}),e.prototype._createInspector=function(e){if(!this.isVisible()){if(this._onPropertyChangedObservable){for(var t=0,i=this._onPropertyChangedObservable.observers;t<i.length;t++){var r=i[t];this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable.add(r)}this._onPropertyChangedObservable.clear(),this._onPropertyChangedObservable=void 0}if(this._onSelectionChangedObservable){for(var n=0,s=this._onSelectionChangedObservable.observers;n<s.length;n++)r=s[n],this.BJSINSPECTOR.Inspector.OnSelectionChangedObservable.add(r);this._onSelectionChangedObservable.clear(),this._onSelectionChangedObservable=void 0}e=g({overlay:!1,showExplorer:!0,showInspector:!0,embedMode:!1,handleResize:!0,enablePopup:!0},e),this.BJSINSPECTOR=this.BJSINSPECTOR||this._getGlobalInspector(),this.BJSINSPECTOR.Inspector.Show(this._scene,e)}},e.prototype.select=function(e,t){this.BJSINSPECTOR&&(t&&("[object String]"==Object.prototype.toString.call(t)?this.BJSINSPECTOR.Inspector.MarkLineContainerTitleForHighlighting(t):this.BJSINSPECTOR.Inspector.MarkMultipleLineContainerTitlesForHighlighting(t)),this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable.notifyObservers(e))},e.prototype._getGlobalInspector=function(){return"undefined"!=typeof INSPECTOR?INSPECTOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.Inspector?BABYLON:void 0},e.prototype.isVisible=function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.IsVisible},e.prototype.hide=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.Hide()},e.prototype.setAsActiveScene=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector._SetNewScene(this._scene)},e.prototype.show=function(t){var i=this;return new Promise((function(r){var n;void 0===i.BJSINSPECTOR?(n=t&&t.inspectorURL?t.inspectorURL:e.InspectorURL,Wt.LoadScript(n,(function(){i._createInspector(t),r(i)}))):(i._createInspector(t),r(i))}))},e.InspectorURL="https://unpkg.com/babylonjs-inspector@".concat(Sr.Version,"/babylon.inspector.bundle.js"),e}());function Pr(e,t,i,...r){if(t=e[Mr(t,i)])for(var n of t)if(n.call(e,...r))return}function Ar(e){return function(t,i,r){var n=Mr(i=Rr(t,i),e);!function(e,t){var i=Symbol.for("__aopinit__"+t);if(!e.hasOwnProperty(i)){e[i]=!0;let r=e[t];e[t]=function(...i){Pr(e,t,br.begin,...i);var n=r.call(e,...i);return i.push(n),Pr(e,t,br.end,...i),n}}}(t,i);let s=function(e,t){return e.hasOwnProperty(t)||(e[t]=[]),e[t]}(t,n);return s.unshift(r),s.length,function(){var e=s.indexOf(r);-1!==e&&s.splice(e,1)}}}function Rr(e,t){if(t.name)return t.name;for(var i in e)if(e[i]===t)return i}function Mr(e,t){return Symbol.for(t+e)}!function(e){e.begin="__begin__",e.end="__end__"}(br=br||{});const Or=Ar(br.begin),Ir=Ar(br.end),Dr="_isProxy",Fr=(e,t,i,r=!1)=>{Object.defineProperty(e,t,{set:function(e){if(e instanceof Array)if(this[i]){let t=this[i];t.length=0,t.push(...e)}else e[Dr]?this[i]=e:this[i]=new Proxy(e,{set:(e,t,i,n)=>(Reflect.get(e,t,n)!==i&&this.writeSnapshoot(),e=Reflect.set(e,t,i,n),r&&this.update(),e),get:(e,t,i)=>t===Dr||("splice"!==t&&"pop"!==t&&"shift"!==t||this.writeSnapshoot(),Reflect.get(e,t,i))});else this[i]!==e&&(this.writeSnapshoot(),this[i]=e,r&&this.update())},get:function(){return this[i]},enumerable:!0,configurable:!0})};function Lr(e,t,i){Fr(e,t,"__"+t,!0)}function kr(e,t,i){Fr(e,t,"__"+t,!1)}let Br=class extends fe{constructor(){super(),this.data={},this.initData(),this.entitys=this.initComponents()}getData(){return{}}get IsComponent(){return!0}get AnimationNames(){const e=super.AnimationNames;for(const t of this.entitys)e.push(...t.AnimationNames);return e}get BoundingBox(){var{min:e,max:t}=this.BoundingVectors;return new E(e,t)}startAnimates(e,t){super.startAnimates(e,t);for(const i of this.entitys)i.startAnimates(e,t)}stopAnimates(e){super.stopAnimates(e);for(const t of this.entitys)t.stopAnimates(e)}initData(e){const t=this;this.data=new Proxy(null!=e?e:this.getData(),{get:(e,t)=>e[t],set(e,i,r){var n=e.hasOwnProperty(i)&&r!==e[i];return t.writeSnapshoot(),e[i]=r,n&&(t.play(),t.update(),t.trigger({type:"change",target:this,key:i})),!0}})}initComponents(){return[]}initDrawObject(e){var t=new n.Mesh(this.UniqueName,fe.Scene);return this.updateDrawObject(e,t),this.watchLoad().then((e=>{this.play(),this.mounted()})).catch((e=>{this.componentCatch(e)})),t}updateDrawObject(e,t){for(var i of this.entitys){i.isPart=!0;let r=i.GetDrawObjectFromRenderType(e);r&&(i.updatePart(),r.parent=t)}}updateMaterial(){this.entitys.forEach((e=>e.updateMaterial()))}play(){}mounted(){}componentCatch(e){}destory(){super.destory();for(const e of this.entitys)e.destory()}writeFile(e){super.writeFile(e),e.write(1),e.write(JSON.stringify(Object.assign({},this.data))),e.write(this.entitys.length);for(const t of this.entitys)e.writeObject(t)}readFile(e){super.readFile(e),e.read();var t=e.read(),i=(this.initData(JSON.parse(t)),e.read());for(const e of this.entitys)e.destory();for(let t=this.entitys.length=0;t<i;t++){var r=e.readObject();this.entitys.push(r)}this.update(),this.watchLoad().then((e=>{this.play()}))}watchLoad(){const e=[];for(const t of this.entitys)t.isAsync&&e.push(new Promise((e=>{t.on("load",(()=>e(!0)))})));return Promise.all(e)}};Br.type="Component",Br.component=!0,Br=y([S],Br);class Nr{constructor(){this.IsContainer=!1,this.startTime=0}get Type(){return this.constructor.type}do(){return null}destory(){}fromJSON(e){}readFile(e){}writeFile(e){}}Nr.schema={};class zr extends L{constructor(){super(...arguments),this._name=""}get Name(){return this._name}set Name(e){this._name=e}}class Ur extends zr{constructor(){super(),this._isLoading=!1,this.wrapU=n.Texture.WRAP_ADDRESSMODE,this.wrapV=n.Texture.WRAP_ADDRESSMODE,this.scale=[1,1],this.rotation=[0,0,0],this.offset=[0,0]}get Texture(){return this.texture}getTexture(){return v(this,void 0,void 0,(function*(){return this.texture}))}get Scale(){return this.scale}set Scale(e){e[0]===this.scale[0]&&e[1]===this.scale[1]||(this.writeSnapshoot(),this.scale=e,this.update())}get Offset(){return this.scale}set Offset(e){e[0]===this.offset[0]&&e[1]===this.offset[1]||(this.writeSnapshoot(),this.offset=e,this.update())}get Rotation(){return this.rotation}set Rotation(e){e[0]===this.rotation[0]&&e[1]===this.rotation[1]&&e[2]===this.rotation[2]||(this.writeSnapshoot(),this.rotation=e,this.update())}update(){this.texture&&(this.texture.name=this._name,this.texture.wrapU=this.wrapU,this.texture.wrapV=this.wrapV)}writeFile(e){super.writeFile(e),e.write(1),e.write(this.wrapU),e.write(this.wrapV),e.write(this.scale[0]),e.write(this.scale[1]),e.write(this.rotation[0]),e.write(this.rotation[1]),e.write(this.rotation[2]),e.write(this.offset[0]),e.write(this.offset[1])}readFile(e){super.readFile(e),e.read(),this.wrapU=e.read(),this.wrapV=e.read(),this.scale[0]=e.read(),this.scale[1]=e.read(),this.rotation[0]=e.read(),this.rotation[1]=e.read(),this.rotation[2]=e.read(),this.offset[0]=e.read(),this.offset[1]=e.read()}}(Er=Er||{}).SelectMarquee="32";class Gr{constructor(e){this.start=new n.Vector2,this.end=new n.Vector2,this.selectType=K.None,this.rightColor="rgba(225, 240, 255, 0.5)",this.leftColor="rgba(225, 240, 255, 0.4)",this.rightBorder="1px dashed rgb(179, 179, 245)",this.leftBorder="1px solid rgb(179, 179, 245)",this.dom=document.createElement("div"),e.appendChild(this.dom);let t=this.dom.style;t.position="absolute",t.zIndex=Er.SelectMarquee,t.background="rgba(0, 63, 255, 0.2)",t.margin="0",t.pointerEvents="none",t.top="460px",t.left="100px",t.width="100px",t.height="200px",t.display="none",t.border=this.leftBorder}show(){this.dom.style.display="block"}hide(){this.dom.style.display="none"}update(){this.dom.style.top=Math.min(this.start.y,this.end.y)+"px",this.dom.style.left=Math.min(this.start.x,this.end.x)+"px",this.width=Math.abs(this.start.x-this.end.x),this.height=Math.abs(this.start.y-this.end.y),this.dom.style.width=this.width+"px",this.dom.style.height=this.height+"px";let e=this.selectType;(e=this.selectType===K.None?this.start.x>this.end.x?K.C:K.W:e)===K.C?(this.dom.style.background=this.leftColor,this.dom.style.border=this.leftBorder):(this.dom.style.background=this.rightColor,this.dom.style.border=this.rightBorder)}setStart(e,t){this.start.set(e,t)}setEnd(e,t){this.end.set(e,t),this.update()}}class jr extends class{constructor(e){this._viewer=e,this.selectList=new Set}get Plane(){if(this._tempPlane)return this._tempPlane;const e=n.MeshBuilder.CreatePlane("get-point",{size:1e3});return e.setEnabled(!1),this._tempPlane=e}select(e){}destoryTempPlane(){this._tempPlane&&(this._tempPlane.dispose(),this._tempPlane=null)}world2screen(e){return n.Vector3.Project(e,n.Matrix.IdentityReadOnly,this._viewer.Scene.getTransformMatrix(),this._viewer.Camera.viewport.toGlobal(this._viewer.Scene.getEngine().getRenderWidth(),this._viewer.Scene.getEngine().getRenderHeight()))}screen2World(e,t=!0){const i=this._viewer.Scene.createPickingRay(e.x,e.y,this._viewer.Scene.getViewMatrix(),this._viewer.cameraManager.Camera,!0);return this._viewer.ground&&(this._viewer.ground.isPickable=!0),e=i.intersectsMesh(this._viewer.ground||this.Plane),this._viewer.ground&&(this._viewer.ground.isPickable=!1),t&&this.destoryTempPlane(),e.hit?e.pickedPoint:null}get SelectEntitys(){const e=[];for(const t of this.selectList)e.push(t.metadata.Entity);return e}get SelectMeshs(){return[...this.selectList]}}{constructor(e,t,i){super(e),this._Viewer=e,this.start=t,this.end=i}select(e){for(const t of e=null!=e?e:this._Viewer.Scene.rootNodes)this.targetIsSelect(t)&&this.selectList.add(t)}targetIsSelect(e){if(null==(t=null==(t=e.metadata)?void 0:t.Entity)||!t.Visiable)return!1;if(null==(t=null==(t=e.metadata)?void 0:t.Entity)||!t.IsPickable)return!1;if("WORLD_GROUND"===e.name)return!1;if(this._SelectType===K.None)return!1;var t=this.start,i=this.end,r=Math.min(t.x,i.x),s=Math.min(t.y,i.y),a=Math.max(t.x,i.x),o=Math.max(t.y,i.y);for(const t of e.getChildMeshes())if(t.geometry){var l=t.geometry._vertexBuffers.position.getData();for(let e=0;e<l.length;e+=3){var h=new n.Vector3(l[e],l[e+1],l[e+2]);if((h=(n.Vector3.TransformCoordinatesToRef(h,t.getWorldMatrix(),h),this.world2screen(h))).x>=r&&h.x<=a&&h.y>=s&&h.y<=o)return!0}}return!1}}class Vr{constructor(){this._selectSetList=new Set}get SelectMeshs(){return[...this._selectSetList]}get SelectEntitys(){return this.SelectMeshs.map((e=>e.metadata.Entity))}add(e){e.forEach((e=>this._selectSetList.add(e)))}addEns(e){e.forEach((e=>this._selectSetList.add(e.DrawObject)))}remove(){}clear(){this._selectSetList.forEach((e=>{var t;null!=(t=e.metadata)&&t.Entity&&(e.metadata.Entity.IsSelect=!1)})),this._selectSetList.clear()}}class Zr{constructor(e){this._viewer=e,this.selectSet=new Vr,this.doing=!1,this.selectObserable=new n.Observable,this._SelectType=K.None,this.selectMarquee=new Gr(e.canvas.parentElement),this._registerEvent()}set SelectType(e){this._SelectType=e,this.selectMarquee.selectType=e}set SelectEntitys(e){this.clearSelect();const t=new Vr;t.addEns(e),this.selectSet=t,this.update()}get SelectMeshs(){return this._selectGui||this._selectDOM?[]:this.selectSet.SelectMeshs}get SelectObjects(){return this._selectGui?[this._selectGui]:this._selectDOM?[this._selectDOM]:this._selectParticle?[this._selectParticle]:this.selectSet.SelectEntitys}onPointerDown(e){var t;if(0===e.event.button){if(this.clearSelect(),e.pickInfo.pickedMesh&&null!=(t=(e=N(e.pickInfo.pickedMesh)).metadata)&&t.Entity)return this.selectSet.add([e]),void this.update();this.doing=!0,this.selectMarquee.show(),this.selectMarquee.setStart(this._viewer.Scene.pointerX,this._viewer.Scene.pointerY),this.selectMarquee.setEnd(this._viewer.Scene.pointerX,this._viewer.Scene.pointerY),this.selectMarquee.update()}}onPointerMove(e){var t;!this.doing||null!=(t=this.SelectGui)&&t.Draging||(this.selectMarquee.setEnd(this._viewer.Scene.pointerX,this._viewer.Scene.pointerY),this._SelectType=this.selectMarquee.end.x>this.selectMarquee.start.x?K.W:K.C)}onPointerUp(e){0===e.event.button&&this.doing&&(this.doing=!1,this.selectMarquee.hide(),this.selectByMarquee())}clearSelect(e=!1){this._selectGui&&(this._selectGui.IsSelect=!1,this._selectGui=null),this._selectParticle&&(this._selectParticle.IsSelect=!1,this._selectParticle=null),this._selectDOM&&(this._selectDOM.IsSelect=!1,this._selectDOM=null),this._viewer.highlightManager.clear(),this.selectSet.clear(),e&&this.update()}on(e){const t=this.selectObserable.add(e);return()=>{this.selectObserable.remove(t)}}update(){this.selectSet.SelectEntitys.forEach((e=>e.IsSelect=!0)),this._viewer.highlightManager.addMeshs(this.selectSet.SelectMeshs),this.selectObserable.notifyObservers({type:"select",meshs:this.SelectMeshs,entitys:this.SelectObjects})}get SelectParticle(){return this._selectParticle}set SelectParticle(e){this.clearSelect(),(this._selectParticle=e).IsSelect=!0,this.update()}get SelectGui(){return this._selectGui}set SelectGui(e){this.clearSelect(),(this._selectGui=e).IsSelect=!0,this.update()}get SelectDOM(){return this._selectDOM}set SelectDOM(e){this.clearSelect(),(this._selectDOM=e).IsSelect=!0,this.update()}selectByMarquee(){const e=new jr(this._viewer,this.selectMarquee.start,this.selectMarquee.end);e._SelectType=this._SelectType,e.select(),this.selectSet.add(e.SelectMeshs),this.update()}_registerEvent(){this._viewer.Scene.onPointerObservable.add((e=>{var t;switch(e.type){case n.PointerEventTypes.POINTERDOWN:this.onPointerDown(e);break;case n.PointerEventTypes.POINTERUP:this.onPointerUp(e);break;case n.PointerEventTypes.POINTERMOVE:null!=(t=this.SelectGui)&&t.Draging?this.SelectGui.drag({x:e.event.offsetX,y:e.event.offsetY}):this.onPointerMove(e)}})),this._viewer.canvas.parentElement.addEventListener("mousemove",(e=>{var t;null!=(t=this.SelectDOM)&&t.Draging&&this.SelectDOM.move(e.clientX,e.clientY)})),le.on("pointerDownGui",(e=>{this.SelectGui=e.target})),document.addEventListener("mouseup",(()=>{var e;null!=(e=this.SelectDOM)&&e.Draging&&this.SelectDOM.end()}))}}class Wr extends n.Gizmo{constructor(){super(...arguments),this._attachedNodes=null,this._tempVector_=new n.Vector3,this.gizmoPosition=null}_attachedNodesChanged(e){}get attachedNode(){return super.attachedNode}set attachedNode(e){this._attachedNodes=null,super.attachedNode=e}get attachedMesh(){return super.attachedMesh}set attachedMesh(e){this._attachedNodes=null,super.attachedMesh=e}get AttachedNodes(){let e;return this.attachedNode?e=[this.attachedNode]:this.attachedNodes&&(e=this.attachedNodes),e}get attachedNodes(){return this._attachedNodes}set attachedNodes(e){this._attachedNode=null,this._attachedMesh=null,this._attachedNodes=e,this._rootMesh.setEnabled(!!e),this._attachedNodesChanged(e),this.setGizmosPosition(),this.gizmoPosition&&this._rootMesh.position.copyFrom(this.gizmoPosition)}setGizmosPosition(){if(this.attachedNodes){const t=this.attachedNodes.map((e=>e.getWorldMatrix().getRow(3)));var e=t.map((e=>e?e.toVector3():new n.Vector3(0,0,0)));1===e.length?this.gizmoPosition=null:this.gizmoPosition=E.GetCenterFromPoints(e)}else this.gizmoPosition=null}_nodeMatrixChanged(e){var t=this._attachedNode;this._attachedNode=e,this._matrixChanged(),this._attachedNode=t}_handlePivots(){for(const e of this._attachedNodes)e.isUsingPivotMatrix&&e.isUsingPivotMatrix()&&e.getWorldMatrix().setTranslation(e.position)}_update(){if(super._update(),this.attachedNodes){let t=this.attachedNodes;if(this.updateGizmoPositionToMatchAttachedMesh&&(this.setGizmosPosition(),this.gizmoPosition&&this._rootMesh.position.copyFrom(this.gizmoPosition)),this.updateGizmoRotationToMatchAttachedMesh&&this._rootMesh.rotationQuaternion.set(0,0,0,1),this.updateScale){let i=(e=this.gizmoLayer.utilityLayerScene.activeCamera).globalPosition;e.devicePosition&&(i=e.devicePosition),this._rootMesh.position.subtractToRef(i,this._tempVector_);var e=this._tempVector_.length()*this.scaleRatio;this._rootMesh.scaling.set(e,e,e),t.some((e=>e._getWorldMatrixDeterminant()<0))&&!n.Gizmo.PreserveScaling&&(this._rootMesh.scaling.y*=-1)}else this._rootMesh.scaling.setAll(this.scaleRatio)}else this.gizmoPosition=null;this.updateScale&&(e=this.gizmoLayer.utilityLayerScene.activeCamera).mode===n.Camera.ORTHOGRAPHIC_CAMERA&&(e=null==(e=e.metadata)?void 0:e.size)&&this._rootMesh.scaling.set(2*e,2*e,2*e)}}class Hr extends Wr{constructor(e,t=n.Color3.Gray(),i=n.UtilityLayerRenderer.DefaultUtilityLayer,r=null,s=1){super(i),this._pointerObserver=null,this.snapDistance=0,this.onSnapObservable=new n.Observable,this._isEnabled=!0,this._parent=null,this._dragging=!1,this._parent=r,this._coloredMaterial=new n.StandardMaterial("",i.utilityLayerScene),this._coloredMaterial.diffuseColor=t,this._coloredMaterial.specularColor=t.subtract(new n.Color3(.1,.1,.1)),this._hoverMaterial=new n.StandardMaterial("",i.utilityLayerScene),this._hoverMaterial.diffuseColor=n.Color3.Yellow(),this._disableMaterial=new n.StandardMaterial("",i.utilityLayerScene),this._disableMaterial.diffuseColor=n.Color3.Gray(),this._disableMaterial.alpha=.4;const a=Hr._CreateArrow(i.utilityLayerScene,this._coloredMaterial,s),o=Hr._CreateArrow(i.utilityLayerScene,this._coloredMaterial,s+4,!0);this._gizmoMesh=new n.Mesh("",i.utilityLayerScene),this._gizmoMesh.addChild(a),this._gizmoMesh.addChild(o),this._gizmoMesh.lookAt(this._rootMesh.position.add(e)),this._gizmoMesh.scaling.scaleInPlace(1/3),this._gizmoMesh.parent=this._rootMesh;let l=0;const h=new n.Vector3,c=new n.Vector3,u={snapDistance:0},d=(this.dragBehavior=new n.PointerDragBehavior({dragAxis:e}),this.dragBehavior.moveAttached=!1,this.dragBehavior.updateDragPlane=!1,this._rootMesh.addBehavior(this.dragBehavior),this.dragBehavior.onDragObservable.add((e=>{let t;if(this.attachedNode?(this._handlePivot(),t=[this.attachedNode]):this.attachedNodes&&(this._handlePivots(),t=this.attachedNodes),t){for(const r of t){let t=!1;var i;0===this.snapDistance?(r.getWorldMatrix().getTranslationToRef(c),c.addInPlace(e.delta),this.dragBehavior.validateDrag(c)&&(r.position&&r.position.addInPlaceFromFloats(e.delta.x,e.delta.y,e.delta.z),r.getWorldMatrix().addTranslationFromFloats(e.delta.x,e.delta.y,e.delta.z),r.updateCache(),t=!0)):(l+=e.dragDistance,Math.abs(l)>this.snapDistance&&(i=Math.floor(Math.abs(l)/this.snapDistance),l%=this.snapDistance,e.delta.normalizeToRef(h),h.scaleInPlace(this.snapDistance*i),r.getWorldMatrix().getTranslationToRef(c),c.addInPlace(h),this.dragBehavior.validateDrag(c)&&(r.getWorldMatrix().addTranslationFromFloats(h.x,h.y,h.z),r.updateCache(),u.snapDistance=this.snapDistance*i,this.onSnapObservable.notifyObservers(u),t=!0))),t&&(this._attachedNode=r,this._matrixChanged())}this.attachedNodes&&(this._attachedNode=null)}})),this.dragBehavior.onDragStartObservable.add((()=>{this._dragging=!0})),this.dragBehavior.onDragEndObservable.add((()=>{this._dragging=!1})),i._getSharedGizmoLight()),p=(d.includedOnlyMeshes=d.includedOnlyMeshes.concat(this._rootMesh.getChildMeshes(!1)),{gizmoMeshes:a.getChildMeshes(),colliderMeshes:o.getChildMeshes(),material:this._coloredMaterial,hoverMaterial:this._hoverMaterial,disableMaterial:this._disableMaterial,active:!1,dragBehavior:this.dragBehavior});null!=(r=this._parent)&&r.addToAxisCache(o,p),this._pointerObserver=i.utilityLayerScene.onPointerObservable.add((e=>{this._customMeshSet||(this._isHovered=!(-1===p.colliderMeshes.indexOf(null==(e=null==e?void 0:e.pickInfo)?void 0:e.pickedMesh)),this._parent||(e=this.dragBehavior.enabled?this._isHovered||this._dragging?this._hoverMaterial:this._coloredMaterial:this._disableMaterial,this._setGizmoMeshMaterial(p.gizmoMeshes,e)))})),this.dragBehavior.onEnabledObservable.add((e=>{this._setGizmoMeshMaterial(p.gizmoMeshes,e?p.material:p.disableMaterial)}))}static _CreateArrow(e,t,i=1,r=!1){var s=new n.TransformNode("arrow",e);const a=(0,n.CreateCylinder)("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375*(1+(i-1)/4),tessellation:96},e),o=(0,n.CreateCylinder)("cylinder",{diameterTop:.005*i,height:.275,diameterBottom:.005*i,tessellation:96},e);return a.parent=s,a.material=t,a.rotation.x=Math.PI/2,a.position.z+=.3,o.parent=s,o.material=t,o.position.z+=.1375,o.rotation.x=Math.PI/2,r&&(o.visibility=0,a.visibility=0),s}static _CreateArrowInstance(e,t){var i=new n.TransformNode("arrow",e);for(const e of t.getChildMeshes()){e.createInstance(e.name).parent=i}return i}_attachedNodeChanged(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)}_attachedNodesChanged(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)}set isEnabled(e){(this._isEnabled=e)?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):(this.attachedMesh=null,this.attachedNode=null)}get isEnabled(){return this._isEnabled}dispose(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach((e=>{e&&e.dispose()})),super.dispose()}}class Kr extends Wr{constructor(e,t=n.Color3.Gray(),i=n.UtilityLayerRenderer.DefaultUtilityLayer,r=null){super(i),this._pointerObserver=null,this.snapDistance=0,this.onSnapObservable=new n.Observable,this._isEnabled=!1,this._parent=null,this._dragging=!1,this._parent=r,this._coloredMaterial=new n.StandardMaterial("",i.utilityLayerScene),this._coloredMaterial.diffuseColor=t,this._coloredMaterial.specularColor=t.subtract(new n.Color3(.1,.1,.1)),this._hoverMaterial=new n.StandardMaterial("",i.utilityLayerScene),this._hoverMaterial.diffuseColor=n.Color3.Yellow(),this._disableMaterial=new n.StandardMaterial("",i.utilityLayerScene),this._disableMaterial.diffuseColor=n.Color3.Gray(),this._disableMaterial.alpha=.4,this._gizmoMesh=Kr._CreatePlane(i.utilityLayerScene,this._coloredMaterial),this._gizmoMesh.lookAt(this._rootMesh.position.add(e)),this._gizmoMesh.scaling.scaleInPlace(1/3),this._gizmoMesh.parent=this._rootMesh;let s=0;const a=new n.Vector3,o={snapDistance:0},l=(this.dragBehavior=new n.PointerDragBehavior({dragPlaneNormal:e}),this.dragBehavior.moveAttached=!1,this._rootMesh.addBehavior(this.dragBehavior),this.dragBehavior.onDragObservable.add((e=>{let t;if(this.attachedNode?(this._handlePivot(),t=[this.attachedNode]):this.attachedNodes&&(t=this.attachedNodes),t){for(const r of t){var i;0===this.snapDistance?r.getWorldMatrix().addTranslationFromFloats(e.delta.x,e.delta.y,e.delta.z):(s+=e.dragDistance,Math.abs(s)>this.snapDistance&&(i=Math.floor(Math.abs(s)/this.snapDistance),s%=this.snapDistance,e.delta.normalizeToRef(a),a.scaleInPlace(this.snapDistance*i),r.getWorldMatrix().addTranslationFromFloats(a.x,a.y,a.z),o.snapDistance=this.snapDistance*i,this.onSnapObservable.notifyObservers(o))),this._attachedNode=r,this._matrixChanged()}this.attachedNodes&&(this._attachedNode=null)}})),this.dragBehavior.onDragStartObservable.add((()=>{this._dragging=!0})),this.dragBehavior.onDragEndObservable.add((()=>{this._dragging=!1})),i._getSharedGizmoLight()),h=(l.includedOnlyMeshes=l.includedOnlyMeshes.concat(this._rootMesh.getChildMeshes(!1)),{gizmoMeshes:this._gizmoMesh.getChildMeshes(),colliderMeshes:this._gizmoMesh.getChildMeshes(),material:this._coloredMaterial,hoverMaterial:this._hoverMaterial,disableMaterial:this._disableMaterial,active:!1,dragBehavior:this.dragBehavior});null!=(r=this._parent)&&r.addToAxisCache(this._gizmoMesh,h),this._pointerObserver=i.utilityLayerScene.onPointerObservable.add((e=>{this._customMeshSet||(this._isHovered=!(-1===h.colliderMeshes.indexOf(null==(e=null==e?void 0:e.pickInfo)?void 0:e.pickedMesh)),this._parent||(e=h.dragBehavior.enabled?this._isHovered||this._dragging?this._hoverMaterial:this._coloredMaterial:this._disableMaterial,this._setGizmoMeshMaterial(h.gizmoMeshes,e)))})),this.dragBehavior.onEnabledObservable.add((e=>{this._setGizmoMeshMaterial(h.gizmoMeshes,e?this._coloredMaterial:this._disableMaterial)}))}static _CreatePlane(e,t){var i=new n.TransformNode("plane",e);const r=(0,n.CreatePlane)("dragPlane",{width:.1375,height:.1375,sideOrientation:2},e);return r.material=t,r.parent=i,r.visibility=.3,i}_attachedNodeChanged(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)}_attachedNodesChanged(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)}set isEnabled(e){(this._isEnabled=e)?this._parent&&(this.attachedNode=this._parent.attachedNode):this.attachedNode=null}get isEnabled(){return this._isEnabled}dispose(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),super.dispose(),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach((e=>{e&&e.dispose()}))}}class qr extends n.Gizmo{constructor(e=n.UtilityLayerRenderer.DefaultUtilityLayer,t=1,i){super(e),this._meshAttached=null,this._nodeAttached=null,this._nodeAttacheds=null,this._observables=[],this._gizmoAxisCache=new Map,this.onDragStartObservable=new n.Observable,this.onDragEndObservable=new n.Observable,this._planarGizmoEnabled=!1,this.xGizmo=new Hr(new n.Vector3(1,0,0),n.Color3.Red().scale(.5),e,this,t),this.yGizmo=new Hr(new n.Vector3(0,1,0),n.Color3.Green().scale(.5),e,this,t),this.zGizmo=new Hr(new n.Vector3(0,0,1),n.Color3.Blue().scale(.5),e,this,t),this.xPlaneGizmo=new Kr(new n.Vector3(1,0,0),n.Color3.Red().scale(.5),this.gizmoLayer,this),this.yPlaneGizmo=new Kr(new n.Vector3(0,1,0),n.Color3.Green().scale(.5),this.gizmoLayer,this),this.zPlaneGizmo=new Kr(new n.Vector3(0,0,1),n.Color3.Blue().scale(.5),this.gizmoLayer,this),[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((e=>{e.dragBehavior.onDragStartObservable.add((()=>{this.onDragStartObservable.notifyObservers({})})),e.dragBehavior.onDragEndObservable.add((()=>{this.onDragEndObservable.notifyObservers({})}))})),this.attachedMesh=null,i?i.addToAxisCache(this._gizmoAxisCache):n.Gizmo.GizmoAxisPointerObserver(e,this._gizmoAxisCache)}get attachedMesh(){return this._meshAttached}set attachedMesh(e){this._nodeAttacheds=null,this._meshAttached=e,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((t=>{t.isEnabled?t.attachedMesh=e:t.attachedMesh=null}))}get attachedNode(){return this._nodeAttached}set attachedNode(e){this._meshAttached=null,this._nodeAttacheds=null,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((t=>{t.isEnabled?t.attachedNode=e:t.attachedNode=null}))}get attachedNodes(){return this._nodeAttacheds}set attachedNodes(e){this._meshAttached=null,this._nodeAttached=null,this._nodeAttacheds=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((t=>{t.isEnabled?t.attachedNodes=e:t.attachedNodes=null}))}get isHovered(){let e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((t=>{e=e||t.isHovered})),e}set planarGizmoEnabled(e){this._planarGizmoEnabled=e,[this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((t=>{t&&(t.isEnabled=e)&&(t.attachedMesh?t.attachedMesh=this.attachedMesh:t.attachedNode=this.attachedNode)}),this)}get planarGizmoEnabled(){return this._planarGizmoEnabled}set updateGizmoRotationToMatchAttachedMesh(e){this._updateGizmoRotationToMatchAttachedMesh=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((t=>{t&&(t.updateGizmoRotationToMatchAttachedMesh=e)}))}get updateGizmoRotationToMatchAttachedMesh(){return this._updateGizmoRotationToMatchAttachedMesh}set snapDistance(e){this._snapDistance=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((t=>{t&&(t.snapDistance=e)}))}get snapDistance(){return this._snapDistance}set scaleRatio(e){this._scaleRatio=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((t=>{t&&(t.scaleRatio=e)}))}get scaleRatio(){return this._scaleRatio}addToAxisCache(e,t){this._gizmoAxisCache.set(e,t)}dispose(){[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((e=>{e&&e.dispose()})),this._observables.forEach((e=>{this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(e)})),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()}setCustomMesh(){n.Logger.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo,gizmo.xPlaneGizmo, gizmo.yPlaneGizmo, gizmo.zPlaneGizmo)")}}class Xr extends Wr{constructor(e,t=n.Color3.Gray(),i=n.UtilityLayerRenderer.DefaultUtilityLayer,r=32,s=null,a,o=1){super(i),this._pointerObserver=null,this.snapDistance=0,this.onSnapObservable=new n.Observable,this.angle=0,this._isEnabled=!0,this._parent=null,this._dragging=!1,this._angles=new n.Vector3,this._parent=s,this._coloredMaterial=new n.StandardMaterial("",i.utilityLayerScene),this._coloredMaterial.diffuseColor=t,this._coloredMaterial.specularColor=t.subtract(new n.Color3(.1,.1,.1)),this._hoverMaterial=new n.StandardMaterial("",i.utilityLayerScene),this._hoverMaterial.diffuseColor=n.Color3.Yellow(),this._disableMaterial=new n.StandardMaterial("",i.utilityLayerScene),this._disableMaterial.diffuseColor=n.Color3.Gray(),this._disableMaterial.alpha=.4,this._gizmoMesh=new n.Mesh("",i.utilityLayerScene);var{rotationMesh:s,collider:t}=this._createGizmoMesh(this._gizmoMesh,o,r);this._rotationDisplayPlane=(0,n.CreatePlane)("rotationDisplay",{size:.6,updatable:!1},this.gizmoLayer.utilityLayerScene),this._rotationDisplayPlane.rotation.z=.5*Math.PI,this._rotationDisplayPlane.parent=this._gizmoMesh,this._rotationDisplayPlane.setEnabled(!1),n.Effect.ShadersStore.rotationGizmoVertexShader=Xr._RotationGizmoVertexShader,n.Effect.ShadersStore.rotationGizmoFragmentShader=Xr._RotationGizmoFragmentShader,this._rotationShaderMaterial=new n.ShaderMaterial("shader",this.gizmoLayer.utilityLayerScene,{vertex:"rotationGizmo",fragment:"rotationGizmo"},{attributes:["position","uv"],uniforms:["worldViewProjection","angles"]}),this._rotationShaderMaterial.backFaceCulling=!1,this._rotationDisplayPlane.material=this._rotationShaderMaterial,this._rotationDisplayPlane.visibility=.999,this._gizmoMesh.lookAt(this._rootMesh.position.add(e)),this._rootMesh.addChild(this._gizmoMesh,n.Gizmo.PreserveScaling),this._gizmoMesh.scaling.scaleInPlace(1/3),this.dragBehavior=new n.PointerDragBehavior({dragPlaneNormal:e}),this.dragBehavior.moveAttached=!1,this.dragBehavior.maxDragAngle=Xr.MaxDragAngle,this.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,this._rootMesh.addBehavior(this.dragBehavior);const l=new n.Vector3,h=new n.Matrix,c=new n.Vector3;let u=new n.Vector3;this.dragBehavior.onDragStartObservable.add((e=>{this.AttachedNodes&&(l.copyFrom(e.dragPlanePoint),this._rotationDisplayPlane.setEnabled(!0),this._rotationDisplayPlane.getWorldMatrix().invertToRef(h),n.Vector3.TransformCoordinatesToRef(e.dragPlanePoint,h,l),this._angles.x=Math.atan2(l.y,l.x)+Math.PI,this._angles.y=0,this._angles.z=this.updateGizmoRotationToMatchAttachedMesh?1:0,this._dragging=!0,l.copyFrom(e.dragPlanePoint),this._rotationShaderMaterial.setVector3("angles",this._angles),this.angle=0)})),this.dragBehavior.onDragEndObservable.add((()=>{this._dragging=!1,this._rotationDisplayPlane.setEnabled(!1)}));const d={snapDistance:0};let p=0;const f=new n.Matrix,m=new n.Quaternion,_=(this.dragBehavior.onDragObservable.add((t=>{let r=this.AttachedNodes;if(this.attachedNode?this._handlePivot():this._handlePivots(),r){var s=new n.Vector3(1,1,1);const _=new n.Quaternion(0,0,0,1),g=new n.Vector3(0,0,0);1<r.length?this.gizmoPosition&&g.copyFrom(this.gizmoPosition):r[0].getWorldMatrix().decompose(s,_,g);var a=t.dragPlanePoint.subtract(g).normalize(),o=l.subtract(g).normalize();const y=n.Vector3.Cross(a,o);a=n.Vector3.Dot(a,o);let v=Math.atan2(y.length(),a),b=(c.copyFrom(e),u.copyFrom(e),!1);if(this.updateGizmoRotationToMatchAttachedMesh&&(_.toRotationMatrix(h),u=n.Vector3.TransformCoordinates(c,h)),i.utilityLayerScene.activeCamera&&(o=i.utilityLayerScene.activeCamera.position.subtract(g).normalize(),0<n.Vector3.Dot(o,u)&&(c.scaleInPlace(-1),u.scaleInPlace(-1))),0!==this.snapDistance)if(p+=v,Math.abs(p)>this.snapDistance){let e=Math.floor(Math.abs(p)/this.snapDistance);p<0&&(e*=-1),p%=this.snapDistance,v=this.snapDistance*e,b=!0}else v=0;0<n.Vector3.Dot(u,y)&&(v=-v),a=Math.sin(v/2),m.set(c.x*a,c.y*a,c.z*a,Math.cos(v/2)),0<f.determinant()&&(o=new n.Vector3,m.toEulerAnglesToRef(o),n.Quaternion.RotationYawPitchRollToRef(o.y,-o.x,-o.z,m)),this._angles.y+=v,this._rotationShaderMaterial.setVector3("angles",this._angles);for(const e of r){let t=new n.Vector3;1===r.length?t=g:e.getWorldMatrix().decompose(s,_,t),this.updateGizmoRotationToMatchAttachedMesh?_.multiplyToRef(m,_):m.multiplyToRef(_,_),e.getWorldMatrix().copyFrom(n.Matrix.Compose(s,_,t)),this._nodeMatrixChanged(e)}b&&(d.snapDistance=v,this.onSnapObservable.notifyObservers(d)),l.copyFrom(t.dragPlanePoint)}})),i._getSharedGizmoLight()),g=(_.includedOnlyMeshes=_.includedOnlyMeshes.concat(this._rootMesh.getChildMeshes(!1)),{colliderMeshes:[t],gizmoMeshes:[s],material:this._coloredMaterial,hoverMaterial:this._hoverMaterial,disableMaterial:this._disableMaterial,active:!1,dragBehavior:this.dragBehavior});null!=(o=this._parent)&&o.addToAxisCache(this._gizmoMesh,g),this._pointerObserver=i.utilityLayerScene.onPointerObservable.add((e=>{this._customMeshSet||(this.dragBehavior.maxDragAngle=Xr.MaxDragAngle,this._isHovered=!(-1===g.colliderMeshes.indexOf(null==(e=null==e?void 0:e.pickInfo)?void 0:e.pickedMesh)),this._parent||(e=g.dragBehavior.enabled?this._isHovered||this._dragging?this._hoverMaterial:this._coloredMaterial:this._disableMaterial,this._setGizmoMeshMaterial(g.gizmoMeshes,e)))})),this.dragBehavior.onEnabledObservable.add((e=>{this._setGizmoMeshMaterial(g.gizmoMeshes,e?this._coloredMaterial:this._disableMaterial)}))}_createGizmoMesh(e,t,i){const r=(0,n.CreateTorus)("ignore",{diameter:.6,thickness:.03*t,tessellation:i},this.gizmoLayer.utilityLayerScene),s=(r.visibility=0,(0,n.CreateTorus)("",{diameter:.6,thickness:.005*t,tessellation:i},this.gizmoLayer.utilityLayerScene));return s.material=this._coloredMaterial,s.rotation.x=Math.PI/2,r.rotation.x=Math.PI/2,e.addChild(s,n.Gizmo.PreserveScaling),e.addChild(r,n.Gizmo.PreserveScaling),{rotationMesh:s,collider:r}}_attachedNodeChanged(e){this.updateGizmoPositionToMatchAttachedMesh=!0,this.dragBehavior&&(this.dragBehavior.enabled=!!e)}_attachedNodesChanged(e){this.updateGizmoPositionToMatchAttachedMesh=!1,this.dragBehavior&&(this.dragBehavior.enabled=!!e)}set isEnabled(e){(this._isEnabled=e)?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null}get isEnabled(){return this._isEnabled}dispose(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),this._rotationDisplayPlane&&this._rotationDisplayPlane.dispose(),this._rotationShaderMaterial&&this._rotationShaderMaterial.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach((e=>{e&&e.dispose()})),super.dispose()}}Xr.MaxDragAngle=9*Math.PI/20,Xr._RotationGizmoVertexShader="\n        precision highp float;\n        attribute vec3 position;\n        attribute vec2 uv;\n        uniform mat4 worldViewProjection;\n        varying vec3 vPosition;\n        varying vec2 vUV;\n        void main(void) {\n            gl_Position = worldViewProjection * vec4(position, 1.0);\n            vUV = uv;\n        }",Xr._RotationGizmoFragmentShader="\n        precision highp float;\n        varying vec2 vUV;\n        varying vec3 vPosition;\n        uniform vec3 angles;\n        #define twopi 6.283185307\n        void main(void) {\n            vec2 uv = vUV - vec2(0.5);\n            float angle = atan(uv.y, uv.x) + 3.141592;\n            float delta = gl_FrontFacing ? angles.y : -angles.y;\n            float begin = angles.x - delta * angles.z;\n            float start = (begin < (begin + delta)) ? begin : (begin + delta);\n            float end = (begin > (begin + delta)) ? begin : (begin + delta);\n            float len = sqrt(dot(uv,uv));\n            float opacity = 1. - step(0.5, len);\n\n            float base = abs(floor(start / twopi)) * twopi;\n            start += base;\n            end += base;\n\n            float intensity = 0.;\n            for (int i = 0; i < 5; i++)\n            {\n                intensity += max(step(start, angle) - step(end, angle), 0.);\n                angle += twopi;\n            }\n            gl_FragColor = vec4(1.,1.,0., min(intensity * 0.25, 0.8)) * opacity;\n        }";class Yr extends n.Gizmo{constructor(e=n.UtilityLayerRenderer.DefaultUtilityLayer,t=32,i=!1,r=1,s,a){super(e),this.onDragStartObservable=new n.Observable,this.onDragEndObservable=new n.Observable,this._observables=[],this._gizmoAxisCache=new Map;var o=a&&a.xOptions&&a.xOptions.color?a.xOptions.color:n.Color3.Red().scale(.5),l=a&&a.yOptions&&a.yOptions.color?a.yOptions.color:n.Color3.Green().scale(.5),h=a&&a.zOptions&&a.zOptions.color?a.zOptions.color:n.Color3.Blue().scale(.5);this.xGizmo=new Xr(new n.Vector3(1,0,0),o,e,t,this,i,r),this.yGizmo=new Xr(new n.Vector3(0,1,0),l,e,t,this,i,r),this.zGizmo=new Xr(new n.Vector3(0,0,1),h,e,t,this,i,r),[this.xGizmo,this.yGizmo,this.zGizmo].forEach((e=>{a&&void 0!==a.updateScale&&(e.updateScale=a.updateScale),e.dragBehavior.onDragStartObservable.add((()=>{this.onDragStartObservable.notifyObservers({})})),e.dragBehavior.onDragEndObservable.add((()=>{this.onDragEndObservable.notifyObservers({})}))})),this.attachedMesh=null,this.attachedNode=null,s?s.addToAxisCache(this._gizmoAxisCache):n.Gizmo.GizmoAxisPointerObserver(e,this._gizmoAxisCache)}get attachedMesh(){return this._meshAttached}set attachedMesh(e){this._meshAttached=e,this._nodeAttached=e,this._checkBillboardTransform(),[this.xGizmo,this.yGizmo,this.zGizmo].forEach((t=>{t.isEnabled?t.attachedMesh=e:t.attachedMesh=null}))}get attachedNode(){return this._nodeAttached}set attachedNode(e){this._meshAttached=null,this._nodeAttached=e,this._checkBillboardTransform(),[this.xGizmo,this.yGizmo,this.zGizmo].forEach((t=>{t.isEnabled?t.attachedNode=e:t.attachedNode=null}))}get attachedNodes(){return this._nodeAttacheds}set attachedNodes(e){this._meshAttached=null,this._nodeAttached=null,this._nodeAttacheds=e,[this.xGizmo,this.yGizmo,this.zGizmo].forEach((t=>{t.isEnabled?t.attachedNodes=e:t.attachedNodes=null}))}_checkBillboardTransform(){this._nodeAttached&&this._nodeAttached.billboardMode}get isHovered(){let e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo].forEach((t=>{e=e||t.isHovered})),e}set updateGizmoRotationToMatchAttachedMesh(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)}get updateGizmoRotationToMatchAttachedMesh(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh}set snapDistance(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)}get snapDistance(){return this.xGizmo.snapDistance}set scaleRatio(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)}get scaleRatio(){return this.xGizmo.scaleRatio}addToAxisCache(e,t){this._gizmoAxisCache.set(e,t)}dispose(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear(),this._observables.forEach((e=>{this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(e)}))}setCustomMesh(){n.Logger.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")}}class Qr{constructor(e,t=1,i=n.UtilityLayerRenderer.DefaultUtilityLayer,r=n.UtilityLayerRenderer.DefaultKeepDepthUtilityLayer){this._scene=e,this.clearGizmoOnEmptyPointerEvent=!1,this.enableAutoPicking=!0,this.onAttachedToMeshObservable=new n.Observable,this.onAttachedToNodeObservable=new n.Observable,this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObservers=[],this._attachedMesh=null,this._attachedNode=null,this._attachedNodes=null,this._boundingBoxColor=n.Color3.FromHexString("#0984e3"),this._thickness=1,this._scaleRatio=1,this._gizmoAxisCache=new Map,this.boundingBoxDragBehavior=new n.SixDofDragBehavior,this.attachableMeshes=null,this.attachableNodes=null,this.usePointerToAttachGizmos=!0,this._defaultUtilityLayer=i,this._defaultKeepDepthUtilityLayer=r,this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._thickness=t,this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null},i=this._attachToMeshPointerObserver(e),r=n.Gizmo.GizmoAxisPointerObserver(this._defaultUtilityLayer,this._gizmoAxisCache),this._pointerObservers=[i,r]}get keepDepthUtilityLayer(){return this._defaultKeepDepthUtilityLayer}get utilityLayer(){return this._defaultUtilityLayer}get isHovered(){let e=!1;for(const i in this.gizmos){var t=this.gizmos[i];if(t&&t.isHovered){e=!0;break}}return e}set scaleRatio(e){this._scaleRatio=e,[this.gizmos.positionGizmo,this.gizmos.rotationGizmo,this.gizmos.scaleGizmo].forEach((t=>{t&&(t.scaleRatio=e)}))}get scaleRatio(){return this._scaleRatio}_attachToMeshPointerObserver(e){return e.onPointerObservable.add((e=>{if(this.usePointerToAttachGizmos&&e.type===n.PointerEventTypes.POINTERDOWN)if(e.pickInfo&&e.pickInfo.pickedMesh){if(this.enableAutoPicking){let t=e.pickInfo.pickedMesh;if(null===this.attachableMeshes)for(;t&&null!==t.parent;)t=t.parent;else{let e=!1;this.attachableMeshes.forEach((i=>{t&&(t===i||t.isDescendantOf(i))&&(t=i,e=!0)})),e||(t=null)}t instanceof n.AbstractMesh?this._attachedMesh!==t&&this.attachToMesh(t):this.clearGizmoOnEmptyPointerEvent&&this.attachToMesh(null)}}else this.clearGizmoOnEmptyPointerEvent&&this.attachToMesh(null)}))}attachToMesh(e){this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=e,this._attachedNode=null;for(const t in this.gizmos){const i=this.gizmos[t];i&&this._gizmosEnabled[t]&&(i.attachedMesh=e)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToMeshObservable.notifyObservers(e)}attachToNode(e){this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedNodes&&this._attachedNodes.forEach((e=>e.removeBehavior(this.boundingBoxDragBehavior))),this._attachedMesh=null,this._attachedNodes=null,this._attachedNode=e;for(const t in this.gizmos){const i=this.gizmos[t];i&&this._gizmosEnabled[t]&&(i.attachedNode=e)}this.boundingBoxGizmoEnabled&&this._attachedNode&&this._attachedNode.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToNodeObservable.notifyObservers(e)}attachToNodes(e){if(null==e||!e.length)return this._attachedNodes=null,void this.attachToNode(null);if(1===(null==e?void 0:e.length))this.attachToNode(e[0]);else{this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedNodes&&this._attachedNodes.forEach((e=>e.removeBehavior(this.boundingBoxDragBehavior))),this._attachedMesh=null,this._attachedNode=null,this._attachedNodes=e;for(const t in this.gizmos){const i=this.gizmos[t];i&&this._gizmosEnabled[t]&&("attachedNodes"in i?i.attachedNodes=e:i.attachedNode=e[0])}this.boundingBoxGizmoEnabled&&this._attachedNode&&this._attachedNode.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToNodeObservable.notifyObservers(e)}}set positionGizmoEnabled(e){e?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new qr(this._defaultUtilityLayer,this._thickness,this)),this._attachedNode?this.gizmos.positionGizmo.attachedNode=this._attachedNode:this._attachedNodes?this.gizmos.positionGizmo.attachedNodes=this._attachedNodes:this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedNode=null,this.gizmos.positionGizmo.attachedNodes=null),this._gizmosEnabled.positionGizmo=e}get positionGizmoEnabled(){return this._gizmosEnabled.positionGizmo}set rotationGizmoEnabled(e){e?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new Yr(this._defaultUtilityLayer,32,!1,this._thickness,this)),this._attachedNode?this.gizmos.rotationGizmo.attachedNode=this._attachedNode:this._attachedNodes?this.gizmos.rotationGizmo.attachedNodes=this._attachedNodes:this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedNode=null,this.gizmos.rotationGizmo.attachedNodes=null),this._gizmosEnabled.rotationGizmo=e}get rotationGizmoEnabled(){return this._gizmosEnabled.rotationGizmo}set scaleGizmoEnabled(e){e?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new n.ScaleGizmo(this._defaultUtilityLayer,this._thickness,this),this._attachedNode?this.gizmos.scaleGizmo.attachedNode=this._attachedNode:this._attachedNodes?this.gizmos.scaleGizmo.attachedNode=this._attachedNodes[0]:this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedNode=null),this._gizmosEnabled.scaleGizmo=e}get scaleGizmoEnabled(){return this._gizmosEnabled.scaleGizmo}set boundingBoxGizmoEnabled(e){e?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new n.BoundingBoxGizmo(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this._attachedMesh?this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh:this.gizmos.boundingBoxGizmo.attachedNode=this._attachedNode,this._attachedMesh?(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior)):this._attachedNode&&(this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this._attachedMesh?this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior):this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this.gizmos.boundingBoxGizmo.attachedNode=null),this._gizmosEnabled.boundingBoxGizmo=e}get boundingBoxGizmoEnabled(){return this._gizmosEnabled.boundingBoxGizmo}addToAxisCache(e){0<e.size&&e.forEach(((e,t)=>{this._gizmoAxisCache.set(t,e)}))}dispose(){var e;this._pointerObservers.forEach((e=>{this._scene.onPointerObservable.remove(e)}));for(const e in this.gizmos){const t=this.gizmos[e];t&&t.dispose()}this._defaultKeepDepthUtilityLayer!==n.UtilityLayerRenderer._DefaultKeepDepthUtilityLayer&&null!=(e=this._defaultKeepDepthUtilityLayer)&&e.dispose(),this._defaultUtilityLayer!==n.UtilityLayerRenderer._DefaultUtilityLayer&&null!=(e=this._defaultUtilityLayer)&&e.dispose(),this.boundingBoxDragBehavior.detach(),this.onAttachedToMeshObservable.clear()}}class $r{constructor(e){this._viewer=e,this._mode=Y.Translate,this.gizmoManager=new Qr(this._viewer.Scene,1,e.utilLayer),this.positionGizmo=new qr(e.utilLayer,1),this.positionGizmo.planarGizmoEnabled=!0,this.rotationGizmo=new Yr(e.utilLayer),this.scaleGizmo=new n.ScaleGizmo(e.utilLayer,1),this.gizmoManager.gizmos.positionGizmo=this.positionGizmo,this.gizmoManager.gizmos.rotationGizmo=this.rotationGizmo,this.gizmoManager.gizmos.scaleGizmo=this.scaleGizmo,this.gizmoManager.usePointerToAttachGizmos=!1,this.Mode=this._mode,this._register()}get Mode(){return this._mode}set Mode(e){this._mode=e,this.gizmoManager.positionGizmoEnabled=!!(e&Y.Translate),this.gizmoManager.rotationGizmoEnabled=!!(e&Y.Rotate),this.gizmoManager.scaleGizmoEnabled=!!(e&Y.Scale),this.gizmoManager.positionGizmoEnabled&&this.gizmoManager.scaleGizmoEnabled&&(this.gizmoManager.gizmos.positionGizmo.scaleRatio=1.5)}attachMeshs(e){this.detachMeshs(),0!==e.length&&(this.attachNodes=e,this.gizmoManager.attachToNodes([...e]))}detachMeshs(){this.attachNodes=null,this.gizmoManager.attachToNode(null)}_register(){const e=e=>{const t=B(null==e?void 0:e[0]);null!=t&&t.DB&&t.DB.HistoryManager.startCmd("\u5b9e\u4f53\u53d8\u6362");for(const t of e)if(t){B(t).Matrix=t._worldMatrix}null!=t&&t.DB&&t.DB.HistoryManager.endCmd()};this.positionGizmo.onDragEndObservable.add((t=>{e(this.attachNodes)})),this.rotationGizmo.onDragEndObservable.add((t=>{e(this.attachNodes)})),this.scaleGizmo.onDragEndObservable.add((t=>{e(this.attachNodes)}))}}class Jr{constructor(e){this._viewer=e,this.keyeunm={keydown:n.KeyboardEventTypes.KEYDOWN,keyup:n.KeyboardEventTypes.KEYUP},this.keydownEvents=new Set,this.keyupEvents=new Set,this._ctrlKey=!1,this._shiftKey=!1,this._altKey=!1,this._register()}get IsCtrl(){return this._ctrlKey}get IsShift(){return this._shiftKey}get IsAlt(){return this._altKey}on(e,t){if(this.keyeunm[e]===n.KeyboardEventTypes.KEYDOWN)this.keydownEvents.add(t);else{if(this.keyeunm[e]!==n.KeyboardEventTypes.KEYUP)throw new TypeError("\u4e8b\u4ef6\u7c7b\u578b\u9519\u8bef");this.keyupEvents.add(t)}return()=>{this.off(e,t)}}off(e,t){this.keyeunm[e]===n.KeyboardEventTypes.KEYDOWN?this.keydownEvents.delete(t):this.keyeunm[e]===n.KeyboardEventTypes.KEYUP&&this.keyupEvents.delete(t)}removeAll(){this.keydownEvents.clear(),this.keyupEvents.clear()}_register(){this._viewer.Scene.onKeyboardObservable.add((e=>{if(e.type===n.KeyboardEventTypes.KEYDOWN){this._ctrlKey=e.event.ctrlKey,this._shiftKey=e.event.shiftKey,this._altKey=e.event.altKey;for(const t of this.keydownEvents)t(e.event)}else for(const t of this.keyupEvents)this._ctrlKey=e.event.ctrlKey,this._shiftKey=e.event.shiftKey,this._altKey=e.event.altKey,t(e.event);le.trigger({type:["keydown","keyup"][e.type-1],event:e.event,target:null})}))}}class en{constructor(e){this._viewer=e,this._pointerdownEvs=new Set,this._pointermoveEvs=new Set,this._pointerupEvs=new Set,this._pointerwheelEvs=new Set,this._pointerPickEvs=new Set,this._pointerTapEvs=new Set,this._pointerDbTapEvs=new Set,this._register()}get Scene(){return this._viewer.Scene}get ScreenPoint(){return{x:this.Scene.pointerX,y:this.Scene.pointerY}}get WorldPoint(){this._viewer.ground&&(this._viewer.ground.isPickable=!0);var e=this.Scene.pick(this.Scene.pointerX,this.Scene.pointerY,(e=>"WORLD_GROUND"===e.name));return this._viewer.ground&&(this._viewer.ground.isPickable=!1),e.hit?e.pickedPoint:null}on(e,t){switch(n.PointerEventTypes[e.toUpperCase()]){case n.PointerEventTypes.POINTERDOWN:this._pointerdownEvs.add(t);break;case n.PointerEventTypes.POINTERMOVE:this._pointermoveEvs.add(t);break;case n.PointerEventTypes.POINTERUP:this._pointerupEvs.add(t);break;case n.PointerEventTypes.POINTERWHEEL:this._pointerwheelEvs.add(t);break;case n.PointerEventTypes.POINTERPICK:this._pointerPickEvs.add(t);break;case n.PointerEventTypes.POINTERTAP:this._pointerTapEvs.add(t);break;case n.PointerEventTypes.POINTERDOUBLETAP:this._pointerDbTapEvs.add(t)}return()=>{this.off(e,t)}}off(e,t){if(e)switch(n.PointerEventTypes[e.toUpperCase()]){case n.PointerEventTypes.POINTERDOWN:this._pointerdownEvs.delete(t);break;case n.PointerEventTypes.POINTERMOVE:this._pointermoveEvs.delete(t);break;case n.PointerEventTypes.POINTERUP:this._pointerupEvs.delete(t);break;case n.PointerEventTypes.POINTERWHEEL:this._pointerwheelEvs.delete(t);break;case n.PointerEventTypes.POINTERPICK:this._pointerPickEvs.delete(t);break;case n.PointerEventTypes.POINTERTAP:this._pointerTapEvs.delete(t);break;case n.PointerEventTypes.POINTERDOUBLETAP:this._pointerDbTapEvs.delete(t)}}getEvent(e){var t;let i,r;return null!=(t=e.pickInfo)&&t.hit&&null!=(t=e.pickInfo)&&t.pickedMesh&&(i=N(e.pickInfo.pickedMesh),r=B(i)),{type:de[e.type],screenX:this.Scene.pointerX,screenY:this.Scene.pointerY,worldPoint:this.WorldPoint,target:r,object:i,event:e.event}}_register(){this._viewer.Scene.onPointerObservable.add((e=>{const t=this.getEvent(e);let i;switch(t.target&&t.target.trigger(t),e.type){case n.PointerEventTypes.POINTERDOWN:i=this._pointerdownEvs;break;case n.PointerEventTypes.POINTERUP:i=this._pointerupEvs;break;case n.PointerEventTypes.POINTERMOVE:i=this._pointermoveEvs;break;case n.PointerEventTypes.POINTERWHEEL:i=this._pointerwheelEvs;break;case n.PointerEventTypes.POINTERPICK:i=this._pointerPickEvs;break;case n.PointerEventTypes.POINTERTAP:i=this._pointerTapEvs;break;case n.PointerEventTypes.POINTERDOUBLETAP:i=this._pointerDbTapEvs}i.forEach((e=>e(t))),le.trigger(t)}))}}class tn{constructor(e,t=!1){this._viewer=e,this.editorMode=t,this.keyboardCtrl=new Jr(e),this.mouseCtrl=new en(e),t&&this.initEditor()}initEditor(){this._viewer.initEditor(),this.selectControl=new Zr(this._viewer),this.transformControl=new $r(this._viewer),this._register()}_register(){this.selectControl.on((e=>{"select"===e.type&&this.transformControl.attachMeshs(e.meshs)}))}}class rn{constructor(e){this._color=n.Color3.White(),this._highlightLayer=new n.HighlightLayer("select-entity",e.Scene),this._highlightLayer.innerGlow=!1}exclude(e){this._highlightLayer.addExcludedMesh(e)}addMeshs(e,t){for(const i of e){i.getChildMeshes().forEach((e=>this._highlightLayer.addMesh(e,null!=t?t:this._color)))}}addEnitys(e,t){for(const i of e)this.addMeshs([i.DrawObject],t)}clear(){this._highlightLayer.removeAllMeshes()}}const nn=1e5,sn=1e3;class an{constructor(e){this._attachedCamera=e,this._radiusScale=1,this._positionScale=.5}zoomOnBoundingInfo(e,t,i=0,r){let s;var a,o;this._attachedCamera&&(o=(o=e.y)+(t.y-o)*this._positionScale,a=t.subtract(e).scale(.5),a=e.add(a),s=new n.Vector3(a.x,o,a.z),this._attachedCamera.target=s,o=this._calculateLowerRadiusFromModelBoundingSphere(e,t),this._attachedCamera.position=s.add(new n.Vector3(0,0,o)))}_calculateLowerRadiusFromModelBoundingSphere(e,t){t=t.subtract(e).length(),e=this._getFrustumSlope();var i=(t=.5*t*this._radiusScale)*Math.sqrt(1+1/(e.x*e.x));t*=Math.sqrt(1+1/(e.y*e.y)),e=Math.max(i,t);return this._attachedCamera?e:0}_getFrustumSlope(){const e=this._attachedCamera;if(!e)return n.Vector2.Zero();var t=e.getScene().getEngine().getAspectRatio(e),i=Math.tan(e.fov/2);return new n.Vector2(i*t,i)}}class on{constructor(e,t){this._scene=e,this._canvas=t,this._enable=q.All,this._position=new n.Vector3(0,0,10),this._target=n.Vector3.Zero(),this._mode=n.Camera.PERSPECTIVE_CAMERA,this.wheelSpeed=20,this.wheelDeltaPercentage=.05,this._flying=!1,this.size=sn,this.onRadiusChangeObserver=new n.Observable,this.onZommScaleChangeObserver=new n.Observable,this.zoomScale=1}get CurrentCamera(){return this._camera}get Position(){return{x:this._position.x,y:this._position.y,z:this._position.z}}set Position(e){se(this._position,e)}get Target(){return this._target}set Target(e){se(this._target,e)}get Alpha(){return 0}set Alpha(e){}get Beta(){return 0}set Beta(e){}get Radius(){return n.Vector3.Distance(this._target,this._position)}set Radius(e){e=this._position.subtract(this._target).normalize().scale(e),this._position=this._position.add(e),this._camera.position.copyFrom(this._position)}get Aspect(){return this._canvas.width/this._canvas.height}get Enable(){return this._enable!==q.None}set Enable(e){this._enable=e?q.All:q.None}get EnableZoom(){return!!(this._enable&q.Zoom)}set EnableZoom(e){e!==this.EnableZoom&&(e?this._enable|=q.Zoom:this._enable&=~q.Zoom,this._mode===n.Camera.PERSPECTIVE_CAMERA&&(e?this._camera.inputs.attached.mousewheel.attachControl():this._camera.inputs.attached.mousewheel.detachControl()))}get Mode(){return this._mode}set Mode(e){this._mode=e}set Size(e){e&&(this.size=e,this._camera.orthoTop=this.size*this.zoomScale,this._camera.orthoBottom=-this.size*this.zoomScale,this._camera.orthoLeft=-this.size*this.zoomScale*this.Aspect,this._camera.orthoRight=this.size*this.zoomScale*this.Aspect)}active(){this._scene.activeCamera=this._camera,this.attachControl()}attachControl(){}detachControl(){this._camera.detachControl()}zoomByBoundBox(e,t){const i=this._camera.getBehaviorByName("Framing");i?(i.framingTime=0,i.elevationReturnTime=-1,i.autoCorrectCameraLimitsAndSensibility=!1,i.zoomOnBoundingInfo(e,t)):(this.customFramingBehavior||(this.customFramingBehavior=new an(this._camera)),this.customFramingBehavior.zoomOnBoundingInfo(e,t))}zoomAll(){var e=e=>e.isVisible&&e.isEnabled()&&"WORLD_GROUND"!==e.name&&!e.getBoundingInfo().boundingBox.extendSize.equalsWithEpsilon(n.Vector3.Zero());if(this._scene.meshes.filter(e).length){const{max:t,min:i}=this._scene.getWorldExtends(e);t.equalsWithEpsilon(i,.001)||this.zoomByBoundBox(i,t)}}zoomToEntity(e){const{extendSize:t,minimumWorld:i,maximumWorld:r}=e.BoundingBox;t.equalsWithEpsilon(n.Vector3.Zero())||this.zoomByBoundBox(i,r)}initOrthCamera(){this.updateOrthCamera(),this._camera.inputs.attached.mousewheel.detachControl(),this.customWheel=this._scene.onPointerObservable.add((e=>{if(this.EnableZoom){let t=0;t=(e=e.event).wheelDelta?-e.wheelDelta:60*-(e.deltaY||e.detail),this.zoomScale+=t/(100*this.wheelSpeed),this.zoomScale<0?this.zoomScale=.001:(this.updateOrthCamera(),this.onZommScaleChangeObserver.notifyObservers(this.zoomScale))}}),n.PointerEventTypes.POINTERWHEEL)}updateOrthCamera(){this._camera.orthoTop=this.Radius*this.zoomScale,this._camera.orthoBottom=-this.Radius*this.zoomScale,this._camera.orthoLeft=-this.Radius*this.zoomScale*this.Aspect,this._camera.orthoRight=this.Radius*this.zoomScale*this.Aspect,this._camera.metadata={zoomScale:this.zoomScale,size:this.Radius*this.zoomScale}}flyTo(e){this._animateGroup&&(this._animateGroup.dispose(),this._animateGroup=null);let{target:t,position:i,time:r=1,complete:s,loop:a=!1}=e;if(t){e=t instanceof fe?t.Position:ne(t);const o=new n.AnimationGroup("camera-fly-group"),l=new n.Animation("camera-fly-target","target",30,n.Animation.ANIMATIONTYPE_VECTOR3);if(l.setKeys([{frame:0,value:this._camera.target.clone()},{frame:30*r,value:e}]),o.addTargetedAnimation(l,this._camera),i){const t=new n.Animation("camera-fly-position","position",30,n.Animation.ANIMATIONTYPE_VECTOR3);e=[{frame:0,value:this._camera.position.clone()},{frame:30*r,value:ne(i)}],t.setKeys(e),o.addTargetedAnimation(t,this._camera)}return o.normalize(0,100),o.play(a),o.onAnimationGroupPlayObservable.add((()=>{this._flying=!0})),o.onAnimationEndObservable.add((()=>{null!=s&&s(),this._flying=!1})),this._animateGroup=o,{clear:()=>{o.dispose(),this._animateGroup=null},stop:()=>o.stop(),pause:()=>o.pause(),reset:()=>o.reset(),restart:()=>o.restart()}}}moveTo(e){return null}destory(){this._camera&&this._camera.dispose()}writeFile(e){e.write(2),e.write(this._target.x),e.write(this._target.y),e.write(this._target.z),e.write(this.zoomScale),e.write(this.size),e.write(this._mode),e.write(this._enable)}readFile(e){var t=e.read();this._target.x=e.read(),this._target.y=e.read(),this._target.z=e.read(),this.zoomScale=e.read(),this.size=e.read(),this._mode=e.read(),1<t&&(this._enable=e.read())}}class ln extends n.ArcRotateCameraPointersInput{constructor(){super(...arguments),this.panningSensibility=1e3,this._button=-1,this.enablePan=!1,this.enableRotate=!0,this.panPercentage=.1}getPanSpeedPercent(){return this.camera.mode===n.Camera.PERSPECTIVE_CAMERA?1e3/(this.panPercentage*this.camera.radius):500*this.panPercentage}onButtonDown(e){this._button=e.button}onTouch(e,t,i){0!==this.panningSensibility&&(this._ctrlKey||this._altKey)&&1===this._button?this.pan(t,i):1===this._button&&this.rotate(t,i)}pan(e,t){var i;this.enablePan&&(i=this.getPanSpeedPercent(),this.camera.inertialPanningX+=-e/i,this.camera.inertialPanningY+=t/i)}rotate(e,t){this.enableRotate&&(this.camera.inertialAlphaOffset-=e/this.angularSensibilityX,this.camera.inertialBetaOffset-=t/this.angularSensibilityY)}}class hn extends on{constructor(e,t){super(e,t),this._scene=e,this._canvas=t,this._pointerInput=new ln,this._radius=10,this._alpha=Math.PI/4,this._beta=Math.PI/3,this._lowerRadiusLimit=.01,this._panningAxis=new n.Vector3(1,1,0),this._originPanTarget=n.Vector3.Zero(),this._panDistance=null,this._minZ=1,this._maxZ=nn,this.onRadiusChangeObserver=new n.Observable,e&&t&&(this.init(),this._camera.onViewMatrixChangedObservable.add((e=>{this._alpha=e.alpha,this._beta=e.beta,this._target.copyFrom(e.target),e.radius!==this._radius&&this.onRadiusChangeObserver.notifyObservers(e),this._mode===n.Camera.PERSPECTIVE_CAMERA&&(this._radius=e.radius),le.trigger({type:"CameraUpdate",target:this})})))}get Alpha(){return this._alpha}set Alpha(e){this._alpha=e,this._camera.alpha=e}get Beta(){return this._beta}set Beta(e){this._beta=e,this._camera.beta=e}get Aspect(){return this._canvas.width/this._canvas.height}get EnablePan(){return!!(this._enable&q.Pan)}set EnablePan(e){e?this._enable|=q.Pan:this._enable&=~q.Pan,this._pointerInput.enablePan=e}get EnableRotate(){return!!(this._enable&q.Roate)}set EnableRotate(e){e?this._enable|=q.Roate:this._enable&=~q.Roate,this._pointerInput.enableRotate=e}get EnableZoom(){return!!(this._enable&q.Zoom)}set EnableZoom(e){e!==this.EnableZoom&&(e?this._enable|=q.Zoom:this._enable&=~q.Zoom,this._mode===n.Camera.PERSPECTIVE_CAMERA&&(e?this._camera.inputs.attached.mousewheel.attachControl():this._camera.inputs.attached.mousewheel.detachControl()))}get Radius(){return this._radius}set Radius(e){this._radius=e,this._camera.radius=e}get IsFlying(){return this._flying}get Position(){return{x:this._camera.position.x,y:this._camera.position.y,z:this._camera.position.z}}set Position(e){var t=new n.Vector3;se(t,e),this._camera.setPosition(t),this._position.copyFrom(t)}get Target(){return{x:this._target.x,y:this._target.y,z:this._target.z}}set Target(e){se(this._target,e),this._camera.setTarget(this._target)}get LowerRadiusLimit(){return this._lowerRadiusLimit}set LowerRadiusLimit(e){e!==this._lowerRadiusLimit&&(this._lowerRadiusLimit=e,this.update())}get UpperRadiusLimit(){return this._upperRadiusLimit}set UpperRadiusLimit(e){e!==this._upperRadiusLimit&&(this._upperRadiusLimit=e,this.update())}get LowerAlphaLimit(){return this._lowerAlphaLimit}set LowerAlphaLimit(e){e!==this._lowerAlphaLimit&&(this._lowerAlphaLimit=e,this.update())}get UpperAlphaLimit(){return this._upperAlphaLimit}set UpperAlphaLimit(e){e!==this._upperAlphaLimit&&(this._upperAlphaLimit=e,this.update())}get LowerBetaLimit(){return this._lowerBetaLimit}set LowerBetaLimit(e){e!==this._lowerBetaLimit&&(this._lowerBetaLimit=e,this.update())}get UpperBetaLimit(){return this._upperBetaLimit}set UpperBetaLimit(e){e!==this._upperBetaLimit&&(this._upperBetaLimit=e,this.update())}get PanningAxis(){return oe(this._panningAxis)}set PanningAxis(e){se(this._panningAxis,e),this.update()}get OriginPanTarget(){return oe(this._originPanTarget)}set OriginPanTarget(e){se(this._originPanTarget,e),this.update()}get PanDistance(){return this._panDistance}set PanDistance(e){e!==this._panDistance&&(this._panDistance=e,this.update())}get MinZ(){return this._minZ}set MinZ(e){e!==this._minZ&&(this._minZ=e,this.update())}get MaxZ(){return this._maxZ}set MaxZ(e){e!==this._maxZ&&(this._maxZ=e,this.update())}zoomTo(e,t){this._camera.setTarget(new n.Vector3(e.x,e.y)),this.Mode===n.Camera.ORTHOGRAPHIC_CAMERA?(this.zoomScale=1.2,this.Size=Math.max(...t.asArray())/2,this._camera.position=new n.Vector3(e.x,e.y,1)):(this._camera.alpha=0,this._camera.beta=0,this._camera.radius=Math.max(...t.asArray())*this.Aspect,this._camera.position=new n.Vector3(e.x,e.y,this._camera.radius))}zoomByBoundBox(e,t){const i=this._camera;i.useFramingBehavior=!0,super.zoomByBoundBox(e,t),i.useFramingBehavior=!1,i.lowerRadiusLimit=this._lowerRadiusLimit}zoomAll(){var e=e=>e.isVisible&&e.isEnabled()&&"WORLD_GROUND"!==e.name&&!e.getBoundingInfo().boundingBox.extendSize.equalsWithEpsilon(n.Vector3.Zero());if(this._scene.meshes.filter(e).length){const{max:t,min:i}=this._scene.getWorldExtends(e);t.equalsWithEpsilon(i,.001)||this.zoomByBoundBox(i,t)}}init(){const e=new n.ArcRotateCamera("MainArcRotateCamera",this._alpha,this._beta,this._radius,this._target,this._scene),t=((this._camera=e).mode=this._mode,e.wheelPrecision=this.wheelSpeed,e.wheelDeltaPercentage=this.wheelDeltaPercentage,e.maxZ=this._maxZ,e.minZ=this._minZ,e.inertia=.5,e.panningInertia=.5,e.lowerRadiusLimit=this._lowerRadiusLimit,e.inputs.removeByType("ArcRotateCameraPointersInput"),this._pointerInput=new ln,this._pointerInput.enableRotate=this.EnableRotate,this._pointerInput.enablePan=this.EnablePan,e.inputs.add(this._pointerInput),e.inputs.attached.mousewheel);t&&(t.customComputeDeltaFromMouseWheel=(t,i,r)=>{let s=0;if(this.wheelDeltaPercentage&&!r.altKey){if(0<(s=this._computeDeltaFromMouseWheelLegacyEvent(t,e.radius))){let i=e.radius,r=e.inertialRadiusOffset+s;for(let t=0;t<20&&.001<Math.abs(r);t++)i-=r,r*=e.inertia;i=n.Scalar.Clamp(i,0,Number.MAX_VALUE),s=this._computeDeltaFromMouseWheelLegacyEvent(t,i)}}else s=t/(40*e.wheelPrecision);return s}),this._mode===n.Camera.ORTHOGRAPHIC_CAMERA?this.initOrthCamera():this.initPerCamera()}set WheelSpeed(e){this._camera.wheelPrecision=this.wheelSpeed}get Mode(){return this._mode}set Mode(e){e!==n.Camera.ORTHOGRAPHIC_CAMERA&&e!==n.Camera.PERSPECTIVE_CAMERA||(this._mode=e,(this._camera.mode=e)===n.Camera.ORTHOGRAPHIC_CAMERA?(this._camera.radius=sn,this.initOrthCamera()):(this._camera.radius=this._radius,this.initPerCamera()))}set ViewMode(e){switch(e){case X.Up:this._camera.position=this._camera.target.clone().add(new n.Vector3(0,0,10));break;case X.Down:this._camera.position=this._camera.target.clone().add(new n.Vector3(0,0,-10));break;case X.Left:this._camera.position=this._camera.target.clone().add(new n.Vector3(-10));break;case X.Right:this._camera.position=this._camera.target.clone().add(new n.Vector3(10));break;case X.Front:this._camera.position=this._camera.target.clone().add(new n.Vector3(0,10));break;case X.Back:this._camera.position=this._camera.target.clone().add(new n.Vector3(0,-10));break;case X.SW:this._camera.position=this._camera.target.clone().add(new n.Vector3(10,10,10))}}initPerCamera(){this.customWheel&&(this._scene.onPointerObservable.remove(this.customWheel),this.customWheel=null,this.EnableZoom&&this._camera.inputs.attached.mousewheel.attachControl())}attachControl(){this._camera.attachControl(this._canvas,!0,!0)}detachControl(){this._camera.detachControl()}lookAt(e){this._camera.setTarget(ne(e))}rotateAround(e){var{target:e,angleX:t,angleY:i,frame:r=30,time:s=10,loop:a=!1}=e;if(t||i){e&&this._camera.target.copyFrom(ne(e));const o=new n.AnimationGroup("camera-around-group");if(t){const e=new n.Animation("camera-around","alpha",r,n.Animation.ANIMATIONTYPE_FLOAT);this._camera.inertialAlphaOffset,e.setKeys([{frame:0,value:0},{frame:s/2*r,value:t/2},{frame:s*r,value:t}]),o.addTargetedAnimation(e,this._camera)}if(i){const e=new n.Animation("camera-around","beta",r,n.Animation.ANIMATIONTYPE_FLOAT);e.setKeys([{frame:0,value:0},{frame:s/2*r,value:i/2},{frame:s*r,value:i}]),o.addTargetedAnimation(e,this._camera)}return o.play(a),{clear:()=>{o.dispose(),this._animateGroup=null},stop:()=>o.stop(),pause:()=>o.pause(),reset:()=>o.reset(),restart:()=>o.restart()}}}moveTo(e){var{alpha:e,beta:t,radius:i,target:r,time:s=1}=e;if(void 0!==e||void 0!==t||void 0!==i||void 0!==r){const a=new n.AnimationGroup("camera-move-to",this._scene);if(void 0!==e){const t=new n.Animation("alpha-a","alpha",30,n.Animation.ANIMATIONTYPE_FLOAT);t.setKeys([{frame:0,value:this._camera.alpha},{frame:30*s,value:e}]),a.addTargetedAnimation(t,this._camera)}if(void 0!==t){const e=new n.Animation("beta-a","beta",30,n.Animation.ANIMATIONTYPE_FLOAT);e.setKeys([{frame:0,value:this._camera.beta},{frame:30*s,value:t}]),a.addTargetedAnimation(e,this._camera)}if(void 0!==i){const e=new n.Animation("radius-a","radius",30,n.Animation.ANIMATIONTYPE_FLOAT);e.setKeys([{frame:0,value:this._camera.radius},{frame:30*s,value:i}]),a.addTargetedAnimation(e,this._camera)}if(void 0!==r){const e=new n.Animation("target-a","target",30,n.Animation.ANIMATIONTYPE_VECTOR3);e.setKeys([{frame:0,value:this._camera.target},{frame:30*s,value:ne(r)}]),a.addTargetedAnimation(e,this._camera)}return{start:()=>(a.start(),new Promise((e=>a.onAnimationEndObservable.add(e)))),clear:()=>{a.dispose(),this._animateGroup=null},stop:()=>a.stop(),pause:()=>a.pause(),reset:()=>a.reset(),restart:()=>a.restart()}}}update(){this._camera.mode=this._mode,this._camera.setTarget(this._target),this._camera.alpha=this._alpha,this._camera.beta=this._beta,this._camera.lowerRadiusLimit=this._lowerRadiusLimit,this._camera.upperRadiusLimit=this._upperRadiusLimit,this._camera.lowerAlphaLimit=this._lowerAlphaLimit,this._camera.upperAlphaLimit=this._upperAlphaLimit,this._camera.lowerBetaLimit=this._lowerBetaLimit,this._camera.upperBetaLimit=this._upperBetaLimit,this._camera.minZ=this._minZ,this._camera.maxZ=this._maxZ,this._camera.panningOriginTarget.copyFrom(this._originPanTarget),this._camera.panningAxis.copyFrom(this._panningAxis),this._camera.panningDistanceLimit=this.PanDistance,this._mode===n.Camera.PERSPECTIVE_CAMERA?this._camera.radius=this._radius:this._camera.radius=sn}reset(){this._target.copyFrom(n.Vector3.Zero()),this._alpha=Math.PI/4,this._beta=Math.PI/3,this._radius=10,this.update()}writeFile(e){e.write(5),super.writeFile(e),e.write(this._alpha),e.write(this._beta),e.write(this._radius),e.write(this._lowerRadiusLimit),e.write(this._upperRadiusLimit),e.write(this._lowerAlphaLimit),e.write(this._upperAlphaLimit),e.write(this._lowerBetaLimit),e.write(this._upperBetaLimit),e.write(this._panDistance),e.write(this._panningAxis.x),e.write(this._panningAxis.y),e.write(this._panningAxis.z),e.write(this._originPanTarget.x),e.write(this._originPanTarget.y),e.write(this._originPanTarget.z),e.write(this._minZ),e.write(this._maxZ)}readFile(e){var t=e.read();1<t&&super.readFile(e),this._alpha=e.read(),this._beta=e.read(),this._radius=e.read(),2<t&&(this._lowerRadiusLimit=e.read(),this._upperRadiusLimit=e.read(),this._lowerAlphaLimit=e.read(),this._upperAlphaLimit=e.read(),this._lowerBetaLimit=e.read(),this._upperBetaLimit=e.read()),3<t&&(this._panDistance=e.read(),this._panningAxis.x=e.read(),this._panningAxis.y=e.read(),this._panningAxis.z=e.read(),this._originPanTarget.x=e.read(),this._originPanTarget.y=e.read(),this._originPanTarget.z=e.read()),4<t&&(this._minZ=e.read(),this._maxZ=e.read()),this._mode===n.Camera.ORTHOGRAPHIC_CAMERA&&this.initOrthCamera(),this.update()}_computeDeltaFromMouseWheelLegacyEvent(e,t){return t=.01*e*this.wheelDeltaPercentage*t,0<e?t/(1+this.wheelDeltaPercentage):t*(1+this.wheelDeltaPercentage)}}class cn extends on{constructor(e,t){super(e,t),this._scene=e,this._canvas=t,e&&t&&(this.init(),this._camera.onViewMatrixChangedObservable.add((e=>{this._position.copyFrom(e.position),this._target.copyFrom(e.target),le.trigger({type:"CameraUpdate",target:this})})))}get EnableZoom(){return!!(this._enable&q.Zoom)}set EnableZoom(e){e!==this.EnableZoom&&(e?this._enable|=q.Zoom:this._enable&=~q.Zoom,this._mode===n.Camera.PERSPECTIVE_CAMERA&&(e?this._camera.inputs.attached.mousewheel.attachControl():this._camera.inputs.attached.mousewheel.detachControl()))}get IsFlying(){return this._flying}get Position(){return{x:this._camera.position.x,y:this._camera.position.y,z:this._camera.position.z}}set Position(e){var t=new n.Vector3;se(t,e),this._camera.position.copyFromFloats(t.x,t.y,t.z)}get Target(){return{x:this._target.x,y:this._target.y,z:this._target.z}}set Target(e){se(this._target,e),this._camera.setTarget(this._target)}zoomTo(e,t){this._camera.setTarget(new n.Vector3(e.x,e.y))}zoomByBoundBox(e,t){super.zoomByBoundBox(e,t)}init(){const e=new n.FreeCamera("MainFreeCamera",this._position,this._scene);e.inputs._mouseInput.buttons=[1],e.keysDown=[p.KeyS],e.keysDownward=[p.ArrowDown],e.keysUp=[p.KeyW],e.keysUpward=[p.ArrowUp],e.keysLeft=[p.KeyA],e.keysRight=[p.KeyD],e.inputs.addMouseWheel(),e.maxZ=nn,this._camera=e,this._mode===n.Camera.ORTHOGRAPHIC_CAMERA?this.initOrthCamera():this.initPerCamera()}set ViewMode(e){switch(e){case X.Up:this._camera.position=this._camera.target.clone().add(new n.Vector3(0,0,10));break;case X.Down:this._camera.position=this._camera.target.clone().add(new n.Vector3(0,0,-10));break;case X.Left:this._camera.position=this._camera.target.clone().add(new n.Vector3(-10));break;case X.Right:this._camera.position=this._camera.target.clone().add(new n.Vector3(10));break;case X.Front:this._camera.position=this._camera.target.clone().add(new n.Vector3(0,10));break;case X.Back:this._camera.position=this._camera.target.clone().add(new n.Vector3(0,-10));break;case X.SW:this._camera.position=this._camera.target.clone().add(new n.Vector3(10,10,10))}}initOrthCamera(){this._camera.orthoTop=this.size,this._camera.orthoBottom=-this.size,this._camera.orthoLeft=-this.size*this.Aspect,this._camera.orthoRight=this.size*this.Aspect,this._camera.inputs.attached.mousewheel.detachControl(),this.customWheel=this._scene.onPointerObservable.add((e=>{if(this.EnableZoom){let t=0;t=(e=e.event).wheelDelta?-e.wheelDelta:60*-(e.deltaY||e.detail),this.zoomScale+=t/(100*this.wheelSpeed),this.zoomScale<0?this.zoomScale=.001:this.updateOrthCamera()}}),n.PointerEventTypes.POINTERWHEEL)}initPerCamera(){this.customWheel&&(this._scene.onPointerObservable.remove(this.customWheel),this.customWheel=null,this.EnableZoom&&this._camera.inputs.attached.mousewheel.attachControl())}attachControl(){this._camera.attachControl(this._canvas,!0)}detachControl(){this._camera.detachControl()}lookAt(e){this._camera.setTarget(ne(e))}moveTo(e){var{target:e,time:t=1,position:i}=e;if(void 0!==i||void 0!==e){const r=new n.AnimationGroup("camera-move-to",this._scene);if(void 0!==e){const i=new n.Animation("target-a","target",30,n.Animation.ANIMATIONTYPE_VECTOR3);i.setKeys([{frame:0,value:this._camera.target},{frame:30*t,value:ne(e)}]),r.addTargetedAnimation(i,this._camera)}if(void 0!==i){const e=new n.Animation("position","position",30,n.Animation.ANIMATIONTYPE_VECTOR3);e.setKeys([{frame:0,value:this._camera.position},{frame:30*t,value:ne(i)}]),r.addTargetedAnimation(e,this._camera)}return{start:()=>(r.start(),new Promise((e=>r.onAnimationEndObservable.add(e)))),clear:()=>{r.dispose(),this._animateGroup=null},stop:()=>r.stop(),pause:()=>r.pause(),reset:()=>r.reset(),restart:()=>r.restart()}}}update(){this._camera.mode=this._mode,this._camera.setTarget(this._target),this._camera.position=this._position,this._mode===n.Camera.ORTHOGRAPHIC_CAMERA&&this.updateOrthCamera()}reset(){this._target.copyFrom(n.Vector3.Zero()),this.update()}updateOrthCamera(){this._camera.orthoTop=this.size*this.zoomScale,this._camera.orthoBottom=-this.size*this.zoomScale,this._camera.orthoLeft=-this.size*this.zoomScale*this.Aspect,this._camera.orthoRight=this.size*this.zoomScale*this.Aspect}writeFile(e){e.write(2),super.writeFile(e),e.write(this._position.x),e.write(this._position.y),e.write(this._position.z)}readFile(e){1<e.read()&&super.readFile(e),this._position.x=e.read(),this._position.y=e.read(),this._position.z=e.read(),this.update()}}!function(e){e[e.ArcRotate=0]="ArcRotate",e[e.FreeCamera=1]="FreeCamera",e[e.Follow=2]="Follow"}(xr=xr||{});class un{constructor(e,t){this._scene=e,this._canvas=t,this._type=xr.ArcRotate,this.init()}get Type(){return this._type}set Type(e){this._type=e,this.switch()}get Control(){return this._control}get Camera(){return this._control.CurrentCamera}get ArcRotateCamera(){return this.ArcRotateControl.CurrentCamera}get FreeCamera(){return this.FreeControl.CurrentCamera}get Alpha(){return this._control.Alpha}set Alpha(e){this._control.Alpha=e}get Beta(){return this._control.Beta}set Beta(e){this._control.Beta=e}get Radius(){return this.ArcRotateControl.Radius}set Radius(e){this.ArcRotateControl.Radius=e}get Position(){return this.Control.Position}set Position(e){this.Control.Position=e}get Target(){return this.Control.Target}set Target(e){this.Control.Target=e}get Mode(){return this.Control.Mode}set Mode(e){this.Control.Mode=e}get ZoomScale(){return this.Control.zoomScale}init(){this.ArcRotateControl=new hn(this._scene,this._canvas),this.FreeControl=new cn(this._scene,this._canvas),this._control=this.ArcRotateControl,this._control.active()}switch(){switch(this._control.detachControl(),this._type){case xr.ArcRotate:this._control=this.ArcRotateControl;break;case xr.FreeCamera:this._control=this.FreeControl;case xr.Follow:}this._control.active(),this.switchEvent(this)}switchEvent(e){}zoomAll(){this._control.zoomAll()}zoomToEntity(e){this._control.zoomToEntity(e)}reset(){this.ArcRotateControl.reset(),this.FreeControl.reset()}destory(){this.ArcRotateControl.destory(),this.FreeControl.destory()}writeFile(e){e.write(1),e.write(this._type),this.ArcRotateControl.writeFile(e),this.FreeControl.writeFile(e)}readFile(e){e.read(),this._type=e.read(),this.ArcRotateControl.readFile(e),this.FreeControl.readFile(e),this.switch()}}class dn{static LoadSkyboxPathTexture(e){var t=Math.max(0,class{static ReadLocalStorageValue(e,t){return"undefined"!=typeof Storage&&null!==localStorage.getItem(e)?parseInt(localStorage.getItem(e)):t}}.ReadLocalStorageValue("defaultSkyboxId",0));const i=this.SkyboxPath||this.Skyboxes[t];return i.indexOf(".hdr")===i.length-4?new n.HDRCubeTexture(i,e,256,!1,!0,!1,!0):n.CubeTexture.CreateFromPrefilteredData(i,e)}}function pn(e,t,i,r){e=[{frame:0,value:e},{frame:30*r,value:t}];const s=new n.Animation("animation"+Date.now(),i,30,n.Animation.ANIMATIONTYPE_FLOAT,n.Animation.ANIMATIONLOOPMODE_CONSTANT);return s.setKeys(e),s}dn.SkyboxPath="",dn.Skyboxes=["https://am-img.gkiiot.com/editor/envs/environmentSpecular.env","https://am-img.gkiiot.com/editor/envs/studio.env"],dn.SkyboxesNames=["Default","Studio"];const fn=["groundMaterial","skyMaterial","skyBox","default material"],mn=["px.jpg","py.jpg","pz.jpg","nx.jpg","ny.jpg","nz.jpg"];class _n{constructor(e){this._skybox="",this._mode=te.None,this._turbidity=10,this._luminance=1,this._rayleigh=2,this._sunPosition=new n.Vector3(0,100,0),this._inclination=0,this._azimuth=.25,this._mieDirectionalG=.8,this._mieCoefficient=.005,this._isReflect=!1,this.LoadObserable=new n.Observable,this.watchMaterial=e=>{setTimeout((()=>{this.reflectMaterial(e)}),0)},this.onLoad=()=>{le.trigger({type:"loadBackground",target:null}),this.LoadObserable.notifyObservers(!0)},this._scene=new n.Scene(e,{useMaterialMeshMap:!0,useClonedMeshMap:!0}),this._scene.ambientColor=n.Color3.FromHexString("#222222"),this._scene.useRightHandedSystem=!0,this.BlockMaterialUpdate=!0,this.initReflection(),this.init()}init(){const e=new n.GlowLayer("glow",this._scene);e.intensity=.5,this._glowLayer=e}initReflection(){this._reflectionProbe&&this._reflectionProbe.dispose();var e=new n.ReflectionProbe("ref",512,this._scene);this._reflectionProbe=e}get Scene(){return this._scene}get Mode(){return this._mode}set Mode(e){this._mode=e,this.update()}get Skybox(){return this._skybox}set Skybox(e){this._skybox!==e&&(this._skybox=e,this.showSkyBox())}get AmbientColor(){return this._scene.ambientColor.toHexString()}set AmbientColor(e){this.Scene.ambientColor=n.Color3.FromHexString(e)}get EmissiveIntensity(){return this._glowLayer.intensity}set EmissiveIntensity(e){this._glowLayer.intensity=e}get Background(){return this.Scene.clearColor.toHexString(!0)}set Background(e){var t;"string"==typeof e?this.Scene.clearColor=n.Color4.FromHexString(e+"FF"):Array.isArray(e)?this.Scene.clearColor=new n.Color4(e[0]/255,e[1]/255,e[2]/255,null!=(t=e[3])?t:1):this.Scene.clearColor=e}get Turbidity(){return this._turbidity}set Turbidity(e){e!==this._turbidity&&(this._turbidity=e,this.update())}get Rayleigh(){return this._rayleigh}set Rayleigh(e){e!==this._rayleigh&&(this._rayleigh=e,this.update())}get Luminance(){return this._luminance}set Luminance(e){e!==this._luminance&&(this._luminance=e,this.update())}get SunPosition(){return{x:this._sunPosition.x,y:this._sunPosition.y,z:this._sunPosition.z}}set SunPosition(e){se(this._sunPosition,e),this.update()}get Inclination(){return this._inclination}set Inclination(e){e!==this._inclination&&(this._inclination=e,this.update())}get Azimuth(){return this._azimuth}set Azimuth(e){e!==this._azimuth&&(this._azimuth=e,this.update())}get IsReflect(){return this._isReflect}set IsReflect(e){e!==this._isReflect&&((this._isReflect=e)?(this._scene.onNewMaterialAddedObservable.add(this.watchMaterial),this.reflect()):(this._scene.onNewMaterialAddedObservable.removeCallback(this.watchMaterial),this.cancelReflect()))}get BlockMaterialUpdate(){return this._scene.blockMaterialDirtyMechanism}set BlockMaterialUpdate(e){this._scene.blockMaterialDirtyMechanism=e}debugger(e={}){me.debugger&&this._scene.debugLayer.show(Object.assign({embedMode:!0},e))}render(){this._scene.activeCamera&&this._scene.render()}update(){switch(this._mode){case te.Image:this.showSkyBox();break;case te.Sun:this.getSkyBox(),this._skyMaterial.inclination=this._inclination,this._skyMaterial.azimuth=this._azimuth,this._skyMaterial.rayleigh=this._rayleigh,this._skyMaterial.turbidity=this._turbidity,this._skyMaterial.luminance=this._luminance,this._skyMaterial.mieDirectionalG=this._mieDirectionalG,this._skyMaterial.mieCoefficient=this._mieCoefficient;break;case te.Env:break;default:this.hiddenSkyBox()}}reflect(){return v(this,void 0,void 0,(function*(){this.BlockMaterialUpdate=!1;let e=0;for(const t of this._scene.materials)fn.includes(t.name)||(this.reflectMaterial(t),5===e?(yield U(100),e=0):e++);this.BlockMaterialUpdate=!0}))}cancelReflect(){return v(this,void 0,void 0,(function*(){this.BlockMaterialUpdate=!1;let e=0;for(const t of this._scene.materials)fn.includes(t.name)||(this.cancelReflectMaterial(t),5===e?(yield U(100),e=0):e++);this.BlockMaterialUpdate=!0}))}createDefaultEnv(){this._scene.environmentTexture=dn.LoadSkyboxPathTexture(this._scene),this._scene.createDefaultSkybox(this._scene.environmentTexture,!0,(this._scene.activeCamera.maxZ-this._scene.activeCamera.minZ)/2,.3,!1)}loadEnv(e){this.BlockMaterialUpdate=!1,e=n.CubeTexture.CreateFromPrefilteredData(e,this._scene),this._scene.environmentTexture=e,this.BlockMaterialUpdate=!0}reset(){this._skybox="",this._scene.clearColor=new n.Color4(.2,.2,.3,1),this._reflectionProbe.dispose(),this._reflectionProbe=new n.ReflectionProbe("ref",512,this._scene),this.update()}writeFile(e){e.write(2),e.write(this._skybox),e.write(this.EmissiveIntensity),e.write(this.Background),e.write(this.AmbientColor),e.write(this._mode),e.write(this._turbidity),e.write(this._luminance),e.write(this._rayleigh),e.write(this._sunPosition.x),e.write(this._sunPosition.y),e.write(this._sunPosition.z),e.write(this._isReflect),e.write(this._inclination),e.write(this._azimuth)}readFile(e){this.initReflection();var t=e.read();this._skybox=e.read(),this.EmissiveIntensity=e.read(),this.Background=e.read(),this.AmbientColor=e.read(),this._mode=e.read(),this._turbidity=e.read(),this._luminance=e.read(),this._rayleigh=e.read(),this._sunPosition.x=e.read(),this._sunPosition.y=e.read(),this._sunPosition.z=e.read(),this.IsReflect=e.read(),1<t&&(this._inclination=e.read(),this._azimuth=e.read()),this.update()}testLights(){var[e,t,i]=[275,30,180],[r,s]=[225,146],[a,o]=[80,148],[l,h]=[-71,190];const c=[new n.Vector3(e,t,i-36),new n.Vector3(r-43,t,s),new n.Vector3(r-43,t,s-30),new n.Vector3(a-43,t,o),new n.Vector3(l,t,h-43)];let u=1;this._scene.materials.forEach((e=>e.maxSimultaneousLights=c.length+1));for(const e of c){const t=new n.SpotLight("s"+u++,e,new n.Vector3(0,-1),2*Math.PI,2,this._scene);t.intensity=3e3,t.range=1e3}}day2Evening(e=!1){if(this._skyMaterial){const l=[this._turbidity,1],h=[this._rayleigh,0],c=[this._luminance,.8],u=[this._inclination,-.48],d=[this._inclination,-.48],p=[1,-.1],f=(e&&(l.reverse(),h.reverse(),c.reverse(),u.reverse(),d.reverse(),p.reverse()),new n.AnimationGroup("d2e"));e=pn(l[0],l[1],"material.turbidity",6);var t=pn(h[0],h[1],"material.rayleigh",6),i=pn(c[0],c[1],"material.luminance",6),r=pn(u[0],u[1],"material.inclination",6),s=pn(d[0],d[1],"material.azimuth",6),a=this._scene.lights[0],o=pn(p[0],p[1],"intensity",6);this._scene.stopAnimation(this._skyboxMesh),this._scene.stopAnimation(a);for(const n of[e,t,i,r,s])f.addTargetedAnimation(n,this._skyboxMesh);f.addTargetedAnimation(o,a),f.start(!1,1,0,180)}}showFog(e=200,t=1e3){this._scene.fogMode=n.Scene.FOGMODE_LINEAR,this._scene.fogColor=new n.Color3(.9,.9,.85),this._scene.fogDensity=.01,this._scene.fogStart=e,this._scene.fogEnd=t}showSkyBox(){this._skybox?["png","jpg","jpeg"].some((e=>this._skybox.endsWith(e)))?(this.hiddenBox(),this._layer?(le.trigger({type:"loadingBackground",target:null}),this._layer.isEnabled=!0,this._layer.texture.updateURL(me.SkyBox_URL+this._skybox,null,this.onLoad)):this._layer=new n.Layer("GlobalBackground",me.SkyBox_URL+this._skybox,this._scene,!0)):(this.hiddenLayer(),this._skybox.endsWith("hdr")?this.setSkyboxByHdr(me.SkyBox_URL+this._skybox):(le.trigger({type:"loadingBackground",target:null}),this.setEnvTexture(new n.CubeTexture(me.SkyBox_URL+this._skybox,this._scene,mn,void 0,null,this.onLoad)))):this.hiddenSkyBox()}hiddenLayer(){this._layer&&(this._layer.isEnabled=!1)}hiddenBox(){this._skyboxMesh&&this._skyboxMesh.setEnabled(!1)}hiddenSkyBox(){this.hiddenBox(),this.hiddenLayer()}setSkyboxByHdr(e){e=new n.HDRCubeTexture(e,this._scene,512),this.setEnvTexture(e)}getSkyBox(){const e=this.createSkybox();return e.setEnabled(!0),this._mode===te.Sun?e.material=this.getSkyMaterial():this._mode===te.Env?e.material=this.getPBRMaterial():e.material=this.getStandMaterial(),e}createSkybox(){if(this._skyboxMesh)return this._skyboxMesh;const e=(0,n.CreateBox)("skybox",{size:nn},this._scene);return e.isPickable=!1,e.infiniteDistance=!0,e.ignoreCameraMaxZ=!0,this._reflectionProbe.renderList.push(e),this._skyboxMesh=e,this._skyboxMesh}getStandMaterial(){if(this._standMaterial)return this._standMaterial;const e=new n.StandardMaterial("skyBox",this._scene);return(this._standMaterial=e).backFaceCulling=!1,e.disableLighting=!0,this._standMaterial=e,this._standMaterial}getPBRMaterial(){if(this._pbrMaterial)return this._pbrMaterial;const e=new n.PBRMaterial("skyBox",this._scene);return e.backFaceCulling=!1,e.reflectionTexture&&(e.reflectionTexture.coordinatesMode=n.Texture.SKYBOX_MODE),e.microSurface=1,e.disableLighting=!0,e.twoSidedLighting=!0,this._pbrMaterial=e,this._pbrMaterial}getSkyMaterial(){if(this._skyMaterial)return this._skyMaterial;const e=new a.SkyMaterial("skyMaterial",this._scene);return e.backFaceCulling=!1,this._skyMaterial=e,this._skyMaterial}setEnvTexture(e){const t=this.getSkyBox().material;t.reflectionTexture=e,t.reflectionTexture&&(t.reflectionTexture.coordinatesMode=n.Texture.SKYBOX_MODE)}reflectMaterial(e){var t;fn.includes(e.name)||(e instanceof n.StandardMaterial||e instanceof n.PBRMaterial)&&(this.BlockMaterialUpdate=!1,t=e.reflectionTexture,e.metadata=t,e.reflectionTexture=this._reflectionProbe.cubeTexture,e.realTimeFiltering=!0,this.BlockMaterialUpdate=!0)}cancelReflectMaterial(e){fn.includes(e.name)||(e instanceof n.StandardMaterial||e instanceof n.PBRMaterial)&&(e.reflectionTexture=e.metadata,e.metadata=null,e.realTimeFiltering=!1)}}function gn({color:e,dir:t,height:i,cameraHeight:r,scene:a,cm:o,reverse:l=!1},h){const c=l?-1:1,u=new n.TransformNode((l?"-":"")+t+"-label",a),d=(u.position[t]=i*c,new s.Ellipse),p=(d.isPointerBlocker=!0,d.width="120px",d.height="120px",d.thickness=4,d.color=e,d.background=e,new s.TextBlock(t,(l?"-":"")+t.toUpperCase())),f=(p.fontSize=70,p.fontWeight="400",p.color="#000000",d.addControl(p),a.activeCamera);return d.onPointerClickObservable.add((e=>{f.restoreState();const i=new n.Vector3,s=new n.Vector3;if(s[t]=r*c,o.Camera instanceof n.ArcRotateCamera){const e=o.Camera;var a=e.radius;i[t]=a*c,o.Position=e.target.add(i)}else o.Camera instanceof n.FreeCamera&&(a=n.Vector3.Distance(o.Camera.target,o.Camera.position),i[t]=a*c,o.Target=o.Camera.position.add(i));f.setPosition(s)})),d.onPointerEnterObservable.add((()=>{p.color="#ffffff"})),d.onPointerOutObservable.add((()=>{p.color="#000000"})),h.addControl(d),d.linkWithMesh(u),d}class yn{constructor(e,t,i){this.engine=e,this.cameraManger=i,this._cameraHeight=3.2,this.ellipses=[],this.stopRender=!1,this.onArcRotateChange=e=>{const t=this.Scene.activeCamera;t instanceof n.ArcRotateCamera&&(t.alpha=e.alpha,t.beta=e.beta)},this.onFreeChange=e=>{const t=this.Scene.activeCamera;t instanceof n.ArcRotateCamera&&(e=e.position.subtract(e.target).normalize().scale(this._cameraHeight),t.position=e)},this.init(),this.initViewHelper();const r=n.Frustum.GetPlanes(this._scene.getTransformMatrix());this._scene.registerBeforeRender((()=>{this.ellipses.forEach((e=>{e.linkedMesh&&this.isInFrustum(r,e.linkedMesh.position)&&this.changeZIndex(e,e.linkedMesh,Math.round(1e3/t.activeCamera.position.subtract(e.linkedMesh.position).length()))}))})),t.onActiveCameraChanged.add((e=>{e.activeCamera instanceof n.FreeCamera&&!this.FreeObserver&&(this.FreeObserver=t.activeCamera.onViewMatrixChangedObservable.add(this.onFreeChange))})),this._scene.activeCamera instanceof n.ArcRotateCamera&&t.activeCamera instanceof n.ArcRotateCamera&&(this._scene.activeCamera.alpha=t.activeCamera.alpha,this._scene.activeCamera.beta=t.activeCamera.beta),t.activeCamera.onViewMatrixChangedObservable.add(this.onArcRotateChange)}get Scene(){return this._scene}render(){this._scene.activeCamera&&!this.stopRender&&this._scene.render()}init(){const e=new n.Scene(this.engine),t=(e.autoClear=!1,e.ambientColor=n.Color3.White(),e.createDefaultCamera(!0,!0,!0),e.useRightHandedSystem=!0,e.activeCamera);t.viewport=new n.Viewport(.85,.85,.15,.15),t.detachControl(),t.target=n.Vector3.Zero(),t.setPosition(new n.Vector3(0,0,this._cameraHeight)),this._scene=e}initViewHelper(){var e={diameter:.05,height:1,tessellation:96},t=new n.TransformNode("viewerHelper",this._scene),i="#ff3653",r="#8adb00",a="#2c8fff";const o=(0,n.CreateCylinder)("x-line",e,this._scene),l=(o.position.x+=.5,o.rotation.z=Math.PI/2,o.parent=t,new n.StandardMaterial("",this._scene)),h=(l.ambientColor=n.Color3.FromHexString(i),o.material=l,(0,n.CreateCylinder)("y-line",e,this._scene)),c=new n.StandardMaterial("",this._scene),u=(c.ambientColor=n.Color3.FromHexString(r),h.material=c,h.position.y+=.5,(0,n.CreateCylinder)("z-line",e,this._scene)),d=new n.StandardMaterial("",this._scene);d.ambientColor=n.Color3.FromHexString(a),u.material=d,u.rotation.x=Math.PI/2,u.position.z+=.5,t=s.AdvancedDynamicTexture.CreateFullscreenUI("UI",!0,this._scene),e={height:1,cameraHeight:this._cameraHeight,scene:this._scene,cm:this.cameraManger},this.ellipses.push(gn(Object.assign(Object.assign({},e),{dir:"x",color:i}),t),gn(Object.assign(Object.assign({},e),{dir:"x",color:i,reverse:!0}),t),gn(Object.assign(Object.assign({},e),{dir:"y",color:r}),t),gn(Object.assign(Object.assign({},e),{dir:"y",color:r,reverse:!0}),t),gn(Object.assign(Object.assign({},e),{dir:"z",color:a}),t),gn(Object.assign(Object.assign({},e),{dir:"z",color:a,reverse:!0}),t))}changeZIndex(e,t,i){e.zIndex=i,e.linkWithMesh(t)}isInFrustum(e,t){for(let i=0;i<6;i++)if(e[i].dotCoordinate(t)<0)return!1;return!0}}class vn{constructor(e,t=!1,i={defaultLight:!1}){this.canvas=e,this.preview=t,this._option=i,this._showWorldAxes=!1,this._engineOption={preserveDrawingBuffer:!0,stencil:!0,useHighPrecisionMatrix:!0,premultipliedAlpha:!1,antialias:!0,forceSRGBBufferSupportState:!1},this.Reading=!1,this.pauseRender=!1,this.renderFunction=()=>{this.renderEvent(),this.Reading||this.pauseRender||(this.sceneControl.render(),this._sceneHelper&&this._sceneHelper.render())},this.init(),this._regiser(),this.render()}get Scene(){return this.sceneControl.Scene}get ShowAxesViewer(){return this._showWorldAxes}set ShowAxesViewer(e){this._showWorldAxes=e,this._worldAxes&&(this._worldAxes.xAxis.setEnabled(e),this._worldAxes.yAxis.setEnabled(e),this._worldAxes.zAxis.setEnabled(e))}get AmbientColor(){return this.Scene.ambientColor}set AmibentColor(e){this.Scene.ambientColor=n.Color3.FromHexString(e)}get GuiContainer(){return this._advancedDynamicTexture}get PauseRender(){return this.PauseRender}set PauseRender(e){e!==this.pauseRender&&(this.pauseRender=e)&&setTimeout((()=>{this.engine.clear(this.Scene.clearColor,this.Scene.autoClear||this.Scene.forceWireframe||this.Scene.forcePointsCloud,this.Scene.autoClearDepthAndStencil,this.Scene.autoClearDepthAndStencil)}),0)}getPreviewUrl(e=!1,t=400){return v(this,void 0,void 0,(function*(){return this._sceneHelper&&(this._sceneHelper.stopRender=!0),this.utilLayer&&this.utilLayer.utilityLayerScene.rootNodes.forEach((e=>{e.metadata=e.isEnabled(),e.setEnabled(!1)})),e&&(this.setSize(400,400),yield U(0)),new Promise((i=>{n.Tools.CreateScreenshot(this.engine,this.Camera,t,(t=>{e&&this.setSize(),this._sceneHelper&&(this._sceneHelper.stopRender=!1),this.utilLayer&&this.utilLayer.utilityLayerScene.rootNodes.forEach((e=>{e.setEnabled(e.metadata)})),i(t)}))}))}))}getBlob(e=!1){return v(this,void 0,void 0,(function*(){return G(yield this.getPreviewUrl(e))}))}get ShowGround(){return this.ground.isEnabled()}set ShowGround(e){this.ground.setEnabled(e)}init(){this._initEngine(),this._initScene(),this._initCamera(),this._option.defaultLight&&this._initLight(),this.preview||this._initSceneHelper(),_e.Scene=this.Scene,this.highlightManager=new rn(this),this.setSize();var e=s.AdvancedDynamicTexture.CreateFullscreenUI("MainGuiContainer",!0,this.Scene);this._advancedDynamicTexture=e}initEditor(){this.utilLayer=new n.UtilityLayerRenderer(this.Scene),this._worldAxes=new n.AxesViewer(this.utilLayer.utilityLayerScene,1,0),this._worldAxes.xAxis.setEnabled(this._showWorldAxes),this._worldAxes.yAxis.setEnabled(this._showWorldAxes),this._worldAxes.zAxis.setEnabled(this._showWorldAxes),this.cameraManager.ArcRotateControl.onRadiusChangeObserver.add((e=>{this.updateAxes()})),this.cameraManager.ArcRotateControl.onZommScaleChangeObserver.add((e=>{this.updateAxes()}));const e=n.MeshBuilder.CreateGround("WORLD_GROUND",{width:4e3,height:4e3},this.Scene),t=(e.isPickable=!1,new a.GridMaterial("groundMaterial",this.Scene));t.lineColor=new n.Color3(79/255,79/255,79/255),t.mainColor=new n.Color3(61/255,61/255,61/255),t.opacity=.98,t.backFaceCulling=!1,t.gridRatio=10,t.freeze(),e.material=t,this.ground=e,this.highlightManager.exclude(e),Or(this.cameraManager,this.cameraManager.switchEvent,(e=>{this._worldAxes&&(e=this._showWorldAxes&&e.Type===xr.ArcRotate,this._worldAxes.xAxis.setEnabled(e),this._worldAxes.yAxis.setEnabled(e),this._worldAxes.zAxis.setEnabled(e))}))}get Width(){return this.engine.getRenderWidth()}get Height(){return this.engine.getRenderHeight()}get Camera(){return this.cameraManager.Camera}get FPS(){return this.engine.getFps()}setSize(e,t){this.engine.setSize(null!=e?e:this.canvas.parentElement.clientWidth,null!=t?t:this.canvas.parentElement.clientHeight)}world2screen(e){return n.Vector3.Project(ne(e),n.Matrix.IdentityReadOnly,this.Scene.getTransformMatrix(),this.Camera.viewport.toGlobal(this.Scene.getEngine().getRenderWidth(),this.Scene.getEngine().getRenderHeight()))}screen2World(e){const t=this.Scene.createPickingRay(e.x,e.y,this.Scene.getViewMatrix(),this.cameraManager.Camera,!0);return this.ground&&(this.ground.isPickable=!0),e=t.intersectsMesh(this.ground||this.Plane),this.ground&&(this.ground.isPickable=!1),e.hit?e.pickedPoint:null}render(){this.engine.runRenderLoop(this.renderFunction)}stopRender(){this.engine.stopRenderLoop()}destory(){this.Scene!==_e.MainScene&&(_e.Scene=_e.MainScene),this.cameraManager.destory(),this.engine.dispose()}on(e,t){let i;return"rendered"===e?(i=this.Scene.onAfterRenderObservable.add(t),()=>{this.Scene.onAfterRenderObservable.remove(i)}):()=>{}}zoomAll(){this.cameraManager.zoomAll()}reset(){this.cameraManager.reset(),this.sceneControl.reset(),this.updateAxes(!0)}_regiser(){}_initEngine(){var e=new n.Engine(this.canvas,!0,this._engineOption);this.engine=e}_initScene(){this.sceneControl=new _n(this.engine)}_initCamera(){this.cameraManager=new un(this.Scene,this.canvas)}_initLight(){new n.HemisphericLight("global-light",new n.Vector3(1,1,1),this.Scene)}_initSceneHelper(){this._sceneHelper=new yn(this.engine,this.Scene,this.cameraManager)}updateAxes(e=!1){var t,i;this.utilLayer&&(t=this.utilLayer.utilityLayerScene.activeCamera.globalPosition,this._worldAxes.xAxis.position.subtractToRef(t,re),t=re.length(),this.Camera.mode===n.Camera.ORTHOGRAPHIC_CAMERA?(i=this.cameraManager.ZoomScale,this._worldAxes.xAxis.scaling.setAll(100*i),this._worldAxes.yAxis.scaling.setAll(100*i),this._worldAxes.zAxis.scaling.setAll(100*i)):e?(this._worldAxes.xAxis.scaling.setAll(1),this._worldAxes.yAxis.scaling.setAll(1),this._worldAxes.zAxis.scaling.setAll(1)):(this._worldAxes.xAxis.scaling.setAll(t/15*4),this._worldAxes.yAxis.scaling.setAll(t/15*4),this._worldAxes.zAxis.scaling.setAll(t/15*4)))}renderEvent(){}writeFile(e){e.write(1),this.cameraManager.writeFile(e),this.sceneControl.writeFile(e)}readFile(e){this.Reading=!0,e.read(),this.cameraManager.readFile(e),this.sceneControl.readFile(e),this.Reading=!1,this.updateAxes(!0)}}class bn extends L{constructor(){super(),this._name="\u7c92\u5b50\u7279\u6548",this._isSelect=!1}get IsSelect(){return this._isSelect}set IsSelect(e){this._isSelect=e}get Name(){return this._name}set Name(e){this._name=e}get UniupeName(){return this.Name+this.Id}start(){}stop(){}destory(){}update(){}clone(){}fromJSON(e){return this}writeFile(e){super.writeFile(e),e.write(1),e.write(this._name)}readFile(e){super.readFile(e),e.read(),this._name=e.read()}}class En{constructor(e){this.Object=e,this.filer=new F}save(){return this.Object&&0===this.filer.Data.length&&this.filer.writeObject(this.Object),this}getObject(e){return this.filer.reset(),this.filer.database=e,this.Object=this.filer.readObject(),this.filer.reset(),this.Object}readFile(e){e.read(),e=e.read(),this.filer.Data=e}writeFile(e){e.write(1),e.write(this.filer.Data)}}class xn{writeFile(e){}readFile(e){}}class Cn{constructor(e){this.index=e}get Index(){return this.index}readFile(e){e.read(),this.index=e.read()}writeFile(e){e.write(1),e.write(this.index)}}let wn=class extends L{constructor(){super(...arguments),this.objects=[]}append(e){this._db&&!e.ObjectId?e._SetOwnerDatabase(this._db):e._SetDatabase(this._db),e.Owner=this._Owner,this.objects.push(e);let t=this.UndoRecord;if(t){let i=new xn;i.redoData=new En(e).save(),i.undoData=new Cn(this.objects.length-1),t.writeObjectHistoryPath(this,i)}return this.appendEvent(e),e.ObjectId}appendEvent(e){}remove(e){e=this.objects.indexOf(e),this.removeIndex(e)}removeIndex(e){if(-1!==e){let t=this.objects[e];return this.objects.splice(e,1),t&&t.destory(),t}}destory(){super.destory();for(const e of this.objects)e.destory();this.objects.length=0}readFile(e){super.readFile(e),e.read();var t=e.read();this.objects=[];for(let r=0;r<t;r++){var i=e.readObject();i&&(this.objects.push(i),i.IsErase||this.appendEvent(i))}}writeFile(e){for(var t of(super.writeFile(e),e.write(1),e.write(this.objects.length),this.objects))e.writeObject(t)}_applyHistoryRecord(e){var t;e instanceof En?(t=e.getObject(this._db),this.objects.push(t),this.appendEvent(t)):e instanceof Cn&&(t=this.removeIndex(e.Index),e.removeObject=t)}};wn=y([S],wn);const Sn=[fe,Ee,ve,bn];class Tn extends L{constructor(){super(),this.entityCol=new wn,Ir(this.entityCol,this.entityCol.appendEvent,(e=>{this.appendEvent(e)}))}get Entitys(){return this.entityCol.objects.slice()}IsVaildObject(e){return Sn.some((t=>e instanceof t))}setCheckout(e){return this.checkout=e,this}append(e){this.checkout&&!this.checkout(e)||!this.IsVaildObject(e)||this.entityCol.append(e)}appendEvent(e){}_SetOwnerDatabase(e){return super._SetOwnerDatabase(e),this.entityCol._SetOwnerDatabase(e),this.entityCol.Owner=this.ObjectId,this}writeFile(e){super.writeFile(e),e.write(1),this.entityCol.writeFile(e)}readFile(e){super.readFile(e),e.read(),this.entityCol.readFile(e)}destory(){super.destory(),this.entityCol.destory()}}class Pn extends xn{constructor(e){super(),this.id=e,this.writeUndo()}writeUndo(){this.undoData=new k(this.id.Object)}writeRedo(){this.redoData=new k(this.id.Object)}writeFile(e){e.write(1),e.writeObjectId(this.id)}readFile(e){e.read(),this.id=e.readObjectId()}}let An=class extends L{constructor(e=""){super(),this.commandName=e,this._HistoryList=new Map,this._CreateObjects=new Map}get HistoryList(){return this._HistoryList}getObjectAllDataRecord(e){let t=[];for(const i of e)i instanceof Pn&&t.push(i);return t}writeObjectSnapshoot(e){var t;if(e.ObjectId&&!this._CreateObjects.has(e)){let i=this.getObjectHistoryList(e.ObjectId);null!=(t=this.getObjectAllDataRecord(i))&&t.length||(t=new Pn(e.ObjectId),i.push(t))}}getObjectHistoryList(e){return this._HistoryList.has(e)||this._HistoryList.set(e,[]),this._HistoryList.get(e)}createEraseHistory(e,t){let i=new xn;i.undoData=new A(!t),i.redoData=new A(t),this.writeObjectHistoryPath(e,i)}writeObjectHistoryPath(e,t){if(!this._CreateObjects.has(e)){let i=this.getObjectHistoryList(e.ObjectId);null!=(e=this.getObjectAllDataRecord(i))&&e.length||(t.redoData instanceof En&&this._CreateObjects.set(t.redoData.Object,t),i.push(t))}}destory(){}writeFile(e){e.write(1),e.write(this.commandName)}readFile(e){e.read(),this.commandName=e.read()}};An=y([S],An);class Rn extends L{constructor(){super(...arguments),this.historyRecordList=[],this.doing=!1,this.cursor=-1,this.isEnable=!0}startCmd(e){this.historyRecordList.splice(this.cursor+1,this.historyRecordList.length-(this.cursor+1)),this.historyRecordList.push(new An(e)),this.cursor=this.historyRecordList.length-1}endCmd(){var e=this.historyRecordList[this.cursor];if(e){for(var[,t]of e.HistoryList)for(const e of t)e instanceof Pn&&e.writeRedo();return this.endCmdEvent(!0),!0}return this.endCmdEvent(!1),!1}get HasUndo(){return!!this.historyRecordList[this.cursor]}get HasRedo(){return!!this.historyRecordList[this.cursor+1]}endCmdEvent(e){}undo(){var e,t,i=this.historyRecordList[this.cursor];if(!i)return!1;for([e,t]of(this.doing=!0,i.HistoryList))for(let i=t.length;i--;)e.Object._applyHistoryRecord(t[i].undoData);return this.cursor--,this.doing=!1,this.undoEvent(i),!0}undoEvent(e){}redo(){var e,t,i=this.historyRecordList[this.cursor+1];if(!i)return!1;for([e,t]of(this.doing=!0,i.HistoryList))for(let i=t.length;i--;)e.Object._applyHistoryRecord(t[i].redoData);return this.cursor++,this.doing=!1,this.redoEvent(i),!0}redoEvent(e){}clear(){this.historyRecordList.length=0,this.cursor=-1}destory(){super.destory();for(const e of this.historyRecordList)e.destory();this.historyRecordList.length=0,this.cursor=-1}get LastCmdRecord(){if(!this.doing&&this.isEnable)return R(this.historyRecordList)}writeFile(e){e.write(1),e.write(this.historyRecordList.length);for(const t of this.historyRecordList)t.writeFile(e)}readFile(e){e.read();var t=e.read();for(let i=this.historyRecordList.length=0;i<t;i++){const t=new An;t.readFile(e),this.historyRecordList.push(t)}}}class Mn extends L{constructor(){super(...arguments),this.recordMap=new Map}append(e){e._SetOwnerDatabase(this.DB),this.recordMap.set(e.Name,e)}remove(e){return this.recordMap.delete(e)}}class On extends L{constructor(){super(),this.objects=[],this.cleaners=[],this.doing=!1,this._pause=!1,this.queues=[],this.resolveFun=[],this.callback=(e,t)=>v(this,void 0,void 0,(function*(){if(this.doing)e.isChild&&(e.isEnd?this.queues.length=0:this.queues.push((()=>this.callback(e,t))));else{this.doing=!0;for(const e of this.objects)e.Target||t(e)&&(yield e.do());if(this.doing=!1,0<this.queues.length&&!this.Pause){this.queues.pop()()}}})),this.pointerCallback=e=>{if(this.lastClickTimeStap){var t=e.event.timeStamp-this.lastClickTimeStap;if(this.lastClickTimeStap=null,t<200&&this.preventDbTimeId)return void clearTimeout(this.preventDbTimeId)}else this.lastClickTimeStap=e.event.timeStamp;this.preventDbTimeId=setTimeout((()=>{const t=2===e.event.button;this.lastClickTimeStap=null,this.callback(e,(i=>"RightClick"===i.TriggerType&&t||"Click"===i.TriggerType&&0===e.event.button||void 0))}),200)},this.pointerDbClick=e=>v(this,void 0,void 0,(function*(){yield this.callback(e,(e=>"DoubleClick"===e.TriggerType))})),this.onKeydown=e=>v(this,void 0,void 0,(function*(){yield this.callback(e,(e=>"KeyDown"===e.TriggerType))})),this.onKeyup=e=>v(this,void 0,void 0,(function*(){yield this.callback(e,(e=>"KeyUp"===e.TriggerType))})),this.onLoad=e=>v(this,void 0,void 0,(function*(){yield U(100),yield this.callback(e,(e=>"Load"===e.TriggerType))})),this.onUpdate=e=>v(this,void 0,void 0,(function*(){yield this.callback(e,(e=>"Update"===e.TriggerType))}))}get Pause(){return this._pause}start(){if(this._pause=!1,0<this.resolveFun.length&&(this.resolveFun.forEach((e=>e(!0))),this.resolveFun.length=0),_e.MainScene.animatables.forEach((e=>e.restart())),0<this.queues.length){this.queues.pop()()}}stop(){this._pause=!0,_e.MainScene.animatables.forEach((e=>e.pause()))}wait(){return new Promise((e=>this.resolveFun.push(e)))}append(e){e._SetOwnerDatabase(this._db),this.objects.push(e)}removeAll(){this.objects.forEach((e=>e.destory())),this.objects.length=0}remove(e){let t;for(const i of t=Array.isArray(e)?e:[e])i.destory();O(this.objects,(e=>t.includes(e)))}destory(){super.destory(),this.objects.forEach((e=>e.destory())),this.objects.length=0,this.doing=!1}watch(){this.cleaners.push(le.on("pointerTap",this.pointerCallback),le.on("pointerDoubleTap",this.pointerDbClick),le.on("keydown",this.onKeydown),le.on("keyup",this.onKeyup),le.on("loadComplete",this.onLoad),le.on("update",this.onUpdate)),document.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState&&this.start(),"hidden"===document.visibilityState&&this.stop()}))}writeFile(e){super.writeFile(e),e.write(1),e.writeAnyArray(this.objects,e.writeObject)}readFile(e){super.readFile(e),e.read(),e.readAnyArrayAndPush(this.objects,e.readObject)}}let In=class extends L{constructor(){super(...arguments),this.list=[]}append(e){this.list.push(e)}do(){for(const e of this.list)e.do()}remove(e){M(this.list,e)}destory(){super.destory();for(const e of this.list)e.destory()}writeFile(e){e.write(1),e.writeAnyArray(this.list,e.writeObject)}readFile(e){e.read(),e.readAnyArrayAndPush(this.list,e.readObject)}},Dn=(In=y([S],In),class extends wn{append(e){var t=super.append(e);return t&&(e.Owner=this.ObjectId),t}readFile(e){e.read(),super.readFile(e)}writeFile(e){e.write(1),super.writeFile(e)}});Dn.type="GroupRecordTable",Dn=y([S],Dn);class Fn{constructor(e=!1){this.preview=e,this.idIndex=1,this.idMap=new Map,this.ModelSpace=(new Tn)._SetOwnerDatabase(this),this.LightSpace=(new Tn)._SetOwnerDatabase(this).setCheckout((e=>e.isLight)),this.TextureTable=(new Mn)._SetOwnerDatabase(this),this.MaterialTable=(new Mn)._SetOwnerDatabase(this),this.HistoryManager=(new Rn)._SetOwnerDatabase(this),this.InteractionTable=(new On)._SetOwnerDatabase(this),e&&this.InteractionTable.watch(),this.DataBindTable=(new In)._SetOwnerDatabase(this),this.GuiSpace=(new Tn)._SetOwnerDatabase(this),this.DomSpace=(new Tn)._SetOwnerDatabase(this),this.ParticleSystemSpace=(new Tn)._SetOwnerDatabase(this),this.GroupTable=(new Dn)._SetOwnerDatabase(this),this.idIndex=100}get AllObjects(){const e=[];for(var[t,i]of this.idMap)t<100||e.push(i.Object);return e}allocateId(){return this.getObjectId(this.idIndex++)}getObjectId(e){if(0!==e){let t=this.idMap.get(e);return t||(t=new D(e),this.idMap.set(e,t),t)}}findObjectById(e){return null==(e=this.idMap.get(e))?void 0:e.Object}findObjectByName(e,t=!0,i){var r,n;const s=[];for([,n]of(i=i||(e=>!1),this.idMap))n.isErase||null!=(r=n.Object)&&r.Name&&!i(n.Object)&&(t?n.Object.Name.includes(e)&&s.push(n.Object):n.Object.Name===e&&s.push(n.Object));return s}writeFile(e){return(e=e||new F).write(2),e.write(this.idIndex),this.ModelSpace.writeFile(e),this.LightSpace.writeFile(e),this.TextureTable.writeFile(e),this.MaterialTable.writeFile(e),this.InteractionTable.writeFile(e),this.DataBindTable.writeFile(e),this.GuiSpace.writeFile(e),this.DomSpace.writeFile(e),this.ParticleSystemSpace.writeFile(e),this.GroupTable.writeFile(e),e}readFile(e){this.destory(),this.reset(),e.database=this;var t=e.read();return this.idIndex=e.read(),this.ModelSpace.readFile(e),this.LightSpace.readFile(e),this.TextureTable.readFile(e),this.MaterialTable.readFile(e),this.InteractionTable.readFile(e),this.DataBindTable.readFile(e),this.GuiSpace.readFile(e),this.DomSpace.readFile(e),this.ParticleSystemSpace.readFile(e),1<t&&this.GroupTable.readFile(e),this.preview&&this.DataBindTable.do(),this}destory(){this.idMap.clear(),this.ModelSpace.destory(),this.LightSpace.destory(),this.TextureTable.destory(),this.MaterialTable.destory(),this.HistoryManager.destory(),this.InteractionTable.destory(),this.DataBindTable.destory(),this.GuiSpace.destory(),this.DomSpace.destory(),this.ParticleSystemSpace.destory(),this.GroupTable.destory(),this.idIndex=1}reset(){this.ModelSpace._SetOwnerDatabase(this),this.LightSpace._SetOwnerDatabase(this),this.TextureTable._SetOwnerDatabase(this),this.MaterialTable._SetOwnerDatabase(this),this.InteractionTable._SetOwnerDatabase(this),this.DataBindTable._SetOwnerDatabase(this),this.GuiSpace._SetOwnerDatabase(this),this.DomSpace._SetOwnerDatabase(this),this.ParticleSystemSpace._SetOwnerDatabase(this),this.GroupTable._SetOwnerDatabase(this),this.idIndex=100}}class Ln extends fe{constructor(){super(...arguments),this.isLight=!0,this._color="#ffffff",this.Intensity=1,this.showHelper=!0}get HasShadowGenerator(){return!!this._shadowGenerator}get Color(){return this._color}set Color(e){e!==this._color&&(this.writeSnapshoot(),this._color=e,this.update())}addShadowCaster(e){if(this._shadowGenerator)for(const t of e)if(t.EnableShadow)for(const e of t.DrawObject.getChildMeshes())this._shadowGenerator.addShadowCaster(e)}removeShadowCaster(e){if(this._shadowGenerator)if(e)for(const t of e)for(const e of t.DrawObject.getChildMeshes())this._shadowGenerator.removeShadowCaster(e);else for(const e of this._shadowGenerator.getShadowMap().renderList.slice())this._shadowGenerator.removeShadowCaster(e)}updateMaterial(){}writeFile(e){super.writeFile(e),e.write(1),e.write(this.Intensity)}readFile(e){super.readFile(e),e.read(),this.Intensity=e.read()}initShadowGenerator(e){this._shadowGenerator=new n.ShadowGenerator(1024,e),this._shadowGenerator.useExponentialShadowMap=!1,this._shadowGenerator.usePercentageCloserFiltering=!0,this._shadowGenerator.filteringQuality=n.ShadowGenerator.QUALITY_MEDIUM}}y([Lr],Ln.prototype,"Intensity",void 0);let kn=class extends Ln{constructor(){super(...arguments),this._dir=[1,1,1],this._name="\u5168\u5c40\u5149"}initDrawObject(e){var t=new n.Mesh(this.UniqueName,fe.Scene);const i=new n.HemisphericLight(this.UniqueName+"-1",n.Vector3.FromArray(this._dir),fe.Scene);return i.parent=t,i.diffuse=n.Color3.FromHexString(this.Color),t}updateDrawObject(e,t){if(t&&0!==t.getChildren().length){const e=t.getChildren()[0];e.intensity=this.Intensity,e.direction.fromArray(this._dir),e.diffuse=n.Color3.FromHexString(this.Color)}}readFile(e){super.readFile(e),this.update()}};kn.type="HemisphericLight",kn=y([S],kn);class Bn{constructor(){this.loadedActions=[],this.conditions=[],this.doing=!1,this.register()}append(e){this.conditions.push(e)}register(){le.once("loaded",(e=>{for(const e of this.loadedActions)e.do()})),le.on("update",(e=>{if(!this.doing){this.doing=!0;const e=[];for(const t of this.conditions)t.check()&&e.push(t.do());Promise.all(e).finally((()=>{this.doing=!1}))}}))}}class Nn extends zr{}let zn=class extends Nn{constructor(){super(),this._albedoColor="#ffffff",this._reflectivityColor="#000000",this._emissiveColor="#000000",this._metallic=0,this._roughness=0,this._opaticy=1,this._gloss=1,this.material=new n.PBRMaterial("pbr",_e.MainScene),this.updateMaterial()}get Material(){return this.material}set Map(e){this._albedoTexture=e.ObjectId,this.update()}set BumpMap(e){this._bumpTexture=e.ObjectId,this.update()}get Color(){return this._albedoColor}set Color(e){e!==this._albedoColor&&(this.writeSnapshoot(),this._albedoColor=e,this.updateMaterial())}get ReflectivityColor(){return this._reflectivityColor}set ReflectivityColor(e){e!==this._reflectivityColor&&(this.writeSnapshoot(),this._reflectivityColor=e,this.updateMaterial())}get EmissiveColor(){return this._emissiveColor}set EmissiveColor(e){e!==this._emissiveColor&&(this.writeSnapshoot(),this._emissiveColor=e,this.updateMaterial())}get Metallic(){return this._metallic}set Metallic(e){e!==this._metallic&&(this.writeSnapshoot(),this._metallic=e,this.updateMaterial())}get Roughness(){return this._roughness}set Roughness(e){e!==this._roughness&&(this.writeSnapshoot(),this._roughness=e,this.updateMaterial())}get Opaticy(){return this._opaticy}set Opaticy(e){e!==this._opaticy&&(this.writeSnapshoot(),this._opaticy=e,this.updateMaterial())}get Gloss(){return this._gloss}set Gloss(e){e!==this._gloss&&(this.writeSnapshoot(),this._gloss=e,this.updateMaterial())}updateMaterial(){this.material.albedoColor=H(this._albedoColor),this.material.reflectivityColor=H(this._reflectivityColor),this.material.emissiveColor=H(this._emissiveColor),this.material.alpha=this._opaticy,this.material.metallic=this._metallic,this.material.roughness=this._roughness,this.material.microSurface=this._gloss}update(){var e;null!=(e=this._albedoTexture)&&e.Object&&(e=this._albedoTexture.Object,this.material.albedoTexture=e.Texture),null!=(e=this._bumpTexture)&&e.Object&&(e=this._bumpTexture.Object,this.material.bumpTexture=e.Texture),this.updateMaterial()}writeFile(e){super.writeFile(e),e.write(1),e.write(this._albedoColor),e.write(this._reflectivityColor),e.write(this._emissiveColor),e.write(this._opaticy),e.write(this._metallic),e.write(this._roughness),e.write(this._gloss),e.writeObjectId(this._albedoTexture)}readFile(e){super.readFile(e),e.read(),this._albedoColor=e.read(),this._reflectivityColor=e.read(),this._emissiveColor=e.read(),this._opaticy=e.read(),this._metallic=e.read(),this._roughness=e.read(),this._gloss=e.read(),this._albedoTexture=e.readObjectId(),this.update()}_SetOwnerDatabase(e){return super._SetOwnerDatabase(e),this.material.name="pbr-"+this.Id,this.material.id="pbr-"+this.Id,this}},Un=(zn.type="PBRMaterialRecord",zn=y([S],zn),class extends Ur{constructor(e=""){super(),this.url=e,this.onLoad=e=>{this._isLoading=!1,this.trigger({type:"load",target:this,object:e})},this.texture=new n.Texture(e,null),this.texture.onLoadObservable.add(this.onLoad)}get Texture(){return this.texture}get Url(){return this.url}set Url(e){this.url=e,this.update()}update(){this.texture.url!==this.url&&(this._isLoading=!0,this.texture.updateURL(this.url)),this.texture.name=this._name,this.texture.wrapU=this.wrapU,this.texture.wrapV=this.wrapV,this.texture.uScale=this.scale[0],this.texture.vScale=this.scale[1],this.texture.uOffset=this.offset[0],this.texture.vOffset=this.offset[1],this.texture.uAng=Z(this.rotation[0]),this.texture.vAng=Z(this.rotation[1]),this.texture.wAng=Z(this.rotation[2])}waitUpdate(){return v(this,void 0,void 0,(function*(){return new Promise((e=>{if(!this._isLoading)return e(!0),!0;let t=setInterval((()=>{this._isLoading||(clearInterval(t),e(!0))}),1e3)}))}))}writeFile(e){super.writeFile(e),e.write(1),e.write(this.url)}readFile(e){super.readFile(e),e.read(),this.url=e.read(),this.update()}});Un=y([S],Un),n.StandardMaterial.AmbientTextureEnabled=!1,function(e){const t=new Map,i=new Map;function r(e){return n.Color3.FromArray(W[e].map((e=>e/255)))}e.getColor3=r,e.getColor4=function(e){return n.Color4.FromArray(W[e].map((e=>e/255)))},e.getColorArray=function(e){return W[e].map((e=>e/255))},e.getStandMaterial=function(e,i){if(t.has(e))return t.get(e);let s=new n.StandardMaterial("__common_color"+e,i);return s.backFaceCulling=!1,s.diffuseColor=r(e),t.set(e,s),s},e.getWireframeStandMaterial=function(e,t){if(i.has(e))return i.get(e);let s=new n.StandardMaterial("__common__wf_color"+e,t);return s.diffuseColor=r(e),s.alpha=0,i.set(e,s),s},e.clear=function(){t.clear(),i.clear()}}(Cr=Cr||{}),n.SceneLoader.ShowLoadingScreen=!1;class Gn{constructor(e){return this.EventSystem=new Bn,this.GisViwer=new l,this._IsShadow=!1,this.cleaners=[],Gn.Intance||(this.Viewer=new vn(e.canvas,!e.editor),this.Editor=new tn(this.Viewer,e.editor),e.domContainer?this._domContainer=e.domContainer:this._domContainer=e.canvas.parentElement,_e.PreviewMode=!e.editor,this.Database=new Fn(!e.editor),_e.MainViewer=this.Viewer,this._register(),this.initLight(),e.skybox&&(this.Viewer.sceneControl.Mode=e.skybox),e.cameraRadius&&(this.Viewer.cameraManager.Radius=e.cameraRadius),me.debugger=e.debug,Gn.Intance=this),Gn.Intance}get IsShadow(){return this._IsShadow}set IsShadow(e){this._IsShadow!==e&&((this._IsShadow=e)?this.openShadow():this.closeShadow())}create(e){const t=w.CreateObject(e.type,e);if(t)return e.name&&(t.Name=e.name),e.position&&(t.Position=e.position,t instanceof ye&&(t.isRead=!0)),void 0!==e.colorIndex&&(t.ColorIndex=e.colorIndex),t instanceof Ee?this.Database.GuiSpace.append(t):t instanceof ve?this.Database.DomSpace.append(t):t instanceof fe&&(t.isLight?this.Database.LightSpace:this.Database.ModelSpace).append(t),e.loading&&t.on("loading",e.loading),e.complete&&(t.isAsync?t.once("load",e.complete):e.complete({type:"load",target:t})),t}createGui(e,t){if(e=w.CreateObject(e,t))return this.Database.GuiSpace.append(e),e}createParticle(e,t){if(e=w.CreateObject(e,t))return this.Database.ParticleSystemSpace.append(e),e}createPBR(){var e=new zn;return this.Database.MaterialTable.append(e),e}createTexture(e,t){const i=new Un(e);return t&&i.once("load",t),this.Database.TextureTable.append(i),i}get SelectObjects(){return[...this.SelectEntitys,...this.SelectGuis,...this.SelectDoms,...this.SelectParticles]}get SelectEntitys(){var e;return null==(e=this.Editor)?void 0:e.selectControl.selectSet.SelectEntitys}get SelectParticles(){var e=null==(e=null==(e=this.Editor)?void 0:e.selectControl)?void 0:e.SelectParticle;return e?[e]:[]}get SelectGuis(){var e=null==(e=null==(e=this.Editor)?void 0:e.selectControl)?void 0:e.SelectGui;return e?[e]:[]}get SelectDoms(){var e=null==(e=null==(e=this.Editor)?void 0:e.selectControl)?void 0:e.SelectDOM;return e?[e]:[]}zoomAll(){this.Viewer.cameraManager.zoomAll()}changeRenderType(e){void 0!==e&&this.Database.ModelSpace.Entitys.forEach((t=>t.updateRenderType(e)))}new(e=!0){var t;null!=(t=this.Editor)&&t.transformControl&&this.Editor.transformControl.detachMeshs(),this.Viewer.reset(),this.Database.readFile((new Fn).writeFile()),this.initLight(),e&&le.trigger({type:"newFile",target:null})}saveFile(){var e=this.Database.writeFile();return this.Viewer.writeFile(e),e.Data}loadFile(e){var t;_e.StartWait(),this.Viewer.stopRender(),null!=(t=this.Editor)&&t.transformControl&&this.Editor.transformControl.detachMeshs(),ge.clear(),le.trigger({type:"startLoad",target:null}),0<me.loadPlugins.size&&(me.loadPlugins.forEach((e=>{var t;return null==(t=null==e?void 0:e.dispose)?void 0:t.call(e)})),me.loadPlugins.clear()),e?(_e.Reading=!0,t=new F(e),this.Database.readFile(t),this.Viewer.readFile(t),this.Viewer.hemisphericLight=this.Database.LightSpace.Entitys.find((e=>e instanceof kn)),_e.Reading=!1):this.new(!1),this.Viewer.render(),le.trigger({type:"loadFile",target:null}),_e.WaitComplete().then((e=>{le.trigger({type:"loadComplete",target:null})}))}destory(){this.Database.destory(),this.Viewer.destory(),Gn.Intance=null,Cr.clear(),this.cleaners.forEach((e=>e())),this.cleaners.length=0}createView(e,t){return new vn(e,!0,t)}openShadow(){var e=this.Database.LightSpace.Entitys,t=this.Database.ModelSpace.Entitys;for(const i of e)i.HasShadowGenerator&&i.addShadowCaster(t)}closeShadow(){for(const e of this.Database.LightSpace.Entitys)e.HasShadowGenerator&&e.removeShadowCaster()}on(e,t){return le.on(e,t)}off(e,t){le.off(e,t)}openGis(e){if(this.GisViwer.viewer)this.GisViwer.openViewer();else{if(!e){const t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href="/static/cesium/Widgets/widgets.css",document.head.append(t),e=document.createElement("div"),this.Viewer.canvas.parentElement.append(e),e.style.cssText="width: 100%;\n        height: 100%;\n        ",this.Viewer.canvas.style.position="absolute",this.Viewer.canvas.style.left="0",this.Viewer.canvas.style.top="0",this.Viewer.canvas.style.zIndex="1"}this.GisViwer.init(e),this.Viewer.sceneControl.Background=[0,0,0,0],this.Viewer.canvas.style.pointerEvents="none"}return this.GisViwer}closeGis(){this.GisViwer.close()}controlCanvas(e){1===e?(this.GisViwer.container.style.pointerEvents="none",this.Viewer.canvas.style.pointerEvents="auto"):2===e&&(this.GisViwer.container.style.pointerEvents="auto",this.Viewer.canvas.style.pointerEvents="none")}initLight(){var e=new kn;this.Viewer.hemisphericLight=e,this.Database.LightSpace.append(e)}_register(){const e=()=>{this.Viewer.setSize(),this.Database.DomSpace.Entitys.forEach((e=>e.update())),this.Database.GuiSpace.Entitys.forEach((e=>e.update()))};window.addEventListener("resize",e),this.cleaners.push(Ir(this.Database.ModelSpace,this.Database.ModelSpace.appendEvent,(e=>{this.Viewer.Scene.addTransformNode(e.DrawObject)})),Ir(this.Database.LightSpace,this.Database.LightSpace.appendEvent,(e=>{this.Viewer.Scene.addTransformNode(e.DrawObject),this._IsShadow&&e.EnableShadow&&e.addShadowCaster(this.Database.ModelSpace.Entitys)})),Ir(this.Database.GuiSpace,this.Database.GuiSpace.appendEvent,(e=>{this.Viewer.GuiContainer.addControl(e.DrawObject)})),Ir(this.Database.DomSpace,this.Database.DomSpace.appendEvent,(e=>{this._domContainer.appendChild(e.DrawObject)})),Ir(this.Database.ParticleSystemSpace,this.Database.ParticleSystemSpace.appendEvent,(e=>{var t=fe.Scene;fe.Scene=_e.MainScene,e.IsErase||e.Intance&&e.stop(),fe.Scene=t})),this.on("update-shadow",(e=>{var t=e.target;for(const e of this.Database.LightSpace.Entitys)e.HasShadowGenerator&&(t.EnableShadow?e.addShadowCaster([t]):e.removeShadowCaster([t]))})),this.on("remove",(()=>{this.Editor.selectControl.clearSelect(!0)})),(()=>{window.removeEventListener("resize",e)}),Ir(this.Viewer,this.Viewer.renderEvent,(()=>{this.GisViwer.render()})))}}const jn=new class{constructor(){}displayLoadingUI(){this.displayLoadingUIEvnet()}displayLoadingUIEvnet(){}hideLoadingUI(){this.hideLoadingUIEvent()}hideLoadingUIEvent(){}};class Vn{constructor(e,t=!1){this.defaultEnv=t,this.onFileLoadedObserver=new n.Observable,this.onFileProgressObserver=new n.Observable,this.onFileErrorObserver=new n.Observable,this.isRendered=!1,this.engine=new n.Engine(e,!1,{premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1}),this.engine.loadingScreen=jn,this.scene=new n.Scene(this.engine),this.scene.clearColor=new n.Color4(1,1,1,1),this.scene.createDefaultCameraOrLight(),t&&this.createDefaultEnv(),this.scene.executeWhenReady((()=>{this.engine.hideLoadingUI(),this.engine.runRenderLoop((()=>{this.scene.activeCamera&&this.scene.render()}))})),n.FilesInputStore.FilesToLoad=new Proxy(n.FilesInputStore.FilesToLoad,{get:(e,t)=>e[t],set:(e,t,i)=>(e[t]=i,!0)}),e=new n.FilesInput(this.engine,null,((e,t)=>{this.scene=t;var i=e.name.endsWith(".glb")||e.name.endsWith(".gltf");this.prepareCamera(i),t.materials.forEach((e=>{e.diffuseColor=n.Color3.White(),e.backFaceCulling=!1,e.emissiveColor=n.Color3.Black()})),this.onFileLoadedObserver.notifyObservers(e)}),(e=>{this.onFileProgressObserver.notifyObservers(e)}),(()=>{this.isRendered=!0}),(e=>{}),(e=>{}),null,((e,t,i)=>{this.onFileErrorObserver.notifyObservers({file:e,scene:t,message:i})})),this.filesInput=e}prepareCamera(e=!1){this.scene.activeCamera||this.scene.createDefaultCameraOrLight(!0,!0);const t=this.scene.activeCamera,i=(e&&(t.alpha+=Math.PI),this.defaultEnv&&this.createDefaultEnv(),t.useFramingBehavior=!0,t.getBehaviorByName("Framing"));i.framingTime=0,i.elevationReturnTime=-1,this.scene.meshes.length&&(t.lowerRadiusLimit=null,e=this.scene.getWorldExtends((function(e){return e.isVisible&&e.isEnabled()})),i.zoomOnBoundingInfo(e.min,e.max)),t.pinchPrecision=200/t.radius,t.upperRadiusLimit=5*t.radius,t.wheelDeltaPercentage=.01,t.pinchDeltaPercentage=.01,t.attachControl(),t.alpha-=Math.PI/4}loadLocalFile(e){this.isRendered=!1,this.filesInput.loadFiles(e)}loadFile(e){return v(this,void 0,void 0,(function*(){this.scene.rootNodes.forEach((e=>e.dispose())),this.isRendered=!1;const t=yield n.SceneLoader.AppendAsync(e,"",this.scene);this.scene=t,this.prepareCamera(e.endsWith("gltf")||e.endsWith("glb")),t.materials.forEach((e=>{e.diffuseColor=n.Color3.White(),e.backFaceCulling=!1,e.emissiveColor=n.Color3.Black()})),this.isRendered=!0}))}getPreviewUrl(e=400){return v(this,void 0,void 0,(function*(){return yield this.waitRendered(),n.Tools.CreateScreenshotAsync(this.engine,this.scene.activeCamera,e)}))}getBlob(){return v(this,void 0,void 0,(function*(){return this.scene.clearColor=new n.Color4(1,1,1,1),yield this.waitRendered(),G(yield this.getPreviewUrl())}))}waitRendered(){return v(this,void 0,void 0,(function*(){return new Promise((e=>{let t=setInterval((()=>{this.isRendered&&(clearInterval(t),e(null))}),100)}))}))}onLoaded(e){const t=this.onFileLoadedObserver.add(e);return()=>{this.onFileLoadedObserver.remove(t)}}onError(e){const t=this.onFileErrorObserver.add(e);return()=>{this.onFileErrorObserver.remove(t)}}onProgress(e){const t=this.onFileProgressObserver.add(e);return()=>{this.onFileProgressObserver.remove(t)}}destory(){this.filesInput.dispose(),this.onFileLoadedObserver.clear(),this.engine.dispose()}createDefaultEnv(){this.scene.environmentTexture=dn.LoadSkyboxPathTexture(this.scene),this.scene.activeCamera&&this.scene.createDefaultSkybox(this.scene.environmentTexture,!0,1e4,.3,!1)}}class Zn extends fe{constructor(){super()}get VertextData(){return null}initDrawObject(e=u.Conceptual){const t=new n.Mesh(this.UniqueName,fe.Scene);return this.VertextData.applyToMesh(t),e===u.Wireframe&&(t.enableEdgesRendering(),t.edgesColor=n.Color4.FromArray(W[this.ColorIndex])),this.updateMaterial(e,t),t.receiveShadows=!0,t}updateDrawObject(e,t){t&&t.geometry.setAllVerticesData(this.VertextData)}updateMaterial(e,t){const i=null!=t?t:this.RenderObject;switch(null!=e?e:this.RenderType){case u.Wireframe:i.material=Cr.getWireframeStandMaterial(this._colorIndex,fe.Scene);break;case u.Conceptual:var r=Cr.getStandMaterial(this.ColorIndex,fe.Scene);i.material=r;break;case u.Physical:this.Material&&(i.material=this.Material.Material)}this.defaultMaterial||(this.defaultMaterial=i.material),this._standardMaterial&&(i.material=this._standardMaterial),i.material&&(i.material.alpha=this._opacity)}}Zn.VertexDataCache=new Map;let Wn=wr=class extends Zn{constructor(e={width:10,height:10,depth:10,center:Q.Center}){var t;super(),this.width=10,this.height=10,this.depth=10,this._center=Q.Center,this.width=null!=(t=e.width)?t:this.width,this.height=null!=(t=e.height)?t:this.height,this.depth=null!=(t=e.depth)?t:this.depth,this._center=null!=(t=e.center)?t:Q.Center}get Width(){return this.width}set Width(e){e!==this.width&&(this.writeSnapshoot(),this.width=e,this.update())}get Height(){return this.height}set Height(e){e!==this.height&&(this.writeSnapshoot(),this.height=e,this.update())}get Depth(){return this.depth}set Depth(e){e!==this.depth&&(this.writeSnapshoot(),this.depth=e,this.update())}get CenterPosition(){return this._center}set CenterPosition(e){e!==this.depth&&(this.writeSnapshoot(),this._center=e,this.update())}get TranslateMtx(){let[e,t,i]=[0,0,0];switch(this._center){case Q.Center:break;case Q.Bottom:i=this.depth/2;break;case Q.Top:i=-this.depth/2;break;case Q.Left:e=this.width/2;break;case Q.Right:e=-this.width/2;break;case Q.Front:t=-this.Height/2;break;case Q.Back:t=this.Height/2;break;case Q.LFB:[e,t,i]=[this.width/2,this.height/2,this.depth/2];break;case Q.RFB:[e,t,i]=[-this.width/2,this.height/2,this.depth/2];break;case Q.LBB:[e,t,i]=[this.width/2,-this.height/2,this.depth/2];break;case Q.RBB:[e,t,i]=[-this.width/2,-this.height/2,this.depth/2]}return n.Matrix.Translation(e,t,i)}get VertextData(){var e=`${this.width}-${this.height}-${this.depth}-`+this._center;let t=wr.VertexDataCache.get(e);return t||((t=(0,n.CreateBoxVertexData)({width:this.width,height:this.height,depth:this.depth})).transform(this.TranslateMtx),wr.VertexDataCache.set(e,t)),t}writeFile(e){super.writeFile(e),e.write(1),e.write(this.width),e.write(this.height),e.write(this.depth),e.write(this._center)}readFile(e){super.readFile(e),e.read(),this.width=e.read(),this.height=e.read(),this.depth=e.read(),this._center=e.read(),this.update()}};Wn.type="Box",Wn=wr=y([S],Wn);class Hn extends fe{updateMaterial(){this.RenderObject.color=Cr.getColor3(this.ColorIndex)}}let Kn=class extends Hn{constructor(e={points:[[0,0,0],[.1,0,0]]}){super(),this.points=[],this.points=null!=(e=e.points)?e:[[0,0,0],[.1,0,0]]}get Points(){return this.points.map((e=>({x:e[0],y:e[1],z:e[2]})))}initDrawObject(e){return n.MeshBuilder.CreateLines("line"+this.Id,{points:this.points.map((e=>n.Vector3.FromArray(e)))},fe.Scene)}writeFile(e){super.writeFile(e),e.write(1),e.write(this.points.length);for(const t of this.points)e.writeArray(t)}readFile(e){super.readFile(e),e.read();var t=e.read();for(let i=this.points.length=0;i<t;i++)this.points.push(e.readArray(e.read()));this.update()}},qn=(Kn.type="Lines",Kn=y([S],Kn),class extends Zn{constructor(e={diameter:1,arc:1}){var t;super(),this.diameter=10,this.arc=10,this.diameter=null!=(t=e.diameter)?t:this.diameter,this.arc=null!=(t=e.arc)?t:this.arc}get Diameter(){return this.diameter}set Diameter(e){e!==this.diameter&&(this.writeSnapshoot(),this.diameter=e,this.update())}get VertextData(){return(0,n.CreateSphereVertexData)({diameter:this.diameter,arc:this.arc})}writeFile(e){super.writeFile(e),e.write(1),e.write(this.diameter),e.write(this.arc)}readFile(e){super.readFile(e),e.read(),this.diameter=e.read(),this.arc=e.read(),this.update()}}),Xn=(qn.type="Sphere",qn=y([S],qn),class extends Zn{constructor(e={diameterTop:10,diameterBottom:10,height:10,arc:10}){var t;super(),this.diameterTop=10,this.diameterBottom=10,this.height=10,this.tessellation=void 0,this.arc=10,this.diameterTop=null!=(t=e.diameterTop)?t:10,this.diameterBottom=null!=(t=e.diameterBottom)?t:10,this.height=null!=(t=e.height)?t:10,this.arc=null!=(t=e.arc)?t:10}get DiameterTop(){return this.diameterTop}set DiameterTop(e){e!==this.diameterTop&&(this.writeSnapshoot(),this.diameterTop=e,this.update())}get DiameterBottom(){return this.diameterBottom}set DiameterBottom(e){e!==this.diameterBottom&&(this.writeSnapshoot(),this.diameterBottom=e,this.update())}get Height(){return this.height}set Height(e){e!==this.height&&(this.writeSnapshoot(),this.height=e,this.update())}get Tessellation(){return this.tessellation}set Tessellation(e){e!==this.tessellation&&(this.writeSnapshoot(),this.tessellation=e,this.update())}get VertextData(){return(0,n.CreateCylinderVertexData)({diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,height:this.height,arc:this.arc,tessellation:this.tessellation})}writeFile(e){super.writeFile(e),e.write(1),e.write(this.diameterTop),e.write(this.diameterBottom),e.write(this.height),e.write(this.tessellation),e.write(this.arc)}readFile(e){super.readFile(e),e.read(),this.diameterTop=e.read(),this.diameterBottom=e.read(),this.height=e.read(),this.tessellation=e.read(),this.arc=e.read(),this.update()}}),Yn=(Xn.type="Cylinder",Xn=y([S],Xn),class extends Zn{constructor(e){var t;super(),this.width=10,this.height=10,this.width=null!=(t=null==e?void 0:e.width)?t:this.width,this.height=null!=(t=null==e?void 0:e.height)?t:this.height}get Width(){return this.width}set Width(e){e!==this.width&&(this.writeSnapshoot(),this.width=e,this.update())}get Height(){return this.height}set Height(e){e!==this.height&&(this.writeSnapshoot(),this.height=e,this.update())}get VertextData(){return(0,n.CreatePlaneVertexData)({width:this.width,height:this.height})}writeFile(e){super.writeFile(e),e.write(1),e.write(this.width),e.write(this.height)}readFile(e){super.readFile(e),e.read(),this.width=e.read(),this.height=e.read(),this.update()}}),Qn=(Yn.type="Plane",Yn=y([S],Yn),class extends Zn{constructor(e={radius:1,radiusTop:void 0,radiusBottom:void 0,height:1,subdivisions:2,tessellation:2,capSubdivisions:6}){var t;super(),this.subdivisions=20,this.tessellation=16,this.capSubdivisions=6,this.height=null!=(t=e.height)?t:20,this.radius=null!=(t=e.radius)?t:5,this.subdivisions=null!=(t=e.subdivisions)?t:2,this.tessellation=null!=(t=e.tessellation)?t:16,this.capSubdivisions=null!=(t=e.capSubdivisions)?t:6,this.radiusTop=e.radiusTop,this.radiusBottom=e.radiusBottom,this.topCapSubdivisions=e.topCapSubdivisions,this.bottomCapSubdivisions=e.bottomCapSubdivisions}get Radius(){return this.radius}set Radius(e){e!==this.radius&&(this.writeSnapshoot(),this.radius=e,this.update())}get RadiusTop(){return this.radiusTop}set RadiusTop(e){e!==this.radiusTop&&(this.writeSnapshoot(),this.radiusTop=e,this.update())}get RadiusBottom(){return this.radiusBottom}set RadiusBottom(e){e!==this.radiusBottom&&(this.writeSnapshoot(),this.radiusBottom=e,this.update())}get CapSubdivisions(){return this.capSubdivisions}set CapSubdivisions(e){e!==this.capSubdivisions&&(this.writeSnapshoot(),this.capSubdivisions=e,this.update())}get TopCapSubdivisions(){return this.topCapSubdivisions}set TopCapSubdivisions(e){e!==this.topCapSubdivisions&&(this.writeSnapshoot(),this.topCapSubdivisions=e,this.update())}get BottomCapSubdivisions(){return this.bottomCapSubdivisions}set BottomCapSubdivisions(e){e!==this.bottomCapSubdivisions&&(this.writeSnapshoot(),this.bottomCapSubdivisions=e,this.update())}get Height(){return this.height}set Height(e){e!==this.height&&(this.writeSnapshoot(),this.height=e,this.update())}get Subdivisions(){return this.subdivisions}set Subdivisions(e){e!==this.subdivisions&&(this.writeSnapshoot(),this.subdivisions=e,this.update())}get Tessellation(){return this.tessellation}set Tessellation(e){e!==this.tessellation&&(this.writeSnapshoot(),this.tessellation=e,this.update())}get VertextData(){return(0,n.CreateCapsuleVertexData)({radius:this.radius,radiusTop:this.radiusTop,radiusBottom:this.radiusBottom,height:this.height,subdivisions:this.subdivisions,tessellation:this.tessellation,capSubdivisions:this.capSubdivisions,topCapSubdivisions:this.topCapSubdivisions,bottomCapSubdivisions:this.bottomCapSubdivisions})}writeFile(e){super.writeFile(e),e.write(1),e.write(this.radius),e.write(this.height),e.write(this.subdivisions),e.write(this.tessellation),e.write(this.capSubdivisions),e.write(this.radiusTop),e.write(this.radiusBottom),e.write(this.topCapSubdivisions),e.write(this.bottomCapSubdivisions)}readFile(e){super.readFile(e),e.read(),this.radius=e.read(),this.height=e.read(),this.subdivisions=e.read(),this.tessellation=e.read(),this.capSubdivisions=e.read(),this.radiusTop=e.read(),this.radiusBottom=e.read(),this.topCapSubdivisions=e.read(),this.bottomCapSubdivisions=e.read(),this.update()}}),$n=(Qn.type="Capsule",Qn=y([S],Qn),class extends Zn{constructor(e={diameter:1,tessellation:2,thickness:.1}){var t;super(),this.diameter=1,this.thickness=.1,this.diameter=null!=(t=e.diameter)?t:1,this.tessellation=null!=(t=e.tessellation)?t:32,this.thickness=null!=(t=e.thickness)?t:.1}get Diameter(){return this.diameter}set Diameter(e){e!==this.diameter&&(this.writeSnapshoot(),this.diameter=e,this.update())}get Tthickness(){return this.thickness}set Tthickness(e){e!==this.thickness&&(this.writeSnapshoot(),this.thickness=e,this.update())}get Tessellation(){return this.tessellation}set Tessellation(e){e!==this.tessellation&&(this.writeSnapshoot(),this.tessellation=e,this.update())}get VertextData(){return(0,n.CreateTorusVertexData)({diameter:this.diameter,tessellation:this.tessellation,thickness:this.thickness})}writeFile(e){super.writeFile(e),e.write(1),e.write(this.diameter),e.write(this.thickness),e.write(this.tessellation)}readFile(e){super.readFile(e),e.read(),this.diameter=e.read(),this.thickness=e.read(),this.tessellation=e.read(),this.update()}}),Jn=($n.type="Torus",$n=y([S],$n),class extends Zn{constructor(e){var t;super(),this.width=10,this.height=10,this.width=null!=(t=null==e?void 0:e.width)?t:this.width,this.height=null!=(t=null==e?void 0:e.height)?t:this.height}get Width(){return this.width}set Width(e){e!==this.width&&(this.writeSnapshoot(),this.width=e,this.update())}get Height(){return this.height}set Height(e){e!==this.height&&(this.writeSnapshoot(),this.height=e,this.update())}get VertextData(){return(0,n.CreateGroundVertexData)({width:this.width,height:this.height})}writeFile(e){super.writeFile(e),e.write(1),e.write(this.width),e.write(this.height)}readFile(e){super.readFile(e),e.read(),this.width=e.read(),this.height=e.read(),this.update()}}),es=(Jn.type="Ground",Jn=y([S],Jn),class extends Ln{constructor(){super(...arguments),this._colorIndex=2,this._name="\u70b9\u5149\u6e90",this.Range=100}initDrawObject(e=u.Conceptual){var t=new n.Mesh(this.UniqueName+"_root",fe.Scene);const i=n.MeshBuilder.CreateSphere("root_"+this.UniqueName,{diameter:.1},fe.Scene),r=new n.StandardMaterial("point-light",fe.Scene),s=(r.emissiveColor=Cr.getColor3(this.ColorIndex),i.material=r,new n.PointLight(this.UniqueName,n.Vector3.Zero(),fe.Scene));return s.diffuse=Cr.getColor3(this.ColorIndex),s.intensity=this.Intensity,s.range=this.Range,s.parent=t,i.parent=t,i.setEnabled(this.showHelper),this.initShadowGenerator(s),t}updateDrawObject(e,t){if(t&&0!==t.getChildren().length){const e=t.getChildren()[0];e.intensity=this.Intensity,e.range=this.Range}}writeFile(e){super.writeFile(e),e.write(1),e.write(this.Range)}readFile(e){super.readFile(e),e.read(),this.Range=e.read(),this.update()}}),ts=(es.type="PointLight",y([Lr],es.prototype,"Range",void 0),es=y([S],es),class extends Ln{constructor(){super(...arguments),this._angle=Math.PI/3,this._dir=[-1,-1,-1],this._colorIndex=2,this._name="\u5c04\u706f",this.Range=100}initDrawObject(){var e=new n.Mesh(this.UniqueName+"_root",fe.Scene);const t=n.CylinderBuilder.CreateCylinder(this.UniqueName+"_cy",{diameterTop:0,diameterBottom:.2,height:.4},fe.Scene);t.setEnabled(this.showHelper);var i=n.Matrix.RotationAxis(n.Vector3.Right(),-Math.PI/2);t.bakeTransformIntoVertices(i);const r=new n.SpotLight(this.UniqueName,n.Vector3.Zero(),n.Vector3.FromArray(this._dir).normalize(),this._angle,2,fe.Scene);return r.parent=e,t.parent=e,r.diffuse=Cr.getColor3(this.ColorIndex),r.intensity=this.Intensity,r.range=this.Range,this.initShadowGenerator(r),e}updateDrawObject(e,t){if(t&&2===t.getChildren().length){const e=(t=t.getChildren())[0],i=(e.intensity=this.Intensity,e.range=this.Range,t[1]),r=new n.StandardMaterial(this.UniqueName+"_mtl",fe.Scene);t=((i.material=r).wireframe=!0,ne(this.Position)).add(n.Vector3.FromArray(this._dir)),i.lookAt(t,0,0,0,n.Space.WORLD)}}}),is=(ts.type="SpotLight",y([Lr],ts.prototype,"Range",void 0),ts=y([S],ts),class extends Ln{constructor(){super(...arguments),this._dir=[-1,-1,-1],this._colorIndex=7,this._name="\u65b9\u5411\u5149"}initDrawObject(){var e=new n.Mesh(this.UniqueName+"_root",fe.Scene);const t=new n.DirectionalLight(this.UniqueName,n.Vector3.FromArray(this._dir),fe.Scene);return t.parent=e,t.diffuse=Cr.getColor3(this._colorIndex),this.initShadowGenerator(t),e}});is.type="DirectionalLight",is=y([S],is);class rs{constructor(){this.noHistory=!0}exec(){Gn.Intance.Database.HistoryManager.undo()}}class ns{constructor(){this.noHistory=!0}exec(){Gn.Intance.Database.HistoryManager.redo()}}class ss{constructor(){this.CommandMap=new Map,this._CommandNameList=new Set,this.doing=!1}ExecCommand(e){return v(this,void 0,void 0,(function*(){if(this.CommandMap.has(e)){let t=this.CommandMap.get(e);if(!this.doing){this.CommandStart(e,t.noHistory);try{yield t.exec()}catch(e){le.trigger({type:"error",target:null,error:e})}yield this.CommandEnd(t.noHistory)}}}))}RegisterCommand(e,t){e=e.toUpperCase(),this.CommandMap.set(e,t),this._CommandNameList.add(e)}RemoveCommand(e){e&&(e=e.toUpperCase(),this.CommandMap.delete(e),this._CommandNameList.delete(e))}CommandStart(e,t=!1){return!this.doing&&(this.LastCmd=e,this.doing=!0,t||Gn.Intance.Database.HistoryManager.startCmd(e),!0)}CommandEnd(e=!1){return v(this,void 0,void 0,(function*(){this.doing=!1,e||Gn.Intance.Database.HistoryManager.endCmd()}))}get CommandNameList(){return this._CommandNameList}}const as=new ss;var os=Object.freeze({__proto__:null,registerCommand:function(e=[]){as.RegisterCommand("undo",new rs),as.RegisterCommand("redo",new ns);for(const t of e)as.RegisterCommand(t[0],t[1])},CommandManager:ss,commandManager:as,CommandWrap:function(e,t=""){return v(this,void 0,void 0,(function*(){if(as.CommandStart(t)){let t=!0;try{var i=yield e();t="boolean"==typeof i&&i}catch(e){}yield as.CommandEnd(t)}}))}});class ls extends Nn{}class hs extends class{constructor(){this.actions=[]}check(){return!1}addAction(e){this.actions.push(e)}do(){return v(this,void 0,void 0,(function*(){for(const e of this.actions)yield e.do()}))}}{constructor(){super(...arguments),this.conditionType=$.Equal}static Create(e={entity:null}){const t=new hs;return t.entity=e.entity,e.type&&(t.conditionType=e.type),t.propertyKey=e.key,t.target=e.target,t}check(){if(null==(i=this.entity)||!i.Object||!this.propertyKey)return!1;var e=this.entity.Object;let t=e;for(const i of this.propertyKey.split("/"))t=e[i];var i=t;return this.compare(i,this.target,this.conditionType)}compare(e,t,i){switch(typeof e!=typeof t&&(t=i===$.Equal?(e=String(e),String(t)):(e=Number(e),Number(t))),i){case $.Equal:return e===t;case $.Greater:return t<e;case $.Less:return e<t;case $.GreEqu:return t<=e;case $.LessEqu:return e<=t;default:return!1}}}class cs extends class{do(){}}{constructor(e=[],t={x:0,y:0,z:0}){super(),this.entitys=e,this.target=t,this.animateType="",this.isOffset=!0,this.time=1}do(){const e=[];for(const t of this.entitys){const i=t.Object;e.push(i.moveTo(this.target,this.isOffset,{time:1}))}return Promise.all(e)}}let us=class extends Nr{constructor(){super(...arguments),this.data={type:"url",value:"",target:"_blank"}}do(){switch(this.data.type){case"url":this.openUrl(this.data.value);break;case"file":this.openUrl(V(location.href,"id",this.data.value)+"&time="+Date.now());break;case"back":history.back();break;case"reload":location.reload()}return!0}readFile(e){e.read(),this.data=JSON.parse(e.read())}writeFile(e){e.write(1),e.write(JSON.stringify(this.data))}toJSON(){return Object.assign({},this.data)}fromJSON(e){Object.assign(this.data,e)}openUrl(e){var t="OpenWidgetHref";let i=document.getElementById(t);i||(i=document.createElement("a"),document.body.appendChild(i),i.setAttribute("id",t)),i.setAttribute("target",this.data.target),i.setAttribute("href",e),i.click()}},ds=(us.type="Open",us.schema={label:"\u6253\u5f00\u94fe\u63a5"},us=y([S],us),class extends Nr{constructor(){super(...arguments),this._list=[]}get List(){return[...this._list]}do(){return v(this,void 0,void 0,(function*(){const e=[];for(const t of this._list){const i=t.objectId.Object;i&&e.push(i.moveTo(t.target,t.type===J.Offset,{time:t.time,startTime:this.startTime}))}return Promise.all(e).then((e=>!0))}))}add(e){this._list.push(e)}fromJSON(e){this._list.length=0;for(const t of e)this._list.push({objectId:t.objectId,time:t.time,target:t.target,type:t.type,animationType:t.animationType})}readFile(e){e.read();var t=e.read();for(let i=this._list.length=0;i<t;i++){const t={target:{x:0,y:0,z:0}};t.objectId=e.readObjectId(),t.type=e.read(),t.target.x=e.read(),t.target.y=e.read(),t.target.z=e.read(),t.time=e.read(),t.animationType=e.read(),this._list.push(t)}}writeFile(e){e.write(1),e.write(this._list.length);for(const t of this._list)e.writeObjectId(t.objectId),e.write(t.type),e.write(t.target.x),e.write(t.target.y),e.write(t.target.z),e.write(t.time),e.write(t.animationType)}});ds.type="Move",ds.schema={label:"\u79fb\u52a8"},ds=y([S],ds);const ps=eval;function fs(e,t){if(!e)return 0;let i="";if(t)for(var r in t)i+=`let ${r} = ${t[r]};`;i+=e;let n=ps(i);return"function"==typeof n?n():Number(n)}let ms=class extends Nr{constructor(){super(...arguments),this._List=[]}get List(){return[...this._List]}do(){return v(this,void 0,void 0,(function*(){const e=[];for(const r of this._List){const n=r.objectId.Object;var t,i;n&&(t={x:(t=n.BoundingBox.extendSize.scale(2)).x,X:t.x,y:t.y,Y:t.y,z:t.z,Z:t.z},t={x:fs(r.pivot.x,t),y:fs(r.pivot.y,t),z:fs(r.pivot.z,t)},i={x:parseFloat(r.axis.x)||0,y:parseFloat(r.axis.y)||0,z:parseFloat(r.axis.z)||0},e.push(n.rotateTo({angle:0===r.dir?-1*r.angle:r.angle,time:r.time,isOffset:r.type===J.Offset,animation:!0,pivot:t,startTime:this.startTime,dir:i})))}return Promise.all(e).then((e=>!0))}))}add(e){this._List.push(e)}fromJSON(e){this._List.length=0;for(const t of e)this._List.push({objectId:t.objectId,time:t.time,angle:t.angle,type:t.type,animationType:t.animationType,dir:t.dir,pivot:t.pivot,axis:t.axis})}readFile(e){var t=e.read(),i=e.read();for(let r=this._List.length=0;r<i;r++){const i={pivot:{x:"",y:"",z:""},axis:{x:"0",y:"1",z:"0"}};i.objectId=e.readObjectId(),i.type=e.read(),i.time=e.read(),i.animationType=e.read(),i.angle=e.read(),i.dir=e.read(),i.pivot.x=e.read(),i.pivot.y=e.read(),i.pivot.z=e.read(),1<t&&(i.axis.x=e.read(),i.axis.y=e.read(),i.axis.z=e.read()),this._List.push(i)}}writeFile(e){e.write(2),e.write(this._List.length);for(const t of this._List)e.writeObjectId(t.objectId),e.write(t.type),e.write(t.time),e.write(t.animationType),e.write(t.angle),e.write(t.dir),e.write(t.pivot.x),e.write(t.pivot.y),e.write(t.pivot.z),e.write(t.axis.x),e.write(t.axis.y),e.write(t.axis.z)}},_s=(ms.type="Rotate",ms.schema={label:"\u65cb\u8f6c"},ms=y([S],ms),class extends Nr{constructor(){super(...arguments),this.List=[]}do(){return v(this,void 0,void 0,(function*(){for(const e of this.List){const{type:t,objectId:i}=e;switch(t){case"Show":i.Object.Visiable=!0;break;case"Hidden":i.Object.Visiable=!1;break;case"Toggle":i.Object.Visiable=!i.Object.Visiable}}return!0}))}fromJSON(e){this.List=e}readFile(e){e.read(),this.List.length=0,e.readAnyArray((()=>{const t={};t.type=e.read(),t.objectId=e.readObjectId(),this.List.push(t)}))}writeFile(e){e.write(1),e.writeAnyArray(this.List,(t=>{e.write(t.type),e.writeObjectId(t.objectId)}))}}),gs=(_s.type="Display",_s.schema={label:"\u663e\u793a/\u9690\u85cf"},_s=y([S],_s),class extends Nr{constructor(){super(...arguments),this._List=[]}get List(){return[...this._List]}do(){return v(this,void 0,void 0,(function*(){const e=[];for(const s of this._List){const a=s.objectId.Object;if(a){let o,l,h;var t=a.BoundingBox.extendSize.scale(2),i=s.bySize?a.BoundingBox.extendSizeWorld.scale(2):a.Scale,r={x:i.x,X:i.x,y:i.y,Y:i.y,z:i.z,Z:i.z};t={x:t.x,X:t.x,y:t.y,Y:t.y,z:t.z,Z:t.z},r=(o=fs(s.scale.x,r),l=fs(s.scale.y,r),h=fs(s.scale.z,r),s.bySize&&(o/=i.x,l/=i.y,h/=i.z),{x:fs(s.pivot.x,t),y:fs(s.pivot.y,t),z:fs(s.pivot.z,t)});e.push(a.scaleTo({scale:new n.Vector3(o,l,h),time:s.time,animation:!0,isOffset:s.bySize,pivot:r,startTime:this.startTime}))}}return Promise.all(e).then((e=>!0))}))}add(e){this._List.push(e)}toJSON(){return{}}fromJSON(e){this._List.length=0;for(const t of e)this._List.push(Object.assign({},t))}readFile(e){e.read(),this._List.length=0,e.readAnyArray((()=>{const t={scale:{x:"1",y:"1",z:"1"},pivot:{x:"x/2",y:"y/2",z:"z/2"}};t.objectId=e.readObjectId(),t.scale.x=e.read(),t.scale.y=e.read(),t.scale.z=e.read(),t.pivot.x=e.read(),t.pivot.y=e.read(),t.pivot.z=e.read(),t.type=e.read(),t.time=e.read(),t.animationType=e.read(),t.bySize=e.read(),this._List.push(t)}))}writeFile(e){e.write(1),e.writeAnyArray(this._List,(t=>{e.writeObjectId(t.objectId),e.write(t.scale.x),e.write(t.scale.y),e.write(t.scale.z),e.write(t.pivot.x),e.write(t.pivot.y),e.write(t.pivot.z),e.write(t.type),e.write(t.time),e.write(t.animationType),e.write(t.bySize)}))}}),ys=(gs.type="Scale",gs.schema={label:"\u7f29\u653e"},gs=y([S],gs),class extends Nr{constructor(){super(),this.current=!1,this._target={x:void 0,y:void 0,z:void 0},this._time=1e3}do(){return v(this,void 0,void 0,(function*(){const e=_e.MainViewer.cameraManager.Control.moveTo({alpha:this._alpha,beta:this._beta,target:this._target,radius:this._radius,time:this._time});return yield e.start(),!0}))}fromJSON(e){var t;this._alpha=null!=(t=e.alpha)?t:this._alpha,this._beta=null!=(t=e.beta)?t:this._beta,this._radius=null!=(t=e.radius)?t:this._radius,this._target=null!=(t=e.target)?t:this._target,this._time=null!=(t=e.time)?t:this._time}readFile(e){e.read(),this._alpha=e.read(),this._beta=e.read(),this._radius=e.read(),this._target.x=e.read(),this._target.y=e.read(),this._target.z=e.read(),this._time=e.read()}writeFile(e){e.write(1),e.write(this._alpha),e.write(this._beta),e.write(this._radius),e.write(this._target.x),e.write(this._target.y),e.write(this._target.z),e.write(this._time)}}),vs=(ys.type="MoveCamera",ys.schema={label:"\u79fb\u52a8\u76f8\u673a\u5230"},ys=y([S],ys),class extends Nr{constructor(){super(...arguments),this.list=[]}get List(){return[...this.list]}do(){for(const t of this.list){const i=_e.GlobalVariables.find((e=>e.key===t.key));var e;i&&("value"===t.value.type?i.value=t.value.value:"param"===t.value.type?(e=_e.GlobalVariables.find((e=>e.key===t.value.value)),i.value=e.value):"entity"===t.value.type&&(i.value=t.value.value.Object[t.value.entityKey]))}return localStorage.setItem("variables",JSON.stringify(_e.GlobalVariables)),!0}add(e){this.list.push(e)}fromJSON(e){this.list=e}readFile(e){e.read(),this.list.length=0,e.readAnyArray((()=>{const t={key:"",value:{type:null,value:null}};t.key=e.read(),e.readWidgetValue(t.value),this.list.push(t)}))}writeFile(e){e.write(1),e.writeAnyArray(this.list,(t=>{e.write(t.key),e.writeWidgetValue(t.value)}))}}),bs=(vs.type="SetVariable",vs.schema={label:"\u8bbe\u7f6e\u53d8\u91cf\u503c"},vs=y([S],vs),class extends Nr{constructor(){super(...arguments),this._time=1e3}do(){return new Promise((e=>setTimeout(e,this._time)))}fromJSON(e){this._time=e.time}readFile(e){e.read(),this._time=e.read()}writeFile(e){e.write(1),e.write(this._time)}}),Es=(bs.type="Wait",bs.schema={label:"\u7b49\u5f85"},bs=y([S],bs),class extends Nr{constructor(){super(),this._list=[]}get List(){return[...this._list]}do(){return v(this,void 0,void 0,(function*(){for(const e of this._list)switch(e.type){case"select":e.objectId.Object.IsSelect=!0;break;case"unSelect":e.objectId.Object.IsSelect=!1;break;case"toggle":e.objectId.Object.IsSelect=!e.objectId.Object.IsSelect}return!0}))}fromJSON(e){this._list.length=0;for(const t of e)t.type&&t.objectId&&this._list.push({type:t.type,objectId:t.objectId});return this}readFile(e){e.read(),this._list.length=0,e.readAnyArray((()=>{const t={type:"",objectId:null};t.type=e.read(),t.objectId=e.readObjectId(),this._list.push(t)}))}writeFile(e){e.write(1),e.writeAnyArray(this._list,(t=>{e.write(t.type),e.writeObjectId(t.objectId)}))}}),xs=(Es.type="Select",Es.schema={label:"\u8bbe\u7f6e\u9009\u4e2d"},Es=y([S],Es),class extends Nr{do(){return!0}readFile(e){e.read()}writeFile(e){e.write(1)}}),Cs=(xs.type="DataFeedback",xs.schema={label:"\u6570\u636e\u53cd\u9988"},xs=y([S],xs),class extends Nr{constructor(){super(...arguments),this._list=[]}get List(){return[...this._list]}do(){return v(this,void 0,void 0,(function*(){for(const e of this._list){e.objectId.Object.highlight(e.color)}return!0}))}fromJSON(e){this._list=e}readFile(e){e.read(),this._list.length=0,e.readAnyArray((()=>{const t={color:"",objectId:null};t.color=e.read(),t.objectId=e.readObjectId(),this._list.push(t)}))}writeFile(e){e.write(1),e.writeAnyArray(this._list,(t=>{e.write(t.color),e.writeObjectId(t.objectId)}))}});function ws(e,t=[]){if(e)return"value"===e.type?e.value:"param"===e.type?null==(t=t.find((t=>t.key===e.value)))?void 0:t.value:"entity"===e.type?(e.entityKey,null==(t=null==(t=e.value)?void 0:t.Object)?void 0:t[e.entityKey]):void 0}function Ss(e){return"RightClick"===e||"Click"===e?"pointerPick":"Load"===e?"load":e}Cs.type="Highlight",Cs.schema={label:"\u663e\u793a\u9ad8\u4eae\u8fb9\u6846"},Cs=y([S],Cs);let Ts=class extends Nr{constructor(){super(...arguments),this._list=[]}get List(){return[...this._list]}do(){var e;for(const t of this._list){const i=null==(e=t.objectId)?void 0:e.Object;i?t.triggerNames.forEach((e=>{e=Object.assign(Object.assign({},this.getTriggerEvent(e)),{type:Ss(e),target:i}),i.trigger(e)})):t.triggerNames.forEach((e=>{e=this.getTriggerEvent(e),le.trigger(e)}))}return!0}fromJSON(e){this._list=e}readFile(e){e.read(),this._list.length=0,e.readAnyArray((()=>{let t={triggerNames:[],objectId:null};e.readAnyArrayAndPush(t.triggerNames,e.read),t.objectId=e.readObjectId(),this._list.push(t)}))}writeFile(e){e.write(1),e.writeAnyArray(this._list,(t=>{e.writeAnyArray(t.triggerNames,e.write),e.writeObjectId(t.objectId)}))}getTriggerEvent(e,t){switch(e){case"Click":case"DoubleClick":return{type:"pointerDown",event:{button:0},isChild:!0,target:t};case"RightClick":return{type:"pointerDown",event:{button:2},isChild:!0,isEnd:!0,target:t};case"Load":return{type:"loadFile",isChild:!0,target:t};default:return{type:e,target:t,isChild:!0}}}},Ps=(Ts.type="Dispatch",Ts.schema={label:"\u89e6\u53d1\u4e8b\u4ef6"},Ts=y([S],Ts),class extends Nr{constructor(){super(...arguments),this.List=[]}do(){var e;return v(this,void 0,void 0,(function*(){const t=[];for(const i of this.List){const r=null==(e=i.objectId)?void 0:e.Object;r&&t.push(r.opacityTo(Object.assign(Object.assign({},i),{startTime:this.startTime})))}return Promise.all(t)}))}fromJSON(e){this.List=e}readFile(e){e.read(),this.List.length=0,e.readAnyArray((()=>{const t={};t.opacity=e.read(),t.time=e.read(),t.animationType=e.read(),t.objectId=e.readObjectId(),this.List.push(t)}))}writeFile(e){e.write(1),e.writeAnyArray(this.List,(t=>{e.write(t.opacity),e.write(t.time),e.write(t.animationType),e.writeObjectId(t.objectId)}))}}),As=(Ps.type="Opacity",Ps.schema={label:"\u8bbe\u7f6e\u4e0d\u900f\u660e"},Ps=y([S],Ps),class extends L{constructor(e,t=null){super(),this._triggerType=e,this.target=t,this.list=[],this._cleaners=[],this.watch()}get TriggerType(){return this._triggerType}get List(){return[...this.list]}set List(e){this.list=e}get Target(){return this.target}do(){return v(this,void 0,void 0,(function*(){const e=[];let t=0;for(const i of this.list)if(this.DB.InteractionTable.Pause&&(yield this.DB.InteractionTable.wait(),yield Promise.all(e).then((t=>{e.length=0}))),"Wait"===i.Type)yield i.do(),t+=i._time/1e3;else if(i.IsContainer){if(yield i.do())return}else i.startTime=t,e.push(i.do());return Promise.all(e).then((e=>{}))}))}add(e){this.list.push(e)}destory(){super.destory(),this.clearWatch();for(const e of this.list)e.destory()}readFile(e){super.readFile(e),e.read(),this._triggerType=e.read(),e.readAnyArrayAndPush(this.list,e.readObject),this.target=e.readObjectId(),this.watch()}writeFile(e){super.writeFile(e),e.write(1),e.write(this._triggerType),e.writeAnyArray(this.list,e.writeObject),e.writeObjectId(this.target)}clearWatch(){this._cleaners.forEach((e=>e())),this._cleaners.length=0}watch(){var e;this.clearWatch(),this.target&&_e.PreviewMode&&(e=Ss(this._triggerType),pe[e]?this._cleaners.push(this.target.Object.registerAction(e,(e=>v(this,void 0,void 0,(function*(){this.DB.InteractionTable.doing||this.check(e.sourceEvent)&&(yield this.doList())}))))):this._cleaners.push(this.target.Object.on(e,(e=>v(this,void 0,void 0,(function*(){this.DB.InteractionTable.doing&&"load"!==e.type&&!e.isChild||this.check(e)&&(yield this.doList())}))))))}check(e){var t;return!e||("RightClick"===this._triggerType?2===e.event.button:void 0===(null==(t=e.event)?void 0:t.button)||e.event.button<=0)}doList(){return v(this,void 0,void 0,(function*(){this.DB.InteractionTable.Pause?this.DB.InteractionTable.queues.push((()=>v(this,void 0,void 0,(function*(){this.DB.InteractionTable.doing=!0,yield this.do(),this.DB.InteractionTable.doing=!1})))):(this.DB.InteractionTable.doing=!0,yield this.do(),this.DB.InteractionTable.doing=!1)}))}}),Rs=(As.type="Interaction",As=y([S],As),class{constructor(){this.type=ee.Equal}check(){return this.compare()}writeFile(e){e.write(1),e.writeWidgetValue(this.value1),e.writeWidgetValue(this.value2),e.write(this.type)}readFile(e){e.read(),this.value1||(this.value1={}),e.readWidgetValue(this.value1),this.value2||(this.value2={}),e.readWidgetValue(this.value2),this.type=e.read()}compare(){var e=ws(this.value1,this._Params),t=ws(this.value2,this._Params);switch(this.type){case ee.Equal:return e===t;case ee.UnEqual:return e!==t;case ee.Great:return t<e;case ee.Less:return e<t;case ee.GtEqual:return t<=e;case ee.LessEqual:return e<=t;case ee.Include:case ee.UnInclude:case ee.Is:case ee.IsNot:default:return!1}}}),Ms=(Rs.type="Compare",Rs=y([S],Rs),0),Os=class extends Nr{constructor(){super(...arguments),this.IsContainer=!0,this.isAll=!0,this.compares=[],this.list=[],this.Name="\u60c5\u5f62"+Ms++}check(){return this.compares.forEach((e=>e._Params=_e.GlobalVariables)),this.isAll?this.compares.every((e=>e.check())):this.compares.some((e=>e.check()))}do(){return v(this,void 0,void 0,(function*(){if(!this.check())return!1;let e=0;const t=[];for(const i of this.list)"Wait"===i.Type?(yield i.do(),e+=i._time/1e3):(i.startTime=e,t.push(i.do()));return Promise.all(t).then((()=>!0))}))}add(e){this.list.push(e)}addCompare(e){this.compares.push(e)}writeFile(e){e.write(1),e.write(this.isAll),e.write(this.Name),e.writeAnyArray(this.list,e.writeObject),e.writeAnyArray(this.compares,e.writeObject)}readFile(e){e.read(),this.isAll=e.read(),this.Name=e.read(),e.readAnyArrayAndPush(this.list,e.readObject),e.readAnyArrayAndPush(this.compares,e.readObject)}};Os.type="Condition",Os=y([S],Os);var Is,Ds,Fs=Object.freeze({__proto__:null,get Open(){return us},get Move(){return ds},get Rotate(){return ms},get Display(){return _s},get Scale(){return gs},get MoveCamera(){return ys},get SetVariable(){return vs},get Wait(){return bs},get Select(){return Es},get DataFeedback(){return xs},get Highlight(){return Cs},get Dispatch(){return Ts},get Opacity(){return Ps},get Interaction(){return As},get Compare(){return Rs},get Condition(){return Os}});!function(e){e.Ws="1",e.Api="2"}(Ds=Ds||{});let Ls=Is=class{constructor(e,t){this.target=e,this.targetKey=t,this.type=Ds.Ws}do(){this.type===Ds.Api?this.startApiRequest():this.startWs()}setEntityValue(e){var t=this.target.Object;if(t){const i=this.targetKey.split("/");let r=t;t=i.pop();for(const e of i)r=r[e];"setProp"in r?r.setProp(t,e):r[t]=e}}destory(){if(this._time&&clearTimeout(this._time),"ws"in this.data){const e=Is.WSList.get(this.data.ws);e&&(e.close(),Is.WSList.delete(this.data.ws))}}writeFile(e){e.write(1),e.writeObjectId(this.target),e.write(this.targetKey),e.write(this.type),e.write(JSON.stringify(this.data))}readFile(e){e.read(),this.target=e.readObjectId(),this.targetKey=e.read(),this.type=e.read(),(e=e.read())&&(this.data=JSON.parse(e))}startApiRequest(){return v(this,void 0,void 0,(function*(){var{type:e,params:t,time:i,url:r,filter:n}=this.data;let s=e=>e;try{const e=new Function("return "+n);e&&(s=e())}catch(e){}const a={};if(t)for(const e of t)a[e.key]=e.value;n=yield function(e,t){var i={method:null!=(i=t.method)?i:"GET",body:null!=t&&t.data?JSON.stringify(t.data):void 0};if(t.params){let i="?";for(const e in t.params)i+=e+"="+t.params[e];e+=i}return fetch(e,i).then((e=>e.json()))}(r,Object.assign({method:e},"POST"===e?{data:a}:{params:a})),this.setEntityValue(s(n)),i&&0<i&&(this._time=setTimeout((()=>{this.startApiRequest()}),1e3*i))}))}startWs(){const e=this.data;if(e.ws){let t=Is.WSList.get(e.ws);t||(t=new WebSocket(e.ws),Is.WSList.set(e.ws,t)),t.addEventListener("message",(t=>{t.data&&(t=JSON.parse(t.data),e.key in(null==t?void 0:t.params)&&this.setEntityValue(t.params[e.key]))}))}}},ks=(Ls.type="DataBind",Ls.WSList=new Map,Ls=Is=y([S],Ls),class extends Ee{constructor(){super(...arguments),this._background="#4a4b4b"}get Visiable(){return super.Visiable}set Visiable(e){super.Visiable=e,this.lines.forEach((t=>t.isVisible=!this._erase&&e))}setProp(e,t){super.setProp(e,t);const i=this._drawObject,r=i.children;var n=r.length;let a=0;for(;a<this.dataList.length;a++){var o=this.dataList[a];if(r[a])r[a].text=o.label+"\uff1a"+o.value+" "+o.unit;else{const e=new s.TextBlock(o.key,o.label+"\uff1a"+o.value+" "+o.unit);e.height=this._height,e.color="#fff",i.addControl(e)}}for(;a<n;a++)i.removeControl(r[a])}initDrawObject(){const e=new s.StackPanel(this.UniqueName);return e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=8,e.shadowColor="#168df8",e.background=this._background,this.updateDrawObject(e),this.generateLinkLine(e),e}updateDrawObject(e){super.updateDrawObject(e),e.background=this._background;const t=e.children;var i=t.length;let r=0;for(;r<this.dataList.length;r++){var n=this.dataList[r];if(t[r])t[r].text=n.label+"\uff1a"+n.value+" "+n.unit;else{const t=new s.TextBlock(n.key,n.label+"\uff1a"+n.value+" "+n.unit);t.height=this._height,t.color="#fff",e.addControl(t)}}for(;r<i;r++)e.removeControl(t[r])}readFile(e){super.readFile(e),e.read(),this._background=e.read(),this.update()}writeFile(e){super.writeFile(e),e.write(1),e.write(this._background)}});function Bs(e){for(;e.firstChild;)e.removeChild(e.firstChild);e.srcObject=null,e.src="",e.removeAttribute("src")}ks.type="StackPanelGui",ks=y([S],ks);class Ns extends s.Control{constructor(e,t=null,i,r,s){super(e),this.name=e,this.scene=s,this._workingCanvas=null,this._loaded=!1,this._autoScale=!1,this._sourceLeft=0,this._sourceTop=0,this._sourceWidth=0,this._sourceHeight=0,this._svgAttributesComputationCompleted=!1,this._cellWidth=0,this._cellHeight=0,this._cellId=-1,this._keepSize=!0,this._imageDataCache={data:null,key:""},this.onImageLoadedObservable=new n.Observable,this.onSVGAttributesComputedObservable=new n.Observable,this.width=i,this.height=r,this.source=t,this.listener=s.onAfterRenderObservable.add((()=>{this.isVisible&&this.source&&this._onImageLoaded()}))}get isLoaded(){return this._loaded}get detectPointerOnOpaqueOnly(){return this._detectPointerOnOpaqueOnly}set detectPointerOnOpaqueOnly(e){this._detectPointerOnOpaqueOnly!==e&&(this._detectPointerOnOpaqueOnly=e)}get sourceLeft(){return this._sourceLeft}set sourceLeft(e){this._sourceLeft!==e&&(this._sourceLeft=e,this._markAsDirty())}get sourceTop(){return this._sourceTop}set sourceTop(e){this._sourceTop!==e&&(this._sourceTop=e,this._markAsDirty())}get sourceWidth(){return this._sourceWidth}set sourceWidth(e){this._sourceWidth!==e&&(this._sourceWidth=e,this._markAsDirty())}get sourceHeight(){return this._sourceHeight}set sourceHeight(e){this._sourceHeight!==e&&(this._sourceHeight=e,this._markAsDirty())}get imageWidth(){return this._videoWidth}get imageHeight(){return this._videoHeight}get svgAttributesComputationCompleted(){return this._svgAttributesComputationCompleted}get autoScale(){return this._autoScale}set autoScale(e){this._autoScale!==e&&(this._autoScale=e)&&this._loaded&&this.synchronizeSizeWithContent()}get keepSize(){return this._autoScale}set keepSize(e){this._keepSize!==e&&(this._keepSize=e)&&this._loaded&&this.synchronizeSizeWithContent()}set VideoDom(e){this._video=e,this._loaded=!1,this._imageDataCache.data=null,this._video.width?this._onImageLoaded():this._video.onload=()=>{this._onImageLoaded()}}get VideoDom(){return this._video}_onImageLoaded(){this._imageDataCache.data=null,this._videoWidth=this._video.videoWidth,this._videoHeight=this._video.videoHeight,this._loaded=!0,this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()}_getVideo(e){if(e.isNative)return e;if(e instanceof HTMLVideoElement)return n.Tools.SetCorsBehavior(e.currentSrc,e),e;const t=document.createElement("video");return"string"==typeof e?(n.Tools.SetCorsBehavior(e,t),t.src=e):(n.Tools.SetCorsBehavior(e[0],t),e.forEach((e=>{const i=document.createElement("source");i.src=e,t.appendChild(i)}))),this.onDisposeObservable.addOnce((()=>{Bs(t)})),t}get source(){return this._source}set source(e){this._source!==e&&(this._loaded=!1,this._source=e,this._imageDataCache.data=null,this._video=this._getVideo(e),this._video.crossOrigin="anonymous",this._video.width=400,this._video.height=400,this._video.muted=!0,this._video.autoplay=!0,this._video.loop=!0,e&&(this._video.play(),this._video.addEventListener("play",(()=>{this._onImageLoaded()})),this._video.addEventListener("seeked",(()=>{this._onImageLoaded()})),this._video.addEventListener("canPlay",(()=>{this._onImageLoaded()})),this._video.addEventListener("loadedData",(()=>{this._onImageLoaded()}))))}get cellWidth(){return this._cellWidth}set cellWidth(e){this._cellWidth!==e&&(this._cellWidth=e,this._markAsDirty())}get cellHeight(){return this._cellHeight}set cellHeight(e){this._cellHeight!==e&&(this._cellHeight=e,this._markAsDirty())}get cellId(){return this._cellId}set cellId(e){this._cellId!==e&&(this._cellId=e,this._markAsDirty())}contains(e,t){if(!super.contains(e,t))return!1;if(!this._detectPointerOnOpaqueOnly||!this._workingCanvas)return!0;var i=0|this._currentMeasure.width,r=0|this._currentMeasure.height,n=i+"_"+r;let s=this._imageDataCache.data;if(!s||this._imageDataCache.key!==n){const e=this._workingCanvas.getContext("2d");this._imageDataCache.data=s=e.getImageData(0,0,i,r).data,this._imageDataCache.key=n}return 0<s[4*((e=e-this._currentMeasure.left|0)+(t=t-this._currentMeasure.top|0)*i)+3]}_getTypeName(){return"Image"}synchronizeSizeWithContent(){this._loaded&&(this.width=this._video.width+"px",this.height=this._video.height+"px")}_processMeasures(e,t){this._loaded&&(this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)),super._processMeasures(e,t)}_prepareWorkingCanvasForOpaqueDetection(){var e;if(this._detectPointerOnOpaqueOnly){var t=this._currentMeasure.width,i=this._currentMeasure.height;if(!this._workingCanvas){const r=(null==(e=null==(e=this._host)?void 0:e.getScene())?void 0:e.getEngine())||n.EngineStore.LastCreatedEngine;if(!r)throw new Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=r.createCanvas(t,i)}this._workingCanvas.getContext("2d").clearRect(0,0,t,i)}}_drawImage(e,t,i,r,n,s,a,o,l){if(e.drawImage(this._video,t,i,r,n,s,a,o,l),this._detectPointerOnOpaqueOnly){(e=this._workingCanvas.getContext("2d")).drawImage(this._video,t,i,r,n,s-this._currentMeasure.left,a-this._currentMeasure.top,o,l)}}_draw(e){let t,i,r,n;var s,a;e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),n=-1===this.cellId?(t=this._sourceLeft,i=this._sourceTop,r=this._sourceWidth||this._videoWidth,this._sourceHeight||this._videoHeight):(a=this._video.videoWidth/this.cellWidth,s=this.cellId/a>>0,a=this.cellId%a,t=this.cellWidth*a,i=this.cellHeight*s,r=this.cellWidth,this.cellHeight),this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(e),this._loaded&&this._drawImage(e,t,i,r,n,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._keepSize?this._currentMeasure.width*n/r:this._currentMeasure.height),e.restore()}dispose(){super.dispose(),this.onImageLoadedObservable.clear(),this.onSVGAttributesComputedObservable.clear(),this.listener&&this.scene.onAfterRenderObservable.remove(this.listener),Bs(this._video)}}y([(0,n.serialize)()],Ns.prototype,"detectPointerOnOpaqueOnly",null),y([(0,n.serialize)()],Ns.prototype,"sourceLeft",null),y([(0,n.serialize)()],Ns.prototype,"sourceTop",null),y([(0,n.serialize)()],Ns.prototype,"sourceWidth",null),y([(0,n.serialize)()],Ns.prototype,"sourceHeight",null),y([(0,n.serialize)()],Ns.prototype,"autoScale",null),y([(0,n.serialize)()],Ns.prototype,"keepSize",null),y([(0,n.serialize)()],Ns.prototype,"source",null),y([(0,n.serialize)()],Ns.prototype,"cellWidth",null),y([(0,n.serialize)()],Ns.prototype,"cellHeight",null),y([(0,n.serialize)()],Ns.prototype,"cellId",null);let zs=class extends Ee{constructor(e){super(),this._url="",this._width="200px",this._height="100px",null!=e&&e.url&&(this._url=e.url),null!=e&&e.width&&(this._width=e.width),null!=e&&e.height&&(this._height=e.height)}get VideoDom(){return this._videoDom}get Url(){return this._url}set Url(e){this._url=e,this.update()}initDrawObject(){const e=new s.Container(this.UniqueName),t=(e.width=this._width,e.height=this._height,new Ns(this.UniqueName,this._url,this._width,this._height,fe.Scene));return e.background="#000",this._videoDom=t.VideoDom,t.keepSize=!0,e.addControl(t),e}updateDrawObject(e){super.updateDrawObject(e);e.children[0].source=this._url}readFile(e){super.readFile(e),e.read(),this.update()}writeFile(e){super.writeFile(e),e.write(1)}erase(e=!0){super.erase(e)}destory(){super.destory()}};zs.type="VideoGui",zs=y([S],zs);class Us extends s.Control{constructor(e,t,i){super(e),this.name=e,this.scene=i,this._needAnimation=!1,this._workingCanvas=null,this._loaded=!1,this._autoScale=!1,this._sourceLeft=0,this._sourceTop=0,this._sourceWidth=0,this._sourceHeight=0,this._svgAttributesComputationCompleted=!1,this._cellWidth=0,this._cellHeight=0,this._cellId=-1,this._keepSize=!0,this._imageDataCache={data:null,key:""},this.onImageLoadedObservable=new n.Observable,this.onSVGAttributesComputedObservable=new n.Observable,this.CanvasDom=t,this.listener=i.onAfterRenderObservable.add((()=>{this.isVisible&&this._needAnimation&&this._onImageLoaded()}))}get isLoaded(){return this._loaded}get detectPointerOnOpaqueOnly(){return this._detectPointerOnOpaqueOnly}set detectPointerOnOpaqueOnly(e){this._detectPointerOnOpaqueOnly!==e&&(this._detectPointerOnOpaqueOnly=e)}get sourceLeft(){return this._sourceLeft}set sourceLeft(e){this._sourceLeft!==e&&(this._sourceLeft=e,this._markAsDirty())}get sourceTop(){return this._sourceTop}set sourceTop(e){this._sourceTop!==e&&(this._sourceTop=e,this._markAsDirty())}get sourceWidth(){return this._sourceWidth}set sourceWidth(e){this._sourceWidth!==e&&(this._sourceWidth=e,this._markAsDirty())}get sourceHeight(){return this._sourceHeight}set sourceHeight(e){this._sourceHeight!==e&&(this._sourceHeight=e,this._markAsDirty())}get imageWidth(){return this._canvasWidth}get imageHeight(){return this._canvasHeight}get svgAttributesComputationCompleted(){return this._svgAttributesComputationCompleted}get autoScale(){return this._autoScale}set autoScale(e){this._autoScale!==e&&(this._autoScale=e)&&this._loaded&&this.synchronizeSizeWithContent()}get keepSize(){return this._autoScale}set keepSize(e){this._keepSize!==e&&(this._keepSize=e)&&this._loaded&&this.synchronizeSizeWithContent()}set CanvasDom(e){this._canvas_=e,this._imageDataCache.data=null,this._onImageLoaded()}get CanvasDom(){return this._canvas_}_onImageLoaded(){this._imageDataCache.data=null,this._canvasWidth=this._canvas_.width,this._canvasHeight=this._canvas_.height,this._loaded=!0,this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()}get cellWidth(){return this._cellWidth}set cellWidth(e){this._cellWidth!==e&&(this._cellWidth=e,this._markAsDirty())}get cellHeight(){return this._cellHeight}set cellHeight(e){this._cellHeight!==e&&(this._cellHeight=e,this._markAsDirty())}get cellId(){return this._cellId}set cellId(e){this._cellId!==e&&(this._cellId=e,this._markAsDirty())}contains(e,t){if(!super.contains(e,t))return!1;if(!this._detectPointerOnOpaqueOnly||!this._workingCanvas)return!0;var i=0|this._currentMeasure.width,r=0|this._currentMeasure.height,n=i+"_"+r;let s=this._imageDataCache.data;if(!s||this._imageDataCache.key!==n){const e=this._workingCanvas.getContext("2d");this._imageDataCache.data=s=e.getImageData(0,0,i,r).data,this._imageDataCache.key=n}return 0<s[4*((e=e-this._currentMeasure.left|0)+(t=t-this._currentMeasure.top|0)*i)+3]}_getTypeName(){return"Image"}synchronizeSizeWithContent(){this._loaded&&(this.width=this._canvas_.width+"px",this.height=this._canvas_.height+"px")}_processMeasures(e,t){this._loaded&&(this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)),super._processMeasures(e,t)}_prepareWorkingCanvasForOpaqueDetection(){var e;if(this._detectPointerOnOpaqueOnly){var t=this._currentMeasure.width,i=this._currentMeasure.height;if(!this._workingCanvas){const r=(null==(e=null==(e=this._host)?void 0:e.getScene())?void 0:e.getEngine())||n.EngineStore.LastCreatedEngine;if(!r)throw new Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=r.createCanvas(t,i)}this._workingCanvas.getContext("2d").clearRect(0,0,t,i)}}_drawImage(e,t,i,r,n,s,a,o,l){if(e.drawImage(this._canvas_,t,i,r,n,s,a,o,l),this._detectPointerOnOpaqueOnly){(e=this._workingCanvas.getContext("2d")).drawImage(this._canvas_,t,i,r,n,s-this._currentMeasure.left,a-this._currentMeasure.top,o,l)}}_draw(e){let t,i,r,n;var s,a;e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),n=-1===this.cellId?(t=this._sourceLeft,i=this._sourceTop,r=this._sourceWidth||this._canvasWidth,this._sourceHeight||this._canvasHeight):(a=this._canvas_.width/this.cellWidth,s=this.cellId/a>>0,a=this.cellId%a,t=this.cellWidth*a,i=this.cellHeight*s,r=this.cellWidth,this.cellHeight),this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(e),this._loaded&&this._drawImage(e,t,i,r,n,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._keepSize?this._currentMeasure.width*n/r:this._currentMeasure.height),e.restore()}dispose(){super.dispose(),this.onImageLoadedObservable.clear(),this.onSVGAttributesComputedObservable.clear(),this.listener&&this.scene.onAfterRenderObservable.remove(this.listener)}}y([(0,n.serialize)()],Us.prototype,"detectPointerOnOpaqueOnly",null),y([(0,n.serialize)()],Us.prototype,"sourceLeft",null),y([(0,n.serialize)()],Us.prototype,"sourceTop",null),y([(0,n.serialize)()],Us.prototype,"sourceWidth",null),y([(0,n.serialize)()],Us.prototype,"sourceHeight",null),y([(0,n.serialize)()],Us.prototype,"autoScale",null),y([(0,n.serialize)()],Us.prototype,"keepSize",null),y([(0,n.serialize)()],Us.prototype,"cellWidth",null),y([(0,n.serialize)()],Us.prototype,"cellHeight",null),y([(0,n.serialize)()],Us.prototype,"cellId",null);var Gs,js,Vs,Zs=Object.freeze({__proto__:null,get CommandHistoryRecord(){return An}});class Ws{constructor(e){this.attachSystem=e}get AttachSystem(){return this.attachSystem}set AttachSystem(e){this.attachSystem=e}update(){}fromJSON(e){return this}toJSON(){return null}readFile(e){}writeFile(e){}}class Hs extends Ws{constructor(e,t){super(e),this.attachSystem=e,this._radius=1,this._radiusRange=1,null!=t&&t.radius&&(this._radius=t.radius),null!=t&&t.radiusRange&&(this._radiusRange=t.radiusRange),null!=e&&e.HasIntance&&this.setEmiter()}setEmiter(){}get AttachSystem(){return this.attachSystem}set AttachSystem(e){this.attachSystem=e,this.setEmiter()}get Radius(){return this._radius}set Radius(e){e!==this._radius&&(this._radius=e,this.update())}get RadiusRange(){return this._radiusRange}set RadiusRange(e){e!==this._radiusRange&&(this._radiusRange=e,this.update())}update(){this._emiter&&(this._emiter.radius=this._radius,this._emiter.radiusRange=this._radiusRange)}toJSON(){return{Radius:this.Radius,RadiusRange:this.RadiusRange}}fromJSON(e){return this._radius=e.Radius,this._radiusRange=e.RadiusRange,this}writeFile(e){super.writeFile(e),e.write(1),e.write(this._radius),e.write(this._radiusRange)}readFile(e){super.readFile(e),e.read(),this._radius=e.read(),this._radiusRange=e.read()}}let Ks=class extends Hs{constructor(e,t){super(e,t),null!=(this.attachSystem=e)&&e.HasIntance&&this.setEmiter()}setEmiter(){this._emiter=this.attachSystem.Intance.createSphereEmitter(this._radius,this._radiusRange)}},qs=(Ks.type="SphereEmiter",Ks=y([S],Ks),function(e){e[e.Point=0]="Point",e[e.Box=1]="Box",e[e.Sphere=2]="Sphere",e[e.Hemisphere=3]="Hemisphere",e[e.Cylinder=4]="Cylinder",e[e.DirctedCylinder=5]="DirctedCylinder",e[e.Cone=6]="Cone",e[e.Mesh=7]="Mesh",e[e.Custom=8]="Custom"}(Gs=Gs||{}),function(e){e[e.Point=0]="Point",e[e.Entity=1]="Entity",e[e.Camera=2]="Camera"}(js=js||{}),class extends bn{constructor(e){super(),this.particleSystem=e,this._name="\u5b50\u7c92\u5b50\u7279\u6548\u89e6\u53d1\u5668",this.type=n.SubEmitterType.END}get Intance(){return this._intance||(this._intance=this.initParticle()),this._intance}initParticle(){const e=this.particleSystem.Intance,t=(e.disposeOnStop=!0,new n.SubEmitter(e));return t.type=this.type,t}updateParticle(e){e.type=this.type,this.particleSystem.updateParticle(e.particleSystem)}destory(){super.destory(),this._intance&&(this._intance.dispose(),this._intance=null)}fromJSON(e){if(e)return e.type&&(this.type=e.type),this.particleSystem.fromJSON(e,!0),this}readFile(e){super.readFile(e),this.particleSystem=e.readObject()}writeFile(e){super.writeFile(e),e.writeObject(this.particleSystem)}}),Xs=(qs.type="SubEmitter",qs=y([S],qs),class extends Hs{constructor(e,t){super(e,t),null!=(this.attachSystem=e)&&e.HasIntance&&this.setEmiter()}setEmiter(){this._emiter=this.attachSystem.Intance.createHemisphericEmitter(this._radius,this._radiusRange)}}),Ys=(Xs.type="HemisphericEmiter",Xs=y([S],Xs),class extends Hs{constructor(e,t){super(e,t),this.attachSystem=e,this.height=1,null!=t&&t.height&&(this.height=t.height),null!=e&&e.HasIntance&&this.setEmiter()}setEmiter(){this._emiter=this.attachSystem.Intance.createCylinderEmitter(this._radius,this.height,this._radiusRange)}writeFile(e){super.writeFile(e),e.write(1),e.write(this.height)}readFile(e){super.readFile(e),e.read(),this.height=e.read()}}),Qs=(Ys.type="CylinderEmitter",Ys=y([S],Ys),class extends Ws{constructor(e,t){super(e),this.attachSystem=e,this._radius=1,this.angle=Math.PI/4,null!=t&&t.radius&&(this._radius=t.radius),null!=t&&t.angle&&(this.angle=t.angle),null!=e&&e.HasIntance&&this.setEmiter()}setEmiter(){this._emiter=this.attachSystem.Intance.createConeEmitter(this._radius,this.angle)}get AttachSystem(){return this.attachSystem}set AttachSystem(e){this.attachSystem=e,this.setEmiter()}get Radius(){return this._radius}set Radius(e){e!==this._radius&&(this._radius=e,this.update())}get Angle(){return this.angle}set Angle(e){e!==this.angle&&(this.angle=e,this.update())}update(){this._emiter&&(this._emiter.radius=this._radius,this._emiter.angle=this.angle)}toJSON(){return{Radius:this.Radius,Angle:this.Angle}}fromJSON(e){return e.Radius&&(this._radius=e.Radius),e.Angle&&(this.angle=e.Angle),this}writeFile(e){super.writeFile(e),e.write(1),e.write(this._radius),e.write(this.angle)}readFile(e){super.readFile(e),e.read(),this._radius=e.read(),this.angle=e.read()}}),$s=(Qs.type="ConeEmitter",Qs=y([S],Qs),class extends Ys{constructor(e,t){super(e,t),null!=(this.attachSystem=e)&&e.HasIntance&&this.setEmiter()}setEmiter(){this._emiter=this.attachSystem.Intance.createDirectedCylinderEmitter(this._radius,this.height,this._radiusRange,ne(this.attachSystem.Direction1),ne(this.attachSystem.Direction2))}}),Js=($s.type="DirectedCylinder",$s=y([S],$s),Vs=class extends bn{constructor(e){super(),this.capacity=1e3,this._updateSpeed=.01,this._size={min:.1,max:.5},this._scale={min:{x:.1,y:.1},max:{x:.5,y:.5}},this.color1="#CD581BFF",this.color2="#000000FF",this.colorDead="#00000000",this._manualEmitCount=-1,this.emitPower={min:1,max:3},this._angularSpeed={min:0,max:Math.PI},this._pivot=new n.Vector2,this.direction1=new n.Vector3(0,1),this.direction2=new n.Vector3(0,1),this.minEmitBox=new n.Vector3(-.5,-.5,-.5),this.maxEmitBox=new n.Vector3(.5,.5,.5),this._gravity=new n.Vector3(0,0),this._rate=100,this.lifeTime={min:.3,max:1.5},this.spriteOption={isAnimationSheetEnabled:!1,spriteCellHeight:32,spriteCellWidth:32,spriteRandomStartCell:!0,startSpriteCellID:0,endSpriteCellID:3,spriteCellChangeSpeed:0},this.emiterShape=Gs.Box,this.emiterType=js.Point,this.emiterPosition=new n.Vector3,this.blendMode=n.ParticleSystem.BLENDMODE_ONEONE,this.subParticleSystems=[],this.needUpdateSubEmiters=!1,this.gradients=[],this._targetStopDuration=0,this._position=n.Vector3.Zero(),null!=e&&e.image&&(this._image=e.image),null!=e&&e.capacity&&(this.capacity=e.capacity),null!=e&&e.manualEmitCount&&(this._manualEmitCount=e.manualEmitCount)}get HasIntance(){return!!this._intance}get Intance(){return this._intance||(this._intance=this.initParticle(),this._intance)}get ManualEmitCount(){return this._manualEmitCount}set ManualEmitCount(e){e!==this._manualEmitCount&&(this._manualEmitCount=e,this.update())}get Capacity(){return this.capacity}set Capacity(e){this.capacity!==e&&(this.capacity=e,Vs.Reading||(this._intance&&(this._intance.dispose(),this._intance=null),this.Intance.start()))}get UpdateSpeed(){return this._updateSpeed}set UpdateSpeed(e){e!==this._updateSpeed&&(this._updateSpeed=e,this.update())}get Size(){return this._size}set Size(e){this._size=e,this.update()}get TextureUrl(){return this._image?this._image.startsWith("http")?this._image:me.Texture_URL+this._image:""}get Image(){return this._image}set Image(e){e!==this._image&&(this._image=e,this.update())}get Scale(){return this._scale}set Scale(e){this.writeSnapshoot(),this._scale=e,this.update()}get Color1(){return this.color1}set Color1(e){this.color1=e,this.update()}get Color2(){return this.color2}set Color2(e){e!==this.color2&&(this.color2=e,this.update())}get ColorDead(){return this.colorDead}set ColorDead(e){e!==this.colorDead&&(this.colorDead=e,this.update())}get EmitPower(){return this.emitPower}set EmitPower(e){e!==this.emitPower&&(this.emitPower=e,this.update())}get AngularSpeed(){return this._angularSpeed}set AngularSpeed(e){this._angularSpeed=e,this.update()}get Pivot(){return function(e){return{x:e.x,y:e.y}}(this._pivot)}set Pivot(e){se(this._pivot,e),this.update()}get Direction1(){return oe(this.direction1)}set Direction1(e){se(this.direction1,e),this.update()}get Direction2(){return oe(this.direction2)}set Direction2(e){se(this.direction2,e),this.update()}get MinEmitBox(){return oe(this.minEmitBox)}set MinEmitBox(e){se(this.minEmitBox,e),this.update()}get MaxEmitBox(){return oe(this.maxEmitBox)}set MaxEmitBox(e){se(this.maxEmitBox,e),this.update()}get Gravity(){return oe(this._gravity)}set Gravity(e){se(this._gravity,e),this.update()}get EmiterPosition(){return oe(this.emiterPosition)}set EmiterPosition(e){se(this.emiterPosition,e),this.update()}get Rate(){return this._rate}set Rate(e){e!==this._rate&&(this._rate=e,this.update())}get LifeTime(){return this.lifeTime}set LifeTime(e){this.lifeTime=e,this.update()}get SpriteOption(){return this.spriteOption}set SpriteOption(e){this.spriteOption=e,this.update()}get EmiterType(){return this.emiterType}set EmiterType(e){e!==this.emiterType&&(this.emiterType=e,this.updateEmitType())}get EmiterShape(){return this.emiterShape}set EmiterShape(e){e!==this.emiterShape&&(this.emiterShape=e,this.updateEmitShape())}get EmiterEntity(){return this.emiterEntity}set EmiterEntity(e){this.emiterEntity=e,this.update()}get BlendMode(){return this.blendMode}set BlendMode(e){e!==this.blendMode&&(this.blendMode=e,this.update())}get SubParticleSystems(){return[...this.subParticleSystems]}set SubParticleSystems(e){this.subParticleSystems=e,this.needUpdateSubEmiters=!0,this.update()}get Emiter(){return this.emiter}get Gradients(){return[...this.gradients]}set Gradients(e){this.removeGradients(),this.gradients=e,this.updateGradient()}get TargetStopDuration(){return this._targetStopDuration}set TargetStopDuration(e){e!==this._targetStopDuration&&(this._targetStopDuration=e,this.update())}get Position(){return oe(this._position)}set Position(e){this.writeSnapshoot(),se(this._position,e),this.update()}appendGradient(e){this.gradients.push(e),this.updateGradient()}removeGradient(e){this.gradients[e]&&(e=this.gradients.splice(e,1),this.removeGradients(e))}initParticle(){const e=new n.ParticleSystem(this.UniupeName,this.capacity,fe.Scene);return e.particleTexture=new n.Texture(this.TextureUrl,fe.Scene),this.updateParticle(e),e}updateParticle(e){e.translationPivot=this._pivot;const t=e.particleTexture;t.url!==this.TextureUrl&&t.updateURL(this.TextureUrl),this.updateEmitType(e),e.blendMode=this.blendMode,e.minEmitBox=this.minEmitBox,e.maxEmitBox=this.maxEmitBox,this.color1&&(e.color1=n.Color4.FromHexString(this.color1)),this.color2&&(e.color2=n.Color4.FromHexString(this.color2)),this.colorDead&&(e.colorDead=n.Color4.FromHexString(this.colorDead)),e.minSize=this._size.min,e.maxSize=this._size.max,e.minLifeTime=this.lifeTime.min,e.maxLifeTime=this.lifeTime.max,e.targetStopDuration=this._targetStopDuration,e.emitRate=this._rate,e.gravity=this._gravity,e.direction1=this.direction1,e.direction2=this.direction2,this.spriteOption.isAnimationSheetEnabled?(e.isAnimationSheetEnabled=this.spriteOption.isAnimationSheetEnabled,e.spriteCellHeight=this.spriteOption.spriteCellHeight,e.spriteCellWidth=this.spriteOption.spriteCellWidth,e.spriteRandomStartCell=this.spriteOption.spriteRandomStartCell,e.startSpriteCellID=this.spriteOption.startSpriteCellID,e.endSpriteCellID=this.spriteOption.endSpriteCellID,e.spriteCellChangeSpeed=this.spriteOption.spriteCellChangeSpeed):e.isAnimationSheetEnabled=this.spriteOption.isAnimationSheetEnabled,e.minAngularSpeed=this._angularSpeed.min,e.maxAngularSpeed=this._angularSpeed.max,e.minEmitPower=this.emitPower.min,e.maxEmitPower=this.emitPower.max,e.updateSpeed=this._updateSpeed,e.manualEmitCount=this._manualEmitCount,this.needUpdateSubEmiters&&this.updateSubEmiters(e),this.updateGradient(e),e.worldOffset.copyFrom(this._position)}update(){Vs.Reading||this._intance&&this.updateParticle(this._intance)}start(){this._intance&&this._intance.start()}stop(){this._intance&&this._intance.stop()}destory(){if(super.destory(),this._intance){this._intance.dispose(),this._intance=null;for(const e of this.subParticleSystems)e.destory()}}fromJSON(e,t=!1){let i;t||(Vs.Reading=!0);for(const t in e){var r;t in this&&("SubParticleSystems"===t?(r=e.SubParticleSystems.map((e=>new qs(new Vs).fromJSON(e))),this.subParticleSystems=r,this.needUpdateSubEmiters=!0):"Emiter"===t?i=e[t]:this[t]=e[t])}return t||(Vs.Reading=!1),i&&this.emiter&&(this.emiter.fromJSON(i),setTimeout((()=>{this.emiter.AttachSystem=this}),0)),this}erase(e){super.erase(e),this._intance&&this._intance.stop(),le.trigger({type:"remove",target:this}),this.trigger({type:"remove",target:this})}toJSON(){return{capacity:this.capacity,updateSpeed:this._updateSpeed,size:Object.assign({},this._size),image:this._image,scale:this._scale,color1:this.color1,color2:this.color2,colorDead:this.colorDead}}clone(){const e=new Vs({image:this._image,capacity:this.capacity});var t=new F;return this.writeFile(t),e.readFile(t),this._id=null,e}writeFile(e){super.writeFile(e),e.write(2),e.write(this.capacity),e.write(this._manualEmitCount),e.write(this._updateSpeed),e.write(this._size.min),e.write(this._size.max),e.write(this._image),e.write(this._scale.min.x),e.write(this._scale.min.y),e.write(this._scale.max.x),e.write(this._scale.max.y),e.write(this.color1),e.write(this.color2),e.write(this.colorDead),e.write(this.emitPower.min),e.write(this.emitPower.max),e.write(this._angularSpeed.min),e.write(this._angularSpeed.max),e.write(this._pivot.x),e.write(this._pivot.y),e.writeArray(this.direction1.asArray()),e.writeArray(this.direction2.asArray()),e.writeArray(this.minEmitBox.asArray()),e.writeArray(this.maxEmitBox.asArray()),e.writeArray(this._gravity.asArray()),e.write(this._rate),e.write(this.lifeTime.min),e.write(this.lifeTime.max),e.write(this._targetStopDuration),e.write(this.spriteOption.isAnimationSheetEnabled),e.write(this.spriteOption.spriteCellHeight),e.write(this.spriteOption.spriteCellWidth),e.write(this.spriteOption.spriteRandomStartCell),e.write(this.spriteOption.startSpriteCellID),e.write(this.spriteOption.endSpriteCellID),e.write(this.spriteOption.spriteCellChangeSpeed),e.write(this.emiterShape),e.write(this.emiterType),e.writeArray(this.emiterPosition.asArray()),e.writeObjectId(this.emiterEntity),e.write(this.blendMode),e.writeAnyArray(this.subParticleSystems,e.writeObject),e.writeObject(this.emiter),e.writeAnyArray(this.gradients,(t=>{e.write(t.key),e.write(t.period),e.write(t.value),e.write(t.otherValue)})),e.writeVector3(this._position)}readFile(e){super.readFile(e);var t=e.read(),i=(this.capacity=e.read(),this._manualEmitCount=e.read(),this._updateSpeed=e.read(),this._size.min=e.read(),this._size.max=e.read(),this._image=e.read(),this._scale.min.x=e.read(),this._scale.min.y=e.read(),this._scale.max.x=e.read(),this._scale.max.y=e.read(),this.color1=e.read(),this.color2=e.read(),this.colorDead=e.read(),this.emitPower.min=e.read(),this.emitPower.max=e.read(),this._angularSpeed.min=e.read(),this._angularSpeed.max=e.read(),this._pivot.x=e.read(),this._pivot.y=e.read(),e.read()),r=e.readArray(i);this.direction1.fromArray(r),i=e.read(),r=e.readArray(i),this.direction2.fromArray(r),i=e.read(),r=e.readArray(i),this.minEmitBox.fromArray(r),i=e.read(),r=e.readArray(i),this.maxEmitBox.fromArray(r),i=e.read(),r=e.readArray(i),this._gravity.fromArray(r),this._rate=e.read(),this.lifeTime.min=e.read(),this.lifeTime.max=e.read(),this._targetStopDuration=e.read(),this.spriteOption.isAnimationSheetEnabled=e.read(),this.spriteOption.spriteCellHeight=e.read(),this.spriteOption.spriteCellWidth=e.read(),this.spriteOption.spriteRandomStartCell=e.read(),this.spriteOption.startSpriteCellID=e.read(),this.spriteOption.endSpriteCellID=e.read(),this.spriteOption.spriteCellChangeSpeed=e.read(),this.emiterShape=e.read(),this.emiterType=e.read(),i=e.read(),r=e.readArray(i),this.emiterPosition.fromArray(r),this.emiterEntity=e.readObjectId(),this.blendMode=e.read(),e.readAnyArrayAndPush(this.subParticleSystems,e.readObject),this.needUpdateSubEmiters=0<this.subParticleSystems.length,this.emiter=e.readObject(this.emiter),this.emiter&&!this.emiter.AttachSystem&&setTimeout((()=>{this.emiter.AttachSystem=this}),0),this.gradients.length=0,e.readAnyArray((()=>{const t={key:"Size",period:0,value:0,otherValue:0};t.key=e.read(),t.period=e.read(),t.value=e.read(),t.otherValue=e.read(),this.gradients.push(t)})),1<t&&e.readVector3(this._position),this.update()}updateSubEmiters(e=this._intance){e&&(e.subEmitters=[this.subParticleSystems.map((e=>e.Intance))],e.start(),this.needUpdateSubEmiters=!1)}updateEmitShape(e=this._intance){switch(this.emiter=null,this.emiterShape){case Gs.Point:e&&e.createPointEmitter(this.direction1,this.direction2);break;case Gs.Box:e&&e.createBoxEmitter(this.direction1,this.direction2,this.minEmitBox,this.maxEmitBox);break;case Gs.Sphere:this.emiter=new Ks(this);break;case Gs.Hemisphere:this.emiter=new Xs(this);break;case Gs.Cylinder:this.emiter=new Ys(this);break;case Gs.DirctedCylinder:this.emiter=new $s(this);break;case Gs.Cone:this.emiter=new Qs(this);case Gs.Mesh:case Gs.Custom:}}updateEmitType(e=this._intance){var t;if(e)switch(this.emiterType){case js.Point:e.emitter=this.emiterPosition;break;case js.Entity:null!=(t=this.emiterEntity)&&t.Object&&(e.emitter=this.emiterEntity.Object.RenderObject);break;case js.Camera:e.emitter=fe.Scene.activeCamera}}updateGradient(e=this._intance){if(e)for(const t of this.gradients)switch(t.key){case"Size":e.removeSizeGradient(t.period),e.addSizeGradient(t.period,t.value,t.otherValue);break;case"Color":e.removeColorGradient(t.period),e.addColorGradient(t.period,n.Color4.FromHexString(t.value),n.Color4.FromHexString(t.otherValue))}}removeGradients(e=this.gradients,t=this._intance){if(t)for(const i of e)switch(i.key){case"Size":t.removeSizeGradient(i.period);break;case"Color":t.removeColorGradient(i.period)}}}),ea=(Js.type="ParticleSystem",Js.Reading=!1,Js=Vs=y([S],Js),class extends Js{constructor(){super(...arguments),this.capacity=1e4,this._pivot=new n.Vector2(0,10),this.minEmitBox=new n.Vector3(-100,50,-100),this.maxEmitBox=new n.Vector3(100,50,100),this.colorDead=new n.Color4(1,1,1,0).toHexString(),this._size={min:.1,max:2},this.lifeTime={min:1,max:10},this._rate=1e3,this._gravity=new n.Vector3(0,-9.81,-1),this.direction1=new n.Vector3(-.5,-1,0),this.direction2=new n.Vector3(5,-1,0),this.spriteOption={isAnimationSheetEnabled:!0,spriteCellHeight:32,spriteCellWidth:32,spriteRandomStartCell:!0,startSpriteCellID:0,endSpriteCellID:3,spriteCellChangeSpeed:0},this._angularSpeed={min:0,max:Math.PI/4},this.emitPower={min:.01,max:10},this.useCameraPosition=!0,this.blendMode=n.BaseParticleSystem.BLENDMODE_STANDARD}}),ta=(ea.type="SnowParticleSystem",ea=y([S],ea),class extends Js{constructor(){super(...arguments),this.capacity=1e4,this._updateSpeed=.033,this._pivot=new n.Vector2(0,10),this.minEmitBox=new n.Vector3(-100,50,-100),this.maxEmitBox=new n.Vector3(100,50,100),this.colorDead=new n.Color4(1,1,1,0).toHexString(),this._size={min:.1,max:2},this.lifeTime={min:1,max:10},this._rate=1e3,this._gravity=new n.Vector3(0,-9.81,-1),this.direction1=new n.Vector3(0,-1,0),this.direction2=new n.Vector3(0,-1,0),this.spriteOption={isAnimationSheetEnabled:!0,spriteCellHeight:512,spriteCellWidth:128,spriteRandomStartCell:!0,startSpriteCellID:0,endSpriteCellID:3,spriteCellChangeSpeed:0},this._angularSpeed={min:0,max:0},this.emitPower={min:.01,max:10}}initParticle(){const e=super.initParticle();return e.emitter=fe.Scene.activeCamera,e}}),ia=(ta.type="RainParticleSystem",ta=y([S],ta),class extends bn{constructor(){super(...arguments),this._name="\u7c92\u5b50\u7ec4\u5408",this.systems=[]}get Intance(){return this._intance||(this._intance=this.initParticle(),this._intance)}initParticle(){const e=new n.ParticleSystemSet;for(const t of this.systems)e.systems.push(t.Intance);return e}updateParticle(e){for(let t=0;t<this.systems.length;t++)this.systems[t].updateParticle(e.systems[t])}start(){this.systems.forEach((e=>e.start()))}stop(){this.systems.forEach((e=>e.stop()))}destory(){this.systems.forEach((e=>e.destory()))}erase(e=!0){super.erase(e),this._intance&&this._intance.systems.forEach((e=>e.stop())),le.trigger({type:"remove",target:this}),this.trigger({type:"remove",target:this})}fromJSON(e){Js.Reading=!0;for(const t of e){const e=new Js;e.fromJSON(t,!0),this.systems.push(e)}return Js.Reading=!1,this}writeFile(e){super.writeFile(e),e.writeAnyArray(this.systems,e.writeObject)}readFile(e){super.readFile(e),e.readAnyArrayAndPush(this.systems,e.readObject)}}),ra=(ia.type="ParticleSystemGroup",ia=y([S],ia),class extends zr{constructor(){super(),this._isPickable=!0;const e=this;this.entitys=new Proxy([],{get:(e,t,i)=>Reflect.get(e,t,i),set:(t,i,r,n)=>(Reflect.get(t,i,n)!==r&&r instanceof D&&r.Object instanceof fe&&(e.Id&&(r.Object.GroupId=e.ObjectId)),Reflect.set(t,i,r,n))})}get IsPickable(){return this._isPickable}set IsPickable(e){e!==this._isPickable&&(this.writeSnapshoot(),this._isPickable=e)}readFile(e){e.read(),e.readAnyArrayAndPush(this.entitys,e.readObjectId)}writeFile(e){e.write(1),e.writeAnyArray(this.entitys,e.writeObjectId)}});ra=y([S],ra)}},s={};function a(e){var t=s[e];if(void 0!==t)return t.exports;var i=s[e]={id:e,loaded:!1,exports:{}};return n[e].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}a.m=n,e=[],a.O=(t,i,r,n)=>{if(!i){var s=1/0;for(c=0;c<e.length;c++){for(var[i,r,n]=e[c],o=!0,l=0;l<i.length;l++)(!1&n||s>=n)&&Object.keys(a.O).every((e=>a.O[e](i[l])))?i.splice(l--,1):(o=!1,n<s&&(s=n));if(o){e.splice(c--,1);var h=r();void 0!==h&&(t=h)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[i,r,n]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},i=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,a.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var n=Object.create(null);a.r(n);var s={};t=t||[null,i({}),i([]),i(i)];for(var o=2&r&&e;"object"==typeof o&&!~t.indexOf(o);o=i(o))Object.getOwnPropertyNames(o).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,a.d(n,s),n},a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,i)=>(a.f[i](e,t),t)),[])),a.u=e=>"js/"+e+"."+{225:"a2646c8c",1743:"5ff1d528",2836:"f4277ff7",4584:"a968ed1d",4740:"cee2d805",6011:"27783f26",6037:"dd236a0b",6104:"7debe342",6244:"8343d48f",6395:"cfa68e00",9188:"f9d84175",9469:"b3e05bb0"}[e]+".js",a.miniCssF=e=>{},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},a.l=(e,t,i,n)=>{if(r[e])r[e].push(t);else{var s,o;if(void 0!==i)for(var l=document.getElementsByTagName("script"),h=0;h<l.length;h++){var c=l[h];if(c.getAttribute("src")==e){s=c;break}}s||(o=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.src=e),r[e]=[t];var u=(t,i)=>{s.onerror=s.onload=null,clearTimeout(d);var n=r[e];if(delete r[e],s.parentNode&&s.parentNode.removeChild(s),n&&n.forEach((e=>e(i))),t)return t(i)},d=setTimeout(u.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=u.bind(null,s.onerror),s.onload=u.bind(null,s.onload),o&&document.head.appendChild(s)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.j=4826,a.p="/",(()=>{var e={4826:0};a.f.j=(t,i)=>{var r=a.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var n=new Promise(((i,n)=>r=e[t]=[i,n]));i.push(r[2]=n);var s=a.p+a.u(t),o=new Error;a.l(s,(i=>{if(a.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var n=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+n+": "+s+")",o.name="ChunkLoadError",o.type=n,o.request=s,r[1](o)}}),"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,i)=>{var r,n,[s,o,l]=i,h=0;if(s.some((t=>0!==e[t]))){for(r in o)a.o(o,r)&&(a.m[r]=o[r]);if(l)var c=l(a)}for(t&&t(i);h<s.length;h++)n=s[h],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(c)},i=self.webpackChunk=self.webpackChunk||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var o=a.O(void 0,[8739,4326,8274,6471,8737,3336,4480,1461,6499,729,2338,4906,9669,3919,5877,2658,6133,9478,2617,8166,7911,1801,4637,7621,6023,3018,2386,5933,3714,8692,6405,7011,4848,3577,9560,6170,2429,7695,5623,7798,9057,103,6769,4868,3991,5557],(()=>a(96796)));o=a.O(o)})();