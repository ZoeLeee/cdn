"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6133],{40185:(e,t,r)=>{r.d(t,{s:()=>n});var n=function(){function e(){this.reset()}return e.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=e.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=e.KEEP,this.opDepthFail=e.KEEP,this.opStencilDepthPass=e.REPLACE},Object.defineProperty(e.prototype,"stencilFunc",{get:function(){return this.func},set:function(e){this.func=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncRef",{get:function(){return this.funcRef},set:function(e){this.funcRef=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncMask",{get:function(){return this.funcMask},set:function(e){this.funcMask=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilFail",{get:function(){return this.opStencilFail},set:function(e){this.opStencilFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpDepthFail",{get:function(){return this.opDepthFail},set:function(e){this.opDepthFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilDepthPass",{get:function(){return this.opStencilDepthPass},set:function(e){this.opStencilDepthPass=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilMask",{get:function(){return this.mask},set:function(e){this.mask=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilTest",{get:function(){return this.enabled},set:function(e){this.enabled=e},enumerable:!1,configurable:!0}),e.ALWAYS=519,e.KEEP=7680,e.REPLACE=7681,e}()},61625:(e,t,r)=>{r.d(t,{C:()=>n});var n=function(){function e(e){void 0===e&&(e=!0),this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"func",{get:function(){return this._func},set:function(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcRef",{get:function(){return this._funcRef},set:function(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcMask",{get:function(){return this._funcMask},set:function(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var e;this.stencilMaterial=void 0,null===(e=this.stencilGlobal)||void 0===e||e.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},e.prototype.apply=function(e){var t;if(e){var r=!this.useStencilGlobalOnly&&!!(null===(t=this.stencilMaterial)||void 0===t?void 0:t.enabled);this.enabled=r?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=r?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=r?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=r?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=r?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=r?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=r?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=r?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}},e}()},41388:(e,t,r)=>{r.d(t,{F:()=>n});var n=function(){function e(e){this._xrSessionManager=e,this._attached=!1,this._removeOnDetach=[],this.isDisposed=!1,this.disableAutoAttach=!1,this.xrNativeFeatureName=""}return Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},enumerable:!1,configurable:!0}),e.prototype.attach=function(e){var t=this;if(this.isDisposed)return!1;if(e)this.attached&&this.detach();else if(this.attached)return!1;return this._attached=!0,this._addNewAttachObserver(this._xrSessionManager.onXRFrameObservable,(function(e){return t._onXRFrame(e)})),!0},e.prototype.detach=function(){return this._attached?(this._attached=!1,this._removeOnDetach.forEach((function(e){e.observable.remove(e.observer)})),!0):(this.disableAutoAttach=!0,!1)},e.prototype.dispose=function(){this.detach(),this.isDisposed=!0},e.prototype.isCompatible=function(){return!0},e.prototype._addNewAttachObserver=function(e,t){this._removeOnDetach.push({observable:e,observer:e.add(t)})},e}()},59237:(e,t,r)=>{r.d(t,{S:()=>g});var n=r(31191),i=r(2914),o=r(58095),s=r(15631),a=r(43048),l=r(3085),c=r(62845),h=r(49353),u=r(1316),d=r(5292),p=r(41388),_=r(85527),f=r(66513),m=r(13514),g=function(e){function t(r,n){var i=e.call(this,r)||this;return i._options=n,i._attachController=function(e){if(!i._controllers[e.uniqueId]){var r=i._generateNewMeshPair(e.pointer),n=r.laserPointer,s=r.selectionMesh;switch(i._controllers[e.uniqueId]={xrController:e,laserPointer:n,selectionMesh:s,meshUnderPointer:null,pick:null,tmpRay:new u.z(new o.P,new o.P),disabledByNearInteraction:!1,id:t._IdCounter++},i._attachedController?!i._options.enablePointerSelectionOnAllControllers&&i._options.preferredHandedness&&e.inputSource.handedness===i._options.preferredHandedness&&(i._attachedController=e.uniqueId):i._options.enablePointerSelectionOnAllControllers||(i._attachedController=e.uniqueId),e.inputSource.targetRayMode){case"tracked-pointer":return i._attachTrackedPointerRayMode(e);case"gaze":return i._attachGazeMode(e);case"screen":return i._attachScreenRayMode(e)}}},i._controllers={},i._tmpVectorForPickCompare=new o.P,i.disablePointerLighting=!0,i.disableSelectionMeshLighting=!0,i.displayLaserPointer=!0,i.displaySelectionMesh=!0,i.laserPointerPickedColor=new s.Wo(.9,.9,.9),i.laserPointerDefaultColor=new s.Wo(.7,.7,.7),i.selectionMeshDefaultColor=new s.Wo(.8,.8,.8),i.selectionMeshPickedColor=new s.Wo(.3,.3,1),i._identityMatrix=o.y3.Identity(),i._screenCoordinatesRef=o.P.Zero(),i._viewportRef=new f.l(0,0,0,0),i._scene=i._xrSessionManager.scene,i}return(0,n.ZT)(t,e),t.prototype.attach=function(){var r=this;if(!e.prototype.attach.call(this))return!1;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(function(e){r._detachController(e.uniqueId)})),this._scene.constantlyUpdateMeshUnderPointer=!0,this._options.gazeCamera){var n=this._options.gazeCamera,i=this._generateNewMeshPair(n),s=i.laserPointer,a=i.selectionMesh;this._controllers.camera={webXRCamera:n,laserPointer:s,selectionMesh:a,meshUnderPointer:null,pick:null,tmpRay:new u.z(new o.P,new o.P),disabledByNearInteraction:!1,id:t._IdCounter++},this._attachGazeMode()}return!0},t.prototype.detach=function(){var t=this;return!!e.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach((function(e){t._detachController(e)})),!0)},t.prototype.getMeshUnderPointer=function(e){return this._controllers[e]?this._controllers[e].meshUnderPointer:null},t.prototype.getXRControllerByPointerId=function(e){for(var t=Object.keys(this._controllers),r=0;r<t.length;++r)if(this._controllers[t[r]].id===e)return this._controllers[t[r]].xrController||null;return null},t.prototype._getPointerSelectionDisabledByPointerId=function(e){for(var t=Object.keys(this._controllers),r=0;r<t.length;++r)if(this._controllers[t[r]].id===e)return this._controllers[t[r]].disabledByNearInteraction;return!0},t.prototype._setPointerSelectionDisabledByPointerId=function(e,t){for(var r=Object.keys(this._controllers),n=0;n<r.length;++n)if(this._controllers[r[n]].id===e)return void(this._controllers[r[n]].disabledByNearInteraction=t)},t.prototype._onXRFrame=function(e){var t=this;Object.keys(this._controllers).forEach((function(e){var r,n=t._controllers[e];if(!t._options.enablePointerSelectionOnAllControllers&&e!==t._attachedController||n.disabledByNearInteraction)return n.selectionMesh.isVisible=!1,n.laserPointer.isVisible=!1,void(n.pick=null);if(n.laserPointer.isVisible=t.displayLaserPointer,n.xrController)r=n.xrController.pointer.position,n.xrController.getWorldPointerRayToRef(n.tmpRay);else{if(!n.webXRCamera)return;r=n.webXRCamera.position,n.webXRCamera.getForwardRayToRef(n.tmpRay)}if(t._options.maxPointerDistance&&(n.tmpRay.length=t._options.maxPointerDistance),!t._options.disableScenePointerVectorUpdate&&r){var i=t._xrSessionManager.scene,s=t._options.xrInput.xrCamera;s&&(s.viewport.toGlobalToRef(i.getEngine().getRenderWidth(),i.getEngine().getRenderHeight(),t._viewportRef),o.P.ProjectToRef(r,t._identityMatrix,i.getTransformMatrix(),t._viewportRef,t._screenCoordinatesRef),"number"!=typeof t._screenCoordinatesRef.x||"number"!=typeof t._screenCoordinatesRef.y||isNaN(t._screenCoordinatesRef.x)||isNaN(t._screenCoordinatesRef.y)||(i.pointerX=t._screenCoordinatesRef.x,i.pointerY=t._screenCoordinatesRef.y,n.screenCoordinates={x:t._screenCoordinatesRef.x,y:t._screenCoordinatesRef.y}))}var l=null;t._utilityLayerScene&&(l=t._utilityLayerScene.pickWithRay(n.tmpRay,t._utilityLayerScene.pointerMovePredicate||t.raySelectionPredicate));var c=t._scene.pickWithRay(n.tmpRay,t._scene.pointerMovePredicate||t.raySelectionPredicate);l&&l.hit?c&&c.hit?l.distance<c.distance?n.pick=l:n.pick=c:n.pick=l:n.pick=c,n.pick&&n.xrController&&(n.pick.aimTransform=n.xrController.pointer,n.pick.gripTransform=n.xrController.grip||null);var h=n.pick;if(h&&h.pickedPoint&&h.hit){t._updatePointerDistance(n.laserPointer,h.distance),n.selectionMesh.position.copyFrom(h.pickedPoint),n.selectionMesh.scaling.x=Math.sqrt(h.distance),n.selectionMesh.scaling.y=Math.sqrt(h.distance),n.selectionMesh.scaling.z=Math.sqrt(h.distance);var u=t._convertNormalToDirectionOfRay(h.getNormal(!0),n.tmpRay);if(n.selectionMesh.position.copyFrom(h.pickedPoint),u){var d=o.P.Cross(a.RD.Y,u),p=o.P.Cross(u,d);o.P.RotationFromAxisToRef(p,u,d,n.selectionMesh.rotation),n.selectionMesh.position.addInPlace(u.scale(.001))}n.selectionMesh.isVisible=t.displaySelectionMesh,n.meshUnderPointer=h.pickedMesh}else n.selectionMesh.isVisible=!1,t._updatePointerDistance(n.laserPointer,1),n.meshUnderPointer=null}))},Object.defineProperty(t.prototype,"_utilityLayerScene",{get:function(){return this._options.customUtilityLayerScene||_.x.DefaultUtilityLayer.utilityLayerScene},enumerable:!1,configurable:!0}),t.prototype._attachGazeMode=function(e){var t=this,r=this._controllers[e&&e.uniqueId||"camera"],n=this._options.timeToSelect||3e3,i=this._options.useUtilityLayer?this._utilityLayerScene:this._scene,o=new d.p,s=(0,h.eu)("selection",{diameter:.0525,thickness:.015,tessellation:20},i);s.isVisible=!1,s.isPickable=!1,s.parent=r.selectionMesh;var a=0,l=!1,c={pointerId:r.id,pointerType:"xr"};r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((function(){if(r.pick){if(t._augmentPointerInit(c,r.id,r.screenCoordinates),r.laserPointer.material.alpha=0,s.isVisible=!1,r.pick.hit)if(t._pickingMoved(o,r.pick))l&&(t._options.disablePointerUpOnTouchOut||t._scene.simulatePointerUp(r.pick,c)),l=!1,a=0;else if(a>n/10&&(s.isVisible=!0),(a+=t._scene.getEngine().getDeltaTime())>=n)t._scene.simulatePointerDown(r.pick,c),l=!0,t._options.disablePointerUpOnTouchOut&&t._scene.simulatePointerUp(r.pick,c),s.isVisible=!1;else{var e=1-a/n;s.scaling.set(e,e,e)}else l=!1,a=0;t._scene.simulatePointerMove(r.pick,c),o=r.pick}})),void 0!==this._options.renderingGroupId&&(s.renderingGroupId=this._options.renderingGroupId),e&&e.onDisposeObservable.addOnce((function(){r.pick&&!t._options.disablePointerUpOnTouchOut&&l&&(t._scene.simulatePointerUp(r.pick,c),r.finalPointerUpTriggered=!0),s.dispose()}))},t.prototype._attachScreenRayMode=function(e){var t=this,r=this._controllers[e.uniqueId],n=!1,i={pointerId:r.id,pointerType:"xr"};r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((function(){t._augmentPointerInit(i,r.id,r.screenCoordinates),!r.pick||t._options.disablePointerUpOnTouchOut&&n||(n?t._scene.simulatePointerMove(r.pick,i):(t._scene.simulatePointerDown(r.pick,i),r.pointerDownTriggered=!0,n=!0,t._options.disablePointerUpOnTouchOut&&t._scene.simulatePointerUp(r.pick,i)))})),e.onDisposeObservable.addOnce((function(){t._augmentPointerInit(i,r.id,r.screenCoordinates),t._xrSessionManager.runInXRFrame((function(){r.pick&&!r.finalPointerUpTriggered&&n&&!t._options.disablePointerUpOnTouchOut&&(t._scene.simulatePointerUp(r.pick,i),r.finalPointerUpTriggered=!0)}))}))},t.prototype._attachTrackedPointerRayMode=function(e){var t=this,r=this._controllers[e.uniqueId];if(this._options.forceGazeMode)return this._attachGazeMode(e);var n={pointerId:r.id,pointerType:"xr"};if(r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((function(){r.laserPointer.material.disableLighting=t.disablePointerLighting,r.selectionMesh.material.disableLighting=t.disableSelectionMeshLighting,r.pick&&(t._augmentPointerInit(n,r.id,r.screenCoordinates),t._scene.simulatePointerMove(r.pick,n))})),e.inputSource.gamepad){var i=function(i){t._options.overrideButtonId&&(r.selectionComponent=i.getComponent(t._options.overrideButtonId)),r.selectionComponent||(r.selectionComponent=i.getMainComponent()),r.onButtonChangedObserver=r.selectionComponent.onButtonStateChangedObservable.add((function(i){if(i.changes.pressed){var o=i.changes.pressed.current;r.pick?(t._options.enablePointerSelectionOnAllControllers||e.uniqueId===t._attachedController)&&(t._augmentPointerInit(n,r.id,r.screenCoordinates),o?(t._scene.simulatePointerDown(r.pick,n),r.pointerDownTriggered=!0,r.selectionMesh.material.emissiveColor=t.selectionMeshPickedColor,r.laserPointer.material.emissiveColor=t.laserPointerPickedColor):(t._scene.simulatePointerUp(r.pick,n),r.selectionMesh.material.emissiveColor=t.selectionMeshDefaultColor,r.laserPointer.material.emissiveColor=t.laserPointerDefaultColor)):!o||t._options.enablePointerSelectionOnAllControllers||t._options.disableSwitchOnClick||(t._attachedController=e.uniqueId)}}))};e.motionController?i(e.motionController):e.onMotionControllerInitObservable.add(i)}else{var o=function(e){t._augmentPointerInit(n,r.id,r.screenCoordinates),r.xrController&&e.inputSource===r.xrController.inputSource&&r.pick&&(t._scene.simulatePointerDown(r.pick,n),r.pointerDownTriggered=!0,r.selectionMesh.material.emissiveColor=t.selectionMeshPickedColor,r.laserPointer.material.emissiveColor=t.laserPointerPickedColor)},s=function(e){t._augmentPointerInit(n,r.id,r.screenCoordinates),r.xrController&&e.inputSource===r.xrController.inputSource&&r.pick&&(t._scene.simulatePointerUp(r.pick,n),r.selectionMesh.material.emissiveColor=t.selectionMeshDefaultColor,r.laserPointer.material.emissiveColor=t.laserPointerDefaultColor)};r.eventListeners={selectend:s,selectstart:o},this._xrSessionManager.session.addEventListener("selectstart",o),this._xrSessionManager.session.addEventListener("selectend",s)}},t.prototype._convertNormalToDirectionOfRay=function(e,t){e&&(Math.acos(o.P.Dot(e,t.direction))<Math.PI/2&&e.scaleInPlace(-1));return e},t.prototype._detachController=function(e){var t=this,r=this._controllers[e];if(r){if(r.selectionComponent&&r.onButtonChangedObserver&&r.selectionComponent.onButtonStateChangedObservable.remove(r.onButtonChangedObserver),r.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(r.onFrameObserver),r.eventListeners&&Object.keys(r.eventListeners).forEach((function(e){var n=r.eventListeners&&r.eventListeners[e];n&&t._xrSessionManager.session.removeEventListener(e,n)})),!r.finalPointerUpTriggered&&r.pointerDownTriggered){var n={pointerId:r.id,pointerType:"xr"};this._xrSessionManager.runInXRFrame((function(){t._augmentPointerInit(n,r.id,r.screenCoordinates),t._scene.simulatePointerUp(r.pick||new d.p,n),r.finalPointerUpTriggered=!0}))}this._xrSessionManager.scene.onBeforeRenderObservable.addOnce((function(){try{if(r.selectionMesh.dispose(),r.laserPointer.dispose(),delete t._controllers[e],t._attachedController===e){var n=Object.keys(t._controllers);n.length?t._attachedController=n[0]:t._attachedController=""}}catch(e){m.w1.Warn("controller already detached.")}}))}},t.prototype._generateNewMeshPair=function(e){var t=this._options.useUtilityLayer?this._options.customUtilityLayerScene||_.x.DefaultUtilityLayer.utilityLayerScene:this._scene,r=this._options.customLasterPointerMeshGenerator?this._options.customLasterPointerMeshGenerator():(0,c.wf)("laserPointer",{height:1,diameterTop:2e-4,diameterBottom:.004,tessellation:20,subdivisions:1},t);r.parent=e;var n=new l.K("laserPointerMat",t);n.emissiveColor=this.laserPointerDefaultColor,n.alpha=.7,r.material=n,r.rotation.x=Math.PI/2,this._updatePointerDistance(r,1),r.isPickable=!1,r.isVisible=!1;var i=this._options.customSelectionMeshGenerator?this._options.customSelectionMeshGenerator():(0,h.eu)("gazeTracker",{diameter:.0105,thickness:.0075,tessellation:20},t);i.bakeCurrentTransformIntoVertices(),i.isPickable=!1,i.isVisible=!1;var o=new l.K("targetMat",t);return o.specularColor=s.Wo.Black(),o.emissiveColor=this.selectionMeshDefaultColor,o.backFaceCulling=!1,i.material=o,void 0!==this._options.renderingGroupId&&(r.renderingGroupId=this._options.renderingGroupId,i.renderingGroupId=this._options.renderingGroupId),{laserPointer:r,selectionMesh:i}},t.prototype._pickingMoved=function(e,t){var r;if(!e.hit||!t.hit)return!0;if(!(e.pickedMesh&&e.pickedPoint&&t.pickedMesh&&t.pickedPoint))return!0;if(e.pickedMesh!==t.pickedMesh)return!0;null===(r=e.pickedPoint)||void 0===r||r.subtractToRef(t.pickedPoint,this._tmpVectorForPickCompare),this._tmpVectorForPickCompare.set(Math.abs(this._tmpVectorForPickCompare.x),Math.abs(this._tmpVectorForPickCompare.y),Math.abs(this._tmpVectorForPickCompare.z));var n=.01*(this._options.gazeModePointerMovedFactor||1)*t.distance;return this._tmpVectorForPickCompare.length()>n},t.prototype._updatePointerDistance=function(e,t){void 0===t&&(t=100),e.scaling.y=t,this._scene.useRightHandedSystem&&(t*=-1),e.position.z=t/2+.05},t.prototype._augmentPointerInit=function(e,t,r){e.pointerId=t,e.pointerType="xr",r&&(e.screenX=r.x,e.screenY=r.y)},Object.defineProperty(t.prototype,"lasterPointerDefaultColor",{get:function(){return this.laserPointerDefaultColor},enumerable:!1,configurable:!0}),t._IdCounter=200,t.Name=i.b.POINTER_SELECTION,t.Version=1,t}(p.F);i.d.AddWebXRFeature(g.Name,(function(e,t){return function(){return new g(e,t)}}),g.Version,!0)},54774:(e,t,r)=>{r.d(t,{z:()=>x});var n=r(31191),i=r(2914),o=r(62897),s=r(23845),a=r(58095),l=r(1316),c=r(93980),h=r(62845),u=r(88916),d=r(18770),p=r(43048),_=r(3085),f=r(41525),m=r(49353),g=r(74742),v=r(9866),y=r(41388),b=r(15631),R=r(85527),C=r(76324),M=r(16433),x=function(e){function t(t,r){var n=e.call(this,t)||this;return n._options=r,n._controllers={},n._snappedToPoint=!1,n._tmpRay=new l.z(new a.P,new a.P),n._tmpVector=new a.P,n._tmpQuaternion=new a._f,n.skipNextTeleportation=!1,n.backwardsMovementEnabled=!0,n.backwardsTeleportationDistance=.7,n.parabolicCheckRadius=5,n.parabolicRayEnabled=!0,n.straightRayEnabled=!0,n.rotationAngle=Math.PI/8,n.onTargetMeshPositionUpdatedObservable=new o.y$,n.teleportationEnabled=!0,n._rotationEnabled=!0,n._attachController=function(e){if(!(n._controllers[e.uniqueId]||n._options.forceHandedness&&e.inputSource.handedness!==n._options.forceHandedness)){n._controllers[e.uniqueId]={xrController:e,teleportationState:{forward:!1,backwards:!1,rotating:!1,currentRotation:0,baseRotation:0}};var t=n._controllers[e.uniqueId];if("tracked-pointer"===t.xrController.inputSource.targetRayMode&&t.xrController.inputSource.gamepad){var r=function(){if(e.motionController){var r=e.motionController.getComponentOfType(s.n.THUMBSTICK_TYPE)||e.motionController.getComponentOfType(s.n.TOUCHPAD_TYPE);if(!r||n._options.useMainComponentOnly){var i=e.motionController.getMainComponent();if(!i)return;t.teleportationComponent=i,t.onButtonChangedObserver=i.onButtonStateChangedObservable.add((function(){if(n.teleportationEnabled&&i.changes.pressed)if(i.changes.pressed.current){t.teleportationState.forward=!0,n._currentTeleportationControllerId=t.xrController.uniqueId,t.teleportationState.baseRotation=n._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,t.teleportationState.currentRotation=0;var r=n._options.timeToTeleport||3e3;(0,M.g_)({timeout:r,contextObservable:n._xrSessionManager.onXRFrameObservable,breakCondition:function(){return!i.pressed},onEnded:function(){n._currentTeleportationControllerId===t.xrController.uniqueId&&t.teleportationState.forward&&n._teleportForward(e.uniqueId)}})}else t.teleportationState.forward=!1,n._currentTeleportationControllerId=""}))}else t.teleportationComponent=r,t.onAxisChangedObserver=r.onAxisValueChangedObservable.add((function(r){if(r.y<=.7&&t.teleportationState.backwards&&(t.teleportationState.backwards=!1),r.y>.7&&!t.teleportationState.forward&&n.backwardsMovementEnabled&&!n.snapPointsOnly&&!t.teleportationState.backwards){t.teleportationState.backwards=!0,n._tmpQuaternion.copyFrom(n._options.xrInput.xrCamera.rotationQuaternion),n._tmpQuaternion.toEulerAnglesToRef(n._tmpVector),n._tmpVector.x=0,n._tmpVector.z=0,a._f.FromEulerVectorToRef(n._tmpVector,n._tmpQuaternion),n._tmpVector.set(0,0,n.backwardsTeleportationDistance*(n._xrSessionManager.scene.useRightHandedSystem?1:-1)),n._tmpVector.rotateByQuaternionToRef(n._tmpQuaternion,n._tmpVector),n._tmpVector.addInPlace(n._options.xrInput.xrCamera.position),n._tmpRay.origin.copyFrom(n._tmpVector),n._tmpRay.length=n._options.xrInput.xrCamera.realWorldHeight+.1,n._tmpRay.direction.set(0,-1,0);var i=n._xrSessionManager.scene.pickWithRay(n._tmpRay,(function(e){return-1!==n._floorMeshes.indexOf(e)}));i&&i.pickedPoint&&(n._options.xrInput.xrCamera.position.x=i.pickedPoint.x,n._options.xrInput.xrCamera.position.z=i.pickedPoint.z)}if(r.y<-.7&&!n._currentTeleportationControllerId&&!t.teleportationState.rotating&&n.teleportationEnabled&&(t.teleportationState.forward=!0,n._currentTeleportationControllerId=t.xrController.uniqueId,t.teleportationState.baseRotation=n._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y),r.x){if(t.teleportationState.forward)n._currentTeleportationControllerId===t.xrController.uniqueId&&(n.rotationEnabled?setTimeout((function(){t.teleportationState.currentRotation=Math.atan2(r.x,r.y*(n._xrSessionManager.scene.useRightHandedSystem?1:-1))})):t.teleportationState.currentRotation=0);else if(!t.teleportationState.rotating&&Math.abs(r.x)>.7){t.teleportationState.rotating=!0;var o=n.rotationAngle*(r.x>0?1:-1)*(n._xrSessionManager.scene.useRightHandedSystem?-1:1);a._f.FromEulerAngles(0,o,0).multiplyToRef(n._options.xrInput.xrCamera.rotationQuaternion,n._options.xrInput.xrCamera.rotationQuaternion)}}else t.teleportationState.rotating=!1;0===r.x&&0===r.y&&t.teleportationState.forward&&n._teleportForward(e.uniqueId)}))}};e.motionController?r():e.onMotionControllerInitObservable.addOnce((function(){r()}))}else n._xrSessionManager.scene.onPointerObservable.add((function(r){if(r.type===C.kD.POINTERDOWN){t.teleportationState.forward=!0,n._currentTeleportationControllerId=t.xrController.uniqueId,t.teleportationState.baseRotation=n._options.xrInput.xrCamera.rotationQuaternion.toEulerAngles().y,t.teleportationState.currentRotation=0;var i=n._options.timeToTeleport||3e3;(0,M.g_)({timeout:i,contextObservable:n._xrSessionManager.onXRFrameObservable,onEnded:function(){n._currentTeleportationControllerId===t.xrController.uniqueId&&t.teleportationState.forward&&n._teleportForward(e.uniqueId)}})}else r.type===C.kD.POINTERUP&&(t.teleportationState.forward=!1,n._currentTeleportationControllerId="")}))}},n._options.teleportationTargetMesh||n._createDefaultTargetMesh(),n._floorMeshes=n._options.floorMeshes||[],n._snapToPositions=n._options.snapPositions||[],n._setTargetMeshVisibility(!1),n}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"rotationEnabled",{get:function(){return this._rotationEnabled},set:function(e){if(this._rotationEnabled=e,this._options.teleportationTargetMesh){var t=this._options.teleportationTargetMesh.getChildMeshes(!1,(function(e){return"rotationCone"===e.name}));t[0]&&t[0].setEnabled(e)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"teleportationTargetMesh",{get:function(){return this._options.teleportationTargetMesh||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapPointsOnly",{get:function(){return!!this._options.snapPointsOnly},set:function(e){this._options.snapPointsOnly=e},enumerable:!1,configurable:!0}),t.prototype.addFloorMesh=function(e){this._floorMeshes.push(e)},t.prototype.addBlockerMesh=function(e){this._options.pickBlockerMeshes=this._options.pickBlockerMeshes||[],this._options.pickBlockerMeshes.push(e)},t.prototype.addSnapPoint=function(e){this._snapToPositions.push(e)},t.prototype.attach=function(){var t=this;return!!e.prototype.attach.call(this)&&(this._currentTeleportationControllerId="",this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(function(e){t._detachController(e.uniqueId)})),!0)},t.prototype.detach=function(){var t=this;return!!e.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach((function(e){t._detachController(e)})),this._setTargetMeshVisibility(!1),this._currentTeleportationControllerId="",this._controllers={},!0)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.dispose(!1,!0)},t.prototype.removeFloorMesh=function(e){var t=this._floorMeshes.indexOf(e);-1!==t&&this._floorMeshes.splice(t,1)},t.prototype.removeBlockerMesh=function(e){this._options.pickBlockerMeshes=this._options.pickBlockerMeshes||[];var t=this._options.pickBlockerMeshes.indexOf(e);-1!==t&&this._options.pickBlockerMeshes.splice(t,1)},t.prototype.removeFloorMeshByName=function(e){var t=this._xrSessionManager.scene.getMeshByName(e);t&&this.removeFloorMesh(t)},t.prototype.removeSnapPoint=function(e){var t=this._snapToPositions.indexOf(e);if(-1===t)for(var r=0;r<this._snapToPositions.length;++r)if(this._snapToPositions[r].equals(e)){t=r;break}return-1!==t&&(this._snapToPositions.splice(t,1),!0)},t.prototype.setSelectionFeature=function(e){this._selectionFeature=e},t.prototype._onXRFrame=function(e){var t=this,r=this._xrSessionManager.currentFrame,n=this._xrSessionManager.scene;if(this.attach&&r){var i=this._options.teleportationTargetMesh;if(this._currentTeleportationControllerId){if(!i)return;i.rotationQuaternion=i.rotationQuaternion||new a._f;var o=this._controllers[this._currentTeleportationControllerId];if(o&&o.teleportationState.forward){a._f.RotationYawPitchRollToRef(o.teleportationState.currentRotation+o.teleportationState.baseRotation,0,0,i.rotationQuaternion);var s=!1;if(o.xrController.getWorldPointerRayToRef(this._tmpRay),this.straightRayEnabled){if((l=n.pickWithRay(this._tmpRay,(function(e){if(t._options.pickBlockerMeshes&&-1!==t._options.pickBlockerMeshes.indexOf(e))return!0;var r=t._floorMeshes.indexOf(e);return-1!==r&&t._floorMeshes[r].absolutePosition.y<t._options.xrInput.xrCamera.globalPosition.y})))&&l.pickedMesh&&this._options.pickBlockerMeshes&&-1!==this._options.pickBlockerMeshes.indexOf(l.pickedMesh))return;l&&l.pickedPoint&&(s=!0,this._setTargetMeshPosition(l),this._setTargetMeshVisibility(!0),this._showParabolicPath(l))}if(this.parabolicRayEnabled&&!s){var l,c=o.xrController.pointer.rotationQuaternion.toEulerAngles().x,h=Math.PI/2-Math.abs(c)+1,u=this.parabolicCheckRadius*h;if(this._tmpRay.origin.addToRef(this._tmpRay.direction.scale(2*u),this._tmpVector),this._tmpVector.y=this._tmpRay.origin.y,this._tmpRay.origin.addInPlace(this._tmpRay.direction.scale(u)),this._tmpVector.subtractToRef(this._tmpRay.origin,this._tmpRay.direction),this._tmpRay.direction.normalize(),(l=n.pickWithRay(this._tmpRay,(function(e){return!(!t._options.pickBlockerMeshes||-1===t._options.pickBlockerMeshes.indexOf(e))||-1!==t._floorMeshes.indexOf(e)})))&&l.pickedMesh&&this._options.pickBlockerMeshes&&-1!==this._options.pickBlockerMeshes.indexOf(l.pickedMesh))return;l&&l.pickedPoint&&(s=!0,this._setTargetMeshPosition(l),this._setTargetMeshVisibility(!0),this._showParabolicPath(l))}this._setTargetMeshVisibility(s)}else this._setTargetMeshVisibility(!1)}else this._setTargetMeshVisibility(!1)}},t.prototype._createDefaultTargetMesh=function(){this._options.defaultTargetMeshOptions=this._options.defaultTargetMeshOptions||{};var e=this._options.useUtilityLayer?this._options.customUtilityLayerScene||R.x.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,t=(0,f.$6)("teleportationTarget",{width:2,height:2,subdivisions:2},e);t.isPickable=!1;var r=new c.c("teleportationPlaneDynamicTexture",512,e,!0);r.hasAlpha=!0;var n=r.getContext();n.beginPath(),n.arc(256,256,200,0,2*Math.PI,!1),n.fillStyle=this._options.defaultTargetMeshOptions.teleportationFillColor||"#444444",n.fill(),n.lineWidth=10,n.strokeStyle=this._options.defaultTargetMeshOptions.teleportationBorderColor||"#FFFFFF",n.stroke(),n.closePath(),r.update();var i=new _.K("teleportationPlaneMaterial",e);i.diffuseTexture=r,t.material=i;var o=(0,m.eu)("torusTeleportation",{diameter:.75,thickness:.1,tessellation:20},e);if(o.isPickable=!1,o.parent=t,!this._options.defaultTargetMeshOptions.disableAnimation){var s=new d.f("animationInnerCircle","position.y",30,d.f.ANIMATIONTYPE_FLOAT,d.f.ANIMATIONLOOPMODE_CYCLE),a=[];a.push({frame:0,value:0}),a.push({frame:30,value:.4}),a.push({frame:60,value:0}),s.setKeys(a);var l=new u.bi;l.setEasingMode(u.Kp.EASINGMODE_EASEINOUT),s.setEasingFunction(l),o.animations=[],o.animations.push(s),e.beginAnimation(o,0,60,!0)}var g=(0,h.wf)("rotationCone",{diameterTop:0,tessellation:4},e);if(g.isPickable=!1,g.scaling.set(.5,.12,.2),g.rotate(p.RD.X,Math.PI/2),g.position.z=.6,g.parent=o,this._options.defaultTargetMeshOptions.torusArrowMaterial)o.material=this._options.defaultTargetMeshOptions.torusArrowMaterial,g.material=this._options.defaultTargetMeshOptions.torusArrowMaterial;else{var v=new _.K("torusConsMat",e);v.disableLighting=!!this._options.defaultTargetMeshOptions.disableLighting,v.disableLighting?v.emissiveColor=new b.Wo(.3,.3,1):v.diffuseColor=new b.Wo(.3,.3,1),v.alpha=.9,o.material=v,g.material=v,this._teleportationRingMaterial=v}void 0!==this._options.renderingGroupId&&(t.renderingGroupId=this._options.renderingGroupId,o.renderingGroupId=this._options.renderingGroupId,g.renderingGroupId=this._options.renderingGroupId),this._options.teleportationTargetMesh=t},t.prototype._detachController=function(e){var t=this._controllers[e];t&&(t.teleportationComponent&&(t.onAxisChangedObserver&&t.teleportationComponent.onAxisValueChangedObservable.remove(t.onAxisChangedObserver),t.onButtonChangedObserver&&t.teleportationComponent.onButtonStateChangedObservable.remove(t.onButtonChangedObserver)),delete this._controllers[e])},t.prototype._findClosestSnapPointWithRadius=function(e,t){void 0===t&&(t=this._options.snapToPositionRadius||.8);var r=null,n=Number.MAX_VALUE;if(this._snapToPositions.length){var i=t*t;this._snapToPositions.forEach((function(t){var o=a.P.DistanceSquared(t,e);o<=i&&o<n&&(n=o,r=t)}))}return r},t.prototype._setTargetMeshPosition=function(e){var t=e.pickedPoint;if(this._options.teleportationTargetMesh&&t){var r=this._findClosestSnapPointWithRadius(t);this._snappedToPoint=!!r,this.snapPointsOnly&&!this._snappedToPoint&&this._teleportationRingMaterial?this._teleportationRingMaterial.diffuseColor.set(1,.3,.3):this.snapPointsOnly&&this._snappedToPoint&&this._teleportationRingMaterial&&this._teleportationRingMaterial.diffuseColor.set(.3,.3,1),this._options.teleportationTargetMesh.position.copyFrom(r||t),this._options.teleportationTargetMesh.position.y+=.01,this.onTargetMeshPositionUpdatedObservable.notifyObservers(e)}},t.prototype._setTargetMeshVisibility=function(e){this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible!==e&&(this._options.teleportationTargetMesh.isVisible=e,this._options.teleportationTargetMesh.getChildren(void 0,!1).forEach((function(t){t.isVisible=e})),e?this._selectionFeature&&this._selectionFeature.detach():(this._quadraticBezierCurve&&(this._quadraticBezierCurve.dispose(),this._quadraticBezierCurve=null),this._selectionFeature&&this._selectionFeature.attach()))},t.prototype._showParabolicPath=function(e){if(e.pickedPoint){var t=this._options.useUtilityLayer?this._options.customUtilityLayerScene||R.x.DefaultUtilityLayer.utilityLayerScene:this._xrSessionManager.scene,r=this._controllers[this._currentTeleportationControllerId],n=g.j_.CreateQuadraticBezier(r.xrController.pointer.absolutePosition,e.ray.origin,e.pickedPoint,25);this._options.generateRayPathMesh?this._quadraticBezierCurve=this._options.generateRayPathMesh(n.getPoints(),e):this._quadraticBezierCurve=(0,v.nL)("teleportation path line",{points:n.getPoints(),instance:this._quadraticBezierCurve,updatable:!0},t),this._quadraticBezierCurve.isPickable=!1,void 0!==this._options.renderingGroupId&&(this._quadraticBezierCurve.renderingGroupId=this._options.renderingGroupId)}},t.prototype._teleportForward=function(e){var t=this._controllers[e];if(t&&t.teleportationState.forward&&this.teleportationEnabled&&(t.teleportationState.forward=!1,this._currentTeleportationControllerId="",!this.snapPointsOnly||this._snappedToPoint))if(this.skipNextTeleportation)this.skipNextTeleportation=!1;else if(this._options.teleportationTargetMesh&&this._options.teleportationTargetMesh.isVisible){var r=this._options.xrInput.xrCamera.realWorldHeight;this._options.xrInput.xrCamera.onBeforeCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position),this._options.xrInput.xrCamera.position.copyFrom(this._options.teleportationTargetMesh.position),this._options.xrInput.xrCamera.position.y+=r,a._f.FromEulerAngles(0,t.teleportationState.currentRotation-(this._xrSessionManager.scene.useRightHandedSystem?Math.PI:0),0).multiplyToRef(this._options.xrInput.xrCamera.rotationQuaternion,this._options.xrInput.xrCamera.rotationQuaternion),this._options.xrInput.xrCamera.onAfterCameraTeleport.notifyObservers(this._options.xrInput.xrCamera.position)}},t.Name=i.b.TELEPORTATION,t.Version=1,t}(y.F);i.d.AddWebXRFeature(x.Name,(function(e,t){return function(){return new x(e,t)}}),x.Version,!0)},68942:(e,t,r)=>{r.d(t,{OF:()=>i,e0:()=>C,en:()=>M,xE:()=>o});var n,i,o,s=r(31191),a=r(41388),l=r(2914),c=r(58095),h=r(18737),u=r(62897),d=r(63407),p=r(15631),_=r(97163),f=r(98163),m=r(75298),g=r(30700),v=r(43048),y=r(15210);!function(e){e.WRIST="wrist",e.THUMB="thumb",e.INDEX="index",e.MIDDLE="middle",e.RING="ring",e.LITTLE="little"}(i||(i={})),function(e){e.WRIST="wrist",e.THUMB_METACARPAL="thumb-metacarpal",e.THUMB_PHALANX_PROXIMAL="thumb-phalanx-proximal",e.THUMB_PHALANX_DISTAL="thumb-phalanx-distal",e.THUMB_TIP="thumb-tip",e.INDEX_FINGER_METACARPAL="index-finger-metacarpal",e.INDEX_FINGER_PHALANX_PROXIMAL="index-finger-phalanx-proximal",e.INDEX_FINGER_PHALANX_INTERMEDIATE="index-finger-phalanx-intermediate",e.INDEX_FINGER_PHALANX_DISTAL="index-finger-phalanx-distal",e.INDEX_FINGER_TIP="index-finger-tip",e.MIDDLE_FINGER_METACARPAL="middle-finger-metacarpal",e.MIDDLE_FINGER_PHALANX_PROXIMAL="middle-finger-phalanx-proximal",e.MIDDLE_FINGER_PHALANX_INTERMEDIATE="middle-finger-phalanx-intermediate",e.MIDDLE_FINGER_PHALANX_DISTAL="middle-finger-phalanx-distal",e.MIDDLE_FINGER_TIP="middle-finger-tip",e.RING_FINGER_METACARPAL="ring-finger-metacarpal",e.RING_FINGER_PHALANX_PROXIMAL="ring-finger-phalanx-proximal",e.RING_FINGER_PHALANX_INTERMEDIATE="ring-finger-phalanx-intermediate",e.RING_FINGER_PHALANX_DISTAL="ring-finger-phalanx-distal",e.RING_FINGER_TIP="ring-finger-tip",e.PINKY_FINGER_METACARPAL="pinky-finger-metacarpal",e.PINKY_FINGER_PHALANX_PROXIMAL="pinky-finger-phalanx-proximal",e.PINKY_FINGER_PHALANX_INTERMEDIATE="pinky-finger-phalanx-intermediate",e.PINKY_FINGER_PHALANX_DISTAL="pinky-finger-phalanx-distal",e.PINKY_FINGER_TIP="pinky-finger-tip"}(o||(o={}));var b=[o.WRIST,o.THUMB_METACARPAL,o.THUMB_PHALANX_PROXIMAL,o.THUMB_PHALANX_DISTAL,o.THUMB_TIP,o.INDEX_FINGER_METACARPAL,o.INDEX_FINGER_PHALANX_PROXIMAL,o.INDEX_FINGER_PHALANX_INTERMEDIATE,o.INDEX_FINGER_PHALANX_DISTAL,o.INDEX_FINGER_TIP,o.MIDDLE_FINGER_METACARPAL,o.MIDDLE_FINGER_PHALANX_PROXIMAL,o.MIDDLE_FINGER_PHALANX_INTERMEDIATE,o.MIDDLE_FINGER_PHALANX_DISTAL,o.MIDDLE_FINGER_TIP,o.RING_FINGER_METACARPAL,o.RING_FINGER_PHALANX_PROXIMAL,o.RING_FINGER_PHALANX_INTERMEDIATE,o.RING_FINGER_PHALANX_DISTAL,o.RING_FINGER_TIP,o.PINKY_FINGER_METACARPAL,o.PINKY_FINGER_PHALANX_PROXIMAL,o.PINKY_FINGER_PHALANX_INTERMEDIATE,o.PINKY_FINGER_PHALANX_DISTAL,o.PINKY_FINGER_TIP],R=((n={})[i.WRIST]=[o.WRIST],n[i.THUMB]=[o.THUMB_METACARPAL,o.THUMB_PHALANX_PROXIMAL,o.THUMB_PHALANX_DISTAL,o.THUMB_TIP],n[i.INDEX]=[o.INDEX_FINGER_METACARPAL,o.INDEX_FINGER_PHALANX_PROXIMAL,o.INDEX_FINGER_PHALANX_INTERMEDIATE,o.INDEX_FINGER_PHALANX_DISTAL,o.INDEX_FINGER_TIP],n[i.MIDDLE]=[o.MIDDLE_FINGER_METACARPAL,o.MIDDLE_FINGER_PHALANX_PROXIMAL,o.MIDDLE_FINGER_PHALANX_INTERMEDIATE,o.MIDDLE_FINGER_PHALANX_DISTAL,o.MIDDLE_FINGER_TIP],n[i.RING]=[o.RING_FINGER_METACARPAL,o.RING_FINGER_PHALANX_PROXIMAL,o.RING_FINGER_PHALANX_INTERMEDIATE,o.RING_FINGER_PHALANX_DISTAL,o.RING_FINGER_TIP],n[i.LITTLE]=[o.PINKY_FINGER_METACARPAL,o.PINKY_FINGER_PHALANX_PROXIMAL,o.PINKY_FINGER_PHALANX_INTERMEDIATE,o.PINKY_FINGER_PHALANX_DISTAL,o.PINKY_FINGER_TIP],n),C=function(){function e(e,t,r,n,i,o,s){void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===s&&(s=1),this.xrController=e,this._jointMeshes=t,this._handMesh=r,this.rigMapping=n,this._leftHandedMeshes=i,this._jointsInvisible=o,this._jointScaleFactor=s,this._jointTransforms=new Array(b.length),this._jointTransformMatrices=new Float32Array(16*b.length),this._tempJointMatrix=new c.y3,this._jointRadii=new Float32Array(b.length),this._scene=t[0].getScene();for(var a=0;a<this._jointTransforms.length;a++){(this._jointTransforms[a]=new g.Y(b[a],this._scene)).rotationQuaternion=new c._f,t[a].rotationQuaternion=new c._f}r&&this.setHandMesh(r,n),this.xrController.motionController&&(this.xrController.motionController.rootMesh?this.xrController.motionController.rootMesh.setEnabled(!1):this.xrController.motionController.onModelLoadedObservable.add((function(e){e.rootMesh&&e.rootMesh.setEnabled(!1)}))),this.xrController.onMotionControllerInitObservable.add((function(e){e.onModelLoadedObservable.add((function(e){e.rootMesh&&e.rootMesh.setEnabled(!1)})),e.rootMesh&&e.rootMesh.setEnabled(!1)}))}return Object.defineProperty(e.prototype,"handMesh",{get:function(){return this._handMesh},enumerable:!1,configurable:!0}),e.prototype.getHandPartMeshes=function(e){var t=this;return R[e].map((function(e){return t._jointMeshes[b.indexOf(e)]}))},e.prototype.getJointMesh=function(e){return this._jointMeshes[b.indexOf(e)]},e.prototype.setHandMesh=function(e,t){var r=this;if(this._handMesh=e,e.alwaysSelectAsActiveMesh=!0,e.getChildMeshes().forEach((function(e){return e.alwaysSelectAsActiveMesh=!0})),this._handMesh.skeleton){var n=this._handMesh.skeleton;b.forEach((function(e,i){var o=n.getBoneIndexByName(t?t[e]:e);-1!==o&&n.bones[o].linkTransformNode(r._jointTransforms[i])}))}},e.prototype.updateFromXRFrame=function(e,t){var r=this,n=this.xrController.inputSource.hand;if(n){var i=n,o=b.map((function(e){return i[e]||n.get(e)})),s=!1;if(e.fillPoses&&e.fillJointRadii)s=e.fillPoses(o,t,this._jointTransformMatrices)&&e.fillJointRadii(o,this._jointRadii);else if(e.getJointPose){s=!0;for(var a=0;a<o.length;a++){var l=e.getJointPose(o[a],t);if(!l){s=!1;break}this._jointTransformMatrices.set(l.transform.matrix,16*a),this._jointRadii[a]=l.radius||.008}}s&&(b.forEach((function(e,t){var n=r._jointTransforms[t];c.y3.FromArrayToRef(r._jointTransformMatrices,16*t,r._tempJointMatrix),r._tempJointMatrix.decompose(void 0,n.rotationQuaternion,n.position);var i=r._jointRadii[t]*r._jointScaleFactor,o=r._jointMeshes[t];o.isVisible=!r._handMesh&&!r._jointsInvisible,o.position.copyFrom(n.position),o.rotationQuaternion.copyFrom(n.rotationQuaternion),o.scaling.setAll(i),r._scene.useRightHandedSystem||(o.position.z*=-1,o.rotationQuaternion.z*=-1,o.rotationQuaternion.w*=-1,r._leftHandedMeshes&&r._handMesh&&(n.position.z*=-1,n.rotationQuaternion.z*=-1,n.rotationQuaternion.w*=-1))})),this._handMesh&&(this._handMesh.isVisible=!0))}},e.prototype.dispose=function(){this._handMesh&&(this._handMesh.isVisible=!1)},e}(),M=function(e){function t(t,r){var n=e.call(this,t)||this;n.options=r,n._attachedHands={},n._trackingHands={left:null,right:null},n._handResources={jointMeshes:null,handMeshes:null,rigMappings:null},n.onHandAddedObservable=new u.y$,n.onHandRemovedObservable=new u.y$,n._attachHand=function(e){var t,r,i;if(e.inputSource.hand&&"none"!=e.inputSource.handedness&&n._handResources.jointMeshes){var o=e.inputSource.handedness,s=new C(e,n._handResources.jointMeshes[o],n._handResources.handMeshes&&n._handResources.handMeshes[o],n._handResources.rigMappings&&n._handResources.rigMappings[o],null===(t=n.options.handMeshes)||void 0===t?void 0:t.meshesUseLeftHandedCoordinates,null===(r=n.options.jointMeshes)||void 0===r?void 0:r.invisible,null===(i=n.options.jointMeshes)||void 0===i?void 0:i.scaleFactor);n._attachedHands[e.uniqueId]=s,n._trackingHands[o]=s,n.onHandAddedObservable.notifyObservers(s)}},n._detachHand=function(e){n._detachHandById(e.uniqueId)},n.xrNativeFeatureName="hand-tracking";var i=r.jointMeshes;if(i&&(void 0!==i.disableDefaultHandMesh&&(r.handMeshes=r.handMeshes||{},r.handMeshes.disableDefaultMeshes=i.disableDefaultHandMesh),void 0!==i.handMeshes&&(r.handMeshes=r.handMeshes||{},r.handMeshes.customMeshes=i.handMeshes),void 0!==i.leftHandedSystemMeshes&&(r.handMeshes=r.handMeshes||{},r.handMeshes.meshesUseLeftHandedCoordinates=i.leftHandedSystemMeshes),void 0!==i.rigMapping)){r.handMeshes=r.handMeshes||{};var o={},s={};[[i.rigMapping.left,o],[i.rigMapping.right,s]].forEach((function(e){var t=e[0],r=e[1];t.forEach((function(e,t){r[b[t]]=e}))})),r.handMeshes.customRigMappings={left:o,right:s}}return n}return(0,s.ZT)(t,e),t._GenerateTrackedJointMeshes=function(e){var r={};return["left","right"].map((function(n){var i,o,a,l,u,d=[],p=(null===(i=e.jointMeshes)||void 0===i?void 0:i.sourceMesh)||(0,m.Au)("jointParent",t._ICOSPHERE_PARAMS);p.isVisible=!!(null===(o=e.jointMeshes)||void 0===o?void 0:o.keepOriginalVisible);for(var _=0;_<b.length;++_){var f=p.createInstance("".concat(n,"-handJoint-").concat(_));if(null===(a=e.jointMeshes)||void 0===a?void 0:a.onHandJointMeshGenerated){var g=e.jointMeshes.onHandJointMeshGenerated(f,_,n);g&&g!==f&&(f.dispose(),f=g)}if(f.isPickable=!1,null===(l=e.jointMeshes)||void 0===l?void 0:l.enablePhysics){var v=(null===(u=e.jointMeshes)||void 0===u?void 0:u.physicsProps)||{};f.scaling.setAll(.02);var y=void 0!==v.impostorType?v.impostorType:h.Q.SphereImpostor;f.physicsImpostor=new h.Q(f,y,(0,s.pi)({mass:0},v))}f.rotationQuaternion=new c._f,f.isVisible=!1,d.push(f)}r[n]=d})),{left:r.left,right:r.right}},t._GenerateDefaultHandMeshesAsync=function(e,r){var n=this;return new Promise((function(i){return(0,s.mG)(n,void 0,void 0,(function(){var n,o,a,l,c,h,u,m,g,y,b;return(0,s.Jh)(this,(function(R){switch(R.label){case 0:return n={},(null===(m=null===(u=t._RightHandGLB)||void 0===u?void 0:u.meshes[1])||void 0===m?void 0:m.isDisposed())&&(t._RightHandGLB=null),(null===(y=null===(g=t._LeftHandGLB)||void 0===g?void 0:g.meshes[1])||void 0===y?void 0:y.isDisposed())&&(t._LeftHandGLB=null),o=!(!t._RightHandGLB||!t._LeftHandGLB),[4,Promise.all([t._RightHandGLB||d.n.ImportMeshAsync("",t.DEFAULT_HAND_MODEL_BASE_URL,t.DEFAULT_HAND_MODEL_RIGHT_FILENAME,e),t._LeftHandGLB||d.n.ImportMeshAsync("",t.DEFAULT_HAND_MODEL_BASE_URL,t.DEFAULT_HAND_MODEL_LEFT_FILENAME,e)])];case 1:return a=R.sent(),t._RightHandGLB=a[0],t._LeftHandGLB=a[1],[4,(l=new _.O("handShader",e,{emitComments:!1})).loadAsync(t.DEFAULT_HAND_MODEL_SHADER_URL)];case 2:return R.sent(),l.needDepthPrePass=!0,l.transparencyMode=f.F.MATERIAL_ALPHABLEND,l.alphaMode=2,l.build(!1),c=(0,s.pi)({base:p.Wo.FromInts(116,63,203),fresnel:p.Wo.FromInts(149,102,229),fingerColor:p.Wo.FromInts(177,130,255),tipFresnel:p.Wo.FromInts(220,200,255)},null===(b=null==r?void 0:r.handMeshes)||void 0===b?void 0:b.customColors),(h={base:l.getBlockByName("baseColor"),fresnel:l.getBlockByName("fresnelColor"),fingerColor:l.getBlockByName("fingerColor"),tipFresnel:l.getBlockByName("tipFresnelColor")}).base.value=c.base,h.fresnel.value=c.fresnel,h.fingerColor.value=c.fingerColor,h.tipFresnel.value=c.tipFresnel,["left","right"].forEach((function(r){var i="left"==r?t._LeftHandGLB:t._RightHandGLB;if(!i)throw new Error("Could not load hand model");var s=i.meshes[1];s._internalAbstractMeshDataInfo._computeBonesUsingShaders=!0,s.material=l.clone("".concat(r,"HandShaderClone"),!0),s.isVisible=!1,n[r]=s,o||e.useRightHandedSystem||i.meshes[1].rotate(v.RD.Y,Math.PI)})),l.dispose(),i({left:n.left,right:n.right}),[2]}}))}))}))},t._GenerateDefaultHandMeshRigMapping=function(e){var t,r="right"==e?"R":"L";return(t={})[o.WRIST]="wrist_".concat(r),t[o.THUMB_METACARPAL]="thumb_metacarpal_".concat(r),t[o.THUMB_PHALANX_PROXIMAL]="thumb_proxPhalanx_".concat(r),t[o.THUMB_PHALANX_DISTAL]="thumb_distPhalanx_".concat(r),t[o.THUMB_TIP]="thumb_tip_".concat(r),t[o.INDEX_FINGER_METACARPAL]="index_metacarpal_".concat(r),t[o.INDEX_FINGER_PHALANX_PROXIMAL]="index_proxPhalanx_".concat(r),t[o.INDEX_FINGER_PHALANX_INTERMEDIATE]="index_intPhalanx_".concat(r),t[o.INDEX_FINGER_PHALANX_DISTAL]="index_distPhalanx_".concat(r),t[o.INDEX_FINGER_TIP]="index_tip_".concat(r),t[o.MIDDLE_FINGER_METACARPAL]="middle_metacarpal_".concat(r),t[o.MIDDLE_FINGER_PHALANX_PROXIMAL]="middle_proxPhalanx_".concat(r),t[o.MIDDLE_FINGER_PHALANX_INTERMEDIATE]="middle_intPhalanx_".concat(r),t[o.MIDDLE_FINGER_PHALANX_DISTAL]="middle_distPhalanx_".concat(r),t[o.MIDDLE_FINGER_TIP]="middle_tip_".concat(r),t[o.RING_FINGER_METACARPAL]="ring_metacarpal_".concat(r),t[o.RING_FINGER_PHALANX_PROXIMAL]="ring_proxPhalanx_".concat(r),t[o.RING_FINGER_PHALANX_INTERMEDIATE]="ring_intPhalanx_".concat(r),t[o.RING_FINGER_PHALANX_DISTAL]="ring_distPhalanx_".concat(r),t[o.RING_FINGER_TIP]="ring_tip_".concat(r),t[o.PINKY_FINGER_METACARPAL]="little_metacarpal_".concat(r),t[o.PINKY_FINGER_PHALANX_PROXIMAL]="little_proxPhalanx_".concat(r),t[o.PINKY_FINGER_PHALANX_INTERMEDIATE]="little_intPhalanx_".concat(r),t[o.PINKY_FINGER_PHALANX_DISTAL]="little_distPhalanx_".concat(r),t[o.PINKY_FINGER_TIP]="little_tip_".concat(r),t},t.prototype.isCompatible=function(){return"undefined"!=typeof XRHand},t.prototype.getHandByControllerId=function(e){return this._attachedHands[e]},t.prototype.getHandByHandedness=function(e){return"none"==e?null:this._trackingHands[e]},t.prototype.attach=function(){var r,n,i,o,s=this;return!!e.prototype.attach.call(this)&&(this._handResources={jointMeshes:t._GenerateTrackedJointMeshes(this.options),handMeshes:(null===(r=this.options.handMeshes)||void 0===r?void 0:r.customMeshes)||null,rigMappings:(null===(n=this.options.handMeshes)||void 0===n?void 0:n.customRigMappings)||null},(null===(i=this.options.handMeshes)||void 0===i?void 0:i.customMeshes)||(null===(o=this.options.handMeshes)||void 0===o?void 0:o.disableDefaultMeshes)||t._GenerateDefaultHandMeshesAsync(y.l.LastCreatedScene,this.options).then((function(e){var r,n;s._handResources.handMeshes=e,s._handResources.rigMappings={left:t._GenerateDefaultHandMeshRigMapping("left"),right:t._GenerateDefaultHandMeshRigMapping("right")},null===(r=s._trackingHands.left)||void 0===r||r.setHandMesh(s._handResources.handMeshes.left,s._handResources.rigMappings.left),null===(n=s._trackingHands.right)||void 0===n||n.setHandMesh(s._handResources.handMeshes.right,s._handResources.rigMappings.right)})),this.options.xrInput.controllers.forEach(this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerAddedObservable,this._attachHand),this._addNewAttachObserver(this.options.xrInput.onControllerRemovedObservable,this._detachHand),!0)},t.prototype._onXRFrame=function(e){var t,r;null===(t=this._trackingHands.left)||void 0===t||t.updateFromXRFrame(e,this._xrSessionManager.referenceSpace),null===(r=this._trackingHands.right)||void 0===r||r.updateFromXRFrame(e,this._xrSessionManager.referenceSpace)},t.prototype._detachHandById=function(e){var t,r=this.getHandByControllerId(e);if(r){var n="left"==r.xrController.inputSource.handedness?"left":"right";(null===(t=this._trackingHands[n])||void 0===t?void 0:t.xrController.uniqueId)===e&&(this._trackingHands[n]=null),this.onHandRemovedObservable.notifyObservers(r),r.dispose(),delete this._attachedHands[e]}},t.prototype.detach=function(){var t=this;return!!e.prototype.detach.call(this)&&(Object.keys(this._attachedHands).forEach((function(e){return t._detachHandById(e)})),!0)},t.prototype.dispose=function(){var r;e.prototype.dispose.call(this),this.onHandAddedObservable.clear(),this.onHandRemovedObservable.clear(),this._handResources.handMeshes&&!(null===(r=this.options.handMeshes)||void 0===r?void 0:r.customMeshes)&&(this._handResources.handMeshes.left.dispose(),this._handResources.handMeshes.right.dispose(),t._RightHandGLB=null,t._LeftHandGLB=null),this._handResources.jointMeshes&&(this._handResources.jointMeshes.left.forEach((function(e){return e.dispose()})),this._handResources.jointMeshes.right.forEach((function(e){return e.dispose()})))},t.Name=l.b.HAND_TRACKING,t.Version=1,t.DEFAULT_HAND_MODEL_BASE_URL="https://assets.babylonjs.com/meshes/HandMeshes/",t.DEFAULT_HAND_MODEL_RIGHT_FILENAME="r_hand_rhs.glb",t.DEFAULT_HAND_MODEL_LEFT_FILENAME="l_hand_rhs.glb",t.DEFAULT_HAND_MODEL_SHADER_URL="https://assets.babylonjs.com/meshes/HandMeshes/handsShader.json",t._ICOSPHERE_PARAMS={radius:.5,flat:!1,subdivisions:2},t._RightHandGLB=null,t._LeftHandGLB=null,t}(a.F);l.d.AddWebXRFeature(M.Name,(function(e,t){return function(){return new M(e,t)}}),M.Version,!1)},79326:(e,t,r)=>{r.d(t,{X:()=>y,m:()=>i});var n,i,o=r(31191),s=r(2914),a=r(48087),l=r(58095),c=r(1316),h=r(5292),u=r(41388),d=r(85527),p=r(14750),_=r(3085),f=r(15631),m=r(97163),g=r(18770),v=r(88916);r(39318);!function(e){e[e.DEHYDRATED=0]="DEHYDRATED",e[e.HOVER=1]="HOVER",e[e.TOUCH=2]="TOUCH"}(n||(n={})),function(e){e[e.DISABLED=0]="DISABLED",e[e.CENTERED_ON_CONTROLLER=1]="CENTERED_ON_CONTROLLER",e[e.CENTERED_IN_FRONT=2]="CENTERED_IN_FRONT"}(i||(i={}));var y=function(e){function t(r,o){var s=e.call(this,r)||this;return s._options=o,s._tmpRay=new c.z(new l.P,new l.P),s._attachController=function(e){if(!s._controllers[e.uniqueId]){var r=s._generateNewTouchPointMesh(),i=r.touchCollisionMesh,o=r.touchCollisionMeshFunction,a=r.hydrateCollisionMeshFunction,h=s._generateVisualCue();switch(s._controllers[e.uniqueId]={xrController:e,meshUnderPointer:null,nearInteractionTargetMesh:null,pick:null,stalePick:null,touchCollisionMesh:i,touchCollisionMeshFunction:o,hydrateCollisionMeshFunction:a,currentAnimationState:n.DEHYDRATED,grabRay:new c.z(new l.P,new l.P),hoverInteraction:!1,nearInteraction:!1,grabInteraction:!1,id:t._IdCounter++,pickedPointVisualCue:h},s._attachedController?!s._options.enableNearInteractionOnAllControllers&&s._options.preferredHandedness&&e.inputSource.handedness===s._options.preferredHandedness&&(s._attachedController=e.uniqueId):s._options.enableNearInteractionOnAllControllers||(s._attachedController=e.uniqueId),e.inputSource.targetRayMode){case"tracked-pointer":return s._attachNearInteractionMode(e);case"gaze":case"screen":return null}}},s._controllers={},s._farInteractionFeature=null,s.selectionMeshDefaultColor=new f.Wo(.8,.8,.8),s.selectionMeshPickedColor=new f.Wo(.3,.3,1),s._hoverRadius=.1,s._pickRadius=.02,s._controllerPickRadius=.03,s._nearGrabLengthScale=5,s._scene=s._xrSessionManager.scene,void 0===s._options.nearInteractionControllerMode&&(s._options.nearInteractionControllerMode=i.CENTERED_IN_FRONT),s._options.farInteractionFeature&&(s._farInteractionFeature=s._options.farInteractionFeature),s}return(0,o.ZT)(t,e),t.prototype.attach=function(){var t=this;return!!e.prototype.attach.call(this)&&(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(function(e){t._detachController(e.uniqueId)})),this._scene.constantlyUpdateMeshUnderPointer=!0,!0)},t.prototype.detach=function(){var t=this;return!!e.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach((function(e){t._detachController(e)})),!0)},t.prototype.getMeshUnderPointer=function(e){return this._controllers[e]?this._controllers[e].meshUnderPointer:null},t.prototype.getXRControllerByPointerId=function(e){for(var t=Object.keys(this._controllers),r=0;r<t.length;++r)if(this._controllers[t[r]].id===e)return this._controllers[t[r]].xrController||null;return null},t.prototype.setFarInteractionFeature=function(e){this._farInteractionFeature=e},t.prototype._nearPickPredicate=function(e){return e.isEnabled()&&e.isVisible&&e.isPickable&&e.isNearPickable},t.prototype._nearGrabPredicate=function(e){return e.isEnabled()&&e.isVisible&&e.isPickable&&e.isNearGrabbable},t.prototype._nearInteractionPredicate=function(e){return e.isEnabled()&&e.isVisible&&e.isPickable&&(e.isNearPickable||e.isNearGrabbable)},t.prototype._controllerAvailablePredicate=function(e,t){for(var r=e;r;){if(r.reservedDataStore&&r.reservedDataStore.nearInteraction&&r.reservedDataStore.nearInteraction.excludedControllerId===t)return!1;r=r.parent}return!0},t.prototype._handleTransitionAnimation=function(e,t){var r;if(e.currentAnimationState!==t&&this._options.nearInteractionControllerMode===i.CENTERED_IN_FRONT&&!(null===(r=e.xrController)||void 0===r?void 0:r.inputSource.hand)){if(t>e.currentAnimationState)switch(e.currentAnimationState){case n.DEHYDRATED:if(e.hydrateCollisionMeshFunction(!0),t===n.HOVER)break;case n.HOVER:if(e.touchCollisionMeshFunction(!0),t===n.TOUCH)break}else switch(e.currentAnimationState){case n.TOUCH:if(e.touchCollisionMeshFunction(!1),t===n.HOVER)break;case n.HOVER:if(e.hydrateCollisionMeshFunction(!1),t===n.DEHYDRATED)break}e.currentAnimationState=t}},t.prototype._processTouchPoint=function(e,t,r){var n,o=this._controllers[e];o.grabRay.origin.copyFrom(t),r.toEulerAnglesToRef(l.jp.Vector3[0]),o.grabRay.direction.copyFrom(l.jp.Vector3[0]),this._options.nearInteractionControllerMode!==i.CENTERED_IN_FRONT||(null===(n=o.xrController)||void 0===n?void 0:n.inputSource.hand)||(o.xrController.getWorldPointerRayToRef(this._tmpRay),o.grabRay.origin.addInPlace(this._tmpRay.direction.scale(.05))),o.grabRay.length=this._nearGrabLengthScale*this._hoverRadius,o.touchCollisionMesh.position.copyFrom(o.grabRay.origin)},t.prototype._onXRFrame=function(e){var t=this;Object.keys(this._controllers).forEach((function(r){var o,s=t._controllers[r],a=null===(o=s.xrController)||void 0===o?void 0:o.inputSource.hand;if((t._options.enableNearInteractionOnAllControllers||r===t._attachedController)&&s.xrController&&(a||t._options.nearInteractionControllerMode&&s.xrController.inputSource.gamepad)){if(s.hoverInteraction=!1,s.nearInteraction=!1,s.xrController){if(a){var c=a.get("index-finger-tip");if(c){var u=e.getJointPose(c,t._xrSessionManager.referenceSpace);if(u&&u.transform){var d=t._scene.useRightHandedSystem?1:-1;l.jp.Vector3[0].set(u.transform.position.x,u.transform.position.y,u.transform.position.z*d),l.jp.Quaternion[0].set(u.transform.orientation.x,u.transform.orientation.y,u.transform.orientation.z*d,u.transform.orientation.w*d),t._processTouchPoint(r,l.jp.Vector3[0],l.jp.Quaternion[0])}}}else if(s.xrController.inputSource.gamepad&&t._options.nearInteractionControllerMode!==i.DISABLED){var p=s.xrController.pointer;s.xrController.grip&&t._options.nearInteractionControllerMode===i.CENTERED_ON_CONTROLLER&&(p=s.xrController.grip),t._processTouchPoint(r,p.position,p.rotationQuaternion)}var _=function(e,t){return t&&t.hit?e&&e.hit?t.distance<e.distance?t:e:t:e},f=function(e){var t=new h.p,r=!1,n=e&&e.pickedPoint&&e.hit;return(null==e?void 0:e.pickedPoint)&&(r=0===e.pickedPoint.x&&0===e.pickedPoint.y&&0===e.pickedPoint.z),n&&!r&&(t=e),t};if(!s.grabInteraction){var m=null,g=null;t._options.useUtilityLayer&&t._utilityLayerScene&&(g=t._pickWithSphere(s,t._hoverRadius,t._utilityLayerScene,(function(e){return t._nearInteractionPredicate(e)})));var v=_(t._pickWithSphere(s,t._hoverRadius,t._scene,(function(e){return t._nearInteractionPredicate(e)})),g);if(v&&v.hit&&(m=f(v)).hit&&(s.hoverInteraction=!0),s.hoverInteraction){var y=null,b=a?t._pickRadius:t._controllerPickRadius;t._options.useUtilityLayer&&t._utilityLayerScene&&(y=t._pickWithSphere(s,b,t._utilityLayerScene,(function(e){return t._nearPickPredicate(e)})));var R=f(_(t._pickWithSphere(s,b,t._scene,(function(e){return t._nearPickPredicate(e)})),y));R.hit&&(m=R,s.nearInteraction=!0)}s.stalePick=s.pick,s.pick=m,s.pick&&s.pick.pickedPoint&&s.pick.hit?(s.meshUnderPointer=s.pick.pickedMesh,s.pickedPointVisualCue.position.copyFrom(s.pick.pickedPoint),s.pickedPointVisualCue.isVisible=!0,t._farInteractionFeature&&t._farInteractionFeature.attached&&t._farInteractionFeature._setPointerSelectionDisabledByPointerId(s.id,!0)):(s.meshUnderPointer=null,s.pickedPointVisualCue.isVisible=!1,t._farInteractionFeature&&t._farInteractionFeature.attached&&t._farInteractionFeature._setPointerSelectionDisabledByPointerId(s.id,!1))}var C=n.DEHYDRATED;s.grabInteraction||s.nearInteraction?C=n.TOUCH:s.hoverInteraction&&(C=n.HOVER),t._handleTransitionAnimation(s,C)}}else s.pick=null}))},Object.defineProperty(t.prototype,"_utilityLayerScene",{get:function(){return this._options.customUtilityLayerScene||d.x.DefaultUtilityLayer.utilityLayerScene},enumerable:!1,configurable:!0}),t.prototype._generateVisualCue=function(){var e=this._options.useUtilityLayer?this._options.customUtilityLayerScene||d.x.DefaultUtilityLayer.utilityLayerScene:this._scene,t=(0,a.Qk)("nearInteraction",{diameter:.0105},e);t.bakeCurrentTransformIntoVertices(),t.isPickable=!1,t.isVisible=!1,t.rotationQuaternion=l._f.Identity();var r=new _.K("targetMat",e);return r.specularColor=f.Wo.Black(),r.emissiveColor=this.selectionMeshDefaultColor,r.backFaceCulling=!1,t.material=r,t},t.prototype._isControllerReadyForNearInteraction=function(e){return!this._farInteractionFeature||this._farInteractionFeature._getPointerSelectionDisabledByPointerId(e)},t.prototype._attachNearInteractionMode=function(e){var t=this,r=this._controllers[e.uniqueId],n={pointerId:r.id,pointerType:"xr"};r.onFrameObserver=this._xrSessionManager.onXRFrameObservable.add((function(){(t._options.enableNearInteractionOnAllControllers||e.uniqueId===t._attachedController)&&r.xrController&&(r.xrController.inputSource.hand||t._options.nearInteractionControllerMode&&r.xrController.inputSource.gamepad)&&(r.pick&&(r.pick.ray=r.grabRay),r.pick&&t._isControllerReadyForNearInteraction(r.id)&&t._scene.simulatePointerMove(r.pick,n),r.nearInteraction&&r.pick&&r.pick.hit?r.nearInteractionTargetMesh||(t._scene.simulatePointerDown(r.pick,n),r.nearInteractionTargetMesh=r.meshUnderPointer):r.nearInteractionTargetMesh&&r.stalePick&&(t._scene.simulatePointerUp(r.stalePick,n),r.nearInteractionTargetMesh=null))}));var i=function(i){t._options.enableNearInteractionOnAllControllers||e.uniqueId===t._attachedController&&t._isControllerReadyForNearInteraction(r.id)?(r.pick&&(r.pick.ray=r.grabRay),i&&r.pick&&r.meshUnderPointer&&t._nearGrabPredicate(r.meshUnderPointer)?(r.grabInteraction=!0,r.pickedPointVisualCue.isVisible=!1,t._scene.simulatePointerDown(r.pick,n)):!i&&r.pick&&r.grabInteraction&&(t._scene.simulatePointerUp(r.pick,n),r.grabInteraction=!1,r.pickedPointVisualCue.isVisible=!0)):!i||t._options.enableNearInteractionOnAllControllers||t._options.disableSwitchOnClick||(t._attachedController=e.uniqueId)};if(e.inputSource.gamepad){var o=function(e){r.squeezeComponent=e.getComponent("grasp"),r.squeezeComponent?r.onSqueezeButtonChangedObserver=r.squeezeComponent.onButtonStateChangedObservable.add((function(e){if(e.changes.pressed){var t=e.changes.pressed.current;i(t)}})):(r.selectionComponent=e.getMainComponent(),r.onButtonChangedObserver=r.selectionComponent.onButtonStateChangedObservable.add((function(e){if(e.changes.pressed){var t=e.changes.pressed.current;i(t)}})))};e.motionController?o(e.motionController):e.onMotionControllerInitObservable.add(o)}else{var s=function(e){r.xrController&&e.inputSource===r.xrController.inputSource&&r.pick&&t._isControllerReadyForNearInteraction(r.id)&&r.meshUnderPointer&&t._nearGrabPredicate(r.meshUnderPointer)&&(r.grabInteraction=!0,r.pickedPointVisualCue.isVisible=!1,t._scene.simulatePointerDown(r.pick,n))},a=function(e){r.xrController&&e.inputSource===r.xrController.inputSource&&r.pick&&t._isControllerReadyForNearInteraction(r.id)&&(t._scene.simulatePointerUp(r.pick,n),r.grabInteraction=!1,r.pickedPointVisualCue.isVisible=!0)};r.eventListeners={selectend:a,selectstart:s},this._xrSessionManager.session.addEventListener("selectstart",s),this._xrSessionManager.session.addEventListener("selectend",a)}},t.prototype._detachController=function(e){var t=this,r=this._controllers[e];if(r&&(r.squeezeComponent&&r.onSqueezeButtonChangedObserver&&r.squeezeComponent.onButtonStateChangedObservable.remove(r.onSqueezeButtonChangedObserver),r.selectionComponent&&r.onButtonChangedObserver&&r.selectionComponent.onButtonStateChangedObservable.remove(r.onButtonChangedObserver),r.onFrameObserver&&this._xrSessionManager.onXRFrameObservable.remove(r.onFrameObserver),r.eventListeners&&Object.keys(r.eventListeners).forEach((function(e){var n=r.eventListeners&&r.eventListeners[e];n&&t._xrSessionManager.session.removeEventListener(e,n)})),r.touchCollisionMesh.dispose(),r.pickedPointVisualCue.dispose(),this._xrSessionManager.runInXRFrame((function(){var e={pointerId:r.id,pointerType:"xr"};t._scene.simulatePointerUp(new h.p,e)})),delete this._controllers[e],this._attachedController===e)){var n=Object.keys(this._controllers);n.length?this._attachedController=n[0]:this._attachedController=""}},t.prototype._generateNewTouchPointMesh=function(){var e=this._options.useUtilityLayer?this._options.customUtilityLayerScene||d.x.DefaultUtilityLayer.utilityLayerScene:this._scene,t=(0,a.Qk)("PickSphere",{diameter:1},e);t.isVisible=!1,this._options.motionControllerOrbMaterial?t.material=this._options.motionControllerOrbMaterial:m.O.ParseFromSnippetAsync("8RUNKL#3",e).then((function(e){t.material=e}));var r=new v.v;r.setEasingMode(v.Kp.EASINGMODE_EASEINOUT);var n=new l.P(this._controllerPickRadius,this._controllerPickRadius,this._controllerPickRadius),i=this._controllerPickRadius*(4/3),o=new l.P(i,i,i),s=this._controllerPickRadius*(7/6),c=new l.P(s,s,s),h=.8*this._controllerPickRadius,u=new l.P(h,h,h),p=1.5*this._controllerPickRadius,_=[{frame:0,value:n},{frame:10,value:new l.P(p,p,p)},{frame:18,value:o}],f=[{frame:0,value:o},{frame:10,value:u},{frame:18,value:n}],y=[{frame:0,value:l.P.ZeroReadOnly},{frame:12,value:c},{frame:15,value:n}],b=[{frame:0,value:n},{frame:10,value:l.P.ZeroReadOnly},{frame:15,value:l.P.ZeroReadOnly}],R=new g.f("touch","scaling",60,g.f.ANIMATIONTYPE_VECTOR3,g.f.ANIMATIONLOOPMODE_CONSTANT),C=new g.f("release","scaling",60,g.f.ANIMATIONTYPE_VECTOR3,g.f.ANIMATIONLOOPMODE_CONSTANT),M=new g.f("hydrate","scaling",60,g.f.ANIMATIONTYPE_VECTOR3,g.f.ANIMATIONLOOPMODE_CONSTANT),x=new g.f("dehydrate","scaling",60,g.f.ANIMATIONTYPE_VECTOR3,g.f.ANIMATIONLOOPMODE_CONSTANT);R.setEasingFunction(r),C.setEasingFunction(r),M.setEasingFunction(r),x.setEasingFunction(r),R.setKeys(_),C.setKeys(f),M.setKeys(y),x.setKeys(b);return{touchCollisionMesh:t,touchCollisionMeshFunction:function(r){var n=r?R:C;e.beginDirectAnimation(t,[n],0,18,!1,1)},hydrateCollisionMeshFunction:function(r){var n=r?M:x;r&&(t.isVisible=!0),e.beginDirectAnimation(t,[n],0,15,!1,1,(function(){r||(t.isVisible=!1)}))}}},t.prototype._pickWithSphere=function(e,r,n,i){var o=new h.p;if(o.distance=1/0,e.touchCollisionMesh&&e.xrController)for(var s=e.touchCollisionMesh.position,a=p.K.CreateFromCenterAndRadius(s,r),l=0;l<n.meshes.length;l++){var c=n.meshes[l];if(i(c)&&this._controllerAvailablePredicate(c,e.xrController.uniqueId)){var u=t.PickMeshWithSphere(c,a);u&&u.hit&&u.distance<o.distance&&(o.hit=u.hit,o.pickedMesh=c,o.pickedPoint=u.pickedPoint,o.aimTransform=e.xrController.pointer,o.gripTransform=e.xrController.grip||null,o.originMesh=e.touchCollisionMesh,o.distance=u.distance)}}return o},t.PickMeshWithSphere=function(e,t,r){void 0===r&&(r=!1);var n=e.subMeshes,i=new h.p,o=e.getBoundingInfo();if(!e._generatePointsArray())return i;if(!e.subMeshes||!o)return i;if(!r&&!p.K.Intersects(o.boundingSphere,t))return i;var s,a,c,u=l.jp.Vector3[0],d=l.jp.Vector3[1],_=1/0,f=l.jp.Vector3[2],m=l.jp.Matrix[0];m.copyFrom(e.getWorldMatrix()),m.invert(),l.P.TransformCoordinatesToRef(t.center,m,f);for(var g=0;g<n.length;g++){n[g].projectToRef(f,e._positions,e.getIndices(),d),l.P.TransformCoordinatesToRef(d,e.getWorldMatrix(),d),s=l.P.Distance(d,t.center),c=l.P.Distance(d,e.getAbsolutePosition()),-1!==(a=l.P.Distance(t.center,e.getAbsolutePosition()))&&-1!==c&&c>a&&(s=0,d.copyFrom(t.center)),-1!==s&&s<_&&(_=s,u.copyFrom(d))}return _<t.radius&&(i.hit=!0,i.distance=_,i.pickedMesh=e,i.pickedPoint=u.clone()),i},t._IdCounter=200,t.Name=s.b.NEAR_INTERACTION,t.Version=1,t}(u.F);s.d.AddWebXRFeature(y.Name,(function(e,t){return function(){return new y(e,t)}}),y.Version,!0)},34779:(e,t,r)=>{r.d(t,{d:()=>h});var n=r(31191),i=r(23845),o=r(62897),s=r(84318),a=r(63407),l=r(58095),c=r(91243),h=function(){function e(e,t,r,n,s,a){void 0===s&&(s=!1);var l=this;this.scene=e,this.layout=t,this.gamepadObject=r,this.handedness=n,this._doNotLoadControllerMesh=s,this._controllerCache=a,this._initComponent=function(e){if(e){var t=l.layout.components[e],r=t.type,n=t.gamepadIndices.button,o=[];void 0!==t.gamepadIndices.xAxis&&void 0!==t.gamepadIndices.yAxis&&o.push(t.gamepadIndices.xAxis,t.gamepadIndices.yAxis),l.components[e]=new i.n(e,r,n,o)}},this._modelReady=!1,this.components={},this.disableAnimation=!1,this.onModelLoadedObservable=new o.y$,t.components&&Object.keys(t.components).forEach(this._initComponent)}return e.prototype.dispose=function(){var e=this;this.getComponentIds().forEach((function(t){return e.getComponent(t).dispose()})),this.rootMesh&&(this.rootMesh.getChildren(void 0,!0).forEach((function(e){e.setEnabled(!1)})),this.rootMesh.dispose(!!this._controllerCache,!this._controllerCache))},e.prototype.getAllComponentsOfType=function(e){var t=this;return this.getComponentIds().map((function(e){return t.components[e]})).filter((function(t){return t.type===e}))},e.prototype.getComponent=function(e){return this.components[e]},e.prototype.getComponentIds=function(){return Object.keys(this.components)},e.prototype.getComponentOfType=function(e){return this.getAllComponentsOfType(e)[0]||null},e.prototype.getMainComponent=function(){return this.getComponent(this.layout.selectComponentId)},e.prototype.loadModel=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t,r=this;return(0,n.Jh)(this,(function(i){return e=!this._getModelLoadingConstraints(),t=this._getGenericFilenameAndPath(),e?s.Y.Warn("Falling back to generic models"):t=this._getFilenameAndPath(),[2,new Promise((function(i,o){var l=function(t){e?r._getGenericParentMesh(t):r._setRootMesh(t),r._processLoadedModel(t),r._modelReady=!0,r.onModelLoadedObservable.notifyObservers(r),i(!0)};if(r._controllerCache){var c=r._controllerCache.filter((function(e){return e.filename===t.filename&&e.path===t.path}));if(c[0])return c[0].meshes.forEach((function(e){return e.setEnabled(!0)})),void l(c[0].meshes)}a.n.ImportMesh("",t.path,t.filename,r.scene,(function(e){r._controllerCache&&r._controllerCache.push((0,n.pi)((0,n.pi)({},t),{meshes:e})),l(e)}),null,(function(e,n){s.Y.Log(n),s.Y.Warn("Failed to retrieve controller model of type ".concat(r.profileId," from the remote server: ").concat(t.path).concat(t.filename)),o(n)}))}))]}))}))},e.prototype.updateFromXRFrame=function(e){var t=this;this.getComponentIds().forEach((function(e){return t.getComponent(e).update(t.gamepadObject)})),this.updateModel(e)},Object.defineProperty(e.prototype,"handness",{get:function(){return this.handedness},enumerable:!1,configurable:!0}),e.prototype.pulse=function(e,t,r){return void 0===r&&(r=0),this.gamepadObject.hapticActuators&&this.gamepadObject.hapticActuators[r]?this.gamepadObject.hapticActuators[r].pulse(e,t):Promise.resolve(!1)},e.prototype._getChildByName=function(e,t){return e.getChildren((function(e){return e.name===t}),!1)[0]},e.prototype._getImmediateChildByName=function(e,t){return e.getChildren((function(e){return e.name==t}),!0)[0]},e.prototype._lerpTransform=function(e,t,r){if(e.minMesh&&e.maxMesh&&e.valueMesh&&e.minMesh.rotationQuaternion&&e.maxMesh.rotationQuaternion&&e.valueMesh.rotationQuaternion){var n=r?.5*t+.5:t;l._f.SlerpToRef(e.minMesh.rotationQuaternion,e.maxMesh.rotationQuaternion,n,e.valueMesh.rotationQuaternion),l.P.LerpToRef(e.minMesh.position,e.maxMesh.position,n,e.valueMesh.position)}},e.prototype.updateModel=function(e){this._modelReady&&this._updateModel(e)},e.prototype._getGenericFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},e.prototype._getGenericParentMesh=function(e){var t=this;this.rootMesh=new c.Kj(this.profileId+" "+this.handedness,this.scene),e.forEach((function(e){e.parent||(e.isPickable=!1,e.setParent(t.rootMesh))})),this.rootMesh.rotationQuaternion=l._f.FromEulerAngles(0,Math.PI,0)},e}()},23845:(e,t,r)=>{r.d(t,{n:()=>i});var n=r(62897),i=function(){function e(e,t,r,i){void 0===r&&(r=-1),void 0===i&&(i=[]),this.id=e,this.type=t,this._buttonIndex=r,this._axesIndices=i,this._axes={x:0,y:0},this._changes={},this._currentValue=0,this._hasChanges=!1,this._pressed=!1,this._touched=!1,this.onAxisValueChangedObservable=new n.y$,this.onButtonStateChangedObservable=new n.y$}return Object.defineProperty(e.prototype,"axes",{get:function(){return this._axes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changes",{get:function(){return this._changes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasChanges",{get:function(){return this._hasChanges},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pressed",{get:function(){return this._pressed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"touched",{get:function(){return this._touched},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this.onAxisValueChangedObservable.clear(),this.onButtonStateChangedObservable.clear()},e.prototype.isAxes=function(){return 0!==this._axesIndices.length},e.prototype.isButton=function(){return-1!==this._buttonIndex},e.prototype.update=function(e){var t=!1,r=!1;if(this._hasChanges=!1,this._changes={},this.isButton()){var n=e.buttons[this._buttonIndex];if(!n)return;this._currentValue!==n.value&&(this.changes.value={current:n.value,previous:this._currentValue},t=!0,this._currentValue=n.value),this._touched!==n.touched&&(this.changes.touched={current:n.touched,previous:this._touched},t=!0,this._touched=n.touched),this._pressed!==n.pressed&&(this.changes.pressed={current:n.pressed,previous:this._pressed},t=!0,this._pressed=n.pressed)}this.isAxes()&&(this._axes.x!==e.axes[this._axesIndices[0]]&&(this.changes.axes={current:{x:e.axes[this._axesIndices[0]],y:this._axes.y},previous:{x:this._axes.x,y:this._axes.y}},this._axes.x=e.axes[this._axesIndices[0]],r=!0),this._axes.y!==e.axes[this._axesIndices[1]]&&(this.changes.axes?this.changes.axes.current.y=e.axes[this._axesIndices[1]]:this.changes.axes={current:{x:this._axes.x,y:e.axes[this._axesIndices[1]]},previous:{x:this._axes.x,y:this._axes.y}},this._axes.y=e.axes[this._axesIndices[1]],r=!0)),t&&(this._hasChanges=!0,this.onButtonStateChangedObservable.notifyObservers(this)),r&&(this._hasChanges=!0,this.onAxisValueChangedObservable.notifyObservers(this._axes))},e.BUTTON_TYPE="button",e.SQUEEZE_TYPE="squeeze",e.THUMBSTICK_TYPE="thumbstick",e.TOUCHPAD_TYPE="touchpad",e.TRIGGER_TYPE="trigger",e}()},28170:(e,t,r)=>{r.d(t,{z:()=>a});var n=r(31191),i=r(34779),o=r(91243),s=r(58095),a=function(e){function t(r,n,i){var o=e.call(this,r,l[i],n,i)||this;return o.profileId=t.ProfileId,o}return(0,n.ZT)(t,e),t.prototype._getFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){},t.prototype._setRootMesh=function(e){var t=this;this.rootMesh=new o.Kj(this.profileId+" "+this.handedness,this.scene),e.forEach((function(e){e.isPickable=!1,e.parent||e.setParent(t.rootMesh)})),this.rootMesh.rotationQuaternion=s._f.FromEulerAngles(0,Math.PI,0)},t.prototype._updateModel=function(){},t.ProfileId="generic-trigger",t}(i.d),l={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-trigger-none",assetPath:"none.glb"}}},51917:(e,t,r)=>{r.d(t,{V:()=>a});var n=r(28170),i=r(13514),o=r(18786),s=[],a=function(){function e(){}return e.ClearProfilesCache=function(){this._ProfilesList=null,this._ProfileLoadingPromises={}},e.DefaultFallbacks=function(){this.RegisterFallbacksForProfileId("google-daydream",["generic-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive-focus",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("htc-vive",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("magicleap-one",["generic-trigger-squeeze-touchpad"]),this.RegisterFallbacksForProfileId("windows-mixed-reality",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("microsoft-mixed-reality",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-go",["generic-trigger-touchpad"]),this.RegisterFallbacksForProfileId("oculus-touch-v2",["oculus-touch","generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("oculus-touch",["generic-trigger-squeeze-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-gearvr",["windows-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("samsung-odyssey",["generic-touchpad"]),this.RegisterFallbacksForProfileId("valve-index",["generic-trigger-squeeze-touchpad-thumbstick"]),this.RegisterFallbacksForProfileId("generic-hand-select",["generic-trigger"])},e.FindFallbackWithProfileId=function(e){var t=this._Fallbacks[e]||[];return t.unshift(e),t},e.GetMotionControllerWithXRInput=function(e,t,r){var n=this,i=[];if(r&&i.push(r),i.push.apply(i,e.profiles||[]),i.length&&!i[0]&&i.pop(),e.gamepad&&e.gamepad.id&&e.gamepad.id===(e.gamepad.id.match(/oculus touch/gi)?e.gamepad.id:void 0))i.push("oculus-touch-v2");var o=i.indexOf("windows-mixed-reality");if(-1!==o&&i.splice(o,0,"microsoft-mixed-reality"),i.length||i.push("generic-trigger"),this.UseOnlineRepository){var s=this.PrioritizeOnlineRepository?this._LoadProfileFromRepository:this._LoadProfilesFromAvailableControllers,a=this.PrioritizeOnlineRepository?this._LoadProfilesFromAvailableControllers:this._LoadProfileFromRepository;return s.call(this,i,e,t).catch((function(){return a.call(n,i,e,t)}))}return this._LoadProfilesFromAvailableControllers(i,e,t)},e.RegisterController=function(e,t){this._AvailableControllers[e]=t},e.RegisterFallbacksForProfileId=function(e,t){var r;this._Fallbacks[e]?(r=this._Fallbacks[e]).push.apply(r,t):this._Fallbacks[e]=t},e.UpdateProfilesList=function(){return this._ProfilesList=i.w1.LoadFileAsync(this.BaseRepositoryUrl+"/profiles/profilesList.json",!1).then((function(e){return JSON.parse(e.toString())})),this._ProfilesList},e.ClearControllerCache=function(){s.forEach((function(e){e.meshes.forEach((function(e){e.dispose(!1,!0)}))})),s.length=0},e._LoadProfileFromRepository=function(e,t,r){var n=this;return Promise.resolve().then((function(){return n._ProfilesList?n._ProfilesList:n.UpdateProfilesList()})).then((function(t){for(var r=0;r<e.length;++r)if(e[r]&&t[e[r]])return e[r];throw new Error("neither controller ".concat(e[0]," nor all fallbacks were found in the repository,"))})).then((function(e){return n._ProfileLoadingPromises[e]||(n._ProfileLoadingPromises[e]=i.w1.LoadFileAsync("".concat(n.BaseRepositoryUrl,"/profiles/").concat(e,"/profile.json"),!1).then((function(e){return JSON.parse(e)}))),n._ProfileLoadingPromises[e]})).then((function(e){return new o.t(r,t,e,n.BaseRepositoryUrl,n.DisableControllerCache?void 0:s)}))},e._LoadProfilesFromAvailableControllers=function(e,t,r){for(var n=0;n<e.length;++n)if(e[n])for(var i=this.FindFallbackWithProfileId(e[n]),o=0;o<i.length;++o){var s=this._AvailableControllers[i[o]];if(s)return Promise.resolve(s(t,r))}throw new Error("no controller requested was found in the available controllers list")},e._AvailableControllers={},e._Fallbacks={},e._ProfileLoadingPromises={},e.BaseRepositoryUrl="https://immersive-web.github.io/webxr-input-profiles/packages/viewer/dist",e.PrioritizeOnlineRepository=!0,e.UseOnlineRepository=!0,e.DisableControllerCache=!0,e}();a.RegisterController(n.z.ProfileId,(function(e,t){return new n.z(t,e.gamepad,e.handedness)})),a.DefaultFallbacks()},18786:(e,t,r)=>{r.d(t,{t:()=>p});var n=r(31191),i=r(34779),o=r(63407),s=r(91243),a=r(43048),l=r(15631),c=r(23845),h=r(48087),u=r(3085),d=r(84318),p=function(e){function t(t,r,n,i,o){var s=e.call(this,t,n.layouts[r.handedness||"none"],r.gamepad,r.handedness,void 0,o)||this;return s._repositoryUrl=i,s.controllerCache=o,s._buttonMeshMapping={},s._touchDots={},s.profileId=n.profileId,s}return(0,n.ZT)(t,e),t.prototype.dispose=function(){var t=this;e.prototype.dispose.call(this),this.controllerCache||Object.keys(this._touchDots).forEach((function(e){t._touchDots[e].dispose()}))},t.prototype._getFilenameAndPath=function(){return{filename:this.layout.assetPath,path:"".concat(this._repositoryUrl,"/profiles/").concat(this.profileId,"/")}},t.prototype._getModelLoadingConstraints=function(){var e=o.n.IsPluginForExtensionAvailable(".glb");return e||d.Y.Warn("glTF / glb loader was not registered, using generic controller instead"),e},t.prototype._processLoadedModel=function(e){var t=this;this.getComponentIds().forEach((function(e){var r=t.layout.components[e];t._buttonMeshMapping[e]={mainMesh:t._getChildByName(t.rootMesh,r.rootNodeName),states:{}},Object.keys(r.visualResponses).forEach((function(n){var i=r.visualResponses[n];if("transform"===i.valueNodeProperty)t._buttonMeshMapping[e].states[n]={valueMesh:t._getChildByName(t.rootMesh,i.valueNodeName),minMesh:t._getChildByName(t.rootMesh,i.minNodeName),maxMesh:t._getChildByName(t.rootMesh,i.maxNodeName)};else{var o=r.type===c.n.TOUCHPAD_TYPE&&r.touchPointNodeName?r.touchPointNodeName:i.valueNodeName;if(t._buttonMeshMapping[e].states[n]={valueMesh:t._getChildByName(t.rootMesh,o)},r.type===c.n.TOUCHPAD_TYPE&&!t._touchDots[n]){var s=(0,h.Qk)(n+"dot",{diameter:.0015,segments:8},t.scene);s.material=new u.K(n+"mat",t.scene),s.material.diffuseColor=l.Wo.Red(),s.parent=t._buttonMeshMapping[e].states[n].valueMesh||null,s.isVisible=!1,t._touchDots[n]=s}}}))}))},t.prototype._setRootMesh=function(e){var t;this.rootMesh=new s.Kj(this.profileId+"-"+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(var r=0;r<e.length;r++){var n=e[r];n.isPickable=!1,n.parent||(t=n)}t&&t.setParent(this.rootMesh),this.scene.useRightHandedSystem||this.rootMesh.rotate(a.RD.Y,Math.PI,a.T.WORLD)},t.prototype._updateModel=function(e){var t=this;this.disableAnimation||this.getComponentIds().forEach((function(e){var r=t.getComponent(e);if(r.hasChanges){var n=t._buttonMeshMapping[e],i=t.layout.components[e];Object.keys(i.visualResponses).forEach((function(e){var o=i.visualResponses[e],s=r.value;if("xAxis"===o.componentProperty?s=r.axes.x:"yAxis"===o.componentProperty&&(s=r.axes.y),"transform"===o.valueNodeProperty)t._lerpTransform(n.states[e],s,"button"!==o.componentProperty);else{var a=n.states[e].valueMesh;a&&(a.isVisible=r.touched||r.pressed),t._touchDots[e]&&(t._touchDots[e].isVisible=r.touched||r.pressed)}}))}}))},t}(i.d)},97001:(e,t,r)=>{r.d(t,{HK:()=>l,ur:()=>a,z5:()=>s});var n=r(31191),i=r(64829),o=r(69022),s=function(e){function t(t){var r=e.call(this,(function(){return t.framebufferWidth}),(function(){return t.framebufferHeight}),t,"XRWebGLLayer",(function(e){return new a(e,r)}))||this;return r.layer=t,r}return(0,n.ZT)(t,e),t}(i.s),a=function(e){function t(t,r){var n=e.call(this,t.scene,r)||this;return n.layerWrapper=r,n._nativeRTTProvider=navigator.xr.getNativeRenderTargetProvider(t.session,n._createRenderTargetTexture.bind(n),n._destroyRenderTargetTexture.bind(n)),n._nativeLayer=r.layer,n}return(0,n.ZT)(t,e),t.prototype.trySetViewportForView=function(e){return e.x=0,e.y=0,e.width=1,e.height=1,!0},t.prototype.getRenderTargetTextureForEye=function(e){return this._nativeRTTProvider.getRenderTargetForEye(e)},t.prototype.getRenderTargetTextureForView=function(e){return this._nativeRTTProvider.getRenderTargetForEye(e.eye)},t.prototype.getFramebufferDimensions=function(){return{framebufferWidth:this._nativeLayer.framebufferWidth,framebufferHeight:this._nativeLayer.framebufferHeight}},t}(o.y),l=function(){function e(e){this._nativeRenderTarget=navigator.xr.getWebXRRenderTarget(e.scene.getEngine())}return e.prototype.initializeXRLayerAsync=function(e){return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(t){switch(t.label){case 0:return[4,this._nativeRenderTarget.initializeXRLayerAsync(e)];case 1:return t.sent(),this.xrLayer=this._nativeRenderTarget.xrLayer,[2,this.xrLayer]}}))}))},e.prototype.dispose=function(){},e}()},52281:(e,t,r)=>{r.d(t,{o:()=>u});var n=r(31191),i=r(58095),o=r(2055),s=r(78098),a=r(86121),l=r(66513),c=r(62897),h=r(9022),u=function(e){function t(t,r,n){var s=e.call(this,t,i.P.Zero(),r)||this;return s._xrSessionManager=n,s._firstFrame=!1,s._referenceQuaternion=i._f.Identity(),s._referencedPosition=new i.P,s._trackingState=h.j.NOT_TRACKING,s.onBeforeCameraTeleport=new c.y$,s.onAfterCameraTeleport=new c.y$,s.onTrackingStateChanged=new c.y$,s.compensateOnFirstFrame=!0,s._rotate180=new i._f(0,1,0,0),s.minZ=.1,s.rotationQuaternion=new i._f,s.cameraRigMode=o.V.RIG_MODE_CUSTOM,s.updateUpVectorFromRotation=!0,s._updateNumberOfRigCameras(1),s.freezeProjectionMatrix(),s._xrSessionManager.onXRSessionInit.add((function(){s._referencedPosition.copyFromFloats(0,0,0),s._referenceQuaternion.copyFromFloats(0,0,0,1),s._firstFrame=s.compensateOnFirstFrame})),s._xrSessionManager.onXRFrameObservable.add((function(){s._firstFrame&&s._updateFromXRSession(),s._updateReferenceSpace(),s._updateFromXRSession()}),void 0,!0),s}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"trackingState",{get:function(){return this._trackingState},enumerable:!1,configurable:!0}),t.prototype._setTrackingState=function(e){this._trackingState!==e&&(this._trackingState=e,this.onTrackingStateChanged.notifyObservers(e))},Object.defineProperty(t.prototype,"realWorldHeight",{get:function(){var e=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.baseReferenceSpace);return e&&e.transform?e.transform.position.y:0},enumerable:!1,configurable:!0}),t.prototype._updateForDualEyeDebugging=function(){this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new l.l(0,0,.5,1),this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new l.l(.5,0,.5,1),this.rigCameras[1].outputRenderTarget=null},t.prototype.setTransformationFromNonVRCamera=function(e,t){(void 0===e&&(e=this.getScene().activeCamera),void 0===t&&(t=!0),e&&e!==this)&&(e.computeWorldMatrix().decompose(void 0,this.rotationQuaternion,this.position),this.position.y=0,i._f.FromEulerAnglesToRef(0,this.rotationQuaternion.toEulerAngles().y,0,this.rotationQuaternion),this._firstFrame=!0,t&&this._xrSessionManager.resetReferenceSpace())},t.prototype.getClassName=function(){return"WebXRCamera"},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._lastXRViewerPose=void 0},t.prototype._updateFromXRSession=function(){var e=this,t=this._xrSessionManager.currentFrame&&this._xrSessionManager.currentFrame.getViewerPose(this._xrSessionManager.referenceSpace);if(this._lastXRViewerPose=t||void 0,t){var r=t.emulatedPosition?h.j.TRACKING_LOST:h.j.TRACKING;if(this._setTrackingState(r),t.transform){var n=t.transform.orientation;if(void 0===t.transform.orientation.x)return;var o=t.transform.position;this._referencedPosition.set(o.x,o.y,o.z),this._referenceQuaternion.set(n.x,n.y,n.z,n.w),this._scene.useRightHandedSystem||(this._referencedPosition.z*=-1,this._referenceQuaternion.z*=-1,this._referenceQuaternion.w*=-1),this._firstFrame?(this._firstFrame=!1,this.position.y+=this._referencedPosition.y,this._referenceQuaternion.copyFromFloats(0,0,0,1)):(this.rotationQuaternion.copyFrom(this._referenceQuaternion),this.position.copyFrom(this._referencedPosition))}this.rigCameras.length!==t.views.length&&this._updateNumberOfRigCameras(t.views.length),t.views.forEach((function(t,r){var n,o=e.rigCameras[r];o.isLeftCamera||o.isRightCamera||("right"===t.eye?o._isRightCamera=!0:"left"===t.eye&&(o._isLeftCamera=!0));var s=t.transform.position,a=t.transform.orientation;o.parent=e.parent,o.position.set(s.x,s.y,s.z),o.rotationQuaternion.set(a.x,a.y,a.z,a.w),e._scene.useRightHandedSystem?o.rotationQuaternion.multiplyInPlace(e._rotate180):(o.position.z*=-1,o.rotationQuaternion.z*=-1,o.rotationQuaternion.w*=-1),i.y3.FromFloat32ArrayToRefScaled(t.projectionMatrix,0,1,o._projectionMatrix),e._scene.useRightHandedSystem||o._projectionMatrix.toggleProjectionMatrixHandInPlace(),0===r&&e._projectionMatrix.copyFrom(o._projectionMatrix);var l=e._xrSessionManager.getRenderTargetTextureForView(t);e._renderingMultiview=(null===(n=null==l?void 0:l._texture)||void 0===n?void 0:n.isMultiview)||!1,e._renderingMultiview?0==r&&(e._xrSessionManager.trySetViewportForView(e.viewport,t),e.outputRenderTarget=l):(e._xrSessionManager.trySetViewportForView(o.viewport,t),o.outputRenderTarget=l||e._xrSessionManager.getRenderTargetTextureForView(t))}))}else this._setTrackingState(h.j.NOT_TRACKING)},t.prototype._updateNumberOfRigCameras=function(e){for(void 0===e&&(e=1);this.rigCameras.length<e;){var t=new a.C("XR-RigCamera: "+this.rigCameras.length,i.P.Zero(),this.getScene());t.minZ=.1,t.rotationQuaternion=new i._f,t.updateUpVectorFromRotation=!0,t.isRigCamera=!0,t.rigParent=this,t.freezeProjectionMatrix(),this.rigCameras.push(t)}for(;this.rigCameras.length>e;){var r=this.rigCameras.pop();r&&r.dispose()}},t.prototype._updateReferenceSpace=function(){if(!this.position.equals(this._referencedPosition)||!this.rotationQuaternion.equals(this._referenceQuaternion)){var e=i.jp.Matrix[0],r=i.jp.Matrix[1],n=i.jp.Matrix[2];i.y3.ComposeToRef(t._ScaleReadOnly,this._referenceQuaternion,this._referencedPosition,e),i.y3.ComposeToRef(t._ScaleReadOnly,this.rotationQuaternion,this.position,r),e.invert().multiplyToRef(r,n),n.invert(),this._scene.useRightHandedSystem||n.toggleModelMatrixHandInPlace(),n.decompose(void 0,this._referenceQuaternion,this._referencedPosition);var o=new XRRigidTransform({x:this._referencedPosition.x,y:this._referencedPosition.y,z:this._referencedPosition.z},{x:this._referenceQuaternion.x,y:this._referenceQuaternion.y,z:this._referenceQuaternion.z,w:this._referenceQuaternion.w});this._xrSessionManager.referenceSpace=this._xrSessionManager.referenceSpace.getOffsetReferenceSpace(o)}},t._ScaleReadOnly=i.P.One(),t}(s.c)},33102:(e,t,r)=>{r.d(t,{B:()=>d,z:()=>u});var n=r(31191),i=r(90570),o=r(428),s=r(59237),a=r(79326),l=r(62510),c=r(54774),h=r(84318),u=function(){},d=function(){function e(){}return e.CreateAsync=function(t,r){void 0===r&&(r={});var u=new e;if(t.onDisposeObservable.addOnce((function(){u.dispose()})),!r.disableDefaultUI){var d=(0,n.pi)({renderTarget:u.renderTarget},r.uiOptions||{});r.optionalFeatures&&("boolean"==typeof r.optionalFeatures?d.optionalFeatures=["hit-test","anchors","plane-detection","hand-tracking"]:d.optionalFeatures=r.optionalFeatures),u.enterExitUI=new l.Af(t,d)}return i.M.CreateAsync(t).then((function(e){if(u.baseExperience=e,r.ignoreNativeCameraTransformation&&(u.baseExperience.camera.compensateOnFirstFrame=!1),u.input=new o.t(e.sessionManager,e.camera,(0,n.pi)({controllerOptions:{renderingGroupId:r.renderingGroupId}},r.inputOptions||{})),!r.disablePointerSelection){var t=(0,n.pi)((0,n.pi)({},r.pointerSelectionOptions),{xrInput:u.input,renderingGroupId:r.renderingGroupId});u.pointerSelection=u.baseExperience.featuresManager.enableFeature(s.S.Name,r.useStablePlugins?"stable":"latest",t),r.disableTeleportation||(u.teleportation=u.baseExperience.featuresManager.enableFeature(c.z.Name,r.useStablePlugins?"stable":"latest",{floorMeshes:r.floorMeshes,xrInput:u.input,renderingGroupId:r.renderingGroupId}),u.teleportation.setSelectionFeature(u.pointerSelection))}return r.disableNearInteraction||(u.nearInteraction=u.baseExperience.featuresManager.enableFeature(a.X.Name,r.useStablePlugins?"stable":"latest",{xrInput:u.input,farInteractionFeature:u.pointerSelection,renderingGroupId:r.renderingGroupId,useUtilityLayer:!0,enableNearInteractionOnAllControllers:!0})),u.renderTarget=u.baseExperience.sessionManager.getWebXRRenderTarget(r.outputCanvasOptions),r.disableDefaultUI?void 0:u.enterExitUI.setHelperAsync(u.baseExperience,u.renderTarget)})).then((function(){return u})).catch((function(e){return h.Y.Error("Error initializing XR"),h.Y.Error(e),u}))},e.prototype.dispose=function(){this.baseExperience&&this.baseExperience.dispose(),this.input&&this.input.dispose(),this.enterExitUI&&this.enterExitUI.dispose(),this.renderTarget&&this.renderTarget.dispose()},e}()},62510:(e,t,r)=>{r.d(t,{Af:()=>c,Jg:()=>a,zI:()=>l});var n=r(31191),i=r(62897),o=r(9022),s=r(13514),a=function(){function e(e,t,r){this.element=e,this.sessionMode=t,this.referenceSpaceType=r}return e.prototype.update=function(e){},e}(),l=function(){},c=function(){function e(e,t){var r=this;if(this._scene=e,this.options=t,this._activeButton=null,this._buttons=[],this.activeButtonChangedObservable=new i.y$,this._onSessionGranted=function(e){r._helper&&r._enterXRWithButtonIndex(0)},this.overlay=document.createElement("div"),this.overlay.classList.add("xr-button-overlay"),this.overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;",!t.ignoreSessionGrantedEvent&&navigator.xr&&navigator.xr.addEventListener("sessiongranted",this._onSessionGranted),"undefined"!=typeof window&&window.location&&"http:"===window.location.protocol&&"localhost"!==window.location.hostname)throw s.w1.Warn("WebXR can only be served over HTTPS"),new Error("WebXR can only be served over HTTPS");if(t.customButtons)this._buttons=t.customButtons;else{var n=t.sessionMode||"immersive-vr",o=t.referenceSpaceType||"local-floor",l=".babylonVRicon { color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+("undefined"==typeof SVGSVGElement?"https://cdn.babylonjs.com/Assets/vrButton.png":"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";l+='.babylonVRicon.vrdisplaypresenting { background-image: none;} .vrdisplaypresenting::after { content: "EXIT"} .xr-error::after { content: "ERROR"}';var c=document.createElement("style");c.appendChild(document.createTextNode(l)),document.getElementsByTagName("head")[0].appendChild(c);var h=document.createElement("button");h.className="babylonVRicon",h.title="".concat(n," - ").concat(o),this._buttons.push(new a(h,n,o)),this._buttons[this._buttons.length-1].update=function(e){this.element.style.display=null===e||e===this?"":"none",h.className="babylonVRicon"+(e===this?" vrdisplaypresenting":"")},this._updateButtons(null)}var u=e.getEngine().getInputElement();u&&u.parentNode&&(u.parentNode.appendChild(this.overlay),e.onDisposeObservable.addOnce((function(){r.dispose()})))}return e.prototype.setHelperAsync=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){var r,i=this;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return this._helper=e,this._renderTarget=t,r=this._buttons.map((function(t){return e.sessionManager.isSessionSupportedAsync(t.sessionMode)})),e.onStateChangedObservable.add((function(e){e==o.k.NOT_IN_XR&&i._updateButtons(null)})),[4,Promise.all(r)];case 1:return n.sent().forEach((function(e,t){e?(i.overlay.appendChild(i._buttons[t].element),i._buttons[t].element.onclick=i._enterXRWithButtonIndex.bind(i,t)):s.w1.Warn('Session mode "'.concat(i._buttons[t].sessionMode,'" not supported in browser'))})),[2]}}))}))},e.CreateAsync=function(t,r,i){return(0,n.mG)(this,void 0,void 0,(function(){var o;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return[4,(o=new e(t,i)).setHelperAsync(r,i.renderTarget||void 0)];case 1:return n.sent(),[2,o]}}))}))},e.prototype._enterXRWithButtonIndex=function(e){return void 0===e&&(e=0),(0,n.mG)(this,void 0,void 0,(function(){var t,r,i;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return this._helper.state!=o.k.IN_XR?[3,2]:[4,this._helper.exitXRAsync()];case 1:return n.sent(),this._updateButtons(null),[3,6];case 2:if(this._helper.state!=o.k.NOT_IN_XR)return[3,6];n.label=3;case 3:return n.trys.push([3,5,,6]),[4,this._helper.enterXRAsync(this._buttons[e].sessionMode,this._buttons[e].referenceSpaceType,this._renderTarget,{optionalFeatures:this.options.optionalFeatures,requiredFeatures:this.options.requiredFeatures})];case 4:return n.sent(),this._updateButtons(this._buttons[e]),[3,6];case 5:return t=n.sent(),this._updateButtons(null),r=this._buttons[e].element,i=r.title,r.title="Error entering XR session : "+i,r.classList.add("xr-error"),this.options.onError&&this.options.onError(t),[3,6];case 6:return[2]}}))}))},e.prototype.dispose=function(){var e=this._scene.getEngine().getInputElement();e&&e.parentNode&&e.parentNode.contains(this.overlay)&&e.parentNode.removeChild(this.overlay),this.activeButtonChangedObservable.clear(),navigator.xr.removeEventListener("sessiongranted",this._onSessionGranted)},e.prototype._updateButtons=function(e){var t=this;this._activeButton=e,this._buttons.forEach((function(e){e.update(t._activeButton)})),this.activeButtonChangedObservable.notifyObservers(this._activeButton)},e}()},90570:(e,t,r)=>{r.d(t,{M:()=>d});var n=r(31191),i=r(62897),o=r(97654),s=r(52281),a=r(9022),l=r(2914),c=r(84318),h=r(71143),u=r(58095),d=function(){function e(e){var t=this;this._scene=e,this._nonVRCamera=null,this._attachedToElement=!1,this._spectatorCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this._spectatorMode=!1,this.onInitialXRPoseSetObservable=new i.y$,this.onStateChangedObservable=new i.y$,this.state=a.k.NOT_IN_XR,this.sessionManager=new o.g(e),this.camera=new s.o("webxr",e,this.sessionManager),this.featuresManager=new l.d(this.sessionManager),e.onDisposeObservable.addOnce((function(){t.dispose()}))}return e.CreateAsync=function(t){var r=new e(t);return r.sessionManager.initializeAsync().then((function(){return r._supported=!0,r})).catch((function(e){throw r._setState(a.k.NOT_IN_XR),r.dispose(),e}))},e.prototype.dispose=function(){var e;this.exitXRAsync(),this.camera.dispose(),this.onStateChangedObservable.clear(),this.onInitialXRPoseSetObservable.clear(),this.sessionManager.dispose(),null===(e=this._spectatorCamera)||void 0===e||e.dispose(),this._nonVRCamera&&(this._scene.activeCamera=this._nonVRCamera)},e.prototype.enterXRAsync=function(e,t,r,i){var o,s;return void 0===r&&(r=this.sessionManager.getWebXRRenderTarget()),void 0===i&&(i={}),(0,n.mG)(this,void 0,void 0,(function(){var h,u,d,p=this;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:if(!this._supported)throw"WebXR not supported in this browser or environment";return this._setState(a.k.ENTERING_XR),"viewer"!==t&&"local"!==t&&(i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.push(t)),[4,this.featuresManager._extendXRSessionInitObject(i)];case 1:i=n.sent(),"immersive-ar"===e&&"unbounded"!==t&&c.Y.Warn("We recommend using 'unbounded' reference space type when using 'immersive-ar' session mode"),n.label=2;case 2:return n.trys.push([2,6,,7]),[4,this.sessionManager.initializeSessionAsync(e,i)];case 3:return n.sent(),[4,this.sessionManager.setReferenceSpaceTypeAsync(t)];case 4:return n.sent(),[4,r.initializeXRLayerAsync(this.sessionManager.session)];case 5:return h=n.sent(),u={depthFar:this.camera.maxZ,depthNear:this.camera.minZ},this.featuresManager.getEnabledFeature(l.b.LAYERS)||(u.baseLayer=h),this.sessionManager.updateRenderState(u),this.sessionManager.runXRRenderLoop(),this._originalSceneAutoClear=this._scene.autoClear,this._nonVRCamera=this._scene.activeCamera,this._attachedToElement=!!(null===(o=this._nonVRCamera)||void 0===o?void 0:o.inputs.attachedToElement),null===(s=this._nonVRCamera)||void 0===s||s.detachControl(),this._scene.activeCamera=this.camera,"immersive-ar"!==e?this._nonXRToXRCamera():(this._scene.autoClear=!1,this.camera.compensateOnFirstFrame=!1,this.camera.position.set(0,0,0),this.camera.rotationQuaternion.set(0,0,0,1)),this.sessionManager.onXRSessionEnded.addOnce((function(){p.state!==a.k.EXITING_XR&&p._setState(a.k.EXITING_XR),p.camera.rigCameras.forEach((function(e){e.outputRenderTarget=null})),p._scene.autoClear=p._originalSceneAutoClear,p._scene.activeCamera=p._nonVRCamera,p._attachedToElement&&p._nonVRCamera&&p._nonVRCamera.attachControl(!!p._nonVRCamera.inputs.noPreventDefault),"immersive-ar"!==e&&p.camera.compensateOnFirstFrame&&(p._nonVRCamera.setPosition?p._nonVRCamera.setPosition(p.camera.position):p._nonVRCamera.position.copyFrom(p.camera.position)),p._setState(a.k.NOT_IN_XR)})),this.sessionManager.onXRFrameObservable.addOnce((function(){p._setState(a.k.IN_XR)})),[2,this.sessionManager];case 6:throw d=n.sent(),this._setState(a.k.NOT_IN_XR),d;case 7:return[2]}}))}))},e.prototype.exitXRAsync=function(){return this.state!==a.k.IN_XR?Promise.resolve():(this._setState(a.k.EXITING_XR),this.sessionManager.exitXRAsync())},e.prototype.enableSpectatorMode=function(){var e=this;if(!this._spectatorMode){var t=function(){e._spectatorCamera&&(e._spectatorCamera.position.copyFrom(e.camera.rigCameras[0].globalPosition),e._spectatorCamera.rotationQuaternion.copyFrom(e.camera.rigCameras[0].absoluteRotation))},r=function(){e.state===a.k.IN_XR?(e._spectatorCamera=new h.x("webxr-spectator",u.P.Zero(),e._scene),e._spectatorCamera.rotationQuaternion=new u._f,e._scene.activeCameras=[e.camera,e._spectatorCamera],e.sessionManager.onXRFrameObservable.add(t),e._scene.onAfterRenderCameraObservable.add((function(t){t===e.camera&&(e._scene.getEngine().framebufferDimensionsObject=null)}))):e.state===a.k.EXITING_XR&&(e.sessionManager.onXRFrameObservable.removeCallback(t),e._scene.activeCameras=null)};this._spectatorMode=!0,this.onStateChangedObservable.add(r),r()}},e.prototype._nonXRToXRCamera=function(){this.camera.setTransformationFromNonVRCamera(this._nonVRCamera),this.onInitialXRPoseSetObservable.notifyObservers(this.camera)},e.prototype._setState=function(e){this.state!==e&&(this.state=e,this.onStateChangedObservable.notifyObservers(this.state))},e}()},2914:(e,t,r)=>{r.d(t,{b:()=>s,d:()=>a});var n,i=r(31191),o=r(13514),s=function(){function e(){}return e.ANCHOR_SYSTEM="xr-anchor-system",e.BACKGROUND_REMOVER="xr-background-remover",e.HIT_TEST="xr-hit-test",e.MESH_DETECTION="xr-mesh-detection",e.PHYSICS_CONTROLLERS="xr-physics-controller",e.PLANE_DETECTION="xr-plane-detection",e.POINTER_SELECTION="xr-controller-pointer-selection",e.TELEPORTATION="xr-controller-teleportation",e.FEATURE_POINTS="xr-feature-points",e.HAND_TRACKING="xr-hand-tracking",e.IMAGE_TRACKING="xr-image-tracking",e.NEAR_INTERACTION="xr-near-interaction",e.DOM_OVERLAY="xr-dom-overlay",e.MOVEMENT="xr-controller-movement",e.LIGHT_ESTIMATION="xr-light-estimation",e.EYE_TRACKING="xr-eye-tracking",e.WALKING_LOCOMOTION="xr-walking-locomotion",e.LAYERS="xr-layers",e}(),a=function(){function e(e){var t=this;this._xrSessionManager=e,this._features={},this._xrSessionManager.onXRSessionInit.add((function(){t.getEnabledFeatures().forEach((function(e){var r=t._features[e];!r.enabled||r.featureImplementation.attached||r.featureImplementation.disableAutoAttach||t.attachFeature(e)}))})),this._xrSessionManager.onXRSessionEnded.add((function(){t.getEnabledFeatures().forEach((function(e){var r=t._features[e];r.enabled&&r.featureImplementation.attached&&t.detachFeature(e)}))}))}return e.AddWebXRFeature=function(e,t,r,n){void 0===r&&(r=1),void 0===n&&(n=!1),this._AvailableFeatures[e]=this._AvailableFeatures[e]||{latest:r},r>this._AvailableFeatures[e].latest&&(this._AvailableFeatures[e].latest=r),n&&(this._AvailableFeatures[e].stable=r),this._AvailableFeatures[e][r]=t},e.ConstructFeature=function(e,t,r,n){void 0===t&&(t=1);var i=this._AvailableFeatures[e][t];if(!i)throw new Error("feature not found");return i(r,n)},e.GetAvailableFeatures=function(){return Object.keys(this._AvailableFeatures)},e.GetAvailableVersions=function(e){return Object.keys(this._AvailableFeatures[e])},e.GetLatestVersionOfFeature=function(e){return this._AvailableFeatures[e]&&this._AvailableFeatures[e].latest||-1},e.GetStableVersionOfFeature=function(e){return this._AvailableFeatures[e]&&this._AvailableFeatures[e].stable||-1},e.prototype.attachFeature=function(e){var t=this._features[e];t&&t.enabled&&!t.featureImplementation.attached&&t.featureImplementation.attach()},e.prototype.detachFeature=function(e){var t=this._features[e];t&&t.featureImplementation.attached&&t.featureImplementation.detach()},e.prototype.disableFeature=function(e){var t="string"==typeof e?e:e.Name,r=this._features[t];return!(!r||!r.enabled)&&(r.enabled=!1,this.detachFeature(t),r.featureImplementation.dispose(),delete this._features[t],!0)},e.prototype.dispose=function(){var e=this;this.getEnabledFeatures().forEach((function(t){e.disableFeature(t)}))},e.prototype.enableFeature=function(t,r,n,i,s){var a=this;void 0===r&&(r="latest"),void 0===n&&(n={}),void 0===i&&(i=!0),void 0===s&&(s=!0);var l="string"==typeof t?t:t.Name,c=0;if("string"==typeof r){if(!r)throw new Error("Error in provided version - ".concat(l," (").concat(r,")"));if(-1===(c="stable"===r?e.GetStableVersionOfFeature(l):"latest"===r?e.GetLatestVersionOfFeature(l):+r)||isNaN(c))throw new Error("feature not found - ".concat(l," (").concat(r,")"))}else c=r;var h=e._ConflictingFeatures[l];if(void 0!==h&&-1!==this.getEnabledFeatures().indexOf(h))throw new Error("Feature ".concat(l," cannot be enabled while ").concat(h," is enabled."));var u=this._features[l],d=e.ConstructFeature(l,c,this._xrSessionManager,n);if(!d)throw new Error("feature not found - ".concat(l));u&&this.disableFeature(l);var p=d();if(p.dependsOn){var _=p.dependsOn.every((function(e){return!!a._features[e]}));if(!_)throw new Error("Dependant features missing. Make sure the following features are enabled - ".concat(p.dependsOn.join(", ")))}if(p.isCompatible())return this._features[l]={featureImplementation:p,enabled:!0,version:c,required:s},i?this._xrSessionManager.session&&!this._features[l].featureImplementation.attached&&this.attachFeature(l):this._features[l].featureImplementation.disableAutoAttach=!0,this._features[l].featureImplementation;if(s)throw new Error("required feature not compatible");return o.w1.Warn("Feature ".concat(l," not compatible with the current environment/browser and was not enabled.")),p},e.prototype.getEnabledFeature=function(e){return this._features[e]&&this._features[e].featureImplementation},e.prototype.getEnabledFeatures=function(){return Object.keys(this._features)},e.prototype._extendXRSessionInitObject=function(e){return(0,i.mG)(this,void 0,void 0,(function(){var t,r,n,o,s,a,l;return(0,i.Jh)(this,(function(c){switch(c.label){case 0:t=this.getEnabledFeatures(),r=0,n=t,c.label=1;case 1:return r<n.length?(o=n[r],s=this._features[o],(a=s.featureImplementation.xrNativeFeatureName)&&(s.required?(e.requiredFeatures=e.requiredFeatures||[],-1===e.requiredFeatures.indexOf(a)&&e.requiredFeatures.push(a)):(e.optionalFeatures=e.optionalFeatures||[],-1===e.optionalFeatures.indexOf(a)&&e.optionalFeatures.push(a))),s.featureImplementation.getXRSessionInitExtension?[4,s.featureImplementation.getXRSessionInitExtension()]:[3,3]):[3,4];case 2:l=c.sent(),e=(0,i.pi)((0,i.pi)({},e),l),c.label=3;case 3:return r++,[3,1];case 4:return[2,e]}}))}))},e._AvailableFeatures={},e._ConflictingFeatures=((n={})[s.TELEPORTATION]=s.MOVEMENT,n[s.MOVEMENT]=s.TELEPORTATION,n),e}()},428:(e,t,r)=>{r.d(t,{t:()=>a});var n=r(31191),i=r(62897),o=r(5412),s=r(51917),a=function(){function e(e,t,r){void 0===r&&(r={});var n=this;if(this.xrSessionManager=e,this.xrCamera=t,this._options=r,this.controllers=[],this.onControllerAddedObservable=new i.y$,this.onControllerRemovedObservable=new i.y$,this._onInputSourcesChange=function(e){n._addAndRemoveControllers(e.added,e.removed)},this._sessionEndedObserver=this.xrSessionManager.onXRSessionEnded.add((function(){n._addAndRemoveControllers([],n.controllers.map((function(e){return e.inputSource})))})),this._sessionInitObserver=this.xrSessionManager.onXRSessionInit.add((function(e){e.addEventListener("inputsourceschange",n._onInputSourcesChange)})),this._frameObserver=this.xrSessionManager.onXRFrameObservable.add((function(e){n.controllers.forEach((function(t){t.updateFromXRFrame(e,n.xrSessionManager.referenceSpace,n.xrCamera)}))})),this._options.customControllersRepositoryURL&&(s.V.BaseRepositoryUrl=this._options.customControllersRepositoryURL),s.V.UseOnlineRepository=!this._options.disableOnlineControllerRepository,s.V.UseOnlineRepository)try{s.V.UpdateProfilesList().catch((function(){s.V.UseOnlineRepository=!1}))}catch(e){s.V.UseOnlineRepository=!1}}return e.prototype._addAndRemoveControllers=function(e,t){for(var r=this,i=this.controllers.map((function(e){return e.inputSource})),s=0,a=e;s<a.length;s++){var l=a[s];if(-1===i.indexOf(l)){var c=new o.e(this.xrSessionManager.scene,l,(0,n.pi)((0,n.pi)({},this._options.controllerOptions||{}),{forceControllerProfile:this._options.forceInputProfile,doNotLoadControllerMesh:this._options.doNotLoadControllerMeshes,disableMotionControllerAnimation:this._options.disableControllerAnimation}));this.controllers.push(c),this.onControllerAddedObservable.notifyObservers(c)}}var h=[],u=[];this.controllers.forEach((function(e){-1===t.indexOf(e.inputSource)?h.push(e):u.push(e)})),this.controllers=h,u.forEach((function(e){r.onControllerRemovedObservable.notifyObservers(e),e.dispose()}))},e.prototype.dispose=function(){this.controllers.forEach((function(e){e.dispose()})),this.xrSessionManager.onXRFrameObservable.remove(this._frameObserver),this.xrSessionManager.onXRSessionInit.remove(this._sessionInitObserver),this.xrSessionManager.onXRSessionEnded.remove(this._sessionEndedObserver),this.onControllerAddedObservable.clear(),this.onControllerRemovedObservable.clear(),s.V.ClearControllerCache()},e}()},5412:(e,t,r)=>{r.d(t,{e:()=>c});var n=r(62897),i=r(71419),o=r(58095),s=r(51917),a=r(13514),l=0,c=function(){function e(e,t,r){void 0===r&&(r={});var c=this;this._scene=e,this.inputSource=t,this._options=r,this._tmpVector=new o.P,this._disposed=!1,this.onDisposeObservable=new n.y$,this.onMeshLoadedObservable=new n.y$,this.onMotionControllerInitObservable=new n.y$,this._uniqueId="controller-".concat(l++,"-").concat(t.targetRayMode,"-").concat(t.handedness),this.pointer=new i.x("".concat(this._uniqueId,"-pointer"),e),this.pointer.rotationQuaternion=new o._f,this.inputSource.gripSpace&&(this.grip=new i.x("".concat(this._uniqueId,"-grip"),this._scene),this.grip.rotationQuaternion=new o._f),this._tmpVector.set(0,0,this._scene.useRightHandedSystem?-1:1),this.inputSource.gamepad&&"tracked-pointer"===this.inputSource.targetRayMode&&s.V.GetMotionControllerWithXRInput(t,e,this._options.forceControllerProfile).then((function(e){c.motionController=e,c.onMotionControllerInitObservable.notifyObservers(e),c._options.doNotLoadControllerMesh||c.motionController._doNotLoadControllerMesh||c.motionController.loadModel().then((function(e){var t;e&&c.motionController&&c.motionController.rootMesh&&(c._options.renderingGroupId&&(c.motionController.rootMesh.renderingGroupId=c._options.renderingGroupId,c.motionController.rootMesh.getChildMeshes(!1).forEach((function(e){return e.renderingGroupId=c._options.renderingGroupId}))),c.onMeshLoadedObservable.notifyObservers(c.motionController.rootMesh),c.motionController.rootMesh.parent=c.grip||c.pointer,c.motionController.disableAnimation=!!c._options.disableMotionControllerAnimation),c._disposed&&(null===(t=c.motionController)||void 0===t||t.dispose())}))}),(function(){a.w1.Warn("Could not find a matching motion controller for the registered input source")}))}return Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this.grip&&this.grip.dispose(!0),this.motionController&&this.motionController.dispose(),this.pointer.dispose(!0),this.onMotionControllerInitObservable.clear(),this.onMeshLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._disposed=!0},e.prototype.getWorldPointerRayToRef=function(e,t){void 0===t&&(t=!1);var r=t&&this.grip?this.grip:this.pointer;o.P.TransformNormalToRef(this._tmpVector,r.getWorldMatrix(),e.direction),e.direction.normalize(),e.origin.copyFrom(r.absolutePosition),e.length=1e3},e.prototype.updateFromXRFrame=function(e,t,r){var n=e.getPose(this.inputSource.targetRaySpace,t);if(this._lastXRPose=n,n){var i=n.transform.position;this.pointer.position.set(i.x,i.y,i.z);var o=n.transform.orientation;this.pointer.rotationQuaternion.set(o.x,o.y,o.z,o.w),this._scene.useRightHandedSystem||(this.pointer.position.z*=-1,this.pointer.rotationQuaternion.z*=-1,this.pointer.rotationQuaternion.w*=-1),this.pointer.parent=r.parent}if(this.inputSource.gripSpace&&this.grip){var s=e.getPose(this.inputSource.gripSpace,t);if(s){i=s.transform.position;var a=s.transform.orientation;this.grip.position.set(i.x,i.y,i.z),this.grip.rotationQuaternion.set(a.x,a.y,a.z,a.w),this._scene.useRightHandedSystem||(this.grip.position.z*=-1,this.grip.rotationQuaternion.z*=-1,this.grip.rotationQuaternion.w*=-1)}this.grip.parent=r.parent}this.motionController&&this.motionController.updateFromXRFrame(e)},e}()},64829:(e,t,r)=>{r.d(t,{s:()=>n});var n=function(){function e(e,t,r,n,i){this.getWidth=e,this.getHeight=t,this.layer=r,this.layerType=n,this.createRenderTargetTextureProvider=i}return Object.defineProperty(e.prototype,"isFixedFoveationSupported",{get:function(){return"XRWebGLLayer"==this.layerType&&"number"==typeof this.layer.fixedFoveation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fixedFoveation",{get:function(){return this.isFixedFoveationSupported?this.layer.fixedFoveation:null},set:function(e){if(this.isFixedFoveationSupported){var t=Math.max(0,Math.min(1,e||0));this.layer.fixedFoveation=t}},enumerable:!1,configurable:!0}),e}()},3195:(e,t,r)=>{r.d(t,{_:()=>a,n:()=>l});var n=r(31191),i=r(62897),o=r(13514),s=r(44347),a=function(){function e(){}return e.GetDefaults=function(t){var r=new e;return r.canvasOptions={antialias:!0,depth:!0,stencil:!t||t.isStencilEnable,alpha:!0,multiview:!1,framebufferScaleFactor:1},r.newCanvasCssStyle="position:absolute; bottom:0px;right:0px;z-index:10;width:90%;height:100%;background-color: #000000;",r},e}(),l=function(){function e(e,t){void 0===t&&(t=a.GetDefaults());var r=this;if(this._options=t,this._canvas=null,this._engine=null,this.xrLayer=null,this._xrLayerWrapper=null,this.onXRLayerInitObservable=new i.y$,this._engine=e.scene.getEngine(),this._engine.onDisposeObservable.addOnce((function(){r._engine=null})),t.canvasElement)this._setManagedOutputCanvas(t.canvasElement);else{var n=document.createElement("canvas");n.style.cssText=this._options.newCanvasCssStyle||"position:absolute; bottom:0px;right:0px;",this._setManagedOutputCanvas(n)}e.onXRSessionInit.add((function(){r._addCanvas()})),e.onXRSessionEnded.add((function(){r._removeCanvas()}))}return e.prototype.dispose=function(){this._removeCanvas(),this._setManagedOutputCanvas(null)},e.prototype.initializeXRLayerAsync=function(e){return(0,n.mG)(this,void 0,void 0,(function(){var t,r=this;return(0,n.Jh)(this,(function(n){return t=function(){return r.xrLayer=new XRWebGLLayer(e,r.canvasContext,r._options.canvasOptions),r._xrLayerWrapper=new s.J(r.xrLayer),r.onXRLayerInitObservable.notifyObservers(r.xrLayer),r.xrLayer},this.canvasContext.makeXRCompatible?[2,this.canvasContext.makeXRCompatible().then((function(){}),(function(){o.w1.Warn("Error executing makeXRCompatible. This does not mean that the session will work incorrectly.")})).then((function(){return t()}))]:[2,Promise.resolve(t())]}))}))},e.prototype._addCanvas=function(){var e=this;this._canvas&&this._engine&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.appendChild(this._canvas),this.xrLayer?this._setCanvasSize(!0):this.onXRLayerInitObservable.addOnce((function(){e._setCanvasSize(!0)}))},e.prototype._removeCanvas=function(){this._canvas&&this._engine&&document.body.contains(this._canvas)&&this._canvas!==this._engine.getRenderingCanvas()&&document.body.removeChild(this._canvas),this._setCanvasSize(!1)},e.prototype._setCanvasSize=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=this._xrLayerWrapper),this._canvas&&this._engine&&(e?t&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=t.getWidth()+"px",this._canvas.style.height=t.getHeight()+"px"):this._engine.setSize(t.getWidth(),t.getHeight())):this._originalCanvasSize&&(this._canvas!==this._engine.getRenderingCanvas()?(this._canvas.style.width=this._originalCanvasSize.width+"px",this._canvas.style.height=this._originalCanvasSize.height+"px"):this._engine.setSize(this._originalCanvasSize.width,this._originalCanvasSize.height)))},e.prototype._setManagedOutputCanvas=function(e){this._removeCanvas(),e?(this._originalCanvasSize={width:e.offsetWidth,height:e.offsetHeight},this._canvas=e,this.canvasContext=this._canvas.getContext("webgl2"),this.canvasContext||(this.canvasContext=this._canvas.getContext("webgl"))):(this._canvas=null,this.canvasContext=null)},e}()},69022:(e,t,r)=>{r.d(t,{y:()=>a});var n=r(61319),i=r(7949),o=r(19363),s=r(63784),a=function(){function e(e,t){this._scene=e,this.layerWrapper=t,this._renderTargetTextures=new Array,this._engine=e.getEngine()}return e.prototype._createInternalTexture=function(e,t){var r=new i.l(this._engine,i.S.Unknown,!0);return r.width=e.width,r.height=e.height,r._hardwareTexture=new n.B(t,this._engine._gl),r.isReady=!0,r},e.prototype._createRenderTargetTexture=function(e,t,r,n,i,a){if(!this._engine)throw new Error("Engine is disposed");var l={width:e,height:t},c=a?new o.x(this._scene,l):new s._("XR renderTargetTexture",l,this._scene),h=c.renderTarget;if(!r&&n||(h._framebuffer=r),n)if(a)h._colorTextureArray=n;else{var u=this._createInternalTexture(l,n);h.setTexture(u,0),c._texture=u}return i&&(a?h._depthStencilTextureArray=i:h._depthStencilTexture=this._createInternalTexture(l,i)),c.disableRescaling(),"undefined"!=typeof XRWebGLBinding&&(c.skipInitialClear=!0),this._renderTargetTextures.push(c),c},e.prototype._destroyRenderTargetTexture=function(e){this._renderTargetTextures.splice(this._renderTargetTextures.indexOf(e),1),e.dispose()},e.prototype.getFramebufferDimensions=function(){return this._framebufferDimensions},e.prototype.dispose=function(){this._renderTargetTextures.forEach((function(e){return e.dispose()})),this._renderTargetTextures.length=0},e}()},97654:(e,t,r)=>{r.d(t,{g:()=>l});var n=r(84318),i=r(62897),o=r(3195),s=r(97001),a=r(44347),l=function(){function e(e){var t=this;this.scene=e,this.currentTimestamp=-1,this.defaultHeightCompensation=1.7,this.onXRFrameObservable=new i.y$,this.onXRReferenceSpaceChanged=new i.y$,this.onXRSessionEnded=new i.y$,this.onXRSessionInit=new i.y$,this.inXRFrameLoop=!1,this.inXRSession=!1,this._engine=e.getEngine(),this._onEngineDisposedObserver=this._engine.onDisposeObservable.addOnce((function(){t._engine=null})),e.onDisposeObservable.addOnce((function(){t.dispose()}))}return Object.defineProperty(e.prototype,"referenceSpace",{get:function(){return this._referenceSpace},set:function(e){this._referenceSpace=e,this.onXRReferenceSpaceChanged.notifyObservers(this._referenceSpace)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionMode",{get:function(){return this._sessionMode},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){var e;this.inXRSession&&this.exitXRAsync(),this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear(),this.onXRReferenceSpaceChanged.clear(),this.onXRSessionInit.clear(),null===(e=this._engine)||void 0===e||e.onDisposeObservable.remove(this._onEngineDisposedObserver),this._engine=null},e.prototype.exitXRAsync=function(){return this.session&&this.inXRSession?(this.inXRSession=!1,this.session.end().catch((function(){n.Y.Warn("Could not end XR session.")}))):Promise.resolve()},e.prototype.trySetViewportForView=function(e,t){var r;return(null===(r=this._baseLayerRTTProvider)||void 0===r?void 0:r.trySetViewportForView(e,t))||!1},e.prototype.getRenderTargetTextureForEye=function(e){var t;return(null===(t=this._baseLayerRTTProvider)||void 0===t?void 0:t.getRenderTargetTextureForEye(e))||null},e.prototype.getRenderTargetTextureForView=function(e){var t;return(null===(t=this._baseLayerRTTProvider)||void 0===t?void 0:t.getRenderTargetTextureForView(e))||null},e.prototype.getWebXRRenderTarget=function(e){var t=this.scene.getEngine();return this._xrNavigator.xr.native?new s.HK(this):((e=e||o._.GetDefaults(t)).canvasElement=e.canvasElement||t.getRenderingCanvas()||void 0,new o.n(this,e))},e.prototype.initializeAsync=function(){return this._xrNavigator=navigator,this._xrNavigator.xr?Promise.resolve():Promise.reject("WebXR not available")},e.prototype.initializeSessionAsync=function(e,t){var r=this;return void 0===e&&(e="immersive-vr"),void 0===t&&(t={}),this._xrNavigator.xr.requestSession(e,t).then((function(t){return r.session=t,r._sessionMode=e,r.onXRSessionInit.notifyObservers(t),r.inXRSession=!0,r.session.addEventListener("end",(function(){var e;r.inXRSession=!1,r.onXRSessionEnded.notifyObservers(null),r._engine&&(r._engine.framebufferDimensionsObject=null,r._engine.restoreDefaultFramebuffer(),r._engine.customAnimationFrameRequester=null,r._engine._renderLoop()),r.isNative&&(null===(e=r._baseLayerRTTProvider)||void 0===e||e.dispose()),r._baseLayerRTTProvider=null,r._baseLayerWrapper=null}),{once:!0}),r.session}))},e.prototype.isSessionSupportedAsync=function(t){return e.IsSessionSupportedAsync(t)},e.prototype.resetReferenceSpace=function(){this.referenceSpace=this.baseReferenceSpace},e.prototype.runXRRenderLoop=function(){var e,t=this;this.inXRSession&&this._engine&&(this._engine.customAnimationFrameRequester={requestAnimationFrame:this.session.requestAnimationFrame.bind(this.session),renderFunction:function(e,r){var n;t.inXRSession&&t._engine&&(t.currentFrame=r,t.currentTimestamp=e,r&&(t.inXRFrameLoop=!0,t._engine.framebufferDimensionsObject=(null===(n=t._baseLayerRTTProvider)||void 0===n?void 0:n.getFramebufferDimensions())||null,t.onXRFrameObservable.notifyObservers(r),t._engine._renderLoop(),t._engine.framebufferDimensionsObject=null,t.inXRFrameLoop=!1))}},this._engine.framebufferDimensionsObject=(null===(e=this._baseLayerRTTProvider)||void 0===e?void 0:e.getFramebufferDimensions())||null,"undefined"!=typeof window&&window.cancelAnimationFrame&&window.cancelAnimationFrame(this._engine._frameHandler),this._engine._renderLoop())},e.prototype.setReferenceSpaceTypeAsync=function(e){var t=this;return void 0===e&&(e="local-floor"),this.session.requestReferenceSpace(e).then((function(e){return e}),(function(e){return n.Y.Error("XR.requestReferenceSpace failed for the following reason: "),n.Y.Error(e),n.Y.Log('Defaulting to universally-supported "viewer" reference space type.'),t.session.requestReferenceSpace("viewer").then((function(e){var r=new XRRigidTransform({x:0,y:-t.defaultHeightCompensation,z:0});return e.getOffsetReferenceSpace(r)}),(function(e){throw n.Y.Error(e),'XR initialization failed: required "viewer" reference space type not supported.'}))})).then((function(e){return t.session.requestReferenceSpace("viewer").then((function(r){return t.viewerReferenceSpace=r,e}))})).then((function(e){return t.referenceSpace=t.baseReferenceSpace=e,t.referenceSpace}))},e.prototype.updateRenderStateAsync=function(e){return Promise.resolve(this.session.updateRenderState(e))},e.prototype._setBaseLayerWrapper=function(e){var t,r;this.isNative&&(null===(t=this._baseLayerRTTProvider)||void 0===t||t.dispose()),this._baseLayerWrapper=e,this._baseLayerRTTProvider=(null===(r=this._baseLayerWrapper)||void 0===r?void 0:r.createRenderTargetTextureProvider(this))||null},e.prototype.updateRenderState=function(e){e.baseLayer&&this._setBaseLayerWrapper(this.isNative?new s.z5(e.baseLayer):new a.J(e.baseLayer)),this.session.updateRenderState(e)},e.IsSessionSupportedAsync=function(e){if(!navigator.xr)return Promise.resolve(!1);var t=navigator.xr.isSessionSupported||navigator.xr.supportsSession;return t?t.call(navigator.xr,e).then((function(e){var t=void 0===e||e;return Promise.resolve(t)})).catch((function(e){return n.Y.Warn(e),Promise.resolve(!1)})):Promise.resolve(!1)},Object.defineProperty(e.prototype,"isNative",{get:function(){var e;return null!==(e=this._xrNavigator.xr.native)&&void 0!==e&&e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFrameRate",{get:function(){var e;return null===(e=this.session)||void 0===e?void 0:e.frameRate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportedFrameRates",{get:function(){var e;return null===(e=this.session)||void 0===e?void 0:e.supportedFrameRates},enumerable:!1,configurable:!0}),e.prototype.updateTargetFrameRate=function(e){return this.session.updateTargetFrameRate(e)},e.prototype.runInXRFrame=function(e,t){void 0===t&&(t=!0),this.inXRFrameLoop?e():!this.inXRSession&&t||this.onXRFrameObservable.addOnce(e)},Object.defineProperty(e.prototype,"isFixedFoveationSupported",{get:function(){var e;return(null===(e=this._baseLayerWrapper)||void 0===e?void 0:e.isFixedFoveationSupported)||!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fixedFoveation",{get:function(){var e;return(null===(e=this._baseLayerWrapper)||void 0===e?void 0:e.fixedFoveation)||null},set:function(e){var t=Math.max(0,Math.min(1,e||0));this._baseLayerWrapper&&(this._baseLayerWrapper.fixedFoveation=t)},enumerable:!1,configurable:!0}),e}()},9022:(e,t,r)=>{var n,i;r.d(t,{j:()=>i,k:()=>n}),function(e){e[e.ENTERING_XR=0]="ENTERING_XR",e[e.EXITING_XR=1]="EXITING_XR",e[e.IN_XR=2]="IN_XR",e[e.NOT_IN_XR=3]="NOT_IN_XR"}(n||(n={})),function(e){e[e.NOT_TRACKING=0]="NOT_TRACKING",e[e.TRACKING_LOST=1]="TRACKING_LOST",e[e.TRACKING=2]="TRACKING"}(i||(i={}))},44347:(e,t,r)=>{r.d(t,{J:()=>s});var n=r(31191),i=r(64829),o=r(69022),s=function(e){function t(t){var r=e.call(this,(function(){return t.framebufferWidth}),(function(){return t.framebufferHeight}),t,"XRWebGLLayer",(function(e){return new a(e.scene,r)}))||this;return r.layer=t,r}return(0,n.ZT)(t,e),t}(i.s),a=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.layerWrapper=r,n._layer=r.layer,n._framebufferDimensions={framebufferWidth:n._layer.framebufferWidth,framebufferHeight:n._layer.framebufferHeight},n}return(0,n.ZT)(t,e),t.prototype.trySetViewportForView=function(e,t){var r=this._layer.getViewport(t),n=this._framebufferDimensions.framebufferWidth,i=this._framebufferDimensions.framebufferHeight;return e.x=r.x/n,e.y=r.y/i,e.width=r.width/n,e.height=r.height/i,!0},t.prototype.getRenderTargetTextureForEye=function(e){var t=this._layer.framebufferWidth,r=this._layer.framebufferHeight,n=this._layer.framebuffer;return this._rtt&&t===this._framebufferDimensions.framebufferWidth&&r===this._framebufferDimensions.framebufferHeight&&n===this._framebuffer||(this._rtt=this._createRenderTargetTexture(t,r,n),this._framebufferDimensions.framebufferWidth=t,this._framebufferDimensions.framebufferHeight=r,this._framebuffer=n),this._rtt},t.prototype.getRenderTargetTextureForView=function(e){return this.getRenderTargetTextureForEye(e.eye)},t}(o.y)},57755:(e,t,r)=>{r.d(t,{p:()=>n});var n=function(){function e(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return e.AddParser=function(e,t){this._BabylonFileParsers[e]=t},e.GetParser=function(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null},e.AddIndividualParser=function(e,t){this._IndividualBabylonFileParsers[e]=t},e.GetIndividualParser=function(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null},e.Parse=function(e,t,r,n){for(var i in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,i)&&this._BabylonFileParsers[i](e,t,r,n)},Object.defineProperty(e.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture=e},enumerable:!1,configurable:!0}),e.prototype.getNodes=function(){var e=new Array;return e=(e=(e=(e=e.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach((function(t){return e=e.concat(t.bones)})),e},e._BabylonFileParsers={},e._IndividualBabylonFileParsers={},e}()},7701:(e,t,r)=>{r.d(t,{TJ:()=>h,fD:()=>l,ve:()=>c});var n=r(31191),i=r(57755),o=r(91243),s=r(84318),a=r(15210),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.ZT)(t,e),t}(i.p),c=function(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]},h=function(e){function t(t){var r=e.call(this)||this;return r._wasAddedToScene=!1,(t=t||a.l.LastCreatedScene)?(r.scene=t,r.sounds=[],r.effectLayers=[],r.layers=[],r.lensFlareSystems=[],r.proceduralTextures=[],r.reflectionProbes=[],t.onDisposeObservable.add((function(){r._wasAddedToScene||r.dispose()})),r._onContextRestoredObserver=t.getEngine().onContextRestoredObservable.add((function(){for(var e=0,t=r.geometries;e<t.length;e++){t[e]._rebuild()}for(var n=0,i=r.meshes;n<i.length;n++){i[n]._rebuild()}for(var o=0,s=r.particleSystems;o<s.length;o++){s[o].rebuild()}for(var a=0,l=r.textures;a<l.length;a++){l[a]._rebuild()}})),r):r}return(0,n.ZT)(t,e),t.prototype.instantiateModelsToScene=function(e,t,r){var n=this;void 0===t&&(t=!1);var i={},s={},a=new c,l=[],h=[];r||(r={doNotInstantiate:!0});var u=function(t,r){if(i[t.uniqueId]=r.uniqueId,s[r.uniqueId]=r,e&&(r.name=e(t.name)),r instanceof o.Kj){var n=r;if(n.morphTargetManager){var a=t.morphTargetManager;n.morphTargetManager=a.clone();for(var l=0;l<a.numTargets;l++){var c=a.getTarget(l),h=n.morphTargetManager.getTarget(l);i[c.uniqueId]=h.uniqueId,s[h.uniqueId]=h}}}};return this.transformNodes.forEach((function(e){if((!r||!r.predicate||r.predicate(e))&&!e.parent){var t=e.instantiateHierarchy(null,r,(function(e,t){u(e,t)}));t&&a.rootNodes.push(t)}})),this.meshes.forEach((function(o){if((!r||!r.predicate||r.predicate(o))&&!o.parent){var l=o.instantiateHierarchy(null,r,(function(r,o){if(u(r,o),o.material){var a=o;if(a.material)if(t){var l=r.material;if(-1===h.indexOf(l)){var c=l.clone(e?e(l.name):"Clone of "+l.name);if(h.push(l),i[l.uniqueId]=c.uniqueId,s[c.uniqueId]=c,"MultiMaterial"===l.getClassName()){for(var d=l,p=0,_=d.subMaterials;p<_.length;p++){var f=_[p];f&&(c=f.clone(e?e(f.name):"Clone of "+f.name),h.push(f),i[f.uniqueId]=c.uniqueId,s[c.uniqueId]=c)}d.subMaterials=d.subMaterials.map((function(e){return e&&s[i[e.uniqueId]]}))}}"InstancedMesh"!==a.getClassName()&&(a.material=s[i[l.uniqueId]])}else"MultiMaterial"===a.material.getClassName()?-1===n.scene.multiMaterials.indexOf(a.material)&&n.scene.addMultiMaterial(a.material):-1===n.scene.materials.indexOf(a.material)&&n.scene.addMaterial(a.material)}}));l&&a.rootNodes.push(l)}})),this.skeletons.forEach((function(t){if(!r||!r.predicate||r.predicate(t)){for(var o=t.clone(e?e(t.name):"Clone of "+t.name),c=0,h=n.meshes;c<h.length;c++){var u=h[c];if(u.skeleton===t&&!u.isAnInstance){var d=s[i[u.uniqueId]];if(d.isAnInstance)continue;if(d.skeleton=o,-1!==l.indexOf(o))continue;l.push(o);for(var p=0,_=o.bones;p<_.length;p++){var f=_[p];f._linkedTransformNode&&(f._linkedTransformNode=s[i[f._linkedTransformNode.uniqueId]])}}}a.skeletons.push(o)}})),this.animationGroups.forEach((function(t){if(!r||!r.predicate||r.predicate(t)){var n=t.clone(e?e(t.name):"Clone of "+t.name,(function(e){return s[i[e.uniqueId]]||e}));a.animationGroups.push(n)}})),a},t.prototype.addAllToScene=function(){if(!this._wasAddedToScene){this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var e=0,t=this.scene._serializableComponents;e<t.length;e++){t[e].addFromContainer(this)}this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}},t.prototype.addToScene=function(e){var t=this;void 0===e&&(e=null),this.cameras.forEach((function(r){e&&!e(r)||t.scene.addCamera(r)})),this.lights.forEach((function(r){e&&!e(r)||t.scene.addLight(r)})),this.meshes.forEach((function(r){e&&!e(r)||t.scene.addMesh(r)})),this.skeletons.forEach((function(r){e&&!e(r)||t.scene.addSkeleton(r)})),this.animations.forEach((function(r){e&&!e(r)||t.scene.addAnimation(r)})),this.animationGroups.forEach((function(r){e&&!e(r)||t.scene.addAnimationGroup(r)})),this.multiMaterials.forEach((function(r){e&&!e(r)||t.scene.addMultiMaterial(r)})),this.materials.forEach((function(r){e&&!e(r)||t.scene.addMaterial(r)})),this.morphTargetManagers.forEach((function(r){e&&!e(r)||t.scene.addMorphTargetManager(r)})),this.geometries.forEach((function(r){e&&!e(r)||t.scene.addGeometry(r)})),this.transformNodes.forEach((function(r){e&&!e(r)||t.scene.addTransformNode(r)})),this.actionManagers.forEach((function(r){e&&!e(r)||t.scene.addActionManager(r)})),this.textures.forEach((function(r){e&&!e(r)||t.scene.addTexture(r)})),this.reflectionProbes.forEach((function(r){e&&!e(r)||t.scene.addReflectionProbe(r)}))},t.prototype.removeAllFromScene=function(){this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var e=0,t=this.scene._serializableComponents;e<t.length;e++){t[e].removeFromContainer(this)}},t.prototype.removeFromScene=function(e){var t=this;void 0===e&&(e=null),this.cameras.forEach((function(r){e&&!e(r)||t.scene.removeCamera(r)})),this.lights.forEach((function(r){e&&!e(r)||t.scene.removeLight(r)})),this.meshes.forEach((function(r){e&&!e(r)||t.scene.removeMesh(r)})),this.skeletons.forEach((function(r){e&&!e(r)||t.scene.removeSkeleton(r)})),this.animations.forEach((function(r){e&&!e(r)||t.scene.removeAnimation(r)})),this.animationGroups.forEach((function(r){e&&!e(r)||t.scene.removeAnimationGroup(r)})),this.multiMaterials.forEach((function(r){e&&!e(r)||t.scene.removeMultiMaterial(r)})),this.materials.forEach((function(r){e&&!e(r)||t.scene.removeMaterial(r)})),this.morphTargetManagers.forEach((function(r){e&&!e(r)||t.scene.removeMorphTargetManager(r)})),this.geometries.forEach((function(r){e&&!e(r)||t.scene.removeGeometry(r)})),this.transformNodes.forEach((function(r){e&&!e(r)||t.scene.removeTransformNode(r)})),this.actionManagers.forEach((function(r){e&&!e(r)||t.scene.removeActionManager(r)})),this.textures.forEach((function(r){e&&!e(r)||t.scene.removeTexture(r)})),this.reflectionProbes.forEach((function(r){e&&!e(r)||t.scene.removeReflectionProbe(r)}))},t.prototype.dispose=function(){this.cameras.slice(0).forEach((function(e){e.dispose()})),this.cameras=[],this.lights.slice(0).forEach((function(e){e.dispose()})),this.lights=[],this.meshes.slice(0).forEach((function(e){e.dispose()})),this.meshes=[],this.skeletons.slice(0).forEach((function(e){e.dispose()})),this.skeletons=[],this.animationGroups.slice(0).forEach((function(e){e.dispose()})),this.animationGroups=[],this.multiMaterials.slice(0).forEach((function(e){e.dispose()})),this.multiMaterials=[],this.materials.slice(0).forEach((function(e){e.dispose()})),this.materials=[],this.geometries.slice(0).forEach((function(e){e.dispose()})),this.geometries=[],this.transformNodes.slice(0).forEach((function(e){e.dispose()})),this.transformNodes=[],this.actionManagers.slice(0).forEach((function(e){e.dispose()})),this.actionManagers=[],this.textures.slice(0).forEach((function(e){e.dispose()})),this.textures=[],this.reflectionProbes.slice(0).forEach((function(e){e.dispose()})),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var e=0,t=this.scene._serializableComponents;e<t.length;e++){t[e].removeFromContainer(this,!0)}this._onContextRestoredObserver&&(this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)},t.prototype._moveAssets=function(e,t,r){if(e)for(var n=0,i=e;n<i.length;n++){var o=i[n],s=!0;if(r)for(var a=0,l=r;a<l.length;a++){if(o===l[a]){s=!1;break}}s&&(t.push(o),o._parentContainer=this)}},t.prototype.moveAllFromScene=function(e){for(var t in this._wasAddedToScene=!1,void 0===e&&(e=new l),this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=this[t]||("environmentTexture"===t?null:[]),this._moveAssets(this.scene[t],this[t],e[t]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()},t.prototype.createRootMesh=function(){var e=new o.Kj("assetContainerRootMesh",this.scene);return this.meshes.forEach((function(t){t.parent||e.addChild(t)})),this.meshes.unshift(e),e},t.prototype.mergeAnimationsTo=function(e,t,r){if(void 0===e&&(e=a.l.LastCreatedScene),void 0===r&&(r=null),!e)return s.Y.Error("No scene available to merge animations to"),[];var n=r||function(t){var r=null,n=t.animations.length?t.animations[0].targetProperty:"",i=t.name.split(".").join("").split("_primitive")[0];switch(n){case"position":case"rotationQuaternion":r=e.getTransformNodeByName(t.name)||e.getTransformNodeByName(i);break;case"influence":r=e.getMorphTargetByName(t.name)||e.getMorphTargetByName(i);break;default:r=e.getNodeByName(t.name)||e.getNodeByName(i)}return r};this.getNodes().forEach((function(e){var t=n(e);if(null!==t){for(var r=function(e){for(var r=0,n=t.animations.filter((function(t){return t.targetProperty===e.targetProperty}));r<n.length;r++){var i=n[r],o=t.animations.indexOf(i,0);o>-1&&t.animations.splice(o,1)}},i=0,o=e.animations;i<o.length;i++){r(o[i])}t.animations=t.animations.concat(e.animations)}}));var i=new Array;return this.animationGroups.slice().forEach((function(e){i.push(e.clone(e.name,n)),e.animatables.forEach((function(e){e.stop()}))})),t.forEach((function(t){var r=n(t.target);r&&(e.beginAnimation(r,t.fromFrame,t.toFrame,t.loopAnimation,t.speedRatio,t.onAnimationEnd?t.onAnimationEnd:void 0,void 0,!0,void 0,t.onAnimationLoop?t.onAnimationLoop:void 0),e.stopAnimation(t.target))})),i},t}(i.p)},2851:(e,t,r)=>{r.r(t),r.d(t,{AbstractActionManager:()=>i.O,AbstractAssetTask:()=>q.vpg,AbstractMesh:()=>A.x2,AbstractScene:()=>n.p,AcquireNativeObjectAsync:()=>v.LN,Action:()=>i.aU,ActionEvent:()=>i.VX,ActionManager:()=>i.kO,AddBlock:()=>E.SXg,AddressMode:()=>v.OB,AdvancedTimer:()=>q.xbB,AlphaState:()=>U.Q,AmmoJSPlugin:()=>k.be,AnaglyphArcRotateCamera:()=>d.uA,AnaglyphFreeCamera:()=>d.Z5,AnaglyphGamepadCamera:()=>d.T3,AnaglyphPostProcess:()=>L.kT,AnaglyphUniversalCamera:()=>d.HE,Analyser:()=>a.qk,AndOrNotEvaluator:()=>q.qWT,Angle:()=>I.RZ,Animatable:()=>o.H4,AnimatedInputBlockTypes:()=>E.cU0,Animation:()=>o.fw,AnimationEvent:()=>o.OB,AnimationGroup:()=>o.Oj,AnimationKeyInterpolation:()=>o.Nv,AnimationPropertiesOverride:()=>o.XD,AnimationRange:()=>o.Xu,AnisotropyBlock:()=>E.pkP,ApplyPostProcess:()=>q.$03,Arc2:()=>I.Q,ArcFollowCamera:()=>d.YR,ArcRotateCamera:()=>d.Yf,ArcRotateCameraGamepadInput:()=>d.Rs,ArcRotateCameraInputsManager:()=>d.$m,ArcRotateCameraKeyboardMoveInput:()=>d.vh,ArcRotateCameraMouseWheelInput:()=>d.F7,ArcRotateCameraPointersInput:()=>d.Hn,ArcRotateCameraVRDeviceOrientationInput:()=>d.u_,ArcTan2Block:()=>E.xDD,AssetContainer:()=>s.TJ,AssetTaskState:()=>q.l4N,AssetsManager:()=>q.SpM,AssetsProgressEvent:()=>q.yHH,AsyncLoop:()=>q.$g_,AttachToBoxBehavior:()=>c.lt,AudioEngine:()=>a.L,AudioSceneComponent:()=>a.c4,AutoLayoutMode:()=>v.fu,AutoReleaseWorkerPool:()=>q.vF6,AutoRotationBehavior:()=>c.ol,AxesViewer:()=>m.wM,Axis:()=>I.RD,AxisDragGizmo:()=>R.uy,AxisScaleGizmo:()=>R.$K,BRDFTextureTools:()=>q.DJx,BabylonFileLoaderConfiguration:()=>S.vq,BackEase:()=>o.ud,BackgroundMaterial:()=>E.Iij,BakedVertexAnimationManager:()=>l.I,BaseCameraMouseWheelInput:()=>d.Y$,BaseCameraPointersInput:()=>d.O6,BaseError:()=>q.GUI,BaseParticleSystem:()=>w.U4,BaseSixDofDragBehavior:()=>c.NA,BaseTexture:()=>E.VL4,BasisTools:()=>q.Mx,BasisToolsOptions:()=>q.iaP,BasisTranscodeConfiguration:()=>q._Bh,BezierCurve:()=>I.hr,BezierCurveEase:()=>o.sj,BinaryFileAssetTask:()=>q.Ro4,BlackAndWhitePostProcess:()=>L.Oy,BlendFactor:()=>v.zi,BlendOperation:()=>v.db,BloomEffect:()=>L.rk,BloomMergePostProcess:()=>L.GV,BlurPostProcess:()=>L.ik,Bone:()=>h.N$,BoneAxesViewer:()=>m.ch,BoneIKController:()=>h.rl,BoneLookController:()=>h.B9,BonesBlock:()=>E.QcV,BounceEase:()=>o.R$,BouncingBehavior:()=>c.ri,BoundingBox:()=>f.kB,BoundingBoxGizmo:()=>R.CP,BoundingBoxRenderer:()=>G.uM,BoundingInfo:()=>f.jF,BoundingSphere:()=>f.KM,BoxBuilder:()=>A.kg,BoxParticleEmitter:()=>w.S3,Buffer:()=>u.lW,BufferBindingType:()=>v.Rs,BufferUsage:()=>v.FB,CSG:()=>A.yU,Camera:()=>d.V1,CameraGizmo:()=>R.kP,CameraInputTypes:()=>d.u7,CameraInputsManager:()=>d.pq,CannonJSPlugin:()=>k.sz,CanvasCompositingAlphaMode:()=>v.nw,CapsuleBuilder:()=>A.KY,CascadedShadowGenerator:()=>T.RS,ChromaticAberrationPostProcess:()=>L.nE,CircleEase:()=>o.qP,CircleOfConfusionPostProcess:()=>L.NF,ClampBlock:()=>E.K0_,ClearCoatBlock:()=>E.N_3,ClipPlanesBlock:()=>E.x1T,ClipboardEventTypes:()=>y.py,ClipboardInfo:()=>y.oF,CloudBlock:()=>E.QTo,CloudPoint:()=>w.QV,Collider:()=>p.YM,Color3:()=>I.Wo,Color3Gradient:()=>q.cwf,Color4:()=>I.HE,ColorCorrectionPostProcess:()=>L.y6,ColorCurves:()=>E.UBy,ColorGradient:()=>q.bK8,ColorGradingTexture:()=>E.Ek2,ColorMergerBlock:()=>E.d_6,ColorSplitterBlock:()=>E.vFz,ColorWriteFlags:()=>v.Ie,CombineAction:()=>i.IA,CompareFunction:()=>v.wb,CompatibilityOptions:()=>Ct.e,CompilationMessageType:()=>v.mj,ComputeBindingType:()=>v.t2,ComputeEffect:()=>_.n,ComputePassTimestampLocation:()=>v.HR,ComputePressureObserverWrapper:()=>q.Dv9,ComputeShader:()=>_.U,ComputeShaderParticleSystem:()=>w.fc,Condition:()=>i.gP,ConditionalBlock:()=>E.T05,ConditionalBlockConditions:()=>E.GLq,ConeParticleEmitter:()=>w.LV,Constants:()=>v.gT,ContainerAssetTask:()=>q.aVv,ConvolutionPostProcess:()=>L.mt,Coordinate:()=>I.c7,CopyTools:()=>q.r1M,CreateBox:()=>A.NR,CreateBoxVertexData:()=>A.aR,CreateCapsule:()=>A.iz,CreateCapsuleVertexData:()=>A.VF,CreateCylinder:()=>A.wf,CreateCylinderVertexData:()=>A.zD,CreateDashedLines:()=>A.Gz,CreateDashedLinesVertexData:()=>A.BH,CreateDecal:()=>A.tY,CreateDisc:()=>A.uH,CreateEnvTextureAsync:()=>q.p6z,CreateGeodesic:()=>A.MP,CreateGoldberg:()=>A._l,CreateGoldbergVertexData:()=>A.wl,CreateGround:()=>A.$6,CreateGroundFromHeightMap:()=>A.W,CreateGroundFromHeightMapVertexData:()=>A.Qq,CreateGroundVertexData:()=>A.kt,CreateHemisphere:()=>A.qL,CreateIcoSphere:()=>A.Au,CreateIcoSphereVertexData:()=>A.GQ,CreateImageDataArrayBufferViews:()=>q.Don,CreateLathe:()=>A.OV,CreateLineSystem:()=>A.xW,CreateLineSystemVertexData:()=>A.eW,CreateLines:()=>A.nL,CreatePlane:()=>A.pT,CreatePlaneVertexData:()=>A.Hq,CreatePolygon:()=>A.a4,CreatePolygonVertexData:()=>A.gl,CreatePolyhedron:()=>A.sh,CreatePolyhedronVertexData:()=>A.Qy,CreateResizedCopy:()=>q.cWA,CreateRibbon:()=>A.LY,CreateRibbonVertexData:()=>A.jM,CreateScreenshot:()=>q.qB,CreateScreenshotAsync:()=>q.MKb,CreateScreenshotUsingRenderTarget:()=>q.Thz,CreateScreenshotUsingRenderTargetAsync:()=>q.mEG,CreateScreenshotWithResizeAsync:()=>q.ng$,CreateSphere:()=>A.Qk,CreateSphereVertexData:()=>A.jY,CreateTiledBox:()=>A.cQ,CreateTiledBoxVertexData:()=>A.qS,CreateTiledGround:()=>A.DG,CreateTiledGroundVertexData:()=>A.Es,CreateTiledPlane:()=>A.KA,CreateTiledPlaneVertexData:()=>A.mm,CreateTorus:()=>A.eu,CreateTorusKnot:()=>A.eB,CreateTorusKnotVertexData:()=>A.i9,CreateTorusVertexData:()=>A.h5,CreateTube:()=>A._u,CrossBlock:()=>E.Ksf,CubeMapToSphericalPolynomialTools:()=>q.$Ip,CubeTexture:()=>E.BtG,CubeTextureAssetTask:()=>q.A0s,CubicEase:()=>o.o0,CullMode:()=>v.Wf,CurrentScreenBlock:()=>E.K0,Curve3:()=>I.j_,CustomBlock:()=>E.wxV,CustomOptimization:()=>q.ifk,CustomParticleEmitter:()=>w.E0,CustomProceduralTexture:()=>E.XVo,CylinderBuilder:()=>A.H6,CylinderDirectedParticleEmitter:()=>w.z,CylinderParticleEmitter:()=>w.kT,DDSTools:()=>q.Ndq,DataBuffer:()=>u.hf,DataReader:()=>q.d86,DataStorage:()=>q.JLz,Database:()=>D.v,DaydreamController:()=>b.wR,DebugLayer:()=>m.bf,DebugLayerTab:()=>m.XB,DecalBuilder:()=>A.l4,Decode:()=>q.fJx,DecodeBase64ToBinary:()=>q.HQP,DecodeBase64ToString:()=>q.rPK,DecodeBase64UrlToBinary:()=>q.$K7,DecodeBase64UrlToString:()=>q.A2h,DeepCopier:()=>q.jEH,DefaultCollisionCoordinator:()=>p.u0,DefaultLoadingScreen:()=>S.NS,DefaultRenderingPipeline:()=>L.ei,Deferred:()=>q.BH3,DepthCullingState:()=>W.k,DepthOfFieldBlurPostProcess:()=>L.Tp,DepthOfFieldEffect:()=>L.Jy,DepthOfFieldEffectBlurLevel:()=>L.zm,DepthOfFieldMergePostProcess:()=>L.fH,DepthOfFieldMergePostProcessOptions:()=>L.SW,DepthPeelingRenderer:()=>G.PS,DepthPeelingSceneComponent:()=>G.xz,DepthReducer:()=>q.jPj,DepthRenderer:()=>G.gq,DepthRendererSceneComponent:()=>G.S,DepthSortedParticle:()=>w.jZ,DerivativeBlock:()=>E.mH,DesaturateBlock:()=>E.qiK,DetailMapConfiguration:()=>E.pi9,DeviceInputEventType:()=>y.gE,DeviceLostReason:()=>v.wS,DeviceOrientationCamera:()=>d.nz,DeviceSource:()=>g.pJ,DeviceSourceManager:()=>g.Uq,DeviceType:()=>g.Yi,DirectionalLight:()=>T.Ox,DirectionalLightFrustumViewer:()=>m.cQ,DiscBuilder:()=>A.tX,DiscardBlock:()=>E.els,DisplayPassPostProcess:()=>L.X_,DistanceBlock:()=>E.yay,DistanceJoint:()=>k.mN,DivideBlock:()=>E.x4y,DoNothingAction:()=>i.TC,DomManagement:()=>q.MZx,DotBlock:()=>E.ORj,DracoCompression:()=>A.Jl,DrawWrapper:()=>E.qXw,DualSenseInput:()=>g.s2,DualShockButton:()=>b.NF,DualShockDpad:()=>b.K4,DualShockInput:()=>g.V7,DualShockPad:()=>b.Xq,DynamicFloat32Array:()=>q.sKQ,DynamicTexture:()=>E.ci9,EasingFunction:()=>o.Kp,EdgesRenderer:()=>G.GW,Effect:()=>E.Qmf,EffectFallbacks:()=>E.LUf,EffectLayer:()=>x.wv,EffectLayerSceneComponent:()=>x.pt,EffectRenderer:()=>E.IWo,EffectWrapper:()=>E.H2K,ElasticEase:()=>o.$A,ElbowBlock:()=>E.Kov,EncodeArrayBufferToBase64:()=>q.GhU,EndsWith:()=>q.gix,Engine:()=>v.D4,EngineFactory:()=>v.ud,EngineInstrumentation:()=>M.Pj,EngineStore:()=>v.lL,EngineView:()=>v.Rc,EnvironmentHelper:()=>C.gZ,EnvironmentTextureTools:()=>q.qh6,Epsilon:()=>I.kn,EquiRectangularCubeTexture:()=>E._NX,EquiRectangularCubeTextureAssetTask:()=>q._Ig,ErrorCodes:()=>q.SMD,ErrorFilter:()=>v.lx,EventConstants:()=>y.GV,EventState:()=>q.he,ExecuteCodeAction:()=>i.fQ,ExponentialEase:()=>o.EI,ExternalTexture:()=>E.xnb,ExtractHighlightsPostProcess:()=>L.mn,ExtrudePolygon:()=>A.Yo,ExtrudeShape:()=>A.Gc,ExtrudeShapeCustom:()=>A.bC,FactorGradient:()=>q.b3K,FadeInOutBehavior:()=>c.Yu,FeatureName:()=>v.eS,FileTools:()=>q.e0i,FileToolsOptions:()=>q.rN$,FilesInput:()=>q.PAr,FilesInputStore:()=>q.XQz,FilterMode:()=>v.X9,FilterPostProcess:()=>L.nR,FlyCamera:()=>d.gO,FlyCameraInputsManager:()=>d.wV,FlyCameraKeyboardInput:()=>d.H6,FlyCameraMouseInput:()=>d.g7,FogBlock:()=>E.rYf,FollowBehavior:()=>c.jk,FollowCamera:()=>d.i0,FollowCameraInputsManager:()=>d.bF,FollowCameraKeyboardMoveInput:()=>d.IF,FollowCameraMouseWheelInput:()=>d.o9,FollowCameraPointersInput:()=>d.Sb,FragCoordBlock:()=>E.Mk4,FragmentOutputBlock:()=>E.gch,FramingBehavior:()=>c.dF,FreeCamera:()=>d.cE,FreeCameraDeviceOrientationInput:()=>d.V,FreeCameraGamepadInput:()=>d.cb,FreeCameraInputsManager:()=>d.a8,FreeCameraKeyboardMoveInput:()=>d.YE,FreeCameraMouseInput:()=>d.AY,FreeCameraMouseWheelInput:()=>d.AG,FreeCameraTouchInput:()=>d.y2,FreeCameraVirtualJoystickInput:()=>d.on,FresnelBlock:()=>E.fMA,FresnelParameters:()=>E.px,FromHalfFloat:()=>q.qZj,FrontFace:()=>v.zX,FrontFacingBlock:()=>E.RK4,Frustum:()=>I.iW,FxaaPostProcess:()=>L.PT,GPUParticleSystem:()=>w.hp,GUID:()=>q.xDR,Gamepad:()=>b.nJ,GamepadCamera:()=>d.iB,GamepadManager:()=>b.v$,GamepadSystemSceneComponent:()=>b.jB,GearVRController:()=>b.N0,GenerateBase64StringFromPixelData:()=>q.xjM,GenerateBase64StringFromTexture:()=>q._uz,GenerateBase64StringFromTextureAsync:()=>q.Jj7,GenericController:()=>b.MS,GenericPad:()=>b.If,GeodesicData:()=>A.zz,Geometry:()=>A.ZX,GeometryBufferRenderer:()=>G.mc,GeometryBufferRendererSceneComponent:()=>G.bm,GetClass:()=>q.qwJ,GetDOMTextContent:()=>q.vaK,GetEnvInfo:()=>q.qJ3,GetEnvironmentBRDFTexture:()=>q.$zc,GetInternalFormatFromBasisFormat:()=>q.aen,GetTGAHeader:()=>q.A6x,Gizmo:()=>R.tb,GizmoManager:()=>R.q1,GlowLayer:()=>x.cM,GoldbergMesh:()=>A.Rk,GradientBlock:()=>E.utX,GradientBlockColorStep:()=>E.Uy,GradientHelper:()=>q.fRE,GrainPostProcess:()=>L.pt,GroundBuilder:()=>A.vU,GroundMesh:()=>A.EJ,HDRCubeTexture:()=>E.ev7,HDRCubeTextureAssetTask:()=>q.dkD,HDRFiltering:()=>E.udn,HDRTools:()=>q.swi,HandConstraintBehavior:()=>c.q_,HandConstraintOrientation:()=>c.rX,HandConstraintVisibility:()=>c.bH,HandConstraintZone:()=>c.$6,HandPart:()=>Pe.OF,HardwareScalingOptimization:()=>q.frz,HemisphereBuilder:()=>A.RO,HemisphericLight:()=>T.ez,HemisphericParticleEmitter:()=>w.VD,HighlightLayer:()=>x.H1,HighlightsPostProcess:()=>L.SL,Hinge2Joint:()=>k.OT,HingeJoint:()=>k.yr,HtmlElementTexture:()=>E.sUv,IWebXRControllerPhysicsOptions:()=>be,IcoSphereBuilder:()=>A.GM,ImageAssetTask:()=>q.LD3,ImageProcessingBlock:()=>E.rE$,ImageProcessingConfiguration:()=>E.$YL,ImageProcessingConfigurationDefines:()=>E.b8n,ImageProcessingPostProcess:()=>L.z8,ImageSourceBlock:()=>E.SVb,IncrementValueAction:()=>i.sn,IndexFormat:()=>v.iD,InputBlock:()=>E.S7L,InputStepMode:()=>v.V,InspectableType:()=>q.rmO,InstancedLinesMesh:()=>A.Ee,InstancedMesh:()=>A.SP,InstancesBlock:()=>E.DAH,InstantiatedEntries:()=>s.ve,InternalTexture:()=>E.l7_,InternalTextureSource:()=>E.SZW,InterpolateValueAction:()=>i.Bv,IntersectionInfo:()=>p.cO,IsBase64DataUrl:()=>q.VLh,IsDocumentAvailable:()=>q.n5s,IsFileURL:()=>q.UhZ,IsNavigatorAvailable:()=>q.uph,IsWindowObjectExist:()=>q.CGO,JoystickAxis:()=>q.hx_,KeepAssets:()=>s.fD,KeyboardEventTypes:()=>y.OG,KeyboardInfo:()=>y.NG,KeyboardInfoPre:()=>y.WZ,KhronosTextureContainer:()=>q.kQW,KhronosTextureContainer2:()=>q.Zqr,LatheBuilder:()=>A.aO,Layer:()=>x.mh,LayerSceneComponent:()=>x.Ni,LengthBlock:()=>E.u0P,LensFlare:()=>P.EP,LensFlareSystem:()=>P.u0,LensFlareSystemSceneComponent:()=>P.WK,LensFlaresOptimization:()=>q.a8K,LensRenderingPipeline:()=>L.pX,LerpBlock:()=>E.JLG,Light:()=>T._k,LightBlock:()=>E.blg,LightGizmo:()=>R.SU,LightInformationBlock:()=>E.FTg,LineEdgesRenderer:()=>G.mo,LinesBuilder:()=>A.RN,LinesMesh:()=>A._M,LoadFile:()=>q.vPj,LoadFileError:()=>q.ehT,LoadImage:()=>q.r6b,LoadOp:()=>v.Ws,LoadTextureFromTranscodeResult:()=>q.nGc,Logger:()=>q.YdH,MapMode:()=>v.gc,Material:()=>E.F5T,MaterialAnisotropicDefines:()=>E.iMC,MaterialClearCoatDefines:()=>E.dqE,MaterialDefines:()=>E.Hgv,MaterialDetailMapDefines:()=>E.GiX,MaterialFlags:()=>E.k6g,MaterialHelper:()=>E.G$p,MaterialIridescenceDefines:()=>E.f4Y,MaterialPluginBase:()=>E.neh,MaterialPluginManager:()=>E.BKQ,MaterialSheenDefines:()=>E.AiU,MaterialSubSurfaceDefines:()=>E.HRV,Matrix:()=>I.y3,MatrixBuilderBlock:()=>E.cLi,MaxBlock:()=>E.Kum,MergeMeshesOptimization:()=>q.qAV,Mesh:()=>A.Kj,MeshAssetTask:()=>q.i5D,MeshBuilder:()=>A.VO,MeshExploder:()=>q.kMd,MeshLODLevel:()=>A.gV,MeshParticleEmitter:()=>w.F3,MeshoptCompression:()=>A.KQ,MinBlock:()=>E.dlz,MinMaxReducer:()=>q.dlF,MirrorTexture:()=>E.h1U,ModBlock:()=>E.jKW,ModelShape:()=>w.sY,MorphTarget:()=>N.Y,MorphTargetManager:()=>N.O,MorphTargetsBlock:()=>E.Utc,MotionBlurPostProcess:()=>L.bh,MotorEnabledJoint:()=>k.$Q,MultiMaterial:()=>E.G2s,MultiObserver:()=>q.JEt,MultiPointerScaleBehavior:()=>c.YB,MultiRenderTarget:()=>E.Kdn,MultiplyBlock:()=>E.U5n,NLerpBlock:()=>E.fgV,NativeDataStream:()=>v.et,NativeEngine:()=>v.I6,NativePointerInput:()=>g.FP,NativeXRFrame:()=>Rt,NativeXRLayerRenderTargetTextureProvider:()=>yt.ur,NativeXRLayerWrapper:()=>yt.z5,NativeXRRenderTarget:()=>yt.HK,NegateBlock:()=>E.Dbg,Node:()=>F.N,NodeMaterial:()=>E.Oie,NodeMaterialBlock:()=>E.knA,NodeMaterialBlockConnectionPointMode:()=>E.MXb,NodeMaterialBlockConnectionPointTypes:()=>E.Epn,NodeMaterialBlockTargets:()=>E.uWh,NodeMaterialConnectionPoint:()=>E.VTJ,NodeMaterialConnectionPointCompatibilityStates:()=>E.WSY,NodeMaterialConnectionPointCustomObject:()=>E.CBt,NodeMaterialConnectionPointDirection:()=>E.Abm,NodeMaterialDefines:()=>E.nOv,NodeMaterialModes:()=>E.a84,NodeMaterialOptimizer:()=>E.wSv,NodeMaterialSystemValues:()=>E.$lO,NoiseProceduralTexture:()=>E._8k,NormalBlendBlock:()=>E.DtL,NormalizeBlock:()=>E.AQ,NullEngine:()=>v.Sj,NullEngineOptions:()=>v.r8,Observable:()=>q.y$z,Observer:()=>q.Qjt,OcclusionMaterial:()=>E.o_u,Octree:()=>f.Vu,OctreeBlock:()=>f.b2,OctreeSceneComponent:()=>f.Zb,OculusTouchController:()=>b.bJ,OimoJSPlugin:()=>k.AE,OnAfterEnteringVRObservableEvent:()=>d.ND,OneMinusBlock:()=>E.m82,Orientation:()=>I.i5,OutlineRenderer:()=>G.Rk,PBRAnisotropicConfiguration:()=>E.uaB,PBRBaseMaterial:()=>E.my6,PBRBaseSimpleMaterial:()=>E.PvR,PBRClearCoatConfiguration:()=>E.Ye,PBRIridescenceConfiguration:()=>E.Bm_,PBRMaterial:()=>E.YVB,PBRMaterialDefines:()=>E.rpb,PBRMetallicRoughnessBlock:()=>E.MAc,PBRMetallicRoughnessMaterial:()=>E.q9t,PBRSheenConfiguration:()=>E.B4R,PBRSpecularGlossinessMaterial:()=>E.aVT,PBRSubSurfaceConfiguration:()=>E.uOX,PHI:()=>I.Q_,PadNumber:()=>q.zAd,PanoramaToCubeMapTools:()=>q.BGP,Particle:()=>w.ZX,ParticleBlendMultiplyBlock:()=>E.DGL,ParticleHelper:()=>w.n4,ParticleRampGradientBlock:()=>E.paE,ParticleSystem:()=>w.pc,ParticleSystemSet:()=>w.D_,ParticleTextureBlock:()=>E.PVD,ParticlesOptimization:()=>q.ZQh,PassCubePostProcess:()=>L.ZU,PassPostProcess:()=>L.Qm,Path2:()=>I.ZZ,Path3D:()=>I.$B,PathCursor:()=>o.dV,PerfCollectionStrategy:()=>q.ivH,PerfCounter:()=>q.zRS,PerformanceConfigurator:()=>v.Z2,PerformanceMonitor:()=>q.Ady,PerformanceViewerCollector:()=>q.PjG,PerturbNormalBlock:()=>E.hBo,PhotoDome:()=>C.lV,PhysicsEngine:()=>k.T2,PhysicsEngineSceneComponent:()=>k.UU,PhysicsHelper:()=>k.G8,PhysicsImpostor:()=>k.Q0,PhysicsJoint:()=>k.q7,PhysicsRadialExplosionEventOptions:()=>k.Vf,PhysicsRadialImpulseFalloff:()=>k.JD,PhysicsUpdraftEventOptions:()=>k.gf,PhysicsUpdraftMode:()=>k.o4,PhysicsViewer:()=>m.rO,PhysicsVortexEventOptions:()=>k.aj,PickingInfo:()=>p.pO,PivotTools:()=>q.mQQ,Plane:()=>I.JO,PlaneBuilder:()=>A.mx,PlaneDragGizmo:()=>R.xW,PlaneRotationGizmo:()=>R.Af,PlayAnimationAction:()=>i.YF,PlaySoundAction:()=>i.k2,PointColor:()=>w.Ic,PointLight:()=>T.ce,PointParticleEmitter:()=>w.cl,PointerDragBehavior:()=>c.Mr,PointerEventTypes:()=>y.kD,PointerInfo:()=>y.R5,PointerInfoBase:()=>y.CU,PointerInfoPre:()=>y.FV,PointerInput:()=>g.Fz,PointsCloudSystem:()=>w.B0,PointsGroup:()=>w.O5,Polygon:()=>A.mg,PolygonBuilder:()=>A.Pk,PolygonMeshBuilder:()=>A.zk,PolyhedronBuilder:()=>A.ox,PolyhedronData:()=>A.lD,PoseEnabledController:()=>b.Ui,PoseEnabledControllerHelper:()=>b.zn,PoseEnabledControllerType:()=>b.wc,PositionGizmo:()=>R.Xh,PositionNormalTextureVertex:()=>I.eN,PositionNormalVertex:()=>I.$S,PostProcess:()=>L.Ds,PostProcessManager:()=>L.OX,PostProcessRenderEffect:()=>L.L7,PostProcessRenderPipeline:()=>L.$g,PostProcessRenderPipelineManager:()=>L.aL,PostProcessRenderPipelineManagerSceneComponent:()=>L.LK,PostProcessesOptimization:()=>q.Cak,PosterizeBlock:()=>E.Yeu,PowBlock:()=>E.Fwk,PowerEase:()=>o.Pu,PowerPreference:()=>v.cM,PrePassRenderer:()=>G.Fo,PrePassRendererSceneComponent:()=>G.oP,PrecisionDate:()=>q.Fn0,PredefinedColorSpace:()=>v.ju,PredicateCondition:()=>i.cw,PrimitiveTopology:()=>v.YV,ProceduralTexture:()=>E.gi1,ProceduralTextureSceneComponent:()=>E.O7V,PropertyTypeForEdition:()=>E.ULE,PushMaterial:()=>E.auf,QuadraticEase:()=>o.v,QuadraticErrorSimplification:()=>A.oN,QuarticEase:()=>o.TO,Quaternion:()=>I._f,QueryType:()=>v.xL,QuinticEase:()=>o.m2,RGBDTextureTools:()=>q.rNK,RandomGUID:()=>q.fkD,RandomNumberBlock:()=>E.VZf,RawCubeTexture:()=>E.Nkl,RawTexture:()=>E.lMF,RawTexture2DArray:()=>E.eoS,RawTexture3D:()=>E.FdB,Ray:()=>f.zH,RayHelper:()=>m.lS,ReadFile:()=>q.Ipe,ReadFileError:()=>q.RCS,RecastJSCrowd:()=>O.n,RecastJSPlugin:()=>O.P,ReciprocalBlock:()=>E.xS5,ReflectBlock:()=>E.sHY,ReflectionBlock:()=>E.Jcg,ReflectionProbe:()=>B.x,ReflectionTextureBlock:()=>E.TBH,Reflector:()=>q.r0D,RefractBlock:()=>E.YFM,RefractionBlock:()=>E.bcL,RefractionPostProcess:()=>L.Zz,RefractionTexture:()=>E.zA4,RegisterClass:()=>q.H7o,RegisterMaterialPlugin:()=>E.rsS,RegisterNativeTypeAsync:()=>v.Oz,RemapBlock:()=>E.wzm,RenderPassTimestampLocation:()=>v.au,RenderTargetTexture:()=>E._iX,RenderTargetWrapper:()=>v.r0,RenderTargetsOptimization:()=>q.oeA,RenderingGroup:()=>G.SP,RenderingGroupInfo:()=>G.tY,RenderingManager:()=>G.$v,ReplaceColorBlock:()=>E.zCT,RequestFile:()=>q.FV1,RequestFileError:()=>q.kKe,RetryStrategy:()=>q.bMj,RibbonBuilder:()=>A.Ub,RollingAverage:()=>q.ZQf,Rotate2dBlock:()=>E.tcv,RotationGizmo:()=>R.xf,RuntimeAnimation:()=>o._Q,RuntimeError:()=>q.LHW,SSAO2RenderingPipeline:()=>L.LC,SSAORenderingPipeline:()=>L.V0,SamplerBindingType:()=>v.dV,Scalar:()=>I.Ru,ScaleBlock:()=>E.aoI,ScaleGizmo:()=>R.qu,Scene:()=>X.x,SceneComponentConstants:()=>H.l,SceneDepthBlock:()=>E.r0z,SceneInstrumentation:()=>M.Cy,SceneLoader:()=>S.n0,SceneLoaderAnimationGroupLoadingMode:()=>S.OP,SceneLoaderFlags:()=>S.Z0,SceneOptimization:()=>q.R58,SceneOptimizer:()=>q.GY9,SceneOptimizerOptions:()=>q.ywH,SceneRecorder:()=>q.vwM,SceneSerializer:()=>q.KqC,ScreenSizeBlock:()=>E.eGW,ScreenSpaceBlock:()=>E.EHI,ScreenSpaceCurvaturePostProcess:()=>L.lt,ScreenSpaceReflectionPostProcess:()=>L.Gl,ScreenshotTools:()=>q.n4V,SerializationHelper:()=>q.p4y,SetCorsBehavior:()=>q.$Ml,SetParentAction:()=>i.Ct,SetStateAction:()=>i.TI,SetValueAction:()=>i._2,ShaderCodeInliner:()=>v.Zq,ShaderLanguage:()=>E.xeF,ShaderMaterial:()=>E.jyz,ShaderStage:()=>v.$X,ShaderStore:()=>v.vG,ShadowDepthWrapper:()=>E.FWn,ShadowGenerator:()=>T.uX,ShadowGeneratorSceneComponent:()=>T.wE,ShadowLight:()=>T.O2,ShadowsOptimization:()=>q.soV,ShapeBuilder:()=>A.Oy,SharpenPostProcess:()=>L.VL,SheenBlock:()=>E.gms,SimplexPerlin3DBlock:()=>E.r2G,SimplicationQueueSceneComponent:()=>A.RT,SimplificationQueue:()=>A.Z3,SimplificationSettings:()=>A.R2,SimplificationType:()=>A.lA,SineEase:()=>o.bi,SixDofDragBehavior:()=>c.KV,Size:()=>I.$u,Skeleton:()=>h.Od,SkeletonViewer:()=>m.Mc,SmartArray:()=>q.trA,SmartArrayNoDuplicate:()=>q.fR9,SmoothStepBlock:()=>E.SVE,SolidParticle:()=>w.eD,SolidParticleSystem:()=>w.Jy,SolidParticleVertex:()=>w.s,Sound:()=>a.$u,SoundTrack:()=>a.tb,Space:()=>I.T,SphereBuilder:()=>A.A1,SphereDirectedParticleEmitter:()=>w.cE,SphereParticleEmitter:()=>w.Ai,SphericalHarmonics:()=>I._c,SphericalPolynomial:()=>I.iv,SpotLight:()=>T.PM,Sprite:()=>V.jy,SpriteManager:()=>V.Zm,SpriteMap:()=>V.T0,SpritePackedManager:()=>V.P9,SpriteSceneComponent:()=>V.OP,Stage:()=>H.H,StandardMaterial:()=>E.KuD,StandardMaterialDefines:()=>E.RLV,StandardRenderingPipeline:()=>L.pJ,StartsWith:()=>q.RiJ,StateCondition:()=>i.bq,StencilOperation:()=>v.xS,StencilState:()=>z.s,StencilStateComposer:()=>j.C,StepBlock:()=>E.nLX,StereoscopicArcRotateCamera:()=>d.zX,StereoscopicFreeCamera:()=>d.Kj,StereoscopicGamepadCamera:()=>d.GW,StereoscopicInterlacePostProcess:()=>L.VB,StereoscopicInterlacePostProcessI:()=>L.i1,StereoscopicScreenUniversalCamera:()=>d.NZ,StereoscopicUniversalCamera:()=>d.z0,StickValues:()=>b.zD,StopAnimationAction:()=>i.BB,StopSoundAction:()=>i.R9,StorageBuffer:()=>u.NB,StorageTextureAccess:()=>v.Gt,StoreOp:()=>v.EG,StringDictionary:()=>q.xx,StringTools:()=>q.MlK,SubEmitter:()=>w.Hb,SubEmitterType:()=>w.ll,SubMesh:()=>A.P4,SubSurfaceBlock:()=>E.lr4,SubSurfaceSceneComponent:()=>G.wm,SubtractBlock:()=>E.FFf,SurfaceMagnetismBehavior:()=>c.pT,SwitchBooleanAction:()=>i.zh,SwitchInput:()=>g.D_,TBNBlock:()=>E.vBF,TGATools:()=>q.t6u,Tags:()=>q.$Gu,TargetCamera:()=>d.CF,TargetedAnimation:()=>o.UO,TextFileAssetTask:()=>q.Dfg,Texture:()=>E.xEZ,TextureAspect:()=>v.H7,TextureAssetTask:()=>q.uCW,TextureBlock:()=>E.Mcz,TextureDimension:()=>v.kd,TextureFormat:()=>v.EV,TextureOptimization:()=>q.Zqg,TexturePacker:()=>E.PtD,TexturePackerFrame:()=>E.ppD,TextureSampleType:()=>v.oD,TextureSampler:()=>E.aJx,TextureTools:()=>q.OiL,TextureUsage:()=>v.v2,TextureViewDimension:()=>v.p_,ThinEngine:()=>v.B6,ThinMaterialHelper:()=>E.O64,ThinRenderTargetTexture:()=>E.R8x,ThinTexture:()=>E.guC,TiledBoxBuilder:()=>A.Sc,TiledPlaneBuilder:()=>A.P8,TimerState:()=>q.vsp,TmpColors:()=>I.zZ,TmpVectors:()=>I.jp,ToGammaSpace:()=>I.zp,ToHalfFloat:()=>q.ayy,ToLinearSpace:()=>I.Nn,TonemapPostProcess:()=>L.uB,TonemappingOperator:()=>L.lA,Tools:()=>q.w1W,TorusBuilder:()=>A.t3,TorusKnotBuilder:()=>A.SN,TouchCamera:()=>d.HC,TrailMesh:()=>A.ZO,Trajectory:()=>q.D_e,TrajectoryClassifier:()=>q.HuU,TranscodeAsync:()=>q.rz6,TransformBlock:()=>E.mM6,TransformNode:()=>A.YO,TrigonometryBlock:()=>E.SYc,TrigonometryBlockOperations:()=>E.pF7,TubeBuilder:()=>A.Fc,TwirlBlock:()=>E.tO3,UniformBuffer:()=>E.Ms4,UniversalCamera:()=>d.xc,UnregisterAllMaterialPlugins:()=>E.Dhx,UnregisterMaterialPlugin:()=>E.jDn,UploadContent:()=>q.Ab0,UploadEnvLevelsAsync:()=>q.RoR,UploadEnvSpherical:()=>q.qCE,UploadLevelsAsync:()=>q.qZN,UtilityLayerRenderer:()=>G.xX,VRCameraMetrics:()=>d.XL,VRDeviceOrientationArcRotateCamera:()=>d.MB,VRDeviceOrientationFreeCamera:()=>d.iq,VRDeviceOrientationGamepadCamera:()=>d.$0,VRDistortionCorrectionPostProcess:()=>L.TM,VRExperienceHelper:()=>d.FG,VRMultiviewToSingleviewPostProcess:()=>L.Ec,ValidatedNativeDataStream:()=>v.ld,ValueCondition:()=>i.Uf,Vector2:()=>I.FM,Vector3:()=>I.P,Vector4:()=>I.Lt,VectorMergerBlock:()=>E.tvr,VectorSplitterBlock:()=>E.RxX,VertexAnimationBaker:()=>l.N,VertexBuffer:()=>u.oZ,VertexData:()=>A.xx,VertexFormat:()=>v.gB,VertexOutputBlock:()=>E.tGn,VideoDome:()=>C.E7,VideoRecorder:()=>q.SBV,VideoTexture:()=>E.fO1,ViewDirectionBlock:()=>E.dCj,Viewport:()=>I.l_,VirtualJoystick:()=>q.Ngj,VirtualJoysticksCamera:()=>d.dL,ViveController:()=>b.lG,VolumetricLightScatteringPostProcess:()=>L.GM,VoronoiNoiseBlock:()=>E.rv,WaveBlock:()=>E.Iky,WaveBlockKind:()=>E.g5,WebGL2ParticleSystem:()=>w.dY,WebGL2ShaderProcessor:()=>v.CE,WebGLDataBuffer:()=>A.MF,WebGLHardwareTexture:()=>v.Bm,WebGLPipelineContext:()=>v.yM,WebGPUCacheBindGroups:()=>v.C4,WebGPUCacheRenderPipeline:()=>v.OD,WebGPUCacheRenderPipelineTree:()=>v.Hv,WebGPUCacheSampler:()=>v.W5,WebGPUDataBuffer:()=>A.CF,WebGPUDrawContext:()=>v.gk,WebGPUEngine:()=>v.fW,WebGPUTintWASM:()=>v.Sk,WebRequest:()=>q.gZ4,WebVRController:()=>b.T8,WebVRFreeCamera:()=>d.$f,WebXRAbstractFeature:()=>ie.F,WebXRAbstractMotionController:()=>ot.d,WebXRAnchorSystem:()=>ue,WebXRBackgroundRemover:()=>_e,WebXRCamera:()=>Q.o,WebXRCompositionLayerWrapper:()=>Ze,WebXRControllerComponent:()=>Oe.n,WebXRControllerMovement:()=>Fe,WebXRControllerPhysics:()=>Re,WebXRControllerPointerSelection:()=>me.S,WebXRDefaultExperience:()=>re.B,WebXRDefaultExperienceOptions:()=>re.z,WebXRDomOverlay:()=>Ne,WebXREnterExitUI:()=>Y.Af,WebXREnterExitUIButton:()=>Y.Jg,WebXREnterExitUIOptions:()=>Y.zI,WebXRExperienceHelper:()=>$.M,WebXREyeTracking:()=>Ue,WebXRFeatureName:()=>ne.b,WebXRFeaturePointSystem:()=>Me,WebXRFeaturesManager:()=>ne.d,WebXRGenericHandController:()=>at,WebXRGenericTriggerMotionController:()=>ct.z,WebXRHTCViveMotionController:()=>mt,WebXRHand:()=>Pe.e0,WebXRHandTracking:()=>Pe.en,WebXRHitTest:()=>Ce,WebXRHitTestLegacy:()=>ce,WebXRImageTracking:()=>Ie,WebXRInput:()=>K.t,WebXRInputSource:()=>Z.e,WebXRLayers:()=>it,WebXRLightEstimation:()=>He,WebXRManagedOutputCanvas:()=>J.n,WebXRManagedOutputCanvasOptions:()=>J._,WebXRMeshDetector:()=>Ee,WebXRMicrosoftMixedRealityController:()=>dt,WebXRMotionControllerManager:()=>st.V,WebXRMotionControllerTeleportation:()=>fe.z,WebXRNearControllerMode:()=>Ae.m,WebXRNearInteraction:()=>Ae.X,WebXROculusTouchMotionController:()=>_t,WebXRPlaneDetector:()=>pe,WebXRProfiledMotionController:()=>vt.t,WebXRProjectionLayerWrapper:()=>et,WebXRSessionManager:()=>te.g,WebXRState:()=>ee.k,WebXRTrackingState:()=>ee.j,WebXRWalkingLocomotion:()=>Qe,WeightedSound:()=>a.s3,WindowsMotionController:()=>b.Bp,WorkerPool:()=>q.hFj,WorleyNoise3DBlock:()=>E.Euh,XRHandJoint:()=>Pe.xE,XRWindowsMotionController:()=>b.jh,Xbox360Button:()=>b.nR,Xbox360Dpad:()=>b._Q,Xbox360Pad:()=>b.FI,XboxInput:()=>g.$i,_BabylonLoaderRegistered:()=>S.UA,_BasisTextureLoader:()=>E.tlW,_CreationDataStorage:()=>A.gW,_DDSTextureLoader:()=>E.sdx,_ENVTextureLoader:()=>E.vzg,_HDRTextureLoader:()=>E.h4G,_IAnimationState:()=>o.uw,_InstancesBatch:()=>A.Wv,_KTXTextureLoader:()=>E.ccn,_MeshCollisionData:()=>p.am,_OcclusionDataStorage:()=>v.if,_PrimaryIsoTriangle:()=>A.Bn,_TGATextureLoader:()=>E._DL,_TimeToken:()=>M.Wh,_UpdateRGBDAsync:()=>q.Lfi,_forceSceneHelpersToBundle:()=>C.ye,_forceTransformFeedbackToBundle:()=>v.QT,_injectLTSFileTools:()=>q.W5h,allocateAndCopyTypedBuffer:()=>v.A8,className:()=>q.okp,createDetailMapPlugin:()=>E.W5O,createPBRAnisotropicPlugin:()=>E.agc,createPBRBRDFPlugin:()=>E.UgH,createPBRClearCoatPlugin:()=>E.p3y,createPBRIridescencePlugin:()=>E.vMn,createPBRSheenPlugin:()=>E.YWN,createPBRSubSurfacePlugin:()=>E.njn,createYieldingScheduler:()=>q.KO$,editableInPropertyPage:()=>E.pv5,expandToProperty:()=>q.wzF,extractMinAndMax:()=>I.kD,extractMinAndMaxIndexed:()=>I.y4,inlineScheduler:()=>q.WPm,makeAsyncFunction:()=>q.U3Q,makeSyncFunction:()=>q.vpB,nativeOverride:()=>q.G6f,normalizeEnvInfo:()=>q.QH4,runCoroutine:()=>q.d_s,runCoroutineAsync:()=>q.sMO,runCoroutineSync:()=>q.s3v,serialize:()=>q.qCG,serializeAsCameraReference:()=>q.VEq,serializeAsColor3:()=>q.n9i,serializeAsColor4:()=>q.XX9,serializeAsColorCurves:()=>q.N$P,serializeAsFresnelParameters:()=>q.qQZ,serializeAsImageProcessingConfiguration:()=>q.rXf,serializeAsMatrix:()=>q.oQ9,serializeAsMeshReference:()=>q.RRj,serializeAsQuaternion:()=>q.mvQ,serializeAsTexture:()=>q.oU6,serializeAsVector2:()=>q.QCU,serializeAsVector3:()=>q.n9s,setAndStartTimer:()=>q.g_C,setStereoscopicAnaglyphRigMode:()=>d.i5,setStereoscopicRigMode:()=>d.kz,setVRRigMode:()=>d.SB,setWebVRRigMode:()=>d.jE});var n=r(57755),i=r(58873),o=r(96088),s=r(7701),a=r(35716),l=r(82576),c=r(61603),h=r(95358),u=r(71927),d=r(94474),p=r(71218),_=r(93553),f=r(25235),m=r(43622),g=r(5185),v=r(94360),y=r(32050),b=r(26449),R=r(42121),C=r(58774),M=r(70127),x=r(84550),P=r(98878),T=r(49721),S=r(32664),E=r(86075),I=r(34479),A=r(73043),N=r(82799),O=r(5257),F=r(17834),D=r(8820),w=r(80759),k=r(96627),L=r(52432),B=r(6044),G=r(8044),X=r(65273),H=r(85627),V=r(29318),U=r(88405),W=r(29507),z=r(40185),j=r(61625),q=r(79287),Q=r(52281),Y=r(62510),$=r(90570),K=r(428),Z=r(5412),J=r(3195),ee=r(9022),te=r(97654),re=r(33102),ne=r(2914),ie=r(41388),oe=r(31191),se=r(62897),ae=r(58095),le=r(13514),ce=function(e){function t(r,n){void 0===n&&(n={});var i=e.call(this,r)||this;return i.options=n,i._direction=new ae.P(0,0,-1),i._mat=new ae.y3,i._onSelectEnabled=!1,i._origin=new ae.P(0,0,0),i.lastNativeXRHitResults=[],i.onHitTestResultObservable=new se.y$,i._onHitTestResults=function(e){var t=e.map((function(e){var t=ae.y3.FromArray(e.hitMatrix);return i._xrSessionManager.scene.useRightHandedSystem||t.toggleModelMatrixHandInPlace(),i.options.worldParentNode&&t.multiplyToRef(i.options.worldParentNode.getWorldMatrix(),t),{xrHitResult:e,transformationMatrix:t}}));i.lastNativeXRHitResults=e,i.onHitTestResultObservable.notifyObservers(t)},i._onSelect=function(e){i._onSelectEnabled&&t.XRHitTestWithSelectEvent(e,i._xrSessionManager.referenceSpace)},i.xrNativeFeatureName="hit-test",le.w1.Warn("A newer version of this plugin is available"),i}return(0,oe.ZT)(t,e),t.XRHitTestWithRay=function(e,t,r,n){return e.requestHitTest(t,r).then((function(e){var t=n||function(e){return!!e.hitMatrix};return e.filter(t)}))},t.XRHitTestWithSelectEvent=function(e,t){var r=e.frame.getPose(e.inputSource.targetRaySpace,t);if(!r)return Promise.resolve([]);var n=new XRRay(r.transform);return this.XRHitTestWithRay(e.frame.session,n,t)},t.prototype.attach=function(){return!!e.prototype.attach.call(this)&&(this.options.testOnPointerDownOnly&&this._xrSessionManager.session.addEventListener("select",this._onSelect,!1),!0)},t.prototype.detach=function(){return!!e.prototype.detach.call(this)&&(this._onSelectEnabled=!1,this._xrSessionManager.session.removeEventListener("select",this._onSelect),!0)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onHitTestResultObservable.clear()},t.prototype._onXRFrame=function(e){if(this.attached&&!this.options.testOnPointerDownOnly){var r=e.getViewerPose(this._xrSessionManager.referenceSpace);if(r){ae.y3.FromArrayToRef(r.transform.matrix,0,this._mat),ae.P.TransformCoordinatesFromFloatsToRef(0,0,0,this._mat,this._origin),ae.P.TransformCoordinatesFromFloatsToRef(0,0,-1,this._mat,this._direction),this._direction.subtractInPlace(this._origin),this._direction.normalize();var n=new XRRay({x:this._origin.x,y:this._origin.y,z:this._origin.z,w:0},{x:this._direction.x,y:this._direction.y,z:this._direction.z,w:0});t.XRHitTestWithRay(this._xrSessionManager.session,n,this._xrSessionManager.referenceSpace).then(this._onHitTestResults)}}},t.Name=ne.b.HIT_TEST,t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(ce.Name,(function(e,t){return function(){return new ce(e,t)}}),ce.Version,!1);var he=0,ue=function(e){function t(t,r){void 0===r&&(r={});var n=e.call(this,t)||this;return n._options=r,n._lastFrameDetected=new Set,n._trackedAnchors=[],n._futureAnchors=[],n.onAnchorAddedObservable=new se.y$,n.onAnchorRemovedObservable=new se.y$,n.onAnchorUpdatedObservable=new se.y$,n._tmpVector=new ae.P,n._tmpQuaternion=new ae._f,n.xrNativeFeatureName="anchors",n}return(0,oe.ZT)(t,e),Object.defineProperty(t.prototype,"referenceSpaceForFrameAnchors",{set:function(e){this._referenceSpaceForFrameAnchors=e},enumerable:!1,configurable:!0}),t.prototype._populateTmpTransformation=function(e,t){return this._tmpVector.copyFrom(e),this._tmpQuaternion.copyFrom(t),this._xrSessionManager.scene.useRightHandedSystem||(this._tmpVector.z*=-1,this._tmpQuaternion.z*=-1,this._tmpQuaternion.w*=-1),{position:this._tmpVector,rotationQuaternion:this._tmpQuaternion}},t.prototype.addAnchorPointUsingHitTestResultAsync=function(e,t,r){return void 0===t&&(t=new ae.P),void 0===r&&(r=new ae._f),(0,oe.mG)(this,void 0,void 0,(function(){var n,i,o,s=this;return(0,oe.Jh)(this,(function(a){switch(a.label){case 0:if(this._populateTmpTransformation(t,r),n=new XRRigidTransform({x:this._tmpVector.x,y:this._tmpVector.y,z:this._tmpVector.z},{x:this._tmpQuaternion.x,y:this._tmpQuaternion.y,z:this._tmpQuaternion.z,w:this._tmpQuaternion.w}),e.xrHitResult.createAnchor)return[3,1];throw this.detach(),new Error("Anchors not enabled in this environment/browser");case 1:return a.trys.push([1,3,,4]),[4,e.xrHitResult.createAnchor(n)];case 2:return i=a.sent(),[2,new Promise((function(e,t){s._futureAnchors.push({nativeAnchor:i,resolved:!1,submitted:!0,xrTransformation:n,resolve:e,reject:t})}))];case 3:throw o=a.sent(),new Error(o);case 4:return[2]}}))}))},t.prototype.addAnchorAtPositionAndRotationAsync=function(e,t,r){return void 0===t&&(t=new ae._f),void 0===r&&(r=!1),(0,oe.mG)(this,void 0,void 0,(function(){var n,i,o,s=this;return(0,oe.Jh)(this,(function(a){switch(a.label){case 0:return this._populateTmpTransformation(e,t),n=new XRRigidTransform({x:this._tmpVector.x,y:this._tmpVector.y,z:this._tmpVector.z},{x:this._tmpQuaternion.x,y:this._tmpQuaternion.y,z:this._tmpQuaternion.z,w:this._tmpQuaternion.w}),r&&this.attached&&this._xrSessionManager.currentFrame?[4,this._createAnchorAtTransformation(n,this._xrSessionManager.currentFrame)]:[3,2];case 1:return o=a.sent(),[3,3];case 2:o=void 0,a.label=3;case 3:return i=o,[2,new Promise((function(e,t){s._futureAnchors.push({nativeAnchor:i,resolved:!1,submitted:!1,xrTransformation:n,resolve:e,reject:t})}))]}}))}))},Object.defineProperty(t.prototype,"anchors",{get:function(){return this._trackedAnchors},enumerable:!1,configurable:!0}),t.prototype.detach=function(){if(!e.prototype.detach.call(this))return!1;if(!this._options.doNotRemoveAnchorsOnSessionEnded)for(;this._trackedAnchors.length;){var t=this._trackedAnchors.pop();if(t){try{t.remove()}catch(e){}this.onAnchorRemovedObservable.notifyObservers(t)}}return!0},t.prototype.dispose=function(){this._futureAnchors.length=0,e.prototype.dispose.call(this),this.onAnchorAddedObservable.clear(),this.onAnchorRemovedObservable.clear(),this.onAnchorUpdatedObservable.clear()},t.prototype._onXRFrame=function(e){var t=this;if(this.attached&&e){var r=e.trackedAnchors;if(r){var n=this._trackedAnchors.filter((function(e){return!r.has(e.xrAnchor)})).map((function(e){return t._trackedAnchors.indexOf(e)})),i=0;n.forEach((function(e){var r=t._trackedAnchors.splice(e-i,1)[0];t.onAnchorRemovedObservable.notifyObservers(r),i++})),r.forEach((function(r){if(t._lastFrameDetected.has(r)){var n=t._findIndexInAnchorArray(r);o=t._trackedAnchors[n];try{t._updateAnchorWithXRFrame(r,o,e),o.attachedNode&&(o.attachedNode.rotationQuaternion=o.attachedNode.rotationQuaternion||new ae._f,o.transformationMatrix.decompose(o.attachedNode.scaling,o.attachedNode.rotationQuaternion,o.attachedNode.position)),t.onAnchorUpdatedObservable.notifyObservers(o)}catch(e){le.w1.Warn("Anchor could not be updated")}}else{var i={id:he++,xrAnchor:r,remove:function(){return r.delete()}},o=t._updateAnchorWithXRFrame(r,i,e);t._trackedAnchors.push(o),t.onAnchorAddedObservable.notifyObservers(o);var s=t._futureAnchors.filter((function(e){return e.nativeAnchor===r}))[0];s&&(s.resolve(o),s.resolved=!0)}})),this._lastFrameDetected=r}this._futureAnchors.forEach((function(r){r.resolved||r.submitted||(t._createAnchorAtTransformation(r.xrTransformation,e).then((function(e){r.nativeAnchor=e}),(function(e){r.resolved=!0,r.reject(e)})),r.submitted=!0)}))}},t.prototype._findIndexInAnchorArray=function(e){for(var t=0;t<this._trackedAnchors.length;++t)if(this._trackedAnchors[t].xrAnchor===e)return t;return-1},t.prototype._updateAnchorWithXRFrame=function(e,t,r){var n=r.getPose(e.anchorSpace,this._xrSessionManager.referenceSpace);if(n){var i=t.transformationMatrix||new ae.y3;ae.y3.FromArrayToRef(n.transform.matrix,0,i),this._xrSessionManager.scene.useRightHandedSystem||i.toggleModelMatrixHandInPlace(),t.transformationMatrix=i,this._options.worldParentNode&&i.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),i)}return t},t.prototype._createAnchorAtTransformation=function(e,t){var r;return(0,oe.mG)(this,void 0,void 0,(function(){return(0,oe.Jh)(this,(function(n){if(!t.createAnchor)throw this.detach(),new Error("Anchors are not enabled in your browser");try{return[2,t.createAnchor(e,null!==(r=this._referenceSpaceForFrameAnchors)&&void 0!==r?r:this._xrSessionManager.referenceSpace)]}catch(e){throw new Error(e)}return[2]}))}))},t.Name=ne.b.ANCHOR_SYSTEM,t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(ue.Name,(function(e,t){return function(){return new ue(e,t)}}),ue.Version);var de=0,pe=function(e){function t(t,r){void 0===r&&(r={});var n=e.call(this,t)||this;return n._options=r,n._detectedPlanes=[],n._enabled=!1,n._lastFrameDetected=new Set,n.onPlaneAddedObservable=new se.y$,n.onPlaneRemovedObservable=new se.y$,n.onPlaneUpdatedObservable=new se.y$,n.xrNativeFeatureName="plane-detection",n._xrSessionManager.session?n._init():n._xrSessionManager.onXRSessionInit.addOnce((function(){n._init()})),n}return(0,oe.ZT)(t,e),t.prototype.detach=function(){if(!e.prototype.detach.call(this))return!1;if(!this._options.doNotRemovePlanesOnSessionEnded)for(;this._detectedPlanes.length;){var t=this._detectedPlanes.pop();t&&this.onPlaneRemovedObservable.notifyObservers(t)}return!0},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onPlaneAddedObservable.clear(),this.onPlaneRemovedObservable.clear(),this.onPlaneUpdatedObservable.clear()},t.prototype.isCompatible=function(){return"undefined"!=typeof XRPlane},t.prototype._onXRFrame=function(e){var t,r=this;if(this.attached&&this._enabled&&e){var n=e.detectedPlanes||(null===(t=e.worldInformation)||void 0===t?void 0:t.detectedPlanes);if(n){for(var i=0;i<this._detectedPlanes.length;i++){var o=this._detectedPlanes[i];n.has(o.xrPlane)||(this._detectedPlanes.splice(i--,1),this.onPlaneRemovedObservable.notifyObservers(o))}n.forEach((function(t){if(r._lastFrameDetected.has(t)){if(t.lastChangedTime===r._xrSessionManager.currentTimestamp){var n=r._findIndexInPlaneArray(t);o=r._detectedPlanes[n];r._updatePlaneWithXRPlane(t,o,e),r.onPlaneUpdatedObservable.notifyObservers(o)}}else{var i={id:de++,xrPlane:t,polygonDefinition:[]},o=r._updatePlaneWithXRPlane(t,i,e);r._detectedPlanes.push(o),r.onPlaneAddedObservable.notifyObservers(o)}})),this._lastFrameDetected=n}}},t.prototype._init=function(){var e=this,t=function(){e._enabled=!0,e._detectedPlanes.length&&(e._detectedPlanes.length=0)};this._xrSessionManager.isNative&&this._options.preferredDetectorOptions&&this._xrSessionManager.session.trySetPreferredPlaneDetectorOptions&&this._xrSessionManager.session.trySetPreferredPlaneDetectorOptions(this._options.preferredDetectorOptions),this._xrSessionManager.session.updateWorldTrackingState?(this._xrSessionManager.session.updateWorldTrackingState({planeDetectionState:{enabled:!0}}),t()):t()},t.prototype._updatePlaneWithXRPlane=function(e,t,r){var n=this;t.polygonDefinition=e.polygon.map((function(e){var t=n._xrSessionManager.scene.useRightHandedSystem?1:-1;return new ae.P(e.x,e.y,e.z*t)}));var i=r.getPose(e.planeSpace,this._xrSessionManager.referenceSpace);if(i){var o=t.transformationMatrix||new ae.y3;ae.y3.FromArrayToRef(i.transform.matrix,0,o),this._xrSessionManager.scene.useRightHandedSystem||o.toggleModelMatrixHandInPlace(),t.transformationMatrix=o,this._options.worldParentNode&&o.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),o)}return t},t.prototype._findIndexInPlaneArray=function(e){for(var t=0;t<this._detectedPlanes.length;++t)if(this._detectedPlanes[t].xrPlane===e)return t;return-1},t.Name=ne.b.PLANE_DETECTION,t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(pe.Name,(function(e,t){return function(){return new pe(e,t)}}),pe.Version);var _e=function(e){function t(t,r){void 0===r&&(r={});var n=e.call(this,t)||this;return n.options=r,n.onBackgroundStateChangedObservable=new se.y$,n}return(0,oe.ZT)(t,e),t.prototype.attach=function(){return this._setBackgroundState(!1),e.prototype.attach.call(this)},t.prototype.detach=function(){return this._setBackgroundState(!0),e.prototype.detach.call(this)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onBackgroundStateChangedObservable.clear()},t.prototype._onXRFrame=function(e){},t.prototype._setBackgroundState=function(e){var t=this._xrSessionManager.scene;if(!this.options.ignoreEnvironmentHelper)if(this.options.environmentHelperRemovalFlags){if(this.options.environmentHelperRemovalFlags.skyBox){var r=t.getMeshByName("BackgroundSkybox");r&&r.setEnabled(e)}if(this.options.environmentHelperRemovalFlags.ground){var n=t.getMeshByName("BackgroundPlane");n&&n.setEnabled(e)}}else{var i=t.getMeshByName("BackgroundHelper");i&&i.setEnabled(e)}this.options.backgroundMeshes&&this.options.backgroundMeshes.forEach((function(t){return t.setEnabled(e)})),this.onBackgroundStateChangedObservable.notifyObservers(e)},t.Name=ne.b.BACKGROUND_REMOVER,t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(_e.Name,(function(e,t){return function(){return new _e(e,t)}}),_e.Version,!0);var fe=r(54774),me=r(59237),ge=r(18737),ve=r(48087),ye=r(84318),be=function(){},Re=function(e){function t(t,r){var n=e.call(this,t)||this;return n._options=r,n._attachController=function(e){n._controllers[e.uniqueId]||(n._xrSessionManager.scene.isPhysicsEnabled()||ye.Y.Warn("physics engine not enabled, skipped. Please add this controller manually."),n._options.physicsProperties.useControllerMesh&&e.inputSource.gamepad?e.onMotionControllerInitObservable.addOnce((function(t){t._doNotLoadControllerMesh?n._createPhysicsImpostor(e):t.onModelLoadedObservable.addOnce((function(){var r=new ge.Q(t.rootMesh,ge.Q.MeshImpostor,(0,oe.pi)({mass:0},n._options.physicsProperties)),i=e.grip||e.pointer;n._controllers[e.uniqueId]={xrController:e,impostor:r,oldPos:i.position.clone(),oldRotation:i.rotationQuaternion.clone()}}))})):n._createPhysicsImpostor(e))},n._controllers={},n._debugMode=!1,n._delta=0,n._lastTimestamp=0,n._tmpQuaternion=new ae._f,n._tmpVector=new ae.P,n._options.physicsProperties||(n._options.physicsProperties={}),n}return(0,oe.ZT)(t,e),t.prototype._createPhysicsImpostor=function(e){var t=this._options.physicsProperties.impostorType||ge.Q.SphereImpostor,r=this._options.physicsProperties.impostorSize||.1,n=(0,ve.Qk)("impostor-mesh-"+e.uniqueId,{diameterX:"number"==typeof r?r:r.width,diameterY:"number"==typeof r?r:r.height,diameterZ:"number"==typeof r?r:r.depth});n.isVisible=this._debugMode,n.isPickable=!1,n.rotationQuaternion=new ae._f;var i=e.grip||e.pointer;n.position.copyFrom(i.position),n.rotationQuaternion.copyFrom(i.rotationQuaternion);var o=new ge.Q(n,t,(0,oe.pi)({mass:0},this._options.physicsProperties));this._controllers[e.uniqueId]={xrController:e,impostor:o,impostorMesh:n}},t.prototype._enablePhysicsDebug=function(){var e=this;this._debugMode=!0,Object.keys(this._controllers).forEach((function(t){var r=e._controllers[t];r.impostorMesh&&(r.impostorMesh.isVisible=!0)}))},t.prototype.addController=function(e){this._attachController(e)},t.prototype.attach=function(){var t=this;if(!e.prototype.attach.call(this))return!1;if(!this._options.xrInput)return!0;if(this._options.xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._options.xrInput.onControllerRemovedObservable,(function(e){t._detachController(e.uniqueId)})),this._options.enableHeadsetImpostor){var r=this._options.headsetImpostorParams||{impostorType:ge.Q.SphereImpostor,restitution:.8,impostorSize:.3},n=r.impostorSize||.3;this._headsetMesh=(0,ve.Qk)("headset-mesh",{diameterX:"number"==typeof n?n:n.width,diameterY:"number"==typeof n?n:n.height,diameterZ:"number"==typeof n?n:n.depth}),this._headsetMesh.rotationQuaternion=new ae._f,this._headsetMesh.isVisible=!1,this._headsetImpostor=new ge.Q(this._headsetMesh,r.impostorType,(0,oe.pi)({mass:0},r))}return!0},t.prototype.detach=function(){var t=this;return!!e.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach((function(e){t._detachController(e)})),this._headsetMesh&&this._headsetMesh.dispose(),!0)},t.prototype.getHeadsetImpostor=function(){return this._headsetImpostor},t.prototype.getImpostorForController=function(e){var t="string"==typeof e?e:e.uniqueId;return this._controllers[t]?this._controllers[t].impostor:null},t.prototype.setPhysicsProperties=function(e){this._options.physicsProperties=(0,oe.pi)((0,oe.pi)({},this._options.physicsProperties),e)},t.prototype._onXRFrame=function(e){var t,r,n=this;if(this._delta=this._xrSessionManager.currentTimestamp-this._lastTimestamp,this._lastTimestamp=this._xrSessionManager.currentTimestamp,this._headsetMesh&&this._headsetImpostor){if(this._headsetMesh.position.copyFrom(this._options.xrInput.xrCamera.globalPosition),this._headsetMesh.rotationQuaternion.copyFrom(this._options.xrInput.xrCamera.absoluteRotation),null===(t=this._options.xrInput.xrCamera._lastXRViewerPose)||void 0===t?void 0:t.linearVelocity){var i=this._options.xrInput.xrCamera._lastXRViewerPose.linearVelocity;this._tmpVector.set(i.x,i.y,i.z),this._headsetImpostor.setLinearVelocity(this._tmpVector)}if(null===(r=this._options.xrInput.xrCamera._lastXRViewerPose)||void 0===r?void 0:r.angularVelocity){var o=this._options.xrInput.xrCamera._lastXRViewerPose.angularVelocity;this._tmpVector.set(o.x,o.y,o.z),this._headsetImpostor.setAngularVelocity(this._tmpVector)}}Object.keys(this._controllers).forEach((function(e){var t,r,i=n._controllers[e],o=i.xrController.grip||i.xrController.pointer,s=i.oldPos||i.impostorMesh.position;if(null===(t=i.xrController._lastXRPose)||void 0===t?void 0:t.linearVelocity){var a=i.xrController._lastXRPose.linearVelocity;n._tmpVector.set(a.x,a.y,a.z),i.impostor.setLinearVelocity(n._tmpVector)}else o.position.subtractToRef(s,n._tmpVector),n._tmpVector.scaleInPlace(1e3/n._delta),i.impostor.setLinearVelocity(n._tmpVector);s.copyFrom(o.position),n._debugMode;var l=i.oldRotation||i.impostorMesh.rotationQuaternion;if(null===(r=i.xrController._lastXRPose)||void 0===r?void 0:r.angularVelocity){var c=i.xrController._lastXRPose.angularVelocity;n._tmpVector.set(c.x,c.y,c.z),i.impostor.setAngularVelocity(n._tmpVector)}else if(!l.equalsWithEpsilon(o.rotationQuaternion)){l.conjugateInPlace().multiplyToRef(o.rotationQuaternion,n._tmpQuaternion);var h=Math.sqrt(n._tmpQuaternion.x*n._tmpQuaternion.x+n._tmpQuaternion.y*n._tmpQuaternion.y+n._tmpQuaternion.z*n._tmpQuaternion.z);if(n._tmpVector.set(n._tmpQuaternion.x,n._tmpQuaternion.y,n._tmpQuaternion.z),h<.001)n._tmpVector.scaleInPlace(2);else{var u=2*Math.atan2(h,n._tmpQuaternion.w);n._tmpVector.scaleInPlace(u/(h*(n._delta/1e3)))}i.impostor.setAngularVelocity(n._tmpVector)}l.copyFrom(o.rotationQuaternion),n._debugMode}))},t.prototype._detachController=function(e){var t=this._controllers[e];t&&(t.impostorMesh&&t.impostorMesh.dispose(),delete this._controllers[e])},t.Name=ne.b.PHYSICS_CONTROLLERS,t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(Re.Name,(function(e,t){return function(){return new Re(e,t)}}),Re.Version,!0);var Ce=function(e){function t(t,r){void 0===r&&(r={});var n=e.call(this,t)||this;return n.options=r,n._tmpMat=new ae.y3,n._tmpPos=new ae.P,n._tmpQuat=new ae._f,n._initHitTestSource=function(e){if(e){var t=new XRRay(n.options.offsetRay||{}),r={space:n.options.useReferenceSpace?e:n._xrSessionManager.viewerReferenceSpace,offsetRay:t};n.options.entityTypes&&(r.entityTypes=n.options.entityTypes),r.space?n._xrSessionManager.session.requestHitTestSource(r).then((function(e){n._xrHitTestSource&&n._xrHitTestSource.cancel(),n._xrHitTestSource=e})):le.w1.Warn("waiting for viewer reference space to initialize")}},n.autoCloneTransformation=!1,n.onHitTestResultObservable=new se.y$,n.paused=!1,n.xrNativeFeatureName="hit-test",le.w1.Warn("Hit test is an experimental and unstable feature."),n}return(0,oe.ZT)(t,e),t.prototype.attach=function(){var t=this;if(!e.prototype.attach.call(this))return!1;if(!this._xrSessionManager.session.requestHitTestSource)return!1;if(this.options.disablePermanentHitTest||(this._xrSessionManager.referenceSpace&&this._initHitTestSource(this._xrSessionManager.referenceSpace),this._xrSessionManager.onXRReferenceSpaceChanged.add(this._initHitTestSource)),this.options.enableTransientHitTest){var r=new XRRay(this.options.transientOffsetRay||{});this._xrSessionManager.session.requestHitTestSourceForTransientInput({profile:this.options.transientHitTestProfile||"generic-touchscreen",offsetRay:r,entityTypes:this.options.entityTypes}).then((function(e){t._transientXrHitTestSource=e}))}return!0},t.prototype.detach=function(){return!!e.prototype.detach.call(this)&&(this._xrHitTestSource&&(this._xrHitTestSource.cancel(),this._xrHitTestSource=null),this._xrSessionManager.onXRReferenceSpaceChanged.removeCallback(this._initHitTestSource),this._transientXrHitTestSource&&(this._transientXrHitTestSource.cancel(),this._transientXrHitTestSource=null),!0)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onHitTestResultObservable.clear()},t.prototype._onXRFrame=function(e){var t=this;if(this.attached&&!this.paused){if(this._xrHitTestSource){var r=e.getHitTestResults(this._xrHitTestSource);this._processWebXRHitTestResult(r)}if(this._transientXrHitTestSource)e.getHitTestResultsForTransientInput(this._transientXrHitTestSource).forEach((function(e){t._processWebXRHitTestResult(e.results,e.inputSource)}))}},t.prototype._processWebXRHitTestResult=function(e,t){var r=this,n=[];e.forEach((function(e){var i=e.getPose(r._xrSessionManager.referenceSpace);if(i){var o=i.transform.position,s=i.transform.orientation;r._tmpPos.set(o.x,o.y,o.z),r._tmpQuat.set(s.x,s.y,s.z,s.w),ae.y3.FromFloat32ArrayToRefScaled(i.transform.matrix,0,1,r._tmpMat),r._xrSessionManager.scene.useRightHandedSystem||(r._tmpPos.z*=-1,r._tmpQuat.z*=-1,r._tmpQuat.w*=-1,r._tmpMat.toggleModelMatrixHandInPlace());var a={position:r.autoCloneTransformation?r._tmpPos.clone():r._tmpPos,rotationQuaternion:r.autoCloneTransformation?r._tmpQuat.clone():r._tmpQuat,transformationMatrix:r.autoCloneTransformation?r._tmpMat.clone():r._tmpMat,inputSource:t,isTransient:!!t,xrHitResult:e};n.push(a)}})),this.onHitTestResultObservable.notifyObservers(n)},t.Name=ne.b.HIT_TEST,t.Version=2,t}(ie.F);ne.d.AddWebXRFeature(Ce.Name,(function(e,t){return function(){return new Ce(e,t)}}),Ce.Version,!1);var Me=function(e){function t(t){var r=e.call(this,t)||this;return r._enabled=!1,r._featurePointCloud=[],r.onFeaturePointsAddedObservable=new se.y$,r.onFeaturePointsUpdatedObservable=new se.y$,r.xrNativeFeatureName="bjsfeature-points",r._xrSessionManager.session?r._init():r._xrSessionManager.onXRSessionInit.addOnce((function(){r._init()})),r}return(0,oe.ZT)(t,e),Object.defineProperty(t.prototype,"featurePointCloud",{get:function(){return this._featurePointCloud},enumerable:!1,configurable:!0}),t.prototype.detach=function(){return!!e.prototype.detach.call(this)&&(this.featurePointCloud.length=0,!0)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._featurePointCloud.length=0,this.onFeaturePointsUpdatedObservable.clear(),this.onFeaturePointsAddedObservable.clear()},t.prototype._onXRFrame=function(e){if(this.attached&&this._enabled&&e){var t=e.featurePointCloud;if(t&&0!==t.length){if(t.length%5!=0)throw new Error("Received malformed feature point cloud of length: "+t.length);for(var r=t.length/5,n=new Array,i=new Array,o=0;o<r;o++){var s=5*o,a=t[s+4];this._featurePointCloud[a]?n.push(a):(this._featurePointCloud[a]={position:new ae.P,confidenceValue:0},i.push(a)),this._featurePointCloud[a].position.x=t[s],this._featurePointCloud[a].position.y=t[s+1],this._featurePointCloud[a].position.z=t[s+2],this._featurePointCloud[a].confidenceValue=t[s+3]}i.length>0&&this.onFeaturePointsAddedObservable.notifyObservers(i),n.length>0&&this.onFeaturePointsUpdatedObservable.notifyObservers(n)}}},t.prototype._init=function(){this._xrSessionManager.session.trySetFeaturePointCloudEnabled&&this._xrSessionManager.session.trySetFeaturePointCloudEnabled(!0)&&(this._enabled=!0)},t.Name=ne.b.FEATURE_POINTS,t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(Me.Name,(function(e){return function(){return new Me(e)}}),Me.Version);var xe,Pe=r(68942),Te=r(6307),Se=0,Ee=function(e){function t(t,r){void 0===r&&(r={});var n=e.call(this,t)||this;return n._options=r,n._detectedMeshes=new Map,n.onMeshAddedObservable=new se.y$,n.onMeshRemovedObservable=new se.y$,n.onMeshUpdatedObservable=new se.y$,n.xrNativeFeatureName="mesh-detection",n._xrSessionManager.session?n._init():n._xrSessionManager.onXRSessionInit.addOnce((function(){n._init()})),n}return(0,oe.ZT)(t,e),t.prototype.detach=function(){var t=this;return!!e.prototype.detach.call(this)&&(this._xrSessionManager.isNative&&this._xrSessionManager.session.trySetMeshDetectorEnabled&&this._xrSessionManager.session.trySetMeshDetectorEnabled(!1),this._options.doNotRemoveMeshesOnSessionEnded||(this._detectedMeshes.forEach((function(e){t.onMeshRemovedObservable.notifyObservers(e)})),this._detectedMeshes.clear()),!0)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onMeshUpdatedObservable.clear()},t.prototype._onXRFrame=function(e){var t,r=this;try{if(!this.attached||!e)return;var n=null===(t=e.worldInformation)||void 0===t?void 0:t.detectedMeshes;if(n){var i=new Set;this._detectedMeshes.forEach((function(e,t){n.has(t)||i.add(t)})),i.forEach((function(e){var t=r._detectedMeshes.get(e);t&&(r.onMeshRemovedObservable.notifyObservers(t),r._detectedMeshes.delete(e))})),n.forEach((function(t){if(r._detectedMeshes.has(t)){if(t.lastChangedTime===r._xrSessionManager.currentTimestamp)(i=r._detectedMeshes.get(t))&&(r._updateVertexDataWithXRMesh(t,i,e),r.onMeshUpdatedObservable.notifyObservers(i))}else{var n={id:Se++,xrMesh:t},i=r._updateVertexDataWithXRMesh(t,n,e);r._detectedMeshes.set(t,i),r.onMeshAddedObservable.notifyObservers(i)}}))}}catch(e){}},t.prototype._init=function(){this._xrSessionManager.isNative&&(this._xrSessionManager.session.trySetMeshDetectorEnabled&&this._xrSessionManager.session.trySetMeshDetectorEnabled(!0),this._options.preferredDetectorOptions&&this._xrSessionManager.session.trySetPreferredMeshDetectorOptions&&this._xrSessionManager.session.trySetPreferredMeshDetectorOptions(this._options.preferredDetectorOptions))},t.prototype._updateVertexDataWithXRMesh=function(e,t,r){if(t.xrMesh=e,t.worldParentNode=this._options.worldParentNode,this._options.convertCoordinateSystems){if(this._xrSessionManager.scene.useRightHandedSystem)t.positions=e.positions,t.normals=e.normals;else{t.positions=new Float32Array(e.positions.length);for(var n=0;n<e.positions.length;n+=3)t.positions[n]=e.positions[n],t.positions[n+1]=e.positions[n+1],t.positions[n+2]=-1*e.positions[n+2];if(e.normals){t.normals=new Float32Array(e.normals.length);for(n=0;n<e.normals.length;n+=3)t.normals[n]=e.normals[n],t.normals[n+1]=e.normals[n+1],t.normals[n+2]=-1*e.normals[n+2]}}t.indices=e.indices;var i=r.getPose(e.meshSpace,this._xrSessionManager.referenceSpace);if(i){var o=t.transformationMatrix||new Te.y3;Te.y3.FromArrayToRef(i.transform.matrix,0,o),this._xrSessionManager.scene.useRightHandedSystem||o.toggleModelMatrixHandInPlace(),t.transformationMatrix=o,this._options.worldParentNode&&o.multiplyToRef(this._options.worldParentNode.getWorldMatrix(),o)}}return t},t.Name=ne.b.MESH_DETECTION,t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(Ee.Name,(function(e,t){return function(){return new Ee(e,t)}}),Ee.Version,!1),function(e){e[e.NotReceived=0]="NotReceived",e[e.Waiting=1]="Waiting",e[e.Received=2]="Received"}(xe||(xe={}));var Ie=function(e){function t(t,r){var n=e.call(this,t)||this;return n.options=r,n.onUntrackableImageFoundObservable=new se.y$,n.onTrackableImageFoundObservable=new se.y$,n.onTrackedImageUpdatedObservable=new se.y$,n._trackableScoreStatus=xe.NotReceived,n._trackedImages=[],n.xrNativeFeatureName="image-tracking",n}return(0,oe.ZT)(t,e),t.prototype.attach=function(){return e.prototype.attach.call(this)},t.prototype.detach=function(){return e.prototype.detach.call(this)},t.prototype.getTrackedImageById=function(e){return this._trackedImages[e]||null},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._trackedImages.forEach((function(e){e.originalBitmap.close()})),this._trackedImages.length=0,this.onTrackableImageFoundObservable.clear(),this.onUntrackableImageFoundObservable.clear(),this.onTrackedImageUpdatedObservable.clear()},t.prototype.getXRSessionInitExtension=function(){return(0,oe.mG)(this,void 0,void 0,(function(){var e,t,r=this;return(0,oe.Jh)(this,(function(n){switch(n.label){case 0:if(!this.options.images||!this.options.images.length)return[2,{}];e=this.options.images.map((function(e){return"string"==typeof e.src?r._xrSessionManager.scene.getEngine()._createImageBitmapFromSource(e.src):Promise.resolve(e.src)})),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,Promise.all(e)];case 2:return t=n.sent(),this._originalTrackingRequest=t.map((function(e,t){return{image:e,widthInMeters:r.options.images[t].estimatedRealWorldWidth}})),[2,{trackedImages:this._originalTrackingRequest}];case 3:return n.sent(),le.w1.Error("Error loading images for tracking, WebXRImageTracking disabled for this session."),[2,{}];case 4:return[2]}}))}))},t.prototype._onXRFrame=function(e){if(e.getImageTrackingResults&&this._trackableScoreStatus!==xe.Waiting)if(this._trackableScoreStatus!==xe.NotReceived)for(var t=0,r=e.getImageTrackingResults();t<r.length;t++){var n=r[t],i=!1,o=n.index,s=this._trackedImages[o];if(s){s.xrTrackingResult=n,s.realWorldWidth!==n.measuredWidthInMeters&&(s.realWorldWidth=n.measuredWidthInMeters,i=!0);var a=e.getPose(n.imageSpace,this._xrSessionManager.referenceSpace);if(a){var l=s.transformationMatrix;ae.y3.FromArrayToRef(a.transform.matrix,0,l),this._xrSessionManager.scene.useRightHandedSystem||l.toggleModelMatrixHandInPlace(),i=!0}var c="emulated"===n.trackingState;s.emulated!==c&&(s.emulated=c,i=!0),i&&this.onTrackedImageUpdatedObservable.notifyObservers(s)}}else this._checkScoresAsync()},t.prototype._checkScoresAsync=function(){return(0,oe.mG)(this,void 0,void 0,(function(){var e,t,r,n;return(0,oe.Jh)(this,(function(i){switch(i.label){case 0:return this._xrSessionManager.session.getTrackedImageScores&&this._trackableScoreStatus===xe.NotReceived?(this._trackableScoreStatus=xe.Waiting,[4,this._xrSessionManager.session.getTrackedImageScores()]):[2];case 1:if(!(e=i.sent())||0===e.length)return this._trackableScoreStatus=xe.NotReceived,[2];for(t=0;t<e.length;++t)"untrackable"==e[t]?this.onUntrackableImageFoundObservable.notifyObservers(t):(r=this._originalTrackingRequest[t].image,n={id:t,originalBitmap:r,transformationMatrix:new ae.y3,ratio:r.width/r.height},this._trackedImages[t]=n,this.onTrackableImageFoundObservable.notifyObservers(n));return this._trackableScoreStatus=e.length>0?xe.Received:xe.NotReceived,[2]}}))}))},t.Name=ne.b.IMAGE_TRACKING,t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(Ie.Name,(function(e,t){return function(){return new Ie(e,t)}}),Ie.Version,!1);var Ae=r(79326),Ne=function(e){function t(t,r){var n=e.call(this,t)||this;return n.options=r,n._domOverlayType=null,n._beforeXRSelectListener=null,n._element=null,n.xrNativeFeatureName="dom-overlay",le.w1.Warn("dom-overlay is an experimental and unstable feature."),n}return(0,oe.ZT)(t,e),t.prototype.attach=function(){return!!e.prototype.attach.call(this)&&(!(!this._xrSessionManager.session.domOverlayState||null===this._xrSessionManager.session.domOverlayState.type)&&(this._domOverlayType=this._xrSessionManager.session.domOverlayState.type,null!==this._element&&!0===this.options.supressXRSelectEvents&&(this._beforeXRSelectListener=function(e){e.preventDefault()},this._element.addEventListener("beforexrselect",this._beforeXRSelectListener)),!0))},Object.defineProperty(t.prototype,"domOverlayType",{get:function(){return this._domOverlayType},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){e.prototype.dispose.call(this),null!==this._element&&this._beforeXRSelectListener&&this._element.removeEventListener("beforexrselect",this._beforeXRSelectListener)},t.prototype._onXRFrame=function(e){},t.prototype.getXRSessionInitExtension=function(){return(0,oe.mG)(this,void 0,void 0,(function(){var e;return(0,oe.Jh)(this,(function(t){if(void 0===this.options.element)return le.w1.Warn('"element" option must be provided to attach xr-dom-overlay feature.'),[2,{}];if("string"==typeof this.options.element){if(null===(e=document.querySelector(this.options.element)))return le.w1.Warn("element not found '".concat(this.options.element,"' (not requesting xr-dom-overlay)")),[2,{}];this._element=e}else this._element=this.options.element;return[2,{domOverlay:{root:this._element}}]}))}))},t.Name=ne.b.DOM_OVERLAY,t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(Ne.Name,(function(e,t){return function(){return new Ne(e,t)}}),Ne.Version,!1);var Oe=r(23845),Fe=function(e){function t(r,n){var i,o,s,a,l,c,h=this;return(h=e.call(this,r)||this)._controllers={},h._currentRegistrationConfigurations=[],h._movementDirection=null,h._tmpRotationMatrix=ae.y3.Identity(),h._tmpTranslationDirection=new ae.P,h._tmpMovementTranslation=new ae.P,h._attachController=function(e){if(!h._controllers[e.uniqueId]){h._controllers[e.uniqueId]={xrController:e,registeredComponents:[]};var t=h._controllers[e.uniqueId];if("tracked-pointer"===t.xrController.inputSource.targetRayMode&&t.xrController.inputSource.gamepad){var r=function(){if(e.motionController)for(var r=function(r){var n=null;if(r.allowedComponentTypes)for(var i=0,o=r.allowedComponentTypes;i<o.length;i++){var s=o[i],a=e.motionController.getComponentOfType(s);if(null!==a){n=a;break}}if(r.mainComponentOnly){var l=e.motionController.getMainComponent();if(null===l)return"continue";n=l}if("function"==typeof r.componentSelectionPredicate&&(n=r.componentSelectionPredicate(e)),n&&r.forceHandedness&&e.inputSource.handedness!==r.forceHandedness)return"continue";if(null===n)return"continue";var c={registrationConfiguration:r,component:n};t.registeredComponents.push(c),"axisChangedHandler"in r&&(c.onAxisChangedObserver=n.onAxisValueChangedObservable.add((function(e){r.axisChangedHandler(e,h._movementState,h._featureContext,h._xrInput)}))),"buttonChangedhandler"in r&&(c.onButtonChangedObserver=n.onButtonStateChangedObservable.add((function(){n.changes.pressed&&r.buttonChangedhandler(n.changes.pressed,h._movementState,h._featureContext,h._xrInput)})))},n=0,i=h._currentRegistrationConfigurations;n<i.length;n++){r(i[n])}};e.motionController?r():e.onMotionControllerInitObservable.addOnce((function(){r()}))}}},n&&void 0!==n.xrInput?(Array.isArray(n.customRegistrationConfigurations)?h._currentRegistrationConfigurations=n.customRegistrationConfigurations:h._currentRegistrationConfigurations=t.REGISTRATIONS.default,h._featureContext={movementEnabled:n.movementEnabled||!0,movementOrientationFollowsViewerPose:null===(i=n.movementOrientationFollowsViewerPose)||void 0===i||i,movementSpeed:null!==(o=n.movementSpeed)&&void 0!==o?o:1,movementThreshold:null!==(s=n.movementThreshold)&&void 0!==s?s:.25,rotationEnabled:null===(a=n.rotationEnabled)||void 0===a||a,rotationSpeed:null!==(l=n.rotationSpeed)&&void 0!==l?l:1,rotationThreshold:null!==(c=n.rotationThreshold)&&void 0!==c?c:.25},h._movementState={moveX:0,moveY:0,rotateX:0,rotateY:0},h._xrInput=n.xrInput,h):(le.w1.Error('WebXRControllerMovement feature requires "xrInput" option.'),h)}return(0,oe.ZT)(t,e),Object.defineProperty(t.prototype,"movementDirection",{get:function(){return this._movementDirection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"movementEnabled",{get:function(){return this._featureContext.movementEnabled},set:function(e){this._featureContext.movementEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"movementOrientationFollowsViewerPose",{get:function(){return this._featureContext.movementOrientationFollowsViewerPose},set:function(e){this._featureContext.movementOrientationFollowsViewerPose=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"movementSpeed",{get:function(){return this._featureContext.movementSpeed},set:function(e){this._featureContext.movementSpeed=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"movementThreshold",{get:function(){return this._featureContext.movementThreshold},set:function(e){this._featureContext.movementThreshold=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationEnabled",{get:function(){return this._featureContext.rotationEnabled},set:function(e){this._featureContext.rotationEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationSpeed",{get:function(){return this._featureContext.rotationSpeed},set:function(e){this._featureContext.rotationSpeed=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationThreshold",{get:function(){return this._featureContext.rotationThreshold},set:function(e){this._featureContext.rotationThreshold=e},enumerable:!1,configurable:!0}),t.prototype.attach=function(){var t=this;return!!e.prototype.attach.call(this)&&(this._xrInput.controllers.forEach(this._attachController),this._addNewAttachObserver(this._xrInput.onControllerAddedObservable,this._attachController),this._addNewAttachObserver(this._xrInput.onControllerRemovedObservable,(function(e){t._detachController(e.uniqueId)})),!0)},t.prototype.detach=function(){var t=this;return!!e.prototype.detach.call(this)&&(Object.keys(this._controllers).forEach((function(e){t._detachController(e)})),this._controllers={},!0)},t.prototype._onXRFrame=function(e){if(this.attach){if(null===this._movementDirection&&(this._movementDirection=this._xrInput.xrCamera.rotationQuaternion.clone()),0!==this._movementState.rotateX&&this._featureContext.rotationEnabled){var t=.001*this._xrSessionManager.scene.getEngine().getDeltaTime()*this._featureContext.rotationSpeed*this._movementState.rotateX*(this._xrSessionManager.scene.useRightHandedSystem?-1:1);!0===this._featureContext.movementOrientationFollowsViewerPose?(this._xrInput.xrCamera.cameraRotation.y+=t,this._movementDirection=this._xrInput.xrCamera.rotationQuaternion.multiply(ae._f.RotationYawPitchRoll(t,0,0))):this._movementDirection.multiplyInPlace(ae._f.RotationYawPitchRoll(3*t,0,0))}else!0===this._featureContext.movementOrientationFollowsViewerPose&&this._movementDirection.copyFrom(this._xrInput.xrCamera.rotationQuaternion);0===this._movementState.moveX&&0===this._movementState.moveY||!this._featureContext.movementEnabled||(ae.y3.FromQuaternionToRef(this._movementDirection,this._tmpRotationMatrix),this._tmpTranslationDirection.set(this._movementState.moveX,0,this._movementState.moveY*(this._xrSessionManager.scene.useRightHandedSystem?1:-1)),ae.P.TransformCoordinatesToRef(this._tmpTranslationDirection,this._tmpRotationMatrix,this._tmpMovementTranslation),this._tmpMovementTranslation.scaleInPlace(this._xrInput.xrCamera._computeLocalCameraSpeed()*this._featureContext.movementSpeed),this._xrInput.xrCamera.cameraDirection.addInPlace(this._tmpMovementTranslation))}},t.prototype._detachController=function(e){var t=this._controllers[e];if(t){for(var r=0,n=t.registeredComponents;r<n.length;r++){var i=n[r];i.onAxisChangedObserver&&i.component.onAxisValueChangedObservable.remove(i.onAxisChangedObserver),i.onButtonChangedObserver&&i.component.onButtonStateChangedObservable.remove(i.onButtonChangedObserver)}delete this._controllers[e]}},t.Name=ne.b.MOVEMENT,t.REGISTRATIONS={default:[{allowedComponentTypes:[Oe.n.THUMBSTICK_TYPE,Oe.n.TOUCHPAD_TYPE],forceHandedness:"left",axisChangedHandler:function(e,t,r){t.rotateX=Math.abs(e.x)>r.rotationThreshold?e.x:0,t.rotateY=Math.abs(e.y)>r.rotationThreshold?e.y:0}},{allowedComponentTypes:[Oe.n.THUMBSTICK_TYPE,Oe.n.TOUCHPAD_TYPE],forceHandedness:"right",axisChangedHandler:function(e,t,r){t.moveX=Math.abs(e.x)>r.movementThreshold?e.x:0,t.moveY=Math.abs(e.y)>r.movementThreshold?e.y:0}}]},t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(Fe.Name,(function(e,t){return function(){return new Fe(e,t)}}),Fe.Version,!0);var De=r(61319),we=r(7949),ke=r(15631),Le=r(258),Be=r(39126),Ge=r(69314),Xe=r(51011),He=function(e){function t(t,r){var n=e.call(this,t)||this;return n.options=r,n._canvasContext=null,n._reflectionCubeMap=null,n._xrLightEstimate=null,n._xrLightProbe=null,n._xrWebGLBinding=null,n._lightDirection=ae.P.Up().negateInPlace(),n._lightColor=ke.Wo.White(),n._intensity=1,n._sphericalHarmonics=new Ge._,n._cubeMapPollTime=Date.now(),n._lightEstimationPollTime=Date.now(),n._reflectionCubeMapTextureSize=16,n.directionalLight=null,n.onReflectionCubeMapUpdatedObservable=new se.y$,n._updateReflectionCubeMap=function(){var e;if(n._xrLightProbe){if(n.options.cubeMapPollInterval){var t=Date.now();if(t-n._cubeMapPollTime<n.options.cubeMapPollInterval)return;n._cubeMapPollTime=t}var r=n._getXRGLBinding().getReflectionCubeMap(n._xrLightProbe);if(r&&n._reflectionCubeMap){if(n._reflectionCubeMap._texture)null===(e=n._reflectionCubeMap._texture._hardwareTexture)||void 0===e||e.set(r),n._reflectionCubeMap._texture.getEngine().resetTextureCache();else{var i=new we.l(n._xrSessionManager.scene.getEngine(),we.S.Unknown);i.isCube=!0,i.invertY=!1,i._useSRGBBuffer="srgba8"===n.options.reflectionFormat,i.format=5,i.generateMipMaps=!0,i.type="srgba8"!==n.options.reflectionFormat?2:0,i.samplingMode=3,i.width=n._reflectionCubeMapTextureSize,i.height=n._reflectionCubeMapTextureSize,i._cachedWrapU=1,i._cachedWrapV=1,i._hardwareTexture=new De.B(r,n._getCanvasContext()),n._reflectionCubeMap._texture=i}n._reflectionCubeMap._texture.isReady=!0,n._xrSessionManager.scene.markAllMaterialsAsDirty(1),n.onReflectionCubeMapUpdatedObservable.notifyObservers(n._reflectionCubeMap)}}},n.xrNativeFeatureName="light-estimation",n.options.createDirectionalLightSource&&(n.directionalLight=new Le.O("light estimation directional",n._lightDirection,n._xrSessionManager.scene),n.directionalLight.position=new ae.P(0,8,0),n.directionalLight.intensity=0,n.directionalLight.falloffType=Xe.m.FALLOFF_GLTF),le.w1.Warn("light-estimation is an experimental and unstable feature."),n}return(0,oe.ZT)(t,e),Object.defineProperty(t.prototype,"reflectionCubeMapTexture",{get:function(){return this._reflectionCubeMap},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xrLightingEstimate",{get:function(){return this._xrLightEstimate?{lightColor:this._lightColor,lightDirection:this._lightDirection,lightIntensity:this._intensity,sphericalHarmonics:this._sphericalHarmonics}:this._xrLightEstimate},enumerable:!1,configurable:!0}),t.prototype._getCanvasContext=function(){return null===this._canvasContext&&(this._canvasContext=this._xrSessionManager.scene.getEngine()._gl),this._canvasContext},t.prototype._getXRGLBinding=function(){if(null===this._xrWebGLBinding){var e=this._getCanvasContext();this._xrWebGLBinding=new XRWebGLBinding(this._xrSessionManager.session,e)}return this._xrWebGLBinding},t.prototype.attach=function(){var t,r=this;if(!e.prototype.attach.call(this))return!1;var n=null!==(t=this.options.reflectionFormat)&&void 0!==t?t:this._xrSessionManager.session.preferredReflectionFormat||"srgba8";return this.options.reflectionFormat=n,this._xrSessionManager.session.requestLightProbe({reflectionFormat:n}).then((function(e){r._xrLightProbe=e,r.options.disableCubeMapReflection||(r._reflectionCubeMap||(r._reflectionCubeMap=new Be.V(r._xrSessionManager.scene),r._reflectionCubeMap.isCube=!0,r._reflectionCubeMap.coordinatesMode=3,r.options.setSceneEnvironmentTexture&&(r._xrSessionManager.scene.environmentTexture=r._reflectionCubeMap)),r._xrLightProbe.addEventListener("reflectionchange",r._updateReflectionCubeMap))})),!0},t.prototype.detach=function(){var t=e.prototype.detach.call(this);return null===this._xrLightProbe||this.options.disableCubeMapReflection||(this._xrLightProbe.removeEventListener("reflectionchange",this._updateReflectionCubeMap),this._xrLightProbe=null),this._canvasContext=null,this._xrLightEstimate=null,this._xrWebGLBinding=null,t},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onReflectionCubeMapUpdatedObservable.clear(),this.directionalLight&&(this.directionalLight.dispose(),this.directionalLight=null),null!==this._reflectionCubeMap&&(this._reflectionCubeMap._texture&&this._reflectionCubeMap._texture.dispose(),this._reflectionCubeMap.dispose(),this._reflectionCubeMap=null)},t.prototype._onXRFrame=function(e){var t;if(null!==this._xrLightProbe){if(this.options.lightEstimationPollInterval){var r=Date.now();if(r-this._lightEstimationPollTime<this.options.lightEstimationPollInterval)return;this._lightEstimationPollTime=r}if(this._xrLightEstimate=e.getLightEstimate(this._xrLightProbe),this._xrLightEstimate){this._intensity=Math.max(1,this._xrLightEstimate.primaryLightIntensity.x,this._xrLightEstimate.primaryLightIntensity.y,this._xrLightEstimate.primaryLightIntensity.z);var n=this._xrSessionManager.scene.useRightHandedSystem?1:-1;this.options.disableVectorReuse&&(this._lightDirection=new ae.P,this._lightColor=new ke.Wo,this.directionalLight&&(this.directionalLight.direction=this._lightDirection,this.directionalLight.diffuse=this._lightColor)),this._lightDirection.copyFromFloats(this._xrLightEstimate.primaryLightDirection.x,this._xrLightEstimate.primaryLightDirection.y,this._xrLightEstimate.primaryLightDirection.z*n),this._lightColor.copyFromFloats(this._xrLightEstimate.primaryLightIntensity.x/this._intensity,this._xrLightEstimate.primaryLightIntensity.y/this._intensity,this._xrLightEstimate.primaryLightIntensity.z/this._intensity),this._sphericalHarmonics.updateFromFloatsArray(this._xrLightEstimate.sphericalHarmonicsCoefficients),this._reflectionCubeMap&&!this.options.disableSphericalPolynomial&&(this._reflectionCubeMap.sphericalPolynomial=this._reflectionCubeMap.sphericalPolynomial||new Ge.i,null===(t=this._reflectionCubeMap.sphericalPolynomial)||void 0===t||t.updateFromHarmonics(this._sphericalHarmonics)),this._lightDirection.negateInPlace(),this.directionalLight&&(this.directionalLight.direction.copyFrom(this._lightDirection),this.directionalLight.intensity=Math.min(this._intensity,1),this.directionalLight.diffuse.copyFrom(this._lightColor))}}},t.Name=ne.b.LIGHT_ESTIMATION,t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(He.Name,(function(e,t){return function(){return new He(e,t)}}),He.Version,!1);var Ve=r(1316),Ue=function(e){function t(t){var r=e.call(this,t)||this;return r.onEyeTrackingStartedObservable=new se.y$,r.onEyeTrackingEndedObservable=new se.y$,r.onEyeTrackingFrameUpdateObservable=new se.y$,r._eyeTrackingStartListener=function(e){r._latestEyeSpace=e.gazeSpace,r._gazeRay=new Ve.z(ae.P.Zero(),ae.P.Forward()),r.onEyeTrackingStartedObservable.notifyObservers(r._gazeRay)},r._eyeTrackingEndListener=function(){r._latestEyeSpace=null,r._gazeRay=null,r.onEyeTrackingEndedObservable.notifyObservers()},r.xrNativeFeatureName="eye-tracking",r._xrSessionManager.session?r._init():r._xrSessionManager.onXRSessionInit.addOnce((function(){r._init()})),r}return(0,oe.ZT)(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._xrSessionManager.session.removeEventListener("eyetrackingstart",this._eyeTrackingStartListener),this._xrSessionManager.session.removeEventListener("eyetrackingend",this._eyeTrackingEndListener),this.onEyeTrackingStartedObservable.clear(),this.onEyeTrackingEndedObservable.clear(),this.onEyeTrackingFrameUpdateObservable.clear()},Object.defineProperty(t.prototype,"isEyeGazeValid",{get:function(){return!!this._gazeRay},enumerable:!1,configurable:!0}),t.prototype.getEyeGaze=function(){return this._gazeRay},t.prototype._onXRFrame=function(e){if(this.attached&&e&&this._latestEyeSpace&&this._gazeRay){var t=e.getPose(this._latestEyeSpace,this._xrSessionManager.referenceSpace);if(t){this._gazeRay.origin.set(t.transform.position.x,t.transform.position.y,t.transform.position.z);var r=t.transform.orientation;ae.jp.Quaternion[0].set(r.x,r.y,r.z,r.w),this._xrSessionManager.scene.useRightHandedSystem?ae.P.RightHandedForwardReadOnly.rotateByQuaternionToRef(ae.jp.Quaternion[0],this._gazeRay.direction):(this._gazeRay.origin.z*=-1,ae.jp.Quaternion[0].z*=-1,ae.jp.Quaternion[0].w*=-1,ae.P.LeftHandedForwardReadOnly.rotateByQuaternionToRef(ae.jp.Quaternion[0],this._gazeRay.direction)),this.onEyeTrackingFrameUpdateObservable.notifyObservers(this._gazeRay)}}},t.prototype._init=function(){this._xrSessionManager.isNative&&(this._xrSessionManager.session.addEventListener("eyetrackingstart",this._eyeTrackingStartListener),this._xrSessionManager.session.addEventListener("eyetrackingend",this._eyeTrackingEndListener))},t.Name=ne.b.EYE_TRACKING,t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(Ue.Name,(function(e){return function(){return new Ue(e)}}),Ue.Version,!1);var We=function(){function e(e,t){this._samples=[],this._idx=0;for(var r=0;r<e;++r)this._samples.push(t?t():ae.FM.Zero())}return Object.defineProperty(e.prototype,"length",{get:function(){return this._samples.length},enumerable:!1,configurable:!0}),e.prototype.push=function(e,t){this._idx=(this._idx+this._samples.length-1)%this._samples.length,this.at(0).copyFromFloats(e,t)},e.prototype.at=function(e){if(e>=this._samples.length)throw new Error("Index out of bounds");return this._samples[(this._idx+e)%this._samples.length]},e}(),ze=function(){function e(){this._samples=new We(20),this._entropy=0,this.onFirstStepDetected=new se.y$}return e.prototype.update=function(e,t,r,n){this._samples.push(e,t);var i=this._samples.at(0);if(this._entropy*=this._entropyDecayFactor,this._entropy+=ae.FM.Distance(i,this._samples.at(1)),!(this._entropy>this._entropyThreshold)){var o;for(o=this._samePointCheckStartIdx;o<this._samples.length&&!(ae.FM.DistanceSquared(i,this._samples.at(o))<this._samePointSquaredDistanceThreshold);++o);if(o!==this._samples.length){for(var s=-1,a=0,l=void 0,c=1;c<o;++c)(l=ae.FM.DistanceSquared(i,this._samples.at(c)))>s&&(a=c,s=l);if(!(s<this._apexSquaredDistanceThreshold)){var h=this._samples.at(a),u=h.subtract(i);u.normalize();var d,p=ae.jp.Vector2[0],_=0;for(c=1;c<o;++c)this._samples.at(c).subtractToRef(i,p),d=ae.FM.Dot(u,p),_+=p.lengthSquared()-d*d;if(!(_>o*this._squaredProjectionDistanceThreshold)){var f=ae.jp.Vector3[0];f.set(r,n,0);var m=ae.jp.Vector3[1];m.set(u.x,u.y,0);var g=ae.P.Cross(f,m).z>0,v=i.clone(),y=i.clone();h.subtractToRef(i,u),g?(u.scaleAndAddToRef(this._axisToApexShrinkFactor,v),u.scaleAndAddToRef(this._axisToApexExtendFactor,y)):(u.scaleAndAddToRef(this._axisToApexExtendFactor,v),u.scaleAndAddToRef(this._axisToApexShrinkFactor,y)),this.onFirstStepDetected.notifyObservers({leftApex:v,rightApex:y,currentPosition:i,currentStepDirection:g?"right":"left"})}}}}},e.prototype.reset=function(){for(var e=0;e<this._samples.length;++e)this._samples.at(e).copyFromFloats(0,0)},Object.defineProperty(e.prototype,"_samePointCheckStartIdx",{get:function(){return Math.floor(this._samples.length/3)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_samePointSquaredDistanceThreshold",{get:function(){return 9e-4},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_apexSquaredDistanceThreshold",{get:function(){return.0081},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_squaredProjectionDistanceThreshold",{get:function(){return 9e-4},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_axisToApexShrinkFactor",{get:function(){return.8},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_axisToApexExtendFactor",{get:function(){return-1.6},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_entropyDecayFactor",{get:function(){return.93},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_entropyThreshold",{get:function(){return.4},enumerable:!1,configurable:!0}),e}(),je=function(){function e(e,t,r,n){this._leftApex=new ae.FM,this._rightApex=new ae.FM,this._currentPosition=new ae.FM,this._axis=new ae.FM,this._axisLength=-1,this._forward=new ae.FM,this._steppingLeft=!1,this._t=-1,this._maxT=-1,this._maxTPosition=new ae.FM,this._vitality=0,this.onMovement=new se.y$,this.onFootfall=new se.y$,this._reset(e,t,r,"left"===n)}return e.prototype._reset=function(e,t,r,n){this._leftApex.copyFrom(e),this._rightApex.copyFrom(t),this._steppingLeft=n,this._steppingLeft?(this._leftApex.subtractToRef(this._rightApex,this._axis),this._forward.copyFromFloats(-this._axis.y,this._axis.x)):(this._rightApex.subtractToRef(this._leftApex,this._axis),this._forward.copyFromFloats(this._axis.y,-this._axis.x)),this._axisLength=this._axis.length(),this._forward.scaleInPlace(1/this._axisLength),this._updateTAndVitality(r.x,r.y),this._maxT=this._t,this._maxTPosition.copyFrom(r),this._vitality=1},e.prototype._updateTAndVitality=function(e,t){this._currentPosition.copyFromFloats(e,t),this._steppingLeft?this._currentPosition.subtractInPlace(this._rightApex):this._currentPosition.subtractInPlace(this._leftApex);var r=this._t,n=ae.FM.Dot(this._currentPosition,this._axis);this._t=n/(this._axisLength*this._axisLength);var i=this._currentPosition.lengthSquared()-n/this._axisLength*(n/this._axisLength);this._vitality*=.92-100*Math.max(i-.0016,0)+Math.max(this._t-r,0)},e.prototype.update=function(e,t){if(this._vitality<this._vitalityThreshold)return!1;var r=this._t;return this._updateTAndVitality(e,t),this._t>this._maxT&&(this._maxT=this._t,this._maxTPosition.copyFromFloats(e,t)),!(this._vitality<this._vitalityThreshold)&&(this._t>r&&(this.onMovement.notifyObservers({deltaT:this._t-r}),r<.5&&this._t>=.5&&this.onFootfall.notifyObservers({foot:this._steppingLeft?"left":"right"})),this._t<.95*this._maxT&&(this._currentPosition.copyFromFloats(e,t),this._steppingLeft?this._leftApex.copyFrom(this._maxTPosition):this._rightApex.copyFrom(this._maxTPosition),this._reset(this._leftApex,this._rightApex,this._currentPosition,!this._steppingLeft)),!(this._axisLength<.03))},Object.defineProperty(e.prototype,"_vitalityThreshold",{get:function(){return.1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"forward",{get:function(){return this._forward},enumerable:!1,configurable:!0}),e}(),qe=function(){function e(t){var r=this;this._detector=new ze,this._walker=null,this._movement=new ae.FM,this._millisecondsSinceLastUpdate=e._MillisecondsPerUpdate,this.movementThisFrame=ae.P.Zero(),this._engine=t,this._detector.onFirstStepDetected.add((function(e){r._walker||(r._walker=new je(e.leftApex,e.rightApex,e.currentPosition,e.currentStepDirection),r._walker.onFootfall.add((function(){})),r._walker.onMovement.add((function(e){r._walker.forward.scaleAndAddToRef(.024*e.deltaT,r._movement)})))}))}return Object.defineProperty(e,"_MillisecondsPerUpdate",{get:function(){return 1e3/15},enumerable:!1,configurable:!0}),e.prototype.update=function(t,r){if(r.y=0,r.normalize(),this._millisecondsSinceLastUpdate+=this._engine.getDeltaTime(),this._millisecondsSinceLastUpdate>=e._MillisecondsPerUpdate){if(this._millisecondsSinceLastUpdate-=e._MillisecondsPerUpdate,this._detector.update(t.x,t.z,r.x,r.z),this._walker)this._walker.update(t.x,t.z)||(this._walker=null);this._movement.scaleInPlace(.85)}this.movementThisFrame.set(this._movement.x,0,this._movement.y)},e}(),Qe=function(e){function t(t,r){var n=e.call(this,t)||this;return n._up=new ae.P,n._forward=new ae.P,n._position=new ae.P,n._movement=new ae.P,n._sessionManager=t,n.locomotionTarget=r.locomotionTarget,n._isLocomotionTargetWebXRCamera&&ye.Y.Warn("Using walking locomotion directly on a WebXRCamera may have unintended interactions with other XR techniques. Using an XR space parent is highly recommended"),n}return(0,oe.ZT)(t,e),Object.defineProperty(t,"Name",{get:function(){return ne.b.WALKING_LOCOMOTION},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Version",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"locomotionTarget",{get:function(){return this._locomotionTarget},set:function(e){this._locomotionTarget=e,this._isLocomotionTargetWebXRCamera="WebXRCamera"===this._locomotionTarget.getClassName()},enumerable:!1,configurable:!0}),t.prototype.isCompatible=function(){return void 0===this._sessionManager.sessionMode||"immersive-vr"===this._sessionManager.sessionMode},t.prototype.attach=function(){return!(!this.isCompatible||!e.prototype.attach.call(this))&&(this._walker=new qe(this._sessionManager.scene.getEngine()),!0)},t.prototype.detach=function(){return!!e.prototype.detach.call(this)&&(this._walker=null,!0)},t.prototype._onXRFrame=function(e){var t=e.getViewerPose(this._sessionManager.baseReferenceSpace);if(t){var r=this.locomotionTarget.getScene().useRightHandedSystem?1:-1,n=t.transform.matrix;this._up.copyFromFloats(n[4],n[5],r*n[6]),this._forward.copyFromFloats(n[8],n[9],r*n[10]),this._position.copyFromFloats(n[12],n[13],r*n[14]),this._forward.scaleAndAddToRef(.05,this._position),this._up.scaleAndAddToRef(-.05,this._position),this._walker.update(this._position,this._forward),this._movement.copyFrom(this._walker.movementThisFrame),this._isLocomotionTargetWebXRCamera||ae.P.TransformNormalToRef(this._movement,this.locomotionTarget.getWorldMatrix(),this._movement),this.locomotionTarget.position.addInPlace(this._movement)}},t}(ie.F);ne.d.AddWebXRFeature(Qe.Name,(function(e,t){return function(){return new Qe(e,t)}}),Qe.Version,!1);var Ye=r(69022),$e=r(64829),Ke=r(44347),Ze=function(e){function t(t,r,n,i,o,s){var a=e.call(this,t,r,n,i,s)||this;return a.getWidth=t,a.getHeight=r,a.layer=n,a.layerType=i,a.isMultiview=o,a.createRTTProvider=s,a}return(0,oe.ZT)(t,e),t}($e.s),Je=function(e){function t(t,r,n){var i=e.call(this,t.scene,n)||this;return i._xrSessionManager=t,i._xrWebGLBinding=r,i.layerWrapper=n,i._lastSubImages=new Map,i._compositionLayer=n.layer,i}return(0,oe.ZT)(t,e),t.prototype._getRenderTargetForSubImage=function(e,t){var r=this._lastSubImages.get(t),n="left"==t?0:1;return this._renderTargetTextures[n]&&(null==r?void 0:r.textureWidth)===e.textureWidth&&(null==r?void 0:r.textureHeight)==e.textureHeight||(this._renderTargetTextures[n]=this._createRenderTargetTexture(e.textureWidth,e.textureHeight,null,e.colorTexture,e.depthStencilTexture,this.layerWrapper.isMultiview),this._framebufferDimensions={framebufferWidth:e.textureWidth,framebufferHeight:e.textureHeight}),this._lastSubImages.set(t,e),this._renderTargetTextures[n]},t.prototype._getSubImageForEye=function(e){var t=this._xrSessionManager.currentFrame;return t?this._xrWebGLBinding.getSubImage(this._compositionLayer,t,e):null},t.prototype.getRenderTargetTextureForEye=function(e){var t=this._getSubImageForEye(e);return t?this._getRenderTargetForSubImage(t,e):null},t.prototype.getRenderTargetTextureForView=function(e){return this.getRenderTargetTextureForEye(e.eye)},t.prototype._setViewportForSubImage=function(e,t){var r=t.textureWidth,n=t.textureHeight,i=t.viewport;e.x=i.x/r,e.y=i.y/n,e.width=i.width/r,e.height=i.height/n},t.prototype.trySetViewportForView=function(e,t){var r=this._lastSubImages.get(t.eye)||this._getSubImageForEye(t.eye);return!!r&&(this._setViewportForSubImage(e,r),!0)},t}(Ye.y),et=function(e){function t(t,r,n){var i=e.call(this,(function(){return t.textureWidth}),(function(){return t.textureHeight}),t,"XRProjectionLayer",r,(function(e){return new tt(e,n,i)}))||this;return i.layer=t,i}return(0,oe.ZT)(t,e),t}(Ze),tt=function(e){function t(t,r,n){var i=e.call(this,t,r,n)||this;return i.layerWrapper=n,i._projectionLayer=n.layer,i}return(0,oe.ZT)(t,e),t.prototype._getSubImageForView=function(e){return this._xrWebGLBinding.getViewSubImage(this._projectionLayer,e)},t.prototype.getRenderTargetTextureForView=function(e){return this._getRenderTargetForSubImage(this._getSubImageForView(e),e.eye)},t.prototype.getRenderTargetTextureForEye=function(e){var t=this._lastSubImages.get(e);return t?this._getRenderTargetForSubImage(t,e):null},t.prototype.trySetViewportForView=function(e,t){var r=this._lastSubImages.get(t.eye)||this._getSubImageForView(t);return!!r&&(this._setViewportForSubImage(e,r),!0)},t}(Je),rt={},nt={textureType:"texture",colorFormat:6408,depthFormat:35056,scaleFactor:1},it=function(e){function t(t,r){void 0===r&&(r={});var n=e.call(this,t)||this;return n._options=r,n._existingLayers=[],n.xrNativeFeatureName="layers",n}return(0,oe.ZT)(t,e),t.prototype.attach=function(){if(!e.prototype.attach.call(this))return!1;var t=this._xrSessionManager.scene.getEngine();this._glContext=t._gl,this._xrWebGLBinding=new XRWebGLBinding(this._xrSessionManager.session,this._glContext),this._existingLayers=[];var r=(0,oe.pi)({},nt),n=this._options.preferMultiviewOnInit&&t.getCaps().multiview;return n&&(r.textureType="texture-array"),this.addXRSessionLayer(this.createProjectionLayer(r,n)),!0},t.prototype.detach=function(){return!!e.prototype.detach.call(this)&&(this._existingLayers.length=0,!0)},t.prototype.createXRWebGLLayer=function(e){void 0===e&&(e=rt);var t=new XRWebGLLayer(this._xrSessionManager.session,this._glContext,e);return new Ke.J(t)},t.prototype.createProjectionLayer=function(e,t){if(void 0===e&&(e=nt),void 0===t&&(t=!1),t&&"texture-array"!==e.textureType)throw new Error("Projection layers can only be made multiview if they use texture arrays. Set the textureType parameter to 'texture-array'.");if(!t&&"texture-array"===e.textureType)throw new Error("We currently only support multiview rendering when the textureType parameter is set to 'texture-array'.");var r=this._xrWebGLBinding.createProjectionLayer(e);return new et(r,t,this._xrWebGLBinding)},t.prototype.addXRSessionLayer=function(e){this.setXRSessionLayers((0,oe.ev)((0,oe.ev)([],this._existingLayers,!0),[e],!1))},t.prototype.setXRSessionLayers=function(e){this._existingLayers=e;var t=(0,oe.pi)({},this._xrSessionManager.session.renderState);t.baseLayer=void 0,t.layers=e.map((function(e){return e.layer})),this._xrSessionManager.updateRenderState(t),this._xrSessionManager._setBaseLayerWrapper(e.length>0?e[0]:null)},t.prototype.isCompatible=function(){return!this._xrSessionManager.isNative&&"undefined"!=typeof XRWebGLBinding&&!!XRWebGLBinding.prototype.createProjectionLayer},t.prototype.dispose=function(){e.prototype.dispose.call(this)},t.prototype._onXRFrame=function(e){},t.Name=ne.b.LAYERS,t.Version=1,t}(ie.F);ne.d.AddWebXRFeature(it.Name,(function(e,t){return function(){return new it(e,t)}}),it.Version,!1);var ot=r(34779),st=r(51917),at=function(e){function t(t,r,n){var i=e.call(this,t,lt[n],r,n,!0)||this;return i.profileId="generic-hand-select-grasp",i}return(0,oe.ZT)(t,e),t.prototype._getFilenameAndPath=function(){return{filename:"generic.babylon",path:"https://controllers.babylonjs.com/generic/"}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){},t.prototype._setRootMesh=function(e){},t.prototype._updateModel=function(){},t}(ot.d);st.V.RegisterController("generic-hand-select-grasp",(function(e,t){return new at(t,e.gamepad,e.handedness)}));var lt={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr-standard-trigger",visualResponses:{}},grasp:{type:"trigger",gamepadIndices:{button:4},rootNodeName:"grasp",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-hand-select-grasp-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr-standard-trigger",visualResponses:{}},grasp:{type:"trigger",gamepadIndices:{button:4},rootNodeName:"grasp",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-hand-select-grasp-right",assetPath:"right.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr-standard-trigger",visualResponses:{}},grasp:{type:"trigger",gamepadIndices:{button:4},rootNodeName:"grasp",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"generic-hand-select-grasp-none",assetPath:"none.glb"}},ct=r(28170),ht=r(91243),ut=r(63407),dt=function(e){function t(t,r,n){var i=e.call(this,t,pt["left-right"],r,n)||this;return i._mapping={defaultButton:{valueNodeName:"VALUE",unpressedNodeName:"UNPRESSED",pressedNodeName:"PRESSED"},defaultAxis:{valueNodeName:"VALUE",minNodeName:"MIN",maxNodeName:"MAX"},buttons:{"xr-standard-trigger":{rootNodeName:"SELECT",componentProperty:"button",states:["default","touched","pressed"]},"xr-standard-squeeze":{rootNodeName:"GRASP",componentProperty:"state",states:["pressed"]},"xr-standard-touchpad":{rootNodeName:"TOUCHPAD_PRESS",labelAnchorNodeName:"squeeze-label",touchPointNodeName:"TOUCH"},"xr-standard-thumbstick":{rootNodeName:"THUMBSTICK_PRESS",componentProperty:"state",states:["pressed"]}},axes:{"xr-standard-touchpad":{"x-axis":{rootNodeName:"TOUCHPAD_TOUCH_X"},"y-axis":{rootNodeName:"TOUCHPAD_TOUCH_Y"}},"xr-standard-thumbstick":{"x-axis":{rootNodeName:"THUMBSTICK_X"},"y-axis":{rootNodeName:"THUMBSTICK_Y"}}}},i.profileId="microsoft-mixed-reality",i}return(0,oe.ZT)(t,e),t.prototype._getFilenameAndPath=function(){return{filename:"left"===this.handedness?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,path:t.MODEL_BASE_URL+"default/"}},t.prototype._getModelLoadingConstraints=function(){var e=ut.n.IsPluginForExtensionAvailable(".glb");return e||ye.Y.Warn("glTF / glb loaded was not registered, using generic controller instead"),e},t.prototype._processLoadedModel=function(e){var t=this;this.rootMesh&&(this.getComponentIds().forEach((function(e,r){if(!t.disableAnimation&&e&&t.rootMesh){var n=t._mapping.buttons[e],i=n.rootNodeName;if(!i)return void ye.Y.Log("Skipping unknown button at index: "+r+" with mapped name: "+e);var o=t._getChildByName(t.rootMesh,i);if(!o)return void ye.Y.Warn("Missing button mesh with name: "+i);if(n.valueMesh=t._getImmediateChildByName(o,t._mapping.defaultButton.valueNodeName),n.pressedMesh=t._getImmediateChildByName(o,t._mapping.defaultButton.pressedNodeName),n.unpressedMesh=t._getImmediateChildByName(o,t._mapping.defaultButton.unpressedNodeName),n.valueMesh&&n.pressedMesh&&n.unpressedMesh){var s=t.getComponent(e);s&&s.onButtonStateChangedObservable.add((function(e){t._lerpTransform(n,e.value)}),void 0,!0)}else ye.Y.Warn("Missing button submesh under mesh with name: "+i)}})),this.getComponentIds().forEach((function(e){var r=t.getComponent(e);r.isAxes()&&["x-axis","y-axis"].forEach((function(n){if(t.rootMesh){var i=t._mapping.axes[e][n],o=t._getChildByName(t.rootMesh,i.rootNodeName);o?(i.valueMesh=t._getImmediateChildByName(o,t._mapping.defaultAxis.valueNodeName),i.minMesh=t._getImmediateChildByName(o,t._mapping.defaultAxis.minNodeName),i.maxMesh=t._getImmediateChildByName(o,t._mapping.defaultAxis.maxNodeName),i.valueMesh&&i.minMesh&&i.maxMesh?r&&r.onAxisValueChangedObservable.add((function(e){var r="x-axis"===n?e.x:e.y;t._lerpTransform(i,r,!0)}),void 0,!0):ye.Y.Warn("Missing axis submesh under mesh with name: "+i.rootNodeName)):ye.Y.Warn("Missing axis mesh with name: "+i.rootNodeName)}}))})))},t.prototype._setRootMesh=function(e){var t;this.rootMesh=new ht.Kj(this.profileId+" "+this.handedness,this.scene),this.rootMesh.isPickable=!1;for(var r=0;r<e.length;r++){var n=e[r];n.isPickable=!1,n.parent||(t=n)}t&&t.setParent(this.rootMesh),this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=ae._f.FromEulerAngles(0,Math.PI,0))},t.prototype._updateModel=function(){},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t}(ot.d);st.V.RegisterController("windows-mixed-reality",(function(e,t){return new dt(t,e.gamepad,e.handedness)}));var pt={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{xr_standard_trigger_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_trigger_pressed_value",minNodeName:"xr_standard_trigger_pressed_min",maxNodeName:"xr_standard_trigger_pressed_max"}}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{xr_standard_squeeze_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_squeeze_pressed_value",minNodeName:"xr_standard_squeeze_pressed_min",maxNodeName:"xr_standard_squeeze_pressed_max"}}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{xr_standard_touchpad_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_pressed_value",minNodeName:"xr_standard_touchpad_pressed_min",maxNodeName:"xr_standard_touchpad_pressed_max"},xr_standard_touchpad_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_pressed_value",minNodeName:"xr_standard_touchpad_xaxis_pressed_min",maxNodeName:"xr_standard_touchpad_xaxis_pressed_max"},xr_standard_touchpad_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_pressed_value",minNodeName:"xr_standard_touchpad_yaxis_pressed_min",maxNodeName:"xr_standard_touchpad_yaxis_pressed_max"},xr_standard_touchpad_xaxis_touched:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_xaxis_touched_value",minNodeName:"xr_standard_touchpad_xaxis_touched_min",maxNodeName:"xr_standard_touchpad_xaxis_touched_max"},xr_standard_touchpad_yaxis_touched:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_touchpad_yaxis_touched_value",minNodeName:"xr_standard_touchpad_yaxis_touched_min",maxNodeName:"xr_standard_touchpad_yaxis_touched_max"},xr_standard_touchpad_axes_touched:{componentProperty:"state",states:["touched","pressed"],valueNodeProperty:"visibility",valueNodeName:"xr_standard_touchpad_axes_touched_value"}},touchPointNodeName:"xr_standard_touchpad_axes_touched_value"},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{xr_standard_thumbstick_pressed:{componentProperty:"button",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_pressed_value",minNodeName:"xr_standard_thumbstick_pressed_min",maxNodeName:"xr_standard_thumbstick_pressed_max"},xr_standard_thumbstick_xaxis_pressed:{componentProperty:"xAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_xaxis_pressed_value",minNodeName:"xr_standard_thumbstick_xaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_xaxis_pressed_max"},xr_standard_thumbstick_yaxis_pressed:{componentProperty:"yAxis",states:["default","touched","pressed"],valueNodeProperty:"transform",valueNodeName:"xr_standard_thumbstick_yaxis_pressed_value",minNodeName:"xr_standard_thumbstick_yaxis_pressed_min",maxNodeName:"xr_standard_thumbstick_yaxis_pressed_max"}}}},gamepadMapping:"xr-standard",rootNodeName:"microsoft-mixed-reality-right",assetPath:"right.glb"}},_t=function(e){function t(t,r,n,i,o){void 0===i&&(i=!1),void 0===o&&(o=!1);var s=e.call(this,t,ft[n],r,n)||this;return s._forceLegacyControllers=o,s.profileId="oculus-touch",s}return(0,oe.ZT)(t,e),t.prototype._getFilenameAndPath=function(){return{filename:"left"===this.handedness?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,path:this._isQuest()?t.QUEST_MODEL_BASE_URL:t.MODEL_BASE_URL}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){var t=this,r=this._isQuest(),n="right"===this.handedness?-1:1;this.getComponentIds().forEach((function(e){var i=e&&t.getComponent(e);i&&i.onButtonStateChangedObservable.add((function(i){if(t.rootMesh&&!t.disableAnimation)switch(e){case"xr-standard-trigger":return void(r||(t._modelRootNode.getChildren()[3].rotation.x=.2*-i.value,t._modelRootNode.getChildren()[3].position.y=.005*-i.value,t._modelRootNode.getChildren()[3].position.z=.005*-i.value));case"xr-standard-squeeze":return void(r||(t._modelRootNode.getChildren()[4].position.x=n*i.value*.0035));case"xr-standard-thumbstick":return;case"a-button":case"x-button":return void(r||(i.pressed?t._modelRootNode.getChildren()[1].position.y=-.001:t._modelRootNode.getChildren()[1].position.y=0));case"b-button":case"y-button":return void(r||(i.pressed?t._modelRootNode.getChildren()[2].position.y=-.001:t._modelRootNode.getChildren()[2].position.y=0))}}),void 0,!0)}))},t.prototype._setRootMesh=function(e){this.rootMesh=new ht.Kj(this.profileId+" "+this.handedness,this.scene),this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=ae._f.FromEulerAngles(0,Math.PI,0)),e.forEach((function(e){e.isPickable=!1})),this._isQuest()?this._modelRootNode=e[0]:(this._modelRootNode=e[1],this.rootMesh.position.y=.034,this.rootMesh.position.z=.052),this._modelRootNode.parent=this.rootMesh},t.prototype._updateModel=function(){},t.prototype._isQuest=function(){return!!navigator.userAgent.match(/Quest/gi)&&!this._forceLegacyControllers},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",t}(ot.d);st.V.RegisterController("oculus-touch",(function(e,t){return new _t(t,e.gamepad,e.handedness)})),st.V.RegisterController("oculus-touch-legacy",(function(e,t){return new _t(t,e.gamepad,e.handedness,!0)}));var ft={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"x-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"x_button",visualResponses:{}},"y-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"y_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-left",assetPath:"left.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-thumbstick":{type:"thumbstick",gamepadIndices:{button:3,xAxis:2,yAxis:3},rootNodeName:"xr_standard_thumbstick",visualResponses:{}},"a-button":{type:"button",gamepadIndices:{button:4},rootNodeName:"a_button",visualResponses:{}},"b-button":{type:"button",gamepadIndices:{button:5},rootNodeName:"b_button",visualResponses:{}},thumbrest:{type:"button",gamepadIndices:{button:6},rootNodeName:"thumbrest",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"oculus-touch-v2-right",assetPath:"right.glb"}},mt=function(e){function t(t,r,n){var i=e.call(this,t,gt[n],r,n)||this;return i.profileId="htc-vive",i}return(0,oe.ZT)(t,e),t.prototype._getFilenameAndPath=function(){return{filename:t.MODEL_FILENAME,path:t.MODEL_BASE_URL}},t.prototype._getModelLoadingConstraints=function(){return!0},t.prototype._processLoadedModel=function(e){var t=this;this.getComponentIds().forEach((function(e){var r=e&&t.getComponent(e);r&&r.onButtonStateChangedObservable.add((function(r){if(t.rootMesh&&!t.disableAnimation)switch(e){case"xr-standard-trigger":return void(t._modelRootNode.getChildren()[6].rotation.x=.15*-r.value);case"xr-standard-touchpad":case"xr-standard-squeeze":return}}),void 0,!0)}))},t.prototype._setRootMesh=function(e){this.rootMesh=new ht.Kj(this.profileId+" "+this.handedness,this.scene),e.forEach((function(e){e.isPickable=!1})),this._modelRootNode=e[1],this._modelRootNode.parent=this.rootMesh,this.scene.useRightHandedSystem||(this.rootMesh.rotationQuaternion=ae._f.FromEulerAngles(0,Math.PI,0))},t.prototype._updateModel=function(){},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(ot.d);st.V.RegisterController("htc-vive",(function(e,t){return new mt(t,e.gamepad,e.handedness)}));var gt={left:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},right:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc_vive_none",assetPath:"none.glb"},none:{selectComponentId:"xr-standard-trigger",components:{"xr-standard-trigger":{type:"trigger",gamepadIndices:{button:0},rootNodeName:"xr_standard_trigger",visualResponses:{}},"xr-standard-squeeze":{type:"squeeze",gamepadIndices:{button:1},rootNodeName:"xr_standard_squeeze",visualResponses:{}},"xr-standard-touchpad":{type:"touchpad",gamepadIndices:{button:2,xAxis:0,yAxis:1},rootNodeName:"xr_standard_touchpad",visualResponses:{}},menu:{type:"button",gamepadIndices:{button:4},rootNodeName:"menu",visualResponses:{}}},gamepadMapping:"xr-standard",rootNodeName:"htc-vive-none",assetPath:"none.glb"}},vt=r(18786),yt=r(97001),bt=r(49576),Rt=function(){function e(e){var t=this;this._nativeImpl=e,this._xrTransform=new XRRigidTransform,this._xrPose={transform:this._xrTransform,emulatedPosition:!1},this._xrPoseVectorData=new Float32Array(8),this.fillPoses=this._nativeImpl.fillPoses.bind(this._nativeImpl),this.getViewerPose=this._nativeImpl.getViewerPose.bind(this._nativeImpl),this.getHitTestResults=this._nativeImpl.getHitTestResults.bind(this._nativeImpl),this.getHitTestResultsForTransientInput=function(){throw new Error("XRFrame.getHitTestResultsForTransientInput not supported on native.")},this.createAnchor=this._nativeImpl.createAnchor.bind(this._nativeImpl),this.getJointPose=this._nativeImpl.getJointPose.bind(this._nativeImpl),this.fillJointRadii=this._nativeImpl.fillJointRadii.bind(this._nativeImpl),this.getLightEstimate=function(){throw new Error("XRFrame.getLightEstimate not supported on native.")},this.getImageTrackingResults=function(){var e;return null!==(e=t._nativeImpl._imageTrackingResults)&&void 0!==e?e:[]}}return Object.defineProperty(e.prototype,"session",{get:function(){return this._nativeImpl.session},enumerable:!1,configurable:!0}),e.prototype.getPose=function(e,t){if(this._nativeImpl.getPoseData(e,t,this._xrPoseVectorData.buffer,this._xrTransform.matrix.buffer)){var r=this._xrTransform.position;r.x=this._xrPoseVectorData[0],r.y=this._xrPoseVectorData[1],r.z=this._xrPoseVectorData[2],r.w=this._xrPoseVectorData[3];var n=this._xrTransform.orientation;return n.x=this._xrPoseVectorData[4],n.y=this._xrPoseVectorData[5],n.z=this._xrPoseVectorData[6],n.w=this._xrPoseVectorData[7],this._xrPose}},Object.defineProperty(e.prototype,"trackedAnchors",{get:function(){return this._nativeImpl.trackedAnchors},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldInformation",{get:function(){return this._nativeImpl.worldInformation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"detectedPlanes",{get:function(){return this._nativeImpl.detectedPlanes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"featurePointCloud",{get:function(){return this._nativeImpl.featurePointCloud},enumerable:!1,configurable:!0}),e}();(0,bt.Oz)("NativeXRFrame",Rt);var Ct=r(77840)},17834:(e,t,r)=>{r.d(t,{N:()=>h});var n=r(31191),i=r(58095),o=r(96969),s=r(62897),a=r(15210),l=r(77851),c=function(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new s.y$,this._onClonedObservable=new s.y$},h=function(){function e(e,t){void 0===t&&(t=null),this._isDirty=!1,this._nodeDataStorage=new c,this.state="",this.metadata=null,this.reservedDataStore=null,this._parentContainer=null,this.animations=new Array,this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=i.y3.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new s.y$,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||a.l.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return e.AddNodeConstructor=function(e,t){this._NodeConstructors[e]=t},e.Construct=function(e,t,r,n){var i=this._NodeConstructors[e];return i?i(t,r,n):null},Object.defineProperty(e.prototype,"doNotSerialize",{get:function(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(e){this._nodeDataStorage._doNotSerialize=e},enumerable:!1,configurable:!0}),e.prototype.isDisposed=function(){return this._nodeDataStorage._isDisposed},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){var t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var r=this._parentNode._children.indexOf(this);-1!==r&&this._parentNode._children.splice(r,1),e||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!1,configurable:!0}),e.prototype._addToSceneRootNodes=function(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},e.prototype._removeFromSceneRootNodes=function(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){var e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}},Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"Node"},Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onEnabledStateChangedObservable",{get:function(){return this._nodeDataStorage._onEnabledStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onClonedObservable",{get:function(){return this._nodeDataStorage._onClonedObservable},enumerable:!1,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._scene.getEngine()},e.prototype.addBehavior=function(e,t){var r=this;return void 0===t&&(t=!1),-1!==this._behaviors.indexOf(e)||(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce((function(){e.attach(r)})):e.attach(this),this._behaviors.push(e)),this},e.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this},Object.defineProperty(e.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!1,configurable:!0}),e.prototype.getBehaviorByName=function(e){for(var t=0,r=this._behaviors;t<r.length;t++){var n=r[t];if(n.name===e)return n}return null},e.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},e.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(e.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!1,configurable:!0}),e.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},e.prototype.updateCache=function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},e.prototype._getActionManagerForTrigger=function(e,t){return void 0===t&&(t=!0),this.parent?this.parent._getActionManagerForTrigger(e,!1):null},e.prototype._updateCache=function(e){},e.prototype._isSynchronized=function(){return!0},e.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},e.prototype.isSynchronizedWithParent=function(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},e.prototype.isSynchronized=function(){return this._cache.parent!==this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},e.prototype.isReady=function(e){return void 0===e&&(e=!1),this._nodeDataStorage._isReady},e.prototype.markAsDirty=function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},e.prototype.isEnabled=function(e){return void 0===e&&(e=!0),!1===e?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled},e.prototype._syncParentEnabledState=function(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((function(e){e._syncParentEnabledState()}))},e.prototype.setEnabled=function(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e),this._syncParentEnabledState())},e.prototype.isDescendantOf=function(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))},e.prototype._getDescendants=function(e,t,r){if(void 0===t&&(t=!1),this._children)for(var n=0;n<this._children.length;n++){var i=this._children[n];r&&!r(i)||e.push(i),t||i._getDescendants(e,!1,r)}},e.prototype.getDescendants=function(e,t){var r=new Array;return this._getDescendants(r,e,t),r},e.prototype.getChildMeshes=function(e,t){var r=[];return this._getDescendants(r,e,(function(e){return(!t||t(e))&&void 0!==e.cullingStrategy})),r},e.prototype.getChildren=function(e,t){return void 0===t&&(t=!0),this.getDescendants(t,e)},e.prototype._setReady=function(e){e!==this._nodeDataStorage._isReady&&(e?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)},e.prototype.getAnimationByName=function(e){for(var t=0;t<this.animations.length;t++){var r=this.animations[t];if(r.name===e)return r}return null},e.prototype.createAnimationRange=function(t,r,n){if(!this._ranges[t]){this._ranges[t]=e._AnimationRangeFactory(t,r,n);for(var i=0,o=this.animations.length;i<o;i++)this.animations[i]&&this.animations[i].createRange(t,r,n)}},e.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var r=0,n=this.animations.length;r<n;r++)this.animations[r]&&this.animations[r].deleteRange(e,t);this._ranges[e]=null},e.prototype.getAnimationRange=function(e){return this._ranges[e]||null},e.prototype.getAnimationRanges=function(){var e,t=[];for(e in this._ranges)t.push(this._ranges[e]);return t},e.prototype.beginAnimation=function(e,t,r,n){var i=this.getAnimationRange(e);return i?this._scene.beginAnimation(this,i.from,i.to,t,r,n):null},e.prototype.serializeAnimationRanges=function(){var e=[];for(var t in this._ranges){var r=this._ranges[t];if(r){var n={};n.name=t,n.from=r.from,n.to=r.to,e.push(n)}}return e},e.prototype.computeWorldMatrix=function(e){return this._worldMatrix||(this._worldMatrix=i.y3.Identity()),this._worldMatrix},e.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),this._nodeDataStorage._isDisposed=!0,!e)for(var r=0,n=this.getDescendants(!0);r<n.length;r++){n[r].dispose(e,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(var i=0,o=this._behaviors;i<o.length;i++){o[i].detach()}this._behaviors=[],this.metadata=null},e.ParseAnimationRanges=function(e,t,r){if(t.ranges)for(var n=0;n<t.ranges.length;n++){var i=t.ranges[n];e.createAnimationRange(i.name,i.from,i.to)}},e.prototype.getHierarchyBoundingVectors=function(e,t){var r,n;void 0===e&&(e=!0),void 0===t&&(t=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var o=this;if(o.getBoundingInfo&&o.subMeshes){var s=o.getBoundingInfo();r=s.boundingBox.minimumWorld.clone(),n=s.boundingBox.maximumWorld.clone()}else r=new i.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e)for(var a=0,l=this.getDescendants(!1);a<l.length;a++){var c=l[a];if(c.computeWorldMatrix(!0),(!t||t(c))&&c.getBoundingInfo&&0!==c.getTotalVertices()){var h=c.getBoundingInfo().boundingBox,u=h.minimumWorld,d=h.maximumWorld;i.P.CheckExtends(u,r,n),i.P.CheckExtends(d,r,n)}}return{min:r,max:n}},e._AnimationRangeFactory=function(e,t,r){throw(0,l.S)("AnimationRange")},e._NodeConstructors={},(0,n.gn)([(0,o.qC)()],e.prototype,"name",void 0),(0,n.gn)([(0,o.qC)()],e.prototype,"id",void 0),(0,n.gn)([(0,o.qC)()],e.prototype,"uniqueId",void 0),(0,n.gn)([(0,o.qC)()],e.prototype,"state",void 0),(0,n.gn)([(0,o.qC)()],e.prototype,"metadata",void 0),e}()},65273:(e,t,r)=>{r.d(t,{x:()=>A});var n=r(31191),i=r(13514),o=r(29945),s=r(62897),a=r(7788),l=r(45008),c=r(20163),h=r(58095),u=r(57755),d=r(90622),p=r(83353),_=r(5292),f=r(23954),m=r(1421),g=r(70235),v=r(85627),y=r(80352),b=r(15210),R=r(77851),C=r(55526),M=r(82577),x=r(15631),P=r(84319),T=r(46310),S=r(79245),E=r(51011),I=r(1233),A=function(e){function t(r,i){var o=e.call(this)||this;o._inputManager=new C.$(o),o.cameraToUseForPointers=null,o._isScene=!0,o._blockEntityCollection=!1,o.autoClear=!0,o.autoClearDepthAndStencil=!0,o.clearColor=new x.HE(.2,.2,.3,1),o.ambientColor=new x.Wo(0,0,0),o.environmentIntensity=1,o._forceWireframe=!1,o._skipFrustumClipping=!1,o._forcePointsCloud=!1,o.animationsEnabled=!0,o._animationPropertiesOverride=null,o.useConstantAnimationDeltaTime=!1,o.constantlyUpdateMeshUnderPointer=!1,o.hoverCursor="pointer",o.defaultCursor="",o.doNotHandleCursors=!1,o.preventDefaultOnPointerDown=!0,o.preventDefaultOnPointerUp=!0,o.metadata=null,o.reservedDataStore=null,o.disableOfflineSupportExceptionRules=new Array,o.onDisposeObservable=new s.y$,o._onDisposeObserver=null,o.onBeforeRenderObservable=new s.y$,o._onBeforeRenderObserver=null,o.onAfterRenderObservable=new s.y$,o.onAfterRenderCameraObservable=new s.y$,o._onAfterRenderObserver=null,o.onBeforeAnimationsObservable=new s.y$,o.onAfterAnimationsObservable=new s.y$,o.onBeforeDrawPhaseObservable=new s.y$,o.onAfterDrawPhaseObservable=new s.y$,o.onReadyObservable=new s.y$,o.onBeforeCameraRenderObservable=new s.y$,o._onBeforeCameraRenderObserver=null,o.onAfterCameraRenderObservable=new s.y$,o._onAfterCameraRenderObserver=null,o.onBeforeActiveMeshesEvaluationObservable=new s.y$,o.onAfterActiveMeshesEvaluationObservable=new s.y$,o.onBeforeParticlesRenderingObservable=new s.y$,o.onAfterParticlesRenderingObservable=new s.y$,o.onDataLoadedObservable=new s.y$,o.onNewCameraAddedObservable=new s.y$,o.onCameraRemovedObservable=new s.y$,o.onNewLightAddedObservable=new s.y$,o.onLightRemovedObservable=new s.y$,o.onNewGeometryAddedObservable=new s.y$,o.onGeometryRemovedObservable=new s.y$,o.onNewTransformNodeAddedObservable=new s.y$,o.onTransformNodeRemovedObservable=new s.y$,o.onNewMeshAddedObservable=new s.y$,o.onMeshRemovedObservable=new s.y$,o.onNewSkeletonAddedObservable=new s.y$,o.onSkeletonRemovedObservable=new s.y$,o.onNewMaterialAddedObservable=new s.y$,o.onNewMultiMaterialAddedObservable=new s.y$,o.onMaterialRemovedObservable=new s.y$,o.onMultiMaterialRemovedObservable=new s.y$,o.onNewTextureAddedObservable=new s.y$,o.onTextureRemovedObservable=new s.y$,o.onBeforeRenderTargetsRenderObservable=new s.y$,o.onAfterRenderTargetsRenderObservable=new s.y$,o.onBeforeStepObservable=new s.y$,o.onAfterStepObservable=new s.y$,o.onActiveCameraChanged=new s.y$,o.onBeforeRenderingGroupObservable=new s.y$,o.onAfterRenderingGroupObservable=new s.y$,o.onMeshImportedObservable=new s.y$,o.onAnimationFileImportedObservable=new s.y$,o._registeredForLateAnimationBindings=new a.f(256),o.skipPointerMovePicking=!1,o.skipPointerDownPicking=!1,o.skipPointerUpPicking=!1,o.onPrePointerObservable=new s.y$,o.onPointerObservable=new s.y$,o.onPreKeyboardObservable=new s.y$,o.onKeyboardObservable=new s.y$,o._useRightHandedSystem=!1,o._timeAccumulator=0,o._currentStepId=0,o._currentInternalStep=0,o._fogEnabled=!0,o._fogMode=t.FOGMODE_NONE,o.fogColor=new x.Wo(.2,.2,.3),o.fogDensity=.1,o.fogStart=0,o.fogEnd=1e3,o.needsPreviousWorldMatrices=!1,o._shadowsEnabled=!0,o._lightsEnabled=!0,o.activeCameras=new Array,o._texturesEnabled=!0,o.physicsEnabled=!0,o.particlesEnabled=!0,o.spritesEnabled=!0,o._skeletonsEnabled=!0,o.lensFlaresEnabled=!0,o.collisionsEnabled=!0,o.gravity=new h.P(0,-9.807,0),o.postProcessesEnabled=!0,o.renderTargetsEnabled=!0,o.dumpNextRenderTargets=!1,o.customRenderTargets=new Array,o.importedMeshesFiles=new Array,o.probesEnabled=!0,o._meshesForIntersections=new a.f(256),o.proceduralTexturesEnabled=!0,o._totalVertices=new M.z,o._activeIndices=new M.z,o._activeParticles=new M.z,o._activeBones=new M.z,o._animationTime=0,o.animationTimeScale=1,o._renderId=0,o._frameId=0,o._executeWhenReadyTimeoutId=null,o._intermediateRendering=!1,o._defaultFrameBufferCleared=!1,o._viewUpdateFlag=-1,o._projectionUpdateFlag=-1,o._toBeDisposed=new Array(256),o._activeRequests=new Array,o._pendingData=new Array,o._isDisposed=!1,o.dispatchAllSubMeshesOfActiveMeshes=!1,o._activeMeshes=new a.t(256),o._processedMaterials=new a.t(256),o._renderTargets=new a.f(256),o._materialsRenderTargets=new a.f(256),o._activeParticleSystems=new a.t(256),o._activeSkeletons=new a.f(32),o._softwareSkinnedMeshes=new a.f(32),o._activeAnimatables=new Array,o._transformMatrix=h.y3.Zero(),o.requireLightSorting=!1,o._components=[],o._serializableComponents=[],o._transientComponents=[],o._beforeCameraUpdateStage=v.H.Create(),o._beforeClearStage=v.H.Create(),o._beforeRenderTargetClearStage=v.H.Create(),o._gatherRenderTargetsStage=v.H.Create(),o._gatherActiveCameraRenderTargetsStage=v.H.Create(),o._isReadyForMeshStage=v.H.Create(),o._beforeEvaluateActiveMeshStage=v.H.Create(),o._evaluateSubMeshStage=v.H.Create(),o._preActiveMeshStage=v.H.Create(),o._cameraDrawRenderTargetStage=v.H.Create(),o._beforeCameraDrawStage=v.H.Create(),o._beforeRenderTargetDrawStage=v.H.Create(),o._beforeRenderingGroupDrawStage=v.H.Create(),o._beforeRenderingMeshStage=v.H.Create(),o._afterRenderingMeshStage=v.H.Create(),o._afterRenderingGroupDrawStage=v.H.Create(),o._afterCameraDrawStage=v.H.Create(),o._afterRenderTargetDrawStage=v.H.Create(),o._afterRenderStage=v.H.Create(),o._pointerMoveStage=v.H.Create(),o._pointerDownStage=v.H.Create(),o._pointerUpStage=v.H.Create(),o._geometriesByUniqueId=null,o._defaultMeshCandidates={data:[],length:0},o._defaultSubMeshCandidates={data:[],length:0},o._preventFreeActiveMeshesAndRenderingGroups=!1,o._activeMeshesFrozen=!1,o._activeMeshesFrozenButKeepClipping=!1,o._skipEvaluateActiveMeshesCompletely=!1,o._allowPostProcessClearColor=!0,o.getDeterministicFrameTime=function(){return o._engine.getTimeStep()},o._blockMaterialDirtyMechanism=!1,o._perfCollector=null,o.onComputePressureChanged=new s.y$;var l=(0,n.pi)({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},i);return o._engine=r||b.l.LastCreatedEngine,l.virtual?o._engine._virtualScenes.push(o):(b.l._LastCreatedScene=o,o._engine.scenes.push(o)),o._uid=null,o._renderingManager=new g.$(o),m.O&&(o.postProcessManager=new m.O(o)),(0,y.CG)()&&o.attachControl(),o._createUbo(),d.$&&(o._imageProcessingConfiguration=new d.$),o.setDefaultCandidateProviders(),l.useGeometryUniqueIdsMap&&(o._geometriesByUniqueId={}),o.useMaterialMeshMap=l.useMaterialMeshMap,o.useClonedMeshMap=l.useClonedMeshMap,i&&i.virtual||o._engine.onNewSceneAddedObservable.notifyObservers(o),I.D.IsAvailable&&(o._computePressureObserver=new I.D((function(e){o.onComputePressureChanged.notifyObservers(e)}),{cpuUtilizationThresholds:[.25,.5,.75,.9],cpuSpeedThresholds:[.5]}),o._computePressureObserver.observe()),o}return(0,n.ZT)(t,e),t.DefaultMaterialFactory=function(e){throw(0,R.S)("StandardMaterial")},t.CollisionCoordinatorFactory=function(){throw(0,R.S)("DefaultCollisionCoordinator")},Object.defineProperty(t.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DragMovementThreshold",{get:function(){return C.$.DragMovementThreshold},set:function(e){C.$.DragMovementThreshold=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LongPressDelay",{get:function(){return C.$.LongPressDelay},set:function(e){C.$.LongPressDelay=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DoubleClickDelay",{get:function(){return C.$.DoubleClickDelay},set:function(e){C.$.DoubleClickDelay=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ExclusiveDoubleClickMode",{get:function(){return C.$.ExclusiveDoubleClickMode},set:function(e){C.$.ExclusiveDoubleClickMode=e},enumerable:!1,configurable:!0}),t.prototype.bindEyePosition=function(e,t,r){var n;void 0===t&&(t="vEyePosition"),void 0===r&&(r=!1);var i=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:null!==(n=this.activeCamera.globalPosition)&&void 0!==n?n:this.activeCamera.devicePosition,o=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return h.jp.Vector4[0].set(i.x,i.y,i.z,o?-1:1),e&&(r?e.setFloat3(t,h.jp.Vector4[0].x,h.jp.Vector4[0].y,h.jp.Vector4[0].z):e.setVector4(t,h.jp.Vector4[0])),h.jp.Vector4[0]},t.prototype.finalizeSceneUbo=function(){var e=this.getSceneUniformBuffer(),t=this.bindEyePosition(null);return e.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),e.update(),e},Object.defineProperty(t.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),t.prototype.setStepId=function(e){this._currentStepId=e},t.prototype.getStepId=function(){return this._currentStepId},t.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(t.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fogMode",{get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"prePass",{get:function(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=t.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=t.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),t.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var e=0,t=this._transientComponents;e<t.length;e++){t[e].register()}this._transientComponents=[]}},t.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e);var t=e;t.addFromContainer&&t.serialize&&this._serializableComponents.push(t)},t.prototype._getComponent=function(e){for(var t=0,r=this._components;t<r.length;t++){var n=r[t];if(n.name===e)return n}return null},t.prototype.getClassName=function(){return"Scene"},t.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},t.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},t.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(e){this._inputManager.pointerX=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(e){this._inputManager.pointerY=e},enumerable:!1,configurable:!0}),t.prototype.getCachedMaterial=function(){return this._cachedMaterial},t.prototype.getCachedEffect=function(){return this._cachedEffect},t.prototype.getCachedVisibility=function(){return this._cachedVisibility},t.prototype.isCachedMaterialInvalid=function(e,t,r){return void 0===r&&(r=1),this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==r},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(t.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),t.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(t.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),t.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(t.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),t.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(t.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},t.prototype.getRenderId=function(){return this._renderId},t.prototype.getFrameId=function(){return this._frameId},t.prototype.incrementRenderId=function(){this._renderId++},t.prototype._createUbo=function(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())},t.prototype.simulatePointerMove=function(e,t){return this._inputManager.simulatePointerMove(e,t),this},t.prototype.simulatePointerDown=function(e,t){return this._inputManager.simulatePointerDown(e,t),this},t.prototype.simulatePointerUp=function(e,t,r){return this._inputManager.simulatePointerUp(e,t,r),this},t.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._inputManager.isPointerCaptured(e)},t.prototype.attachControl=function(e,t,r){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===r&&(r=!0),this._inputManager.attachControl(e,t,r)},t.prototype.detachControl=function(){this._inputManager.detachControl()},t.prototype.isReady=function(e){if(void 0===e&&(e=!0),this._isDisposed)return!1;var t,r=this.getEngine(),n=!0;for(this._pendingData.length>0&&(n=!1),e&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),t=0;t<this.meshes.length;t++){var i=this.meshes[t];if(i.subMeshes&&0!==i.subMeshes.length)if(i.isReady(!0)){for(var o=i.hasThinInstances||"InstancedMesh"===i.getClassName()||"InstancedLinesMesh"===i.getClassName()||r.getCaps().instancedArrays&&i.instances.length>0,s=0,a=this._isReadyForMeshStage;s<a.length;s++){a[s].action(i,o)||(n=!1)}if(e){var l=i.material||this.defaultMaterial;if(l)if(l._storeEffectOnSubMeshes)for(var c=0,h=i.subMeshes;c<h.length;c++){var u=h[c].getMaterial();u&&u.hasRenderTargetTextures&&null!=u.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(u)&&(this._processedMaterials.push(u),this._materialsRenderTargets.concatWithNoDuplicate(u.getRenderTargetTextures()))}else l.hasRenderTargetTextures&&null!=l.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(l)&&(this._processedMaterials.push(l),this._materialsRenderTargets.concatWithNoDuplicate(l.getRenderTargetTextures()))}}else n=!1}if(!n)return!1;if(!r.areAllEffectsReady())return!1;if(e)for(t=0;t<this._materialsRenderTargets.length;++t){if(!this._materialsRenderTargets.data[t].isReadyForRendering())return!1}for(t=0;t<this.geometries.length;t++){if(2===this.geometries[t].delayLoadState)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var d=0,p=this.activeCameras;d<p.length;d++){if(!p[d].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var _=0,f=this.particleSystems;_<f.length;_++){if(!f[_].isReady())return!1}return!0},t.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},t.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},t.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},t.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},t.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},t.prototype._executeOnceBeforeRender=function(e){var t=this,r=function(){e(),setTimeout((function(){t.unregisterBeforeRender(r)}))};this.registerBeforeRender(r)},t.prototype.executeOnceBeforeRender=function(e,t){var r=this;void 0!==t?setTimeout((function(){r._executeOnceBeforeRender(e)}),t):this._executeOnceBeforeRender(e)},t.prototype._addPendingData=function(e){this._pendingData.push(e)},t.prototype._removePendingData=function(e){var t=this.isLoading,r=this._pendingData.indexOf(e);-1!==r&&this._pendingData.splice(r,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),t.prototype.executeWhenReady=function(e,t){void 0===t&&(t=!1),this.onReadyObservable.add(e),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(t)},t.prototype.whenReadyAsync=function(e){var t=this;return void 0===e&&(e=!1),new Promise((function(r){t.executeWhenReady((function(){r()}),e)}))},t.prototype._checkIsReady=function(e){var t=this;return void 0===e&&(e=!1),this._registerTransientComponents(),this.isReady(e)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((function(){t._checkIsReady(e)}),100))},Object.defineProperty(t.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),t.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=o.F.Now},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(e,t,r,n){r||n||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?P.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=P.i.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(r,n):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))},t.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},t.prototype.createSceneUniformBuffer=function(e){var t=new p.M(this._engine,void 0,!1,null!=e?e:"scene");return t.addUniform("viewProjection",16),t.addUniform("view",16),t.addUniform("projection",16),t.addUniform("vEyePosition",4),t},t.prototype.setSceneUniformBuffer=function(e){this._sceneUbo=e,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1},t.prototype.getUniqueId=function(){return T.K.UniqueId},t.prototype.addMesh=function(e,t){var r=this;void 0===t&&(t=!1),this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((function(e){r.addMesh(e)})))},t.prototype.removeMesh=function(e,t){var r=this;void 0===t&&(t=!1);var n=this.meshes.indexOf(e);return-1!==n&&(this.meshes[n]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(e),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((function(e){r.removeMesh(e)})),n},t.prototype.addTransformNode=function(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneTransformNodesArray||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))},t.prototype.removeTransformNode=function(e){var t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){var r=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=r,r._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t},t.prototype.removeSkeleton=function(e){var t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e),this._executeActiveContainerCleanup(this._activeSkeletons)),t},t.prototype.removeMorphTargetManager=function(e){var t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t},t.prototype.removeLight=function(e){var t=this.lights.indexOf(e);if(-1!==t){for(var r=0,n=this.meshes;r<n.length;r++){n[r]._removeLightSource(e,!1)}this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t},t.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);if(-1!==t&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){var r=this.activeCameras.indexOf(e);-1!==r&&this.activeCameras.splice(r,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t},t.prototype.removeParticleSystem=function(e){var t=this.particleSystems.indexOf(e);return-1!==t&&(this.particleSystems.splice(t,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),t},t.prototype.removeAnimation=function(e){var t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t},t.prototype.stopAnimation=function(e,t,r){},t.prototype.removeAnimationGroup=function(e){var t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t},t.prototype.removeMultiMaterial=function(e){var t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),t},t.prototype.removeMaterial=function(e){var t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){var r=this.materials[this.materials.length-1];this.materials[t]=r,r._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t},t.prototype.removeActionManager=function(e){var t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t},t.prototype.removeTexture=function(e){var t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t},t.prototype.addLight=function(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(var t=0,r=this.meshes;t<r.length;t++){var n=r[t];-1===n.lightSources.indexOf(e)&&(n.lightSources.push(e),n._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)}},t.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(E.m.CompareLightsPriority)},t.prototype.addCamera=function(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())},t.prototype.addSkeleton=function(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))},t.prototype.addParticleSystem=function(e){this._blockEntityCollection||this.particleSystems.push(e)},t.prototype.addAnimation=function(e){this._blockEntityCollection||this.animations.push(e)},t.prototype.addAnimationGroup=function(e){this._blockEntityCollection||this.animationGroups.push(e)},t.prototype.addMultiMaterial=function(e){this._blockEntityCollection||(this.multiMaterials.push(e),this.onNewMultiMaterialAddedObservable.notifyObservers(e))},t.prototype.addMaterial=function(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneMaterialArray||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))},t.prototype.addMorphTargetManager=function(e){this._blockEntityCollection||this.morphTargetManagers.push(e)},t.prototype.addGeometry=function(e){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))},t.prototype.addActionManager=function(e){this.actionManagers.push(e)},t.prototype.addTexture=function(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))},t.prototype.switchActiveCamera=function(e,t){void 0===t&&(t=!0),this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,t&&e.attachControl())},t.prototype.setActiveCameraById=function(e){var t=this.getCameraById(e);return t?(this.activeCamera=t,t):null},t.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},t.prototype.getAnimationGroupByName=function(e){for(var t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null},t.prototype.getMaterialByUniqueID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].uniqueId===e)return this.materials[t];return null},t.prototype.getMaterialById=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},t.prototype.getLastMaterialById=function(e,t){void 0===t&&(t=!1);for(var r=this.materials.length-1;r>=0;r--)if(this.materials[r].id===e)return this.materials[r];if(t)for(r=this.multiMaterials.length-1;r>=0;r--)if(this.multiMaterials[r].id===e)return this.multiMaterials[r];return null},t.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},t.prototype.getTextureByUniqueId=function(e){for(var t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===e)return this.textures[t];return null},t.prototype.getTextureByName=function(e){for(var t=0;t<this.textures.length;t++)if(this.textures[t].name===e)return this.textures[t];return null},t.prototype.getCameraById=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},t.prototype.getCameraByUniqueId=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},t.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},t.prototype.getBoneById=function(e){for(var t=0;t<this.skeletons.length;t++)for(var r=this.skeletons[t],n=0;n<r.bones.length;n++)if(r.bones[n].id===e)return r.bones[n];return null},t.prototype.getBoneByName=function(e){for(var t=0;t<this.skeletons.length;t++)for(var r=this.skeletons[t],n=0;n<r.bones.length;n++)if(r.bones[n].name===e)return r.bones[n];return null},t.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},t.prototype.getLightById=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getLightByUniqueId=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},t.prototype.getParticleSystemById=function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null},t.prototype.getGeometryById=function(e){for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null},t.prototype._getGeometryByUniqueId=function(e){if(this._geometriesByUniqueId){if(void 0!==(t=this._geometriesByUniqueId[e]))return this.geometries[t]}else for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].uniqueId===e)return this.geometries[t];return null},t.prototype.pushGeometry=function(e,t){return!(!t&&this._getGeometryByUniqueId(e.uniqueId))&&(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)},t.prototype.removeGeometry=function(e){var t;if(this._geometriesByUniqueId){if(void 0===(t=this._geometriesByUniqueId[e.uniqueId]))return!1}else if((t=this.geometries.indexOf(e))<0)return!1;if(t!==this.geometries.length-1){var r=this.geometries[this.geometries.length-1];r&&(this.geometries[t]=r,this._geometriesByUniqueId&&(this._geometriesByUniqueId[r.uniqueId]=t,this._geometriesByUniqueId[e.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getMeshById=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getMeshesById=function(e){return this.meshes.filter((function(t){return t.id===e}))},t.prototype.getTransformNodeById=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null},t.prototype.getTransformNodeByUniqueId=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null},t.prototype.getTransformNodesById=function(e){return this.transformNodes.filter((function(t){return t.id===e}))},t.prototype.getMeshByUniqueId=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},t.prototype.getLastMeshById=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getLastEntryById=function(e){var t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getNodeById=function(e){var t=this.getMeshById(e);if(t)return t;var r=this.getTransformNodeById(e);if(r)return r;var n=this.getLightById(e);if(n)return n;var i=this.getCameraById(e);if(i)return i;var o=this.getBoneById(e);return o||null},t.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var r=this.getTransformNodeByName(e);if(r)return r;var n=this.getLightByName(e);if(n)return n;var i=this.getCameraByName(e);if(i)return i;var o=this.getBoneByName(e);return o||null},t.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},t.prototype.getTransformNodeByName=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null},t.prototype.getLastSkeletonById=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByUniqueId=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null},t.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},t.prototype.getMorphTargetManagerById=function(e){for(var t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null},t.prototype.getMorphTargetById=function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var r=this.morphTargetManagers[t],n=0;n<r.numTargets;++n){var i=r.getTarget(n);if(i.id===e)return i}return null},t.prototype.getMorphTargetByName=function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var r=this.morphTargetManagers[t],n=0;n<r.numTargets;++n){var i=r.getTarget(n);if(i.name===e)return i}return null},t.prototype.getPostProcessByName=function(e){for(var t=0;t<this.postProcesses.length;++t){var r=this.postProcesses[t];if(r.name===e)return r}return null},t.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=i.w1.RandomId()),this._uid},enumerable:!1,configurable:!0}),t.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new l.x),this._externalData.add(e,t)},t.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},t.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new l.x),this._externalData.getOrAddWithFactory(e,t)},t.prototype.removeExternalData=function(e){return this._externalData.remove(e)},t.prototype._evaluateSubMesh=function(e,t,r){if(r.hasInstances||r.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){for(var n=0,i=this._evaluateSubMeshStage;n<i.length;n++){i[n].action(t,e)}var o=e.getMaterial();null!=o&&(o.hasRenderTargetTextures&&null!=o.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(o)&&(this._processedMaterials.push(o),this._materialsRenderTargets.concatWithNoDuplicate(o.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,o))}},t.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(t.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)},enumerable:!1,configurable:!0}),t.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}},t.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}},t.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},t.prototype.freezeActiveMeshes=function(e,t,r,n,i){var o=this;return void 0===e&&(e=!1),void 0===n&&(n=!0),void 0===i&&(i=!1),this.executeWhenReady((function(){if(o.activeCamera){if(o._frustumPlanes||o.updateTransformMatrix(),o._evaluateActiveMeshes(),o._activeMeshesFrozen=!0,o._activeMeshesFrozenButKeepClipping=i,o._skipEvaluateActiveMeshesCompletely=e,n)for(var s=0;s<o._activeMeshes.length;s++)o._activeMeshes.data[s]._freeze();t&&t()}else r&&r("No active camera found")})),this},t.prototype.unfreezeActiveMeshes=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this},t.prototype._executeActiveContainerCleanup=function(e){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((function(){return e.dispose()}))},t.prototype._evaluateActiveMeshes=function(){var e;if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)this._activeMeshes.length>0&&(null===(e=this.activeCamera)||void 0===e||e._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset());else if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var t=this._activeMeshes.length,r=0;r<t;r++){(l=this._activeMeshes.data[r]).computeWorldMatrix()}if(this._activeParticleSystems){var n=this._activeParticleSystems.length;for(r=0;r<n;r++)this._activeParticleSystems.data[r].animate()}}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(var i=0,o=this._beforeEvaluateActiveMeshStage;i<o.length;i++){o[i].action()}var s=this.getActiveMeshCandidates(),a=s.length;for(r=0;r<a;r++){var l;if((l=s.data[r])._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!l.isBlocked&&(this._totalVertices.addCount(l.getTotalVertices(),!1),l.isReady()&&l.isEnabled()&&!l.scaling.hasAZeroComponent)){l.computeWorldMatrix(),l.actionManager&&l.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(l);var c=this.customLODSelector?this.customLODSelector(l,this.activeCamera):l.getLOD(this.activeCamera);if(l._internalAbstractMeshDataInfo._currentLOD=c,l._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,null!=c&&(c!==l&&0!==c.billboardMode&&c.computeWorldMatrix(),l._preActivate(),l.isVisible&&l.visibility>0&&0!=(l.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||l.alwaysSelectAsActiveMesh||l.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(l),this.activeCamera._activeMeshes.push(l),c!==l&&c._activate(this._renderId,!1);for(var h=0,u=this._preActiveMeshStage;h<u.length;h++){u[h].action(l)}l._activate(this._renderId,!1)&&(l.isAnInstance?l._internalAbstractMeshDataInfo._actAsRegularMesh&&(c=l):c._internalAbstractMeshDataInfo._onlyForInstances=!1,c._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(l,c)),l._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var d=0;d<this.particleSystems.length;d++){var p=this.particleSystems[d];if(p.isStarted()&&p.emitter){var _=p.emitter;_.position&&!_.isEnabled()||(this._activeParticleSystems.push(p),p.animate(),this._renderingManager.dispatchParticles(p))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},t.prototype._activeMesh=function(e,t){if(this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&(t.skeleton.prepare(),this._activeBones.addCount(t.skeleton.bones.length,!1)),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t)),t&&t.subMeshes&&t.subMeshes.length>0)for(var r=this.getActiveSubMeshCandidates(t),n=r.length,i=0;i<n;i++){var o=r.data[i];this._evaluateSubMesh(o,t,e)}},t.prototype.updateTransformMatrix=function(e){if(this.activeCamera)if(this.activeCamera._renderingMultiview){var t=this.activeCamera._rigCameras[0],r=this.activeCamera._rigCameras[1];this.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(e),r.getViewMatrix(),r.getProjectionMatrix(e))}else this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},t.prototype._bindFrameBuffer=function(e,t){void 0===t&&(t=!0),e&&e._multiviewTexture?e._multiviewTexture._bindFrameBuffer():e&&e.outputRenderTarget?e.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),t&&this._clearFrameBuffer(e)},t.prototype._clearFrameBuffer=function(e){if(e&&e._multiviewTexture);else if(e&&e.outputRenderTarget){var t=e.outputRenderTarget;t.onClearObservable.hasObservers()?t.onClearObservable.notifyObservers(this._engine):t.skipInitialClear||(this._engine.clear(t.clearColor||this.clearColor,!t._cleared,!0,!0),t._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())},t.prototype._renderForCamera=function(e,t,r){var n,o,s;if(void 0===r&&(r=!0),!e||!e._skipRendering){var a=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");if(a.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&r){var l=!0;e._renderingMultiview&&e.outputRenderTarget&&(l=e.outputRenderTarget.skipInitialClear,this.autoClear&&(e.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),e._renderingMultiview&&e.outputRenderTarget&&(e.outputRenderTarget.skipInitialClear=l)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var c=0;c<this._softwareSkinnedMeshes.length;c++){var h=this._softwareSkinnedMeshes.data[c];h.applySkeleton(h.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(var u=0,d=this._gatherActiveCameraRenderTargetsStage;u<d.length;u++){d[u].action(this._renderTargets)}var p=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){i.w1.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var _=0;_<this._renderTargets.length;_++){var f=this._renderTargets.data[_];if(f._shouldRender()){this._renderId++;var m=f.activeCamera&&f.activeCamera!==this.activeCamera;f.render(m,this.dumpNextRenderTargets),p=!0}}i.w1.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var g=0,v=this._cameraDrawRenderTargetStage;g<v.length;g++){p=v[g].action(this.activeCamera)||p}this._intermediateRendering=!1}this._engine.currentRenderPassId=null!==(s=null!==(o=null===(n=e.outputRenderTarget)||void 0===n?void 0:n.renderPassId)&&void 0!==o?o:e.renderPassId)&&void 0!==s?s:0,p&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||e._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(var y=0,b=this._beforeCameraDrawStage;y<b.length;y++){b[y].action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),a.snapshotRendering&&1===a.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var R=0,C=this._afterCameraDrawStage;R<C.length;R++){C[R].action(this.activeCamera)}if(this.postProcessManager&&!e._multiviewTexture){var M=e.outputRenderTarget?e.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,M)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},t.prototype._processSubCameras=function(e,t){if(void 0===t&&(t=!0),0===e.cameraRigMode||e._renderingMultiview)return e._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(e,void 0,t),void this.onAfterRenderCameraObservable.notifyObservers(e);if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else{this.onBeforeCameraRenderObservable.notifyObservers(e);for(var r=0;r<e._rigCameras.length;r++)this._renderForCamera(e._rigCameras[r],e)}this._activeCamera=e,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(e)},t.prototype._checkIntersections=function(){for(var e=0;e<this._meshesForIntersections.length;e++){var t=this._meshesForIntersections.data[e];if(t.actionManager)for(var r=function(e){var r=t.actionManager.actions[e];if(12===r.trigger||13===r.trigger){var n=r.getTriggerParameter(),i=n.mesh?n.mesh:n,o=i.intersectsMesh(t,n.usePreciseIntersection),s=t._intersectionsInProgress.indexOf(i);o&&-1===s?12===r.trigger?(r._executeCurrent(f.V.CreateNew(t,void 0,i)),t._intersectionsInProgress.push(i)):13===r.trigger&&t._intersectionsInProgress.push(i):!o&&s>-1&&(13===r.trigger&&r._executeCurrent(f.V.CreateNew(t,void 0,i)),t.actionManager.hasSpecificTrigger(13,(function(e){var t=e.mesh?e.mesh:e;return i===t}))&&13!==r.trigger||t._intersectionsInProgress.splice(s,1))}},n=0;t.actionManager&&n<t.actionManager.actions.length;n++)r(n)}},t.prototype._advancePhysicsEngineStep=function(e){},t.prototype._animate=function(){},t.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var e=Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime))+this._timeAccumulator,r=this._engine.getTimeStep(),n=1e3/r/1e3,i=0,o=this._engine.getLockstepMaxSteps(),s=Math.floor(e/r);for(s=Math.min(s,o);e>0&&i<s;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=r*n,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(r),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,i++,e-=r;this._timeAccumulator=e<0?0:e}else{e=this.useConstantAnimationDeltaTime?16:Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime));this._animationRatio=.06*e,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(e)}},t.prototype._clear=function(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)},t.prototype._checkCameraRenderTarget=function(e){var t;if((null==e?void 0:e.outputRenderTarget)&&!(null==e?void 0:e.isRigCamera)&&(e.outputRenderTarget._cleared=!1),null===(t=null==e?void 0:e.rigCameras)||void 0===t?void 0:t.length)for(var r=0;r<e.rigCameras.length;++r){var n=e.rigCameras[r].outputRenderTarget;n&&(n._cleared=!1)}},t.prototype.resetDrawCache=function(e){if(this.meshes)for(var t=0,r=this.meshes;t<r.length;t++){r[t].resetDrawCache(e)}},t.prototype.render=function(e,t){var r,n,o;if(void 0===e&&(e=!0),void 0===t&&(t=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),(null===(r=this.activeCameras)||void 0===r?void 0:r.length)&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),t||this.animate();for(var s=0,a=this._beforeCameraUpdateStage;s<a.length;s++){a[s].action()}if(e)if(this.activeCameras&&this.activeCameras.length>0)for(var l=0;l<this.activeCameras.length;l++){var c=this.activeCameras[l];if(c.update(),0!==c.cameraRigMode)for(var h=0;h<c._rigCameras.length;h++)c._rigCameras[h].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(h=0;h<this.activeCamera._rigCameras.length;h++)this.activeCamera._rigCameras[h].update();this.onBeforeRenderObservable.notifyObservers(this);var u=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var d=(null===(n=this.activeCameras)||void 0===n?void 0:n.length)?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){i.w1.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var p=0;p<this.customRenderTargets.length;p++){var _=this.customRenderTargets[p];if(_._shouldRender()){if(this._renderId++,this.activeCamera=_.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");u.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),_.render(d!==this.activeCamera,this.dumpNextRenderTargets)}}i.w1.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=null!==(o=null==d?void 0:d.renderPassId)&&void 0!==o?o:0,this.activeCamera=d,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var f=0,m=this._beforeClearStage;f<m.length;f++){m[f].action()}this._clearFrameBuffer(this.activeCamera);for(var g=0,v=this._gatherRenderTargetsStage;g<v.length;g++){v[g].action(this._renderTargets)}if(this.activeCameras&&this.activeCameras.length>0)for(l=0;l<this.activeCameras.length;l++)this._processSubCameras(this.activeCameras[l],l>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(var y=0,b=this._afterRenderStage;y<b.length;y++){b[y].action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(h=0;h<this._toBeDisposed.length;h++){var R=this._toBeDisposed[h];R&&R.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}},t.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},t.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},t.prototype.dispose=function(){var e;if(!this.isDisposed){this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var t=0,r=this._activeRequests.slice();t<r.length;t++){r[t].abort()}if(this._activeRequests=[],this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onComputePressureChanged.clear(),null===(e=this._computePressureObserver)||void 0===e||e.unobserve(),this._computePressureObserver=void 0,this.detachControl(),this._engine.getInputElement())for(var n=0;n<this.cameras.length;n++)this.cameras[n].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(function(e){return e.dispose(!0)})),this._disposeList(this.transformNodes,(function(e){return e.dispose(!0)})),this._disposeList(this.cameras),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);var i=this._engine.scenes.indexOf(this);i>-1&&this._engine.scenes.splice(i,1),b.l._LastCreatedScene===this&&(this._engine.scenes.length>0?b.l._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:b.l._LastCreatedScene=null),(i=this._engine._virtualScenes.indexOf(this))>-1&&this._engine._virtualScenes.splice(i,1),this._engine.wipeCaches(!0),this._isDisposed=!0}},t.prototype._disposeList=function(e,t){t=null!=t?t:function(e){return e.dispose()};for(var r=0,n=e.slice(0);r<n.length;r++){t(n[r])}e.length=0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),t.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e].geometry;t&&t.clearCachedData()}},t.prototype.cleanCachedTextureBuffer=function(){for(var e=0,t=this.textures;e<t.length;e++){var r=t[e];r._buffer&&(r._buffer=null)}},t.prototype.getWorldExtends=function(e){var t=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new h.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||function(){return!0},this.meshes.filter(e).forEach((function(e){if(e.computeWorldMatrix(!0),e.subMeshes&&0!==e.subMeshes.length&&!e.infiniteDistance){var n=e.getBoundingInfo(),i=n.boundingBox.minimumWorld,o=n.boundingBox.maximumWorld;h.P.CheckExtends(i,t,r),h.P.CheckExtends(o,t,r)}})),{min:t,max:r}},t.prototype.createPickingRay=function(e,t,r,n,i){throw void 0===i&&(i=!1),(0,R.S)("Ray")},t.prototype.createPickingRayToRef=function(e,t,r,n,i,o,s){throw void 0===o&&(o=!1),void 0===s&&(s=!1),(0,R.S)("Ray")},t.prototype.createPickingRayInCameraSpace=function(e,t,r){throw(0,R.S)("Ray")},t.prototype.createPickingRayInCameraSpaceToRef=function(e,t,r,n){throw(0,R.S)("Ray")},t.prototype.pick=function(e,t,r,n,i,o){var s=new _.p;return s._pickingUnavailable=!0,s},t.prototype.pickWithBoundingInfo=function(e,t,r,n,i){var o=new _.p;return o._pickingUnavailable=!0,o},t.prototype.pickWithRay=function(e,t,r,n){throw(0,R.S)("Ray")},t.prototype.multiPick=function(e,t,r,n,i){throw(0,R.S)("Ray")},t.prototype.multiPickWithRay=function(e,t,r){throw(0,R.S)("Ray")},t.prototype.setPointerOverMesh=function(e,t,r){this._inputManager.setPointerOverMesh(e,t,r)},t.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},t.prototype._rebuildGeometries=function(){for(var e=0,t=this.geometries;e<t.length;e++){t[e]._rebuild()}for(var r=0,n=this.meshes;r<n.length;r++){n[r]._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var i=0,o=this._components;i<o.length;i++){o[i].rebuild()}for(var s=0,a=this.particleSystems;s<a.length;s++){a[s].rebuild()}if(this.spriteManagers)for(var l=0,c=this.spriteManagers;l<c.length;l++){c[l].rebuild()}},t.prototype._rebuildTextures=function(){for(var e=0,t=this.textures;e<t.length;e++){t[e]._rebuild()}this.markAllMaterialsAsDirty(1)},t.prototype._getByTags=function(e,t,r){if(void 0===t)return e;var n=[];for(var i in r=r||function(e){},e){var o=e[i];c.$&&c.$.MatchesQuery(o,t)&&(n.push(o),r(o))}return n},t.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},t.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},t.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},t.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},t.prototype.getTransformNodesByTags=function(e,t){return this._getByTags(this.transformNodes,e,t)},t.prototype.setRenderingOrder=function(e,t,r,n){void 0===t&&(t=null),void 0===r&&(r=null),void 0===n&&(n=null),this._renderingManager.setRenderingOrder(e,t,r,n)},t.prototype.setRenderingAutoClearDepthStencil=function(e,t,r,n){void 0===r&&(r=!0),void 0===n&&(n=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,t,r,n)},t.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(t.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(63))},enumerable:!1,configurable:!0}),t.prototype.markAllMaterialsAsDirty=function(e,t){if(!this._blockMaterialDirtyMechanism)for(var r=0,n=this.materials;r<n.length;r++){var i=n[r];t&&!t(i)||i.markAsDirty(e)}},t.prototype._loadFile=function(e,t,r,n,i,o,s){var a=this,l=(0,S.vP)(e,t,r,n?this.offlineProvider:void 0,i,o,s);return this._activeRequests.push(l),l.onCompleteObservable.add((function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)})),l},t.prototype._loadFileAsync=function(e,t,r,n,i){var o=this;return new Promise((function(s,a){o._loadFile(e,(function(e){s(e)}),t,r,n,(function(e,t){a(t)}),i)}))},t.prototype._requestFile=function(e,t,r,n,i,o,s){var a=this,l=(0,S.FV)(e,t,r,n?this.offlineProvider:void 0,i,o,s);return this._activeRequests.push(l),l.onCompleteObservable.add((function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)})),l},t.prototype._requestFileAsync=function(e,t,r,n,i){var o=this;return new Promise((function(s,a){o._requestFile(e,(function(e){s(e)}),t,r,n,(function(e){a(e)}),i)}))},t.prototype._readFile=function(e,t,r,n,i){var o=this,s=(0,S.Ip)(e,t,r,n,i);return this._activeRequests.push(s),s.onCompleteObservable.add((function(e){o._activeRequests.splice(o._activeRequests.indexOf(e),1)})),s},t.prototype._readFileAsync=function(e,t,r){var n=this;return new Promise((function(i,o){n._readFile(e,(function(e){i(e)}),t,r,(function(e){o(e)}))}))},t.prototype.getPerfCollector=function(){throw(0,R.S)("performanceViewerSceneExtension")},t.FOGMODE_NONE=0,t.FOGMODE_EXP=1,t.FOGMODE_EXP2=2,t.FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}(u.p);A.prototype.setActiveCameraByID=function(e){return this.setActiveCameraById(e)},A.prototype.getLastMaterialByID=function(e){return this.getLastMaterialById(e)},A.prototype.getMaterialByID=function(e){return this.getMaterialById(e)},A.prototype.getTextureByUniqueID=function(e){return this.getTextureByUniqueId(e)},A.prototype.getCameraByID=function(e){return this.getCameraById(e)},A.prototype.getCameraByUniqueID=function(e){return this.getCameraByUniqueId(e)},A.prototype.getBoneByID=function(e){return this.getBoneById(e)},A.prototype.getLightByID=function(e){return this.getLightById(e)},A.prototype.getLightByUniqueID=function(e){return this.getLightByUniqueId(e)},A.prototype.getParticleSystemByID=function(e){return this.getParticleSystemById(e)},A.prototype.getGeometryByID=function(e){return this.getGeometryById(e)},A.prototype.getMeshByID=function(e){return this.getMeshById(e)},A.prototype.getMeshesByID=function(e){return this.getMeshesById(e)},A.prototype.getTransformNodeByID=function(e){return this.getTransformNodeById(e)},A.prototype.getTransformNodeByUniqueID=function(e){return this.getTransformNodeByUniqueId(e)},A.prototype.getTransformNodesByID=function(e){return this.getTransformNodesById(e)},A.prototype.getMeshByUniqueID=function(e){return this.getMeshByUniqueId(e)},A.prototype.getLastMeshByID=function(e){return this.getLastMeshById(e)},A.prototype.getLastEntryByID=function(e){return this.getLastEntryById(e)},A.prototype.getNodeByID=function(e){return this.getNodeById(e)},A.prototype.getLastSkeletonByID=function(e){return this.getLastSkeletonById(e)}},85627:(e,t,r)=>{r.d(t,{H:()=>o,l:()=>i});var n=r(31191),i=function(){function e(){}return e.NAME_EFFECTLAYER="EffectLayer",e.NAME_LAYER="Layer",e.NAME_LENSFLARESYSTEM="LensFlareSystem",e.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",e.NAME_PARTICLESYSTEM="ParticleSystem",e.NAME_GAMEPAD="Gamepad",e.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",e.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",e.NAME_PREPASSRENDERER="PrePassRenderer",e.NAME_DEPTHRENDERER="DepthRenderer",e.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",e.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",e.NAME_SPRITE="Sprite",e.NAME_SUBSURFACE="SubSurface",e.NAME_OUTLINERENDERER="Outline",e.NAME_PROCEDURALTEXTURE="ProceduralTexture",e.NAME_SHADOWGENERATOR="ShadowGenerator",e.NAME_OCTREE="Octree",e.NAME_PHYSICSENGINE="PhysicsEngine",e.NAME_AUDIO="Audio",e.STEP_ISREADYFORMESH_EFFECTLAYER=0,e.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,e.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,e.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,e.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,e.STEP_BEFORECAMERADRAW_PREPASS=0,e.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,e.STEP_BEFORECAMERADRAW_LAYER=2,e.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,e.STEP_BEFORERENDERTARGETDRAW_LAYER=1,e.STEP_BEFORERENDERINGMESH_PREPASS=0,e.STEP_BEFORERENDERINGMESH_OUTLINE=1,e.STEP_AFTERRENDERINGMESH_PREPASS=0,e.STEP_AFTERRENDERINGMESH_OUTLINE=1,e.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,e.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,e.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,e.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,e.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,e.STEP_BEFORECLEAR_PREPASS=1,e.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,e.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,e.STEP_AFTERRENDERTARGETDRAW_LAYER=1,e.STEP_AFTERCAMERADRAW_PREPASS=0,e.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,e.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,e.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,e.STEP_AFTERCAMERADRAW_LAYER=4,e.STEP_AFTERRENDER_AUDIO=0,e.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,e.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,e.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,e.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,e.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,e.STEP_POINTERMOVE_SPRITE=0,e.STEP_POINTERDOWN_SPRITE=0,e.STEP_POINTERUP_SPRITE=0,e}(),o=function(e){function t(t){return e.apply(this,t)||this}return(0,n.ZT)(t,e),t.Create=function(){return Object.create(t.prototype)},t.prototype.registerStep=function(e,t,r){var n=0;for(Number.MAX_VALUE;n<this.length;n++){if(e<this[n].index)break}this.splice(n,0,{index:e,component:t,action:r.bind(t)})},t.prototype.clear=function(){this.length=0},t}(Array)}}]);