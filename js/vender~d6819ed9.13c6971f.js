"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4480],{98878:(e,t,i)=>{i.d(t,{EP:()=>s,u0:()=>m,WK:()=>y});var r=i(15631),n=i(73803),o=i(67759),a=i(72208),s=function(){function e(e,t,i,s,c){this.size=e,this.position=t,this.alphaMode=6,this.color=i||new r.Wo(1,1,1),this.texture=s?new n.x(s,c.getScene(),!0):null,this._system=c;var u=c.scene.getEngine();this._drawWrapper=new o.q(u),this._drawWrapper.effect=u.createEffect("lensFlare",[a.o.PositionKind],["color","viewportMatrix"],["textureSampler"],""),c.lensFlares.push(this)}return e.AddFlare=function(t,i,r,n,o){return new e(t,i,r,n,o)},e.prototype.dispose=function(){this.texture&&this.texture.dispose();var e=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(e,1)},e}(),c=i(13514),u=i(58095),l=i(72739),h=i(15210),p=i(1316),d=i(98163),f=(i(99476),i(40971),i(77851)),m=function(){function e(t,i,r){this.name=t,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=r||h.l.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._emitter=i,this.id=t,r.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(e){return r.activeCamera&&e.material&&e.isVisible&&e.isEnabled()&&e.isBlocker&&0!=(e.layerMask&r.activeCamera.layerMask)};var n=r.getEngine(),o=[];o.push(1,1),o.push(-1,1),o.push(-1,-1),o.push(1,-1),this._vertexBuffers[a.o.PositionKind]=new a.o(n,o,a.o.PositionKind,!1,!1,2),this._createIndexBuffer()}return Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),e.prototype._createIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e},enumerable:!1,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEmitter=function(){return this._emitter},e.prototype.setEmitter=function(e){this._emitter=e},e.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},e.prototype.computeEffectivePosition=function(e){var t=this.getEmitterPosition();t=u.P.Project(t,u.y3.Identity(),this._scene.getTransformMatrix(),e),this._positionX=t.x,this._positionY=t.y,t=u.P.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(e.x-=this.viewportBorder,e.y-=this.viewportBorder,e.width+=2*this.viewportBorder,e.height+=2*this.viewportBorder,t.x+=this.viewportBorder,t.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder);var i=this._scene.useRightHandedSystem;return!!(t.z>0&&!i||t.z<0&&i)&&(this._positionX>e.x&&this._positionX<e.x+e.width&&this._positionY>e.y&&(this._positionY,e.y,e.height),!0)},e.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var e=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),t=e.length();e.normalize();var i=new p.z(this._scene.activeCamera.globalPosition,e),r=this._scene.pickWithRay(i,this.meshesSelectionPredicate,!0);return!r||!r.hit||r.distance>t},e.prototype.render=function(){if(!this._scene.activeCamera)return!1;var e,t,i=this._scene.getEngine(),r=this._scene.activeCamera.viewport.toGlobal(i.getRenderWidth(!0),i.getRenderHeight(!0));if(!this.computeEffectivePosition(r))return!1;if(!this._isVisible())return!1;var n=(e=this._positionX<this.borderLimit+r.x?this.borderLimit+r.x-this._positionX:this._positionX>r.x+r.width-this.borderLimit?this._positionX-r.x-r.width+this.borderLimit:0)>(t=this._positionY<this.borderLimit+r.y?this.borderLimit+r.y-this._positionY:this._positionY>r.y+r.height-this.borderLimit?this._positionY-r.y-r.height+this.borderLimit:0)?e:t;(n-=this.viewportBorder)>this.borderLimit&&(n=this.borderLimit);var o=1-l.R.Clamp(n/this.borderLimit,0,1);if(o<0)return!1;o>1&&(o=1),this.viewportBorder>0&&(r.x+=this.viewportBorder,r.y+=this.viewportBorder,r.width-=2*this.viewportBorder,r.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var a=r.x+r.width/2,s=r.y+r.height/2,c=a-this._positionX,h=s-this._positionY;i.setState(!1),i.setDepthBuffer(!1);for(var p=0;p<this.lensFlares.length;p++){var f=this.lensFlares[p];if(f._drawWrapper.effect.isReady()&&(!f.texture||f.texture.isReady())){i.enableEffect(f._drawWrapper),i.bindBuffers(this._vertexBuffers,this._indexBuffer,f._drawWrapper.effect),i.setAlphaMode(f.alphaMode);var m=a-c*f.position,g=s-h*f.position,_=f.size,y=f.size*i.getAspectRatio(this._scene.activeCamera,!0),v=m/(r.width+2*r.x)*2-1,b=1-g/(r.height+2*r.y)*2,S=u.y3.FromValues(_/2,0,0,0,0,y/2,0,0,0,0,1,0,v,b,0,1);f._drawWrapper.effect.setMatrix("viewportMatrix",S),f._drawWrapper.effect.setTexture("textureSampler",f.texture),f._drawWrapper.effect.setFloat4("color",f.color.r*o,f.color.g*o,f.color.b*o,1),i.drawElementsType(d.F.TriangleFillMode,0,6)}}return i.setDepthBuffer(!0),i.setAlphaMode(0),!0},e.prototype.rebuild=function(){var e;for(var t in this._createIndexBuffer(),this._vertexBuffers)null===(e=this._vertexBuffers[t])||void 0===e||e._rebuild()},e.prototype.dispose=function(){var e=this._vertexBuffers[a.o.PositionKind];for(e&&(e.dispose(),this._vertexBuffers[a.o.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var t=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(t,1)},e.Parse=function(t,i,n){var o=i.getLastEntryById(t.emitterId),a=t.name||"lensFlareSystem#"+t.emitterId,c=new e(a,o,i);c.id=t.id||a,c.borderLimit=t.borderLimit;for(var u=0;u<t.flares.length;u++){var l=t.flares[u];s.AddFlare(l.size,l.position,r.Wo.FromArray(l.color),l.textureName?n+l.textureName:"",c)}return c},e.prototype.serialize=function(){var e={};e.id=this.id,e.name=this.name,e.emitterId=this.getEmitter().id,e.borderLimit=this.borderLimit,e.flares=[];for(var t=0;t<this.lensFlares.length;t++){var i=this.lensFlares[t];e.flares.push({size:i.size,position:i.position,color:i.color.asArray(),textureName:c.w1.GetFilename(i.texture?i.texture.name:"")})}return e},e._SceneComponentInitialization=function(e){throw(0,f.S)("LensFlareSystemSceneComponent")},e}(),g=i(85627),_=i(57755);_.p.AddParser(g.l.NAME_LENSFLARESYSTEM,(function(e,t,i,r){if(void 0!==e.lensFlareSystems&&null!==e.lensFlareSystems){i.lensFlareSystems||(i.lensFlareSystems=new Array);for(var n=0,o=e.lensFlareSystems.length;n<o;n++){var a=e.lensFlareSystems[n],s=m.Parse(a,t,r);i.lensFlareSystems.push(s)}}})),_.p.prototype.getLensFlareSystemByName=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].name===e)return this.lensFlareSystems[t];return null},_.p.prototype.getLensFlareSystemById=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].id===e)return this.lensFlareSystems[t];return null},_.p.prototype.getLensFlareSystemByID=function(e){return this.getLensFlareSystemById(e)},_.p.prototype.removeLensFlareSystem=function(e){var t=this.lensFlareSystems.indexOf(e);return-1!==t&&this.lensFlareSystems.splice(t,1),t},_.p.prototype.addLensFlareSystem=function(e){this.lensFlareSystems.push(e)};var y=function(){function e(e){this.name=g.l.NAME_LENSFLARESYSTEM,this.scene=e,e.lensFlareSystems=new Array}return e.prototype.register=function(){this.scene._afterCameraDrawStage.registerStep(g.l.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)},e.prototype.rebuild=function(){for(var e=0;e<this.scene.lensFlareSystems.length;e++)this.scene.lensFlareSystems[e].rebuild()},e.prototype.addFromContainer=function(e){var t=this;e.lensFlareSystems&&e.lensFlareSystems.forEach((function(e){t.scene.addLensFlareSystem(e)}))},e.prototype.removeFromContainer=function(e,t){var i=this;e.lensFlareSystems&&e.lensFlareSystems.forEach((function(e){i.scene.removeLensFlareSystem(e),t&&e.dispose()}))},e.prototype.serialize=function(e){e.lensFlareSystems=[];for(var t=0,i=this.scene.lensFlareSystems;t<i.length;t++){var r=i[t];e.lensFlareSystems.push(r.serialize())}},e.prototype.dispose=function(){for(var e=this.scene.lensFlareSystems;e.length;)e[0].dispose()},e.prototype._draw=function(e){if(this.scene.lensFlaresEnabled){var t=this.scene.lensFlareSystems;c.w1.StartPerformanceCounter("Lens flares",t.length>0);for(var i=0,r=t;i<r.length;i++){var n=r[i];0!=(e.layerMask&n.layerMask)&&n.render()}c.w1.EndPerformanceCounter("Lens flares",t.length>0)}},e}();m._SceneComponentInitialization=function(e){var t=e._getComponent(g.l.NAME_LENSFLARESYSTEM);t||(t=new y(e),e._addComponent(t))}},89982:(e,t,i)=>{i.d(t,{u:()=>y});var r=i(31191),n=i(58095),o=i(15631),a=i(72208),s=i(43812),c=i(90360),u=i(73803),l=i(63784),h=i(16142),p=i(442),d=i(62897),f=i(77851),m=i(38309),g=i(70235),_=i(67759),y=(i(88246),i(50347),i(9669),i(7689),function(){function e(t,i,r){this.onBeforeShadowMapRenderObservable=new d.y$,this.onAfterShadowMapRenderObservable=new d.y$,this.onBeforeShadowMapRenderMeshObservable=new d.y$,this.onAfterShadowMapRenderMeshObservable=new d.y$,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=e.FILTER_NONE,this._filteringQuality=e.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.enableSoftTransparentShadow=!1,this.useOpacityTextureForTransparentShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=n.P.Zero(),this._viewMatrix=n.y3.Zero(),this._projectionMatrix=n.y3.Zero(),this._transformMatrix=n.y3.Zero(),this._cachedPosition=new n.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new n.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=n.y3.Identity(),this._mapSize=t,this._light=i,this._scene=i.getScene(),i._shadowGenerator=this,this.id=i.id,this._useUBO=this._scene.getEngine().supportsUniformBuffers,this._useUBO&&(this._sceneUBOs=[],this._sceneUBOs.push(this._scene.createSceneUniformBuffer('Scene for Shadow Generator (light "'.concat(this._light.name,'")')))),e._SceneComponentInitialization(this._scene);var o=this._scene.getEngine().getCaps();r?o.textureFloatRender&&o.textureFloatLinearFiltering?this._textureType=1:o.textureHalfFloatRender&&o.textureHalfFloatLinearFiltering?this._textureType=2:this._textureType=0:o.textureHalfFloatRender&&o.textureHalfFloatLinearFiltering?this._textureType=2:o.textureFloatRender&&o.textureFloatLinearFiltering?this._textureType=1:this._textureType=0,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(e.prototype,"bias",{get:function(){return this._bias},set:function(e){this._bias=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"normalBias",{get:function(){return this._normalBias},set:function(e){this._normalBias=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(e){this._blurBoxOffset!==e&&(this._blurBoxOffset=e,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurScale",{get:function(){return this._blurScale},set:function(e){this._blurScale!==e&&(this._blurScale=e,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(e){this._blurKernel!==e&&(this._blurKernel=e,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(e){this._useKernelBlur!==e&&(this._useKernelBlur=e,this._disposeBlurPostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthScale",{get:function(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()},set:function(e){this._depthScale=e},enumerable:!1,configurable:!0}),e.prototype._validateFilter=function(e){return e},Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(t){if(t=this._validateFilter(t),this._light.needCube()){if(t===e.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(t===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(t===e.FILTER_PCF||t===e.FILTER_PCSS)return void(this.usePoissonSampling=!0)}t!==e.FILTER_PCF&&t!==e.FILTER_PCSS||this._scene.getEngine()._features.supportShadowSamplers?this._filter!==t&&(this._filter=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"usePoissonSampling",{get:function(){return this.filter===e.FILTER_POISSONSAMPLING},set:function(t){var i=this._validateFilter(e.FILTER_POISSONSAMPLING);(t||this.filter===e.FILTER_POISSONSAMPLING)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useExponentialShadowMap",{get:function(){return this.filter===e.FILTER_EXPONENTIALSHADOWMAP},set:function(t){var i=this._validateFilter(e.FILTER_EXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(t){var i=this._validateFilter(e.FILTER_BLUREXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(t){var i=this._validateFilter(e.FILTER_CLOSEEXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(t){var i=this._validateFilter(e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);(t||this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===e.FILTER_PCF},set:function(t){var i=this._validateFilter(e.FILTER_PCF);(t||this.filter===e.FILTER_PCF)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(e){this._filteringQuality!==e&&(this._filteringQuality=e,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useContactHardeningShadow",{get:function(){return this.filter===e.FILTER_PCSS},set:function(t){var i=this._validateFilter(e.FILTER_PCSS);(t||this.filter===e.FILTER_PCSS)&&(this.filter=t?i:e.FILTER_NONE)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(e){this._contactHardeningLightSizeUVRatio=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"darkness",{get:function(){return this._darkness},set:function(e){this.setDarkness(e)},enumerable:!1,configurable:!0}),e.prototype.getDarkness=function(){return this._darkness},e.prototype.setDarkness=function(e){return this._darkness=e>=1?1:e<=0?0:e,this},Object.defineProperty(e.prototype,"transparencyShadow",{get:function(){return this._transparencyShadow},set:function(e){this.setTransparencyShadow(e)},enumerable:!1,configurable:!0}),e.prototype.setTransparencyShadow=function(e){return this._transparencyShadow=e,this},e.prototype.getShadowMap=function(){return this._shadowMap},e.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},e.prototype.getClassName=function(){return e.CLASSNAME},e.prototype.addShadowCaster=function(e,t){if(void 0===t&&(t=!0),!this._shadowMap)return this;if(this._shadowMap.renderList||(this._shadowMap.renderList=[]),-1===this._shadowMap.renderList.indexOf(e)&&this._shadowMap.renderList.push(e),t)for(var i=0,r=e.getChildMeshes();i<r.length;i++){var n=r[i];-1===this._shadowMap.renderList.indexOf(n)&&this._shadowMap.renderList.push(n)}return this},e.prototype.removeShadowCaster=function(e,t){if(void 0===t&&(t=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var i=this._shadowMap.renderList.indexOf(e);if(-1!==i&&this._shadowMap.renderList.splice(i,1),t)for(var r=0,n=e.getChildren();r<n.length;r++){var o=n[r];this.removeShadowCaster(o)}return this},e.prototype.getLight=function(){return this._light},Object.defineProperty(e.prototype,"mapSize",{get:function(){return this._mapSize},set:function(e){this._mapSize=e,this._light._markMeshesAsLightDirty(),this.recreateShadowMap()},enumerable:!1,configurable:!0}),e.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},e.prototype._createTargetRenderTexture=function(){var e=this._scene.getEngine();e._features.supportDepthStencilTexture?(this._shadowMap=new l._(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(e.useReverseDepthBuffer?516:513,!0)):this._shadowMap=new l._(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube())},e.prototype._initializeShadowMap=function(){var t=this;if(this._createTargetRenderTexture(),null!==this._shadowMap){this._shadowMap.wrapU=u.x.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=u.x.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(u.x.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._storedUniqueId&&(this._shadowMap.uniqueId=this._storedUniqueId),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.customIsReadyFunction=function(){return!0};var i=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.add((function(){var e;t._currentSceneUBO=t._scene.getSceneUniformBuffer(),null===(e=i._debugPushGroup)||void 0===e||e.call(i,"shadow map generation for pass id ".concat(i.currentRenderPassId),1)})),this._shadowMap.onBeforeRenderObservable.add((function(r){t._sceneUBOs&&t._scene.setSceneUniformBuffer(t._sceneUBOs[0]),t._currentFaceIndex=r,t._filter===e.FILTER_PCF&&i.setColorWrite(!1),t.getTransformMatrix(),t._scene.setTransformMatrix(t._viewMatrix,t._projectionMatrix),t._useUBO&&(t._scene.getSceneUniformBuffer().unbindEffect(),t._scene.finalizeSceneUbo())})),this._shadowMap.onAfterUnbindObservable.add((function(){var r,n;if(t._sceneUBOs&&t._scene.setSceneUniformBuffer(t._currentSceneUBO),t._scene.updateTransformMatrix(),t._filter===e.FILTER_PCF&&i.setColorWrite(!0),t.useBlurExponentialShadowMap||t.useBlurCloseExponentialShadowMap){var o=t.getShadowMapForRendering();o&&(t._scene.postProcessManager.directRender(t._blurPostProcesses,o.renderTarget,!0),i.unBindFramebuffer(o.renderTarget,!0),null===(n=i._debugPopGroup)||void 0===n||n.call(i,1))}else null===(r=i._debugPopGroup)||void 0===r||r.call(i,1)}));var r=new o.HE(0,0,0,0),n=new o.HE(1,1,1,1);this._shadowMap.onClearObservable.add((function(i){t._filter===e.FILTER_PCF?i.clear(n,!1,!0,!1):t.useExponentialShadowMap||t.useBlurExponentialShadowMap?i.clear(r,!0,!0,!1):i.clear(n,!0,!0,!1)})),this._shadowMap.onResizeObservable.add((function(e){t._storedUniqueId=t._shadowMap.uniqueId,t._mapSize=e.getRenderSize(),t._light._markMeshesAsLightDirty(),t.recreateShadowMap()}));for(var a=g.$.MIN_RENDERINGGROUPS;a<g.$.MAX_RENDERINGGROUPS;a++)this._shadowMap.setRenderingAutoClearDepthStencil(a,!1)}},e.prototype._initializeBlurRTTAndPostProcesses=function(){var e=this,t=this._scene.getEngine(),i=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new l._(this._light.name+"_shadowMap2",i,this._scene,!1,!0,this._textureType,void 0,void 0,!1),this._shadowMap2.wrapU=u.x.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=u.x.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(u.x.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new p.i(this._light.name+"KernelBlurX",new n.FM(1,0),this.blurKernel,1,null,u.x.BILINEAR_SAMPLINGMODE,t,!1,this._textureType),this._kernelBlurXPostprocess.width=i,this._kernelBlurXPostprocess.height=i,this._kernelBlurXPostprocess.externalTextureSamplerBinding=!0,this._kernelBlurXPostprocess.onApplyObservable.add((function(t){t.setTexture("textureSampler",e._shadowMap)})),this._kernelBlurYPostprocess=new p.i(this._light.name+"KernelBlurY",new n.FM(0,1),this.blurKernel,1,null,u.x.BILINEAR_SAMPLINGMODE,t,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,0===this._textureType&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new h.D(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,u.x.BILINEAR_SAMPLINGMODE,t,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.externalTextureSamplerBinding=!0,this._boxBlurPostprocess.onApplyObservable.add((function(t){t.setFloat2("screenSize",i,i),t.setTexture("textureSampler",e._shadowMap)})),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},e.prototype._renderForShadowMap=function(e,t,i,r){var n;if(r.length)for(n=0;n<r.length;n++)this._renderSubMeshForShadowMap(r.data[n]);for(n=0;n<e.length;n++)this._renderSubMeshForShadowMap(e.data[n]);for(n=0;n<t.length;n++)this._renderSubMeshForShadowMap(t.data[n]);if(this._transparencyShadow)for(n=0;n<i.length;n++)this._renderSubMeshForShadowMap(i.data[n],!0);else for(n=0;n<i.length;n++)i.data[n].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1},e.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(e,t,i){t.setMatrix("viewProjection",this.getTransformMatrix())},e.prototype._renderSubMeshForShadowMap=function(e,t){var i,r;void 0===t&&(t=!1);var n=e.getRenderingMesh(),o=e.getEffectiveMesh(),a=this._scene,u=a.getEngine(),l=e.getMaterial();if(o._internalAbstractMeshDataInfo._isActiveIntermediate=!1,l&&0!==e.verticesCount&&e._renderId!==a.getRenderId()){var h=o._getWorldMatrixDeterminant()<0,p=null!==(i=n.overrideMaterialSideOrientation)&&void 0!==i?i:l.sideOrientation;h&&(p=0===p?1:0);var d=0===p;u.setState(l.backFaceCulling,void 0,void 0,d,l.cullBackFaces);var f=n._getInstancesRenderList(e._id,!!e.getReplacementMesh());if(!f.mustReturn){var m=u.getCaps().instancedArrays&&(null!==f.visibleInstances[e._id]&&void 0!==f.visibleInstances[e._id]||n.hasThinInstances);if(!this.customAllowRendering||this.customAllowRendering(e))if(this.isReady(e,m,t)){e._renderId=a.getRenderId();var g=l.shadowDepthWrapper,y=null!==(r=null==g?void 0:g.getEffect(e,this,u.currentRenderPassId))&&void 0!==r?r:e._getDrawWrapper(),v=_.q.GetEffect(y);if(u.enableEffect(y),m||n._bind(e,v,l.fillMode),this.getTransformMatrix(),v.setFloat3("biasAndScaleSM",this.bias,this.normalBias,this.depthScale),this.getLight().getTypeID()===s._.LIGHTTYPEID_DIRECTIONALLIGHT?v.setVector3("lightDataSM",this._cachedDirection):v.setVector3("lightDataSM",this._cachedPosition),a.activeCamera&&v.setFloat2("depthValuesSM",this.getLight().getDepthMinZ(a.activeCamera),this.getLight().getDepthMinZ(a.activeCamera)+this.getLight().getDepthMaxZ(a.activeCamera)),t&&this.enableSoftTransparentShadow&&v.setFloat("softTransparentShadowSM",o.visibility*l.alpha),g)e._setMainDrawWrapperOverride(y),g.standalone?g.baseMaterial.bindForSubMesh(o.getWorldMatrix(),n,e):l.bindForSubMesh(o.getWorldMatrix(),n,e),e._setMainDrawWrapperOverride(null);else{if(l&&this.useOpacityTextureForTransparentShadow){var b=l.opacityTexture;b&&(v.setTexture("diffuseSampler",b),v.setMatrix("diffuseMatrix",b.getTextureMatrix()||this._defaultTextureMatrix))}else if(l&&l.needAlphaTesting()){var S=l.getAlphaTestTexture();S&&(v.setTexture("diffuseSampler",S),v.setMatrix("diffuseMatrix",S.getTextureMatrix()||this._defaultTextureMatrix))}if(n.useBones&&n.computeBonesUsingShaders&&n.skeleton){var C=n.skeleton;if(C.isUsingTextureForMatrices){var x=C.getTransformMatrixTexture(n);if(!x)return;v.setTexture("boneSampler",x),v.setFloat("boneTextureWidth",4*(C.bones.length+1))}else v.setMatrices("mBones",C.getTransformMatrices(n))}c.G.BindMorphTargetParameters(n,v),n.morphTargetManager&&n.morphTargetManager.isUsingTextureForTargets&&n.morphTargetManager._bind(v),c.G.BindClipPlane(v,a)}this._useUBO||g||this._bindCustomEffectForRenderSubMeshForShadowMap(e,v,o),c.G.BindSceneUniformBuffer(v,this._scene.getSceneUniformBuffer()),this._scene.getSceneUniformBuffer().bindUniformBuffer();var T=o.getWorldMatrix();m&&(o.getMeshUniformBuffer().bindToEffect(v,"Mesh"),o.transferToEffect(T)),this.forceBackFacesOnly&&u.setState(!0,0,!1,!0,l.cullBackFaces),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(n),this.onBeforeShadowMapRenderObservable.notifyObservers(v),n._processRendering(o,e,v,l.fillMode,f,m,(function(e,t){o===n||e?(o.getMeshUniformBuffer().bindToEffect(v,"Mesh"),o.transferToEffect(e?t:T)):(n.getMeshUniformBuffer().bindToEffect(v,"Mesh"),n.transferToEffect(t))})),this.forceBackFacesOnly&&u.setState(!0,0,!1,!1,l.cullBackFaces),this.onAfterShadowMapRenderObservable.notifyObservers(v),this.onAfterShadowMapRenderMeshObservable.notifyObservers(n)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},e.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===e.FILTER_NONE||this.filter===e.FILTER_PCSS?this._shadowMap.updateSamplingMode(u.x.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(u.x.BILINEAR_SAMPLINGMODE))},e.prototype.forceCompilation=function(e,t){var i=this,n=(0,r.pi)({useInstances:!1},t),o=this.getShadowMap();if(o){var a=o.renderList;if(a){for(var s=new Array,c=0,u=a;c<u.length;c++){var l=u[c];s.push.apply(s,l.subMeshes)}if(0!==s.length){var h=0,p=function(){var t,r;if(i._scene&&i._scene.getEngine()){for(;i.isReady(s[h],n.useInstances,null!==(r=null===(t=s[h].getMaterial())||void 0===t?void 0:t.needAlphaBlendingForMesh(s[h].getMesh()))&&void 0!==r&&r);)if(++h>=s.length)return void(e&&e(i));setTimeout(p,16)}};p()}else e&&e(this)}else e&&e(this)}else e&&e(this)},e.prototype.forceCompilationAsync=function(e){var t=this;return new Promise((function(i){t.forceCompilation((function(){i()}),e)}))},e.prototype._isReadyCustomDefines=function(e,t,i){},e.prototype._prepareShadowDefines=function(e,t,i,r){i.push("#define SM_FLOAT "+(0!==this._textureType?"1":"0")),i.push("#define SM_ESM "+(this.useExponentialShadowMap||this.useBlurExponentialShadowMap?"1":"0")),i.push("#define SM_DEPTHTEXTURE "+(this.usePercentageCloserFiltering||this.useContactHardeningShadow?"1":"0"));var n=e.getMesh();return i.push("#define SM_NORMALBIAS "+(this.normalBias&&n.isVerticesDataPresent(a.o.NormalKind)?"1":"0")),i.push("#define SM_DIRECTIONINLIGHTDATA "+(this.getLight().getTypeID()===s._.LIGHTTYPEID_DIRECTIONALLIGHT?"1":"0")),i.push("#define SM_USEDISTANCE "+(this._light.needCube()?"1":"0")),i.push("#define SM_SOFTTRANSPARENTSHADOW "+(this.enableSoftTransparentShadow&&r?"1":"0")),this._isReadyCustomDefines(i,e,t),i},e.prototype.isReady=function(t,i,r){var n,o=t.getMaterial(),s=null==o?void 0:o.shadowDepthWrapper,u=[];if(this._prepareShadowDefines(t,i,u,r),s){if(!s.isReadyForSubMesh(t,u,this,i,this._scene.getEngine().currentRenderPassId))return!1}else{var l=t._getDrawWrapper(void 0,!0),h=l.effect,p=l.defines,d=[a.o.PositionKind],f=t.getMesh();if(this.normalBias&&f.isVerticesDataPresent(a.o.NormalKind)&&(d.push(a.o.NormalKind),u.push("#define NORMAL"),f.nonUniformScaling&&u.push("#define NONUNIFORMSCALING")),o&&o.needAlphaTesting()){var g=null;if(g=this.useOpacityTextureForTransparentShadow?o.opacityTexture:o.getAlphaTestTexture()){if(!g.isReady())return!1;var _=null!==(n=o.alphaCutOff)&&void 0!==n?n:e.DEFAULT_ALPHA_CUTOFF;u.push("#define ALPHATEST"),u.push("#define ALPHATESTVALUE ".concat(_).concat(_%1==0?".":"")),f.isVerticesDataPresent(a.o.UVKind)&&(d.push(a.o.UVKind),u.push("#define UV1")),f.isVerticesDataPresent(a.o.UV2Kind)&&1===g.coordinatesIndex&&(d.push(a.o.UV2Kind),u.push("#define UV2"))}}var y=new m.L;if(f.useBones&&f.computeBonesUsingShaders&&f.skeleton){d.push(a.o.MatricesIndicesKind),d.push(a.o.MatricesWeightsKind),f.numBoneInfluencers>4&&(d.push(a.o.MatricesIndicesExtraKind),d.push(a.o.MatricesWeightsExtraKind));var v=f.skeleton;u.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),f.numBoneInfluencers>0&&y.addCPUSkinningFallback(0,f),v.isUsingTextureForMatrices?u.push("#define BONETEXTURE"):u.push("#define BonesPerMesh "+(v.bones.length+1))}else u.push("#define NUM_BONE_INFLUENCERS 0");var b=f.morphTargetManager,S=0;b&&b.numInfluencers>0&&(u.push("#define MORPHTARGETS"),S=b.numInfluencers,u.push("#define NUM_MORPH_INFLUENCERS "+S),b.isUsingTextureForTargets&&u.push("#define MORPHTARGETS_TEXTURE"),c.G.PrepareAttributesForMorphTargetsInfluencers(d,f,S));var C=this._scene;if(C.clipPlane&&u.push("#define CLIPPLANE"),C.clipPlane2&&u.push("#define CLIPPLANE2"),C.clipPlane3&&u.push("#define CLIPPLANE3"),C.clipPlane4&&u.push("#define CLIPPLANE4"),C.clipPlane5&&u.push("#define CLIPPLANE5"),C.clipPlane6&&u.push("#define CLIPPLANE6"),i&&(u.push("#define INSTANCES"),c.G.PushAttributesForInstances(d),t.getRenderingMesh().hasThinInstances&&u.push("#define THIN_INSTANCES")),this.customShaderOptions&&this.customShaderOptions.defines)for(var x=0,T=this.customShaderOptions.defines;x<T.length;x++){var M=T[x];-1===u.indexOf(M)&&u.push(M)}var N=u.join("\n");if(p!==N){p=N;var E="shadowMap",P=["world","mBones","viewProjection","diffuseMatrix","lightDataSM","depthValuesSM","biasAndScaleSM","morphTargetInfluences","boneTextureWidth","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","softTransparentShadowSM","morphTargetTextureInfo","morphTargetTextureIndices"],L=["diffuseSampler","boneSampler","morphTargets"];if(this.customShaderOptions){if(E=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(var I=0,O=this.customShaderOptions.attributes;I<O.length;I++){var w=O[I];-1===d.indexOf(w)&&d.push(w)}if(this.customShaderOptions.uniforms)for(var F=0,A=this.customShaderOptions.uniforms;F<A.length;F++){var D=A[F];-1===P.indexOf(D)&&P.push(D)}if(this.customShaderOptions.samplers)for(var B=0,R=this.customShaderOptions.samplers;B<R.length;B++){var V=R[B];-1===L.indexOf(V)&&L.push(V)}}var U=this._scene.getEngine();h=U.createEffect(E,{attributes:d,uniformsNames:P,uniformBuffersNames:["Scene","Mesh"],samplers:L,defines:N,fallbacks:y,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:S}},U),l.setEffect(h,p)}if(!h.isReady())return!1}return(this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&(!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady()))},e.prototype.prepareDefines=function(t,i){var r=this._scene,n=this._light;r.shadowsEnabled&&n.shadowEnabled&&(t["SHADOW"+i]=!0,this.useContactHardeningShadow?(t["SHADOWPCSS"+i]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+i]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+i]=!0)):this.usePercentageCloserFiltering?(t["SHADOWPCF"+i]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+i]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+i]=!0)):this.usePoissonSampling?t["SHADOWPOISSON"+i]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?t["SHADOWESM"+i]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(t["SHADOWCLOSEESM"+i]=!0),n.needCube()&&(t["SHADOWCUBE"+i]=!0))},e.prototype.bindShadowLight=function(t,i){var r=this._light,n=this._scene;if(n.shadowsEnabled&&r.shadowEnabled){var o=n.activeCamera;if(o){var a=this.getShadowMap();a&&(r.needCube()||i.setMatrix("lightMatrix"+t,this.getTransformMatrix()),this._filter===e.FILTER_PCF?(i.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),a.getSize().width,1/a.getSize().width,this.frustumEdgeFalloff,t)):this._filter===e.FILTER_PCSS?(i.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),i.setTexture("depthSampler"+t,this.getShadowMapForRendering()),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/a.getSize().width,this._contactHardeningLightSizeUVRatio*a.getSize().width,this.frustumEdgeFalloff,t)):(i.setTexture("shadowSampler"+t,this.getShadowMapForRendering()),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/a.getSize().width,this.depthScale,this.frustumEdgeFalloff,t)),r._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(o),this.getLight().getDepthMinZ(o)+this.getLight().getDepthMaxZ(o),t))}}},e.prototype.getTransformMatrix=function(){var e=this._scene;if(this._currentRenderId===e.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderId=e.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var t=this._light.position;if(this._light.computeTransformedInformation()&&(t=this._light.transformedPosition),n.P.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(n.P.Dot(this._lightDirection,n.P.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!t.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(t),this._cachedDirection.copyFrom(this._lightDirection),n.y3.LookAtLHToRef(t,t.add(this._lightDirection),n.P.Up(),this._viewMatrix);var i=this.getShadowMap();if(i){var r=i.renderList;r&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,r)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},e.prototype.recreateShadowMap=function(){var e=this._shadowMap;if(e){var t=e.renderList;if(this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this._filter,this._applyFilterValues(),t){this._shadowMap.renderList||(this._shadowMap.renderList=[]);for(var i=0,r=t;i<r.length;i++){var n=r[i];this._shadowMap.renderList.push(n)}}else this._shadowMap.renderList=null}},e.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},e.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},e.prototype._disposeSceneUBOs=function(){if(this._sceneUBOs){for(var e=0,t=this._sceneUBOs;e<t.length;e++){t[e].dispose()}this._sceneUBOs=[]}},e.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._disposeSceneUBOs(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty()),this.onBeforeShadowMapRenderMeshObservable.clear(),this.onBeforeShadowMapRenderObservable.clear(),this.onAfterShadowMapRenderMeshObservable.clear(),this.onAfterShadowMapRenderObservable.clear()},e.prototype.serialize=function(){var e={},t=this.getShadowMap();if(!t)return e;if(e.className=this.getClassName(),e.lightId=this._light.id,e.id=this.id,e.mapSize=t.getRenderSize(),e.forceBackFacesOnly=this.forceBackFacesOnly,e.darkness=this.getDarkness(),e.transparencyShadow=this._transparencyShadow,e.frustumEdgeFalloff=this.frustumEdgeFalloff,e.bias=this.bias,e.normalBias=this.normalBias,e.usePercentageCloserFiltering=this.usePercentageCloserFiltering,e.useContactHardeningShadow=this.useContactHardeningShadow,e.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,e.filteringQuality=this.filteringQuality,e.useExponentialShadowMap=this.useExponentialShadowMap,e.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,e.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.usePoissonSampling=this.usePoissonSampling,e.depthScale=this.depthScale,e.blurBoxOffset=this.blurBoxOffset,e.blurKernel=this.blurKernel,e.blurScale=this.blurScale,e.useKernelBlur=this.useKernelBlur,e.renderList=[],t.renderList)for(var i=0;i<t.renderList.length;i++){var r=t.renderList[i];e.renderList.push(r.id)}return e},e.Parse=function(t,i,r){for(var n=i.getLightById(t.lightId),o=r?r(t.mapSize,n):new e(t.mapSize,n),a=o.getShadowMap(),s=0;s<t.renderList.length;s++){i.getMeshesById(t.renderList[s]).forEach((function(e){a&&(a.renderList||(a.renderList=[]),a.renderList.push(e))}))}return void 0!==t.id&&(o.id=t.id),o.forceBackFacesOnly=!!t.forceBackFacesOnly,void 0!==t.darkness&&o.setDarkness(t.darkness),t.transparencyShadow&&o.setTransparencyShadow(!0),void 0!==t.frustumEdgeFalloff&&(o.frustumEdgeFalloff=t.frustumEdgeFalloff),void 0!==t.bias&&(o.bias=t.bias),void 0!==t.normalBias&&(o.normalBias=t.normalBias),t.usePercentageCloserFiltering?o.usePercentageCloserFiltering=!0:t.useContactHardeningShadow?o.useContactHardeningShadow=!0:t.usePoissonSampling?o.usePoissonSampling=!0:t.useExponentialShadowMap?o.useExponentialShadowMap=!0:t.useBlurExponentialShadowMap?o.useBlurExponentialShadowMap=!0:t.useCloseExponentialShadowMap?o.useCloseExponentialShadowMap=!0:t.useBlurCloseExponentialShadowMap?o.useBlurCloseExponentialShadowMap=!0:t.useVarianceShadowMap?o.useExponentialShadowMap=!0:t.useBlurVarianceShadowMap&&(o.useBlurExponentialShadowMap=!0),void 0!==t.contactHardeningLightSizeUVRatio&&(o.contactHardeningLightSizeUVRatio=t.contactHardeningLightSizeUVRatio),void 0!==t.filteringQuality&&(o.filteringQuality=t.filteringQuality),t.depthScale&&(o.depthScale=t.depthScale),t.blurScale&&(o.blurScale=t.blurScale),t.blurBoxOffset&&(o.blurBoxOffset=t.blurBoxOffset),t.useKernelBlur&&(o.useKernelBlur=t.useKernelBlur),t.blurKernel&&(o.blurKernel=t.blurKernel),o},e.CLASSNAME="ShadowGenerator",e.FILTER_NONE=0,e.FILTER_EXPONENTIALSHADOWMAP=1,e.FILTER_POISSONSAMPLING=2,e.FILTER_BLUREXPONENTIALSHADOWMAP=3,e.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,e.FILTER_PCF=6,e.FILTER_PCSS=7,e.QUALITY_HIGH=0,e.QUALITY_MEDIUM=1,e.QUALITY_LOW=2,e.DEFAULT_ALPHA_CUTOFF=.5,e._SceneComponentInitialization=function(e){throw(0,f.S)("ShadowGeneratorSceneComponent")},e}())},258:(e,t,i)=>{i.d(t,{O:()=>u});var r=i(31191),n=i(96969),o=i(58095),a=i(17834),s=i(43812),c=i(41691);a.N.AddNodeConstructor("Light_Type_1",(function(e,t){return function(){return new u(e,o.P.Zero(),t)}}));var u=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n._shadowFrustumSize=0,n._shadowOrthoScale=.1,n.autoUpdateExtends=!0,n.autoCalcShadowZBounds=!1,n._orthoLeft=Number.MAX_VALUE,n._orthoRight=Number.MIN_VALUE,n._orthoTop=Number.MIN_VALUE,n._orthoBottom=Number.MAX_VALUE,n.position=i.scale(-1),n.direction=i,n}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"orthoLeft",{get:function(){return this._orthoLeft},set:function(e){this._orthoLeft=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"orthoRight",{get:function(){return this._orthoRight},set:function(e){this._orthoRight=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"orthoTop",{get:function(){return this._orthoTop},set:function(e){this._orthoTop=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"orthoBottom",{get:function(){return this._orthoBottom},set:function(e){this._orthoBottom=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"DirectionalLight"},t.prototype.getTypeID=function(){return s._.LIGHTTYPEID_DIRECTIONALLIGHT},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,i){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,t,i)},t.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(e){var t=this.getScene().activeCamera;t&&o.y3.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:t.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,e,this.getScene().getEngine().isNDCHalfZRange)},t.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(e,t,i){var r=this.getScene().activeCamera;if(r){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var n=o.P.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var a=Number.MAX_VALUE,s=Number.MIN_VALUE,c=0;c<i.length;c++){var u=i[c];if(u)for(var l=u.getBoundingInfo().boundingBox,h=0;h<l.vectorsWorld.length;h++)o.P.TransformCoordinatesToRef(l.vectorsWorld[h],t,n),n.x<this._orthoLeft&&(this._orthoLeft=n.x),n.y<this._orthoBottom&&(this._orthoBottom=n.y),n.x>this._orthoRight&&(this._orthoRight=n.x),n.y>this._orthoTop&&(this._orthoTop=n.y),this.autoCalcShadowZBounds&&(n.z<a&&(a=n.z),n.z>s&&(s=n.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=a,this._shadowMaxZ=s)}var p=this._orthoRight-this._orthoLeft,d=this._orthoTop-this._orthoBottom,f=void 0!==this.shadowMinZ?this.shadowMinZ:r.minZ,m=void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,g=this.getScene().getEngine().useReverseDepthBuffer;o.y3.OrthoOffCenterLHToRef(this._orthoLeft-p*this.shadowOrthoScale,this._orthoRight+p*this.shadowOrthoScale,this._orthoBottom-d*this.shadowOrthoScale,this._orthoTop+d*this.shadowOrthoScale,g?m:f,g?f:m,e,this.getScene().getEngine().isNDCHalfZRange)}},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)},t.prototype.transferToNodeMaterialEffect=function(e,t){return this.computeTransformedInformation()?(e.setFloat3(t,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(e.setFloat3(t,this.direction.x,this.direction.y,this.direction.z),this)},t.prototype.getDepthMinZ=function(e){var t=this._scene.getEngine();return!t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1},t.prototype.getDepthMaxZ=function(e){var t=this._scene.getEngine();return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1},t.prototype.prepareLightSpecificDefines=function(e,t){e["DIRLIGHT"+t]=!0},(0,r.gn)([(0,n.qC)()],t.prototype,"shadowFrustumSize",null),(0,r.gn)([(0,n.qC)()],t.prototype,"shadowOrthoScale",null),(0,r.gn)([(0,n.qC)()],t.prototype,"autoUpdateExtends",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"autoCalcShadowZBounds",void 0),(0,r.gn)([(0,n.qC)("orthoLeft")],t.prototype,"_orthoLeft",void 0),(0,r.gn)([(0,n.qC)("orthoRight")],t.prototype,"_orthoRight",void 0),(0,r.gn)([(0,n.qC)("orthoTop")],t.prototype,"_orthoTop",void 0),(0,r.gn)([(0,n.qC)("orthoBottom")],t.prototype,"_orthoBottom",void 0),t}(c.O)},51356:(e,t,i)=>{i.d(t,{e:()=>u});var r=i(31191),n=i(96969),o=i(58095),a=i(15631),s=i(17834),c=i(43812);s.N.AddNodeConstructor("Light_Type_3",(function(e,t){return function(){return new u(e,o.P.Zero(),t)}}));var u=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n.groundColor=new a.Wo(0,0,0),n.direction=i||o.P.Up(),n}return(0,r.ZT)(t,e),t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.getClassName=function(){return"HemisphericLight"},t.prototype.setDirectionToTarget=function(e){return this.direction=o.P.Normalize(e.subtract(o.P.Zero())),this.direction},t.prototype.getShadowGenerator=function(){return null},t.prototype.transferToEffect=function(e,t){var i=o.P.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this},t.prototype.transferToNodeMaterialEffect=function(e,t){var i=o.P.Normalize(this.direction);return e.setFloat3(t,i.x,i.y,i.z),this},t.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=o.y3.Identity()),this._worldMatrix},t.prototype.getTypeID=function(){return c._.LIGHTTYPEID_HEMISPHERICLIGHT},t.prototype.prepareLightSpecificDefines=function(e,t){e["HEMILIGHT"+t]=!0},(0,r.gn)([(0,n.n9)()],t.prototype,"groundColor",void 0),(0,r.gn)([(0,n.hd)()],t.prototype,"direction",void 0),t}(c._)},49721:(e,t,i)=>{i.d(t,{RS:()=>v,Ox:()=>C.O,ez:()=>x.e,_k:()=>r._,ce:()=>T.c,uX:()=>o.u,wE:()=>S,O2:()=>n.O,PM:()=>M.P});var r=i(43812),n=i(41691),o=i(89982),a=i(31191),s=i(58095),c=i(63784),u=(i(88246),i(50347),i(9669),i(77851)),l=i(91859),h=i(39521),p=i(84318),d=i(15210),f=s.P.Up(),m=s.P.Zero(),g=new s.P,_=new s.P,y=new s.y3,v=function(e){function t(i,r,n){var o=this;return t.IsSupported?((o=e.call(this,i,r,n)||this).usePercentageCloserFiltering=!0,o):(p.Y.Error("CascadedShadowMap is not supported by the current engine."),o)}return(0,a.ZT)(t,e),t.prototype._validateFilter=function(e){return e===o.u.FILTER_NONE||e===o.u.FILTER_PCF||e===o.u.FILTER_PCSS?e:o.u.FILTER_NONE},Object.defineProperty(t.prototype,"numCascades",{get:function(){return this._numCascades},set:function(e){(e=Math.min(Math.max(e,t.MIN_CASCADES_COUNT),t.MAX_CASCADES_COUNT))!==this._numCascades&&(this._numCascades=e,this.recreateShadowMap(),this._recreateSceneUBOs())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"freezeShadowCastersBoundingInfo",{get:function(){return this._freezeShadowCastersBoundingInfo},set:function(e){this._freezeShadowCastersBoundingInfoObservable&&e&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._freezeShadowCastersBoundingInfoObservable||e||(this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add(this._computeShadowCastersBoundingInfo.bind(this))),this._freezeShadowCastersBoundingInfo=e,e&&this._computeShadowCastersBoundingInfo()},enumerable:!1,configurable:!0}),t.prototype._computeShadowCastersBoundingInfo=function(){if(this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._scbiMax.copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._shadowMap&&this._shadowMap.renderList){for(var e=this._shadowMap.renderList,t=0;t<e.length;t++){if(n=e[t]){var i=n.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(i.minimumWorld),this._scbiMax.maximizeInPlace(i.maximumWorld)}}var r=this._scene.meshes;for(t=0;t<r.length;t++){var n;if((n=r[t])&&n.isVisible&&n.isEnabled&&n.receiveShadows){i=n.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(i.minimumWorld),this._scbiMax.maximizeInPlace(i.maximumWorld)}}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax)},Object.defineProperty(t.prototype,"shadowCastersBoundingInfo",{get:function(){return this._shadowCastersBoundingInfo},set:function(e){this._shadowCastersBoundingInfo=e},enumerable:!1,configurable:!0}),t.prototype.setMinMaxDistance=function(e,t){this._minDistance===e&&this._maxDistance===t||(e>t&&(e=0,t=1),e<0&&(e=0),t>1&&(t=1),this._minDistance=e,this._maxDistance=t,this._breaksAreDirty=!0)},Object.defineProperty(t.prototype,"minDistance",{get:function(){return this._minDistance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxDistance",{get:function(){return this._maxDistance},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return t.CLASSNAME},t.prototype.getCascadeMinExtents=function(e){return e>=0&&e<this._numCascades?this._cascadeMinExtents[e]:null},t.prototype.getCascadeMaxExtents=function(e){return e>=0&&e<this._numCascades?this._cascadeMaxExtents[e]:null},Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._scene&&this._scene.activeCamera?this._shadowMaxZ:0},set:function(e){this._scene&&this._scene.activeCamera?this._shadowMaxZ===e||e<this._scene.activeCamera.minZ||e>this._scene.activeCamera.maxZ||(this._shadowMaxZ=e,this._light._markMeshesAsLightDirty(),this._breaksAreDirty=!0):this._shadowMaxZ=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,this._light._markMeshesAsLightDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthClamp",{get:function(){return this._depthClamp},set:function(e){this._depthClamp=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cascadeBlendPercentage",{get:function(){return this._cascadeBlendPercentage},set:function(e){this._cascadeBlendPercentage=e,this._light._markMeshesAsLightDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lambda",{get:function(){return this._lambda},set:function(e){var t=Math.min(Math.max(e,0),1);this._lambda!=t&&(this._lambda=t,this._breaksAreDirty=!0)},enumerable:!1,configurable:!0}),t.prototype.getCascadeViewMatrix=function(e){return e>=0&&e<this._numCascades?this._viewMatrices[e]:null},t.prototype.getCascadeProjectionMatrix=function(e){return e>=0&&e<this._numCascades?this._projectionMatrices[e]:null},t.prototype.getCascadeTransformMatrix=function(e){return e>=0&&e<this._numCascades?this._transformMatrices[e]:null},t.prototype.setDepthRenderer=function(e){this._depthRenderer=e,this._depthReducer&&this._depthReducer.setDepthRenderer(this._depthRenderer)},Object.defineProperty(t.prototype,"autoCalcDepthBounds",{get:function(){return this._autoCalcDepthBounds},set:function(e){var t=this,i=this._scene.activeCamera;if(i){if(this._autoCalcDepthBounds=e,!e)return this._depthReducer&&this._depthReducer.deactivate(),void this.setMinMaxDistance(0,1);this._depthReducer||(this._depthReducer=new h.j(i),this._depthReducer.onAfterReductionPerformed.add((function(e){var i=e.min,r=e.max;i>=r&&(i=0,r=1),i==t._minDistance&&r==t._maxDistance||t.setMinMaxDistance(i,r)})),this._depthReducer.setDepthRenderer(this._depthRenderer)),this._depthReducer.activate()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoCalcDepthBoundsRefreshRate",{get:function(){var e,t,i;return null!==(i=null===(t=null===(e=this._depthReducer)||void 0===e?void 0:e.depthRenderer)||void 0===t?void 0:t.getDepthMap().refreshRate)&&void 0!==i?i:-1},set:function(e){var t;(null===(t=this._depthReducer)||void 0===t?void 0:t.depthRenderer)&&(this._depthReducer.depthRenderer.getDepthMap().refreshRate=e)},enumerable:!1,configurable:!0}),t.prototype.splitFrustum=function(){this._breaksAreDirty=!0},t.prototype._splitFrustum=function(){var e=this._scene.activeCamera;if(e){for(var t=e.minZ,i=e.maxZ,r=i-t,n=this._minDistance,o=t+n*r,a=t+(this._shadowMaxZ<i&&this._shadowMaxZ>=t?Math.min((this._shadowMaxZ-t)/(i-t),this._maxDistance):this._maxDistance)*r,s=a-o,c=a/o,u=0;u<this._cascades.length;++u){var l=(u+1)/this._numCascades,h=o*Math.pow(c,l),p=o+s*l,d=this._lambda*(h-p)+p;this._cascades[u].prevBreakDistance=0===u?n:this._cascades[u-1].breakDistance,this._cascades[u].breakDistance=(d-t)/r,this._viewSpaceFrustumsZ[u]=d,this._frustumLengths[u]=(this._cascades[u].breakDistance-this._cascades[u].prevBreakDistance)*r}this._breaksAreDirty=!1}},t.prototype._computeMatrices=function(){var e=this._scene;if(e.activeCamera){s.P.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection),1===Math.abs(s.P.Dot(this._lightDirection,s.P.Up()))&&(this._lightDirection.z=1e-13),this._cachedDirection.copyFrom(this._lightDirection);for(var t=e.getEngine().useReverseDepthBuffer,i=0;i<this._numCascades;++i){this._computeFrustumInWorldSpace(i),this._computeCascadeFrustum(i),this._cascadeMaxExtents[i].subtractToRef(this._cascadeMinExtents[i],g),this._frustumCenter[i].addToRef(this._lightDirection.scale(this._cascadeMinExtents[i].z),this._shadowCameraPos[i]),s.y3.LookAtLHToRef(this._shadowCameraPos[i],this._frustumCenter[i],f,this._viewMatrices[i]);var r=0,n=g.z,a=this._shadowCastersBoundingInfo;a.update(this._viewMatrices[i]),n=Math.min(n,a.boundingBox.maximumWorld.z),r=this._depthClamp&&this.filter!==o.u.FILTER_PCSS?Math.max(r,a.boundingBox.minimumWorld.z):Math.min(r,a.boundingBox.minimumWorld.z),s.y3.OrthoOffCenterLHToRef(this._cascadeMinExtents[i].x,this._cascadeMaxExtents[i].x,this._cascadeMinExtents[i].y,this._cascadeMaxExtents[i].y,t?n:r,t?r:n,this._projectionMatrices[i],e.getEngine().isNDCHalfZRange),this._cascadeMinExtents[i].z=r,this._cascadeMaxExtents[i].z=n,this._viewMatrices[i].multiplyToRef(this._projectionMatrices[i],this._transformMatrices[i]),s.P.TransformCoordinatesToRef(m,this._transformMatrices[i],g),g.scaleInPlace(this._mapSize/2),_.copyFromFloats(Math.round(g.x),Math.round(g.y),Math.round(g.z)),_.subtractInPlace(g).scaleInPlace(2/this._mapSize),s.y3.TranslationToRef(_.x,_.y,0,y),this._projectionMatrices[i].multiplyToRef(y,this._projectionMatrices[i]),this._viewMatrices[i].multiplyToRef(this._projectionMatrices[i],this._transformMatrices[i]),this._transformMatrices[i].copyToArray(this._transformMatricesAsArray,16*i)}}},t.prototype._computeFrustumInWorldSpace=function(e){if(this._scene.activeCamera){var i=this._cascades[e].prevBreakDistance,r=this._cascades[e].breakDistance,n=this._scene.getEngine().isNDCHalfZRange;this._scene.activeCamera.getViewMatrix();for(var o=s.y3.Invert(this._scene.activeCamera.getTransformationMatrix()),a=this._scene.getEngine().useReverseDepthBuffer?4:0,c=0;c<t._FrustumCornersNDCSpace.length;++c)g.copyFrom(t._FrustumCornersNDCSpace[(c+a)%t._FrustumCornersNDCSpace.length]),n&&-1===g.z&&(g.z=0),s.P.TransformCoordinatesToRef(g,o,this._frustumCornersWorldSpace[e][c]);for(c=0;c<t._FrustumCornersNDCSpace.length/2;++c)g.copyFrom(this._frustumCornersWorldSpace[e][c+4]).subtractInPlace(this._frustumCornersWorldSpace[e][c]),_.copyFrom(g).scaleInPlace(i),g.scaleInPlace(r),g.addInPlace(this._frustumCornersWorldSpace[e][c]),this._frustumCornersWorldSpace[e][c+4].copyFrom(g),this._frustumCornersWorldSpace[e][c].addInPlace(_)}},t.prototype._computeCascadeFrustum=function(e){if(this._cascadeMinExtents[e].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cascadeMaxExtents[e].copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),this._frustumCenter[e].copyFromFloats(0,0,0),this._scene.activeCamera){for(var t=0;t<this._frustumCornersWorldSpace[e].length;++t)this._frustumCenter[e].addInPlace(this._frustumCornersWorldSpace[e][t]);if(this._frustumCenter[e].scaleInPlace(1/this._frustumCornersWorldSpace[e].length),this.stabilizeCascades){var i=0;for(t=0;t<this._frustumCornersWorldSpace[e].length;++t){var r=this._frustumCornersWorldSpace[e][t].subtractToRef(this._frustumCenter[e],g).length();i=Math.max(i,r)}i=Math.ceil(16*i)/16,this._cascadeMaxExtents[e].copyFromFloats(i,i,i),this._cascadeMinExtents[e].copyFromFloats(-i,-i,-i)}else{var n=this._frustumCenter[e];this._frustumCenter[e].addToRef(this._lightDirection,g),s.y3.LookAtLHToRef(n,g,f,y);for(t=0;t<this._frustumCornersWorldSpace[e].length;++t)s.P.TransformCoordinatesToRef(this._frustumCornersWorldSpace[e][t],y,g),this._cascadeMinExtents[e].minimizeInPlace(g),this._cascadeMaxExtents[e].maximizeInPlace(g)}}},t.prototype._recreateSceneUBOs=function(){if(this._disposeSceneUBOs(),this._sceneUBOs)for(var e=0;e<this._numCascades;++e)this._sceneUBOs.push(this._scene.createSceneUniformBuffer('Scene for CSM Shadow Generator (light "'.concat(this._light.name,'" cascade #').concat(e,")")))},Object.defineProperty(t,"IsSupported",{get:function(){var e=d.l.LastCreatedEngine;return!!e&&e._features.supportCSM},enumerable:!1,configurable:!0}),t.prototype._initializeGenerator=function(){var i,r,n,o,a,c,u,h,p,d,f,m,g,_,y,v,b,S,C,x;this.penumbraDarkness=null!==(i=this.penumbraDarkness)&&void 0!==i?i:1,this._numCascades=null!==(r=this._numCascades)&&void 0!==r?r:t.DEFAULT_CASCADES_COUNT,this.stabilizeCascades=null!==(n=this.stabilizeCascades)&&void 0!==n&&n,this._freezeShadowCastersBoundingInfoObservable=null!==(o=this._freezeShadowCastersBoundingInfoObservable)&&void 0!==o?o:null,this.freezeShadowCastersBoundingInfo=null!==(a=this.freezeShadowCastersBoundingInfo)&&void 0!==a&&a,this._scbiMin=null!==(c=this._scbiMin)&&void 0!==c?c:new s.P(0,0,0),this._scbiMax=null!==(u=this._scbiMax)&&void 0!==u?u:new s.P(0,0,0),this._shadowCastersBoundingInfo=null!==(h=this._shadowCastersBoundingInfo)&&void 0!==h?h:new l.j(new s.P(0,0,0),new s.P(0,0,0)),this._breaksAreDirty=null===(p=this._breaksAreDirty)||void 0===p||p,this._minDistance=null!==(d=this._minDistance)&&void 0!==d?d:0,this._maxDistance=null!==(f=this._maxDistance)&&void 0!==f?f:1,this._currentLayer=null!==(m=this._currentLayer)&&void 0!==m?m:0,this._shadowMaxZ=null!==(y=null!==(g=this._shadowMaxZ)&&void 0!==g?g:null===(_=this._scene.activeCamera)||void 0===_?void 0:_.maxZ)&&void 0!==y?y:1e4,this._debug=null!==(v=this._debug)&&void 0!==v&&v,this._depthClamp=null===(b=this._depthClamp)||void 0===b||b,this._cascadeBlendPercentage=null!==(S=this._cascadeBlendPercentage)&&void 0!==S?S:.1,this._lambda=null!==(C=this._lambda)&&void 0!==C?C:.5,this._autoCalcDepthBounds=null!==(x=this._autoCalcDepthBounds)&&void 0!==x&&x,this._recreateSceneUBOs(),e.prototype._initializeGenerator.call(this)},t.prototype._createTargetRenderTexture=function(){var e=this._scene.getEngine(),t={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new c._(this._light.name+"_CSMShadowMap",t,this._scene,!1,!0,this._textureType,!1,void 0,!1,!1,void 0),this._shadowMap.createDepthStencilTexture(e.useReverseDepthBuffer?516:513,!0)},t.prototype._initializeShadowMap=function(){var i=this;if(e.prototype._initializeShadowMap.call(this),null!==this._shadowMap){this._transformMatricesAsArray=new Float32Array(16*this._numCascades),this._viewSpaceFrustumsZ=new Array(this._numCascades),this._frustumLengths=new Array(this._numCascades),this._lightSizeUVCorrection=new Array(2*this._numCascades),this._depthCorrection=new Array(this._numCascades),this._cascades=[],this._viewMatrices=[],this._projectionMatrices=[],this._transformMatrices=[],this._cascadeMinExtents=[],this._cascadeMaxExtents=[],this._frustumCenter=[],this._shadowCameraPos=[],this._frustumCornersWorldSpace=[];for(var r=0;r<this._numCascades;++r){this._cascades[r]={prevBreakDistance:0,breakDistance:0},this._viewMatrices[r]=s.y3.Zero(),this._projectionMatrices[r]=s.y3.Zero(),this._transformMatrices[r]=s.y3.Zero(),this._cascadeMinExtents[r]=new s.P,this._cascadeMaxExtents[r]=new s.P,this._frustumCenter[r]=new s.P,this._shadowCameraPos[r]=new s.P,this._frustumCornersWorldSpace[r]=new Array(t._FrustumCornersNDCSpace.length);for(var n=0;n<t._FrustumCornersNDCSpace.length;++n)this._frustumCornersWorldSpace[r][n]=new s.P}var a=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.clear(),this._shadowMap.onBeforeRenderObservable.clear(),this._shadowMap.onBeforeRenderObservable.add((function(e){i._sceneUBOs&&i._scene.setSceneUniformBuffer(i._sceneUBOs[e]),i._currentLayer=e,i._filter===o.u.FILTER_PCF&&a.setColorWrite(!1),i._scene.setTransformMatrix(i.getCascadeViewMatrix(e),i.getCascadeProjectionMatrix(e)),i._useUBO&&(i._scene.getSceneUniformBuffer().unbindEffect(),i._scene.finalizeSceneUbo())})),this._shadowMap.onBeforeBindObservable.add((function(){var e;i._currentSceneUBO=i._scene.getSceneUniformBuffer(),null===(e=a._debugPushGroup)||void 0===e||e.call(a,"cascaded shadow map generation for pass id ".concat(a.currentRenderPassId),1),i._breaksAreDirty&&i._splitFrustum(),i._computeMatrices()})),this._splitFrustum()}},t.prototype._bindCustomEffectForRenderSubMeshForShadowMap=function(e,t){t.setMatrix("viewProjection",this.getCascadeTransformMatrix(this._currentLayer))},t.prototype._isReadyCustomDefines=function(e){e.push("#define SM_DEPTHCLAMP "+(this._depthClamp&&this._filter!==o.u.FILTER_PCSS?"1":"0"))},t.prototype.prepareDefines=function(t,i){e.prototype.prepareDefines.call(this,t,i);var r=this._scene,n=this._light;if(r.shadowsEnabled&&n.shadowEnabled){t["SHADOWCSM"+i]=!0,t["SHADOWCSMDEBUG"+i]=this.debug,t["SHADOWCSMNUM_CASCADES"+i]=this.numCascades,t["SHADOWCSM_RIGHTHANDED"+i]=r.useRightHandedSystem;var o=r.activeCamera;o&&this._shadowMaxZ<o.maxZ&&(t["SHADOWCSMUSESHADOWMAXZ"+i]=!0),0===this.cascadeBlendPercentage&&(t["SHADOWCSMNOBLEND"+i]=!0)}},t.prototype.bindShadowLight=function(e,t){var i=this._light,r=this._scene;if(r.shadowsEnabled&&i.shadowEnabled){var n=r.activeCamera;if(n){var a=this.getShadowMap();if(a){var s=a.getSize().width;if(t.setMatrices("lightMatrix"+e,this._transformMatricesAsArray),t.setArray("viewFrustumZ"+e,this._viewSpaceFrustumsZ),t.setFloat("cascadeBlendFactor"+e,0===this.cascadeBlendPercentage?1e4:1/this.cascadeBlendPercentage),t.setArray("frustumLengths"+e,this._frustumLengths),this._filter===o.u.FILTER_PCF)t.setDepthStencilTexture("shadowSampler"+e,a),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),s,1/s,this.frustumEdgeFalloff,e);else if(this._filter===o.u.FILTER_PCSS){for(var c=0;c<this._numCascades;++c)this._lightSizeUVCorrection[2*c+0]=0===c?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[c].x-this._cascadeMinExtents[c].x),this._lightSizeUVCorrection[2*c+1]=0===c?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[c].y-this._cascadeMinExtents[c].y),this._depthCorrection[c]=0===c?1:(this._cascadeMaxExtents[c].z-this._cascadeMinExtents[c].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);t.setDepthStencilTexture("shadowSampler"+e,a),t.setTexture("depthSampler"+e,a),t.setArray2("lightSizeUVCorrection"+e,this._lightSizeUVCorrection),t.setArray("depthCorrection"+e,this._depthCorrection),t.setFloat("penumbraDarkness"+e,this.penumbraDarkness),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/s,this._contactHardeningLightSizeUVRatio*s,this.frustumEdgeFalloff,e)}else t.setTexture("shadowSampler"+e,a),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),s,1/s,this.frustumEdgeFalloff,e);i._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(n),this.getLight().getDepthMinZ(n)+this.getLight().getDepthMaxZ(n),e)}}}},t.prototype.getTransformMatrix=function(){return this.getCascadeTransformMatrix(0)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._freezeShadowCastersBoundingInfoObservable&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._depthReducer&&(this._depthReducer.dispose(),this._depthReducer=null)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this),i=this.getShadowMap();if(!i)return t;if(t.numCascades=this._numCascades,t.debug=this._debug,t.stabilizeCascades=this.stabilizeCascades,t.lambda=this._lambda,t.cascadeBlendPercentage=this.cascadeBlendPercentage,t.depthClamp=this._depthClamp,t.autoCalcDepthBounds=this.autoCalcDepthBounds,t.shadowMaxZ=this._shadowMaxZ,t.penumbraDarkness=this.penumbraDarkness,t.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo,t.minDistance=this.minDistance,t.maxDistance=this.maxDistance,t.renderList=[],i.renderList)for(var r=0;r<i.renderList.length;r++){var n=i.renderList[r];t.renderList.push(n.id)}return t},t.Parse=function(e,i){var r=o.u.Parse(e,i,(function(e,i){return new t(e,i)}));return void 0!==e.numCascades&&(r.numCascades=e.numCascades),void 0!==e.debug&&(r.debug=e.debug),void 0!==e.stabilizeCascades&&(r.stabilizeCascades=e.stabilizeCascades),void 0!==e.lambda&&(r.lambda=e.lambda),void 0!==e.cascadeBlendPercentage&&(r.cascadeBlendPercentage=e.cascadeBlendPercentage),void 0!==e.depthClamp&&(r.depthClamp=e.depthClamp),void 0!==e.autoCalcDepthBounds&&(r.autoCalcDepthBounds=e.autoCalcDepthBounds),void 0!==e.shadowMaxZ&&(r.shadowMaxZ=e.shadowMaxZ),void 0!==e.penumbraDarkness&&(r.penumbraDarkness=e.penumbraDarkness),void 0!==e.freezeShadowCastersBoundingInfo&&(r.freezeShadowCastersBoundingInfo=e.freezeShadowCastersBoundingInfo),void 0!==e.minDistance&&void 0!==e.maxDistance&&r.setMinMaxDistance(e.minDistance,e.maxDistance),r},t._FrustumCornersNDCSpace=[new s.P(-1,1,-1),new s.P(1,1,-1),new s.P(1,-1,-1),new s.P(-1,-1,-1),new s.P(-1,1,1),new s.P(1,1,1),new s.P(1,-1,1),new s.P(-1,-1,1)],t.CLASSNAME="CascadedShadowGenerator",t.DEFAULT_CASCADES_COUNT=4,t.MIN_CASCADES_COUNT=2,t.MAX_CASCADES_COUNT=4,t._SceneComponentInitialization=function(e){throw(0,u.S)("ShadowGeneratorSceneComponent")},t}(o.u),b=i(85627);i(57755).p.AddParser(b.l.NAME_SHADOWGENERATOR,(function(e,t){if(void 0!==e.shadowGenerators&&null!==e.shadowGenerators)for(var i=0,r=e.shadowGenerators.length;i<r;i++){var n=e.shadowGenerators[i];n.className===v.CLASSNAME?v.Parse(n,t):o.u.Parse(n,t)}}));var S=function(){function e(e){this.name=b.l.NAME_SHADOWGENERATOR,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(b.l.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.serialize=function(e){e.shadowGenerators=[];for(var t=0,i=this.scene.lights;t<i.length;t++){var r=i[t].getShadowGenerator();r&&e.shadowGenerators.push(r.serialize())}},e.prototype.addFromContainer=function(e){},e.prototype.removeFromContainer=function(e,t){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(e){var t=this.scene;if(this.scene.shadowsEnabled)for(var i=0;i<t.lights.length;i++){var r=t.lights[i],n=r.getShadowGenerator();if(r.isEnabled()&&r.shadowEnabled&&n){var o=n.getShadowMap();-1!==t.textures.indexOf(o)&&e.push(o)}}},e}();o.u._SceneComponentInitialization=function(e){var t=e._getComponent(b.l.NAME_SHADOWGENERATOR);t||(t=new S(e),e._addComponent(t))};var C=i(258),x=i(51356),T=i(65064),M=i(96761)},43812:(e,t,i)=>{i.d(t,{_:()=>h});var r=i(31191),n=i(96969),o=i(58095),a=i(15631),s=i(17834),c=i(83353),u=i(48620),l=i(51011),h=function(e){function t(i,r){var n=e.call(this,i,r)||this;return n.diffuse=new a.Wo(1,1,1),n.specular=new a.Wo(1,1,1),n.falloffType=t.FALLOFF_DEFAULT,n.intensity=1,n._range=Number.MAX_VALUE,n._inverseSquaredRange=0,n._photometricScale=1,n._intensityMode=t.INTENSITYMODE_AUTOMATIC,n._radius=1e-5,n.renderPriority=0,n._shadowEnabled=!0,n._excludeWithLayerMask=0,n._includeOnlyWithLayerMask=0,n._lightmapMode=0,n._excludedMeshesIds=new Array,n._includedOnlyMeshesIds=new Array,n._isLight=!0,n.getScene().addLight(n),n._uniformBuffer=new c.M(n.getScene().getEngine(),void 0,void 0,i),n._buildUniformLayout(),n.includedOnlyMeshes=new Array,n.excludedMeshes=new Array,n._resyncMeshes(),n}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),t.prototype.transferTexturesToEffect=function(e,t){return this},t.prototype._bindLight=function(e,t,i,r,n){void 0===n&&(n=!0);var o=e.toString(),s=!1;if(this._uniformBuffer.bindToEffect(i,"Light"+o),this._renderId!==t.getRenderId()||this._lastUseSpecular!==r||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId(),this._lastUseSpecular=r;var c=this.getScaledIntensity();this.transferToEffect(i,o),this.diffuse.scaleToRef(c,a.zZ.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",a.zZ.Color3[0],this.range,o),r&&(this.specular.scaleToRef(c,a.zZ.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",a.zZ.Color3[1],this.radius,o)),s=!0}if(this.transferTexturesToEffect(i,o),t.shadowsEnabled&&this.shadowEnabled&&n){var u=this.getShadowGenerator();u&&(u.bindShadowLight(o,i),s=!0)}s?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()},t.prototype.getClassName=function(){return"Light"},t.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t},t.prototype._syncParentEnabledState=function(){e.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t),this._resyncMeshes()},t.prototype.getShadowGenerator=function(){return this._shadowGenerator},t.prototype.getAbsolutePosition=function(){return o.P.Zero()},t.prototype.canAffectMesh=function(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))},t.prototype.dispose=function(t,i){if(void 0===i&&(i=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this),this._parentContainer){var r=this._parentContainer.lights.indexOf(this);r>-1&&this._parentContainer.lights.splice(r,1),this._parentContainer=null}for(var n=0,o=this.getScene().meshes;n<o.length;n++){o[n]._removeLightSource(this,!0)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),e.prototype.dispose.call(this,t,i)},t.prototype.getTypeID=function(){return 0},t.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},t.prototype.clone=function(e,i){void 0===i&&(i=null);var r=t.GetConstructorFromName(this.getTypeID(),e,this.getScene());if(!r)return null;var o=n.p4.Clone(r,this);return e&&(o.name=e),i&&(o.parent=i),o.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(o),o},t.prototype.serialize=function(){var e=n.p4.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getTypeID(),this.parent&&(e.parentId=this.parent.uniqueId),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach((function(t){e.excludedMeshesIds.push(t.id)}))),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((function(t){e.includedOnlyMeshesIds.push(t.id)}))),n.p4.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e},t.GetConstructorFromName=function(e,t,i){var r=s.N.Construct("Light_Type_"+e,t,i);return r||null},t.Parse=function(e,i){var r=t.GetConstructorFromName(e.type,e.name,i);if(!r)return null;var o=n.p4.Parse(r,e,i);if(e.excludedMeshesIds&&(o._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(o._includedOnlyMeshesIds=e.includedOnlyMeshesIds),void 0!==e.parentId&&(o._waitingParentId=e.parentId),void 0!==e.falloffType&&(o.falloffType=e.falloffType),void 0!==e.lightmapMode&&(o.lightmapMode=e.lightmapMode),e.animations){for(var a=0;a<e.animations.length;a++){var c=e.animations[a],l=(0,u.q)("BABYLON.Animation");l&&o.animations.push(l.Parse(c))}s.N.ParseAnimationRanges(o,e,i)}return e.autoAnimate&&i.beginAnimation(o,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&o.setEnabled(e.isEnabled),o},t.prototype._hookArrayForExcluded=function(e){var t=this,i=e.push;e.push=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];for(var o=i.apply(e,r),a=0,s=r;a<s.length;a++){var c=s[a];c._resyncLightSource(t)}return o};var r=e.splice;e.splice=function(i,n){for(var o=r.apply(e,[i,n]),a=0,s=o;a<s.length;a++){s[a]._resyncLightSource(t)}return o};for(var n=0,o=e;n<o.length;n++){o[n]._resyncLightSource(this)}},t.prototype._hookArrayForIncludedOnly=function(e){var t=this,i=e.push;e.push=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var o=i.apply(e,r);return t._resyncMeshes(),o};var r=e.splice;e.splice=function(i,n){var o=r.apply(e,[i,n]);return t._resyncMeshes(),o},this._resyncMeshes()},t.prototype._resyncMeshes=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){t[e]._resyncLightSource(this)}},t.prototype._markMeshesAsLightDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var i=t[e];-1!==i.lightSources.indexOf(this)&&i._markSubMeshesAsLightDirty()}},t.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},t.prototype._getPhotometricScale=function(){var e=0,i=this.getTypeID(),r=this.intensityMode;switch(r===t.INTENSITYMODE_AUTOMATIC&&(r=i===t.LIGHTTYPEID_DIRECTIONALLIGHT?t.INTENSITYMODE_ILLUMINANCE:t.INTENSITYMODE_LUMINOUSINTENSITY),i){case t.LIGHTTYPEID_POINTLIGHT:case t.LIGHTTYPEID_SPOTLIGHT:switch(r){case t.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case t.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case t.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case t.LIGHTTYPEID_DIRECTIONALLIGHT:switch(r){case t.INTENSITYMODE_ILLUMINANCE:e=1;break;case t.INTENSITYMODE_LUMINANCE:var n=this.radius;n=Math.max(n,.001),e=2*Math.PI*(1-Math.cos(n))}break;case t.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e},t.prototype._reorderLightsInScene=function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},t.FALLOFF_DEFAULT=l.m.FALLOFF_DEFAULT,t.FALLOFF_PHYSICAL=l.m.FALLOFF_PHYSICAL,t.FALLOFF_GLTF=l.m.FALLOFF_GLTF,t.FALLOFF_STANDARD=l.m.FALLOFF_STANDARD,t.LIGHTMAP_DEFAULT=l.m.LIGHTMAP_DEFAULT,t.LIGHTMAP_SPECULAR=l.m.LIGHTMAP_SPECULAR,t.LIGHTMAP_SHADOWSONLY=l.m.LIGHTMAP_SHADOWSONLY,t.INTENSITYMODE_AUTOMATIC=l.m.INTENSITYMODE_AUTOMATIC,t.INTENSITYMODE_LUMINOUSPOWER=l.m.INTENSITYMODE_LUMINOUSPOWER,t.INTENSITYMODE_LUMINOUSINTENSITY=l.m.INTENSITYMODE_LUMINOUSINTENSITY,t.INTENSITYMODE_ILLUMINANCE=l.m.INTENSITYMODE_ILLUMINANCE,t.INTENSITYMODE_LUMINANCE=l.m.INTENSITYMODE_LUMINANCE,t.LIGHTTYPEID_POINTLIGHT=l.m.LIGHTTYPEID_POINTLIGHT,t.LIGHTTYPEID_DIRECTIONALLIGHT=l.m.LIGHTTYPEID_DIRECTIONALLIGHT,t.LIGHTTYPEID_SPOTLIGHT=l.m.LIGHTTYPEID_SPOTLIGHT,t.LIGHTTYPEID_HEMISPHERICLIGHT=l.m.LIGHTTYPEID_HEMISPHERICLIGHT,(0,r.gn)([(0,n.n9)()],t.prototype,"diffuse",void 0),(0,r.gn)([(0,n.n9)()],t.prototype,"specular",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"falloffType",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"intensity",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"range",null),(0,r.gn)([(0,n.qC)()],t.prototype,"intensityMode",null),(0,r.gn)([(0,n.qC)()],t.prototype,"radius",null),(0,r.gn)([(0,n.qC)()],t.prototype,"_renderPriority",void 0),(0,r.gn)([(0,n.wz)("_reorderLightsInScene")],t.prototype,"renderPriority",void 0),(0,r.gn)([(0,n.qC)("shadowEnabled")],t.prototype,"_shadowEnabled",void 0),(0,r.gn)([(0,n.qC)("excludeWithLayerMask")],t.prototype,"_excludeWithLayerMask",void 0),(0,r.gn)([(0,n.qC)("includeOnlyWithLayerMask")],t.prototype,"_includeOnlyWithLayerMask",void 0),(0,r.gn)([(0,n.qC)("lightmapMode")],t.prototype,"_lightmapMode",void 0),t}(s.N)},51011:(e,t,i)=>{i.d(t,{m:()=>r});var r=function(){function e(){}return e.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},e.FALLOFF_DEFAULT=0,e.FALLOFF_PHYSICAL=1,e.FALLOFF_GLTF=2,e.FALLOFF_STANDARD=3,e.LIGHTMAP_DEFAULT=0,e.LIGHTMAP_SPECULAR=1,e.LIGHTMAP_SHADOWSONLY=2,e.INTENSITYMODE_AUTOMATIC=0,e.INTENSITYMODE_LUMINOUSPOWER=1,e.INTENSITYMODE_LUMINOUSINTENSITY=2,e.INTENSITYMODE_ILLUMINANCE=3,e.INTENSITYMODE_LUMINANCE=4,e.LIGHTTYPEID_POINTLIGHT=0,e.LIGHTTYPEID_DIRECTIONALLIGHT=1,e.LIGHTTYPEID_SPOTLIGHT=2,e.LIGHTTYPEID_HEMISPHERICLIGHT=3,e}()},65064:(e,t,i)=>{i.d(t,{c:()=>u});var r=i(31191),n=i(96969),o=i(58095),a=i(17834),s=i(43812),c=i(41691);a.N.AddNodeConstructor("Light_Type_0",(function(e,t){return function(){return new u(e,o.P.Zero(),t)}}));var u=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n._shadowAngle=Math.PI/2,n.position=i,n}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){var t=this.needCube();this._direction=e,this.needCube()!==t&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PointLight"},t.prototype.getTypeID=function(){return s._.LIGHTTYPEID_POINTLIGHT},t.prototype.needCube=function(){return!this.direction},t.prototype.getShadowDirection=function(t){if(this.direction)return e.prototype.getShadowDirection.call(this,t);switch(t){case 0:return new o.P(1,0,0);case 1:return new o.P(-1,0,0);case 2:return new o.P(0,-1,0);case 3:return new o.P(0,1,0);case 4:return new o.P(0,0,1);case 5:return new o.P(0,0,-1)}return o.P.Zero()},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,i){var r=this.getScene().activeCamera;if(r){var n=void 0!==this.shadowMinZ?this.shadowMinZ:r.minZ,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,s=this.getScene().getEngine().useReverseDepthBuffer;o.y3.PerspectiveFovLHToRef(this.shadowAngle,1,s?a:n,s?n:a,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,s)}},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this},t.prototype.transferToNodeMaterialEffect=function(e,t){return this.computeTransformedInformation()?e.setFloat3(t,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):e.setFloat3(t,this.position.x,this.position.y,this.position.z),this},t.prototype.prepareLightSpecificDefines=function(e,t){e["POINTLIGHT"+t]=!0},(0,r.gn)([(0,n.qC)()],t.prototype,"shadowAngle",null),t}(c.O)},41691:(e,t,i)=>{i.d(t,{O:()=>c});var r=i(31191),n=i(96969),o=i(58095),a=i(43812),s=i(43048),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._needProjectionMatrixCompute=!0,t}return(0,r.ZT)(t,e),t.prototype._setPosition=function(e){this._position=e},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._setPosition(e)},enumerable:!1,configurable:!0}),t.prototype._setDirection=function(e){this._direction=e},Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._setDirection(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),t.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=o.P.Zero()),o.P.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=o.P.Zero()),o.P.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},t.prototype.getDepthScale=function(){return 50},t.prototype.getShadowDirection=function(e){return this.transformedDirection?this.transformedDirection:this.direction},t.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},t.prototype.setDirectionToTarget=function(e){return this.direction=o.P.Normalize(e.subtract(this.position)),this.direction},t.prototype.getRotation=function(){this.direction.normalize();var e=o.P.Cross(this.direction,s.RD.Y),t=o.P.Cross(e,this.direction);return o.P.RotationFromAxis(e,t,this.direction)},t.prototype.needCube=function(){return!1},t.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},t.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.position=o.P.Zero()},t.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},t.prototype.computeWorldMatrix=function(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=o.y3.Identity()),o.y3.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},t.prototype.getDepthMinZ=function(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ},t.prototype.getDepthMaxZ=function(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ},t.prototype.setShadowProjectionMatrix=function(e,t,i){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,i,e):this._setDefaultShadowProjectionMatrix(e,t,i),this},t.prototype._syncParentEnabledState=function(){e.prototype._syncParentEnabledState.call(this),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)},(0,r.gn)([(0,n.hd)()],t.prototype,"position",null),(0,r.gn)([(0,n.hd)()],t.prototype,"direction",null),(0,r.gn)([(0,n.qC)()],t.prototype,"shadowMinZ",null),(0,r.gn)([(0,n.qC)()],t.prototype,"shadowMaxZ",null),t}(a._)},96761:(e,t,i)=>{i.d(t,{P:()=>l});var r=i(31191),n=i(96969),o=i(58095),a=i(17834),s=i(43812),c=i(41691),u=i(73803);a.N.AddNodeConstructor("Light_Type_2",(function(e,t){return function(){return new l(e,o.P.Zero(),o.P.Zero(),0,0,t)}}));var l=function(e){function t(t,i,r,n,a,s){var c=e.call(this,t,s)||this;return c._innerAngle=0,c._projectionTextureMatrix=o.y3.Zero(),c._projectionTextureLightNear=1e-6,c._projectionTextureLightFar=1e3,c._projectionTextureUpDirection=o.P.Up(),c._projectionTextureViewLightDirty=!0,c._projectionTextureProjectionLightDirty=!0,c._projectionTextureDirty=!0,c._projectionTextureViewTargetVector=o.P.Zero(),c._projectionTextureViewLightMatrix=o.y3.Zero(),c._projectionTextureProjectionLightMatrix=o.y3.Zero(),c._projectionTextureScalingMatrix=o.y3.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),c.position=i,c.direction=r,c.angle=n,c.exponent=a,c}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(e){this._innerAngle=e,this._computeAngleValues()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(e){var i=this;this._projectionTexture!==e&&(this._projectionTexture=e,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(t._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((function(){i._markMeshesAsLightDirty()})):t._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((function(){i._markMeshesAsLightDirty()}))))},enumerable:!1,configurable:!0}),t._IsProceduralTexture=function(e){return void 0!==e.onGeneratedObservable},t._IsTexture=function(e){return void 0!==e.onLoadObservable},Object.defineProperty(t.prototype,"projectionTextureProjectionLightMatrix",{get:function(){return this._projectionTextureProjectionLightMatrix},set:function(e){this._projectionTextureProjectionLightMatrix=e,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"SpotLight"},t.prototype.getTypeID=function(){return s._.LIGHTTYPEID_SPOTLIGHT},t.prototype._setDirection=function(t){e.prototype._setDirection.call(this,t),this._projectionTextureViewLightDirty=!0},t.prototype._setPosition=function(t){e.prototype._setPosition.call(this,t),this._projectionTextureViewLightDirty=!0},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,i){var r=this.getScene().activeCamera;if(r){this._shadowAngleScale=this._shadowAngleScale||1;var n=this._shadowAngleScale*this._angle,a=void 0!==this.shadowMinZ?this.shadowMinZ:r.minZ,s=void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,c=this.getScene().getEngine().useReverseDepthBuffer;o.y3.PerspectiveFovLHToRef(n,1,c?s:a,c?a:s,e,!0,this._scene.getEngine().isNDCHalfZRange,void 0,c)}},t.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),o.y3.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},t.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var e=this.projectionTextureLightFar,t=this.projectionTextureLightNear,i=e/(e-t),r=-i*t,n=1/Math.tan(this._angle/2);o.y3.FromValuesToRef(n/1,0,0,0,0,n,0,0,0,0,i,1,0,0,r,0,this._projectionTextureProjectionLightMatrix)},t.prototype._computeProjectionTextureMatrix=function(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof u.x){var e=this._projectionTexture.uScale/2,t=this._projectionTexture.vScale/2;o.y3.FromValuesToRef(e,0,0,0,0,t,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},t.prototype.transferTexturesToEffect=function(e,t){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),e.setMatrix("textureProjectionMatrix"+t,this._projectionTextureMatrix),e.setTexture("projectionLightSampler"+t,this.projectionTexture)),this},t.prototype.transferToEffect=function(e,t){var i;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,t),i=o.P.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,t),i=o.P.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",i.x,i.y,i.z,this._cosHalfAngle,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,t),this},t.prototype.transferToNodeMaterialEffect=function(e,t){var i;return i=this.computeTransformedInformation()?o.P.Normalize(this.transformedDirection):o.P.Normalize(this.direction),this.getScene().useRightHandedSystem?e.setFloat3(t,-i.x,-i.y,-i.z):e.setFloat3(t,i.x,i.y,i.z),this},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},t.prototype.getDepthMinZ=function(e){var t=this._scene.getEngine(),i=void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ;return t.useReverseDepthBuffer&&t.isNDCHalfZRange?i:this._scene.getEngine().isNDCHalfZRange?0:i},t.prototype.getDepthMaxZ=function(e){var t=this._scene.getEngine(),i=void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ;return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:i},t.prototype.prepareLightSpecificDefines=function(e,t){e["SPOTLIGHT"+t]=!0,e["PROJECTEDLIGHTTEXTURE"+t]=!(!this.projectionTexture||!this.projectionTexture.isReady())},(0,r.gn)([(0,n.qC)()],t.prototype,"angle",null),(0,r.gn)([(0,n.qC)()],t.prototype,"innerAngle",null),(0,r.gn)([(0,n.qC)()],t.prototype,"shadowAngleScale",null),(0,r.gn)([(0,n.qC)()],t.prototype,"exponent",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"projectionTextureLightNear",null),(0,r.gn)([(0,n.qC)()],t.prototype,"projectionTextureLightFar",null),(0,r.gn)([(0,n.qC)()],t.prototype,"projectionTextureUpDirection",null),(0,r.gn)([(0,n.oU)("projectedLightTexture")],t.prototype,"_projectionTexture",void 0),t}(c.O)},32664:(e,t,i)=>{i.d(t,{vq:()=>F,NS:()=>n,n0:()=>v.n,OP:()=>v.O,Z0:()=>z.Z,UA:()=>w});var r=i(37290),n=function(){function e(e,t,i){void 0===t&&(t=""),void 0===i&&(i="black");var r=this;this._renderingCanvas=e,this._loadingText=t,this._loadingDivBackgroundColor=i,this._resizeLoadingUI=function(){var e=r._renderingCanvas.getBoundingClientRect(),t=window.getComputedStyle(r._renderingCanvas).position;r._loadingDiv&&(r._loadingDiv.style.position="fixed"===t?"fixed":"absolute",r._loadingDiv.style.left=e.left+"px",r._loadingDiv.style.top=e.top+"px",r._loadingDiv.style.width=e.width+"px",r._loadingDiv.style.height=e.height+"px")}}return e.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingDiv.style.display="grid",this._loadingDiv.style.gridTemplateRows="100%",this._loadingDiv.style.gridTemplateColumns="100%",this._loadingDiv.style.justifyItems="center",this._loadingDiv.style.alignItems="center",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.style.zIndex="1",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText,this._style=document.createElement("style"),this._style.type="text/css";this._style.innerHTML="@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }",document.getElementsByTagName("head")[0].appendChild(this._style);var t=!!window.SVGSVGElement,i=new Image;e.DefaultLogoUrl?i.src=e.DefaultLogoUrl:i.src=t?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+":"https://cdn.babylonjs.com/Assets/babylonLogo.png",i.style.width="150px",i.style.gridColumn="1",i.style.gridRow="1",i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)",i.style.position="absolute";var r=document.createElement("div");r.style.width="300px",r.style.gridColumn="1",r.style.gridRow="1",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)",r.style.position="absolute";var n=new Image;if(e.DefaultSpinnerUrl?n.src=e.DefaultSpinnerUrl:n.src=t?"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==":"https://cdn.babylonjs.com/Assets/loadingIcon.png",n.style.animation="spin1 0.75s infinite linear",n.style.webkitAnimation="spin1 0.75s infinite linear",n.style.transformOrigin="50% 50%",n.style.webkitTransformOrigin="50% 50%",!t){var o={w:16,h:18.5},a={w:30,h:30};i.style.width="".concat(o.w,"vh"),i.style.height="".concat(o.h,"vh"),i.style.left="calc(50% - ".concat(o.w/2,"vh)"),i.style.top="calc(50% - ".concat(o.h/2,"vh)"),n.style.width="".concat(a.w,"vh"),n.style.height="".concat(a.h,"vh"),n.style.left="calc(50% - ".concat(a.w/2,"vh)"),n.style.top="calc(50% - ".concat(a.h/2,"vh)")}r.appendChild(n),this._loadingDiv.appendChild(i),this._loadingDiv.appendChild(r),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},e.prototype.hideLoadingUI=function(){var e=this;if(this._loadingDiv){this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",(function(){e._loadingDiv&&(e._loadingDiv.parentElement&&e._loadingDiv.parentElement.removeChild(e._loadingDiv),e._loadingDiv=null),e._style&&(e._style.parentElement&&e._style.parentElement.removeChild(e._style),e._style=null),window.removeEventListener("resize",e._resizeLoadingUI)}))}},Object.defineProperty(e.prototype,"loadingUIText",{get:function(){return this._loadingText},set:function(e){this._loadingText=e,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!1,configurable:!0}),e.DefaultLogoUrl="",e.DefaultSpinnerUrl="",e}();r.D.DefaultLoadingScreenFactory=function(e){return new n(e)};var o=i(84318),a=i(2055),s=i(58095),c=i(15631),u=i(91243),l=i(63946),h=i(30700),p=i(98163),d=i(91855),f=i(44394),m=i(85790),g=i(4849),_=i(43812),y=i(85627),v=i(63407),b=i(57755),S=i(7701),C=i(85619),x=i(52106),T=i(27398),M=i(67087),N=i(86671),E=i(35731),P=i(4323),L=i(48620),I=i(13514),O=i(16142),w=!0,F=function(){function e(){}return e.LoaderInjectedPhysicsEngine=void 0,e}(),A={},D={},B=function(e,t,i,r){if(!t.materials)return null;for(var n=0,o=t.materials.length;n<o;n++){var a=t.materials[n];if(e(a))return{parsedMaterial:a,material:p.F.Parse(a,i,r)}}return null},R=function(e,t){return e+" of "+(t?t.file+" from "+t.name+" version: "+t.version+", exporter version: "+t.exporter_version:"unknown")},V=function(e,t){var i=t;if(t._waitingData.lods){if(t._waitingData.lods.ids&&t._waitingData.lods.ids.length>0){var r=t._waitingData.lods.ids,n=i.isEnabled(!1);if(t._waitingData.lods.distances){var o=t._waitingData.lods.distances;if(o.length>=r.length){var a=o.length>r.length?o[o.length-1]:0;i.setEnabled(!1);for(var s=0;s<r.length;s++){var c=r[s],u=e.getMeshById(c);null!=u&&i.addLODLevel(o[s],u)}a>0&&i.addLODLevel(a,null),!0===n&&i.setEnabled(!0)}else I.w1.Warn("Invalid level of detail distances for "+t.name)}}t._waitingData.lods=null}},U=function(e,t){return"number"!=typeof e?t.getLastEntryById(e):A[e]},k=function(e,t){return"number"!=typeof e?t.getLastMaterialById(e,!0):D[e]},j=function(e,t,i,r,n){void 0===n&&(n=!1);var s=new S.TJ(e),c="importScene has failed JSON parse";try{var y=JSON.parse(t);c="";var M=v.n.loggingLevel===v.n.DETAILED_LOGGING,N=void 0,E=void 0;if(void 0!==y.environmentTexture&&null!==y.environmentTexture){var I=void 0===y.isPBR||y.isPBR;if(y.environmentTextureType&&"BABYLON.HDRCubeTexture"===y.environmentTextureType){var w=y.environmentTextureSize?y.environmentTextureSize:128,F=new m.e((y.environmentTexture.match(/https?:\/\//g)?"":i)+y.environmentTexture,e,w,!0,!I,void 0,y.environmentTexturePrefilterOnLoad);y.environmentTextureRotationY&&(F.rotationY=y.environmentTextureRotationY),e.environmentTexture=F}else if("object"==typeof y.environmentTexture){var B=f.B.Parse(y.environmentTexture,e,i);e.environmentTexture=B}else if(y.environmentTexture.endsWith(".env")){var j=new f.B((y.environmentTexture.match(/https?:\/\//g)?"":i)+y.environmentTexture,e,y.environmentTextureForcedExtension);y.environmentTextureRotationY&&(j.rotationY=y.environmentTextureRotationY),e.environmentTexture=j}else{var z=f.B.CreateFromPrefilteredData((y.environmentTexture.match(/https?:\/\//g)?"":i)+y.environmentTexture,e,y.environmentTextureForcedExtension);y.environmentTextureRotationY&&(z.rotationY=y.environmentTextureRotationY),e.environmentTexture=z}if(!0===y.createDefaultSkybox){var G=void 0!==e.activeCamera&&null!==e.activeCamera?(e.activeCamera.maxZ-e.activeCamera.minZ)/2:1e3,H=y.skyboxBlurLevel||0;e.createDefaultSkybox(e.environmentTexture,I,G,H)}s.environmentTexture=e.environmentTexture}if(void 0!==y.environmentIntensity&&null!==y.environmentIntensity&&(e.environmentIntensity=y.environmentIntensity),void 0!==y.lights&&null!==y.lights)for(N=0,E=y.lights.length;N<E;N++){var W=y.lights[N];(Ne=_._.Parse(W,e))&&(A[W.uniqueId]=Ne,s.lights.push(Ne),Ne._parentContainer=s,c+=0===N?"\n\tLights:":"",c+="\n\t\t"+Ne.toString(M))}if(void 0!==y.reflectionProbes&&null!==y.reflectionProbes)for(N=0,E=y.reflectionProbes.length;N<E;N++){var Z=y.reflectionProbes[N],Y=P.x.Parse(Z,e,i);Y&&(s.reflectionProbes.push(Y),Y._parentContainer=s,c+=0===N?"\n\tReflection Probes:":"",c+="\n\t\t"+Y.toString(M))}if(void 0!==y.animations&&null!==y.animations)for(N=0,E=y.animations.length;N<E;N++){var X=y.animations[N],q=(0,L.q)("BABYLON.Animation");if(q){var K=q.Parse(X);e.animations.push(K),s.animations.push(K),c+=0===N?"\n\tAnimations:":"",c+="\n\t\t"+K.toString(M)}}if(void 0!==y.materials&&null!==y.materials)for(N=0,E=y.materials.length;N<E;N++){var Q=y.materials[N],$=p.F.Parse(Q,e,i);if($)D[Q.uniqueId||Q.id]=$,s.materials.push($),$._parentContainer=s,c+=0===N?"\n\tMaterials:":"",c+="\n\t\t"+$.toString(M),$.getActiveTextures().forEach((function(e){-1==s.textures.indexOf(e)&&(s.textures.push(e),e._parentContainer=s)}))}if(void 0!==y.multiMaterials&&null!==y.multiMaterials)for(N=0,E=y.multiMaterials.length;N<E;N++){var J=y.multiMaterials[N],ee=d.G.ParseMultiMaterial(J,e);D[J.uniqueId||J.id]=ee,s.multiMaterials.push(ee),ee._parentContainer=s,c+=0===N?"\n\tMultiMaterials:":"",c+="\n\t\t"+ee.toString(M),ee.getActiveTextures().forEach((function(e){-1==s.textures.indexOf(e)&&(s.textures.push(e),e._parentContainer=s)}))}if(void 0!==y.morphTargetManagers&&null!==y.morphTargetManagers)for(var te=0,ie=y.morphTargetManagers;te<ie.length;te++){var re=ie[te],ne=T.O.Parse(re,e);s.morphTargetManagers.push(ne),ne._parentContainer=s}if(void 0!==y.skeletons&&null!==y.skeletons)for(N=0,E=y.skeletons.length;N<E;N++){var oe=y.skeletons[N],ae=x.O.Parse(oe,e);s.skeletons.push(ae),ae._parentContainer=s,c+=0===N?"\n\tSkeletons:":"",c+="\n\t\t"+ae.toString(M)}var se=y.geometries;if(null!=se){var ce=new Array,ue=se.vertexData;if(null!=ue)for(N=0,E=ue.length;N<E;N++){var le=ue[N];ce.push(l.Z.Parse(le,e,i))}ce.forEach((function(e){e&&(s.geometries.push(e),e._parentContainer=s)}))}if(void 0!==y.transformNodes&&null!==y.transformNodes)for(N=0,E=y.transformNodes.length;N<E;N++){var he=y.transformNodes[N],pe=h.Y.Parse(he,e,i);A[he.uniqueId]=pe,s.transformNodes.push(pe),pe._parentContainer=s}if(void 0!==y.meshes&&null!==y.meshes)for(N=0,E=y.meshes.length;N<E;N++){var de=y.meshes[N],fe=u.Kj.Parse(de,e,i);if(A[de.uniqueId]=fe,s.meshes.push(fe),fe._parentContainer=s,fe.hasInstances)for(var me=0,ge=fe.instances;me<ge.length;me++){var _e=ge[me];s.meshes.push(_e),_e._parentContainer=s}c+=0===N?"\n\tMeshes:":"",c+="\n\t\t"+fe.toString(M)}if(void 0!==y.cameras&&null!==y.cameras)for(N=0,E=y.cameras.length;N<E;N++){var ye=y.cameras[N],ve=a.V.Parse(ye,e);A[ye.uniqueId]=ve,s.cameras.push(ve),ve._parentContainer=s,c+=0===N?"\n\tCameras:":"",c+="\n\t\t"+ve.toString(M)}if(void 0!==y.postProcesses&&null!==y.postProcesses)for(N=0,E=y.postProcesses.length;N<E;N++){var be=y.postProcesses[N],Se=O.D.Parse(be,e,i);Se&&(s.postProcesses.push(Se),Se._parentContainer=s,c+=0===N?"\nPostprocesses:":"",c+="\n\t\t"+Se.toString())}if(void 0!==y.animationGroups&&null!==y.animationGroups)for(N=0,E=y.animationGroups.length;N<E;N++){var Ce=y.animationGroups[N],xe=g.O.Parse(Ce,e);s.animationGroups.push(xe),xe._parentContainer=s,c+=0===N?"\n\tAnimationGroups:":"",c+="\n\t\t"+xe.toString(M)}for(N=0,E=e.cameras.length;N<E;N++){null!==(ve=e.cameras[N])._waitingParentId&&(ve.parent=U(ve._waitingParentId,e),ve._waitingParentId=null)}for(N=0,E=e.lights.length;N<E;N++){(Ne=e.lights[N])&&null!==Ne._waitingParentId&&(Ne.parent=U(Ne._waitingParentId,e),Ne._waitingParentId=null)}for(N=0,E=e.transformNodes.length;N<E;N++){var Te=e.transformNodes[N];null!==Te._waitingParentId&&(Te.parent=U(Te._waitingParentId,e),Te._waitingParentId=null)}for(N=0,E=e.meshes.length;N<E;N++){null!==(fe=e.meshes[N])._waitingParentId&&(fe.parent=U(fe._waitingParentId,e),fe._waitingParentId=null),fe._waitingData.lods&&V(e,fe)}for(e.multiMaterials.forEach((function(t){t._waitingSubMaterialsUniqueIds.forEach((function(i){t.subMaterials.push(k(i,e))})),t._waitingSubMaterialsUniqueIds=[]})),e.meshes.forEach((function(t){null!==t._waitingMaterialId&&(t.material=k(t._waitingMaterialId,e),t._waitingMaterialId=null)})),N=0,E=e.skeletons.length;N<E;N++){(ae=e.skeletons[N])._hasWaitingData&&(null!=ae.bones&&ae.bones.forEach((function(t){if(t._waitingTransformNodeId){var i=e.getLastEntryById(t._waitingTransformNodeId);i&&t.linkTransformNode(i),t._waitingTransformNodeId=null}})),ae._hasWaitingData=null)}for(N=0,E=e.meshes.length;N<E;N++){var Me=e.meshes[N];Me._waitingData.freezeWorldMatrix?(Me.freezeWorldMatrix(),Me._waitingData.freezeWorldMatrix=null):Me.computeWorldMatrix(!0)}for(N=0,E=e.lights.length;N<E;N++){var Ne;if((Ne=e.lights[N])._excludedMeshesIds.length>0){for(var Ee=0;Ee<Ne._excludedMeshesIds.length;Ee++){var Pe=e.getMeshById(Ne._excludedMeshesIds[Ee]);Pe&&Ne.excludedMeshes.push(Pe)}Ne._excludedMeshesIds=[]}if(Ne._includedOnlyMeshesIds.length>0){for(var Le=0;Le<Ne._includedOnlyMeshesIds.length;Le++){var Ie=e.getMeshById(Ne._includedOnlyMeshesIds[Le]);Ie&&Ne.includedOnlyMeshes.push(Ie)}Ne._includedOnlyMeshesIds=[]}}for(b.p.Parse(y,e,s,i),N=0,E=e.meshes.length;N<E;N++){(fe=e.meshes[N])._waitingData.actions&&(C.k.Parse(fe._waitingData.actions,fe,e),fe._waitingData.actions=null)}void 0!==y.actions&&null!==y.actions&&C.k.Parse(y.actions,null,e)}catch(e){var Oe=R("loadAssets",y?y.producer:"Unknown")+c;if(!r)throw o.Y.Log(Oe),e;r(Oe,e)}finally{A={},D={},n||s.removeAllFromScene(),null!==c&&v.n.loggingLevel!==v.n.NO_LOGGING&&o.Y.Log(R("loadAssets",y?y.producer:"Unknown")+(v.n.loggingLevel!==v.n.MINIMAL_LOGGING?c:""))}return s};v.n.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(e){return-1!==e.indexOf("babylon")},importMesh:function(e,t,i,r,n,a,s,c){var p,f="importMesh has failed JSON parse";try{var m=JSON.parse(i);f="";var g=v.n.loggingLevel===v.n.DETAILED_LOGGING;e?Array.isArray(e)||(e=[e]):e=null;var _=new Array,S=[];if(void 0!==m.transformNodes&&null!==m.transformNodes)for(var C=0,M=m.transformNodes.length;C<M;C++){var N=m.transformNodes[C];S.push(h.Y.Parse(N,t,r))}if(void 0!==m.meshes&&null!==m.meshes){var E=[],P=[],L=[],I=[],O=function(i,a){var c=m.meshes[i];if(null===e||function(e,t,i){for(var r in t)if(e.name===t[r])return i.push(e.id),!0;return void 0!==e.parentId&&-1!==i.indexOf(e.parentId)&&(i.push(e.id),!0)}(c,e,_)){if(null!==e&&delete e[e.indexOf(c.name)],void 0!==c.geometryId&&null!==c.geometryId&&void 0!==m.geometries&&null!==m.geometries){var h=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach((function(e){!0!==h&&m.geometries[e]&&Array.isArray(m.geometries[e])&&m.geometries[e].forEach((function(i){if(i.id===c.geometryId){if("vertexData"===e)l.Z.Parse(i,t,r);h=!0}}))})),!1===h&&o.Y.Warn("Geometry not found for mesh "+c.id)}if(c.materialUniqueId||c.materialId){var p=c.materialUniqueId?L:P,y=-1!==p.indexOf(c.materialUniqueId||c.materialId);if(!1===y&&void 0!==m.multiMaterials&&null!==m.multiMaterials)for(var v=function(e,i){p.push(e);var n=B(i,m,t,r);n&&n.material&&(D[n.parsedMaterial.uniqueId||n.parsedMaterial.id]=n.material,f+="\n\tMaterial "+n.material.toString(g))},b=0,S=m.multiMaterials.length;b<S;b++){var C=m.multiMaterials[b];if(c.materialUniqueId&&C.uniqueId===c.materialUniqueId||C.id===c.materialId){C.materialsUniqueIds?C.materialsUniqueIds.forEach((function(e){return v(e,(function(t){return t.uniqueId===e}))})):C.materials.forEach((function(e){return v(e,(function(t){return t.id===e}))})),p.push(C.uniqueId||C.id);var M=d.G.ParseMultiMaterial(C,t);D[C.uniqueId||C.id]=M,M&&(y=!0,f+="\n\tMulti-Material "+M.toString(g));break}}if(!1===y){p.push(c.materialUniqueId||c.materialId);var N=B((function(e){return c.materialUniqueId&&e.uniqueId===c.materialUniqueId||e.id===c.materialId}),m,t,r);N&&N.material?(D[N.parsedMaterial.uniqueId||N.parsedMaterial.id]=N.material,f+="\n\tMaterial "+N.material.toString(g)):o.Y.Warn("Material not found for mesh "+c.id)}}if(c.skeletonId>-1&&void 0!==m.skeletons&&null!==m.skeletons)if(!(E.indexOf(c.skeletonId)>-1))for(var O=0,w=m.skeletons.length;O<w;O++){var F=m.skeletons[O];if(F.id===c.skeletonId){var A=x.O.Parse(F,t);s.push(A),E.push(F.id),f+="\n\tSkeleton "+A.toString(g)}}if(c.morphTargetManagerId>-1&&void 0!==m.morphTargetManagers&&null!==m.morphTargetManagers)if(!(I.indexOf(c.morphTargetManagerId)>-1))for(var R=0,V=m.morphTargetManagers.length;R<V;R++){var U=m.morphTargetManagers[R];if(U.id===c.morphTargetManagerId){var k=T.O.Parse(U,t);I.push(k.uniqueId),f+="\nMorph target "+k.toString()}}var j=u.Kj.Parse(c,t,r);n.push(j),f+="\n\tMesh "+j.toString(g)}};for(C=0,M=m.meshes.length;C<M;C++)O(C);t.multiMaterials.forEach((function(e){e._waitingSubMaterialsUniqueIds.forEach((function(i){e.subMaterials.push(k(i,t))})),e._waitingSubMaterialsUniqueIds=[]})),t.meshes.forEach((function(e){null!==e._waitingMaterialId&&(e.material=k(e._waitingMaterialId,t),e._waitingMaterialId=null)}));for(C=0,M=t.transformNodes.length;C<M;C++){null!==(j=t.transformNodes[C])._waitingParentId&&(j.parent=t.getLastEntryById(j._waitingParentId),j._waitingParentId=null)}var w=void 0;for(C=0,M=t.meshes.length;C<M;C++){if((w=t.meshes[C])._waitingParentId){if(w.parent=t.getLastEntryById(w._waitingParentId),"TransformNode"===(null===(p=w.parent)||void 0===p?void 0:p.getClassName())){var F=S.indexOf(w.parent);F>-1&&S.splice(F,1)}w._waitingParentId=null}w._waitingData.lods&&V(t,w)}for(var A=0,U=S;A<U.length;A++){var j;(j=U[A]).dispose()}for(C=0,M=t.skeletons.length;C<M;C++){var z=t.skeletons[C];z._hasWaitingData&&(null!=z.bones&&z.bones.forEach((function(e){if(e._waitingTransformNodeId){var i=t.getLastEntryById(e._waitingTransformNodeId);i&&e.linkTransformNode(i),e._waitingTransformNodeId=null}})),z._hasWaitingData=null)}for(C=0,M=t.meshes.length;C<M;C++)(w=t.meshes[C])._waitingData.freezeWorldMatrix?(w.freezeWorldMatrix(),w._waitingData.freezeWorldMatrix=null):w.computeWorldMatrix(!0)}if(void 0!==m.particleSystems&&null!==m.particleSystems){var G=b.p.GetIndividualParser(y.l.NAME_PARTICLESYSTEM);if(G)for(C=0,M=m.particleSystems.length;C<M;C++){var H=m.particleSystems[C];-1!==_.indexOf(H.emitterId)&&a.push(G(H,t,r))}}return!0}catch(e){var W=R("importMesh",m?m.producer:"Unknown")+f;if(!c)throw o.Y.Log(W),e;c(W,e)}finally{null!==f&&v.n.loggingLevel!==v.n.NO_LOGGING&&o.Y.Log(R("importMesh",m?m.producer:"Unknown")+(v.n.loggingLevel!==v.n.MINIMAL_LOGGING?f:""))}return!1},load:function(e,t,i,r){var n="importScene has failed JSON parse";try{var a=JSON.parse(t);if(n="",void 0!==a.useDelayedTextureLoading&&null!==a.useDelayedTextureLoading&&(e.useDelayedTextureLoading=a.useDelayedTextureLoading&&!v.n.ForceFullSceneLoadingForIncremental),void 0!==a.autoClear&&null!==a.autoClear&&(e.autoClear=a.autoClear),void 0!==a.clearColor&&null!==a.clearColor&&(e.clearColor=c.HE.FromArray(a.clearColor)),void 0!==a.ambientColor&&null!==a.ambientColor&&(e.ambientColor=c.Wo.FromArray(a.ambientColor)),void 0!==a.gravity&&null!==a.gravity&&(e.gravity=s.P.FromArray(a.gravity)),void 0!==a.useRightHandedSystem&&(e.useRightHandedSystem=!!a.useRightHandedSystem),a.fogMode&&0!==a.fogMode)switch(e.fogMode=a.fogMode,e.fogColor=c.Wo.FromArray(a.fogColor),e.fogStart=a.fogStart,e.fogEnd=a.fogEnd,e.fogDensity=a.fogDensity,n+="\tFog mode for scene:  ",e.fogMode){case 1:n+="exp\n";break;case 2:n+="exp2\n";break;case 3:n+="linear\n"}if(a.physicsEnabled){var u=void 0;"cannon"===a.physicsEngine?u=new M.s(void 0,void 0,F.LoaderInjectedPhysicsEngine):"oimo"===a.physicsEngine?u=new N.A(void 0,F.LoaderInjectedPhysicsEngine):"ammo"===a.physicsEngine&&(u=new E.b(void 0,F.LoaderInjectedPhysicsEngine,void 0)),n="\tPhysics engine "+(a.physicsEngine?a.physicsEngine:"oimo")+" enabled\n";var l=a.physicsGravity?s.P.FromArray(a.physicsGravity):null;e.enablePhysics(l,u)}return void 0!==a.metadata&&null!==a.metadata&&(e.metadata=a.metadata),void 0!==a.collisionsEnabled&&null!==a.collisionsEnabled&&(e.collisionsEnabled=a.collisionsEnabled),!!j(e,t,i,r,!0)&&(a.autoAnimate&&e.beginAnimation(e,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),void 0!==a.activeCameraID&&null!==a.activeCameraID&&e.setActiveCameraById(a.activeCameraID),!0)}catch(e){var h=R("importScene",a?a.producer:"Unknown")+n;if(!r)throw o.Y.Log(h),e;r(h,e)}finally{null!==n&&v.n.loggingLevel!==v.n.NO_LOGGING&&o.Y.Log(R("importScene",a?a.producer:"Unknown")+(v.n.loggingLevel!==v.n.MINIMAL_LOGGING?n:""))}return!1},loadAssetContainer:function(e,t,i,r){return j(e,t,i,r)}});var z=i(43824)},63407:(e,t,i)=>{i.d(t,{O:()=>r,n:()=>d});var r,n=i(13514),o=i(62897),a=i(65273),s=i(37290),c=i(15210),u=i(84318),l=i(43824),h=i(79245),p=i(46223);!function(e){e[e.Clean=0]="Clean",e[e.Stop=1]="Stop",e[e.Sync=2]="Sync",e[e.NoSync=3]="NoSync"}(r||(r={}));var d=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return l.Z.ForceFullSceneLoadingForIncremental},set:function(e){l.Z.ForceFullSceneLoadingForIncremental=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return l.Z.ShowLoadingScreen},set:function(e){l.Z.ShowLoadingScreen=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return l.Z.loggingLevel},set:function(e){l.Z.loggingLevel=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return l.Z.CleanBoneMatrixWeights},set:function(e){l.Z.CleanBoneMatrixWeights=e},enumerable:!1,configurable:!0}),e.GetDefaultPlugin=function(){return e._RegisteredPlugins[".babylon"]},e._GetPluginForExtension=function(t){var i=e._RegisteredPlugins[t];return i||(u.Y.Warn("Unable to find a plugin to load "+t+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/how_to/load_from_any_file_type"),e.GetDefaultPlugin())},e._GetPluginForDirectLoad=function(t){for(var i in e._RegisteredPlugins){var r=e._RegisteredPlugins[i].plugin;if(r.canDirectLoad&&r.canDirectLoad(t))return e._RegisteredPlugins[i]}return e.GetDefaultPlugin()},e._GetPluginForFilename=function(t){var i=t.indexOf("?");-1!==i&&(t=t.substring(0,i));var r=t.lastIndexOf("."),n=t.substring(r,t.length).toLowerCase();return e._GetPluginForExtension(n)},e._GetDirectLoad=function(e){return"data:"===e.substr(0,5)?e.substr(5):null},e._FormatErrorMessage=function(e,t,i){var r="Unable to load from "+e.url;return t?r+=": ".concat(t):i&&(r+=": ".concat(i)),r},e._LoadData=function(t,i,r,n,o,a,c){var u,l=e._GetDirectLoad(t.url),p=c?e._GetPluginForExtension(c):l?e._GetPluginForDirectLoad(t.url):e._GetPluginForFilename(t.url);if(!(u=void 0!==p.plugin.createPlugin?p.plugin.createPlugin():p.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";if(e.OnPluginActivatedObservable.notifyObservers(u),l&&(u.canDirectLoad&&u.canDirectLoad(t.url)||!(0,h.VL)(t.url))){if(u.directLoad){var d=u.directLoad(i,l);d.then?d.then((function(e){r(u,e)})).catch((function(e){o("Error in directLoad of _loadData: "+e,e)})):r(u,d)}else r(u,l);return u}var f=p.isBinary,m=function(e,t){i.isDisposed?o("Scene has been disposed"):r(u,e,t)},g=null,_=!1,y=u.onDisposeObservable;y&&y.add((function(){_=!0,g&&(g.abort(),g=null),a()}));var v=function(){if(!_){var e=function(e,t){o(null==e?void 0:e.statusText,t)},r=t.file||t.url;g=u.loadFile?u.loadFile(i,r,m,n,f,e):i._loadFile(r,m,n,!0,f,e)}},b=i.getEngine(),S=b.enableOfflineSupport;if(S){for(var C=!1,x=0,T=i.disableOfflineSupportExceptionRules;x<T.length;x++){if(T[x].test(t.url)){C=!0;break}}S=!C}return S&&s.D.OfflineProviderFactory?i.offlineProvider=s.D.OfflineProviderFactory(t.url,v,b.disableManifestCheck):v(),u},e._GetFileInfo=function(e,t){var i,r,o=null;if(t)if(t.name){var a=t;i="file:".concat(a.name),r=a.name,o=a}else if("string"==typeof t&&t.startsWith("data:"))i=t,r="";else{var s=t;if("/"===s.substr(0,1))return n.w1.Error("Wrong sceneFilename parameter"),null;i=e+s,r=s}else i=e,r=n.w1.GetFilename(e),e=n.w1.GetFolderPath(e);return{url:i,rootUrl:e,name:r,file:o}},e.GetPluginForExtension=function(t){return e._GetPluginForExtension(t).plugin},e.IsPluginForExtensionAvailable=function(t){return!!e._RegisteredPlugins[t]},e.RegisterPlugin=function(t){if("string"==typeof t.extensions){var i=t.extensions;e._RegisteredPlugins[i.toLowerCase()]={plugin:t,isBinary:!1}}else{var r=t.extensions;Object.keys(r).forEach((function(i){e._RegisteredPlugins[i.toLowerCase()]={plugin:t,isBinary:r[i].isBinary}}))}},e.ImportMesh=function(t,i,r,n,o,a,s,l){if(void 0===r&&(r=""),void 0===n&&(n=c.l.LastCreatedScene),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),!n)return u.Y.Error("No scene available to import mesh to"),null;var h=e._GetFileInfo(i,r);if(!h)return null;var d={};n._addPendingData(d);var f=function(){n._removePendingData(d)},m=function(t,i){var r=e._FormatErrorMessage(h,t,i);s?s(n,r,new p.LH(r,p.SM.SceneLoaderError,i)):u.Y.Error(r),f()},g=a?function(e){try{a(e)}catch(e){m("Error in onProgress callback: "+e,e)}}:void 0,_=function(e,t,i,r,a,s,c){if(n.importedMeshesFiles.push(h.url),o)try{o(e,t,i,r,a,s,c)}catch(e){m("Error in onSuccess callback: "+e,e)}n._removePendingData(d)};return e._LoadData(h,n,(function(e,i,r){if(e.rewriteRootURL&&(h.rootUrl=e.rewriteRootURL(h.rootUrl,r)),e.importMesh){var o=e,a=new Array,s=new Array,c=new Array;if(!o.importMesh(t,n,i,h.rootUrl,a,s,c,m))return;n.loadingPluginName=e.name,_(a,s,c,[],[],[],[])}else{e.importMeshAsync(t,n,i,h.rootUrl,g,h.name).then((function(t){n.loadingPluginName=e.name,_(t.meshes,t.particleSystems,t.skeletons,t.animationGroups,t.transformNodes,t.geometries,t.lights)})).catch((function(e){m(e.message,e)}))}}),g,m,f,l)},e.ImportMeshAsync=function(t,i,r,n,o,a){return void 0===r&&(r=""),void 0===n&&(n=c.l.LastCreatedScene),void 0===o&&(o=null),void 0===a&&(a=null),new Promise((function(s,c){e.ImportMesh(t,i,r,n,(function(e,t,i,r,n,o,a){s({meshes:e,particleSystems:t,skeletons:i,animationGroups:r,transformNodes:n,geometries:o,lights:a})}),o,(function(e,t,i){c(i||new Error(t))}),a)}))},e.Load=function(t,i,r,o,s,u,l){return void 0===i&&(i=""),void 0===r&&(r=c.l.LastCreatedEngine),void 0===o&&(o=null),void 0===s&&(s=null),void 0===u&&(u=null),void 0===l&&(l=null),r?e.Append(t,i,new a.x(r),o,s,u,l):(n.w1.Error("No engine available"),null)},e.LoadAsync=function(t,i,r,n,o){return void 0===i&&(i=""),void 0===r&&(r=c.l.LastCreatedEngine),void 0===n&&(n=null),void 0===o&&(o=null),new Promise((function(a,s){e.Load(t,i,r,(function(e){a(e)}),n,(function(e,t,i){s(i||new Error(t))}),o)}))},e.Append=function(t,i,r,n,o,a,s){var l=this;if(void 0===i&&(i=""),void 0===r&&(r=c.l.LastCreatedScene),void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),!r)return u.Y.Error("No scene available to append to"),null;var h=e._GetFileInfo(t,i);if(!h)return null;e.ShowLoadingScreen&&!this._ShowingLoadingScreen&&(this._ShowingLoadingScreen=!0,r.getEngine().displayLoadingUI(),r.executeWhenReady((function(){r.getEngine().hideLoadingUI(),l._ShowingLoadingScreen=!1})));var d={};r._addPendingData(d);var f=function(){r._removePendingData(d)},m=function(t,i){var n=e._FormatErrorMessage(h,t,i);a?a(r,n,new p.LH(n,p.SM.SceneLoaderError,i)):u.Y.Error(n),f()},g=o?function(e){try{o(e)}catch(e){m("Error in onProgress callback",e)}}:void 0,_=function(){if(n)try{n(r)}catch(e){m("Error in onSuccess callback",e)}r._removePendingData(d)};return e._LoadData(h,r,(function(e,t){if(e.load){if(!e.load(r,t,h.rootUrl,m))return;r.loadingPluginName=e.name,_()}else{e.loadAsync(r,t,h.rootUrl,g,h.name).then((function(){r.loadingPluginName=e.name,_()})).catch((function(e){m(e.message,e)}))}}),g,m,f,s)},e.AppendAsync=function(t,i,r,n,o){return void 0===i&&(i=""),void 0===r&&(r=c.l.LastCreatedScene),void 0===n&&(n=null),void 0===o&&(o=null),new Promise((function(a,s){e.Append(t,i,r,(function(e){a(e)}),n,(function(e,t,i){s(i||new Error(t))}),o)}))},e.LoadAssetContainer=function(t,i,r,n,o,a,s){if(void 0===i&&(i=""),void 0===r&&(r=c.l.LastCreatedScene),void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),!r)return u.Y.Error("No scene available to load asset container to"),null;var l=e._GetFileInfo(t,i);if(!l)return null;var h={};r._addPendingData(h);var d=function(){r._removePendingData(h)},f=function(t,i){var n=e._FormatErrorMessage(l,t,i);a?a(r,n,new p.LH(n,p.SM.SceneLoaderError,i)):u.Y.Error(n),d()},m=o?function(e){try{o(e)}catch(e){f("Error in onProgress callback",e)}}:void 0,g=function(e){if(n)try{n(e)}catch(e){f("Error in onSuccess callback",e)}r._removePendingData(h)};return e._LoadData(l,r,(function(e,t){if(e.loadAssetContainer){var i=e.loadAssetContainer(r,t,l.rootUrl,f);if(!i)return;r.loadingPluginName=e.name,g(i)}else if(e.loadAssetContainerAsync){e.loadAssetContainerAsync(r,t,l.rootUrl,m,l.name).then((function(t){r.loadingPluginName=e.name,g(t)})).catch((function(e){f(e.message,e)}))}else f("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),m,f,d,s)},e.LoadAssetContainerAsync=function(t,i,r,n,o){return void 0===i&&(i=""),void 0===r&&(r=c.l.LastCreatedScene),void 0===n&&(n=null),void 0===o&&(o=null),new Promise((function(a,s){e.LoadAssetContainer(t,i,r,(function(e){a(e)}),n,(function(e,t,i){s(i||new Error(t))}),o)}))},e.ImportAnimations=function(e,t,i,n,o,a,s,l,h,p){if(void 0===t&&(t=""),void 0===i&&(i=c.l.LastCreatedScene),void 0===n&&(n=!0),void 0===o&&(o=r.Clean),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===h&&(h=null),void 0===p&&(p=null),i){if(n){for(var d=0,f=i.animatables;d<f.length;d++){f[d].reset()}i.stopAllAnimations(),i.animationGroups.slice().forEach((function(e){e.dispose()})),i.getNodes().forEach((function(e){e.animations&&(e.animations=[])}))}else switch(o){case r.Clean:i.animationGroups.slice().forEach((function(e){e.dispose()}));break;case r.Stop:i.animationGroups.forEach((function(e){e.stop()}));break;case r.Sync:i.animationGroups.forEach((function(e){e.reset(),e.restart()}));break;case r.NoSync:break;default:return void u.Y.Error("Unknown animation group loading mode value '"+o+"'")}var m=i.animatables.length;this.LoadAssetContainer(e,t,i,(function(e){e.mergeAnimationsTo(i,i.animatables.slice(m),a),e.dispose(),i.onAnimationFileImportedObservable.notifyObservers(i),s&&s(i)}),l,h,p)}else u.Y.Error("No scene available to load animations to")},e.ImportAnimationsAsync=function(t,i,n,o,a,s,u,l,h,p){return void 0===i&&(i=""),void 0===n&&(n=c.l.LastCreatedScene),void 0===o&&(o=!0),void 0===a&&(a=r.Clean),void 0===s&&(s=null),void 0===u&&(u=null),void 0===l&&(l=null),void 0===h&&(h=null),void 0===p&&(p=null),new Promise((function(r,c){e.ImportAnimations(t,i,n,o,a,s,(function(e){r(e)}),l,(function(e,t,i){c(i||new Error(t))}),p)}))},e.NO_LOGGING=0,e.MINIMAL_LOGGING=1,e.SUMMARY_LOGGING=2,e.DETAILED_LOGGING=3,e.OnPluginActivatedObservable=new o.y$,e._RegisteredPlugins={},e._ShowingLoadingScreen=!1,e}()},43824:(e,t,i)=>{i.d(t,{Z:()=>r});var r=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return e._ForceFullSceneLoadingForIncremental},set:function(t){e._ForceFullSceneLoadingForIncremental=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return e._ShowLoadingScreen},set:function(t){e._ShowLoadingScreen=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return e._LoggingLevel},set:function(t){e._LoggingLevel=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return e._CleanBoneMatrixWeights},set:function(t){e._CleanBoneMatrixWeights=t},enumerable:!1,configurable:!0}),e._ForceFullSceneLoadingForIncremental=!1,e._ShowLoadingScreen=!0,e._CleanBoneMatrixWeights=!1,e._LoggingLevel=0,e}()},17713:(e,t,i)=>{i.d(t,{I:()=>v});var r=i(31191),n=i(96969),o=i(7788),a=i(84318),s=i(58095),c=i(72208),u=i(90360),l=i(64849),h=i(74375),p=i(90622),d=i(73803),f=i(48620),m=i(46110),g=i(15631),_=(i(91699),i(83825),i(38309)),y=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.DIFFUSEDIRECTUV=0,t.GAMMADIFFUSE=!1,t.DIFFUSEHASALPHA=!1,t.OPACITYFRESNEL=!1,t.REFLECTIONBLUR=!1,t.REFLECTIONFRESNEL=!1,t.REFLECTIONFALLOFF=!1,t.TEXTURELODSUPPORT=!1,t.PREMULTIPLYALPHA=!1,t.USERGBCOLOR=!1,t.USEHIGHLIGHTANDSHADOWCOLORS=!1,t.BACKMAT_SHADOWONLY=!1,t.NOISE=!1,t.REFLECTIONBGR=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.EXPOSURE=!1,t.MULTIVIEW=!1,t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RGBDREFLECTION=!1,t.EQUIRECTANGULAR_RELFECTION_FOV=!1,t.MAINUV1=!1,t.MAINUV2=!1,t.UV1=!1,t.UV2=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.SHADOWFLOAT=!1,t.LOGARITHMICDEPTH=!1,t.NONUNIFORMSCALING=!1,t.ALPHATEST=!1,t.rebuild(),t}return(0,r.ZT)(t,e),t}(l.H),v=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.primaryColor=g.Wo.White(),r._primaryColorShadowLevel=0,r._primaryColorHighlightLevel=0,r.reflectionTexture=null,r.reflectionBlur=0,r.diffuseTexture=null,r._shadowLights=null,r.shadowLights=null,r.shadowLevel=0,r.sceneCenter=s.P.Zero(),r.opacityFresnel=!0,r.reflectionFresnel=!1,r.reflectionFalloffDistance=0,r.reflectionAmount=1,r.reflectionReflectance0=.05,r.reflectionReflectance90=.5,r.useRGBColor=!0,r.enableNoise=!1,r._fovMultiplier=1,r.useEquirectangularFOV=!1,r._maxSimultaneousLights=4,r.maxSimultaneousLights=4,r._shadowOnly=!1,r.shadowOnly=!1,r._imageProcessingObserver=null,r.switchToBGR=!1,r._renderTargets=new o.t(16),r._reflectionControls=s.Lt.Zero(),r._white=g.Wo.White(),r._primaryShadowColor=g.Wo.Black(),r._primaryHighlightColor=g.Wo.Black(),r._attachImageProcessingConfiguration(null),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),r._diffuseTexture&&r._diffuseTexture.isRenderTarget&&r._renderTargets.push(r._diffuseTexture),r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),r._renderTargets},r}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"_perceptualColor",{get:function(){return this.__perceptualColor},set:function(e){this.__perceptualColor=e,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorShadowLevel",{get:function(){return this._primaryColorShadowLevel},set:function(e){this._primaryColorShadowLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorHighlightLevel",{get:function(){return this._primaryColorHighlightLevel},set:function(e){this._primaryColorHighlightLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionStandardFresnelWeight",{set:function(e){var i=e;i<.5?(i*=2,this.reflectionReflectance0=t.StandardReflectance0*i,this.reflectionReflectance90=t.StandardReflectance90*i):(i=2*i-1,this.reflectionReflectance0=t.StandardReflectance0+(1-t.StandardReflectance0)*i,this.reflectionReflectance90=t.StandardReflectance90+(1-t.StandardReflectance90)*i)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._fovMultiplier},set:function(e){isNaN(e)&&(e=1),this._fovMultiplier=Math.max(0,Math.min(2,e))},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){t._computePrimaryColorFromPerceptualColor(),t._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)},enumerable:!1,configurable:!0}),t.prototype.needAlphaTesting=function(){return!0},t.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||this._shadowOnly},t.prototype.isReadyForSubMesh=function(e,t,i){if(void 0===i&&(i=!1),t.effect&&this.isFrozen&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new y);var r=this.getScene(),n=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(u.G.PrepareDefinesForLights(r,e,n,!1,this._maxSimultaneousLights),n._needNormals=!0,u.G.PrepareDefinesForMultiview(r,n),n._areTexturesDirty){if(n._needUVs=!1,r.texturesEnabled){if(r.getEngine().getCaps().textureLOD&&(n.TEXTURELODSUPPORT=!0),this._diffuseTexture&&m.k.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;u.G.PrepareDefinesForMergedUV(this._diffuseTexture,n,"DIFFUSE"),n.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,n.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,n.OPACITYFRESNEL=this._opacityFresnel}else n.DIFFUSE=!1,n.DIFFUSEHASALPHA=!1,n.GAMMADIFFUSE=!1,n.OPACITYFRESNEL=!1;var s=this._reflectionTexture;if(s&&m.k.ReflectionTextureEnabled){if(!s.isReadyOrNotBlocking())return!1;switch(n.REFLECTION=!0,n.GAMMAREFLECTION=s.gammaSpace,n.RGBDREFLECTION=s.isRGBD,n.REFLECTIONBLUR=this._reflectionBlur>0,n.LODINREFLECTIONALPHA=s.lodLevelInAlpha,n.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,n.REFLECTIONBGR=this.switchToBGR,s.coordinatesMode===d.x.INVCUBIC_MODE&&(n.INVERTCUBICMAP=!0),n.REFLECTIONMAP_3D=s.isCube,n.REFLECTIONMAP_OPPOSITEZ=n.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!s.invertZ:s.invertZ,s.coordinatesMode){case d.x.EXPLICIT_MODE:n.REFLECTIONMAP_EXPLICIT=!0;break;case d.x.PLANAR_MODE:n.REFLECTIONMAP_PLANAR=!0;break;case d.x.PROJECTION_MODE:n.REFLECTIONMAP_PROJECTION=!0;break;case d.x.SKYBOX_MODE:n.REFLECTIONMAP_SKYBOX=!0;break;case d.x.SPHERICAL_MODE:n.REFLECTIONMAP_SPHERICAL=!0;break;case d.x.EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case d.x.FIXED_EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case d.x.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case d.x.CUBIC_MODE:case d.x.INVCUBIC_MODE:default:n.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(n.REFLECTIONFRESNEL=!0,n.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(n.REFLECTIONFRESNEL=!1,n.REFLECTIONFALLOFF=!1)}else n.REFLECTION=!1,n.REFLECTIONFRESNEL=!1,n.REFLECTIONFALLOFF=!1,n.REFLECTIONBLUR=!1,n.REFLECTIONMAP_3D=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.INVERTCUBICMAP=!1,n.REFLECTIONMAP_OPPOSITEZ=!1,n.LODINREFLECTIONALPHA=!1,n.GAMMAREFLECTION=!1,n.RGBDREFLECTION=!1}n.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,n.USERGBCOLOR=this._useRGBColor,n.NOISE=this._enableNoise}if(n._areLightsDirty&&(n.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(0!==this._primaryColorShadowLevel||0!==this._primaryColorHighlightLevel),n.BACKMAT_SHADOWONLY=this._shadowOnly),n._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(n)}if(u.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),u.G.PrepareDefinesForFrameBoundValues(r,o,n,i,null,t.getRenderingMesh().hasThinInstances),u.G.PrepareDefinesForAttributes(e,n,!1,!0,!1)&&e&&(r.getEngine().getCaps().standardDerivatives||e.isVerticesDataPresent(c.o.NormalKind)||(e.createNormals(!0),a.Y.Warn("BackgroundMaterial: Normals have been created for the mesh: "+e.name))),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var l=new _.L;n.FOG&&l.addFallback(0,"FOG"),n.POINTSIZE&&l.addFallback(1,"POINTSIZE"),n.MULTIVIEW&&l.addFallback(0,"MULTIVIEW"),u.G.HandleFallbacksForShadows(n,l,this._maxSimultaneousLights);var h=[c.o.PositionKind];n.NORMAL&&h.push(c.o.NormalKind),n.UV1&&h.push(c.o.UVKind),n.UV2&&h.push(c.o.UV2Kind),u.G.PrepareAttributesForBones(h,e,n,l),u.G.PrepareAttributesForInstances(h,n);var f=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],g=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],v=["Material","Scene"];p.$&&(p.$.PrepareUniforms(f,n),p.$.PrepareSamplers(g,n)),u.G.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:v,samplers:g,defines:n,maxSimultaneousLights:this._maxSimultaneousLights});var b=n.toString(),S=r.getEngine().createEffect("background",{attributes:h,uniformsNames:f,uniformBuffersNames:v,samplers:g,defines:b,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},o);t.setEffect(S,n,this._materialContext),this.buildUniformLayout()}return!(!t.effect||!t.effect.isReady())&&(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype._computePrimaryColorFromPerceptualColor=function(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())},t.prototype._computePrimaryColors=function(){0===this._primaryColorShadowLevel&&0===this._primaryColorHighlightLevel||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))},t.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},t.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),e.prototype.unbind.call(this)},t.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},t.prototype.bindForSubMesh=function(e,t,i){var r=this.getScene(),n=i.materialDefines;if(n){var o=i.effect;if(o){this._activeEffect=o,this.bindOnlyWorldMatrix(e),u.G.BindBonesParameters(t,this._activeEffect);var a=this._mustRebind(r,o,t.visibility);if(a){this._uniformBuffer.bindToEffect(o,"Material"),this.bindViewProjection(o);var s=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(r.texturesEnabled&&(this._diffuseTexture&&m.k.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),u.G.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),s&&m.k.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",s.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",s.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",s.getSize().width,s.lodGenerationScale,s.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),n.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),r.texturesEnabled&&(this._diffuseTexture&&m.k.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),s&&m.k.ReflectionTextureEnabled&&(n.REFLECTIONBLUR&&n.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",s):n.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",s._lodTextureMid||s),this._uniformBuffer.setTexture("reflectionSamplerLow",s._lodTextureLow||s),this._uniformBuffer.setTexture("reflectionSamplerHigh",s._lodTextureHigh||s)):this._uniformBuffer.setTexture("reflectionSampler",s),n.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),u.G.BindClipPlane(this._activeEffect,r),r.bindEyePosition(o)}else r.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._uniformBuffer.bindToEffect(o,"Material"),this._needToBindSceneUbo=!0);!a&&this.isFrozen||(r.lightsEnabled&&u.G.BindLights(r,t,this._activeEffect,n,this._maxSimultaneousLights),this.bindView(o),u.G.BindFogParameters(r,t,this._activeEffect,!0),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(t,this._activeEffect),this._uniformBuffer.update()}}},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this._reflectionTexture===t||this._diffuseTexture===t)},t.prototype.dispose=function(t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),i&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return n.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.BackgroundMaterial",t},t.prototype.getClassName=function(){return"BackgroundMaterial"},t.Parse=function(e,i,r){return n.p4.Parse((function(){return new t(e.name,i)}),e,i,r)},t.StandardReflectance0=.05,t.StandardReflectance90=.5,(0,r.gn)([(0,n.n9)()],t.prototype,"_primaryColor",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColor",void 0),(0,r.gn)([(0,n.n9)()],t.prototype,"__perceptualColor",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_primaryColorShadowLevel",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_primaryColorHighlightLevel",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColorHighlightLevel",null),(0,r.gn)([(0,n.oU)()],t.prototype,"_reflectionTexture",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_reflectionBlur",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionBlur",void 0),(0,r.gn)([(0,n.oU)()],t.prototype,"_diffuseTexture",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLights",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_shadowLevel",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLevel",void 0),(0,r.gn)([(0,n.hd)()],t.prototype,"_sceneCenter",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"sceneCenter",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_opacityFresnel",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityFresnel",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_reflectionFresnel",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFresnel",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_reflectionFalloffDistance",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFalloffDistance",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_reflectionAmount",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionAmount",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_reflectionReflectance0",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance0",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_reflectionReflectance90",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance90",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_useRGBColor",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRGBColor",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_enableNoise",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableNoise",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_maxSimultaneousLights",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"maxSimultaneousLights",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"_shadowOnly",void 0),(0,r.gn)([(0,n.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"shadowOnly",void 0),(0,r.gn)([(0,n.rX)()],t.prototype,"_imageProcessingConfiguration",void 0),t}(h.a);(0,f.H)("BABYLON.BackgroundMaterial",v)},99625:(e,t,i)=>{i.d(t,{I:()=>r.I});var r=i(17713)},853:(e,t,i)=>{i.d(t,{K:()=>u});var r=i(31191),n=i(89592),o=i(89762),a=i(70848),s=i(48620),c=i(73803),u=function(e){function t(t){var i=e.call(this,t,a.u.VertexAndFragment)||this;return i._samplerName="textureSampler",i.convertToGammaSpace=!1,i.convertToLinearSpace=!1,i._isUnique=!1,i.registerInput("uv",o.E.Vector2,!1,a.u.VertexAndFragment),i.registerOutput("rgba",o.E.Color4,a.u.Neutral),i.registerOutput("rgb",o.E.Color3,a.u.Neutral),i.registerOutput("r",o.E.Float,a.u.Neutral),i.registerOutput("g",o.E.Float,a.u.Neutral),i.registerOutput("b",o.E.Float,a.u.Neutral),i.registerOutput("a",o.E.Float,a.u.Neutral),i._inputs[0].acceptedConnectionPointTypes.push(o.E.Vector3),i._inputs[0].acceptedConnectionPointTypes.push(o.E.Vector4),i._inputs[0]._prioritizeVertex=!1,i}return(0,r.ZT)(t,e),t.prototype.getClassName=function(){return"CurrentScreenBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("textureSampler")},Object.defineProperty(t.prototype,"target",{get:function(){return this.uv.isConnected?this.uv.sourceBlock.isInput?a.u.VertexAndFragment:a.u.Fragment:a.u.VertexAndFragment},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,t,i){i.setValue(this._linearDefineName,this.convertToGammaSpace,!0),i.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype._injectVertexCode=function(e){var t=this.uv;t.connectedPoint.ownerBlock.isInput&&(t.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(t.associatedVariableName,"vec2"));if(this._mainUVName="vMain"+t.associatedVariableName,e._emitVaryingFromString(this._mainUVName,"vec2"),e.compilationString+="".concat(this._mainUVName," = ").concat(t.associatedVariableName,".xy;\r\n"),this._outputs.some((function(e){return e.isConnectedInVertexShader}))){this._writeTextureRead(e,!0);for(var i=0,r=this._outputs;i<r.length;i++){var n=r[i];n.hasEndpoints&&this._writeOutput(e,n,n.name,!0)}}},t.prototype._writeTextureRead=function(e,t){void 0===t&&(t=!1);var i=this.uv;if(t){if(e.target===a.u.Fragment)return;e.compilationString+="vec4 ".concat(this._tempTextureRead," = texture2D(").concat(this._samplerName,", ").concat(i.associatedVariableName,");\r\n")}else this.uv.ownerBlock.target!==a.u.Fragment?e.compilationString+="vec4 ".concat(this._tempTextureRead," = texture2D(").concat(this._samplerName,", ").concat(this._mainUVName,");\r\n"):e.compilationString+="vec4 ".concat(this._tempTextureRead," = texture2D(").concat(this._samplerName,", ").concat(i.associatedVariableName,");\r\n")},t.prototype._writeOutput=function(e,t,i,r){if(void 0===r&&(r=!1),r){if(e.target===a.u.Fragment)return;e.compilationString+="".concat(this._declareOutput(t,e)," = ").concat(this._tempTextureRead,".").concat(i,";\r\n")}else this.uv.ownerBlock.target!==a.u.Fragment?(e.compilationString+="".concat(this._declareOutput(t,e)," = ").concat(this._tempTextureRead,".").concat(i,";\r\n"),e.compilationString+="#ifdef ".concat(this._linearDefineName,"\r\n"),e.compilationString+="".concat(t.associatedVariableName," = toGammaSpace(").concat(t.associatedVariableName,");\r\n"),e.compilationString+="#endif\r\n",e.compilationString+="#ifdef ".concat(this._gammaDefineName,"\r\n"),e.compilationString+="".concat(t.associatedVariableName," = toLinearSpace(").concat(t.associatedVariableName,");\r\n"),e.compilationString+="#endif\r\n"):e.compilationString+="".concat(this._declareOutput(t,e)," = ").concat(this._tempTextureRead,".").concat(i,";\r\n")},t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),this._tempTextureRead=t._getFreeVariableName("tempTextureRead"),t.sharedData.blockingBlocks.indexOf(this)<0&&t.sharedData.blockingBlocks.push(this),t.sharedData.textureBlocks.indexOf(this)<0&&t.sharedData.textureBlocks.push(this),t.sharedData.blocksWithDefines.indexOf(this)<0&&t.sharedData.blocksWithDefines.push(this),t.target!==a.u.Fragment)return t._emit2DSampler(this._samplerName),void this._injectVertexCode(t);if(this._outputs.some((function(e){return e.isConnectedInFragmentShader}))){t._emit2DSampler(this._samplerName),this._linearDefineName=t._getFreeDefineName("ISLINEAR"),this._gammaDefineName=t._getFreeDefineName("ISGAMMA");var i="//".concat(this.name);t._emitFunctionFromInclude("helperFunctions",i),this._writeTextureRead(t);for(var r=0,n=this._outputs;r<n.length;r++){var o=n[r];o.hasEndpoints&&this._writeOutput(t,o,o.name)}return this}},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.convertToGammaSpace=this.convertToGammaSpace,t.convertToLinearSpace=this.convertToLinearSpace,this.texture&&!this.texture.isRenderTarget&&(t.texture=this.texture.serialize()),t},t.prototype._deserialize=function(t,i,r){e.prototype._deserialize.call(this,t,i,r),this.convertToGammaSpace=t.convertToGammaSpace,this.convertToLinearSpace=!!t.convertToLinearSpace,t.texture&&(r=0===t.texture.url.indexOf("data:")?"":r,this.texture=c.x.Parse(t.texture,i,r))},t}(n.k);(0,s.H)("BABYLON.CurrentScreenBlock",u)},33325:(e,t,i)=>{i.d(t,{x1:()=>M,K0:()=>C.K,rY:()=>h,SV:()=>v,bl:()=>p,TB:()=>S,r0:()=>T,Mc:()=>b});var r=i(31191),n=i(89592),o=i(89762),a=i(69958),s=i(70848),c=i(90360),u=i(62976),l=i(48620),h=(i(62495),function(e){function t(t){var i=e.call(this,t,s.u.VertexAndFragment,!1)||this;return i.registerInput("worldPosition",o.E.Vector4,!1,s.u.Vertex),i.registerInput("view",o.E.Matrix,!1,s.u.Vertex),i.registerInput("input",o.E.Color3,!1,s.u.Fragment),i.registerInput("fogColor",o.E.Color3,!1,s.u.Fragment),i.registerOutput("output",o.E.Color3,s.u.Fragment),i.input.acceptedConnectionPointTypes.push(o.E.Color4),i.fogColor.acceptedConnectionPointTypes.push(o.E.Color4),i}return(0,r.ZT)(t,e),t.prototype.getClassName=function(){return"FogBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fogColor",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.view.isConnected){var t=e.getInputBlockByPredicate((function(e){return e.systemValue===a.$.View}));t||(t=new u.S("view")).setAsSystemValue(a.$.View),t.output.connectTo(this.view)}if(!this.fogColor.isConnected){var i=e.getInputBlockByPredicate((function(e){return e.systemValue===a.$.FogColor}));i||(i=new u.S("fogColor",void 0,o.E.Color3)).setAsSystemValue(a.$.FogColor),i.output.connectTo(this.fogColor)}},t.prototype.prepareDefines=function(e,t,i){var r=e.getScene();i.setValue("FOG",t.fogEnabled&&c.G.GetFogState(e,r))},t.prototype.bind=function(e,t,i){if(i){var r=i.getScene();e.setFloat4(this._fogParameters,r.fogMode,r.fogStart,r.fogEnd,r.fogDensity)}},t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),t.target===s.u.Fragment){t.sharedData.blocksWithDefines.push(this),t.sharedData.bindableBlocks.push(this),t._emitFunctionFromInclude("fogFragmentDeclaration","//".concat(this.name),{removeUniforms:!0,removeVaryings:!0,removeIfDef:!1,replaceStrings:[{search:/float CalcFogFactor\(\)/,replace:"float CalcFogFactor(vec3 vFogDistance, vec4 vFogInfos)"}]});var i=t._getFreeVariableName("fog"),r=this.input,n=this.fogColor;this._fogParameters=t._getFreeVariableName("fogParameters");var o=this._outputs[0];t._emitUniformFromString(this._fogParameters,"vec4"),t.compilationString+="#ifdef FOG\r\n",t.compilationString+="float ".concat(i," = CalcFogFactor(").concat(this._fogDistanceName,", ").concat(this._fogParameters,");\r\n"),t.compilationString+=this._declareOutput(o,t)+" = ".concat(i," * ").concat(r.associatedVariableName,".rgb + (1.0 - ").concat(i,") * ").concat(n.associatedVariableName,".rgb;\r\n"),t.compilationString+="#else\r\n".concat(this._declareOutput(o,t)," =  ").concat(r.associatedVariableName,".rgb;\r\n"),t.compilationString+="#endif\r\n"}else{var a=this.worldPosition,c=this.view;this._fogDistanceName=t._getFreeVariableName("vFogDistance"),t._emitVaryingFromString(this._fogDistanceName,"vec3"),t.compilationString+="".concat(this._fogDistanceName," = (").concat(c.associatedVariableName," * ").concat(a.associatedVariableName,").xyz;\r\n")}return this},t}(n.k));(0,l.H)("BABYLON.FogBlock",h);i(46545),i(50682),i(46462),i(70089),i(87954),i(54081),i(43921),i(6506),i(16744);var p=function(e){function t(t){var i=e.call(this,t,s.u.VertexAndFragment)||this;return i._isUnique=!0,i.registerInput("worldPosition",o.E.Vector4,!1,s.u.Vertex),i.registerInput("worldNormal",o.E.Vector4,!1,s.u.Fragment),i.registerInput("cameraPosition",o.E.Vector3,!1,s.u.Fragment),i.registerInput("glossiness",o.E.Float,!0,s.u.Fragment),i.registerInput("glossPower",o.E.Float,!0,s.u.Fragment),i.registerInput("diffuseColor",o.E.Color3,!0,s.u.Fragment),i.registerInput("specularColor",o.E.Color3,!0,s.u.Fragment),i.registerInput("view",o.E.Matrix,!0),i.registerOutput("diffuseOutput",o.E.Color3,s.u.Fragment),i.registerOutput("specularOutput",o.E.Color3,s.u.Fragment),i.registerOutput("shadow",o.E.Float,s.u.Fragment),i}return(0,r.ZT)(t,e),t.prototype.getClassName=function(){return"LightBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glossiness",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glossPower",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularColor",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseOutput",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularOutput",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadow",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.cameraPosition.isConnected){var t=e.getInputBlockByPredicate((function(e){return e.systemValue===a.$.CameraPosition}));t||(t=new u.S("cameraPosition")).setAsSystemValue(a.$.CameraPosition),t.output.connectTo(this.cameraPosition)}},t.prototype.prepareDefines=function(e,t,i){if(i._areLightsDirty){var r=e.getScene();if(this.light){var n={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};c.G.PrepareDefinesForLight(r,e,this.light,this._lightId,i,!0,n),n.needRebuild&&i.rebuild()}else c.G.PrepareDefinesForLights(r,e,i,!0,t.maxSimultaneousLights)}},t.prototype.updateUniformsAndSamples=function(e,t,i,r){for(var n=0;n<t.maxSimultaneousLights&&i["LIGHT"+n];n++){var o=e.uniforms.indexOf("vLightData"+n)>=0;c.G.PrepareUniformsAndSamplersForLight(n,e.uniforms,e.samplers,i["PROJECTEDLIGHTTEXTURE"+n],r,o)}},t.prototype.bind=function(e,t,i){if(i){var r=i.getScene();this.light?c.G.BindLight(this.light,this._lightId,r,e,!0):c.G.BindLights(r,i,e,!0,t.maxSimultaneousLights)}},t.prototype._injectVertexCode=function(e){var t=this.worldPosition,i="//".concat(this.name);this.light?(this._lightId=(void 0!==e.counters.lightCounter?e.counters.lightCounter:-1)+1,e.counters.lightCounter=this._lightId,e._emitFunctionFromInclude(e.supportUniformBuffers?"lightVxUboDeclaration":"lightVxFragmentDeclaration",i,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(e._emitFunctionFromInclude(e.supportUniformBuffers?"lightVxUboDeclaration":"lightVxFragmentDeclaration",i,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,e.sharedData.dynamicUniformBlocks.push(this));var r="v_"+t.associatedVariableName;e._emitVaryingFromString(r,"vec4")&&(e.compilationString+="".concat(r," = ").concat(t.associatedVariableName,";\r\n")),this.light?e.compilationString+=e._emitCodeFromInclude("shadowsVertex",i,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:t.associatedVariableName}]}):(e.compilationString+="vec4 worldPos = ".concat(t.associatedVariableName,";\r\n"),this.view.isConnected&&(e.compilationString+="mat4 view = ".concat(this.view.associatedVariableName,";\r\n")),e.compilationString+=e._emitCodeFromInclude("shadowsVertex",i,{repeatKey:"maxSimultaneousLights"}))},t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),t.target===s.u.Fragment){t.sharedData.forcedBindableBlocks.push(this),t.sharedData.blocksWithDefines.push(this);var i="//".concat(this.name),r=this.worldPosition;t._emitFunctionFromInclude("helperFunctions",i),t._emitFunctionFromInclude("lightsFragmentFunctions",i,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+r.associatedVariableName+".xyz"}]}),t._emitFunctionFromInclude("shadowsFragmentFunctions",i,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+r.associatedVariableName+".xyz"}]}),this.light?t._emitFunctionFromInclude(t.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",i,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):t._emitFunctionFromInclude(t.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",i,{repeatKey:"maxSimultaneousLights"}),0===this._lightId&&(t._registerTempVariable("viewDirectionW")&&(t.compilationString+="vec3 viewDirectionW = normalize(".concat(this.cameraPosition.associatedVariableName," - ").concat("v_"+r.associatedVariableName,".xyz);\r\n")),t.compilationString+="lightingInfo info;\r\n",t.compilationString+="float shadow = 1.;\r\n",t.compilationString+="float glossiness = ".concat(this.glossiness.isConnected?this.glossiness.associatedVariableName:"1.0"," * ").concat(this.glossPower.isConnected?this.glossPower.associatedVariableName:"1024.0",";\r\n"),t.compilationString+="vec3 diffuseBase = vec3(0., 0., 0.);\r\n",t.compilationString+="vec3 specularBase = vec3(0., 0., 0.);\r\n",t.compilationString+="vec3 normalW = ".concat(this.worldNormal.associatedVariableName,".xyz;\r\n")),this.light?t.compilationString+=t._emitCodeFromInclude("lightFragment",i,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):t.compilationString+=t._emitCodeFromInclude("lightFragment",i,{repeatKey:"maxSimultaneousLights"});var n=this.diffuseOutput,o=this.specularOutput;return t.compilationString+=this._declareOutput(n,t)+" = diffuseBase".concat(this.diffuseColor.isConnected?" * "+this.diffuseColor.associatedVariableName:"",";\r\n"),o.hasEndpoints&&(t.compilationString+=this._declareOutput(o,t)+" = specularBase".concat(this.specularColor.isConnected?" * "+this.specularColor.associatedVariableName:"",";\r\n")),this.shadow.hasEndpoints&&(t.compilationString+=this._declareOutput(this.shadow,t)+" = shadow;\r\n"),this}this._injectVertexCode(t)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return this.light&&(t.lightId=this.light.id),t},t.prototype._deserialize=function(t,i,r){e.prototype._deserialize.call(this,t,i,r),t.lightId&&(this.light=i.getLightById(t.lightId))},t}(n.k);(0,l.H)("BABYLON.LightBlock",p);var d=i(96979),f=i(97163),m=i(73803),g=i(44337),_=i(93682),y=i(15210),v=function(e){function t(i){var r=e.call(this,i,s.u.VertexAndFragment)||this;return r.registerOutput("source",o.E.Object,s.u.VertexAndFragment,new _.C("source",r,d.Ab.Output,t,"ImageSourceBlock")),r}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){var t,i=this;if(this._texture!==e){var r=null!==(t=null==e?void 0:e.getScene())&&void 0!==t?t:y.l.LastCreatedScene;!e&&r&&r.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(i._texture)})),this._texture=e,e&&r&&r.markAllMaterialsAsDirty(1,(function(t){return t.hasTexture(e)}))}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"samplerName",{get:function(){return this._samplerName},enumerable:!1,configurable:!0}),t.prototype.bind=function(e){this.texture&&e.setTexture(this._samplerName,this.texture)},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype.getClassName=function(){return"ImageSourceBlock"},Object.defineProperty(t.prototype,"source",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){return e.prototype._buildBlock.call(this,t),t.target===s.u.Vertex&&(this._samplerName=t._getFreeVariableName(this.name+"Sampler"),t.sharedData.blockingBlocks.push(this),t.sharedData.textureBlocks.push(this),t.sharedData.bindableBlocks.push(this)),t._emit2DSampler(this._samplerName),this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);return this.texture?(t+="".concat(this._codeVariableName,'.texture = new BABYLON.Texture("').concat(this.texture.name,'", null, ').concat(this.texture.noMipmap,", ").concat(this.texture.invertY,", ").concat(this.texture.samplingMode,");\r\n"),t+="".concat(this._codeVariableName,".texture.wrapU = ").concat(this.texture.wrapU,";\r\n"),t+="".concat(this._codeVariableName,".texture.wrapV = ").concat(this.texture.wrapV,";\r\n"),t+="".concat(this._codeVariableName,".texture.uAng = ").concat(this.texture.uAng,";\r\n"),t+="".concat(this._codeVariableName,".texture.vAng = ").concat(this.texture.vAng,";\r\n"),t+="".concat(this._codeVariableName,".texture.wAng = ").concat(this.texture.wAng,";\r\n"),t+="".concat(this._codeVariableName,".texture.uOffset = ").concat(this.texture.uOffset,";\r\n"),t+="".concat(this._codeVariableName,".texture.vOffset = ").concat(this.texture.vOffset,";\r\n"),t+="".concat(this._codeVariableName,".texture.uScale = ").concat(this.texture.uScale,";\r\n"),t+="".concat(this._codeVariableName,".texture.vScale = ").concat(this.texture.vScale,";\r\n"),t+="".concat(this._codeVariableName,".texture.coordinatesMode = ").concat(this.texture.coordinatesMode,";\r\n")):t},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return this.texture&&!this.texture.isRenderTarget&&"VideoTexture"!==this.texture.getClassName()&&(t.texture=this.texture.serialize()),t},t.prototype._deserialize=function(t,i,r){e.prototype._deserialize.call(this,t,i,r),t.texture&&!f.O.IgnoreTexturesAtLoadTime&&void 0!==t.texture.url&&(r=0===t.texture.url.indexOf("data:")?"":r,this.texture=m.x.Parse(t.texture,i,r))},t}(n.k);(0,l.H)("BABYLON.ImageSourceBlock",v);var b=function(e){function t(t,i){void 0===i&&(i=!1);var r=e.call(this,t,i?s.u.Fragment:s.u.VertexAndFragment)||this;return r._convertToGammaSpace=!1,r._convertToLinearSpace=!1,r.disableLevelMultiplication=!1,r._fragmentOnly=i,r.registerInput("uv",o.E.Vector2,!1,s.u.VertexAndFragment),r.registerInput("source",o.E.Object,!0,s.u.VertexAndFragment,new _.C("source",r,d.Ab.Input,v,"ImageSourceBlock")),r.registerOutput("rgba",o.E.Color4,s.u.Neutral),r.registerOutput("rgb",o.E.Color3,s.u.Neutral),r.registerOutput("r",o.E.Float,s.u.Neutral),r.registerOutput("g",o.E.Float,s.u.Neutral),r.registerOutput("b",o.E.Float,s.u.Neutral),r.registerOutput("a",o.E.Float,s.u.Neutral),r.registerOutput("level",o.E.Float,s.u.Neutral),r._inputs[0].acceptedConnectionPointTypes.push(o.E.Vector3),r._inputs[0].acceptedConnectionPointTypes.push(o.E.Vector4),r._inputs[0]._prioritizeVertex=!i,r}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"texture",{get:function(){var e;return this.source.isConnected?(null===(e=this.source.connectedPoint)||void 0===e?void 0:e.ownerBlock).texture:this._texture},set:function(e){var t,i=this;if(this._texture!==e){var r=null!==(t=null==e?void 0:e.getScene())&&void 0!==t?t:y.l.LastCreatedScene;!e&&r&&r.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(i._texture)})),this._texture=e,e&&r&&r.markAllMaterialsAsDirty(1,(function(t){return t.hasTexture(e)}))}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"samplerName",{get:function(){return this._imageSource?this._imageSource.samplerName:this._samplerName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasImageSource",{get:function(){return!!this._imageSource},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"convertToGammaSpace",{get:function(){return this._convertToGammaSpace},set:function(e){var t,i=this;if(e!==this._convertToGammaSpace&&(this._convertToGammaSpace=e,this.texture)){var r=null!==(t=this.texture.getScene())&&void 0!==t?t:y.l.LastCreatedScene;null==r||r.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(i.texture)}))}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"convertToLinearSpace",{get:function(){return this._convertToLinearSpace},set:function(e){var t,i=this;if(e!==this._convertToLinearSpace&&(this._convertToLinearSpace=e,this.texture)){var r=null!==(t=this.texture.getScene())&&void 0!==t?t:y.l.LastCreatedScene;null==r||r.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(i.texture)}))}},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"TextureBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._outputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){if(this._fragmentOnly)return s.u.Fragment;if(!this.uv.isConnected)return s.u.VertexAndFragment;if(this.uv.sourceBlock.isInput)return s.u.VertexAndFragment;for(var e=this.uv.connectedPoint;e;){if(e.target===s.u.Fragment)return s.u.Fragment;if(e.target===s.u.Vertex)return s.u.VertexAndFragment;if(e.target===s.u.Neutral||e.target===s.u.VertexAndFragment){var t=e.ownerBlock;if(t.target===s.u.Fragment)return s.u.Fragment;e=null;for(var i=0,r=t.inputs;i<r.length;i++){var n=r[i];if(n.connectedPoint){e=n.connectedPoint;break}}}}return s.u.VertexAndFragment},set:function(e){},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.uv.isConnected)if(e.mode===g.a.PostProcess){(t=e.getBlockByPredicate((function(e){return"uv"===e.name})))&&t.connectTo(this)}else{var t,i=e.mode===g.a.Particle?"particle_uv":"uv";(t=e.getInputBlockByPredicate((function(e){return e.isAttribute&&e.name===i})))||(t=new u.S("uv")).setAsAttribute(i),t.output.connectTo(this.uv)}},t.prototype.initializeDefines=function(e,t,i){i._areTexturesDirty&&void 0!==this._mainUVDefineName&&i.setValue(this._mainUVDefineName,!1,!0)},t.prototype.prepareDefines=function(e,t,i){if(i._areTexturesDirty)if(this.texture&&this.texture.getTextureMatrix){var r=this.convertToGammaSpace&&this.texture&&!this.texture.gammaSpace,n=this.convertToLinearSpace&&this.texture&&this.texture.gammaSpace;i.setValue(this._linearDefineName,r,!0),i.setValue(this._gammaDefineName,n,!0),this._isMixed&&(this.texture.getTextureMatrix().isIdentityAs3x2()?(i.setValue(this._defineName,!1,!0),i.setValue(this._mainUVDefineName,!0,!0)):(i.setValue(this._defineName,!0),null==i[this._mainUVDefineName]&&i.setValue(this._mainUVDefineName,!1,!0)))}else this._isMixed&&(i.setValue(this._defineName,!1,!0),i.setValue(this._mainUVDefineName,!0,!0))},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype.bind=function(e){this.texture&&(this._isMixed&&(e.setFloat(this._textureInfoName,this.texture.level),e.setMatrix(this._textureTransformName,this.texture.getTextureMatrix())),this._imageSource||e.setTexture(this._samplerName,this.texture))},Object.defineProperty(t.prototype,"_isMixed",{get:function(){return this.target!==s.u.Fragment},enumerable:!1,configurable:!0}),t.prototype._injectVertexCode=function(e){var t=this.uv;if(this._defineName=e._getFreeDefineName("UVTRANSFORM"),this._mainUVDefineName="VMAIN"+t.associatedVariableName.toUpperCase(),this._mainUVName="vMain"+t.associatedVariableName,this._transformedUVName=e._getFreeVariableName("transformedUV"),this._textureTransformName=e._getFreeVariableName("textureTransform"),this._textureInfoName=e._getFreeVariableName("textureInfoName"),this.level.associatedVariableName=this._textureInfoName,e._emitVaryingFromString(this._transformedUVName,"vec2",this._defineName),e._emitVaryingFromString(this._mainUVName,"vec2",this._mainUVDefineName),e._emitUniformFromString(this._textureTransformName,"mat4",this._defineName),e.compilationString+="#ifdef ".concat(this._defineName,"\r\n"),e.compilationString+="".concat(this._transformedUVName," = vec2(").concat(this._textureTransformName," * vec4(").concat(t.associatedVariableName,".xy, 1.0, 0.0));\r\n"),e.compilationString+="#elif defined(".concat(this._mainUVDefineName,")\r\n"),e.compilationString+="".concat(this._mainUVName," = ").concat(t.associatedVariableName,".xy;\r\n"),e.compilationString+="#endif\r\n",this._outputs.some((function(e){return e.isConnectedInVertexShader}))){this._writeTextureRead(e,!0);for(var i=0,r=this._outputs;i<r.length;i++){var n=r[i];n.hasEndpoints&&"level"!==n.name&&this._writeOutput(e,n,n.name,!0)}}},t.prototype._generateTextureLookup=function(e){var t=this.samplerName;e.compilationString+="#ifdef ".concat(this._defineName,"\r\n"),e.compilationString+="vec4 ".concat(this._tempTextureRead," = texture2D(").concat(t,", ").concat(this._transformedUVName,");\r\n"),e.compilationString+="#elif defined(".concat(this._mainUVDefineName,")\r\n"),e.compilationString+="vec4 ".concat(this._tempTextureRead," = texture2D(").concat(t,", ").concat(this._mainUVName?this._mainUVName:this.uv.associatedVariableName,");\r\n"),e.compilationString+="#endif\r\n"},t.prototype._writeTextureRead=function(e,t){void 0===t&&(t=!1);var i=this.uv;if(t){if(e.target===s.u.Fragment)return;this._generateTextureLookup(e)}else this.uv.ownerBlock.target!==s.u.Fragment?this._generateTextureLookup(e):e.compilationString+="vec4 ".concat(this._tempTextureRead," = texture2D(").concat(this.samplerName,", ").concat(i.associatedVariableName,");\r\n")},t.prototype._generateConversionCode=function(e,t,i){"a"!==i&&(this.texture&&this.texture.gammaSpace||(e.compilationString+="#ifdef ".concat(this._linearDefineName,"\n                    ").concat(t.associatedVariableName," = toGammaSpace(").concat(t.associatedVariableName,");\n                    #endif\n                ")),e.compilationString+="#ifdef ".concat(this._gammaDefineName,"\n                ").concat(t.associatedVariableName," = toLinearSpace(").concat(t.associatedVariableName,");\n                #endif\n            "))},t.prototype._writeOutput=function(e,t,i,r){if(void 0===r&&(r=!1),r){if(e.target===s.u.Fragment)return;return e.compilationString+="".concat(this._declareOutput(t,e)," = ").concat(this._tempTextureRead,".").concat(i,";\r\n"),void this._generateConversionCode(e,t,i)}if(this.uv.ownerBlock.target===s.u.Fragment)return e.compilationString+="".concat(this._declareOutput(t,e)," = ").concat(this._tempTextureRead,".").concat(i,";\r\n"),void this._generateConversionCode(e,t,i);var n="";this.disableLevelMultiplication||(n=" * ".concat(this._textureInfoName)),e.compilationString+="".concat(this._declareOutput(t,e)," = ").concat(this._tempTextureRead,".").concat(i).concat(n,";\r\n"),this._generateConversionCode(e,t,i)},t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),this.source.isConnected?this._imageSource=this.source.connectedPoint.ownerBlock:this._imageSource=null,(t.target===s.u.Vertex||this._fragmentOnly||t.target===s.u.Fragment&&void 0===this._tempTextureRead)&&(this._tempTextureRead=t._getFreeVariableName("tempTextureRead"),this._linearDefineName=t._getFreeDefineName("ISLINEAR"),this._gammaDefineName=t._getFreeDefineName("ISGAMMA")),(!this._isMixed&&t.target===s.u.Fragment||this._isMixed&&t.target===s.u.Vertex)&&(this._imageSource||(this._samplerName=t._getFreeVariableName(this.name+"Sampler"),t._emit2DSampler(this._samplerName)),t.sharedData.blockingBlocks.push(this),t.sharedData.textureBlocks.push(this),t.sharedData.blocksWithDefines.push(this),t.sharedData.bindableBlocks.push(this)),t.target===s.u.Fragment){if(this._outputs.some((function(e){return e.isConnectedInFragmentShader}))){this._isMixed&&!this._imageSource&&t._emit2DSampler(this._samplerName);var i="//".concat(this.name);t._emitFunctionFromInclude("helperFunctions",i),this._isMixed&&t._emitUniformFromString(this._textureInfoName,"float"),this._writeTextureRead(t);for(var r=0,n=this._outputs;r<n.length;r++){var o=n[r];o.hasEndpoints&&"level"!==o.name&&this._writeOutput(t,o,o.name)}return this}}else this._injectVertexCode(t)},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);return t+="".concat(this._codeVariableName,".convertToGammaSpace = ").concat(this.convertToGammaSpace,";\r\n"),t+="".concat(this._codeVariableName,".convertToLinearSpace = ").concat(this.convertToLinearSpace,";\r\n"),t+="".concat(this._codeVariableName,".disableLevelMultiplication = ").concat(this.disableLevelMultiplication,";\r\n"),this.texture?(t+="".concat(this._codeVariableName,'.texture = new BABYLON.Texture("').concat(this.texture.name,'", null, ').concat(this.texture.noMipmap,", ").concat(this.texture.invertY,", ").concat(this.texture.samplingMode,");\r\n"),t+="".concat(this._codeVariableName,".texture.wrapU = ").concat(this.texture.wrapU,";\r\n"),t+="".concat(this._codeVariableName,".texture.wrapV = ").concat(this.texture.wrapV,";\r\n"),t+="".concat(this._codeVariableName,".texture.uAng = ").concat(this.texture.uAng,";\r\n"),t+="".concat(this._codeVariableName,".texture.vAng = ").concat(this.texture.vAng,";\r\n"),t+="".concat(this._codeVariableName,".texture.wAng = ").concat(this.texture.wAng,";\r\n"),t+="".concat(this._codeVariableName,".texture.uOffset = ").concat(this.texture.uOffset,";\r\n"),t+="".concat(this._codeVariableName,".texture.vOffset = ").concat(this.texture.vOffset,";\r\n"),t+="".concat(this._codeVariableName,".texture.uScale = ").concat(this.texture.uScale,";\r\n"),t+="".concat(this._codeVariableName,".texture.vScale = ").concat(this.texture.vScale,";\r\n"),t+="".concat(this._codeVariableName,".texture.coordinatesMode = ").concat(this.texture.coordinatesMode,";\r\n")):t},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.convertToGammaSpace=this.convertToGammaSpace,t.convertToLinearSpace=this.convertToLinearSpace,t.fragmentOnly=this._fragmentOnly,t.disableLevelMultiplication=this.disableLevelMultiplication,this.hasImageSource||!this.texture||this.texture.isRenderTarget||"VideoTexture"===this.texture.getClassName()||(t.texture=this.texture.serialize()),t},t.prototype._deserialize=function(t,i,r){e.prototype._deserialize.call(this,t,i,r),this.convertToGammaSpace=t.convertToGammaSpace,this.convertToLinearSpace=!!t.convertToLinearSpace,this._fragmentOnly=!!t.fragmentOnly,this.disableLevelMultiplication=!!t.disableLevelMultiplication,t.texture&&!f.O.IgnoreTexturesAtLoadTime&&void 0!==t.texture.url&&(r=0===t.texture.url.indexOf("data:")?"":r,this.texture=m.x.Parse(t.texture,i,r))},t}(n.k);(0,l.H)("BABYLON.TextureBlock",b);var S=function(e){function t(t){var i=e.call(this,t)||this;return i.registerInput("position",o.E.Vector3,!1,s.u.Vertex),i.registerInput("worldPosition",o.E.Vector4,!1,s.u.Vertex),i.registerInput("worldNormal",o.E.Vector4,!1,s.u.Fragment),i.registerInput("world",o.E.Matrix,!1,s.u.Vertex),i.registerInput("cameraPosition",o.E.Vector3,!1,s.u.Fragment),i.registerInput("view",o.E.Matrix,!1,s.u.Fragment),i.registerOutput("rgb",o.E.Color3,s.u.Fragment),i.registerOutput("rgba",o.E.Color4,s.u.Fragment),i.registerOutput("r",o.E.Float,s.u.Fragment),i.registerOutput("g",o.E.Float,s.u.Fragment),i.registerOutput("b",o.E.Float,s.u.Fragment),i.registerOutput("a",o.E.Float,s.u.Fragment),i._inputs[0].acceptedConnectionPointTypes.push(o.E.Vector4),i}return(0,r.ZT)(t,e),t.prototype.getClassName=function(){return"ReflectionTextureBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(t){if(e.prototype.autoConfigure.call(this,t),!this.cameraPosition.isConnected){var i=t.getInputBlockByPredicate((function(e){return e.systemValue===a.$.CameraPosition}));i||(i=new u.S("cameraPosition")).setAsSystemValue(a.$.CameraPosition),i.output.connectTo(this.cameraPosition)}},t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),!this.texture)return t.compilationString+=this.writeOutputs(t,"vec3(0.)"),this;if(t.target!==s.u.Fragment)return t.compilationString+=this.handleVertexSide(t),this;this.handleFragmentSideInits(t);var i=t._getFreeVariableName("normalWUnit");return t.compilationString+="vec4 ".concat(i," = normalize(").concat(this.worldNormal.associatedVariableName,");\r\n"),t.compilationString+=this.handleFragmentSideCodeReflectionCoords(i),t.compilationString+=this.handleFragmentSideCodeReflectionColor(void 0,""),t.compilationString+=this.writeOutputs(t,this._reflectionColorName),this},t}(i(44264).W);(0,l.H)("BABYLON.ReflectionTextureBlock",S);var C=i(853),x=i(12352),T=function(e){function t(t){var i=e.call(this,t,s.u.VertexAndFragment)||this;return i._samplerName="textureSampler",i.useNonLinearDepth=!1,i.force32itsFloat=!1,i._isUnique=!0,i.registerInput("uv",o.E.Vector2,!1,s.u.VertexAndFragment),i.registerOutput("depth",o.E.Float,s.u.Neutral),i._inputs[0].acceptedConnectionPointTypes.push(o.E.Vector3),i._inputs[0].acceptedConnectionPointTypes.push(o.E.Vector4),i._inputs[0]._prioritizeVertex=!1,i}return(0,r.ZT)(t,e),t.prototype.getClassName=function(){return"SceneDepthBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depth",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("textureSampler")},Object.defineProperty(t.prototype,"target",{get:function(){return this.uv.isConnected?this.uv.sourceBlock.isInput?s.u.VertexAndFragment:s.u.Fragment:s.u.VertexAndFragment},enumerable:!1,configurable:!0}),t.prototype._getTexture=function(e){return e.enableDepthRenderer(void 0,this.useNonLinearDepth,this.force32itsFloat).getDepthMap()},t.prototype.bind=function(e,t){var i=this._getTexture(t.getScene());e.setTexture(this._samplerName,i)},t.prototype._injectVertexCode=function(e){var t=this.uv;t.connectedPoint.ownerBlock.isInput&&(t.connectedPoint.ownerBlock.isAttribute||e._emitUniformFromString(t.associatedVariableName,"vec"+(t.type===o.E.Vector3?"3":t.type===o.E.Vector4?"4":"2")));if(this._mainUVName="vMain"+t.associatedVariableName,e._emitVaryingFromString(this._mainUVName,"vec2"),e.compilationString+="".concat(this._mainUVName," = ").concat(t.associatedVariableName,".xy;\r\n"),this._outputs.some((function(e){return e.isConnectedInVertexShader}))){this._writeTextureRead(e,!0);for(var i=0,r=this._outputs;i<r.length;i++){var n=r[i];n.hasEndpoints&&this._writeOutput(e,n,"r",!0)}}},t.prototype._writeTextureRead=function(e,t){void 0===t&&(t=!1);var i=this.uv;if(t){if(e.target===s.u.Fragment)return;e.compilationString+="vec4 ".concat(this._tempTextureRead," = texture2D(").concat(this._samplerName,", ").concat(i.associatedVariableName,".xy);\r\n")}else this.uv.ownerBlock.target!==s.u.Fragment?e.compilationString+="vec4 ".concat(this._tempTextureRead," = texture2D(").concat(this._samplerName,", ").concat(this._mainUVName,");\r\n"):e.compilationString+="vec4 ".concat(this._tempTextureRead," = texture2D(").concat(this._samplerName,", ").concat(i.associatedVariableName,".xy);\r\n")},t.prototype._writeOutput=function(e,t,i,r){if(void 0===r&&(r=!1),r){if(e.target===s.u.Fragment)return;e.compilationString+="".concat(this._declareOutput(t,e)," = ").concat(this._tempTextureRead,".").concat(i,";\r\n")}else this.uv.ownerBlock.target,s.u.Fragment,e.compilationString+="".concat(this._declareOutput(t,e)," = ").concat(this._tempTextureRead,".").concat(i,";\r\n")},t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),this._tempTextureRead=t._getFreeVariableName("tempTextureRead"),t.sharedData.bindableBlocks.indexOf(this)<0&&t.sharedData.bindableBlocks.push(this),t.target!==s.u.Fragment)return t._emit2DSampler(this._samplerName),void this._injectVertexCode(t);if(this._outputs.some((function(e){return e.isConnectedInFragmentShader}))){t._emit2DSampler(this._samplerName),this._writeTextureRead(t);for(var i=0,r=this._outputs;i<r.length;i++){var n=r[i];n.hasEndpoints&&this._writeOutput(t,n,"r")}return this}},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.useNonLinearDepth=this.useNonLinearDepth,t.force32itsFloat=this.force32itsFloat,t},t.prototype._deserialize=function(t,i,r){e.prototype._deserialize.call(this,t,i,r),this.useNonLinearDepth=t.useNonLinearDepth,this.force32itsFloat=t.force32itsFloat},(0,r.gn)([(0,x.p)("Use non linear depth",x.U.Boolean,"ADVANCED",{notifiers:{activatePreviewCommand:!0,callback:function(e){return e.disableDepthRenderer()}}})],t.prototype,"useNonLinearDepth",void 0),(0,r.gn)([(0,x.p)("Force 32 bits float",x.U.Boolean,"ADVANCED",{notifiers:{activatePreviewCommand:!0,callback:function(e){return e.disableDepthRenderer()}}})],t.prototype,"force32itsFloat",void 0),t}(n.k);(0,l.H)("BABYLON.SceneDepthBlock",T);var M=function(e){function t(t){var i=e.call(this,t,s.u.VertexAndFragment,!0)||this;return i.registerInput("worldPosition",o.E.Vector4,!1),i}return(0,r.ZT)(t,e),t.prototype.getClassName=function(){return"ClipPlanesBlock"},t.prototype.initialize=function(e){e._excludeVariableName("vClipPlane"),e._excludeVariableName("fClipDistance"),e._excludeVariableName("vClipPlane2"),e._excludeVariableName("fClipDistance2"),e._excludeVariableName("vClipPlane3"),e._excludeVariableName("fClipDistance3"),e._excludeVariableName("vClipPlane4"),e._excludeVariableName("fClipDistance4"),e._excludeVariableName("vClipPlane5"),e._excludeVariableName("fClipDistance5"),e._excludeVariableName("vClipPlane6"),e._excludeVariableName("fClipDistance6")},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){return s.u.VertexAndFragment},set:function(e){},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,t,i){var r=e.getScene(),n=void 0!==r.clipPlane&&null!==r.clipPlane,o=void 0!==r.clipPlane2&&null!==r.clipPlane2,a=void 0!==r.clipPlane3&&null!==r.clipPlane3,s=void 0!==r.clipPlane4&&null!==r.clipPlane4,c=void 0!==r.clipPlane5&&null!==r.clipPlane5,u=void 0!==r.clipPlane6&&null!==r.clipPlane6;i.setValue("CLIPPLANE",n,!0),i.setValue("CLIPPLANE2",o,!0),i.setValue("CLIPPLANE3",a,!0),i.setValue("CLIPPLANE4",s,!0),i.setValue("CLIPPLANE5",c,!0),i.setValue("CLIPPLANE6",u,!0)},t.prototype.bind=function(e,t,i){if(i){var r=i.getScene();c.G.BindClipPlane(e,r)}},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var i="//".concat(this.name);if(t.target!==s.u.Fragment){var r=this.worldPosition;return t._emitFunctionFromInclude("clipPlaneVertexDeclaration",i,{replaceStrings:[{search:/uniform vec4 vClipPlane\d*;/g,replace:""}]}),t.compilationString+=t._emitCodeFromInclude("clipPlaneVertex",i,{replaceStrings:[{search:/worldPos/g,replace:r.associatedVariableName}]}),t._emitUniformFromString("vClipPlane","vec4"),t._emitUniformFromString("vClipPlane2","vec4"),t._emitUniformFromString("vClipPlane3","vec4"),t._emitUniformFromString("vClipPlane4","vec4"),t._emitUniformFromString("vClipPlane5","vec4"),void t._emitUniformFromString("vClipPlane6","vec4")}return t.sharedData.bindableBlocks.push(this),t.sharedData.blocksWithDefines.push(this),t._emitFunctionFromInclude("clipPlaneFragmentDeclaration",i),t.compilationString+=t._emitCodeFromInclude("clipPlaneFragment",i),this},t}(n.k);(0,l.H)("BABYLON.ClipPlanesBlock",M)},44264:(e,t,i)=>{i.d(t,{W:()=>p});var r=i(31191),n=i(89592),o=i(70848),a=i(48620),s=i(62976),c=i(69958),u=(i(76350),i(44394)),l=i(73803),h=i(15210),p=function(e){function t(t){return e.call(this,t,o.u.VertexAndFragment)||this}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){var t,i=this;if(this._texture!==e){var r=null!==(t=null==e?void 0:e.getScene())&&void 0!==t?t:h.l.LastCreatedScene;!e&&r&&r.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(i._texture)})),this._texture=e,e&&r&&r.markAllMaterialsAsDirty(1,(function(t){return t.hasTexture(e)}))}},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"ReflectionTextureBaseBlock"},t.prototype._getTexture=function(){return this.texture},t.prototype.autoConfigure=function(e){if(!this.position.isConnected){var t=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"position"===e.name}));t||(t=new s.S("position")).setAsAttribute(),t.output.connectTo(this.position)}if(!this.world.isConnected){var i=e.getInputBlockByPredicate((function(e){return e.systemValue===c.$.World}));i||(i=new s.S("world")).setAsSystemValue(c.$.World),i.output.connectTo(this.world)}if(this.view&&!this.view.isConnected){var r=e.getInputBlockByPredicate((function(e){return e.systemValue===c.$.View}));r||(r=new s.S("view")).setAsSystemValue(c.$.View),r.output.connectTo(this.view)}},t.prototype.prepareDefines=function(e,t,i){if(i._areTexturesDirty){var r=this._getTexture();r&&r.getTextureMatrix&&(i.setValue(this._define3DName,r.isCube,!0),i.setValue(this._defineLocalCubicName,!!r.boundingBoxSize,!0),i.setValue(this._defineExplicitName,0===r.coordinatesMode,!0),i.setValue(this._defineSkyboxName,5===r.coordinatesMode,!0),i.setValue(this._defineCubicName,3===r.coordinatesMode||6===r.coordinatesMode,!0),i.setValue("INVERTCUBICMAP",6===r.coordinatesMode,!0),i.setValue(this._defineSphericalName,1===r.coordinatesMode,!0),i.setValue(this._definePlanarName,2===r.coordinatesMode,!0),i.setValue(this._defineProjectionName,4===r.coordinatesMode,!0),i.setValue(this._defineEquirectangularName,7===r.coordinatesMode,!0),i.setValue(this._defineEquirectangularFixedName,8===r.coordinatesMode,!0),i.setValue(this._defineMirroredEquirectangularFixedName,9===r.coordinatesMode,!0))}},t.prototype.isReady=function(){var e=this._getTexture();return!(e&&!e.isReadyOrNotBlocking())},t.prototype.bind=function(e,t,i){var r=this._getTexture();if(i&&r&&(e.setMatrix(this._reflectionMatrixName,r.getReflectionTextureMatrix()),r.isCube?e.setTexture(this._cubeSamplerName,r):e.setTexture(this._2DSamplerName,r),r.boundingBoxSize)){var n=r;e.setVector3(this._reflectionPositionName,n.boundingBoxPosition),e.setVector3(this._reflectionSizeName,n.boundingBoxSize)}},t.prototype.handleVertexSide=function(e){this._define3DName=e._getFreeDefineName("REFLECTIONMAP_3D"),this._defineCubicName=e._getFreeDefineName("REFLECTIONMAP_CUBIC"),this._defineSphericalName=e._getFreeDefineName("REFLECTIONMAP_SPHERICAL"),this._definePlanarName=e._getFreeDefineName("REFLECTIONMAP_PLANAR"),this._defineProjectionName=e._getFreeDefineName("REFLECTIONMAP_PROJECTION"),this._defineExplicitName=e._getFreeDefineName("REFLECTIONMAP_EXPLICIT"),this._defineEquirectangularName=e._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR"),this._defineLocalCubicName=e._getFreeDefineName("USE_LOCAL_REFLECTIONMAP_CUBIC"),this._defineMirroredEquirectangularFixedName=e._getFreeDefineName("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"),this._defineEquirectangularFixedName=e._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR_FIXED"),this._defineSkyboxName=e._getFreeDefineName("REFLECTIONMAP_SKYBOX"),this._defineOppositeZ=e._getFreeDefineName("REFLECTIONMAP_OPPOSITEZ"),this._reflectionMatrixName=e._getFreeVariableName("reflectionMatrix"),e._emitUniformFromString(this._reflectionMatrixName,"mat4");var t="",i="v_"+this.worldPosition.associatedVariableName;return e._emitVaryingFromString(i,"vec4")&&(t+="".concat(i," = ").concat(this.worldPosition.associatedVariableName,";\r\n")),this._positionUVWName=e._getFreeVariableName("positionUVW"),this._directionWName=e._getFreeVariableName("directionW"),e._emitVaryingFromString(this._positionUVWName,"vec3",this._defineSkyboxName)&&(t+="#ifdef ".concat(this._defineSkyboxName,"\r\n"),t+="".concat(this._positionUVWName," = ").concat(this.position.associatedVariableName,".xyz;\r\n"),t+="#endif\r\n"),e._emitVaryingFromString(this._directionWName,"vec3","defined(".concat(this._defineEquirectangularFixedName,") || defined(").concat(this._defineMirroredEquirectangularFixedName,")"))&&(t+="#if defined(".concat(this._defineEquirectangularFixedName,") || defined(").concat(this._defineMirroredEquirectangularFixedName,")\r\n"),t+="".concat(this._directionWName," = normalize(vec3(").concat(this.world.associatedVariableName," * vec4(").concat(this.position.associatedVariableName,".xyz, 0.0)));\r\n"),t+="#endif\r\n"),t},t.prototype.handleFragmentSideInits=function(e){e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),this._cubeSamplerName=e._getFreeVariableName(this.name+"CubeSampler"),e.samplers.push(this._cubeSamplerName),this._2DSamplerName=e._getFreeVariableName(this.name+"2DSampler"),e.samplers.push(this._2DSamplerName),e._samplerDeclaration+="#ifdef ".concat(this._define3DName,"\r\n"),e._samplerDeclaration+="uniform samplerCube ".concat(this._cubeSamplerName,";\r\n"),e._samplerDeclaration+="#else\r\n",e._samplerDeclaration+="uniform sampler2D ".concat(this._2DSamplerName,";\r\n"),e._samplerDeclaration+="#endif\r\n",e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this);var t="//".concat(this.name);e._emitFunction("ReciprocalPI","#define RECIPROCAL_PI2 0.15915494",""),e._emitFunctionFromInclude("helperFunctions",t),e._emitFunctionFromInclude("reflectionFunction",t,{replaceStrings:[{search:/vec3 computeReflectionCoords/g,replace:"void DUMMYFUNC"}]}),this._reflectionColorName=e._getFreeVariableName("reflectionColor"),this._reflectionVectorName=e._getFreeVariableName("reflectionUVW"),this._reflectionCoordsName=e._getFreeVariableName("reflectionCoords"),this._reflectionPositionName=e._getFreeVariableName("vReflectionPosition"),e._emitUniformFromString(this._reflectionPositionName,"vec3"),this._reflectionSizeName=e._getFreeVariableName("vReflectionPosition"),e._emitUniformFromString(this._reflectionSizeName,"vec3")},t.prototype.handleFragmentSideCodeReflectionCoords=function(e,t,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1),t||(t="v_".concat(this.worldPosition.associatedVariableName));var n=this._reflectionMatrixName,o="normalize(".concat(this._directionWName,")"),a="".concat(this._positionUVWName),s="".concat(this.cameraPosition.associatedVariableName),c="".concat(this.view.associatedVariableName);e+=".xyz";var u="\n            #ifdef ".concat(this._defineMirroredEquirectangularFixedName,"\n                vec3 ").concat(this._reflectionVectorName," = computeMirroredFixedEquirectangularCoords(").concat(t,", ").concat(e,", ").concat(o,");\n            #endif\n\n            #ifdef ").concat(this._defineEquirectangularFixedName,"\n                vec3 ").concat(this._reflectionVectorName," = computeFixedEquirectangularCoords(").concat(t,", ").concat(e,", ").concat(o,");\n            #endif\n\n            #ifdef ").concat(this._defineEquirectangularName,"\n                vec3 ").concat(this._reflectionVectorName," = computeEquirectangularCoords(").concat(t,", ").concat(e,", ").concat(s,".xyz, ").concat(n,");\n            #endif\n\n            #ifdef ").concat(this._defineSphericalName,"\n                vec3 ").concat(this._reflectionVectorName," = computeSphericalCoords(").concat(t,", ").concat(e,", ").concat(c,", ").concat(n,");\n            #endif\n\n            #ifdef ").concat(this._definePlanarName,"\n                vec3 ").concat(this._reflectionVectorName," = computePlanarCoords(").concat(t,", ").concat(e,", ").concat(s,".xyz, ").concat(n,");\n            #endif\n\n            #ifdef ").concat(this._defineCubicName,"\n                #ifdef ").concat(this._defineLocalCubicName,"\n                    vec3 ").concat(this._reflectionVectorName," = computeCubicLocalCoords(").concat(t,", ").concat(e,", ").concat(s,".xyz, ").concat(n,", ").concat(this._reflectionSizeName,", ").concat(this._reflectionPositionName,");\n                #else\n                vec3 ").concat(this._reflectionVectorName," = computeCubicCoords(").concat(t,", ").concat(e,", ").concat(s,".xyz, ").concat(n,");\n                #endif\n            #endif\n\n            #ifdef ").concat(this._defineProjectionName,"\n                vec3 ").concat(this._reflectionVectorName," = computeProjectionCoords(").concat(t,", ").concat(c,", ").concat(n,");\n            #endif\n\n            #ifdef ").concat(this._defineSkyboxName,"\n                vec3 ").concat(this._reflectionVectorName," = computeSkyBoxCoords(").concat(a,", ").concat(n,");\n            #endif\n\n            #ifdef ").concat(this._defineExplicitName,"\n                vec3 ").concat(this._reflectionVectorName," = vec3(0, 0, 0);\n            #endif\r\n");return r||(u+="#ifdef ".concat(this._defineOppositeZ,"\n                ").concat(this._reflectionVectorName,".z *= -1.0;\n            #endif\r\n")),i||(u+="\n                #ifdef ".concat(this._define3DName,"\n                    vec3 ").concat(this._reflectionCoordsName," = ").concat(this._reflectionVectorName,";\n                #else\n                    vec2 ").concat(this._reflectionCoordsName," = ").concat(this._reflectionVectorName,".xy;\n                    #ifdef ").concat(this._defineProjectionName,"\n                        ").concat(this._reflectionCoordsName," /= ").concat(this._reflectionVectorName,".z;\n                    #endif\n                    ").concat(this._reflectionCoordsName,".y = 1.0 - ").concat(this._reflectionCoordsName,".y;\n                #endif\r\n")),u},t.prototype.handleFragmentSideCodeReflectionColor=function(e,t){void 0===t&&(t=".rgb");var i="vec"+(0===t.length?"4":t.length-1),r="".concat(i," ").concat(this._reflectionColorName,";\n            #ifdef ").concat(this._define3DName,"\r\n");return r+=e?"".concat(this._reflectionColorName," = textureCubeLodEXT(").concat(this._cubeSamplerName,", ").concat(this._reflectionVectorName,", ").concat(e,")").concat(t,";\r\n"):"".concat(this._reflectionColorName," = textureCube(").concat(this._cubeSamplerName,", ").concat(this._reflectionVectorName,")").concat(t,";\r\n"),r+="\n            #else\r\n",r+=e?"".concat(this._reflectionColorName," = texture2DLodEXT(").concat(this._2DSamplerName,", ").concat(this._reflectionCoordsName,", ").concat(e,")").concat(t,";\r\n"):"".concat(this._reflectionColorName," = texture2D(").concat(this._2DSamplerName,", ").concat(this._reflectionCoordsName,")").concat(t,";\r\n"),r+="#endif\r\n"},t.prototype.writeOutputs=function(e,t){var i="";if(e.target===o.u.Fragment)for(var r=0,n=this._outputs;r<n.length;r++){var a=n[r];a.hasEndpoints&&(i+="".concat(this._declareOutput(a,e)," = ").concat(t,".").concat(a.name,";\r\n"))}return i},t.prototype._buildBlock=function(t){return e.prototype._buildBlock.call(this,t),this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);if(!this.texture)return t;if(this.texture.isCube){var i=this.texture.forcedExtension;t+="".concat(this._codeVariableName,'.texture = new BABYLON.CubeTexture("').concat(this.texture.name,'", undefined, undefined, ').concat(this.texture.noMipmap,", null, undefined, undefined, undefined, ").concat(this.texture._prefiltered,", ").concat(i?'"'+i+'"':"null",");\r\n")}else t+="".concat(this._codeVariableName,'.texture = new BABYLON.Texture("').concat(this.texture.name,'", null);\r\n');return t+="".concat(this._codeVariableName,".texture.coordinatesMode = ").concat(this.texture.coordinatesMode,";\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return this.texture&&!this.texture.isRenderTarget&&(t.texture=this.texture.serialize()),t},t.prototype._deserialize=function(t,i,r){e.prototype._deserialize.call(this,t,i,r),t.texture&&(r=0===t.texture.url.indexOf("data:")?"":r,t.texture.isCube?this.texture=u.B.Parse(t.texture,i,r):this.texture=l.x.Parse(t.texture,i,r))},t}(n.k);(0,a.H)("BABYLON.ReflectionTextureBaseBlock",p)},80498:(e,t,i)=>{i.d(t,{v:()=>p});var r=i(31191),n=i(89592),o=i(89762),a=i(70848),s=i(96979),c=i(48620),u=i(93682),l=i(69958),h=i(62976),p=function(e){function t(i){var r=e.call(this,i,a.u.Fragment,!0)||this;return r.registerInput("normal",o.E.Vector4,!1),r.normal.acceptedConnectionPointTypes.push(o.E.Vector3),r.registerInput("tangent",o.E.Vector4,!1),r.registerInput("world",o.E.Matrix,!1),r.registerOutput("TBN",o.E.Object,a.u.Fragment,new u.C("TBN",r,s.Ab.Output,t,"TBNBlock")),r}return(0,r.ZT)(t,e),t.prototype.getClassName=function(){return"TBNBlock"},t.prototype.initialize=function(e){e._excludeVariableName("tbnNormal"),e._excludeVariableName("tbnTangent"),e._excludeVariableName("tbnBitangent"),e._excludeVariableName("TBN")},Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangent",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"TBN",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){return a.u.Fragment},set:function(e){},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.world.isConnected){var t=e.getInputBlockByPredicate((function(e){return e.isSystemValue&&e.systemValue===l.$.World}));t||(t=new h.S("world")).setAsSystemValue(l.$.World),t.output.connectTo(this.world)}if(!this.normal.isConnected){var i=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"normal"===e.name}));i||(i=new h.S("normal")).setAsAttribute("normal"),i.output.connectTo(this.normal)}if(!this.tangent.isConnected){var r=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"tangent"===e.name&&e.type===o.E.Vector4}));r||(r=new h.S("tangent")).setAsAttribute("tangent"),r.output.connectTo(this.tangent)}},t.prototype.prepareDefines=function(e,t,i){var r,n,o,a,s=this.normal,c=this.tangent,u=s.isConnected;(null===(r=s.connectInputBlock)||void 0===r?void 0:r.isAttribute)&&!e.isVerticesDataPresent(null===(n=s.connectInputBlock)||void 0===n?void 0:n.name)&&(u=!1);var l=c.isConnected;(null===(o=c.connectInputBlock)||void 0===o?void 0:o.isAttribute)&&!e.isVerticesDataPresent(null===(a=c.connectInputBlock)||void 0===a?void 0:a.name)&&(l=!1);var h=u&&l;i.setValue("TBNBLOCK",h,!0)},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var i=this.normal,r=this.tangent,n=this.world,o=this.TBN;return t.target===a.u.Fragment&&(t.compilationString+="\n                // ".concat(this.name,"\n                vec3 tbnNormal = normalize(").concat(i.associatedVariableName,").xyz;\n                vec3 tbnTangent = normalize(").concat(r.associatedVariableName,".xyz);\n                vec3 tbnBitangent = cross(tbnNormal, tbnTangent) * ").concat(r.associatedVariableName,".w;\n                mat3 ").concat(o.associatedVariableName," = mat3(").concat(n.associatedVariableName,") * mat3(tbnTangent, tbnBitangent, tbnNormal);\n            "),t.sharedData.blocksWithDefines.push(this)),this},t}(n.k);(0,c.H)("BABYLON.TBNBlock",p)},62374:(e,t,i)=>{i.d(t,{g:()=>l});var r=i(31191),n=i(89592),o=i(89762),a=i(70848),s=i(48620),c=i(12352),u=i(90360),l=function(e){function t(t){var i=e.call(this,t,a.u.Fragment,!0)||this;return i.convertToGammaSpace=!1,i.convertToLinearSpace=!1,i.useLogarithmicDepth=!1,i.registerInput("rgba",o.E.Color4,!0),i.registerInput("rgb",o.E.Color3,!0),i.registerInput("a",o.E.Float,!0),i.rgb.acceptedConnectionPointTypes.push(o.E.Float),i}return(0,r.ZT)(t,e),t.prototype.getClassName=function(){return"FragmentOutputBlock"},t.prototype.initialize=function(e){e._excludeVariableName("logarithmicDepthConstant"),e._excludeVariableName("vFragmentDepth")},Object.defineProperty(t.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,t,i){i.setValue(this._linearDefineName,this.convertToLinearSpace,!0),i.setValue(this._gammaDefineName,this.convertToGammaSpace,!0)},t.prototype.bind=function(e,t,i){this.useLogarithmicDepth&&i&&u.G.BindLogDepth(void 0,e,i.getScene())},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var i=this.rgba,r=this.rgb,n=this.a;t.sharedData.hints.needAlphaBlending=i.isConnected||n.isConnected,t.sharedData.blocksWithDefines.push(this),this.useLogarithmicDepth&&(t._emitUniformFromString("logarithmicDepthConstant","float"),t._emitVaryingFromString("vFragmentDepth","float"),t.sharedData.bindableBlocks.push(this)),this._linearDefineName=t._getFreeDefineName("CONVERTTOLINEAR"),this._gammaDefineName=t._getFreeDefineName("CONVERTTOGAMMA");var a="//".concat(this.name);if(t._emitFunctionFromInclude("helperFunctions",a),i.connectedPoint)n.isConnected?t.compilationString+="gl_FragColor = vec4(".concat(i.associatedVariableName,".rgb, ").concat(n.associatedVariableName,");\r\n"):t.compilationString+="gl_FragColor = ".concat(i.associatedVariableName,";\r\n");else if(r.connectedPoint){var s="1.0";n.connectedPoint&&(s=n.associatedVariableName),r.connectedPoint.type===o.E.Float?t.compilationString+="gl_FragColor = vec4(".concat(r.associatedVariableName,", ").concat(r.associatedVariableName,", ").concat(r.associatedVariableName,", ").concat(s,");\r\n"):t.compilationString+="gl_FragColor = vec4(".concat(r.associatedVariableName,", ").concat(s,");\r\n")}else t.sharedData.checks.notConnectedNonOptionalInputs.push(i);return t.compilationString+="#ifdef ".concat(this._linearDefineName,"\r\n"),t.compilationString+="gl_FragColor = toLinearSpace(gl_FragColor);\r\n",t.compilationString+="#endif\r\n",t.compilationString+="#ifdef ".concat(this._gammaDefineName,"\r\n"),t.compilationString+="gl_FragColor = toGammaSpace(gl_FragColor);\r\n",t.compilationString+="#endif\r\n",this.useLogarithmicDepth&&(t.compilationString+="gl_FragDepthEXT = log2(vFragmentDepth) * logarithmicDepthConstant * 0.5;\r\n"),this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);return t+="".concat(this._codeVariableName,".convertToGammaSpace = ").concat(this.convertToGammaSpace,";\r\n"),t+="".concat(this._codeVariableName,".convertToLinearSpace = ").concat(this.convertToLinearSpace,";\r\n"),t+="".concat(this._codeVariableName,".useLogarithmicDepth = ").concat(this.useLogarithmicDepth,";\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.convertToGammaSpace=this.convertToGammaSpace,t.convertToLinearSpace=this.convertToLinearSpace,t.useLogarithmicDepth=this.useLogarithmicDepth,t},t.prototype._deserialize=function(t,i,r){var n;e.prototype._deserialize.call(this,t,i,r),this.convertToGammaSpace=t.convertToGammaSpace,this.convertToLinearSpace=t.convertToLinearSpace,this.useLogarithmicDepth=null!==(n=t.useLogarithmicDepth)&&void 0!==n&&n},(0,r.gn)([(0,c.p)("Convert to gamma space",c.U.Boolean,"PROPERTIES",{notifiers:{update:!0}})],t.prototype,"convertToGammaSpace",void 0),(0,r.gn)([(0,c.p)("Convert to linear space",c.U.Boolean,"PROPERTIES",{notifiers:{update:!0}})],t.prototype,"convertToLinearSpace",void 0),(0,r.gn)([(0,c.p)("Use logarithmic depth",c.U.Boolean,"PROPERTIES")],t.prototype,"useLogarithmicDepth",void 0),t}(n.k);(0,s.H)("BABYLON.FragmentOutputBlock",l)},4670:(e,t,i)=>{i.d(t,{mH:()=>y,el:()=>g,Mk:()=>v,gc:()=>r.g,RK:()=>_,rE:()=>l,hB:()=>m,eG:()=>b,EH:()=>C,vB:()=>f.v,tO:()=>T});var r=i(62374),n=i(31191),o=i(89592),a=i(89762),s=i(70848),c=i(48620),u=i(12352),l=(i(54081),i(69464),i(47157),function(e){function t(t){var i=e.call(this,t,s.u.Fragment)||this;return i.convertInputToLinearSpace=!0,i.registerInput("color",a.E.Color4),i.registerOutput("output",a.E.Color4),i._inputs[0].acceptedConnectionPointTypes.push(a.E.Color3),i}return(0,n.ZT)(t,e),t.prototype.getClassName=function(){return"ImageProcessingBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("exposureLinear"),e._excludeVariableName("contrast"),e._excludeVariableName("vInverseScreenSize"),e._excludeVariableName("vignetteSettings1"),e._excludeVariableName("vignetteSettings2"),e._excludeVariableName("vCameraColorCurveNegative"),e._excludeVariableName("vCameraColorCurveNeutral"),e._excludeVariableName("vCameraColorCurvePositive"),e._excludeVariableName("txColorTransform"),e._excludeVariableName("colorTransformSettings")},t.prototype.isReady=function(e,t,i){return!(i._areImageProcessingDirty&&t.imageProcessingConfiguration&&!t.imageProcessingConfiguration.isReady())},t.prototype.prepareDefines=function(e,t,i){i._areImageProcessingDirty&&t.imageProcessingConfiguration&&t.imageProcessingConfiguration.prepareDefines(i)},t.prototype.bind=function(e,t,i){i&&t.imageProcessingConfiguration&&t.imageProcessingConfiguration.bind(e)},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t),t.sharedData.blocksWithDefines.push(this),t.sharedData.blockingBlocks.push(this),t.sharedData.bindableBlocks.push(this),t.uniforms.push("exposureLinear"),t.uniforms.push("contrast"),t.uniforms.push("vInverseScreenSize"),t.uniforms.push("vignetteSettings1"),t.uniforms.push("vignetteSettings2"),t.uniforms.push("vCameraColorCurveNegative"),t.uniforms.push("vCameraColorCurveNeutral"),t.uniforms.push("vCameraColorCurvePositive"),t.uniforms.push("txColorTransform"),t.uniforms.push("colorTransformSettings");var i=this.color,r=this._outputs[0],n="//".concat(this.name);return t._emitFunctionFromInclude("helperFunctions",n),t._emitFunctionFromInclude("imageProcessingDeclaration",n),t._emitFunctionFromInclude("imageProcessingFunctions",n),i.connectedPoint.type===a.E.Color4||i.connectedPoint.type===a.E.Vector4?t.compilationString+="".concat(this._declareOutput(r,t)," = ").concat(i.associatedVariableName,";\r\n"):t.compilationString+="".concat(this._declareOutput(r,t)," = vec4(").concat(i.associatedVariableName,", 1.0);\r\n"),t.compilationString+="#ifdef IMAGEPROCESSINGPOSTPROCESS\r\n",this.convertInputToLinearSpace&&(t.compilationString+="".concat(r.associatedVariableName,".rgb = toLinearSpace(").concat(i.associatedVariableName,".rgb);\r\n")),t.compilationString+="#else\r\n",t.compilationString+="#ifdef IMAGEPROCESSING\r\n",this.convertInputToLinearSpace&&(t.compilationString+="".concat(r.associatedVariableName,".rgb = toLinearSpace(").concat(i.associatedVariableName,".rgb);\r\n")),t.compilationString+="".concat(r.associatedVariableName," = applyImageProcessing(").concat(r.associatedVariableName,");\r\n"),t.compilationString+="#endif\r\n",t.compilationString+="#endif\r\n",this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);return t+="".concat(this._codeVariableName,".convertInputToLinearSpace = ").concat(this.convertInputToLinearSpace,";\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.convertInputToLinearSpace=this.convertInputToLinearSpace,t},t.prototype._deserialize=function(t,i,r){var n;e.prototype._deserialize.call(this,t,i,r),this.convertInputToLinearSpace=null===(n=t.convertInputToLinearSpace)||void 0===n||n},(0,n.gn)([(0,u.p)("Convert input to linear space",u.U.Boolean,"ADVANCED")],t.prototype,"convertInputToLinearSpace",void 0),t}(o.k));(0,c.H)("BABYLON.ImageProcessingBlock",l);var h=i(96979),p=i(62976),d=i(93682),f=i(80498),m=(i(82953),i(44345),i(16161),function(e){function t(t){var i=e.call(this,t,s.u.Fragment)||this;return i._tangentSpaceParameterName="",i.invertX=!1,i.invertY=!1,i.useParallaxOcclusion=!1,i._isUnique=!0,i.registerInput("worldPosition",a.E.Vector4,!1),i.registerInput("worldNormal",a.E.Vector4,!1),i.registerInput("worldTangent",a.E.Vector4,!0),i.registerInput("uv",a.E.Vector2,!1),i.registerInput("normalMapColor",a.E.Color3,!1),i.registerInput("strength",a.E.Float,!1),i.registerInput("viewDirection",a.E.Vector3,!0),i.registerInput("parallaxScale",a.E.Float,!0),i.registerInput("parallaxHeight",a.E.Float,!0),i.registerInput("TBN",a.E.Object,!0,s.u.VertexAndFragment,new d.C("TBN",i,h.Ab.Input,f.v,"TBNBlock")),i.registerOutput("output",a.E.Vector4),i.registerOutput("uvOffset",a.E.Vector2),i}return(0,n.ZT)(t,e),t.prototype.getClassName=function(){return"PerturbNormalBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalMapColor",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strength",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewDirection",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parallaxScale",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parallaxHeight",{get:function(){return this._inputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"TBN",{get:function(){return this._inputs[9]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uvOffset",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(e,t,i){var r=this.normalMapColor.connectedPoint._ownerBlock.samplerName,n=this.viewDirection.isConnected&&(this.useParallaxOcclusion&&r||!this.useParallaxOcclusion&&this.parallaxHeight.isConnected);i.setValue("BUMP",!0),i.setValue("PARALLAX",n,!0),i.setValue("PARALLAXOCCLUSION",this.useParallaxOcclusion,!0)},t.prototype.bind=function(e,t){t.getScene()._mirroredCameraPosition?e.setFloat2(this._tangentSpaceParameterName,this.invertX?1:-1,this.invertY?1:-1):e.setFloat2(this._tangentSpaceParameterName,this.invertX?-1:1,this.invertY?-1:1)},t.prototype.autoConfigure=function(e){if(!this.uv.isConnected){var t=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"uv"===e.name}));t||(t=new p.S("uv")).setAsAttribute(),t.output.connectTo(this.uv)}if(!this.strength.isConnected){var i=new p.S("strength");i.value=1,i.output.connectTo(this.strength)}},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var i="//".concat(this.name),r=this.uv,n=this.worldPosition,o=this.worldNormal,a=this.worldTangent;t.sharedData.blocksWithDefines.push(this),t.sharedData.bindableBlocks.push(this),this._tangentSpaceParameterName=t._getFreeDefineName("tangentSpaceParameter"),t._emitUniformFromString(this._tangentSpaceParameterName,"vec2");var s=this.normalMapColor.connectedPoint._ownerBlock.samplerName,c=this.viewDirection.isConnected&&(this.useParallaxOcclusion&&s||!this.useParallaxOcclusion&&this.parallaxHeight.isConnected),u=this.parallaxScale.isConnectedToInputBlock?this.parallaxScale.connectInputBlock.isConstant?t._emitFloat(this.parallaxScale.connectInputBlock.value):this.parallaxScale.associatedVariableName:"0.05",l=this.strength.isConnectedToInputBlock&&this.strength.connectInputBlock.isConstant?"\r\n#if !defined(NORMALXYSCALE)\r\n1.0/\r\n#endif\r\n".concat(t._emitFloat(this.strength.connectInputBlock.value)):"\r\n#if !defined(NORMALXYSCALE)\r\n1.0/\r\n#endif\r\n".concat(this.strength.associatedVariableName);t._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var h={search:/defined\(TANGENT\)/g,replace:a.isConnected?"defined(TANGENT)":"defined(IGNORE)"},p=this.TBN;p.isConnected?t.compilationString+="\n            #ifdef TBNBLOCK\n            mat3 vTBN = ".concat(p.associatedVariableName,";\n            #endif\n            "):a.isConnected&&(t.compilationString+="vec3 tbnNormal = normalize(".concat(o.associatedVariableName,".xyz);\r\n"),t.compilationString+="vec3 tbnTangent = normalize(".concat(a.associatedVariableName,".xyz);\r\n"),t.compilationString+="vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r\n",t.compilationString+="mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n"),t._emitFunctionFromInclude("bumpFragmentMainFunctions",i,{replaceStrings:[h,{search:/varying mat3 vTBN/g,replace:""}]}),t._emitFunctionFromInclude("bumpFragmentFunctions",i,{replaceStrings:[{search:/#include<samplerFragmentDeclaration>\(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump\)/g,replace:""},{search:/uniform sampler2D bumpSampler;/g,replace:""},{search:/vec2 parallaxOcclusion\(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale\)/g,replace:"#define inline\r\nvec2 parallaxOcclusion(vec3 vViewDirCoT, vec3 vNormalCoT, vec2 texCoord, float parallaxScale, sampler2D bumpSampler)"},{search:/vec2 parallaxOffset\(vec3 viewDir,float heightScale\)/g,replace:"vec2 parallaxOffset(vec3 viewDir, float heightScale, float height_)"},{search:/texture2D\(bumpSampler,vBumpUV\)\.w/g,replace:"height_"}]});var d=c&&s?"texture2D(".concat(s,", ").concat(r.associatedVariableName," + uvOffset).xyz"):this.normalMapColor.associatedVariableName;return t.compilationString+=this._declareOutput(this.output,t)+" = vec4(0.);\r\n",t.compilationString+=t._emitCodeFromInclude("bumpFragment",i,{replaceStrings:[{search:/perturbNormal\(TBN,texture2D\(bumpSampler,vBumpUV\+uvOffset\).xyz,vBumpInfos.y\)/g,replace:"perturbNormal(TBN, ".concat(d,", vBumpInfos.y)")},{search:/parallaxOcclusion\(invTBN\*-viewDirectionW,invTBN\*normalW,vBumpUV,vBumpInfos.z\)/g,replace:"parallaxOcclusion((invTBN * -viewDirectionW), (invTBN * normalW), vBumpUV, vBumpInfos.z, ".concat(c&&this.useParallaxOcclusion?s:"bumpSampler",")")},{search:/parallaxOffset\(invTBN\*viewDirectionW,vBumpInfos\.z\)/g,replace:"parallaxOffset(invTBN * viewDirectionW, vBumpInfos.z, ".concat(c?this.parallaxHeight.associatedVariableName:"0.",")")},{search:/vTangentSpaceParams/g,replace:this._tangentSpaceParameterName},{search:/vBumpInfos.y/g,replace:l},{search:/vBumpInfos.z/g,replace:u},{search:/vBumpUV/g,replace:r.associatedVariableName},{search:/vPositionW/g,replace:n.associatedVariableName+".xyz"},{search:/normalW=/g,replace:this.output.associatedVariableName+".xyz = "},{search:/mat3\(normalMatrix\)\*normalW/g,replace:"mat3(normalMatrix) * "+this.output.associatedVariableName+".xyz"},{search:/normalW/g,replace:o.associatedVariableName+".xyz"},{search:/viewDirectionW/g,replace:c?this.viewDirection.associatedVariableName:"vec3(0.)"},h]}),this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this)+"".concat(this._codeVariableName,".invertX = ").concat(this.invertX,";\r\n");return t+="".concat(this._codeVariableName,".invertY = ").concat(this.invertY,";\r\n"),t+="".concat(this._codeVariableName,".useParallaxOcclusion = ").concat(this.useParallaxOcclusion,";\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.invertX=this.invertX,t.invertY=this.invertY,t.useParallaxOcclusion=this.useParallaxOcclusion,t},t.prototype._deserialize=function(t,i,r){e.prototype._deserialize.call(this,t,i,r),this.invertX=t.invertX,this.invertY=t.invertY,this.useParallaxOcclusion=!!t.useParallaxOcclusion},(0,n.gn)([(0,u.p)("Invert X axis",u.U.Boolean,"PROPERTIES",{notifiers:{update:!1}})],t.prototype,"invertX",void 0),(0,n.gn)([(0,u.p)("Invert Y axis",u.U.Boolean,"PROPERTIES",{notifiers:{update:!1}})],t.prototype,"invertY",void 0),(0,n.gn)([(0,u.p)("Use parallax occlusion",u.U.Boolean)],t.prototype,"useParallaxOcclusion",void 0),t}(o.k));(0,c.H)("BABYLON.PerturbNormalBlock",m);var g=function(e){function t(t){var i=e.call(this,t,s.u.Fragment,!0)||this;return i.registerInput("value",a.E.Float,!0),i.registerInput("cutoff",a.E.Float,!0),i}return(0,n.ZT)(t,e),t.prototype.getClassName=function(){return"DiscardBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cutoff",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),t.sharedData.hints.needAlphaTesting=!0,this.cutoff.isConnected&&this.value.isConnected)return t.compilationString+="if (".concat(this.value.associatedVariableName," < ").concat(this.cutoff.associatedVariableName,") discard;\r\n"),this},t}(o.k);(0,c.H)("BABYLON.DiscardBlock",g);var _=function(e){function t(t){var i=e.call(this,t,s.u.Fragment)||this;return i.registerOutput("output",a.E.Float,s.u.Fragment),i}return(0,n.ZT)(t,e),t.prototype.getClassName=function(){return"FrontFacingBlock"},Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),t.target===s.u.Vertex)throw"FrontFacingBlock must only be used in a fragment shader";var i=this._outputs[0];return t.compilationString+=this._declareOutput(i,t)+" = gl_FrontFacing ? 1.0 : 0.0;\r\n",this},t}(o.k);(0,c.H)("BABYLON.FrontFacingBlock",_);var y=function(e){function t(t){var i=e.call(this,t,s.u.Fragment)||this;return i.registerInput("input",a.E.AutoDetect,!1),i.registerOutput("dx",a.E.BasedOnInput),i.registerOutput("dy",a.E.BasedOnInput),i._outputs[0]._typeConnectionSource=i._inputs[0],i._outputs[1]._typeConnectionSource=i._inputs[0],i}return(0,n.ZT)(t,e),t.prototype.getClassName=function(){return"DerivativeBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dx",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dy",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var i=this._outputs[0],r=this._outputs[1];return t._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable"),i.hasEndpoints&&(t.compilationString+=this._declareOutput(i,t)+" = dFdx(".concat(this.input.associatedVariableName,");\r\n")),r.hasEndpoints&&(t.compilationString+=this._declareOutput(r,t)+" = dFdy(".concat(this.input.associatedVariableName,");\r\n")),this},t}(o.k);(0,c.H)("BABYLON.DerivativeBlock",y);var v=function(e){function t(t){var i=e.call(this,t,s.u.Fragment)||this;return i.registerOutput("xy",a.E.Vector2,s.u.Fragment),i.registerOutput("xyz",a.E.Vector3,s.u.Fragment),i.registerOutput("xyzw",a.E.Vector4,s.u.Fragment),i.registerOutput("x",a.E.Float,s.u.Fragment),i.registerOutput("y",a.E.Float,s.u.Fragment),i.registerOutput("z",a.E.Float,s.u.Fragment),i.registerOutput("w",a.E.Float,s.u.Fragment),i}return(0,n.ZT)(t,e),t.prototype.getClassName=function(){return"FragCoordBlock"},Object.defineProperty(t.prototype,"xy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[6]},enumerable:!1,configurable:!0}),t.prototype.writeOutputs=function(e){for(var t="",i=0,r=this._outputs;i<r.length;i++){var n=r[i];n.hasEndpoints&&(t+="".concat(this._declareOutput(n,e)," = gl_FragCoord.").concat(n.name,";\r\n"))}return t},t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),t.target===s.u.Vertex)throw"FragCoordBlock must only be used in a fragment shader";return t.compilationString+=this.writeOutputs(t),this},t}(o.k);(0,c.H)("BABYLON.FragCoordBlock",v);var b=function(e){function t(t){var i=e.call(this,t,s.u.Fragment)||this;return i.registerOutput("xy",a.E.Vector2,s.u.Fragment),i.registerOutput("x",a.E.Float,s.u.Fragment),i.registerOutput("y",a.E.Float,s.u.Fragment),i}return(0,n.ZT)(t,e),t.prototype.getClassName=function(){return"ScreenSizeBlock"},Object.defineProperty(t.prototype,"xy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.bind=function(e){var t=this._scene.getEngine();e.setFloat2(this._varName,t.getRenderWidth(),t.getRenderHeight())},t.prototype.writeOutputs=function(e,t){for(var i="",r=0,n=this._outputs;r<n.length;r++){var o=n[r];o.hasEndpoints&&(i+="".concat(this._declareOutput(o,e)," = ").concat(t,".").concat(o.name,";\r\n"))}return i},t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),this._scene=t.sharedData.scene,t.target===s.u.Vertex)throw"ScreenSizeBlock must only be used in a fragment shader";return t.sharedData.bindableBlocks.push(this),this._varName=t._getFreeVariableName("screenSize"),t._emitUniformFromString(this._varName,"vec2"),t.compilationString+=this.writeOutputs(t,this._varName),this},t}(o.k);(0,c.H)("BABYLON.ScreenSizeBlock",b);var S=i(69958),C=function(e){function t(t){var i=e.call(this,t,s.u.Fragment)||this;return i.registerInput("vector",a.E.Vector3),i.registerInput("worldViewProjection",a.E.Matrix),i.registerOutput("output",a.E.Vector2),i.registerOutput("x",a.E.Float),i.registerOutput("y",a.E.Float),i.inputs[0].acceptedConnectionPointTypes.push(a.E.Vector4),i}return(0,n.ZT)(t,e),t.prototype.getClassName=function(){return"ScreenSpaceBlock"},Object.defineProperty(t.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldViewProjection",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.worldViewProjection.isConnected){var t=e.getInputBlockByPredicate((function(e){return e.systemValue===S.$.WorldViewProjection}));t||(t=new p.S("worldViewProjection")).setAsSystemValue(S.$.WorldViewProjection),t.output.connectTo(this.worldViewProjection)}},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var i=this.vector,r=this.worldViewProjection;if(i.connectedPoint){var n=r.associatedVariableName,o=t._getFreeVariableName("screenSpaceTemp");switch(i.connectedPoint.type){case a.E.Vector3:t.compilationString+="vec4 ".concat(o," = ").concat(n," * vec4(").concat(i.associatedVariableName,", 1.0);\r\n");break;case a.E.Vector4:t.compilationString+="vec4 ".concat(o," = ").concat(n," * ").concat(i.associatedVariableName,";\r\n")}return t.compilationString+="".concat(o,".xy /= ").concat(o,".w;"),t.compilationString+="".concat(o,".xy = ").concat(o,".xy * 0.5 + vec2(0.5, 0.5);"),this.output.hasEndpoints&&(t.compilationString+=this._declareOutput(this.output,t)+" = ".concat(o,".xy;\r\n")),this.x.hasEndpoints&&(t.compilationString+=this._declareOutput(this.x,t)+" = ".concat(o,".x;\r\n")),this.y.hasEndpoints&&(t.compilationString+=this._declareOutput(this.y,t)+" = ".concat(o,".y;\r\n")),this}},t}(o.k);(0,c.H)("BABYLON.ScreenSpaceBlock",C);var x=i(58095),T=function(e){function t(t){var i=e.call(this,t,s.u.Fragment)||this;return i.registerInput("input",a.E.Vector2),i.registerInput("strength",a.E.Float),i.registerInput("center",a.E.Vector2),i.registerInput("offset",a.E.Vector2),i.registerOutput("output",a.E.Vector2),i.registerOutput("x",a.E.Float),i.registerOutput("y",a.E.Float),i}return(0,n.ZT)(t,e),t.prototype.getClassName=function(){return"TwirlBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"strength",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offset",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(){if(!this.center.isConnected){var e=new p.S("center");e.value=new x.FM(.5,.5),e.output.connectTo(this.center)}if(!this.strength.isConnected){var t=new p.S("strength");t.value=1,t.output.connectTo(this.strength)}if(!this.offset.isConnected){var i=new p.S("offset");i.value=new x.FM(0,0),i.output.connectTo(this.offset)}},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var i=t._getFreeVariableName("delta"),r=t._getFreeVariableName("angle"),n=t._getFreeVariableName("x"),o=t._getFreeVariableName("y"),a=t._getFreeVariableName("result");return t.compilationString+="\n            vec2 ".concat(i," = ").concat(this.input.associatedVariableName," - ").concat(this.center.associatedVariableName,";\n            float ").concat(r," = ").concat(this.strength.associatedVariableName," * length(").concat(i,");\n            float ").concat(n," = cos(").concat(r,") * ").concat(i,".x - sin(").concat(r,") * ").concat(i,".y;\n            float ").concat(o," = sin(").concat(r,") * ").concat(i,".x + cos(").concat(r,") * ").concat(i,".y;\n            vec2 ").concat(a," = vec2(").concat(n," + ").concat(this.center.associatedVariableName,".x + ").concat(this.offset.associatedVariableName,".x, ").concat(o," + ").concat(this.center.associatedVariableName,".y + ").concat(this.offset.associatedVariableName,".y);\n        "),this.output.hasEndpoints&&(t.compilationString+=this._declareOutput(this.output,t)+" = ".concat(a,";\r\n")),this.x.hasEndpoints&&(t.compilationString+=this._declareOutput(this.x,t)+" = ".concat(a,".x;\r\n")),this.y.hasEndpoints&&(t.compilationString+=this._declareOutput(this.y,t)+" = ".concat(a,".y;\r\n")),this},t}(o.k);(0,c.H)("BABYLON.TwirlBlock",T)},97425:(e,t,i)=>{var r;i.d(t,{c:()=>r}),function(e){e[e.None=0]="None",e[e.Time=1]="Time"}(r||(r={}))},32247:(e,t,i)=>{i.d(t,{S:()=>r.S,c:()=>n.c});var r=i(62976),n=i(97425)},62976:(e,t,i)=>{i.d(t,{S:()=>_});var r=i(31191),n=i(89592),o=i(89762),a=i(88215),s=i(69958),c=i(58095),u=i(70848),l=i(48620),h=i(6307),p=i(97425),d=i(62897),f={position2d:"position",particle_uv:"vUV",particle_color:"vColor",particle_texturemask:"textureMask",particle_positionw:"vPositionW"},m={particle_uv:!0,particle_color:!0,particle_texturemask:!0,particle_positionw:!0},g={particle_texturemask:!0},_=function(e){function t(t,i,r){void 0===i&&(i=u.u.Vertex),void 0===r&&(r=o.E.AutoDetect);var n=e.call(this,t,i,!1,!0)||this;return n._mode=a.M.Undefined,n._animationType=p.c.None,n.min=0,n.max=0,n.isBoolean=!1,n.matrixMode=0,n._systemValue=null,n.isConstant=!1,n.groupInInspector="",n.onValueChangedObservable=new d.y$,n.convertToGammaSpace=!1,n.convertToLinearSpace=!1,n._type=r,n.setDefaultValue(),n.registerOutput("output",r),n}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"type",{get:function(){if(this._type===o.E.AutoDetect){if(this.isUniform&&null!=this.value){if(!isNaN(this.value))return this._type=o.E.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=o.E.Vector2,this._type;case"Vector3":return this._type=o.E.Vector3,this._type;case"Vector4":return this._type=o.E.Vector4,this._type;case"Color3":return this._type=o.E.Color3,this._type;case"Color4":return this._type=o.E.Color4,this._type;case"Matrix":return this._type=o.E.Matrix,this._type}}if(this.isAttribute)switch(this.name){case"position":case"normal":case"particle_positionw":return this._type=o.E.Vector3,this._type;case"uv":case"uv2":case"uv3":case"uv4":case"uv5":case"uv6":case"position2d":case"particle_uv":return this._type=o.E.Vector2,this._type;case"matricesIndices":case"matricesWeights":case"world0":case"world1":case"world2":case"world3":case"tangent":return this._type=o.E.Vector4,this._type;case"color":case"instanceColor":case"particle_color":case"particle_texturemask":return this._type=o.E.Color4,this._type}if(this.isSystemValue)switch(this._systemValue){case s.$.World:case s.$.WorldView:case s.$.WorldViewProjection:case s.$.View:case s.$.ViewProjection:case s.$.Projection:return this._type=o.E.Matrix,this._type;case s.$.CameraPosition:return this._type=o.E.Vector3,this._type;case s.$.FogColor:return this._type=o.E.Color3,this._type;case s.$.DeltaTime:case s.$.MaterialAlpha:return this._type=o.E.Float,this._type;case s.$.CameraParameters:return this._type=o.E.Vector4,this._type}}return this._type},enumerable:!1,configurable:!0}),t.prototype.validateBlockName=function(t){return!!this.isAttribute||e.prototype.validateBlockName.call(this,t)},Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.setAsAttribute=function(e){return this._mode=a.M.Attribute,e&&(this.name=e),this},t.prototype.setAsSystemValue=function(e){return this.systemValue=e,this},Object.defineProperty(t.prototype,"value",{get:function(){return this._storedValue},set:function(e){this.type===o.E.Float&&(this.isBoolean?e=e?1:0:this.min!==this.max&&(e=Math.max(this.min,e),e=Math.min(this.max,e))),this._storedValue=e,this._mode=a.M.Uniform,this.onValueChangedObservable.notifyObservers(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valueCallback",{get:function(){return this._valueCallback},set:function(e){this._valueCallback=e,this._mode=a.M.Uniform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"associatedVariableName",{get:function(){return this._associatedVariableName},set:function(e){this._associatedVariableName=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationType",{get:function(){return this._animationType},set:function(e){this._animationType=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUndefined",{get:function(){return this._mode===a.M.Undefined},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUniform",{get:function(){return this._mode===a.M.Uniform},set:function(e){this._mode=e?a.M.Uniform:a.M.Undefined,this.associatedVariableName=""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAttribute",{get:function(){return this._mode===a.M.Attribute},set:function(e){this._mode=e?a.M.Attribute:a.M.Undefined,this.associatedVariableName=""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVarying",{get:function(){return this._mode===a.M.Varying},set:function(e){this._mode=e?a.M.Varying:a.M.Undefined,this.associatedVariableName=""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSystemValue",{get:function(){return null!=this._systemValue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"systemValue",{get:function(){return this._systemValue},set:function(e){this._mode=a.M.Uniform,this.associatedVariableName="",this._systemValue=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"InputBlock"},t.prototype.animate=function(e){if(this._animationType===p.c.Time)this.type===o.E.Float&&(this.value+=.01*e.getAnimationRatio())},t.prototype._emitDefine=function(e){return"!"===e[0]?"#ifndef ".concat(e.substring(1),"\r\n"):"#ifdef ".concat(e,"\r\n")},t.prototype.initialize=function(){this.associatedVariableName=""},t.prototype.setDefaultValue=function(){switch(this.type){case o.E.Float:this.value=0;break;case o.E.Vector2:this.value=c.FM.Zero();break;case o.E.Vector3:this.value=c.P.Zero();break;case o.E.Vector4:this.value=c.Lt.Zero();break;case o.E.Color3:this.value=h.Wo.White();break;case o.E.Color4:this.value=new h.HE(1,1,1,1);break;case o.E.Matrix:this.value=c.y3.Identity()}},t.prototype._emitConstant=function(e){switch(this.type){case o.E.Float:return"".concat(e._emitFloat(this.value));case o.E.Vector2:return"vec2(".concat(this.value.x,", ").concat(this.value.y,")");case o.E.Vector3:return"vec3(".concat(this.value.x,", ").concat(this.value.y,", ").concat(this.value.z,")");case o.E.Vector4:return"vec4(".concat(this.value.x,", ").concat(this.value.y,", ").concat(this.value.z,", ").concat(this.value.w,")");case o.E.Color3:return h.zZ.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&h.zZ.Color3[0].toGammaSpaceToRef(h.zZ.Color3[0]),this.convertToLinearSpace&&h.zZ.Color3[0].toLinearSpaceToRef(h.zZ.Color3[0]),"vec3(".concat(h.zZ.Color3[0].r,", ").concat(h.zZ.Color3[0].g,", ").concat(h.zZ.Color3[0].b,")");case o.E.Color4:return h.zZ.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&h.zZ.Color4[0].toGammaSpaceToRef(h.zZ.Color4[0]),this.convertToLinearSpace&&h.zZ.Color4[0].toLinearSpaceToRef(h.zZ.Color4[0]),"vec4(".concat(h.zZ.Color4[0].r,", ").concat(h.zZ.Color4[0].g,", ").concat(h.zZ.Color4[0].b,", ").concat(h.zZ.Color4[0].a,")")}return""},Object.defineProperty(t.prototype,"_noContextSwitch",{get:function(){return m[this.name]},enumerable:!1,configurable:!0}),t.prototype._emit=function(e,t){var i;if(this.isUniform){if(this.associatedVariableName||(this.associatedVariableName=e._getFreeVariableName("u_"+this.name)),this.isConstant){if(-1!==e.constants.indexOf(this.associatedVariableName))return;return e.constants.push(this.associatedVariableName),void(e._constantDeclaration+=this._declareOutput(this.output,e)+" = ".concat(this._emitConstant(e),";\r\n"))}if(-1!==e.uniforms.indexOf(this.associatedVariableName))return;e.uniforms.push(this.associatedVariableName),t&&(e._uniformDeclaration+=this._emitDefine(t)),e._uniformDeclaration+="uniform ".concat(e._getGLType(this.type)," ").concat(this.associatedVariableName,";\r\n"),t&&(e._uniformDeclaration+="#endif\r\n");var r=e.sharedData.hints;if(null!==this._systemValue&&void 0!==this._systemValue)switch(this._systemValue){case s.$.WorldView:r.needWorldViewMatrix=!0;break;case s.$.WorldViewProjection:r.needWorldViewProjectionMatrix=!0}else this._animationType!==p.c.None&&e.sharedData.animatedInputs.push(this)}else if(this.isAttribute){if(this.associatedVariableName=null!==(i=f[this.name])&&void 0!==i?i:this.name,this.target===u.u.Vertex&&e._vertexState)return void(m[this.name]?g[this.name]?e._emitUniformFromString(this.associatedVariableName,e._getGLType(this.type),t):e._emitVaryingFromString(this.associatedVariableName,e._getGLType(this.type),t):this._emit(e._vertexState,t));if(-1!==e.attributes.indexOf(this.associatedVariableName))return;e.attributes.push(this.associatedVariableName),m[this.name]?g[this.name]?e._emitUniformFromString(this.associatedVariableName,e._getGLType(this.type),t):e._emitVaryingFromString(this.associatedVariableName,e._getGLType(this.type),t):(t&&(e._attributeDeclaration+=this._emitDefine(t)),e._attributeDeclaration+="attribute ".concat(e._getGLType(this.type)," ").concat(this.associatedVariableName,";\r\n"),t&&(e._attributeDeclaration+="#endif\r\n"))}},t.prototype._transmitWorld=function(e,t,i,r){if(this._systemValue){var n=this.associatedVariableName;switch(this._systemValue){case s.$.World:e.setMatrix(n,t);break;case s.$.WorldView:e.setMatrix(n,i);break;case s.$.WorldViewProjection:e.setMatrix(n,r)}}},t.prototype._transmit=function(e,t,i){if(!this.isAttribute){var r=this.associatedVariableName;if(this._systemValue)switch(this._systemValue){case s.$.World:case s.$.WorldView:case s.$.WorldViewProjection:return;case s.$.View:e.setMatrix(r,t.getViewMatrix());break;case s.$.Projection:e.setMatrix(r,t.getProjectionMatrix());break;case s.$.ViewProjection:e.setMatrix(r,t.getTransformMatrix());break;case s.$.CameraPosition:t.bindEyePosition(e,r,!0);break;case s.$.FogColor:e.setColor3(r,t.fogColor);break;case s.$.DeltaTime:e.setFloat(r,t.deltaTime/1e3);break;case s.$.CameraParameters:t.activeCamera&&e.setFloat4(r,t.getEngine().hasOriginBottomLeft?-1:1,t.activeCamera.minZ,t.activeCamera.maxZ,1/t.activeCamera.maxZ);break;case s.$.MaterialAlpha:e.setFloat(r,i.alpha)}else{var n=this._valueCallback?this._valueCallback():this._storedValue;if(null!==n)switch(this.type){case o.E.Float:e.setFloat(r,n);break;case o.E.Int:e.setInt(r,n);break;case o.E.Color3:h.zZ.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&h.zZ.Color3[0].toGammaSpaceToRef(h.zZ.Color3[0]),this.convertToLinearSpace&&h.zZ.Color3[0].toLinearSpaceToRef(h.zZ.Color3[0]),e.setColor3(r,h.zZ.Color3[0]);break;case o.E.Color4:h.zZ.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&h.zZ.Color4[0].toGammaSpaceToRef(h.zZ.Color4[0]),this.convertToLinearSpace&&h.zZ.Color4[0].toLinearSpaceToRef(h.zZ.Color4[0]),e.setDirectColor4(r,h.zZ.Color4[0]);break;case o.E.Vector2:e.setVector2(r,n);break;case o.E.Vector3:e.setVector3(r,n);break;case o.E.Vector4:e.setVector4(r,n);break;case o.E.Matrix:e.setMatrix(r,n)}}}},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t),(this.isUniform||this.isSystemValue)&&t.sharedData.inputBlocks.push(this),this._emit(t)},t.prototype._dumpPropertiesCode=function(){var t=this._codeVariableName;if(this.isAttribute)return e.prototype._dumpPropertiesCode.call(this)+"".concat(t,'.setAsAttribute("').concat(this.name,'");\r\n');if(this.isSystemValue)return e.prototype._dumpPropertiesCode.call(this)+"".concat(t,".setAsSystemValue(BABYLON.NodeMaterialSystemValues.").concat(s.$[this._systemValue],");\r\n");if(this.isUniform){var i=[],r="";switch(this.type){case o.E.Float:r="".concat(this.value);break;case o.E.Vector2:r="new BABYLON.Vector2(".concat(this.value.x,", ").concat(this.value.y,")");break;case o.E.Vector3:r="new BABYLON.Vector3(".concat(this.value.x,", ").concat(this.value.y,", ").concat(this.value.z,")");break;case o.E.Vector4:r="new BABYLON.Vector4(".concat(this.value.x,", ").concat(this.value.y,", ").concat(this.value.z,", ").concat(this.value.w,")");break;case o.E.Color3:r="new BABYLON.Color3(".concat(this.value.r,", ").concat(this.value.g,", ").concat(this.value.b,")"),this.convertToGammaSpace&&(r+=".toGammaSpace()"),this.convertToLinearSpace&&(r+=".toLinearSpace()");break;case o.E.Color4:r="new BABYLON.Color4(".concat(this.value.r,", ").concat(this.value.g,", ").concat(this.value.b,", ").concat(this.value.a,")"),this.convertToGammaSpace&&(r+=".toGammaSpace()"),this.convertToLinearSpace&&(r+=".toLinearSpace()");break;case o.E.Matrix:r="BABYLON.Matrix.FromArray([".concat(this.value.m,"])")}return i.push("".concat(t,".value = ").concat(r)),this.type===o.E.Float&&i.push("".concat(t,".min = ").concat(this.min),"".concat(t,".max = ").concat(this.max),"".concat(t,".isBoolean = ").concat(this.isBoolean),"".concat(t,".matrixMode = ").concat(this.matrixMode),"".concat(t,".animationType = BABYLON.AnimatedInputBlockTypes.").concat(p.c[this.animationType])),i.push("".concat(t,".isConstant = ").concat(this.isConstant)),i.push(""),e.prototype._dumpPropertiesCode.call(this)+i.join(";\r\n")}return e.prototype._dumpPropertiesCode.call(this)},t.prototype.dispose=function(){this.onValueChangedObservable.clear(),e.prototype.dispose.call(this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.type=this.type,t.mode=this._mode,t.systemValue=this._systemValue,t.animationType=this._animationType,t.min=this.min,t.max=this.max,t.isBoolean=this.isBoolean,t.matrixMode=this.matrixMode,t.isConstant=this.isConstant,t.groupInInspector=this.groupInInspector,t.convertToGammaSpace=this.convertToGammaSpace,t.convertToLinearSpace=this.convertToLinearSpace,null!=this._storedValue&&this._mode===a.M.Uniform&&(this._storedValue.asArray?(t.valueType="BABYLON."+this._storedValue.getClassName(),t.value=this._storedValue.asArray()):(t.valueType="number",t.value=this._storedValue)),t},t.prototype._deserialize=function(t,i,r){if(this._mode=t.mode,e.prototype._deserialize.call(this,t,i,r),this._type=t.type,this._systemValue=t.systemValue||t.wellKnownValue,this._animationType=t.animationType,this.min=t.min||0,this.max=t.max||0,this.isBoolean=!!t.isBoolean,this.matrixMode=t.matrixMode||0,this.isConstant=!!t.isConstant,this.groupInInspector=t.groupInInspector||"",this.convertToGammaSpace=!!t.convertToGammaSpace,this.convertToLinearSpace=!!t.convertToLinearSpace,"tangent"===t.name&&t.mode===a.M.Attribute&&t.type===o.E.Vector3&&(this._type=o.E.Vector4),t.valueType)if("number"===t.valueType)this._storedValue=t.value;else{var n=(0,l.q)(t.valueType);n&&(this._storedValue=n.FromArray(t.value))}},t}(n.k);(0,l.H)("BABYLON.InputBlock",_)},23680:(e,t,i)=>{i.d(t,{p:()=>h});var r=i(31191),n=i(89592),o=i(89762),a=i(96979),s=i(70848),c=i(48620),u=i(93682),l=i(80498),h=function(e){function t(i){var r=e.call(this,i,s.u.Fragment)||this;return r._isUnique=!0,r.registerInput("intensity",o.E.Float,!0,s.u.Fragment),r.registerInput("direction",o.E.Vector2,!0,s.u.Fragment),r.registerInput("uv",o.E.Vector2,!0),r.registerInput("worldTangent",o.E.Vector4,!0),r.registerInput("TBN",o.E.Object,!0,s.u.VertexAndFragment,new u.C("TBN",r,a.Ab.Input,l.v,"TBNBlock")),r.registerOutput("anisotropy",o.E.Object,s.u.Fragment,new u.C("anisotropy",r,a.Ab.Output,t,"AnisotropyBlock")),r}return(0,r.ZT)(t,e),t.prototype.initialize=function(e){e._excludeVariableName("anisotropicOut"),e._excludeVariableName("TBN")},t.prototype.getClassName=function(){return"AnisotropyBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"TBN",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anisotropy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._generateTBNSpace=function(e){var t="",i="//".concat(this.name),r=this.uv,n=this.worldPositionConnectionPoint,o=this.worldNormalConnectionPoint,a=this.worldTangent;r.isConnected,e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var s={search:/defined\(TANGENT\)/g,replace:a.isConnected?"defined(TANGENT)":"defined(IGNORE)"},c=this.TBN;return c.isConnected?e.compilationString+="\n            #ifdef TBNBLOCK\n            mat3 vTBN = ".concat(c.associatedVariableName,";\n            #endif\n            "):a.isConnected&&(t+="vec3 tbnNormal = normalize(".concat(o.associatedVariableName,".xyz);\r\n"),t+="vec3 tbnTangent = normalize(".concat(a.associatedVariableName,".xyz);\r\n"),t+="vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r\n",t+="mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n"),t+="\n            #if defined(".concat(a.isConnected?"TANGENT":"IGNORE",") && defined(NORMAL)\n                mat3 TBN = vTBN;\n            #else\n                mat3 TBN = cotangent_frame(").concat(o.associatedVariableName+".xyz",", ").concat("v_"+n.associatedVariableName+".xyz",", ").concat(r.isConnected?r.associatedVariableName:"vec2(0.)",", vec2(1., 1.));\n            #endif\r\n"),e._emitFunctionFromInclude("bumpFragmentMainFunctions",i,{replaceStrings:[s]}),t},t.prototype.getCode=function(e,t){void 0===t&&(t=!1);var i="";t&&(i+=this._generateTBNSpace(e));var r=this.intensity.isConnected?this.intensity.associatedVariableName:"1.0",n=this.direction.isConnected?this.direction.associatedVariableName:"vec2(1., 0.)";return i+="anisotropicOutParams anisotropicOut;\n            anisotropicBlock(\n                vec3(".concat(n,", ").concat(r,"),\n            #ifdef ANISOTROPIC_TEXTURE\n                vec3(0.),\n            #endif\n                TBN,\n                normalW,\n                viewDirectionW,\n                anisotropicOut\n            );\r\n")},t.prototype.prepareDefines=function(t,i,r){e.prototype.prepareDefines.call(this,t,i,r),r.setValue("ANISOTROPIC",!0),r.setValue("ANISOTROPIC_TEXTURE",!1,!0)},t.prototype._buildBlock=function(e){return e.target===s.u.Fragment&&e.sharedData.blocksWithDefines.push(this),this},t}(n.k);(0,c.H)("BABYLON.AnisotropyBlock",h)},24278:(e,t,i)=>{i.d(t,{N:()=>f});var r=i(31191),n=i(89592),o=i(89762),a=i(96979),s=i(70848),c=i(48620),u=i(62976),l=i(93682),h=i(13283),p=i(12352),d=i(80498),f=function(e){function t(i){var r=e.call(this,i,s.u.Fragment)||this;return r.remapF0OnInterfaceChange=!0,r._isUnique=!0,r.registerInput("intensity",o.E.Float,!1,s.u.Fragment),r.registerInput("roughness",o.E.Float,!0,s.u.Fragment),r.registerInput("indexOfRefraction",o.E.Float,!0,s.u.Fragment),r.registerInput("normalMapColor",o.E.Color3,!0,s.u.Fragment),r.registerInput("uv",o.E.Vector2,!0,s.u.Fragment),r.registerInput("tintColor",o.E.Color3,!0,s.u.Fragment),r.registerInput("tintAtDistance",o.E.Float,!0,s.u.Fragment),r.registerInput("tintThickness",o.E.Float,!0,s.u.Fragment),r.registerInput("worldTangent",o.E.Vector4,!0),r.registerInput("worldNormal",o.E.Vector4,!0),r.worldNormal.acceptedConnectionPointTypes.push(o.E.Vector3),r.registerInput("TBN",o.E.Object,!0,s.u.VertexAndFragment,new l.C("TBN",r,a.Ab.Input,d.v,"TBNBlock")),r.registerOutput("clearcoat",o.E.Object,s.u.Fragment,new l.C("clearcoat",r,a.Ab.Output,t,"ClearCoatBlock")),r}return(0,r.ZT)(t,e),t.prototype.initialize=function(e){e._excludeVariableName("clearcoatOut"),e._excludeVariableName("vClearCoatParams"),e._excludeVariableName("vClearCoatTintParams"),e._excludeVariableName("vClearCoatRefractionParams"),e._excludeVariableName("vClearCoatTangentSpaceParams"),e._excludeVariableName("vGeometricNormaClearCoatW")},t.prototype.getClassName=function(){return"ClearCoatBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roughness",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalMapColor",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintAtDistance",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintThickness",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTangent",{get:function(){return this._inputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[9]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"TBN",{get:function(){return this._inputs[10]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoat",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(){if(!this.intensity.isConnected){var e=new u.S("ClearCoat intensity",s.u.Fragment,o.E.Float);e.value=1,e.output.connectTo(this.intensity)}},t.prototype.prepareDefines=function(t,i,r){e.prototype.prepareDefines.call(this,t,i,r),r.setValue("CLEARCOAT",!0),r.setValue("CLEARCOAT_TEXTURE",!1,!0),r.setValue("CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE",!0,!0),r.setValue("CLEARCOAT_TINT",this.tintColor.isConnected||this.tintThickness.isConnected||this.tintAtDistance.isConnected,!0),r.setValue("CLEARCOAT_BUMP",this.normalMapColor.isConnected,!0),r.setValue("CLEARCOAT_DEFAULTIOR",!this.indexOfRefraction.isConnected||this.indexOfRefraction.connectInputBlock.value===h.Y._DefaultIndexOfRefraction,!0),r.setValue("CLEARCOAT_REMAP_F0",this.remapF0OnInterfaceChange,!0)},t.prototype.bind=function(t,i,r){var n,o;e.prototype.bind.call(this,t,i,r);var a=null!==(o=null===(n=this.indexOfRefraction.connectInputBlock)||void 0===n?void 0:n.value)&&void 0!==o?o:h.Y._DefaultIndexOfRefraction,s=1-a,c=1+a,u=Math.pow(-s/c,2),l=1/a;t.setFloat4("vClearCoatRefractionParams",u,l,s,c);var p=this.clearcoat.hasEndpoints?this.clearcoat.endpoints[0].ownerBlock:null,d=(null==p?void 0:p.perturbedNormal.isConnected)?p.perturbedNormal.connectedPoint.ownerBlock:null;this._scene._mirroredCameraPosition?t.setFloat2("vClearCoatTangentSpaceParams",(null==d?void 0:d.invertX)?1:-1,(null==d?void 0:d.invertY)?1:-1):t.setFloat2("vClearCoatTangentSpaceParams",(null==d?void 0:d.invertX)?-1:1,(null==d?void 0:d.invertY)?-1:1)},t.prototype._generateTBNSpace=function(e,t,i){var r="",n="//".concat(this.name),o=this.worldTangent;e._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var a={search:/defined\(TANGENT\)/g,replace:o.isConnected?"defined(TANGENT)":"defined(IGNORE)"},s=this.TBN;return s.isConnected?e.compilationString+="\n            #ifdef TBNBLOCK\n            mat3 vTBN = ".concat(s.associatedVariableName,";\n            #endif\n            "):o.isConnected&&(r+="vec3 tbnNormal = normalize(".concat(i,".xyz);\r\n"),r+="vec3 tbnTangent = normalize(".concat(o.associatedVariableName,".xyz);\r\n"),r+="vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r\n",r+="mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n"),e._emitFunctionFromInclude("bumpFragmentMainFunctions",n,{replaceStrings:[a]}),r},t.GetCode=function(e,t,i,r,n,o,a){var s="",c=(null==t?void 0:t.intensity.isConnected)?t.intensity.associatedVariableName:"1.",u=(null==t?void 0:t.roughness.isConnected)?t.roughness.associatedVariableName:"0.",l=(null==t?void 0:t.normalMapColor.isConnected)?t.normalMapColor.associatedVariableName:"vec3(0.)",h=(null==t?void 0:t.uv.isConnected)?t.uv.associatedVariableName:"vec2(0.)",p=(null==t?void 0:t.tintColor.isConnected)?t.tintColor.associatedVariableName:"vec3(1.)",d=(null==t?void 0:t.tintThickness.isConnected)?t.tintThickness.associatedVariableName:"1.",f=(null==t?void 0:t.tintAtDistance.isConnected)?t.tintAtDistance.associatedVariableName:"1.";if(t){e._emitUniformFromString("vClearCoatRefractionParams","vec4"),e._emitUniformFromString("vClearCoatTangentSpaceParams","vec2");var m=t.worldNormal;s+="vec3 vGeometricNormaClearCoatW = ".concat(m.isConnected?"normalize("+m.associatedVariableName+".xyz)":"geometricNormalW",";\r\n")}else s+="vec3 vGeometricNormaClearCoatW = geometricNormalW;\r\n";return n&&t&&(s+=t._generateTBNSpace(e,r,a),o=t.worldTangent.isConnected),s+="clearcoatOutParams clearcoatOut;\n\n        #ifdef CLEARCOAT\n            vec2 vClearCoatParams = vec2(".concat(c,", ").concat(u,");\n            vec4 vClearCoatTintParams = vec4(").concat(p,", ").concat(d,");\n\n            clearcoatBlock(\n                ").concat(r,".xyz,\n                vGeometricNormaClearCoatW,\n                viewDirectionW,\n                vClearCoatParams,\n                specularEnvironmentR0,\n            #ifdef CLEARCOAT_TEXTURE\n                vec2(0.),\n            #endif\n            #ifdef CLEARCOAT_TINT\n                vClearCoatTintParams,\n                ").concat(f,",\n                vClearCoatRefractionParams,\n                #ifdef CLEARCOAT_TINT_TEXTURE\n                    ").concat("vec4(0.)",",\n                #endif\n            #endif\n            #ifdef CLEARCOAT_BUMP\n                vec2(0., 1.),\n                vec4(").concat(l,", 0.),\n                ").concat(h,",\n                #if defined(").concat(o?"TANGENT":"IGNORE",") && defined(NORMAL)\n                    vTBN,\n                #else\n                    vClearCoatTangentSpaceParams,\n                #endif\n                #ifdef OBJECTSPACE_NORMALMAP\n                    normalMatrix,\n                #endif\n            #endif\n            #if defined(FORCENORMALFORWARD) && defined(NORMAL)\n                faceNormal,\n            #endif\n            #ifdef REFLECTION\n                ").concat(null==i?void 0:i._vReflectionMicrosurfaceInfosName,",\n                ").concat(null==i?void 0:i._vReflectionInfosName,",\n                ").concat(null==i?void 0:i.reflectionColor,",\n                vLightingIntensity,\n                #ifdef ").concat(null==i?void 0:i._define3DName,"\n                    ").concat(null==i?void 0:i._cubeSamplerName,",\n                #else\n                    ").concat(null==i?void 0:i._2DSamplerName,",\n                #endif\n                #ifndef LODBASEDMICROSFURACE\n                    #ifdef ").concat(null==i?void 0:i._define3DName,"\n                        ").concat(null==i?void 0:i._cubeSamplerName,",\n                        ").concat(null==i?void 0:i._cubeSamplerName,",\n                    #else\n                        ").concat(null==i?void 0:i._2DSamplerName,",\n                        ").concat(null==i?void 0:i._2DSamplerName,",\n                    #endif\n                #endif\n            #endif\n            #if defined(ENVIRONMENTBRDF) && !defined(").concat(null==i?void 0:i._defineSkyboxName,")\n                #ifdef RADIANCEOCCLUSION\n                    ambientMonochrome,\n                #endif\n            #endif\n            #if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n                (gl_FrontFacing ? 1. : -1.),\n            #endif\n                clearcoatOut\n            );\n        #else\n            clearcoatOut.specularEnvironmentR0 = specularEnvironmentR0;\n        #endif\r\n")},t.prototype._buildBlock=function(e){return this._scene=e.sharedData.scene,e.target===s.u.Fragment&&(e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this)),this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);return t+="".concat(this._codeVariableName,".remapF0OnInterfaceChange = ").concat(this.remapF0OnInterfaceChange,";\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.remapF0OnInterfaceChange=this.remapF0OnInterfaceChange,t},t.prototype._deserialize=function(t,i,r){var n;e.prototype._deserialize.call(this,t,i,r),this.remapF0OnInterfaceChange=null===(n=t.remapF0OnInterfaceChange)||void 0===n||n},(0,r.gn)([(0,p.p)("Remap F0 on interface change",p.U.Boolean,"ADVANCED")],t.prototype,"remapF0OnInterfaceChange",void 0),t}(n.k);(0,c.H)("BABYLON.ClearCoatBlock",f)},63881:(e,t,i)=>{i.d(t,{Jc:()=>a.J,MA:()=>r.M,N_:()=>s.N,bc:()=>c.b,gm:()=>n.g,lr:()=>u.l,pk:()=>o.p});var r=i(84315),n=i(55159),o=i(23680),a=i(69890),s=i(24278),c=i(45073),u=i(76882)}}]);