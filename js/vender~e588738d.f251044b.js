"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4906],{28674:(e,t,i)=>{i.d(t,{Bn:()=>h,lD:()=>c,zz:()=>u});var r=i(31191),n=i(58095),s=i(72739),a=i(48154),o=i(89223),h=function(){function e(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new c("icosahedron","Regular",[[0,a.Q_,-1],[-a.Q_,1,0],[-1,0,-a.Q_],[1,0,-a.Q_],[a.Q_,1,0],[0,a.Q_,1],[-1,0,a.Q_],[-a.Q_,-1,0],[0,-a.Q_,-1],[a.Q_,-1,0],[1,0,a.Q_],[0,-a.Q_,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}return e.prototype.setIndices=function(){var e,t,i,r,n,a,h,c=12,u={},l=this.m,d=this.n,f=l;0!==d&&(f=s.R.HCF(l,d)),e=l/f,t=d/f;var p,g,_,v=o.a.Zero(),m=new o.a(l,d),y=new o.a(-d,l+d),x=o.a.Zero(),b=o.a.Zero(),I=o.a.Zero(),M=[],D=[],B=this.vertByDist,A=function(e,t,i,r){g=t+"|"+r,(p=e+"|"+i)in u||g in u?p in u&&!(g in u)?u[g]=u[p]:g in u&&!(p in u)&&(u[p]=u[g]):(u[p]=c,u[g]=c,c++),B[i][0]>2?D[u[p]]=[-B[i][0],B[i][1],u[p]]:D[u[p]]=[M[B[i][0]],B[i][1],u[p]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(var S=0;S<20;S++){if(n=(M=this.IDATA.face[S])[2],a=M[1],h=M[0],_=v.x+"|"+v.y,(p=S+"|"+_)in u||(u[p]=n,D[n]=[M[B[_][0]],B[_][1]]),_=m.x+"|"+m.y,(p=S+"|"+_)in u||(u[p]=a,D[a]=[M[B[_][0]],B[_][1]]),_=y.x+"|"+y.y,(p=S+"|"+_)in u||(u[p]=h,D[h]=[M[B[_][0]],B[_][1]]),i=this.IDATA.edgematch[S][0],"B"===(r=this.IDATA.edgematch[S][1]))for(var P=1;P<f;P++)b.x=l-P*(e+t),b.y=d+P*e,I.x=-P*t,I.y=P*(e+t),A(S,i,_=b.x+"|"+b.y,I.x+"|"+I.y);if("O"===r)for(P=1;P<f;P++)I.x=-P*t,I.y=P*(e+t),x.x=P*e,x.y=P*t,A(S,i,_=I.x+"|"+I.y,x.x+"|"+x.y);if(i=this.IDATA.edgematch[S][2],(r=this.IDATA.edgematch[S][3])&&"A"===r)for(P=1;P<f;P++)x.x=P*e,x.y=P*t,b.x=l-(f-P)*(e+t),b.y=d+(f-P)*e,A(S,i,_=x.x+"|"+x.y,b.x+"|"+b.y);for(P=0;P<this.vertices.length;P++)_=this.vertices[P].x+"|"+this.vertices[P].y,(p=S+"|"+_)in u||(u[p]=c++,B[_][0]>2?D[u[p]]=[-B[_][0],B[_][1],u[p]]:D[u[p]]=[M[B[_][0]],B[_][1],u[p]])}this.closestTo=D,this.vecToidx=u},e.prototype.calcCoeffs=function(){var e=this.m,t=this.n,i=Math.sqrt(3)/3,r=e*e+t*t+e*t;this.coau=(e+t)/r,this.cobu=-t/r,this.coav=-i*(e-t)/r,this.cobv=i*(2*e+t)/r},e.prototype.createInnerFacets=function(){for(var e=this.m,t=this.n,i=0;i<t+e+1;i++)for(var r=this.min[i];r<this.max[i]+1;r++)r<this.max[i]&&r<this.max[i+1]+1&&this.innerFacets.push(["|"+r+"|"+i,"|"+r+"|"+(i+1),"|"+(r+1)+"|"+i]),i>0&&r<this.max[i-1]&&r+1<this.max[i]+1&&this.innerFacets.push(["|"+r+"|"+i,"|"+(r+1)+"|"+i,"|"+(r+1)+"|"+(i-1)])},e.prototype.edgeVecsABOB=function(){for(var e=this.m,t=this.n,i=new o.a(-t,e+t),r=1;r<e+t;r++){var n=new o.a(this.min[r],r),s=new o.a(this.min[r-1],r-1),a=new o.a(this.min[r+1],r+1),h=n.clone(),c=s.clone(),u=a.clone();h.rotate60About(i),c.rotate60About(i),u.rotate60About(i);var l=new o.a(this.max[h.y],h.y),d=new o.a(this.max[h.y-1],h.y-1),f=new o.a(this.max[h.y-1]-1,h.y-1);h.x===l.x&&h.y===l.y||(h.x!==d.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([n,d,f]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([n,f,l])):h.y===u.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([n,s,d]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([n,d,a])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([n,s,d]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([n,d,l])))}},e.prototype.mapABOBtoOBOA=function(){for(var e=new o.a(0,0),t=0;t<this.isoVecsABOB.length;t++){for(var i=[],r=0;r<3;r++)e.x=this.isoVecsABOB[t][r].x,e.y=this.isoVecsABOB[t][r].y,0===this.vertexTypes[t][r]&&e.rotateNeg120(this.m,this.n),i.push(e.clone());this.isoVecsOBOA.push(i)}},e.prototype.mapABOBtoBAOA=function(){for(var e=new o.a(0,0),t=0;t<this.isoVecsABOB.length;t++){for(var i=[],r=0;r<3;r++)e.x=this.isoVecsABOB[t][r].x,e.y=this.isoVecsABOB[t][r].y,1===this.vertexTypes[t][r]&&e.rotate120(this.m,this.n),i.push(e.clone());this.isoVecsBAOA.push(i)}},e.prototype.MapToFace=function(e,t){for(var i,r=this.IDATA.face[e],s=r[2],a=r[1],o=r[0],h=n.P.FromArray(this.IDATA.vertex[s]),c=n.P.FromArray(this.IDATA.vertex[a]),u=n.P.FromArray(this.IDATA.vertex[o]),l=c.subtract(h),d=u.subtract(h),f=l.scale(this.coau).add(d.scale(this.cobu)),p=l.scale(this.coav).add(d.scale(this.cobv)),g=[],_=n.jp.Vector3[0],v=0;v<this.cartesian.length;v++)_=f.scale(this.cartesian[v].x).add(p.scale(this.cartesian[v].y)).add(h),g[v]=[_.x,_.y,_.z],i=e+"|"+this.vertices[v].x+"|"+this.vertices[v].y,t.vertex[this.vecToidx[i]]=[_.x,_.y,_.z]},e.prototype.build=function(e,t){var i=new Array,r=o.a.Zero(),n=new o.a(e,t),a=new o.a(-t,e+t);i.push(r,n,a);for(var h=t;h<e+1;h++)for(var c=0;c<e+1-h;c++)i.push(new o.a(c,h));if(t>0){for(var u=s.R.HCF(e,t),l=e/u,d=t/u,f=1;f<u;f++)i.push(new o.a(f*l,f*d)),i.push(new o.a(-f*d,f*(l+d))),i.push(new o.a(e-f*(l+d),t+f*l));for(var p=e/t,g=1;g<t;g++)for(var _=0;_<g*p;_++)i.push(new o.a(_,g)),i.push(new o.a(_,g).rotate120(e,t)),i.push(new o.a(_,g).rotateNeg120(e,t))}i.sort((function(e,t){return e.x-t.x})),i.sort((function(e,t){return e.y-t.y}));var v=new Array(e+t+1),m=new Array(e+t+1);for(f=0;f<v.length;f++)v[f]=1/0,m[f]=-1/0;var y=0,x=0,b=i.length;for(f=0;f<b;f++)x=i[f].x,v[y=i[f].y]=Math.min(x,v[y]),m[y]=Math.max(x,m[y]);var I=function(i,r){var n=i.clone();return"A"===r&&n.rotateNeg120(e,t),"B"===r&&n.rotate120(e,t),n.x<0?n.y:n.x+n.y},M=[],D=[],B=[],A=[],S={},P=[],V=-1,T=-1;for(f=0;f<b;f++)M[f]=i[f].toCartesianOrigin(new o.a(0,0),.5),D[f]=I(i[f],"O"),B[f]=I(i[f],"A"),A[f]=I(i[f],"B"),D[f]===B[f]&&B[f]===A[f]?(V=3,T=D[f]):D[f]===B[f]?(V=4,T=D[f]):B[f]===A[f]?(V=5,T=B[f]):A[f]===D[f]&&(V=6,T=D[f]),D[f]<B[f]&&D[f]<A[f]&&(V=2,T=D[f]),B[f]<D[f]&&B[f]<A[f]&&(V=1,T=B[f]),A[f]<B[f]&&A[f]<D[f]&&(V=0,T=A[f]),P.push([V,T,i[f].x,i[f].y]);P.sort((function(e,t){return e[2]-t[2]})),P.sort((function(e,t){return e[3]-t[3]})),P.sort((function(e,t){return e[1]-t[1]})),P.sort((function(e,t){return e[0]-t[0]}));for(var C=0;C<P.length;C++)S[P[C][2]+"|"+P[C][3]]=[P[C][0],P[C][1],C];return this.m=e,this.n=t,this.vertices=i,this.vertByDist=S,this.cartesian=M,this.min=v,this.max=m,this},e}(),c=function(e,t,i,r){this.name=e,this.category=t,this.vertex=i,this.face=r},u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),t.prototype.innerToData=function(e,t){for(var i=0;i<t.innerFacets.length;i++)this.face.push(t.innerFacets[i].map((function(i){return t.vecToidx[e+i]})))},t.prototype.mapABOBtoDATA=function(e,t){for(var i=t.IDATA.edgematch[e][0],r=0;r<t.isoVecsABOB.length;r++){for(var n=[],s=0;s<3;s++)0===t.vertexTypes[r][s]?n.push(e+"|"+t.isoVecsABOB[r][s].x+"|"+t.isoVecsABOB[r][s].y):n.push(i+"|"+t.isoVecsABOB[r][s].x+"|"+t.isoVecsABOB[r][s].y);this.face.push([t.vecToidx[n[0]],t.vecToidx[n[1]],t.vecToidx[n[2]]])}},t.prototype.mapOBOAtoDATA=function(e,t){for(var i=t.IDATA.edgematch[e][0],r=0;r<t.isoVecsOBOA.length;r++){for(var n=[],s=0;s<3;s++)1===t.vertexTypes[r][s]?n.push(e+"|"+t.isoVecsOBOA[r][s].x+"|"+t.isoVecsOBOA[r][s].y):n.push(i+"|"+t.isoVecsOBOA[r][s].x+"|"+t.isoVecsOBOA[r][s].y);this.face.push([t.vecToidx[n[0]],t.vecToidx[n[1]],t.vecToidx[n[2]]])}},t.prototype.mapBAOAtoDATA=function(e,t){for(var i=t.IDATA.edgematch[e][2],r=0;r<t.isoVecsBAOA.length;r++){for(var n=[],s=0;s<3;s++)1===t.vertexTypes[r][s]?n.push(e+"|"+t.isoVecsBAOA[r][s].x+"|"+t.isoVecsBAOA[r][s].y):n.push(i+"|"+t.isoVecsBAOA[r][s].x+"|"+t.isoVecsBAOA[r][s].y);this.face.push([t.vecToidx[n[0]],t.vecToidx[n[1]],t.vecToidx[n[2]]])}},t.prototype.orderData=function(e){for(var t=[],i=0;i<13;i++)t[i]=[];var r=e.closestTo;for(i=0;i<r.length;i++)r[i][0]>-1?r[i][1]>0&&t[r[i][0]].push([i,r[i][1]]):t[12].push([i,r[i][0]]);var n=[];for(i=0;i<12;i++)n[i]=i;var s=12;for(i=0;i<12;i++){t[i].sort((function(e,t){return e[1]-t[1]}));for(var a=0;a<t[i].length;a++)n[t[i][a][0]]=s++}for(a=0;a<t[12].length;a++)n[t[12][a][0]]=s++;for(i=0;i<this.vertex.length;i++)this.vertex[i].push(n[i]);this.vertex.sort((function(e,t){return e[3]-t[3]}));for(i=0;i<this.vertex.length;i++)this.vertex[i].pop();for(i=0;i<this.face.length;i++)for(a=0;a<this.face[i].length;a++)this.face[i][a]=n[this.face[i][a]];this.sharedNodes=t[12].length,this.poleNodes=this.vertex.length-this.sharedNodes},t.prototype.setOrder=function(e,t){var i=[],r=[],n=t.pop();r.push(n);var s=this.face[n].indexOf(e);s=(s+2)%3;var a=this.face[n][s];i.push(a);for(var o=0;t.length>0;)n=t[o],this.face[n].indexOf(a)>-1?(s=(this.face[n].indexOf(a)+1)%3,a=this.face[n][s],i.push(a),r.push(n),t.splice(o,1),o=0):o++;return this.adjacentFaces.push(i),r},t.prototype.toGoldbergPolyhedronData=function(){var e=this,t=new c("GeoDual","Goldberg",[],[]);t.name="GD dual";for(var i=this.vertex.length,r=new Array(i),n=0;n<i;n++)r[n]=[];for(var s=0;s<this.face.length;s++)for(var a=0;a<3;a++)r[this.face[s][a]].push(s);var o=0,h=0,u=0,l=[],d=[];this.adjacentFaces=[];for(var f=0;f<r.length;f++)t.face[f]=this.setOrder(f,r[f].concat([])),r[f].forEach((function(i){o=0,h=0,u=0,l=e.face[i];for(var r=0;r<3;r++)d=e.vertex[l[r]],o+=d[0],h+=d[1],u+=d[2];t.vertex[i]=[o/3,h/3,u/3]}));return t},t.BuildGeodesicData=function(e){var i=new t("Geodesic-m-n","Geodesic",[[0,a.Q_,-1],[-a.Q_,1,0],[-1,0,-a.Q_],[1,0,-a.Q_],[a.Q_,1,0],[0,a.Q_,1],[-1,0,a.Q_],[-a.Q_,-1,0],[0,-a.Q_,-1],[a.Q_,-1,0],[1,0,a.Q_],[0,-a.Q_,1]],[]);e.setIndices(),e.calcCoeffs(),e.createInnerFacets(),e.edgeVecsABOB(),e.mapABOBtoOBOA(),e.mapABOBtoBAOA();for(var r=0;r<e.IDATA.face.length;r++)e.MapToFace(r,i),i.innerToData(r,e),"B"===e.IDATA.edgematch[r][1]&&i.mapABOBtoDATA(r,e),"O"===e.IDATA.edgematch[r][1]&&i.mapOBOAtoDATA(r,e),"A"===e.IDATA.edgematch[r][3]&&i.mapBAOAtoDATA(r,e);i.orderData(e);return i.vertex=i.vertex.map((function(e){var t=e[0],i=e[1],r=e[2],n=Math.sqrt(t*t+i*i+r*r);return e[0]*=1/n,e[1]*=1/n,e[2]*=1/n,e})),i},t}(c)},63946:(e,t,i)=>{i.d(t,{Z:()=>g});var r=i(58095),n=i(15631),s=i(89209),a=i(72208),o=i(68345),h=i(43824),c=i(91859),u=i(13514),l=i(20163),d=i(93701),f=i(15210),p=i(47884),g=function(){function e(e,t,i,r,n){void 0===r&&(r=!1),void 0===n&&(n=null),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=t||f.l.LastCreatedScene,this._scene&&(this.id=e,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=r,i?this.setAllVerticesData(i,r):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),n&&(this.applyToMesh(n),n.computeWorldMatrix(!0)))}return Object.defineProperty(e.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)},enumerable:!1,configurable:!0}),e.CreateGeometryForMesh=function(t){var i=new e(e.RandomId(),t.getScene());return i.applyToMesh(t),i},Object.defineProperty(e.prototype,"meshes",{get:function(){return this._meshes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extend",{get:function(){return this._extend},enumerable:!1,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._engine},e.prototype.isReady=function(){return 1===this.delayLoadState||0===this.delayLoadState},Object.defineProperty(e.prototype,"doNotSerialize",{get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0},enumerable:!1,configurable:!0}),e.prototype._rebuild=function(){for(var e in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),this._vertexBuffers){this._vertexBuffers[e]._rebuild()}},e.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this._notifyUpdate()},e.prototype.setVerticesData=function(e,t,i,r){void 0===i&&(i=!1),i&&Array.isArray(t)&&(t=new Float32Array(t));var n=new a.o(this._engine,t,e,i,0===this._meshes.length,r);this.setVerticesBuffer(n)},e.prototype.removeVerticesData=function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()},e.prototype.setVerticesBuffer=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!0);var r=e.getKind();this._vertexBuffers[r]&&i&&this._vertexBuffers[r].dispose(),e._buffer&&e._buffer._increaseReferences(),this._vertexBuffers[r]=e;var n=this._meshes,s=n.length;if(r===a.o.PositionKind){var o=e.getData();null!=t?this._totalVertices=t:null!=o&&(this._totalVertices=o.length/(e.type===a.o.BYTE?e.byteStride:e.byteStride/4)),this._updateExtend(o),this._resetPointsArrayCache();for(var h=0;h<s;h++){var c=n[h];c.buildBoundingInfo(this._extend.minimum,this._extend.maximum),c._createGlobalSubMesh(c.isUnIndexed),c.computeWorldMatrix(!0),c.synchronizeInstances()}}this._notifyUpdate(r)},e.prototype.updateVerticesDataDirectly=function(e,t,i,r){void 0===r&&(r=!1);var n=this.getVertexBuffer(e);n&&(n.updateDirectly(t,i,r),this._notifyUpdate(e))},e.prototype.updateVerticesData=function(e,t,i){void 0===i&&(i=!1);var r=this.getVertexBuffer(e);r&&(r.update(t),e===a.o.PositionKind&&this._updateBoundingInfo(i,t),this._notifyUpdate(e))},e.prototype._updateBoundingInfo=function(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e)for(var i=0,r=this._meshes;i<r.length;i++){var n=r[i];n.hasBoundingInfo?n.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):n.buildBoundingInfo(this._extend.minimum,this._extend.maximum);for(var s=0,a=n.subMeshes;s<a.length;s++){a[s].refreshBoundingInfo()}}},e.prototype._bind=function(e,t,i,r){if(e){void 0===t&&(t=this._indexBuffer);var n=this.getVertexBuffers();if(n)if(t==this._indexBuffer&&(this._vertexArrayObjects||r)){var s=r||this._vertexArrayObjects;s[e.key]||(s[e.key]=this._engine.recordVertexArrayObject(n,t,e,i)),this._engine.bindVertexArrayObject(s[e.key],t)}else this._engine.bindBuffers(n,t,e,i)}},e.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},e.prototype.getVerticesData=function(e,t,i){var r=this.getVertexBuffer(e);return r?r.getFloatData(this._totalVertices,i||t&&1!==this._meshes.length):null},e.prototype.isVertexBufferUpdatable=function(e){var t=this._vertexBuffers[e];return!!t&&t.isUpdatable()},e.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},e.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},e.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},e.prototype.getVerticesDataKinds=function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},e.prototype.updateIndices=function(e,t,i){if(void 0===i&&(i=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var r=e.length!==this._indices.length;if(i||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),r)for(var n=0,s=this._meshes;n<s.length;n++){s[n]._createGlobalSubMesh(!0)}}else this.setIndices(e,null,!0)},e.prototype.setIndices=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,this._indexBufferIsUpdatable=i,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i)),null!=t&&(this._totalVertices=t);for(var r=0,n=this._meshes;r<n.length;r++){var s=n[r];s._createGlobalSubMesh(!0),s.synchronizeInstances()}this._notifyUpdate()},e.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},e.prototype.getIndices=function(e,t){if(!this.isReady())return null;var i=this._indices;return t||e&&1!==this._meshes.length?i.slice():i},e.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},e.prototype._releaseVertexArrayObject=function(e){void 0===e&&(e=null),e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])},e.prototype.releaseForMesh=function(e,t){var i=this._meshes,r=i.indexOf(e);-1!==r&&(i.splice(r,1),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject(),e._geometry=null,0===i.length&&t&&this.dispose())},e.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject();var i=this._meshes;e._geometry=this,e._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):this._boundingInfo&&e.setBoundingInfo(this._boundingInfo)}},e.prototype._updateExtend=function(e){if(void 0===e&&(e=null),this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!e&&!(e=this.getVerticesData(a.o.PositionKind)))return;this._extend=(0,d.k)(e,0,this._totalVertices,this.boundingBias,3)}},e.prototype._applyToMesh=function(e){var t=this._meshes.length;for(var i in this._vertexBuffers)1===t&&this._vertexBuffers[i].create(),i===a.o.PositionKind&&(this._extend||this._updateExtend(),e.buildBoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(e.isUnIndexed),e._updateBoundingInfo());1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()},e.prototype._notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(var t=0,i=this._meshes;t<i.length;t++){i[t]._markSubMeshesAsAttributesDirty()}},e.prototype.load=function(e,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(e,t)))},e.prototype._queueLoad=function(e,t){var i=this;this.delayLoadingFile&&(e._addPendingData(this),e._loadFile(this.delayLoadingFile,(function(r){if(i._delayLoadingFunction){i._delayLoadingFunction(JSON.parse(r),i),i.delayLoadState=1,i._delayInfo=[],e._removePendingData(i);for(var n=i._meshes,s=n.length,a=0;a<s;a++)i._applyToMesh(n[a]);t&&t()}}),void 0,!0))},e.prototype.toLeftHanded=function(){var e=this.getIndices(!1);if(null!=e&&e.length>0){for(var t=0;t<e.length;t+=3){var i=e[t+0];e[t+0]=e[t+2],e[t+2]=i}this.setIndices(e)}var r=this.getVerticesData(a.o.PositionKind,!1);if(null!=r&&r.length>0){for(t=0;t<r.length;t+=3)r[t+2]=-r[t+2];this.setVerticesData(a.o.PositionKind,r,!1)}var n=this.getVerticesData(a.o.NormalKind,!1);if(null!=n&&n.length>0){for(t=0;t<n.length;t+=3)n[t+2]=-n[t+2];this.setVerticesData(a.o.NormalKind,n,!1)}},e.prototype._resetPointsArrayCache=function(){this._positions=null},e.prototype._generatePointsArray=function(){if(this._positions)return!0;var e=this.getVerticesData(a.o.PositionKind);if(!e||0===e.length)return!1;for(var t=3*this._positionsCache.length,i=this._positionsCache.length;t<e.length;t+=3,++i)this._positionsCache[i]=r.P.FromArray(e,t);for(t=0,i=0;t<e.length;t+=3,++i)this._positionsCache[i].set(e[0+t],e[1+t],e[2+t]);return this._positionsCache.length=e.length/3,this._positions=this._positionsCache,!0},e.prototype.isDisposed=function(){return this._isDisposed},e.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={};for(var t=this._meshes,i=t.length,r=0;r<i;r++)t[r]._invalidateInstanceVertexArrayObject()}},e.prototype.dispose=function(){var e,t=this._meshes,i=t.length;for(e=0;e<i;e++)this.releaseForMesh(t[e]);for(var r in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[r].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){var n=this._parentContainer.geometries.indexOf(this);n>-1&&this._parentContainer.geometries.splice(n,1),this._parentContainer=null}this._isDisposed=!0},e.prototype.copy=function(t){var i=new s.x;i.indices=[];var r=this.getIndices();if(r)for(var n=0;n<r.length;n++)i.indices.push(r[n]);var a,o=!1,h=!1;for(a in this._vertexBuffers){var u=this.getVerticesData(a);if(u&&(u instanceof Float32Array?i.set(new Float32Array(u),a):i.set(u.slice(0),a),!h)){var l=this.getVertexBuffer(a);l&&(h=!(o=l.isUpdatable()))}}var d=new e(t,this._scene,i,o);for(a in d.delayLoadState=this.delayLoadState,d.delayLoadingFile=this.delayLoadingFile,d._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)d._delayInfo=d._delayInfo||[],d._delayInfo.push(a);return d._boundingInfo=new c.j(this._extend.minimum,this._extend.maximum),d},e.prototype.serialize=function(){var e={};return e.id=this.id,e.uniqueId=this.uniqueId,e.updatable=this._updatable,l.$&&l.$.HasTags(this)&&(e.tags=l.$.GetTags(this)),e},e.prototype._toNumberArray=function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)},e.prototype.clearCachedData=function(){for(var e in this._indices=[],this._resetPointsArrayCache(),this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,e)&&(this._vertexBuffers[e]._buffer._data=null)},e.prototype.serializeVerticeData=function(){var e=this.serialize();return this.isVerticesDataPresent(a.o.PositionKind)&&(e.positions=this._toNumberArray(this.getVerticesData(a.o.PositionKind)),this.isVertexBufferUpdatable(a.o.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(a.o.NormalKind)&&(e.normals=this._toNumberArray(this.getVerticesData(a.o.NormalKind)),this.isVertexBufferUpdatable(a.o.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(a.o.TangentKind)&&(e.tangents=this._toNumberArray(this.getVerticesData(a.o.TangentKind)),this.isVertexBufferUpdatable(a.o.TangentKind)&&(e.tangents._updatable=!0)),this.isVerticesDataPresent(a.o.UVKind)&&(e.uvs=this._toNumberArray(this.getVerticesData(a.o.UVKind)),this.isVertexBufferUpdatable(a.o.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(a.o.UV2Kind)&&(e.uv2s=this._toNumberArray(this.getVerticesData(a.o.UV2Kind)),this.isVertexBufferUpdatable(a.o.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(a.o.UV3Kind)&&(e.uv3s=this._toNumberArray(this.getVerticesData(a.o.UV3Kind)),this.isVertexBufferUpdatable(a.o.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(a.o.UV4Kind)&&(e.uv4s=this._toNumberArray(this.getVerticesData(a.o.UV4Kind)),this.isVertexBufferUpdatable(a.o.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(a.o.UV5Kind)&&(e.uv5s=this._toNumberArray(this.getVerticesData(a.o.UV5Kind)),this.isVertexBufferUpdatable(a.o.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(a.o.UV6Kind)&&(e.uv6s=this._toNumberArray(this.getVerticesData(a.o.UV6Kind)),this.isVertexBufferUpdatable(a.o.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(a.o.ColorKind)&&(e.colors=this._toNumberArray(this.getVerticesData(a.o.ColorKind)),this.isVertexBufferUpdatable(a.o.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(a.o.MatricesIndicesKind)&&(e.matricesIndices=this._toNumberArray(this.getVerticesData(a.o.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(a.o.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(a.o.MatricesWeightsKind)&&(e.matricesWeights=this._toNumberArray(this.getVerticesData(a.o.MatricesWeightsKind)),this.isVertexBufferUpdatable(a.o.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this._toNumberArray(this.getIndices()),e},e.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},e.RandomId=function(){return u.w1.RandomId()},e._GetGeometryByLoadedUniqueId=function(e,t){for(var i=0;i<t.geometries.length;i++)if(t.geometries[i]._loadedUniqueId===e)return t.geometries[i];return null},e._ImportGeometry=function(t,i){var r=i.getScene(),s=t.geometryUniqueId,h=t.geometryId;if(s||h){var c=s?this._GetGeometryByLoadedUniqueId(s,r):r.getGeometryById(h);c&&c.applyToMesh(i)}else if(t instanceof ArrayBuffer){var u=i._binaryInfo;if(u.positionsAttrDesc&&u.positionsAttrDesc.count>0){var l=new Float32Array(t,u.positionsAttrDesc.offset,u.positionsAttrDesc.count);i.setVerticesData(a.o.PositionKind,l,!1)}if(u.normalsAttrDesc&&u.normalsAttrDesc.count>0){var d=new Float32Array(t,u.normalsAttrDesc.offset,u.normalsAttrDesc.count);i.setVerticesData(a.o.NormalKind,d,!1)}if(u.tangetsAttrDesc&&u.tangetsAttrDesc.count>0){var f=new Float32Array(t,u.tangetsAttrDesc.offset,u.tangetsAttrDesc.count);i.setVerticesData(a.o.TangentKind,f,!1)}if(u.uvsAttrDesc&&u.uvsAttrDesc.count>0){var g=new Float32Array(t,u.uvsAttrDesc.offset,u.uvsAttrDesc.count);if(p.e.UseOpenGLOrientationForUV)for(var _=1;_<g.length;_+=2)g[_]=1-g[_];i.setVerticesData(a.o.UVKind,g,!1)}if(u.uvs2AttrDesc&&u.uvs2AttrDesc.count>0){var v=new Float32Array(t,u.uvs2AttrDesc.offset,u.uvs2AttrDesc.count);if(p.e.UseOpenGLOrientationForUV)for(_=1;_<v.length;_+=2)v[_]=1-v[_];i.setVerticesData(a.o.UV2Kind,v,!1)}if(u.uvs3AttrDesc&&u.uvs3AttrDesc.count>0){var m=new Float32Array(t,u.uvs3AttrDesc.offset,u.uvs3AttrDesc.count);if(p.e.UseOpenGLOrientationForUV)for(_=1;_<m.length;_+=2)m[_]=1-m[_];i.setVerticesData(a.o.UV3Kind,m,!1)}if(u.uvs4AttrDesc&&u.uvs4AttrDesc.count>0){var y=new Float32Array(t,u.uvs4AttrDesc.offset,u.uvs4AttrDesc.count);if(p.e.UseOpenGLOrientationForUV)for(_=1;_<y.length;_+=2)y[_]=1-y[_];i.setVerticesData(a.o.UV4Kind,y,!1)}if(u.uvs5AttrDesc&&u.uvs5AttrDesc.count>0){var x=new Float32Array(t,u.uvs5AttrDesc.offset,u.uvs5AttrDesc.count);if(p.e.UseOpenGLOrientationForUV)for(_=1;_<x.length;_+=2)x[_]=1-x[_];i.setVerticesData(a.o.UV5Kind,x,!1)}if(u.uvs6AttrDesc&&u.uvs6AttrDesc.count>0){var b=new Float32Array(t,u.uvs6AttrDesc.offset,u.uvs6AttrDesc.count);if(p.e.UseOpenGLOrientationForUV)for(_=1;_<b.length;_+=2)b[_]=1-b[_];i.setVerticesData(a.o.UV6Kind,b,!1)}if(u.colorsAttrDesc&&u.colorsAttrDesc.count>0){var I=new Float32Array(t,u.colorsAttrDesc.offset,u.colorsAttrDesc.count);i.setVerticesData(a.o.ColorKind,I,!1,u.colorsAttrDesc.stride)}if(u.matricesIndicesAttrDesc&&u.matricesIndicesAttrDesc.count>0){for(var M=new Int32Array(t,u.matricesIndicesAttrDesc.offset,u.matricesIndicesAttrDesc.count),D=[],B=0;B<M.length;B++){_=M[B];D.push(255&_),D.push((65280&_)>>8),D.push((16711680&_)>>16),D.push(_>>24&255)}i.setVerticesData(a.o.MatricesIndicesKind,D,!1)}if(u.matricesIndicesExtraAttrDesc&&u.matricesIndicesExtraAttrDesc.count>0){for(M=new Int32Array(t,u.matricesIndicesExtraAttrDesc.offset,u.matricesIndicesExtraAttrDesc.count),D=[],B=0;B<M.length;B++){_=M[B];D.push(255&_),D.push((65280&_)>>8),D.push((16711680&_)>>16),D.push(_>>24&255)}i.setVerticesData(a.o.MatricesIndicesExtraKind,D,!1)}if(u.matricesWeightsAttrDesc&&u.matricesWeightsAttrDesc.count>0){var A=new Float32Array(t,u.matricesWeightsAttrDesc.offset,u.matricesWeightsAttrDesc.count);i.setVerticesData(a.o.MatricesWeightsKind,A,!1)}if(u.indicesAttrDesc&&u.indicesAttrDesc.count>0){var S=new Int32Array(t,u.indicesAttrDesc.offset,u.indicesAttrDesc.count);i.setIndices(S,null)}if(u.subMeshesAttrDesc&&u.subMeshesAttrDesc.count>0){var P=new Int32Array(t,u.subMeshesAttrDesc.offset,5*u.subMeshesAttrDesc.count);i.subMeshes=[];for(B=0;B<u.subMeshesAttrDesc.count;B++){var V=P[5*B+0],T=P[5*B+1],C=P[5*B+2],O=P[5*B+3],w=P[5*B+4];o.P.AddToMesh(V,T,C,O,w,i)}}}else if(t.positions&&t.normals&&t.indices){if(i.setVerticesData(a.o.PositionKind,t.positions,t.positions._updatable),i.setVerticesData(a.o.NormalKind,t.normals,t.normals._updatable),t.tangents&&i.setVerticesData(a.o.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&i.setVerticesData(a.o.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&i.setVerticesData(a.o.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&i.setVerticesData(a.o.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&i.setVerticesData(a.o.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&i.setVerticesData(a.o.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&i.setVerticesData(a.o.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&i.setVerticesData(a.o.ColorKind,n.HE.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,i.setVerticesData(a.o.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{for(D=[],B=0;B<t.matricesIndices.length;B++){var F=t.matricesIndices[B];D.push(255&F),D.push((65280&F)>>8),D.push((16711680&F)>>16),D.push(F>>24&255)}i.setVerticesData(a.o.MatricesIndicesKind,D,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,i.setVerticesData(a.o.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{for(D=[],B=0;B<t.matricesIndicesExtra.length;B++){F=t.matricesIndicesExtra[B];D.push(255&F),D.push((65280&F)>>8),D.push((16711680&F)>>16),D.push(F>>24&255)}i.setVerticesData(a.o.MatricesIndicesExtraKind,D,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(e._CleanMatricesWeights(t,i),i.setVerticesData(a.o.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&i.setVerticesData(a.o.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),i.setIndices(t.indices,null)}if(t.subMeshes){i.subMeshes=[];for(var R=0;R<t.subMeshes.length;R++){var K=t.subMeshes[R];o.P.AddToMesh(K.materialIndex,K.verticesStart,K.verticesCount,K.indexStart,K.indexCount,i)}}i._shouldGenerateFlatShading&&(i.convertToFlatShadedMesh(),i._shouldGenerateFlatShading=!1),i.computeWorldMatrix(!0),r.onMeshImportedObservable.notifyObservers(i)},e._CleanMatricesWeights=function(e,t){var i=.001;if(h.Z.CleanBoneMatrixWeights){var r=0;if(e.skeletonId>-1){var n=t.getScene().getLastSkeletonById(e.skeletonId);if(n){r=n.bones.length;for(var s=t.getVerticesData(a.o.MatricesIndicesKind),o=t.getVerticesData(a.o.MatricesIndicesExtraKind),c=e.matricesWeights,u=e.matricesWeightsExtra,l=e.numBoneInfluencer,d=c.length,f=0;f<d;f+=4){for(var p=0,g=-1,_=0;_<4;_++){p+=v=c[f+_],v<i&&g<0&&(g=_)}if(u)for(_=0;_<4;_++){var v;p+=v=u[f+_],v<i&&g<0&&(g=_+4)}if((g<0||g>l-1)&&(g=l-1),p>i){var m=1/p;for(_=0;_<4;_++)c[f+_]*=m;if(u)for(_=0;_<4;_++)u[f+_]*=m}else g>=4?(u[f+g-4]=1-p,o[f+g-4]=r):(c[f+g]=1-p,s[f+g]=r)}t.setVerticesData(a.o.MatricesIndicesKind,s),e.matricesWeightsExtra&&t.setVerticesData(a.o.MatricesIndicesExtraKind,o)}}}},e.Parse=function(t,i,n){var o=new e(t.id,i,void 0,t.updatable);return o._loadedUniqueId=t.uniqueId,l.$&&l.$.AddTagsTo(o,t.tags),t.delayLoadingFile?(o.delayLoadState=4,o.delayLoadingFile=n+t.delayLoadingFile,o._boundingInfo=new c.j(r.P.FromArray(t.boundingBoxMinimum),r.P.FromArray(t.boundingBoxMaximum)),o._delayInfo=[],t.hasUVs&&o._delayInfo.push(a.o.UVKind),t.hasUVs2&&o._delayInfo.push(a.o.UV2Kind),t.hasUVs3&&o._delayInfo.push(a.o.UV3Kind),t.hasUVs4&&o._delayInfo.push(a.o.UV4Kind),t.hasUVs5&&o._delayInfo.push(a.o.UV5Kind),t.hasUVs6&&o._delayInfo.push(a.o.UV6Kind),t.hasColors&&o._delayInfo.push(a.o.ColorKind),t.hasMatricesIndices&&o._delayInfo.push(a.o.MatricesIndicesKind),t.hasMatricesWeights&&o._delayInfo.push(a.o.MatricesWeightsKind),o._delayLoadingFunction=s.x.ImportVertexData):s.x.ImportVertexData(t,o),i.pushGeometry(o,!0),o},e}()},41234:(e,t,i)=>{i.d(t,{R:()=>c});var r=i(31191),n=i(58095),s=i(72208),a=i(91243),o=i(15631),h=i(84318);a.Kj._GoldbergMeshParser=function(e,t){return c.Parse(e,t)};var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]},t}return(0,r.ZT)(t,e),t.prototype.relatedGoldbergFace=function(e,t){return void 0===t?(e>this.goldbergData.nbUnsharedFaces-1&&(h.Y.Warn("Maximum number of unshared faces used"),e=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+e):(e>11&&(h.Y.Warn("Last pole used"),e=11),t>this.goldbergData.nbFacesAtPole-1&&(h.Y.Warn("Maximum number of faces at a pole used"),t=this.goldbergData.nbFacesAtPole-1),12+e*this.goldbergData.nbFacesAtPole+t)},t.prototype._changeGoldbergFaceColors=function(e){for(var t=0;t<e.length;t++)for(var i=e[t][0],r=e[t][1],n=e[t][2],s=i;s<r+1;s++)this.goldbergData.faceColors[s]=n;var a=[];for(s=0;s<12;s++)for(t=0;t<5;t++)a.push(this.goldbergData.faceColors[s].r,this.goldbergData.faceColors[s].g,this.goldbergData.faceColors[s].b,this.goldbergData.faceColors[s].a);for(s=12;s<this.goldbergData.faceColors.length;s++)for(t=0;t<6;t++)a.push(this.goldbergData.faceColors[s].r,this.goldbergData.faceColors[s].g,this.goldbergData.faceColors[s].b,this.goldbergData.faceColors[s].a);return a},t.prototype.setGoldbergFaceColors=function(e){var t=this._changeGoldbergFaceColors(e);this.setVerticesData(s.o.ColorKind,t)},t.prototype.updateGoldbergFaceColors=function(e){var t=this._changeGoldbergFaceColors(e);this.updateVerticesData(s.o.ColorKind,t)},t.prototype._changeGoldbergFaceUVs=function(e){for(var t=this.getVerticesData(s.o.UVKind),i=0;i<e.length;i++){for(var r=e[i][0],n=e[i][1],a=e[i][2],o=e[i][3],h=e[i][4],c=[],u=[],l=void 0,d=void 0,f=0;f<5;f++)l=a.x+o*Math.cos(h+f*Math.PI/2.5),d=a.y+o*Math.sin(h+f*Math.PI/2.5),l<0&&(l=0),l>1&&(l=1),c.push(l,d);for(f=0;f<6;f++)l=a.x+o*Math.cos(h+f*Math.PI/3),d=a.y+o*Math.sin(h+f*Math.PI/3),l<0&&(l=0),l>1&&(l=1),u.push(l,d);for(var p=r;p<Math.min(12,n+1);p++)for(f=0;f<5;f++)t[10*p+2*f]=c[2*f],t[10*p+2*f+1]=c[2*f+1];for(p=Math.max(12,r);p<n+1;p++)for(f=0;f<6;f++)t[12*p-24+2*f]=u[2*f],t[12*p-23+2*f]=u[2*f+1]}return t},t.prototype.setGoldbergFaceUVs=function(e){var t=this._changeGoldbergFaceUVs(e);this.setVerticesData(s.o.UVKind,t)},t.prototype.updateGoldbergFaceUVs=function(e){var t=this._changeGoldbergFaceUVs(e);this.updateVerticesData(s.o.UVKind,t)},t.prototype.placeOnGoldbergFaceAt=function(e,t,i){var r=n.P.RotationFromAxis(this.goldbergData.faceXaxis[t],this.goldbergData.faceYaxis[t],this.goldbergData.faceZaxis[t]);e.rotation=r,e.position=this.goldbergData.faceCenters[t].add(this.goldbergData.faceXaxis[t].scale(i.x)).add(this.goldbergData.faceYaxis[t].scale(i.y)).add(this.goldbergData.faceZaxis[t].scale(i.z))},t.prototype.serialize=function(t){e.prototype.serialize.call(this,t),t.type="GoldbergMesh";var i={};if(i.adjacentFaces=this.goldbergData.adjacentFaces,i.nbSharedFaces=this.goldbergData.nbSharedFaces,i.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,i.nbFaces=this.goldbergData.nbFaces,i.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){i.faceColors=[];for(var r=0,n=this.goldbergData.faceColors;r<n.length;r++){var s=n[r];i.faceColors.push(s.asArray())}}if(this.goldbergData.faceCenters){i.faceCenters=[];for(var a=0,o=this.goldbergData.faceCenters;a<o.length;a++){var h=o[a];i.faceCenters.push(h.asArray())}}if(this.goldbergData.faceZaxis){i.faceZaxis=[];for(var c=0,u=this.goldbergData.faceZaxis;c<u.length;c++){h=u[c];i.faceZaxis.push(h.asArray())}}if(this.goldbergData.faceYaxis){i.faceYaxis=[];for(var l=0,d=this.goldbergData.faceYaxis;l<d.length;l++){h=d[l];i.faceYaxis.push(h.asArray())}}if(this.goldbergData.faceXaxis){i.faceXaxis=[];for(var f=0,p=this.goldbergData.faceXaxis;f<p.length;f++){h=p[f];i.faceXaxis.push(h.asArray())}}t.goldbergData=i},t.Parse=function(e,i){var r=e.goldbergData;r.faceColors=r.faceColors.map((function(e){return o.HE.FromArray(e)})),r.faceCenters=r.faceCenters.map((function(e){return n.P.FromArray(e)})),r.faceZaxis=r.faceZaxis.map((function(e){return n.P.FromArray(e)})),r.faceXaxis=r.faceXaxis.map((function(e){return n.P.FromArray(e)})),r.faceYaxis=r.faceYaxis.map((function(e){return n.P.FromArray(e)}));var s=new t(e.name,i);return s.goldbergData=r,s},t}(a.Kj)},66378:(e,t,i)=>{i.d(t,{E:()=>o});var r=i(31191),n=i(58095),s=i(72208),a=i(91243);a.Kj._GroundMeshParser=function(e,t){return o.Parse(e,t)};var o=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.generateOctree=!1,r}return(0,r.ZT)(t,e),t.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(t.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!1,configurable:!0}),t.prototype.optimize=function(e,t){void 0===t&&(t=32),this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(t)},t.prototype.getHeightAtCoordinates=function(e,t){var i=this.getWorldMatrix(),r=n.jp.Matrix[5];i.invertToRef(r);var s=n.jp.Vector3[8];if(n.P.TransformCoordinatesFromFloatsToRef(e,0,t,r,s),e=s.x,t=s.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var a=this._getFacetAt(e,t),o=-(a.x*e+a.z*t+a.w)/a.y;return n.P.TransformCoordinatesFromFloatsToRef(0,o,0,i,s),s.y},t.prototype.getNormalAtCoordinates=function(e,t){var i=new n.P(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,i),i},t.prototype.getNormalAtCoordinatesToRef=function(e,t,i){var r=this.getWorldMatrix(),s=n.jp.Matrix[5];r.invertToRef(s);var a=n.jp.Vector3[8];if(n.P.TransformCoordinatesFromFloatsToRef(e,0,t,s,a),e=a.x,t=a.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var o=this._getFacetAt(e,t);return n.P.TransformNormalFromFloatsToRef(o.x,o.y,o.z,r,i),this},t.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},t.prototype._getFacetAt=function(e,t){var i=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),r=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),n=this._heightQuads[r*this._subdivisionsX+i];return t<n.slope.x*e+n.slope.y?n.facet1:n.facet2},t.prototype._initHeightQuads=function(){var e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(var i=0;i<t;i++)for(var r=0;r<e;r++){var s={slope:n.FM.Zero(),facet1:new n.Lt(0,0,0,0),facet2:new n.Lt(0,0,0,0)};this._heightQuads[i*e+r]=s}return this},t.prototype._computeHeightQuads=function(){var e=this.getVerticesData(s.o.PositionKind);if(!e)return this;for(var t=n.jp.Vector3[3],i=n.jp.Vector3[2],r=n.jp.Vector3[1],a=n.jp.Vector3[0],o=n.jp.Vector3[4],h=n.jp.Vector3[5],c=n.jp.Vector3[6],u=n.jp.Vector3[7],l=n.jp.Vector3[8],d=0,f=0,p=0,g=0,_=0,v=0,m=0,y=this._subdivisionsX,x=this._subdivisionsY,b=0;b<x;b++)for(var I=0;I<y;I++){d=3*I,f=b*(y+1)*3,p=(b+1)*(y+1)*3,t.x=e[f+d],t.y=e[f+d+1],t.z=e[f+d+2],i.x=e[f+d+3],i.y=e[f+d+4],i.z=e[f+d+5],r.x=e[p+d],r.y=e[p+d+1],r.z=e[p+d+2],a.x=e[p+d+3],a.y=e[p+d+4],a.z=e[p+d+5],g=(a.z-t.z)/(a.x-t.x),_=t.z-g*t.x,i.subtractToRef(t,o),r.subtractToRef(t,h),a.subtractToRef(t,c),n.P.CrossToRef(c,h,u),n.P.CrossToRef(o,c,l),u.normalize(),l.normalize(),v=-(u.x*t.x+u.y*t.y+u.z*t.z),m=-(l.x*i.x+l.y*i.y+l.z*i.z);var M=this._heightQuads[b*y+I];M.slope.copyFromFloats(g,_),M.facet1.copyFromFloats(u.x,u.y,u.z,v),M.facet2.copyFromFloats(l.x,l.y,l.z,m)}return this},t.prototype.serialize=function(t){e.prototype.serialize.call(this,t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t.minZ=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height},t.Parse=function(e,i){var r=new t(e.name,i);return r._subdivisionsX=e.subdivisionsX||1,r._subdivisionsY=e.subdivisionsY||1,r._minX=e.minX,r._maxX=e.maxX,r._minZ=e.minZ,r._maxZ=e.maxZ,r._width=e.width,r._height=e.height,r},t}(a.Kj)},73043:(e,t,i)=>{i.d(t,{x2:()=>n.x,kg:()=>ue.kg,yU:()=>_,KY:()=>ue.KY,NR:()=>ue.NR,aR:()=>ue.aR,iz:()=>ue.iz,VF:()=>ue.VF,wf:()=>ue.wf,zD:()=>ue.zD,Gz:()=>ue.Gz,BH:()=>ue.BH,tY:()=>ue.tY,uH:()=>ue.uH,MP:()=>ue.MP,_l:()=>ue._l,wl:()=>ue.wl,$6:()=>ue.$6,W:()=>ue.W,Qq:()=>ue.Qq,kt:()=>ue.kt,qL:()=>ue.qL,Au:()=>ue.Au,GQ:()=>ue.GQ,OV:()=>ue.OV,xW:()=>ue.xW,eW:()=>ue.eW,nL:()=>ue.nL,pT:()=>ue.pT,Hq:()=>ue.Hq,a4:()=>ue.a4,gl:()=>ue.gl,sh:()=>ue.sh,Qy:()=>ue.Qy,LY:()=>ue.LY,jM:()=>ue.jM,Qk:()=>ue.Qk,jY:()=>ue.jY,cQ:()=>ue.cQ,qS:()=>ue.qS,DG:()=>ue.DG,Es:()=>ue.Es,KA:()=>ue.KA,mm:()=>ue.mm,eu:()=>ue.eu,eB:()=>ue.eB,i9:()=>ue.i9,h5:()=>ue.h5,_u:()=>ue._u,H6:()=>ue.H6,l4:()=>ue.l4,tX:()=>ue.tX,Jl:()=>s.J,Yo:()=>ue.Yo,Gc:()=>ue.Gc,bC:()=>ue.bC,zz:()=>oe.zz,ZX:()=>v.Z,Rk:()=>y.R,vU:()=>ue.vU,EJ:()=>m.E,RO:()=>ue.RO,GM:()=>ue.GM,Ee:()=>D.E,SP:()=>M.S,aO:()=>ue.aO,RN:()=>ue.RN,_M:()=>D._,Kj:()=>c.Kj,VO:()=>Z,gV:()=>he.g,KQ:()=>s.K,mx:()=>ue.mx,mg:()=>ae.m,Pk:()=>ue.Pk,zk:()=>ae.z,ox:()=>ue.ox,lD:()=>oe.lD,oN:()=>ie,Ub:()=>ue.Ub,Oy:()=>ue.Oy,RT:()=>se,Z3:()=>X,R2:()=>H,lA:()=>r,A1:()=>ue.A1,P4:()=>h.P,Sc:()=>ue.Sc,P8:()=>ue.P8,t3:()=>ue.t3,SN:()=>ue.SN,ZO:()=>I,YO:()=>ce.Y,Fc:()=>ue.Fc,xx:()=>b.x,MF:()=>le.M,CF:()=>de.C,gW:()=>c.gW,Wv:()=>c.Wv,Bn:()=>oe.Bn});var r,n=i(71419),s=i(19488),a=i(58095),o=i(72208),h=i(68345),c=i(91243),u=i(15631),l=0,d=function(){function e(e,t,i,r){this.pos=e,this.normal=t,this.uv=i,this.vertColor=r}return e.prototype.clone=function(){var t,i;return new e(this.pos.clone(),this.normal.clone(),null===(t=this.uv)||void 0===t?void 0:t.clone(),null===(i=this.vertColor)||void 0===i?void 0:i.clone())},e.prototype.flip=function(){this.normal=this.normal.scale(-1)},e.prototype.interpolate=function(t,i){return new e(a.P.Lerp(this.pos,t.pos,i),a.P.Lerp(this.normal,t.normal,i),this.uv&&t.uv?a.FM.Lerp(this.uv,t.uv,i):void 0,this.vertColor&&t.vertColor?u.HE.Lerp(this.vertColor,t.vertColor,i):void 0)},e}(),f=function(){function e(e,t){this.normal=e,this.w=t}return e.FromPoints=function(t,i,r){var n=r.subtract(t),s=i.subtract(t);if(0===n.lengthSquared()||0===s.lengthSquared())return null;var o=a.P.Normalize(a.P.Cross(n,s));return new e(o,a.P.Dot(o,t))},e.prototype.clone=function(){return new e(this.normal.clone(),this.w)},e.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},e.prototype.splitPolygon=function(t,i,r,n,s){var o,h,c=0,u=[];for(o=0;o<t.vertices.length;o++){var l=(h=a.P.Dot(this.normal,t.vertices[o].pos)-this.w)<-e.EPSILON?2:h>e.EPSILON?1:0;c|=l,u.push(l)}switch(c){case 0:(a.P.Dot(this.normal,t.plane.normal)>0?i:r).push(t);break;case 1:n.push(t);break;case 2:s.push(t);break;case 3:var d=[],f=[];for(o=0;o<t.vertices.length;o++){var g=(o+1)%t.vertices.length,_=u[o],v=u[g],m=t.vertices[o],y=t.vertices[g];if(2!==_&&d.push(m),1!==_&&f.push(2!==_?m.clone():m),3==(_|v)){h=(this.w-a.P.Dot(this.normal,m.pos))/a.P.Dot(this.normal,y.pos.subtract(m.pos));var x=m.interpolate(y,h);d.push(x),f.push(x.clone())}}var b=void 0;d.length>=3&&(b=new p(d,t.shared)).plane&&n.push(b),f.length>=3&&(b=new p(f,t.shared)).plane&&s.push(b)}},e.EPSILON=1e-5,e}(),p=function(){function e(e,t){this.vertices=e,this.shared=t,this.plane=f.FromPoints(e[0].pos,e[1].pos,e[2].pos)}return e.prototype.clone=function(){return new e(this.vertices.map((function(e){return e.clone()})),this.shared)},e.prototype.flip=function(){this.vertices.reverse().map((function(e){e.flip()})),this.plane.flip()},e}(),g=function(){function e(e){this._plane=null,this._front=null,this._back=null,this._polygons=new Array,e&&this.build(e)}return e.prototype.clone=function(){var t=new e;return t._plane=this._plane&&this._plane.clone(),t._front=this._front&&this._front.clone(),t._back=this._back&&this._back.clone(),t._polygons=this._polygons.map((function(e){return e.clone()})),t},e.prototype.invert=function(){for(var e=0;e<this._polygons.length;e++)this._polygons[e].flip();this._plane&&this._plane.flip(),this._front&&this._front.invert(),this._back&&this._back.invert();var t=this._front;this._front=this._back,this._back=t},e.prototype.clipPolygons=function(e){if(!this._plane)return e.slice();for(var t=new Array,i=new Array,r=0;r<e.length;r++)this._plane.splitPolygon(e[r],t,i,t,i);return this._front&&(t=this._front.clipPolygons(t)),i=this._back?this._back.clipPolygons(i):[],t.concat(i)},e.prototype.clipTo=function(e){this._polygons=e.clipPolygons(this._polygons),this._front&&this._front.clipTo(e),this._back&&this._back.clipTo(e)},e.prototype.allPolygons=function(){var e=this._polygons.slice();return this._front&&(e=e.concat(this._front.allPolygons())),this._back&&(e=e.concat(this._back.allPolygons())),e},e.prototype.build=function(t){if(t.length){this._plane||(this._plane=t[0].plane.clone());for(var i=new Array,r=new Array,n=0;n<t.length;n++)this._plane.splitPolygon(t[n],this._polygons,this._polygons,i,r);i.length&&(this._front||(this._front=new e),this._front.build(i)),r.length&&(this._back||(this._back=new e),this._back.build(r))}},e}(),_=function(){function e(){this._polygons=new Array}return e.FromMesh=function(t,i){void 0===i&&(i=!1);var r,n,s,h,f,g,_,v,m,y=void 0,x=void 0,b=new Array,I=null,M=!1;if(!(t instanceof c.Kj))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";t.computeWorldMatrix(!0),g=t.getWorldMatrix(),_=t.position.clone(),v=t.rotation.clone(),t.rotationQuaternion&&(I=t.rotationQuaternion.clone()),m=t.scaling.clone(),t.material&&i&&(M=0===t.material.sideOrientation);for(var D=t.getIndices(),B=t.getVerticesData(o.o.PositionKind),A=t.getVerticesData(o.o.NormalKind),S=t.getVerticesData(o.o.UVKind),P=t.getVerticesData(o.o.ColorKind),V=t.subMeshes,T=0,C=V.length;T<C;T++)for(var O=V[T].indexStart,w=V[T].indexCount+V[T].indexStart;O<w;O+=3){f=[];for(var F=0;F<3;F++){var R=0===F?O+F:M?O+3-F:O+F,K=new a.P(A[3*D[R]],A[3*D[R]+1],A[3*D[R]+2]);S&&(y=new a.FM(S[2*D[R]],S[2*D[R]+1])),P&&(x=new u.HE(P[4*D[R]],P[4*D[R]+1],P[4*D[R]+2],P[4*D[R]+3]));var E=new a.P(B[3*D[R]],B[3*D[R]+1],B[3*D[R]+2]);s=a.P.TransformCoordinates(E,g),n=a.P.TransformNormal(K,g),r=new d(s,n,y,x),f.push(r)}(h=new p(f,{subMeshId:T,meshId:l,materialIndex:V[T].materialIndex})).plane&&b.push(h)}var L=e._FromPolygons(b);return L.matrix=i?a.y3.Identity():g,L.position=i?a.P.Zero():_,L.rotation=i?a.P.Zero():v,L.scaling=i?a.P.One():m,L.rotationQuaternion=i&&I?a._f.Identity():I,l++,L},e._FromPolygons=function(t){var i=new e;return i._polygons=t,i},e.prototype.clone=function(){var t=new e;return t._polygons=this._polygons.map((function(e){return e.clone()})),t.copyTransformAttributes(this),t},e.prototype.union=function(t){var i=new g(this.clone()._polygons),r=new g(t.clone()._polygons);return i.clipTo(r),r.clipTo(i),r.invert(),r.clipTo(i),r.invert(),i.build(r.allPolygons()),e._FromPolygons(i.allPolygons()).copyTransformAttributes(this)},e.prototype.unionInPlace=function(e){var t=new g(this._polygons),i=new g(e._polygons);t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),this._polygons=t.allPolygons()},e.prototype.subtract=function(t){var i=new g(this.clone()._polygons),r=new g(t.clone()._polygons);return i.invert(),i.clipTo(r),r.clipTo(i),r.invert(),r.clipTo(i),r.invert(),i.build(r.allPolygons()),i.invert(),e._FromPolygons(i.allPolygons()).copyTransformAttributes(this)},e.prototype.subtractInPlace=function(e){var t=new g(this._polygons),i=new g(e._polygons);t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),this._polygons=t.allPolygons()},e.prototype.intersect=function(t){var i=new g(this.clone()._polygons),r=new g(t.clone()._polygons);return i.invert(),r.clipTo(i),r.invert(),i.clipTo(r),r.clipTo(i),i.build(r.allPolygons()),i.invert(),e._FromPolygons(i.allPolygons()).copyTransformAttributes(this)},e.prototype.intersectInPlace=function(e){var t=new g(this._polygons),i=new g(e._polygons);t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),this._polygons=t.allPolygons()},e.prototype.inverse=function(){var e=this.clone();return e.inverseInPlace(),e},e.prototype.inverseInPlace=function(){this._polygons.map((function(e){e.flip()}))},e.prototype.copyTransformAttributes=function(e){return this.matrix=e.matrix,this.position=e.position,this.rotation=e.rotation,this.scaling=e.scaling,this.rotationQuaternion=e.rotationQuaternion,this},e.prototype.buildMeshGeometry=function(e,t,i){var r=this.matrix.clone();r.invert();var n,s,l,d=new c.Kj(e,t),f=[],p=[],g=[],_=null,v=null,m=a.P.Zero(),y=a.P.Zero(),x=a.FM.Zero(),b=new u.HE(0,0,0,0),I=this._polygons,M=[0,0,0],D={},B=0,A={};i&&I.sort((function(e,t){return e.shared.meshId===t.shared.meshId?e.shared.subMeshId-t.shared.subMeshId:e.shared.meshId-t.shared.meshId}));for(var S=0,P=I.length;S<P;S++){A[(n=I[S]).shared.meshId]||(A[n.shared.meshId]={}),A[n.shared.meshId][n.shared.subMeshId]||(A[n.shared.meshId][n.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:n.shared.materialIndex}),l=A[n.shared.meshId][n.shared.subMeshId];for(var V=2,T=n.vertices.length;V<T;V++){M[0]=0,M[1]=V-1,M[2]=V;for(var C=0;C<3;C++){m.copyFrom(n.vertices[M[C]].pos),y.copyFrom(n.vertices[M[C]].normal),n.vertices[M[C]].uv&&(_||(_=[]),x.copyFrom(n.vertices[M[C]].uv)),n.vertices[M[C]].vertColor&&(v||(v=[]),b.copyFrom(n.vertices[M[C]].vertColor));var O=a.P.TransformCoordinates(m,r),w=a.P.TransformNormal(y,r);s=D[O.x+","+O.y+","+O.z];var F=!1;_&&_[2*s]!==x.x&&_[2*s+1]!==x.y&&(F=!0);var R=!1;v&&v[4*s]!==b.r&&v[4*s+1]!==b.g&&v[4*s+2]!==b.b&&v[4*s+3]!==b.a&&(R=!0),(void 0===s||g[3*s]!==w.x||g[3*s+1]!==w.y||g[3*s+2]!==w.z||F||R)&&(f.push(O.x,O.y,O.z),_&&_.push(x.x,x.y),g.push(y.x,y.y,y.z),v&&v.push(b.r,b.g,b.b,b.a),s=D[O.x+","+O.y+","+O.z]=f.length/3-1),p.push(s),l.indexStart=Math.min(B,l.indexStart),l.indexEnd=Math.max(B,l.indexEnd),B++}}}if(d.setVerticesData(o.o.PositionKind,f),d.setVerticesData(o.o.NormalKind,g),_&&d.setVerticesData(o.o.UVKind,_),v&&d.setVerticesData(o.o.ColorKind,v),d.setIndices(p,null),i){var K=0,E=void 0;for(var L in d.subMeshes=new Array,A){for(var W in E=-1,A[L])l=A[L][W],h.P.CreateFromIndices(l.materialIndex+K,l.indexStart,l.indexEnd-l.indexStart+1,d),E=Math.max(l.materialIndex,E);K+=++E}}return d},e.prototype.toMesh=function(e,t,i,r){void 0===t&&(t=null);var n=this.buildMeshGeometry(e,i,r);return n.material=t,n.position.copyFrom(this.position),n.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(n.rotationQuaternion=this.rotationQuaternion.clone()),n.scaling.copyFrom(this.scaling),n.computeWorldMatrix(!0),n},e}(),v=i(63946),m=i(66378),y=i(41234),x=i(31191),b=i(89209),I=function(e){function t(t,i,r,n,s,o){void 0===n&&(n=1),void 0===s&&(s=60),void 0===o&&(o=!0);var h=e.call(this,t,r)||this;h._sectionPolygonPointsCount=4,h._running=!1,h._autoStart=o,h._generator=i,h._diameter=n,h._length=s,h._sectionVectors=[],h._sectionNormalVectors=[];for(var c=0;c<h._sectionPolygonPointsCount;c++)h._sectionVectors[c]=a.P.Zero(),h._sectionNormalVectors[c]=a.P.Zero();return h._createMesh(),h}return(0,x.ZT)(t,e),t.prototype.getClassName=function(){return"TrailMesh"},t.prototype._createMesh=function(){var e=new b.x,t=[],i=[],r=[],s=a.P.Zero();s=this._generator instanceof n.x&&this._generator.hasBoundingInfo?this._generator.getBoundingInfo().boundingBox.centerWorld:this._generator.position;for(var o=2*Math.PI/this._sectionPolygonPointsCount,h=0;h<this._sectionPolygonPointsCount;h++)t.push(s.x+Math.cos(h*o)*this._diameter,s.y+Math.sin(h*o)*this._diameter,s.z);for(h=1;h<=this._length;h++){for(var c=0;c<this._sectionPolygonPointsCount;c++)t.push(s.x+Math.cos(c*o)*this._diameter,s.y+Math.sin(c*o)*this._diameter,s.z);var u=t.length/3-2*this._sectionPolygonPointsCount;for(c=0;c<this._sectionPolygonPointsCount-1;c++)r.push(u+c,u+c+this._sectionPolygonPointsCount,u+c+this._sectionPolygonPointsCount+1),r.push(u+c,u+c+this._sectionPolygonPointsCount+1,u+c+1);r.push(u+this._sectionPolygonPointsCount-1,u+this._sectionPolygonPointsCount-1+this._sectionPolygonPointsCount,u+this._sectionPolygonPointsCount),r.push(u+this._sectionPolygonPointsCount-1,u+this._sectionPolygonPointsCount,u)}b.x.ComputeNormals(t,r,i),e.positions=t,e.normals=i,e.indices=r,e.applyToMesh(this,!0),this._autoStart&&this.start()},t.prototype.start=function(){var e=this;this._running||(this._running=!0,this._beforeRenderObserver=this.getScene().onBeforeRenderObservable.add((function(){e.update()})))},t.prototype.stop=function(){this._beforeRenderObserver&&this._running&&(this._running=!1,this.getScene().onBeforeRenderObservable.remove(this._beforeRenderObserver))},t.prototype.update=function(){var e=this.getVerticesData(o.o.PositionKind),t=this.getVerticesData(o.o.NormalKind),i=this._generator.getWorldMatrix();if(e&&t){for(var r=3*this._sectionPolygonPointsCount;r<e.length;r++)e[r-3*this._sectionPolygonPointsCount]=e[r]-t[r]/this._length*this._diameter;for(r=3*this._sectionPolygonPointsCount;r<t.length;r++)t[r-3*this._sectionPolygonPointsCount]=t[r];var n=e.length-3*this._sectionPolygonPointsCount,s=2*Math.PI/this._sectionPolygonPointsCount;for(r=0;r<this._sectionPolygonPointsCount;r++)this._sectionVectors[r].copyFromFloats(Math.cos(r*s)*this._diameter,Math.sin(r*s)*this._diameter,0),this._sectionNormalVectors[r].copyFromFloats(Math.cos(r*s),Math.sin(r*s),0),a.P.TransformCoordinatesToRef(this._sectionVectors[r],i,this._sectionVectors[r]),a.P.TransformNormalToRef(this._sectionNormalVectors[r],i,this._sectionNormalVectors[r]);for(r=0;r<this._sectionPolygonPointsCount;r++)e[n+3*r]=this._sectionVectors[r].x,e[n+3*r+1]=this._sectionVectors[r].y,e[n+3*r+2]=this._sectionVectors[r].z,t[n+3*r]=this._sectionNormalVectors[r].x,t[n+3*r+1]=this._sectionNormalVectors[r].y,t[n+3*r+2]=this._sectionNormalVectors[r].z;this.updateVerticesData(o.o.PositionKind,e,!0,!1),this.updateVerticesData(o.o.NormalKind,t,!0,!1)}},t.prototype.clone=function(e,i){return void 0===e&&(e=""),new t(e,void 0===i?this._generator:i,this.getScene(),this._diameter,this._length,this._autoStart)},t.prototype.serialize=function(t){e.prototype.serialize.call(this,t)},t.Parse=function(e,i){return new t(e.name,e._generator,i,e._diameter,e._length,e._autoStart)},t}(c.Kj),M=i(63003),D=i(37852),B=i(48236),A=i(42620),S=i(8451),P=i(10149),V=i(48087),T=i(62845),C=i(49353),O=i(93471),w=i(9866),F=i(52590),R=i(75159),K=i(89202),E=i(46719),L=i(89234),W=i(41525),U=i(42387),N=i(57891),j=i(75298),z=i(96907),k=i(6588),Q=i(76926),G=i(21784),Z={CreateBox:S.NR,CreateTiledBox:P.cQ,CreateSphere:V.Qk,CreateDisc:A.u,CreateIcoSphere:j.Au,CreateRibbon:B.LY,CreateCylinder:T.wf,CreateTorus:C.eu,CreateTorusKnot:O.eB,CreateLineSystem:w.xW,CreateLines:w.nL,CreateDashedLines:w.Gz,ExtrudeShape:R.Gc,ExtrudeShapeCustom:R.bC,CreateLathe:K.O,CreateTiledPlane:L.KA,CreatePlane:E.pT,CreateGround:W.$6,CreateTiledGround:W.DG,CreateGroundFromHeightMap:W.W,CreatePolygon:F.a4,ExtrudePolygon:F.Yo,CreateTube:U._,CreatePolyhedron:N.sh,CreateGeodesic:Q.M,CreateGoldberg:G._,CreateDecal:z.t,CreateCapsule:k.iz},Y=i(13514),q=i(48154),H=function(e,t,i){this.quality=e,this.distance=t,this.optimizeMesh=i},X=function(){function e(){this.running=!1,this._simplificationArray=[]}return e.prototype.addTask=function(e){this._simplificationArray.push(e)},e.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},e.prototype.runSimplification=function(e){var t=this;if(e.parallelProcessing)e.settings.forEach((function(i){t._getSimplifier(e).simplify(i,(function(r){void 0!==i.distance&&e.mesh.addLODLevel(i.distance,r),r.isVisible=!0,i.quality===e.settings[e.settings.length-1].quality&&e.successCallback&&e.successCallback(),t.executeNext()}))}));else{var i=this._getSimplifier(e);Y.$g.Run(e.settings.length,(function(t){var r,n;r=e.settings[t.index],n=function(){t.executeNext()},i.simplify(r,(function(t){void 0!==r.distance&&e.mesh.addLODLevel(r.distance,t),t.isVisible=!0,n()}))}),(function(){e.successCallback&&e.successCallback(),t.executeNext()}))}},e.prototype._getSimplifier=function(e){return e.simplificationType,r.QUADRATIC,new ie(e.mesh)},e}();!function(e){e[e.QUADRATIC=0]="QUADRATIC"}(r||(r={}));var $=function(e){this._vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0},J=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new ee,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}(),ee=function(){function e(e){this.data=new Array(10);for(var t=0;t<10;++t)e&&e[t]?this.data[t]=e[t]:this.data[t]=0}return e.prototype.det=function(e,t,i,r,n,s,a,o,h){return this.data[e]*this.data[n]*this.data[h]+this.data[i]*this.data[r]*this.data[o]+this.data[t]*this.data[s]*this.data[a]-this.data[i]*this.data[n]*this.data[a]-this.data[e]*this.data[s]*this.data[o]-this.data[t]*this.data[r]*this.data[h]},e.prototype.addInPlace=function(e){for(var t=0;t<10;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;t<10;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var i=new e,r=0;r<10;++r)i.data[r]=this.data[r]+t.data[r];return i},e.FromData=function(t,i,r,n){return new e(e.DataFromNumbers(t,i,r,n))},e.DataFromNumbers=function(e,t,i,r){return[e*e,e*t,e*i,e*r,t*t,t*i,t*r,i*i,i*r,r*r]},e}(),te=function(e,t){this.vertexId=e,this.triangleId=t},ie=function(){function e(e){this._mesh=e,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=q.kn}return e.prototype.simplify=function(e,t){var i=this;this._initDecimatedMesh(),Y.$g.Run(this._mesh.subMeshes.length,(function(t){i._initWithMesh(t.index,(function(){i._runDecimation(e,t.index,(function(){t.executeNext()}))}),e.optimizeMesh)}),(function(){setTimeout((function(){t(i._reconstructedMesh)}),0)}))},e.prototype._runDecimation=function(e,t,i){var r=this,n=~~(this._triangles.length*e.quality),s=0,o=this._triangles.length;Y.$g.Run(this.decimationIterations,(function(e){var t,i;o-s<=n?e.breakLoop():(t=e.index,i=function(){e.executeNext()},setTimeout((function(){t%5==0&&r._updateMesh(0===t);for(var e=0;e<r._triangles.length;++e)r._triangles[e].isDirty=!1;var h=1e-9*Math.pow(t+3,r.aggressiveness);Y.$g.SyncAsyncForLoop(r._triangles.length,r.syncIterations,(function(e){var t=~~((r._triangles.length/2+e)%r._triangles.length),i=r._triangles[t];if(i&&!(i.error[3]>h||i.deleted||i.isDirty))for(var n=function(e){if(i.error[e]<h){var t=[],n=[],o=i._vertices[e],c=i._vertices[(e+1)%3];if(o.isBorder||c.isBorder)return"continue";var u=a.P.Zero();r._calculateError(o,c,u);var l=new Array;if(r._isFlipped(o,c,u,t,l))return"continue";if(r._isFlipped(c,o,u,n,l))return"continue";if(t.indexOf(!0)<0||n.indexOf(!0)<0)return"continue";var d=new Array;if(l.forEach((function(e){-1===d.indexOf(e)&&(e.deletePending=!0,d.push(e))})),d.length%2!=0)return"continue";o.q=c.q.add(o.q),o.updatePosition(u);var f=r._references.length;s=r._updateTriangles(o,o,t,s),s=r._updateTriangles(o,c,n,s);var p=r._references.length-f;if(p<=o.triangleCount){if(p)for(var g=0;g<p;g++)r._references[o.triangleStart+g]=r._references[f+g]}else o.triangleStart=f;return o.triangleCount=p,"break"}},o=0;o<3&&"break"!==n(o);++o);}),i,(function(){return o-s<=n}))}),0))}),(function(){setTimeout((function(){r._reconstructMesh(t),i()}),0)}))},e.prototype._initWithMesh=function(e,t,i){var r=this;this._vertices=[],this._triangles=[];var n=this._mesh.getVerticesData(o.o.PositionKind),s=this._mesh.getIndices(),h=this._mesh.subMeshes[e],c=[],u=h.verticesCount;Y.$g.SyncAsyncForLoop(u,this.syncIterations/4>>0,(function(e){if(n){var t=e+h.verticesStart,s=a.P.FromArray(n,3*t),o=function(e){if(i)for(var t=0;t<r._vertices.length;++t)if(r._vertices[t].position.equalsWithEpsilon(e,1e-4))return r._vertices[t];return null}(s)||new J(s,r._vertices.length);o.originalOffsets.push(t),o.id===r._vertices.length&&r._vertices.push(o),c.push(o.id)}}),(function(){Y.$g.SyncAsyncForLoop(h.indexCount/3,r.syncIterations,(function(e){if(s){var t=3*(h.indexStart/3+e),i=s[t+0],n=s[t+1],a=s[t+2],o=r._vertices[c[i-h.verticesStart]],u=r._vertices[c[n-h.verticesStart]],l=r._vertices[c[a-h.verticesStart]],d=new $([o,u,l]);d.originalOffset=t,r._triangles.push(d)}}),(function(){r._init(t)}))}))},e.prototype._init=function(e){var t=this;Y.$g.SyncAsyncForLoop(this._triangles.length,this.syncIterations,(function(e){var i=t._triangles[e];i.normal=a.P.Cross(i._vertices[1].position.subtract(i._vertices[0].position),i._vertices[2].position.subtract(i._vertices[0].position)).normalize();for(var r=0;r<3;r++)i._vertices[r].q.addArrayInPlace(ee.DataFromNumbers(i.normal.x,i.normal.y,i.normal.z,-a.P.Dot(i.normal,i._vertices[0].position)))}),(function(){Y.$g.SyncAsyncForLoop(t._triangles.length,t.syncIterations,(function(e){for(var i=t._triangles[e],r=0;r<3;++r)i.error[r]=t._calculateError(i._vertices[r],i._vertices[(r+1)%3]);i.error[3]=Math.min(i.error[0],i.error[1],i.error[2])}),(function(){e()}))}))},e.prototype._reconstructMesh=function(e){var t,i,r,n=[];for(t=0;t<this._vertices.length;++t)this._vertices[t].triangleCount=0;for(t=0;t<this._triangles.length;++t)if(!this._triangles[t].deleted){for(i=this._triangles[t],r=0;r<3;++r)i._vertices[r].triangleCount=1;n.push(i)}var s=this._reconstructedMesh.getVerticesData(o.o.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(o.o.NormalKind)||[],c=this._reconstructedMesh.getVerticesData(o.o.UVKind)||[],u=this._reconstructedMesh.getVerticesData(o.o.ColorKind)||[],l=this._mesh.getVerticesData(o.o.NormalKind),d=this._mesh.getVerticesData(o.o.UVKind),f=this._mesh.getVerticesData(o.o.ColorKind),p=0,g=function(){var e=_._vertices[t];e.id=p,e.triangleCount&&e.originalOffsets.forEach((function(t){s.push(e.position.x),s.push(e.position.y),s.push(e.position.z),l&&l.length&&(a.push(l[3*t]),a.push(l[3*t+1]),a.push(l[3*t+2])),d&&d.length&&(c.push(d[2*t]),c.push(d[2*t+1])),f&&f.length&&(u.push(f[4*t]),u.push(f[4*t+1]),u.push(f[4*t+2]),u.push(f[4*t+3])),++p}))},_=this;for(t=0;t<this._vertices.length;++t)g();var v=this._reconstructedMesh.getTotalIndices(),m=this._reconstructedMesh.getTotalVertices(),y=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var x=this._reconstructedMesh.getIndices(),b=this._mesh.getIndices();for(t=0;t<n.length;++t)i=n[t],[0,1,2].forEach((function(e){var t=b[i.originalOffset+e],r=i._vertices[e].originalOffsets.indexOf(t);r<0&&(r=0),x.push(i._vertices[e].id+r+m)}));this._reconstructedMesh.setIndices(x),this._reconstructedMesh.setVerticesData(o.o.PositionKind,s),a.length>0&&this._reconstructedMesh.setVerticesData(o.o.NormalKind,a),c.length>0&&this._reconstructedMesh.setVerticesData(o.o.UVKind,c),u.length>0&&this._reconstructedMesh.setVerticesData(o.o.ColorKind,u);var I=this._mesh.subMeshes[e];e>0&&(this._reconstructedMesh.subMeshes=[],y.forEach((function(e){h.P.AddToMesh(e.materialIndex,e.verticesStart,e.verticesCount,e.indexStart,e.indexCount,e.getMesh())})),h.P.AddToMesh(I.materialIndex,m,p,v,3*n.length,this._reconstructedMesh))},e.prototype._initDecimatedMesh=function(){this._reconstructedMesh=new c.Kj(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},e.prototype._isFlipped=function(e,t,i,r,n){for(var s=0;s<e.triangleCount;++s){var o=this._triangles[this._references[e.triangleStart+s].triangleId];if(!o.deleted){var h=this._references[e.triangleStart+s].vertexId,c=o._vertices[(h+1)%3],u=o._vertices[(h+2)%3];if(c!==t&&u!==t){var l=c.position.subtract(i);l=l.normalize();var d=u.position.subtract(i);if(d=d.normalize(),Math.abs(a.P.Dot(l,d))>.999)return!0;var f=a.P.Cross(l,d).normalize();if(r[s]=!1,a.P.Dot(f,o.normal)<.2)return!0}else r[s]=!0,n.push(o)}}return!1},e.prototype._updateTriangles=function(e,t,i,r){for(var n=r,s=0;s<t.triangleCount;++s){var a=this._references[t.triangleStart+s],o=this._triangles[a.triangleId];o.deleted||(i[s]&&o.deletePending?(o.deleted=!0,n++):(o._vertices[a.vertexId]=e,o.isDirty=!0,o.error[0]=this._calculateError(o._vertices[0],o._vertices[1])+o.borderFactor/2,o.error[1]=this._calculateError(o._vertices[1],o._vertices[2])+o.borderFactor/2,o.error[2]=this._calculateError(o._vertices[2],o._vertices[0])+o.borderFactor/2,o.error[3]=Math.min(o.error[0],o.error[1],o.error[2]),this._references.push(a)))}return n},e.prototype._identifyBorder=function(){for(var e=0;e<this._vertices.length;++e){var t=[],i=[],r=this._vertices[e],n=void 0;for(n=0;n<r.triangleCount;++n)for(var s=this._triangles[this._references[r.triangleStart+n].triangleId],a=0;a<3;a++){for(var o=0,h=s._vertices[a];o<t.length&&i[o]!==h.id;)++o;o===t.length?(t.push(1),i.push(h.id)):t[o]++}for(n=0;n<t.length;++n)1===t[n]?this._vertices[i[n]].isBorder=!0:this._vertices[i[n]].isBorder=!1}},e.prototype._updateMesh=function(e){var t,i,r,n;if(void 0===e&&(e=!1),!e){var s=[];for(t=0;t<this._triangles.length;++t)this._triangles[t].deleted||s.push(this._triangles[t]);this._triangles=s}for(t=0;t<this._vertices.length;++t)this._vertices[t].triangleCount=0,this._vertices[t].triangleStart=0;for(t=0;t<this._triangles.length;++t)for(i=this._triangles[t],r=0;r<3;++r)(n=i._vertices[r]).triangleCount++;var a=0;for(t=0;t<this._vertices.length;++t)this._vertices[t].triangleStart=a,a+=this._vertices[t].triangleCount,this._vertices[t].triangleCount=0;var o=new Array(3*this._triangles.length);for(t=0;t<this._triangles.length;++t)for(i=this._triangles[t],r=0;r<3;++r)o[(n=i._vertices[r]).triangleStart+n.triangleCount]=new te(r,t),n.triangleCount++;this._references=o,e&&this._identifyBorder()},e.prototype._vertexError=function(e,t){var i=t.x,r=t.y,n=t.z;return e.data[0]*i*i+2*e.data[1]*i*r+2*e.data[2]*i*n+2*e.data[3]*i+e.data[4]*r*r+2*e.data[5]*r*n+2*e.data[6]*r+e.data[7]*n*n+2*e.data[8]*n+e.data[9]},e.prototype._calculateError=function(e,t,i){var r=e.q.add(t.q),n=e.isBorder&&t.isBorder,s=0,o=r.det(0,1,2,1,4,5,2,5,7);if(0===o||n){var h=e.position.add(t.position).divide(new a.P(2,2,2)),c=this._vertexError(r,e.position),u=this._vertexError(r,t.position),l=this._vertexError(r,h);(s=Math.min(c,u,l))===c?i&&i.copyFrom(e.position):s===u?i&&i.copyFrom(t.position):i&&i.copyFrom(h)}else i||(i=a.P.Zero()),i.x=-1/o*r.det(1,2,3,4,5,6,5,7,8),i.y=1/o*r.det(0,2,3,1,5,6,2,7,8),i.z=-1/o*r.det(0,1,3,1,4,6,2,5,8),s=this._vertexError(r,i);return s},e}(),re=i(65273),ne=i(85627);Object.defineProperty(re.x.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new X;var e=this._getComponent(ne.l.NAME_SIMPLIFICATIONQUEUE);e||(e=new se(this),this._addComponent(e))}return this._simplificationQueue},set:function(e){this._simplificationQueue=e},enumerable:!0,configurable:!0}),c.Kj.prototype.simplify=function(e,t,i,n){return void 0===t&&(t=!0),void 0===i&&(i=r.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:e,parallelProcessing:t,mesh:this,simplificationType:i,successCallback:n}),this};var se=function(){function e(e){this.name=ne.l.NAME_SIMPLIFICATIONQUEUE,this.scene=e}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(ne.l.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},e}(),ae=i(86230),oe=i(28674),he=(i(39318),i(62659)),ce=i(30700),ue=i(42080),le=i(21254),de=i(84157);i(83236)},63003:(e,t,i)=>{i.d(t,{S:()=>l});var r=i(31191),n=i(58095),s=i(84318),a=i(71419),o=i(91243),h=i(1101),c=i(30700),u=i(72208);o.Kj._instancedMeshFactory=function(e,t){var i=new l(e,t);if(t.instancedBuffers)for(var r in i.instancedBuffers={},t.instancedBuffers)i.instancedBuffers[r]=t.instancedBuffers[r];return i};var l=function(e){function t(t,i){var r=e.call(this,t,i.getScene())||this;r._indexInSourceMeshInstanceArray=-1,r._distanceToCamera=0,i.addInstance(r),r._sourceMesh=i,r._unIndexed=i._unIndexed,r.position.copyFrom(i.position),r.rotation.copyFrom(i.rotation),r.scaling.copyFrom(i.scaling),i.rotationQuaternion&&(r.rotationQuaternion=i.rotationQuaternion.clone()),r.animations=i.animations.slice();for(var n=0,s=i.getAnimationRanges();n<s.length;n++){var a=s[n];null!=a&&r.createAnimationRange(a.name,a.from,a.to)}return r.infiniteDistance=i.infiniteDistance,r.setPivotMatrix(i.getPivotMatrix()),r.refreshBoundingInfo(!0,!0),r._syncSubMeshes(),r}return(0,r.ZT)(t,e),t.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(t.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!1,configurable:!0}),t.prototype._resyncLightSources=function(){},t.prototype._resyncLightSource=function(){},t.prototype._removeLightSource=function(){},Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&s.Y.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!1,configurable:!0}),t.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},t.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(t.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!1,configurable:!0}),t.prototype.createInstance=function(e){return this._sourceMesh.createInstance(e)},t.prototype.isReady=function(e){return void 0===e&&(e=!1),this._sourceMesh.isReady(e,!0)},t.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},t.prototype.setVerticesData=function(e,t,i,r){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,i,r),this.sourceMesh},t.prototype.updateVerticesData=function(e,t,i,r){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,i,r),this.sourceMesh},t.prototype.setIndices=function(e,t){return void 0===t&&(t=null),this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh},t.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},t.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!1,configurable:!0}),t.prototype.refreshBoundingInfo=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;var i=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e,t),i),this},t.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},t.prototype._activate=function(t,i){if(e.prototype._activate.call(this,t,i),this._sourceMesh.subMeshes||s.Y.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!=this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,t),i){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},t.prototype._postActivate=function(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},t.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==c.Y.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new n.y3);var t=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,n.jp.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(n.jp.Vector3[7]),this._currentLOD._masterMesh=t,this._billboardWorldMatrix}return e.prototype.getWorldMatrix.call(this)},Object.defineProperty(t.prototype,"isAnInstance",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.getLOD=function(e){if(!e)return this;var t=this.sourceMesh.getLODLevels();if(t&&0!==t.length){var i=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(e,i.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD},t.prototype._preActivateForIntermediateRendering=function(e){return this.sourceMesh._preActivateForIntermediateRendering(e)},t.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this},t.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},t.prototype._updateBoundingInfo=function(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},t.prototype.clone=function(e,t,i){void 0===t&&(t=null);var r=this._sourceMesh.createInstance(e);if(h.j.DeepCopy(this,r,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),t&&(r.parent=t),!i)for(var n=0;n<this.getScene().meshes.length;n++){var s=this.getScene().meshes[n];s.parent===this&&s.clone(s.name,r)}return r.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(r),r},t.prototype.dispose=function(t,i){void 0===i&&(i=!1),this._sourceMesh.removeInstance(this),e.prototype.dispose.call(this,t,i)},t}(a.x);o.Kj.prototype.registerInstancedBuffer=function(e,t){var i,r;if(null===(r=null===(i=this._userInstancedBuffersStorage)||void 0===i?void 0:i.vertexBuffers[e])||void 0===r||r.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(var n=0,s=this.instances;n<s.length;n++){s[n].instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0})}this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new u.o(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0);for(var a=0,o=this.instances;a<o.length;a++){o[a].instancedBuffers[e]=null}this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},o.Kj.prototype._processInstancedBuffers=function(e,t){var i=e.length;for(var r in this.instancedBuffers){for(var n=this._userInstancedBuffersStorage.sizes[r],s=this._userInstancedBuffersStorage.strides[r],a=(i+1)*s;n<a;)n*=2;this._userInstancedBuffersStorage.data[r].length!=n&&(this._userInstancedBuffersStorage.data[r]=new Float32Array(n),this._userInstancedBuffersStorage.sizes[r]=n,this._userInstancedBuffersStorage.vertexBuffers[r]&&(this._userInstancedBuffersStorage.vertexBuffers[r].dispose(),this._userInstancedBuffersStorage.vertexBuffers[r]=null));var o=this._userInstancedBuffersStorage.data[r],h=0;if(t)(l=this.instancedBuffers[r]).toArray?l.toArray(o,h):l.copyToArray?l.copyToArray(o,h):o[h]=l,h+=s;for(var c=0;c<i;c++){var l;(l=e[c].instancedBuffers[r]).toArray?l.toArray(o,h):l.copyToArray?l.copyToArray(o,h):o[h]=l,h+=s}this._userInstancedBuffersStorage.vertexBuffers[r]?this._userInstancedBuffersStorage.vertexBuffers[r].updateDirectly(o,0):(this._userInstancedBuffersStorage.vertexBuffers[r]=new u.o(this.getEngine(),this._userInstancedBuffersStorage.data[r],r,!0,!1,s,!0),this._invalidateInstanceVertexArrayObject())}},o.Kj.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(var e in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[e]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},o.Kj.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}}},37852:(e,t,i)=>{i.d(t,{E:()=>l,_:()=>u});var r=i(31191),n=i(15631),s=i(72208),a=i(91243),o=i(63003),h=i(98163),c=i(54067);i(77018),i(81654);a.Kj._LinesMeshParser=function(e,t){return u.Parse(e,t)};var u=function(e){function t(t,i,r,a,o,h,u,l){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null);var d=e.call(this,t,i,r,a,o)||this;d.useVertexColor=h,d.useVertexAlpha=u,d.color=new n.Wo(1,1,1),d.alpha=1,a&&(d.color=a.color.clone(),d.alpha=a.alpha,d.useVertexColor=a.useVertexColor,d.useVertexAlpha=a.useVertexAlpha),d.intersectionThreshold=.1;var f={attributes:[s.o.PositionKind],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null};return!1===u?f.needAlphaBlending=!1:f.defines.push("#define VERTEXALPHA"),h?(f.defines.push("#define VERTEXCOLOR"),f.attributes.push(s.o.ColorKind)):(f.uniforms.push("color"),d._color4=new n.HE),d.material=l||new c.j("colorShader",d.getScene(),"color",f,!1),d}return(0,r.ZT)(t,e),t.prototype._isShaderMaterial=function(e){return"ShaderMaterial"===e.getClassName()},t.prototype.isReady=function(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage)&&e.prototype.isReady.call(this)},t.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(t.prototype,"material",{get:function(){return this._lineMaterial},set:function(e){this._lineMaterial=e,this._lineMaterial.fillMode=h.F.LineListDrawMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"checkCollisions",{get:function(){return!1},set:function(e){},enumerable:!1,configurable:!0}),t.prototype._bind=function(){if(!this._geometry)return this;var e=this._lineMaterial.getEffect(),t=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._userInstancedBuffersStorage?this._geometry._bind(e,t,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(e,t),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){var i=this.color,r=i.r,n=i.g,s=i.b;this._color4.set(r,n,s,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this},t.prototype._draw=function(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var r=this.getScene().getEngine();return this._unIndexed?r.drawArraysType(h.F.LineListDrawMode,e.verticesStart,e.verticesCount,i):r.drawElementsType(h.F.LineListDrawMode,e.indexStart,e.indexCount,i),this},t.prototype.dispose=function(t){this._lineMaterial.dispose(!1,!1,!0),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e,i,r){return void 0===i&&(i=null),new t(e,this.getScene(),i,this,r)},t.prototype.createInstance=function(e){var t=new l(e,this);if(this.instancedBuffers)for(var i in t.instancedBuffers={},this.instancedBuffers)t.instancedBuffers[i]=this.instancedBuffers[i];return t},t.prototype.serialize=function(t){e.prototype.serialize.call(this,t),t.color=this.color.asArray(),t.alpha=this.alpha},t.Parse=function(e,i){var r=new t(e.name,i);return r.color=n.Wo.FromArray(e.color),r.alpha=e.alpha,r},t}(a.Kj),l=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.intersectionThreshold=i.intersectionThreshold,r}return(0,r.ZT)(t,e),t.prototype.getClassName=function(){return"InstancedLinesMesh"},t}(o.S)},91243:(e,t,i)=>{i.d(t,{Kj:()=>C,Wv:()=>P,gW:()=>A});var r=i(31191),n=i(62897),s=i(13514),a=i(1101),o=i(20163),h=i(24539),c=i(58095),u=i(15631),l=i(17834),d=i(72208),f=i(89209),p=i(63946),g=i(71419),_=i(68345),v=i(98163),m=i(91855),y=i(43824),x=i(96969),b=i(84318),I=i(48620),M=i(77851),D=i(85627),B=i(62659),A=function(){},S=function(){this.visibleInstances={},this.batchCache=new P,this.batchCacheReplacementModeInFrozenMode=new P,this.instancesBufferSize=2048},P=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},V=function(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null},T=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0},C=function(e){function t(i,r,s,h,c,u){void 0===r&&(r=null),void 0===s&&(s=null),void 0===h&&(h=null),void 0===u&&(u=!0);var l=e.call(this,i,r)||this;if(l._internalMeshDataInfo=new T,l.delayLoadState=0,l.instances=new Array,l._creationDataStorage=null,l._geometry=null,l._instanceDataStorage=new S,l._thinInstanceDataStorage=new V,l._shouldGenerateFlatShading=!1,l._originalBuilderSideOrientation=t.DEFAULTSIDE,l.overrideMaterialSideOrientation=null,l.ignoreCameraMaxZ=!1,r=l.getScene(),l._onBeforeDraw=function(e,t,i){e&&i&&(l._uniformBuffer?l.transferToEffect(t):i.bindOnlyWorldMatrix(t))},h){if(h._geometry&&h._geometry.applyToMesh(l),a.j.DeepCopy(h,l,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo"],["_poseMatrix"]),l._internalMeshDataInfo._source=h,r.useClonedMeshMap&&(h._internalMeshDataInfo.meshMap||(h._internalMeshDataInfo.meshMap={}),h._internalMeshDataInfo.meshMap[l.uniqueId]=l),l._originalBuilderSideOrientation=h._originalBuilderSideOrientation,l._creationDataStorage=h._creationDataStorage,h._ranges){var d=h._ranges;for(var f in d)Object.prototype.hasOwnProperty.call(d,f)&&d[f]&&l.createAnimationRange(f,d[f].from,d[f].to)}if(h.metadata&&h.metadata.clone?l.metadata=h.metadata.clone():l.metadata=h.metadata,o.$&&o.$.HasTags(h)&&o.$.AddTagsTo(l,o.$.GetTags(h,!0)),l.setEnabled(h.isEnabled()),l.parent=h.parent,l.setPivotMatrix(h.getPivotMatrix()),l.id=i+"."+h.id,l.material=h.material,!c)for(var p=h.getDescendants(!0),g=0;g<p.length;g++){var _=p[g];_.clone&&_.clone(i+"."+_.name,l)}if(h.morphTargetManager&&(l.morphTargetManager=h.morphTargetManager),r.getPhysicsEngine){var v=r.getPhysicsEngine();if(u&&v){var m=v.getImpostorForPhysicsObject(h);m&&(l.physicsImpostor=m.clone(l))}}for(g=0;g<r.particleSystems.length;g++){var y=r.particleSystems[g];y.emitter===h&&y.clone(y.name,l)}l.skeleton=h.skeleton,l.refreshBoundingInfo(!0,!0),l.computeWorldMatrix(!0)}return null!==s&&(l.parent=s),l._instanceDataStorage.hardwareInstancedRendering=l.getEngine().getCaps().instancedArrays,l._internalMeshDataInfo._onMeshReadyObserverAdded=function(e){e.unregisterOnNextCall=!0,l.isReady(!0)?l.onMeshReadyObservable.notifyObservers(l):l._internalMeshDataInfo._checkReadinessObserver||(l._internalMeshDataInfo._checkReadinessObserver=l._scene.onBeforeRenderObservable.add((function(){l.isReady(!0)&&(l._scene.onBeforeRenderObservable.remove(l._internalMeshDataInfo._checkReadinessObserver),l._internalMeshDataInfo._checkReadinessObserver=null,l.onMeshReadyObservable.notifyObservers(l))})))},l.onMeshReadyObservable=new n.y$(l._internalMeshDataInfo._onMeshReadyObserverAdded),h&&h.onClonedObservable.notifyObservers(l),l}return(0,r.ZT)(t,e),t._GetDefaultSideOrientation=function(e){return e||t.FRONTSIDE},Object.defineProperty(t.prototype,"useLODScreenCoverage",{get:function(){return this._internalMeshDataInfo._useLODScreenCoverage},set:function(e){this._internalMeshDataInfo._useLODScreenCoverage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(e&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(d.o.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(d.o.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new n.y$),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new n.y$),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new n.y$),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBetweenPassObservable",{get:function(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new n.y$),this._internalMeshDataInfo._onBetweenPassObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new n.y$),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasThinInstances",{get:function(){var e;return(null!==(e=this._thinInstanceDataStorage.instancesCount)&&void 0!==e?e:0)>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forcedInstanceCount",{get:function(){return this._internalMeshDataInfo._forcedInstanceCount},set:function(e){this._internalMeshDataInfo._forcedInstanceCount=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cloneMeshMap",{get:function(){return this._internalMeshDataInfo.meshMap},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesPreviousData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(e){this._instanceDataStorage.manualUpdate=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"manualUpdateOfPreviousWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.previousManualUpdate},set:function(e){this._instanceDataStorage.previousManualUpdate=e},enumerable:!1,configurable:!0}),t.prototype.instantiateHierarchy=function(e,t,i){void 0===e&&(e=null);var r=!(this.getTotalVertices()>0)||t&&t.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));r.parent=e||this.parent,r.position=this.position.clone(),r.scaling=this.scaling.clone(),this.rotationQuaternion?r.rotationQuaternion=this.rotationQuaternion.clone():r.rotation=this.rotation.clone(),i&&i(this,r);for(var n=0,s=this.getChildTransformNodes(!0);n<s.length;n++){s[n].instantiateHierarchy(r,t,i)}return r},t.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(t.prototype,"_isMesh",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.toString=function(t){var i=e.prototype.toString.call(this,t);if(i+=", n vertices: "+this.getTotalVertices(),i+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var r=0;r<this.animations.length;r++)i+=", animation[0]: "+this.animations[r].toString(t);if(t)if(this._geometry){var n=this.getIndices(),s=this.getVerticesData(d.o.PositionKind);s&&n&&(i+=", flat shading: "+(s.length/3===n.length?"YES":"NO"))}else i+=", flat shading: UNKNOWN";return i},t.prototype._unBindEffect=function(){e.prototype._unBindEffect.call(this);for(var t=0,i=this.instances;t<i.length;t++){i[t]._unBindEffect()}},Object.defineProperty(t.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!1,configurable:!0}),t.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},t.prototype._sortLODLevels=function(){var e=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort((function(t,i){return t.distanceOrScreenCoverage<i.distanceOrScreenCoverage?e:t.distanceOrScreenCoverage>i.distanceOrScreenCoverage?-e:0}))},t.prototype.addLODLevel=function(e,t){if(t&&t._masterMesh)return b.Y.Warn("You cannot use a mesh as LOD level twice"),this;var i=new B.g(e,t);return this._internalMeshDataInfo._LODLevels.push(i),t&&(t._masterMesh=this),this._sortLODLevels(),this},t.prototype.getLODLevelAtDistance=function(e){for(var t=this._internalMeshDataInfo,i=0;i<t._LODLevels.length;i++){var r=t._LODLevels[i];if(r.distanceOrScreenCoverage===e)return r.mesh}return null},t.prototype.removeLODLevel=function(e){for(var t=this._internalMeshDataInfo,i=0;i<t._LODLevels.length;i++)t._LODLevels[i].mesh===e&&(t._LODLevels.splice(i,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},t.prototype.getLOD=function(e,t){var i,r=this._internalMeshDataInfo;if(!r._LODLevels||0===r._LODLevels.length)return this;t?i=t:i=this.getBoundingInfo().boundingSphere;var n=i.centerWorld.subtract(e.globalPosition).length(),s=n,a=1;if(r._useLODScreenCoverage){var o=e.screenArea,h=i.radiusWorld*e.minZ/n;s=(h=h*h*Math.PI)/o,a=-1}if(a*r._LODLevels[r._LODLevels.length-1].distanceOrScreenCoverage>a*s)return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this;for(var c=0;c<r._LODLevels.length;c++){var u=r._LODLevels[c];if(a*u.distanceOrScreenCoverage<a*s){if(u.mesh){if(4===u.mesh.delayLoadState)return u.mesh._checkDelayState(),this;if(2===u.mesh.delayLoadState)return this;u.mesh._preActivate(),u.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,u.mesh),u.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),t.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},t.prototype.getVerticesData=function(e,t,i){var r,n;if(!this._geometry)return null;var s=null===(n=null===(r=this._userInstancedBuffersStorage)||void 0===r?void 0:r.vertexBuffers[e])||void 0===n?void 0:n.getFloatData(this._geometry.getTotalVertices(),i||t&&1!==this._geometry.meshes.length);return s||(s=this._geometry.getVerticesData(e,t,i)),s},t.prototype.getVertexBuffer=function(e){var t,i;return this._geometry?null!==(i=null===(t=this._userInstancedBuffersStorage)||void 0===t?void 0:t.vertexBuffers[e])&&void 0!==i?i:this._geometry.getVertexBuffer(e):null},t.prototype.isVerticesDataPresent=function(e){var t;return this._geometry?void 0!==(null===(t=this._userInstancedBuffersStorage)||void 0===t?void 0:t.vertexBuffers[e])||this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.isVertexBufferUpdatable=function(e){var t,i;return this._geometry?(null===(i=null===(t=this._userInstancedBuffersStorage)||void 0===t?void 0:t.vertexBuffers[e])||void 0===i?void 0:i.isUpdatable())||this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=new Array;return this._delayInfo&&this._delayInfo.forEach((function(t){e.push(t)})),e}var t=this._geometry.getVerticesDataKinds();if(this._userInstancedBuffersStorage)for(var i in this._userInstancedBuffersStorage.vertexBuffers)t.push(i);return t},t.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},t.prototype.getIndices=function(e,t){return this._geometry?this._geometry.getIndices(e,t):[]},Object.defineProperty(t.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!1,configurable:!0}),t.prototype.isReady=function(t,i){var r,n,s,a,o,h;if(void 0===t&&(t=!1),void 0===i&&(i=!1),2===this.delayLoadState)return!1;if(!e.prototype.isReady.call(this,t))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!t)return!0;var c=this.getEngine(),u=this.getScene(),l=i||c.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();var d=this.material||u.defaultMaterial;if(d)if(d._storeEffectOnSubMeshes)for(var f=0,p=this.subMeshes;f<p.length;f++){var g=(I=p[f]).getMaterial();if(g)if(g._storeEffectOnSubMeshes){if(!g.isReadyForSubMesh(this,I,l))return!1}else if(!g.isReady(this,l))return!1}else if(!d.isReady(this,l))return!1;for(var _=c.currentRenderPassId,v=0,m=this.lightSources;v<m.length;v++){var y=m[v].getShadowGenerator();if(y&&(!(null===(r=y.getShadowMap())||void 0===r?void 0:r.renderList)||(null===(n=y.getShadowMap())||void 0===n?void 0:n.renderList)&&-1!==(null===(a=null===(s=y.getShadowMap())||void 0===s?void 0:s.renderList)||void 0===a?void 0:a.indexOf(this)))){y.getShadowMap()&&(c.currentRenderPassId=y.getShadowMap().renderPassId);for(var x=0,b=this.subMeshes;x<b.length;x++){var I=b[x];if(!y.isReady(I,l,null!==(h=null===(o=I.getMaterial())||void 0===o?void 0:o.needAlphaBlendingForMesh(this))&&void 0!==h&&h))return c.currentRenderPassId=_,!1}c.currentRenderPassId=_}}for(var M=0,D=this._internalMeshDataInfo._LODLevels;M<D.length;M++){var B=D[M];if(B.mesh&&!B.mesh.isReady(l))return!1}return!0},Object.defineProperty(t.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!1,configurable:!0}),t.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},t.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(t.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!1,configurable:!0}),t.prototype._preActivate=function(){var e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t||(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null),this},t.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},t.prototype._registerInstanceForRenderId=function(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=t,this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this},t.prototype._afterComputeWorldMatrix=function(){e.prototype._afterComputeWorldMatrix.call(this),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))},t.prototype._postActivate=function(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))},t.prototype.refreshBoundingInfo=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;var i=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e,t),i),this},t.prototype._createGlobalSubMesh=function(e){var t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var i=this.getIndices();if(!i)return null;var r=i.length,n=!1;if(e)n=!0;else for(var s=0,a=this.subMeshes;s<a.length;s++){var o=a[s];if(o.indexStart+o.indexCount>r){n=!0;break}if(o.verticesStart+o.verticesCount>t){n=!0;break}}if(!n)return this.subMeshes[0]}return this.releaseSubMeshes(),new _.P(0,0,t,0,this.getTotalIndices(),this)},t.prototype.subdivide=function(e){if(!(e<1)){for(var t=this.getTotalIndices(),i=t/e|0,r=0;i%3!=0;)i++;this.releaseSubMeshes();for(var n=0;n<e&&!(r>=t);n++)_.P.CreateFromIndices(0,r,n===e-1?t-r:i,this),r+=i;this.synchronizeInstances()}},t.prototype.setVerticesData=function(e,t,i,r){if(void 0===i&&(i=!1),this._geometry)this._geometry.setVerticesData(e,t,i,r);else{var n=new f.x;n.set(t,e);var s=this.getScene();new p.Z(p.Z.RandomId(),s,n,i,this)}return this},t.prototype.removeVerticesData=function(e){this._geometry&&this._geometry.removeVerticesData(e)},t.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var i=this.getVertexBuffer(e);i&&i.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},t.prototype.setVerticesBuffer=function(e,t){return void 0===t&&(t=!0),this._geometry||(this._geometry=p.Z.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e,null,t),this},t.prototype.updateVerticesData=function(e,t,i,r){return this._geometry?(r?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i),this):this},t.prototype.updateMeshPositions=function(e,t){void 0===t&&(t=!0);var i=this.getVerticesData(d.o.PositionKind);if(!i)return this;if(e(i),this.updateVerticesData(d.o.PositionKind,i,!1,!1),t){var r=this.getIndices(),n=this.getVerticesData(d.o.NormalKind);if(!n)return this;f.x.ComputeNormals(i,r,n),this.updateVerticesData(d.o.NormalKind,n,!1,!1)}return this},t.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;var e=this._geometry,t=this._geometry.copy(p.Z.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this},t.prototype.setIndices=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=!1),this._geometry)this._geometry.setIndices(e,t,i);else{var r=new f.x;r.indices=e;var n=this.getScene();new p.Z(p.Z.RandomId(),n,r,i,this)}return this},t.prototype.updateIndices=function(e,t,i){return void 0===i&&(i=!1),this._geometry?(this._geometry.updateIndices(e,t,i),this):this},t.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},t.prototype._bind=function(e,t,i){if(!this._geometry)return this;var r,n=this.getScene().getEngine();if(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(t),this._unIndexed)r=null;else switch(i){case v.F.PointFillMode:r=null;break;case v.F.WireFrameFillMode:r=e._getLinesIndexBuffer(this.getIndices(),n);break;default:case v.F.TriangleFillMode:r=this._geometry.getIndexBuffer()}return!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(t,r):this._geometry._bind(t,r,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),this},t.prototype._draw=function(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var r=this.getScene().getEngine();return this._unIndexed||t==v.F.PointFillMode?r.drawArraysType(t,e.verticesStart,e.verticesCount,this.forcedInstanceCount||i):t==v.F.WireFrameFillMode?r.drawElementsType(t,0,e._linesIndexCount,this.forcedInstanceCount||i):r.drawElementsType(t,e.indexStart,e.indexCount,this.forcedInstanceCount||i),this},t.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},t.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},t.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},t.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},t.prototype._getInstancesRenderList=function(e,t){if(void 0===t&&(t=!1),this._instanceDataStorage.isFrozen){if(t)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[e]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[e]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}var i=this.getScene(),r=i._isInIntermediateRendering(),n=r?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,s=this._instanceDataStorage.batchCache;if(s.mustReturn=!1,s.renderSelf[e]=t||!n&&this.isEnabled()&&this.isVisible,s.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t){var a=this._instanceDataStorage.visibleInstances,o=i.getRenderId(),h=r?a.intermediateDefaultRenderId:a.defaultRenderId;s.visibleInstances[e]=a[o],!s.visibleInstances[e]&&h&&(s.visibleInstances[e]=a[h])}return s.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==s.visibleInstances[e]&&void 0!==s.visibleInstances[e],this._instanceDataStorage.previousBatch=s,s},t.prototype._renderWithInstances=function(e,i,r,n,s){var a,o=r.visibleInstances[e._id];if(!o)return this;for(var h=this._instanceDataStorage,u=h.instancesBufferSize,l=h.instancesBuffer,f=h.instancesPreviousBuffer,p=16*(o.length+1)*4;h.instancesBufferSize<p;)h.instancesBufferSize*=2;h.instancesData&&u==h.instancesBufferSize||(h.instancesData=new Float32Array(h.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!h.instancesPreviousData||u!=h.instancesBufferSize)&&(h.instancesPreviousData=new Float32Array(h.instancesBufferSize/4));var g=0,_=0,v=r.renderSelf[e._id],m=!l||u!==h.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!h.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||h.isFrozen&&!m)_=(v?1:0)+o.length;else{var y=this.getWorldMatrix();if(v&&(this._scene.needsPreviousWorldMatrices&&(h.masterMeshPreviousWorldMatrix?(h.masterMeshPreviousWorldMatrix.copyToArray(h.instancesPreviousData,g),h.masterMeshPreviousWorldMatrix.copyFrom(y)):(h.masterMeshPreviousWorldMatrix=y.clone(),h.masterMeshPreviousWorldMatrix.copyToArray(h.instancesPreviousData,g))),y.copyToArray(h.instancesData,g),g+=16,_++),o){if(t.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&(null===(a=e.getMaterial())||void 0===a?void 0:a.needAlphaBlendingForMesh(e.getRenderingMesh()))){for(var x=this._scene.activeCamera.globalPosition,b=0;b<o.length;b++){var I=o[b];I._distanceToCamera=c.P.Distance(I.getBoundingInfo().boundingSphere.centerWorld,x)}o.sort((function(e,t){return e._distanceToCamera>t._distanceToCamera?-1:e._distanceToCamera<t._distanceToCamera?1:0}))}for(b=0;b<o.length;b++){var M=o[b],D=M.getWorldMatrix();D.copyToArray(h.instancesData,g),this._scene.needsPreviousWorldMatrices&&(M._previousWorldMatrix?(M._previousWorldMatrix.copyToArray(h.instancesPreviousData,g),M._previousWorldMatrix.copyFrom(D)):(M._previousWorldMatrix=D.clone(),M._previousWorldMatrix.copyToArray(h.instancesPreviousData,g))),g+=16,_++}}}return m?(l&&l.dispose(),f&&f.dispose(),l=new d.l(s,h.instancesData,!0,16,!1,!0),h.instancesBuffer=l,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=l.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=l.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=l.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=l.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(f=new d.l(s,h.instancesPreviousData,!0,16,!1,!0),h.instancesPreviousBuffer=f,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=f.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=f.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=f.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=f.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen||(l.updateDirectly(h.instancesData,0,_),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||f.updateDirectly(h.instancesPreviousData,0,_)),this._processInstancedBuffers(o,v),this.getScene()._activeIndices.addCount(e.indexCount*_,!1),s._currentDrawContext&&(s._currentDrawContext.useInstancing=!0),this._bind(e,n,i),this._draw(e,i,_),!this._scene.needsPreviousWorldMatrices||m||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen||this._instanceDataStorage.previousManualUpdate||f.updateDirectly(h.instancesData,0,_),s.unbindInstanceAttributes(),this},t.prototype._renderWithThinInstances=function(e,t,i,r){var n,s,a=null!==(s=null===(n=this._thinInstanceDataStorage)||void 0===n?void 0:n.instancesCount)&&void 0!==s?s:0;this.getScene()._activeIndices.addCount(e.indexCount*a,!1),r._currentDrawContext&&(r._currentDrawContext.useInstancing=!0),this._bind(e,i,t),this._draw(e,t,a),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,a):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),r.unbindInstanceAttributes()},t.prototype._processInstancedBuffers=function(e,t){},t.prototype._processRendering=function(e,t,i,r,n,s,a,o){var h=this.getScene(),c=h.getEngine();if(s&&t.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(t,r,i,c),this;if(s)this._renderWithInstances(t,r,n,i,c);else{c._currentDrawContext&&(c._currentDrawContext.useInstancing=!1);var u=0;n.renderSelf[t._id]&&(a&&a(!1,e.getWorldMatrix(),o),u++,this._draw(t,r,this._instanceDataStorage.overridenInstanceCount));var l=n.visibleInstances[t._id];if(l){var d=l.length;u+=d;for(var f=0;f<d;f++){var p=l[f].getWorldMatrix();a&&a(!0,p,o),this._draw(t,r)}}h._activeIndices.addCount(t.indexCount*u,!1)}return this},t.prototype._rebuild=function(t){if(void 0===t&&(t=!1),this._instanceDataStorage.instancesBuffer&&(t&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(var i in this._userInstancedBuffersStorage.vertexBuffers){var r=this._userInstancedBuffersStorage.vertexBuffers[i];r&&(t&&r.dispose(),this._userInstancedBuffersStorage.vertexBuffers[i]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,e.prototype._rebuild.call(this,t)},t.prototype._freeze=function(){if(this.subMeshes){for(var e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},t.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},t.prototype.render=function(e,t,i){var r,n,s,a=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;var o=this._getInstancesRenderList(e._id,!!i);if(o.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var h=a.getEngine(),c=0,u=null;this.ignoreCameraMaxZ&&a.activeCamera&&!a._isInIntermediateRendering()&&(c=a.activeCamera.maxZ,u=a.activeCamera,a.activeCamera.maxZ=0,a.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var l,d=o.hardwareInstancedRendering[e._id]||e.getRenderingMesh().hasThinInstances,f=this._instanceDataStorage,p=e.getMaterial();if(!p)return u&&(u.maxZ=c,a.updateTransformMatrix(!0)),this;if(f.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===p){if(p._storeEffectOnSubMeshes&&!(null===(r=e.effect)||void 0===r?void 0:r._wasPreviouslyReady)||!p._storeEffectOnSubMeshes&&!(null===(n=p.getEffect())||void 0===n?void 0:n._wasPreviouslyReady))return u&&(u.maxZ=c,a.updateTransformMatrix(!0)),this}else{if(p._storeEffectOnSubMeshes){if(!p.isReadyForSubMesh(this,e,d))return u&&(u.maxZ=c,a.updateTransformMatrix(!0)),this}else if(!p.isReady(this,d))return u&&(u.maxZ=c,a.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=p}t&&h.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode);for(var g=null!==(s=null==(l=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?e._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper())?void 0:l.effect)&&void 0!==s?s:null,_=0,m=a._beforeRenderingMeshStage;_<m.length;_++){m[_].action(this,e,o,g)}if(!l||!g)return u&&(u.maxZ=c,a.updateTransformMatrix(!0)),this;var y,x=i||this;if(f.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.backFaceCulling&&null===this.overrideMaterialSideOrientation)y=f.sideOrientation;else{var b=x._getWorldMatrixDeterminant();null==(y=this.overrideMaterialSideOrientation)&&(y=this._internalMeshDataInfo._effectiveMaterial.sideOrientation),b<0&&(y=y===v.F.ClockWiseSideOrientation?v.F.CounterClockWiseSideOrientation:v.F.ClockWiseSideOrientation),f.sideOrientation=y}var I=this._internalMeshDataInfo._effectiveMaterial._preBind(l,y);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&h.setDepthWrite(!0);var M=a.forcePointsCloud?v.F.PointFillMode:a.forceWireframe?v.F.WireFrameFillMode:this._internalMeshDataInfo._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),d||this._bind(e,g,M);var D=this._internalMeshDataInfo._effectiveMaterial,B=x.getWorldMatrix();D._storeEffectOnSubMeshes?D.bindForSubMesh(B,this,e):D.bind(B,this),!D.backFaceCulling&&D.separateCullingPass&&(h.setState(!0,D.zOffset,!1,!I,D.cullBackFaces,D.stencil,D.zOffsetUnits),this._processRendering(this,e,g,M,o,d,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),h.setState(!0,D.zOffset,!1,I,D.cullBackFaces,D.stencil,D.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(e)),this._processRendering(this,e,g,M,o,d,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(var A=0,S=a._afterRenderingMeshStage;A<S.length;A++){S[A].action(this,e,o,g)}return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),u&&(u.maxZ=c,a.updateTransformMatrix(!0)),this},t.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(d.o.MatricesWeightsKind)&&(this.isVerticesDataPresent(d.o.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())},t.prototype._normalizeSkinFourWeights=function(){for(var e=this.getVerticesData(d.o.MatricesWeightsKind),t=e.length,i=0;i<t;i+=4){var r=e[i]+e[i+1]+e[i+2]+e[i+3];if(0===r)e[i]=1;else{var n=1/r;e[i]*=n,e[i+1]*=n,e[i+2]*=n,e[i+3]*=n}}this.setVerticesData(d.o.MatricesWeightsKind,e)},t.prototype._normalizeSkinWeightsAndExtra=function(){for(var e=this.getVerticesData(d.o.MatricesWeightsExtraKind),t=this.getVerticesData(d.o.MatricesWeightsKind),i=t.length,r=0;r<i;r+=4){var n=t[r]+t[r+1]+t[r+2]+t[r+3];if(0===(n+=e[r]+e[r+1]+e[r+2]+e[r+3]))t[r]=1;else{var s=1/n;t[r]*=s,t[r+1]*=s,t[r+2]*=s,t[r+3]*=s,e[r]*=s,e[r+1]*=s,e[r+2]*=s,e[r+3]*=s}}this.setVerticesData(d.o.MatricesWeightsKind,t),this.setVerticesData(d.o.MatricesWeightsKind,e)},t.prototype.validateSkinning=function(){var e=this.getVerticesData(d.o.MatricesWeightsExtraKind),t=this.getVerticesData(d.o.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var i=t.length,r=0,n=0,s=0,a=0,o=null===e?4:8,h=new Array,c=0;c<=o;c++)h[c]=0;for(c=0;c<i;c+=4){for(var u=t[c],l=u,f=0===l?0:1,p=1;p<o;p++){var g=p<4?t[c+p]:e[c+p-4];g>u&&r++,0!==g&&f++,l+=g,u=g}if(h[f]++,f>s&&(s=f),0===l)n++;else{var _=1/l,v=0;for(p=0;p<o;p++)v+=p<4?Math.abs(t[c+p]-t[c+p]*_):Math.abs(e[c+p-4]-e[c+p-4]*_);v>.001&&a++}}var m=this.skeleton.bones.length,y=this.getVerticesData(d.o.MatricesIndicesKind),x=this.getVerticesData(d.o.MatricesIndicesExtraKind),b=0;for(c=0;c<i;c+=4)for(p=0;p<o;p++){var I=p<4?y[c+p]:x[c+p-4];(I>=m||I<0)&&b++}return{skinned:!0,valid:0===n&&0===a&&0===b,report:"Number of Weights = "+i/4+"\nMaximum influences = "+s+"\nMissing Weights = "+n+"\nNot Sorted = "+r+"\nNot Normalized = "+a+"\nWeightCounts = ["+h+"]\nNumber of bones = "+m+"\nBad Bone Indices = "+b}},t.prototype._checkDelayState=function(){var e=this.getScene();return this._geometry?this._geometry.load(e):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(e)),this},t.prototype._queueLoad=function(e){var t=this;e._addPendingData(this);var i=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return s.w1.LoadFile(this.delayLoadingFile,(function(i){i instanceof ArrayBuffer?t._delayLoadingFunction(i,t):t._delayLoadingFunction(JSON.parse(i),t),t.instances.forEach((function(e){e.refreshBoundingInfo(),e._syncSubMeshes()})),t.delayLoadState=1,e._removePendingData(t)}),(function(){}),e.offlineProvider,i),this},t.prototype.isInFrustum=function(t){return 2!==this.delayLoadState&&(!!e.prototype.isInFrustum.call(this,t)&&(this._checkDelayState(),!0))},t.prototype.setMaterialById=function(e){var t,i=this.getScene().materials;for(t=i.length-1;t>-1;t--)if(i[t].id===e)return this.material=i[t],this;var r=this.getScene().multiMaterials;for(t=r.length-1;t>-1;t--)if(r[t].id===e)return this.material=r[t],this;return this},t.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},t.prototype.bakeTransformIntoVertices=function(e){if(!this.isVerticesDataPresent(d.o.PositionKind))return this;var t=this.subMeshes.splice(0);this._resetPointsArrayCache();var i,r=this.getVerticesData(d.o.PositionKind),n=new Array;for(i=0;i<r.length;i+=3)c.P.TransformCoordinates(c.P.FromArray(r,i),e).toArray(n,i);if(this.setVerticesData(d.o.PositionKind,n,this.getVertexBuffer(d.o.PositionKind).isUpdatable()),this.isVerticesDataPresent(d.o.NormalKind)){for(r=this.getVerticesData(d.o.NormalKind),n=[],i=0;i<r.length;i+=3)c.P.TransformNormal(c.P.FromArray(r,i),e).normalize().toArray(n,i);this.setVerticesData(d.o.NormalKind,n,this.getVertexBuffer(d.o.NormalKind).isUpdatable())}return e.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this},t.prototype.bakeCurrentTransformIntoVertices=function(e){return void 0===e&&(e=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._internalAbstractMeshDataInfo._positions?this._internalAbstractMeshDataInfo._positions:this._geometry?this._geometry._positions:null},enumerable:!1,configurable:!0}),t.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},t.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},t.prototype.clone=function(e,i,r,n){return void 0===e&&(e=""),void 0===i&&(i=null),void 0===n&&(n=!0),new t(e,this.getScene(),i,this,r,n)},t.prototype.dispose=function(t,i){void 0===i&&(i=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var r=this._internalMeshDataInfo;if(r._onBeforeDrawObservable&&r._onBeforeDrawObservable.clear(),r._onBeforeBindObservable&&r._onBeforeBindObservable.clear(),r._onBeforeRenderObservable&&r._onBeforeRenderObservable.clear(),r._onAfterRenderObservable&&r._onAfterRenderObservable.clear(),r._onBetweenPassObservable&&r._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(r.meshMap)for(var n in r.meshMap){(o=r.meshMap[n])&&(o._internalMeshDataInfo._source=null,r.meshMap[n]=void 0)}r._source&&r._source._internalMeshDataInfo.meshMap&&(r._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var s=0,a=this.getScene().meshes;s<a.length;s++){var o;(o=a[s])._internalMeshDataInfo&&o._internalMeshDataInfo._source&&o._internalMeshDataInfo._source===this&&(o._internalMeshDataInfo._source=null)}r._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),e.prototype.dispose.call(this,t,i)},t.prototype._disposeInstanceSpecificData=function(){},t.prototype._disposeThinInstanceSpecificData=function(){},t.prototype._invalidateInstanceVertexArrayObject=function(){},t.prototype.applyDisplacementMap=function(e,t,i,r,n,a,o){var h=this;void 0===o&&(o=!1);var c=this.getScene();return s.w1.LoadImage(e,(function(e){var s=e.width,c=e.height,u=h.getEngine().createCanvas(s,c).getContext("2d");u.drawImage(e,0,0);var l=u.getImageData(0,0,s,c).data;h.applyDisplacementMapFromBuffer(l,s,c,t,i,n,a,o),r&&r(h)}),(function(){}),c.offlineProvider),this},t.prototype.applyDisplacementMapFromBuffer=function(e,t,i,r,n,s,a,o){if(void 0===o&&(o=!1),!this.isVerticesDataPresent(d.o.PositionKind)||!this.isVerticesDataPresent(d.o.NormalKind)||!this.isVerticesDataPresent(d.o.UVKind))return b.Y.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var h=this.getVerticesData(d.o.PositionKind,!0,!0),u=this.getVerticesData(d.o.NormalKind),l=this.getVerticesData(d.o.UVKind),p=c.P.Zero(),g=c.P.Zero(),_=c.FM.Zero();s=s||c.FM.Zero(),a=a||new c.FM(1,1);for(var v=0;v<h.length;v+=3){c.P.FromArrayToRef(h,v,p),c.P.FromArrayToRef(u,v,g),c.FM.FromArrayToRef(l,v/3*2,_);var m=4*((Math.abs(_.x*a.x+s.x%1)*(t-1)%t|0)+(Math.abs(_.y*a.y+s.y%1)*(i-1)%i|0)*t),y=.3*(e[m]/255)+.59*(e[m+1]/255)+.11*(e[m+2]/255);g.normalize(),g.scaleInPlace(r+(n-r)*y),(p=p.add(g)).toArray(h,v)}return f.x.ComputeNormals(h,this.getIndices(),u),o?(this.setVerticesData(d.o.PositionKind,h),this.setVerticesData(d.o.NormalKind,u),this.setVerticesData(d.o.UVKind,l)):(this.updateVerticesData(d.o.PositionKind,h),this.updateVerticesData(d.o.NormalKind,u)),this},t.prototype.convertToFlatShadedMesh=function(){var e,t,i=this.getVerticesDataKinds(),r={},n={},s={},a=!1;for(e=0;e<i.length;e++){t=i[e];var o=this.getVertexBuffer(t),h=o.getData();(h instanceof Array||h instanceof Float32Array)&&0===h.length||(t!==d.o.NormalKind?(r[t]=o,n[t]=this.getVerticesData(t),s[t]=[]):(a=o.isUpdatable(),i.splice(e,1),e--))}var u,l=this.subMeshes.slice(0),f=this.getIndices(),p=this.getTotalIndices();for(u=0;u<p;u++){var g=f[u];for(e=0;e<i.length;e++)if(r[t=i[e]])for(var v=r[t].getStrideSize(),m=0;m<v;m++)s[t].push(n[t][g*v+m])}var y,x=[],b=s[d.o.PositionKind];for(y=this.getScene().useRightHandedSystem?1===this.overrideMaterialSideOrientation:0===this.overrideMaterialSideOrientation,u=0;u<p;u+=3){f[u]=u,f[u+1]=u+1,f[u+2]=u+2;var I=c.P.FromArray(b,3*u),M=c.P.FromArray(b,3*(u+1)),D=c.P.FromArray(b,3*(u+2)),B=I.subtract(M),A=D.subtract(M),S=c.P.Normalize(c.P.Cross(B,A));y&&S.scaleInPlace(-1);for(var P=0;P<3;P++)x.push(S.x),x.push(S.y),x.push(S.z)}for(this.setIndices(f),this.setVerticesData(d.o.NormalKind,x,a),e=0;e<i.length;e++)s[t=i[e]]&&this.setVerticesData(t,s[t],r[t].isUpdatable());this.releaseSubMeshes();for(var V=0;V<l.length;V++){var T=l[V];_.P.AddToMesh(T.materialIndex,T.indexStart,T.indexCount,T.indexStart,T.indexCount,this)}return this.synchronizeInstances(),this},t.prototype.convertToUnIndexedMesh=function(){var e,t,i=this.getVerticesDataKinds(),r={},n={},s={};for(e=0;e<i.length;e++){t=i[e];var a=this.getVertexBuffer(t);r[t]=a,n[t]=r[t].getData(),s[t]=[]}var o,h=this.subMeshes.slice(0),c=this.getIndices(),u=this.getTotalIndices();for(o=0;o<u;o++){var l=c[o];for(e=0;e<i.length;e++)for(var d=r[t=i[e]].getStrideSize(),f=0;f<d;f++)s[t].push(n[t][l*d+f])}for(o=0;o<u;o+=3)c[o]=o,c[o+1]=o+1,c[o+2]=o+2;for(this.setIndices(c),e=0;e<i.length;e++)t=i[e],this.setVerticesData(t,s[t],r[t].isUpdatable());this.releaseSubMeshes();for(var p=0;p<h.length;p++){var g=h[p];_.P.AddToMesh(g.materialIndex,g.indexStart,g.indexCount,g.indexStart,g.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},t.prototype.flipFaces=function(e){void 0===e&&(e=!1);var t,i=f.x.ExtractFromMesh(this);if(e&&this.isVerticesDataPresent(d.o.NormalKind)&&i.normals)for(t=0;t<i.normals.length;t++)i.normals[t]*=-1;if(i.indices){var r=void 0;for(t=0;t<i.indices.length;t+=3)r=i.indices[t+1],i.indices[t+1]=i.indices[t+2],i.indices[t+2]=r}return i.applyToMesh(this,this.isVertexBufferUpdatable(d.o.PositionKind)),this},t.prototype.increaseVertices=function(e){void 0===e&&(e=1);var t=f.x.ExtractFromMesh(this),i=t.indices&&!Array.isArray(t.indices)&&Array.from?Array.from(t.indices):t.indices,r=t.positions&&!Array.isArray(t.positions)&&Array.from?Array.from(t.positions):t.positions,n=t.uvs&&!Array.isArray(t.uvs)&&Array.from?Array.from(t.uvs):t.uvs,s=t.normals&&!Array.isArray(t.normals)&&Array.from?Array.from(t.normals):t.normals;if(i&&r){t.indices=i,t.positions=r,n&&(t.uvs=n),s&&(t.normals=s);for(var a=e+1,o=new Array,h=0;h<a+1;h++)o[h]=new Array;var u=void 0,l=void 0,p=new c.P(0,0,0),g=new c.P(0,0,0),_=new c.FM(0,0),v=new Array,m=new Array,y=new Array,x=void 0,I=r.length,M=void 0;n&&(M=n.length);var D=void 0;s&&(D=s.length);for(h=0;h<i.length;h+=3){m[0]=i[h],m[1]=i[h+1],m[2]=i[h+2];for(var B=0;B<3;B++)if(u=m[B],l=m[(B+1)%3],void 0===y[u]&&void 0===y[l]?(y[u]=new Array,y[l]=new Array):(void 0===y[u]&&(y[u]=new Array),void 0===y[l]&&(y[l]=new Array)),void 0===y[u][l]&&void 0===y[l][u]){y[u][l]=[],p.x=(r[3*l]-r[3*u])/a,p.y=(r[3*l+1]-r[3*u+1])/a,p.z=(r[3*l+2]-r[3*u+2])/a,s&&(g.x=(s[3*l]-s[3*u])/a,g.y=(s[3*l+1]-s[3*u+1])/a,g.z=(s[3*l+2]-s[3*u+2])/a),n&&(_.x=(n[2*l]-n[2*u])/a,_.y=(n[2*l+1]-n[2*u+1])/a),y[u][l].push(u);for(var A=1;A<a;A++)y[u][l].push(r.length/3),r[I++]=r[3*u]+A*p.x,r[I++]=r[3*u+1]+A*p.y,r[I++]=r[3*u+2]+A*p.z,s&&(s[D++]=s[3*u]+A*g.x,s[D++]=s[3*u+1]+A*g.y,s[D++]=s[3*u+2]+A*g.z),n&&(n[M++]=n[2*u]+A*_.x,n[M++]=n[2*u+1]+A*_.y);y[u][l].push(l),y[l][u]=new Array,x=y[u][l].length;for(var S=0;S<x;S++)y[l][u][S]=y[u][l][x-1-S]}o[0][0]=i[h],o[1][0]=y[i[h]][i[h+1]][1],o[1][1]=y[i[h]][i[h+2]][1];for(A=2;A<a;A++){o[A][0]=y[i[h]][i[h+1]][A],o[A][A]=y[i[h]][i[h+2]][A],p.x=(r[3*o[A][A]]-r[3*o[A][0]])/A,p.y=(r[3*o[A][A]+1]-r[3*o[A][0]+1])/A,p.z=(r[3*o[A][A]+2]-r[3*o[A][0]+2])/A,s&&(g.x=(s[3*o[A][A]]-s[3*o[A][0]])/A,g.y=(s[3*o[A][A]+1]-s[3*o[A][0]+1])/A,g.z=(s[3*o[A][A]+2]-s[3*o[A][0]+2])/A),n&&(_.x=(n[2*o[A][A]]-n[2*o[A][0]])/A,_.y=(n[2*o[A][A]+1]-n[2*o[A][0]+1])/A);for(B=1;B<A;B++)o[A][B]=r.length/3,r[I++]=r[3*o[A][0]]+B*p.x,r[I++]=r[3*o[A][0]+1]+B*p.y,r[I++]=r[3*o[A][0]+2]+B*p.z,s&&(s[D++]=s[3*o[A][0]]+B*g.x,s[D++]=s[3*o[A][0]+1]+B*g.y,s[D++]=s[3*o[A][0]+2]+B*g.z),n&&(n[M++]=n[2*o[A][0]]+B*_.x,n[M++]=n[2*o[A][0]+1]+B*_.y)}o[a]=y[i[h+1]][i[h+2]],v.push(o[0][0],o[1][0],o[1][1]);for(A=1;A<a;A++){B=void 0;for(B=0;B<A;B++)v.push(o[A][B],o[A+1][B],o[A+1][B+1]),v.push(o[A][B],o[A+1][B+1],o[A][B+1]);v.push(o[A][B],o[A+1][B],o[A+1][B+1])}}t.indices=v,t.applyToMesh(this,this.isVertexBufferUpdatable(d.o.PositionKind))}else b.Y.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")},t.prototype.forceSharedVertices=function(){var e=f.x.ExtractFromMesh(this),t=e.uvs,i=e.indices,r=e.positions,n=e.colors;if(void 0===i||void 0===r||null===i||null===r)b.Y.Warn("VertexData contains empty entries");else{for(var s=new Array,a=new Array,o=new Array,h=new Array,c=new Array,u=0,l={},p=void 0,g=void 0,_=0;_<i.length;_+=3){g=[i[_],i[_+1],i[_+2]],c=new Array;for(var v=0;v<3;v++){c[v]="";for(var m=0;m<3;m++)Math.abs(r[3*g[v]+m])<1e-8&&(r[3*g[v]+m]=0),c[v]+=r[3*g[v]+m]+"|"}if(c[0]!=c[1]&&c[0]!=c[2]&&c[1]!=c[2])for(v=0;v<3;v++){if(void 0===(p=l[c[v]])){l[c[v]]=u,p=u++;for(m=0;m<3;m++)s.push(r[3*g[v]+m]);if(null!=n)for(m=0;m<4;m++)h.push(n[4*g[v]+m]);if(null!=t)for(m=0;m<2;m++)o.push(t[2*g[v]+m])}a.push(p)}}var y=new Array;f.x.ComputeNormals(s,a,y),e.positions=s,e.indices=a,e.normals=y,null!=t&&(e.uvs=o),null!=n&&(e.colors=h),e.applyToMesh(this,this.isVertexBufferUpdatable(d.o.PositionKind))}},t._instancedMeshFactory=function(e,t){throw(0,M.S)("InstancedMesh")},t._PhysicsImpostorParser=function(e,t,i){throw(0,M.S)("PhysicsImpostor")},t.prototype.createInstance=function(e){return t._instancedMeshFactory(e,this)},t.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){this.instances[e]._syncSubMeshes()}return this},t.prototype.optimizeIndices=function(e){var t=this,i=this.getIndices(),r=this.getVerticesData(d.o.PositionKind);if(!r||!i)return this;for(var n=new Array,a=0;a<r.length;a+=3)n.push(c.P.FromArray(r,a));var o=new Array;return s.$g.SyncAsyncForLoop(n.length,40,(function(e){for(var t=n.length-1-e,i=n[t],r=0;r<t;++r){var s=n[r];if(i.equals(s)){o[t]=r;break}}}),(function(){for(var r=0;r<i.length;++r)i[r]=o[i[r]]||i[r];var n=t.subMeshes.slice(0);t.setIndices(i),t.subMeshes=n,e&&e(t)})),this},t.prototype.serialize=function(e){e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,e.type=this.getClassName(),o.$&&o.$.HasTags(this)&&(e.tags=o.$.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,e.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(e.parentId=this.parent.uniqueId),e.isUnIndexed=this.isUnIndexed;var t=this._geometry;if(t&&this.subMeshes){e.geometryUniqueId=t.uniqueId,e.geometryId=t.id,e.subMeshes=[];for(var i=0;i<this.subMeshes.length;i++){var r=this.subMeshes[i];e.subMeshes.push({materialIndex:r.materialIndex,verticesStart:r.verticesStart,verticesCount:r.verticesCount,indexStart:r.indexStart,indexCount:r.indexCount})}}(this.material?this.material.doNotSerialize||(e.materialUniqueId=this.material.uniqueId,e.materialId=this.material.id):(this.material=null,e.materialUniqueId=this._scene.defaultMaterial.uniqueId,e.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id,e.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(D.l.NAME_PHYSICSENGINE))&&((a=this.getPhysicsImpostor())&&(e.physicsMass=a.getParam("mass"),e.physicsFriction=a.getParam("friction"),e.physicsRestitution=a.getParam("mass"),e.physicsImpostor=a.type));this.metadata&&(e.metadata=this.metadata),e.instances=[];for(var n=0;n<this.instances.length;n++){var s=this.instances[n];if(!s.doNotSerialize){var a,h={name:s.name,id:s.id,isEnabled:s.isEnabled(!1),isVisible:s.isVisible,isPickable:s.isPickable,checkCollisions:s.checkCollisions,position:s.position.asArray(),scaling:s.scaling.asArray()};if(s.parent&&(h.parentId=s.parent.uniqueId),s.rotationQuaternion?h.rotationQuaternion=s.rotationQuaternion.asArray():s.rotation&&(h.rotation=s.rotation.asArray()),this.getScene()._getComponent(D.l.NAME_PHYSICSENGINE))(a=s.getPhysicsImpostor())&&(h.physicsMass=a.getParam("mass"),h.physicsFriction=a.getParam("friction"),h.physicsRestitution=a.getParam("mass"),h.physicsImpostor=a.type);s.metadata&&(h.metadata=s.metadata),e.instances.push(h),x.p4.AppendSerializedAnimations(s,h),h.ranges=s.serializeAnimationRanges()}}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(e.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){var c={data:{},sizes:{},strides:{}};for(var u in this._userThinInstanceBuffersStorage.data)c.data[u]=Array.from(this._userThinInstanceBuffersStorage.data[u]),c.sizes[u]=this._userThinInstanceBuffersStorage.sizes[u],c.strides[u]=this._userThinInstanceBuffersStorage.strides[u];e.thinInstances.userThinInstance=c}x.p4.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name))},t.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var e=this._internalAbstractMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return b.Y.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(e.isUsingTextureForTargets)return;for(var t=0;t<e.numInfluencers;t++){var i=e.getActiveTarget(t),r=i.getPositions();if(!r)return void b.Y.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(d.o.PositionKind+t,r,!1,3);var n=i.getNormals();n&&this.geometry.setVerticesData(d.o.NormalKind+t,n,!1,3);var s=i.getTangents();s&&this.geometry.setVerticesData(d.o.TangentKind+t,s,!1,3);var a=i.getUVs();a&&this.geometry.setVerticesData(d.o.UVKind+"_"+t,a,!1,2)}}else for(t=0;this.geometry.isVerticesDataPresent(d.o.PositionKind+t);)this.geometry.removeVerticesData(d.o.PositionKind+t),this.geometry.isVerticesDataPresent(d.o.NormalKind+t)&&this.geometry.removeVerticesData(d.o.NormalKind+t),this.geometry.isVerticesDataPresent(d.o.TangentKind+t)&&this.geometry.removeVerticesData(d.o.TangentKind+t),this.geometry.isVerticesDataPresent(d.o.UVKind+t)&&this.geometry.removeVerticesData(d.o.UVKind+"_"+t),t++}},t.Parse=function(e,i,r){var n;if((n=e.type&&"LinesMesh"===e.type?t._LinesMeshParser(e,i):e.type&&"GroundMesh"===e.type?t._GroundMeshParser(e,i):e.type&&"GoldbergMesh"===e.type?t._GoldbergMeshParser(e,i):new t(e.name,i)).id=e.id,o.$&&o.$.AddTagsTo(n,e.tags),n.position=c.P.FromArray(e.position),void 0!==e.metadata&&(n.metadata=e.metadata),e.rotationQuaternion?n.rotationQuaternion=c._f.FromArray(e.rotationQuaternion):e.rotation&&(n.rotation=c.P.FromArray(e.rotation)),n.scaling=c.P.FromArray(e.scaling),e.localMatrix?n.setPreTransformMatrix(c.y3.FromArray(e.localMatrix)):e.pivotMatrix&&n.setPivotMatrix(c.y3.FromArray(e.pivotMatrix)),n.setEnabled(e.isEnabled),n.isVisible=e.isVisible,n.infiniteDistance=e.infiniteDistance,n.showBoundingBox=e.showBoundingBox,n.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(n.applyFog=e.applyFog),void 0!==e.pickable&&(n.isPickable=e.pickable),void 0!==e.alphaIndex&&(n.alphaIndex=e.alphaIndex),n.receiveShadows=e.receiveShadows,n.billboardMode=e.billboardMode,void 0!==e.visibility&&(n.visibility=e.visibility),n.checkCollisions=e.checkCollisions,n.overrideMaterialSideOrientation=e.overrideMaterialSideOrientation,void 0!==e.isBlocker&&(n.isBlocker=e.isBlocker),n._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(n._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),void 0!==e.parentId&&(n._waitingParentId=e.parentId),void 0!==e.actions&&(n._waitingData.actions=e.actions),void 0!==e.overlayAlpha&&(n.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(n.overlayColor=u.Wo.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(n.renderOverlay=e.renderOverlay),n.isUnIndexed=!!e.isUnIndexed,n.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(n.delayLoadState=4,n.delayLoadingFile=r+e.delayLoadingFile,n.buildBoundingInfo(c.P.FromArray(e.boundingBoxMinimum),c.P.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(n._binaryInfo=e._binaryInfo),n._delayInfo=[],e.hasUVs&&n._delayInfo.push(d.o.UVKind),e.hasUVs2&&n._delayInfo.push(d.o.UV2Kind),e.hasUVs3&&n._delayInfo.push(d.o.UV3Kind),e.hasUVs4&&n._delayInfo.push(d.o.UV4Kind),e.hasUVs5&&n._delayInfo.push(d.o.UV5Kind),e.hasUVs6&&n._delayInfo.push(d.o.UV6Kind),e.hasColors&&n._delayInfo.push(d.o.ColorKind),e.hasMatricesIndices&&n._delayInfo.push(d.o.MatricesIndicesKind),e.hasMatricesWeights&&n._delayInfo.push(d.o.MatricesWeightsKind),n._delayLoadingFunction=p.Z._ImportGeometry,y.Z.ForceFullSceneLoadingForIncremental&&n._checkDelayState()):p.Z._ImportGeometry(e,n),e.materialUniqueId?n._waitingMaterialId=e.materialUniqueId:e.materialId&&(n._waitingMaterialId=e.materialId),e.morphTargetManagerId>-1&&(n.morphTargetManager=i.getMorphTargetManagerById(e.morphTargetManagerId)),void 0!==e.skeletonId&&null!==e.skeletonId&&(n.skeleton=i.getLastSkeletonById(e.skeletonId),e.numBoneInfluencers&&(n.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(var s=0;s<e.animations.length;s++){var a=e.animations[s];(_=(0,I.q)("BABYLON.Animation"))&&n.animations.push(_.Parse(a))}l.N.ParseAnimationRanges(n,e,i)}if(e.autoAnimate&&i.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?n.layerMask=Math.abs(parseInt(e.layerMask)):n.layerMask=268435455,e.physicsImpostor&&t._PhysicsImpostorParser(i,n,e),e.lodMeshIds&&(n._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(var h=0;h<e.instances.length;h++){var f=e.instances[h],g=n.createInstance(f.name);if(f.id&&(g.id=f.id),o.$&&(f.tags?o.$.AddTagsTo(g,f.tags):o.$.AddTagsTo(g,e.tags)),g.position=c.P.FromArray(f.position),void 0!==f.metadata&&(g.metadata=f.metadata),void 0!==f.parentId&&(g._waitingParentId=f.parentId),void 0!==f.isEnabled&&null!==f.isEnabled&&g.setEnabled(f.isEnabled),void 0!==f.isVisible&&null!==f.isVisible&&(g.isVisible=f.isVisible),void 0!==f.isPickable&&null!==f.isPickable&&(g.isPickable=f.isPickable),f.rotationQuaternion?g.rotationQuaternion=c._f.FromArray(f.rotationQuaternion):f.rotation&&(g.rotation=c.P.FromArray(f.rotation)),g.scaling=c.P.FromArray(f.scaling),null!=f.checkCollisions&&null!=f.checkCollisions&&(g.checkCollisions=f.checkCollisions),null!=f.pickable&&null!=f.pickable&&(g.isPickable=f.pickable),null!=f.showBoundingBox&&null!=f.showBoundingBox&&(g.showBoundingBox=f.showBoundingBox),null!=f.showSubMeshesBoundingBox&&null!=f.showSubMeshesBoundingBox&&(g.showSubMeshesBoundingBox=f.showSubMeshesBoundingBox),null!=f.alphaIndex&&null!=f.showSubMeshesBoundingBox&&(g.alphaIndex=f.alphaIndex),f.physicsImpostor&&t._PhysicsImpostorParser(i,g,f),f.animations){for(s=0;s<f.animations.length;s++){var _;a=f.animations[s];(_=(0,I.q)("BABYLON.Animation"))&&g.animations.push(_.Parse(a))}l.N.ParseAnimationRanges(g,f,i),f.autoAnimate&&i.beginAnimation(g,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1)}}if(e.thinInstances){var v=e.thinInstances;if(n.thinInstanceEnablePicking=!!v.enablePicking,v.matrixData?(n.thinInstanceSetBuffer("matrix",new Float32Array(v.matrixData),16,!1),n._thinInstanceDataStorage.matrixBufferSize=v.matrixBufferSize,n._thinInstanceDataStorage.instancesCount=v.instancesCount):n._thinInstanceDataStorage.matrixBufferSize=v.matrixBufferSize,e.thinInstances.userThinInstance){var m=e.thinInstances.userThinInstance;for(var x in m.data)n.thinInstanceSetBuffer(x,new Float32Array(m.data[x]),m.strides[x],!1),n._userThinInstanceBuffersStorage.sizes[x]=m.sizes[x]}}return n},t.prototype.setPositionsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourcePositions){var t=this.getVerticesData(d.o.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(d.o.PositionKind)||this.setVerticesData(d.o.PositionKind,t,!0)}return e._sourcePositions},t.prototype.setNormalsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourceNormals){var t=this.getVerticesData(d.o.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(d.o.NormalKind)||this.setVerticesData(d.o.NormalKind,t,!0)}return e._sourceNormals},t.prototype.applySkeleton=function(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(d.o.PositionKind))return this;if(!this.isVerticesDataPresent(d.o.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(d.o.MatricesWeightsKind))return this;var t=this.isVerticesDataPresent(d.o.NormalKind),i=this._internalMeshDataInfo;if(!i._sourcePositions){var r=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=r}t&&!i._sourceNormals&&this.setNormalsForCPUSkinning();var n=this.getVerticesData(d.o.PositionKind);if(!n)return this;n instanceof Float32Array||(n=new Float32Array(n));var s=this.getVerticesData(d.o.NormalKind);if(t){if(!s)return this;s instanceof Float32Array||(s=new Float32Array(s))}var a=this.getVerticesData(d.o.MatricesIndicesKind),o=this.getVerticesData(d.o.MatricesWeightsKind);if(!o||!a)return this;for(var h,u=this.numBoneInfluencers>4,l=u?this.getVerticesData(d.o.MatricesIndicesExtraKind):null,f=u?this.getVerticesData(d.o.MatricesWeightsExtraKind):null,p=e.getTransformMatrices(this),g=c.P.Zero(),_=new c.y3,v=new c.y3,m=0,y=0;y<n.length;y+=3,m+=4){var x=void 0;for(h=0;h<4;h++)(x=o[m+h])>0&&(c.y3.FromFloat32ArrayToRefScaled(p,Math.floor(16*a[m+h]),x,v),_.addToSelf(v));if(u)for(h=0;h<4;h++)(x=f[m+h])>0&&(c.y3.FromFloat32ArrayToRefScaled(p,Math.floor(16*l[m+h]),x,v),_.addToSelf(v));c.P.TransformCoordinatesFromFloatsToRef(i._sourcePositions[y],i._sourcePositions[y+1],i._sourcePositions[y+2],_,g),g.toArray(n,y),t&&(c.P.TransformNormalFromFloatsToRef(i._sourceNormals[y],i._sourceNormals[y+1],i._sourceNormals[y+2],_,g),g.toArray(s,y)),_.reset()}return this.updateVerticesData(d.o.PositionKind,n),t&&this.updateVerticesData(d.o.NormalKind,s),this},t.MinMax=function(e){var t=null,i=null;return e.forEach((function(e){var r=e.getBoundingInfo().boundingBox;t&&i?(t.minimizeInPlace(r.minimumWorld),i.maximizeInPlace(r.maximumWorld)):(t=r.minimumWorld,i=r.maximumWorld)})),t&&i?{min:t,max:i}:{min:c.P.Zero(),max:c.P.Zero()}},t.Center=function(e){var i=e instanceof Array?t.MinMax(e):e;return c.P.Center(i.min,i.max)},t.MergeMeshes=function(e,i,r,n,s,a){return void 0===i&&(i=!0),(0,h.s3)(t._MergeMeshesCoroutine(e,i,r,n,s,a,!1))},t.MergeMeshesAsync=function(e,i,r,n,s,a){return void 0===i&&(i=!0),(0,h.sM)(t._MergeMeshesCoroutine(e,i,r,n,s,a,!0),(0,h.KO)())},t._MergeMeshesCoroutine=function(e,i,n,s,a,o,h){var c,u,l,d,p,g,v,y,x,I,M,D,B,A,S,P,V,T,C,O,w,F,R,K,E,L;return void 0===i&&(i=!0),(0,r.Jh)(this,(function(r){switch(r.label){case 0:if(0===(e=e.filter(Boolean)).length)return[2,null];if(!n)for(u=0,c=0;c<e.length;c++)if((u+=e[c].getTotalVertices())>=65536)return b.Y.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),[2,null];for(o&&(a=!1),l=new Array,d=new Array,p=new Array,g=e[0].overrideMaterialSideOrientation,c=0;c<e.length;c++){if((v=e[c]).isAnInstance)return b.Y.Warn("Cannot merge instance meshes."),[2,null];if(g!==v.overrideMaterialSideOrientation)return b.Y.Warn("Cannot merge meshes with different overrideMaterialSideOrientation values."),[2,null];if(a&&p.push(v.getTotalIndices()),o)if(v.material)if((y=v.material)instanceof m.G){for(x=0;x<y.subMaterials.length;x++)l.indexOf(y.subMaterials[x])<0&&l.push(y.subMaterials[x]);for(L=0;L<v.subMeshes.length;L++)d.push(l.indexOf(y.subMaterials[v.subMeshes[L].materialIndex])),p.push(v.subMeshes[L].indexCount)}else for(l.indexOf(y)<0&&l.push(y),L=0;L<v.subMeshes.length;L++)d.push(l.indexOf(y)),p.push(v.subMeshes[L].indexCount);else for(L=0;L<v.subMeshes.length;L++)d.push(0),p.push(v.subMeshes[L].indexCount)}return I=e[0],M=function(e){var t=e.computeWorldMatrix(!0);return[f.x.ExtractFromMesh(e,!1,!1),t]},D=M(I),B=D[0],A=D[1],h?[4]:[3,2];case 1:r.sent(),r.label=2;case 2:S=new Array(e.length-1),P=1,r.label=3;case 3:return P<e.length?(S[P-1]=M(e[P]),h?[4]:[3,5]):[3,6];case 4:r.sent(),r.label=5;case 5:return P++,[3,3];case 6:V=B._mergeCoroutine(A,S,n,h,!i),T=V.next(),r.label=7;case 7:return T.done?[3,10]:h?[4]:[3,9];case 8:r.sent(),r.label=9;case 9:return T=V.next(),[3,7];case 10:C=T.value,s||(s=new t(I.name+"_merged",I.getScene())),O=C._applyToCoroutine(s,void 0,h),w=O.next(),r.label=11;case 11:return w.done?[3,14]:h?[4]:[3,13];case 12:r.sent(),r.label=13;case 13:return w=O.next(),[3,11];case 14:if(s.checkCollisions=I.checkCollisions,s.overrideMaterialSideOrientation=I.overrideMaterialSideOrientation,i)for(c=0;c<e.length;c++)e[c].dispose();if(a||o){for(s.releaseSubMeshes(),c=0,F=0;c<p.length;)_.P.CreateFromIndices(0,F,p[c],s,void 0,!1),F+=p[c],c++;for(R=0,K=s.subMeshes;R<K.length;R++)K[R].refreshBoundingInfo();s.computeWorldMatrix(!0)}if(o){for((E=new m.G(I.name+"_merged",I.getScene())).subMaterials=l,L=0;L<s.subMeshes.length;L++)s.subMeshes[L].materialIndex=d[L];s.material=E}else s.material=I.material;return[2,s]}}))},t.prototype.addInstance=function(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)},t.prototype.removeInstance=function(e){var t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){var i=this.instances[this.instances.length-1];this.instances[t]=i,i._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},t.prototype._shouldConvertRHS=function(){return this.overrideMaterialSideOrientation===v.F.CounterClockWiseSideOrientation},t.FRONTSIDE=f.x.FRONTSIDE,t.BACKSIDE=f.x.BACKSIDE,t.DOUBLESIDE=f.x.DOUBLESIDE,t.DEFAULTSIDE=f.x.DEFAULTSIDE,t.NO_CAP=0,t.CAP_START=1,t.CAP_END=2,t.CAP_ALL=3,t.NO_FLIP=0,t.FLIP_TILE=1,t.ROTATE_TILE=2,t.FLIP_ROW=3,t.ROTATE_ROW=4,t.FLIP_N_ROTATE_TILE=5,t.FLIP_N_ROTATE_ROW=6,t.CENTER=0,t.LEFT=1,t.RIGHT=2,t.TOP=3,t.BOTTOM=4,t.INSTANCEDMESH_SORT_TRANSPARENT=!1,t._GroundMeshParser=function(e,t){throw(0,M.S)("GroundMesh")},t._GoldbergMeshParser=function(e,t){throw(0,M.S)("GoldbergMesh")},t._LinesMeshParser=function(e,t){throw(0,M.S)("LinesMesh")},t}(g.x);(0,I.H)("BABYLON.Mesh",C),C.prototype.setMaterialByID=function(e){return this.setMaterialById(e)},C.CreateDisc=C.CreateDisc||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreateBox=C.CreateBox||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreateSphere=C.CreateSphere||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreateCylinder=C.CreateCylinder||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreateTorusKnot=C.CreateTorusKnot||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreateTorus=C.CreateTorus||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreatePlane=C.CreatePlane||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreateGround=C.CreateGround||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreateTiledGround=C.CreateTiledGround||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreateGroundFromHeightMap=C.CreateGroundFromHeightMap||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreateTube=C.CreateTube||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreatePolyhedron=C.CreatePolyhedron||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreateIcoSphere=C.CreateIcoSphere||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreateDecal=C.CreateDecal||function(){throw new Error("Import MeshBuilder to populate this function")},C.CreateCapsule=C.CreateCapsule||function(){throw new Error("Import MeshBuilder to populate this function")},C.ExtendToGoldberg=C.ExtendToGoldberg||function(){throw new Error("Import MeshBuilder to populate this function")}},89209:(e,t,i)=>{i.d(t,{x:()=>d});var r=i(31191),n=i(58095),s=i(72208),a=i(77851),o=i(15631),h=i(84318),c=i(96969),u=i(24539),l=i(46223),d=function(){function e(){this._applyTo=(0,u.vp)(this._applyToCoroutine.bind(this))}return e.prototype.set=function(e,t){switch(e.length||h.Y.Warn("Setting vertex data kind '".concat(t,"' with an empty array")),t){case s.o.PositionKind:this.positions=e;break;case s.o.NormalKind:this.normals=e;break;case s.o.TangentKind:this.tangents=e;break;case s.o.UVKind:this.uvs=e;break;case s.o.UV2Kind:this.uvs2=e;break;case s.o.UV3Kind:this.uvs3=e;break;case s.o.UV4Kind:this.uvs4=e;break;case s.o.UV5Kind:this.uvs5=e;break;case s.o.UV6Kind:this.uvs6=e;break;case s.o.ColorKind:this.colors=e;break;case s.o.MatricesIndicesKind:this.matricesIndices=e;break;case s.o.MatricesWeightsKind:this.matricesWeights=e;break;case s.o.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case s.o.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}},e.prototype.applyToMesh=function(e,t){return this._applyTo(e,t,!1),this},e.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t,!1),this},e.prototype.updateMesh=function(e){return this._update(e),this},e.prototype.updateGeometry=function(e){return this._update(e),this},e.prototype._applyToCoroutine=function(e,t,i){return void 0===t&&(t=!1),(0,r.Jh)(this,(function(r){switch(r.label){case 0:return this.positions?(e.setVerticesData(s.o.PositionKind,this.positions,t),i?[4]:[3,2]):[3,2];case 1:r.sent(),r.label=2;case 2:return this.normals?(e.setVerticesData(s.o.NormalKind,this.normals,t),i?[4]:[3,4]):[3,4];case 3:r.sent(),r.label=4;case 4:return this.tangents?(e.setVerticesData(s.o.TangentKind,this.tangents,t),i?[4]:[3,6]):[3,6];case 5:r.sent(),r.label=6;case 6:return this.uvs?(e.setVerticesData(s.o.UVKind,this.uvs,t),i?[4]:[3,8]):[3,8];case 7:r.sent(),r.label=8;case 8:return this.uvs2?(e.setVerticesData(s.o.UV2Kind,this.uvs2,t),i?[4]:[3,10]):[3,10];case 9:r.sent(),r.label=10;case 10:return this.uvs3?(e.setVerticesData(s.o.UV3Kind,this.uvs3,t),i?[4]:[3,12]):[3,12];case 11:r.sent(),r.label=12;case 12:return this.uvs4?(e.setVerticesData(s.o.UV4Kind,this.uvs4,t),i?[4]:[3,14]):[3,14];case 13:r.sent(),r.label=14;case 14:return this.uvs5?(e.setVerticesData(s.o.UV5Kind,this.uvs5,t),i?[4]:[3,16]):[3,16];case 15:r.sent(),r.label=16;case 16:return this.uvs6?(e.setVerticesData(s.o.UV6Kind,this.uvs6,t),i?[4]:[3,18]):[3,18];case 17:r.sent(),r.label=18;case 18:return this.colors?(e.setVerticesData(s.o.ColorKind,this.colors,t),i?[4]:[3,20]):[3,20];case 19:r.sent(),r.label=20;case 20:return this.matricesIndices?(e.setVerticesData(s.o.MatricesIndicesKind,this.matricesIndices,t),i?[4]:[3,22]):[3,22];case 21:r.sent(),r.label=22;case 22:return this.matricesWeights?(e.setVerticesData(s.o.MatricesWeightsKind,this.matricesWeights,t),i?[4]:[3,24]):[3,24];case 23:r.sent(),r.label=24;case 24:return this.matricesIndicesExtra?(e.setVerticesData(s.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),i?[4]:[3,26]):[3,26];case 25:r.sent(),r.label=26;case 26:return this.matricesWeightsExtra?(e.setVerticesData(s.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),i?[4]:[3,28]):[3,28];case 27:r.sent(),r.label=28;case 28:return this.indices?(e.setIndices(this.indices,null,t),i?[4]:[3,30]):[3,31];case 29:r.sent(),r.label=30;case 30:return[3,32];case 31:e.setIndices([],null),r.label=32;case 32:return[2,this]}}))},e.prototype._update=function(e,t,i){return this.positions&&e.updateVerticesData(s.o.PositionKind,this.positions,t,i),this.normals&&e.updateVerticesData(s.o.NormalKind,this.normals,t,i),this.tangents&&e.updateVerticesData(s.o.TangentKind,this.tangents,t,i),this.uvs&&e.updateVerticesData(s.o.UVKind,this.uvs,t,i),this.uvs2&&e.updateVerticesData(s.o.UV2Kind,this.uvs2,t,i),this.uvs3&&e.updateVerticesData(s.o.UV3Kind,this.uvs3,t,i),this.uvs4&&e.updateVerticesData(s.o.UV4Kind,this.uvs4,t,i),this.uvs5&&e.updateVerticesData(s.o.UV5Kind,this.uvs5,t,i),this.uvs6&&e.updateVerticesData(s.o.UV6Kind,this.uvs6,t,i),this.colors&&e.updateVerticesData(s.o.ColorKind,this.colors,t,i),this.matricesIndices&&e.updateVerticesData(s.o.MatricesIndicesKind,this.matricesIndices,t,i),this.matricesWeights&&e.updateVerticesData(s.o.MatricesWeightsKind,this.matricesWeights,t,i),this.matricesIndicesExtra&&e.updateVerticesData(s.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,i),this.matricesWeightsExtra&&e.updateVerticesData(s.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,i),this.indices&&e.setIndices(this.indices,null),this},e._TransformVector3Coordinates=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=e.length);for(var s=n.jp.Vector3[0],a=n.jp.Vector3[1],o=i;o<i+r;o+=3)n.P.FromArrayToRef(e,o,s),n.P.TransformCoordinatesToRef(s,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z},e._TransformVector3Normals=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=e.length);for(var s=n.jp.Vector3[0],a=n.jp.Vector3[1],o=i;o<i+r;o+=3)n.P.FromArrayToRef(e,o,s),n.P.TransformNormalToRef(s,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z},e._TransformVector4Normals=function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=e.length);for(var s=n.jp.Vector4[0],a=n.jp.Vector4[1],o=i;o<i+r;o+=4)n.Lt.FromArrayToRef(e,o,s),n.Lt.TransformNormalToRef(s,t,a),e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z,e[o+3]=a.w},e._FlipFaces=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=e.length);for(var r=t;r<t+i;r+=3){var n=e[r+1];e[r+1]=e[r+2],e[r+2]=n}},e.prototype.transform=function(t){var i=t.determinant()<0;return this.positions&&e._TransformVector3Coordinates(this.positions,t),this.normals&&e._TransformVector3Normals(this.normals,t),this.tangents&&e._TransformVector4Normals(this.tangents,t),i&&this.indices&&e._FlipFaces(this.indices),this},e.prototype.merge=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1);var r=Array.isArray(e)?e.map((function(e){return[e,void 0]})):[[e,void 0]];return(0,u.s3)(this._mergeCoroutine(void 0,r,t,!1,i))},e.prototype._mergeCoroutine=function(t,i,n,a,o){var h,c,u,l,d,f,p,g,_,v,m,y,x,b,I,M,D,B,A,S=this;return void 0===n&&(n=!1),(0,r.Jh)(this,(function(r){switch(r.label){case 0:for(this._validate(),h=i.map((function(e){return e[0]})),c=0,u=h;c<u.length;c++)if((x=u[c])._validate(),!this.normals!=!x.normals||!this.tangents!=!x.tangents||!this.uvs!=!x.uvs||!this.uvs2!=!x.uvs2||!this.uvs3!=!x.uvs3||!this.uvs4!=!x.uvs4||!this.uvs5!=!x.uvs5||!this.uvs6!=!x.uvs6||!this.colors!=!x.colors||!this.matricesIndices!=!x.matricesIndices||!this.matricesWeights!=!x.matricesWeights||!this.matricesIndicesExtra!=!x.matricesIndicesExtra||!this.matricesWeightsExtra!=!x.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(l=h.reduce((function(e,t){var i,r;return e+(null!==(r=null===(i=t.indices)||void 0===i?void 0:i.length)&&void 0!==r?r:0)}),null!==(D=null===(M=this.indices)||void 0===M?void 0:M.length)&&void 0!==D?D:0),d=o||h.some((function(e){return e.indices===S.indices})),f=d?null===(B=this.indices)||void 0===B?void 0:B.slice():this.indices,!(l>0))return[3,4];p=null!==(A=null==f?void 0:f.length)&&void 0!==A?A:0,f||(f=new Array(l)),f.length!==l&&(Array.isArray(f)?f.length=l:((g=n||f instanceof Uint32Array?new Uint32Array(l):new Uint16Array(l)).set(f),f=g),t&&t.determinant()<0&&e._FlipFaces(f,0,p)),_=this.positions?this.positions.length/3:0,v=0,m=i,r.label=1;case 1:if(!(v<m.length))return[3,4];if(y=m[v],x=y[0],b=y[1],!x.indices)return[3,3];for(I=0;I<x.indices.length;I++)f[p+I]=x.indices[I]+_;return b&&b.determinant()<0&&e._FlipFaces(f,p,x.indices.length),_+=x.positions.length/3,p+=x.indices.length,a?[4]:[3,3];case 2:r.sent(),r.label=3;case 3:return v++,[3,1];case 4:return this.indices=f,this.positions=e._MergeElement(s.o.PositionKind,this.positions,t,i.map((function(e){return[e[0].positions,e[1]]}))),a?[4]:[3,6];case 5:r.sent(),r.label=6;case 6:return this.normals=e._MergeElement(s.o.NormalKind,this.normals,t,i.map((function(e){return[e[0].normals,e[1]]}))),a?[4]:[3,8];case 7:r.sent(),r.label=8;case 8:return this.tangents=e._MergeElement(s.o.TangentKind,this.tangents,t,i.map((function(e){return[e[0].tangents,e[1]]}))),a?[4]:[3,10];case 9:r.sent(),r.label=10;case 10:return this.uvs=e._MergeElement(s.o.UVKind,this.uvs,t,i.map((function(e){return[e[0].uvs,e[1]]}))),a?[4]:[3,12];case 11:r.sent(),r.label=12;case 12:return this.uvs2=e._MergeElement(s.o.UV2Kind,this.uvs2,t,i.map((function(e){return[e[0].uvs2,e[1]]}))),a?[4]:[3,14];case 13:r.sent(),r.label=14;case 14:return this.uvs3=e._MergeElement(s.o.UV3Kind,this.uvs3,t,i.map((function(e){return[e[0].uvs3,e[1]]}))),a?[4]:[3,16];case 15:r.sent(),r.label=16;case 16:return this.uvs4=e._MergeElement(s.o.UV4Kind,this.uvs4,t,i.map((function(e){return[e[0].uvs4,e[1]]}))),a?[4]:[3,18];case 17:r.sent(),r.label=18;case 18:return this.uvs5=e._MergeElement(s.o.UV5Kind,this.uvs5,t,i.map((function(e){return[e[0].uvs5,e[1]]}))),a?[4]:[3,20];case 19:r.sent(),r.label=20;case 20:return this.uvs6=e._MergeElement(s.o.UV6Kind,this.uvs6,t,i.map((function(e){return[e[0].uvs6,e[1]]}))),a?[4]:[3,22];case 21:r.sent(),r.label=22;case 22:return this.colors=e._MergeElement(s.o.ColorKind,this.colors,t,i.map((function(e){return[e[0].colors,e[1]]}))),a?[4]:[3,24];case 23:r.sent(),r.label=24;case 24:return this.matricesIndices=e._MergeElement(s.o.MatricesIndicesKind,this.matricesIndices,t,i.map((function(e){return[e[0].matricesIndices,e[1]]}))),a?[4]:[3,26];case 25:r.sent(),r.label=26;case 26:return this.matricesWeights=e._MergeElement(s.o.MatricesWeightsKind,this.matricesWeights,t,i.map((function(e){return[e[0].matricesWeights,e[1]]}))),a?[4]:[3,28];case 27:r.sent(),r.label=28;case 28:return this.matricesIndicesExtra=e._MergeElement(s.o.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,i.map((function(e){return[e[0].matricesIndicesExtra,e[1]]}))),a?[4]:[3,30];case 29:r.sent(),r.label=30;case 30:return this.matricesWeightsExtra=e._MergeElement(s.o.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,i.map((function(e){return[e[0].matricesWeightsExtra,e[1]]}))),[2,this]}}))},e._MergeElement=function(t,i,r,n){var a=n.filter((function(e){return null!==e[0]&&void 0!==e[0]}));if(!i&&0==a.length)return i;if(!i)return this._MergeElement(t,a[0][0],a[0][1],a.slice(1));var o=a.reduce((function(e,t){return e+t[0].length}),i.length),h=t===s.o.PositionKind?e._TransformVector3Coordinates:t===s.o.NormalKind?e._TransformVector3Normals:t===s.o.TangentKind?e._TransformVector4Normals:function(){};if(i instanceof Float32Array){var c=new Float32Array(o);c.set(i),r&&h(c,r,0,i.length);for(var u=i.length,l=0,d=a;l<d.length;l++){var f=d[l],p=f[0],g=f[1];c.set(p,u),g&&h(c,g,u,p.length),u+=p.length}return c}for(var _=new Array(o),v=0;v<i.length;v++)_[v]=i[v];r&&h(_,r,0,i.length);u=i.length;for(var m=0,y=a;m<y.length;m++){var x=y[m],b=(p=x[0],x[1]);for(v=0;v<p.length;v++)_[u+v]=p[v];b&&h(_,b,u,p.length),u+=p.length}return _},e.prototype._validate=function(){if(!this.positions)throw new l.LH("Positions are required",l.SM.MeshInvalidPositionsError);var e=function(e,t){var i=s.o.DeduceStride(e);if(t.length%i!=0)throw new Error("The "+e+"s array count must be a multiple of "+i);return t.length/i},t=e(s.o.PositionKind,this.positions),i=function(i,r){var n=e(i,r);if(n!==t)throw new Error("The "+i+"s element count ("+n+") does not match the positions count ("+t+")")};this.normals&&i(s.o.NormalKind,this.normals),this.tangents&&i(s.o.TangentKind,this.tangents),this.uvs&&i(s.o.UVKind,this.uvs),this.uvs2&&i(s.o.UV2Kind,this.uvs2),this.uvs3&&i(s.o.UV3Kind,this.uvs3),this.uvs4&&i(s.o.UV4Kind,this.uvs4),this.uvs5&&i(s.o.UV5Kind,this.uvs5),this.uvs6&&i(s.o.UV6Kind,this.uvs6),this.colors&&i(s.o.ColorKind,this.colors),this.matricesIndices&&i(s.o.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&i(s.o.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&i(s.o.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&i(s.o.MatricesWeightsExtraKind,this.matricesWeightsExtra)},e.prototype.serialize=function(){var e={};return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},e.ExtractFromMesh=function(t,i,r){return e._ExtractFrom(t,i,r)},e.ExtractFromGeometry=function(t,i,r){return e._ExtractFrom(t,i,r)},e._ExtractFrom=function(t,i,r){var n=new e;return t.isVerticesDataPresent(s.o.PositionKind)&&(n.positions=t.getVerticesData(s.o.PositionKind,i,r)),t.isVerticesDataPresent(s.o.NormalKind)&&(n.normals=t.getVerticesData(s.o.NormalKind,i,r)),t.isVerticesDataPresent(s.o.TangentKind)&&(n.tangents=t.getVerticesData(s.o.TangentKind,i,r)),t.isVerticesDataPresent(s.o.UVKind)&&(n.uvs=t.getVerticesData(s.o.UVKind,i,r)),t.isVerticesDataPresent(s.o.UV2Kind)&&(n.uvs2=t.getVerticesData(s.o.UV2Kind,i,r)),t.isVerticesDataPresent(s.o.UV3Kind)&&(n.uvs3=t.getVerticesData(s.o.UV3Kind,i,r)),t.isVerticesDataPresent(s.o.UV4Kind)&&(n.uvs4=t.getVerticesData(s.o.UV4Kind,i,r)),t.isVerticesDataPresent(s.o.UV5Kind)&&(n.uvs5=t.getVerticesData(s.o.UV5Kind,i,r)),t.isVerticesDataPresent(s.o.UV6Kind)&&(n.uvs6=t.getVerticesData(s.o.UV6Kind,i,r)),t.isVerticesDataPresent(s.o.ColorKind)&&(n.colors=t.getVerticesData(s.o.ColorKind,i,r)),t.isVerticesDataPresent(s.o.MatricesIndicesKind)&&(n.matricesIndices=t.getVerticesData(s.o.MatricesIndicesKind,i,r)),t.isVerticesDataPresent(s.o.MatricesWeightsKind)&&(n.matricesWeights=t.getVerticesData(s.o.MatricesWeightsKind,i,r)),t.isVerticesDataPresent(s.o.MatricesIndicesExtraKind)&&(n.matricesIndicesExtra=t.getVerticesData(s.o.MatricesIndicesExtraKind,i,r)),t.isVerticesDataPresent(s.o.MatricesWeightsExtraKind)&&(n.matricesWeightsExtra=t.getVerticesData(s.o.MatricesWeightsExtraKind,i,r)),n.indices=t.getIndices(i,r),n},e.CreateRibbon=function(e){throw(0,a.S)("ribbonBuilder")},e.CreateBox=function(e){throw(0,a.S)("boxBuilder")},e.CreateTiledBox=function(e){throw(0,a.S)("tiledBoxBuilder")},e.CreateTiledPlane=function(e){throw(0,a.S)("tiledPlaneBuilder")},e.CreateSphere=function(e){throw(0,a.S)("sphereBuilder")},e.CreateCylinder=function(e){throw(0,a.S)("cylinderBuilder")},e.CreateTorus=function(e){throw(0,a.S)("torusBuilder")},e.CreateLineSystem=function(e){throw(0,a.S)("linesBuilder")},e.CreateDashedLines=function(e){throw(0,a.S)("linesBuilder")},e.CreateGround=function(e){throw(0,a.S)("groundBuilder")},e.CreateTiledGround=function(e){throw(0,a.S)("groundBuilder")},e.CreateGroundFromHeightMap=function(e){throw(0,a.S)("groundBuilder")},e.CreatePlane=function(e){throw(0,a.S)("planeBuilder")},e.CreateDisc=function(e){throw(0,a.S)("discBuilder")},e.CreatePolygon=function(e,t,i,r,n,s,o){throw(0,a.S)("polygonBuilder")},e.CreateIcoSphere=function(e){throw(0,a.S)("icoSphereBuilder")},e.CreatePolyhedron=function(e){throw(0,a.S)("polyhedronBuilder")},e.CreateCapsule=function(e){throw void 0===e&&(e={orientation:n.P.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),(0,a.S)("capsuleBuilder")},e.CreateTorusKnot=function(e){throw(0,a.S)("torusKnotBuilder")},e.ComputeNormals=function(e,t,i,r){var s=0,a=0,o=0,h=0,c=0,u=0,l=0,d=0,f=0,p=0,g=0,_=0,v=0,m=0,y=0,x=0,b=0,I=0,M=0,D=0,B=!1,A=!1,S=!1,P=!1,V=1,T=0,C=null;r&&(B=!!r.facetNormals,A=!!r.facetPositions,S=!!r.facetPartitioning,V=!0===r.useRightHandedSystem?-1:1,T=r.ratio||0,P=!!r.depthSort,C=r.distanceTo,P&&void 0===C&&(C=n.P.Zero()));var O=0,w=0,F=0,R=0;for(S&&r&&r.bbSize&&(O=r.subDiv.X*T/r.bbSize.x,w=r.subDiv.Y*T/r.bbSize.y,F=r.subDiv.Z*T/r.bbSize.z,R=r.subDiv.max*r.subDiv.max,r.facetPartitioning.length=0),s=0;s<e.length;s++)i[s]=0;var K=t.length/3|0;for(s=0;s<K;s++){if(v=(_=3*t[3*s])+1,m=_+2,x=(y=3*t[3*s+1])+1,b=y+2,M=(I=3*t[3*s+2])+1,D=I+2,a=e[_]-e[y],o=e[v]-e[x],h=e[m]-e[b],c=e[I]-e[y],u=e[M]-e[x],d=V*(o*(l=e[D]-e[b])-h*u),f=V*(h*c-a*l),p=V*(a*u-o*c),d/=g=0===(g=Math.sqrt(d*d+f*f+p*p))?1:g,f/=g,p/=g,B&&r&&(r.facetNormals[s].x=d,r.facetNormals[s].y=f,r.facetNormals[s].z=p),A&&r&&(r.facetPositions[s].x=(e[_]+e[y]+e[I])/3,r.facetPositions[s].y=(e[v]+e[x]+e[M])/3,r.facetPositions[s].z=(e[m]+e[b]+e[D])/3),S&&r){var E=Math.floor((r.facetPositions[s].x-r.bInfo.minimum.x*T)*O),L=Math.floor((r.facetPositions[s].y-r.bInfo.minimum.y*T)*w),W=Math.floor((r.facetPositions[s].z-r.bInfo.minimum.z*T)*F),U=Math.floor((e[_]-r.bInfo.minimum.x*T)*O),N=Math.floor((e[v]-r.bInfo.minimum.y*T)*w),j=Math.floor((e[m]-r.bInfo.minimum.z*T)*F),z=Math.floor((e[y]-r.bInfo.minimum.x*T)*O),k=Math.floor((e[x]-r.bInfo.minimum.y*T)*w),Q=Math.floor((e[b]-r.bInfo.minimum.z*T)*F),G=Math.floor((e[I]-r.bInfo.minimum.x*T)*O),Z=Math.floor((e[M]-r.bInfo.minimum.y*T)*w),Y=Math.floor((e[D]-r.bInfo.minimum.z*T)*F),q=U+r.subDiv.max*N+R*j,H=z+r.subDiv.max*k+R*Q,X=G+r.subDiv.max*Z+R*Y,$=E+r.subDiv.max*L+R*W;r.facetPartitioning[$]=r.facetPartitioning[$]?r.facetPartitioning[$]:new Array,r.facetPartitioning[q]=r.facetPartitioning[q]?r.facetPartitioning[q]:new Array,r.facetPartitioning[H]=r.facetPartitioning[H]?r.facetPartitioning[H]:new Array,r.facetPartitioning[X]=r.facetPartitioning[X]?r.facetPartitioning[X]:new Array,r.facetPartitioning[q].push(s),H!=q&&r.facetPartitioning[H].push(s),X!=H&&X!=q&&r.facetPartitioning[X].push(s),$!=q&&$!=H&&$!=X&&r.facetPartitioning[$].push(s)}if(P&&r&&r.facetPositions){var J=r.depthSortedFacets[s];J.ind=3*s,J.sqDistance=n.P.DistanceSquared(r.facetPositions[s],C)}i[_]+=d,i[v]+=f,i[m]+=p,i[y]+=d,i[x]+=f,i[b]+=p,i[I]+=d,i[M]+=f,i[D]+=p}for(s=0;s<i.length/3;s++)d=i[3*s],f=i[3*s+1],p=i[3*s+2],d/=g=0===(g=Math.sqrt(d*d+f*f+p*p))?1:g,f/=g,p/=g,i[3*s]=d,i[3*s+1]=f,i[3*s+2]=p},e._ComputeSides=function(t,i,r,s,a,o,h){var c,u,l=r.length,d=s.length;switch(t=t||e.DEFAULTSIDE){case e.FRONTSIDE:break;case e.BACKSIDE:for(c=0;c<l;c+=3){var f=r[c];r[c]=r[c+2],r[c+2]=f}for(u=0;u<d;u++)s[u]=-s[u];break;case e.DOUBLESIDE:for(var p=i.length,g=p/3,_=0;_<p;_++)i[p+_]=i[_];for(c=0;c<l;c+=3)r[c+l]=r[c+2]+g,r[c+1+l]=r[c+1]+g,r[c+2+l]=r[c]+g;for(u=0;u<d;u++)s[d+u]=-s[u];var v=a.length,m=0;for(m=0;m<v;m++)a[m+v]=a[m];for(o=o||new n.Lt(0,0,1,1),h=h||new n.Lt(0,0,1,1),m=0,c=0;c<v/2;c++)a[m]=o.x+(o.z-o.x)*a[m],a[m+1]=o.y+(o.w-o.y)*a[m+1],a[m+v]=h.x+(h.z-h.x)*a[m+v],a[m+v+1]=h.y+(h.w-h.y)*a[m+v+1],m+=2}},e.ImportVertexData=function(t,i){var r=new e,n=t.positions;n&&r.set(n,s.o.PositionKind);var a=t.normals;a&&r.set(a,s.o.NormalKind);var h=t.tangents;h&&r.set(h,s.o.TangentKind);var c=t.uvs;c&&r.set(c,s.o.UVKind);var u=t.uv2s;u&&r.set(u,s.o.UV2Kind);var l=t.uv3s;l&&r.set(l,s.o.UV3Kind);var d=t.uv4s;d&&r.set(d,s.o.UV4Kind);var f=t.uv5s;f&&r.set(f,s.o.UV5Kind);var p=t.uv6s;p&&r.set(p,s.o.UV6Kind);var g=t.colors;g&&r.set(o.HE.CheckColors4(g,n.length/3),s.o.ColorKind);var _=t.matricesIndices;_&&r.set(_,s.o.MatricesIndicesKind);var v=t.matricesWeights;v&&r.set(v,s.o.MatricesWeightsKind);var m=t.indices;m&&(r.indices=m),i.setAllVerticesData(r,t.updatable)},e.FRONTSIDE=0,e.BACKSIDE=1,e.DOUBLESIDE=2,e.DEFAULTSIDE=0,(0,r.gn)([c.G6.filter((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[0];return!Array.isArray(i)}))],e,"_TransformVector3Coordinates",null),(0,r.gn)([c.G6.filter((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[0];return!Array.isArray(i)}))],e,"_TransformVector3Normals",null),(0,r.gn)([c.G6.filter((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[0];return!Array.isArray(i)}))],e,"_TransformVector4Normals",null),(0,r.gn)([c.G6.filter((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[0];return!Array.isArray(i)}))],e,"_FlipFaces",null),e}()},62659:(e,t,i)=>{i.d(t,{g:()=>r});var r=function(e,t){this.distanceOrScreenCoverage=e,this.mesh=t}},86230:(e,t,i)=>{i.d(t,{m:()=>p,z:()=>g});var r=i(31191),n=i(84318),s=i(58095),a=i(72208),o=i(91243),h=i(89209),c=i(74742),u=i(48154),l=i(15210),d=function(e){function t(t,i){var r=e.call(this,t.x,t.y)||this;return r.index=i,r}return(0,r.ZT)(t,e),t}(s.FM),f=function(){function e(){this.elements=new Array}return e.prototype.add=function(e){var t=this,i=new Array;return e.forEach((function(e){var r=new d(e,t.elements.length);i.push(r),t.elements.push(r)})),i},e.prototype.computeBounds=function(){var e=new s.FM(this.elements[0].x,this.elements[0].y),t=new s.FM(this.elements[0].x,this.elements[0].y);return this.elements.forEach((function(i){i.x<e.x?e.x=i.x:i.x>t.x&&(t.x=i.x),i.y<e.y?e.y=i.y:i.y>t.y&&(t.y=i.y)})),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}},e}(),p=function(){function e(){}return e.Rectangle=function(e,t,i,r){return[new s.FM(e,t),new s.FM(i,t),new s.FM(i,r),new s.FM(e,r)]},e.Circle=function(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=32);for(var n=new Array,a=0,o=2*Math.PI/r,h=0;h<r;h++)n.push(new s.FM(t+Math.cos(a)*e,i+Math.sin(a)*e)),a-=o;return n},e.Parse=function(e){var t,i=e.split(/[^-+eE.\d]+/).map(parseFloat).filter((function(e){return!isNaN(e)})),r=[];for(t=0;t<(2147483646&i.length);t+=2)r.push(new s.FM(i[t],i[t+1]));return r},e.StartingAt=function(e,t){return c.ZZ.StartingAt(e,t)},e}(),g=function(){function e(e,t,i,r){var s;void 0===r&&(r=earcut),this._points=new f,this._outlinepoints=new f,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=r,this._name=e,this._scene=i||l.l.LastCreatedScene,s=t instanceof c.ZZ?t.getPoints():t,this._addToepoint(s),this._points.add(s),this._outlinepoints.add(s),void 0===this.bjsEarcut&&n.Y.Warn("Earcut was not found, the polygon will not be built.")}return e.prototype._addToepoint=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];this._epoints.push(r.x,r.y)}},e.prototype.addHole=function(e){this._points.add(e);var t=new f;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this},e.prototype.build=function(e,t,i){void 0===e&&(e=!1),void 0===t&&(t=0),void 0===i&&(i=2);var r=new o.Kj(this._name,this._scene),n=this.buildVertexData(t,i);return r.setVerticesData(a.o.PositionKind,n.positions,e),r.setVerticesData(a.o.NormalKind,n.normals,e),r.setVerticesData(a.o.UVKind,n.uvs,e),r.setIndices(n.indices),r},e.prototype.buildVertexData=function(e,t){var i=this;void 0===e&&(e=0),void 0===t&&(t=2);var r=new h.x,n=new Array,s=new Array,a=new Array,o=this._points.computeBounds();this._points.elements.forEach((function(e){n.push(0,1,0),s.push(e.x,0,e.y),a.push((e.x-o.min.x)/o.width,(e.y-o.min.y)/o.height)}));for(var c=new Array,u=this.bjsEarcut(this._epoints,this._eholes,2),l=0;l<u.length;l++)c.push(u[l]);if(e>0){var d=s.length/3;this._points.elements.forEach((function(t){n.push(0,-1,0),s.push(t.x,-e,t.y),a.push(1-(t.x-o.min.x)/o.width,1-(t.y-o.min.y)/o.height)}));var f=c.length;for(l=0;l<f;l+=3){var p=c[l+0],g=c[l+1],_=c[l+2];c.push(_+d),c.push(g+d),c.push(p+d)}this._addSide(s,n,a,c,o,this._outlinepoints,e,!1,t),this._holes.forEach((function(r){i._addSide(s,n,a,c,o,r,e,!0,t)}))}return r.indices=c,r.positions=s,r.normals=n,r.uvs=a,r},e.prototype._addSide=function(e,t,i,r,n,a,o,h,c){for(var l=e.length/3,d=0,f=0;f<a.elements.length;f++){var p=a.elements[f],g=a.elements[(f+1)%a.elements.length];e.push(p.x,0,p.y),e.push(p.x,-o,p.y),e.push(g.x,0,g.y),e.push(g.x,-o,g.y);var _=a.elements[(f+a.elements.length-1)%a.elements.length],v=a.elements[(f+2)%a.elements.length],m=new s.P(-(g.y-p.y),0,g.x-p.x),y=new s.P(-(p.y-_.y),0,p.x-_.x),x=new s.P(-(v.y-g.y),0,v.x-g.x);h||(m=m.scale(-1),y=y.scale(-1),x=x.scale(-1));var b=m.normalizeToNew(),I=y.normalizeToNew(),M=x.normalizeToNew(),D=s.P.Dot(I,b);I=D>c?D<u.kn-1?new s.P(p.x,0,p.y).subtract(new s.P(g.x,0,g.y)).normalize():y.add(m).normalize():b;var B=s.P.Dot(x,m);M=B>c?B<u.kn-1?new s.P(g.x,0,g.y).subtract(new s.P(p.x,0,p.y)).normalize():x.add(m).normalize():b,i.push(d/n.width,0),i.push(d/n.width,1),d+=m.length(),i.push(d/n.width,0),i.push(d/n.width,1),t.push(I.x,I.y,I.z),t.push(I.x,I.y,I.z),t.push(M.x,M.y,M.z),t.push(M.x,M.y,M.z),h?(r.push(l),r.push(l+2),r.push(l+1),r.push(l+1),r.push(l+2),r.push(l+3)):(r.push(l),r.push(l+1),r.push(l+2),r.push(l+1),r.push(l+3),r.push(l+2)),l+=4}},e}()},68345:(e,t,i)=>{i.d(t,{P:()=>h});var r=i(72208),n=i(94184),s=i(91859),a=i(93701),o=i(67759),h=function(){function e(e,t,i,r,n,s,a,o,h){void 0===o&&(o=!0),void 0===h&&(h=!0),this.materialIndex=e,this.verticesStart=t,this.verticesCount=i,this.indexStart=r,this.indexCount=n,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=s,this._renderingMesh=a||s,h&&s.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=s.subMeshes.length-1,o&&(this.refreshBoundingInfo(),s.computeWorldMatrix(!0))}return Object.defineProperty(e.prototype,"materialDefines",{get:function(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(e=this._getDrawWrapper())||void 0===e?void 0:e.defines},set:function(e){var t;(null!==(t=this._mainDrawWrapperOverride)&&void 0!==t?t:this._getDrawWrapper(void 0,!0)).defines=e},enumerable:!1,configurable:!0}),e.prototype._getDrawWrapper=function(e,t){void 0===t&&(t=!1),e=null!=e?e:this._engine.currentRenderPassId;var i=this._drawWrappers[e];return!i&&t&&(this._drawWrappers[e]=i=new o.q(this._mesh.getScene().getEngine())),i},e.prototype._removeDrawWrapper=function(e,t){var i;void 0===t&&(t=!0),t&&(null===(i=this._drawWrappers[e])||void 0===i||i.dispose()),this._drawWrappers[e]=void 0},Object.defineProperty(e.prototype,"effect",{get:function(){var e,t;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:null!==(t=null===(e=this._getDrawWrapper())||void 0===e?void 0:e.effect)&&void 0!==t?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_drawWrapper",{get:function(){var e;return null!==(e=this._mainDrawWrapperOverride)&&void 0!==e?e:this._getDrawWrapper(void 0,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_drawWrapperOverride",{get:function(){return this._mainDrawWrapperOverride},enumerable:!1,configurable:!0}),e.prototype._setMainDrawWrapperOverride=function(e){this._mainDrawWrapperOverride=e},e.prototype.setEffect=function(e,t,i,r){void 0===t&&(t=null),void 0===r&&(r=!0);var n=this._drawWrapper;n.setEffect(e,t,r),void 0!==i&&(n.materialContext=i),e||(n.defines=null,n.materialContext=void 0)},e.prototype.resetDrawCache=function(e){if(this._drawWrappers){if(void 0!==e)return void this._removeDrawWrapper(e);for(var t=0,i=this._drawWrappers;t<i.length;t++){var r=i[t];null==r||r.dispose()}}this._drawWrappers=[]},e.AddToMesh=function(t,i,r,n,s,a,o,h){return void 0===h&&(h=!0),new e(t,i,r,n,s,a,o,h)},Object.defineProperty(e.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()},enumerable:!1,configurable:!0}),e.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},e.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},e.prototype.getMesh=function(){return this._mesh},e.prototype.getRenderingMesh=function(){return this._renderingMesh},e.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null},e.prototype.getEffectiveMesh=function(){var e=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return e||this._renderingMesh},e.prototype.getMaterial=function(e){var t;void 0===e&&(e=!0);var i=null!==(t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId))&&void 0!==t?t:this._renderingMesh.material;if(!i)return e?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(i)){var r=i.getSubMaterial(this.materialIndex);return this._currentMaterial!==r&&(this._currentMaterial=r,this.resetDrawCache()),r}return i},e.prototype._isMultiMaterial=function(e){return void 0!==e.getSubMaterial},e.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(r.o.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var t,i=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===i.length){var n=this._renderingMesh.getBoundingInfo();t={minimum:n.minimum.clone(),maximum:n.maximum.clone()}}else t=(0,a.y)(e,i,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new s.j(t.minimum,t.maximum),this},e.prototype._checkCollision=function(e){return this.getBoundingInfo()._checkCollision(e)},e.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this},e.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)},e.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)},e.prototype.render=function(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},e.prototype._getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var i=[],r=this.indexStart;r<this.indexStart+this.indexCount;r+=3)i.push(e[r],e[r+1],e[r+1],e[r+2],e[r+2],e[r]);this._linesIndexBuffer=t.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer},e.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)},e.prototype.intersects=function(e,t,i,r,n){var s=this.getMaterial();if(!s)return null;var a=3,o=!1;switch(s.fillMode){case 3:case 5:case 6:case 8:return null;case 7:a=1,o=!0}return 4===s.fillMode?i.length?this._intersectLines(e,t,i,this._mesh.intersectionThreshold,r):this._intersectUnIndexedLines(e,t,i,this._mesh.intersectionThreshold,r):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,i,r,n):this._intersectTriangles(e,t,i,a,o,r,n)},e.prototype._intersectLines=function(e,t,i,r,s){for(var a=null,o=this.indexStart;o<this.indexStart+this.indexCount;o+=2){var h=t[i[o]],c=t[i[o+1]],u=e.intersectionSegment(h,c,r);if(!(u<0)&&((s||!a||u<a.distance)&&((a=new n.c(null,null,u)).faceId=o/2,s)))break}return a},e.prototype._intersectUnIndexedLines=function(e,t,i,r,s){for(var a=null,o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=2){var h=t[o],c=t[o+1],u=e.intersectionSegment(h,c,r);if(!(u<0)&&((s||!a||u<a.distance)&&((a=new n.c(null,null,u)).faceId=o/2,s)))break}return a},e.prototype._intersectTriangles=function(e,t,i,r,n,s,a){for(var o=null,h=-1,c=this.indexStart;c<this.indexStart+this.indexCount-(3-r);c+=r){h++;var u=i[c],l=i[c+1],d=i[c+2];if(n&&4294967295===d)c+=2;else{var f=t[u],p=t[l],g=t[d];if(f&&p&&g&&(!a||a(f,p,g,e))){var _=e.intersectsTriangle(f,p,g);if(_){if(_.distance<0)continue;if((s||!o||_.distance<o.distance)&&((o=_).faceId=h,s))break}}}}return o},e.prototype._intersectUnIndexedTriangles=function(e,t,i,r,n){for(var s=null,a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=3){var o=t[a],h=t[a+1],c=t[a+2];if(!n||n(o,h,c,e)){var u=e.intersectsTriangle(o,h,c);if(u){if(u.distance<0)continue;if((r||!s||u.distance<s.distance)&&((s=u).faceId=a/3,r))break}}}return s},e.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},e.prototype.clone=function(t,i){var r=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,i,!1);if(!this.IsGlobal){var n=this.getBoundingInfo();if(!n)return r;r._boundingInfo=new s.j(n.minimum,n.maximum)}return r},e.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1),this.resetDrawCache()},e.prototype.getClassName=function(){return"SubMesh"},e.CreateFromIndices=function(t,i,r,n,s,a){void 0===a&&(a=!0);for(var o=Number.MAX_VALUE,h=-Number.MAX_VALUE,c=(s||n).getIndices(),u=i;u<i+r;u++){var l=c[u];l<o&&(o=l),l>h&&(h=l)}return new e(t,o,h-o+1,i,r,n,s,a)},e}()},39318:(e,t,i)=>{var r=i(58095),n=i(68345);n.P.prototype._projectOnTrianglesToRef=function(e,t,i,n,s,a){for(var o=r.jp.Vector3[0],h=r.jp.Vector3[1],c=1/0,u=this.indexStart;u<this.indexStart+this.indexCount-(3-n);u+=n){var l=i[u],d=i[u+1],f=i[u+2];if(s&&4294967295===f)u+=2;else{var p=t[l],g=t[d],_=t[f];if(p&&g&&_){var v=r.P.ProjectOnTriangleToRef(e,p,g,_,h);v<c&&(o.copyFrom(h),c=v)}}}return a.copyFrom(o),c},n.P.prototype._projectOnUnIndexedTrianglesToRef=function(e,t,i,n){for(var s=r.jp.Vector3[0],a=r.jp.Vector3[1],o=1/0,h=this.verticesStart;h<this.verticesStart+this.verticesCount;h+=3){var c=t[h],u=t[h+1],l=t[h+2],d=r.P.ProjectOnTriangleToRef(e,c,u,l,a);d<o&&(s.copyFrom(a),o=d)}return n.copyFrom(s),o},n.P.prototype.projectToRef=function(e,t,i,r){var n=this.getMaterial();if(!n)return-1;var s=3,a=!1;switch(n.fillMode){case 3:case 5:case 6:case 8:return-1;case 7:s=1,a=!0}return 4===n.fillMode?-1:!i.length&&this._mesh._unIndexed?this._projectOnUnIndexedTrianglesToRef(e,t,i,r):this._projectOnTrianglesToRef(e,t,i,s,a,r)}},83236:(e,t,i)=>{var r=i(91243),n=i(72208),s=i(58095);r.Kj.prototype.thinInstanceAdd=function(e,t){void 0===t&&(t=!0),this._thinInstanceUpdateBufferSize("matrix",Array.isArray(e)?e.length:1);var i=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(e))for(var r=0;r<e.length;++r)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,e[r],r===e.length-1&&t);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,e,t);return i},r.Kj.prototype.thinInstanceAddSelf=function(e){return void 0===e&&(e=!0),this.thinInstanceAdd(s.y3.IdentityReadOnly,e)},r.Kj.prototype.thinInstanceRegisterAttribute=function(e,t){e===n.o.ColorKind&&(e=n.o.ColorInstanceKind),this.removeVerticesData(e),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[e]=t,this._userThinInstanceBuffersStorage.sizes[e]=t*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[e]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[e]),this._userThinInstanceBuffersStorage.vertexBuffers[e]=new n.o(this.getEngine(),this._userThinInstanceBuffersStorage.data[e],e,!0,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e])},r.Kj.prototype.thinInstanceSetMatrixAt=function(e,t,i){if(void 0===i&&(i=!0),!this._thinInstanceDataStorage.matrixData||e>=this._thinInstanceDataStorage.instancesCount)return!1;var r=this._thinInstanceDataStorage.matrixData;return t.copyToArray(r,16*e),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[e]=t),i&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)),!0},r.Kj.prototype.thinInstanceSetAttributeAt=function(e,t,i,r){return void 0===r&&(r=!0),e===n.o.ColorKind&&(e=n.o.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[e]||t>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(e,0),this._userThinInstanceBuffersStorage.data[e].set(i,t*this._userThinInstanceBuffersStorage.strides[e]),r&&this.thinInstanceBufferUpdated(e),!0)},Object.defineProperty(r.Kj.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(e){var t,i,r=null!==(t=this._thinInstanceDataStorage.matrixData)&&void 0!==t?t:null===(i=this.source)||void 0===i?void 0:i._thinInstanceDataStorage.matrixData;e<=(r?r.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=e)},enumerable:!0,configurable:!0}),r.Kj.prototype._thinInstanceCreateMatrixBuffer=function(e,t,i){void 0===i&&(i=!1),e===n.o.ColorKind&&(e=n.o.ColorInstanceKind);for(var r=new n.l(this.getEngine(),t,!i,16,!1,!0),s=0;s<4;s++)this.setVerticesBuffer(r.createVertexBuffer(e+s,4*s,4));return r},r.Kj.prototype.thinInstanceSetBuffer=function(e,t,i,r){var s,a,o;void 0===i&&(i=0),void 0===r&&(r=!1),i=i||16,"matrix"===e?(null===(s=this._thinInstanceDataStorage.matrixBuffer)||void 0===s||s.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=t?t.length:32*i,this._thinInstanceDataStorage.matrixData=t,this._thinInstanceDataStorage.worldMatrices=null,null!==t?(this._thinInstanceDataStorage.instancesCount=t.length/i,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",t,r),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo())):"previousMatrix"===e?(null===(a=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===a||a.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=t,null!==t&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",t,r))):(e===n.o.ColorKind&&(e=n.o.ColorInstanceKind),null===t?(null===(o=this._userThinInstanceBuffersStorage)||void 0===o?void 0:o.data[e])&&(this.removeVerticesData(e),delete this._userThinInstanceBuffersStorage.data[e],delete this._userThinInstanceBuffersStorage.strides[e],delete this._userThinInstanceBuffersStorage.sizes[e],delete this._userThinInstanceBuffersStorage.vertexBuffers[e]):(this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[e]=t,this._userThinInstanceBuffersStorage.strides[e]=i,this._userThinInstanceBuffersStorage.sizes[e]=t.length,this._userThinInstanceBuffersStorage.vertexBuffers[e]=new n.o(this.getEngine(),t,e,!r,!1,i,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e])))},r.Kj.prototype.thinInstanceBufferUpdated=function(e){var t,i,r;"matrix"===e?null===(t=this._thinInstanceDataStorage.matrixBuffer)||void 0===t||t.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount):"previousMatrix"===e?null===(i=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===i||i.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount):(e===n.o.ColorKind&&(e=n.o.ColorInstanceKind),(null===(r=this._userThinInstanceBuffersStorage)||void 0===r?void 0:r.vertexBuffers[e])&&this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(this._userThinInstanceBuffersStorage.data[e],0))},r.Kj.prototype.thinInstancePartialBufferUpdate=function(e,t,i){var r;"matrix"===e?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(t,i):(e===n.o.ColorKind&&(e=n.o.ColorInstanceKind),(null===(r=this._userThinInstanceBuffersStorage)||void 0===r?void 0:r.vertexBuffers[e])&&this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(t,i))},r.Kj.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];var e=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=new Array;for(var t=0;t<this._thinInstanceDataStorage.instancesCount;++t)this._thinInstanceDataStorage.worldMatrices[t]=s.y3.FromArray(e,16*t)}return this._thinInstanceDataStorage.worldMatrices},r.Kj.prototype.thinInstanceRefreshBoundingInfo=function(e,t,i){if(void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=!1),this._thinInstanceDataStorage.matrixData&&this._thinInstanceDataStorage.matrixBuffer){var r=this._thinInstanceDataStorage.boundingVectors;e&&(r.length=0,this.refreshBoundingInfo(t,i));var n=this.getBoundingInfo(),a=this._thinInstanceDataStorage.matrixData;if(0===r.length)for(var o=0;o<n.boundingBox.vectors.length;++o)r.push(n.boundingBox.vectors[o].clone());s.jp.Vector3[0].setAll(Number.POSITIVE_INFINITY),s.jp.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(var h=0;h<this._thinInstanceDataStorage.instancesCount;++h){s.y3.FromArrayToRef(a,16*h,s.jp.Matrix[0]);for(o=0;o<r.length;++o)s.P.TransformCoordinatesToRef(r[o],s.jp.Matrix[0],s.jp.Vector3[2]),s.jp.Vector3[0].minimizeInPlace(s.jp.Vector3[2]),s.jp.Vector3[1].maximizeInPlace(s.jp.Vector3[2])}n.reConstruct(s.jp.Vector3[0],s.jp.Vector3[1]),this._updateBoundingInfo()}},r.Kj.prototype._thinInstanceUpdateBufferSize=function(e,t){var i,r,s;void 0===t&&(t=1),e===n.o.ColorKind&&(e=n.o.ColorInstanceKind);var a="matrix"===e;if(a||this._userThinInstanceBuffersStorage&&this._userThinInstanceBuffersStorage.strides[e]){for(var o=a?16:this._userThinInstanceBuffersStorage.strides[e],h=a?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[e],c=a?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[e],u=(this._thinInstanceDataStorage.instancesCount+t)*o,l=h;l<u;)l*=2;if(!c||h!=l){if(c){var d=new Float32Array(l);d.set(c,0),c=d}else c=new Float32Array(l);a?(null===(i=this._thinInstanceDataStorage.matrixBuffer)||void 0===i||i.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",c,!1),this._thinInstanceDataStorage.matrixData=c,this._thinInstanceDataStorage.matrixBufferSize=l,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&(null===(r=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===r||r.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",c,!1))):(null===(s=this._userThinInstanceBuffersStorage.vertexBuffers[e])||void 0===s||s.dispose(),this._userThinInstanceBuffersStorage.data[e]=c,this._userThinInstanceBuffersStorage.sizes[e]=l,this._userThinInstanceBuffersStorage.vertexBuffers[e]=new n.o(this.getEngine(),c,e,!0,!1,o,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[e]))}}},r.Kj.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},r.Kj.prototype._disposeThinInstanceSpecificData=function(){var e;(null===(e=this._thinInstanceDataStorage)||void 0===e?void 0:e.matrixBuffer)&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},30700:(e,t,i)=>{i.d(t,{Y:()=>c});var r=i(31191),n=i(96969),s=i(62897),a=i(58095),o=i(17834),h=i(43048),c=function(e){function t(i,r,n){void 0===r&&(r=null),void 0===n&&(n=!0);var o=e.call(this,i,r)||this;return o._forward=new a.P(0,0,1),o._up=new a.P(0,1,0),o._right=new a.P(1,0,0),o._position=a.P.Zero(),o._rotation=a.P.Zero(),o._rotationQuaternion=null,o._scaling=a.P.One(),o._transformToBoneReferal=null,o._isAbsoluteSynced=!1,o._billboardMode=t.BILLBOARDMODE_NONE,o._preserveParentRotationForBillboard=!1,o.scalingDeterminant=1,o._infiniteDistance=!1,o.ignoreNonUniformScaling=!1,o.reIntegrateRotationIntoRotationQuaternion=!1,o._poseMatrix=null,o._localMatrix=a.y3.Zero(),o._usePivotMatrix=!1,o._absolutePosition=a.P.Zero(),o._absoluteScaling=a.P.Zero(),o._absoluteRotationQuaternion=a._f.Identity(),o._pivotMatrix=a.y3.Identity(),o._postMultiplyPivotMatrix=!1,o._isWorldMatrixFrozen=!1,o._indexInSceneTransformNodesArray=-1,o.onAfterWorldMatrixUpdateObservable=new s.y$,o._nonUniformScaling=!1,n&&o.getScene().addTransformNode(o),o}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(e){this._billboardMode!==e&&(this._billboardMode=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._isDirty=!0},enumerable:!1,configurable:!0}),t.prototype.isUsingPivotMatrix=function(){return this._usePivotMatrix},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forward",{get:function(){return a.P.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"up",{get:function(){return a.P.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return a.P.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()},enumerable:!1,configurable:!0}),t.prototype.updatePoseMatrix=function(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)},t.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=a.y3.Identity()),this._poseMatrix},t.prototype._isSynchronized=function(){var e=this._cache;return this._billboardMode===e.billboardMode&&this._billboardMode===t.BILLBOARDMODE_NONE&&(!e.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))},t.prototype._initCache=function(){e.prototype._initCache.call(this);var t=this._cache;t.localMatrixUpdated=!1,t.billboardMode=-1,t.infiniteDistance=!1},Object.defineProperty(t.prototype,"absolutePosition",{get:function(){return this.getAbsolutePosition()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),t.prototype.setPreTransformMatrix=function(e){return this.setPivotMatrix(e,!1)},t.prototype.setPivotMatrix=function(e,t){return void 0===t&&(t=!0),this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=a.y3.Invert(this._pivotMatrix)),this},t.prototype.getPivotMatrix=function(){return this._pivotMatrix},t.prototype.instantiateHierarchy=function(e,t,i){void 0===e&&(e=null);var r=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);r&&i&&i(this,r);for(var n=0,s=this.getChildTransformNodes(!0);n<s.length;n++){s[n].instantiateHierarchy(r,t,i)}return r},t.prototype.freezeWorldMatrix=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),e?t?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||a._f.Identity(),e.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=e,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},t.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(t.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),t.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},t.prototype.setAbsolutePosition=function(e){if(!e)return this;var t,i,r;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],i=arguments[1],r=arguments[2]}else t=e.x,i=e.y,r=e.z;if(this.parent){var n=a.jp.Matrix[0];this.parent.getWorldMatrix().invertToRef(n),a.P.TransformCoordinatesFromFloatsToRef(t,i,r,n,this.position)}else this.position.x=t,this.position.y=i,this.position.z=r;return this._absolutePosition.copyFrom(e),this},t.prototype.setPositionWithLocalVector=function(e){return this.computeWorldMatrix(),this.position=a.P.TransformNormal(e,this._localMatrix),this},t.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var e=a.jp.Matrix[0];return this._localMatrix.invertToRef(e),a.P.TransformNormal(this.position,e)},t.prototype.locallyTranslate=function(e){return this.computeWorldMatrix(!0),this.position=a.P.TransformCoordinates(e,this._localMatrix),this},t.prototype.lookAt=function(e,i,r,n,s){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=h.T.LOCAL);var o=t._LookAtVectorCache,c=s===h.T.LOCAL?this.position:this.getAbsolutePosition();if(e.subtractToRef(c,o),this.setDirection(o,i,r,n),s===h.T.WORLD&&this.parent)if(this.rotationQuaternion){var u=a.jp.Matrix[0];this.rotationQuaternion.toRotationMatrix(u);var l=a.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(l),l.invert(),u.multiplyToRef(l,u),this.rotationQuaternion.fromRotationMatrix(u)}else{var d=a.jp.Quaternion[0];a._f.FromEulerVectorToRef(this.rotation,d);u=a.jp.Matrix[0];d.toRotationMatrix(u);l=a.jp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(l),l.invert(),u.multiplyToRef(l,u),d.fromRotationMatrix(u),d.toEulerAnglesToRef(this.rotation)}return this},t.prototype.getDirection=function(e){var t=a.P.Zero();return this.getDirectionToRef(e,t),t},t.prototype.getDirectionToRef=function(e,t){return a.P.TransformNormalToRef(e,this.getWorldMatrix(),t),this},t.prototype.setDirection=function(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0);var n=-Math.atan2(e.z,e.x)+Math.PI/2,s=Math.sqrt(e.x*e.x+e.z*e.z),o=-Math.atan2(e.y,s);return this.rotationQuaternion?a._f.RotationYawPitchRollToRef(n+t,o+i,r,this.rotationQuaternion):(this.rotation.x=o+i,this.rotation.y=n+t,this.rotation.z=r),this},t.prototype.setPivotPoint=function(e,t){void 0===t&&(t=h.T.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var i=this.getWorldMatrix();if(t==h.T.WORLD){var r=a.jp.Matrix[0];i.invertToRef(r),e=a.P.TransformCoordinates(e,r)}return this.setPivotMatrix(a.y3.Translation(-e.x,-e.y,-e.z),!0)},t.prototype.getPivotPoint=function(){var e=a.P.Zero();return this.getPivotPointToRef(e),e},t.prototype.getPivotPointToRef=function(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this},t.prototype.getAbsolutePivotPoint=function(){var e=a.P.Zero();return this.getAbsolutePivotPointToRef(e),e},t.prototype.getAbsolutePivotPointToRef=function(e){return this.getPivotPointToRef(e),a.P.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this},t.prototype.markAsDirty=function(t){if(this._children)for(var i=0,r=this._children;i<r.length;i++){r[i].markAsDirty(t)}return e.prototype.markAsDirty.call(this,t)},t.prototype.setParent=function(e,i){if(void 0===i&&(i=!1),!e&&!this.parent)return this;var r=a.jp.Quaternion[0],n=a.jp.Vector3[0],s=a.jp.Vector3[1],o=a.jp.Matrix[1];a.y3.IdentityToRef(o);var h=a.jp.Matrix[0];this.computeWorldMatrix(!0);var c=this.rotationQuaternion;return c||(c=t._TmpRotation,a._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,c)),a.y3.ComposeToRef(this.scaling,c,this.position,h),this.parent&&h.multiplyToRef(this.parent.computeWorldMatrix(!0),h),e&&(e.computeWorldMatrix(!0).invertToRef(o),h.multiplyToRef(o,h)),h.decompose(s,r,n,i?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(r):r.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(s),this.position.copyFrom(n),this.parent=e,this},Object.defineProperty(t.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),t.prototype._updateNonUniformScalingState=function(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)},t.prototype.attachToBone=function(e,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=e,e.getSkeleton().prepare(),e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},t.prototype.detachFromBone=function(e){return void 0===e&&(e=!1),this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=e?this._currentParentWhenAttachingToBone:null,this):(e&&(this.parent=this._currentParentWhenAttachingToBone),this)},t.prototype.rotate=function(e,i,r){var n;if(e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),r&&r!==h.T.LOCAL){if(this.parent){var s=a.jp.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),e=a.P.TransformNormal(e,s)}(n=a._f.RotationAxisToRef(e,i,t._RotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else n=a._f.RotationAxisToRef(e,i,t._RotationAxisCache),this.rotationQuaternion.multiplyToRef(n,this.rotationQuaternion);return this},t.prototype.rotateAround=function(e,t,i){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=a._f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var r=a.jp.Vector3[0],n=a.jp.Vector3[1],s=a.jp.Vector3[2],o=a.jp.Quaternion[0],h=a.jp.Matrix[0],c=a.jp.Matrix[1],u=a.jp.Matrix[2],l=a.jp.Matrix[3];return e.subtractToRef(this.position,r),a.y3.TranslationToRef(r.x,r.y,r.z,h),a.y3.TranslationToRef(-r.x,-r.y,-r.z,c),a.y3.RotationAxisToRef(t,i,u),c.multiplyToRef(u,l),l.multiplyToRef(h,l),l.decompose(n,o,s),this.position.addInPlace(s),o.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},t.prototype.translate=function(e,t,i){var r=e.scale(t);if(i&&i!==h.T.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(r));else{var n=this.getPositionExpressedInLocalSpace().add(r);this.setPositionWithLocalVector(n)}return this},t.prototype.addRotation=function(e,t,i){var r;this.rotationQuaternion?r=this.rotationQuaternion:(r=a.jp.Quaternion[1],a._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,r));var n=a.jp.Quaternion[0];return a._f.RotationYawPitchRollToRef(t,e,i,n),r.multiplyInPlace(n),this.rotationQuaternion||r.toEulerAnglesToRef(this.rotation),this},t.prototype._getEffectiveParent=function(){return this.parent},t.prototype.computeWorldMatrix=function(e){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var i=this.getScene().getRenderId();if(!this._isDirty&&!e&&(this._currentRenderId===i||this.isSynchronized()))return this._currentRenderId=i,this._worldMatrix;var r=this.getScene().activeCamera,n=0!=(this._billboardMode&t.BILLBOARDMODE_USE_POSITION),s=this._billboardMode!==t.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;this._updateCache();var o=this._cache;o.pivotMatrixUpdated=!1,o.billboardMode=this.billboardMode,o.infiniteDistance=this.infiniteDistance,o.parent=this._parentNode,this._currentRenderId=i,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var h,c=this._getEffectiveParent(),u=t._TmpScaling,l=this._position;if(this._infiniteDistance&&!this.parent&&r){var d=r.getWorldMatrix(),f=new a.P(d.m[12],d.m[13],d.m[14]);(l=t._TmpTranslation).copyFromFloats(this._position.x+f.x,this._position.y+f.y,this._position.z+f.z)}(u.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion)?(this._rotationQuaternion._isDirty=!1,h=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&(M=this.rotation.lengthSquared())&&(this._rotationQuaternion.multiplyInPlace(a._f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(h=t._TmpRotation,a._f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,h));if(this._usePivotMatrix){var p=a.jp.Matrix[1];a.y3.ScalingToRef(u.x,u.y,u.z,p);var g=a.jp.Matrix[0];h.toRotationMatrix(g),this._pivotMatrix.multiplyToRef(p,a.jp.Matrix[4]),a.jp.Matrix[4].multiplyToRef(g,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(l.x,l.y,l.z)}else a.y3.ComposeToRef(u,h,l,this._localMatrix);if(c&&c.getWorldMatrix){if(e&&c.computeWorldMatrix(e),s){this._transformToBoneReferal?c.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),a.jp.Matrix[7]):a.jp.Matrix[7].copyFrom(c.getWorldMatrix());var _=a.jp.Vector3[5],v=a.jp.Vector3[6];a.jp.Matrix[7].decompose(v,void 0,_),a.y3.ScalingToRef(v.x,v.y,v.z,a.jp.Matrix[7]),a.jp.Matrix[7].setTranslation(_),this._localMatrix.multiplyToRef(a.jp.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(c.getWorldMatrix(),a.jp.Matrix[6]),a.jp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(c.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(s&&r&&this.billboardMode&&!n){var m=a.jp.Vector3[0];if(this._worldMatrix.getTranslationToRef(m),a.jp.Matrix[1].copyFrom(r.getViewMatrix()),a.jp.Matrix[1].setTranslationFromFloats(0,0,0),a.jp.Matrix[1].invertToRef(a.jp.Matrix[0]),(this.billboardMode&t.BILLBOARDMODE_ALL)!==t.BILLBOARDMODE_ALL){a.jp.Matrix[0].decompose(void 0,a.jp.Quaternion[0],void 0);var y=a.jp.Vector3[1];a.jp.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(y.z=0),a.y3.RotationYawPitchRollToRef(y.y,y.x,y.z,a.jp.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(a.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(a.jp.Vector3[0])}else if(s&&r&&this.billboardMode&&n){m=a.jp.Vector3[0];this._worldMatrix.getTranslationToRef(m);var x=r.globalPosition;this._worldMatrix.invertToRef(a.jp.Matrix[1]);var b=a.jp.Vector3[1];a.P.TransformCoordinatesToRef(x,a.jp.Matrix[1],b),b.normalize();var I=-Math.atan2(b.z,b.x)+Math.PI/2,M=Math.sqrt(b.x*b.x+b.z*b.z),D=-Math.atan2(b.y,M);if(a._f.RotationYawPitchRollToRef(I,D,0,a.jp.Quaternion[0]),(this.billboardMode&t.BILLBOARDMODE_ALL)!==t.BILLBOARDMODE_ALL){y=a.jp.Vector3[1];a.jp.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(y.z=0),a.y3.RotationYawPitchRollToRef(y.y,y.x,y.z,a.jp.Matrix[0])}else a.y3.FromQuaternionToRef(a.jp.Quaternion[0],a.jp.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(a.jp.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(a.jp.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):c&&c._nonUniformScaling?this._updateNonUniformScalingState(c._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=a.y3.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},t.prototype.resetLocalMatrix=function(e){if(void 0===e&&(e=!0),this.computeWorldMatrix(),e)for(var t=this.getChildren(),i=0;i<t.length;++i){var r=t[i];if(r){r.computeWorldMatrix();var n=a.jp.Matrix[0];r._localMatrix.multiplyToRef(this._localMatrix,n);var s=a.jp.Quaternion[0];n.decompose(r.scaling,s,r.position),r.rotationQuaternion?r.rotationQuaternion.copyFrom(s):s.toEulerAnglesToRef(r.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=a._f.Identity()),this._worldMatrix=a.y3.Identity()},t.prototype._afterComputeWorldMatrix=function(){},t.prototype.registerAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this},t.prototype.unregisterAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this},t.prototype.getPositionInCameraSpace=function(e){return void 0===e&&(e=null),e||(e=this.getScene().activeCamera),a.P.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())},t.prototype.getDistanceToCamera=function(e){return void 0===e&&(e=null),e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()},t.prototype.clone=function(e,i,r){var s=this,a=n.p4.Clone((function(){return new t(e,s.getScene())}),this);if(a.name=e,a.id=e,i&&(a.parent=i),!r)for(var o=this.getDescendants(!0),h=0;h<o.length;h++){var c=o[h];c.clone&&c.clone(e+"."+c.name,a)}return a},t.prototype.serialize=function(e){var t=n.p4.Serialize(this,e);return t.type=this.getClassName(),t.uniqueId=this.uniqueId,this.parent&&(t.parentId=this.parent.uniqueId),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),this.parent&&(t.parentId=this.parent.uniqueId),t},t.Parse=function(e,i,r){var s=n.p4.Parse((function(){return new t(e.name,i)}),e,i,r);return e.localMatrix?s.setPreTransformMatrix(a.y3.FromArray(e.localMatrix)):e.pivotMatrix&&s.setPivotMatrix(a.y3.FromArray(e.pivotMatrix)),s.setEnabled(e.isEnabled),void 0!==e.parentId&&(s._waitingParentId=e.parentId),s},t.prototype.getChildTransformNodes=function(e,i){var r=[];return this._getDescendants(r,e,(function(e){return(!i||i(e))&&e instanceof t})),r},t.prototype.dispose=function(t,i){if(void 0===i&&(i=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){var r=this._parentContainer.transformNodes.indexOf(this);r>-1&&this._parentContainer.transformNodes.splice(r,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),t)for(var n=0,s=this.getChildTransformNodes(!0);n<s.length;n++){var a=s[n];a.parent=null,a.computeWorldMatrix(!0)}e.prototype.dispose.call(this,t,i)},t.prototype.normalizeToUnitCube=function(e,t,i){void 0===e&&(e=!0),void 0===t&&(t=!1);var r=null,n=null;t&&(this.rotationQuaternion?(n=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(r=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var s=this.getHierarchyBoundingVectors(e,i),a=s.max.subtract(s.min),o=Math.max(a.x,a.y,a.z);if(0===o)return this;var h=1/o;return this.scaling.scaleInPlace(h),t&&(this.rotationQuaternion&&n?this.rotationQuaternion.copyFrom(n):this.rotation&&r&&this.rotation.copyFrom(r)),this},t.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},t.BILLBOARDMODE_NONE=0,t.BILLBOARDMODE_X=1,t.BILLBOARDMODE_Y=2,t.BILLBOARDMODE_Z=4,t.BILLBOARDMODE_ALL=7,t.BILLBOARDMODE_USE_POSITION=128,t._TmpRotation=a._f.Zero(),t._TmpScaling=a.P.Zero(),t._TmpTranslation=a.P.Zero(),t._LookAtVectorCache=new a.P(0,0,0),t._RotationAxisCache=new a._f,(0,r.gn)([(0,n.hd)("position")],t.prototype,"_position",void 0),(0,r.gn)([(0,n.hd)("rotation")],t.prototype,"_rotation",void 0),(0,r.gn)([(0,n.mv)("rotationQuaternion")],t.prototype,"_rotationQuaternion",void 0),(0,r.gn)([(0,n.hd)("scaling")],t.prototype,"_scaling",void 0),(0,r.gn)([(0,n.qC)("billboardMode")],t.prototype,"_billboardMode",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"scalingDeterminant",void 0),(0,r.gn)([(0,n.qC)("infiniteDistance")],t.prototype,"_infiniteDistance",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"ignoreNonUniformScaling",void 0),(0,r.gn)([(0,n.qC)()],t.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),t}(o.N)}}]);