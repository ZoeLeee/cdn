"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1743],{35513:(e,t,n)=>{n.d(t,{Z:()=>ne});var l=n(20246),i=n.n(l),a=n(39831),o=n.n(a),r=n(61799),c=n.n(r),d=n(26117),s=n.n(d),p=n(5996),u=n.n(p),m=n(20658),h=n.n(m),g=n(3434),f=n.n(g),y=n(97828),x=n.n(y),b=n(93213),E=n(51463),v=n.n(E),Z=n(32735),w=n(94063),k=n(61241),C=n(3450),P=n(29405),S=n.n(P),j=n(14549),I=n.n(j),_=n(97539),z=n.n(_),D=n(13697),O=n(47513),L=n(45709),F=n(67970),M=n(10800),R=n(11528),T=n(27660),$=n(83228),W=n(46600);const B=(0,C.ZP)(D.Z)((({theme:e})=>({position:"relative"}))),N=(0,C.ZP)("div")((({theme:e})=>({display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"90%","& i":{fontSize:"10em",color:"rgb(255, 208, 129)"}}))),A=(0,C.ZP)("div")((({theme:e})=>({display:"flex",justifyContent:"flex-end",alignItems:"center",width:"calc((100% - 32px) / 2)",height:"9%",position:"absolute",right:"16px",zIndex:100,"& .action-menu-item":{display:"flex",justifyContent:"center",alignItems:"center",width:30,height:30,margin:"0 5px",borderRadius:"50%"}}))),H=(0,C.ZP)("div")((({theme:e})=>({display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"calc(100% / 3)"}))),q=(0,C.ZP)(F.Z)((({theme:e})=>({width:40,height:40,margin:"0 15px"}))),U=[{key:"preview",title:"\u9884\u89c8",icon:"icon-3Dyulan-dakai1",type:"dir-file"},{key:"rename",title:"\u91cd\u547d\u540d",icon:"icon-3Dbianji",type:"dir-file"},{key:"edit",title:"\u7f16\u8f91",icon:"icon-3Dshezhi",type:"dir-file"},{key:"delete",title:"\u5220\u9664",icon:"icon-3Ddel",type:"dir-file"}],G={id:"id",name:"name",count:"count",createdTime:"createdTime",updatedTime:"updatedTime",img:"img"};let J=0;const Y=({dataItem:e,dataIndex:t,handleClick:n,menuList:l,keyFormat:i,doubleClick:a,moreList:o})=>{const[r,d]=(0,Z.useState)(null),[s,p]=(0,Z.useState)(null),u=Boolean(r),m=(e,t,l)=>{y(),n&&n(e,t,l)},h=()=>{J+=1,S()((()=>{1===J?n&&n(e,t):2===J&&a&&a(e,t),J=0}),300)},g=e=>{const t={fontSize:"13px"};return Z.createElement(M.Z,{id:"basic-menu"+e,anchorEl:r,open:u,onClose:y,MenuListProps:{"aria-labelledby":"basic-button"}},o&&v()(o).call(o,((e,n)=>Z.createElement(R.Z,{sx:t,key:n,onClick:()=>m(e.key,s,n)},Z.createElement("i",{className:"iconfont "+e.icon}),e.title))))},f=(e,t,n,l)=>{"more"===l?x(e,t):m(l,t,n)},y=()=>{d(null),p({})},x=(e,t)=>{d(e.currentTarget),p(t)};return(()=>{let n=I()(G,i||{}),a=l||U,o=c()(a).call(a,(t=>{var n;return-1!==z()(n=t.type).call(n,e.node_type)}));return Z.createElement(B,null,Z.createElement(O.Z,{sx:{width:"100%",height:"300px",userSelect:"none"},onClick:h},Z.createElement(A,null,v()(o).call(o,((l,i)=>Z.createElement(H,{key:i},Z.createElement(q,{title:l.title,color:"primary",onClick:n=>f(n,e,t,l.key)},Z.createElement(W.Z,{type:l.icon})),"more"===l.key?g(e[n.id]):null)))),Z.createElement(L.Z,{align:"left",variant:"body2",color:"text.secondary",sx:{color:"#222",fontSize:"15px",fontWeight:"bold",width:"50%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},e[n.name]),Z.createElement(N,null,"file"===e.node_type?e[n.img]&&(0,$.ap)(T.l.prefix+e[n.key]+"/"+e[n.img])?Z.createElement("img",{src:`${T.l.prefix}${e[n.key]}/${e[n.img]}?t=${(new Date).getTime()}`,style:{height:"80%"}}):Z.createElement("img",{src:"/static/images/bg.png"}):Z.createElement(W.Z,{type:"icon-3Dxiangmu"}))))})()};var K=n(60092);function X(e,t){var n=i()(e);if(o()){var l=o()(e);t&&(l=c()(l).call(l,(function(t){return s()(e,t).enumerable}))),n.push.apply(n,l)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n,l,i=null!=arguments[t]?arguments[t]:{};t%2?u()(n=X(Object(i),!0)).call(n,(function(t){(0,b.Z)(e,t,i[t])})):h()?f()(e,h()(i)):u()(l=X(Object(i))).call(l,(function(t){x()(e,t,s()(i,t))}))}return e}const V=(0,C.ZP)("div")((({theme:e})=>({padding:"20px",display:"grid",flexWrap:"wrap",gridTemplateColumns:"repeat(auto-fill, calc((100% - 25px * 3) / 4))",gridGap:"25px 25px","& .projectCardItem":{width:"100%",maxHeight:300,boxShadow:"0px 0px 8px 0px rgba(0, 0, 0, 0.08)",borderRadius:"5px"},"& .activePane":{boxShadow:"0px 0px 8px 0px rgba(7, 95, 184, 0.46)"},"& .activeIcon":{color:"#1890ff"},"& .projectCardItem:hover":{boxShadow:"0px 0px 8px 0px rgba(7, 95, 184, 0.46)","& .hover-icon":{color:"#1890ff"}},"& .MuiCardContent-root:last-child":{paddingBottom:"16px"}}))),ee=(0,C.ZP)(k.Z)((({theme:e})=>Q(Q({},e.typography.body2),{},{textAlign:"center",color:e.palette.text.secondary,height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer"}))),te=(0,C.ZP)("div")((({theme:e})=>({textAlign:"center",fontSize:"14px",padding:"20px 0","& img":{width:300,height:300},"& p":{margin:0}}))),ne=({dataSource:e,handleClick:t,ipagenation:n,handleChangePage:l,handleChangeRowsPerPage:i,add:a,menuList:o,sx:r,total:c,keyFormat:d,doubleClick:s,moreList:p})=>Z.createElement(Z.Fragment,null,Z.createElement(V,{sx:r},a?Z.createElement(w.Z,{sx:{position:"relative",display:"flex",height:300,"& > :not(style)":{width:"100%",height:"100%"}}},Z.createElement("label",{style:{cursor:"pointer",opacity:0,position:"absolute"}},Z.createElement("input",{multiple:!0,type:"file",onChange:a,accept:".zip",style:{display:"none"}})),Z.createElement(ee,{elevation:3},Z.createElement("img",{src:"/static/images/add.png",width:"60%"}))):null,e&&v()(e).call(e,((e,n)=>Z.createElement(Y,{key:n,dataIndex:n,dataItem:e,menuList:o,moreList:p,keyFormat:d,handleClick:t,doubleClick:s})))),n&&c>0?Z.createElement(K.Z,{pagenation:n,total:c,onPageChange:l,onRowsPerPageChange:i}):null,e&&0!==e.length?null:Z.createElement(te,null,Z.createElement("img",{src:"/static/images/nodata.svg"}),Z.createElement("p",null,"\u6682\u65e0\u6570\u636e")))},24240:(e,t,n)=>{n.d(t,{Z:()=>s});var l=n(32735),i=n(61241),a=n(5385),o=n(3450),r=n(89044);const c=(0,o.ZP)(i.Z)((({theme:e})=>({border:"1px solid #E2E2E2",p:"0 0 0 4px",display:"inline-flex",alignItems:"center",width:400,height:36,boxShadow:"none",borderRadius:"5px"}))),d=(0,o.ZP)("div")((({theme:e})=>({display:"flex",justifyContent:"center",alignItems:"center",padding:"0 3px",background:"#075FB8",height:"100%",width:36,color:"#fff",borderRadius:"0 5px 5px 0",cursor:"pointer"})));function s(e){const[t,n]=(0,l.useState)(""),i=()=>{const{search:n}=e;n&&n(t)};return l.createElement(c,null,l.createElement(a.ZP,{sx:{ml:1,flex:1},placeholder:"\u641c\u7d22",value:t,onChange:e=>{n(e.target.value)},onKeyUp:e=>{13===e.keyCode&&i()}}),l.createElement(d,{onClick:i},l.createElement(r.Z,null)))}},22693:(e,t,n)=>{n.d(t,{Z:()=>v});var l=n(51463),i=n.n(l),a=n(32735),o=n(46561),r=n(37394),c=n(3450),d=n(20246),s=n.n(d),p=n(64496),u=n(37360),m=n(67970),h=n(10800),g=n(11528),f=n(46600);const y=(0,c.ZP)(r.Z)((({theme:e})=>({height:40,paddingRight:0,"& .label-style span":{fontSize:"13px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}))),x=({currentObj:e,dataItem:t,dataIndex:n,menuItemArr:l,handleClick:o,onMenuClick:r})=>{const[c,d]=(0,a.useState)(null),x=Boolean(c),b=e=>{d(e.currentTarget),e.stopPropagation()},E=()=>{d(null)};return(d=>{let v="";e&&s()(e).length>0&&(v=e.key);let{key:Z,label:w,type:k,children:C,open:P,icon:S}=t;return a.createElement(a.Fragment,{key:n},a.createElement(y,{sx:{pl:d},className:v===Z?"SelfList active":"SelfList",onClick:e=>{o&&o(t,e)}},S?a.createElement(p.Z,{sx:{minWidth:"30px"}},a.createElement(f.Z,{type:S})):null,a.createElement(u.Z,{className:"label-style",title:w,primary:w}),a.createElement(m.Z,{onClick:b},a.createElement(f.Z,{sx:{fontSize:"20px",color:"#333"},type:"icon-3Dgengduo"}))),a.createElement(h.Z,{id:"actionMenu-"+Z,anchorEl:c,open:x,onClose:E,MenuListProps:{"aria-labelledby":"basic-button"}},l&&i()(l).call(l,((e,n)=>a.createElement(g.Z,{sx:{fontSize:"13px"},key:n,onClick:()=>(e=>{r&&r(e.key,t),E()})(e)},e.icon?a.createElement(f.Z,{sx:{fontSize:"18px",marginRight:"5px"},type:e.icon}):null,e.title)))))})(2)},b=(0,c.ZP)(o.Z)((({theme:e})=>({width:"100%",maxWidth:360,bgcolor:"background.paper","& .active, & .SelfList:hover":{backgroundColor:"rgba(25, 118, 210, 0.2)"}}))),E=((0,c.ZP)(r.Z)((({theme:e})=>({fontSize:"12px",height:40,"& .label-style span":{fontSize:"13px"}}))),[{key:"rename",title:"\u91cd\u547d\u540d",icon:"icon-3Dbianji1"},{key:"delete",title:"\u5220\u9664",icon:"icon-3Ddel"}]),v=({dataList:e,handleClick:t,currentObj:n,onMenuClick:l})=>a.createElement(b,{sx:{width:"100%",maxWidth:360,bgcolor:"background.paper"},"aria-labelledby":"nested-list-subheader"},e&&i()(e).call(e,((e,i)=>a.createElement(x,{key:i,dataItem:e,dataIndex:i,menuItemArr:E,currentObj:n,onMenuClick:l,handleClick:t}))))},18163:(e,t,n)=>{n.d(t,{Z:()=>v});var l=n(74857),i=n(21092),a=n(32735),o=n(75393),r=n(68867),c=n(57426),d=n(58181),s=n(37211),p=n(67970),u=n(44700),m=n(61241),h=n(3450),g=n(89294),f=n.n(g);const y=["children","onClose"],x=(0,h.ZP)(r.Z)((({theme:e})=>({"& .MuiDialogContent-root":{padding:e.spacing(2)},"& .MuiDialogActions-root":{padding:e.spacing(1)}}))),b=e=>{const{children:t,onClose:n}=e,o=(0,i.Z)(e,y);return a.createElement(c.Z,(0,l.Z)({sx:{m:0,p:2,cursor:"move"}},o),t,n?a.createElement(p.Z,{"aria-label":"close",onClick:n,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]}},a.createElement(u.Z,null)):null)},E=e=>a.createElement(f(),{handle:"#draggable-dialog-title",cancel:'[class*="MuiDialogContent-root"]'},a.createElement(m.Z,e)),v=({title:e,visible:t,size:n,children:l,header:i,footer:r,fullWidth:c,sx:p,height:u,hideFooter:m,handleOk:h,handleClose:g})=>{const f=()=>{g&&g()};return a.createElement(x,{open:t,maxWidth:n,fullWidth:c,PaperComponent:E,"aria-labelledby":"draggable-dialog-title"},i||a.createElement(b,{id:"draggable-dialog-title",onClose:f},e),a.createElement(d.Z,{sx:{height:""+(u?u+"px":"auto")},dividers:!0},l),m?null:a.createElement(s.Z,null,r||a.createElement(a.Fragment,null,a.createElement(o.Z,{onClick:f},"\u53d6\u6d88"),a.createElement(o.Z,{onClick:()=>{h&&h()}},"\u786e\u5b9a"))))}},60092:(e,t,n)=>{n.d(t,{Z:()=>r});var l=n(36800),i=n.n(l),a=n(32735),o=n(65404);const r=({total:e,pagenation:t,onPageChange:n,onRowsPerPageChange:l})=>{const{pageNum:r,pageSize:c,pageSizeOptions:d}=t;return a.createElement(o.Z,{rowsPerPageOptions:d||[],component:"div",count:e,rowsPerPage:c,page:r>0?r-1:0,onPageChange:(e,t)=>{n&&n(t+1)},onRowsPerPageChange:e=>{l&&l(i()(e.target.value,10))},labelRowsPerPage:"\u6bcf\u9875\u6761\u6570\uff1a",labelDisplayedRows:({from:t,to:n})=>`${t}\u2013${n} \u5171 ${Math.ceil(e/c)}\u9875, ${e}\u6761`})}},81743:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ze});var l=n(39831),i=n.n(l),a=n(61799),o=n.n(a),r=n(26117),c=n.n(r),d=n(20658),s=n.n(d),p=n(3434),u=n.n(p),m=n(97828),h=n.n(m),g=n(93213),f=n(71722),y=n.n(f),x=n(12625),b=n.n(x),E=n(20246),v=n.n(E),Z=n(66989),w=n.n(Z),k=n(62750),C=n.n(k),P=n(45285),S=n.n(P),j=n(18578),I=n.n(j),_=n(5996),z=n.n(_),D=n(13567),O=n.n(D),L=n(33591),F=n.n(L),M=n(51463),R=n.n(M),T=n(32735),$=n(57055),W=n(3450),B=n(75393),N=n(95279),A=n(67970),H=n(94063),q=n(21365),U=n(45709),G=n(43553),J=n(36517),Y=n(35513),K=n(22693),X=n(24240),Q=n(99394),V=n(73554),ee=n(81215),te=n(25661),ne=n(4992),le=n(1869),ie=n(6475),ae=n(29115),oe=n(27660),re=n(19853),ce=n(89487);function de(e,t){var n=v()(e);if(i()){var l=i()(e);t&&(l=o()(l).call(l,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,l)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n,l,i=null!=arguments[t]?arguments[t]:{};t%2?z()(n=de(Object(i),!0)).call(n,(function(t){(0,g.Z)(e,t,i[t])})):s()?u()(e,s()(i)):z()(l=de(Object(i))).call(l,(function(t){h()(e,t,c()(i,t))}))}return e}const pe=(0,W.ZP)("div")((({theme:e})=>({display:"flex",height:"50px",justifyContent:"space-between",alignItems:"center",fontSize:"15px",padding:"15px 8px",borderBottom:"1px solid #f0f0f0"}))),ue=(0,W.ZP)(H.Z)((({theme:e})=>({position:"absolute",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200}))),me="editor/file/private/list",he="editor/file/delete",ge={name:"",pid:0,source_type:"models",node_type:"dir",status:1,project_type:"3d"},fe=[{key:"preview",title:"\u9884\u89c8",icon:"icon-3Dsousuo",type:"file"},{key:"rename",title:"\u7f16\u8f91",icon:"icon-3Dbianji1",type:"dir-file"},{key:"delete",title:"\u5220\u9664",icon:"icon-3Ddel",type:"dir"},{key:"more",title:"\u66f4\u591a",icon:"icon-3Dgengduo",type:"file"}],ye=[{key:"publish",title:"\u53d1\u5e03",icon:"icon-3Dgongnengdingyi",type:"file"},{key:"delete",title:"\u5220\u9664",icon:"icon-3Ddel",type:"file"}],xe=[];let be,Ee;const ve=["obj","gltf","glb","STL"];let Ze,we,ke,Ce,Pe;const Se=()=>new(y())((e=>{Pe=e}));let je,Ie=!1;new(b());let _e;function ze(e){const[t,n]=(0,T.useState)([]),[l,i]=(0,T.useState)({pageNum:1,pageSize:7}),[a,o]=(0,T.useState)([]),[r,c]=(0,T.useState)(null),[d,s]=(0,T.useState)(0),[p,u]=(0,T.useState)(""),[m,h]=(0,T.useState)(null),[g,f]=(0,T.useState)(xe),[x,b]=(0,T.useState)(!1),E=(0,T.useRef)(null),Z=(0,T.useRef)(null),k=e=>{e&&0!==v()(e).length?Z.current.init(e,!0,"\u7f16\u8f91"):V.y.warn("\u8bf7\u9009\u62e9\u8981\u91cd\u547d\u540d\u7684\u9879\uff01")},P=(e,t,l)=>{let i=se({source_type:"models",project_type:"3d",pid:d},e),r=l||"both";(0,Q.s7)(me,i).then((e=>{if(0===e.code){let l=e.data;if(l&&l.length>0){for(let e of l)e.children=[];if("both"===r||"tree"===r)if(t){t.children=[];for(let e of l){let n=se({key:e.id,label:e.name,type:e.node_type,open:!1,icon:"icon-3Dweb"},e);t.children.push(n)}let e=JSON.parse(w()(a));o(e)}else{let e=[];for(let t of l){let n=se({key:t.id,label:t.name,type:t.node_type,open:!1,icon:"icon-3Dweb"},t);e.push(n)}o(e)}"both"!==r&&"list"!==r||n(l)}else"both"!==r&&"tree"!==r||t||o([]),"both"!==r&&"list"!==r||n([])}}))},j=e=>{if(e&&0!==v()(e).length){let t={id:e.id};(0,ee.i)({title:"\u63d0\u793a",content:`\u786e\u5b9a\u5220\u9664\u201c${e.name}\u201d\u5417\uff1f`,onOk:()=>{_(t,e.node_type)}})}else V.y.warn("\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u9879\uff01")},_=(e,t)=>{(0,Q.mn)(he,e).then((e=>{0===e.code&&("dir"===t&&P({pid:0},null,"tree"),P({pid:r.id},null,"list"),V.y.success("\u5220\u9664\u6210\u529f"))}))},D=e=>{let t=se({source_type:"models",project_type:"3d"},e);(0,Q.s7)(me,t).then((e=>{if(0===e.code){let t=e.data;if(t&&t.length>0){let e=[];for(let n of t)if("file"===n.node_type){let t=se({key:n.id,label:n.name,type:n.node_type,open:!1},n);e.push(t)}n(e)}else n([])}}))};(0,T.useEffect)((()=>{(e=>{let t=se({source_type:"models",project_type:"3d",pid:d},e);(0,Q.s7)(me,t).then((e=>{if(0===e.code){let t=e.data;if(t&&t.length>0){let e=[];for(let n of t){let t=se({key:n.id,label:n.name,type:n.node_type,open:!1,icon:"icon-3Dweb"},n);e.push(t)}o(e),c(e[0]),f([{id:e[0].id,name:e[0].name,pid:d}]),P({pid:e[0].id},null,"list")}else o([])}}))})()}),[]);const L=e=>{E.current.open(),u(`/preview.html?&model=${e.id}`)},M=e=>{if(e){const{id:t,name:n,pid:l}=e;f([{id:t,name:n,pid:l}]),P({pid:r.id},null,"list"),P({pid:0},null,"tree")}};(0,T.useEffect)((()=>{be||(be=document.createElement("canvas"),be.width=400,be.height=400,window.filePreview=_e=new $.FilePreviewer(be,!0))}),[]),(0,T.useEffect)((()=>{const e=[];return e.push(_e.onLoaded((async e=>{if(!e&&Ie&&je)return;const t=await _e.getBlob(),n=new File([t],e.name+".png");ke.push(n),Pe&&(Pe(!0),Pe=null),await W()})),_e.onError((({file:e,message:t})=>{Ce.push(e),Pe&&(Pe(!0),Pe=null),W()}))),()=>{z()(e).call(e,(e=>e()))}}),[]);const W=async()=>{if(ke.length+Ce.length===Ze.length){if(0===ke.length)return void V.y.warn("\u6a21\u578b\u4e0a\u4f20\u5931\u8d25\uff0c\u68c0\u67e5\u6a21\u578b\u662f\u5426\u5b58\u5728\u95ee\u9898",{autoHideDuration:2e3});let e=new FormData,t=0;const n=O()(),l=[],i=[...ke,...Ee];let a=Math.ceil(i.length/50);for(let o=0;o<i.length;o++){const r=i[o];if(!F()(Ce).call(Ce,r)&&(e.append(r.name,r),t++,t>=50||o===i.length-1)){const i=await(0,ae.qu)(ie.Ym.uploadMulti+"?p="+n,e,{headers:{"Content-Type":"multipart/form-data"},transformRequest:[function(e){return e}],onUploadProgress:e=>{}});i.code===ae.Mx.Ok&&l.push(...i.data.files),e=new FormData,t=0,a--}}de(l)}},de=e=>{const t=t=>{for(const n of e)if("png"===n.tag&&n.name===t+".png")return n},n=[];for(const l of e)if(F()(ve).call(ve,l.tag)){const e=t(l.name);n.push((0,ae.qu)(ie.au.create,{name:l.name,pId:r.id||0,source_type:ie.fL.Model,node_type:"file",fileId:l.ID,picId:e.ID}))}y().all(n).then((e=>{V.y.success(`\u6210\u529f\u4e0a\u4f20${ke.length}\u4e2a\u6a21\u578b,\u5931\u8d25${Ce.length}\u4e2a`,{autoHideDuration:5e3})})).then((e=>{}))};return T.createElement(T.Fragment,null,T.createElement(N.ZP,{columns:8,container:!0,sx:{height:"100%"},spacing:0},x?T.createElement(ue,null,T.createElement(G.Z,{size:150})):null,T.createElement(N.ZP,{item:!0,xs:1,sx:{height:"100%",padding:"10px"}},T.createElement(H.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"}},T.createElement(B.Z,{variant:"outlined",sx:{height:"32px",fontSize:"12px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},onClick:()=>{s(0),c(null),f(xe),P({pid:0})}},"\u6211\u7684\u6a21\u578b"),T.createElement(A.Z,{title:"\u65b0\u5efa\u76ee\u5f55",color:"primary",onClick:()=>{return e=ge,void Z.current.init(e,!1,"\u65b0\u589e");var e}},T.createElement(J.Z,null))),T.createElement(K.Z,{dataList:a,handleClick:(e,t)=>{if(c(e),"dir"===e.node_type){const{id:t,name:n,pid:l}=e;s(t),f([{id:t,name:n,pid:l}]),P({pid:t},null,"list")}},currentObj:r,onMenuClick:(e,t)=>{"delete"===e?j(t):"rename"===e&&k(t)}})),T.createElement(N.ZP,{item:!0,xs:7,sx:{borderLeft:"1px solid #aaa"}},T.createElement(pe,null,T.createElement(q.Z,null,T.createElement(U.Z,null,"\u6211\u7684\u6a21\u578b"),g&&R()(g).call(g,((e,t)=>T.createElement(U.Z,{key:t},e.name)))),T.createElement(X.Z,{search:e=>{e?D({name:e}):P({},null,"list")}})),T.createElement(Y.Z,{dataSource:t,add:async e=>{if(Ee=C()(e.target.files),S()(Ee).call(Ee,(e=>{var t;return I()(t=e.name).call(t,".zip")})))return b(!0),await(async()=>{Ie=!0;for(const e of Ee){const t=new FormData;t.append("pid",r.id),t.append("pic_key","icon.png"),t.append("source_type",ie.fL.Model),t.append("node_type","file"),t.append("status","1"),t.append("files",e),t.append("name",e.name),t.append("project_type","3d");const n=await(0,ae.qu)(ie.Ym.upload,t,{headers:{"Content-Type":"multipart/form-data"},transformRequest:[function(e){return e}],onUploadProgress:e=>{}});if(n.code===ae.Mx.Ok&&n.data)for(const e of n.data)await _e.loadFile(oe.l.prefix+(0,re.qm)(e)),je=e.id,await(0,ce.jv)(e.id,(async()=>_e.getPreviewUrl(200)))}Ie=!1,P({pid:r.id},null,"list"),P({pid:0},null,"tree"),b(!1)})(),void(e.target.value=null);Ze=[],we=[];for(const e of Ee){if(e.size>31457280)return void V.y.error(e.name+"\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc720M\uff0c\u76ee\u524d\u5355\u4e2a\u4e0a\u4f20\u6587\u4ef6\u4f53\u79ef\u4e0d\u8d85\u8fc720M");S()(ve).call(ve,(t=>{var n;return I()(n=e.name).call(n,t)}))?Ze.push(e):we.push(e)}if(Ze.length>0){if(_e){ke=[],Ce=[],_e.loadLocalFile({target:{files:[Ze[0],...we]}}),await Se();for(let e=1;e<Ze.length;e++)_e.loadLocalFile({target:{files:[Ze[e]]}}),await Se()}}else V.y.warn("\u8bf7\u4e0a\u4f20\u6b63\u786e\u7684\u6a21\u578b\u6587\u4ef6\u548c\u5176\u4f9d\u8d56\u6587\u4ef6\uff0c\u76ee\u524d\u652f\u6301OBJ,GLTF,GLB 3\u79cd",{autoHideDuration:2e3});e.target.value=null},ipagenation:l,handleChangePage:e=>{i({pageNum:e,pageSize:l.pageSize})},handleChangeRowsPerPage:e=>{i({pageNum:0,pageSize:e})},handleClick:(e,t)=>{if("rename"===e)k(t);else if("preview"===e)L(t);else if("delete"===e)j(t);else if("move"===e);else if("publish"===e){let{id:e,uuid:n,name:l,pic_key:i,file_key:a}=t;h({id:e,uuid:n,title:l,preview:n+"/"+i})}},keyFormat:{img:"pic_key",key:"uuid"},doubleClick:(e,t)=>{if("dir"===e.node_type){const{id:t,name:n,pid:l}=e;s(t),f([{id:t,name:n,pid:l}]),P({pid:t},null,"list")}else L(e)},menuList:fe,moreList:ye}))),T.createElement(le.Z,{dataRef:Z,onOk:M,onClose:M}),T.createElement(ne.Z,{previewRef:E,url:p}),m&&v()(m).length>0?T.createElement(te.Z,{category:"M0003",type:"file",onClose:()=>{h(null)},target:m.id,targetObj:m}):null)}},1869:(e,t,n)=>{n.d(t,{Z:()=>B});var l=n(20246),i=n.n(l),a=n(39831),o=n.n(a),r=n(61799),c=n.n(r),d=n(26117),s=n.n(d),p=n(5996),u=n.n(p),m=n(20658),h=n.n(m),g=n(3434),f=n.n(g),y=n(97828),x=n.n(y),b=n(93213),E=n(66989),v=n.n(E),Z=n(51463),w=n.n(Z),k=n(32735),C=n(3450),P=n(95279),S=n(73764),j=n(11528),I=n(92491),_=n(61241),z=n(18163),D=n(99394),O=n(73554);function L(e,t){var n=i()(e);if(o()){var l=o()(e);t&&(l=c()(l).call(l,(function(t){return s()(e,t).enumerable}))),n.push.apply(n,l)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n,l,i=null!=arguments[t]?arguments[t]:{};t%2?u()(n=L(Object(i),!0)).call(n,(function(t){(0,b.Z)(e,t,i[t])})):h()?f()(e,h()(i)):u()(l=L(Object(i))).call(l,(function(t){x()(e,t,s()(i,t))}))}return e}(0,C.ZP)("div")((({theme:e})=>({display:"flex",height:"50px",justifyContent:"space-between",alignItems:"center",fontSize:"15px",padding:"15px 8px",borderBottom:"1px solid #f0f0f0"})));const M=(0,C.ZP)(S.Z)((({theme:e})=>({"& input":{height:"1em",width:"300px"}}))),R="editor/file/private/list",T="editor/file/upload",$="editor/file/edit",W=(0,C.ZP)(I.Z)((({theme:e})=>({height:"30px",width:"330px"}))),B=((0,C.ZP)(_.Z)((({theme:e})=>F(F({},e.typography.body2),{},{textAlign:"center",color:e.palette.text.secondary,height:128,lineHeight:"128px",cursor:"pointer"}))),({onOk:e,onClose:t,dataRef:n})=>{const[l,i]=(0,k.useState)(!1),[a,o]=(0,k.useState)({}),[r,c]=(0,k.useState)(!1),[d,s]=(0,k.useState)(""),[p,u]=(0,k.useState)([]),[m,h]=(0,k.useState)("*"),[g,f]=(0,k.useState)(""),[y,x]=(0,k.useState)("");(0,k.useImperativeHandle)(n,(()=>({init:b})));const b=(e,t,n)=>{let l=JSON.parse(v()(e));i(!0),o(l),c(t),s(n),E()},E=()=>{(0,D.s7)(R,{source_type:"models",project_type:"3d",pid:0}).then((e=>{if(0===e.code){let t=e.data;if(t&&t.length>0){let e=[];for(let n of t)"dir"===n.node_type&&e.push({value:n.id,label:n.name});u(e)}else u([])}})).catch((e=>{}))},Z=t=>{let n="",l="";r?(n="put",l=$):(n="post",l=T),(0,D.XD)(l,t,n).then((n=>{0===n.code&&(O.y.success("\u64cd\u4f5c\u6210\u529f"),i(!1),e&&e(t))}))};return k.createElement(z.Z,{size:"sm",title:d,visible:l,handleOk:()=>{Z(a)},handleClose:()=>{i(!1),t&&t()},fullWidth:!0},k.createElement(P.ZP,{container:!0,spacing:2},k.createElement(P.ZP,{item:!0,xs:12,sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",height:"80px"}},k.createElement("div",{style:{fontSize:"14px",width:"100px",textAlign:"right"}},"dir"===a.node_type?"\u76ee\u5f55":"\u6587\u4ef6","\u540d\u79f0\uff1a"),k.createElement(M,{size:"small",value:a.name,onChange:e=>{((e,t)=>{let n=F({},a);n[t]=e.target.value,o(n)})(e,"name")}})),"file"===a.node_type?k.createElement(k.Fragment,null,k.createElement(P.ZP,{item:!0,xs:12,sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",height:"80px"}},k.createElement("div",{style:{fontSize:"14px",width:"100px",textAlign:"right"}},"\u9009\u62e9\u6587\u4ef6\u5939\uff1a"),k.createElement(W,{value:a.pid,placeholder:"\u8bf7\u9009\u62e9",onChange:e=>{let t=e.target.value||0,n=F(F({},a),{},{pid:t});o(n)}},p&&w()(p).call(p,((e,t)=>k.createElement(j.Z,{key:t,value:e.value},e.label)))))):null))})},4992:(e,t,n)=>{n.d(t,{Z:()=>d});var l=n(32735),i=n(3346),a=n(3450),o=n(18163),r=n(1453);const c=(0,a.ZP)("iframe")((({theme:e})=>({width:"100%",height:"calc(100% - 32px)",border:"none",margin:"0",padding:"0"}))),d=({url:e,previewRef:t})=>{const[n,a]=(0,l.useState)(!1),d=(0,i.s0)();(0,l.useImperativeHandle)(t,(()=>({open:p})));const s=()=>{a(!1)},p=e=>{a(!0),u(e)},u=e=>{r.h.addEventListener("message",(t=>{const{type:n}=t.data;"close_preview"===n?a(!1):"apply-shop"===n&&(d("/editor?code="+e),s())}))};return l.createElement(o.Z,{size:"xl",title:"\u9884\u89c8",visible:n,handleOk:()=>{a(!1)},handleClose:s,fullWidth:!0,height:800,hideFooter:!0},l.createElement(c,{src:e}))}}}]);