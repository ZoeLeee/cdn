/*! For license information please see vender~640e94a9.05bbcf0e.js.LICENSE.txt */
"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4637],{55277:(e,t)=>{t.byteLength=function(e){var t=f(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,o=f(e),s=o[0],a=o[1],u=new r(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),l=0,c=a>0?s-4:s;for(n=0;n<c;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[l++]=255&t);1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,i=e.length,r=i%3,o=[],s=16383,a=0,f=i-r;a<f;a+=s)o.push(u(e,a,a+s>f?f:a+s));1===r?(t=e[i-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===r&&(t=(e[i-2]<<8)+e[i-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=o.length;s<a;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function f(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,i){for(var r,o,s=[],a=t;a<i;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=r)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},75291:(e,t,n)=>{const i=n(55277),r=n(2608),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=f,t.SlowBuffer=function(e){+e!=e&&(e=0);return f.alloc(+e)},t.INSPECT_MAX_BYTES=50;const s=2147483647;function a(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,f.prototype),t}function f(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return c(e)}return u(e,t,n)}function u(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!f.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|m(e,t);let i=a(n);const r=i.write(e,t);r!==n&&(i=i.slice(0,r));return i}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Y(e,Uint8Array)){const t=new Uint8Array(e);return h(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Y(e,ArrayBuffer)||e&&Y(e.buffer,ArrayBuffer))return h(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(Y(e,SharedArrayBuffer)||e&&Y(e.buffer,SharedArrayBuffer)))return h(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return f.from(i,t,n);const r=function(e){if(f.isBuffer(e)){const t=0|p(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||Z(e.length)?a(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return f.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return l(e),a(e<0?0:0|p(e))}function d(e){const t=e.length<0?0:0|p(e.length),n=a(t);for(let i=0;i<t;i+=1)n[i]=255&e[i];return n}function h(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let i;return i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(i,f.prototype),i}function p(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function m(e,t){if(f.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Y(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;let r=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return X(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(e).length;default:if(r)return i?-1:X(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){let i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return w(this,t,n);case"utf8":case"utf-8":return P(this,t,n);case"ascii":return F(this,t,n);case"latin1":case"binary":return R(this,t,n);case"base64":return C(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function v(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function _(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Z(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=f.from(t,i)),f.isBuffer(t))return 0===t.length?-1:x(e,t,n,i,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):x(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function x(e,t,n,i,r){let o,s=1,a=e.length,f=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;s=2,a/=2,f/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(r){let i=-1;for(o=n;o<a;o++)if(u(e,o)===u(t,-1===i?0:o-i)){if(-1===i&&(i=o),o-i+1===f)return i*s}else-1!==i&&(o-=o-i),i=-1}else for(n+f>a&&(n=a-f),o=n;o>=0;o--){let n=!0;for(let i=0;i<f;i++)if(u(e,o+i)!==u(t,i)){n=!1;break}if(n)return o}return-1}function T(e,t,n,i){n=Number(n)||0;const r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;const o=t.length;let s;for(i>o/2&&(i=o/2),s=0;s<i;++s){const i=parseInt(t.substr(2*s,2),16);if(Z(i))return s;e[n+s]=i}return s}function y(e,t,n,i){return q(X(t,e.length-n),e,n,i)}function E(e,t,n,i){return q(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function S(e,t,n,i){return q(j(t),e,n,i)}function b(e,t,n,i){return q(function(e,t){let n,i,r;const o=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),i=n>>8,r=n%256,o.push(r),o.push(i);return o}(t,e.length-n),e,n,i)}function C(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function P(e,t,n){n=Math.min(e.length,n);const i=[];let r=t;for(;r<n;){const t=e[r];let o=null,s=t>239?4:t>223?3:t>191?2:1;if(r+s<=n){let n,i,a,f;switch(s){case 1:t<128&&(o=t);break;case 2:n=e[r+1],128==(192&n)&&(f=(31&t)<<6|63&n,f>127&&(o=f));break;case 3:n=e[r+1],i=e[r+2],128==(192&n)&&128==(192&i)&&(f=(15&t)<<12|(63&n)<<6|63&i,f>2047&&(f<55296||f>57343)&&(o=f));break;case 4:n=e[r+1],i=e[r+2],a=e[r+3],128==(192&n)&&128==(192&i)&&128==(192&a)&&(f=(15&t)<<18|(63&n)<<12|(63&i)<<6|63&a,f>65535&&f<1114112&&(o=f))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,i.push(o>>>10&1023|55296),o=56320|1023&o),i.push(o),r+=s}return function(e){const t=e.length;if(t<=A)return String.fromCharCode.apply(String,e);let n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=A));return n}(i)}t.kMaxLength=s,f.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!f.TYPED_ARRAY_SUPPORT&&"undefined"!=typeof console&&console.error,Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}}),f.poolSize=8192,f.from=function(e,t,n){return u(e,t,n)},Object.setPrototypeOf(f.prototype,Uint8Array.prototype),Object.setPrototypeOf(f,Uint8Array),f.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},f.allocUnsafe=function(e){return c(e)},f.allocUnsafeSlow=function(e){return c(e)},f.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==f.prototype},f.compare=function(e,t){if(Y(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),Y(t,Uint8Array)&&(t=f.from(t,t.offset,t.byteLength)),!f.isBuffer(e)||!f.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},f.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return f.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const i=f.allocUnsafe(t);let r=0;for(n=0;n<e.length;++n){let t=e[n];if(Y(t,Uint8Array))r+t.length>i.length?(f.isBuffer(t)||(t=f.from(t)),t.copy(i,r)):Uint8Array.prototype.set.call(i,t,r);else{if(!f.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(i,r)}r+=t.length}return i},f.byteLength=m,f.prototype._isBuffer=!0,f.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)v(this,t,t+1);return this},f.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},f.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},f.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?P(this,0,e):g.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(e){if(!f.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===f.compare(this,e)},f.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},o&&(f.prototype[o]=f.prototype.inspect),f.prototype.compare=function(e,t,n,i,r){if(Y(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),!f.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;let o=(r>>>=0)-(i>>>=0),s=(n>>>=0)-(t>>>=0);const a=Math.min(o,s),u=this.slice(i,r),l=e.slice(t,n);for(let e=0;e<a;++e)if(u[e]!==l[e]){o=u[e],s=l[e];break}return o<s?-1:s<o?1:0},f.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},f.prototype.indexOf=function(e,t,n){return _(this,e,t,n,!0)},f.prototype.lastIndexOf=function(e,t,n){return _(this,e,t,n,!1)},f.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}const r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let o=!1;for(;;)switch(i){case"hex":return T(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":case"latin1":case"binary":return E(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const A=4096;function F(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function R(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function w(e,t,n){const i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);let r="";for(let i=t;i<n;++i)r+=$[e[i]];return r}function M(e,t,n){const i=e.slice(t,n);let r="";for(let e=0;e<i.length-1;e+=2)r+=String.fromCharCode(i[e]+256*i[e+1]);return r}function I(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,n,i,r,o){if(!f.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function N(e,t,n,i,r){k(t,i,r,e,n,7);let o=Number(t&BigInt(4294967295));e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,n}function O(e,t,n,i,r){k(t,i,r,e,n,7);let o=Number(t&BigInt(4294967295));e[n+7]=o,o>>=8,e[n+6]=o,o>>=8,e[n+5]=o,o>>=8,e[n+4]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=s,s>>=8,e[n+2]=s,s>>=8,e[n+1]=s,s>>=8,e[n]=s,n+8}function D(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U(e,t,n,i,o){return t=+t,n>>>=0,o||D(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function B(e,t,n,i,o){return t=+t,n>>>=0,o||D(e,0,n,8),r.write(e,t,n,i,52,8),n+8}f.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const i=this.subarray(e,t);return Object.setPrototypeOf(i,f.prototype),i},f.prototype.readUintLE=f.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);let i=this[e],r=1,o=0;for(;++o<t&&(r*=256);)i+=this[e+o]*r;return i},f.prototype.readUintBE=f.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);let i=this[e+--t],r=1;for(;t>0&&(r*=256);)i+=this[e+--t]*r;return i},f.prototype.readUint8=f.prototype.readUInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),this[e]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]|this[e+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]<<8|this[e+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},f.prototype.readBigUInt64LE=Q((function(e){W(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const i=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,r=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(i)+(BigInt(r)<<BigInt(32))})),f.prototype.readBigUInt64BE=Q((function(e){W(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const i=t*2**24+65536*this[++e]+256*this[++e]+this[++e],r=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(i)<<BigInt(32))+BigInt(r)})),f.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);let i=this[e],r=1,o=0;for(;++o<t&&(r*=256);)i+=this[e+o]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},f.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);let i=t,r=1,o=this[e+--i];for(;i>0&&(r*=256);)o+=this[e+--i]*r;return r*=128,o>=r&&(o-=Math.pow(2,8*t)),o},f.prototype.readInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},f.prototype.readInt16LE=function(e,t){e>>>=0,t||I(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},f.prototype.readInt16BE=function(e,t){e>>>=0,t||I(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},f.prototype.readInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},f.prototype.readInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},f.prototype.readBigInt64LE=Q((function(e){W(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const i=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),f.prototype.readBigInt64BE=Q((function(e){W(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const i=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),f.prototype.readFloatLE=function(e,t){return e>>>=0,t||I(e,4,this.length),r.read(this,e,!0,23,4)},f.prototype.readFloatBE=function(e,t){return e>>>=0,t||I(e,4,this.length),r.read(this,e,!1,23,4)},f.prototype.readDoubleLE=function(e,t){return e>>>=0,t||I(e,8,this.length),r.read(this,e,!0,52,8)},f.prototype.readDoubleBE=function(e,t){return e>>>=0,t||I(e,8,this.length),r.read(this,e,!1,52,8)},f.prototype.writeUintLE=f.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t>>>=0,n>>>=0,!i){L(this,e,t,n,Math.pow(2,8*n)-1,0)}let r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t>>>=0,n>>>=0,!i){L(this,e,t,n,Math.pow(2,8*n)-1,0)}let r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},f.prototype.writeUint8=f.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,1,255,0),this[t]=255&e,t+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},f.prototype.writeBigUInt64LE=Q((function(e,t=0){return N(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),f.prototype.writeBigUInt64BE=Q((function(e,t=0){return O(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),f.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t>>>=0,!i){const i=Math.pow(2,8*n-1);L(this,e,t,n,i-1,-i)}let r=0,o=1,s=0;for(this[t]=255&e;++r<n&&(o*=256);)e<0&&0===s&&0!==this[t+r-1]&&(s=1),this[t+r]=(e/o>>0)-s&255;return t+n},f.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t>>>=0,!i){const i=Math.pow(2,8*n-1);L(this,e,t,n,i-1,-i)}let r=n-1,o=1,s=0;for(this[t+r]=255&e;--r>=0&&(o*=256);)e<0&&0===s&&0!==this[t+r+1]&&(s=1),this[t+r]=(e/o>>0)-s&255;return t+n},f.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},f.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},f.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},f.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},f.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},f.prototype.writeBigInt64LE=Q((function(e,t=0){return N(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),f.prototype.writeBigInt64BE=Q((function(e,t=0){return O(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),f.prototype.writeFloatLE=function(e,t,n){return U(this,e,t,!0,n)},f.prototype.writeFloatBE=function(e,t,n){return U(this,e,t,!1,n)},f.prototype.writeDoubleLE=function(e,t,n){return B(this,e,t,!0,n)},f.prototype.writeDoubleBE=function(e,t,n){return B(this,e,t,!1,n)},f.prototype.copy=function(e,t,n,i){if(!f.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);const r=i-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),r},f.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!f.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){const t=e.charCodeAt(0);("utf8"===i&&t<128||"latin1"===i)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let r;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{const o=f.isBuffer(e)?e:f.from(e,i),s=o.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<n-t;++r)this[r+t]=o[r%s]}return this};const V={};function G(e,t,n){V[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function z(e){let t="",n=e.length;const i="-"===e[0]?1:0;for(;n>=i+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function k(e,t,n,i,r,o){if(e>n||e<t){const i="bigint"==typeof t?"n":"";let r;throw r=o>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${8*(o+1)}${i}`:`>= -(2${i} ** ${8*(o+1)-1}${i}) and < 2 ** ${8*(o+1)-1}${i}`:`>= ${t}${i} and <= ${n}${i}`,new V.ERR_OUT_OF_RANGE("value",r,e)}!function(e,t,n){W(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||H(t,e.length-(n+1))}(i,r,o)}function W(e,t){if("number"!=typeof e)throw new V.ERR_INVALID_ARG_TYPE(t,"number",e)}function H(e,t,n){if(Math.floor(e)!==e)throw W(e,n),new V.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new V.ERR_BUFFER_OUT_OF_BOUNDS;throw new V.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}G("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),G("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),G("ERR_OUT_OF_RANGE",(function(e,t,n){let i=`The value of "${e}" is out of range.`,r=n;return Number.isInteger(n)&&Math.abs(n)>2**32?r=z(String(n)):"bigint"==typeof n&&(r=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(r=z(r)),r+="n"),i+=` It must be ${t}. Received ${r}`,i}),RangeError);const K=/[^+/0-9A-Za-z-_]/g;function X(e,t){let n;t=t||1/0;const i=e.length;let r=null;const o=[];for(let s=0;s<i;++s){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function j(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(K,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,n,i){let r;for(r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function Y(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Z(e){return e!=e}const $=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const i=16*n;for(let r=0;r<16;++r)t[i+r]=e[n]+e[r]}return t}();function Q(e){return"undefined"==typeof BigInt?J:e}function J(){throw new Error("BigInt not supported")}},25175:(e,t,n)=>{n.d(t,{n:()=>_});var i=n(31191),r=n(96969),o=n(15631),s=n(64849),a=n(90360),f=n(74375),u=n(46110),l=n(72208),c=n(65273),d=n(48620),h=n(69543),p=(n(54081),n(46545),n(46462),n(43921),n(6506),n(67528),n(62495),n(37513),n(62348),n(87954),n(85019),n(34140),"precision highp float;uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;varying vec3 vPositionW;uniform float time;uniform float speed;uniform float movingSpeed;uniform vec3 fogColor;uniform sampler2D noiseTexture;uniform float fogDensity;varying float noise;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<helperFunctions>\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;uniform sampler2D diffuseSampler;uniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\nfloat random( vec3 scale,float seed ){return fract( sin( dot( gl_FragCoord.xyz+seed,scale ) )*43758.5453+seed ) ;}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(1.,1.,1.,1.);vec3 diffuseColor=vDiffuseColor.rgb;float alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nvec4 noiseTex=texture2D( noiseTexture,vDiffuseUV );vec2 T1=vDiffuseUV+vec2( 1.5,-1.5 )*time *0.02;vec2 T2=vDiffuseUV+vec2( -0.5,2.0 )*time*0.01*speed;T1.x+=noiseTex.x*2.0;T1.y+=noiseTex.y*2.0;T2.x-=noiseTex.y*0.2+time*0.001*movingSpeed;T2.y+=noiseTex.z*0.2+time*0.002*movingSpeed;float p=texture2D( noiseTexture,T1*3.0 ).a;vec4 lavaColor=texture2D( diffuseSampler,T2*4.0);vec4 temp=lavaColor*( vec4( p,p,p,p )*2. )+( lavaColor*lavaColor-0.1 );baseColor=temp;float depth=gl_FragCoord.z*4.0;const float LOG2=1.442695;float fogFactor=exp2(-fogDensity*fogDensity*depth*depth*LOG2 );fogFactor=1.0-clamp( fogFactor,0.0,1.0 );baseColor=mix( baseColor,vec4( fogColor,baseColor.w ),fogFactor );diffuseColor=baseColor.rgb;\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\nvec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float glossiness=0.;\n#include<lightFragment>[0]\n#include<lightFragment>[1]\n#include<lightFragment>[2]\n#include<lightFragment>[3]\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;vec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}");h.v.ShadersStore.lavaPixelShader=p;n(51802),n(67196),n(4511),n(52974),n(74255),n(97236),n(59725),n(35211),n(95441),n(97220),n(16744),n(53035);var m="precision highp float;uniform float time;uniform float lowFrequencySpeed;varying float noise;attribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;uniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;uniform mat4 diffuseMatrix;uniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n/* NOISE FUNCTIONS */\nvec3 mod289(vec3 x)\n{return x-floor(x*(1.0/289.0))*289.0;}\nvec4 mod289(vec4 x)\n{return x-floor(x*(1.0/289.0))*289.0;}\nvec4 permute(vec4 x)\n{return mod289(((x*34.0)+1.0)*x);}\nvec4 taylorInvSqrt(vec4 r)\n{return 1.79284291400159-0.85373472095314*r;}\nvec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}\nfloat pnoise(vec3 P,vec3 rep)\n{vec3 Pi0=mod(floor(P),rep); \nvec3 Pi1=mod(Pi0+vec3(1.0),rep); \nPi0=mod289(Pi0);Pi1=mod289(Pi1);vec3 Pf0=fract(P); \nvec3 Pf1=Pf0-vec3(1.0); \nvec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);vec4 iy=vec4(Pi0.yy,Pi1.yy);vec4 iz0=Pi0.zzzz;vec4 iz1=Pi1.zzzz;vec4 ixy=permute(permute(ix)+iy);vec4 ixy0=permute(ixy+iz0);vec4 ixy1=permute(ixy+iz1);vec4 gx0=ixy0*(1.0/7.0);vec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;gx0=fract(gx0);vec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);vec4 sz0=step(gz0,vec4(0.0));gx0-=sz0*(step(0.0,gx0)-0.5);gy0-=sz0*(step(0.0,gy0)-0.5);vec4 gx1=ixy1*(1.0/7.0);vec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;gx1=fract(gx1);vec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);vec4 sz1=step(gz1,vec4(0.0));gx1-=sz1*(step(0.0,gx1)-0.5);gy1-=sz1*(step(0.0,gy1)-0.5);vec3 g000=vec3(gx0.x,gy0.x,gz0.x);vec3 g100=vec3(gx0.y,gy0.y,gz0.y);vec3 g010=vec3(gx0.z,gy0.z,gz0.z);vec3 g110=vec3(gx0.w,gy0.w,gz0.w);vec3 g001=vec3(gx1.x,gy1.x,gz1.x);vec3 g101=vec3(gx1.y,gy1.y,gz1.y);vec3 g011=vec3(gx1.z,gy1.z,gz1.z);vec3 g111=vec3(gx1.w,gy1.w,gz1.w);vec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));g000*=norm0.x;g010*=norm0.y;g100*=norm0.z;g110*=norm0.w;vec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));g001*=norm1.x;g011*=norm1.y;g101*=norm1.z;g111*=norm1.w;float n000=dot(g000,Pf0);float n100=dot(g100,vec3(Pf1.x,Pf0.yz));float n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));float n110=dot(g110,vec3(Pf1.xy,Pf0.z));float n001=dot(g001,vec3(Pf0.xy,Pf1.z));float n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));float n011=dot(g011,vec3(Pf0.x,Pf1.yz));float n111=dot(g111,Pf1);vec3 fade_xyz=fade(Pf0);vec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);vec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);float n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);return 2.2*n_xyz;}\n/* END FUNCTION */\nfloat turbulence( vec3 p ) {float w=100.0;float t=-.5;for (float f=1.0 ; f<=10.0 ; f++ ){float power=pow( 2.0,f );t+=abs( pnoise( vec3( power*p ),vec3( 10.0,10.0,10.0 ) )/power );}\nreturn t;}\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\n#ifdef NORMAL\nnoise=10.0* -.10*turbulence( .5*normal+time*1.15 );float b=lowFrequencySpeed*5.0*pnoise( 0.05*position +vec3(time*1.025),vec3( 100.0 ) );float displacement=- 1.5*noise+b;vec3 newPosition=position+normal*displacement;gl_Position=viewProjection*finalWorld*vec4( newPosition,1.0 );vec4 worldPos=finalWorld*vec4(newPosition,1.0);vPositionW=vec3(worldPos);vNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x==0.)\n{vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));}\nelse\n{vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}";h.v.ShadersStore.lavaVertexShader=m;var g=n(38309),v=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.LIGHT0=!1,t.LIGHT1=!1,t.LIGHT2=!1,t.LIGHT3=!1,t.SPOTLIGHT0=!1,t.SPOTLIGHT1=!1,t.SPOTLIGHT2=!1,t.SPOTLIGHT3=!1,t.HEMILIGHT0=!1,t.HEMILIGHT1=!1,t.HEMILIGHT2=!1,t.HEMILIGHT3=!1,t.DIRLIGHT0=!1,t.DIRLIGHT1=!1,t.DIRLIGHT2=!1,t.DIRLIGHT3=!1,t.POINTLIGHT0=!1,t.POINTLIGHT1=!1,t.POINTLIGHT2=!1,t.POINTLIGHT3=!1,t.SHADOW0=!1,t.SHADOW1=!1,t.SHADOW2=!1,t.SHADOW3=!1,t.SHADOWS=!1,t.SHADOWESM0=!1,t.SHADOWESM1=!1,t.SHADOWESM2=!1,t.SHADOWESM3=!1,t.SHADOWPOISSON0=!1,t.SHADOWPOISSON1=!1,t.SHADOWPOISSON2=!1,t.SHADOWPOISSON3=!1,t.SHADOWPCF0=!1,t.SHADOWPCF1=!1,t.SHADOWPCF2=!1,t.SHADOWPCF3=!1,t.SHADOWPCSS0=!1,t.SHADOWPCSS1=!1,t.SHADOWPCSS2=!1,t.SHADOWPCSS3=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.INSTANCESCOLOR=!1,t.UNLIT=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,i.ZT)(t,e),t}(s.H),_=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.speed=1,i.movingSpeed=1,i.lowFrequencySpeed=1,i.fogDensity=.15,i._lastTime=0,i.diffuseColor=new o.Wo(1,1,1),i._disableLighting=!1,i._unlit=!1,i._maxSimultaneousLights=4,i._scaledDiffuse=new o.Wo,i}return(0,i.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new v);var i=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(i._areTexturesDirty&&(i._needUVs=!1,r.texturesEnabled&&this._diffuseTexture&&u.k.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;i._needUVs=!0,i.DIFFUSE=!0}if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=!0,a.G.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,i,!!n),a.G.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var s=new g.L;i.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(i,s),i.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),i.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var f=[l.o.PositionKind];i.NORMAL&&f.push(l.o.NormalKind),i.UV1&&f.push(l.o.UVKind),i.UV2&&f.push(l.o.UV2Kind),i.VERTEXCOLOR&&f.push(l.o.ColorKind),a.G.PrepareAttributesForBones(f,e,i,s),a.G.PrepareAttributesForInstances(f,i);var c=i.toString(),d=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","time","speed","movingSpeed","fogColor","fogDensity","lowFrequencySpeed"],h=["diffuseSampler","noiseTexture"],p=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("lava",{attributes:f,uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),i,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(i._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene(),r=n.materialDefines;if(r){var s=n.effect;s&&(this._activeEffect=s,r.UNLIT=this._unlit,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",i.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(i,s)&&(this.diffuseTexture&&u.k.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.noiseTexture&&this._activeEffect.setTexture("noiseTexture",this.noiseTexture),a.G.BindClipPlane(this._activeEffect,i),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),i.bindEyePosition(s)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*t.visibility),i.lightsEnabled&&!this.disableLighting&&a.G.BindLights(i,t,this._activeEffect,r),i.fogEnabled&&t.applyFog&&i.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",i.getViewMatrix()),a.G.BindFogParameters(i,t,this._activeEffect),this._lastTime+=i.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime*this.speed/1e3),this.fogColor||(this.fogColor=o.Wo.Black()),this._activeEffect.setColor3("fogColor",this.fogColor),this._activeEffect.setFloat("fogDensity",this.fogDensity),this._activeEffect.setFloat("lowFrequencySpeed",this.lowFrequencySpeed),this._activeEffect.setFloat("movingSpeed",this.movingSpeed),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.noiseTexture&&this.noiseTexture.animations&&this.noiseTexture.animations.length>0&&e.push(this.noiseTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this.diffuseTexture===t},t.prototype.dispose=function(t){this.diffuseTexture&&this.diffuseTexture.dispose(),this.noiseTexture&&this.noiseTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return r.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.LavaMaterial",t},t.prototype.getClassName=function(){return"LavaMaterial"},t.Parse=function(e,n,i){return r.p4.Parse((function(){return new t(e.name,n)}),e,n,i)},(0,i.gn)([(0,r.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,i.gn)([(0,r.oU)()],t.prototype,"noiseTexture",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"fogColor",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"speed",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"movingSpeed",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"lowFrequencySpeed",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"fogDensity",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,i.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,i.gn)([(0,r.qC)("unlit")],t.prototype,"_unlit",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"unlit",void 0),(0,i.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(f.a);(0,d.H)("BABYLON.LavaMaterial",_)},91484:(e,t,n)=>{n.d(t,{t:()=>_});var i=n(31191),r=n(96969),o=n(15631),s=n(64849),a=n(90360),f=n(74375),u=n(46110),l=n(72208),c=n(65273),d=n(48620),h=n(69543),p=(n(54081),n(46545),n(46462),n(43921),n(6506),n(67528),n(62495),n(37513),n(62348),n(87954),n(85019),n(34140),"precision highp float;\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform sampler2D mixMap1Sampler;\nuniform vec2 vTextureInfos;\n#ifdef MIXMAP2\nuniform sampler2D mixMap2Sampler;\n#endif\nuniform sampler2D diffuse1Sampler;\nuniform sampler2D diffuse2Sampler;\nuniform sampler2D diffuse3Sampler;\nuniform sampler2D diffuse4Sampler;\nuniform vec2 diffuse1Infos;\nuniform vec2 diffuse2Infos;\nuniform vec2 diffuse3Infos;\nuniform vec2 diffuse4Infos;\n#ifdef MIXMAP2\nuniform sampler2D diffuse5Sampler;\nuniform sampler2D diffuse6Sampler;\nuniform sampler2D diffuse7Sampler;\nuniform sampler2D diffuse8Sampler;\nuniform vec2 diffuse5Infos;\nuniform vec2 diffuse6Infos;\nuniform vec2 diffuse7Infos;\nuniform vec2 diffuse8Infos;\n#endif\n#endif\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 finalMixColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef MIXMAP2\nvec4 mixColor2=vec4(1.,1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\nfloat alpha=vDiffuseColor.a;\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nvec4 mixColor=texture2D(mixMap1Sampler,vTextureUV);\n#include<depthPrePass>\nmixColor.rgb*=vTextureInfos.y;\nvec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);\nvec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);\nvec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);\nvec4 diffuse4Color=texture2D(diffuse4Sampler,vTextureUV*diffuse4Infos);\ndiffuse1Color.rgb*=mixColor.r;\ndiffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,mixColor.g);\ndiffuse3Color.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,mixColor.b);\nfinalMixColor.rgb=mix(diffuse3Color.rgb,diffuse4Color.rgb,1.0-mixColor.a);\n#ifdef MIXMAP2\nmixColor=texture2D(mixMap2Sampler,vTextureUV);\nmixColor.rgb*=vTextureInfos.y;\nvec4 diffuse5Color=texture2D(diffuse5Sampler,vTextureUV*diffuse5Infos);\nvec4 diffuse6Color=texture2D(diffuse6Sampler,vTextureUV*diffuse6Infos);\nvec4 diffuse7Color=texture2D(diffuse7Sampler,vTextureUV*diffuse7Infos);\nvec4 diffuse8Color=texture2D(diffuse8Sampler,vTextureUV*diffuse8Infos);\ndiffuse5Color.rgb=mix(finalMixColor.rgb,diffuse5Color.rgb,mixColor.r);\ndiffuse6Color.rgb=mix(diffuse5Color.rgb,diffuse6Color.rgb,mixColor.g);\ndiffuse7Color.rgb=mix(diffuse6Color.rgb,diffuse7Color.rgb,mixColor.b);\nfinalMixColor.rgb=mix(diffuse7Color.rgb,diffuse8Color.rgb,1.0-mixColor.a);\n#endif\n#endif\n#ifdef VERTEXCOLOR\nfinalMixColor.rgb*=vColor.rgb;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor*finalMixColor.rgb,0.0,1.0);\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n");h.v.ShadersStore.mixPixelShader=p;n(51802),n(67196),n(4511),n(52974),n(74255),n(97236),n(59725),n(35211),n(95441),n(97220),n(16744),n(53035);var m="precision highp float;attribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;uniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;uniform mat4 textureMatrix;uniform vec2 vTextureInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vTextureInfos.x==0.)\n{vTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));}\nelse\n{vTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";h.v.ShadersStore.mixVertexShader=m;var g=n(38309),v=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.INSTANCESCOLOR=!1,t.MIXMAP2=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,i.ZT)(t,e),t}(s.H),_=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.diffuseColor=new o.Wo(1,1,1),i.specularColor=new o.Wo(0,0,0),i.specularPower=64,i._disableLighting=!1,i._maxSimultaneousLights=4,i}return(0,i.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new v);var i=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(r.texturesEnabled){if(!this._mixTexture1||!this._mixTexture1.isReady())return!1;if(i._needUVs=!0,u.k.DiffuseTextureEnabled){if(!this._diffuseTexture1||!this._diffuseTexture1.isReady())return!1;if(i.DIFFUSE=!0,!this._diffuseTexture2||!this._diffuseTexture2.isReady())return!1;if(!this._diffuseTexture3||!this._diffuseTexture3.isReady())return!1;if(!this._diffuseTexture4||!this._diffuseTexture4.isReady())return!1;if(this._mixTexture2){if(!this._mixTexture2.isReady())return!1;if(i.MIXMAP2=!0,!this._diffuseTexture5||!this._diffuseTexture5.isReady())return!1;if(!this._diffuseTexture6||!this._diffuseTexture6.isReady())return!1;if(!this._diffuseTexture7||!this._diffuseTexture7.isReady())return!1;if(!this._diffuseTexture8||!this._diffuseTexture8.isReady())return!1}}}if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=a.G.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,i,!!n),a.G.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var s=new g.L;i.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(i,s,this.maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),i.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var f=[l.o.PositionKind];i.NORMAL&&f.push(l.o.NormalKind),i.UV1&&f.push(l.o.UVKind),i.UV2&&f.push(l.o.UV2Kind),i.VERTEXCOLOR&&f.push(l.o.ColorKind),a.G.PrepareAttributesForBones(f,e,i,s),a.G.PrepareAttributesForInstances(f,i);var c=i.toString(),d=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMatrix","diffuse1Infos","diffuse2Infos","diffuse3Infos","diffuse4Infos","diffuse5Infos","diffuse6Infos","diffuse7Infos","diffuse8Infos"],h=["mixMap1Sampler","mixMap2Sampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","diffuse4Sampler","diffuse5Sampler","diffuse6Sampler","diffuse7Sampler","diffuse8Sampler"],p=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("mix",{attributes:f,uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),i,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(i._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene(),r=n.materialDefines;if(r){var o=n.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",i.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(i,o)&&(this._mixTexture1&&(this._activeEffect.setTexture("mixMap1Sampler",this._mixTexture1),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture1.coordinatesIndex,this._mixTexture1.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture1.getTextureMatrix()),u.k.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale)),this._diffuseTexture4&&(this._activeEffect.setTexture("diffuse4Sampler",this._diffuseTexture4),this._activeEffect.setFloat2("diffuse4Infos",this._diffuseTexture4.uScale,this._diffuseTexture4.vScale)))),this._mixTexture2&&(this._activeEffect.setTexture("mixMap2Sampler",this._mixTexture2),u.k.DiffuseTextureEnabled&&(this._diffuseTexture5&&(this._activeEffect.setTexture("diffuse5Sampler",this._diffuseTexture5),this._activeEffect.setFloat2("diffuse5Infos",this._diffuseTexture5.uScale,this._diffuseTexture5.vScale)),this._diffuseTexture6&&(this._activeEffect.setTexture("diffuse6Sampler",this._diffuseTexture6),this._activeEffect.setFloat2("diffuse6Infos",this._diffuseTexture6.uScale,this._diffuseTexture6.vScale)),this._diffuseTexture7&&(this._activeEffect.setTexture("diffuse7Sampler",this._diffuseTexture7),this._activeEffect.setFloat2("diffuse7Infos",this._diffuseTexture7.uScale,this._diffuseTexture7.vScale)),this._diffuseTexture8&&(this._activeEffect.setTexture("diffuse8Sampler",this._diffuseTexture8),this._activeEffect.setFloat2("diffuse8Infos",this._diffuseTexture8.uScale,this._diffuseTexture8.vScale)))),a.G.BindClipPlane(this._activeEffect,i),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),i.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),i.lightsEnabled&&!this.disableLighting&&a.G.BindLights(i,t,this._activeEffect,r,this.maxSimultaneousLights),i.fogEnabled&&t.applyFog&&i.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",i.getViewMatrix()),a.G.BindFogParameters(i,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this._mixTexture1&&this._mixTexture1.animations&&this._mixTexture1.animations.length>0&&e.push(this._mixTexture1),this._mixTexture2&&this._mixTexture2.animations&&this._mixTexture2.animations.length>0&&e.push(this._mixTexture2),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._mixTexture1&&t.push(this._mixTexture1),this._diffuseTexture1&&t.push(this._diffuseTexture1),this._diffuseTexture2&&t.push(this._diffuseTexture2),this._diffuseTexture3&&t.push(this._diffuseTexture3),this._diffuseTexture4&&t.push(this._diffuseTexture4),this._mixTexture2&&t.push(this._mixTexture2),this._diffuseTexture5&&t.push(this._diffuseTexture5),this._diffuseTexture6&&t.push(this._diffuseTexture6),this._diffuseTexture7&&t.push(this._diffuseTexture7),this._diffuseTexture8&&t.push(this._diffuseTexture8),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this._mixTexture1===t||(this._diffuseTexture1===t||(this._diffuseTexture2===t||(this._diffuseTexture3===t||(this._diffuseTexture4===t||(this._mixTexture2===t||(this._diffuseTexture5===t||(this._diffuseTexture6===t||(this._diffuseTexture7===t||this._diffuseTexture8===t)))))))))},t.prototype.dispose=function(t){this._mixTexture1&&this._mixTexture1.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return r.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.MixMaterial",t},t.prototype.getClassName=function(){return"MixMaterial"},t.Parse=function(e,n,i){return r.p4.Parse((function(){return new t(e.name,n)}),e,n,i)},(0,i.gn)([(0,r.oU)("mixTexture1")],t.prototype,"_mixTexture1",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"mixTexture1",void 0),(0,i.gn)([(0,r.oU)("mixTexture2")],t.prototype,"_mixTexture2",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"mixTexture2",void 0),(0,i.gn)([(0,r.oU)("diffuseTexture1")],t.prototype,"_diffuseTexture1",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture1",void 0),(0,i.gn)([(0,r.oU)("diffuseTexture2")],t.prototype,"_diffuseTexture2",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture2",void 0),(0,i.gn)([(0,r.oU)("diffuseTexture3")],t.prototype,"_diffuseTexture3",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture3",void 0),(0,i.gn)([(0,r.oU)("diffuseTexture4")],t.prototype,"_diffuseTexture4",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture4",void 0),(0,i.gn)([(0,r.oU)("diffuseTexture1")],t.prototype,"_diffuseTexture5",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture5",void 0),(0,i.gn)([(0,r.oU)("diffuseTexture2")],t.prototype,"_diffuseTexture6",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture6",void 0),(0,i.gn)([(0,r.oU)("diffuseTexture3")],t.prototype,"_diffuseTexture7",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture7",void 0),(0,i.gn)([(0,r.oU)("diffuseTexture4")],t.prototype,"_diffuseTexture8",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture8",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"specularColor",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"specularPower",void 0),(0,i.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,i.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(f.a);(0,d.H)("BABYLON.MixMaterial",_)},10963:(e,t,n)=>{n.d(t,{o:()=>_});var i=n(31191),r=n(96969),o=n(15631),s=n(64849),a=n(90360),f=n(74375),u=n(46110),l=n(72208),c=n(65273),d=n(48620),h=n(69543),p=(n(54081),n(46545),n(46462),n(43921),n(6506),n(67528),n(62495),n(37513),n(62348),n(87954),n(85019),n(34140),"precision highp float;\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef LIGHTING\n#include<helperFunctions>\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#endif\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef NORMAL\nbaseColor=mix(baseColor,vec4(vNormalW,1.0),0.5);\n#endif\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef LIGHTING\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0]\n#include<lightFragment>[1]\n#include<lightFragment>[2]\n#include<lightFragment>[3]\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse= baseColor.rgb;\n#endif\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}");h.v.ShadersStore.normalPixelShader=p;n(51802),n(67196),n(4511),n(52974),n(74255),n(97236),n(59725),n(35211),n(95441),n(97220),n(16744);var m="precision highp float;\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x==0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";h.v.ShadersStore.normalVertexShader=m;var g=n(38309),v=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.LIGHT0=!1,t.LIGHT1=!1,t.LIGHT2=!1,t.LIGHT3=!1,t.SPOTLIGHT0=!1,t.SPOTLIGHT1=!1,t.SPOTLIGHT2=!1,t.SPOTLIGHT3=!1,t.HEMILIGHT0=!1,t.HEMILIGHT1=!1,t.HEMILIGHT2=!1,t.HEMILIGHT3=!1,t.DIRLIGHT0=!1,t.DIRLIGHT1=!1,t.DIRLIGHT2=!1,t.DIRLIGHT3=!1,t.POINTLIGHT0=!1,t.POINTLIGHT1=!1,t.POINTLIGHT2=!1,t.POINTLIGHT3=!1,t.SHADOW0=!1,t.SHADOW1=!1,t.SHADOW2=!1,t.SHADOW3=!1,t.SHADOWS=!1,t.SHADOWESM0=!1,t.SHADOWESM1=!1,t.SHADOWESM2=!1,t.SHADOWESM3=!1,t.SHADOWPOISSON0=!1,t.SHADOWPOISSON1=!1,t.SHADOWPOISSON2=!1,t.SHADOWPOISSON3=!1,t.SHADOWPCF0=!1,t.SHADOWPCF1=!1,t.SHADOWPCF2=!1,t.SHADOWPCF3=!1,t.SHADOWPCSS0=!1,t.SHADOWPCSS1=!1,t.SHADOWPCSS2=!1,t.SHADOWPCSS3=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.LIGHTING=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,i.ZT)(t,e),t}(s.H),_=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.diffuseColor=new o.Wo(1,1,1),i._disableLighting=!1,i._maxSimultaneousLights=4,i}return(0,i.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()||e.visibility<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new v);var i=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(i._areTexturesDirty&&(i._needUVs=!1,r.texturesEnabled&&this._diffuseTexture&&u.k.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;i._needUVs=!0,i.DIFFUSE=!0}if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=!0,a.G.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,i,!!n),i.LIGHTING=!this._disableLighting,a.G.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var s=new g.L;i.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(i,s),i.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),i.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var f=[l.o.PositionKind];i.NORMAL&&f.push(l.o.NormalKind),i.UV1&&f.push(l.o.UVKind),i.UV2&&f.push(l.o.UV2Kind),a.G.PrepareAttributesForBones(f,e,i,s),a.G.PrepareAttributesForInstances(f,i);var c=i.toString(),d=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix"],h=["diffuseSampler"],p=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:i,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("normal",{attributes:f,uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),i,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(i._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene(),r=n.materialDefines;if(r){var o=n.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",i.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(i,o)&&(this.diffuseTexture&&u.k.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),a.G.BindClipPlane(this._activeEffect,i),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),i.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),i.lightsEnabled&&!this.disableLighting&&a.G.BindLights(i,t,this._activeEffect,r),i.fogEnabled&&t.applyFog&&i.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",i.getViewMatrix()),a.G.BindFogParameters(i,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this.diffuseTexture===t},t.prototype.dispose=function(t){this.diffuseTexture&&this.diffuseTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return r.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.NormalMaterial",t},t.prototype.getClassName=function(){return"NormalMaterial"},t.Parse=function(e,n,i){return r.p4.Parse((function(){return new t(e.name,n)}),e,n,i)},(0,i.gn)([(0,r.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,i.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,i.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(f.a);(0,d.H)("BABYLON.NormalMaterial",_)},994:(e,t,n)=>{n.d(t,{O:()=>v});var i=n(31191),r=n(96969),o=n(15631),s=n(64849),a=n(90360),f=n(74375),u=n(72208),l=n(65273),c=n(48620),d=n(69543),h=(n(54081),n(46545),n(46462),n(43921),n(6506),n(67528),n(62495),n(37513),n(87954),n(85019),n(34140),"precision highp float;\nuniform vec4 vEyePosition;\nuniform float alpha;\nuniform vec3 shadowColor;\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0..1]\nvec4 color=vec4(shadowColor,(1.0-clamp(shadow,0.,1.))*alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}");d.v.ShadersStore.shadowOnlyPixelShader=h;n(51802),n(67196),n(4511),n(52974),n(74255),n(97236),n(59725),n(35211),n(95441),n(97220),n(16744);var p="precision highp float;\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";d.v.ShadersStore.shadowOnlyVertexShader=p;var m=n(38309),g=function(e){function t(){var t=e.call(this)||this;return t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,i.ZT)(t,e),t}(s.H),v=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._needAlphaBlending=!0,i.shadowColor=o.Wo.Black(),i}return(0,i.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this._needAlphaBlending},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},Object.defineProperty(t.prototype,"activeLight",{get:function(){return this._activeLight},set:function(e){this._activeLight=e},enumerable:!1,configurable:!0}),t.prototype._getFirstShadowLightForMesh=function(e){for(var t=0,n=e.lightSources;t<n.length;t++){var i=n[t];if(i.shadowEnabled)return i}return null},t.prototype.isReadyForSubMesh=function(e,t,n){var i;if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new g);var r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;var s=o.getEngine();if(this._activeLight)for(var f=0,l=e.lightSources;f<l.length;f++){var c=l[f];if(c.shadowEnabled){if(this._activeLight===c)break;var d=e.lightSources.indexOf(this._activeLight);-1!==d&&(e.lightSources.splice(d,1),e.lightSources.splice(0,0,this._activeLight));break}}a.G.PrepareDefinesForFrameBoundValues(o,s,r,!!n),a.G.PrepareDefinesForMisc(e,o,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),r),r._needNormals=a.G.PrepareDefinesForLights(o,e,r,!1,1);var h=null===(i=this._getFirstShadowLightForMesh(e))||void 0===i?void 0:i.getShadowGenerator();if(this._needAlphaBlending=!0,h&&h.getClassName&&"CascadedShadowGenerator"===h.getClassName()){var p=h;this._needAlphaBlending=!p.autoCalcDepthBounds}if(a.G.PrepareDefinesForAttributes(e,r,!1,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();var v=new m.L;r.FOG&&v.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(r,v,1),r.NUM_BONE_INFLUENCERS>0&&v.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;var _=[u.o.PositionKind];r.NORMAL&&_.push(u.o.NormalKind),a.G.PrepareAttributesForBones(_,e,r,v),a.G.PrepareAttributesForInstances(_,r);var x=r.toString(),T=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","alpha","shadowColor","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6"],y=new Array,E=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:T,uniformBuffersNames:E,samplers:y,defines:r,maxSimultaneousLights:1}),t.setEffect(o.getEngine().createEffect("shadowOnly",{attributes:_,uniformsNames:T,uniformBuffersNames:E,samplers:y,defines:x,fallbacks:v,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:1}},s),r,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(r._renderId=o.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene(),r=n.materialDefines;if(r){var o=n.effect;if(o){if(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",i.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(i,o)&&(a.G.BindClipPlane(this._activeEffect,i),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._activeEffect.setFloat("alpha",this.alpha),this._activeEffect.setColor3("shadowColor",this.shadowColor),i.bindEyePosition(o)),i.lightsEnabled){a.G.BindLights(i,t,this._activeEffect,r,1);var s=this._getFirstShadowLightForMesh(t);s&&(s._renderId=-1)}(i.fogEnabled&&t.applyFog&&i.fogMode!==l.x.FOGMODE_NONE||r.SHADOWCSM0)&&this._activeEffect.setMatrix("view",i.getViewMatrix()),a.G.BindFogParameters(i,t,this._activeEffect),this._afterBind(t,this._activeEffect)}}},t.prototype.clone=function(e){var n=this;return r.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.ShadowOnlyMaterial",t},t.prototype.getClassName=function(){return"ShadowOnlyMaterial"},t.Parse=function(e,n,i){return r.p4.Parse((function(){return new t(e.name,n)}),e,n,i)},t}(f.a);(0,c.H)("BABYLON.ShadowOnlyMaterial",v)},40345:(e,t,n)=>{n.d(t,{q:()=>_});var i=n(31191),r=n(96969),o=n(15631),s=n(64849),a=n(90360),f=n(74375),u=n(46110),l=n(72208),c=n(65273),d=n(48620),h=n(69543),p=(n(54081),n(46545),n(46462),n(43921),n(6506),n(67528),n(62495),n(37513),n(62348),n(87954),n(85019),n(34140),"precision highp float;\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif \n#include<lightFragment>[0..maxSimultaneousLights]\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}");h.v.ShadersStore.simplePixelShader=p;n(51802),n(67196),n(4511),n(52974),n(74255),n(97236),n(59725),n(35211),n(95441),n(97220),n(16744),n(53035);var m="precision highp float;\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x==0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";h.v.ShadersStore.simpleVertexShader=m;var g=n(38309),v=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.INSTANCESCOLOR=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,i.ZT)(t,e),t}(s.H),_=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.diffuseColor=new o.Wo(1,1,1),i._disableLighting=!1,i._maxSimultaneousLights=4,i}return(0,i.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new v);var i=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(i._areTexturesDirty&&(i._needUVs=!1,r.texturesEnabled&&this._diffuseTexture&&u.k.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;i._needUVs=!0,i.DIFFUSE=!0}if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=a.G.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,i,!!n),a.G.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var s=new g.L;i.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(i,s,this.maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),i.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var f=[l.o.PositionKind];i.NORMAL&&f.push(l.o.NormalKind),i.UV1&&f.push(l.o.UVKind),i.UV2&&f.push(l.o.UV2Kind),i.VERTEXCOLOR&&f.push(l.o.ColorKind),a.G.PrepareAttributesForBones(f,e,i,s),a.G.PrepareAttributesForInstances(f,i);var c=i.toString(),d=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix"],h=["diffuseSampler"],p=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("simple",{attributes:f,uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights-1}},o),i,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(i._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene(),r=n.materialDefines;if(r){var o=n.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",i.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(i,o)&&(this._diffuseTexture&&u.k.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),a.G.BindClipPlane(this._activeEffect,i),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),i.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),i.lightsEnabled&&!this.disableLighting&&a.G.BindLights(i,t,this._activeEffect,r,this.maxSimultaneousLights),i.fogEnabled&&t.applyFog&&i.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",i.getViewMatrix()),a.G.BindFogParameters(i,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this.diffuseTexture===t},t.prototype.dispose=function(t){this._diffuseTexture&&this._diffuseTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return r.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.SimpleMaterial",t},t.prototype.getClassName=function(){return"SimpleMaterial"},t.Parse=function(e,n,i){return r.p4.Parse((function(){return new t(e.name,n)}),e,n,i)},(0,i.gn)([(0,r.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,i.gn)([(0,r.n9)("diffuse")],t.prototype,"diffuseColor",void 0),(0,i.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,i.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(f.a);(0,d.H)("BABYLON.SimpleMaterial",_)},70272:(e,t,n)=>{n.d(t,{f:()=>v});var i=n(31191),r=n(96969),o=n(58095),s=n(64849),a=n(90360),f=n(74375),u=n(72208),l=n(65273),c=n(48620),d=n(69543),h=(n(67528),n(62495),n(37513),n(85019),n(34140),"precision highp float;\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;\nuniform vec3 cameraOffset;\nuniform vec3 up;\nuniform float luminance;\nuniform float turbidity;\nuniform float rayleigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\nuniform vec3 sunPosition;\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;\nconst float pi=3.141592653589793238462643383279502884197169;\nconst float n=1.0003;\nconst float N=2.545E25;\nconst float pn=0.035;\nconst vec3 lambda=vec3(680E-9,550E-9,450E-9);\nconst vec3 K=vec3(0.686,0.678,0.666);\nconst float v=4.0;\nconst float rayleighZenithLength=8.4E3;\nconst float mieZenithLength=1.25E3;\nconst float EE=1000.0;\nconst float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;\nconst float cutoffAngle=pi/1.95;\nconst float steepness=1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));\n}\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005/vec3(94,40,18);\n}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));\n}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{\nfloat c=(0.2*T )*10E-18;\nreturn 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;\n}\nfloat hgPhase(float cosTheta,float g)\n{\nreturn (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));\n}\nfloat A=0.15;\nfloat B=0.50;\nfloat C=0.10;\nfloat D=0.20;\nfloat EEE=0.02;\nfloat F=0.30;\nfloat W=1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;\n}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\nfloat rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));\nvec3 sunDirection=normalize(sunPosition);\nfloat sunE=sunIntensity(dot(sunDirection,up));\nvec3 betaR=simplifiedRayleigh()*rayleighCoefficient;\nvec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;\nfloat zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));\nfloat sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nfloat sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nvec3 Fex=exp(-(betaR*sR+betaM*sM));\nfloat cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);\nfloat rPhase=rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta=betaR*rPhase;\nfloat mPhase=hgPhase(cosTheta,mieDirectionalG);\nvec3 betaMTheta=betaM*mPhase;\nvec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));\nLin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));\nvec3 direction=normalize(vPositionW-cameraPosition);\nfloat theta=acos(direction.y);\nfloat phi=atan(direction.z,direction.x);\nvec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);\nvec3 L0=vec3(0.1)*Fex;\nfloat sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\nL0+=(sunE*19000.0*Fex)*sundisk;\nvec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor=(Lin+L0);\ntexColor*=0.04 ;\ntexColor+=vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance=1.0;\nfloat fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;\nvec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\nvec3 retColor=curr*whiteScale;\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n");d.v.ShadersStore.skyPixelShader=h;n(52974),n(74255),n(95441),n(97220);var p="precision highp float;\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);\nvec4 worldPos=world*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";d.v.ShadersStore.skyVertexShader=p;var m=n(38309),g=function(e){function t(){var t=e.call(this)||this;return t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.POINTSIZE=!1,t.FOG=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,i.ZT)(t,e),t}(s.H),v=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.luminance=1,i.turbidity=10,i.rayleigh=2,i.mieCoefficient=.005,i.mieDirectionalG=.8,i.distance=500,i.inclination=.49,i.azimuth=.25,i.sunPosition=new o.P(0,100,0),i.useSunPosition=!1,i.cameraOffset=o.P.Zero(),i.up=o.P.Up(),i._cameraPosition=o.P.Zero(),i._skyOrientation=new o._f,i}return(0,i.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new g);var n=t.materialDefines,i=this.getScene();if(this._isReadyForSubMesh(t))return!0;if(a.G.PrepareDefinesForMisc(e,i,!1,this.pointsCloud,this.fogEnabled,!1,n),a.G.PrepareDefinesForAttributes(e,n,!0,!1),n.IMAGEPROCESSINGPOSTPROCESS!==i.imageProcessingConfiguration.applyByPostProcess&&n.markAsMiscDirty(),n.isDirty){n.markAsProcessed(),i.resetCachedMaterial();var r=new m.L;n.FOG&&r.addFallback(1,"FOG"),n.IMAGEPROCESSINGPOSTPROCESS=i.imageProcessingConfiguration.applyByPostProcess;var o=[u.o.PositionKind];n.VERTEXCOLOR&&o.push(u.o.ColorKind);var s=n.toString();t.setEffect(i.getEngine().createEffect("sky",o,["world","viewProjection","view","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"],[],s,r,this.onCompiled,this.onError),n,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(n._renderId=i.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene();if(n.materialDefines){var r=n.effect;if(r){this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",i.getTransformMatrix()),this._mustRebind(i,r)&&(a.G.BindClipPlane(this._activeEffect,i),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize)),i.fogEnabled&&t.applyFog&&i.fogMode!==l.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",i.getViewMatrix()),a.G.BindFogParameters(i,t,this._activeEffect);var s=i.activeCamera;if(s){var f=s.getWorldMatrix();this._cameraPosition.x=f.m[12],this._cameraPosition.y=f.m[13],this._cameraPosition.z=f.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){var u=Math.PI*(this.inclination-.5),c=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(c)*Math.cos(u),this.sunPosition.y=this.distance*Math.sin(-u),this.sunPosition.z=this.distance*Math.sin(c)*Math.cos(u),o._f.FromUnitVectorsToRef(o.P.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(t,this._activeEffect)}}},t.prototype.getAnimatables=function(){return[]},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return r.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.SkyMaterial",t},t.prototype.getClassName=function(){return"SkyMaterial"},t.Parse=function(e,n,i){return r.p4.Parse((function(){return new t(e.name,n)}),e,n,i)},(0,i.gn)([(0,r.qC)()],t.prototype,"luminance",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"turbidity",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"rayleigh",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"mieCoefficient",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"mieDirectionalG",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"distance",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"inclination",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"azimuth",void 0),(0,i.gn)([(0,r.hd)()],t.prototype,"sunPosition",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"useSunPosition",void 0),(0,i.gn)([(0,r.hd)()],t.prototype,"cameraOffset",void 0),(0,i.gn)([(0,r.hd)()],t.prototype,"up",void 0),t}(f.a);(0,c.H)("BABYLON.SkyMaterial",v)},9673:(e,t,n)=>{n.d(t,{F:()=>_});var i=n(31191),r=n(96969),o=n(15631),s=n(64849),a=n(90360),f=n(74375),u=n(46110),l=n(72208),c=n(65273),d=n(48620),h=n(69543),p=(n(54081),n(46545),n(46462),n(43921),n(6506),n(67528),n(62495),n(37513),n(62348),n(87954),n(85019),n(34140),"precision highp float;\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform sampler2D textureSampler;\nuniform vec2 vTextureInfos;\nuniform sampler2D diffuse1Sampler;\nuniform sampler2D diffuse2Sampler;\nuniform sampler2D diffuse3Sampler;\nuniform vec2 diffuse1Infos;\nuniform vec2 diffuse2Infos;\nuniform vec2 diffuse3Infos;\n#endif\n#ifdef BUMP\nuniform sampler2D bump1Sampler;\nuniform sampler2D bump2Sampler;\nuniform sampler2D bump3Sampler;\n#endif\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\n#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\nreturn mat3(tangent*invmax,binormal*invmax,normal);\n}\nvec3 perturbNormal(vec3 viewDir,vec3 mixColor)\n{\nvec3 bump1Color=texture2D(bump1Sampler,vTextureUV*diffuse1Infos).xyz;\nvec3 bump2Color=texture2D(bump2Sampler,vTextureUV*diffuse2Infos).xyz;\nvec3 bump3Color=texture2D(bump3Sampler,vTextureUV*diffuse3Infos).xyz;\nbump1Color.rgb*=mixColor.r;\nbump2Color.rgb=mix(bump1Color.rgb,bump2Color.rgb,mixColor.g);\nvec3 map=mix(bump2Color.rgb,bump3Color.rgb,mixColor.b);\nmap=map*255./127.-128./127.;\nmat3 TBN=cotangent_frame(vNormalW*vTextureInfos.y,-viewDir,vTextureUV);\nreturn normalize(TBN*map);\n}\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\nfloat alpha=vDiffuseColor.a;\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(textureSampler,vTextureUV);\n#if defined(BUMP) && defined(DIFFUSE)\nnormalW=perturbNormal(viewDirectionW,baseColor.rgb);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vTextureInfos.y;\nvec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);\nvec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);\nvec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);\ndiffuse1Color.rgb*=baseColor.r;\ndiffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,baseColor.g);\nbaseColor.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,baseColor.b);\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nbaseColor.rgb*=vColor.rgb;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor*baseColor.rgb,0.0,1.0);\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n");h.v.ShadersStore.terrainPixelShader=p;n(51802),n(67196),n(4511),n(52974),n(74255),n(97236),n(59725),n(35211),n(95441),n(97220),n(16744),n(53035);var m="precision highp float;attribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;uniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;uniform mat4 textureMatrix;uniform vec2 vTextureInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vTextureInfos.x==0.)\n{vTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));}\nelse\n{vTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";h.v.ShadersStore.terrainVertexShader=m;var g=n(38309),v=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.BUMP=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.INSTANCESCOLOR=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,i.ZT)(t,e),t}(s.H),_=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.diffuseColor=new o.Wo(1,1,1),i.specularColor=new o.Wo(0,0,0),i.specularPower=64,i._disableLighting=!1,i._maxSimultaneousLights=4,i}return(0,i.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new v);var i=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(r.texturesEnabled){if(!this.mixTexture||!this.mixTexture.isReady())return!1;if(i._needUVs=!0,u.k.DiffuseTextureEnabled){if(!this.diffuseTexture1||!this.diffuseTexture1.isReady())return!1;if(!this.diffuseTexture2||!this.diffuseTexture2.isReady())return!1;if(!this.diffuseTexture3||!this.diffuseTexture3.isReady())return!1;i.DIFFUSE=!0}if(this.bumpTexture1&&this.bumpTexture2&&this.bumpTexture3&&u.k.BumpTextureEnabled){if(!this.bumpTexture1.isReady())return!1;if(!this.bumpTexture2.isReady())return!1;if(!this.bumpTexture3.isReady())return!1;i._needNormals=!0,i.BUMP=!0}}if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=a.G.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,i,!!n),a.G.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var s=new g.L;i.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(i,s,this.maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),i.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var f=[l.o.PositionKind];i.NORMAL&&f.push(l.o.NormalKind),i.UV1&&f.push(l.o.UVKind),i.UV2&&f.push(l.o.UV2Kind),i.VERTEXCOLOR&&f.push(l.o.ColorKind),a.G.PrepareAttributesForBones(f,e,i,s),a.G.PrepareAttributesForInstances(f,i);var c=i.toString(),d=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMatrix","diffuse1Infos","diffuse2Infos","diffuse3Infos"],h=["textureSampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","bump1Sampler","bump2Sampler","bump3Sampler"],p=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("terrain",{attributes:f,uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),i,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(i._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene(),r=n.materialDefines;if(r){var o=n.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",i.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(i,o)&&(this.mixTexture&&(this._activeEffect.setTexture("textureSampler",this._mixTexture),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture.coordinatesIndex,this._mixTexture.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture.getTextureMatrix()),u.k.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale))),u.k.BumpTextureEnabled&&i.getEngine().getCaps().standardDerivatives&&(this._bumpTexture1&&this._activeEffect.setTexture("bump1Sampler",this._bumpTexture1),this._bumpTexture2&&this._activeEffect.setTexture("bump2Sampler",this._bumpTexture2),this._bumpTexture3&&this._activeEffect.setTexture("bump3Sampler",this._bumpTexture3))),a.G.BindClipPlane(this._activeEffect,i),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),i.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),i.lightsEnabled&&!this.disableLighting&&a.G.BindLights(i,t,this._activeEffect,r,this.maxSimultaneousLights),i.fogEnabled&&t.applyFog&&i.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",i.getViewMatrix()),a.G.BindFogParameters(i,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&e.push(this.mixTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._mixTexture&&t.push(this._mixTexture),this._diffuseTexture1&&t.push(this._diffuseTexture1),this._diffuseTexture2&&t.push(this._diffuseTexture2),this._diffuseTexture3&&t.push(this._diffuseTexture3),this._bumpTexture1&&t.push(this._bumpTexture1),this._bumpTexture2&&t.push(this._bumpTexture2),this._bumpTexture3&&t.push(this._bumpTexture3),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this._mixTexture===t||(this._diffuseTexture1===t||(this._diffuseTexture2===t||(this._diffuseTexture3===t||(this._bumpTexture1===t||(this._bumpTexture2===t||this._bumpTexture3===t))))))},t.prototype.dispose=function(t){this.mixTexture&&this.mixTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return r.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.TerrainMaterial",t},t.prototype.getClassName=function(){return"TerrainMaterial"},t.Parse=function(e,n,i){return r.p4.Parse((function(){return new t(e.name,n)}),e,n,i)},(0,i.gn)([(0,r.oU)("mixTexture")],t.prototype,"_mixTexture",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"mixTexture",void 0),(0,i.gn)([(0,r.oU)("diffuseTexture1")],t.prototype,"_diffuseTexture1",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture1",void 0),(0,i.gn)([(0,r.oU)("diffuseTexture2")],t.prototype,"_diffuseTexture2",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture2",void 0),(0,i.gn)([(0,r.oU)("diffuseTexture3")],t.prototype,"_diffuseTexture3",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture3",void 0),(0,i.gn)([(0,r.oU)("bumpTexture1")],t.prototype,"_bumpTexture1",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture1",void 0),(0,i.gn)([(0,r.oU)("bumpTexture2")],t.prototype,"_bumpTexture2",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture2",void 0),(0,i.gn)([(0,r.oU)("bumpTexture3")],t.prototype,"_bumpTexture3",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture3",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"specularColor",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"specularPower",void 0),(0,i.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,i.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(f.a);(0,d.H)("BABYLON.TerrainMaterial",_)},97706:(e,t,n)=>{n.d(t,{P:()=>_});var i=n(31191),r=n(96969),o=n(15631),s=n(64849),a=n(90360),f=n(74375),u=n(46110),l=n(72208),c=n(65273),d=n(48620),h=n(69543),p=(n(54081),n(46545),n(46462),n(43921),n(6506),n(67528),n(62495),n(37513),n(62348),n(87954),n(85019),n(34140),"precision highp float;\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nvarying vec3 vPositionW;\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#ifdef DIFFUSEX\nvarying vec2 vTextureUVX;\nuniform sampler2D diffuseSamplerX;\n#ifdef BUMPX\nuniform sampler2D normalSamplerX;\n#endif\n#endif\n#ifdef DIFFUSEY\nvarying vec2 vTextureUVY;\nuniform sampler2D diffuseSamplerY;\n#ifdef BUMPY\nuniform sampler2D normalSamplerY;\n#endif\n#endif\n#ifdef DIFFUSEZ\nvarying vec2 vTextureUVZ;\nuniform sampler2D diffuseSamplerZ;\n#ifdef BUMPZ\nuniform sampler2D normalSamplerZ;\n#endif\n#endif\n#ifdef NORMAL\nvarying mat3 tangentSpace;\n#endif\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 baseColor=vec4(0.,0.,0.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\nfloat alpha=vDiffuseColor.a;\n#ifdef NORMAL\nvec3 normalW=tangentSpace[2];\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\nvec4 baseNormal=vec4(0.0,0.0,0.0,1.0);\nnormalW*=normalW;\n#ifdef DIFFUSEX\nbaseColor+=texture2D(diffuseSamplerX,vTextureUVX)*normalW.x;\n#ifdef BUMPX\nbaseNormal+=texture2D(normalSamplerX,vTextureUVX)*normalW.x;\n#endif\n#endif\n#ifdef DIFFUSEY\nbaseColor+=texture2D(diffuseSamplerY,vTextureUVY)*normalW.y;\n#ifdef BUMPY\nbaseNormal+=texture2D(normalSamplerY,vTextureUVY)*normalW.y;\n#endif\n#endif\n#ifdef DIFFUSEZ\nbaseColor+=texture2D(diffuseSamplerZ,vTextureUVZ)*normalW.z;\n#ifdef BUMPZ\nbaseNormal+=texture2D(normalSamplerZ,vTextureUVZ)*normalW.z;\n#endif\n#endif\n#ifdef NORMAL\nnormalW=normalize((2.0*baseNormal.xyz-1.0)*tangentSpace);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nbaseColor.rgb*=vColor.rgb;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n");h.v.ShadersStore.triplanarPixelShader=p;n(51802),n(67196),n(4511),n(52974),n(74255),n(97236),n(59725),n(35211),n(95441),n(97220),n(16744),n(53035);var m="precision highp float;\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSEX\nvarying vec2 vTextureUVX;\n#endif\n#ifdef DIFFUSEY\nvarying vec2 vTextureUVY;\n#endif\n#ifdef DIFFUSEZ\nvarying vec2 vTextureUVZ;\n#endif\nuniform float tileSize;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying mat3 tangentSpace;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void)\n{\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef DIFFUSEX\nvTextureUVX=worldPos.zy/tileSize;\n#endif\n#ifdef DIFFUSEY\nvTextureUVY=worldPos.xz/tileSize;\n#endif\n#ifdef DIFFUSEZ\nvTextureUVZ=worldPos.xy/tileSize;\n#endif\n#ifdef NORMAL\nvec3 xtan=vec3(0,0,1);\nvec3 xbin=vec3(0,1,0);\nvec3 ytan=vec3(1,0,0);\nvec3 ybin=vec3(0,0,1);\nvec3 ztan=vec3(1,0,0);\nvec3 zbin=vec3(0,1,0);\nvec3 normalizedNormal=normalize(normal);\nnormalizedNormal*=normalizedNormal;\nvec3 worldBinormal=normalize(xbin*normalizedNormal.x+ybin*normalizedNormal.y+zbin*normalizedNormal.z);\nvec3 worldTangent=normalize(xtan*normalizedNormal.x+ytan*normalizedNormal.y+ztan*normalizedNormal.z);\nworldTangent=(world*vec4(worldTangent,0.0)).xyz;\nworldBinormal=(world*vec4(worldBinormal,0.0)).xyz;\nvec3 worldNormal=(world*vec4(normalize(normal),0.0)).xyz;\ntangentSpace[0]=worldTangent;\ntangentSpace[1]=worldBinormal;\ntangentSpace[2]=worldNormal;\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";h.v.ShadersStore.triplanarVertexShader=m;var g=n(38309),v=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSEX=!1,t.DIFFUSEY=!1,t.DIFFUSEZ=!1,t.BUMPX=!1,t.BUMPY=!1,t.BUMPZ=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.NORMAL=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.INSTANCESCOLOR=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,i.ZT)(t,e),t}(s.H),_=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.tileSize=1,i.diffuseColor=new o.Wo(1,1,1),i.specularColor=new o.Wo(.2,.2,.2),i.specularPower=64,i._disableLighting=!1,i._maxSimultaneousLights=4,i}return(0,i.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new v);var i=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(i._areTexturesDirty&&r.texturesEnabled){if(u.k.DiffuseTextureEnabled)for(var s=[this.diffuseTextureX,this.diffuseTextureY,this.diffuseTextureZ],f=["DIFFUSEX","DIFFUSEY","DIFFUSEZ"],c=0;c<s.length;c++)if(s[c]){if(!s[c].isReady())return!1;i[f[c]]=!0}if(u.k.BumpTextureEnabled)for(s=[this.normalTextureX,this.normalTextureY,this.normalTextureZ],f=["BUMPX","BUMPY","BUMPZ"],c=0;c<s.length;c++)if(s[c]){if(!s[c].isReady())return!1;i[f[c]]=!0}}if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._needNormals=a.G.PrepareDefinesForLights(r,e,i,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,i,!!n),a.G.PrepareDefinesForAttributes(e,i,!0,!0),i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var d=new g.L;i.FOG&&d.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(i,d,this.maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&d.addCPUSkinningFallback(0,e),i.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var h=[l.o.PositionKind];i.NORMAL&&h.push(l.o.NormalKind),i.VERTEXCOLOR&&h.push(l.o.ColorKind),a.G.PrepareAttributesForBones(h,e,i,d),a.G.PrepareAttributesForInstances(h,i);var p=i.toString(),m=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","tileSize"],_=["diffuseSamplerX","diffuseSamplerY","diffuseSamplerZ","normalSamplerX","normalSamplerY","normalSamplerZ"],x=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:m,uniformBuffersNames:x,samplers:_,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("triplanar",{attributes:h,uniformsNames:m,uniformBuffersNames:x,samplers:_,defines:p,fallbacks:d,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),i,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(i._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene(),r=n.materialDefines;if(r){var o=n.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",i.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._activeEffect.setFloat("tileSize",this.tileSize),i.getCachedMaterial()!==this&&(this.diffuseTextureX&&this._activeEffect.setTexture("diffuseSamplerX",this.diffuseTextureX),this.diffuseTextureY&&this._activeEffect.setTexture("diffuseSamplerY",this.diffuseTextureY),this.diffuseTextureZ&&this._activeEffect.setTexture("diffuseSamplerZ",this.diffuseTextureZ),this.normalTextureX&&this._activeEffect.setTexture("normalSamplerX",this.normalTextureX),this.normalTextureY&&this._activeEffect.setTexture("normalSamplerY",this.normalTextureY),this.normalTextureZ&&this._activeEffect.setTexture("normalSamplerZ",this.normalTextureZ),a.G.BindClipPlane(this._activeEffect,i),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),i.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),i.lightsEnabled&&!this.disableLighting&&a.G.BindLights(i,t,this._activeEffect,r,this.maxSimultaneousLights),i.fogEnabled&&t.applyFog&&i.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",i.getViewMatrix()),a.G.BindFogParameters(i,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&e.push(this.mixTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTextureX&&t.push(this._diffuseTextureX),this._diffuseTextureY&&t.push(this._diffuseTextureY),this._diffuseTextureZ&&t.push(this._diffuseTextureZ),this._normalTextureX&&t.push(this._normalTextureX),this._normalTextureY&&t.push(this._normalTextureY),this._normalTextureZ&&t.push(this._normalTextureZ),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this._diffuseTextureX===t||(this._diffuseTextureY===t||(this._diffuseTextureZ===t||(this._normalTextureX===t||(this._normalTextureY===t||this._normalTextureZ===t)))))},t.prototype.dispose=function(t){this.mixTexture&&this.mixTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return r.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.TriPlanarMaterial",t},t.prototype.getClassName=function(){return"TriPlanarMaterial"},t.Parse=function(e,n,i){return r.p4.Parse((function(){return new t(e.name,n)}),e,n,i)},(0,i.gn)([(0,r.oU)()],t.prototype,"mixTexture",void 0),(0,i.gn)([(0,r.oU)("diffuseTextureX")],t.prototype,"_diffuseTextureX",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTextureX",void 0),(0,i.gn)([(0,r.oU)("diffuseTexturY")],t.prototype,"_diffuseTextureY",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTextureY",void 0),(0,i.gn)([(0,r.oU)("diffuseTextureZ")],t.prototype,"_diffuseTextureZ",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTextureZ",void 0),(0,i.gn)([(0,r.oU)("normalTextureX")],t.prototype,"_normalTextureX",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"normalTextureX",void 0),(0,i.gn)([(0,r.oU)("normalTextureY")],t.prototype,"_normalTextureY",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"normalTextureY",void 0),(0,i.gn)([(0,r.oU)("normalTextureZ")],t.prototype,"_normalTextureZ",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"normalTextureZ",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"tileSize",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"specularColor",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"specularPower",void 0),(0,i.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,i.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(f.a);(0,d.H)("BABYLON.TriPlanarMaterial",_)},83610:(e,t,n)=>{n.d(t,{H:()=>C});var i=n(31191),r=n(96969),o=n(58095),s=n(15631),a=n(62464),f=n(34941),u=n(7788),l=n(63784),c=n(64849),d=n(90622),h=n(90360),p=n(74375),m=n(46110),g=n(72208),v=n(65273),_=n(48620),x=n(69543),T=(n(54081),n(69464),n(47157),n(46545),n(46462),n(43921),n(6506),n(67528),n(55371),n(62495),n(37513),n(87954),n(32860),n(85019),"#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<helperFunctions>\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#ifdef BUMP\nvarying vec2 vNormalUV;\n#ifdef BUMPSUPERIMPOSE\nvarying vec2 vNormalUV2;\n#endif\nuniform sampler2D normalSampler;\nuniform vec2 vNormalInfos;\n#endif\nuniform sampler2D refractionSampler;\nuniform sampler2D reflectionSampler;\nconst float LOG2=1.442695;\nuniform vec3 cameraPosition;\nuniform vec4 waterColor;\nuniform float colorBlendFactor;\nuniform vec4 waterColor2;\nuniform float colorBlendFactor2;\nuniform float bumpHeight;\nuniform float time;\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\nvarying vec3 vPosition;\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\nfloat alpha=vDiffuseColor.a;\n#ifdef BUMP\n#ifdef BUMPSUPERIMPOSE\nbaseColor=0.6*texture2D(normalSampler,vNormalUV)+0.4*texture2D(normalSampler,vec2(vNormalUV2.x,vNormalUV2.y));\n#else\nbaseColor=texture2D(normalSampler,vNormalUV);\n#endif\nvec3 bumpColor=baseColor.rgb;\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\nbaseColor.rgb*=vNormalInfos.y;\n#else\nvec3 bumpColor=vec3(1.0);\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef NORMAL\nvec2 perturbation=bumpHeight*(baseColor.rg-0.5);\n#ifdef BUMPAFFECTSREFLECTION\nvec3 normalW=normalize(vNormalW+vec3(perturbation.x*8.0,0.0,perturbation.y*8.0));\nif (normalW.y<0.0) {\nnormalW.y=-normalW.y;\n}\n#else\nvec3 normalW=normalize(vNormalW);\n#endif\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\nvec2 perturbation=bumpHeight*(vec2(1.0,1.0)-0.5);\n#endif\n#ifdef FRESNELSEPARATE\n#ifdef REFLECTION\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation*0.5,0.0,1.0);\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\n#ifdef IS_REFRACTION_LINEAR\nrefractiveColor.rgb=toGammaSpace(refractiveColor.rgb);\n#endif\nvec2 projectedReflectionTexCoords=clamp(vec2(\nvReflectionMapTexCoord.x/vReflectionMapTexCoord.z+perturbation.x*0.3,\nvReflectionMapTexCoord.y/vReflectionMapTexCoord.z+perturbation.y\n),0.0,1.0);\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\n#ifdef IS_REFLECTION_LINEAR\nreflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);\n#endif\nvec3 upVector=vec3(0.0,1.0,0.0);\nfloat fresnelTerm=clamp(abs(pow(dot(viewDirectionW,upVector),3.0)),0.05,0.65);\nfloat IfresnelTerm=1.0-fresnelTerm;\nrefractiveColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*refractiveColor;\nreflectiveColor=IfresnelTerm*colorBlendFactor2*waterColor+(1.0-colorBlendFactor2*IfresnelTerm)*reflectiveColor;\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*IfresnelTerm;\nbaseColor=combinedColor;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#else \n#ifdef REFLECTION\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation,0.0,1.0);\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\n#ifdef IS_REFRACTION_LINEAR\nrefractiveColor.rgb=toGammaSpace(refractiveColor.rgb);\n#endif\nvec2 projectedReflectionTexCoords=clamp(vReflectionMapTexCoord.xy/vReflectionMapTexCoord.z+perturbation,0.0,1.0);\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\n#ifdef IS_REFLECTION_LINEAR\nreflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);\n#endif\nvec3 upVector=vec3(0.0,1.0,0.0);\nfloat fresnelTerm=max(dot(viewDirectionW,upVector),0.0);\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*(1.0-fresnelTerm);\nbaseColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*combinedColor;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#endif\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#elif defined(IMAGEPROCESSING)\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\ngl_FragColor=color;\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n");x.v.ShadersStore.waterPixelShader=T;n(51802),n(67196),n(4511),n(52974),n(74255),n(97236),n(59725),n(35211),n(95441),n(97220),n(16744),n(53035),n(45983);var y="precision highp float;\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef BUMP\nvarying vec2 vNormalUV;\n#ifdef BUMPSUPERIMPOSE\nvarying vec2 vNormalUV2;\n#endif\nuniform mat4 normalMatrix;\nuniform vec2 vNormalInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR)\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<logDepthDeclaration>\nuniform mat4 worldReflectionViewProjection;\nuniform vec2 windDirection;\nuniform float waveLength;\nuniform float time;\nuniform float windForce;\nuniform float waveHeight;\nuniform float waveSpeed;\nuniform float waveCount;\nvarying vec3 vPosition;\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef BUMP\nif (vNormalInfos.x==0.)\n{\nvNormalUV=vec2(normalMatrix*vec4((uv*1.0)/waveLength+time*windForce*windDirection,1.0,0.0));\n#ifdef BUMPSUPERIMPOSE\nvNormalUV2=vec2(normalMatrix*vec4((uv*0.721)/waveLength+time*1.2*windForce*windDirection,1.0,0.0));\n#endif\n}\nelse\n{\nvNormalUV=vec2(normalMatrix*vec4((uv2*1.0)/waveLength+time*windForce*windDirection ,1.0,0.0));\n#ifdef BUMPSUPERIMPOSE\nvNormalUV2=vec2(normalMatrix*vec4((uv2*0.721)/waveLength+time*1.2*windForce*windDirection ,1.0,0.0));\n#endif\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\nfloat finalWaveCount=1.0/(waveCount*0.5);\nvec3 p=position;\nfloat newY=(sin(((p.x/finalWaveCount)+time*waveSpeed))*waveHeight*windDirection.x*5.0)\n+ (cos(((p.z/finalWaveCount)+ time*waveSpeed))*waveHeight*windDirection.y*5.0);\np.y+=abs(newY);\ngl_Position=viewProjection*finalWorld*vec4(p,1.0);\n#ifdef REFLECTION\nworldPos=viewProjection*finalWorld*vec4(p,1.0);\nvPosition=position;\nvRefractionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\nvRefractionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\nvRefractionMapTexCoord.z=worldPos.w;\nworldPos=worldReflectionViewProjection*vec4(position,1.0);\nvReflectionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\nvReflectionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\nvReflectionMapTexCoord.z=worldPos.w;\n#endif\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";x.v.ShadersStore.waterVertexShader=y;var E=n(38309),S=n(41525),b=function(e){function t(){var t=e.call(this)||this;return t.BUMP=!1,t.REFLECTION=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.INSTANCESCOLOR=!1,t.SPECULARTERM=!1,t.LOGARITHMICDEPTH=!1,t.USE_REVERSE_DEPTHBUFFER=!1,t.FRESNELSEPARATE=!1,t.BUMPSUPERIMPOSE=!1,t.BUMPAFFECTSREFLECTION=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,i.ZT)(t,e),t}(c.H),C=function(e){function t(t,n,i){void 0===i&&(i=new o.FM(512,512));var r=e.call(this,t,n)||this;return r.renderTargetSize=i,r.diffuseColor=new s.Wo(1,1,1),r.specularColor=new s.Wo(0,0,0),r.specularPower=64,r._disableLighting=!1,r._maxSimultaneousLights=4,r.windForce=6,r.windDirection=new o.FM(0,1),r.waveHeight=.4,r.bumpHeight=.4,r._bumpSuperimpose=!1,r._fresnelSeparate=!1,r._bumpAffectsReflection=!1,r.waterColor=new s.Wo(.1,.1,.6),r.colorBlendFactor=.2,r.waterColor2=new s.Wo(.1,.1,.6),r.colorBlendFactor2=.2,r.waveLength=.1,r.waveSpeed=1,r.waveCount=20,r.disableClipPlane=!1,r._renderTargets=new u.t(16),r._mesh=null,r._reflectionTransform=o.y3.Zero(),r._lastTime=0,r._lastDeltaTime=0,r._createRenderTargets(r.getScene(),i),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),r._renderTargets.push(r._reflectionRTT),r._renderTargets.push(r._refractionRTT),r._renderTargets},r._imageProcessingConfiguration=r.getScene().imageProcessingConfiguration,r._imageProcessingConfiguration&&(r._imageProcessingObserver=r._imageProcessingConfiguration.onUpdateParameters.add((function(){r._markAllSubMeshesAsImageProcessingDirty()}))),r}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this._refractionRTT},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionTexture",{get:function(){return this._reflectionRTT},enumerable:!1,configurable:!0}),t.prototype.addToRenderList=function(e){this._refractionRTT&&this._refractionRTT.renderList&&this._refractionRTT.renderList.push(e),this._reflectionRTT&&this._reflectionRTT.renderList&&this._reflectionRTT.renderList.push(e)},t.prototype.enableRenderTargets=function(e){var t=e?1:0;this._refractionRTT&&(this._refractionRTT.refreshRate=t),this._reflectionRTT&&(this._reflectionRTT.refreshRate=t)},t.prototype.getRenderList=function(){return this._refractionRTT?this._refractionRTT.renderList:[]},Object.defineProperty(t.prototype,"renderTargetsEnabled",{get:function(){return!(this._refractionRTT&&0===this._refractionRTT.refreshRate)},enumerable:!1,configurable:!0}),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new b);var i=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(i._areTexturesDirty&&(i._needUVs=!1,r.texturesEnabled)){if(this.bumpTexture&&m.k.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;i._needUVs=!0,i.BUMP=!0}m.k.ReflectionTextureEnabled&&(i.REFLECTION=!0)}if(h.G.PrepareDefinesForFrameBoundValues(r,o,i,!!n),h.G.PrepareDefinesForMisc(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),i),i._areMiscDirty&&(this._fresnelSeparate&&(i.FRESNELSEPARATE=!0),this._bumpSuperimpose&&(i.BUMPSUPERIMPOSE=!0),this._bumpAffectsReflection&&(i.BUMPAFFECTSREFLECTION=!0)),i._needNormals=h.G.PrepareDefinesForLights(r,e,i,!0,this._maxSimultaneousLights,this._disableLighting),i._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(i),i.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,i.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(h.G.PrepareDefinesForAttributes(e,i,!0,!0),this._mesh=e,this._waitingRenderList){for(var s=0;s<this._waitingRenderList.length;s++)this.addToRenderList(r.getNodeById(this._waitingRenderList[s]));this._waitingRenderList=null}if(i.isDirty){i.markAsProcessed(),r.resetCachedMaterial();var a=new E.L;i.FOG&&a.addFallback(1,"FOG"),i.LOGARITHMICDEPTH&&a.addFallback(0,"LOGARITHMICDEPTH"),h.G.HandleFallbacksForShadows(i,a,this.maxSimultaneousLights),i.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e);var f=[g.o.PositionKind];i.NORMAL&&f.push(g.o.NormalKind),i.UV1&&f.push(g.o.UVKind),i.UV2&&f.push(g.o.UV2Kind),i.VERTEXCOLOR&&f.push(g.o.ColorKind),h.G.PrepareAttributesForBones(f,e,i,a),h.G.PrepareAttributesForInstances(f,i);var u=i.toString(),l=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vNormalInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","normalMatrix","logarithmicDepthConstant","worldReflectionViewProjection","windDirection","waveLength","time","windForce","cameraPosition","bumpHeight","waveHeight","waterColor","waterColor2","colorBlendFactor","colorBlendFactor2","waveSpeed","waveCount"],c=["normalSampler","refractionSampler","reflectionSampler"],p=new Array;d.$&&(d.$.PrepareUniforms(l,i),d.$.PrepareSamplers(c,i)),h.G.PrepareUniformsAndSamplersList({uniformsNames:l,uniformBuffersNames:p,samplers:c,defines:i,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("water",{attributes:f,uniformsNames:l,uniformBuffersNames:p,samplers:c,defines:u,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},o),i,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(i._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene(),r=n.materialDefines;if(r){var o=n.effect;if(o&&this._mesh){this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",i.getTransformMatrix()),h.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(i,o)&&(this.bumpTexture&&m.k.BumpTextureEnabled&&(this._activeEffect.setTexture("normalSampler",this.bumpTexture),this._activeEffect.setFloat2("vNormalInfos",this.bumpTexture.coordinatesIndex,this.bumpTexture.level),this._activeEffect.setMatrix("normalMatrix",this.bumpTexture.getTextureMatrix())),h.G.BindClipPlane(this._activeEffect,i),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),i.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),i.lightsEnabled&&!this.disableLighting&&h.G.BindLights(i,t,this._activeEffect,r,this.maxSimultaneousLights),i.fogEnabled&&t.applyFog&&i.fogMode!==v.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",i.getViewMatrix()),h.G.BindFogParameters(i,t,this._activeEffect),h.G.BindLogDepth(r,this._activeEffect,i),m.k.ReflectionTextureEnabled&&(this._activeEffect.setTexture("refractionSampler",this._refractionRTT),this._activeEffect.setTexture("reflectionSampler",this._reflectionRTT));var s=this._mesh.getWorldMatrix().multiply(this._reflectionTransform).multiply(i.getProjectionMatrix()),a=i.getEngine().getDeltaTime();a!==this._lastDeltaTime&&(this._lastDeltaTime=a,this._lastTime+=this._lastDeltaTime),this._activeEffect.setMatrix("worldReflectionViewProjection",s),this._activeEffect.setVector2("windDirection",this.windDirection),this._activeEffect.setFloat("waveLength",this.waveLength),this._activeEffect.setFloat("time",this._lastTime/1e5),this._activeEffect.setFloat("windForce",this.windForce),this._activeEffect.setFloat("waveHeight",this.waveHeight),this._activeEffect.setFloat("bumpHeight",this.bumpHeight),this._activeEffect.setColor4("waterColor",this.waterColor,1),this._activeEffect.setFloat("colorBlendFactor",this.colorBlendFactor),this._activeEffect.setColor4("waterColor2",this.waterColor2,1),this._activeEffect.setFloat("colorBlendFactor2",this.colorBlendFactor2),this._activeEffect.setFloat("waveSpeed",this.waveSpeed),this._activeEffect.setFloat("waveCount",this.waveCount),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect),this._afterBind(t,this._activeEffect)}}},t.prototype._createRenderTargets=function(e,t){var n,i=this;this._refractionRTT=new l._(name+"_refraction",{width:t.x,height:t.y},e,!1,!0),this._refractionRTT.wrapU=f.g.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.wrapV=f.g.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.ignoreCameraViewport=!0,this._reflectionRTT=new l._(name+"_reflection",{width:t.x,height:t.y},e,!1,!0),this._reflectionRTT.wrapU=f.g.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.wrapV=f.g.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.ignoreCameraViewport=!0;var r,s=null,u=o.y3.Zero();this._refractionRTT.onBeforeRender=function(){if(i._mesh&&(n=i._mesh.isVisible,i._mesh.isVisible=!1),!i.disableClipPlane){s=e.clipPlane;var t=i._mesh?i._mesh.position.y:0;e.clipPlane=a.J.FromPositionAndNormal(new o.P(0,t+.05,0),new o.P(0,1,0))}},this._refractionRTT.onAfterRender=function(){i._mesh&&(i._mesh.isVisible=n),i.disableClipPlane||(e.clipPlane=s)},this._reflectionRTT.onBeforeRender=function(){if(i._mesh&&(n=i._mesh.isVisible,i._mesh.isVisible=!1),!i.disableClipPlane){s=e.clipPlane;var t=i._mesh?i._mesh.position.y:0;e.clipPlane=a.J.FromPositionAndNormal(new o.P(0,t-.05,0),new o.P(0,-1,0)),o.y3.ReflectionToRef(e.clipPlane,u)}r=e.getViewMatrix(),u.multiplyToRef(r,i._reflectionTransform),e.setTransformMatrix(i._reflectionTransform,e.getProjectionMatrix()),e.getEngine().cullBackFaces=!1,e._mirroredCameraPosition=o.P.TransformCoordinates(e.activeCamera.position,u)},this._reflectionRTT.onAfterRender=function(){i._mesh&&(i._mesh.isVisible=n),e.clipPlane=s,e.setTransformMatrix(r,e.getProjectionMatrix()),e.getEngine().cullBackFaces=null,e._mirroredCameraPosition=null}},t.prototype.getAnimatables=function(){var e=[];return this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&e.push(this.bumpTexture),this._reflectionRTT&&this._reflectionRTT.animations&&this._reflectionRTT.animations.length>0&&e.push(this._reflectionRTT),this._refractionRTT&&this._refractionRTT.animations&&this._refractionRTT.animations.length>0&&e.push(this._refractionRTT),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._bumpTexture&&t.push(this._bumpTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._bumpTexture===t},t.prototype.dispose=function(t){this.bumpTexture&&this.bumpTexture.dispose();var n=this.getScene().customRenderTargets.indexOf(this._refractionRTT);-1!=n&&this.getScene().customRenderTargets.splice(n,1),n=-1,-1!=(n=this.getScene().customRenderTargets.indexOf(this._reflectionRTT))&&this.getScene().customRenderTargets.splice(n,1),this._reflectionRTT&&this._reflectionRTT.dispose(),this._refractionRTT&&this._refractionRTT.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return r.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);if(t.customType="BABYLON.WaterMaterial",t.renderList=[],this._refractionRTT&&this._refractionRTT.renderList)for(var n=0;n<this._refractionRTT.renderList.length;n++)t.renderList.push(this._refractionRTT.renderList[n].id);return t},t.prototype.getClassName=function(){return"WaterMaterial"},t.Parse=function(e,n,i){var o=r.p4.Parse((function(){return new t(e.name,n)}),e,n,i);return o._waitingRenderList=e.renderList,o},t.CreateDefaultMesh=function(e,t){return(0,S.$6)(e,{width:512,height:512,subdivisions:32,updatable:!1},t)},(0,i.gn)([(0,r.oU)("bumpTexture")],t.prototype,"_bumpTexture",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"specularColor",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"specularPower",void 0),(0,i.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,i.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"windForce",void 0),(0,i.gn)([(0,r.QC)()],t.prototype,"windDirection",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"waveHeight",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"bumpHeight",void 0),(0,i.gn)([(0,r.qC)("bumpSuperimpose")],t.prototype,"_bumpSuperimpose",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsMiscDirty")],t.prototype,"bumpSuperimpose",void 0),(0,i.gn)([(0,r.qC)("fresnelSeparate")],t.prototype,"_fresnelSeparate",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsMiscDirty")],t.prototype,"fresnelSeparate",void 0),(0,i.gn)([(0,r.qC)("bumpAffectsReflection")],t.prototype,"_bumpAffectsReflection",void 0),(0,i.gn)([(0,r.wz)("_markAllSubMeshesAsMiscDirty")],t.prototype,"bumpAffectsReflection",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"waterColor",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"colorBlendFactor",void 0),(0,i.gn)([(0,r.n9)()],t.prototype,"waterColor2",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"colorBlendFactor2",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"waveLength",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"waveSpeed",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"waveCount",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"disableClipPlane",void 0),(0,i.gn)([(0,r.qC)()],t.prototype,"useLogarithmicDepth",null),t}(p.a);(0,_.H)("BABYLON.WaterMaterial",C)},47835:(e,t,n)=>{n.r(t),n.d(t,{EXT_mesh_gpu_instancing:()=>he,GLTF2Export:()=>D,GLTFData:()=>m,KHR_lights_punctual:()=>X,KHR_materials_clearcoat:()=>Y,KHR_materials_ior:()=>oe,KHR_materials_iridescence:()=>$,KHR_materials_sheen:()=>ee,KHR_materials_specular:()=>ae,KHR_materials_transmission:()=>ce,KHR_materials_unlit:()=>ie,KHR_materials_volume:()=>ue,KHR_texture_transform:()=>G,OBJExport:()=>s,STLExport:()=>pe,_BinaryWriter:()=>N,_Exporter:()=>L,_GLTFAnimation:()=>p,_GLTFMaterialExporter:()=>R,_GLTFUtilities:()=>d,__IGLTFExporterExtension:()=>a,__IGLTFExporterExtensionV2:()=>O});var i,r=n(58095),o=n(13514),s=function(){function e(){}return e.OBJ=function(e,t,n,i){var s=[],a=1,f=1;t&&(n||(n="mat"),s.push("mtllib "+n+".mtl"));for(var u=0;u<e.length;u++){s.push("g object"+u),s.push("o object_"+u);var l=null;if(i){var c=e[u].computeWorldMatrix(!0);l=new r.y3,c.invertToRef(l),e[u].bakeTransformIntoVertices(c)}if(t){var d=e[u].material;d&&s.push("usemtl "+d.id)}var h=e[u].geometry;if(h){var p=h.getVerticesData("position"),m=h.getVerticesData("normal"),g=h.getVerticesData("uv"),v=h.getIndices(),_=0,x=0;if(p&&v){for(var T=0;T<p.length;T+=3)e[0].getScene().useRightHandedSystem?s.push("v "+p[T]+" "+p[T+1]+" "+p[T+2]):s.push("v "+p[T]+" "+p[T+1]+" "+-p[T+2]),_++;if(null!=m)for(T=0;T<m.length;T+=3)s.push("vn "+m[T]+" "+m[T+1]+" "+m[T+2]);if(null!=g)for(T=0;T<g.length;T+=2)s.push("vt "+g[T]+" "+g[T+1]),x++;for(T=0;T<v.length;T+=3){var y=[String(v[T+2]+a),String(v[T+1]+a),String(v[T]+a)],E=[String(v[T+2]+f),String(v[T+1]+f),String(v[T]+f)],S=["","",""],b=y,C=null!=g?E:S,P=null!=m?y:S;s.push("f "+b[0]+"/"+C[0]+"/"+P[0]+" "+b[1]+"/"+C[1]+"/"+P[1]+" "+b[2]+"/"+C[2]+"/"+P[2])}i&&l&&e[u].bakeTransformIntoVertices(l),a+=_,f+=x}else o.w1.Warn("There are no position vertices or indices on the mesh!")}else o.w1.Warn("No geometry is present on the mesh")}return s.join("\n")},e.MTL=function(e){var t=[],n=e.material;t.push("newmtl mat1"),t.push("  Ns "+n.specularPower.toFixed(4)),t.push("  Ni 1.5000"),t.push("  d "+n.alpha.toFixed(4)),t.push("  Tr 0.0000"),t.push("  Tf 1.0000 1.0000 1.0000"),t.push("  illum 2"),t.push("  Ka "+n.ambientColor.r.toFixed(4)+" "+n.ambientColor.g.toFixed(4)+" "+n.ambientColor.b.toFixed(4)),t.push("  Kd "+n.diffuseColor.r.toFixed(4)+" "+n.diffuseColor.g.toFixed(4)+" "+n.diffuseColor.b.toFixed(4)),t.push("  Ks "+n.specularColor.r.toFixed(4)+" "+n.specularColor.g.toFixed(4)+" "+n.specularColor.b.toFixed(4)),t.push("  Ke "+n.emissiveColor.r.toFixed(4)+" "+n.emissiveColor.g.toFixed(4)+" "+n.emissiveColor.b.toFixed(4));return n.ambientTexture&&t.push("  map_Ka "+n.ambientTexture.name),n.diffuseTexture&&t.push("  map_Kd "+n.diffuseTexture.name),n.specularTexture&&t.push("  map_Ks "+n.specularTexture.name),n.bumpTexture&&t.push("  map_bump -imfchan z "+n.bumpTexture.name),n.opacityTexture&&t.push("  map_d "+n.opacityTexture.name),t.join("\n")},e}(),a=0,f=n(18770),u=n(30700),l=n(8471),c=n(91243),d=function(){function e(){}return e._CreateBufferView=function(e,t,n,i,r){var o={buffer:e,byteLength:n};return t&&(o.byteOffset=t),r&&(o.name=r),i&&(o.byteStride=i),o},e._CreateAccessor=function(e,t,n,i,r,o,s,a){var f={name:t,bufferView:e,componentType:i,count:r,type:n};return null!=s&&(f.min=s),null!=a&&(f.max=a),null!=o&&(f.byteOffset=o),f},e._CalculateMinMaxPositions=function(t,n,i,o){var s,a,f,u=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];if(i)for(var c=n,d=n+i;c<d;++c){s=3*c,a=r.P.FromArray(t,s),o&&e._GetRightHandedPositionVector3FromRef(a),f=a.asArray();for(var h=0;h<3;++h){var p=f[h];p<u[h]&&(u[h]=p),p>l[h]&&(l[h]=p),++s}}return{min:u,max:l}},e._GetRightHandedPositionVector3=function(e){return new r.P(e.x,e.y,-e.z)},e._GetRightHandedPositionVector3FromRef=function(e){e.z*=-1},e._GetRightHandedPositionArray3FromRef=function(e){e[2]*=-1},e._GetRightHandedNormalVector3=function(e){return new r.P(e.x,e.y,-e.z)},e._GetRightHandedNormalVector3FromRef=function(e){e.z*=-1},e._GetRightHandedNormalArray3FromRef=function(e){e[2]*=-1},e._GetRightHandedVector4FromRef=function(e){e.z*=-1,e.w*=-1},e._GetRightHandedArray4FromRef=function(e){e[2]*=-1,e[3]*=-1},e._GetRightHandedQuaternionFromRef=function(e){e.x*=-1,e.y*=-1},e._GetRightHandedQuaternionArrayFromRef=function(e){e[0]*=-1,e[1]*=-1},e._NormalizeTangentFromRef=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);t>0&&(e.x/=t,e.y/=t,e.z/=t)},e._GetDataAccessorElementCount=function(e){switch(e){case"MAT2":case"VEC4":return 4;case"MAT3":return 9;case"MAT4":return 16;case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3}},e}(),h=n(45345);!function(e){e[e.INTANGENT=0]="INTANGENT",e[e.OUTTANGENT=1]="OUTTANGENT"}(i||(i={}));var p=function(){function e(){}return e._CreateNodeAnimation=function(t,n,i,r,s,a){var f=[],u=[],l=n.getKeys(),c=e._CalculateMinMaxKeyFrames(l),d=e._DeduceInterpolation(l,i,s),h=c.max-c.min,p=d.interpolationType,m=d.shouldBakeAnimation;return m?e._CreateBakedAnimation(t,n,i,c.min,c.max,n.framePerSecond,a,f,u,c,r,s):"LINEAR"===p||"STEP"===p?e._CreateLinearOrStepAnimation(t,n,i,h,f,u,r,s):"CUBICSPLINE"===p?e._CreateCubicSplineAnimation(t,n,i,h,f,u,r,s):e._CreateBakedAnimation(t,n,i,c.min,c.max,n.framePerSecond,a,f,u,c,r,s),f.length&&u.length?{inputs:f,outputs:u,samplerInterpolation:p,inputsMin:m?c.min:o.w1.FloatRound(c.min/n.framePerSecond),inputsMax:m?c.max:o.w1.FloatRound(c.max/n.framePerSecond)}:null},e._DeduceAnimationInfo=function(e){var t=null,n="VEC3",i=!1,r=e.targetProperty.split(".");switch(r[0]){case"scaling":t="scale";break;case"position":t="translation";break;case"rotation":n="VEC4",t="rotation";break;case"rotationQuaternion":n="VEC4",i=!0,t="rotation";break;case"influence":n="SCALAR",t="weights";break;default:o.w1.Error("Unsupported animatable property ".concat(r[0]))}return t?{animationChannelTargetPath:t,dataAccessorType:n,useQuaternion:i}:(o.w1.Error("animation channel target path and data accessor type could be deduced"),null)},e._CreateNodeAnimationFromNodeAnimations=function(t,n,i,r,o,s,a,f,l,c){var d;if(t instanceof u.Y&&t.animations)for(var h=0,p=t.animations;h<p.length;h++){var m=p[h],g=e._DeduceAnimationInfo(m);g&&(d={name:m.name,samplers:[],channels:[]},e._AddAnimation("".concat(m.name),m.hasRunningRuntimeAnimations?n:d,t,m,g.dataAccessorType,g.animationChannelTargetPath,r,s,a,f,l,g.useQuaternion,c),d.samplers.length&&d.channels.length&&i.push(d))}},e._CreateMorphTargetAnimationFromMorphTargetAnimations=function(t,n,i,r,o,s,a,u,l,d){var h;if(t instanceof c.Kj){var p=t.morphTargetManager;if(p)for(var m=0;m<p.numTargets;++m)for(var g=0,v=p.getTarget(m).animations;g<v.length;g++){for(var _=v[g],x=new f.f("".concat(_.name),"influence",_.framePerSecond,_.dataType,_.loopMode,_.enableBlending),T=[],y=_.getKeys(),E=0;E<y.length;++E)for(var S=y[E],b=0;b<p.numTargets;++b)b==m?T.push(S):T.push({frame:S.frame,value:0});x.setKeys(T);var C=e._DeduceAnimationInfo(x);C&&(h={name:x.name,samplers:[],channels:[]},e._AddAnimation(_.name,_.hasRunningRuntimeAnimations?n:h,t,x,C.dataAccessorType,C.animationChannelTargetPath,r,s,a,u,l,C.useQuaternion,d,p.numTargets),h.samplers.length&&h.channels.length&&i.push(h))}}},e._CreateNodeAndMorphAnimationFromAnimationGroups=function(t,n,i,r,o,s,a,c,d){var h,p;if(t.animationGroups)for(var m=function(r){var m=new Map,g=new Map,v=new Set,_=r.to-r.from;p={name:r.name,channels:[],samplers:[]};for(var x=function(n){var f=r.targetedAnimations[n],_=f.target,x=f.animation;if(_ instanceof u.Y||1===_.length&&_[0]instanceof u.Y){if(E=e._DeduceAnimationInfo(f.animation)){var T=_ instanceof u.Y?_:_[0],y=c[T.uniqueId];e._AddAnimation("".concat(x.name),p,T,x,E.dataAccessorType,E.animationChannelTargetPath,i,o,s,a,y,E.useQuaternion,d)}}else if(_ instanceof l.Y||1===_.length&&_[0]instanceof l.Y){var E;if(E=e._DeduceAnimationInfo(f.animation)){var S=_ instanceof l.Y?_:_[0];if(S){var b=t.morphTargetManagers.find((function(e){for(var t=0;t<e.numTargets;++t)if(e.getTarget(t)===S)return!0;return!1}));if(b){var C=t.meshes.find((function(e){return e.morphTargetManager===b}));C&&(m.has(C)||m.set(C,new Map),null===(h=m.get(C))||void 0===h||h.set(S,x),v.add(C),g.set(C,x))}}}}},T=0;T<r.targetedAnimations.length;++T)x(T);v.forEach((function(t){for(var n=t.morphTargetManager,u=null,l=[],c=g.get(t).getKeys(),h=c.length,v=0;v<h;++v)for(var x=0;x<n.numTargets;++x){var T=n.getTarget(x),y=m.get(t);if(y){var E=y.get(T);E?(u||(u=new f.f("".concat(r.name,"_").concat(t.name,"_MorphWeightAnimation"),"influence",E.framePerSecond,f.f.ANIMATIONTYPE_FLOAT,E.loopMode,E.enableBlending)),l.push(E.getKeys()[v])):l.push({frame:r.from+_/h*v,value:T.influence,inTangent:c[0].inTangent?0:void 0,outTangent:c[0].outTangent?0:void 0})}}u.setKeys(l);var S=e._DeduceAnimationInfo(u);S&&e._AddAnimation("".concat(r.name,"_").concat(t.name,"_MorphWeightAnimation"),p,t,u,S.dataAccessorType,S.animationChannelTargetPath,i,o,s,a,!1,S.useQuaternion,d,null==n?void 0:n.numTargets)})),p.channels.length&&p.samplers.length&&n.push(p)},g=0,v=t.animationGroups;g<v.length;g++){m(v[g])}},e._AddAnimation=function(t,n,i,r,o,s,a,f,u,l,c,h,p,m){var g,v,_,x,T,y,E,S=e._CreateNodeAnimation(i,r,s,c,h,p);if(S){if(m){for(var b=0,C=0,P=[];S.inputs.length>0;)C=S.inputs.shift(),b%m==0&&P.push(C),b++;S.inputs=P}var A=a[i.uniqueId],F=4*S.inputs.length;g=d._CreateBufferView(0,f.getByteOffset(),F,void 0,"".concat(t,"  keyframe data view")),u.push(g),S.inputs.forEach((function(e){f.setFloat32(e)})),v=d._CreateAccessor(u.length-1,"".concat(t,"  keyframes"),"SCALAR",5126,S.inputs.length,null,[S.inputsMin],[S.inputsMax]),l.push(v),_=l.length-1,T=S.outputs.length,F=4*d._GetDataAccessorElementCount(o)*S.outputs.length,g=d._CreateBufferView(0,f.getByteOffset(),F,void 0,"".concat(t,"  data view")),u.push(g),S.outputs.forEach((function(e){e.forEach((function(e){f.setFloat32(e)}))})),v=d._CreateAccessor(u.length-1,"".concat(t,"  data"),o,5126,T,null,null,null),l.push(v),x=l.length-1,y={interpolation:S.samplerInterpolation,input:_,output:x},n.samplers.push(y),E={sampler:n.samplers.length-1,target:{node:A,path:s}},n.channels.push(E)}},e._CreateBakedAnimation=function(t,n,i,s,a,f,u,l,c,d,h,p){var m,g,v=r._f.Identity(),_=null,x=null,T=null,y=null,E=null,S=null;d.min=o.w1.FloatRound(s/f);for(var b=n.getKeys(),C=0,P=b.length;C<P;++C){if(S=null,T=b[C],C+1<P)if(y=b[C+1],T.value.equals&&T.value.equals(y.value)||T.value===y.value){if(0!==C)continue;S=T.frame}else S=y.frame;else{if(E=b[C-1],T.value.equals&&T.value.equals(E.value)||T.value===E.value)continue;S=a}if(S)for(var A=T.frame;A<=S;A+=u)if((g=o.w1.FloatRound(A/f))!==_){_=g,x=g;var F={key:0,repeatCount:0,loopMode:n.loopMode};m=n._interpolate(A,F),e._SetInterpolatedValue(t,m,g,n,i,v,l,c,h,p)}}x&&(d.max=x)},e._ConvertFactorToVector3OrQuaternion=function(t,n,i,s,a,u,l){var c,d,h=null,p=e._GetBasePositionRotationOrScale(n,a,u,l);if(s===f.f.ANIMATIONTYPE_FLOAT)switch(d=(c=i.targetProperty.split("."))?c[1]:"",h=l?r._f.FromArray(p).normalize():r.P.FromArray(p),d){case"x":case"y":h[d]=u&&l&&"scale"!==a?-t:t;break;case"z":h[d]=u&&!l&&"scale"!==a?-t:t;break;case"w":h.w=t;break;default:o.w1.Error('glTFAnimation: Unsupported component type "'.concat(d,'" for scale animation!'))}return h},e._SetInterpolatedValue=function(e,t,n,i,o,s,a,f,l,c){var h,p=i.dataType;a.push(n),"number"==typeof t&&e instanceof u.Y&&(t=this._ConvertFactorToVector3OrQuaternion(t,e,i,p,o,l,c)),t&&("rotation"===o?(c?s=t:(h=t,r._f.RotationYawPitchRollToRef(h.y,h.x,h.z,s)),l&&(d._GetRightHandedQuaternionFromRef(s),e.parent||(s=r._f.FromArray([0,1,0,0]).multiply(s))),f.push(s.asArray())):"weights"===o?f.push([t]):(h=t,l&&"scale"!==o&&(d._GetRightHandedPositionVector3FromRef(h),e.parent||(h.x*=-1,h.z*=-1)),f.push(h.asArray())))},e._CreateLinearOrStepAnimation=function(t,n,i,r,o,s,a,f){for(var u=0,l=n.getKeys();u<l.length;u++){var c=l[u];o.push(c.frame/n.framePerSecond),e._AddKeyframeValue(c,n,s,i,t,a,f)}},e._CreateCubicSplineAnimation=function(t,n,r,o,s,a,f,u){n.getKeys().forEach((function(l){s.push(l.frame/n.framePerSecond),e._AddSplineTangent(t,i.INTANGENT,a,r,"CUBICSPLINE",l,o,u,f),e._AddKeyframeValue(l,n,a,r,t,f,u),e._AddSplineTangent(t,i.OUTTANGENT,a,r,"CUBICSPLINE",l,o,u,f)}))},e._GetBasePositionRotationOrScale=function(e,t,n,i){var o;return"rotation"===t?i?e.rotationQuaternion?(o=e.rotationQuaternion.asArray(),n&&(d._GetRightHandedQuaternionArrayFromRef(o),e.parent||(o=r._f.FromArray([0,1,0,0]).multiply(r._f.FromArray(o)).asArray()))):o=r._f.Identity().asArray():(o=e.rotation.asArray(),d._GetRightHandedNormalArray3FromRef(o)):"translation"===t?(o=e.position.asArray(),n&&d._GetRightHandedPositionArray3FromRef(o)):o=e.scaling.asArray(),o},e._AddKeyframeValue=function(e,t,n,i,s,a,u){var l,c,h=t.dataType;if(h===f.f.ANIMATIONTYPE_VECTOR3){if(l=e.value.asArray(),"rotation"===i){var p=r.P.FromArray(l),m=r._f.RotationYawPitchRoll(p.y,p.x,p.z);a&&(d._GetRightHandedQuaternionFromRef(m),s.parent||(m=r._f.FromArray([0,1,0,0]).multiply(m))),l=m.asArray()}else"translation"===i&&a&&(d._GetRightHandedNormalArray3FromRef(l),s.parent||(l[0]*=-1,l[2]*=-1));n.push(l)}else if(h===f.f.ANIMATIONTYPE_FLOAT){if("weights"===i)n.push([e.value]);else if(c=this._ConvertFactorToVector3OrQuaternion(e.value,s,t,h,i,a,u)){if("rotation"===i){var g=u?c:r._f.RotationYawPitchRoll(c.y,c.x,c.z).normalize();a&&(d._GetRightHandedQuaternionFromRef(g),s.parent||(g=r._f.FromArray([0,1,0,0]).multiply(g))),n.push(g.asArray())}else"translation"===i&&a&&(d._GetRightHandedNormalVector3FromRef(c),s.parent||(c.x*=-1,c.z*=-1));n.push(c.asArray())}}else h===f.f.ANIMATIONTYPE_QUATERNION?(l=e.value.normalize().asArray(),a&&(d._GetRightHandedQuaternionArrayFromRef(l),s.parent||(l=r._f.FromArray([0,1,0,0]).multiply(r._f.FromArray(l)).asArray())),n.push(l)):o.w1.Error("glTFAnimation: Unsupported key frame values for animation!")},e._DeduceInterpolation=function(e,t,n){var i,r,o=!1;if("rotation"===t&&!n)return{interpolationType:"LINEAR",shouldBakeAnimation:!0};for(var s=0,a=e.length;s<a;++s)if((r=e[s]).inTangent||r.outTangent)if(i){if("CUBICSPLINE"!==i){i="LINEAR",o=!0;break}}else i="CUBICSPLINE";else if(i){if("CUBICSPLINE"===i||r.interpolation&&r.interpolation===h.N.STEP&&"STEP"!==i){i="LINEAR",o=!0;break}}else i=r.interpolation&&r.interpolation===h.N.STEP?"STEP":"LINEAR";return i||(i="LINEAR"),{interpolationType:i,shouldBakeAnimation:o}},e._AddSplineTangent=function(e,t,n,o,s,a,f,u,l){var c,h=t===i.INTANGENT?a.inTangent:a.outTangent;if("CUBICSPLINE"===s){if("rotation"===o)if(h){if(u)c=h.asArray();else{var p=h;c=r._f.RotationYawPitchRoll(p.y,p.x,p.z).asArray()}l&&(d._GetRightHandedQuaternionArrayFromRef(c),e.parent||(c=r._f.FromArray([0,1,0,0]).multiply(r._f.FromArray(c)).asArray()))}else c=[0,0,0,0];else"weights"===o?c=h?[h]:[0]:h?(c=h.asArray(),l&&"translation"===o&&(d._GetRightHandedPositionArray3FromRef(c),e.parent||(c[0]*=-1,c[2]*=-1))):c=[0,0,0];n.push(c)}},e._CalculateMinMaxKeyFrames=function(e){var t=1/0,n=-1/0;return e.forEach((function(e){t=Math.min(t,e.frame),n=Math.max(n,e.frame)})),{min:t,max:n}},e}(),m=function(){function e(){this.glTFFiles={}}return e.prototype.downloadFiles=function(){function e(e,t){return-1!==e.indexOf(t,e.length-t.length)}for(var t in this.glTFFiles){var n=document.createElement("a");document.body.appendChild(n),n.setAttribute("type","hidden"),n.download=t;var i=this.glTFFiles[t],r=void 0;e(t,".glb")?r={type:"model/gltf-binary"}:e(t,".bin")?r={type:"application/octet-stream"}:e(t,".gltf")?r={type:"model/gltf+json"}:e(t,".jpeg")||e(t,".jpg")?r={type:"image/jpeg"}:e(t,".png")&&(r={type:"image/png"}),n.href=window.URL.createObjectURL(new Blob([i],r)),n.click()}},e}(),g=n(31191),v=n(15631),_=n(72208),x=n(71419),T=n(37852),y=n(63003),E=n(98163),S=n(37290),b=n(72739),C=n(80949),P=n(73803),A=n(15034),F=n(34941),R=function(){function e(e){this._textureMap={},this._textureMap={},this._exporter=e}return e._FuzzyEquals=function(e,t,n){return b.R.WithinEpsilon(e.r,t.r,n)&&b.R.WithinEpsilon(e.g,t.g,n)&&b.R.WithinEpsilon(e.b,t.b,n)},e.prototype._convertMaterialsToGLTFAsync=function(e,t,n){var i=this,r=[];return e.forEach((function(e){"StandardMaterial"===e.getClassName()?r.push(i._convertStandardMaterialAsync(e,t,n)):-1!==e.getClassName().indexOf("PBR")?r.push(i._convertPBRMaterialAsync(e,t,n)):o.w1.Warn("Unsupported material type: ".concat(e.name))})),Promise.all(r).then((function(){}))},e.prototype._stripTexturesFromMaterial=function(e){var t={};if(e){t.name=e.name,t.doubleSided=e.doubleSided,t.alphaMode=e.alphaMode,t.alphaCutoff=e.alphaCutoff,t.emissiveFactor=e.emissiveFactor;var n=e.pbrMetallicRoughness;n&&(t.pbrMetallicRoughness={},t.pbrMetallicRoughness.baseColorFactor=n.baseColorFactor,t.pbrMetallicRoughness.metallicFactor=n.metallicFactor,t.pbrMetallicRoughness.roughnessFactor=n.roughnessFactor)}return t},e.prototype._hasTexturesPresent=function(e){var t;if(e.emissiveTexture||e.normalTexture||e.occlusionTexture)return!0;var n=e.pbrMetallicRoughness;if(n&&(n.baseColorTexture||n.metallicRoughnessTexture))return!0;if(e.extensions)for(var i in e.extensions){var r=e.extensions[i];if(r)return null===(t=r.hasTextures)||void 0===t?void 0:t.call(r)}return!1},e.prototype._getTextureInfo=function(e){if(e){var t=e.uid;if(t in this._textureMap)return this._textureMap[t]}return null},e.prototype._convertToGLTFPBRMetallicRoughness=function(t){var n=new r.FM(0,1),i=new r.FM(0,.1),o=new r.FM(0,.1),s=new r.FM(1300,.1);var a=t.diffuseColor.toLinearSpace().scale(.5),f=t.alpha,u=function(e){return function(e,t,n,i,r){return(1-e)*(1-e)*(1-e)*t+3*(1-e)*(1-e)*e*n+3*(1-e)*e*e*i+e*e*e*r}(Math.pow(e/s.x,.333333),n.y,i.y,o.y,s.y)}(b.R.Clamp(t.specularPower,0,e._MaxSpecularPower));return{baseColorFactor:[a.r,a.g,a.b,f],metallicFactor:0,roughnessFactor:u}},e._SolveMetallic=function(e,t,n){if(t<this._DielectricSpecular.r)return this._DielectricSpecular,0;var i=this._DielectricSpecular.r,r=e*n/(1-this._DielectricSpecular.r)+t-2*this._DielectricSpecular.r,o=r*r-4*i*(this._DielectricSpecular.r-t);return b.R.Clamp((-r+Math.sqrt(o))/(2*i),0,1)},e._SetAlphaMode=function(e,t){t.needAlphaBlending()?e.alphaMode="BLEND":t.needAlphaTesting()&&(e.alphaMode="MASK",e.alphaCutoff=t.alphaCutOff)},e.prototype._convertStandardMaterialAsync=function(t,n,i){var r=this._exporter._materialMap,s=this._exporter._materials,a=[],f=this._convertToGLTFPBRMetallicRoughness(t),u={name:t.name};return null==t.backFaceCulling||t.backFaceCulling||(t.twoSidedLighting||o.w1.Warn(t.name+": Back-face culling disabled and two-sided lighting disabled is not supported in glTF."),u.doubleSided=!0),i&&(t.diffuseTexture&&a.push(this._exportTextureAsync(t.diffuseTexture,n).then((function(e){e&&(f.baseColorTexture=e)}))),t.bumpTexture&&a.push(this._exportTextureAsync(t.bumpTexture,n).then((function(e){e&&(u.normalTexture=e,null!=t.bumpTexture&&1!==t.bumpTexture.level&&(u.normalTexture.scale=t.bumpTexture.level))}))),t.emissiveTexture&&(u.emissiveFactor=[1,1,1],a.push(this._exportTextureAsync(t.emissiveTexture,n).then((function(e){e&&(u.emissiveTexture=e)})))),t.ambientTexture&&a.push(this._exportTextureAsync(t.ambientTexture,n).then((function(e){if(e){var t={index:e.index};u.occlusionTexture=t,t.strength=1}})))),(t.alpha<1||t.opacityTexture)&&(t.alphaMode===F.g.ALPHA_COMBINE?u.alphaMode="BLEND":o.w1.Warn(t.name+": glTF 2.0 does not support alpha mode: "+t.alphaMode.toString())),t.emissiveColor&&!e._FuzzyEquals(t.emissiveColor,v.Wo.Black(),e._Epsilon)&&(u.emissiveFactor=t.emissiveColor.asArray()),u.pbrMetallicRoughness=f,e._SetAlphaMode(u,t),s.push(u),r[t.uniqueId]=s.length-1,this._finishMaterial(a,u,t,n)},e.prototype._finishMaterial=function(e,t,n,i){var r=this;return Promise.all(e).then((function(){for(var e=null,o=0,s=r._exporter._extensionsPostExportMaterialAdditionalTextures("exportMaterial",t,n);o<s.length;o++){var a=s[o];e||(e=[]),e.push(r._exportTextureAsync(a,i))}return e||(e=[Promise.resolve(null)]),Promise.all(e).then((function(){var e=r._exporter._extensionsPostExportMaterialAsync("exportMaterial",t,n);return e?e.then((function(){return t})):t}))}))},e.prototype._createBase64FromCanvasAsync=function(e,t,n,i){var r=this;return new Promise((function(s){return(0,g.mG)(r,void 0,void 0,(function(){var r,a,f,u,l,c;return(0,g.Jh)(this,(function(d){switch(d.label){case 0:return r=F.g.TEXTURETYPE_UNSIGNED_INT,a=this._exporter._babylonScene,f=a.getEngine(),u=f.createRawTexture(e,t,n,F.g.TEXTUREFORMAT_RGBA,!1,!0,P.x.NEAREST_SAMPLINGMODE,null,r),[4,C.Oi.ApplyPostProcess("pass",u,a,r,F.g.TEXTURE_NEAREST_SAMPLINGMODE,F.g.TEXTUREFORMAT_RGBA)];case 1:return d.sent(),[4,f._readTexturePixels(u,t,n)];case 2:return l=d.sent(),[4,o.w1.DumpDataAsync(t,n,l,i,void 0,!0,!1)];case 3:return c=d.sent(),s(c),[2]}}))}))}))},e.prototype._createWhiteTexture=function(e,t,n){for(var i=new Uint8Array(e*t*4),r=0;r<i.length;r+=4)i[r]=i[r+1]=i[r+2]=i[r+3]=255;return A.l.CreateRGBATexture(i,e,t,n)},e.prototype._resizeTexturesToSameDimensions=function(e,t,n){var i,r,o=e?e.getSize():{width:0,height:0},s=t?t.getSize():{width:0,height:0};return o.width<s.width?(i=e&&e instanceof P.x?C.Oi.CreateResizedCopy(e,s.width,s.height,!0):this._createWhiteTexture(s.width,s.height,n),r=t):o.width>s.width?(r=t&&t instanceof P.x?C.Oi.CreateResizedCopy(t,o.width,o.height,!0):this._createWhiteTexture(o.width,o.height,n),i=e):(i=e,r=t),{texture1:i,texture2:r}},e.prototype._convertPixelArrayToFloat32=function(e){if(e instanceof Uint8Array){for(var t=e.length,n=new Float32Array(e.length),i=0;i<t;++i)n[i]=e[i]/255;return n}if(e instanceof Float32Array)return e;throw new Error("Unsupported pixel format!")},e.prototype._convertSpecularGlossinessTexturesToMetallicRoughnessAsync=function(t,n,i,r){var o;return(0,g.mG)(this,void 0,void 0,(function(){var s,a,f,u,l,c,d,h,p,m,_,x,T,y,E,S,b,C,P,A,F,R,w,M,I,L,N,O,D,U,B,V;return(0,g.Jh)(this,(function(g){switch(g.label){case 0:return s=[],t||n?(a=t?t.getScene():n?n.getScene():null)?(f=this._resizeTexturesToSameDimensions(t,n,a),u=null===(o=f.texture1)||void 0===o?void 0:o.getSize(),l=void 0,c=void 0,d=u.width,h=u.height,[4,f.texture1.readPixels()]):[3,3]:[2,Promise.reject("_ConvertSpecularGlosinessTexturesToMetallicRoughness: diffuse and specular glossiness textures are not defined!")];case 1:return p=g.sent(),[4,f.texture2.readPixels()];case 2:if(m=g.sent(),!p)return[2,Promise.reject("Failed to retrieve pixels from diffuse texture!")];if(l=this._convertPixelArrayToFloat32(p),!m)return[2,Promise.reject("Failed to retrieve pixels from specular glossiness texture!")];for(c=this._convertPixelArrayToFloat32(m),_=c.byteLength,x=new Uint8Array(_),T=new Uint8Array(_),4,y=v.Wo.Black(),E=0,S=0,L=0;L<h;++L)for(N=0;N<d;++N)b=4*(d*L+N),C=new v.Wo(l[b],l[b+1],l[b+2]).toLinearSpace().multiply(i.diffuseColor),P=new v.Wo(c[b],c[b+1],c[b+2]).toLinearSpace().multiply(i.specularColor),A=c[b+3]*i.glossiness,F={diffuseColor:C,specularColor:P,glossiness:A},R=this._convertSpecularGlossinessToMetallicRoughness(F),y.r=Math.max(y.r,R.baseColor.r),y.g=Math.max(y.g,R.baseColor.g),y.b=Math.max(y.b,R.baseColor.b),E=Math.max(E,R.metallic),S=Math.max(S,R.roughness),T[b]=255*R.baseColor.r,T[b+1]=255*R.baseColor.g,T[b+2]=255*R.baseColor.b,T[b+3]=f.texture1.hasAlpha?255*l[b+3]:255,x[b]=0,x[b+1]=255*R.roughness,x[b+2]=255*R.metallic,x[b+3]=255;for(w={baseColor:y,metallic:E,roughness:S},M=!1,I=!1,L=0;L<h;++L)for(N=0;N<d;++N)T[O=4*(d*L+N)]/=w.baseColor.r>e._Epsilon?w.baseColor.r:1,T[O+1]/=w.baseColor.g>e._Epsilon?w.baseColor.g:1,T[O+2]/=w.baseColor.b>e._Epsilon?w.baseColor.b:1,D=v.Wo.FromInts(T[O],T[O+1],T[O+2]),U=D.toGammaSpace(),T[O]=255*U.r,T[O+1]=255*U.g,T[O+2]=255*U.b,e._FuzzyEquals(U,v.Wo.White(),e._Epsilon)||(I=!0),x[O+1]/=w.roughness>e._Epsilon?w.roughness:1,x[O+2]/=w.metallic>e._Epsilon?w.metallic:1,B=v.Wo.FromInts(255,x[O+1],x[O+2]),e._FuzzyEquals(B,v.Wo.White(),e._Epsilon)||(M=!0);return M&&(V=this._createBase64FromCanvasAsync(x,d,h,r).then((function(e){w.metallicRoughnessTextureBase64=e})),s.push(V)),I&&(V=this._createBase64FromCanvasAsync(T,d,h,r).then((function(e){w.baseColorTextureBase64=e})),s.push(V)),[2,Promise.all(s).then((function(){return w}))];case 3:return[2,Promise.reject("_ConvertSpecularGlossinessTexturesToMetallicRoughness: Scene from textures is missing!")]}}))}))},e.prototype._convertSpecularGlossinessToMetallicRoughness=function(t){var n=this._getPerceivedBrightness(t.diffuseColor),i=this._getPerceivedBrightness(t.specularColor),r=1-this._getMaxComponent(t.specularColor),o=e._SolveMetallic(n,i,r),s=t.diffuseColor.scale(r/(1-e._DielectricSpecular.r)/Math.max(1-o,e._Epsilon)),a=t.specularColor.subtract(e._DielectricSpecular.scale(1-o)).scale(1/Math.max(o,e._Epsilon)),f=v.Wo.Lerp(s,a,o*o);return{baseColor:f=f.clampToRef(0,1,f),metallic:o,roughness:1-t.glossiness}},e.prototype._getPerceivedBrightness=function(e){return e?Math.sqrt(.299*e.r*e.r+.587*e.g*e.g+.114*e.b*e.b):0},e.prototype._getMaxComponent=function(e){return e?Math.max(e.r,Math.max(e.g,e.b)):0},e.prototype._convertMetalRoughFactorsToMetallicRoughnessAsync=function(e,t,n,i){var r=[],o={baseColor:e._albedoColor,metallic:e._metallic,roughness:e._roughness};if(i){e._albedoTexture&&r.push(this._exportTextureAsync(e._albedoTexture,t).then((function(e){e&&(n.baseColorTexture=e)})));var s=e._metallicTexture;s&&r.push(this._exportTextureAsync(s,t).then((function(e){e&&(n.metallicRoughnessTexture=e)})))}return Promise.all(r).then((function(){return o}))},e.prototype._getGLTFTextureSampler=function(e){var t=this._getGLTFTextureWrapModesSampler(e),n=e instanceof P.x?e.samplingMode:null;if(null!=n)switch(n){case P.x.LINEAR_LINEAR:t.magFilter=9729,t.minFilter=9729;break;case P.x.LINEAR_NEAREST:t.magFilter=9729,t.minFilter=9728;break;case P.x.NEAREST_LINEAR:t.magFilter=9728,t.minFilter=9729;break;case P.x.NEAREST_LINEAR_MIPLINEAR:t.magFilter=9728,t.minFilter=9987;break;case P.x.NEAREST_NEAREST:t.magFilter=9728,t.minFilter=9728;break;case P.x.NEAREST_LINEAR_MIPNEAREST:t.magFilter=9728,t.minFilter=9985;break;case P.x.LINEAR_NEAREST_MIPNEAREST:t.magFilter=9729,t.minFilter=9984;break;case P.x.LINEAR_NEAREST_MIPLINEAR:t.magFilter=9729,t.minFilter=9986;break;case P.x.NEAREST_NEAREST_MIPLINEAR:t.magFilter=9728,t.minFilter=9986;break;case P.x.LINEAR_LINEAR_MIPLINEAR:t.magFilter=9729,t.minFilter=9987;break;case P.x.LINEAR_LINEAR_MIPNEAREST:t.magFilter=9729,t.minFilter=9985;break;case P.x.NEAREST_NEAREST_MIPNEAREST:t.magFilter=9728,t.minFilter=9984}return t},e.prototype._getGLTFTextureWrapMode=function(e){switch(e){case P.x.WRAP_ADDRESSMODE:return 10497;case P.x.CLAMP_ADDRESSMODE:return 33071;case P.x.MIRROR_ADDRESSMODE:return 33648;default:return o.w1.Error("Unsupported Texture Wrap Mode ".concat(e,"!")),10497}},e.prototype._getGLTFTextureWrapModesSampler=function(e){var t=this._getGLTFTextureWrapMode(e instanceof P.x?e.wrapU:P.x.WRAP_ADDRESSMODE),n=this._getGLTFTextureWrapMode(e instanceof P.x?e.wrapV:P.x.WRAP_ADDRESSMODE);return 10497===t&&10497===n?{}:{wrapS:t,wrapT:n}},e.prototype._convertSpecGlossFactorsToMetallicRoughnessAsync=function(e,t,n,i){var r=this;return Promise.resolve().then((function(){var o=r._exporter._samplers,s=r._exporter._textures,a={diffuseColor:e._albedoColor,specularColor:e._reflectivityColor,glossiness:e._microSurface},f=null,u=e._albedoTexture,l=e._reflectivityTexture;if(u){var c=r._getGLTFTextureSampler(u);null!=c.magFilter&&null!=c.minFilter&&null!=c.wrapS&&null!=c.wrapT&&(o.push(c),f=o.length-1)}var d=e._useMicroSurfaceFromReflectivityMapAlpha;return l&&!d?Promise.reject("_ConvertPBRMaterial: Glossiness values not included in the reflectivity texture are currently not supported"):(u||l)&&i?r._convertSpecularGlossinessTexturesToMetallicRoughnessAsync(u,l,a,t).then((function(e){if(e.baseColorTextureBase64){var i=r._getTextureInfoFromBase64(e.baseColorTextureBase64,"bjsBaseColorTexture_"+s.length+".png",t,u?u.coordinatesIndex:null,f);i&&(n.baseColorTexture=i)}if(e.metallicRoughnessTextureBase64){var o=r._getTextureInfoFromBase64(e.metallicRoughnessTextureBase64,"bjsMetallicRoughnessTexture_"+s.length+".png",t,l?l.coordinatesIndex:null,f);o&&(n.metallicRoughnessTexture=o)}return e})):r._convertSpecularGlossinessToMetallicRoughness(a)}))},e.prototype._convertPBRMaterialAsync=function(e,t,n){var i=this,r={},o={name:e.name};if(e.isMetallicWorkflow()){var s=e._albedoColor,a=e.alpha;return s&&(r.baseColorFactor=[s.r,s.g,s.b,a]),this._convertMetalRoughFactorsToMetallicRoughnessAsync(e,t,r,n).then((function(s){return i._setMetallicRoughnessPbrMaterial(s,e,o,r,t,n)}))}return this._convertSpecGlossFactorsToMetallicRoughnessAsync(e,t,r,n).then((function(s){return i._setMetallicRoughnessPbrMaterial(s,e,o,r,t,n)}))},e.prototype._setMetallicRoughnessPbrMaterial=function(t,n,i,r,s,a){var f=this._exporter._materialMap,u=this._exporter._materials,l=[];if(t){if(e._SetAlphaMode(i,n),e._FuzzyEquals(t.baseColor,v.Wo.White(),e._Epsilon)&&n.alpha>=e._Epsilon||(r.baseColorFactor=[t.baseColor.r,t.baseColor.g,t.baseColor.b,n.alpha]),null!=t.metallic&&1!==t.metallic&&(r.metallicFactor=t.metallic),null!=t.roughness&&1!==t.roughness&&(r.roughnessFactor=t.roughness),null==n.backFaceCulling||n.backFaceCulling||(n._twoSidedLighting||o.w1.Warn(n.name+": Back-face culling disabled and two-sided lighting disabled is not supported in glTF."),i.doubleSided=!0),a){var c=n._bumpTexture;if(c){var d=this._exportTextureAsync(c,s).then((function(e){e&&(i.normalTexture=e,1!==c.level&&(i.normalTexture.scale=c.level))}));l.push(d)}var h=n._ambientTexture;if(h){d=this._exportTextureAsync(h,s).then((function(e){if(e){var t={index:e.index,texCoord:e.texCoord};i.occlusionTexture=t;var r=n._ambientTextureStrength;r&&(t.strength=r)}}));l.push(d)}var p=n._emissiveTexture;if(p){d=this._exportTextureAsync(p,s).then((function(e){e&&(i.emissiveTexture=e)}));l.push(d)}}var m=n._emissiveColor;e._FuzzyEquals(m,v.Wo.Black(),e._Epsilon)||(i.emissiveFactor=m.asArray()),i.pbrMetallicRoughness=r,u.push(i),f[n.uniqueId]=u.length-1}return this._finishMaterial(l,i,n,s)},e.prototype._getPixelsFromTexture=function(e){return e.textureType,F.g.TEXTURETYPE_UNSIGNED_INT,e.readPixels()},e.prototype._exportTextureAsync=function(e,t){var n=this,i=this._exporter._extensionsPreExportTextureAsync("exporter",e,t);return i?i.then((function(i){return i?n._exportTextureInfoAsync(i,t):n._exportTextureInfoAsync(e,t)})):this._exportTextureInfoAsync(e,t)},e.prototype._exportTextureInfoAsync=function(e,t){var n=this;return Promise.resolve().then((function(){return(0,g.mG)(n,void 0,void 0,(function(){var n,i,r,o,s,a,f,u,l,c=this;return(0,g.Jh)(this,(function(d){switch(d.label){case 0:return(n=e.uid)in this._textureMap?[2,this._textureMap[n]]:[3,1];case 1:return[4,this._getPixelsFromTexture(e)];case 2:if(!(i=d.sent()))return[2,null];for(r=this._exporter._samplers,o=this._getGLTFTextureSampler(e),s=null,a=null,f=0;f<r.length;++f)if((u=r[f]).minFilter===o.minFilter&&u.magFilter===o.magFilter&&u.wrapS===o.wrapS&&u.wrapT===o.wrapT){a=f;break}if(null==a?(r.push(o),s=r.length-1):s=a,l=e.getSize(),e.mimeType)switch(e.mimeType){case"image/jpeg":t="image/jpeg";break;case"image/png":t="image/png"}return[2,this._createBase64FromCanvasAsync(i,l.width,l.height,t).then((function(i){var r=c._getTextureInfoFromBase64(i,e.name.replace(/\.\/|\/|\.\\|\\/g,"_"),t,e.coordinatesIndex,s);return r&&(c._textureMap[n]=r,c._exporter._extensionsPostExportTextures("linkTextureInfo",r,e)),r}))]}}))}))}))},e.prototype._getTextureInfoFromBase64=function(e,t,n,i,r){var s=this._exporter._textures,a=this._exporter._images,f=this._exporter._imageData,u=null,l={source:a.length,name:t};null!=r&&(l.sampler=r);for(var c=atob(e.split(",")[1]),d=new ArrayBuffer(c.length),h=new Uint8Array(d),p=0,m=c.length;p<m;++p)h[p]=c.charCodeAt(p);var g={data:h,mimeType:n},v="image/jpeg"===n?".jpeg":".png",_=t+v,x=_;if(_ in f&&(_="".concat(t,"_").concat(o.w1.RandomId()).concat(v)),f[_]=g,"image/jpeg"===n||"image/png"===n){var T={name:t,uri:_},y=null;for(p=0;p<a.length;++p)if(a[p].uri===x){y=p;break}null==y?(a.push(T),l.source=a.length-1):l.source=y,s.push(l),u={index:s.length-1},null!=i&&(u.texCoord=i)}else o.w1.Error("Unsupported texture mime type ".concat(n));return u},e._DielectricSpecular=new v.Wo(.04,.04,.04),e._MaxSpecularPower=1024,e._Epsilon=1e-6,e}(),w=n(2055),M=n(15210),I=n(91855),L=function(){function e(e,t){this._includeCoordinateSystemConversionNodes=!1,this._extensions={},this._glTF={asset:{generator:"Babylon.js v".concat(S.D.Version),version:"2.0"}},(e=e||M.l.LastCreatedScene)&&(this._babylonScene=e,this._bufferViews=[],this._accessors=[],this._meshes=[],this._scenes=[],this._cameras=[],this._nodes=[],this._images=[],this._materials=[],this._materialMap=[],this._textures=[],this._samplers=[],this._skins=[],this._animations=[],this._imageData={},this._orderedImageData=[],this._options=t||{},this._animationSampleRate=t&&t.animationSampleRate?t.animationSampleRate:1/60,this._includeCoordinateSystemConversionNodes=!(!t||!t.includeCoordinateSystemConversionNodes),this._glTFMaterialExporter=new R(this),this._loadExtensions())}return e.prototype._applyExtension=function(e,t,n,i){var r=this;if(n>=t.length)return Promise.resolve(e);var o=i(t[n],e);return o?o.then((function(e){return r._applyExtension(e,t,n+1,i)})):this._applyExtension(e,t,n+1,i)},e.prototype._applyExtensions=function(t,n){for(var i=[],r=0,o=e._ExtensionNames;r<o.length;r++){var s=o[r];i.push(this._extensions[s])}return this._applyExtension(t,i,0,n)},e.prototype._extensionsPreExportTextureAsync=function(e,t,n){return this._applyExtensions(t,(function(t,i){return t.preExportTextureAsync&&t.preExportTextureAsync(e,i,n)}))},e.prototype._extensionsPostExportMeshPrimitiveAsync=function(e,t,n,i){return this._applyExtensions(t,(function(t,r){return t.postExportMeshPrimitiveAsync&&t.postExportMeshPrimitiveAsync(e,r,n,i)}))},e.prototype._extensionsPostExportNodeAsync=function(e,t,n,i,r){return this._applyExtensions(t,(function(t,o){return t.postExportNodeAsync&&t.postExportNodeAsync(e,o,n,i,r)}))},e.prototype._extensionsPostExportMaterialAsync=function(e,t,n){return this._applyExtensions(t,(function(t,i){return t.postExportMaterialAsync&&t.postExportMaterialAsync(e,i,n)}))},e.prototype._extensionsPostExportMaterialAdditionalTextures=function(t,n,i){for(var r=[],o=0,s=e._ExtensionNames;o<s.length;o++){var a=s[o],f=this._extensions[a];f.postExportMaterialAdditionalTextures&&r.push.apply(r,f.postExportMaterialAdditionalTextures(t,n,i))}return r},e.prototype._extensionsPostExportTextures=function(t,n,i){for(var r=0,o=e._ExtensionNames;r<o.length;r++){var s=o[r],a=this._extensions[s];a.postExportTexture&&a.postExportTexture(t,n,i)}},e.prototype._forEachExtensions=function(t){for(var n=0,i=e._ExtensionNames;n<i.length;n++){var r=i[n],o=this._extensions[r];o.enabled&&t(o)}},e.prototype._extensionsOnExporting=function(){var e=this;this._forEachExtensions((function(t){t.wasUsed&&(null==e._glTF.extensionsUsed&&(e._glTF.extensionsUsed=[]),-1===e._glTF.extensionsUsed.indexOf(t.name)&&e._glTF.extensionsUsed.push(t.name),t.required&&(null==e._glTF.extensionsRequired&&(e._glTF.extensionsRequired=[]),-1===e._glTF.extensionsRequired.indexOf(t.name)&&e._glTF.extensionsRequired.push(t.name)),null==e._glTF.extensions&&(e._glTF.extensions={}),t.onExporting&&t.onExporting())}))},e.prototype._loadExtensions=function(){for(var t=0,n=e._ExtensionNames;t<n.length;t++){var i=n[t],r=e._ExtensionFactories[i](this);this._extensions[i]=r}},e.prototype.dispose=function(){for(var e in this._extensions){this._extensions[e].dispose()}},Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),e.RegisterExtension=function(t,n){e.UnregisterExtension(t)&&o.w1.Warn("Extension with the name ".concat(t," already exists")),e._ExtensionFactories[t]=n,e._ExtensionNames.push(t)},e.UnregisterExtension=function(t){if(!e._ExtensionFactories[t])return!1;delete e._ExtensionFactories[t];var n=e._ExtensionNames.indexOf(t);return-1!==n&&e._ExtensionNames.splice(n,1),!0},e.prototype._reorderIndicesBasedOnPrimitiveMode=function(e,t,n,i,r){switch(t){case E.F.TriangleFillMode:i||(i=0);for(var o=e.indexStart,s=e.indexStart+e.indexCount;o<s;o+=3){var a=i+4*o,f=r.getUInt32(a+4),u=r.getUInt32(a+8);r.setUInt32(u,a+4),r.setUInt32(f,a+8)}break;case E.F.TriangleFanDrawMode:o=e.indexStart+e.indexCount-1;for(var l=e.indexStart;o>=l;--o)r.setUInt32(n[o],i),i+=4;break;case E.F.TriangleStripDrawMode:e.indexCount>=3&&(r.setUInt32(n[e.indexStart+2],i+4),r.setUInt32(n[e.indexStart+1],i+8))}},e.prototype._reorderVertexAttributeDataBasedOnPrimitiveMode=function(e,t,n,i,r,o,s,a){if(a&&n===E.F.ClockWiseSideOrientation)switch(t){case E.F.TriangleFillMode:this._reorderTriangleFillMode(e,t,n,i,r,o,s,a);break;case E.F.TriangleStripDrawMode:this._reorderTriangleStripDrawMode(e,t,n,i,r,o,s,a);break;case E.F.TriangleFanDrawMode:this._reorderTriangleFanMode(e,t,n,i,r,o,s,a)}},e.prototype._reorderTriangleFillMode=function(e,t,n,i,s,a,f,u){var l=this._getVertexBufferFromMesh(i,e.getMesh());if(l){var c=l.byteStride/_.o.GetTypeByteLength(l.type);if(e.verticesCount%3!=0)o.w1.Error("The submesh vertices for the triangle fill mode is not divisible by 3!");else{var d=[],h=0;switch(i){case _.o.PositionKind:case _.o.NormalKind:for(var p=e.verticesStart;p<e.verticesStart+e.verticesCount;p+=3)h=p*c,d.push(r.P.FromArray(s,h)),d.push(r.P.FromArray(s,h+2*c)),d.push(r.P.FromArray(s,h+c));break;case _.o.TangentKind:for(p=e.verticesStart;p<e.verticesStart+e.verticesCount;p+=3)h=p*c,d.push(r.Lt.FromArray(s,h)),d.push(r.Lt.FromArray(s,h+2*c)),d.push(r.Lt.FromArray(s,h+c));break;case _.o.ColorKind:var m=l.getSize();for(p=e.verticesStart;p<e.verticesStart+e.verticesCount;p+=m)h=p*c,4===m?(d.push(r.Lt.FromArray(s,h)),d.push(r.Lt.FromArray(s,h+2*c)),d.push(r.Lt.FromArray(s,h+c))):(d.push(r.P.FromArray(s,h)),d.push(r.P.FromArray(s,h+2*c)),d.push(r.P.FromArray(s,h+c)));break;case _.o.UVKind:case _.o.UV2Kind:for(p=e.verticesStart;p<e.verticesStart+e.verticesCount;p+=3)h=p*c,d.push(r.FM.FromArray(s,h)),d.push(r.FM.FromArray(s,h+2*c)),d.push(r.FM.FromArray(s,h+c));break;default:o.w1.Error("Unsupported Vertex Buffer type: ".concat(i))}this._writeVertexAttributeData(d,a,i,s,f,u)}}else o.w1.Warn("reorderTriangleFillMode: Vertex Buffer Kind ".concat(i," not present!"))},e.prototype._reorderTriangleStripDrawMode=function(e,t,n,i,s,a,f,u){var l=this._getVertexBufferFromMesh(i,e.getMesh());if(l){var c=l.byteStride/_.o.GetTypeByteLength(l.type),d=[],h=0;switch(i){case _.o.PositionKind:case _.o.NormalKind:h=e.verticesStart,d.push(r.P.FromArray(s,h+2*c)),d.push(r.P.FromArray(s,h+c));break;case _.o.TangentKind:for(var p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)h=p*c,d.push(r.Lt.FromArray(s,h));break;case _.o.ColorKind:for(p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)h=p*c,4===l.getSize()?d.push(r.Lt.FromArray(s,h)):d.push(r.P.FromArray(s,h));break;case _.o.UVKind:case _.o.UV2Kind:for(p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)h=p*c,d.push(r.FM.FromArray(s,h));break;default:o.w1.Error("Unsupported Vertex Buffer type: ".concat(i))}this._writeVertexAttributeData(d,a+12,i,s,f,u)}else o.w1.Warn("reorderTriangleStripDrawMode: Vertex buffer kind ".concat(i," not present!"))},e.prototype._reorderTriangleFanMode=function(e,t,n,i,s,a,f,u){var l=this._getVertexBufferFromMesh(i,e.getMesh());if(l){var c=l.byteStride/_.o.GetTypeByteLength(l.type),d=[],h=0;switch(i){case _.o.PositionKind:case _.o.NormalKind:for(var p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)h=p*c,d.push(r.P.FromArray(s,h));break;case _.o.TangentKind:for(p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)h=p*c,d.push(r.Lt.FromArray(s,h));break;case _.o.ColorKind:for(p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)h=p*c,d.push(r.Lt.FromArray(s,h)),4===l.getSize()?d.push(r.Lt.FromArray(s,h)):d.push(r.P.FromArray(s,h));break;case _.o.UVKind:case _.o.UV2Kind:for(p=e.verticesStart+e.verticesCount-1;p>=e.verticesStart;--p)h=p*c,d.push(r.FM.FromArray(s,h));break;default:o.w1.Error("Unsupported Vertex Buffer type: ".concat(i))}this._writeVertexAttributeData(d,a,i,s,f,u)}else o.w1.Warn("reorderTriangleFanMode: Vertex buffer kind ".concat(i," not present!"))},e.prototype._writeVertexAttributeData=function(e,t,n,i,s,a){for(var f=0,u=e;f<u.length;f++){var l=u[f];!a||n===_.o.ColorKind||l instanceof r.FM||(l instanceof r.P?n===_.o.NormalKind?d._GetRightHandedNormalVector3FromRef(l):n===_.o.PositionKind?d._GetRightHandedPositionVector3FromRef(l):o.w1.Error("Unsupported vertex attribute kind!"):d._GetRightHandedVector4FromRef(l)),n===_.o.NormalKind?l.normalize():n===_.o.TangentKind&&l instanceof r.Lt&&d._NormalizeTangentFromRef(l);for(var c=0,h=l.asArray();c<h.length;c++){var p=h[c];s.setFloat32(p,t),t+=4}}},e.prototype._writeAttributeData=function(e,t,n,i,s,a,f){var u,l,c=[];switch(e){case _.o.PositionKind:for(var h=0,p=n.length/i;h<p;++h){u=h*i;var m=r.P.FromArray(n,u);a&&d._GetRightHandedPositionVector3FromRef(m),c.push(m.asArray())}break;case _.o.NormalKind:h=0;for(var g=n.length/i;h<g;++h){u=h*i;m=r.P.FromArray(n,u);a&&d._GetRightHandedNormalVector3FromRef(m),m.normalize(),c.push(m.asArray())}break;case _.o.TangentKind:h=0;for(var x=n.length/i;h<x;++h){u=h*i;m=r.Lt.FromArray(n,u);a&&d._GetRightHandedVector4FromRef(m),d._NormalizeTangentFromRef(m),c.push(m.asArray())}break;case _.o.ColorKind:for(var T=f.material,y=!T||"StandardMaterial"===T.getClassName(),E=(m=3===i?new v.Wo:new v.HE,h=0,n.length/i);h<E;++h)u=h*i,3===i?(v.Wo.FromArrayToRef(n,u,m),y&&m.toLinearSpaceToRef(m)):(v.HE.FromArrayToRef(n,u,m),y&&m.toLinearSpaceToRef(m)),c.push(m.asArray());break;case _.o.UVKind:case _.o.UV2Kind:h=0;for(var S=n.length/i;h<S;++h)u=h*i,c.push([n[u],n[u+1]]);break;case _.o.MatricesIndicesKind:case _.o.MatricesIndicesExtraKind:h=0;for(var b=n.length/i;h<b;++h){u=h*i;m=r.Lt.FromArray(n,u);c.push(m.asArray())}break;case _.o.MatricesWeightsKind:case _.o.MatricesWeightsExtraKind:h=0;for(var C=n.length/i;h<C;++h){u=h*i;m=r.Lt.FromArray(n,u);c.push(m.asArray())}break;default:o.w1.Warn("Unsupported Vertex Buffer Type: "+e),c=[]}switch(t){case 5121:l=s.setUInt8.bind(s);break;case 5123:l=s.setUInt16.bind(s);break;case 5125:l=s.setUInt32.bind(s);break;case 5126:l=s.setFloat32.bind(s);break;default:return void o.w1.Warn("Unsupported Attribute Component kind: "+t)}for(var P=0,A=c;P<A.length;P++)for(var F=0,R=A[P];F<R.length;F++){l(R[F])}},e.prototype.writeMorphTargetAttributeData=function(e,t,n,i,s,a,f,u,l,c){var h,p,m=[],g=new r.P,v=new r.Lt(0,0,0,0);switch(e){case _.o.PositionKind:for(var x=n.verticesStart;x<n.verticesCount;++x){h=n.indexStart+x*f;var T=r.P.FromArray(s,h);g=(y=r.P.FromArray(a,h)).subtractToRef(T,g),l&&d._GetRightHandedPositionVector3FromRef(g),c&&(c.min.copyFromFloats(Math.min(g.x,c.min.x),Math.min(g.y,c.min.y),Math.min(g.z,c.min.z)),c.max.copyFromFloats(Math.max(g.x,c.max.x),Math.max(g.y,c.max.y),Math.max(g.z,c.max.z))),m.push(g.asArray())}break;case _.o.NormalKind:for(x=n.verticesStart;x<n.verticesCount;++x){h=n.indexStart+x*f,(T=r.P.FromArray(s,h)).normalize(),(y=r.P.FromArray(a,h)).normalize(),g=y.subtractToRef(T,g),l&&d._GetRightHandedNormalVector3FromRef(g),m.push(g.asArray())}break;case _.o.TangentKind:for(x=n.verticesStart;x<n.verticesCount;++x){h=n.indexStart+x*(f+1);T=r.Lt.FromArray(s,h);d._NormalizeTangentFromRef(T);var y=r.Lt.FromArray(a,h);d._NormalizeTangentFromRef(y),v=y.subtractToRef(T,v),l&&d._GetRightHandedVector4FromRef(v),m.push([v.x,v.y,v.z])}break;default:o.w1.Warn("Unsupported Vertex Buffer Type: "+e),m=[]}switch(t){case 5121:p=u.setUInt8.bind(u);break;case 5123:p=u.setUInt16.bind(u);break;case 5125:p=u.setUInt32.bind(u);break;case 5126:p=u.setFloat32.bind(u);break;default:return void o.w1.Warn("Unsupported Attribute Component kind: "+t)}for(var E=0,S=m;E<S.length;E++)for(var b=0,C=S[E];b<C.length;b++){p(C[b])}},e.prototype._generateJSON=function(e,t,n){var i,r,o,s=this,a={byteLength:this._totalByteLength},f=this._totalByteLength;return a.byteLength&&(this._glTF.buffers=[a]),this._nodes&&this._nodes.length&&(this._glTF.nodes=this._nodes),this._meshes&&this._meshes.length&&(this._glTF.meshes=this._meshes),this._scenes&&this._scenes.length&&(this._glTF.scenes=this._scenes,this._glTF.scene=0),this._cameras&&this._cameras.length&&(this._glTF.cameras=this._cameras),this._bufferViews&&this._bufferViews.length&&(this._glTF.bufferViews=this._bufferViews),this._accessors&&this._accessors.length&&(this._glTF.accessors=this._accessors),this._animations&&this._animations.length&&(this._glTF.animations=this._animations),this._materials&&this._materials.length&&(this._glTF.materials=this._materials),this._textures&&this._textures.length&&(this._glTF.textures=this._textures),this._samplers&&this._samplers.length&&(this._glTF.samplers=this._samplers),this._skins&&this._skins.length&&(this._glTF.skins=this._skins),this._images&&this._images.length&&(e?(this._glTF.images=[],this._images.forEach((function(e){e.uri&&(r=s._imageData[e.uri],s._orderedImageData.push(r),i=e.uri.split(".")[0]+" image",o=d._CreateBufferView(0,f,r.data.length,void 0,i),f+=r.data.buffer.byteLength,s._bufferViews.push(o),e.bufferView=s._bufferViews.length-1,e.name=i,e.mimeType=r.mimeType,e.uri=void 0,s._glTF.images||(s._glTF.images=[]),s._glTF.images.push(e))})),a.byteLength=f):this._glTF.images=this._images),e||(a.uri=t+".bin"),n?JSON.stringify(this._glTF,null,2):JSON.stringify(this._glTF)},e.prototype._generateGLTFAsync=function(e,t){var n=this;return void 0===t&&(t=!0),this._generateBinaryAsync().then((function(i){n._extensionsOnExporting();var r=n._generateJSON(!1,e,!0),o=new Blob([i],{type:"application/octet-stream"}),s=e+".gltf",a=e+".bin",f=new m;if(f.glTFFiles[s]=r,f.glTFFiles[a]=o,n._imageData)for(var u in n._imageData)f.glTFFiles[u]=new Blob([n._imageData[u].data],{type:n._imageData[u].mimeType});return t&&n.dispose(),f}))},e.prototype._generateBinaryAsync=function(){var e=this,t=new N(4);return this._createSceneAsync(this._babylonScene,t).then((function(){return e._localEngine&&e._localEngine.dispose(),t.getArrayBuffer()}))},e.prototype._getPadding=function(e){var t=e%4;return 0===t?t:4-t},e.prototype._generateGLBAsync=function(e,t){var n=this;return void 0===t&&(t=!0),this._generateBinaryAsync().then((function(i){n._extensionsOnExporting();var r,o=n._generateJSON(!0),s=e+".glb",a=o.length,f=0;"undefined"!=typeof TextEncoder&&(a=(r=(new TextEncoder).encode(o)).length);for(var u=0;u<n._orderedImageData.length;++u)f+=n._orderedImageData[u].data.byteLength;var l=n._getPadding(a),c=n._getPadding(i.byteLength),d=n._getPadding(f),h=28+a+l+i.byteLength+c+f+d,p=new ArrayBuffer(12),g=new DataView(p);g.setUint32(0,1179937895,!0),g.setUint32(4,2,!0),g.setUint32(8,h,!0);var v=new ArrayBuffer(8+a+l),_=new DataView(v);_.setUint32(0,a+l,!0),_.setUint32(4,1313821514,!0);var x=new Uint8Array(v,8);if(r)x.set(r);else{var T="_".charCodeAt(0);for(u=0;u<a;++u){var y=o.charCodeAt(u);y!=o.codePointAt(u)?x[u]=T:x[u]=y}}var E=new Uint8Array(v,8+a);for(u=0;u<l;++u)E[u]=32;var S=new ArrayBuffer(8),b=new DataView(S);b.setUint32(0,i.byteLength+f+d,!0),b.setUint32(4,5130562,!0);var C=new ArrayBuffer(c),P=new Uint8Array(C);for(u=0;u<c;++u)P[u]=0;var A=new ArrayBuffer(d),F=new Uint8Array(A);for(u=0;u<d;++u)F[u]=0;var R=[p,v,S,i];for(u=0;u<n._orderedImageData.length;++u)R.push(n._orderedImageData[u].data.buffer);R.push(C),R.push(A);var w=new Blob(R,{type:"application/octet-stream"}),M=new m;return M.glTFFiles[s]=w,null!=n._localEngine&&n._localEngine.dispose(),t&&n.dispose(),M}))},e.prototype._setNodeTransformation=function(e,t,n){t.getPivotPoint().equalsToFloats(0,0,0)||o.w1.Warn("Pivot points are not supported in the glTF serializer"),t.position.equalsToFloats(0,0,0)||(e.translation=n?d._GetRightHandedPositionVector3(t.position).asArray():t.position.asArray()),t.scaling.equalsToFloats(1,1,1)||(e.scale=t.scaling.asArray());var i=r._f.RotationYawPitchRoll(t.rotation.y,t.rotation.x,t.rotation.z);t.rotationQuaternion&&i.multiplyInPlace(t.rotationQuaternion),r._f.IsIdentity(i)||(n&&d._GetRightHandedQuaternionFromRef(i),e.rotation=i.normalize().asArray())},e.prototype._setCameraTransformation=function(e,t,n){t.position.equalsToFloats(0,0,0)||(e.translation=n?d._GetRightHandedPositionVector3(t.position).asArray():t.position.asArray());var i=t.absoluteRotation;r._f.IsIdentity(i)||(n&&d._GetRightHandedQuaternionFromRef(i),e.rotation=i.normalize().asArray())},e.prototype._getVertexBufferFromMesh=function(e,t){if(t.isVerticesDataPresent(e)){var n=t.getVertexBuffer(e);if(n)return n}return null},e.prototype._createBufferViewKind=function(e,t,n,i,r,o){var s=n instanceof c.Kj?n:n instanceof y.S?n.sourceMesh:null;if(s){var a=s.getVertexBuffer(e),f=s.getVerticesData(e);if(a&&f){var u=_.o.GetTypeByteLength(t),l=f.length*u,h=d._CreateBufferView(0,i.getByteOffset(),l,r,e+" - "+s.name);this._bufferViews.push(h),this._writeAttributeData(e,t,f,r/u,i,o,n)}}},e.prototype._setMorphTargetAttributes=function(e,t,n,i,o){if(n){t.targets||(t.targets=[]);var s={};if(n.hasNormals){var a=e.getMesh().getVerticesData(_.o.NormalKind),f=n.getNormals(),u=(v=e.verticesCount)*(x=12),l=d._CreateBufferView(0,i.getByteOffset(),u,x,n.name+"_NORMAL");this._bufferViews.push(l);var c=this._bufferViews.length-1,h=d._CreateAccessor(c,n.name+" - NORMAL","VEC3",5126,v,0,null,null);this._accessors.push(h),s.NORMAL=this._accessors.length-1,this.writeMorphTargetAttributeData(_.o.NormalKind,5126,e,n,a,f,x/4,i,o)}if(n.hasPositions){var p=e.getMesh().getVerticesData(_.o.PositionKind),m=n.getPositions();u=(v=e.verticesCount)*(x=12),l=d._CreateBufferView(0,i.getByteOffset(),u,x,n.name+"_POSITION");this._bufferViews.push(l);c=this._bufferViews.length-1;var g={min:new r.P(1/0,1/0,1/0),max:new r.P(-1/0,-1/0,-1/0)};h=d._CreateAccessor(c,n.name+" - POSITION","VEC3",5126,v,0,null,null);this._accessors.push(h),s.POSITION=this._accessors.length-1,this.writeMorphTargetAttributeData(_.o.PositionKind,5126,e,n,p,m,x/4,i,o,g),h.min=g.min.asArray(),h.max=g.max.asArray()}if(n.hasTangents){var v,x,T=e.getMesh().getVerticesData(_.o.TangentKind),y=n.getTangents();u=(v=e.verticesCount)*(x=12),l=d._CreateBufferView(0,i.getByteOffset(),u,x,n.name+"_NORMAL");this._bufferViews.push(l);c=this._bufferViews.length-1,h=d._CreateAccessor(c,n.name+" - TANGENT","VEC3",5126,v,0,null,null);this._accessors.push(h),s.TANGENT=this._accessors.length-1,this.writeMorphTargetAttributeData(_.o.TangentKind,5126,e,n,T,y,x/4,i,o)}t.targets.push(s)}},e.prototype._getMeshPrimitiveMode=function(e){return e instanceof T._?E.F.LineListDrawMode:e.material?e.material.fillMode:E.F.TriangleFillMode},e.prototype._setPrimitiveMode=function(e,t){switch(t){case E.F.TriangleFillMode:break;case E.F.TriangleStripDrawMode:e.mode=5;break;case E.F.TriangleFanDrawMode:e.mode=6;break;case E.F.PointListDrawMode:case E.F.PointFillMode:e.mode=0;break;case E.F.LineLoopDrawMode:e.mode=2;break;case E.F.LineListDrawMode:e.mode=1;break;case E.F.LineStripDrawMode:e.mode=3}},e.prototype._setAttributeKind=function(e,t){switch(t){case _.o.PositionKind:e.attributes.POSITION=this._accessors.length-1;break;case _.o.NormalKind:e.attributes.NORMAL=this._accessors.length-1;break;case _.o.ColorKind:e.attributes.COLOR_0=this._accessors.length-1;break;case _.o.TangentKind:e.attributes.TANGENT=this._accessors.length-1;break;case _.o.UVKind:e.attributes.TEXCOORD_0=this._accessors.length-1;break;case _.o.UV2Kind:e.attributes.TEXCOORD_1=this._accessors.length-1;break;case _.o.MatricesIndicesKind:e.attributes.JOINTS_0=this._accessors.length-1;break;case _.o.MatricesIndicesExtraKind:e.attributes.JOINTS_1=this._accessors.length-1;break;case _.o.MatricesWeightsKind:e.attributes.WEIGHTS_0=this._accessors.length-1;break;case _.o.MatricesWeightsExtraKind:e.attributes.WEIGHTS_1=this._accessors.length-1;break;default:o.w1.Warn("Unsupported Vertex Buffer Type: "+t)}},e.prototype._setPrimitiveAttributesAsync=function(e,t,n,i){var r,o,s,a=[],f=null;t instanceof c.Kj?f=t:t instanceof y.S&&(f=t.sourceMesh);var u=[{kind:_.o.PositionKind,accessorType:"VEC3",accessorComponentType:5126,byteStride:12},{kind:_.o.NormalKind,accessorType:"VEC3",accessorComponentType:5126,byteStride:12},{kind:_.o.ColorKind,accessorType:"VEC4",accessorComponentType:5126,byteStride:16},{kind:_.o.TangentKind,accessorType:"VEC4",accessorComponentType:5126,byteStride:16},{kind:_.o.UVKind,accessorType:"VEC2",accessorComponentType:5126,byteStride:8},{kind:_.o.UV2Kind,accessorType:"VEC2",accessorComponentType:5126,byteStride:8},{kind:_.o.MatricesIndicesKind,accessorType:"VEC4",accessorComponentType:5123,byteStride:8},{kind:_.o.MatricesIndicesExtraKind,accessorType:"VEC4",accessorComponentType:5123,byteStride:8},{kind:_.o.MatricesWeightsKind,accessorType:"VEC4",accessorComponentType:5126,byteStride:16},{kind:_.o.MatricesWeightsExtraKind,accessorType:"VEC4",accessorComponentType:5126,byteStride:16}];if(f){for(var l=null,h=this._getMeshPrimitiveMode(f),p={},m=f.morphTargetManager,g=0,x=u;g<x.length;g++){var S=($=x[g]).kind,b=$.accessorComponentType;if(f.isVerticesDataPresent(S)){var C=this._getVertexBufferFromMesh(S,f);$.byteStride=C?C.getSize()*_.o.GetTypeByteLength($.accessorComponentType):4*_.o.DeduceStride(S),12===$.byteStride&&($.accessorType="VEC3"),this._createBufferViewKind(S,b,t,n,$.byteStride,i),$.bufferViewIndex=this._bufferViews.length-1,p[S]=$.bufferViewIndex}}if(f.getTotalIndices()){var P=f.getIndices();if(P){var A=4*P.length;o=d._CreateBufferView(0,n.getByteOffset(),A,void 0,"Indices - "+f.name),this._bufferViews.push(o),l=this._bufferViews.length-1;for(var F=0,R=P.length;F<R;++F)n.setUInt32(P[F])}}if(f.subMeshes)for(var w=0,M=f.subMeshes;w<M.length;w++){var L=M[w],N=L.getMaterial()||f.getScene().defaultMaterial,O=null;if(N)if(f instanceof T._){var D={name:f.name+" material"};(!f.color.equals(v.Wo.White())||f.alpha<1)&&(D.pbrMetallicRoughness={baseColorFactor:f.color.asArray().concat([f.alpha])}),this._materials.push(D),O=this._materials.length-1}else if(N instanceof I.G){var U=N.subMaterials[L.materialIndex];U&&(N=U,O=this._materialMap[N.uniqueId])}else O=this._materialMap[N.uniqueId];var B=null!=O?this._materials[O]:null,V={attributes:{}};this._setPrimitiveMode(V,h);for(var G=0,z=u;G<z.length;G++){if((S=($=z[G]).kind)!==_.o.UVKind&&S!==_.o.UV2Kind||this._options.exportUnusedUVs||B&&this._glTFMaterialExporter._hasTexturesPresent(B))if(Z=f.getVerticesData(S))if(C=this._getVertexBufferFromMesh(S,f)){var k=C.getSize(),W=$.bufferViewIndex;if(null!=W){s={min:null,max:null},S==_.o.PositionKind&&(s=d._CalculateMinMaxPositions(Z,0,Z.length/k,i));var H=d._CreateAccessor(W,S+" - "+t.name,$.accessorType,$.accessorComponentType,Z.length/k,0,s.min,s.max);this._accessors.push(H),this._setAttributeKind(V,S)}}}if(l){H=d._CreateAccessor(l,"indices - "+t.name,"SCALAR",5125,L.indexCount,4*L.indexStart,null,null);this._accessors.push(H),V.indices=this._accessors.length-1}if(null!=O&&Object.keys(V.attributes).length>0){var K=null!==f.overrideMaterialSideOrientation?f.overrideMaterialSideOrientation:N.sideOrientation;if(K==E.F.ClockWiseSideOrientation&&this._babylonScene.useRightHandedSystem||K==E.F.ClockWiseSideOrientation&&i&&f.overrideMaterialSideOrientation!==(null===(r=f.material)||void 0===r?void 0:r.sideOrientation)){var X=null!=l?this._bufferViews[l].byteOffset:null;null==X&&(X=0);var j=null;if(null!=l&&(j=f.getIndices()),j)this._reorderIndicesBasedOnPrimitiveMode(L,h,j,X,n);else for(var q=0,Y=u;q<Y.length;q++){var Z,$=Y[q];if(Z=f.getVerticesData($.kind)){var Q=this._bufferViews[p[$.kind]].byteOffset;Q||(Q=0),this._reorderVertexAttributeDataBasedOnPrimitiveMode(L,h,K,$.kind,Z,Q,n,i)}}}V.material=O}if(m)for(var J=void 0,ee=0;ee<m.numTargets;++ee)J=m.getTarget(ee),this._setMorphTargetAttributes(L,V,J,n,i);e.primitives.push(V),this._extensionsPostExportMeshPrimitiveAsync("postExport",V,L,n),a.push()}}return Promise.all(a).then((function(){}))},e.prototype._isBabylonCoordinateSystemConvertingNode=function(e){return e instanceof u.Y&&("__root__"===e.name&&(1!==e.getWorldMatrix().determinant()&&(!(e instanceof c.Kj&&null!==e.geometry||e instanceof y.S&&null!==e.sourceMesh.geometry)&&!this._includeCoordinateSystemConversionNodes)))},e.prototype._createSceneAsync=function(e,t){var n,i,s,a=this,f={nodes:[]},u=(0,g.ev)((0,g.ev)((0,g.ev)((0,g.ev)([],e.transformNodes,!0),e.meshes,!0),e.lights,!0),e.cameras,!0),l=[];this._convertToRightHandedSystem=!e.useRightHandedSystem,this._convertToRightHandedSystemMap={},e.rootNodes.forEach((function(e){a._convertToRightHandedSystemMap[e.uniqueId]=a._convertToRightHandedSystem,e.getDescendants(!1).forEach((function(e){a._convertToRightHandedSystemMap[e.uniqueId]=a._convertToRightHandedSystem}))})),e.rootNodes.forEach((function(e){if(a._isBabylonCoordinateSystemConvertingNode(e)){l.push(e);var t=u.indexOf(e);-1!==t&&u.splice(t,1),e.getDescendants(!1).forEach((function(e){a._convertToRightHandedSystemMap[e.uniqueId]=!1}))}}));var d=new Map;e.cameras.forEach((function(e){if(!a._options.shouldExportNode||a._options.shouldExportNode(e)){var t={type:e.mode===w.V.PERSPECTIVE_CAMERA?"perspective":"orthographic"};if(e.name&&(t.name=e.name),"perspective"===t.type)t.perspective={aspectRatio:e.getEngine().getAspectRatio(e),yfov:e.fovMode===w.V.FOVMODE_VERTICAL_FIXED?e.fov:e.fov*e.getEngine().getAspectRatio(e),znear:e.minZ,zfar:e.maxZ};else if("orthographic"===t.type){var n=e.orthoLeft&&e.orthoRight?.5*(e.orthoRight-e.orthoLeft):.5*e.getEngine().getRenderWidth(),i=e.orthoBottom&&e.orthoTop?.5*(e.orthoTop-e.orthoBottom):.5*e.getEngine().getRenderHeight();t.orthographic={xmag:n,ymag:i,znear:e.minZ,zfar:e.maxZ}}d.set(e,a._cameras.length),a._cameras.push(t)}}));var h=this._getExportNodes(u),p=h[0],m=h[1];return this._glTFMaterialExporter._convertMaterialsToGLTFAsync(m,"image/png",!0).then((function(){return a._createNodeMapAndAnimationsAsync(e,p,t).then((function(h){return a._createSkinsAsync(e,h,t).then((function(e){if(a._nodeMap=h,a._totalByteLength=t.getByteOffset(),null==a._totalByteLength)throw new Error("undefined byte length!");for(var p=0,m=u;p<m.length;p++){var g=m[p];if(void 0!==(n=a._nodeMap[g.uniqueId])){if(i=a._nodes[n],g.metadata&&(a._options.metadataSelector?i.extras=a._options.metadataSelector(g.metadata):g.metadata.gltf&&(i.extras=g.metadata.gltf.extras)),g instanceof w.V&&(i.camera=d.get(g)),!g.parent||-1!==l.indexOf(g.parent))if(a._options.shouldExportNode&&!a._options.shouldExportNode(g))o.w1.Log("Omitting "+g.name+" from scene.");else a._convertToRightHandedSystemMap[g.uniqueId]&&(i.translation&&(i.translation[2]*=-1,i.translation[0]*=-1),i.rotation=i.rotation?r._f.FromArray([0,1,0,0]).multiply(r._f.FromArray(i.rotation)).asArray():r._f.FromArray([0,1,0,0]).asArray()),f.nodes.push(n);if(g instanceof c.Kj){var v=g;v.skeleton&&(i.skin=e[v.skeleton.uniqueId])}if(s=g.getDescendants(!0),!i.children&&s&&s.length){for(var _=[],x=0,T=s;x<T.length;x++){var y=T[x];null!=a._nodeMap[y.uniqueId]&&_.push(a._nodeMap[y.uniqueId])}_.length&&(i.children=_)}}}f.nodes.length&&a._scenes.push(f)}))}))}))},e.prototype._getExportNodes=function(e){for(var t=[],n=new Set,i=0,r=e;i<r.length;i++){var o=r[i];if(!this._options.shouldExportNode||this._options.shouldExportNode(o)){if(t.push(o),o instanceof x.x){var s=o.material||o.getScene().defaultMaterial;if(s instanceof I.G)for(var a=0,f=s.subMaterials;a<f.length;a++){var u=f[a];u&&n.add(u)}else n.add(s)}}else"Excluding node ".concat(o.name)}return[t,n]},e.prototype._createNodeMapAndAnimationsAsync=function(e,t,n){for(var i,r=this,s=Promise.resolve(),a={},f={name:"runtime animations",channels:[],samplers:[]},u=[],l=function(t){s=s.then((function(){var s=r._convertToRightHandedSystemMap[t.uniqueId];return r._createNodeAsync(t,n,s).then((function(l){var c=r._extensionsPostExportNodeAsync("createNodeAsync",l,t,a,n);return null==c?(o.w1.Warn("Not exporting node ".concat(t.name)),Promise.resolve()):c.then((function(o){o&&(r._nodes.push(o),i=r._nodes.length-1,a[t.uniqueId]=i,e.animationGroups.length||(p._CreateMorphTargetAnimationFromMorphTargetAnimations(t,f,u,a,r._nodes,n,r._bufferViews,r._accessors,s,r._animationSampleRate),t.animations.length&&p._CreateNodeAnimationFromNodeAnimations(t,f,u,a,r._nodes,n,r._bufferViews,r._accessors,s,r._animationSampleRate)))}))}))}))},c=0,d=t;c<d.length;c++){l(d[c])}return s.then((function(){return f.channels.length&&f.samplers.length&&r._animations.push(f),u.forEach((function(e){e.channels.length&&e.samplers.length&&r._animations.push(e)})),e.animationGroups.length&&p._CreateNodeAndMorphAnimationFromAnimationGroups(e,r._animations,a,r._nodes,n,r._bufferViews,r._accessors,r._convertToRightHandedSystemMap,r._animationSampleRate),a}))},e.prototype._createNodeAsync=function(e,t,n){var i=this;return Promise.resolve().then((function(){var r={},o={primitives:[]};if(e.name&&(r.name=e.name),e instanceof u.Y){if(i._setNodeTransformation(r,e,n),e instanceof c.Kj){var s=e.morphTargetManager;if(s&&s.numTargets>0){o.weights=[];for(var a=0;a<s.numTargets;++a)o.weights.push(s.getTarget(a).influence)}}return i._setPrimitiveAttributesAsync(o,e,t,n).then((function(){return o.primitives.length&&(i._meshes.push(o),r.mesh=i._meshes.length-1),r}))}return e instanceof w.V?(i._setCameraTransformation(r,e,n),r):r}))},e.prototype._createSkinsAsync=function(e,t,n){for(var i,r=Promise.resolve(),s={},a=0,f=e.skeletons;a<f.length;a++){var u=f[a];if(!(u.bones.length<=0)){for(var l={joints:[]},c=[],h={},p=-1,m=0;m<u.bones.length;++m){-1!==(g=null!==(i=(v=u.bones[m]).getIndex())&&void 0!==i?i:m)&&(h[g]=v,g>p&&(p=g))}for(var g=0;g<=p;++g){var v=h[g];c.push(v.getInvertedAbsoluteTransform());var _=v.getTransformNode();_?l.joints.push(t[_.uniqueId]):o.w1.Warn("Exporting a bone without a linked transform node is currently unsupported")}var x=64*c.length,T=n.getByteOffset(),y=d._CreateBufferView(0,T,x,void 0,"InverseBindMatrices - "+u.name);this._bufferViews.push(y);var E=this._bufferViews.length-1,S=d._CreateAccessor(E,"InverseBindMatrices - "+u.name,"MAT4",5126,c.length,null,null,null),b=this._accessors.push(S)-1;l.inverseBindMatrices=b,this._skins.push(l),s[u.uniqueId]=this._skins.length-1,c.forEach((function(e){e.m.forEach((function(e){n.setFloat32(e)}))}))}}return r.then((function(){return s}))},e._ExtensionNames=new Array,e._ExtensionFactories={},e}(),N=function(){function e(e){this._arrayBuffer=new ArrayBuffer(e),this._dataView=new DataView(this._arrayBuffer),this._byteOffset=0}return e.prototype._resizeBuffer=function(e){for(var t=new ArrayBuffer(e),n=new Uint8Array(this._arrayBuffer),i=new Uint8Array(t),r=0,o=i.byteLength;r<o;++r)i[r]=n[r];return this._arrayBuffer=t,this._dataView=new DataView(this._arrayBuffer),t},e.prototype.getArrayBuffer=function(){return this._resizeBuffer(this.getByteOffset())},e.prototype.getByteOffset=function(){if(null==this._byteOffset)throw new Error("Byte offset is undefined!");return this._byteOffset},e.prototype.setUInt8=function(e,t){null!=t?t<this._byteOffset?this._dataView.setUint8(t,e):o.w1.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._byteOffset+1>this._arrayBuffer.byteLength&&this._resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setUint8(this._byteOffset,e),this._byteOffset+=1)},e.prototype.setUInt16=function(e,t){null!=t?t<this._byteOffset?this._dataView.setUint16(t,e,!0):o.w1.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._byteOffset+2>this._arrayBuffer.byteLength&&this._resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setUint16(this._byteOffset,e,!0),this._byteOffset+=2)},e.prototype.getUInt32=function(e){if(e<this._byteOffset)return this._dataView.getUint32(e,!0);throw o.w1.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"),new Error("BinaryWriter: byteoffset is greater than the current binary buffer length!")},e.prototype.getVector3Float32FromRef=function(e,t){t+8>this._byteOffset?o.w1.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(e.x=this._dataView.getFloat32(t,!0),e.y=this._dataView.getFloat32(t+4,!0),e.z=this._dataView.getFloat32(t+8,!0))},e.prototype.setVector3Float32FromRef=function(e,t){t+8>this._byteOffset?o.w1.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._dataView.setFloat32(t,e.x,!0),this._dataView.setFloat32(t+4,e.y,!0),this._dataView.setFloat32(t+8,e.z,!0))},e.prototype.getVector4Float32FromRef=function(e,t){t+12>this._byteOffset?o.w1.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(e.x=this._dataView.getFloat32(t,!0),e.y=this._dataView.getFloat32(t+4,!0),e.z=this._dataView.getFloat32(t+8,!0),e.w=this._dataView.getFloat32(t+12,!0))},e.prototype.setVector4Float32FromRef=function(e,t){t+12>this._byteOffset?o.w1.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._dataView.setFloat32(t,e.x,!0),this._dataView.setFloat32(t+4,e.y,!0),this._dataView.setFloat32(t+8,e.z,!0),this._dataView.setFloat32(t+12,e.w,!0))},e.prototype.setFloat32=function(e,t){isNaN(e)&&o.w1.Error("Invalid data being written!"),null!=t&&(t<this._byteOffset?this._dataView.setFloat32(t,e,!0):o.w1.Error("BinaryWriter: byteoffset is greater than the current binary length!")),this._byteOffset+4>this._arrayBuffer.byteLength&&this._resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setFloat32(this._byteOffset,e,!0),this._byteOffset+=4},e.prototype.setUInt32=function(e,t){null!=t?t<this._byteOffset?this._dataView.setUint32(t,e,!0):o.w1.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._byteOffset+4>this._arrayBuffer.byteLength&&this._resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setUint32(this._byteOffset,e,!0),this._byteOffset+=4)},e.prototype.setInt16=function(e,t){null!=t?t<this._byteOffset?this._dataView.setInt16(t,e,!0):o.w1.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._byteOffset+2>this._arrayBuffer.byteLength&&this._resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setInt16(this._byteOffset,e,!0),this._byteOffset+=2)},e.prototype.setByte=function(e,t){null!=t?t<this._byteOffset?this._dataView.setInt8(t,e):o.w1.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._byteOffset+1>this._arrayBuffer.byteLength&&this._resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setInt8(this._byteOffset,e),this._byteOffset++)},e}(),O=0,D=function(){function e(){}return e.GLTFAsync=function(e,t,n){return e.whenReadyAsync().then((function(){var i=t.replace(/\.[^/.]+$/,"");return new L(e,n)._generateGLTFAsync(i)}))},e._PreExportAsync=function(e,t){return Promise.resolve().then((function(){return t&&t.exportWithoutWaitingForScene?Promise.resolve():e.whenReadyAsync()}))},e._PostExportAsync=function(e,t,n){return Promise.resolve().then((function(){return n&&n.exportWithoutWaitingForScene,t}))},e.GLBAsync=function(e,t,n){var i=this;return this._PreExportAsync(e,n).then((function(){var r=t.replace(/\.[^/.]+$/,"");return new L(e,n)._generateGLBAsync(r).then((function(t){return i._PostExportAsync(e,t,n)}))}))},e}(),U=n(91062),B="precision highp float;varying vec2 vUV;uniform sampler2D textureSampler;uniform mat4 textureTransformMat;void main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\nvec2 uvTransformed=(textureTransformMat*vec4(vUV.xy,1,1)).xy;gl_FragColor=texture2D(textureSampler,uvTransformed);\n#define CUSTOM_FRAGMENT_MAIN_END\n}";n(69543).v.ShadersStore.textureTransformPixelShader=B;var V="KHR_texture_transform",G=function(){function e(){this._recordedTextures=[],this.name=V,this.enabled=!0,this.required=!1,this._wasUsed=!1}return e.prototype.dispose=function(){for(var e=0,t=this._recordedTextures;e<t.length;e++){t[e].dispose()}},Object.defineProperty(e.prototype,"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0}),e.prototype.postExportTexture=function(e,t,n){if(n&&(0===n.uAng&&0===n.wAng&&0===n.vAng||0===n.uRotationCenter&&0===n.vRotationCenter)){var i={},r=!1;if(0===n.uOffset&&0===n.vOffset||(i.offset=[n.uOffset,n.vOffset],r=!0),1===n.uScale&&1===n.vScale||(i.scale=[n.uScale,n.vScale],r=!0),0!==n.wAng&&(i.rotation=n.wAng,r=!0),0!==n.coordinatesIndex&&(i.texCoord=n.coordinatesIndex,r=!0),!r)return;this._wasUsed=!0,t.extensions||(t.extensions={}),t.extensions[V]=i}},e.prototype.preExportTextureAsync=function(e,t){var n=this;return new Promise((function(i,r){var o=t.getScene();if(o){var s=!1;if(0===t.uAng&&0===t.wAng&&0===t.vAng||0===t.uRotationCenter&&0===t.vRotationCenter||(s=!0),s)return n._textureTransformTextureAsync(t,o).then((function(e){i(e)})).catch((function(e){r(e)}));i(t)}else r("".concat(e,': "scene" is not defined for Babylon texture ').concat(t.name,"!"))}))},e.prototype._textureTransformTextureAsync=function(e,t){var n=this;return new Promise((function(i){var r=new U.g("".concat(e.name),e.getSize(),"textureTransform",t);r||(o.w1.Log("Cannot create procedural texture for ".concat(e.name,"!")),i(e)),r.reservedDataStore={hidden:!0,source:e},n._recordedTextures.push(r),r.coordinatesIndex=e.coordinatesIndex,r.setTexture("textureSampler",e),r.setMatrix("textureTransformMat",e.getTextureMatrix()),r.isReady()?(r.render(),i(r)):r.getEffect().executeWhenCompiled((function(){r.render(),i(r)}))}))},e}();L.RegisterExtension(V,(function(){return new G}));var z=n(43812),k=n(258),W=n(41691),H=n(84318),K="KHR_lights_punctual",X=function(){function e(e){this.name=K,this.enabled=!0,this.required=!1,this._exporter=e}return e.prototype.dispose=function(){this._lights=null},Object.defineProperty(e.prototype,"wasUsed",{get:function(){return!!this._lights},enumerable:!1,configurable:!0}),e.prototype.onExporting=function(){this._exporter._glTF.extensions.KHR_lights_punctual=this._lights},e.prototype.postExportNodeAsync=function(e,t,n,i){var o=this;return new Promise((function(s){if(t&&n instanceof W.O){var a=n,f=void 0,u=a.getTypeID()==z._.LIGHTTYPEID_POINTLIGHT?"point":a.getTypeID()==z._.LIGHTTYPEID_DIRECTIONALLIGHT?"directional":a.getTypeID()==z._.LIGHTTYPEID_SPOTLIGHT?"spot":null;if(null==u)H.Y.Warn("".concat(e,": Light ").concat(a.name," is not supported in ").concat(K));else{var l=a.position.clone(),c=o._exporter._convertToRightHandedSystemMap[n.uniqueId];if(l.equals(r.P.Zero())||(c&&d._GetRightHandedPositionVector3FromRef(l),t.translation=l.asArray()),"point"!==u){var h=a.direction,p=-Math.atan2(h.z*(o._exporter._babylonScene.useRightHandedSystem?-1:1),h.x)+Math.PI/2,m=Math.sqrt(h.x*h.x+h.z*h.z),g=-Math.atan2(h.y,m),_=r._f.RotationYawPitchRoll(p,g,0);c&&d._GetRightHandedQuaternionFromRef(_),_.equals(r._f.Identity())||(t.rotation=_.asArray())}if(a.falloffType!==z._.FALLOFF_GLTF&&H.Y.Warn("".concat(e,": Light falloff for ").concat(a.name," does not match the ").concat(K," specification!")),f={type:u},a.diffuse.equals(v.Wo.White())||(f.color=a.diffuse.asArray()),1!==a.intensity&&(f.intensity=a.intensity),a.range!==Number.MAX_VALUE&&(f.range=a.range),"spot"===u){var x=a;x.angle!==Math.PI/2&&(null==f.spot&&(f.spot={}),f.spot.outerConeAngle=x.angle/2),0!==x.innerAngle&&(null==f.spot&&(f.spot={}),f.spot.innerConeAngle=x.innerAngle/2)}null==o._lights&&(o._lights={lights:[]}),o._lights.lights.push(f);var T={light:o._lights.lights.length-1},y=n.parent;if(y&&1==y.getChildren().length){var E=o._exporter._nodes[i[y.uniqueId]];if(E){var S=r.jp.Matrix[0],b=r.jp.Matrix[1],C=E.translation?new r.P(E.translation[0],E.translation[1],E.translation[2]):r.P.Zero(),P=E.rotation?new r._f(E.rotation[0],E.rotation[1],E.rotation[2],E.rotation[3]):r._f.Identity(),A=E.scale?new r.P(E.scale[0],E.scale[1],E.scale[2]):r.P.One();r.y3.ComposeToRef(A,P,C,S),S.invertToRef(b);var F=r.jp.Matrix[2],R=t.translation?new r.P(t.translation[0],t.translation[1],t.translation[2]):r.P.Zero();a instanceof k.O&&R.subtractInPlace(o._exporter._babylonScene.useRightHandedSystem?a.direction:d._GetRightHandedPositionVector3(a.direction));var w=o._exporter._babylonScene.useRightHandedSystem?r._f.Identity():new r._f(0,1,0,0);t.rotation&&w.multiplyInPlace(new r._f(t.rotation[0],t.rotation[1],t.rotation[2],t.rotation[3]));var M=t.scale?new r.P(t.scale[0],t.scale[1],t.scale[2]):r.P.One();r.y3.ComposeToRef(M,w,R,F),F.multiplyToRef(b,F);var I=r.jp.Vector3[0],L=r.jp.Quaternion[0],N=r.jp.Vector3[1];return F.decompose(I,L,N),E.scale=I.asArray(),E.rotation=L.asArray(),E.translation=N.asArray(),null==E.extensions&&(E.extensions={}),E.extensions.KHR_lights_punctual=T,void s(null)}}null==t.extensions&&(t.extensions={}),t.extensions.KHR_lights_punctual=T}}s(t)}))},e}();L.RegisterExtension(K,(function(e){return new X(e)}));var j=n(12746),q="KHR_materials_clearcoat",Y=function(){function e(e){this.name=q,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0}),e.prototype.postExportMaterialAdditionalTextures=function(e,t,n){var i=[];return n instanceof j.m&&n.clearCoat.isEnabled?(n.clearCoat.texture&&i.push(n.clearCoat.texture),!n.clearCoat.useRoughnessFromMainTexture&&n.clearCoat.textureRoughness&&i.push(n.clearCoat.textureRoughness),n.clearCoat.bumpTexture&&i.push(n.clearCoat.bumpTexture),i):[]},e.prototype.postExportMaterialAsync=function(e,t,n){var i=this;return new Promise((function(e){if(n instanceof j.m){if(!n.clearCoat.isEnabled)return void e(t);i._wasUsed=!0,t.extensions=t.extensions||{};var r=i._exporter._glTFMaterialExporter._getTextureInfo(n.clearCoat.texture),s=void 0;s=n.clearCoat.useRoughnessFromMainTexture?i._exporter._glTFMaterialExporter._getTextureInfo(n.clearCoat.texture):i._exporter._glTFMaterialExporter._getTextureInfo(n.clearCoat.textureRoughness),n.clearCoat.isTintEnabled&&o.w1.Warn("Clear Color tint is not supported for glTF export. Ignoring for: ".concat(n.name)),n.clearCoat.remapF0OnInterfaceChange&&o.w1.Warn("Clear Color F0 remapping is not supported for glTF export. Ignoring for: ".concat(n.name));var a=i._exporter._glTFMaterialExporter._getTextureInfo(n.clearCoat.bumpTexture),f={clearcoatFactor:n.clearCoat.intensity,clearcoatTexture:null!=r?r:void 0,clearcoatRoughnessFactor:n.clearCoat.roughness,clearcoatRoughnessTexture:null!=s?s:void 0,clearcoatNormalTexture:null!=a?a:void 0,hasTextures:function(){return null!==f.clearcoatTexture||null!==f.clearcoatRoughnessTexture||null!==f.clearcoatRoughnessTexture}};t.extensions.KHR_materials_clearcoat=f}e(t)}))},e}();L.RegisterExtension(q,(function(e){return new Y(e)}));var Z="KHR_materials_iridescence",$=function(){function e(e){this.name=Z,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0}),e.prototype.postExportMaterialAdditionalTextures=function(e,t,n){var i=[];return n instanceof j.m&&n.iridescence.isEnabled?(n.iridescence.texture&&i.push(n.iridescence.texture),n.iridescence.thicknessTexture&&n.iridescence.thicknessTexture!==n.iridescence.texture&&i.push(n.iridescence.thicknessTexture),i):[]},e.prototype.postExportMaterialAsync=function(e,t,n){var i=this;return new Promise((function(e){if(n instanceof j.m){if(!n.iridescence.isEnabled)return void e(t);i._wasUsed=!0,t.extensions=t.extensions||{};var r=i._exporter._glTFMaterialExporter._getTextureInfo(n.iridescence.texture),o=i._exporter._glTFMaterialExporter._getTextureInfo(n.iridescence.thicknessTexture),s={iridescenceFactor:n.iridescence.intensity,iridescenceIor:n.iridescence.indexOfRefraction,iridescenceThicknessMinimum:n.iridescence.minimumThickness,iridescenceThicknessMaximum:n.iridescence.maximumThickness,iridescenceTexture:null!=r?r:void 0,iridescenceThicknessTexture:null!=o?o:void 0,hasTextures:function(){return null!==s.iridescenceTexture||null!==s.iridescenceThicknessTexture}};t.extensions.KHR_materials_iridescence=s}e(t)}))},e}();L.RegisterExtension(Z,(function(e){return new $(e)}));var Q=n(47914),J="KHR_materials_sheen",ee=function(){function e(e){this.name=J,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0}),e.prototype.postExportMaterialAdditionalTextures=function(e,t,n){return n instanceof Q.Y&&n.sheen.isEnabled&&n.sheen.texture?[n.sheen.texture]:[]},e.prototype.postExportMaterialAsync=function(e,t,n){var i=this;return new Promise((function(e){var r,o,s,a;if(n instanceof Q.Y){if(!n.sheen.isEnabled)return void e(t);i._wasUsed=!0,null==t.extensions&&(t.extensions={});var f={sheenColorFactor:n.sheen.color.asArray(),sheenRoughnessFactor:null!==(r=n.sheen.roughness)&&void 0!==r?r:0,hasTextures:function(){return null!==f.sheenColorTexture||null!==f.sheenRoughnessTexture}};n.sheen.texture&&(f.sheenColorTexture=null!==(o=i._exporter._glTFMaterialExporter._getTextureInfo(n.sheen.texture))&&void 0!==o?o:void 0),n.sheen.textureRoughness&&!n.sheen.useRoughnessFromMainTexture?f.sheenRoughnessTexture=null!==(s=i._exporter._glTFMaterialExporter._getTextureInfo(n.sheen.textureRoughness))&&void 0!==s?s:void 0:n.sheen.texture&&n.sheen.useRoughnessFromMainTexture&&(f.sheenRoughnessTexture=null!==(a=i._exporter._glTFMaterialExporter._getTextureInfo(n.sheen.texture))&&void 0!==a?a:void 0),t.extensions.KHR_materials_sheen=f}e(t)}))},e}();L.RegisterExtension(J,(function(e){return new ee(e)}));var te=n(3085),ne="KHR_materials_unlit",ie=function(){function e(){this.name=ne,this.enabled=!0,this.required=!1,this._wasUsed=!1}return Object.defineProperty(e.prototype,"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){},e.prototype.postExportMaterialAsync=function(e,t,n){var i=this;return new Promise((function(e){var r=!1;n instanceof Q.Y?r=n.unlit:n instanceof te.K&&(r=n.disableLighting),r&&(i._wasUsed=!0,null==t.extensions&&(t.extensions={}),t.extensions.KHR_materials_unlit={}),e(t)}))},e}();L.RegisterExtension(ne,(function(){return new ie}));var re="KHR_materials_ior",oe=function(){function e(){this.name=re,this.enabled=!0,this.required=!1,this._wasUsed=!1}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0}),e.prototype._isExtensionEnabled=function(e){return!e.unlit&&(null!=e.indexOfRefraction&&1.5!=e.indexOfRefraction)},e.prototype.postExportMaterialAsync=function(e,t,n){var i=this;return new Promise((function(e){if(n instanceof Q.Y&&i._isExtensionEnabled(n)){i._wasUsed=!0;var r={ior:n.indexOfRefraction};t.extensions=t.extensions||{},t.extensions.KHR_materials_ior=r}e(t)}))},e}();L.RegisterExtension(re,(function(e){return new oe}));var se="KHR_materials_specular",ae=function(){function e(e){this.name=se,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0}),e.prototype.postExportMaterialAdditionalTextures=function(e,t,n){var i=[];return n instanceof Q.Y&&this._isExtensionEnabled(n)?(n.metallicReflectanceTexture&&i.push(n.metallicReflectanceTexture),n.reflectanceTexture&&i.push(n.reflectanceTexture),i):i},e.prototype._isExtensionEnabled=function(e){return!e.unlit&&(null!=e.metallicF0Factor&&1!=e.metallicF0Factor||null!=e.metallicReflectanceColor&&!e.metallicReflectanceColor.equalsFloats(1,1,1)||this._hasTexturesExtension(e))},e.prototype._hasTexturesExtension=function(e){return null!=e.metallicReflectanceTexture||null!=e.reflectanceTexture},e.prototype.postExportMaterialAsync=function(e,t,n){var i=this;return new Promise((function(e){var r,o;if(n instanceof Q.Y&&i._isExtensionEnabled(n)){i._wasUsed=!0,t.extensions=t.extensions||{};var s=null!==(r=i._exporter._glTFMaterialExporter._getTextureInfo(n.metallicReflectanceTexture))&&void 0!==r?r:void 0,a=null!==(o=i._exporter._glTFMaterialExporter._getTextureInfo(n.reflectanceTexture))&&void 0!==o?o:void 0,f={specularFactor:1==n.metallicF0Factor?void 0:n.metallicF0Factor,specularTexture:s,specularColorFactor:n.metallicReflectanceColor.equalsFloats(1,1,1)?void 0:n.metallicReflectanceColor.asArray(),specularColorTexture:a,hasTextures:function(){return i._hasTexturesExtension(n)}};t.extensions.KHR_materials_specular=f}e(t)}))},e}();L.RegisterExtension(se,(function(e){return new ae(e)}));var fe="KHR_materials_volume",ue=function(){function e(e){this.name=fe,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0}),e.prototype.postExportMaterialAdditionalTextures=function(e,t,n){var i=[];return n instanceof Q.Y&&this._isExtensionEnabled(n)?(n.subSurface.thicknessTexture&&i.push(n.subSurface.thicknessTexture),i):i},e.prototype._isExtensionEnabled=function(e){if(e.unlit)return!1;var t=e.subSurface;return!(!t.isRefractionEnabled&&!t.isTranslucencyEnabled)&&(null!=t.maximumThickness&&0!=t.maximumThickness||null!=t.tintColorAtDistance&&t.tintColorAtDistance!=Number.POSITIVE_INFINITY||null!=t.tintColor&&t.tintColor!=v.Wo.White()||this._hasTexturesExtension(e))},e.prototype._hasTexturesExtension=function(e){return null!=e.subSurface.thicknessTexture},e.prototype.postExportMaterialAsync=function(e,t,n){var i=this;return new Promise((function(e){var r;if(n instanceof Q.Y&&i._isExtensionEnabled(n)){i._wasUsed=!0;var o=n.subSurface,s={thicknessFactor:0==o.maximumThickness?void 0:o.maximumThickness,thicknessTexture:null!==(r=i._exporter._glTFMaterialExporter._getTextureInfo(o.thicknessTexture))&&void 0!==r?r:void 0,attenuationDistance:o.tintColorAtDistance==Number.POSITIVE_INFINITY?void 0:o.tintColorAtDistance,attenuationColor:o.tintColor.equalsFloats(1,1,1)?void 0:o.tintColor.asArray(),hasTextures:function(){return i._hasTexturesExtension(n)}};t.extensions=t.extensions||{},t.extensions.KHR_materials_volume=s}e(t)}))},e}();L.RegisterExtension(fe,(function(e){return new ue(e)}));var le="KHR_materials_transmission",ce=function(){function e(e){this.name=le,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0}),e.prototype.postExportMaterialAdditionalTextures=function(e,t,n){var i=[];return n instanceof Q.Y&&this._isExtensionEnabled(n)?(n.subSurface.thicknessTexture&&i.push(n.subSurface.thicknessTexture),i):i},e.prototype._isExtensionEnabled=function(e){if(e.unlit)return!1;var t=e.subSurface;return t.isRefractionEnabled&&null!=t.refractionIntensity&&0!=t.refractionIntensity||this._hasTexturesExtension(e)},e.prototype._hasTexturesExtension=function(e){return null!=e.subSurface.refractionIntensityTexture},e.prototype.postExportMaterialAsync=function(e,t,n){var i=this;return new Promise((function(e){var r;if(n instanceof Q.Y&&i._isExtensionEnabled(n)){i._wasUsed=!0;var o=n.subSurface,s={transmissionFactor:0===o.refractionIntensity?void 0:o.refractionIntensity,transmissionTexture:null!==(r=i._exporter._glTFMaterialExporter._getTextureInfo(o.refractionIntensityTexture))&&void 0!==r?r:void 0,hasTextures:function(){return i._hasTexturesExtension(n)}};t.extensions=t.extensions||{},t.extensions.KHR_materials_transmission=s}e(t)}))},e}();L.RegisterExtension(le,(function(e){return new ce(e)}));n(83236);var de="EXT_mesh_gpu_instancing",he=function(){function e(e){this.name=de,this.enabled=!0,this.required=!1,this._wasUsed=!1,this._exporter=e}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0}),e.prototype.postExportNodeAsync=function(e,t,n,i,o){var s=this;return new Promise((function(e){if(t&&n instanceof c.Kj&&n.hasThinInstances&&o){s._wasUsed=!0;for(var i=r.P.Zero(),a=r._f.Identity(),f=r.P.One(),u=n.thinInstanceGetWorldMatrices(),l=r.jp.Vector3[2],d=r.jp.Quaternion[1],h=r.jp.Vector3[3],p=!1,m=!1,g=!1,v=new Float32Array(3*n.thinInstanceCount),_=new Float32Array(4*n.thinInstanceCount),x=new Float32Array(3*n.thinInstanceCount),T=0,y=0,E=u;y<E.length;y++){E[y].decompose(h,d,l),v.set(l.asArray(),3*T),_.set(d.normalize().asArray(),4*T),x.set(h.asArray(),3*T),p=p||!l.equalsWithEpsilon(i),m=m||!d.equalsWithEpsilon(a),g=g||!h.equalsWithEpsilon(f),T++}var S={attributes:{}};if(p&&(S.attributes.TRANSLATION=s._buildAccessor(v,"VEC3",n.thinInstanceCount,o,5126)),m){S.attributes.ROTATION=s._buildAccessor(_,"VEC4",n.thinInstanceCount,o,5126)}g&&(S.attributes.SCALE=s._buildAccessor(x,"VEC3",n.thinInstanceCount,o,5126)),t.extensions=t.extensions||{},t.extensions.EXT_mesh_gpu_instancing=S}e(t)}))},e.prototype._buildAccessor=function(e,t,n,i,r){var o=i.getByteOffset();switch(r){case 5126:for(var s=0;s!=e.length;s++)i.setFloat32(e[s]);break;case 5120:for(s=0;s!=e.length;s++)i.setByte(127*e[s]);break;case 5122:for(s=0;s!=e.length;s++)i.setInt16(32767*e[s])}var a={buffer:0,byteOffset:o,byteLength:e.length*_.o.GetTypeByteLength(r)},f=this._exporter._bufferViews.length;this._exporter._bufferViews.push(a);var u=this._exporter._accessors.length,l={bufferView:f,componentType:r,count:n,type:t,normalized:5120==r||5122==r};return this._exporter._accessors.push(l),u},e}();L.RegisterExtension(de,(function(e){return new he(e)}));var pe=function(){function e(){}return e.CreateSTL=function(e,t,n,i,o,s){void 0===t&&(t=!0),void 0===n&&(n="stlmesh"),void 0===i&&(i=!1),void 0===o&&(o=!0),void 0===s&&(s=!1);var a,f=function(e,t,n){var i=[3*e[n],3*e[n+1],3*e[n+2]],o=[new r.P(t[i[0]],t[i[0]+2],t[i[0]+1]),new r.P(t[i[1]],t[i[1]+2],t[i[1]+1]),new r.P(t[i[2]],t[i[2]+2],t[i[2]+1])],s=o[0].subtract(o[1]),a=o[2].subtract(o[1]);return{v:o,n:r.P.Cross(a,s).normalize()}},u=function(e,t,n,i){return t=l(e,t,n.x,i),t=l(e,t,n.y,i),l(e,t,n.z,i)},l=function(e,t,n,i){return e.setFloat32(t,n,i),t+4},c=0,d=0;if(i){for(var h=0;h<e.length;h++){c+=(v=(m=e[h]).getIndices())?v.length/3:0}var p=new ArrayBuffer(84+50*c);d+=80,(a=new DataView(p)).setUint32(d,c,o),d+=4}else a="solid stlmesh\r\n";for(h=0;h<e.length;h++){var m=e[h];s||m.bakeCurrentTransformIntoVertices();for(var g=m.getVerticesData(_.o.PositionKind)||[],v=m.getIndices()||[],x=0;x<v.length;x+=3){var T=f(v,g,x);i?(d=u(a,d,T.n,o),d=u(a,d,T.v[0],o),d=u(a,d,T.v[1],o),d=u(a,d,T.v[2],o),d+=2):(a+="facet normal "+T.n.x+" "+T.n.y+" "+T.n.z+"\r\n",a+="\touter loop\r\n",a+="\t\tvertex "+T.v[0].x+" "+T.v[0].y+" "+T.v[0].z+"\r\n",a+="\t\tvertex "+T.v[1].x+" "+T.v[1].y+" "+T.v[1].z+"\r\n",a+="\t\tvertex "+T.v[2].x+" "+T.v[2].y+" "+T.v[2].z+"\r\n",a+="\tendloop\r\n",a+="endfacet\r\n")}}if(i||(a+="endsolid stlmesh"),t){var y=document.createElement("a"),E=new Blob([a],{type:"application/octet-stream"});y.href=window.URL.createObjectURL(E),y.download=n+".stl",y.click()}return a},e}()}}]);