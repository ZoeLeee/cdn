{"version":3,"file":"js/vender~d6819ed9.13c6971f.js","mappings":"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","sources":["webpack:///../../../node_modules/@babylonjs/core/LensFlares/lensFlare.js","webpack:///../../../node_modules/@babylonjs/core/LensFlares/lensFlareSystem.js","webpack:///../../../node_modules/@babylonjs/core/LensFlares/lensFlareSystemSceneComponent.js","webpack:///../../../node_modules/@babylonjs/core/Lights/Shadows/shadowGenerator.js","webpack:///../../../node_modules/@babylonjs/core/Lights/directionalLight.js","webpack:///../../../node_modules/@babylonjs/core/Lights/hemisphericLight.js","webpack:///../../../node_modules/@babylonjs/core/Lights/Shadows/cascadedShadowGenerator.js","webpack:///../../../node_modules/@babylonjs/core/Lights/Shadows/shadowGeneratorSceneComponent.js","webpack:///../../../node_modules/@babylonjs/core/Lights/light.js","webpack:///../../../node_modules/@babylonjs/core/Lights/lightConstants.js","webpack:///../../../node_modules/@babylonjs/core/Lights/pointLight.js","webpack:///../../../node_modules/@babylonjs/core/Lights/shadowLight.js","webpack:///../../../node_modules/@babylonjs/core/Lights/spotLight.js","webpack:///../../../node_modules/@babylonjs/core/Loading/loadingScreen.js","webpack:///../../../node_modules/@babylonjs/core/Loading/Plugins/babylonFileLoader.js","webpack:///../../../node_modules/@babylonjs/core/Loading/sceneLoader.js","webpack:///../../../node_modules/@babylonjs/core/Loading/sceneLoaderFlags.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Background/backgroundMaterial.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Dual/currentScreenBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Dual/fogBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Dual/lightBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Dual/imageSourceBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Dual/textureBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Dual/reflectionTextureBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Dual/sceneDepthBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Dual/clipPlanesBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Dual/reflectionTextureBaseBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Fragment/TBNBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Fragment/fragmentOutputBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Fragment/imageProcessingBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Fragment/perturbNormalBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Fragment/discardBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Fragment/frontFacingBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Fragment/derivativeBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Fragment/fragCoordBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Fragment/screenSizeBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Fragment/screenSpaceBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Fragment/twirlBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Input/animatedInputBlockTypes.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/Input/inputBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/PBR/anisotropyBlock.js","webpack:///../../../node_modules/@babylonjs/core/Materials/Node/Blocks/PBR/clearCoatBlock.js"],"sourcesContent":["import { Color3 } from \"../Maths/math.color.js\";\nimport { Texture } from \"../Materials/Textures/texture.js\";\n\nimport { DrawWrapper } from \"../Materials/drawWrapper.js\";\nimport { VertexBuffer } from \"../Buffers/buffer.js\";\n/**\n * This represents one of the lens effect in a `lensFlareSystem`.\n * It controls one of the individual texture used in the effect.\n * @see https://doc.babylonjs.com/how_to/how_to_use_lens_flares\n */\nvar LensFlare = /** @class */ (function () {\n    /**\n     * Instantiates a new Lens Flare.\n     * This represents one of the lens effect in a `lensFlareSystem`.\n     * It controls one of the individual texture used in the effect.\n     * @see https://doc.babylonjs.com/how_to/how_to_use_lens_flares\n     * @param size Define the size of the lens flare in the system (a floating value between 0 and 1)\n     * @param position Define the position of the lens flare in the system. (a floating value between -1 and 1). A value of 0 is located on the emitter. A value greater than 0 is beyond the emitter and a value lesser than 0 is behind.\n     * @param color Define the lens color\n     * @param imgUrl Define the lens texture url\n     * @param system Define the `lensFlareSystem` this flare is part of\n     */\n    function LensFlare(\n    /**\n     * Define the size of the lens flare in the system (a floating value between 0 and 1)\n     */\n    size, \n    /**\n     * Define the position of the lens flare in the system. (a floating value between -1 and 1). A value of 0 is located on the emitter. A value greater than 0 is beyond the emitter and a value lesser than 0 is behind.\n     */\n    position, color, imgUrl, system) {\n        this.size = size;\n        this.position = position;\n        /**\n         * Define the alpha mode to render this particular lens.\n         */\n        this.alphaMode = 6;\n        this.color = color || new Color3(1, 1, 1);\n        this.texture = imgUrl ? new Texture(imgUrl, system.getScene(), true) : null;\n        this._system = system;\n        var engine = system.scene.getEngine();\n        this._drawWrapper = new DrawWrapper(engine);\n        this._drawWrapper.effect = engine.createEffect(\"lensFlare\", [VertexBuffer.PositionKind], [\"color\", \"viewportMatrix\"], [\"textureSampler\"], \"\");\n        system.lensFlares.push(this);\n    }\n    /**\n     * Creates a new Lens Flare.\n     * This represents one of the lens effect in a `lensFlareSystem`.\n     * It controls one of the individual texture used in the effect.\n     * @see https://doc.babylonjs.com/how_to/how_to_use_lens_flares\n     * @param size Define the size of the lens flare (a floating value between 0 and 1)\n     * @param position Define the position of the lens flare in the system. (a floating value between -1 and 1). A value of 0 is located on the emitter. A value greater than 0 is beyond the emitter and a value lesser than 0 is behind.\n     * @param color Define the lens color\n     * @param imgUrl Define the lens texture url\n     * @param system Define the `lensFlareSystem` this flare is part of\n     * @returns The newly created Lens Flare\n     */\n    LensFlare.AddFlare = function (size, position, color, imgUrl, system) {\n        return new LensFlare(size, position, color, imgUrl, system);\n    };\n    /**\n     * Dispose and release the lens flare with its associated resources.\n     */\n    LensFlare.prototype.dispose = function () {\n        if (this.texture) {\n            this.texture.dispose();\n        }\n        // Remove from scene\n        var index = this._system.lensFlares.indexOf(this);\n        this._system.lensFlares.splice(index, 1);\n    };\n    return LensFlare;\n}());\nexport { LensFlare };\n//# sourceMappingURL=lensFlare.js.map","import { Tools } from \"../Misc/tools.js\";\nimport { Matrix, Vector3 } from \"../Maths/math.vector.js\";\nimport { Scalar } from \"../Maths/math.scalar.js\";\nimport { EngineStore } from \"../Engines/engineStore.js\";\nimport { VertexBuffer } from \"../Buffers/buffer.js\";\nimport { Ray } from \"../Culling/ray.js\";\nimport { Material } from \"../Materials/material.js\";\nimport { LensFlare } from \"./lensFlare.js\";\n\nimport \"../Shaders/lensFlare.fragment.js\";\nimport \"../Shaders/lensFlare.vertex.js\";\nimport { _WarnImport } from \"../Misc/devTools.js\";\nimport { Color3 } from \"../Maths/math.color.js\";\n/**\n * This represents a Lens Flare System or the shiny effect created by the light reflection on the  camera lenses.\n * It is usually composed of several `lensFlare`.\n * @see https://doc.babylonjs.com/how_to/how_to_use_lens_flares\n */\nvar LensFlareSystem = /** @class */ (function () {\n    /**\n     * Instantiates a lens flare system.\n     * This represents a Lens Flare System or the shiny effect created by the light reflection on the  camera lenses.\n     * It is usually composed of several `lensFlare`.\n     * @see https://doc.babylonjs.com/how_to/how_to_use_lens_flares\n     * @param name Define the name of the lens flare system in the scene\n     * @param emitter Define the source (the emitter) of the lens flares (it can be a camera, a light or a mesh).\n     * @param scene Define the scene the lens flare system belongs to\n     */\n    function LensFlareSystem(\n    /**\n     * Define the name of the lens flare system\n     */\n    name, emitter, scene) {\n        this.name = name;\n        /**\n         * List of lens flares used in this system.\n         */\n        this.lensFlares = new Array();\n        /**\n         * Define a limit from the border the lens flare can be visible.\n         */\n        this.borderLimit = 300;\n        /**\n         * Define a viewport border we do not want to see the lens flare in.\n         */\n        this.viewportBorder = 0;\n        /**\n         * Restricts the rendering of the effect to only the camera rendering this layer mask.\n         */\n        this.layerMask = 0x0fffffff;\n        this._vertexBuffers = {};\n        this._isEnabled = true;\n        this._scene = scene || EngineStore.LastCreatedScene;\n        LensFlareSystem._SceneComponentInitialization(this._scene);\n        this._emitter = emitter;\n        this.id = name;\n        scene.lensFlareSystems.push(this);\n        this.meshesSelectionPredicate = function (m) {\n            return (scene.activeCamera && m.material && m.isVisible && m.isEnabled() && m.isBlocker && (m.layerMask & scene.activeCamera.layerMask) != 0);\n        };\n        var engine = scene.getEngine();\n        // VBO\n        var vertices = [];\n        vertices.push(1, 1);\n        vertices.push(-1, 1);\n        vertices.push(-1, -1);\n        vertices.push(1, -1);\n        this._vertexBuffers[VertexBuffer.PositionKind] = new VertexBuffer(engine, vertices, VertexBuffer.PositionKind, false, false, 2);\n        // Indices\n        this._createIndexBuffer();\n    }\n    Object.defineProperty(LensFlareSystem.prototype, \"scene\", {\n        /** Gets the scene */\n        get: function () {\n            return this._scene;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LensFlareSystem.prototype._createIndexBuffer = function () {\n        var indices = [];\n        indices.push(0);\n        indices.push(1);\n        indices.push(2);\n        indices.push(0);\n        indices.push(2);\n        indices.push(3);\n        this._indexBuffer = this._scene.getEngine().createIndexBuffer(indices);\n    };\n    Object.defineProperty(LensFlareSystem.prototype, \"isEnabled\", {\n        /**\n         * Define if the lens flare system is enabled.\n         */\n        get: function () {\n            return this._isEnabled;\n        },\n        set: function (value) {\n            this._isEnabled = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Get the scene the effects belongs to.\n     * @returns the scene holding the lens flare system\n     */\n    LensFlareSystem.prototype.getScene = function () {\n        return this._scene;\n    };\n    /**\n     * Get the emitter of the lens flare system.\n     * It defines the source of the lens flares (it can be a camera, a light or a mesh).\n     * @returns the emitter of the lens flare system\n     */\n    LensFlareSystem.prototype.getEmitter = function () {\n        return this._emitter;\n    };\n    /**\n     * Set the emitter of the lens flare system.\n     * It defines the source of the lens flares (it can be a camera, a light or a mesh).\n     * @param newEmitter Define the new emitter of the system\n     */\n    LensFlareSystem.prototype.setEmitter = function (newEmitter) {\n        this._emitter = newEmitter;\n    };\n    /**\n     * Get the lens flare system emitter position.\n     * The emitter defines the source of the lens flares (it can be a camera, a light or a mesh).\n     * @returns the position\n     */\n    LensFlareSystem.prototype.getEmitterPosition = function () {\n        return this._emitter.getAbsolutePosition ? this._emitter.getAbsolutePosition() : this._emitter.position;\n    };\n    /**\n     * @param globalViewport\n     * @hidden\n     */\n    LensFlareSystem.prototype.computeEffectivePosition = function (globalViewport) {\n        var position = this.getEmitterPosition();\n        position = Vector3.Project(position, Matrix.Identity(), this._scene.getTransformMatrix(), globalViewport);\n        this._positionX = position.x;\n        this._positionY = position.y;\n        position = Vector3.TransformCoordinates(this.getEmitterPosition(), this._scene.getViewMatrix());\n        if (this.viewportBorder > 0) {\n            globalViewport.x -= this.viewportBorder;\n            globalViewport.y -= this.viewportBorder;\n            globalViewport.width += this.viewportBorder * 2;\n            globalViewport.height += this.viewportBorder * 2;\n            position.x += this.viewportBorder;\n            position.y += this.viewportBorder;\n            this._positionX += this.viewportBorder;\n            this._positionY += this.viewportBorder;\n        }\n        var rhs = this._scene.useRightHandedSystem;\n        var okZ = (position.z > 0 && !rhs) || (position.z < 0 && rhs);\n        if (okZ) {\n            if (this._positionX > globalViewport.x && this._positionX < globalViewport.x + globalViewport.width) {\n                if (this._positionY > globalViewport.y && this._positionY < globalViewport.y + globalViewport.height) {\n                    return true;\n                }\n            }\n            return true;\n        }\n        return false;\n    };\n    /** @hidden */\n    LensFlareSystem.prototype._isVisible = function () {\n        if (!this._isEnabled || !this._scene.activeCamera) {\n            return false;\n        }\n        var emitterPosition = this.getEmitterPosition();\n        var direction = emitterPosition.subtract(this._scene.activeCamera.globalPosition);\n        var distance = direction.length();\n        direction.normalize();\n        var ray = new Ray(this._scene.activeCamera.globalPosition, direction);\n        var pickInfo = this._scene.pickWithRay(ray, this.meshesSelectionPredicate, true);\n        return !pickInfo || !pickInfo.hit || pickInfo.distance > distance;\n    };\n    /**\n     * @hidden\n     */\n    LensFlareSystem.prototype.render = function () {\n        if (!this._scene.activeCamera) {\n            return false;\n        }\n        var engine = this._scene.getEngine();\n        var viewport = this._scene.activeCamera.viewport;\n        var globalViewport = viewport.toGlobal(engine.getRenderWidth(true), engine.getRenderHeight(true));\n        // Position\n        if (!this.computeEffectivePosition(globalViewport)) {\n            return false;\n        }\n        // Visibility\n        if (!this._isVisible()) {\n            return false;\n        }\n        // Intensity\n        var awayX;\n        var awayY;\n        if (this._positionX < this.borderLimit + globalViewport.x) {\n            awayX = this.borderLimit + globalViewport.x - this._positionX;\n        }\n        else if (this._positionX > globalViewport.x + globalViewport.width - this.borderLimit) {\n            awayX = this._positionX - globalViewport.x - globalViewport.width + this.borderLimit;\n        }\n        else {\n            awayX = 0;\n        }\n        if (this._positionY < this.borderLimit + globalViewport.y) {\n            awayY = this.borderLimit + globalViewport.y - this._positionY;\n        }\n        else if (this._positionY > globalViewport.y + globalViewport.height - this.borderLimit) {\n            awayY = this._positionY - globalViewport.y - globalViewport.height + this.borderLimit;\n        }\n        else {\n            awayY = 0;\n        }\n        var away = awayX > awayY ? awayX : awayY;\n        away -= this.viewportBorder;\n        if (away > this.borderLimit) {\n            away = this.borderLimit;\n        }\n        var intensity = 1.0 - Scalar.Clamp(away / this.borderLimit, 0, 1);\n        if (intensity < 0) {\n            return false;\n        }\n        if (intensity > 1.0) {\n            intensity = 1.0;\n        }\n        if (this.viewportBorder > 0) {\n            globalViewport.x += this.viewportBorder;\n            globalViewport.y += this.viewportBorder;\n            globalViewport.width -= this.viewportBorder * 2;\n            globalViewport.height -= this.viewportBorder * 2;\n            this._positionX -= this.viewportBorder;\n            this._positionY -= this.viewportBorder;\n        }\n        // Position\n        var centerX = globalViewport.x + globalViewport.width / 2;\n        var centerY = globalViewport.y + globalViewport.height / 2;\n        var distX = centerX - this._positionX;\n        var distY = centerY - this._positionY;\n        // Effects\n        engine.setState(false);\n        engine.setDepthBuffer(false);\n        // Flares\n        for (var index = 0; index < this.lensFlares.length; index++) {\n            var flare = this.lensFlares[index];\n            if (!flare._drawWrapper.effect.isReady() || (flare.texture && !flare.texture.isReady())) {\n                continue;\n            }\n            engine.enableEffect(flare._drawWrapper);\n            engine.bindBuffers(this._vertexBuffers, this._indexBuffer, flare._drawWrapper.effect);\n            engine.setAlphaMode(flare.alphaMode);\n            var x = centerX - distX * flare.position;\n            var y = centerY - distY * flare.position;\n            var cw = flare.size;\n            var ch = flare.size * engine.getAspectRatio(this._scene.activeCamera, true);\n            var cx = 2 * (x / (globalViewport.width + globalViewport.x * 2)) - 1.0;\n            var cy = 1.0 - 2 * (y / (globalViewport.height + globalViewport.y * 2));\n            var viewportMatrix = Matrix.FromValues(cw / 2, 0, 0, 0, 0, ch / 2, 0, 0, 0, 0, 1, 0, cx, cy, 0, 1);\n            flare._drawWrapper.effect.setMatrix(\"viewportMatrix\", viewportMatrix);\n            // Texture\n            flare._drawWrapper.effect.setTexture(\"textureSampler\", flare.texture);\n            // Color\n            flare._drawWrapper.effect.setFloat4(\"color\", flare.color.r * intensity, flare.color.g * intensity, flare.color.b * intensity, 1.0);\n            // Draw order\n            engine.drawElementsType(Material.TriangleFillMode, 0, 6);\n        }\n        engine.setDepthBuffer(true);\n        engine.setAlphaMode(0);\n        return true;\n    };\n    /**\n     * Rebuilds the lens flare system\n     */\n    LensFlareSystem.prototype.rebuild = function () {\n        var _a;\n        this._createIndexBuffer();\n        for (var key in this._vertexBuffers) {\n            (_a = this._vertexBuffers[key]) === null || _a === void 0 ? void 0 : _a._rebuild();\n        }\n    };\n    /**\n     * Dispose and release the lens flare with its associated resources.\n     */\n    LensFlareSystem.prototype.dispose = function () {\n        var vertexBuffer = this._vertexBuffers[VertexBuffer.PositionKind];\n        if (vertexBuffer) {\n            vertexBuffer.dispose();\n            this._vertexBuffers[VertexBuffer.PositionKind] = null;\n        }\n        if (this._indexBuffer) {\n            this._scene.getEngine()._releaseBuffer(this._indexBuffer);\n            this._indexBuffer = null;\n        }\n        while (this.lensFlares.length) {\n            this.lensFlares[0].dispose();\n        }\n        // Remove from scene\n        var index = this._scene.lensFlareSystems.indexOf(this);\n        this._scene.lensFlareSystems.splice(index, 1);\n    };\n    /**\n     * Parse a lens flare system from a JSON representation\n     * @param parsedLensFlareSystem Define the JSON to parse\n     * @param scene Define the scene the parsed system should be instantiated in\n     * @param rootUrl Define the rootUrl of the load sequence to easily find a load relative dependencies such as textures\n     * @returns the parsed system\n     */\n    LensFlareSystem.Parse = function (parsedLensFlareSystem, scene, rootUrl) {\n        var emitter = scene.getLastEntryById(parsedLensFlareSystem.emitterId);\n        var name = parsedLensFlareSystem.name || \"lensFlareSystem#\" + parsedLensFlareSystem.emitterId;\n        var lensFlareSystem = new LensFlareSystem(name, emitter, scene);\n        lensFlareSystem.id = parsedLensFlareSystem.id || name;\n        lensFlareSystem.borderLimit = parsedLensFlareSystem.borderLimit;\n        for (var index = 0; index < parsedLensFlareSystem.flares.length; index++) {\n            var parsedFlare = parsedLensFlareSystem.flares[index];\n            LensFlare.AddFlare(parsedFlare.size, parsedFlare.position, Color3.FromArray(parsedFlare.color), parsedFlare.textureName ? rootUrl + parsedFlare.textureName : \"\", lensFlareSystem);\n        }\n        return lensFlareSystem;\n    };\n    /**\n     * Serialize the current Lens Flare System into a JSON representation.\n     * @returns the serialized JSON\n     */\n    LensFlareSystem.prototype.serialize = function () {\n        var serializationObject = {};\n        serializationObject.id = this.id;\n        serializationObject.name = this.name;\n        serializationObject.emitterId = this.getEmitter().id;\n        serializationObject.borderLimit = this.borderLimit;\n        serializationObject.flares = [];\n        for (var index = 0; index < this.lensFlares.length; index++) {\n            var flare = this.lensFlares[index];\n            serializationObject.flares.push({\n                size: flare.size,\n                position: flare.position,\n                color: flare.color.asArray(),\n                textureName: Tools.GetFilename(flare.texture ? flare.texture.name : \"\"),\n            });\n        }\n        return serializationObject;\n    };\n    /**\n     * @param _\n     * @hidden\n     */\n    LensFlareSystem._SceneComponentInitialization = function (_) {\n        throw _WarnImport(\"LensFlareSystemSceneComponent\");\n    };\n    return LensFlareSystem;\n}());\nexport { LensFlareSystem };\n//# sourceMappingURL=lensFlareSystem.js.map","import { Tools } from \"../Misc/tools.js\";\nimport { SceneComponentConstants } from \"../sceneComponent.js\";\nimport { AbstractScene } from \"../abstractScene.js\";\nimport { LensFlareSystem } from \"./lensFlareSystem.js\";\n// Adds the parser to the scene parsers.\nAbstractScene.AddParser(SceneComponentConstants.NAME_LENSFLARESYSTEM, function (parsedData, scene, container, rootUrl) {\n    // Lens flares\n    if (parsedData.lensFlareSystems !== undefined && parsedData.lensFlareSystems !== null) {\n        if (!container.lensFlareSystems) {\n            container.lensFlareSystems = new Array();\n        }\n        for (var index = 0, cache = parsedData.lensFlareSystems.length; index < cache; index++) {\n            var parsedLensFlareSystem = parsedData.lensFlareSystems[index];\n            var lf = LensFlareSystem.Parse(parsedLensFlareSystem, scene, rootUrl);\n            container.lensFlareSystems.push(lf);\n        }\n    }\n});\nAbstractScene.prototype.getLensFlareSystemByName = function (name) {\n    for (var index = 0; index < this.lensFlareSystems.length; index++) {\n        if (this.lensFlareSystems[index].name === name) {\n            return this.lensFlareSystems[index];\n        }\n    }\n    return null;\n};\nAbstractScene.prototype.getLensFlareSystemById = function (id) {\n    for (var index = 0; index < this.lensFlareSystems.length; index++) {\n        if (this.lensFlareSystems[index].id === id) {\n            return this.lensFlareSystems[index];\n        }\n    }\n    return null;\n};\nAbstractScene.prototype.getLensFlareSystemByID = function (id) {\n    return this.getLensFlareSystemById(id);\n};\nAbstractScene.prototype.removeLensFlareSystem = function (toRemove) {\n    var index = this.lensFlareSystems.indexOf(toRemove);\n    if (index !== -1) {\n        this.lensFlareSystems.splice(index, 1);\n    }\n    return index;\n};\nAbstractScene.prototype.addLensFlareSystem = function (newLensFlareSystem) {\n    this.lensFlareSystems.push(newLensFlareSystem);\n};\n/**\n * Defines the lens flare scene component responsible to manage any lens flares\n * in a given scene.\n */\nvar LensFlareSystemSceneComponent = /** @class */ (function () {\n    /**\n     * Creates a new instance of the component for the given scene\n     * @param scene Defines the scene to register the component in\n     */\n    function LensFlareSystemSceneComponent(scene) {\n        /**\n         * The component name helpful to identify the component in the list of scene components.\n         */\n        this.name = SceneComponentConstants.NAME_LENSFLARESYSTEM;\n        this.scene = scene;\n        scene.lensFlareSystems = new Array();\n    }\n    /**\n     * Registers the component in a given scene\n     */\n    LensFlareSystemSceneComponent.prototype.register = function () {\n        this.scene._afterCameraDrawStage.registerStep(SceneComponentConstants.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM, this, this._draw);\n    };\n    /**\n     * Rebuilds the elements related to this component in case of\n     * context lost for instance.\n     */\n    LensFlareSystemSceneComponent.prototype.rebuild = function () {\n        for (var index = 0; index < this.scene.lensFlareSystems.length; index++) {\n            this.scene.lensFlareSystems[index].rebuild();\n        }\n    };\n    /**\n     * Adds all the elements from the container to the scene\n     * @param container the container holding the elements\n     */\n    LensFlareSystemSceneComponent.prototype.addFromContainer = function (container) {\n        var _this = this;\n        if (!container.lensFlareSystems) {\n            return;\n        }\n        container.lensFlareSystems.forEach(function (o) {\n            _this.scene.addLensFlareSystem(o);\n        });\n    };\n    /**\n     * Removes all the elements in the container from the scene\n     * @param container contains the elements to remove\n     * @param dispose if the removed element should be disposed (default: false)\n     */\n    LensFlareSystemSceneComponent.prototype.removeFromContainer = function (container, dispose) {\n        var _this = this;\n        if (!container.lensFlareSystems) {\n            return;\n        }\n        container.lensFlareSystems.forEach(function (o) {\n            _this.scene.removeLensFlareSystem(o);\n            if (dispose) {\n                o.dispose();\n            }\n        });\n    };\n    /**\n     * Serializes the component data to the specified json object\n     * @param serializationObject The object to serialize to\n     */\n    LensFlareSystemSceneComponent.prototype.serialize = function (serializationObject) {\n        // Lens flares\n        serializationObject.lensFlareSystems = [];\n        var lensFlareSystems = this.scene.lensFlareSystems;\n        for (var _i = 0, lensFlareSystems_1 = lensFlareSystems; _i < lensFlareSystems_1.length; _i++) {\n            var lensFlareSystem = lensFlareSystems_1[_i];\n            serializationObject.lensFlareSystems.push(lensFlareSystem.serialize());\n        }\n    };\n    /**\n     * Disposes the component and the associated resources.\n     */\n    LensFlareSystemSceneComponent.prototype.dispose = function () {\n        var lensFlareSystems = this.scene.lensFlareSystems;\n        while (lensFlareSystems.length) {\n            lensFlareSystems[0].dispose();\n        }\n    };\n    LensFlareSystemSceneComponent.prototype._draw = function (camera) {\n        // Lens flares\n        if (this.scene.lensFlaresEnabled) {\n            var lensFlareSystems = this.scene.lensFlareSystems;\n            Tools.StartPerformanceCounter(\"Lens flares\", lensFlareSystems.length > 0);\n            for (var _i = 0, lensFlareSystems_2 = lensFlareSystems; _i < lensFlareSystems_2.length; _i++) {\n                var lensFlareSystem = lensFlareSystems_2[_i];\n                if ((camera.layerMask & lensFlareSystem.layerMask) !== 0) {\n                    lensFlareSystem.render();\n                }\n            }\n            Tools.EndPerformanceCounter(\"Lens flares\", lensFlareSystems.length > 0);\n        }\n    };\n    return LensFlareSystemSceneComponent;\n}());\nexport { LensFlareSystemSceneComponent };\nLensFlareSystem._SceneComponentInitialization = function (scene) {\n    var component = scene._getComponent(SceneComponentConstants.NAME_LENSFLARESYSTEM);\n    if (!component) {\n        component = new LensFlareSystemSceneComponent(scene);\n        scene._addComponent(component);\n    }\n};\n//# sourceMappingURL=lensFlareSystemSceneComponent.js.map","import { __assign } from \"tslib\";\nimport { Matrix, Vector3, Vector2 } from \"../../Maths/math.vector.js\";\nimport { Color4 } from \"../../Maths/math.color.js\";\nimport { VertexBuffer } from \"../../Buffers/buffer.js\";\nimport { Light } from \"../../Lights/light.js\";\nimport { MaterialHelper } from \"../../Materials/materialHelper.js\";\nimport { Texture } from \"../../Materials/Textures/texture.js\";\nimport { RenderTargetTexture } from \"../../Materials/Textures/renderTargetTexture.js\";\nimport { PostProcess } from \"../../PostProcesses/postProcess.js\";\nimport { BlurPostProcess } from \"../../PostProcesses/blurPostProcess.js\";\n\nimport { Observable } from \"../../Misc/observable.js\";\nimport { _WarnImport } from \"../../Misc/devTools.js\";\nimport { EffectFallbacks } from \"../../Materials/effectFallbacks.js\";\nimport { RenderingManager } from \"../../Rendering/renderingManager.js\";\nimport { DrawWrapper } from \"../../Materials/drawWrapper.js\";\nimport \"../../Shaders/shadowMap.fragment.js\";\nimport \"../../Shaders/shadowMap.vertex.js\";\nimport \"../../Shaders/depthBoxBlur.fragment.js\";\nimport \"../../Shaders/ShadersInclude/shadowMapFragmentSoftTransparentShadow.js\";\n/**\n * Default implementation IShadowGenerator.\n * This is the main object responsible of generating shadows in the framework.\n * Documentation: https://doc.babylonjs.com/babylon101/shadows\n */\nvar ShadowGenerator = /** @class */ (function () {\n    /**\n     * Creates a ShadowGenerator object.\n     * A ShadowGenerator is the required tool to use the shadows.\n     * Each light casting shadows needs to use its own ShadowGenerator.\n     * Documentation : https://doc.babylonjs.com/babylon101/shadows\n     * @param mapSize The size of the texture what stores the shadows. Example : 1024.\n     * @param light The light object generating the shadows.\n     * @param usefullFloatFirst By default the generator will try to use half float textures but if you need precision (for self shadowing for instance), you can use this option to enforce full float texture.\n     */\n    function ShadowGenerator(mapSize, light, usefullFloatFirst) {\n        /**\n         * Observable triggered before the shadow is rendered. Can be used to update internal effect state\n         */\n        this.onBeforeShadowMapRenderObservable = new Observable();\n        /**\n         * Observable triggered after the shadow is rendered. Can be used to restore internal effect state\n         */\n        this.onAfterShadowMapRenderObservable = new Observable();\n        /**\n         * Observable triggered before a mesh is rendered in the shadow map.\n         * Can be used to update internal effect state (that you can get from the onBeforeShadowMapRenderObservable)\n         */\n        this.onBeforeShadowMapRenderMeshObservable = new Observable();\n        /**\n         * Observable triggered after a mesh is rendered in the shadow map.\n         * Can be used to update internal effect state (that you can get from the onAfterShadowMapRenderObservable)\n         */\n        this.onAfterShadowMapRenderMeshObservable = new Observable();\n        this._bias = 0.00005;\n        this._normalBias = 0;\n        this._blurBoxOffset = 1;\n        this._blurScale = 2;\n        this._blurKernel = 1;\n        this._useKernelBlur = false;\n        this._filter = ShadowGenerator.FILTER_NONE;\n        this._filteringQuality = ShadowGenerator.QUALITY_HIGH;\n        this._contactHardeningLightSizeUVRatio = 0.1;\n        this._darkness = 0;\n        this._transparencyShadow = false;\n        /**\n         * Enables or disables shadows with varying strength based on the transparency\n         * When it is enabled, the strength of the shadow is taken equal to mesh.visibility\n         * If you enabled an alpha texture on your material, the alpha value red from the texture is also combined to compute the strength:\n         *          mesh.visibility * alphaTexture.a\n         * The texture used is the diffuse by default, but it can be set to the opacity by setting useOpacityTextureForTransparentShadow\n         * Note that by definition transparencyShadow must be set to true for enableSoftTransparentShadow to work!\n         */\n        this.enableSoftTransparentShadow = false;\n        /**\n         * If this is true, use the opacity texture's alpha channel for transparent shadows instead of the diffuse one\n         */\n        this.useOpacityTextureForTransparentShadow = false;\n        /**\n         * Controls the extent to which the shadows fade out at the edge of the frustum\n         */\n        this.frustumEdgeFalloff = 0;\n        /**\n         * If true the shadow map is generated by rendering the back face of the mesh instead of the front face.\n         * This can help with self-shadowing as the geometry making up the back of objects is slightly offset.\n         * It might on the other hand introduce peter panning.\n         */\n        this.forceBackFacesOnly = false;\n        this._lightDirection = Vector3.Zero();\n        this._viewMatrix = Matrix.Zero();\n        this._projectionMatrix = Matrix.Zero();\n        this._transformMatrix = Matrix.Zero();\n        this._cachedPosition = new Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\n        this._cachedDirection = new Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\n        this._currentFaceIndex = 0;\n        this._currentFaceIndexCache = 0;\n        this._defaultTextureMatrix = Matrix.Identity();\n        this._mapSize = mapSize;\n        this._light = light;\n        this._scene = light.getScene();\n        light._shadowGenerator = this;\n        this.id = light.id;\n        this._useUBO = this._scene.getEngine().supportsUniformBuffers;\n        if (this._useUBO) {\n            this._sceneUBOs = [];\n            this._sceneUBOs.push(this._scene.createSceneUniformBuffer(\"Scene for Shadow Generator (light \\\"\".concat(this._light.name, \"\\\")\")));\n        }\n        ShadowGenerator._SceneComponentInitialization(this._scene);\n        // Texture type fallback from float to int if not supported.\n        var caps = this._scene.getEngine().getCaps();\n        if (!usefullFloatFirst) {\n            if (caps.textureHalfFloatRender && caps.textureHalfFloatLinearFiltering) {\n                this._textureType = 2;\n            }\n            else if (caps.textureFloatRender && caps.textureFloatLinearFiltering) {\n                this._textureType = 1;\n            }\n            else {\n                this._textureType = 0;\n            }\n        }\n        else {\n            if (caps.textureFloatRender && caps.textureFloatLinearFiltering) {\n                this._textureType = 1;\n            }\n            else if (caps.textureHalfFloatRender && caps.textureHalfFloatLinearFiltering) {\n                this._textureType = 2;\n            }\n            else {\n                this._textureType = 0;\n            }\n        }\n        this._initializeGenerator();\n        this._applyFilterValues();\n    }\n    Object.defineProperty(ShadowGenerator.prototype, \"bias\", {\n        /**\n         * Gets the bias: offset applied on the depth preventing acnea (in light direction).\n         */\n        get: function () {\n            return this._bias;\n        },\n        /**\n         * Sets the bias: offset applied on the depth preventing acnea (in light direction).\n         */\n        set: function (bias) {\n            this._bias = bias;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"normalBias\", {\n        /**\n         * Gets the normalBias: offset applied on the depth preventing acnea (along side the normal direction and proportional to the light/normal angle).\n         */\n        get: function () {\n            return this._normalBias;\n        },\n        /**\n         * Sets the normalBias: offset applied on the depth preventing acnea (along side the normal direction and proportional to the light/normal angle).\n         */\n        set: function (normalBias) {\n            this._normalBias = normalBias;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"blurBoxOffset\", {\n        /**\n         * Gets the blur box offset: offset applied during the blur pass.\n         * Only useful if useKernelBlur = false\n         */\n        get: function () {\n            return this._blurBoxOffset;\n        },\n        /**\n         * Sets the blur box offset: offset applied during the blur pass.\n         * Only useful if useKernelBlur = false\n         */\n        set: function (value) {\n            if (this._blurBoxOffset === value) {\n                return;\n            }\n            this._blurBoxOffset = value;\n            this._disposeBlurPostProcesses();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"blurScale\", {\n        /**\n         * Gets the blur scale: scale of the blurred texture compared to the main shadow map.\n         * 2 means half of the size.\n         */\n        get: function () {\n            return this._blurScale;\n        },\n        /**\n         * Sets the blur scale: scale of the blurred texture compared to the main shadow map.\n         * 2 means half of the size.\n         */\n        set: function (value) {\n            if (this._blurScale === value) {\n                return;\n            }\n            this._blurScale = value;\n            this._disposeBlurPostProcesses();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"blurKernel\", {\n        /**\n         * Gets the blur kernel: kernel size of the blur pass.\n         * Only useful if useKernelBlur = true\n         */\n        get: function () {\n            return this._blurKernel;\n        },\n        /**\n         * Sets the blur kernel: kernel size of the blur pass.\n         * Only useful if useKernelBlur = true\n         */\n        set: function (value) {\n            if (this._blurKernel === value) {\n                return;\n            }\n            this._blurKernel = value;\n            this._disposeBlurPostProcesses();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"useKernelBlur\", {\n        /**\n         * Gets whether the blur pass is a kernel blur (if true) or box blur.\n         * Only useful in filtered mode (useBlurExponentialShadowMap...)\n         */\n        get: function () {\n            return this._useKernelBlur;\n        },\n        /**\n         * Sets whether the blur pass is a kernel blur (if true) or box blur.\n         * Only useful in filtered mode (useBlurExponentialShadowMap...)\n         */\n        set: function (value) {\n            if (this._useKernelBlur === value) {\n                return;\n            }\n            this._useKernelBlur = value;\n            this._disposeBlurPostProcesses();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"depthScale\", {\n        /**\n         * Gets the depth scale used in ESM mode.\n         */\n        get: function () {\n            return this._depthScale !== undefined ? this._depthScale : this._light.getDepthScale();\n        },\n        /**\n         * Sets the depth scale used in ESM mode.\n         * This can override the scale stored on the light.\n         */\n        set: function (value) {\n            this._depthScale = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ShadowGenerator.prototype._validateFilter = function (filter) {\n        return filter;\n    };\n    Object.defineProperty(ShadowGenerator.prototype, \"filter\", {\n        /**\n         * Gets the current mode of the shadow generator (normal, PCF, ESM...).\n         * The returned value is a number equal to one of the available mode defined in ShadowMap.FILTER_x like _FILTER_NONE\n         */\n        get: function () {\n            return this._filter;\n        },\n        /**\n         * Sets the current mode of the shadow generator (normal, PCF, ESM...).\n         * The returned value is a number equal to one of the available mode defined in ShadowMap.FILTER_x like _FILTER_NONE\n         */\n        set: function (value) {\n            value = this._validateFilter(value);\n            // Blurring the cubemap is going to be too expensive. Reverting to unblurred version\n            if (this._light.needCube()) {\n                if (value === ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP) {\n                    this.useExponentialShadowMap = true;\n                    return;\n                }\n                else if (value === ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP) {\n                    this.useCloseExponentialShadowMap = true;\n                    return;\n                }\n                // PCF on cubemap would also be expensive\n                else if (value === ShadowGenerator.FILTER_PCF || value === ShadowGenerator.FILTER_PCSS) {\n                    this.usePoissonSampling = true;\n                    return;\n                }\n            }\n            // Weblg1 fallback for PCF.\n            if (value === ShadowGenerator.FILTER_PCF || value === ShadowGenerator.FILTER_PCSS) {\n                if (!this._scene.getEngine()._features.supportShadowSamplers) {\n                    this.usePoissonSampling = true;\n                    return;\n                }\n            }\n            if (this._filter === value) {\n                return;\n            }\n            this._filter = value;\n            this._disposeBlurPostProcesses();\n            this._applyFilterValues();\n            this._light._markMeshesAsLightDirty();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"usePoissonSampling\", {\n        /**\n         * Gets if the current filter is set to Poisson Sampling.\n         */\n        get: function () {\n            return this.filter === ShadowGenerator.FILTER_POISSONSAMPLING;\n        },\n        /**\n         * Sets the current filter to Poisson Sampling.\n         */\n        set: function (value) {\n            var filter = this._validateFilter(ShadowGenerator.FILTER_POISSONSAMPLING);\n            if (!value && this.filter !== ShadowGenerator.FILTER_POISSONSAMPLING) {\n                return;\n            }\n            this.filter = value ? filter : ShadowGenerator.FILTER_NONE;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"useExponentialShadowMap\", {\n        /**\n         * Gets if the current filter is set to ESM.\n         */\n        get: function () {\n            return this.filter === ShadowGenerator.FILTER_EXPONENTIALSHADOWMAP;\n        },\n        /**\n         * Sets the current filter is to ESM.\n         */\n        set: function (value) {\n            var filter = this._validateFilter(ShadowGenerator.FILTER_EXPONENTIALSHADOWMAP);\n            if (!value && this.filter !== ShadowGenerator.FILTER_EXPONENTIALSHADOWMAP) {\n                return;\n            }\n            this.filter = value ? filter : ShadowGenerator.FILTER_NONE;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"useBlurExponentialShadowMap\", {\n        /**\n         * Gets if the current filter is set to filtered ESM.\n         */\n        get: function () {\n            return this.filter === ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP;\n        },\n        /**\n         * Gets if the current filter is set to filtered  ESM.\n         */\n        set: function (value) {\n            var filter = this._validateFilter(ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP);\n            if (!value && this.filter !== ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP) {\n                return;\n            }\n            this.filter = value ? filter : ShadowGenerator.FILTER_NONE;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"useCloseExponentialShadowMap\", {\n        /**\n         * Gets if the current filter is set to \"close ESM\" (using the inverse of the\n         * exponential to prevent steep falloff artifacts).\n         */\n        get: function () {\n            return this.filter === ShadowGenerator.FILTER_CLOSEEXPONENTIALSHADOWMAP;\n        },\n        /**\n         * Sets the current filter to \"close ESM\" (using the inverse of the\n         * exponential to prevent steep falloff artifacts).\n         */\n        set: function (value) {\n            var filter = this._validateFilter(ShadowGenerator.FILTER_CLOSEEXPONENTIALSHADOWMAP);\n            if (!value && this.filter !== ShadowGenerator.FILTER_CLOSEEXPONENTIALSHADOWMAP) {\n                return;\n            }\n            this.filter = value ? filter : ShadowGenerator.FILTER_NONE;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"useBlurCloseExponentialShadowMap\", {\n        /**\n         * Gets if the current filter is set to filtered \"close ESM\" (using the inverse of the\n         * exponential to prevent steep falloff artifacts).\n         */\n        get: function () {\n            return this.filter === ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP;\n        },\n        /**\n         * Sets the current filter to filtered \"close ESM\" (using the inverse of the\n         * exponential to prevent steep falloff artifacts).\n         */\n        set: function (value) {\n            var filter = this._validateFilter(ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);\n            if (!value && this.filter !== ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP) {\n                return;\n            }\n            this.filter = value ? filter : ShadowGenerator.FILTER_NONE;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"usePercentageCloserFiltering\", {\n        /**\n         * Gets if the current filter is set to \"PCF\" (percentage closer filtering).\n         */\n        get: function () {\n            return this.filter === ShadowGenerator.FILTER_PCF;\n        },\n        /**\n         * Sets the current filter to \"PCF\" (percentage closer filtering).\n         */\n        set: function (value) {\n            var filter = this._validateFilter(ShadowGenerator.FILTER_PCF);\n            if (!value && this.filter !== ShadowGenerator.FILTER_PCF) {\n                return;\n            }\n            this.filter = value ? filter : ShadowGenerator.FILTER_NONE;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"filteringQuality\", {\n        /**\n         * Gets the PCF or PCSS Quality.\n         * Only valid if usePercentageCloserFiltering or usePercentageCloserFiltering is true.\n         */\n        get: function () {\n            return this._filteringQuality;\n        },\n        /**\n         * Sets the PCF or PCSS Quality.\n         * Only valid if usePercentageCloserFiltering or usePercentageCloserFiltering is true.\n         */\n        set: function (filteringQuality) {\n            if (this._filteringQuality === filteringQuality) {\n                return;\n            }\n            this._filteringQuality = filteringQuality;\n            this._disposeBlurPostProcesses();\n            this._applyFilterValues();\n            this._light._markMeshesAsLightDirty();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"useContactHardeningShadow\", {\n        /**\n         * Gets if the current filter is set to \"PCSS\" (contact hardening).\n         */\n        get: function () {\n            return this.filter === ShadowGenerator.FILTER_PCSS;\n        },\n        /**\n         * Sets the current filter to \"PCSS\" (contact hardening).\n         */\n        set: function (value) {\n            var filter = this._validateFilter(ShadowGenerator.FILTER_PCSS);\n            if (!value && this.filter !== ShadowGenerator.FILTER_PCSS) {\n                return;\n            }\n            this.filter = value ? filter : ShadowGenerator.FILTER_NONE;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"contactHardeningLightSizeUVRatio\", {\n        /**\n         * Gets the Light Size (in shadow map uv unit) used in PCSS to determine the blocker search area and the penumbra size.\n         * Using a ratio helps keeping shape stability independently of the map size.\n         *\n         * It does not account for the light projection as it was having too much\n         * instability during the light setup or during light position changes.\n         *\n         * Only valid if useContactHardeningShadow is true.\n         */\n        get: function () {\n            return this._contactHardeningLightSizeUVRatio;\n        },\n        /**\n         * Sets the Light Size (in shadow map uv unit) used in PCSS to determine the blocker search area and the penumbra size.\n         * Using a ratio helps keeping shape stability independently of the map size.\n         *\n         * It does not account for the light projection as it was having too much\n         * instability during the light setup or during light position changes.\n         *\n         * Only valid if useContactHardeningShadow is true.\n         */\n        set: function (contactHardeningLightSizeUVRatio) {\n            this._contactHardeningLightSizeUVRatio = contactHardeningLightSizeUVRatio;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowGenerator.prototype, \"darkness\", {\n        /** Gets or sets the actual darkness of a shadow */\n        get: function () {\n            return this._darkness;\n        },\n        set: function (value) {\n            this.setDarkness(value);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Returns the darkness value (float). This can only decrease the actual darkness of a shadow.\n     * 0 means strongest and 1 would means no shadow.\n     * @returns the darkness.\n     */\n    ShadowGenerator.prototype.getDarkness = function () {\n        return this._darkness;\n    };\n    /**\n     * Sets the darkness value (float). This can only decrease the actual darkness of a shadow.\n     * @param darkness The darkness value 0 means strongest and 1 would means no shadow.\n     * @returns the shadow generator allowing fluent coding.\n     */\n    ShadowGenerator.prototype.setDarkness = function (darkness) {\n        if (darkness >= 1.0) {\n            this._darkness = 1.0;\n        }\n        else if (darkness <= 0.0) {\n            this._darkness = 0.0;\n        }\n        else {\n            this._darkness = darkness;\n        }\n        return this;\n    };\n    Object.defineProperty(ShadowGenerator.prototype, \"transparencyShadow\", {\n        /** Gets or sets the ability to have transparent shadow  */\n        get: function () {\n            return this._transparencyShadow;\n        },\n        set: function (value) {\n            this.setTransparencyShadow(value);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Sets the ability to have transparent shadow (boolean).\n     * @param transparent True if transparent else False\n     * @returns the shadow generator allowing fluent coding\n     */\n    ShadowGenerator.prototype.setTransparencyShadow = function (transparent) {\n        this._transparencyShadow = transparent;\n        return this;\n    };\n    /**\n     * Gets the main RTT containing the shadow map (usually storing depth from the light point of view).\n     * @returns The render target texture if present otherwise, null\n     */\n    ShadowGenerator.prototype.getShadowMap = function () {\n        return this._shadowMap;\n    };\n    /**\n     * Gets the RTT used during rendering (can be a blurred version of the shadow map or the shadow map itself).\n     * @returns The render target texture if the shadow map is present otherwise, null\n     */\n    ShadowGenerator.prototype.getShadowMapForRendering = function () {\n        if (this._shadowMap2) {\n            return this._shadowMap2;\n        }\n        return this._shadowMap;\n    };\n    /**\n     * Gets the class name of that object\n     * @returns \"ShadowGenerator\"\n     */\n    ShadowGenerator.prototype.getClassName = function () {\n        return ShadowGenerator.CLASSNAME;\n    };\n    /**\n     * Helper function to add a mesh and its descendants to the list of shadow casters.\n     * @param mesh Mesh to add\n     * @param includeDescendants boolean indicating if the descendants should be added. Default to true\n     * @returns the Shadow Generator itself\n     */\n    ShadowGenerator.prototype.addShadowCaster = function (mesh, includeDescendants) {\n        if (includeDescendants === void 0) { includeDescendants = true; }\n        if (!this._shadowMap) {\n            return this;\n        }\n        if (!this._shadowMap.renderList) {\n            this._shadowMap.renderList = [];\n        }\n        if (this._shadowMap.renderList.indexOf(mesh) === -1) {\n            this._shadowMap.renderList.push(mesh);\n        }\n        if (includeDescendants) {\n            for (var _i = 0, _a = mesh.getChildMeshes(); _i < _a.length; _i++) {\n                var childMesh = _a[_i];\n                if (this._shadowMap.renderList.indexOf(childMesh) === -1) {\n                    this._shadowMap.renderList.push(childMesh);\n                }\n            }\n        }\n        return this;\n    };\n    /**\n     * Helper function to remove a mesh and its descendants from the list of shadow casters\n     * @param mesh Mesh to remove\n     * @param includeDescendants boolean indicating if the descendants should be removed. Default to true\n     * @returns the Shadow Generator itself\n     */\n    ShadowGenerator.prototype.removeShadowCaster = function (mesh, includeDescendants) {\n        if (includeDescendants === void 0) { includeDescendants = true; }\n        if (!this._shadowMap || !this._shadowMap.renderList) {\n            return this;\n        }\n        var index = this._shadowMap.renderList.indexOf(mesh);\n        if (index !== -1) {\n            this._shadowMap.renderList.splice(index, 1);\n        }\n        if (includeDescendants) {\n            for (var _i = 0, _a = mesh.getChildren(); _i < _a.length; _i++) {\n                var child = _a[_i];\n                this.removeShadowCaster(child);\n            }\n        }\n        return this;\n    };\n    /**\n     * Returns the associated light object.\n     * @returns the light generating the shadow\n     */\n    ShadowGenerator.prototype.getLight = function () {\n        return this._light;\n    };\n    Object.defineProperty(ShadowGenerator.prototype, \"mapSize\", {\n        /**\n         * Gets or sets the size of the texture what stores the shadows\n         */\n        get: function () {\n            return this._mapSize;\n        },\n        set: function (size) {\n            this._mapSize = size;\n            this._light._markMeshesAsLightDirty();\n            this.recreateShadowMap();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ShadowGenerator.prototype._initializeGenerator = function () {\n        this._light._markMeshesAsLightDirty();\n        this._initializeShadowMap();\n    };\n    ShadowGenerator.prototype._createTargetRenderTexture = function () {\n        var engine = this._scene.getEngine();\n        if (engine._features.supportDepthStencilTexture) {\n            this._shadowMap = new RenderTargetTexture(this._light.name + \"_shadowMap\", this._mapSize, this._scene, false, true, this._textureType, this._light.needCube(), undefined, false, false);\n            this._shadowMap.createDepthStencilTexture(engine.useReverseDepthBuffer ? 516 : 513, true);\n        }\n        else {\n            this._shadowMap = new RenderTargetTexture(this._light.name + \"_shadowMap\", this._mapSize, this._scene, false, true, this._textureType, this._light.needCube());\n        }\n    };\n    ShadowGenerator.prototype._initializeShadowMap = function () {\n        var _this = this;\n        this._createTargetRenderTexture();\n        if (this._shadowMap === null) {\n            return;\n        }\n        this._shadowMap.wrapU = Texture.CLAMP_ADDRESSMODE;\n        this._shadowMap.wrapV = Texture.CLAMP_ADDRESSMODE;\n        this._shadowMap.anisotropicFilteringLevel = 1;\n        this._shadowMap.updateSamplingMode(Texture.BILINEAR_SAMPLINGMODE);\n        this._shadowMap.renderParticles = false;\n        this._shadowMap.ignoreCameraViewport = true;\n        if (this._storedUniqueId) {\n            this._shadowMap.uniqueId = this._storedUniqueId;\n        }\n        // Custom render function.\n        this._shadowMap.customRenderFunction = this._renderForShadowMap.bind(this);\n        // Force the mesh is ready function to true as we are double checking it\n        // in the custom render function. Also it prevents side effects and useless\n        // shader variations in DEPTHPREPASS mode.\n        this._shadowMap.customIsReadyFunction = function () {\n            return true;\n        };\n        var engine = this._scene.getEngine();\n        this._shadowMap.onBeforeBindObservable.add(function () {\n            var _a;\n            _this._currentSceneUBO = _this._scene.getSceneUniformBuffer();\n            (_a = engine._debugPushGroup) === null || _a === void 0 ? void 0 : _a.call(engine, \"shadow map generation for pass id \".concat(engine.currentRenderPassId), 1);\n        });\n        // Record Face Index before render.\n        this._shadowMap.onBeforeRenderObservable.add(function (faceIndex) {\n            if (_this._sceneUBOs) {\n                _this._scene.setSceneUniformBuffer(_this._sceneUBOs[0]);\n            }\n            _this._currentFaceIndex = faceIndex;\n            if (_this._filter === ShadowGenerator.FILTER_PCF) {\n                engine.setColorWrite(false);\n            }\n            _this.getTransformMatrix(); // generate the view/projection matrix\n            _this._scene.setTransformMatrix(_this._viewMatrix, _this._projectionMatrix);\n            if (_this._useUBO) {\n                _this._scene.getSceneUniformBuffer().unbindEffect();\n                _this._scene.finalizeSceneUbo();\n            }\n        });\n        // Blur if required after render.\n        this._shadowMap.onAfterUnbindObservable.add(function () {\n            var _a, _b;\n            if (_this._sceneUBOs) {\n                _this._scene.setSceneUniformBuffer(_this._currentSceneUBO);\n            }\n            _this._scene.updateTransformMatrix(); // restore the view/projection matrices of the active camera\n            if (_this._filter === ShadowGenerator.FILTER_PCF) {\n                engine.setColorWrite(true);\n            }\n            if (!_this.useBlurExponentialShadowMap && !_this.useBlurCloseExponentialShadowMap) {\n                (_a = engine._debugPopGroup) === null || _a === void 0 ? void 0 : _a.call(engine, 1);\n                return;\n            }\n            var shadowMap = _this.getShadowMapForRendering();\n            if (shadowMap) {\n                _this._scene.postProcessManager.directRender(_this._blurPostProcesses, shadowMap.renderTarget, true);\n                engine.unBindFramebuffer(shadowMap.renderTarget, true);\n                (_b = engine._debugPopGroup) === null || _b === void 0 ? void 0 : _b.call(engine, 1);\n            }\n        });\n        // Clear according to the chosen filter.\n        var clearZero = new Color4(0, 0, 0, 0);\n        var clearOne = new Color4(1.0, 1.0, 1.0, 1.0);\n        this._shadowMap.onClearObservable.add(function (engine) {\n            if (_this._filter === ShadowGenerator.FILTER_PCF) {\n                engine.clear(clearOne, false, true, false);\n            }\n            else if (_this.useExponentialShadowMap || _this.useBlurExponentialShadowMap) {\n                engine.clear(clearZero, true, true, false);\n            }\n            else {\n                engine.clear(clearOne, true, true, false);\n            }\n        });\n        // Recreate on resize.\n        this._shadowMap.onResizeObservable.add(function (rtt) {\n            _this._storedUniqueId = _this._shadowMap.uniqueId;\n            _this._mapSize = rtt.getRenderSize();\n            _this._light._markMeshesAsLightDirty();\n            _this.recreateShadowMap();\n        });\n        // Ensures rendering groupids do not erase the depth buffer\n        // or we would lose the shadows information.\n        for (var i = RenderingManager.MIN_RENDERINGGROUPS; i < RenderingManager.MAX_RENDERINGGROUPS; i++) {\n            this._shadowMap.setRenderingAutoClearDepthStencil(i, false);\n        }\n    };\n    ShadowGenerator.prototype._initializeBlurRTTAndPostProcesses = function () {\n        var _this = this;\n        var engine = this._scene.getEngine();\n        var targetSize = this._mapSize / this.blurScale;\n        if (!this.useKernelBlur || this.blurScale !== 1.0) {\n            this._shadowMap2 = new RenderTargetTexture(this._light.name + \"_shadowMap2\", targetSize, this._scene, false, true, this._textureType, undefined, undefined, false);\n            this._shadowMap2.wrapU = Texture.CLAMP_ADDRESSMODE;\n            this._shadowMap2.wrapV = Texture.CLAMP_ADDRESSMODE;\n            this._shadowMap2.updateSamplingMode(Texture.BILINEAR_SAMPLINGMODE);\n        }\n        if (this.useKernelBlur) {\n            this._kernelBlurXPostprocess = new BlurPostProcess(this._light.name + \"KernelBlurX\", new Vector2(1, 0), this.blurKernel, 1.0, null, Texture.BILINEAR_SAMPLINGMODE, engine, false, this._textureType);\n            this._kernelBlurXPostprocess.width = targetSize;\n            this._kernelBlurXPostprocess.height = targetSize;\n            this._kernelBlurXPostprocess.externalTextureSamplerBinding = true;\n            this._kernelBlurXPostprocess.onApplyObservable.add(function (effect) {\n                effect.setTexture(\"textureSampler\", _this._shadowMap);\n            });\n            this._kernelBlurYPostprocess = new BlurPostProcess(this._light.name + \"KernelBlurY\", new Vector2(0, 1), this.blurKernel, 1.0, null, Texture.BILINEAR_SAMPLINGMODE, engine, false, this._textureType);\n            this._kernelBlurXPostprocess.autoClear = false;\n            this._kernelBlurYPostprocess.autoClear = false;\n            if (this._textureType === 0) {\n                this._kernelBlurXPostprocess.packedFloat = true;\n                this._kernelBlurYPostprocess.packedFloat = true;\n            }\n            this._blurPostProcesses = [this._kernelBlurXPostprocess, this._kernelBlurYPostprocess];\n        }\n        else {\n            this._boxBlurPostprocess = new PostProcess(this._light.name + \"DepthBoxBlur\", \"depthBoxBlur\", [\"screenSize\", \"boxOffset\"], [], 1.0, null, Texture.BILINEAR_SAMPLINGMODE, engine, false, \"#define OFFSET \" + this._blurBoxOffset, this._textureType);\n            this._boxBlurPostprocess.externalTextureSamplerBinding = true;\n            this._boxBlurPostprocess.onApplyObservable.add(function (effect) {\n                effect.setFloat2(\"screenSize\", targetSize, targetSize);\n                effect.setTexture(\"textureSampler\", _this._shadowMap);\n            });\n            this._boxBlurPostprocess.autoClear = false;\n            this._blurPostProcesses = [this._boxBlurPostprocess];\n        }\n    };\n    ShadowGenerator.prototype._renderForShadowMap = function (opaqueSubMeshes, alphaTestSubMeshes, transparentSubMeshes, depthOnlySubMeshes) {\n        var index;\n        if (depthOnlySubMeshes.length) {\n            for (index = 0; index < depthOnlySubMeshes.length; index++) {\n                this._renderSubMeshForShadowMap(depthOnlySubMeshes.data[index]);\n            }\n        }\n        for (index = 0; index < opaqueSubMeshes.length; index++) {\n            this._renderSubMeshForShadowMap(opaqueSubMeshes.data[index]);\n        }\n        for (index = 0; index < alphaTestSubMeshes.length; index++) {\n            this._renderSubMeshForShadowMap(alphaTestSubMeshes.data[index]);\n        }\n        if (this._transparencyShadow) {\n            for (index = 0; index < transparentSubMeshes.length; index++) {\n                this._renderSubMeshForShadowMap(transparentSubMeshes.data[index], true);\n            }\n        }\n        else {\n            for (index = 0; index < transparentSubMeshes.length; index++) {\n                transparentSubMeshes.data[index].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate = false;\n            }\n        }\n    };\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    ShadowGenerator.prototype._bindCustomEffectForRenderSubMeshForShadowMap = function (subMesh, effect, mesh) {\n        effect.setMatrix(\"viewProjection\", this.getTransformMatrix());\n    };\n    ShadowGenerator.prototype._renderSubMeshForShadowMap = function (subMesh, isTransparent) {\n        var _a, _b;\n        if (isTransparent === void 0) { isTransparent = false; }\n        var renderingMesh = subMesh.getRenderingMesh();\n        var effectiveMesh = subMesh.getEffectiveMesh();\n        var scene = this._scene;\n        var engine = scene.getEngine();\n        var material = subMesh.getMaterial();\n        effectiveMesh._internalAbstractMeshDataInfo._isActiveIntermediate = false;\n        if (!material || subMesh.verticesCount === 0 || subMesh._renderId === scene.getRenderId()) {\n            return;\n        }\n        // Culling\n        var detNeg = effectiveMesh._getWorldMatrixDeterminant() < 0;\n        var sideOrientation = (_a = renderingMesh.overrideMaterialSideOrientation) !== null && _a !== void 0 ? _a : material.sideOrientation;\n        if (detNeg) {\n            sideOrientation =\n                sideOrientation === 0 ? 1 : 0;\n        }\n        var reverseSideOrientation = sideOrientation === 0;\n        engine.setState(material.backFaceCulling, undefined, undefined, reverseSideOrientation, material.cullBackFaces);\n        // Managing instances\n        var batch = renderingMesh._getInstancesRenderList(subMesh._id, !!subMesh.getReplacementMesh());\n        if (batch.mustReturn) {\n            return;\n        }\n        var hardwareInstancedRendering = engine.getCaps().instancedArrays &&\n            ((batch.visibleInstances[subMesh._id] !== null && batch.visibleInstances[subMesh._id] !== undefined) || renderingMesh.hasThinInstances);\n        if (this.customAllowRendering && !this.customAllowRendering(subMesh)) {\n            return;\n        }\n        if (this.isReady(subMesh, hardwareInstancedRendering, isTransparent)) {\n            subMesh._renderId = scene.getRenderId();\n            var shadowDepthWrapper = material.shadowDepthWrapper;\n            var drawWrapper = (_b = shadowDepthWrapper === null || shadowDepthWrapper === void 0 ? void 0 : shadowDepthWrapper.getEffect(subMesh, this, engine.currentRenderPassId)) !== null && _b !== void 0 ? _b : subMesh._getDrawWrapper();\n            var effect_1 = DrawWrapper.GetEffect(drawWrapper);\n            engine.enableEffect(drawWrapper);\n            if (!hardwareInstancedRendering) {\n                renderingMesh._bind(subMesh, effect_1, material.fillMode);\n            }\n            this.getTransformMatrix(); // make sure _cachedDirection et _cachedPosition are up to date\n            effect_1.setFloat3(\"biasAndScaleSM\", this.bias, this.normalBias, this.depthScale);\n            if (this.getLight().getTypeID() === Light.LIGHTTYPEID_DIRECTIONALLIGHT) {\n                effect_1.setVector3(\"lightDataSM\", this._cachedDirection);\n            }\n            else {\n                effect_1.setVector3(\"lightDataSM\", this._cachedPosition);\n            }\n            if (scene.activeCamera) {\n                effect_1.setFloat2(\"depthValuesSM\", this.getLight().getDepthMinZ(scene.activeCamera), this.getLight().getDepthMinZ(scene.activeCamera) + this.getLight().getDepthMaxZ(scene.activeCamera));\n            }\n            if (isTransparent && this.enableSoftTransparentShadow) {\n                effect_1.setFloat(\"softTransparentShadowSM\", effectiveMesh.visibility * material.alpha);\n            }\n            if (shadowDepthWrapper) {\n                subMesh._setMainDrawWrapperOverride(drawWrapper);\n                if (shadowDepthWrapper.standalone) {\n                    shadowDepthWrapper.baseMaterial.bindForSubMesh(effectiveMesh.getWorldMatrix(), renderingMesh, subMesh);\n                }\n                else {\n                    material.bindForSubMesh(effectiveMesh.getWorldMatrix(), renderingMesh, subMesh);\n                }\n                subMesh._setMainDrawWrapperOverride(null);\n            }\n            else {\n                // Alpha test\n                if (material && this.useOpacityTextureForTransparentShadow) {\n                    var opacityTexture = material.opacityTexture;\n                    if (opacityTexture) {\n                        effect_1.setTexture(\"diffuseSampler\", opacityTexture);\n                        effect_1.setMatrix(\"diffuseMatrix\", opacityTexture.getTextureMatrix() || this._defaultTextureMatrix);\n                    }\n                }\n                else if (material && material.needAlphaTesting()) {\n                    var alphaTexture = material.getAlphaTestTexture();\n                    if (alphaTexture) {\n                        effect_1.setTexture(\"diffuseSampler\", alphaTexture);\n                        effect_1.setMatrix(\"diffuseMatrix\", alphaTexture.getTextureMatrix() || this._defaultTextureMatrix);\n                    }\n                }\n                // Bones\n                if (renderingMesh.useBones && renderingMesh.computeBonesUsingShaders && renderingMesh.skeleton) {\n                    var skeleton = renderingMesh.skeleton;\n                    if (skeleton.isUsingTextureForMatrices) {\n                        var boneTexture = skeleton.getTransformMatrixTexture(renderingMesh);\n                        if (!boneTexture) {\n                            return;\n                        }\n                        effect_1.setTexture(\"boneSampler\", boneTexture);\n                        effect_1.setFloat(\"boneTextureWidth\", 4.0 * (skeleton.bones.length + 1));\n                    }\n                    else {\n                        effect_1.setMatrices(\"mBones\", skeleton.getTransformMatrices(renderingMesh));\n                    }\n                }\n                // Morph targets\n                MaterialHelper.BindMorphTargetParameters(renderingMesh, effect_1);\n                if (renderingMesh.morphTargetManager && renderingMesh.morphTargetManager.isUsingTextureForTargets) {\n                    renderingMesh.morphTargetManager._bind(effect_1);\n                }\n                // Clip planes\n                MaterialHelper.BindClipPlane(effect_1, scene);\n            }\n            if (!this._useUBO && !shadowDepthWrapper) {\n                this._bindCustomEffectForRenderSubMeshForShadowMap(subMesh, effect_1, effectiveMesh);\n            }\n            MaterialHelper.BindSceneUniformBuffer(effect_1, this._scene.getSceneUniformBuffer());\n            this._scene.getSceneUniformBuffer().bindUniformBuffer();\n            var world_1 = effectiveMesh.getWorldMatrix();\n            // In the non hardware instanced mode, the Mesh ubo update is done by the callback passed to renderingMesh._processRendering (see below)\n            if (hardwareInstancedRendering) {\n                effectiveMesh.getMeshUniformBuffer().bindToEffect(effect_1, \"Mesh\");\n                effectiveMesh.transferToEffect(world_1);\n            }\n            if (this.forceBackFacesOnly) {\n                engine.setState(true, 0, false, true, material.cullBackFaces);\n            }\n            // Observables\n            this.onBeforeShadowMapRenderMeshObservable.notifyObservers(renderingMesh);\n            this.onBeforeShadowMapRenderObservable.notifyObservers(effect_1);\n            // Draw\n            renderingMesh._processRendering(effectiveMesh, subMesh, effect_1, material.fillMode, batch, hardwareInstancedRendering, function (isInstance, worldOverride) {\n                if (effectiveMesh !== renderingMesh && !isInstance) {\n                    renderingMesh.getMeshUniformBuffer().bindToEffect(effect_1, \"Mesh\");\n                    renderingMesh.transferToEffect(worldOverride);\n                }\n                else {\n                    effectiveMesh.getMeshUniformBuffer().bindToEffect(effect_1, \"Mesh\");\n                    effectiveMesh.transferToEffect(isInstance ? worldOverride : world_1);\n                }\n            });\n            if (this.forceBackFacesOnly) {\n                engine.setState(true, 0, false, false, material.cullBackFaces);\n            }\n            // Observables\n            this.onAfterShadowMapRenderObservable.notifyObservers(effect_1);\n            this.onAfterShadowMapRenderMeshObservable.notifyObservers(renderingMesh);\n        }\n        else {\n            // Need to reset refresh rate of the shadowMap\n            if (this._shadowMap) {\n                this._shadowMap.resetRefreshCounter();\n            }\n        }\n    };\n    ShadowGenerator.prototype._applyFilterValues = function () {\n        if (!this._shadowMap) {\n            return;\n        }\n        if (this.filter === ShadowGenerator.FILTER_NONE || this.filter === ShadowGenerator.FILTER_PCSS) {\n            this._shadowMap.updateSamplingMode(Texture.NEAREST_SAMPLINGMODE);\n        }\n        else {\n            this._shadowMap.updateSamplingMode(Texture.BILINEAR_SAMPLINGMODE);\n        }\n    };\n    /**\n     * Forces all the attached effect to compile to enable rendering only once ready vs. lazily compiling effects.\n     * @param onCompiled Callback triggered at the and of the effects compilation\n     * @param options Sets of optional options forcing the compilation with different modes\n     */\n    ShadowGenerator.prototype.forceCompilation = function (onCompiled, options) {\n        var _this = this;\n        var localOptions = __assign({ useInstances: false }, options);\n        var shadowMap = this.getShadowMap();\n        if (!shadowMap) {\n            if (onCompiled) {\n                onCompiled(this);\n            }\n            return;\n        }\n        var renderList = shadowMap.renderList;\n        if (!renderList) {\n            if (onCompiled) {\n                onCompiled(this);\n            }\n            return;\n        }\n        var subMeshes = new Array();\n        for (var _i = 0, renderList_1 = renderList; _i < renderList_1.length; _i++) {\n            var mesh = renderList_1[_i];\n            subMeshes.push.apply(subMeshes, mesh.subMeshes);\n        }\n        if (subMeshes.length === 0) {\n            if (onCompiled) {\n                onCompiled(this);\n            }\n            return;\n        }\n        var currentIndex = 0;\n        var checkReady = function () {\n            var _a, _b;\n            if (!_this._scene || !_this._scene.getEngine()) {\n                return;\n            }\n            while (_this.isReady(subMeshes[currentIndex], localOptions.useInstances, (_b = (_a = subMeshes[currentIndex].getMaterial()) === null || _a === void 0 ? void 0 : _a.needAlphaBlendingForMesh(subMeshes[currentIndex].getMesh())) !== null && _b !== void 0 ? _b : false)) {\n                currentIndex++;\n                if (currentIndex >= subMeshes.length) {\n                    if (onCompiled) {\n                        onCompiled(_this);\n                    }\n                    return;\n                }\n            }\n            setTimeout(checkReady, 16);\n        };\n        checkReady();\n    };\n    /**\n     * Forces all the attached effect to compile to enable rendering only once ready vs. lazily compiling effects.\n     * @param options Sets of optional options forcing the compilation with different modes\n     * @returns A promise that resolves when the compilation completes\n     */\n    ShadowGenerator.prototype.forceCompilationAsync = function (options) {\n        var _this = this;\n        return new Promise(function (resolve) {\n            _this.forceCompilation(function () {\n                resolve();\n            }, options);\n        });\n    };\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    ShadowGenerator.prototype._isReadyCustomDefines = function (defines, subMesh, useInstances) { };\n    ShadowGenerator.prototype._prepareShadowDefines = function (subMesh, useInstances, defines, isTransparent) {\n        defines.push(\"#define SM_FLOAT \" + (this._textureType !== 0 ? \"1\" : \"0\"));\n        defines.push(\"#define SM_ESM \" + (this.useExponentialShadowMap || this.useBlurExponentialShadowMap ? \"1\" : \"0\"));\n        defines.push(\"#define SM_DEPTHTEXTURE \" + (this.usePercentageCloserFiltering || this.useContactHardeningShadow ? \"1\" : \"0\"));\n        var mesh = subMesh.getMesh();\n        // Normal bias.\n        defines.push(\"#define SM_NORMALBIAS \" + (this.normalBias && mesh.isVerticesDataPresent(VertexBuffer.NormalKind) ? \"1\" : \"0\"));\n        defines.push(\"#define SM_DIRECTIONINLIGHTDATA \" + (this.getLight().getTypeID() === Light.LIGHTTYPEID_DIRECTIONALLIGHT ? \"1\" : \"0\"));\n        // Point light\n        defines.push(\"#define SM_USEDISTANCE \" + (this._light.needCube() ? \"1\" : \"0\"));\n        // Soft transparent shadows\n        defines.push(\"#define SM_SOFTTRANSPARENTSHADOW \" + (this.enableSoftTransparentShadow && isTransparent ? \"1\" : \"0\"));\n        this._isReadyCustomDefines(defines, subMesh, useInstances);\n        return defines;\n    };\n    /**\n     * Determine whether the shadow generator is ready or not (mainly all effects and related post processes needs to be ready).\n     * @param subMesh The submesh we want to render in the shadow map\n     * @param useInstances Defines whether will draw in the map using instances\n     * @param isTransparent Indicates that isReady is called for a transparent subMesh\n     * @returns true if ready otherwise, false\n     */\n    ShadowGenerator.prototype.isReady = function (subMesh, useInstances, isTransparent) {\n        var _a;\n        var material = subMesh.getMaterial(), shadowDepthWrapper = material === null || material === void 0 ? void 0 : material.shadowDepthWrapper;\n        var defines = [];\n        this._prepareShadowDefines(subMesh, useInstances, defines, isTransparent);\n        if (shadowDepthWrapper) {\n            if (!shadowDepthWrapper.isReadyForSubMesh(subMesh, defines, this, useInstances, this._scene.getEngine().currentRenderPassId)) {\n                return false;\n            }\n        }\n        else {\n            var subMeshEffect = subMesh._getDrawWrapper(undefined, true);\n            var effect = subMeshEffect.effect;\n            var cachedDefines = subMeshEffect.defines;\n            var attribs = [VertexBuffer.PositionKind];\n            var mesh = subMesh.getMesh();\n            // Normal bias.\n            if (this.normalBias && mesh.isVerticesDataPresent(VertexBuffer.NormalKind)) {\n                attribs.push(VertexBuffer.NormalKind);\n                defines.push(\"#define NORMAL\");\n                if (mesh.nonUniformScaling) {\n                    defines.push(\"#define NONUNIFORMSCALING\");\n                }\n            }\n            // Alpha test\n            if (material && material.needAlphaTesting()) {\n                var alphaTexture = null;\n                if (this.useOpacityTextureForTransparentShadow) {\n                    alphaTexture = material.opacityTexture;\n                }\n                else {\n                    alphaTexture = material.getAlphaTestTexture();\n                }\n                if (alphaTexture) {\n                    if (!alphaTexture.isReady()) {\n                        return false;\n                    }\n                    var alphaCutOff = (_a = material.alphaCutOff) !== null && _a !== void 0 ? _a : ShadowGenerator.DEFAULT_ALPHA_CUTOFF;\n                    defines.push(\"#define ALPHATEST\");\n                    defines.push(\"#define ALPHATESTVALUE \".concat(alphaCutOff).concat(alphaCutOff % 1 === 0 ? \".\" : \"\"));\n                    if (mesh.isVerticesDataPresent(VertexBuffer.UVKind)) {\n                        attribs.push(VertexBuffer.UVKind);\n                        defines.push(\"#define UV1\");\n                    }\n                    if (mesh.isVerticesDataPresent(VertexBuffer.UV2Kind)) {\n                        if (alphaTexture.coordinatesIndex === 1) {\n                            attribs.push(VertexBuffer.UV2Kind);\n                            defines.push(\"#define UV2\");\n                        }\n                    }\n                }\n            }\n            // Bones\n            var fallbacks = new EffectFallbacks();\n            if (mesh.useBones && mesh.computeBonesUsingShaders && mesh.skeleton) {\n                attribs.push(VertexBuffer.MatricesIndicesKind);\n                attribs.push(VertexBuffer.MatricesWeightsKind);\n                if (mesh.numBoneInfluencers > 4) {\n                    attribs.push(VertexBuffer.MatricesIndicesExtraKind);\n                    attribs.push(VertexBuffer.MatricesWeightsExtraKind);\n                }\n                var skeleton = mesh.skeleton;\n                defines.push(\"#define NUM_BONE_INFLUENCERS \" + mesh.numBoneInfluencers);\n                if (mesh.numBoneInfluencers > 0) {\n                    fallbacks.addCPUSkinningFallback(0, mesh);\n                }\n                if (skeleton.isUsingTextureForMatrices) {\n                    defines.push(\"#define BONETEXTURE\");\n                }\n                else {\n                    defines.push(\"#define BonesPerMesh \" + (skeleton.bones.length + 1));\n                }\n            }\n            else {\n                defines.push(\"#define NUM_BONE_INFLUENCERS 0\");\n            }\n            // Morph targets\n            var manager = mesh.morphTargetManager;\n            var morphInfluencers = 0;\n            if (manager) {\n                if (manager.numInfluencers > 0) {\n                    defines.push(\"#define MORPHTARGETS\");\n                    morphInfluencers = manager.numInfluencers;\n                    defines.push(\"#define NUM_MORPH_INFLUENCERS \" + morphInfluencers);\n                    if (manager.isUsingTextureForTargets) {\n                        defines.push(\"#define MORPHTARGETS_TEXTURE\");\n                    }\n                    MaterialHelper.PrepareAttributesForMorphTargetsInfluencers(attribs, mesh, morphInfluencers);\n                }\n            }\n            // ClipPlanes\n            var scene = this._scene;\n            if (scene.clipPlane) {\n                defines.push(\"#define CLIPPLANE\");\n            }\n            if (scene.clipPlane2) {\n                defines.push(\"#define CLIPPLANE2\");\n            }\n            if (scene.clipPlane3) {\n                defines.push(\"#define CLIPPLANE3\");\n            }\n            if (scene.clipPlane4) {\n                defines.push(\"#define CLIPPLANE4\");\n            }\n            if (scene.clipPlane5) {\n                defines.push(\"#define CLIPPLANE5\");\n            }\n            if (scene.clipPlane6) {\n                defines.push(\"#define CLIPPLANE6\");\n            }\n            // Instances\n            if (useInstances) {\n                defines.push(\"#define INSTANCES\");\n                MaterialHelper.PushAttributesForInstances(attribs);\n                if (subMesh.getRenderingMesh().hasThinInstances) {\n                    defines.push(\"#define THIN_INSTANCES\");\n                }\n            }\n            if (this.customShaderOptions) {\n                if (this.customShaderOptions.defines) {\n                    for (var _i = 0, _b = this.customShaderOptions.defines; _i < _b.length; _i++) {\n                        var define = _b[_i];\n                        if (defines.indexOf(define) === -1) {\n                            defines.push(define);\n                        }\n                    }\n                }\n            }\n            // Get correct effect\n            var join = defines.join(\"\\n\");\n            if (cachedDefines !== join) {\n                cachedDefines = join;\n                var shaderName = \"shadowMap\";\n                var uniforms = [\n                    \"world\",\n                    \"mBones\",\n                    \"viewProjection\",\n                    \"diffuseMatrix\",\n                    \"lightDataSM\",\n                    \"depthValuesSM\",\n                    \"biasAndScaleSM\",\n                    \"morphTargetInfluences\",\n                    \"boneTextureWidth\",\n                    \"vClipPlane\",\n                    \"vClipPlane2\",\n                    \"vClipPlane3\",\n                    \"vClipPlane4\",\n                    \"vClipPlane5\",\n                    \"vClipPlane6\",\n                    \"softTransparentShadowSM\",\n                    \"morphTargetTextureInfo\",\n                    \"morphTargetTextureIndices\",\n                ];\n                var samplers = [\"diffuseSampler\", \"boneSampler\", \"morphTargets\"];\n                var uniformBuffers = [\"Scene\", \"Mesh\"];\n                // Custom shader?\n                if (this.customShaderOptions) {\n                    shaderName = this.customShaderOptions.shaderName;\n                    if (this.customShaderOptions.attributes) {\n                        for (var _c = 0, _d = this.customShaderOptions.attributes; _c < _d.length; _c++) {\n                            var attrib = _d[_c];\n                            if (attribs.indexOf(attrib) === -1) {\n                                attribs.push(attrib);\n                            }\n                        }\n                    }\n                    if (this.customShaderOptions.uniforms) {\n                        for (var _e = 0, _f = this.customShaderOptions.uniforms; _e < _f.length; _e++) {\n                            var uniform = _f[_e];\n                            if (uniforms.indexOf(uniform) === -1) {\n                                uniforms.push(uniform);\n                            }\n                        }\n                    }\n                    if (this.customShaderOptions.samplers) {\n                        for (var _g = 0, _h = this.customShaderOptions.samplers; _g < _h.length; _g++) {\n                            var sampler = _h[_g];\n                            if (samplers.indexOf(sampler) === -1) {\n                                samplers.push(sampler);\n                            }\n                        }\n                    }\n                }\n                var engine = this._scene.getEngine();\n                effect = engine.createEffect(shaderName, {\n                    attributes: attribs,\n                    uniformsNames: uniforms,\n                    uniformBuffersNames: uniformBuffers,\n                    samplers: samplers,\n                    defines: join,\n                    fallbacks: fallbacks,\n                    onCompiled: null,\n                    onError: null,\n                    indexParameters: { maxSimultaneousMorphTargets: morphInfluencers },\n                }, engine);\n                subMeshEffect.setEffect(effect, cachedDefines);\n            }\n            if (!effect.isReady()) {\n                return false;\n            }\n        }\n        if (this.useBlurExponentialShadowMap || this.useBlurCloseExponentialShadowMap) {\n            if (!this._blurPostProcesses || !this._blurPostProcesses.length) {\n                this._initializeBlurRTTAndPostProcesses();\n            }\n        }\n        if (this._kernelBlurXPostprocess && !this._kernelBlurXPostprocess.isReady()) {\n            return false;\n        }\n        if (this._kernelBlurYPostprocess && !this._kernelBlurYPostprocess.isReady()) {\n            return false;\n        }\n        if (this._boxBlurPostprocess && !this._boxBlurPostprocess.isReady()) {\n            return false;\n        }\n        return true;\n    };\n    /**\n     * Prepare all the defines in a material relying on a shadow map at the specified light index.\n     * @param defines Defines of the material we want to update\n     * @param lightIndex Index of the light in the enabled light list of the material\n     */\n    ShadowGenerator.prototype.prepareDefines = function (defines, lightIndex) {\n        var scene = this._scene;\n        var light = this._light;\n        if (!scene.shadowsEnabled || !light.shadowEnabled) {\n            return;\n        }\n        defines[\"SHADOW\" + lightIndex] = true;\n        if (this.useContactHardeningShadow) {\n            defines[\"SHADOWPCSS\" + lightIndex] = true;\n            if (this._filteringQuality === ShadowGenerator.QUALITY_LOW) {\n                defines[\"SHADOWLOWQUALITY\" + lightIndex] = true;\n            }\n            else if (this._filteringQuality === ShadowGenerator.QUALITY_MEDIUM) {\n                defines[\"SHADOWMEDIUMQUALITY\" + lightIndex] = true;\n            }\n            // else default to high.\n        }\n        else if (this.usePercentageCloserFiltering) {\n            defines[\"SHADOWPCF\" + lightIndex] = true;\n            if (this._filteringQuality === ShadowGenerator.QUALITY_LOW) {\n                defines[\"SHADOWLOWQUALITY\" + lightIndex] = true;\n            }\n            else if (this._filteringQuality === ShadowGenerator.QUALITY_MEDIUM) {\n                defines[\"SHADOWMEDIUMQUALITY\" + lightIndex] = true;\n            }\n            // else default to high.\n        }\n        else if (this.usePoissonSampling) {\n            defines[\"SHADOWPOISSON\" + lightIndex] = true;\n        }\n        else if (this.useExponentialShadowMap || this.useBlurExponentialShadowMap) {\n            defines[\"SHADOWESM\" + lightIndex] = true;\n        }\n        else if (this.useCloseExponentialShadowMap || this.useBlurCloseExponentialShadowMap) {\n            defines[\"SHADOWCLOSEESM\" + lightIndex] = true;\n        }\n        if (light.needCube()) {\n            defines[\"SHADOWCUBE\" + lightIndex] = true;\n        }\n    };\n    /**\n     * Binds the shadow related information inside of an effect (information like near, far, darkness...\n     * defined in the generator but impacting the effect).\n     * @param lightIndex Index of the light in the enabled light list of the material owning the effect\n     * @param effect The effect we are binding the information for\n     */\n    ShadowGenerator.prototype.bindShadowLight = function (lightIndex, effect) {\n        var light = this._light;\n        var scene = this._scene;\n        if (!scene.shadowsEnabled || !light.shadowEnabled) {\n            return;\n        }\n        var camera = scene.activeCamera;\n        if (!camera) {\n            return;\n        }\n        var shadowMap = this.getShadowMap();\n        if (!shadowMap) {\n            return;\n        }\n        if (!light.needCube()) {\n            effect.setMatrix(\"lightMatrix\" + lightIndex, this.getTransformMatrix());\n        }\n        // Only PCF uses depth stencil texture.\n        if (this._filter === ShadowGenerator.FILTER_PCF) {\n            effect.setDepthStencilTexture(\"shadowSampler\" + lightIndex, this.getShadowMapForRendering());\n            light._uniformBuffer.updateFloat4(\"shadowsInfo\", this.getDarkness(), shadowMap.getSize().width, 1 / shadowMap.getSize().width, this.frustumEdgeFalloff, lightIndex);\n        }\n        else if (this._filter === ShadowGenerator.FILTER_PCSS) {\n            effect.setDepthStencilTexture(\"shadowSampler\" + lightIndex, this.getShadowMapForRendering());\n            effect.setTexture(\"depthSampler\" + lightIndex, this.getShadowMapForRendering());\n            light._uniformBuffer.updateFloat4(\"shadowsInfo\", this.getDarkness(), 1 / shadowMap.getSize().width, this._contactHardeningLightSizeUVRatio * shadowMap.getSize().width, this.frustumEdgeFalloff, lightIndex);\n        }\n        else {\n            effect.setTexture(\"shadowSampler\" + lightIndex, this.getShadowMapForRendering());\n            light._uniformBuffer.updateFloat4(\"shadowsInfo\", this.getDarkness(), this.blurScale / shadowMap.getSize().width, this.depthScale, this.frustumEdgeFalloff, lightIndex);\n        }\n        light._uniformBuffer.updateFloat2(\"depthValues\", this.getLight().getDepthMinZ(camera), this.getLight().getDepthMinZ(camera) + this.getLight().getDepthMaxZ(camera), lightIndex);\n    };\n    /**\n     * Gets the transformation matrix used to project the meshes into the map from the light point of view.\n     * (eq to shadow projection matrix * light transform matrix)\n     * @returns The transform matrix used to create the shadow map\n     */\n    ShadowGenerator.prototype.getTransformMatrix = function () {\n        var scene = this._scene;\n        if (this._currentRenderId === scene.getRenderId() && this._currentFaceIndexCache === this._currentFaceIndex) {\n            return this._transformMatrix;\n        }\n        this._currentRenderId = scene.getRenderId();\n        this._currentFaceIndexCache = this._currentFaceIndex;\n        var lightPosition = this._light.position;\n        if (this._light.computeTransformedInformation()) {\n            lightPosition = this._light.transformedPosition;\n        }\n        Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex), this._lightDirection);\n        if (Math.abs(Vector3.Dot(this._lightDirection, Vector3.Up())) === 1.0) {\n            this._lightDirection.z = 0.0000000000001; // Required to avoid perfectly perpendicular light\n        }\n        if (this._light.needProjectionMatrixCompute() ||\n            !this._cachedPosition ||\n            !this._cachedDirection ||\n            !lightPosition.equals(this._cachedPosition) ||\n            !this._lightDirection.equals(this._cachedDirection)) {\n            this._cachedPosition.copyFrom(lightPosition);\n            this._cachedDirection.copyFrom(this._lightDirection);\n            Matrix.LookAtLHToRef(lightPosition, lightPosition.add(this._lightDirection), Vector3.Up(), this._viewMatrix);\n            var shadowMap = this.getShadowMap();\n            if (shadowMap) {\n                var renderList = shadowMap.renderList;\n                if (renderList) {\n                    this._light.setShadowProjectionMatrix(this._projectionMatrix, this._viewMatrix, renderList);\n                }\n            }\n            this._viewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix);\n        }\n        return this._transformMatrix;\n    };\n    /**\n     * Recreates the shadow map dependencies like RTT and post processes. This can be used during the switch between\n     * Cube and 2D textures for instance.\n     */\n    ShadowGenerator.prototype.recreateShadowMap = function () {\n        var shadowMap = this._shadowMap;\n        if (!shadowMap) {\n            return;\n        }\n        // Track render list.\n        var renderList = shadowMap.renderList;\n        // Clean up existing data.\n        this._disposeRTTandPostProcesses();\n        // Reinitializes.\n        this._initializeGenerator();\n        // Reaffect the filter to ensure a correct fallback if necessary.\n        this.filter = this._filter;\n        // Reaffect the filter.\n        this._applyFilterValues();\n        // Reaffect Render List.\n        if (renderList) {\n            // Note: don't do this._shadowMap!.renderList = renderList;\n            // The renderList hooked array is accessing the old RenderTargetTexture (see RenderTargetTexture._hookArray), which is disposed at this point (by the call to _disposeRTTandPostProcesses)\n            if (!this._shadowMap.renderList) {\n                this._shadowMap.renderList = [];\n            }\n            for (var _i = 0, renderList_2 = renderList; _i < renderList_2.length; _i++) {\n                var mesh = renderList_2[_i];\n                this._shadowMap.renderList.push(mesh);\n            }\n        }\n        else {\n            this._shadowMap.renderList = null;\n        }\n    };\n    ShadowGenerator.prototype._disposeBlurPostProcesses = function () {\n        if (this._shadowMap2) {\n            this._shadowMap2.dispose();\n            this._shadowMap2 = null;\n        }\n        if (this._boxBlurPostprocess) {\n            this._boxBlurPostprocess.dispose();\n            this._boxBlurPostprocess = null;\n        }\n        if (this._kernelBlurXPostprocess) {\n            this._kernelBlurXPostprocess.dispose();\n            this._kernelBlurXPostprocess = null;\n        }\n        if (this._kernelBlurYPostprocess) {\n            this._kernelBlurYPostprocess.dispose();\n            this._kernelBlurYPostprocess = null;\n        }\n        this._blurPostProcesses = [];\n    };\n    ShadowGenerator.prototype._disposeRTTandPostProcesses = function () {\n        if (this._shadowMap) {\n            this._shadowMap.dispose();\n            this._shadowMap = null;\n        }\n        this._disposeBlurPostProcesses();\n    };\n    ShadowGenerator.prototype._disposeSceneUBOs = function () {\n        if (this._sceneUBOs) {\n            for (var _i = 0, _a = this._sceneUBOs; _i < _a.length; _i++) {\n                var ubo = _a[_i];\n                ubo.dispose();\n            }\n            this._sceneUBOs = [];\n        }\n    };\n    /**\n     * Disposes the ShadowGenerator.\n     * Returns nothing.\n     */\n    ShadowGenerator.prototype.dispose = function () {\n        this._disposeRTTandPostProcesses();\n        this._disposeSceneUBOs();\n        if (this._light) {\n            this._light._shadowGenerator = null;\n            this._light._markMeshesAsLightDirty();\n        }\n        this.onBeforeShadowMapRenderMeshObservable.clear();\n        this.onBeforeShadowMapRenderObservable.clear();\n        this.onAfterShadowMapRenderMeshObservable.clear();\n        this.onAfterShadowMapRenderObservable.clear();\n    };\n    /**\n     * Serializes the shadow generator setup to a json object.\n     * @returns The serialized JSON object\n     */\n    ShadowGenerator.prototype.serialize = function () {\n        var serializationObject = {};\n        var shadowMap = this.getShadowMap();\n        if (!shadowMap) {\n            return serializationObject;\n        }\n        serializationObject.className = this.getClassName();\n        serializationObject.lightId = this._light.id;\n        serializationObject.id = this.id;\n        serializationObject.mapSize = shadowMap.getRenderSize();\n        serializationObject.forceBackFacesOnly = this.forceBackFacesOnly;\n        serializationObject.darkness = this.getDarkness();\n        serializationObject.transparencyShadow = this._transparencyShadow;\n        serializationObject.frustumEdgeFalloff = this.frustumEdgeFalloff;\n        serializationObject.bias = this.bias;\n        serializationObject.normalBias = this.normalBias;\n        serializationObject.usePercentageCloserFiltering = this.usePercentageCloserFiltering;\n        serializationObject.useContactHardeningShadow = this.useContactHardeningShadow;\n        serializationObject.contactHardeningLightSizeUVRatio = this.contactHardeningLightSizeUVRatio;\n        serializationObject.filteringQuality = this.filteringQuality;\n        serializationObject.useExponentialShadowMap = this.useExponentialShadowMap;\n        serializationObject.useBlurExponentialShadowMap = this.useBlurExponentialShadowMap;\n        serializationObject.useCloseExponentialShadowMap = this.useBlurExponentialShadowMap;\n        serializationObject.useBlurCloseExponentialShadowMap = this.useBlurExponentialShadowMap;\n        serializationObject.usePoissonSampling = this.usePoissonSampling;\n        serializationObject.depthScale = this.depthScale;\n        serializationObject.blurBoxOffset = this.blurBoxOffset;\n        serializationObject.blurKernel = this.blurKernel;\n        serializationObject.blurScale = this.blurScale;\n        serializationObject.useKernelBlur = this.useKernelBlur;\n        serializationObject.renderList = [];\n        if (shadowMap.renderList) {\n            for (var meshIndex = 0; meshIndex < shadowMap.renderList.length; meshIndex++) {\n                var mesh = shadowMap.renderList[meshIndex];\n                serializationObject.renderList.push(mesh.id);\n            }\n        }\n        return serializationObject;\n    };\n    /**\n     * Parses a serialized ShadowGenerator and returns a new ShadowGenerator.\n     * @param parsedShadowGenerator The JSON object to parse\n     * @param scene The scene to create the shadow map for\n     * @param constr A function that builds a shadow generator or undefined to create an instance of the default shadow generator\n     * @returns The parsed shadow generator\n     */\n    ShadowGenerator.Parse = function (parsedShadowGenerator, scene, constr) {\n        var light = scene.getLightById(parsedShadowGenerator.lightId);\n        var shadowGenerator = constr ? constr(parsedShadowGenerator.mapSize, light) : new ShadowGenerator(parsedShadowGenerator.mapSize, light);\n        var shadowMap = shadowGenerator.getShadowMap();\n        for (var meshIndex = 0; meshIndex < parsedShadowGenerator.renderList.length; meshIndex++) {\n            var meshes = scene.getMeshesById(parsedShadowGenerator.renderList[meshIndex]);\n            meshes.forEach(function (mesh) {\n                if (!shadowMap) {\n                    return;\n                }\n                if (!shadowMap.renderList) {\n                    shadowMap.renderList = [];\n                }\n                shadowMap.renderList.push(mesh);\n            });\n        }\n        if (parsedShadowGenerator.id !== undefined) {\n            shadowGenerator.id = parsedShadowGenerator.id;\n        }\n        shadowGenerator.forceBackFacesOnly = !!parsedShadowGenerator.forceBackFacesOnly;\n        if (parsedShadowGenerator.darkness !== undefined) {\n            shadowGenerator.setDarkness(parsedShadowGenerator.darkness);\n        }\n        if (parsedShadowGenerator.transparencyShadow) {\n            shadowGenerator.setTransparencyShadow(true);\n        }\n        if (parsedShadowGenerator.frustumEdgeFalloff !== undefined) {\n            shadowGenerator.frustumEdgeFalloff = parsedShadowGenerator.frustumEdgeFalloff;\n        }\n        if (parsedShadowGenerator.bias !== undefined) {\n            shadowGenerator.bias = parsedShadowGenerator.bias;\n        }\n        if (parsedShadowGenerator.normalBias !== undefined) {\n            shadowGenerator.normalBias = parsedShadowGenerator.normalBias;\n        }\n        if (parsedShadowGenerator.usePercentageCloserFiltering) {\n            shadowGenerator.usePercentageCloserFiltering = true;\n        }\n        else if (parsedShadowGenerator.useContactHardeningShadow) {\n            shadowGenerator.useContactHardeningShadow = true;\n        }\n        else if (parsedShadowGenerator.usePoissonSampling) {\n            shadowGenerator.usePoissonSampling = true;\n        }\n        else if (parsedShadowGenerator.useExponentialShadowMap) {\n            shadowGenerator.useExponentialShadowMap = true;\n        }\n        else if (parsedShadowGenerator.useBlurExponentialShadowMap) {\n            shadowGenerator.useBlurExponentialShadowMap = true;\n        }\n        else if (parsedShadowGenerator.useCloseExponentialShadowMap) {\n            shadowGenerator.useCloseExponentialShadowMap = true;\n        }\n        else if (parsedShadowGenerator.useBlurCloseExponentialShadowMap) {\n            shadowGenerator.useBlurCloseExponentialShadowMap = true;\n        }\n        // Backward compat\n        else if (parsedShadowGenerator.useVarianceShadowMap) {\n            shadowGenerator.useExponentialShadowMap = true;\n        }\n        else if (parsedShadowGenerator.useBlurVarianceShadowMap) {\n            shadowGenerator.useBlurExponentialShadowMap = true;\n        }\n        if (parsedShadowGenerator.contactHardeningLightSizeUVRatio !== undefined) {\n            shadowGenerator.contactHardeningLightSizeUVRatio = parsedShadowGenerator.contactHardeningLightSizeUVRatio;\n        }\n        if (parsedShadowGenerator.filteringQuality !== undefined) {\n            shadowGenerator.filteringQuality = parsedShadowGenerator.filteringQuality;\n        }\n        if (parsedShadowGenerator.depthScale) {\n            shadowGenerator.depthScale = parsedShadowGenerator.depthScale;\n        }\n        if (parsedShadowGenerator.blurScale) {\n            shadowGenerator.blurScale = parsedShadowGenerator.blurScale;\n        }\n        if (parsedShadowGenerator.blurBoxOffset) {\n            shadowGenerator.blurBoxOffset = parsedShadowGenerator.blurBoxOffset;\n        }\n        if (parsedShadowGenerator.useKernelBlur) {\n            shadowGenerator.useKernelBlur = parsedShadowGenerator.useKernelBlur;\n        }\n        if (parsedShadowGenerator.blurKernel) {\n            shadowGenerator.blurKernel = parsedShadowGenerator.blurKernel;\n        }\n        return shadowGenerator;\n    };\n    /**\n     * Name of the shadow generator class\n     */\n    ShadowGenerator.CLASSNAME = \"ShadowGenerator\";\n    /**\n     * Shadow generator mode None: no filtering applied.\n     */\n    ShadowGenerator.FILTER_NONE = 0;\n    /**\n     * Shadow generator mode ESM: Exponential Shadow Mapping.\n     * (http://developer.download.nvidia.com/presentations/2008/GDC/GDC08_SoftShadowMapping.pdf)\n     */\n    ShadowGenerator.FILTER_EXPONENTIALSHADOWMAP = 1;\n    /**\n     * Shadow generator mode Poisson Sampling: Percentage Closer Filtering.\n     * (Multiple Tap around evenly distributed around the pixel are used to evaluate the shadow strength)\n     */\n    ShadowGenerator.FILTER_POISSONSAMPLING = 2;\n    /**\n     * Shadow generator mode ESM: Blurred Exponential Shadow Mapping.\n     * (http://developer.download.nvidia.com/presentations/2008/GDC/GDC08_SoftShadowMapping.pdf)\n     */\n    ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP = 3;\n    /**\n     * Shadow generator mode ESM: Exponential Shadow Mapping using the inverse of the exponential preventing\n     * edge artifacts on steep falloff.\n     * (http://developer.download.nvidia.com/presentations/2008/GDC/GDC08_SoftShadowMapping.pdf)\n     */\n    ShadowGenerator.FILTER_CLOSEEXPONENTIALSHADOWMAP = 4;\n    /**\n     * Shadow generator mode ESM: Blurred Exponential Shadow Mapping using the inverse of the exponential preventing\n     * edge artifacts on steep falloff.\n     * (http://developer.download.nvidia.com/presentations/2008/GDC/GDC08_SoftShadowMapping.pdf)\n     */\n    ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP = 5;\n    /**\n     * Shadow generator mode PCF: Percentage Closer Filtering\n     * benefits from Webgl 2 shadow samplers. Fallback to Poisson Sampling in Webgl 1\n     * (https://developer.nvidia.com/gpugems/GPUGems/gpugems_ch11.html)\n     */\n    ShadowGenerator.FILTER_PCF = 6;\n    /**\n     * Shadow generator mode PCSS: Percentage Closering Soft Shadow.\n     * benefits from Webgl 2 shadow samplers. Fallback to Poisson Sampling in Webgl 1\n     * Contact Hardening\n     */\n    ShadowGenerator.FILTER_PCSS = 7;\n    /**\n     * Reserved for PCF and PCSS\n     * Highest Quality.\n     *\n     * Execute PCF on a 5*5 kernel improving a lot the shadow aliasing artifacts.\n     *\n     * Execute PCSS with 32 taps blocker search and 64 taps PCF.\n     */\n    ShadowGenerator.QUALITY_HIGH = 0;\n    /**\n     * Reserved for PCF and PCSS\n     * Good tradeoff for quality/perf cross devices\n     *\n     * Execute PCF on a 3*3 kernel.\n     *\n     * Execute PCSS with 16 taps blocker search and 32 taps PCF.\n     */\n    ShadowGenerator.QUALITY_MEDIUM = 1;\n    /**\n     * Reserved for PCF and PCSS\n     * The lowest quality but the fastest.\n     *\n     * Execute PCF on a 1*1 kernel.\n     *\n     * Execute PCSS with 16 taps blocker search and 16 taps PCF.\n     */\n    ShadowGenerator.QUALITY_LOW = 2;\n    /**\n     * Defines the default alpha cutoff value used for transparent alpha tested materials.\n     */\n    ShadowGenerator.DEFAULT_ALPHA_CUTOFF = 0.5;\n    /**\n     * @param _\n     * @hidden\n     */\n    ShadowGenerator._SceneComponentInitialization = function (_) {\n        throw _WarnImport(\"ShadowGeneratorSceneComponent\");\n    };\n    return ShadowGenerator;\n}());\nexport { ShadowGenerator };\n//# sourceMappingURL=shadowGenerator.js.map","import { __decorate, __extends } from \"tslib\";\nimport { serialize } from \"../Misc/decorators.js\";\nimport { Matrix, Vector3 } from \"../Maths/math.vector.js\";\nimport { Node } from \"../node.js\";\nimport { Light } from \"./light.js\";\nimport { ShadowLight } from \"./shadowLight.js\";\nNode.AddNodeConstructor(\"Light_Type_1\", function (name, scene) {\n    return function () { return new DirectionalLight(name, Vector3.Zero(), scene); };\n});\n/**\n * A directional light is defined by a direction (what a surprise!).\n * The light is emitted from everywhere in the specified direction, and has an infinite range.\n * An example of a directional light is when a distance planet is lit by the apparently parallel lines of light from its sun. Light in a downward direction will light the top of an object.\n * Documentation: https://doc.babylonjs.com/babylon101/lights\n */\nvar DirectionalLight = /** @class */ (function (_super) {\n    __extends(DirectionalLight, _super);\n    /**\n     * Creates a DirectionalLight object in the scene, oriented towards the passed direction (Vector3).\n     * The directional light is emitted from everywhere in the given direction.\n     * It can cast shadows.\n     * Documentation : https://doc.babylonjs.com/babylon101/lights\n     * @param name The friendly name of the light\n     * @param direction The direction of the light\n     * @param scene The scene the light belongs to\n     */\n    function DirectionalLight(name, direction, scene) {\n        var _this = _super.call(this, name, scene) || this;\n        _this._shadowFrustumSize = 0;\n        _this._shadowOrthoScale = 0.1;\n        /**\n         * Automatically compute the projection matrix to best fit (including all the casters)\n         * on each frame.\n         */\n        _this.autoUpdateExtends = true;\n        /**\n         * Automatically compute the shadowMinZ and shadowMaxZ for the projection matrix to best fit (including all the casters)\n         * on each frame. autoUpdateExtends must be set to true for this to work\n         */\n        _this.autoCalcShadowZBounds = false;\n        // Cache\n        _this._orthoLeft = Number.MAX_VALUE;\n        _this._orthoRight = Number.MIN_VALUE;\n        _this._orthoTop = Number.MIN_VALUE;\n        _this._orthoBottom = Number.MAX_VALUE;\n        _this.position = direction.scale(-1.0);\n        _this.direction = direction;\n        return _this;\n    }\n    Object.defineProperty(DirectionalLight.prototype, \"shadowFrustumSize\", {\n        /**\n         * Fix frustum size for the shadow generation. This is disabled if the value is 0.\n         */\n        get: function () {\n            return this._shadowFrustumSize;\n        },\n        /**\n         * Specifies a fix frustum size for the shadow generation.\n         */\n        set: function (value) {\n            this._shadowFrustumSize = value;\n            this.forceProjectionMatrixCompute();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DirectionalLight.prototype, \"shadowOrthoScale\", {\n        /**\n         * Gets the shadow projection scale against the optimal computed one.\n         * 0.1 by default which means that the projection window is increase by 10% from the optimal size.\n         * This does not impact in fixed frustum size (shadowFrustumSize being set)\n         */\n        get: function () {\n            return this._shadowOrthoScale;\n        },\n        /**\n         * Sets the shadow projection scale against the optimal computed one.\n         * 0.1 by default which means that the projection window is increase by 10% from the optimal size.\n         * This does not impact in fixed frustum size (shadowFrustumSize being set)\n         */\n        set: function (value) {\n            this._shadowOrthoScale = value;\n            this.forceProjectionMatrixCompute();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DirectionalLight.prototype, \"orthoLeft\", {\n        /**\n         * Gets or sets the orthoLeft property used to build the light frustum\n         */\n        get: function () {\n            return this._orthoLeft;\n        },\n        set: function (left) {\n            this._orthoLeft = left;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DirectionalLight.prototype, \"orthoRight\", {\n        /**\n         * Gets or sets the orthoRight property used to build the light frustum\n         */\n        get: function () {\n            return this._orthoRight;\n        },\n        set: function (right) {\n            this._orthoRight = right;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DirectionalLight.prototype, \"orthoTop\", {\n        /**\n         * Gets or sets the orthoTop property used to build the light frustum\n         */\n        get: function () {\n            return this._orthoTop;\n        },\n        set: function (top) {\n            this._orthoTop = top;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DirectionalLight.prototype, \"orthoBottom\", {\n        /**\n         * Gets or sets the orthoBottom property used to build the light frustum\n         */\n        get: function () {\n            return this._orthoBottom;\n        },\n        set: function (bottom) {\n            this._orthoBottom = bottom;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Returns the string \"DirectionalLight\".\n     * @return The class name\n     */\n    DirectionalLight.prototype.getClassName = function () {\n        return \"DirectionalLight\";\n    };\n    /**\n     * Returns the integer 1.\n     * @return The light Type id as a constant defines in Light.LIGHTTYPEID_x\n     */\n    DirectionalLight.prototype.getTypeID = function () {\n        return Light.LIGHTTYPEID_DIRECTIONALLIGHT;\n    };\n    /**\n     * Sets the passed matrix \"matrix\" as projection matrix for the shadows cast by the light according to the passed view matrix.\n     * Returns the DirectionalLight Shadow projection matrix.\n     * @param matrix\n     * @param viewMatrix\n     * @param renderList\n     */\n    DirectionalLight.prototype._setDefaultShadowProjectionMatrix = function (matrix, viewMatrix, renderList) {\n        if (this.shadowFrustumSize > 0) {\n            this._setDefaultFixedFrustumShadowProjectionMatrix(matrix);\n        }\n        else {\n            this._setDefaultAutoExtendShadowProjectionMatrix(matrix, viewMatrix, renderList);\n        }\n    };\n    /**\n     * Sets the passed matrix \"matrix\" as fixed frustum projection matrix for the shadows cast by the light according to the passed view matrix.\n     * Returns the DirectionalLight Shadow projection matrix.\n     * @param matrix\n     */\n    DirectionalLight.prototype._setDefaultFixedFrustumShadowProjectionMatrix = function (matrix) {\n        var activeCamera = this.getScene().activeCamera;\n        if (!activeCamera) {\n            return;\n        }\n        Matrix.OrthoLHToRef(this.shadowFrustumSize, this.shadowFrustumSize, this.shadowMinZ !== undefined ? this.shadowMinZ : activeCamera.minZ, this.shadowMaxZ !== undefined ? this.shadowMaxZ : activeCamera.maxZ, matrix, this.getScene().getEngine().isNDCHalfZRange);\n    };\n    /**\n     * Sets the passed matrix \"matrix\" as auto extend projection matrix for the shadows cast by the light according to the passed view matrix.\n     * Returns the DirectionalLight Shadow projection matrix.\n     * @param matrix\n     * @param viewMatrix\n     * @param renderList\n     */\n    DirectionalLight.prototype._setDefaultAutoExtendShadowProjectionMatrix = function (matrix, viewMatrix, renderList) {\n        var activeCamera = this.getScene().activeCamera;\n        if (!activeCamera) {\n            return;\n        }\n        // Check extends\n        if (this.autoUpdateExtends || this._orthoLeft === Number.MAX_VALUE) {\n            var tempVector3 = Vector3.Zero();\n            this._orthoLeft = Number.MAX_VALUE;\n            this._orthoRight = Number.MIN_VALUE;\n            this._orthoTop = Number.MIN_VALUE;\n            this._orthoBottom = Number.MAX_VALUE;\n            var shadowMinZ = Number.MAX_VALUE;\n            var shadowMaxZ = Number.MIN_VALUE;\n            for (var meshIndex = 0; meshIndex < renderList.length; meshIndex++) {\n                var mesh = renderList[meshIndex];\n                if (!mesh) {\n                    continue;\n                }\n                var boundingInfo = mesh.getBoundingInfo();\n                var boundingBox = boundingInfo.boundingBox;\n                for (var index = 0; index < boundingBox.vectorsWorld.length; index++) {\n                    Vector3.TransformCoordinatesToRef(boundingBox.vectorsWorld[index], viewMatrix, tempVector3);\n                    if (tempVector3.x < this._orthoLeft) {\n                        this._orthoLeft = tempVector3.x;\n                    }\n                    if (tempVector3.y < this._orthoBottom) {\n                        this._orthoBottom = tempVector3.y;\n                    }\n                    if (tempVector3.x > this._orthoRight) {\n                        this._orthoRight = tempVector3.x;\n                    }\n                    if (tempVector3.y > this._orthoTop) {\n                        this._orthoTop = tempVector3.y;\n                    }\n                    if (this.autoCalcShadowZBounds) {\n                        if (tempVector3.z < shadowMinZ) {\n                            shadowMinZ = tempVector3.z;\n                        }\n                        if (tempVector3.z > shadowMaxZ) {\n                            shadowMaxZ = tempVector3.z;\n                        }\n                    }\n                }\n            }\n            if (this.autoCalcShadowZBounds) {\n                this._shadowMinZ = shadowMinZ;\n                this._shadowMaxZ = shadowMaxZ;\n            }\n        }\n        var xOffset = this._orthoRight - this._orthoLeft;\n        var yOffset = this._orthoTop - this._orthoBottom;\n        var minZ = this.shadowMinZ !== undefined ? this.shadowMinZ : activeCamera.minZ;\n        var maxZ = this.shadowMaxZ !== undefined ? this.shadowMaxZ : activeCamera.maxZ;\n        var useReverseDepthBuffer = this.getScene().getEngine().useReverseDepthBuffer;\n        Matrix.OrthoOffCenterLHToRef(this._orthoLeft - xOffset * this.shadowOrthoScale, this._orthoRight + xOffset * this.shadowOrthoScale, this._orthoBottom - yOffset * this.shadowOrthoScale, this._orthoTop + yOffset * this.shadowOrthoScale, useReverseDepthBuffer ? maxZ : minZ, useReverseDepthBuffer ? minZ : maxZ, matrix, this.getScene().getEngine().isNDCHalfZRange);\n    };\n    DirectionalLight.prototype._buildUniformLayout = function () {\n        this._uniformBuffer.addUniform(\"vLightData\", 4);\n        this._uniformBuffer.addUniform(\"vLightDiffuse\", 4);\n        this._uniformBuffer.addUniform(\"vLightSpecular\", 4);\n        this._uniformBuffer.addUniform(\"shadowsInfo\", 3);\n        this._uniformBuffer.addUniform(\"depthValues\", 2);\n        this._uniformBuffer.create();\n    };\n    /**\n     * Sets the passed Effect object with the DirectionalLight transformed position (or position if not parented) and the passed name.\n     * @param effect The effect to update\n     * @param lightIndex The index of the light in the effect to update\n     * @returns The directional light\n     */\n    DirectionalLight.prototype.transferToEffect = function (effect, lightIndex) {\n        if (this.computeTransformedInformation()) {\n            this._uniformBuffer.updateFloat4(\"vLightData\", this.transformedDirection.x, this.transformedDirection.y, this.transformedDirection.z, 1, lightIndex);\n            return this;\n        }\n        this._uniformBuffer.updateFloat4(\"vLightData\", this.direction.x, this.direction.y, this.direction.z, 1, lightIndex);\n        return this;\n    };\n    DirectionalLight.prototype.transferToNodeMaterialEffect = function (effect, lightDataUniformName) {\n        if (this.computeTransformedInformation()) {\n            effect.setFloat3(lightDataUniformName, this.transformedDirection.x, this.transformedDirection.y, this.transformedDirection.z);\n            return this;\n        }\n        effect.setFloat3(lightDataUniformName, this.direction.x, this.direction.y, this.direction.z);\n        return this;\n    };\n    /**\n     * Gets the minZ used for shadow according to both the scene and the light.\n     *\n     * Values are fixed on directional lights as it relies on an ortho projection hence the need to convert being\n     * -1 and 1 to 0 and 1 doing (depth + min) / (min + max) -> (depth + 1) / (1 + 1) -> (depth * 0.5) + 0.5.\n     * (when not using reverse depth buffer / NDC half Z range)\n     * @param activeCamera The camera we are returning the min for\n     * @returns the depth min z\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    DirectionalLight.prototype.getDepthMinZ = function (activeCamera) {\n        var engine = this._scene.getEngine();\n        return !engine.useReverseDepthBuffer && engine.isNDCHalfZRange ? 0 : 1;\n    };\n    /**\n     * Gets the maxZ used for shadow according to both the scene and the light.\n     *\n     * Values are fixed on directional lights as it relies on an ortho projection hence the need to convert being\n     * -1 and 1 to 0 and 1 doing (depth + min) / (min + max) -> (depth + 1) / (1 + 1) -> (depth * 0.5) + 0.5.\n     * (when not using reverse depth buffer / NDC half Z range)\n     * @param activeCamera The camera we are returning the max for\n     * @returns the depth max z\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    DirectionalLight.prototype.getDepthMaxZ = function (activeCamera) {\n        var engine = this._scene.getEngine();\n        return engine.useReverseDepthBuffer && engine.isNDCHalfZRange ? 0 : 1;\n    };\n    /**\n     * Prepares the list of defines specific to the light type.\n     * @param defines the list of defines\n     * @param lightIndex defines the index of the light for the effect\n     */\n    DirectionalLight.prototype.prepareLightSpecificDefines = function (defines, lightIndex) {\n        defines[\"DIRLIGHT\" + lightIndex] = true;\n    };\n    __decorate([\n        serialize()\n    ], DirectionalLight.prototype, \"shadowFrustumSize\", null);\n    __decorate([\n        serialize()\n    ], DirectionalLight.prototype, \"shadowOrthoScale\", null);\n    __decorate([\n        serialize()\n    ], DirectionalLight.prototype, \"autoUpdateExtends\", void 0);\n    __decorate([\n        serialize()\n    ], DirectionalLight.prototype, \"autoCalcShadowZBounds\", void 0);\n    __decorate([\n        serialize(\"orthoLeft\")\n    ], DirectionalLight.prototype, \"_orthoLeft\", void 0);\n    __decorate([\n        serialize(\"orthoRight\")\n    ], DirectionalLight.prototype, \"_orthoRight\", void 0);\n    __decorate([\n        serialize(\"orthoTop\")\n    ], DirectionalLight.prototype, \"_orthoTop\", void 0);\n    __decorate([\n        serialize(\"orthoBottom\")\n    ], DirectionalLight.prototype, \"_orthoBottom\", void 0);\n    return DirectionalLight;\n}(ShadowLight));\nexport { DirectionalLight };\n//# sourceMappingURL=directionalLight.js.map","import { __decorate, __extends } from \"tslib\";\nimport { serializeAsColor3, serializeAsVector3 } from \"../Misc/decorators.js\";\nimport { Matrix, Vector3 } from \"../Maths/math.vector.js\";\nimport { Color3 } from \"../Maths/math.color.js\";\nimport { Node } from \"../node.js\";\nimport { Light } from \"./light.js\";\nNode.AddNodeConstructor(\"Light_Type_3\", function (name, scene) {\n    return function () { return new HemisphericLight(name, Vector3.Zero(), scene); };\n});\n/**\n * The HemisphericLight simulates the ambient environment light,\n * so the passed direction is the light reflection direction, not the incoming direction.\n */\nvar HemisphericLight = /** @class */ (function (_super) {\n    __extends(HemisphericLight, _super);\n    /**\n     * Creates a HemisphericLight object in the scene according to the passed direction (Vector3).\n     * The HemisphericLight simulates the ambient environment light, so the passed direction is the light reflection direction, not the incoming direction.\n     * The HemisphericLight can't cast shadows.\n     * Documentation : https://doc.babylonjs.com/babylon101/lights\n     * @param name The friendly name of the light\n     * @param direction The direction of the light reflection\n     * @param scene The scene the light belongs to\n     */\n    function HemisphericLight(name, direction, scene) {\n        var _this = _super.call(this, name, scene) || this;\n        /**\n         * The groundColor is the light in the opposite direction to the one specified during creation.\n         * You can think of the diffuse and specular light as coming from the centre of the object in the given direction and the groundColor light in the opposite direction.\n         */\n        _this.groundColor = new Color3(0.0, 0.0, 0.0);\n        _this.direction = direction || Vector3.Up();\n        return _this;\n    }\n    HemisphericLight.prototype._buildUniformLayout = function () {\n        this._uniformBuffer.addUniform(\"vLightData\", 4);\n        this._uniformBuffer.addUniform(\"vLightDiffuse\", 4);\n        this._uniformBuffer.addUniform(\"vLightSpecular\", 4);\n        this._uniformBuffer.addUniform(\"vLightGround\", 3);\n        this._uniformBuffer.addUniform(\"shadowsInfo\", 3);\n        this._uniformBuffer.addUniform(\"depthValues\", 2);\n        this._uniformBuffer.create();\n    };\n    /**\n     * Returns the string \"HemisphericLight\".\n     * @return The class name\n     */\n    HemisphericLight.prototype.getClassName = function () {\n        return \"HemisphericLight\";\n    };\n    /**\n     * Sets the HemisphericLight direction towards the passed target (Vector3).\n     * Returns the updated direction.\n     * @param target The target the direction should point to\n     * @return The computed direction\n     */\n    HemisphericLight.prototype.setDirectionToTarget = function (target) {\n        this.direction = Vector3.Normalize(target.subtract(Vector3.Zero()));\n        return this.direction;\n    };\n    /**\n     * Returns the shadow generator associated to the light.\n     * @returns Always null for hemispheric lights because it does not support shadows.\n     */\n    HemisphericLight.prototype.getShadowGenerator = function () {\n        return null;\n    };\n    /**\n     * Sets the passed Effect object with the HemisphericLight normalized direction and color and the passed name (string).\n     * @param _effect The effect to update\n     * @param lightIndex The index of the light in the effect to update\n     * @returns The hemispheric light\n     */\n    HemisphericLight.prototype.transferToEffect = function (_effect, lightIndex) {\n        var normalizeDirection = Vector3.Normalize(this.direction);\n        this._uniformBuffer.updateFloat4(\"vLightData\", normalizeDirection.x, normalizeDirection.y, normalizeDirection.z, 0.0, lightIndex);\n        this._uniformBuffer.updateColor3(\"vLightGround\", this.groundColor.scale(this.intensity), lightIndex);\n        return this;\n    };\n    HemisphericLight.prototype.transferToNodeMaterialEffect = function (effect, lightDataUniformName) {\n        var normalizeDirection = Vector3.Normalize(this.direction);\n        effect.setFloat3(lightDataUniformName, normalizeDirection.x, normalizeDirection.y, normalizeDirection.z);\n        return this;\n    };\n    /**\n     * Computes the world matrix of the node\n     * @returns the world matrix\n     */\n    HemisphericLight.prototype.computeWorldMatrix = function () {\n        if (!this._worldMatrix) {\n            this._worldMatrix = Matrix.Identity();\n        }\n        return this._worldMatrix;\n    };\n    /**\n     * Returns the integer 3.\n     * @return The light Type id as a constant defines in Light.LIGHTTYPEID_x\n     */\n    HemisphericLight.prototype.getTypeID = function () {\n        return Light.LIGHTTYPEID_HEMISPHERICLIGHT;\n    };\n    /**\n     * Prepares the list of defines specific to the light type.\n     * @param defines the list of defines\n     * @param lightIndex defines the index of the light for the effect\n     */\n    HemisphericLight.prototype.prepareLightSpecificDefines = function (defines, lightIndex) {\n        defines[\"HEMILIGHT\" + lightIndex] = true;\n    };\n    __decorate([\n        serializeAsColor3()\n    ], HemisphericLight.prototype, \"groundColor\", void 0);\n    __decorate([\n        serializeAsVector3()\n    ], HemisphericLight.prototype, \"direction\", void 0);\n    return HemisphericLight;\n}(Light));\nexport { HemisphericLight };\n//# sourceMappingURL=hemisphericLight.js.map","import { __extends } from \"tslib\";\nimport { Matrix, Vector3 } from \"../../Maths/math.vector.js\";\nimport { RenderTargetTexture } from \"../../Materials/Textures/renderTargetTexture.js\";\n\nimport \"../../Shaders/shadowMap.fragment.js\";\nimport \"../../Shaders/shadowMap.vertex.js\";\nimport \"../../Shaders/depthBoxBlur.fragment.js\";\nimport { _WarnImport } from \"../../Misc/devTools.js\";\nimport { ShadowGenerator } from \"./shadowGenerator.js\";\nimport { BoundingInfo } from \"../../Culling/boundingInfo.js\";\nimport { DepthReducer } from \"../../Misc/depthReducer.js\";\nimport { Logger } from \"../../Misc/logger.js\";\nimport { EngineStore } from \"../../Engines/engineStore.js\";\n// eslint-disable-next-line @typescript-eslint/naming-convention\nvar UpDir = Vector3.Up();\n// eslint-disable-next-line @typescript-eslint/naming-convention\nvar ZeroVec = Vector3.Zero();\nvar tmpv1 = new Vector3(), tmpv2 = new Vector3(), tmpMatrix = new Matrix();\n/**\n * A CSM implementation allowing casting shadows on large scenes.\n * Documentation : https://doc.babylonjs.com/babylon101/cascadedShadows\n * Based on: https://github.com/TheRealMJP/Shadows and https://johanmedestrom.wordpress.com/2016/03/18/opengl-cascaded-shadow-maps/\n */\nvar CascadedShadowGenerator = /** @class */ (function (_super) {\n    __extends(CascadedShadowGenerator, _super);\n    /**\n     * Creates a Cascaded Shadow Generator object.\n     * A ShadowGenerator is the required tool to use the shadows.\n     * Each directional light casting shadows needs to use its own ShadowGenerator.\n     * Documentation : https://doc.babylonjs.com/babylon101/cascadedShadows\n     * @param mapSize The size of the texture what stores the shadows. Example : 1024.\n     * @param light The directional light object generating the shadows.\n     * @param usefulFloatFirst By default the generator will try to use half float textures but if you need precision (for self shadowing for instance), you can use this option to enforce full float texture.\n     */\n    function CascadedShadowGenerator(mapSize, light, usefulFloatFirst) {\n        var _this = this;\n        if (!CascadedShadowGenerator.IsSupported) {\n            Logger.Error(\"CascadedShadowMap is not supported by the current engine.\");\n            return _this;\n        }\n        _this = _super.call(this, mapSize, light, usefulFloatFirst) || this;\n        _this.usePercentageCloserFiltering = true;\n        return _this;\n    }\n    CascadedShadowGenerator.prototype._validateFilter = function (filter) {\n        if (filter === ShadowGenerator.FILTER_NONE || filter === ShadowGenerator.FILTER_PCF || filter === ShadowGenerator.FILTER_PCSS) {\n            return filter;\n        }\n        console.error('Unsupported filter \"' + filter + '\"!');\n        return ShadowGenerator.FILTER_NONE;\n    };\n    Object.defineProperty(CascadedShadowGenerator.prototype, \"numCascades\", {\n        /**\n         * Gets or set the number of cascades used by the CSM.\n         */\n        get: function () {\n            return this._numCascades;\n        },\n        set: function (value) {\n            value = Math.min(Math.max(value, CascadedShadowGenerator.MIN_CASCADES_COUNT), CascadedShadowGenerator.MAX_CASCADES_COUNT);\n            if (value === this._numCascades) {\n                return;\n            }\n            this._numCascades = value;\n            this.recreateShadowMap();\n            this._recreateSceneUBOs();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CascadedShadowGenerator.prototype, \"freezeShadowCastersBoundingInfo\", {\n        /**\n         * Enables or disables the shadow casters bounding info computation.\n         * If your shadow casters don't move, you can disable this feature.\n         * If it is enabled, the bounding box computation is done every frame.\n         */\n        get: function () {\n            return this._freezeShadowCastersBoundingInfo;\n        },\n        set: function (freeze) {\n            if (this._freezeShadowCastersBoundingInfoObservable && freeze) {\n                this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable);\n                this._freezeShadowCastersBoundingInfoObservable = null;\n            }\n            if (!this._freezeShadowCastersBoundingInfoObservable && !freeze) {\n                this._freezeShadowCastersBoundingInfoObservable = this._scene.onBeforeRenderObservable.add(this._computeShadowCastersBoundingInfo.bind(this));\n            }\n            this._freezeShadowCastersBoundingInfo = freeze;\n            if (freeze) {\n                this._computeShadowCastersBoundingInfo();\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CascadedShadowGenerator.prototype._computeShadowCastersBoundingInfo = function () {\n        this._scbiMin.copyFromFloats(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\n        this._scbiMax.copyFromFloats(Number.MIN_VALUE, Number.MIN_VALUE, Number.MIN_VALUE);\n        if (this._shadowMap && this._shadowMap.renderList) {\n            var renderList = this._shadowMap.renderList;\n            for (var meshIndex = 0; meshIndex < renderList.length; meshIndex++) {\n                var mesh = renderList[meshIndex];\n                if (!mesh) {\n                    continue;\n                }\n                var boundingInfo = mesh.getBoundingInfo(), boundingBox = boundingInfo.boundingBox;\n                this._scbiMin.minimizeInPlace(boundingBox.minimumWorld);\n                this._scbiMax.maximizeInPlace(boundingBox.maximumWorld);\n            }\n            var meshes = this._scene.meshes;\n            for (var meshIndex = 0; meshIndex < meshes.length; meshIndex++) {\n                var mesh = meshes[meshIndex];\n                if (!mesh || !mesh.isVisible || !mesh.isEnabled || !mesh.receiveShadows) {\n                    continue;\n                }\n                var boundingInfo = mesh.getBoundingInfo(), boundingBox = boundingInfo.boundingBox;\n                this._scbiMin.minimizeInPlace(boundingBox.minimumWorld);\n                this._scbiMax.maximizeInPlace(boundingBox.maximumWorld);\n            }\n        }\n        this._shadowCastersBoundingInfo.reConstruct(this._scbiMin, this._scbiMax);\n    };\n    Object.defineProperty(CascadedShadowGenerator.prototype, \"shadowCastersBoundingInfo\", {\n        /**\n         * Gets or sets the shadow casters bounding info.\n         * If you provide your own shadow casters bounding info, first enable freezeShadowCastersBoundingInfo\n         * so that the system won't overwrite the bounds you provide\n         */\n        get: function () {\n            return this._shadowCastersBoundingInfo;\n        },\n        set: function (boundingInfo) {\n            this._shadowCastersBoundingInfo = boundingInfo;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Sets the minimal and maximal distances to use when computing the cascade breaks.\n     *\n     * The values of min / max are typically the depth zmin and zmax values of your scene, for a given frame.\n     * If you don't know these values, simply leave them to their defaults and don't call this function.\n     * @param min minimal distance for the breaks (default to 0.)\n     * @param max maximal distance for the breaks (default to 1.)\n     */\n    CascadedShadowGenerator.prototype.setMinMaxDistance = function (min, max) {\n        if (this._minDistance === min && this._maxDistance === max) {\n            return;\n        }\n        if (min > max) {\n            min = 0;\n            max = 1;\n        }\n        if (min < 0) {\n            min = 0;\n        }\n        if (max > 1) {\n            max = 1;\n        }\n        this._minDistance = min;\n        this._maxDistance = max;\n        this._breaksAreDirty = true;\n    };\n    Object.defineProperty(CascadedShadowGenerator.prototype, \"minDistance\", {\n        /** Gets the minimal distance used in the cascade break computation */\n        get: function () {\n            return this._minDistance;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CascadedShadowGenerator.prototype, \"maxDistance\", {\n        /** Gets the maximal distance used in the cascade break computation */\n        get: function () {\n            return this._maxDistance;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Gets the class name of that object\n     * @returns \"CascadedShadowGenerator\"\n     */\n    CascadedShadowGenerator.prototype.getClassName = function () {\n        return CascadedShadowGenerator.CLASSNAME;\n    };\n    /**\n     * Gets a cascade minimum extents\n     * @param cascadeIndex index of the cascade\n     * @returns the minimum cascade extents\n     */\n    CascadedShadowGenerator.prototype.getCascadeMinExtents = function (cascadeIndex) {\n        return cascadeIndex >= 0 && cascadeIndex < this._numCascades ? this._cascadeMinExtents[cascadeIndex] : null;\n    };\n    /**\n     * Gets a cascade maximum extents\n     * @param cascadeIndex index of the cascade\n     * @returns the maximum cascade extents\n     */\n    CascadedShadowGenerator.prototype.getCascadeMaxExtents = function (cascadeIndex) {\n        return cascadeIndex >= 0 && cascadeIndex < this._numCascades ? this._cascadeMaxExtents[cascadeIndex] : null;\n    };\n    Object.defineProperty(CascadedShadowGenerator.prototype, \"shadowMaxZ\", {\n        /**\n         * Gets the shadow max z distance. It's the limit beyond which shadows are not displayed.\n         * It defaults to camera.maxZ\n         */\n        get: function () {\n            if (!this._scene || !this._scene.activeCamera) {\n                return 0;\n            }\n            return this._shadowMaxZ;\n        },\n        /**\n         * Sets the shadow max z distance.\n         */\n        set: function (value) {\n            if (!this._scene || !this._scene.activeCamera) {\n                this._shadowMaxZ = value;\n                return;\n            }\n            if (this._shadowMaxZ === value || value < this._scene.activeCamera.minZ || value > this._scene.activeCamera.maxZ) {\n                return;\n            }\n            this._shadowMaxZ = value;\n            this._light._markMeshesAsLightDirty();\n            this._breaksAreDirty = true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CascadedShadowGenerator.prototype, \"debug\", {\n        /**\n         * Gets or sets the debug flag.\n         * When enabled, the cascades are materialized by different colors on the screen.\n         */\n        get: function () {\n            return this._debug;\n        },\n        set: function (dbg) {\n            this._debug = dbg;\n            this._light._markMeshesAsLightDirty();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CascadedShadowGenerator.prototype, \"depthClamp\", {\n        /**\n         * Gets or sets the depth clamping value.\n         *\n         * When enabled, it improves the shadow quality because the near z plane of the light frustum don't need to be adjusted\n         * to account for the shadow casters far away.\n         *\n         * Note that this property is incompatible with PCSS filtering, so it won't be used in that case.\n         */\n        get: function () {\n            return this._depthClamp;\n        },\n        set: function (value) {\n            this._depthClamp = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CascadedShadowGenerator.prototype, \"cascadeBlendPercentage\", {\n        /**\n         * Gets or sets the percentage of blending between two cascades (value between 0. and 1.).\n         * It defaults to 0.1 (10% blending).\n         */\n        get: function () {\n            return this._cascadeBlendPercentage;\n        },\n        set: function (value) {\n            this._cascadeBlendPercentage = value;\n            this._light._markMeshesAsLightDirty();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CascadedShadowGenerator.prototype, \"lambda\", {\n        /**\n         * Gets or set the lambda parameter.\n         * This parameter is used to split the camera frustum and create the cascades.\n         * It's a value between 0. and 1.: If 0, the split is a uniform split of the frustum, if 1 it is a logarithmic split.\n         * For all values in-between, it's a linear combination of the uniform and logarithm split algorithm.\n         */\n        get: function () {\n            return this._lambda;\n        },\n        set: function (value) {\n            var lambda = Math.min(Math.max(value, 0), 1);\n            if (this._lambda == lambda) {\n                return;\n            }\n            this._lambda = lambda;\n            this._breaksAreDirty = true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Gets the view matrix corresponding to a given cascade\n     * @param cascadeNum cascade to retrieve the view matrix from\n     * @returns the cascade view matrix\n     */\n    CascadedShadowGenerator.prototype.getCascadeViewMatrix = function (cascadeNum) {\n        return cascadeNum >= 0 && cascadeNum < this._numCascades ? this._viewMatrices[cascadeNum] : null;\n    };\n    /**\n     * Gets the projection matrix corresponding to a given cascade\n     * @param cascadeNum cascade to retrieve the projection matrix from\n     * @returns the cascade projection matrix\n     */\n    CascadedShadowGenerator.prototype.getCascadeProjectionMatrix = function (cascadeNum) {\n        return cascadeNum >= 0 && cascadeNum < this._numCascades ? this._projectionMatrices[cascadeNum] : null;\n    };\n    /**\n     * Gets the transformation matrix corresponding to a given cascade\n     * @param cascadeNum cascade to retrieve the transformation matrix from\n     * @returns the cascade transformation matrix\n     */\n    CascadedShadowGenerator.prototype.getCascadeTransformMatrix = function (cascadeNum) {\n        return cascadeNum >= 0 && cascadeNum < this._numCascades ? this._transformMatrices[cascadeNum] : null;\n    };\n    /**\n     * Sets the depth renderer to use when autoCalcDepthBounds is enabled.\n     *\n     * Note that if no depth renderer is set, a new one will be automatically created internally when necessary.\n     *\n     * You should call this function if you already have a depth renderer enabled in your scene, to avoid\n     * doing multiple depth rendering each frame. If you provide your own depth renderer, make sure it stores linear depth!\n     * @param depthRenderer The depth renderer to use when autoCalcDepthBounds is enabled. If you pass null or don't call this function at all, a depth renderer will be automatically created\n     */\n    CascadedShadowGenerator.prototype.setDepthRenderer = function (depthRenderer) {\n        this._depthRenderer = depthRenderer;\n        if (this._depthReducer) {\n            this._depthReducer.setDepthRenderer(this._depthRenderer);\n        }\n    };\n    Object.defineProperty(CascadedShadowGenerator.prototype, \"autoCalcDepthBounds\", {\n        /**\n         * Gets or sets the autoCalcDepthBounds property.\n         *\n         * When enabled, a depth rendering pass is first performed (with an internally created depth renderer or with the one\n         * you provide by calling setDepthRenderer). Then, a min/max reducing is applied on the depth map to compute the\n         * minimal and maximal depth of the map and those values are used as inputs for the setMinMaxDistance() function.\n         * It can greatly enhance the shadow quality, at the expense of more GPU works.\n         * When using this option, you should increase the value of the lambda parameter, and even set it to 1 for best results.\n         */\n        get: function () {\n            return this._autoCalcDepthBounds;\n        },\n        set: function (value) {\n            var _this = this;\n            var camera = this._scene.activeCamera;\n            if (!camera) {\n                return;\n            }\n            this._autoCalcDepthBounds = value;\n            if (!value) {\n                if (this._depthReducer) {\n                    this._depthReducer.deactivate();\n                }\n                this.setMinMaxDistance(0, 1);\n                return;\n            }\n            if (!this._depthReducer) {\n                this._depthReducer = new DepthReducer(camera);\n                this._depthReducer.onAfterReductionPerformed.add(function (minmax) {\n                    var min = minmax.min, max = minmax.max;\n                    if (min >= max) {\n                        min = 0;\n                        max = 1;\n                    }\n                    if (min != _this._minDistance || max != _this._maxDistance) {\n                        _this.setMinMaxDistance(min, max);\n                    }\n                });\n                this._depthReducer.setDepthRenderer(this._depthRenderer);\n            }\n            this._depthReducer.activate();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CascadedShadowGenerator.prototype, \"autoCalcDepthBoundsRefreshRate\", {\n        /**\n         * Defines the refresh rate of the min/max computation used when autoCalcDepthBounds is set to true\n         * Use 0 to compute just once, 1 to compute on every frame, 2 to compute every two frames and so on...\n         * Note that if you provided your own depth renderer through a call to setDepthRenderer, you are responsible\n         * for setting the refresh rate on the renderer yourself!\n         */\n        get: function () {\n            var _a, _b, _c;\n            return (_c = (_b = (_a = this._depthReducer) === null || _a === void 0 ? void 0 : _a.depthRenderer) === null || _b === void 0 ? void 0 : _b.getDepthMap().refreshRate) !== null && _c !== void 0 ? _c : -1;\n        },\n        set: function (value) {\n            var _a;\n            if ((_a = this._depthReducer) === null || _a === void 0 ? void 0 : _a.depthRenderer) {\n                this._depthReducer.depthRenderer.getDepthMap().refreshRate = value;\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Create the cascade breaks according to the lambda, shadowMaxZ and min/max distance properties, as well as the camera near and far planes.\n     * This function is automatically called when updating lambda, shadowMaxZ and min/max distances, however you should call it yourself if\n     * you change the camera near/far planes!\n     */\n    CascadedShadowGenerator.prototype.splitFrustum = function () {\n        this._breaksAreDirty = true;\n    };\n    CascadedShadowGenerator.prototype._splitFrustum = function () {\n        var camera = this._scene.activeCamera;\n        if (!camera) {\n            return;\n        }\n        var near = camera.minZ, far = camera.maxZ, cameraRange = far - near, minDistance = this._minDistance, maxDistance = this._shadowMaxZ < far && this._shadowMaxZ >= near ? Math.min((this._shadowMaxZ - near) / (far - near), this._maxDistance) : this._maxDistance;\n        var minZ = near + minDistance * cameraRange, maxZ = near + maxDistance * cameraRange;\n        var range = maxZ - minZ, ratio = maxZ / minZ;\n        for (var cascadeIndex = 0; cascadeIndex < this._cascades.length; ++cascadeIndex) {\n            var p = (cascadeIndex + 1) / this._numCascades, log = minZ * Math.pow(ratio, p), uniform = minZ + range * p;\n            var d = this._lambda * (log - uniform) + uniform;\n            this._cascades[cascadeIndex].prevBreakDistance = cascadeIndex === 0 ? minDistance : this._cascades[cascadeIndex - 1].breakDistance;\n            this._cascades[cascadeIndex].breakDistance = (d - near) / cameraRange;\n            this._viewSpaceFrustumsZ[cascadeIndex] = d;\n            this._frustumLengths[cascadeIndex] = (this._cascades[cascadeIndex].breakDistance - this._cascades[cascadeIndex].prevBreakDistance) * cameraRange;\n        }\n        this._breaksAreDirty = false;\n    };\n    CascadedShadowGenerator.prototype._computeMatrices = function () {\n        var scene = this._scene;\n        var camera = scene.activeCamera;\n        if (!camera) {\n            return;\n        }\n        Vector3.NormalizeToRef(this._light.getShadowDirection(0), this._lightDirection);\n        if (Math.abs(Vector3.Dot(this._lightDirection, Vector3.Up())) === 1.0) {\n            this._lightDirection.z = 0.0000000000001; // Required to avoid perfectly perpendicular light\n        }\n        this._cachedDirection.copyFrom(this._lightDirection);\n        var useReverseDepthBuffer = scene.getEngine().useReverseDepthBuffer;\n        for (var cascadeIndex = 0; cascadeIndex < this._numCascades; ++cascadeIndex) {\n            this._computeFrustumInWorldSpace(cascadeIndex);\n            this._computeCascadeFrustum(cascadeIndex);\n            this._cascadeMaxExtents[cascadeIndex].subtractToRef(this._cascadeMinExtents[cascadeIndex], tmpv1); // tmpv1 = cascadeExtents\n            // Get position of the shadow camera\n            this._frustumCenter[cascadeIndex].addToRef(this._lightDirection.scale(this._cascadeMinExtents[cascadeIndex].z), this._shadowCameraPos[cascadeIndex]);\n            // Come up with a new orthographic camera for the shadow caster\n            Matrix.LookAtLHToRef(this._shadowCameraPos[cascadeIndex], this._frustumCenter[cascadeIndex], UpDir, this._viewMatrices[cascadeIndex]);\n            var minZ = 0, maxZ = tmpv1.z;\n            // Try to tighten minZ and maxZ based on the bounding box of the shadow casters\n            var boundingInfo = this._shadowCastersBoundingInfo;\n            boundingInfo.update(this._viewMatrices[cascadeIndex]);\n            maxZ = Math.min(maxZ, boundingInfo.boundingBox.maximumWorld.z);\n            if (!this._depthClamp || this.filter === ShadowGenerator.FILTER_PCSS) {\n                // If we don't use depth clamping, we must set minZ so that all shadow casters are in the light frustum\n                minZ = Math.min(minZ, boundingInfo.boundingBox.minimumWorld.z);\n            }\n            else {\n                // If using depth clamping, we can adjust minZ to reduce the [minZ, maxZ] range (and get some additional precision in the shadow map)\n                minZ = Math.max(minZ, boundingInfo.boundingBox.minimumWorld.z);\n            }\n            Matrix.OrthoOffCenterLHToRef(this._cascadeMinExtents[cascadeIndex].x, this._cascadeMaxExtents[cascadeIndex].x, this._cascadeMinExtents[cascadeIndex].y, this._cascadeMaxExtents[cascadeIndex].y, useReverseDepthBuffer ? maxZ : minZ, useReverseDepthBuffer ? minZ : maxZ, this._projectionMatrices[cascadeIndex], scene.getEngine().isNDCHalfZRange);\n            this._cascadeMinExtents[cascadeIndex].z = minZ;\n            this._cascadeMaxExtents[cascadeIndex].z = maxZ;\n            this._viewMatrices[cascadeIndex].multiplyToRef(this._projectionMatrices[cascadeIndex], this._transformMatrices[cascadeIndex]);\n            // Create the rounding matrix, by projecting the world-space origin and determining\n            // the fractional offset in texel space\n            Vector3.TransformCoordinatesToRef(ZeroVec, this._transformMatrices[cascadeIndex], tmpv1); // tmpv1 = shadowOrigin\n            tmpv1.scaleInPlace(this._mapSize / 2);\n            tmpv2.copyFromFloats(Math.round(tmpv1.x), Math.round(tmpv1.y), Math.round(tmpv1.z)); // tmpv2 = roundedOrigin\n            tmpv2.subtractInPlace(tmpv1).scaleInPlace(2 / this._mapSize); // tmpv2 = roundOffset\n            Matrix.TranslationToRef(tmpv2.x, tmpv2.y, 0.0, tmpMatrix);\n            this._projectionMatrices[cascadeIndex].multiplyToRef(tmpMatrix, this._projectionMatrices[cascadeIndex]);\n            this._viewMatrices[cascadeIndex].multiplyToRef(this._projectionMatrices[cascadeIndex], this._transformMatrices[cascadeIndex]);\n            this._transformMatrices[cascadeIndex].copyToArray(this._transformMatricesAsArray, cascadeIndex * 16);\n        }\n    };\n    // Get the 8 points of the view frustum in world space\n    CascadedShadowGenerator.prototype._computeFrustumInWorldSpace = function (cascadeIndex) {\n        if (!this._scene.activeCamera) {\n            return;\n        }\n        var prevSplitDist = this._cascades[cascadeIndex].prevBreakDistance, splitDist = this._cascades[cascadeIndex].breakDistance;\n        var isNDCHalfZRange = this._scene.getEngine().isNDCHalfZRange;\n        this._scene.activeCamera.getViewMatrix(); // make sure the transformation matrix we get when calling 'getTransformationMatrix()' is calculated with an up to date view matrix\n        var invViewProj = Matrix.Invert(this._scene.activeCamera.getTransformationMatrix());\n        var cornerIndexOffset = this._scene.getEngine().useReverseDepthBuffer ? 4 : 0;\n        for (var cornerIndex = 0; cornerIndex < CascadedShadowGenerator._FrustumCornersNDCSpace.length; ++cornerIndex) {\n            tmpv1.copyFrom(CascadedShadowGenerator._FrustumCornersNDCSpace[(cornerIndex + cornerIndexOffset) % CascadedShadowGenerator._FrustumCornersNDCSpace.length]);\n            if (isNDCHalfZRange && tmpv1.z === -1) {\n                tmpv1.z = 0;\n            }\n            Vector3.TransformCoordinatesToRef(tmpv1, invViewProj, this._frustumCornersWorldSpace[cascadeIndex][cornerIndex]);\n        }\n        // Get the corners of the current cascade slice of the view frustum\n        for (var cornerIndex = 0; cornerIndex < CascadedShadowGenerator._FrustumCornersNDCSpace.length / 2; ++cornerIndex) {\n            tmpv1.copyFrom(this._frustumCornersWorldSpace[cascadeIndex][cornerIndex + 4]).subtractInPlace(this._frustumCornersWorldSpace[cascadeIndex][cornerIndex]);\n            tmpv2.copyFrom(tmpv1).scaleInPlace(prevSplitDist); // near corner ray\n            tmpv1.scaleInPlace(splitDist); // far corner ray\n            tmpv1.addInPlace(this._frustumCornersWorldSpace[cascadeIndex][cornerIndex]);\n            this._frustumCornersWorldSpace[cascadeIndex][cornerIndex + 4].copyFrom(tmpv1);\n            this._frustumCornersWorldSpace[cascadeIndex][cornerIndex].addInPlace(tmpv2);\n        }\n    };\n    CascadedShadowGenerator.prototype._computeCascadeFrustum = function (cascadeIndex) {\n        this._cascadeMinExtents[cascadeIndex].copyFromFloats(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\n        this._cascadeMaxExtents[cascadeIndex].copyFromFloats(Number.MIN_VALUE, Number.MIN_VALUE, Number.MIN_VALUE);\n        this._frustumCenter[cascadeIndex].copyFromFloats(0, 0, 0);\n        var camera = this._scene.activeCamera;\n        if (!camera) {\n            return;\n        }\n        // Calculate the centroid of the view frustum slice\n        for (var cornerIndex = 0; cornerIndex < this._frustumCornersWorldSpace[cascadeIndex].length; ++cornerIndex) {\n            this._frustumCenter[cascadeIndex].addInPlace(this._frustumCornersWorldSpace[cascadeIndex][cornerIndex]);\n        }\n        this._frustumCenter[cascadeIndex].scaleInPlace(1 / this._frustumCornersWorldSpace[cascadeIndex].length);\n        if (this.stabilizeCascades) {\n            // Calculate the radius of a bounding sphere surrounding the frustum corners\n            var sphereRadius = 0;\n            for (var cornerIndex = 0; cornerIndex < this._frustumCornersWorldSpace[cascadeIndex].length; ++cornerIndex) {\n                var dist = this._frustumCornersWorldSpace[cascadeIndex][cornerIndex].subtractToRef(this._frustumCenter[cascadeIndex], tmpv1).length();\n                sphereRadius = Math.max(sphereRadius, dist);\n            }\n            sphereRadius = Math.ceil(sphereRadius * 16) / 16;\n            this._cascadeMaxExtents[cascadeIndex].copyFromFloats(sphereRadius, sphereRadius, sphereRadius);\n            this._cascadeMinExtents[cascadeIndex].copyFromFloats(-sphereRadius, -sphereRadius, -sphereRadius);\n        }\n        else {\n            // Create a temporary view matrix for the light\n            var lightCameraPos = this._frustumCenter[cascadeIndex];\n            this._frustumCenter[cascadeIndex].addToRef(this._lightDirection, tmpv1); // tmpv1 = look at\n            Matrix.LookAtLHToRef(lightCameraPos, tmpv1, UpDir, tmpMatrix); // matrix = lightView\n            // Calculate an AABB around the frustum corners\n            for (var cornerIndex = 0; cornerIndex < this._frustumCornersWorldSpace[cascadeIndex].length; ++cornerIndex) {\n                Vector3.TransformCoordinatesToRef(this._frustumCornersWorldSpace[cascadeIndex][cornerIndex], tmpMatrix, tmpv1);\n                this._cascadeMinExtents[cascadeIndex].minimizeInPlace(tmpv1);\n                this._cascadeMaxExtents[cascadeIndex].maximizeInPlace(tmpv1);\n            }\n        }\n    };\n    CascadedShadowGenerator.prototype._recreateSceneUBOs = function () {\n        this._disposeSceneUBOs();\n        if (this._sceneUBOs) {\n            for (var i = 0; i < this._numCascades; ++i) {\n                this._sceneUBOs.push(this._scene.createSceneUniformBuffer(\"Scene for CSM Shadow Generator (light \\\"\".concat(this._light.name, \"\\\" cascade #\").concat(i, \")\")));\n            }\n        }\n    };\n    Object.defineProperty(CascadedShadowGenerator, \"IsSupported\", {\n        /**\n         *  Support test.\n         */\n        get: function () {\n            var engine = EngineStore.LastCreatedEngine;\n            if (!engine) {\n                return false;\n            }\n            return engine._features.supportCSM;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CascadedShadowGenerator.prototype._initializeGenerator = function () {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v;\n        this.penumbraDarkness = (_a = this.penumbraDarkness) !== null && _a !== void 0 ? _a : 1.0;\n        this._numCascades = (_b = this._numCascades) !== null && _b !== void 0 ? _b : CascadedShadowGenerator.DEFAULT_CASCADES_COUNT;\n        this.stabilizeCascades = (_c = this.stabilizeCascades) !== null && _c !== void 0 ? _c : false;\n        this._freezeShadowCastersBoundingInfoObservable = (_d = this._freezeShadowCastersBoundingInfoObservable) !== null && _d !== void 0 ? _d : null;\n        this.freezeShadowCastersBoundingInfo = (_e = this.freezeShadowCastersBoundingInfo) !== null && _e !== void 0 ? _e : false;\n        this._scbiMin = (_f = this._scbiMin) !== null && _f !== void 0 ? _f : new Vector3(0, 0, 0);\n        this._scbiMax = (_g = this._scbiMax) !== null && _g !== void 0 ? _g : new Vector3(0, 0, 0);\n        this._shadowCastersBoundingInfo = (_h = this._shadowCastersBoundingInfo) !== null && _h !== void 0 ? _h : new BoundingInfo(new Vector3(0, 0, 0), new Vector3(0, 0, 0));\n        this._breaksAreDirty = (_j = this._breaksAreDirty) !== null && _j !== void 0 ? _j : true;\n        this._minDistance = (_k = this._minDistance) !== null && _k !== void 0 ? _k : 0;\n        this._maxDistance = (_l = this._maxDistance) !== null && _l !== void 0 ? _l : 1;\n        this._currentLayer = (_m = this._currentLayer) !== null && _m !== void 0 ? _m : 0;\n        this._shadowMaxZ = (_q = (_o = this._shadowMaxZ) !== null && _o !== void 0 ? _o : (_p = this._scene.activeCamera) === null || _p === void 0 ? void 0 : _p.maxZ) !== null && _q !== void 0 ? _q : 10000;\n        this._debug = (_r = this._debug) !== null && _r !== void 0 ? _r : false;\n        this._depthClamp = (_s = this._depthClamp) !== null && _s !== void 0 ? _s : true;\n        this._cascadeBlendPercentage = (_t = this._cascadeBlendPercentage) !== null && _t !== void 0 ? _t : 0.1;\n        this._lambda = (_u = this._lambda) !== null && _u !== void 0 ? _u : 0.5;\n        this._autoCalcDepthBounds = (_v = this._autoCalcDepthBounds) !== null && _v !== void 0 ? _v : false;\n        this._recreateSceneUBOs();\n        _super.prototype._initializeGenerator.call(this);\n    };\n    CascadedShadowGenerator.prototype._createTargetRenderTexture = function () {\n        var engine = this._scene.getEngine();\n        var size = { width: this._mapSize, height: this._mapSize, layers: this.numCascades };\n        this._shadowMap = new RenderTargetTexture(this._light.name + \"_CSMShadowMap\", size, this._scene, false, true, this._textureType, false, undefined, false, false, undefined /*, 6*/);\n        this._shadowMap.createDepthStencilTexture(engine.useReverseDepthBuffer ? 516 : 513, true);\n    };\n    CascadedShadowGenerator.prototype._initializeShadowMap = function () {\n        var _this = this;\n        _super.prototype._initializeShadowMap.call(this);\n        if (this._shadowMap === null) {\n            return;\n        }\n        this._transformMatricesAsArray = new Float32Array(this._numCascades * 16);\n        this._viewSpaceFrustumsZ = new Array(this._numCascades);\n        this._frustumLengths = new Array(this._numCascades);\n        this._lightSizeUVCorrection = new Array(this._numCascades * 2);\n        this._depthCorrection = new Array(this._numCascades);\n        this._cascades = [];\n        this._viewMatrices = [];\n        this._projectionMatrices = [];\n        this._transformMatrices = [];\n        this._cascadeMinExtents = [];\n        this._cascadeMaxExtents = [];\n        this._frustumCenter = [];\n        this._shadowCameraPos = [];\n        this._frustumCornersWorldSpace = [];\n        for (var cascadeIndex = 0; cascadeIndex < this._numCascades; ++cascadeIndex) {\n            this._cascades[cascadeIndex] = {\n                prevBreakDistance: 0,\n                breakDistance: 0,\n            };\n            this._viewMatrices[cascadeIndex] = Matrix.Zero();\n            this._projectionMatrices[cascadeIndex] = Matrix.Zero();\n            this._transformMatrices[cascadeIndex] = Matrix.Zero();\n            this._cascadeMinExtents[cascadeIndex] = new Vector3();\n            this._cascadeMaxExtents[cascadeIndex] = new Vector3();\n            this._frustumCenter[cascadeIndex] = new Vector3();\n            this._shadowCameraPos[cascadeIndex] = new Vector3();\n            this._frustumCornersWorldSpace[cascadeIndex] = new Array(CascadedShadowGenerator._FrustumCornersNDCSpace.length);\n            for (var i = 0; i < CascadedShadowGenerator._FrustumCornersNDCSpace.length; ++i) {\n                this._frustumCornersWorldSpace[cascadeIndex][i] = new Vector3();\n            }\n        }\n        var engine = this._scene.getEngine();\n        this._shadowMap.onBeforeBindObservable.clear();\n        this._shadowMap.onBeforeRenderObservable.clear();\n        this._shadowMap.onBeforeRenderObservable.add(function (layer) {\n            if (_this._sceneUBOs) {\n                _this._scene.setSceneUniformBuffer(_this._sceneUBOs[layer]);\n            }\n            _this._currentLayer = layer;\n            if (_this._filter === ShadowGenerator.FILTER_PCF) {\n                engine.setColorWrite(false);\n            }\n            _this._scene.setTransformMatrix(_this.getCascadeViewMatrix(layer), _this.getCascadeProjectionMatrix(layer));\n            if (_this._useUBO) {\n                _this._scene.getSceneUniformBuffer().unbindEffect();\n                _this._scene.finalizeSceneUbo();\n            }\n        });\n        this._shadowMap.onBeforeBindObservable.add(function () {\n            var _a;\n            _this._currentSceneUBO = _this._scene.getSceneUniformBuffer();\n            (_a = engine._debugPushGroup) === null || _a === void 0 ? void 0 : _a.call(engine, \"cascaded shadow map generation for pass id \".concat(engine.currentRenderPassId), 1);\n            if (_this._breaksAreDirty) {\n                _this._splitFrustum();\n            }\n            _this._computeMatrices();\n        });\n        this._splitFrustum();\n    };\n    CascadedShadowGenerator.prototype._bindCustomEffectForRenderSubMeshForShadowMap = function (subMesh, effect) {\n        effect.setMatrix(\"viewProjection\", this.getCascadeTransformMatrix(this._currentLayer));\n    };\n    CascadedShadowGenerator.prototype._isReadyCustomDefines = function (defines) {\n        defines.push(\"#define SM_DEPTHCLAMP \" + (this._depthClamp && this._filter !== ShadowGenerator.FILTER_PCSS ? \"1\" : \"0\"));\n    };\n    /**\n     * Prepare all the defines in a material relying on a shadow map at the specified light index.\n     * @param defines Defines of the material we want to update\n     * @param lightIndex Index of the light in the enabled light list of the material\n     */\n    CascadedShadowGenerator.prototype.prepareDefines = function (defines, lightIndex) {\n        _super.prototype.prepareDefines.call(this, defines, lightIndex);\n        var scene = this._scene;\n        var light = this._light;\n        if (!scene.shadowsEnabled || !light.shadowEnabled) {\n            return;\n        }\n        defines[\"SHADOWCSM\" + lightIndex] = true;\n        defines[\"SHADOWCSMDEBUG\" + lightIndex] = this.debug;\n        defines[\"SHADOWCSMNUM_CASCADES\" + lightIndex] = this.numCascades;\n        defines[\"SHADOWCSM_RIGHTHANDED\" + lightIndex] = scene.useRightHandedSystem;\n        var camera = scene.activeCamera;\n        if (camera && this._shadowMaxZ < camera.maxZ) {\n            defines[\"SHADOWCSMUSESHADOWMAXZ\" + lightIndex] = true;\n        }\n        if (this.cascadeBlendPercentage === 0) {\n            defines[\"SHADOWCSMNOBLEND\" + lightIndex] = true;\n        }\n    };\n    /**\n     * Binds the shadow related information inside of an effect (information like near, far, darkness...\n     * defined in the generator but impacting the effect).\n     * @param lightIndex Index of the light in the enabled light list of the material owning the effect\n     * @param effect The effect we are binfing the information for\n     */\n    CascadedShadowGenerator.prototype.bindShadowLight = function (lightIndex, effect) {\n        var light = this._light;\n        var scene = this._scene;\n        if (!scene.shadowsEnabled || !light.shadowEnabled) {\n            return;\n        }\n        var camera = scene.activeCamera;\n        if (!camera) {\n            return;\n        }\n        var shadowMap = this.getShadowMap();\n        if (!shadowMap) {\n            return;\n        }\n        var width = shadowMap.getSize().width;\n        effect.setMatrices(\"lightMatrix\" + lightIndex, this._transformMatricesAsArray);\n        effect.setArray(\"viewFrustumZ\" + lightIndex, this._viewSpaceFrustumsZ);\n        effect.setFloat(\"cascadeBlendFactor\" + lightIndex, this.cascadeBlendPercentage === 0 ? 10000 : 1 / this.cascadeBlendPercentage);\n        effect.setArray(\"frustumLengths\" + lightIndex, this._frustumLengths);\n        // Only PCF uses depth stencil texture.\n        if (this._filter === ShadowGenerator.FILTER_PCF) {\n            effect.setDepthStencilTexture(\"shadowSampler\" + lightIndex, shadowMap);\n            light._uniformBuffer.updateFloat4(\"shadowsInfo\", this.getDarkness(), width, 1 / width, this.frustumEdgeFalloff, lightIndex);\n        }\n        else if (this._filter === ShadowGenerator.FILTER_PCSS) {\n            for (var cascadeIndex = 0; cascadeIndex < this._numCascades; ++cascadeIndex) {\n                this._lightSizeUVCorrection[cascadeIndex * 2 + 0] =\n                    cascadeIndex === 0\n                        ? 1\n                        : (this._cascadeMaxExtents[0].x - this._cascadeMinExtents[0].x) / (this._cascadeMaxExtents[cascadeIndex].x - this._cascadeMinExtents[cascadeIndex].x); // x correction\n                this._lightSizeUVCorrection[cascadeIndex * 2 + 1] =\n                    cascadeIndex === 0\n                        ? 1\n                        : (this._cascadeMaxExtents[0].y - this._cascadeMinExtents[0].y) / (this._cascadeMaxExtents[cascadeIndex].y - this._cascadeMinExtents[cascadeIndex].y); // y correction\n                this._depthCorrection[cascadeIndex] =\n                    cascadeIndex === 0\n                        ? 1\n                        : (this._cascadeMaxExtents[cascadeIndex].z - this._cascadeMinExtents[cascadeIndex].z) / (this._cascadeMaxExtents[0].z - this._cascadeMinExtents[0].z);\n            }\n            effect.setDepthStencilTexture(\"shadowSampler\" + lightIndex, shadowMap);\n            effect.setTexture(\"depthSampler\" + lightIndex, shadowMap);\n            effect.setArray2(\"lightSizeUVCorrection\" + lightIndex, this._lightSizeUVCorrection);\n            effect.setArray(\"depthCorrection\" + lightIndex, this._depthCorrection);\n            effect.setFloat(\"penumbraDarkness\" + lightIndex, this.penumbraDarkness);\n            light._uniformBuffer.updateFloat4(\"shadowsInfo\", this.getDarkness(), 1 / width, this._contactHardeningLightSizeUVRatio * width, this.frustumEdgeFalloff, lightIndex);\n        }\n        else {\n            effect.setTexture(\"shadowSampler\" + lightIndex, shadowMap);\n            light._uniformBuffer.updateFloat4(\"shadowsInfo\", this.getDarkness(), width, 1 / width, this.frustumEdgeFalloff, lightIndex);\n        }\n        light._uniformBuffer.updateFloat2(\"depthValues\", this.getLight().getDepthMinZ(camera), this.getLight().getDepthMinZ(camera) + this.getLight().getDepthMaxZ(camera), lightIndex);\n    };\n    /**\n     * Gets the transformation matrix of the first cascade used to project the meshes into the map from the light point of view.\n     * (eq to view projection * shadow projection matrices)\n     * @returns The transform matrix used to create the shadow map\n     */\n    CascadedShadowGenerator.prototype.getTransformMatrix = function () {\n        return this.getCascadeTransformMatrix(0);\n    };\n    /**\n     * Disposes the ShadowGenerator.\n     * Returns nothing.\n     */\n    CascadedShadowGenerator.prototype.dispose = function () {\n        _super.prototype.dispose.call(this);\n        if (this._freezeShadowCastersBoundingInfoObservable) {\n            this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable);\n            this._freezeShadowCastersBoundingInfoObservable = null;\n        }\n        if (this._depthReducer) {\n            this._depthReducer.dispose();\n            this._depthReducer = null;\n        }\n    };\n    /**\n     * Serializes the shadow generator setup to a json object.\n     * @returns The serialized JSON object\n     */\n    CascadedShadowGenerator.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        var shadowMap = this.getShadowMap();\n        if (!shadowMap) {\n            return serializationObject;\n        }\n        serializationObject.numCascades = this._numCascades;\n        serializationObject.debug = this._debug;\n        serializationObject.stabilizeCascades = this.stabilizeCascades;\n        serializationObject.lambda = this._lambda;\n        serializationObject.cascadeBlendPercentage = this.cascadeBlendPercentage;\n        serializationObject.depthClamp = this._depthClamp;\n        serializationObject.autoCalcDepthBounds = this.autoCalcDepthBounds;\n        serializationObject.shadowMaxZ = this._shadowMaxZ;\n        serializationObject.penumbraDarkness = this.penumbraDarkness;\n        serializationObject.freezeShadowCastersBoundingInfo = this._freezeShadowCastersBoundingInfo;\n        serializationObject.minDistance = this.minDistance;\n        serializationObject.maxDistance = this.maxDistance;\n        serializationObject.renderList = [];\n        if (shadowMap.renderList) {\n            for (var meshIndex = 0; meshIndex < shadowMap.renderList.length; meshIndex++) {\n                var mesh = shadowMap.renderList[meshIndex];\n                serializationObject.renderList.push(mesh.id);\n            }\n        }\n        return serializationObject;\n    };\n    /**\n     * Parses a serialized ShadowGenerator and returns a new ShadowGenerator.\n     * @param parsedShadowGenerator The JSON object to parse\n     * @param scene The scene to create the shadow map for\n     * @returns The parsed shadow generator\n     */\n    CascadedShadowGenerator.Parse = function (parsedShadowGenerator, scene) {\n        var shadowGenerator = ShadowGenerator.Parse(parsedShadowGenerator, scene, function (mapSize, light) { return new CascadedShadowGenerator(mapSize, light); });\n        if (parsedShadowGenerator.numCascades !== undefined) {\n            shadowGenerator.numCascades = parsedShadowGenerator.numCascades;\n        }\n        if (parsedShadowGenerator.debug !== undefined) {\n            shadowGenerator.debug = parsedShadowGenerator.debug;\n        }\n        if (parsedShadowGenerator.stabilizeCascades !== undefined) {\n            shadowGenerator.stabilizeCascades = parsedShadowGenerator.stabilizeCascades;\n        }\n        if (parsedShadowGenerator.lambda !== undefined) {\n            shadowGenerator.lambda = parsedShadowGenerator.lambda;\n        }\n        if (parsedShadowGenerator.cascadeBlendPercentage !== undefined) {\n            shadowGenerator.cascadeBlendPercentage = parsedShadowGenerator.cascadeBlendPercentage;\n        }\n        if (parsedShadowGenerator.depthClamp !== undefined) {\n            shadowGenerator.depthClamp = parsedShadowGenerator.depthClamp;\n        }\n        if (parsedShadowGenerator.autoCalcDepthBounds !== undefined) {\n            shadowGenerator.autoCalcDepthBounds = parsedShadowGenerator.autoCalcDepthBounds;\n        }\n        if (parsedShadowGenerator.shadowMaxZ !== undefined) {\n            shadowGenerator.shadowMaxZ = parsedShadowGenerator.shadowMaxZ;\n        }\n        if (parsedShadowGenerator.penumbraDarkness !== undefined) {\n            shadowGenerator.penumbraDarkness = parsedShadowGenerator.penumbraDarkness;\n        }\n        if (parsedShadowGenerator.freezeShadowCastersBoundingInfo !== undefined) {\n            shadowGenerator.freezeShadowCastersBoundingInfo = parsedShadowGenerator.freezeShadowCastersBoundingInfo;\n        }\n        if (parsedShadowGenerator.minDistance !== undefined && parsedShadowGenerator.maxDistance !== undefined) {\n            shadowGenerator.setMinMaxDistance(parsedShadowGenerator.minDistance, parsedShadowGenerator.maxDistance);\n        }\n        return shadowGenerator;\n    };\n    CascadedShadowGenerator._FrustumCornersNDCSpace = [\n        new Vector3(-1.0, +1.0, -1.0),\n        new Vector3(+1.0, +1.0, -1.0),\n        new Vector3(+1.0, -1.0, -1.0),\n        new Vector3(-1.0, -1.0, -1.0),\n        new Vector3(-1.0, +1.0, +1.0),\n        new Vector3(+1.0, +1.0, +1.0),\n        new Vector3(+1.0, -1.0, +1.0),\n        new Vector3(-1.0, -1.0, +1.0),\n    ];\n    /**\n     * Name of the CSM class\n     */\n    CascadedShadowGenerator.CLASSNAME = \"CascadedShadowGenerator\";\n    /**\n     * Defines the default number of cascades used by the CSM.\n     */\n    CascadedShadowGenerator.DEFAULT_CASCADES_COUNT = 4;\n    /**\n     * Defines the minimum number of cascades used by the CSM.\n     */\n    CascadedShadowGenerator.MIN_CASCADES_COUNT = 2;\n    /**\n     * Defines the maximum number of cascades used by the CSM.\n     */\n    CascadedShadowGenerator.MAX_CASCADES_COUNT = 4;\n    /**\n     * @param _\n     * @hidden\n     */\n    CascadedShadowGenerator._SceneComponentInitialization = function (_) {\n        throw _WarnImport(\"ShadowGeneratorSceneComponent\");\n    };\n    return CascadedShadowGenerator;\n}(ShadowGenerator));\nexport { CascadedShadowGenerator };\n//# sourceMappingURL=cascadedShadowGenerator.js.map","import { ShadowGenerator } from \"./shadowGenerator.js\";\nimport { CascadedShadowGenerator } from \"./cascadedShadowGenerator.js\";\nimport { SceneComponentConstants } from \"../../sceneComponent.js\";\nimport { AbstractScene } from \"../../abstractScene.js\";\n// Adds the parser to the scene parsers.\nAbstractScene.AddParser(SceneComponentConstants.NAME_SHADOWGENERATOR, function (parsedData, scene) {\n    // Shadows\n    if (parsedData.shadowGenerators !== undefined && parsedData.shadowGenerators !== null) {\n        for (var index = 0, cache = parsedData.shadowGenerators.length; index < cache; index++) {\n            var parsedShadowGenerator = parsedData.shadowGenerators[index];\n            if (parsedShadowGenerator.className === CascadedShadowGenerator.CLASSNAME) {\n                CascadedShadowGenerator.Parse(parsedShadowGenerator, scene);\n            }\n            else {\n                ShadowGenerator.Parse(parsedShadowGenerator, scene);\n            }\n            // SG would be available on their associated lights\n        }\n    }\n});\n/**\n * Defines the shadow generator component responsible to manage any shadow generators\n * in a given scene.\n */\nvar ShadowGeneratorSceneComponent = /** @class */ (function () {\n    /**\n     * Creates a new instance of the component for the given scene\n     * @param scene Defines the scene to register the component in\n     */\n    function ShadowGeneratorSceneComponent(scene) {\n        /**\n         * The component name helpful to identify the component in the list of scene components.\n         */\n        this.name = SceneComponentConstants.NAME_SHADOWGENERATOR;\n        this.scene = scene;\n    }\n    /**\n     * Registers the component in a given scene\n     */\n    ShadowGeneratorSceneComponent.prototype.register = function () {\n        this.scene._gatherRenderTargetsStage.registerStep(SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR, this, this._gatherRenderTargets);\n    };\n    /**\n     * Rebuilds the elements related to this component in case of\n     * context lost for instance.\n     */\n    ShadowGeneratorSceneComponent.prototype.rebuild = function () {\n        // Nothing To Do Here.\n    };\n    /**\n     * Serializes the component data to the specified json object\n     * @param serializationObject The object to serialize to\n     */\n    ShadowGeneratorSceneComponent.prototype.serialize = function (serializationObject) {\n        // Shadows\n        serializationObject.shadowGenerators = [];\n        var lights = this.scene.lights;\n        for (var _i = 0, lights_1 = lights; _i < lights_1.length; _i++) {\n            var light = lights_1[_i];\n            var shadowGenerator = light.getShadowGenerator();\n            if (shadowGenerator) {\n                serializationObject.shadowGenerators.push(shadowGenerator.serialize());\n            }\n        }\n    };\n    /**\n     * Adds all the elements from the container to the scene\n     * @param container the container holding the elements\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    ShadowGeneratorSceneComponent.prototype.addFromContainer = function (container) {\n        // Nothing To Do Here. (directly attached to a light)\n    };\n    /**\n     * Removes all the elements in the container from the scene\n     * @param container contains the elements to remove\n     * @param dispose if the removed element should be disposed (default: false)\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    ShadowGeneratorSceneComponent.prototype.removeFromContainer = function (container, dispose) {\n        // Nothing To Do Here. (directly attached to a light)\n    };\n    /**\n     * Rebuilds the elements related to this component in case of\n     * context lost for instance.\n     */\n    ShadowGeneratorSceneComponent.prototype.dispose = function () {\n        // Nothing To Do Here.\n    };\n    ShadowGeneratorSceneComponent.prototype._gatherRenderTargets = function (renderTargets) {\n        // Shadows\n        var scene = this.scene;\n        if (this.scene.shadowsEnabled) {\n            for (var lightIndex = 0; lightIndex < scene.lights.length; lightIndex++) {\n                var light = scene.lights[lightIndex];\n                var shadowGenerator = light.getShadowGenerator();\n                if (light.isEnabled() && light.shadowEnabled && shadowGenerator) {\n                    var shadowMap = shadowGenerator.getShadowMap();\n                    if (scene.textures.indexOf(shadowMap) !== -1) {\n                        renderTargets.push(shadowMap);\n                    }\n                }\n            }\n        }\n    };\n    return ShadowGeneratorSceneComponent;\n}());\nexport { ShadowGeneratorSceneComponent };\nShadowGenerator._SceneComponentInitialization = function (scene) {\n    var component = scene._getComponent(SceneComponentConstants.NAME_SHADOWGENERATOR);\n    if (!component) {\n        component = new ShadowGeneratorSceneComponent(scene);\n        scene._addComponent(component);\n    }\n};\n//# sourceMappingURL=shadowGeneratorSceneComponent.js.map","import { __decorate, __extends } from \"tslib\";\nimport { serialize, SerializationHelper, serializeAsColor3, expandToProperty } from \"../Misc/decorators.js\";\nimport { Vector3 } from \"../Maths/math.vector.js\";\nimport { Color3, TmpColors } from \"../Maths/math.color.js\";\nimport { Node } from \"../node.js\";\nimport { UniformBuffer } from \"../Materials/uniformBuffer.js\";\nimport { GetClass } from \"../Misc/typeStore.js\";\nimport { LightConstants } from \"./lightConstants.js\";\n/**\n * Base class of all the lights in Babylon. It groups all the generic information about lights.\n * Lights are used, as you would expect, to affect how meshes are seen, in terms of both illumination and colour.\n * All meshes allow light to pass through them unless shadow generation is activated. The default number of lights allowed is four but this can be increased.\n */\nvar Light = /** @class */ (function (_super) {\n    __extends(Light, _super);\n    /**\n     * Creates a Light object in the scene.\n     * Documentation : https://doc.babylonjs.com/babylon101/lights\n     * @param name The friendly name of the light\n     * @param scene The scene the light belongs too\n     */\n    function Light(name, scene) {\n        var _this = _super.call(this, name, scene) || this;\n        /**\n         * Diffuse gives the basic color to an object.\n         */\n        _this.diffuse = new Color3(1.0, 1.0, 1.0);\n        /**\n         * Specular produces a highlight color on an object.\n         * Note: This is not affecting PBR materials.\n         */\n        _this.specular = new Color3(1.0, 1.0, 1.0);\n        /**\n         * Defines the falloff type for this light. This lets overriding how punctual light are\n         * falling off base on range or angle.\n         * This can be set to any values in Light.FALLOFF_x.\n         *\n         * Note: This is only useful for PBR Materials at the moment. This could be extended if required to\n         * other types of materials.\n         */\n        _this.falloffType = Light.FALLOFF_DEFAULT;\n        /**\n         * Strength of the light.\n         * Note: By default it is define in the framework own unit.\n         * Note: In PBR materials the intensityMode can be use to chose what unit the intensity is defined in.\n         */\n        _this.intensity = 1.0;\n        _this._range = Number.MAX_VALUE;\n        _this._inverseSquaredRange = 0;\n        /**\n         * Cached photometric scale default to 1.0 as the automatic intensity mode defaults to 1.0 for every type\n         * of light.\n         */\n        _this._photometricScale = 1.0;\n        _this._intensityMode = Light.INTENSITYMODE_AUTOMATIC;\n        _this._radius = 0.00001;\n        /**\n         * Defines the rendering priority of the lights. It can help in case of fallback or number of lights\n         * exceeding the number allowed of the materials.\n         */\n        _this.renderPriority = 0;\n        _this._shadowEnabled = true;\n        _this._excludeWithLayerMask = 0;\n        _this._includeOnlyWithLayerMask = 0;\n        _this._lightmapMode = 0;\n        /**\n         * @hidden Internal use only.\n         */\n        _this._excludedMeshesIds = new Array();\n        /**\n         * @hidden Internal use only.\n         */\n        _this._includedOnlyMeshesIds = new Array();\n        /** @hidden */\n        _this._isLight = true;\n        _this.getScene().addLight(_this);\n        _this._uniformBuffer = new UniformBuffer(_this.getScene().getEngine(), undefined, undefined, name);\n        _this._buildUniformLayout();\n        _this.includedOnlyMeshes = new Array();\n        _this.excludedMeshes = new Array();\n        _this._resyncMeshes();\n        return _this;\n    }\n    Object.defineProperty(Light.prototype, \"range\", {\n        /**\n         * Defines how far from the source the light is impacting in scene units.\n         * Note: Unused in PBR material as the distance light falloff is defined following the inverse squared falloff.\n         */\n        get: function () {\n            return this._range;\n        },\n        /**\n         * Defines how far from the source the light is impacting in scene units.\n         * Note: Unused in PBR material as the distance light falloff is defined following the inverse squared falloff.\n         */\n        set: function (value) {\n            this._range = value;\n            this._inverseSquaredRange = 1.0 / (this.range * this.range);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Light.prototype, \"intensityMode\", {\n        /**\n         * Gets the photometric scale used to interpret the intensity.\n         * This is only relevant with PBR Materials where the light intensity can be defined in a physical way.\n         */\n        get: function () {\n            return this._intensityMode;\n        },\n        /**\n         * Sets the photometric scale used to interpret the intensity.\n         * This is only relevant with PBR Materials where the light intensity can be defined in a physical way.\n         */\n        set: function (value) {\n            this._intensityMode = value;\n            this._computePhotometricScale();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Light.prototype, \"radius\", {\n        /**\n         * Gets the light radius used by PBR Materials to simulate soft area lights.\n         */\n        get: function () {\n            return this._radius;\n        },\n        /**\n         * sets the light radius used by PBR Materials to simulate soft area lights.\n         */\n        set: function (value) {\n            this._radius = value;\n            this._computePhotometricScale();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Light.prototype, \"shadowEnabled\", {\n        /**\n         * Gets whether or not the shadows are enabled for this light. This can help turning off/on shadow without detaching\n         * the current shadow generator.\n         */\n        get: function () {\n            return this._shadowEnabled;\n        },\n        /**\n         * Sets whether or not the shadows are enabled for this light. This can help turning off/on shadow without detaching\n         * the current shadow generator.\n         */\n        set: function (value) {\n            if (this._shadowEnabled === value) {\n                return;\n            }\n            this._shadowEnabled = value;\n            this._markMeshesAsLightDirty();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Light.prototype, \"includedOnlyMeshes\", {\n        /**\n         * Gets the only meshes impacted by this light.\n         */\n        get: function () {\n            return this._includedOnlyMeshes;\n        },\n        /**\n         * Sets the only meshes impacted by this light.\n         */\n        set: function (value) {\n            this._includedOnlyMeshes = value;\n            this._hookArrayForIncludedOnly(value);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Light.prototype, \"excludedMeshes\", {\n        /**\n         * Gets the meshes not impacted by this light.\n         */\n        get: function () {\n            return this._excludedMeshes;\n        },\n        /**\n         * Sets the meshes not impacted by this light.\n         */\n        set: function (value) {\n            this._excludedMeshes = value;\n            this._hookArrayForExcluded(value);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Light.prototype, \"excludeWithLayerMask\", {\n        /**\n         * Gets the layer id use to find what meshes are not impacted by the light.\n         * Inactive if 0\n         */\n        get: function () {\n            return this._excludeWithLayerMask;\n        },\n        /**\n         * Sets the layer id use to find what meshes are not impacted by the light.\n         * Inactive if 0\n         */\n        set: function (value) {\n            this._excludeWithLayerMask = value;\n            this._resyncMeshes();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Light.prototype, \"includeOnlyWithLayerMask\", {\n        /**\n         * Gets the layer id use to find what meshes are impacted by the light.\n         * Inactive if 0\n         */\n        get: function () {\n            return this._includeOnlyWithLayerMask;\n        },\n        /**\n         * Sets the layer id use to find what meshes are impacted by the light.\n         * Inactive if 0\n         */\n        set: function (value) {\n            this._includeOnlyWithLayerMask = value;\n            this._resyncMeshes();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Light.prototype, \"lightmapMode\", {\n        /**\n         * Gets the lightmap mode of this light (should be one of the constants defined by Light.LIGHTMAP_x)\n         */\n        get: function () {\n            return this._lightmapMode;\n        },\n        /**\n         * Sets the lightmap mode of this light (should be one of the constants defined by Light.LIGHTMAP_x)\n         */\n        set: function (value) {\n            if (this._lightmapMode === value) {\n                return;\n            }\n            this._lightmapMode = value;\n            this._markMeshesAsLightDirty();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Sets the passed Effect \"effect\" with the Light textures.\n     * @param effect The effect to update\n     * @param lightIndex The index of the light in the effect to update\n     * @returns The light\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    Light.prototype.transferTexturesToEffect = function (effect, lightIndex) {\n        // Do nothing by default.\n        return this;\n    };\n    /**\n     * Binds the lights information from the scene to the effect for the given mesh.\n     * @param lightIndex Light index\n     * @param scene The scene where the light belongs to\n     * @param effect The effect we are binding the data to\n     * @param useSpecular Defines if specular is supported\n     * @param receiveShadows Defines if the effect (mesh) we bind the light for receives shadows\n     */\n    Light.prototype._bindLight = function (lightIndex, scene, effect, useSpecular, receiveShadows) {\n        if (receiveShadows === void 0) { receiveShadows = true; }\n        var iAsString = lightIndex.toString();\n        var needUpdate = false;\n        this._uniformBuffer.bindToEffect(effect, \"Light\" + iAsString);\n        if (this._renderId !== scene.getRenderId() || this._lastUseSpecular !== useSpecular || !this._uniformBuffer.useUbo) {\n            this._renderId = scene.getRenderId();\n            this._lastUseSpecular = useSpecular;\n            var scaledIntensity = this.getScaledIntensity();\n            this.transferToEffect(effect, iAsString);\n            this.diffuse.scaleToRef(scaledIntensity, TmpColors.Color3[0]);\n            this._uniformBuffer.updateColor4(\"vLightDiffuse\", TmpColors.Color3[0], this.range, iAsString);\n            if (useSpecular) {\n                this.specular.scaleToRef(scaledIntensity, TmpColors.Color3[1]);\n                this._uniformBuffer.updateColor4(\"vLightSpecular\", TmpColors.Color3[1], this.radius, iAsString);\n            }\n            needUpdate = true;\n        }\n        // Textures might still need to be rebound.\n        this.transferTexturesToEffect(effect, iAsString);\n        // Shadows\n        if (scene.shadowsEnabled && this.shadowEnabled && receiveShadows) {\n            var shadowGenerator = this.getShadowGenerator();\n            if (shadowGenerator) {\n                shadowGenerator.bindShadowLight(iAsString, effect);\n                needUpdate = true;\n            }\n        }\n        if (needUpdate) {\n            this._uniformBuffer.update();\n        }\n        else {\n            this._uniformBuffer.bindUniformBuffer();\n        }\n    };\n    /**\n     * Returns the string \"Light\".\n     * @returns the class name\n     */\n    Light.prototype.getClassName = function () {\n        return \"Light\";\n    };\n    /**\n     * Converts the light information to a readable string for debug purpose.\n     * @param fullDetails Supports for multiple levels of logging within scene loading\n     * @returns the human readable light info\n     */\n    Light.prototype.toString = function (fullDetails) {\n        var ret = \"Name: \" + this.name;\n        ret += \", type: \" + [\"Point\", \"Directional\", \"Spot\", \"Hemispheric\"][this.getTypeID()];\n        if (this.animations) {\n            for (var i = 0; i < this.animations.length; i++) {\n                ret += \", animation[0]: \" + this.animations[i].toString(fullDetails);\n            }\n        }\n        return ret;\n    };\n    /** @hidden */\n    Light.prototype._syncParentEnabledState = function () {\n        _super.prototype._syncParentEnabledState.call(this);\n        if (!this.isDisposed()) {\n            this._resyncMeshes();\n        }\n    };\n    /**\n     * Set the enabled state of this node.\n     * @param value - the new enabled state\n     */\n    Light.prototype.setEnabled = function (value) {\n        _super.prototype.setEnabled.call(this, value);\n        this._resyncMeshes();\n    };\n    /**\n     * Returns the Light associated shadow generator if any.\n     * @return the associated shadow generator.\n     */\n    Light.prototype.getShadowGenerator = function () {\n        return this._shadowGenerator;\n    };\n    /**\n     * Returns a Vector3, the absolute light position in the World.\n     * @returns the world space position of the light\n     */\n    Light.prototype.getAbsolutePosition = function () {\n        return Vector3.Zero();\n    };\n    /**\n     * Specifies if the light will affect the passed mesh.\n     * @param mesh The mesh to test against the light\n     * @return true the mesh is affected otherwise, false.\n     */\n    Light.prototype.canAffectMesh = function (mesh) {\n        if (!mesh) {\n            return true;\n        }\n        if (this.includedOnlyMeshes && this.includedOnlyMeshes.length > 0 && this.includedOnlyMeshes.indexOf(mesh) === -1) {\n            return false;\n        }\n        if (this.excludedMeshes && this.excludedMeshes.length > 0 && this.excludedMeshes.indexOf(mesh) !== -1) {\n            return false;\n        }\n        if (this.includeOnlyWithLayerMask !== 0 && (this.includeOnlyWithLayerMask & mesh.layerMask) === 0) {\n            return false;\n        }\n        if (this.excludeWithLayerMask !== 0 && this.excludeWithLayerMask & mesh.layerMask) {\n            return false;\n        }\n        return true;\n    };\n    /**\n     * Releases resources associated with this node.\n     * @param doNotRecurse Set to true to not recurse into each children (recurse into each children by default)\n     * @param disposeMaterialAndTextures Set to true to also dispose referenced materials and textures (false by default)\n     */\n    Light.prototype.dispose = function (doNotRecurse, disposeMaterialAndTextures) {\n        if (disposeMaterialAndTextures === void 0) { disposeMaterialAndTextures = false; }\n        if (this._shadowGenerator) {\n            this._shadowGenerator.dispose();\n            this._shadowGenerator = null;\n        }\n        // Animations\n        this.getScene().stopAnimation(this);\n        if (this._parentContainer) {\n            var index = this._parentContainer.lights.indexOf(this);\n            if (index > -1) {\n                this._parentContainer.lights.splice(index, 1);\n            }\n            this._parentContainer = null;\n        }\n        // Remove from meshes\n        for (var _i = 0, _a = this.getScene().meshes; _i < _a.length; _i++) {\n            var mesh = _a[_i];\n            mesh._removeLightSource(this, true);\n        }\n        this._uniformBuffer.dispose();\n        // Remove from scene\n        this.getScene().removeLight(this);\n        _super.prototype.dispose.call(this, doNotRecurse, disposeMaterialAndTextures);\n    };\n    /**\n     * Returns the light type ID (integer).\n     * @returns The light Type id as a constant defines in Light.LIGHTTYPEID_x\n     */\n    Light.prototype.getTypeID = function () {\n        return 0;\n    };\n    /**\n     * Returns the intensity scaled by the Photometric Scale according to the light type and intensity mode.\n     * @returns the scaled intensity in intensity mode unit\n     */\n    Light.prototype.getScaledIntensity = function () {\n        return this._photometricScale * this.intensity;\n    };\n    /**\n     * Returns a new Light object, named \"name\", from the current one.\n     * @param name The name of the cloned light\n     * @param newParent The parent of this light, if it has one\n     * @returns the new created light\n     */\n    Light.prototype.clone = function (name, newParent) {\n        if (newParent === void 0) { newParent = null; }\n        var constructor = Light.GetConstructorFromName(this.getTypeID(), name, this.getScene());\n        if (!constructor) {\n            return null;\n        }\n        var clonedLight = SerializationHelper.Clone(constructor, this);\n        if (name) {\n            clonedLight.name = name;\n        }\n        if (newParent) {\n            clonedLight.parent = newParent;\n        }\n        clonedLight.setEnabled(this.isEnabled());\n        this.onClonedObservable.notifyObservers(clonedLight);\n        return clonedLight;\n    };\n    /**\n     * Serializes the current light into a Serialization object.\n     * @returns the serialized object.\n     */\n    Light.prototype.serialize = function () {\n        var serializationObject = SerializationHelper.Serialize(this);\n        serializationObject.uniqueId = this.uniqueId;\n        // Type\n        serializationObject.type = this.getTypeID();\n        // Parent\n        if (this.parent) {\n            serializationObject.parentId = this.parent.uniqueId;\n        }\n        // Inclusion / exclusions\n        if (this.excludedMeshes.length > 0) {\n            serializationObject.excludedMeshesIds = [];\n            this.excludedMeshes.forEach(function (mesh) {\n                serializationObject.excludedMeshesIds.push(mesh.id);\n            });\n        }\n        if (this.includedOnlyMeshes.length > 0) {\n            serializationObject.includedOnlyMeshesIds = [];\n            this.includedOnlyMeshes.forEach(function (mesh) {\n                serializationObject.includedOnlyMeshesIds.push(mesh.id);\n            });\n        }\n        // Animations\n        SerializationHelper.AppendSerializedAnimations(this, serializationObject);\n        serializationObject.ranges = this.serializeAnimationRanges();\n        serializationObject.isEnabled = this.isEnabled();\n        return serializationObject;\n    };\n    /**\n     * Creates a new typed light from the passed type (integer) : point light = 0, directional light = 1, spot light = 2, hemispheric light = 3.\n     * This new light is named \"name\" and added to the passed scene.\n     * @param type Type according to the types available in Light.LIGHTTYPEID_x\n     * @param name The friendly name of the light\n     * @param scene The scene the new light will belong to\n     * @returns the constructor function\n     */\n    Light.GetConstructorFromName = function (type, name, scene) {\n        var constructorFunc = Node.Construct(\"Light_Type_\" + type, name, scene);\n        if (constructorFunc) {\n            return constructorFunc;\n        }\n        // Default to no light for none present once.\n        return null;\n    };\n    /**\n     * Parses the passed \"parsedLight\" and returns a new instanced Light from this parsing.\n     * @param parsedLight The JSON representation of the light\n     * @param scene The scene to create the parsed light in\n     * @returns the created light after parsing\n     */\n    Light.Parse = function (parsedLight, scene) {\n        var constructor = Light.GetConstructorFromName(parsedLight.type, parsedLight.name, scene);\n        if (!constructor) {\n            return null;\n        }\n        var light = SerializationHelper.Parse(constructor, parsedLight, scene);\n        // Inclusion / exclusions\n        if (parsedLight.excludedMeshesIds) {\n            light._excludedMeshesIds = parsedLight.excludedMeshesIds;\n        }\n        if (parsedLight.includedOnlyMeshesIds) {\n            light._includedOnlyMeshesIds = parsedLight.includedOnlyMeshesIds;\n        }\n        // Parent\n        if (parsedLight.parentId !== undefined) {\n            light._waitingParentId = parsedLight.parentId;\n        }\n        // Falloff\n        if (parsedLight.falloffType !== undefined) {\n            light.falloffType = parsedLight.falloffType;\n        }\n        // Lightmaps\n        if (parsedLight.lightmapMode !== undefined) {\n            light.lightmapMode = parsedLight.lightmapMode;\n        }\n        // Animations\n        if (parsedLight.animations) {\n            for (var animationIndex = 0; animationIndex < parsedLight.animations.length; animationIndex++) {\n                var parsedAnimation = parsedLight.animations[animationIndex];\n                var internalClass = GetClass(\"BABYLON.Animation\");\n                if (internalClass) {\n                    light.animations.push(internalClass.Parse(parsedAnimation));\n                }\n            }\n            Node.ParseAnimationRanges(light, parsedLight, scene);\n        }\n        if (parsedLight.autoAnimate) {\n            scene.beginAnimation(light, parsedLight.autoAnimateFrom, parsedLight.autoAnimateTo, parsedLight.autoAnimateLoop, parsedLight.autoAnimateSpeed || 1.0);\n        }\n        // Check if isEnabled is defined to be back compatible with prior serialized versions.\n        if (parsedLight.isEnabled !== undefined) {\n            light.setEnabled(parsedLight.isEnabled);\n        }\n        return light;\n    };\n    Light.prototype._hookArrayForExcluded = function (array) {\n        var _this = this;\n        var oldPush = array.push;\n        array.push = function () {\n            var items = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                items[_i] = arguments[_i];\n            }\n            var result = oldPush.apply(array, items);\n            for (var _a = 0, items_1 = items; _a < items_1.length; _a++) {\n                var item = items_1[_a];\n                item._resyncLightSource(_this);\n            }\n            return result;\n        };\n        var oldSplice = array.splice;\n        array.splice = function (index, deleteCount) {\n            var deleted = oldSplice.apply(array, [index, deleteCount]);\n            for (var _i = 0, deleted_1 = deleted; _i < deleted_1.length; _i++) {\n                var item = deleted_1[_i];\n                item._resyncLightSource(_this);\n            }\n            return deleted;\n        };\n        for (var _i = 0, array_1 = array; _i < array_1.length; _i++) {\n            var item = array_1[_i];\n            item._resyncLightSource(this);\n        }\n    };\n    Light.prototype._hookArrayForIncludedOnly = function (array) {\n        var _this = this;\n        var oldPush = array.push;\n        array.push = function () {\n            var items = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                items[_i] = arguments[_i];\n            }\n            var result = oldPush.apply(array, items);\n            _this._resyncMeshes();\n            return result;\n        };\n        var oldSplice = array.splice;\n        array.splice = function (index, deleteCount) {\n            var deleted = oldSplice.apply(array, [index, deleteCount]);\n            _this._resyncMeshes();\n            return deleted;\n        };\n        this._resyncMeshes();\n    };\n    Light.prototype._resyncMeshes = function () {\n        for (var _i = 0, _a = this.getScene().meshes; _i < _a.length; _i++) {\n            var mesh = _a[_i];\n            mesh._resyncLightSource(this);\n        }\n    };\n    /**\n     * Forces the meshes to update their light related information in their rendering used effects\n     * @hidden Internal Use Only\n     */\n    Light.prototype._markMeshesAsLightDirty = function () {\n        for (var _i = 0, _a = this.getScene().meshes; _i < _a.length; _i++) {\n            var mesh = _a[_i];\n            if (mesh.lightSources.indexOf(this) !== -1) {\n                mesh._markSubMeshesAsLightDirty();\n            }\n        }\n    };\n    /**\n     * Recomputes the cached photometric scale if needed.\n     */\n    Light.prototype._computePhotometricScale = function () {\n        this._photometricScale = this._getPhotometricScale();\n        this.getScene().resetCachedMaterial();\n    };\n    /**\n     * Returns the Photometric Scale according to the light type and intensity mode.\n     */\n    Light.prototype._getPhotometricScale = function () {\n        var photometricScale = 0.0;\n        var lightTypeID = this.getTypeID();\n        //get photometric mode\n        var photometricMode = this.intensityMode;\n        if (photometricMode === Light.INTENSITYMODE_AUTOMATIC) {\n            if (lightTypeID === Light.LIGHTTYPEID_DIRECTIONALLIGHT) {\n                photometricMode = Light.INTENSITYMODE_ILLUMINANCE;\n            }\n            else {\n                photometricMode = Light.INTENSITYMODE_LUMINOUSINTENSITY;\n            }\n        }\n        //compute photometric scale\n        switch (lightTypeID) {\n            case Light.LIGHTTYPEID_POINTLIGHT:\n            case Light.LIGHTTYPEID_SPOTLIGHT:\n                switch (photometricMode) {\n                    case Light.INTENSITYMODE_LUMINOUSPOWER:\n                        photometricScale = 1.0 / (4.0 * Math.PI);\n                        break;\n                    case Light.INTENSITYMODE_LUMINOUSINTENSITY:\n                        photometricScale = 1.0;\n                        break;\n                    case Light.INTENSITYMODE_LUMINANCE:\n                        photometricScale = this.radius * this.radius;\n                        break;\n                }\n                break;\n            case Light.LIGHTTYPEID_DIRECTIONALLIGHT:\n                switch (photometricMode) {\n                    case Light.INTENSITYMODE_ILLUMINANCE:\n                        photometricScale = 1.0;\n                        break;\n                    case Light.INTENSITYMODE_LUMINANCE: {\n                        // When radius (and therefore solid angle) is non-zero a directional lights brightness can be specified via central (peak) luminance.\n                        // For a directional light the 'radius' defines the angular radius (in radians) rather than world-space radius (e.g. in metres).\n                        var apexAngleRadians = this.radius;\n                        // Impose a minimum light angular size to avoid the light becoming an infinitely small angular light source (i.e. a dirac delta function).\n                        apexAngleRadians = Math.max(apexAngleRadians, 0.001);\n                        var solidAngle = 2.0 * Math.PI * (1.0 - Math.cos(apexAngleRadians));\n                        photometricScale = solidAngle;\n                        break;\n                    }\n                }\n                break;\n            case Light.LIGHTTYPEID_HEMISPHERICLIGHT:\n                // No fall off in hemispheric light.\n                photometricScale = 1.0;\n                break;\n        }\n        return photometricScale;\n    };\n    /**\n     * Reorder the light in the scene according to their defined priority.\n     * @hidden Internal Use Only\n     */\n    Light.prototype._reorderLightsInScene = function () {\n        var scene = this.getScene();\n        if (this._renderPriority != 0) {\n            scene.requireLightSorting = true;\n        }\n        this.getScene().sortLightsByPriority();\n    };\n    /**\n     * Falloff Default: light is falling off following the material specification:\n     * standard material is using standard falloff whereas pbr material can request special falloff per materials.\n     */\n    Light.FALLOFF_DEFAULT = LightConstants.FALLOFF_DEFAULT;\n    /**\n     * Falloff Physical: light is falling off following the inverse squared distance law.\n     */\n    Light.FALLOFF_PHYSICAL = LightConstants.FALLOFF_PHYSICAL;\n    /**\n     * Falloff gltf: light is falling off as described in the gltf moving to PBR document\n     * to enhance interoperability with other engines.\n     */\n    Light.FALLOFF_GLTF = LightConstants.FALLOFF_GLTF;\n    /**\n     * Falloff Standard: light is falling off like in the standard material\n     * to enhance interoperability with other materials.\n     */\n    Light.FALLOFF_STANDARD = LightConstants.FALLOFF_STANDARD;\n    //lightmapMode Consts\n    /**\n     * If every light affecting the material is in this lightmapMode,\n     * material.lightmapTexture adds or multiplies\n     * (depends on material.useLightmapAsShadowmap)\n     * after every other light calculations.\n     */\n    Light.LIGHTMAP_DEFAULT = LightConstants.LIGHTMAP_DEFAULT;\n    /**\n     * material.lightmapTexture as only diffuse lighting from this light\n     * adds only specular lighting from this light\n     * adds dynamic shadows\n     */\n    Light.LIGHTMAP_SPECULAR = LightConstants.LIGHTMAP_SPECULAR;\n    /**\n     * material.lightmapTexture as only lighting\n     * no light calculation from this light\n     * only adds dynamic shadows from this light\n     */\n    Light.LIGHTMAP_SHADOWSONLY = LightConstants.LIGHTMAP_SHADOWSONLY;\n    // Intensity Mode Consts\n    /**\n     * Each light type uses the default quantity according to its type:\n     *      point/spot lights use luminous intensity\n     *      directional lights use illuminance\n     */\n    Light.INTENSITYMODE_AUTOMATIC = LightConstants.INTENSITYMODE_AUTOMATIC;\n    /**\n     * lumen (lm)\n     */\n    Light.INTENSITYMODE_LUMINOUSPOWER = LightConstants.INTENSITYMODE_LUMINOUSPOWER;\n    /**\n     * candela (lm/sr)\n     */\n    Light.INTENSITYMODE_LUMINOUSINTENSITY = LightConstants.INTENSITYMODE_LUMINOUSINTENSITY;\n    /**\n     * lux (lm/m^2)\n     */\n    Light.INTENSITYMODE_ILLUMINANCE = LightConstants.INTENSITYMODE_ILLUMINANCE;\n    /**\n     * nit (cd/m^2)\n     */\n    Light.INTENSITYMODE_LUMINANCE = LightConstants.INTENSITYMODE_LUMINANCE;\n    // Light types ids const.\n    /**\n     * Light type const id of the point light.\n     */\n    Light.LIGHTTYPEID_POINTLIGHT = LightConstants.LIGHTTYPEID_POINTLIGHT;\n    /**\n     * Light type const id of the directional light.\n     */\n    Light.LIGHTTYPEID_DIRECTIONALLIGHT = LightConstants.LIGHTTYPEID_DIRECTIONALLIGHT;\n    /**\n     * Light type const id of the spot light.\n     */\n    Light.LIGHTTYPEID_SPOTLIGHT = LightConstants.LIGHTTYPEID_SPOTLIGHT;\n    /**\n     * Light type const id of the hemispheric light.\n     */\n    Light.LIGHTTYPEID_HEMISPHERICLIGHT = LightConstants.LIGHTTYPEID_HEMISPHERICLIGHT;\n    __decorate([\n        serializeAsColor3()\n    ], Light.prototype, \"diffuse\", void 0);\n    __decorate([\n        serializeAsColor3()\n    ], Light.prototype, \"specular\", void 0);\n    __decorate([\n        serialize()\n    ], Light.prototype, \"falloffType\", void 0);\n    __decorate([\n        serialize()\n    ], Light.prototype, \"intensity\", void 0);\n    __decorate([\n        serialize()\n    ], Light.prototype, \"range\", null);\n    __decorate([\n        serialize()\n    ], Light.prototype, \"intensityMode\", null);\n    __decorate([\n        serialize()\n    ], Light.prototype, \"radius\", null);\n    __decorate([\n        serialize()\n    ], Light.prototype, \"_renderPriority\", void 0);\n    __decorate([\n        expandToProperty(\"_reorderLightsInScene\")\n    ], Light.prototype, \"renderPriority\", void 0);\n    __decorate([\n        serialize(\"shadowEnabled\")\n    ], Light.prototype, \"_shadowEnabled\", void 0);\n    __decorate([\n        serialize(\"excludeWithLayerMask\")\n    ], Light.prototype, \"_excludeWithLayerMask\", void 0);\n    __decorate([\n        serialize(\"includeOnlyWithLayerMask\")\n    ], Light.prototype, \"_includeOnlyWithLayerMask\", void 0);\n    __decorate([\n        serialize(\"lightmapMode\")\n    ], Light.prototype, \"_lightmapMode\", void 0);\n    return Light;\n}(Node));\nexport { Light };\n//# sourceMappingURL=light.js.map","/** Defines the cross module constantsused by lights to avoid circular dependencies */\nvar LightConstants = /** @class */ (function () {\n    function LightConstants() {\n    }\n    /**\n     * Sort function to order lights for rendering.\n     * @param a First Light object to compare to second.\n     * @param b Second Light object to compare first.\n     * @return -1 to reduce's a's index relative to be, 0 for no change, 1 to increase a's index relative to b.\n     */\n    LightConstants.CompareLightsPriority = function (a, b) {\n        //shadow-casting lights have priority over non-shadow-casting lights\n        //the renderPriority is a secondary sort criterion\n        if (a.shadowEnabled !== b.shadowEnabled) {\n            return (b.shadowEnabled ? 1 : 0) - (a.shadowEnabled ? 1 : 0);\n        }\n        return b.renderPriority - a.renderPriority;\n    };\n    /**\n     * Falloff Default: light is falling off following the material specification:\n     * standard material is using standard falloff whereas pbr material can request special falloff per materials.\n     */\n    LightConstants.FALLOFF_DEFAULT = 0;\n    /**\n     * Falloff Physical: light is falling off following the inverse squared distance law.\n     */\n    LightConstants.FALLOFF_PHYSICAL = 1;\n    /**\n     * Falloff gltf: light is falling off as described in the gltf moving to PBR document\n     * to enhance interoperability with other engines.\n     */\n    LightConstants.FALLOFF_GLTF = 2;\n    /**\n     * Falloff Standard: light is falling off like in the standard material\n     * to enhance interoperability with other materials.\n     */\n    LightConstants.FALLOFF_STANDARD = 3;\n    //lightmapMode Consts\n    /**\n     * If every light affecting the material is in this lightmapMode,\n     * material.lightmapTexture adds or multiplies\n     * (depends on material.useLightmapAsShadowmap)\n     * after every other light calculations.\n     */\n    LightConstants.LIGHTMAP_DEFAULT = 0;\n    /**\n     * material.lightmapTexture as only diffuse lighting from this light\n     * adds only specular lighting from this light\n     * adds dynamic shadows\n     */\n    LightConstants.LIGHTMAP_SPECULAR = 1;\n    /**\n     * material.lightmapTexture as only lighting\n     * no light calculation from this light\n     * only adds dynamic shadows from this light\n     */\n    LightConstants.LIGHTMAP_SHADOWSONLY = 2;\n    // Intensity Mode Consts\n    /**\n     * Each light type uses the default quantity according to its type:\n     *      point/spot lights use luminous intensity\n     *      directional lights use illuminance\n     */\n    LightConstants.INTENSITYMODE_AUTOMATIC = 0;\n    /**\n     * lumen (lm)\n     */\n    LightConstants.INTENSITYMODE_LUMINOUSPOWER = 1;\n    /**\n     * candela (lm/sr)\n     */\n    LightConstants.INTENSITYMODE_LUMINOUSINTENSITY = 2;\n    /**\n     * lux (lm/m^2)\n     */\n    LightConstants.INTENSITYMODE_ILLUMINANCE = 3;\n    /**\n     * nit (cd/m^2)\n     */\n    LightConstants.INTENSITYMODE_LUMINANCE = 4;\n    // Light types ids const.\n    /**\n     * Light type const id of the point light.\n     */\n    LightConstants.LIGHTTYPEID_POINTLIGHT = 0;\n    /**\n     * Light type const id of the directional light.\n     */\n    LightConstants.LIGHTTYPEID_DIRECTIONALLIGHT = 1;\n    /**\n     * Light type const id of the spot light.\n     */\n    LightConstants.LIGHTTYPEID_SPOTLIGHT = 2;\n    /**\n     * Light type const id of the hemispheric light.\n     */\n    LightConstants.LIGHTTYPEID_HEMISPHERICLIGHT = 3;\n    return LightConstants;\n}());\nexport { LightConstants };\n//# sourceMappingURL=lightConstants.js.map","import { __decorate, __extends } from \"tslib\";\nimport { serialize } from \"../Misc/decorators.js\";\nimport { Matrix, Vector3 } from \"../Maths/math.vector.js\";\nimport { Node } from \"../node.js\";\nimport { Light } from \"./light.js\";\nimport { ShadowLight } from \"./shadowLight.js\";\nNode.AddNodeConstructor(\"Light_Type_0\", function (name, scene) {\n    return function () { return new PointLight(name, Vector3.Zero(), scene); };\n});\n/**\n * A point light is a light defined by an unique point in world space.\n * The light is emitted in every direction from this point.\n * A good example of a point light is a standard light bulb.\n * Documentation: https://doc.babylonjs.com/babylon101/lights\n */\nvar PointLight = /** @class */ (function (_super) {\n    __extends(PointLight, _super);\n    /**\n     * Creates a PointLight object from the passed name and position (Vector3) and adds it in the scene.\n     * A PointLight emits the light in every direction.\n     * It can cast shadows.\n     * If the scene camera is already defined and you want to set your PointLight at the camera position, just set it :\n     * ```javascript\n     * var pointLight = new PointLight(\"pl\", camera.position, scene);\n     * ```\n     * Documentation : https://doc.babylonjs.com/babylon101/lights\n     * @param name The light friendly name\n     * @param position The position of the point light in the scene\n     * @param scene The scene the lights belongs to\n     */\n    function PointLight(name, position, scene) {\n        var _this = _super.call(this, name, scene) || this;\n        _this._shadowAngle = Math.PI / 2;\n        _this.position = position;\n        return _this;\n    }\n    Object.defineProperty(PointLight.prototype, \"shadowAngle\", {\n        /**\n         * Getter: In case of direction provided, the shadow will not use a cube texture but simulate a spot shadow as a fallback\n         * This specifies what angle the shadow will use to be created.\n         *\n         * It default to 90 degrees to work nicely with the cube texture generation for point lights shadow maps.\n         */\n        get: function () {\n            return this._shadowAngle;\n        },\n        /**\n         * Setter: In case of direction provided, the shadow will not use a cube texture but simulate a spot shadow as a fallback\n         * This specifies what angle the shadow will use to be created.\n         *\n         * It default to 90 degrees to work nicely with the cube texture generation for point lights shadow maps.\n         */\n        set: function (value) {\n            this._shadowAngle = value;\n            this.forceProjectionMatrixCompute();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PointLight.prototype, \"direction\", {\n        /**\n         * Gets the direction if it has been set.\n         * In case of direction provided, the shadow will not use a cube texture but simulate a spot shadow as a fallback\n         */\n        get: function () {\n            return this._direction;\n        },\n        /**\n         * In case of direction provided, the shadow will not use a cube texture but simulate a spot shadow as a fallback\n         */\n        set: function (value) {\n            var previousNeedCube = this.needCube();\n            this._direction = value;\n            if (this.needCube() !== previousNeedCube && this._shadowGenerator) {\n                this._shadowGenerator.recreateShadowMap();\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Returns the string \"PointLight\"\n     * @returns the class name\n     */\n    PointLight.prototype.getClassName = function () {\n        return \"PointLight\";\n    };\n    /**\n     * Returns the integer 0.\n     * @returns The light Type id as a constant defines in Light.LIGHTTYPEID_x\n     */\n    PointLight.prototype.getTypeID = function () {\n        return Light.LIGHTTYPEID_POINTLIGHT;\n    };\n    /**\n     * Specifies whether or not the shadowmap should be a cube texture.\n     * @returns true if the shadowmap needs to be a cube texture.\n     */\n    PointLight.prototype.needCube = function () {\n        return !this.direction;\n    };\n    /**\n     * Returns a new Vector3 aligned with the PointLight cube system according to the passed cube face index (integer).\n     * @param faceIndex The index of the face we are computed the direction to generate shadow\n     * @returns The set direction in 2d mode otherwise the direction to the cubemap face if needCube() is true\n     */\n    PointLight.prototype.getShadowDirection = function (faceIndex) {\n        if (this.direction) {\n            return _super.prototype.getShadowDirection.call(this, faceIndex);\n        }\n        else {\n            switch (faceIndex) {\n                case 0:\n                    return new Vector3(1.0, 0.0, 0.0);\n                case 1:\n                    return new Vector3(-1.0, 0.0, 0.0);\n                case 2:\n                    return new Vector3(0.0, -1.0, 0.0);\n                case 3:\n                    return new Vector3(0.0, 1.0, 0.0);\n                case 4:\n                    return new Vector3(0.0, 0.0, 1.0);\n                case 5:\n                    return new Vector3(0.0, 0.0, -1.0);\n            }\n        }\n        return Vector3.Zero();\n    };\n    /**\n     * Sets the passed matrix \"matrix\" as a left-handed perspective projection matrix with the following settings :\n     * - fov = PI / 2\n     * - aspect ratio : 1.0\n     * - z-near and far equal to the active camera minZ and maxZ.\n     * Returns the PointLight.\n     * @param matrix\n     * @param viewMatrix\n     * @param renderList\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    PointLight.prototype._setDefaultShadowProjectionMatrix = function (matrix, viewMatrix, renderList) {\n        var activeCamera = this.getScene().activeCamera;\n        if (!activeCamera) {\n            return;\n        }\n        var minZ = this.shadowMinZ !== undefined ? this.shadowMinZ : activeCamera.minZ;\n        var maxZ = this.shadowMaxZ !== undefined ? this.shadowMaxZ : activeCamera.maxZ;\n        var useReverseDepthBuffer = this.getScene().getEngine().useReverseDepthBuffer;\n        Matrix.PerspectiveFovLHToRef(this.shadowAngle, 1.0, useReverseDepthBuffer ? maxZ : minZ, useReverseDepthBuffer ? minZ : maxZ, matrix, true, this._scene.getEngine().isNDCHalfZRange, undefined, useReverseDepthBuffer);\n    };\n    PointLight.prototype._buildUniformLayout = function () {\n        this._uniformBuffer.addUniform(\"vLightData\", 4);\n        this._uniformBuffer.addUniform(\"vLightDiffuse\", 4);\n        this._uniformBuffer.addUniform(\"vLightSpecular\", 4);\n        this._uniformBuffer.addUniform(\"vLightFalloff\", 4);\n        this._uniformBuffer.addUniform(\"shadowsInfo\", 3);\n        this._uniformBuffer.addUniform(\"depthValues\", 2);\n        this._uniformBuffer.create();\n    };\n    /**\n     * Sets the passed Effect \"effect\" with the PointLight transformed position (or position, if none) and passed name (string).\n     * @param effect The effect to update\n     * @param lightIndex The index of the light in the effect to update\n     * @returns The point light\n     */\n    PointLight.prototype.transferToEffect = function (effect, lightIndex) {\n        if (this.computeTransformedInformation()) {\n            this._uniformBuffer.updateFloat4(\"vLightData\", this.transformedPosition.x, this.transformedPosition.y, this.transformedPosition.z, 0.0, lightIndex);\n        }\n        else {\n            this._uniformBuffer.updateFloat4(\"vLightData\", this.position.x, this.position.y, this.position.z, 0, lightIndex);\n        }\n        this._uniformBuffer.updateFloat4(\"vLightFalloff\", this.range, this._inverseSquaredRange, 0, 0, lightIndex);\n        return this;\n    };\n    PointLight.prototype.transferToNodeMaterialEffect = function (effect, lightDataUniformName) {\n        if (this.computeTransformedInformation()) {\n            effect.setFloat3(lightDataUniformName, this.transformedPosition.x, this.transformedPosition.y, this.transformedPosition.z);\n        }\n        else {\n            effect.setFloat3(lightDataUniformName, this.position.x, this.position.y, this.position.z);\n        }\n        return this;\n    };\n    /**\n     * Prepares the list of defines specific to the light type.\n     * @param defines the list of defines\n     * @param lightIndex defines the index of the light for the effect\n     */\n    PointLight.prototype.prepareLightSpecificDefines = function (defines, lightIndex) {\n        defines[\"POINTLIGHT\" + lightIndex] = true;\n    };\n    __decorate([\n        serialize()\n    ], PointLight.prototype, \"shadowAngle\", null);\n    return PointLight;\n}(ShadowLight));\nexport { PointLight };\n//# sourceMappingURL=pointLight.js.map","import { __decorate, __extends } from \"tslib\";\nimport { serialize, serializeAsVector3 } from \"../Misc/decorators.js\";\nimport { Matrix, Vector3 } from \"../Maths/math.vector.js\";\nimport { Light } from \"./light.js\";\nimport { Axis } from \"../Maths/math.axis.js\";\n/**\n * Base implementation IShadowLight\n * It groups all the common behaviour in order to reduce duplication and better follow the DRY pattern.\n */\nvar ShadowLight = /** @class */ (function (_super) {\n    __extends(ShadowLight, _super);\n    function ShadowLight() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this._needProjectionMatrixCompute = true;\n        return _this;\n    }\n    ShadowLight.prototype._setPosition = function (value) {\n        this._position = value;\n    };\n    Object.defineProperty(ShadowLight.prototype, \"position\", {\n        /**\n         * Sets the position the shadow will be casted from. Also use as the light position for both\n         * point and spot lights.\n         */\n        get: function () {\n            return this._position;\n        },\n        /**\n         * Sets the position the shadow will be casted from. Also use as the light position for both\n         * point and spot lights.\n         */\n        set: function (value) {\n            this._setPosition(value);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ShadowLight.prototype._setDirection = function (value) {\n        this._direction = value;\n    };\n    Object.defineProperty(ShadowLight.prototype, \"direction\", {\n        /**\n         * In 2d mode (needCube being false), gets the direction used to cast the shadow.\n         * Also use as the light direction on spot and directional lights.\n         */\n        get: function () {\n            return this._direction;\n        },\n        /**\n         * In 2d mode (needCube being false), sets the direction used to cast the shadow.\n         * Also use as the light direction on spot and directional lights.\n         */\n        set: function (value) {\n            this._setDirection(value);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowLight.prototype, \"shadowMinZ\", {\n        /**\n         * Gets the shadow projection clipping minimum z value.\n         */\n        get: function () {\n            return this._shadowMinZ;\n        },\n        /**\n         * Sets the shadow projection clipping minimum z value.\n         */\n        set: function (value) {\n            this._shadowMinZ = value;\n            this.forceProjectionMatrixCompute();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ShadowLight.prototype, \"shadowMaxZ\", {\n        /**\n         * Sets the shadow projection clipping maximum z value.\n         */\n        get: function () {\n            return this._shadowMaxZ;\n        },\n        /**\n         * Gets the shadow projection clipping maximum z value.\n         */\n        set: function (value) {\n            this._shadowMaxZ = value;\n            this.forceProjectionMatrixCompute();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Computes the transformed information (transformedPosition and transformedDirection in World space) of the current light\n     * @returns true if the information has been computed, false if it does not need to (no parenting)\n     */\n    ShadowLight.prototype.computeTransformedInformation = function () {\n        if (this.parent && this.parent.getWorldMatrix) {\n            if (!this.transformedPosition) {\n                this.transformedPosition = Vector3.Zero();\n            }\n            Vector3.TransformCoordinatesToRef(this.position, this.parent.getWorldMatrix(), this.transformedPosition);\n            // In case the direction is present.\n            if (this.direction) {\n                if (!this.transformedDirection) {\n                    this.transformedDirection = Vector3.Zero();\n                }\n                Vector3.TransformNormalToRef(this.direction, this.parent.getWorldMatrix(), this.transformedDirection);\n            }\n            return true;\n        }\n        return false;\n    };\n    /**\n     * Return the depth scale used for the shadow map.\n     * @returns the depth scale.\n     */\n    ShadowLight.prototype.getDepthScale = function () {\n        return 50.0;\n    };\n    /**\n     * Get the direction to use to render the shadow map. In case of cube texture, the face index can be passed.\n     * @param faceIndex The index of the face we are computed the direction to generate shadow\n     * @returns The set direction in 2d mode otherwise the direction to the cubemap face if needCube() is true\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    ShadowLight.prototype.getShadowDirection = function (faceIndex) {\n        return this.transformedDirection ? this.transformedDirection : this.direction;\n    };\n    /**\n     * Returns the ShadowLight absolute position in the World.\n     * @returns the position vector in world space\n     */\n    ShadowLight.prototype.getAbsolutePosition = function () {\n        return this.transformedPosition ? this.transformedPosition : this.position;\n    };\n    /**\n     * Sets the ShadowLight direction toward the passed target.\n     * @param target The point to target in local space\n     * @returns the updated ShadowLight direction\n     */\n    ShadowLight.prototype.setDirectionToTarget = function (target) {\n        this.direction = Vector3.Normalize(target.subtract(this.position));\n        return this.direction;\n    };\n    /**\n     * Returns the light rotation in euler definition.\n     * @returns the x y z rotation in local space.\n     */\n    ShadowLight.prototype.getRotation = function () {\n        this.direction.normalize();\n        var xaxis = Vector3.Cross(this.direction, Axis.Y);\n        var yaxis = Vector3.Cross(xaxis, this.direction);\n        return Vector3.RotationFromAxis(xaxis, yaxis, this.direction);\n    };\n    /**\n     * Returns whether or not the shadow generation require a cube texture or a 2d texture.\n     * @returns true if a cube texture needs to be use\n     */\n    ShadowLight.prototype.needCube = function () {\n        return false;\n    };\n    /**\n     * Detects if the projection matrix requires to be recomputed this frame.\n     * @returns true if it requires to be recomputed otherwise, false.\n     */\n    ShadowLight.prototype.needProjectionMatrixCompute = function () {\n        return this._needProjectionMatrixCompute;\n    };\n    /**\n     * Forces the shadow generator to recompute the projection matrix even if position and direction did not changed.\n     */\n    ShadowLight.prototype.forceProjectionMatrixCompute = function () {\n        this._needProjectionMatrixCompute = true;\n    };\n    /** @hidden */\n    ShadowLight.prototype._initCache = function () {\n        _super.prototype._initCache.call(this);\n        this._cache.position = Vector3.Zero();\n    };\n    /** @hidden */\n    ShadowLight.prototype._isSynchronized = function () {\n        if (!this._cache.position.equals(this.position)) {\n            return false;\n        }\n        return true;\n    };\n    /**\n     * Computes the world matrix of the node\n     * @param force defines if the cache version should be invalidated forcing the world matrix to be created from scratch\n     * @returns the world matrix\n     */\n    ShadowLight.prototype.computeWorldMatrix = function (force) {\n        if (!force && this.isSynchronized()) {\n            this._currentRenderId = this.getScene().getRenderId();\n            return this._worldMatrix;\n        }\n        this._updateCache();\n        this._cache.position.copyFrom(this.position);\n        if (!this._worldMatrix) {\n            this._worldMatrix = Matrix.Identity();\n        }\n        Matrix.TranslationToRef(this.position.x, this.position.y, this.position.z, this._worldMatrix);\n        if (this.parent && this.parent.getWorldMatrix) {\n            this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(), this._worldMatrix);\n            this._markSyncedWithParent();\n        }\n        // Cache the determinant\n        this._worldMatrixDeterminantIsDirty = true;\n        return this._worldMatrix;\n    };\n    /**\n     * Gets the minZ used for shadow according to both the scene and the light.\n     * @param activeCamera The camera we are returning the min for\n     * @returns the depth min z\n     */\n    ShadowLight.prototype.getDepthMinZ = function (activeCamera) {\n        return this.shadowMinZ !== undefined ? this.shadowMinZ : activeCamera.minZ;\n    };\n    /**\n     * Gets the maxZ used for shadow according to both the scene and the light.\n     * @param activeCamera The camera we are returning the max for\n     * @returns the depth max z\n     */\n    ShadowLight.prototype.getDepthMaxZ = function (activeCamera) {\n        return this.shadowMaxZ !== undefined ? this.shadowMaxZ : activeCamera.maxZ;\n    };\n    /**\n     * Sets the shadow projection matrix in parameter to the generated projection matrix.\n     * @param matrix The matrix to updated with the projection information\n     * @param viewMatrix The transform matrix of the light\n     * @param renderList The list of mesh to render in the map\n     * @returns The current light\n     */\n    ShadowLight.prototype.setShadowProjectionMatrix = function (matrix, viewMatrix, renderList) {\n        if (this.customProjectionMatrixBuilder) {\n            this.customProjectionMatrixBuilder(viewMatrix, renderList, matrix);\n        }\n        else {\n            this._setDefaultShadowProjectionMatrix(matrix, viewMatrix, renderList);\n        }\n        return this;\n    };\n    /** @hidden */\n    ShadowLight.prototype._syncParentEnabledState = function () {\n        _super.prototype._syncParentEnabledState.call(this);\n        if (!this.parent || !this.parent.getWorldMatrix) {\n            this.transformedPosition = null;\n            this.transformedDirection = null;\n        }\n    };\n    __decorate([\n        serializeAsVector3()\n    ], ShadowLight.prototype, \"position\", null);\n    __decorate([\n        serializeAsVector3()\n    ], ShadowLight.prototype, \"direction\", null);\n    __decorate([\n        serialize()\n    ], ShadowLight.prototype, \"shadowMinZ\", null);\n    __decorate([\n        serialize()\n    ], ShadowLight.prototype, \"shadowMaxZ\", null);\n    return ShadowLight;\n}(Light));\nexport { ShadowLight };\n//# sourceMappingURL=shadowLight.js.map","import { __decorate, __extends } from \"tslib\";\nimport { serialize, serializeAsTexture } from \"../Misc/decorators.js\";\nimport { Matrix, Vector3 } from \"../Maths/math.vector.js\";\nimport { Node } from \"../node.js\";\nimport { Light } from \"./light.js\";\nimport { ShadowLight } from \"./shadowLight.js\";\nimport { Texture } from \"../Materials/Textures/texture.js\";\nNode.AddNodeConstructor(\"Light_Type_2\", function (name, scene) {\n    return function () { return new SpotLight(name, Vector3.Zero(), Vector3.Zero(), 0, 0, scene); };\n});\n/**\n * A spot light is defined by a position, a direction, an angle, and an exponent.\n * These values define a cone of light starting from the position, emitting toward the direction.\n * The angle, in radians, defines the size (field of illumination) of the spotlight's conical beam,\n * and the exponent defines the speed of the decay of the light with distance (reach).\n * Documentation: https://doc.babylonjs.com/babylon101/lights\n */\nvar SpotLight = /** @class */ (function (_super) {\n    __extends(SpotLight, _super);\n    /**\n     * Creates a SpotLight object in the scene. A spot light is a simply light oriented cone.\n     * It can cast shadows.\n     * Documentation : https://doc.babylonjs.com/babylon101/lights\n     * @param name The light friendly name\n     * @param position The position of the spot light in the scene\n     * @param direction The direction of the light in the scene\n     * @param angle The cone angle of the light in Radians\n     * @param exponent The light decay speed with the distance from the emission spot\n     * @param scene The scene the lights belongs to\n     */\n    function SpotLight(name, position, direction, angle, exponent, scene) {\n        var _this = _super.call(this, name, scene) || this;\n        _this._innerAngle = 0;\n        _this._projectionTextureMatrix = Matrix.Zero();\n        _this._projectionTextureLightNear = 1e-6;\n        _this._projectionTextureLightFar = 1000.0;\n        _this._projectionTextureUpDirection = Vector3.Up();\n        _this._projectionTextureViewLightDirty = true;\n        _this._projectionTextureProjectionLightDirty = true;\n        _this._projectionTextureDirty = true;\n        _this._projectionTextureViewTargetVector = Vector3.Zero();\n        _this._projectionTextureViewLightMatrix = Matrix.Zero();\n        _this._projectionTextureProjectionLightMatrix = Matrix.Zero();\n        _this._projectionTextureScalingMatrix = Matrix.FromValues(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);\n        _this.position = position;\n        _this.direction = direction;\n        _this.angle = angle;\n        _this.exponent = exponent;\n        return _this;\n    }\n    Object.defineProperty(SpotLight.prototype, \"angle\", {\n        /**\n         * Gets the cone angle of the spot light in Radians.\n         */\n        get: function () {\n            return this._angle;\n        },\n        /**\n         * Sets the cone angle of the spot light in Radians.\n         */\n        set: function (value) {\n            this._angle = value;\n            this._cosHalfAngle = Math.cos(value * 0.5);\n            this._projectionTextureProjectionLightDirty = true;\n            this.forceProjectionMatrixCompute();\n            this._computeAngleValues();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SpotLight.prototype, \"innerAngle\", {\n        /**\n         * Only used in gltf falloff mode, this defines the angle where\n         * the directional falloff will start before cutting at angle which could be seen\n         * as outer angle.\n         */\n        get: function () {\n            return this._innerAngle;\n        },\n        /**\n         * Only used in gltf falloff mode, this defines the angle where\n         * the directional falloff will start before cutting at angle which could be seen\n         * as outer angle.\n         */\n        set: function (value) {\n            this._innerAngle = value;\n            this._computeAngleValues();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SpotLight.prototype, \"shadowAngleScale\", {\n        /**\n         * Allows scaling the angle of the light for shadow generation only.\n         */\n        get: function () {\n            return this._shadowAngleScale;\n        },\n        /**\n         * Allows scaling the angle of the light for shadow generation only.\n         */\n        set: function (value) {\n            this._shadowAngleScale = value;\n            this.forceProjectionMatrixCompute();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SpotLight.prototype, \"projectionTextureMatrix\", {\n        /**\n         * Allows reading the projection texture\n         */\n        get: function () {\n            return this._projectionTextureMatrix;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SpotLight.prototype, \"projectionTextureLightNear\", {\n        /**\n         * Gets the near clip of the Spotlight for texture projection.\n         */\n        get: function () {\n            return this._projectionTextureLightNear;\n        },\n        /**\n         * Sets the near clip of the Spotlight for texture projection.\n         */\n        set: function (value) {\n            this._projectionTextureLightNear = value;\n            this._projectionTextureProjectionLightDirty = true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SpotLight.prototype, \"projectionTextureLightFar\", {\n        /**\n         * Gets the far clip of the Spotlight for texture projection.\n         */\n        get: function () {\n            return this._projectionTextureLightFar;\n        },\n        /**\n         * Sets the far clip of the Spotlight for texture projection.\n         */\n        set: function (value) {\n            this._projectionTextureLightFar = value;\n            this._projectionTextureProjectionLightDirty = true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SpotLight.prototype, \"projectionTextureUpDirection\", {\n        /**\n         * Gets the Up vector of the Spotlight for texture projection.\n         */\n        get: function () {\n            return this._projectionTextureUpDirection;\n        },\n        /**\n         * Sets the Up vector of the Spotlight for texture projection.\n         */\n        set: function (value) {\n            this._projectionTextureUpDirection = value;\n            this._projectionTextureProjectionLightDirty = true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SpotLight.prototype, \"projectionTexture\", {\n        /**\n         * Gets the projection texture of the light.\n         */\n        get: function () {\n            return this._projectionTexture;\n        },\n        /**\n         * Sets the projection texture of the light.\n         */\n        set: function (value) {\n            var _this = this;\n            if (this._projectionTexture === value) {\n                return;\n            }\n            this._projectionTexture = value;\n            this._projectionTextureDirty = true;\n            if (this._projectionTexture && !this._projectionTexture.isReady()) {\n                if (SpotLight._IsProceduralTexture(this._projectionTexture)) {\n                    this._projectionTexture.getEffect().executeWhenCompiled(function () {\n                        _this._markMeshesAsLightDirty();\n                    });\n                }\n                else if (SpotLight._IsTexture(this._projectionTexture)) {\n                    this._projectionTexture.onLoadObservable.addOnce(function () {\n                        _this._markMeshesAsLightDirty();\n                    });\n                }\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    SpotLight._IsProceduralTexture = function (texture) {\n        return texture.onGeneratedObservable !== undefined;\n    };\n    SpotLight._IsTexture = function (texture) {\n        return texture.onLoadObservable !== undefined;\n    };\n    Object.defineProperty(SpotLight.prototype, \"projectionTextureProjectionLightMatrix\", {\n        /**\n         * Gets or sets the light projection matrix as used by the projection texture\n         */\n        get: function () {\n            return this._projectionTextureProjectionLightMatrix;\n        },\n        set: function (projection) {\n            this._projectionTextureProjectionLightMatrix = projection;\n            this._projectionTextureProjectionLightDirty = false;\n            this._projectionTextureDirty = true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Returns the string \"SpotLight\".\n     * @returns the class name\n     */\n    SpotLight.prototype.getClassName = function () {\n        return \"SpotLight\";\n    };\n    /**\n     * Returns the integer 2.\n     * @returns The light Type id as a constant defines in Light.LIGHTTYPEID_x\n     */\n    SpotLight.prototype.getTypeID = function () {\n        return Light.LIGHTTYPEID_SPOTLIGHT;\n    };\n    /**\n     * Overrides the direction setter to recompute the projection texture view light Matrix.\n     * @param value\n     */\n    SpotLight.prototype._setDirection = function (value) {\n        _super.prototype._setDirection.call(this, value);\n        this._projectionTextureViewLightDirty = true;\n    };\n    /**\n     * Overrides the position setter to recompute the projection texture view light Matrix.\n     * @param value\n     */\n    SpotLight.prototype._setPosition = function (value) {\n        _super.prototype._setPosition.call(this, value);\n        this._projectionTextureViewLightDirty = true;\n    };\n    /**\n     * Sets the passed matrix \"matrix\" as perspective projection matrix for the shadows and the passed view matrix with the fov equal to the SpotLight angle and and aspect ratio of 1.0.\n     * Returns the SpotLight.\n     * @param matrix\n     * @param viewMatrix\n     * @param renderList\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    SpotLight.prototype._setDefaultShadowProjectionMatrix = function (matrix, viewMatrix, renderList) {\n        var activeCamera = this.getScene().activeCamera;\n        if (!activeCamera) {\n            return;\n        }\n        this._shadowAngleScale = this._shadowAngleScale || 1;\n        var angle = this._shadowAngleScale * this._angle;\n        var minZ = this.shadowMinZ !== undefined ? this.shadowMinZ : activeCamera.minZ;\n        var maxZ = this.shadowMaxZ !== undefined ? this.shadowMaxZ : activeCamera.maxZ;\n        var useReverseDepthBuffer = this.getScene().getEngine().useReverseDepthBuffer;\n        Matrix.PerspectiveFovLHToRef(angle, 1.0, useReverseDepthBuffer ? maxZ : minZ, useReverseDepthBuffer ? minZ : maxZ, matrix, true, this._scene.getEngine().isNDCHalfZRange, undefined, useReverseDepthBuffer);\n    };\n    SpotLight.prototype._computeProjectionTextureViewLightMatrix = function () {\n        this._projectionTextureViewLightDirty = false;\n        this._projectionTextureDirty = true;\n        this.position.addToRef(this.direction, this._projectionTextureViewTargetVector);\n        Matrix.LookAtLHToRef(this.position, this._projectionTextureViewTargetVector, this._projectionTextureUpDirection, this._projectionTextureViewLightMatrix);\n    };\n    SpotLight.prototype._computeProjectionTextureProjectionLightMatrix = function () {\n        this._projectionTextureProjectionLightDirty = false;\n        this._projectionTextureDirty = true;\n        var lightFar = this.projectionTextureLightFar;\n        var lightNear = this.projectionTextureLightNear;\n        var P = lightFar / (lightFar - lightNear);\n        var Q = -P * lightNear;\n        var S = 1.0 / Math.tan(this._angle / 2.0);\n        var A = 1.0;\n        Matrix.FromValuesToRef(S / A, 0.0, 0.0, 0.0, 0.0, S, 0.0, 0.0, 0.0, 0.0, P, 1.0, 0.0, 0.0, Q, 0.0, this._projectionTextureProjectionLightMatrix);\n    };\n    /**\n     * Main function for light texture projection matrix computing.\n     */\n    SpotLight.prototype._computeProjectionTextureMatrix = function () {\n        this._projectionTextureDirty = false;\n        this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix, this._projectionTextureMatrix);\n        if (this._projectionTexture instanceof Texture) {\n            var u = this._projectionTexture.uScale / 2.0;\n            var v = this._projectionTexture.vScale / 2.0;\n            Matrix.FromValuesToRef(u, 0.0, 0.0, 0.0, 0.0, v, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0, this._projectionTextureScalingMatrix);\n        }\n        this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix, this._projectionTextureMatrix);\n    };\n    SpotLight.prototype._buildUniformLayout = function () {\n        this._uniformBuffer.addUniform(\"vLightData\", 4);\n        this._uniformBuffer.addUniform(\"vLightDiffuse\", 4);\n        this._uniformBuffer.addUniform(\"vLightSpecular\", 4);\n        this._uniformBuffer.addUniform(\"vLightDirection\", 3);\n        this._uniformBuffer.addUniform(\"vLightFalloff\", 4);\n        this._uniformBuffer.addUniform(\"shadowsInfo\", 3);\n        this._uniformBuffer.addUniform(\"depthValues\", 2);\n        this._uniformBuffer.create();\n    };\n    SpotLight.prototype._computeAngleValues = function () {\n        this._lightAngleScale = 1.0 / Math.max(0.001, Math.cos(this._innerAngle * 0.5) - this._cosHalfAngle);\n        this._lightAngleOffset = -this._cosHalfAngle * this._lightAngleScale;\n    };\n    /**\n     * Sets the passed Effect \"effect\" with the Light textures.\n     * @param effect The effect to update\n     * @param lightIndex The index of the light in the effect to update\n     * @returns The light\n     */\n    SpotLight.prototype.transferTexturesToEffect = function (effect, lightIndex) {\n        if (this.projectionTexture && this.projectionTexture.isReady()) {\n            if (this._projectionTextureViewLightDirty) {\n                this._computeProjectionTextureViewLightMatrix();\n            }\n            if (this._projectionTextureProjectionLightDirty) {\n                this._computeProjectionTextureProjectionLightMatrix();\n            }\n            if (this._projectionTextureDirty) {\n                this._computeProjectionTextureMatrix();\n            }\n            effect.setMatrix(\"textureProjectionMatrix\" + lightIndex, this._projectionTextureMatrix);\n            effect.setTexture(\"projectionLightSampler\" + lightIndex, this.projectionTexture);\n        }\n        return this;\n    };\n    /**\n     * Sets the passed Effect object with the SpotLight transformed position (or position if not parented) and normalized direction.\n     * @param effect The effect to update\n     * @param lightIndex The index of the light in the effect to update\n     * @returns The spot light\n     */\n    SpotLight.prototype.transferToEffect = function (effect, lightIndex) {\n        var normalizeDirection;\n        if (this.computeTransformedInformation()) {\n            this._uniformBuffer.updateFloat4(\"vLightData\", this.transformedPosition.x, this.transformedPosition.y, this.transformedPosition.z, this.exponent, lightIndex);\n            normalizeDirection = Vector3.Normalize(this.transformedDirection);\n        }\n        else {\n            this._uniformBuffer.updateFloat4(\"vLightData\", this.position.x, this.position.y, this.position.z, this.exponent, lightIndex);\n            normalizeDirection = Vector3.Normalize(this.direction);\n        }\n        this._uniformBuffer.updateFloat4(\"vLightDirection\", normalizeDirection.x, normalizeDirection.y, normalizeDirection.z, this._cosHalfAngle, lightIndex);\n        this._uniformBuffer.updateFloat4(\"vLightFalloff\", this.range, this._inverseSquaredRange, this._lightAngleScale, this._lightAngleOffset, lightIndex);\n        return this;\n    };\n    SpotLight.prototype.transferToNodeMaterialEffect = function (effect, lightDataUniformName) {\n        var normalizeDirection;\n        if (this.computeTransformedInformation()) {\n            normalizeDirection = Vector3.Normalize(this.transformedDirection);\n        }\n        else {\n            normalizeDirection = Vector3.Normalize(this.direction);\n        }\n        if (this.getScene().useRightHandedSystem) {\n            effect.setFloat3(lightDataUniformName, -normalizeDirection.x, -normalizeDirection.y, -normalizeDirection.z);\n        }\n        else {\n            effect.setFloat3(lightDataUniformName, normalizeDirection.x, normalizeDirection.y, normalizeDirection.z);\n        }\n        return this;\n    };\n    /**\n     * Disposes the light and the associated resources.\n     */\n    SpotLight.prototype.dispose = function () {\n        _super.prototype.dispose.call(this);\n        if (this._projectionTexture) {\n            this._projectionTexture.dispose();\n        }\n    };\n    /**\n     * Gets the minZ used for shadow according to both the scene and the light.\n     * @param activeCamera The camera we are returning the min for\n     * @returns the depth min z\n     */\n    SpotLight.prototype.getDepthMinZ = function (activeCamera) {\n        var engine = this._scene.getEngine();\n        var minZ = this.shadowMinZ !== undefined ? this.shadowMinZ : activeCamera.minZ;\n        return engine.useReverseDepthBuffer && engine.isNDCHalfZRange ? minZ : this._scene.getEngine().isNDCHalfZRange ? 0 : minZ;\n    };\n    /**\n     * Gets the maxZ used for shadow according to both the scene and the light.\n     * @param activeCamera The camera we are returning the max for\n     * @returns the depth max z\n     */\n    SpotLight.prototype.getDepthMaxZ = function (activeCamera) {\n        var engine = this._scene.getEngine();\n        var maxZ = this.shadowMaxZ !== undefined ? this.shadowMaxZ : activeCamera.maxZ;\n        return engine.useReverseDepthBuffer && engine.isNDCHalfZRange ? 0 : maxZ;\n    };\n    /**\n     * Prepares the list of defines specific to the light type.\n     * @param defines the list of defines\n     * @param lightIndex defines the index of the light for the effect\n     */\n    SpotLight.prototype.prepareLightSpecificDefines = function (defines, lightIndex) {\n        defines[\"SPOTLIGHT\" + lightIndex] = true;\n        defines[\"PROJECTEDLIGHTTEXTURE\" + lightIndex] = this.projectionTexture && this.projectionTexture.isReady() ? true : false;\n    };\n    __decorate([\n        serialize()\n    ], SpotLight.prototype, \"angle\", null);\n    __decorate([\n        serialize()\n    ], SpotLight.prototype, \"innerAngle\", null);\n    __decorate([\n        serialize()\n    ], SpotLight.prototype, \"shadowAngleScale\", null);\n    __decorate([\n        serialize()\n    ], SpotLight.prototype, \"exponent\", void 0);\n    __decorate([\n        serialize()\n    ], SpotLight.prototype, \"projectionTextureLightNear\", null);\n    __decorate([\n        serialize()\n    ], SpotLight.prototype, \"projectionTextureLightFar\", null);\n    __decorate([\n        serialize()\n    ], SpotLight.prototype, \"projectionTextureUpDirection\", null);\n    __decorate([\n        serializeAsTexture(\"projectedLightTexture\")\n    ], SpotLight.prototype, \"_projectionTexture\", void 0);\n    return SpotLight;\n}(ShadowLight));\nexport { SpotLight };\n//# sourceMappingURL=spotLight.js.map","import { Engine } from \"../Engines/engine.js\";\n/**\n * Class used for the default loading screen\n * @see https://doc.babylonjs.com/how_to/creating_a_custom_loading_screen\n */\nvar DefaultLoadingScreen = /** @class */ (function () {\n    /**\n     * Creates a new default loading screen\n     * @param _renderingCanvas defines the canvas used to render the scene\n     * @param _loadingText defines the default text to display\n     * @param _loadingDivBackgroundColor defines the default background color\n     */\n    function DefaultLoadingScreen(_renderingCanvas, _loadingText, _loadingDivBackgroundColor) {\n        if (_loadingText === void 0) { _loadingText = \"\"; }\n        if (_loadingDivBackgroundColor === void 0) { _loadingDivBackgroundColor = \"black\"; }\n        var _this = this;\n        this._renderingCanvas = _renderingCanvas;\n        this._loadingText = _loadingText;\n        this._loadingDivBackgroundColor = _loadingDivBackgroundColor;\n        // Resize\n        this._resizeLoadingUI = function () {\n            var canvasRect = _this._renderingCanvas.getBoundingClientRect();\n            var canvasPositioning = window.getComputedStyle(_this._renderingCanvas).position;\n            if (!_this._loadingDiv) {\n                return;\n            }\n            _this._loadingDiv.style.position = canvasPositioning === \"fixed\" ? \"fixed\" : \"absolute\";\n            _this._loadingDiv.style.left = canvasRect.left + \"px\";\n            _this._loadingDiv.style.top = canvasRect.top + \"px\";\n            _this._loadingDiv.style.width = canvasRect.width + \"px\";\n            _this._loadingDiv.style.height = canvasRect.height + \"px\";\n        };\n    }\n    /**\n     * Function called to display the loading screen\n     */\n    DefaultLoadingScreen.prototype.displayLoadingUI = function () {\n        if (this._loadingDiv) {\n            // Do not add a loading screen if there is already one\n            return;\n        }\n        this._loadingDiv = document.createElement(\"div\");\n        this._loadingDiv.id = \"babylonjsLoadingDiv\";\n        this._loadingDiv.style.opacity = \"0\";\n        this._loadingDiv.style.transition = \"opacity 1.5s ease\";\n        this._loadingDiv.style.pointerEvents = \"none\";\n        this._loadingDiv.style.display = \"grid\";\n        this._loadingDiv.style.gridTemplateRows = \"100%\";\n        this._loadingDiv.style.gridTemplateColumns = \"100%\";\n        this._loadingDiv.style.justifyItems = \"center\";\n        this._loadingDiv.style.alignItems = \"center\";\n        // Loading text\n        this._loadingTextDiv = document.createElement(\"div\");\n        this._loadingTextDiv.style.position = \"absolute\";\n        this._loadingTextDiv.style.left = \"0\";\n        this._loadingTextDiv.style.top = \"50%\";\n        this._loadingTextDiv.style.marginTop = \"80px\";\n        this._loadingTextDiv.style.width = \"100%\";\n        this._loadingTextDiv.style.height = \"20px\";\n        this._loadingTextDiv.style.fontFamily = \"Arial\";\n        this._loadingTextDiv.style.fontSize = \"14px\";\n        this._loadingTextDiv.style.color = \"white\";\n        this._loadingTextDiv.style.textAlign = \"center\";\n        this._loadingTextDiv.style.zIndex = \"1\";\n        this._loadingTextDiv.innerHTML = \"Loading\";\n        this._loadingDiv.appendChild(this._loadingTextDiv);\n        //set the predefined text\n        this._loadingTextDiv.innerHTML = this._loadingText;\n        // Generating keyframes\n        this._style = document.createElement(\"style\");\n        this._style.type = \"text/css\";\n        var keyFrames = \"@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\\n                    100% { -webkit-transform: rotate(360deg);}\\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\\n                    100% { transform: rotate(360deg);}\\n                }\";\n        this._style.innerHTML = keyFrames;\n        document.getElementsByTagName(\"head\")[0].appendChild(this._style);\n        var svgSupport = !!window.SVGSVGElement;\n        // Loading img\n        var imgBack = new Image();\n        if (!DefaultLoadingScreen.DefaultLogoUrl) {\n            imgBack.src = !svgSupport\n                ? \"https://cdn.babylonjs.com/Assets/babylonLogo.png\"\n                : \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+\";\n        }\n        else {\n            imgBack.src = DefaultLoadingScreen.DefaultLogoUrl;\n        }\n        imgBack.style.width = \"150px\";\n        imgBack.style.gridColumn = \"1\";\n        imgBack.style.gridRow = \"1\";\n        imgBack.style.top = \"50%\";\n        imgBack.style.left = \"50%\";\n        imgBack.style.transform = \"translate(-50%, -50%)\";\n        imgBack.style.position = \"absolute\";\n        var imageSpinnerContainer = document.createElement(\"div\");\n        imageSpinnerContainer.style.width = \"300px\";\n        imageSpinnerContainer.style.gridColumn = \"1\";\n        imageSpinnerContainer.style.gridRow = \"1\";\n        imageSpinnerContainer.style.top = \"50%\";\n        imageSpinnerContainer.style.left = \"50%\";\n        imageSpinnerContainer.style.transform = \"translate(-50%, -50%)\";\n        imageSpinnerContainer.style.position = \"absolute\";\n        // Loading spinner\n        var imgSpinner = new Image();\n        if (!DefaultLoadingScreen.DefaultSpinnerUrl) {\n            imgSpinner.src = !svgSupport\n                ? \"https://cdn.babylonjs.com/Assets/loadingIcon.png\"\n                : \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==\";\n        }\n        else {\n            imgSpinner.src = DefaultLoadingScreen.DefaultSpinnerUrl;\n        }\n        imgSpinner.style.animation = \"spin1 0.75s infinite linear\";\n        imgSpinner.style.webkitAnimation = \"spin1 0.75s infinite linear\";\n        imgSpinner.style.transformOrigin = \"50% 50%\";\n        imgSpinner.style.webkitTransformOrigin = \"50% 50%\";\n        if (!svgSupport) {\n            var logoSize = { w: 16, h: 18.5 };\n            var loadingSize = { w: 30, h: 30 };\n            // set styling correctly\n            imgBack.style.width = \"\".concat(logoSize.w, \"vh\");\n            imgBack.style.height = \"\".concat(logoSize.h, \"vh\");\n            imgBack.style.left = \"calc(50% - \".concat(logoSize.w / 2, \"vh)\");\n            imgBack.style.top = \"calc(50% - \".concat(logoSize.h / 2, \"vh)\");\n            imgSpinner.style.width = \"\".concat(loadingSize.w, \"vh\");\n            imgSpinner.style.height = \"\".concat(loadingSize.h, \"vh\");\n            imgSpinner.style.left = \"calc(50% - \".concat(loadingSize.w / 2, \"vh)\");\n            imgSpinner.style.top = \"calc(50% - \".concat(loadingSize.h / 2, \"vh)\");\n        }\n        imageSpinnerContainer.appendChild(imgSpinner);\n        this._loadingDiv.appendChild(imgBack);\n        this._loadingDiv.appendChild(imageSpinnerContainer);\n        this._resizeLoadingUI();\n        window.addEventListener(\"resize\", this._resizeLoadingUI);\n        this._loadingDiv.style.backgroundColor = this._loadingDivBackgroundColor;\n        document.body.appendChild(this._loadingDiv);\n        this._loadingDiv.style.opacity = \"1\";\n    };\n    /**\n     * Function called to hide the loading screen\n     */\n    DefaultLoadingScreen.prototype.hideLoadingUI = function () {\n        var _this = this;\n        if (!this._loadingDiv) {\n            return;\n        }\n        var onTransitionEnd = function () {\n            if (_this._loadingDiv) {\n                if (_this._loadingDiv.parentElement) {\n                    _this._loadingDiv.parentElement.removeChild(_this._loadingDiv);\n                }\n                _this._loadingDiv = null;\n            }\n            if (_this._style) {\n                if (_this._style.parentElement) {\n                    _this._style.parentElement.removeChild(_this._style);\n                }\n                _this._style = null;\n            }\n            window.removeEventListener(\"resize\", _this._resizeLoadingUI);\n        };\n        this._loadingDiv.style.opacity = \"0\";\n        this._loadingDiv.addEventListener(\"transitionend\", onTransitionEnd);\n    };\n    Object.defineProperty(DefaultLoadingScreen.prototype, \"loadingUIText\", {\n        get: function () {\n            return this._loadingText;\n        },\n        /**\n         * Gets or sets the text to display while loading\n         */\n        set: function (text) {\n            this._loadingText = text;\n            if (this._loadingTextDiv) {\n                this._loadingTextDiv.innerHTML = this._loadingText;\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DefaultLoadingScreen.prototype, \"loadingUIBackgroundColor\", {\n        /**\n         * Gets or sets the color to use for the background\n         */\n        get: function () {\n            return this._loadingDivBackgroundColor;\n        },\n        set: function (color) {\n            this._loadingDivBackgroundColor = color;\n            if (!this._loadingDiv) {\n                return;\n            }\n            this._loadingDiv.style.backgroundColor = this._loadingDivBackgroundColor;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /** Gets or sets the logo url to use for the default loading screen */\n    DefaultLoadingScreen.DefaultLogoUrl = \"\";\n    /** Gets or sets the spinner url to use for the default loading screen */\n    DefaultLoadingScreen.DefaultSpinnerUrl = \"\";\n    return DefaultLoadingScreen;\n}());\nexport { DefaultLoadingScreen };\nEngine.DefaultLoadingScreenFactory = function (canvas) {\n    return new DefaultLoadingScreen(canvas);\n};\n//# sourceMappingURL=loadingScreen.js.map","import { Logger } from \"../../Misc/logger.js\";\nimport { Camera } from \"../../Cameras/camera.js\";\nimport { Vector3 } from \"../../Maths/math.vector.js\";\nimport { Color3, Color4 } from \"../../Maths/math.color.js\";\nimport { Mesh } from \"../../Meshes/mesh.js\";\nimport { Geometry } from \"../../Meshes/geometry.js\";\nimport { TransformNode } from \"../../Meshes/transformNode.js\";\nimport { Material } from \"../../Materials/material.js\";\nimport { MultiMaterial } from \"../../Materials/multiMaterial.js\";\nimport { CubeTexture } from \"../../Materials/Textures/cubeTexture.js\";\nimport { HDRCubeTexture } from \"../../Materials/Textures/hdrCubeTexture.js\";\nimport { AnimationGroup } from \"../../Animations/animationGroup.js\";\nimport { Light } from \"../../Lights/light.js\";\nimport { SceneComponentConstants } from \"../../sceneComponent.js\";\nimport { SceneLoader } from \"../../Loading/sceneLoader.js\";\nimport { AbstractScene } from \"../../abstractScene.js\";\nimport { AssetContainer } from \"../../assetContainer.js\";\nimport { ActionManager } from \"../../Actions/actionManager.js\";\nimport { Skeleton } from \"../../Bones/skeleton.js\";\nimport { MorphTargetManager } from \"../../Morph/morphTargetManager.js\";\nimport { CannonJSPlugin } from \"../../Physics/Plugins/cannonJSPlugin.js\";\nimport { OimoJSPlugin } from \"../../Physics/Plugins/oimoJSPlugin.js\";\nimport { AmmoJSPlugin } from \"../../Physics/Plugins/ammoJSPlugin.js\";\nimport { ReflectionProbe } from \"../../Probes/reflectionProbe.js\";\nimport { GetClass } from \"../../Misc/typeStore.js\";\nimport { Tools } from \"../../Misc/tools.js\";\nimport { PostProcess } from \"../../PostProcesses/postProcess.js\";\n/** @hidden */\n// eslint-disable-next-line @typescript-eslint/naming-convention, no-var\nexport var _BabylonLoaderRegistered = true;\n/**\n * Helps setting up some configuration for the babylon file loader.\n */\nvar BabylonFileLoaderConfiguration = /** @class */ (function () {\n    function BabylonFileLoaderConfiguration() {\n    }\n    /**\n     * The loader does not allow injecting custom physics engine into the plugins.\n     * Unfortunately in ES6, we need to manually inject them into the plugin.\n     * So you could set this variable to your engine import to make it work.\n     */\n    BabylonFileLoaderConfiguration.LoaderInjectedPhysicsEngine = undefined;\n    return BabylonFileLoaderConfiguration;\n}());\nexport { BabylonFileLoaderConfiguration };\nvar tempIndexContainer = {};\nvar tempMaterialIndexContainer = {};\nvar parseMaterialByPredicate = function (predicate, parsedData, scene, rootUrl) {\n    if (!parsedData.materials) {\n        return null;\n    }\n    for (var index = 0, cache = parsedData.materials.length; index < cache; index++) {\n        var parsedMaterial = parsedData.materials[index];\n        if (predicate(parsedMaterial)) {\n            return { parsedMaterial: parsedMaterial, material: Material.Parse(parsedMaterial, scene, rootUrl) };\n        }\n    }\n    return null;\n};\nvar isDescendantOf = function (mesh, names, hierarchyIds) {\n    for (var i in names) {\n        if (mesh.name === names[i]) {\n            hierarchyIds.push(mesh.id);\n            return true;\n        }\n    }\n    if (mesh.parentId !== undefined && hierarchyIds.indexOf(mesh.parentId) !== -1) {\n        hierarchyIds.push(mesh.id);\n        return true;\n    }\n    return false;\n};\n// eslint-disable-next-line @typescript-eslint/naming-convention\nvar logOperation = function (operation, producer) {\n    return (operation +\n        \" of \" +\n        (producer ? producer.file + \" from \" + producer.name + \" version: \" + producer.version + \", exporter version: \" + producer.exporter_version : \"unknown\"));\n};\nvar loadDetailLevels = function (scene, mesh) {\n    var mastermesh = mesh;\n    // Every value specified in the ids array of the lod data points to another mesh which should be used as the lower LOD level.\n    // The distances (or coverages) array values specified are used along with the lod mesh ids as a hint to determine the switching threshold for the various LODs.\n    if (mesh._waitingData.lods) {\n        if (mesh._waitingData.lods.ids && mesh._waitingData.lods.ids.length > 0) {\n            var lodmeshes = mesh._waitingData.lods.ids;\n            var wasenabled = mastermesh.isEnabled(false);\n            if (mesh._waitingData.lods.distances) {\n                var distances = mesh._waitingData.lods.distances;\n                if (distances.length >= lodmeshes.length) {\n                    var culling = distances.length > lodmeshes.length ? distances[distances.length - 1] : 0;\n                    mastermesh.setEnabled(false);\n                    for (var index = 0; index < lodmeshes.length; index++) {\n                        var lodid = lodmeshes[index];\n                        var lodmesh = scene.getMeshById(lodid);\n                        if (lodmesh != null) {\n                            mastermesh.addLODLevel(distances[index], lodmesh);\n                        }\n                    }\n                    if (culling > 0) {\n                        mastermesh.addLODLevel(culling, null);\n                    }\n                    if (wasenabled === true) {\n                        mastermesh.setEnabled(true);\n                    }\n                }\n                else {\n                    Tools.Warn(\"Invalid level of detail distances for \" + mesh.name);\n                }\n            }\n        }\n        mesh._waitingData.lods = null;\n    }\n};\nvar findParent = function (parentId, scene) {\n    if (typeof parentId !== \"number\") {\n        return scene.getLastEntryById(parentId);\n    }\n    var parent = tempIndexContainer[parentId];\n    return parent;\n};\nvar findMaterial = function (materialId, scene) {\n    if (typeof materialId !== \"number\") {\n        return scene.getLastMaterialById(materialId, true);\n    }\n    return tempMaterialIndexContainer[materialId];\n};\nvar loadAssetContainer = function (scene, data, rootUrl, onError, addToScene) {\n    if (addToScene === void 0) { addToScene = false; }\n    var container = new AssetContainer(scene);\n    // Entire method running in try block, so ALWAYS logs as far as it got, only actually writes details\n    // when SceneLoader.debugLogging = true (default), or exception encountered.\n    // Everything stored in var log instead of writing separate lines to support only writing in exception,\n    // and avoid problems with multiple concurrent .babylon loads.\n    var log = \"importScene has failed JSON parse\";\n    try {\n        // eslint-disable-next-line no-var\n        var parsedData = JSON.parse(data);\n        log = \"\";\n        var fullDetails = SceneLoader.loggingLevel === SceneLoader.DETAILED_LOGGING;\n        var index = void 0;\n        var cache = void 0;\n        // Environment texture\n        if (parsedData.environmentTexture !== undefined && parsedData.environmentTexture !== null) {\n            // PBR needed for both HDR texture (gamma space) & a sky box\n            var isPBR = parsedData.isPBR !== undefined ? parsedData.isPBR : true;\n            if (parsedData.environmentTextureType && parsedData.environmentTextureType === \"BABYLON.HDRCubeTexture\") {\n                var hdrSize = parsedData.environmentTextureSize ? parsedData.environmentTextureSize : 128;\n                var hdrTexture = new HDRCubeTexture((parsedData.environmentTexture.match(/https?:\\/\\//g) ? \"\" : rootUrl) + parsedData.environmentTexture, scene, hdrSize, true, !isPBR, undefined, parsedData.environmentTexturePrefilterOnLoad);\n                if (parsedData.environmentTextureRotationY) {\n                    hdrTexture.rotationY = parsedData.environmentTextureRotationY;\n                }\n                scene.environmentTexture = hdrTexture;\n            }\n            else {\n                if (typeof parsedData.environmentTexture === \"object\") {\n                    var environmentTexture = CubeTexture.Parse(parsedData.environmentTexture, scene, rootUrl);\n                    scene.environmentTexture = environmentTexture;\n                }\n                else if (parsedData.environmentTexture.endsWith(\".env\")) {\n                    var compressedTexture = new CubeTexture((parsedData.environmentTexture.match(/https?:\\/\\//g) ? \"\" : rootUrl) + parsedData.environmentTexture, scene, parsedData.environmentTextureForcedExtension);\n                    if (parsedData.environmentTextureRotationY) {\n                        compressedTexture.rotationY = parsedData.environmentTextureRotationY;\n                    }\n                    scene.environmentTexture = compressedTexture;\n                }\n                else {\n                    var cubeTexture = CubeTexture.CreateFromPrefilteredData((parsedData.environmentTexture.match(/https?:\\/\\//g) ? \"\" : rootUrl) + parsedData.environmentTexture, scene, parsedData.environmentTextureForcedExtension);\n                    if (parsedData.environmentTextureRotationY) {\n                        cubeTexture.rotationY = parsedData.environmentTextureRotationY;\n                    }\n                    scene.environmentTexture = cubeTexture;\n                }\n            }\n            if (parsedData.createDefaultSkybox === true) {\n                var skyboxScale = scene.activeCamera !== undefined && scene.activeCamera !== null ? (scene.activeCamera.maxZ - scene.activeCamera.minZ) / 2 : 1000;\n                var skyboxBlurLevel = parsedData.skyboxBlurLevel || 0;\n                scene.createDefaultSkybox(scene.environmentTexture, isPBR, skyboxScale, skyboxBlurLevel);\n            }\n            container.environmentTexture = scene.environmentTexture;\n        }\n        // Environment Intensity\n        if (parsedData.environmentIntensity !== undefined && parsedData.environmentIntensity !== null) {\n            scene.environmentIntensity = parsedData.environmentIntensity;\n        }\n        // Lights\n        if (parsedData.lights !== undefined && parsedData.lights !== null) {\n            for (index = 0, cache = parsedData.lights.length; index < cache; index++) {\n                var parsedLight = parsedData.lights[index];\n                var light = Light.Parse(parsedLight, scene);\n                if (light) {\n                    tempIndexContainer[parsedLight.uniqueId] = light;\n                    container.lights.push(light);\n                    light._parentContainer = container;\n                    log += index === 0 ? \"\\n\\tLights:\" : \"\";\n                    log += \"\\n\\t\\t\" + light.toString(fullDetails);\n                }\n            }\n        }\n        // Reflection probes\n        if (parsedData.reflectionProbes !== undefined && parsedData.reflectionProbes !== null) {\n            for (index = 0, cache = parsedData.reflectionProbes.length; index < cache; index++) {\n                var parsedReflectionProbe = parsedData.reflectionProbes[index];\n                var reflectionProbe = ReflectionProbe.Parse(parsedReflectionProbe, scene, rootUrl);\n                if (reflectionProbe) {\n                    container.reflectionProbes.push(reflectionProbe);\n                    reflectionProbe._parentContainer = container;\n                    log += index === 0 ? \"\\n\\tReflection Probes:\" : \"\";\n                    log += \"\\n\\t\\t\" + reflectionProbe.toString(fullDetails);\n                }\n            }\n        }\n        // Animations\n        if (parsedData.animations !== undefined && parsedData.animations !== null) {\n            for (index = 0, cache = parsedData.animations.length; index < cache; index++) {\n                var parsedAnimation = parsedData.animations[index];\n                var internalClass = GetClass(\"BABYLON.Animation\");\n                if (internalClass) {\n                    var animation = internalClass.Parse(parsedAnimation);\n                    scene.animations.push(animation);\n                    container.animations.push(animation);\n                    log += index === 0 ? \"\\n\\tAnimations:\" : \"\";\n                    log += \"\\n\\t\\t\" + animation.toString(fullDetails);\n                }\n            }\n        }\n        // Materials\n        if (parsedData.materials !== undefined && parsedData.materials !== null) {\n            for (index = 0, cache = parsedData.materials.length; index < cache; index++) {\n                var parsedMaterial = parsedData.materials[index];\n                var mat = Material.Parse(parsedMaterial, scene, rootUrl);\n                if (mat) {\n                    tempMaterialIndexContainer[parsedMaterial.uniqueId || parsedMaterial.id] = mat;\n                    container.materials.push(mat);\n                    mat._parentContainer = container;\n                    log += index === 0 ? \"\\n\\tMaterials:\" : \"\";\n                    log += \"\\n\\t\\t\" + mat.toString(fullDetails);\n                    // Textures\n                    var textures = mat.getActiveTextures();\n                    textures.forEach(function (t) {\n                        if (container.textures.indexOf(t) == -1) {\n                            container.textures.push(t);\n                            t._parentContainer = container;\n                        }\n                    });\n                }\n            }\n        }\n        if (parsedData.multiMaterials !== undefined && parsedData.multiMaterials !== null) {\n            for (index = 0, cache = parsedData.multiMaterials.length; index < cache; index++) {\n                var parsedMultiMaterial = parsedData.multiMaterials[index];\n                var mmat = MultiMaterial.ParseMultiMaterial(parsedMultiMaterial, scene);\n                tempMaterialIndexContainer[parsedMultiMaterial.uniqueId || parsedMultiMaterial.id] = mmat;\n                container.multiMaterials.push(mmat);\n                mmat._parentContainer = container;\n                log += index === 0 ? \"\\n\\tMultiMaterials:\" : \"\";\n                log += \"\\n\\t\\t\" + mmat.toString(fullDetails);\n                // Textures\n                var textures = mmat.getActiveTextures();\n                textures.forEach(function (t) {\n                    if (container.textures.indexOf(t) == -1) {\n                        container.textures.push(t);\n                        t._parentContainer = container;\n                    }\n                });\n            }\n        }\n        // Morph targets\n        if (parsedData.morphTargetManagers !== undefined && parsedData.morphTargetManagers !== null) {\n            for (var _i = 0, _a = parsedData.morphTargetManagers; _i < _a.length; _i++) {\n                var managerData = _a[_i];\n                var manager = MorphTargetManager.Parse(managerData, scene);\n                container.morphTargetManagers.push(manager);\n                manager._parentContainer = container;\n            }\n        }\n        // Skeletons\n        if (parsedData.skeletons !== undefined && parsedData.skeletons !== null) {\n            for (index = 0, cache = parsedData.skeletons.length; index < cache; index++) {\n                var parsedSkeleton = parsedData.skeletons[index];\n                var skeleton = Skeleton.Parse(parsedSkeleton, scene);\n                container.skeletons.push(skeleton);\n                skeleton._parentContainer = container;\n                log += index === 0 ? \"\\n\\tSkeletons:\" : \"\";\n                log += \"\\n\\t\\t\" + skeleton.toString(fullDetails);\n            }\n        }\n        // Geometries\n        var geometries = parsedData.geometries;\n        if (geometries !== undefined && geometries !== null) {\n            var addedGeometry = new Array();\n            // VertexData\n            var vertexData = geometries.vertexData;\n            if (vertexData !== undefined && vertexData !== null) {\n                for (index = 0, cache = vertexData.length; index < cache; index++) {\n                    var parsedVertexData = vertexData[index];\n                    addedGeometry.push(Geometry.Parse(parsedVertexData, scene, rootUrl));\n                }\n            }\n            addedGeometry.forEach(function (g) {\n                if (g) {\n                    container.geometries.push(g);\n                    g._parentContainer = container;\n                }\n            });\n        }\n        // Transform nodes\n        if (parsedData.transformNodes !== undefined && parsedData.transformNodes !== null) {\n            for (index = 0, cache = parsedData.transformNodes.length; index < cache; index++) {\n                var parsedTransformNode = parsedData.transformNodes[index];\n                var node = TransformNode.Parse(parsedTransformNode, scene, rootUrl);\n                tempIndexContainer[parsedTransformNode.uniqueId] = node;\n                container.transformNodes.push(node);\n                node._parentContainer = container;\n            }\n        }\n        // Meshes\n        if (parsedData.meshes !== undefined && parsedData.meshes !== null) {\n            for (index = 0, cache = parsedData.meshes.length; index < cache; index++) {\n                var parsedMesh = parsedData.meshes[index];\n                var mesh = Mesh.Parse(parsedMesh, scene, rootUrl);\n                tempIndexContainer[parsedMesh.uniqueId] = mesh;\n                container.meshes.push(mesh);\n                mesh._parentContainer = container;\n                if (mesh.hasInstances) {\n                    for (var _b = 0, _c = mesh.instances; _b < _c.length; _b++) {\n                        var instance = _c[_b];\n                        container.meshes.push(instance);\n                        instance._parentContainer = container;\n                    }\n                }\n                log += index === 0 ? \"\\n\\tMeshes:\" : \"\";\n                log += \"\\n\\t\\t\" + mesh.toString(fullDetails);\n            }\n        }\n        // Cameras\n        if (parsedData.cameras !== undefined && parsedData.cameras !== null) {\n            for (index = 0, cache = parsedData.cameras.length; index < cache; index++) {\n                var parsedCamera = parsedData.cameras[index];\n                var camera = Camera.Parse(parsedCamera, scene);\n                tempIndexContainer[parsedCamera.uniqueId] = camera;\n                container.cameras.push(camera);\n                camera._parentContainer = container;\n                log += index === 0 ? \"\\n\\tCameras:\" : \"\";\n                log += \"\\n\\t\\t\" + camera.toString(fullDetails);\n            }\n        }\n        // Postprocesses\n        if (parsedData.postProcesses !== undefined && parsedData.postProcesses !== null) {\n            for (index = 0, cache = parsedData.postProcesses.length; index < cache; index++) {\n                var parsedPostProcess = parsedData.postProcesses[index];\n                var postProcess = PostProcess.Parse(parsedPostProcess, scene, rootUrl);\n                if (postProcess) {\n                    container.postProcesses.push(postProcess);\n                    postProcess._parentContainer = container;\n                    log += index === 0 ? \"\\nPostprocesses:\" : \"\";\n                    log += \"\\n\\t\\t\" + postProcess.toString();\n                }\n            }\n        }\n        // Animation Groups\n        if (parsedData.animationGroups !== undefined && parsedData.animationGroups !== null) {\n            for (index = 0, cache = parsedData.animationGroups.length; index < cache; index++) {\n                var parsedAnimationGroup = parsedData.animationGroups[index];\n                var animationGroup = AnimationGroup.Parse(parsedAnimationGroup, scene);\n                container.animationGroups.push(animationGroup);\n                animationGroup._parentContainer = container;\n                log += index === 0 ? \"\\n\\tAnimationGroups:\" : \"\";\n                log += \"\\n\\t\\t\" + animationGroup.toString(fullDetails);\n            }\n        }\n        // Browsing all the graph to connect the dots\n        for (index = 0, cache = scene.cameras.length; index < cache; index++) {\n            var camera = scene.cameras[index];\n            if (camera._waitingParentId !== null) {\n                camera.parent = findParent(camera._waitingParentId, scene);\n                camera._waitingParentId = null;\n            }\n        }\n        for (index = 0, cache = scene.lights.length; index < cache; index++) {\n            var light = scene.lights[index];\n            if (light && light._waitingParentId !== null) {\n                light.parent = findParent(light._waitingParentId, scene);\n                light._waitingParentId = null;\n            }\n        }\n        // Connect parents & children and parse actions and lods\n        for (index = 0, cache = scene.transformNodes.length; index < cache; index++) {\n            var transformNode = scene.transformNodes[index];\n            if (transformNode._waitingParentId !== null) {\n                transformNode.parent = findParent(transformNode._waitingParentId, scene);\n                transformNode._waitingParentId = null;\n            }\n        }\n        for (index = 0, cache = scene.meshes.length; index < cache; index++) {\n            var mesh = scene.meshes[index];\n            if (mesh._waitingParentId !== null) {\n                mesh.parent = findParent(mesh._waitingParentId, scene);\n                mesh._waitingParentId = null;\n            }\n            if (mesh._waitingData.lods) {\n                loadDetailLevels(scene, mesh);\n            }\n        }\n        // link multimats with materials\n        scene.multiMaterials.forEach(function (multimat) {\n            multimat._waitingSubMaterialsUniqueIds.forEach(function (subMaterial) {\n                multimat.subMaterials.push(findMaterial(subMaterial, scene));\n            });\n            multimat._waitingSubMaterialsUniqueIds = [];\n        });\n        // link meshes with materials\n        scene.meshes.forEach(function (mesh) {\n            if (mesh._waitingMaterialId !== null) {\n                mesh.material = findMaterial(mesh._waitingMaterialId, scene);\n                mesh._waitingMaterialId = null;\n            }\n        });\n        // link skeleton transform nodes\n        for (index = 0, cache = scene.skeletons.length; index < cache; index++) {\n            var skeleton = scene.skeletons[index];\n            if (skeleton._hasWaitingData) {\n                if (skeleton.bones != null) {\n                    skeleton.bones.forEach(function (bone) {\n                        if (bone._waitingTransformNodeId) {\n                            var linkTransformNode = scene.getLastEntryById(bone._waitingTransformNodeId);\n                            if (linkTransformNode) {\n                                bone.linkTransformNode(linkTransformNode);\n                            }\n                            bone._waitingTransformNodeId = null;\n                        }\n                    });\n                }\n                skeleton._hasWaitingData = null;\n            }\n        }\n        // freeze world matrix application\n        for (index = 0, cache = scene.meshes.length; index < cache; index++) {\n            var currentMesh = scene.meshes[index];\n            if (currentMesh._waitingData.freezeWorldMatrix) {\n                currentMesh.freezeWorldMatrix();\n                currentMesh._waitingData.freezeWorldMatrix = null;\n            }\n            else {\n                currentMesh.computeWorldMatrix(true);\n            }\n        }\n        // Lights exclusions / inclusions\n        for (index = 0, cache = scene.lights.length; index < cache; index++) {\n            var light = scene.lights[index];\n            // Excluded check\n            if (light._excludedMeshesIds.length > 0) {\n                for (var excludedIndex = 0; excludedIndex < light._excludedMeshesIds.length; excludedIndex++) {\n                    var excludedMesh = scene.getMeshById(light._excludedMeshesIds[excludedIndex]);\n                    if (excludedMesh) {\n                        light.excludedMeshes.push(excludedMesh);\n                    }\n                }\n                light._excludedMeshesIds = [];\n            }\n            // Included check\n            if (light._includedOnlyMeshesIds.length > 0) {\n                for (var includedOnlyIndex = 0; includedOnlyIndex < light._includedOnlyMeshesIds.length; includedOnlyIndex++) {\n                    var includedOnlyMesh = scene.getMeshById(light._includedOnlyMeshesIds[includedOnlyIndex]);\n                    if (includedOnlyMesh) {\n                        light.includedOnlyMeshes.push(includedOnlyMesh);\n                    }\n                }\n                light._includedOnlyMeshesIds = [];\n            }\n        }\n        AbstractScene.Parse(parsedData, scene, container, rootUrl);\n        // Actions (scene) Done last as it can access other objects.\n        for (index = 0, cache = scene.meshes.length; index < cache; index++) {\n            var mesh = scene.meshes[index];\n            if (mesh._waitingData.actions) {\n                ActionManager.Parse(mesh._waitingData.actions, mesh, scene);\n                mesh._waitingData.actions = null;\n            }\n        }\n        if (parsedData.actions !== undefined && parsedData.actions !== null) {\n            ActionManager.Parse(parsedData.actions, null, scene);\n        }\n    }\n    catch (err) {\n        var msg = logOperation(\"loadAssets\", parsedData ? parsedData.producer : \"Unknown\") + log;\n        if (onError) {\n            onError(msg, err);\n        }\n        else {\n            Logger.Log(msg);\n            throw err;\n        }\n    }\n    finally {\n        tempIndexContainer = {};\n        tempMaterialIndexContainer = {};\n        if (!addToScene) {\n            container.removeAllFromScene();\n        }\n        if (log !== null && SceneLoader.loggingLevel !== SceneLoader.NO_LOGGING) {\n            Logger.Log(logOperation(\"loadAssets\", parsedData ? parsedData.producer : \"Unknown\") + (SceneLoader.loggingLevel !== SceneLoader.MINIMAL_LOGGING ? log : \"\"));\n        }\n    }\n    return container;\n};\nSceneLoader.RegisterPlugin({\n    name: \"babylon.js\",\n    extensions: \".babylon\",\n    canDirectLoad: function (data) {\n        if (data.indexOf(\"babylon\") !== -1) {\n            // We consider that the producer string is filled\n            return true;\n        }\n        return false;\n    },\n    importMesh: function (meshesNames, scene, data, rootUrl, meshes, particleSystems, skeletons, onError) {\n        var _a;\n        // Entire method running in try block, so ALWAYS logs as far as it got, only actually writes details\n        // when SceneLoader.debugLogging = true (default), or exception encountered.\n        // Everything stored in var log instead of writing separate lines to support only writing in exception,\n        // and avoid problems with multiple concurrent .babylon loads.\n        var log = \"importMesh has failed JSON parse\";\n        try {\n            // eslint-disable-next-line no-var\n            var parsedData = JSON.parse(data);\n            log = \"\";\n            var fullDetails_1 = SceneLoader.loggingLevel === SceneLoader.DETAILED_LOGGING;\n            if (!meshesNames) {\n                meshesNames = null;\n            }\n            else if (!Array.isArray(meshesNames)) {\n                meshesNames = [meshesNames];\n            }\n            var hierarchyIds = new Array();\n            // Transform nodes (the overall idea is to load all of them as this is super fast and then get rid of the ones we don't need)\n            var loadedTransformNodes = [];\n            if (parsedData.transformNodes !== undefined && parsedData.transformNodes !== null) {\n                for (var index = 0, cache = parsedData.transformNodes.length; index < cache; index++) {\n                    var parsedTransformNode = parsedData.transformNodes[index];\n                    loadedTransformNodes.push(TransformNode.Parse(parsedTransformNode, scene, rootUrl));\n                }\n            }\n            if (parsedData.meshes !== undefined && parsedData.meshes !== null) {\n                var loadedSkeletonsIds = [];\n                var loadedMaterialsIds = [];\n                var loadedMaterialsUniqueIds = [];\n                var loadedMorphTargetsIds = [];\n                var _loop_1 = function (index, cache) {\n                    var parsedMesh = parsedData.meshes[index];\n                    if (meshesNames === null || isDescendantOf(parsedMesh, meshesNames, hierarchyIds)) {\n                        if (meshesNames !== null) {\n                            // Remove found mesh name from list.\n                            delete meshesNames[meshesNames.indexOf(parsedMesh.name)];\n                        }\n                        //Geometry?\n                        if (parsedMesh.geometryId !== undefined && parsedMesh.geometryId !== null) {\n                            //does the file contain geometries?\n                            if (parsedData.geometries !== undefined && parsedData.geometries !== null) {\n                                //find the correct geometry and add it to the scene\n                                var found_1 = false;\n                                [\"boxes\", \"spheres\", \"cylinders\", \"toruses\", \"grounds\", \"planes\", \"torusKnots\", \"vertexData\"].forEach(function (geometryType) {\n                                    if (found_1 === true || !parsedData.geometries[geometryType] || !Array.isArray(parsedData.geometries[geometryType])) {\n                                        return;\n                                    }\n                                    else {\n                                        parsedData.geometries[geometryType].forEach(function (parsedGeometryData) {\n                                            if (parsedGeometryData.id === parsedMesh.geometryId) {\n                                                switch (geometryType) {\n                                                    case \"vertexData\":\n                                                        Geometry.Parse(parsedGeometryData, scene, rootUrl);\n                                                        break;\n                                                }\n                                                found_1 = true;\n                                            }\n                                        });\n                                    }\n                                });\n                                if (found_1 === false) {\n                                    Logger.Warn(\"Geometry not found for mesh \" + parsedMesh.id);\n                                }\n                            }\n                        }\n                        // Material ?\n                        if (parsedMesh.materialUniqueId || parsedMesh.materialId) {\n                            // if we have a unique ID, look up and store in loadedMaterialsUniqueIds, else use loadedMaterialsIds\n                            var materialArray_1 = parsedMesh.materialUniqueId ? loadedMaterialsUniqueIds : loadedMaterialsIds;\n                            var materialFound = materialArray_1.indexOf(parsedMesh.materialUniqueId || parsedMesh.materialId) !== -1;\n                            if (materialFound === false && parsedData.multiMaterials !== undefined && parsedData.multiMaterials !== null) {\n                                // Loads a submaterial of a multimaterial\n                                var loadSubMaterial_1 = function (subMatId, predicate) {\n                                    materialArray_1.push(subMatId);\n                                    var mat = parseMaterialByPredicate(predicate, parsedData, scene, rootUrl);\n                                    if (mat && mat.material) {\n                                        tempMaterialIndexContainer[mat.parsedMaterial.uniqueId || mat.parsedMaterial.id] = mat.material;\n                                        log += \"\\n\\tMaterial \" + mat.material.toString(fullDetails_1);\n                                    }\n                                };\n                                for (var multimatIndex = 0, multimatCache = parsedData.multiMaterials.length; multimatIndex < multimatCache; multimatIndex++) {\n                                    var parsedMultiMaterial = parsedData.multiMaterials[multimatIndex];\n                                    if ((parsedMesh.materialUniqueId && parsedMultiMaterial.uniqueId === parsedMesh.materialUniqueId) ||\n                                        parsedMultiMaterial.id === parsedMesh.materialId) {\n                                        if (parsedMultiMaterial.materialsUniqueIds) {\n                                            // if the materials inside the multimat are stored by unique id\n                                            parsedMultiMaterial.materialsUniqueIds.forEach(function (subMatId) {\n                                                return loadSubMaterial_1(subMatId, function (parsedMaterial) { return parsedMaterial.uniqueId === subMatId; });\n                                            });\n                                        }\n                                        else {\n                                            // if the mats are stored by id instead\n                                            parsedMultiMaterial.materials.forEach(function (subMatId) {\n                                                return loadSubMaterial_1(subMatId, function (parsedMaterial) { return parsedMaterial.id === subMatId; });\n                                            });\n                                        }\n                                        materialArray_1.push(parsedMultiMaterial.uniqueId || parsedMultiMaterial.id);\n                                        var mmat = MultiMaterial.ParseMultiMaterial(parsedMultiMaterial, scene);\n                                        tempMaterialIndexContainer[parsedMultiMaterial.uniqueId || parsedMultiMaterial.id] = mmat;\n                                        if (mmat) {\n                                            materialFound = true;\n                                            log += \"\\n\\tMulti-Material \" + mmat.toString(fullDetails_1);\n                                        }\n                                        break;\n                                    }\n                                }\n                            }\n                            if (materialFound === false) {\n                                materialArray_1.push(parsedMesh.materialUniqueId || parsedMesh.materialId);\n                                var mat = parseMaterialByPredicate(function (parsedMaterial) {\n                                    return (parsedMesh.materialUniqueId && parsedMaterial.uniqueId === parsedMesh.materialUniqueId) || parsedMaterial.id === parsedMesh.materialId;\n                                }, parsedData, scene, rootUrl);\n                                if (!mat || !mat.material) {\n                                    Logger.Warn(\"Material not found for mesh \" + parsedMesh.id);\n                                }\n                                else {\n                                    tempMaterialIndexContainer[mat.parsedMaterial.uniqueId || mat.parsedMaterial.id] = mat.material;\n                                    log += \"\\n\\tMaterial \" + mat.material.toString(fullDetails_1);\n                                }\n                            }\n                        }\n                        // Skeleton ?\n                        if (parsedMesh.skeletonId > -1 && parsedData.skeletons !== undefined && parsedData.skeletons !== null) {\n                            var skeletonAlreadyLoaded = loadedSkeletonsIds.indexOf(parsedMesh.skeletonId) > -1;\n                            if (!skeletonAlreadyLoaded) {\n                                for (var skeletonIndex = 0, skeletonCache = parsedData.skeletons.length; skeletonIndex < skeletonCache; skeletonIndex++) {\n                                    var parsedSkeleton = parsedData.skeletons[skeletonIndex];\n                                    if (parsedSkeleton.id === parsedMesh.skeletonId) {\n                                        var skeleton = Skeleton.Parse(parsedSkeleton, scene);\n                                        skeletons.push(skeleton);\n                                        loadedSkeletonsIds.push(parsedSkeleton.id);\n                                        log += \"\\n\\tSkeleton \" + skeleton.toString(fullDetails_1);\n                                    }\n                                }\n                            }\n                        }\n                        // Morph targets ?\n                        if (parsedMesh.morphTargetManagerId > -1 && parsedData.morphTargetManagers !== undefined && parsedData.morphTargetManagers !== null) {\n                            var morphTargetAlreadyLoaded = loadedMorphTargetsIds.indexOf(parsedMesh.morphTargetManagerId) > -1;\n                            if (!morphTargetAlreadyLoaded) {\n                                for (var morphTargetIndex = 0, morphTargetCache = parsedData.morphTargetManagers.length; morphTargetIndex < morphTargetCache; morphTargetIndex++) {\n                                    var parsedMorphTarget = parsedData.morphTargetManagers[morphTargetIndex];\n                                    if (parsedMorphTarget.id === parsedMesh.morphTargetManagerId) {\n                                        var morphTarget = MorphTargetManager.Parse(parsedMorphTarget, scene);\n                                        loadedMorphTargetsIds.push(morphTarget.uniqueId);\n                                        log += \"\\nMorph target \" + morphTarget.toString();\n                                    }\n                                }\n                            }\n                        }\n                        var mesh = Mesh.Parse(parsedMesh, scene, rootUrl);\n                        meshes.push(mesh);\n                        log += \"\\n\\tMesh \" + mesh.toString(fullDetails_1);\n                    }\n                };\n                for (var index = 0, cache = parsedData.meshes.length; index < cache; index++) {\n                    _loop_1(index, cache);\n                }\n                // link multimats with materials\n                scene.multiMaterials.forEach(function (multimat) {\n                    multimat._waitingSubMaterialsUniqueIds.forEach(function (subMaterial) {\n                        multimat.subMaterials.push(findMaterial(subMaterial, scene));\n                    });\n                    multimat._waitingSubMaterialsUniqueIds = [];\n                });\n                // link meshes with materials\n                scene.meshes.forEach(function (mesh) {\n                    if (mesh._waitingMaterialId !== null) {\n                        mesh.material = findMaterial(mesh._waitingMaterialId, scene);\n                        mesh._waitingMaterialId = null;\n                    }\n                });\n                // Connecting parents and lods\n                for (var index = 0, cache = scene.transformNodes.length; index < cache; index++) {\n                    var transformNode = scene.transformNodes[index];\n                    if (transformNode._waitingParentId !== null) {\n                        transformNode.parent = scene.getLastEntryById(transformNode._waitingParentId);\n                        transformNode._waitingParentId = null;\n                    }\n                }\n                var currentMesh = void 0;\n                for (var index = 0, cache = scene.meshes.length; index < cache; index++) {\n                    currentMesh = scene.meshes[index];\n                    if (currentMesh._waitingParentId) {\n                        currentMesh.parent = scene.getLastEntryById(currentMesh._waitingParentId);\n                        if (((_a = currentMesh.parent) === null || _a === void 0 ? void 0 : _a.getClassName()) === \"TransformNode\") {\n                            var loadedTransformNodeIndex = loadedTransformNodes.indexOf(currentMesh.parent);\n                            if (loadedTransformNodeIndex > -1) {\n                                loadedTransformNodes.splice(loadedTransformNodeIndex, 1);\n                            }\n                        }\n                        currentMesh._waitingParentId = null;\n                    }\n                    if (currentMesh._waitingData.lods) {\n                        loadDetailLevels(scene, currentMesh);\n                    }\n                }\n                // Remove unused transform nodes\n                for (var _i = 0, loadedTransformNodes_1 = loadedTransformNodes; _i < loadedTransformNodes_1.length; _i++) {\n                    var transformNode = loadedTransformNodes_1[_i];\n                    transformNode.dispose();\n                }\n                // link skeleton transform nodes\n                for (var index = 0, cache = scene.skeletons.length; index < cache; index++) {\n                    var skeleton = scene.skeletons[index];\n                    if (skeleton._hasWaitingData) {\n                        if (skeleton.bones != null) {\n                            skeleton.bones.forEach(function (bone) {\n                                if (bone._waitingTransformNodeId) {\n                                    var linkTransformNode = scene.getLastEntryById(bone._waitingTransformNodeId);\n                                    if (linkTransformNode) {\n                                        bone.linkTransformNode(linkTransformNode);\n                                    }\n                                    bone._waitingTransformNodeId = null;\n                                }\n                            });\n                        }\n                        skeleton._hasWaitingData = null;\n                    }\n                }\n                // freeze and compute world matrix application\n                for (var index = 0, cache = scene.meshes.length; index < cache; index++) {\n                    currentMesh = scene.meshes[index];\n                    if (currentMesh._waitingData.freezeWorldMatrix) {\n                        currentMesh.freezeWorldMatrix();\n                        currentMesh._waitingData.freezeWorldMatrix = null;\n                    }\n                    else {\n                        currentMesh.computeWorldMatrix(true);\n                    }\n                }\n            }\n            // Particles\n            if (parsedData.particleSystems !== undefined && parsedData.particleSystems !== null) {\n                var parser = AbstractScene.GetIndividualParser(SceneComponentConstants.NAME_PARTICLESYSTEM);\n                if (parser) {\n                    for (var index = 0, cache = parsedData.particleSystems.length; index < cache; index++) {\n                        var parsedParticleSystem = parsedData.particleSystems[index];\n                        if (hierarchyIds.indexOf(parsedParticleSystem.emitterId) !== -1) {\n                            particleSystems.push(parser(parsedParticleSystem, scene, rootUrl));\n                        }\n                    }\n                }\n            }\n            return true;\n        }\n        catch (err) {\n            var msg = logOperation(\"importMesh\", parsedData ? parsedData.producer : \"Unknown\") + log;\n            if (onError) {\n                onError(msg, err);\n            }\n            else {\n                Logger.Log(msg);\n                throw err;\n            }\n        }\n        finally {\n            if (log !== null && SceneLoader.loggingLevel !== SceneLoader.NO_LOGGING) {\n                Logger.Log(logOperation(\"importMesh\", parsedData ? parsedData.producer : \"Unknown\") + (SceneLoader.loggingLevel !== SceneLoader.MINIMAL_LOGGING ? log : \"\"));\n            }\n        }\n        return false;\n    },\n    load: function (scene, data, rootUrl, onError) {\n        // Entire method running in try block, so ALWAYS logs as far as it got, only actually writes details\n        // when SceneLoader.debugLogging = true (default), or exception encountered.\n        // Everything stored in var log instead of writing separate lines to support only writing in exception,\n        // and avoid problems with multiple concurrent .babylon loads.\n        var log = \"importScene has failed JSON parse\";\n        try {\n            // eslint-disable-next-line no-var\n            var parsedData = JSON.parse(data);\n            log = \"\";\n            // Scene\n            if (parsedData.useDelayedTextureLoading !== undefined && parsedData.useDelayedTextureLoading !== null) {\n                scene.useDelayedTextureLoading = parsedData.useDelayedTextureLoading && !SceneLoader.ForceFullSceneLoadingForIncremental;\n            }\n            if (parsedData.autoClear !== undefined && parsedData.autoClear !== null) {\n                scene.autoClear = parsedData.autoClear;\n            }\n            if (parsedData.clearColor !== undefined && parsedData.clearColor !== null) {\n                scene.clearColor = Color4.FromArray(parsedData.clearColor);\n            }\n            if (parsedData.ambientColor !== undefined && parsedData.ambientColor !== null) {\n                scene.ambientColor = Color3.FromArray(parsedData.ambientColor);\n            }\n            if (parsedData.gravity !== undefined && parsedData.gravity !== null) {\n                scene.gravity = Vector3.FromArray(parsedData.gravity);\n            }\n            if (parsedData.useRightHandedSystem !== undefined) {\n                scene.useRightHandedSystem = !!parsedData.useRightHandedSystem;\n            }\n            // Fog\n            if (parsedData.fogMode && parsedData.fogMode !== 0) {\n                scene.fogMode = parsedData.fogMode;\n                scene.fogColor = Color3.FromArray(parsedData.fogColor);\n                scene.fogStart = parsedData.fogStart;\n                scene.fogEnd = parsedData.fogEnd;\n                scene.fogDensity = parsedData.fogDensity;\n                log += \"\\tFog mode for scene:  \";\n                switch (scene.fogMode) {\n                    // getters not compiling, so using hardcoded\n                    case 1:\n                        log += \"exp\\n\";\n                        break;\n                    case 2:\n                        log += \"exp2\\n\";\n                        break;\n                    case 3:\n                        log += \"linear\\n\";\n                        break;\n                }\n            }\n            //Physics\n            if (parsedData.physicsEnabled) {\n                var physicsPlugin = void 0;\n                if (parsedData.physicsEngine === \"cannon\") {\n                    physicsPlugin = new CannonJSPlugin(undefined, undefined, BabylonFileLoaderConfiguration.LoaderInjectedPhysicsEngine);\n                }\n                else if (parsedData.physicsEngine === \"oimo\") {\n                    physicsPlugin = new OimoJSPlugin(undefined, BabylonFileLoaderConfiguration.LoaderInjectedPhysicsEngine);\n                }\n                else if (parsedData.physicsEngine === \"ammo\") {\n                    physicsPlugin = new AmmoJSPlugin(undefined, BabylonFileLoaderConfiguration.LoaderInjectedPhysicsEngine, undefined);\n                }\n                log = \"\\tPhysics engine \" + (parsedData.physicsEngine ? parsedData.physicsEngine : \"oimo\") + \" enabled\\n\";\n                //else - default engine, which is currently oimo\n                var physicsGravity = parsedData.physicsGravity ? Vector3.FromArray(parsedData.physicsGravity) : null;\n                scene.enablePhysics(physicsGravity, physicsPlugin);\n            }\n            // Metadata\n            if (parsedData.metadata !== undefined && parsedData.metadata !== null) {\n                scene.metadata = parsedData.metadata;\n            }\n            //collisions, if defined. otherwise, default is true\n            if (parsedData.collisionsEnabled !== undefined && parsedData.collisionsEnabled !== null) {\n                scene.collisionsEnabled = parsedData.collisionsEnabled;\n            }\n            var container = loadAssetContainer(scene, data, rootUrl, onError, true);\n            if (!container) {\n                return false;\n            }\n            if (parsedData.autoAnimate) {\n                scene.beginAnimation(scene, parsedData.autoAnimateFrom, parsedData.autoAnimateTo, parsedData.autoAnimateLoop, parsedData.autoAnimateSpeed || 1.0);\n            }\n            if (parsedData.activeCameraID !== undefined && parsedData.activeCameraID !== null) {\n                scene.setActiveCameraById(parsedData.activeCameraID);\n            }\n            // Finish\n            return true;\n        }\n        catch (err) {\n            var msg = logOperation(\"importScene\", parsedData ? parsedData.producer : \"Unknown\") + log;\n            if (onError) {\n                onError(msg, err);\n            }\n            else {\n                Logger.Log(msg);\n                throw err;\n            }\n        }\n        finally {\n            if (log !== null && SceneLoader.loggingLevel !== SceneLoader.NO_LOGGING) {\n                Logger.Log(logOperation(\"importScene\", parsedData ? parsedData.producer : \"Unknown\") + (SceneLoader.loggingLevel !== SceneLoader.MINIMAL_LOGGING ? log : \"\"));\n            }\n        }\n        return false;\n    },\n    loadAssetContainer: function (scene, data, rootUrl, onError) {\n        var container = loadAssetContainer(scene, data, rootUrl, onError);\n        return container;\n    },\n});\n//# sourceMappingURL=babylonFileLoader.js.map","import { Tools } from \"../Misc/tools.js\";\nimport { Observable } from \"../Misc/observable.js\";\nimport { Scene } from \"../scene.js\";\nimport { Engine } from \"../Engines/engine.js\";\nimport { EngineStore } from \"../Engines/engineStore.js\";\nimport { Logger } from \"../Misc/logger.js\";\n\nimport { SceneLoaderFlags } from \"./sceneLoaderFlags.js\";\nimport { IsBase64DataUrl } from \"../Misc/fileTools.js\";\nimport { RuntimeError, ErrorCodes } from \"../Misc/error.js\";\n/**\n * Mode that determines how to handle old animation groups before loading new ones.\n */\nexport var SceneLoaderAnimationGroupLoadingMode;\n(function (SceneLoaderAnimationGroupLoadingMode) {\n    /**\n     * Reset all old animations to initial state then dispose them.\n     */\n    SceneLoaderAnimationGroupLoadingMode[SceneLoaderAnimationGroupLoadingMode[\"Clean\"] = 0] = \"Clean\";\n    /**\n     * Stop all old animations.\n     */\n    SceneLoaderAnimationGroupLoadingMode[SceneLoaderAnimationGroupLoadingMode[\"Stop\"] = 1] = \"Stop\";\n    /**\n     * Restart old animations from first frame.\n     */\n    SceneLoaderAnimationGroupLoadingMode[SceneLoaderAnimationGroupLoadingMode[\"Sync\"] = 2] = \"Sync\";\n    /**\n     * Old animations remains untouched.\n     */\n    SceneLoaderAnimationGroupLoadingMode[SceneLoaderAnimationGroupLoadingMode[\"NoSync\"] = 3] = \"NoSync\";\n})(SceneLoaderAnimationGroupLoadingMode || (SceneLoaderAnimationGroupLoadingMode = {}));\n/**\n * Class used to load scene from various file formats using registered plugins\n * @see https://doc.babylonjs.com/how_to/load_from_any_file_type\n */\nvar SceneLoader = /** @class */ (function () {\n    function SceneLoader() {\n    }\n    Object.defineProperty(SceneLoader, \"ForceFullSceneLoadingForIncremental\", {\n        /**\n         * Gets or sets a boolean indicating if entire scene must be loaded even if scene contains incremental data\n         */\n        get: function () {\n            return SceneLoaderFlags.ForceFullSceneLoadingForIncremental;\n        },\n        set: function (value) {\n            SceneLoaderFlags.ForceFullSceneLoadingForIncremental = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SceneLoader, \"ShowLoadingScreen\", {\n        /**\n         * Gets or sets a boolean indicating if loading screen must be displayed while loading a scene\n         */\n        get: function () {\n            return SceneLoaderFlags.ShowLoadingScreen;\n        },\n        set: function (value) {\n            SceneLoaderFlags.ShowLoadingScreen = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SceneLoader, \"loggingLevel\", {\n        /**\n         * Defines the current logging level (while loading the scene)\n         * @ignorenaming\n         */\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        get: function () {\n            return SceneLoaderFlags.loggingLevel;\n        },\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        set: function (value) {\n            SceneLoaderFlags.loggingLevel = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SceneLoader, \"CleanBoneMatrixWeights\", {\n        /**\n         * Gets or set a boolean indicating if matrix weights must be cleaned upon loading\n         */\n        get: function () {\n            return SceneLoaderFlags.CleanBoneMatrixWeights;\n        },\n        set: function (value) {\n            SceneLoaderFlags.CleanBoneMatrixWeights = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Gets the default plugin (used to load Babylon files)\n     * @returns the .babylon plugin\n     */\n    SceneLoader.GetDefaultPlugin = function () {\n        return SceneLoader._RegisteredPlugins[\".babylon\"];\n    };\n    SceneLoader._GetPluginForExtension = function (extension) {\n        var registeredPlugin = SceneLoader._RegisteredPlugins[extension];\n        if (registeredPlugin) {\n            return registeredPlugin;\n        }\n        Logger.Warn(\"Unable to find a plugin to load \" +\n            extension +\n            \" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/how_to/load_from_any_file_type\");\n        return SceneLoader.GetDefaultPlugin();\n    };\n    SceneLoader._GetPluginForDirectLoad = function (data) {\n        for (var extension in SceneLoader._RegisteredPlugins) {\n            var plugin = SceneLoader._RegisteredPlugins[extension].plugin;\n            if (plugin.canDirectLoad && plugin.canDirectLoad(data)) {\n                return SceneLoader._RegisteredPlugins[extension];\n            }\n        }\n        return SceneLoader.GetDefaultPlugin();\n    };\n    SceneLoader._GetPluginForFilename = function (sceneFilename) {\n        var queryStringPosition = sceneFilename.indexOf(\"?\");\n        if (queryStringPosition !== -1) {\n            sceneFilename = sceneFilename.substring(0, queryStringPosition);\n        }\n        var dotPosition = sceneFilename.lastIndexOf(\".\");\n        var extension = sceneFilename.substring(dotPosition, sceneFilename.length).toLowerCase();\n        return SceneLoader._GetPluginForExtension(extension);\n    };\n    SceneLoader._GetDirectLoad = function (sceneFilename) {\n        if (sceneFilename.substr(0, 5) === \"data:\") {\n            return sceneFilename.substr(5);\n        }\n        return null;\n    };\n    SceneLoader._FormatErrorMessage = function (fileInfo, message, exception) {\n        var errorMessage = \"Unable to load from \" + fileInfo.url;\n        if (message) {\n            errorMessage += \": \".concat(message);\n        }\n        else if (exception) {\n            errorMessage += \": \".concat(exception);\n        }\n        return errorMessage;\n    };\n    SceneLoader._LoadData = function (fileInfo, scene, onSuccess, onProgress, onError, onDispose, pluginExtension) {\n        var directLoad = SceneLoader._GetDirectLoad(fileInfo.url);\n        var registeredPlugin = pluginExtension\n            ? SceneLoader._GetPluginForExtension(pluginExtension)\n            : directLoad\n                ? SceneLoader._GetPluginForDirectLoad(fileInfo.url)\n                : SceneLoader._GetPluginForFilename(fileInfo.url);\n        var plugin;\n        if (registeredPlugin.plugin.createPlugin !== undefined) {\n            plugin = registeredPlugin.plugin.createPlugin();\n        }\n        else {\n            plugin = registeredPlugin.plugin;\n        }\n        if (!plugin) {\n            throw \"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.\";\n        }\n        SceneLoader.OnPluginActivatedObservable.notifyObservers(plugin);\n        // Check if we have a direct load url. If the plugin is registered to handle\n        // it or it's not a base64 data url, then pass it through the direct load path.\n        if (directLoad && ((plugin.canDirectLoad && plugin.canDirectLoad(fileInfo.url)) || !IsBase64DataUrl(fileInfo.url))) {\n            if (plugin.directLoad) {\n                var result = plugin.directLoad(scene, directLoad);\n                if (result.then) {\n                    result\n                        .then(function (data) {\n                        onSuccess(plugin, data);\n                    })\n                        .catch(function (error) {\n                        onError(\"Error in directLoad of _loadData: \" + error, error);\n                    });\n                }\n                else {\n                    onSuccess(plugin, result);\n                }\n            }\n            else {\n                onSuccess(plugin, directLoad);\n            }\n            return plugin;\n        }\n        var useArrayBuffer = registeredPlugin.isBinary;\n        var dataCallback = function (data, responseURL) {\n            if (scene.isDisposed) {\n                onError(\"Scene has been disposed\");\n                return;\n            }\n            onSuccess(plugin, data, responseURL);\n        };\n        var request = null;\n        var pluginDisposed = false;\n        var onDisposeObservable = plugin.onDisposeObservable;\n        if (onDisposeObservable) {\n            onDisposeObservable.add(function () {\n                pluginDisposed = true;\n                if (request) {\n                    request.abort();\n                    request = null;\n                }\n                onDispose();\n            });\n        }\n        var manifestChecked = function () {\n            if (pluginDisposed) {\n                return;\n            }\n            var errorCallback = function (request, exception) {\n                onError(request === null || request === void 0 ? void 0 : request.statusText, exception);\n            };\n            var fileOrUrl = fileInfo.file || fileInfo.url;\n            request = plugin.loadFile\n                ? plugin.loadFile(scene, fileOrUrl, dataCallback, onProgress, useArrayBuffer, errorCallback)\n                : scene._loadFile(fileOrUrl, dataCallback, onProgress, true, useArrayBuffer, errorCallback);\n        };\n        var engine = scene.getEngine();\n        var canUseOfflineSupport = engine.enableOfflineSupport;\n        if (canUseOfflineSupport) {\n            // Also check for exceptions\n            var exceptionFound = false;\n            for (var _i = 0, _a = scene.disableOfflineSupportExceptionRules; _i < _a.length; _i++) {\n                var regex = _a[_i];\n                if (regex.test(fileInfo.url)) {\n                    exceptionFound = true;\n                    break;\n                }\n            }\n            canUseOfflineSupport = !exceptionFound;\n        }\n        if (canUseOfflineSupport && Engine.OfflineProviderFactory) {\n            // Checking if a manifest file has been set for this scene and if offline mode has been requested\n            scene.offlineProvider = Engine.OfflineProviderFactory(fileInfo.url, manifestChecked, engine.disableManifestCheck);\n        }\n        else {\n            manifestChecked();\n        }\n        return plugin;\n    };\n    SceneLoader._GetFileInfo = function (rootUrl, sceneFilename) {\n        var url;\n        var name;\n        var file = null;\n        if (!sceneFilename) {\n            url = rootUrl;\n            name = Tools.GetFilename(rootUrl);\n            rootUrl = Tools.GetFolderPath(rootUrl);\n        }\n        else if (sceneFilename.name) {\n            var sceneFile = sceneFilename;\n            url = \"file:\".concat(sceneFile.name);\n            name = sceneFile.name;\n            file = sceneFile;\n        }\n        else if (typeof sceneFilename === \"string\" && sceneFilename.startsWith(\"data:\")) {\n            url = sceneFilename;\n            name = \"\";\n        }\n        else {\n            var filename = sceneFilename;\n            if (filename.substr(0, 1) === \"/\") {\n                Tools.Error(\"Wrong sceneFilename parameter\");\n                return null;\n            }\n            url = rootUrl + filename;\n            name = filename;\n        }\n        return {\n            url: url,\n            rootUrl: rootUrl,\n            name: name,\n            file: file,\n        };\n    };\n    // Public functions\n    /**\n     * Gets a plugin that can load the given extension\n     * @param extension defines the extension to load\n     * @returns a plugin or null if none works\n     */\n    SceneLoader.GetPluginForExtension = function (extension) {\n        return SceneLoader._GetPluginForExtension(extension).plugin;\n    };\n    /**\n     * Gets a boolean indicating that the given extension can be loaded\n     * @param extension defines the extension to load\n     * @returns true if the extension is supported\n     */\n    SceneLoader.IsPluginForExtensionAvailable = function (extension) {\n        return !!SceneLoader._RegisteredPlugins[extension];\n    };\n    /**\n     * Adds a new plugin to the list of registered plugins\n     * @param plugin defines the plugin to add\n     */\n    SceneLoader.RegisterPlugin = function (plugin) {\n        if (typeof plugin.extensions === \"string\") {\n            var extension = plugin.extensions;\n            SceneLoader._RegisteredPlugins[extension.toLowerCase()] = {\n                plugin: plugin,\n                isBinary: false,\n            };\n        }\n        else {\n            var extensions_1 = plugin.extensions;\n            Object.keys(extensions_1).forEach(function (extension) {\n                SceneLoader._RegisteredPlugins[extension.toLowerCase()] = {\n                    plugin: plugin,\n                    isBinary: extensions_1[extension].isBinary,\n                };\n            });\n        }\n    };\n    /**\n     * Import meshes into a scene\n     * @param meshNames an array of mesh names, a single mesh name, or empty string for all meshes that filter what meshes are imported\n     * @param rootUrl a string that defines the root url for the scene and resources or the concatenation of rootURL and filename (e.g. http://example.com/test.glb)\n     * @param sceneFilename a string that defines the name of the scene file or starts with \"data:\" following by the stringified version of the scene or a File object (default: empty string)\n     * @param scene the instance of BABYLON.Scene to append to\n     * @param onSuccess a callback with a list of imported meshes, particleSystems, skeletons, and animationGroups when import succeeds\n     * @param onProgress a callback with a progress event for each file being loaded\n     * @param onError a callback with the scene, a message, and possibly an exception when import fails\n     * @param pluginExtension the extension used to determine the plugin\n     * @returns The loaded plugin\n     */\n    SceneLoader.ImportMesh = function (meshNames, rootUrl, sceneFilename, scene, onSuccess, onProgress, onError, pluginExtension) {\n        if (sceneFilename === void 0) { sceneFilename = \"\"; }\n        if (scene === void 0) { scene = EngineStore.LastCreatedScene; }\n        if (onSuccess === void 0) { onSuccess = null; }\n        if (onProgress === void 0) { onProgress = null; }\n        if (onError === void 0) { onError = null; }\n        if (pluginExtension === void 0) { pluginExtension = null; }\n        if (!scene) {\n            Logger.Error(\"No scene available to import mesh to\");\n            return null;\n        }\n        var fileInfo = SceneLoader._GetFileInfo(rootUrl, sceneFilename);\n        if (!fileInfo) {\n            return null;\n        }\n        var loadingToken = {};\n        scene._addPendingData(loadingToken);\n        var disposeHandler = function () {\n            scene._removePendingData(loadingToken);\n        };\n        var errorHandler = function (message, exception) {\n            var errorMessage = SceneLoader._FormatErrorMessage(fileInfo, message, exception);\n            if (onError) {\n                onError(scene, errorMessage, new RuntimeError(errorMessage, ErrorCodes.SceneLoaderError, exception));\n            }\n            else {\n                Logger.Error(errorMessage);\n                // should the exception be thrown?\n            }\n            disposeHandler();\n        };\n        var progressHandler = onProgress\n            ? function (event) {\n                try {\n                    onProgress(event);\n                }\n                catch (e) {\n                    errorHandler(\"Error in onProgress callback: \" + e, e);\n                }\n            }\n            : undefined;\n        var successHandler = function (meshes, particleSystems, skeletons, animationGroups, transformNodes, geometries, lights) {\n            scene.importedMeshesFiles.push(fileInfo.url);\n            if (onSuccess) {\n                try {\n                    onSuccess(meshes, particleSystems, skeletons, animationGroups, transformNodes, geometries, lights);\n                }\n                catch (e) {\n                    errorHandler(\"Error in onSuccess callback: \" + e, e);\n                }\n            }\n            scene._removePendingData(loadingToken);\n        };\n        return SceneLoader._LoadData(fileInfo, scene, function (plugin, data, responseURL) {\n            if (plugin.rewriteRootURL) {\n                fileInfo.rootUrl = plugin.rewriteRootURL(fileInfo.rootUrl, responseURL);\n            }\n            if (plugin.importMesh) {\n                var syncedPlugin = plugin;\n                var meshes = new Array();\n                var particleSystems = new Array();\n                var skeletons = new Array();\n                if (!syncedPlugin.importMesh(meshNames, scene, data, fileInfo.rootUrl, meshes, particleSystems, skeletons, errorHandler)) {\n                    return;\n                }\n                scene.loadingPluginName = plugin.name;\n                successHandler(meshes, particleSystems, skeletons, [], [], [], []);\n            }\n            else {\n                var asyncedPlugin = plugin;\n                asyncedPlugin\n                    .importMeshAsync(meshNames, scene, data, fileInfo.rootUrl, progressHandler, fileInfo.name)\n                    .then(function (result) {\n                    scene.loadingPluginName = plugin.name;\n                    successHandler(result.meshes, result.particleSystems, result.skeletons, result.animationGroups, result.transformNodes, result.geometries, result.lights);\n                })\n                    .catch(function (error) {\n                    errorHandler(error.message, error);\n                });\n            }\n        }, progressHandler, errorHandler, disposeHandler, pluginExtension);\n    };\n    /**\n     * Import meshes into a scene\n     * @param meshNames an array of mesh names, a single mesh name, or empty string for all meshes that filter what meshes are imported\n     * @param rootUrl a string that defines the root url for the scene and resources or the concatenation of rootURL and filename (e.g. http://example.com/test.glb)\n     * @param sceneFilename a string that defines the name of the scene file or starts with \"data:\" following by the stringified version of the scene or a File object (default: empty string)\n     * @param scene the instance of BABYLON.Scene to append to\n     * @param onProgress a callback with a progress event for each file being loaded\n     * @param pluginExtension the extension used to determine the plugin\n     * @returns The loaded list of imported meshes, particle systems, skeletons, and animation groups\n     */\n    SceneLoader.ImportMeshAsync = function (meshNames, rootUrl, sceneFilename, scene, onProgress, pluginExtension) {\n        if (sceneFilename === void 0) { sceneFilename = \"\"; }\n        if (scene === void 0) { scene = EngineStore.LastCreatedScene; }\n        if (onProgress === void 0) { onProgress = null; }\n        if (pluginExtension === void 0) { pluginExtension = null; }\n        return new Promise(function (resolve, reject) {\n            SceneLoader.ImportMesh(meshNames, rootUrl, sceneFilename, scene, function (meshes, particleSystems, skeletons, animationGroups, transformNodes, geometries, lights) {\n                resolve({\n                    meshes: meshes,\n                    particleSystems: particleSystems,\n                    skeletons: skeletons,\n                    animationGroups: animationGroups,\n                    transformNodes: transformNodes,\n                    geometries: geometries,\n                    lights: lights,\n                });\n            }, onProgress, function (scene, message, exception) {\n                reject(exception || new Error(message));\n            }, pluginExtension);\n        });\n    };\n    /**\n     * Load a scene\n     * @param rootUrl a string that defines the root url for the scene and resources or the concatenation of rootURL and filename (e.g. http://example.com/test.glb)\n     * @param sceneFilename a string that defines the name of the scene file or starts with \"data:\" following by the stringified version of the scene or a File object (default: empty string)\n     * @param engine is the instance of BABYLON.Engine to use to create the scene\n     * @param onSuccess a callback with the scene when import succeeds\n     * @param onProgress a callback with a progress event for each file being loaded\n     * @param onError a callback with the scene, a message, and possibly an exception when import fails\n     * @param pluginExtension the extension used to determine the plugin\n     * @returns The loaded plugin\n     */\n    SceneLoader.Load = function (rootUrl, sceneFilename, engine, onSuccess, onProgress, onError, pluginExtension) {\n        if (sceneFilename === void 0) { sceneFilename = \"\"; }\n        if (engine === void 0) { engine = EngineStore.LastCreatedEngine; }\n        if (onSuccess === void 0) { onSuccess = null; }\n        if (onProgress === void 0) { onProgress = null; }\n        if (onError === void 0) { onError = null; }\n        if (pluginExtension === void 0) { pluginExtension = null; }\n        if (!engine) {\n            Tools.Error(\"No engine available\");\n            return null;\n        }\n        return SceneLoader.Append(rootUrl, sceneFilename, new Scene(engine), onSuccess, onProgress, onError, pluginExtension);\n    };\n    /**\n     * Load a scene\n     * @param rootUrl a string that defines the root url for the scene and resources or the concatenation of rootURL and filename (e.g. http://example.com/test.glb)\n     * @param sceneFilename a string that defines the name of the scene file or starts with \"data:\" following by the stringified version of the scene or a File object (default: empty string)\n     * @param engine is the instance of BABYLON.Engine to use to create the scene\n     * @param onProgress a callback with a progress event for each file being loaded\n     * @param pluginExtension the extension used to determine the plugin\n     * @returns The loaded scene\n     */\n    SceneLoader.LoadAsync = function (rootUrl, sceneFilename, engine, onProgress, pluginExtension) {\n        if (sceneFilename === void 0) { sceneFilename = \"\"; }\n        if (engine === void 0) { engine = EngineStore.LastCreatedEngine; }\n        if (onProgress === void 0) { onProgress = null; }\n        if (pluginExtension === void 0) { pluginExtension = null; }\n        return new Promise(function (resolve, reject) {\n            SceneLoader.Load(rootUrl, sceneFilename, engine, function (scene) {\n                resolve(scene);\n            }, onProgress, function (scene, message, exception) {\n                reject(exception || new Error(message));\n            }, pluginExtension);\n        });\n    };\n    /**\n     * Append a scene\n     * @param rootUrl a string that defines the root url for the scene and resources or the concatenation of rootURL and filename (e.g. http://example.com/test.glb)\n     * @param sceneFilename a string that defines the name of the scene file or starts with \"data:\" following by the stringified version of the scene or a File object (default: empty string)\n     * @param scene is the instance of BABYLON.Scene to append to\n     * @param onSuccess a callback with the scene when import succeeds\n     * @param onProgress a callback with a progress event for each file being loaded\n     * @param onError a callback with the scene, a message, and possibly an exception when import fails\n     * @param pluginExtension the extension used to determine the plugin\n     * @returns The loaded plugin\n     */\n    SceneLoader.Append = function (rootUrl, sceneFilename, scene, onSuccess, onProgress, onError, pluginExtension) {\n        var _this = this;\n        if (sceneFilename === void 0) { sceneFilename = \"\"; }\n        if (scene === void 0) { scene = EngineStore.LastCreatedScene; }\n        if (onSuccess === void 0) { onSuccess = null; }\n        if (onProgress === void 0) { onProgress = null; }\n        if (onError === void 0) { onError = null; }\n        if (pluginExtension === void 0) { pluginExtension = null; }\n        if (!scene) {\n            Logger.Error(\"No scene available to append to\");\n            return null;\n        }\n        var fileInfo = SceneLoader._GetFileInfo(rootUrl, sceneFilename);\n        if (!fileInfo) {\n            return null;\n        }\n        if (SceneLoader.ShowLoadingScreen && !this._ShowingLoadingScreen) {\n            this._ShowingLoadingScreen = true;\n            scene.getEngine().displayLoadingUI();\n            scene.executeWhenReady(function () {\n                scene.getEngine().hideLoadingUI();\n                _this._ShowingLoadingScreen = false;\n            });\n        }\n        var loadingToken = {};\n        scene._addPendingData(loadingToken);\n        var disposeHandler = function () {\n            scene._removePendingData(loadingToken);\n        };\n        var errorHandler = function (message, exception) {\n            var errorMessage = SceneLoader._FormatErrorMessage(fileInfo, message, exception);\n            if (onError) {\n                onError(scene, errorMessage, new RuntimeError(errorMessage, ErrorCodes.SceneLoaderError, exception));\n            }\n            else {\n                Logger.Error(errorMessage);\n                // should the exception be thrown?\n            }\n            disposeHandler();\n        };\n        var progressHandler = onProgress\n            ? function (event) {\n                try {\n                    onProgress(event);\n                }\n                catch (e) {\n                    errorHandler(\"Error in onProgress callback\", e);\n                }\n            }\n            : undefined;\n        var successHandler = function () {\n            if (onSuccess) {\n                try {\n                    onSuccess(scene);\n                }\n                catch (e) {\n                    errorHandler(\"Error in onSuccess callback\", e);\n                }\n            }\n            scene._removePendingData(loadingToken);\n        };\n        return SceneLoader._LoadData(fileInfo, scene, function (plugin, data) {\n            if (plugin.load) {\n                var syncedPlugin = plugin;\n                if (!syncedPlugin.load(scene, data, fileInfo.rootUrl, errorHandler)) {\n                    return;\n                }\n                scene.loadingPluginName = plugin.name;\n                successHandler();\n            }\n            else {\n                var asyncedPlugin = plugin;\n                asyncedPlugin\n                    .loadAsync(scene, data, fileInfo.rootUrl, progressHandler, fileInfo.name)\n                    .then(function () {\n                    scene.loadingPluginName = plugin.name;\n                    successHandler();\n                })\n                    .catch(function (error) {\n                    errorHandler(error.message, error);\n                });\n            }\n        }, progressHandler, errorHandler, disposeHandler, pluginExtension);\n    };\n    /**\n     * Append a scene\n     * @param rootUrl a string that defines the root url for the scene and resources or the concatenation of rootURL and filename (e.g. http://example.com/test.glb)\n     * @param sceneFilename a string that defines the name of the scene file or starts with \"data:\" following by the stringified version of the scene or a File object (default: empty string)\n     * @param scene is the instance of BABYLON.Scene to append to\n     * @param onProgress a callback with a progress event for each file being loaded\n     * @param pluginExtension the extension used to determine the plugin\n     * @returns The given scene\n     */\n    SceneLoader.AppendAsync = function (rootUrl, sceneFilename, scene, onProgress, pluginExtension) {\n        if (sceneFilename === void 0) { sceneFilename = \"\"; }\n        if (scene === void 0) { scene = EngineStore.LastCreatedScene; }\n        if (onProgress === void 0) { onProgress = null; }\n        if (pluginExtension === void 0) { pluginExtension = null; }\n        return new Promise(function (resolve, reject) {\n            SceneLoader.Append(rootUrl, sceneFilename, scene, function (scene) {\n                resolve(scene);\n            }, onProgress, function (scene, message, exception) {\n                reject(exception || new Error(message));\n            }, pluginExtension);\n        });\n    };\n    /**\n     * Load a scene into an asset container\n     * @param rootUrl a string that defines the root url for the scene and resources or the concatenation of rootURL and filename (e.g. http://example.com/test.glb)\n     * @param sceneFilename a string that defines the name of the scene file or starts with \"data:\" following by the stringified version of the scene or a File object (default: empty string)\n     * @param scene is the instance of BABYLON.Scene to append to (default: last created scene)\n     * @param onSuccess a callback with the scene when import succeeds\n     * @param onProgress a callback with a progress event for each file being loaded\n     * @param onError a callback with the scene, a message, and possibly an exception when import fails\n     * @param pluginExtension the extension used to determine the plugin\n     * @returns The loaded plugin\n     */\n    SceneLoader.LoadAssetContainer = function (rootUrl, sceneFilename, scene, onSuccess, onProgress, onError, pluginExtension) {\n        if (sceneFilename === void 0) { sceneFilename = \"\"; }\n        if (scene === void 0) { scene = EngineStore.LastCreatedScene; }\n        if (onSuccess === void 0) { onSuccess = null; }\n        if (onProgress === void 0) { onProgress = null; }\n        if (onError === void 0) { onError = null; }\n        if (pluginExtension === void 0) { pluginExtension = null; }\n        if (!scene) {\n            Logger.Error(\"No scene available to load asset container to\");\n            return null;\n        }\n        var fileInfo = SceneLoader._GetFileInfo(rootUrl, sceneFilename);\n        if (!fileInfo) {\n            return null;\n        }\n        var loadingToken = {};\n        scene._addPendingData(loadingToken);\n        var disposeHandler = function () {\n            scene._removePendingData(loadingToken);\n        };\n        var errorHandler = function (message, exception) {\n            var errorMessage = SceneLoader._FormatErrorMessage(fileInfo, message, exception);\n            if (onError) {\n                onError(scene, errorMessage, new RuntimeError(errorMessage, ErrorCodes.SceneLoaderError, exception));\n            }\n            else {\n                Logger.Error(errorMessage);\n                // should the exception be thrown?\n            }\n            disposeHandler();\n        };\n        var progressHandler = onProgress\n            ? function (event) {\n                try {\n                    onProgress(event);\n                }\n                catch (e) {\n                    errorHandler(\"Error in onProgress callback\", e);\n                }\n            }\n            : undefined;\n        var successHandler = function (assets) {\n            if (onSuccess) {\n                try {\n                    onSuccess(assets);\n                }\n                catch (e) {\n                    errorHandler(\"Error in onSuccess callback\", e);\n                }\n            }\n            scene._removePendingData(loadingToken);\n        };\n        return SceneLoader._LoadData(fileInfo, scene, function (plugin, data) {\n            if (plugin.loadAssetContainer) {\n                var syncedPlugin = plugin;\n                var assetContainer = syncedPlugin.loadAssetContainer(scene, data, fileInfo.rootUrl, errorHandler);\n                if (!assetContainer) {\n                    return;\n                }\n                scene.loadingPluginName = plugin.name;\n                successHandler(assetContainer);\n            }\n            else if (plugin.loadAssetContainerAsync) {\n                var asyncedPlugin = plugin;\n                asyncedPlugin\n                    .loadAssetContainerAsync(scene, data, fileInfo.rootUrl, progressHandler, fileInfo.name)\n                    .then(function (assetContainer) {\n                    scene.loadingPluginName = plugin.name;\n                    successHandler(assetContainer);\n                })\n                    .catch(function (error) {\n                    errorHandler(error.message, error);\n                });\n            }\n            else {\n                errorHandler(\"LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.\");\n            }\n        }, progressHandler, errorHandler, disposeHandler, pluginExtension);\n    };\n    /**\n     * Load a scene into an asset container\n     * @param rootUrl a string that defines the root url for the scene and resources or the concatenation of rootURL and filename (e.g. http://example.com/test.glb)\n     * @param sceneFilename a string that defines the name of the scene file or starts with \"data:\" following by the stringified version of the scene (default: empty string)\n     * @param scene is the instance of Scene to append to\n     * @param onProgress a callback with a progress event for each file being loaded\n     * @param pluginExtension the extension used to determine the plugin\n     * @returns The loaded asset container\n     */\n    SceneLoader.LoadAssetContainerAsync = function (rootUrl, sceneFilename, scene, onProgress, pluginExtension) {\n        if (sceneFilename === void 0) { sceneFilename = \"\"; }\n        if (scene === void 0) { scene = EngineStore.LastCreatedScene; }\n        if (onProgress === void 0) { onProgress = null; }\n        if (pluginExtension === void 0) { pluginExtension = null; }\n        return new Promise(function (resolve, reject) {\n            SceneLoader.LoadAssetContainer(rootUrl, sceneFilename, scene, function (assetContainer) {\n                resolve(assetContainer);\n            }, onProgress, function (scene, message, exception) {\n                reject(exception || new Error(message));\n            }, pluginExtension);\n        });\n    };\n    /**\n     * Import animations from a file into a scene\n     * @param rootUrl a string that defines the root url for the scene and resources or the concatenation of rootURL and filename (e.g. http://example.com/test.glb)\n     * @param sceneFilename a string that defines the name of the scene file or starts with \"data:\" following by the stringified version of the scene or a File object (default: empty string)\n     * @param scene is the instance of BABYLON.Scene to append to (default: last created scene)\n     * @param overwriteAnimations when true, animations are cleaned before importing new ones. Animations are appended otherwise\n     * @param animationGroupLoadingMode defines how to handle old animations groups before importing new ones\n     * @param targetConverter defines a function used to convert animation targets from loaded scene to current scene (default: search node by name)\n     * @param onSuccess a callback with the scene when import succeeds\n     * @param onProgress a callback with a progress event for each file being loaded\n     * @param onError a callback with the scene, a message, and possibly an exception when import fails\n     * @param pluginExtension the extension used to determine the plugin\n     */\n    SceneLoader.ImportAnimations = function (rootUrl, sceneFilename, scene, overwriteAnimations, animationGroupLoadingMode, targetConverter, onSuccess, onProgress, onError, pluginExtension) {\n        if (sceneFilename === void 0) { sceneFilename = \"\"; }\n        if (scene === void 0) { scene = EngineStore.LastCreatedScene; }\n        if (overwriteAnimations === void 0) { overwriteAnimations = true; }\n        if (animationGroupLoadingMode === void 0) { animationGroupLoadingMode = SceneLoaderAnimationGroupLoadingMode.Clean; }\n        if (targetConverter === void 0) { targetConverter = null; }\n        if (onSuccess === void 0) { onSuccess = null; }\n        if (onProgress === void 0) { onProgress = null; }\n        if (onError === void 0) { onError = null; }\n        if (pluginExtension === void 0) { pluginExtension = null; }\n        if (!scene) {\n            Logger.Error(\"No scene available to load animations to\");\n            return;\n        }\n        if (overwriteAnimations) {\n            // Reset, stop and dispose all animations before loading new ones\n            for (var _i = 0, _a = scene.animatables; _i < _a.length; _i++) {\n                var animatable = _a[_i];\n                animatable.reset();\n            }\n            scene.stopAllAnimations();\n            scene.animationGroups.slice().forEach(function (animationGroup) {\n                animationGroup.dispose();\n            });\n            var nodes = scene.getNodes();\n            nodes.forEach(function (node) {\n                if (node.animations) {\n                    node.animations = [];\n                }\n            });\n        }\n        else {\n            switch (animationGroupLoadingMode) {\n                case SceneLoaderAnimationGroupLoadingMode.Clean:\n                    scene.animationGroups.slice().forEach(function (animationGroup) {\n                        animationGroup.dispose();\n                    });\n                    break;\n                case SceneLoaderAnimationGroupLoadingMode.Stop:\n                    scene.animationGroups.forEach(function (animationGroup) {\n                        animationGroup.stop();\n                    });\n                    break;\n                case SceneLoaderAnimationGroupLoadingMode.Sync:\n                    scene.animationGroups.forEach(function (animationGroup) {\n                        animationGroup.reset();\n                        animationGroup.restart();\n                    });\n                    break;\n                case SceneLoaderAnimationGroupLoadingMode.NoSync:\n                    // nothing to do\n                    break;\n                default:\n                    Logger.Error(\"Unknown animation group loading mode value '\" + animationGroupLoadingMode + \"'\");\n                    return;\n            }\n        }\n        var startingIndexForNewAnimatables = scene.animatables.length;\n        var onAssetContainerLoaded = function (container) {\n            container.mergeAnimationsTo(scene, scene.animatables.slice(startingIndexForNewAnimatables), targetConverter);\n            container.dispose();\n            scene.onAnimationFileImportedObservable.notifyObservers(scene);\n            if (onSuccess) {\n                onSuccess(scene);\n            }\n        };\n        this.LoadAssetContainer(rootUrl, sceneFilename, scene, onAssetContainerLoaded, onProgress, onError, pluginExtension);\n    };\n    /**\n     * Import animations from a file into a scene\n     * @param rootUrl a string that defines the root url for the scene and resources or the concatenation of rootURL and filename (e.g. http://example.com/test.glb)\n     * @param sceneFilename a string that defines the name of the scene file or starts with \"data:\" following by the stringified version of the scene or a File object (default: empty string)\n     * @param scene is the instance of BABYLON.Scene to append to (default: last created scene)\n     * @param overwriteAnimations when true, animations are cleaned before importing new ones. Animations are appended otherwise\n     * @param animationGroupLoadingMode defines how to handle old animations groups before importing new ones\n     * @param targetConverter defines a function used to convert animation targets from loaded scene to current scene (default: search node by name)\n     * @param onSuccess a callback with the scene when import succeeds\n     * @param onProgress a callback with a progress event for each file being loaded\n     * @param onError a callback with the scene, a message, and possibly an exception when import fails\n     * @param pluginExtension the extension used to determine the plugin\n     * @returns the updated scene with imported animations\n     */\n    SceneLoader.ImportAnimationsAsync = function (rootUrl, sceneFilename, scene, overwriteAnimations, animationGroupLoadingMode, targetConverter, \n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    onSuccess, onProgress, \n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    onError, pluginExtension) {\n        if (sceneFilename === void 0) { sceneFilename = \"\"; }\n        if (scene === void 0) { scene = EngineStore.LastCreatedScene; }\n        if (overwriteAnimations === void 0) { overwriteAnimations = true; }\n        if (animationGroupLoadingMode === void 0) { animationGroupLoadingMode = SceneLoaderAnimationGroupLoadingMode.Clean; }\n        if (targetConverter === void 0) { targetConverter = null; }\n        if (onSuccess === void 0) { onSuccess = null; }\n        if (onProgress === void 0) { onProgress = null; }\n        if (onError === void 0) { onError = null; }\n        if (pluginExtension === void 0) { pluginExtension = null; }\n        return new Promise(function (resolve, reject) {\n            SceneLoader.ImportAnimations(rootUrl, sceneFilename, scene, overwriteAnimations, animationGroupLoadingMode, targetConverter, function (_scene) {\n                resolve(_scene);\n            }, onProgress, function (_scene, message, exception) {\n                reject(exception || new Error(message));\n            }, pluginExtension);\n        });\n    };\n    /**\n     * No logging while loading\n     */\n    SceneLoader.NO_LOGGING = 0;\n    /**\n     * Minimal logging while loading\n     */\n    SceneLoader.MINIMAL_LOGGING = 1;\n    /**\n     * Summary logging while loading\n     */\n    SceneLoader.SUMMARY_LOGGING = 2;\n    /**\n     * Detailed logging while loading\n     */\n    SceneLoader.DETAILED_LOGGING = 3;\n    // Members\n    /**\n     * Event raised when a plugin is used to load a scene\n     */\n    SceneLoader.OnPluginActivatedObservable = new Observable();\n    SceneLoader._RegisteredPlugins = {};\n    SceneLoader._ShowingLoadingScreen = false;\n    return SceneLoader;\n}());\nexport { SceneLoader };\n//# sourceMappingURL=sceneLoader.js.map","\n/**\n * Class used to represent data loading progression\n */\nvar SceneLoaderFlags = /** @class */ (function () {\n    function SceneLoaderFlags() {\n    }\n    Object.defineProperty(SceneLoaderFlags, \"ForceFullSceneLoadingForIncremental\", {\n        /**\n         * Gets or sets a boolean indicating if entire scene must be loaded even if scene contains incremental data\n         */\n        get: function () {\n            return SceneLoaderFlags._ForceFullSceneLoadingForIncremental;\n        },\n        set: function (value) {\n            SceneLoaderFlags._ForceFullSceneLoadingForIncremental = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SceneLoaderFlags, \"ShowLoadingScreen\", {\n        /**\n         * Gets or sets a boolean indicating if loading screen must be displayed while loading a scene\n         */\n        get: function () {\n            return SceneLoaderFlags._ShowLoadingScreen;\n        },\n        set: function (value) {\n            SceneLoaderFlags._ShowLoadingScreen = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SceneLoaderFlags, \"loggingLevel\", {\n        /**\n         * Defines the current logging level (while loading the scene)\n         * @ignorenaming\n         */\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        get: function () {\n            return SceneLoaderFlags._LoggingLevel;\n        },\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        set: function (value) {\n            SceneLoaderFlags._LoggingLevel = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SceneLoaderFlags, \"CleanBoneMatrixWeights\", {\n        /**\n         * Gets or set a boolean indicating if matrix weights must be cleaned upon loading\n         */\n        get: function () {\n            return SceneLoaderFlags._CleanBoneMatrixWeights;\n        },\n        set: function (value) {\n            SceneLoaderFlags._CleanBoneMatrixWeights = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    // Flags\n    SceneLoaderFlags._ForceFullSceneLoadingForIncremental = false;\n    SceneLoaderFlags._ShowLoadingScreen = true;\n    SceneLoaderFlags._CleanBoneMatrixWeights = false;\n    SceneLoaderFlags._LoggingLevel = 0;\n    return SceneLoaderFlags;\n}());\nexport { SceneLoaderFlags };\n//# sourceMappingURL=sceneLoaderFlags.js.map","import { __decorate, __extends } from \"tslib\";\n/* eslint-disable @typescript-eslint/naming-convention */\nimport { SerializationHelper, serialize, serializeAsColor3, expandToProperty, serializeAsTexture, serializeAsVector3, serializeAsImageProcessingConfiguration, } from \"../../Misc/decorators.js\";\nimport { SmartArray } from \"../../Misc/smartArray.js\";\nimport { Logger } from \"../../Misc/logger.js\";\nimport { Vector3, Vector4 } from \"../../Maths/math.vector.js\";\nimport { VertexBuffer } from \"../../Buffers/buffer.js\";\nimport { MaterialHelper } from \"../../Materials/materialHelper.js\";\nimport { MaterialDefines } from \"../../Materials/materialDefines.js\";\nimport { PushMaterial } from \"../../Materials/pushMaterial.js\";\nimport { ImageProcessingConfiguration } from \"../../Materials/imageProcessingConfiguration.js\";\nimport { Texture } from \"../../Materials/Textures/texture.js\";\n\nimport { RegisterClass } from \"../../Misc/typeStore.js\";\nimport { MaterialFlags } from \"../materialFlags.js\";\nimport { Color3 } from \"../../Maths/math.color.js\";\nimport \"../../Shaders/background.fragment.js\";\nimport \"../../Shaders/background.vertex.js\";\nimport { EffectFallbacks } from \"../effectFallbacks.js\";\n/**\n * Background material defines definition.\n * @hidden Mainly internal Use\n */\nvar BackgroundMaterialDefines = /** @class */ (function (_super) {\n    __extends(BackgroundMaterialDefines, _super);\n    /**\n     * Constructor of the defines.\n     */\n    function BackgroundMaterialDefines() {\n        var _this = _super.call(this) || this;\n        /**\n         * True if the diffuse texture is in use.\n         */\n        _this.DIFFUSE = false;\n        /**\n         * The direct UV channel to use.\n         */\n        _this.DIFFUSEDIRECTUV = 0;\n        /**\n         * True if the diffuse texture is in gamma space.\n         */\n        _this.GAMMADIFFUSE = false;\n        /**\n         * True if the diffuse texture has opacity in the alpha channel.\n         */\n        _this.DIFFUSEHASALPHA = false;\n        /**\n         * True if you want the material to fade to transparent at grazing angle.\n         */\n        _this.OPACITYFRESNEL = false;\n        /**\n         * True if an extra blur needs to be added in the reflection.\n         */\n        _this.REFLECTIONBLUR = false;\n        /**\n         * True if you want the material to fade to reflection at grazing angle.\n         */\n        _this.REFLECTIONFRESNEL = false;\n        /**\n         * True if you want the material to falloff as far as you move away from the scene center.\n         */\n        _this.REFLECTIONFALLOFF = false;\n        /**\n         * False if the current Webgl implementation does not support the texture lod extension.\n         */\n        _this.TEXTURELODSUPPORT = false;\n        /**\n         * True to ensure the data are premultiplied.\n         */\n        _this.PREMULTIPLYALPHA = false;\n        /**\n         * True if the texture contains cooked RGB values and not gray scaled multipliers.\n         */\n        _this.USERGBCOLOR = false;\n        /**\n         * True if highlight and shadow levels have been specified. It can help ensuring the main perceived color\n         * stays aligned with the desired configuration.\n         */\n        _this.USEHIGHLIGHTANDSHADOWCOLORS = false;\n        /**\n         * True if only shadows must be rendered\n         */\n        _this.BACKMAT_SHADOWONLY = false;\n        /**\n         * True to add noise in order to reduce the banding effect.\n         */\n        _this.NOISE = false;\n        /**\n         * is the reflection texture in BGR color scheme?\n         * Mainly used to solve a bug in ios10 video tag\n         */\n        _this.REFLECTIONBGR = false;\n        _this.IMAGEPROCESSING = false;\n        _this.VIGNETTE = false;\n        _this.VIGNETTEBLENDMODEMULTIPLY = false;\n        _this.VIGNETTEBLENDMODEOPAQUE = false;\n        _this.TONEMAPPING = false;\n        _this.TONEMAPPING_ACES = false;\n        _this.CONTRAST = false;\n        _this.COLORCURVES = false;\n        _this.COLORGRADING = false;\n        _this.COLORGRADING3D = false;\n        _this.SAMPLER3DGREENDEPTH = false;\n        _this.SAMPLER3DBGRMAP = false;\n        _this.IMAGEPROCESSINGPOSTPROCESS = false;\n        _this.SKIPFINALCOLORCLAMP = false;\n        _this.EXPOSURE = false;\n        _this.MULTIVIEW = false;\n        // Reflection.\n        _this.REFLECTION = false;\n        _this.REFLECTIONMAP_3D = false;\n        _this.REFLECTIONMAP_SPHERICAL = false;\n        _this.REFLECTIONMAP_PLANAR = false;\n        _this.REFLECTIONMAP_CUBIC = false;\n        _this.REFLECTIONMAP_PROJECTION = false;\n        _this.REFLECTIONMAP_SKYBOX = false;\n        _this.REFLECTIONMAP_EXPLICIT = false;\n        _this.REFLECTIONMAP_EQUIRECTANGULAR = false;\n        _this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = false;\n        _this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = false;\n        _this.INVERTCUBICMAP = false;\n        _this.REFLECTIONMAP_OPPOSITEZ = false;\n        _this.LODINREFLECTIONALPHA = false;\n        _this.GAMMAREFLECTION = false;\n        _this.RGBDREFLECTION = false;\n        _this.EQUIRECTANGULAR_RELFECTION_FOV = false;\n        // Default BJS.\n        _this.MAINUV1 = false;\n        _this.MAINUV2 = false;\n        _this.UV1 = false;\n        _this.UV2 = false;\n        _this.CLIPPLANE = false;\n        _this.CLIPPLANE2 = false;\n        _this.CLIPPLANE3 = false;\n        _this.CLIPPLANE4 = false;\n        _this.CLIPPLANE5 = false;\n        _this.CLIPPLANE6 = false;\n        _this.POINTSIZE = false;\n        _this.FOG = false;\n        _this.NORMAL = false;\n        _this.NUM_BONE_INFLUENCERS = 0;\n        _this.BonesPerMesh = 0;\n        _this.INSTANCES = false;\n        _this.SHADOWFLOAT = false;\n        _this.LOGARITHMICDEPTH = false;\n        _this.NONUNIFORMSCALING = false;\n        _this.ALPHATEST = false;\n        _this.rebuild();\n        return _this;\n    }\n    return BackgroundMaterialDefines;\n}(MaterialDefines));\n/**\n * Background material used to create an efficient environment around your scene.\n */\nvar BackgroundMaterial = /** @class */ (function (_super) {\n    __extends(BackgroundMaterial, _super);\n    /**\n     * Instantiates a Background Material in the given scene\n     * @param name The friendly name of the material\n     * @param scene The scene to add the material to\n     */\n    function BackgroundMaterial(name, scene) {\n        var _this = _super.call(this, name, scene) || this;\n        /**\n         * Key light Color (multiply against the environment texture)\n         */\n        _this.primaryColor = Color3.White();\n        _this._primaryColorShadowLevel = 0;\n        _this._primaryColorHighlightLevel = 0;\n        /**\n         * Reflection Texture used in the material.\n         * Should be author in a specific way for the best result (refer to the documentation).\n         */\n        _this.reflectionTexture = null;\n        /**\n         * Reflection Texture level of blur.\n         *\n         * Can be use to reuse an existing HDR Texture and target a specific LOD to prevent authoring the\n         * texture twice.\n         */\n        _this.reflectionBlur = 0;\n        /**\n         * Diffuse Texture used in the material.\n         * Should be author in a specific way for the best result (refer to the documentation).\n         */\n        _this.diffuseTexture = null;\n        _this._shadowLights = null;\n        /**\n         * Specify the list of lights casting shadow on the material.\n         * All scene shadow lights will be included if null.\n         */\n        _this.shadowLights = null;\n        /**\n         * Helps adjusting the shadow to a softer level if required.\n         * 0 means black shadows and 1 means no shadows.\n         */\n        _this.shadowLevel = 0;\n        /**\n         * In case of opacity Fresnel or reflection falloff, this is use as a scene center.\n         * It is usually zero but might be interesting to modify according to your setup.\n         */\n        _this.sceneCenter = Vector3.Zero();\n        /**\n         * This helps specifying that the material is falling off to the sky box at grazing angle.\n         * This helps ensuring a nice transition when the camera goes under the ground.\n         */\n        _this.opacityFresnel = true;\n        /**\n         * This helps specifying that the material is falling off from diffuse to the reflection texture at grazing angle.\n         * This helps adding a mirror texture on the ground.\n         */\n        _this.reflectionFresnel = false;\n        /**\n         * This helps specifying the falloff radius off the reflection texture from the sceneCenter.\n         * This helps adding a nice falloff effect to the reflection if used as a mirror for instance.\n         */\n        _this.reflectionFalloffDistance = 0.0;\n        /**\n         * This specifies the weight of the reflection against the background in case of reflection Fresnel.\n         */\n        _this.reflectionAmount = 1.0;\n        /**\n         * This specifies the weight of the reflection at grazing angle.\n         */\n        _this.reflectionReflectance0 = 0.05;\n        /**\n         * This specifies the weight of the reflection at a perpendicular point of view.\n         */\n        _this.reflectionReflectance90 = 0.5;\n        /**\n         * Helps to directly use the maps channels instead of their level.\n         */\n        _this.useRGBColor = true;\n        /**\n         * This helps reducing the banding effect that could occur on the background.\n         */\n        _this.enableNoise = false;\n        _this._fovMultiplier = 1.0;\n        /**\n         * Enable the FOV adjustment feature controlled by fovMultiplier.\n         */\n        _this.useEquirectangularFOV = false;\n        _this._maxSimultaneousLights = 4;\n        /**\n         * Number of Simultaneous lights allowed on the material.\n         */\n        _this.maxSimultaneousLights = 4;\n        _this._shadowOnly = false;\n        /**\n         * Make the material only render shadows\n         */\n        _this.shadowOnly = false;\n        /**\n         * Keep track of the image processing observer to allow dispose and replace.\n         */\n        _this._imageProcessingObserver = null;\n        /**\n         * Due to a bug in iOS10, video tags (which are using the background material) are in BGR and not RGB.\n         * Setting this flag to true (not done automatically!) will convert it back to RGB.\n         */\n        _this.switchToBGR = false;\n        // Temp values kept as cache in the material.\n        _this._renderTargets = new SmartArray(16);\n        _this._reflectionControls = Vector4.Zero();\n        _this._white = Color3.White();\n        _this._primaryShadowColor = Color3.Black();\n        _this._primaryHighlightColor = Color3.Black();\n        // Setup the default processing configuration to the scene.\n        _this._attachImageProcessingConfiguration(null);\n        _this.getRenderTargetTextures = function () {\n            _this._renderTargets.reset();\n            if (_this._diffuseTexture && _this._diffuseTexture.isRenderTarget) {\n                _this._renderTargets.push(_this._diffuseTexture);\n            }\n            if (_this._reflectionTexture && _this._reflectionTexture.isRenderTarget) {\n                _this._renderTargets.push(_this._reflectionTexture);\n            }\n            return _this._renderTargets;\n        };\n        return _this;\n    }\n    Object.defineProperty(BackgroundMaterial.prototype, \"_perceptualColor\", {\n        /**\n         * Experimental Internal Use Only.\n         *\n         * Key light Color in \"perceptual value\" meaning the color you would like to see on screen.\n         * This acts as a helper to set the primary color to a more \"human friendly\" value.\n         * Conversion to linear space as well as exposure and tone mapping correction will be applied to keep the\n         * output color as close as possible from the chosen value.\n         * (This does not account for contrast color grading and color curves as they are considered post effect and not directly\n         * part of lighting setup.)\n         */\n        get: function () {\n            return this.__perceptualColor;\n        },\n        set: function (value) {\n            this.__perceptualColor = value;\n            this._computePrimaryColorFromPerceptualColor();\n            this._markAllSubMeshesAsLightsDirty();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BackgroundMaterial.prototype, \"primaryColorShadowLevel\", {\n        /**\n         * Defines the level of the shadows (dark area of the reflection map) in order to help scaling the colors.\n         * The color opposite to the primary color is used at the level chosen to define what the black area would look.\n         */\n        get: function () {\n            return this._primaryColorShadowLevel;\n        },\n        set: function (value) {\n            this._primaryColorShadowLevel = value;\n            this._computePrimaryColors();\n            this._markAllSubMeshesAsLightsDirty();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BackgroundMaterial.prototype, \"primaryColorHighlightLevel\", {\n        /**\n         * Defines the level of the highlights (highlight area of the reflection map) in order to help scaling the colors.\n         * The primary color is used at the level chosen to define what the white area would look.\n         */\n        get: function () {\n            return this._primaryColorHighlightLevel;\n        },\n        set: function (value) {\n            this._primaryColorHighlightLevel = value;\n            this._computePrimaryColors();\n            this._markAllSubMeshesAsLightsDirty();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BackgroundMaterial.prototype, \"reflectionStandardFresnelWeight\", {\n        /**\n         * Sets the reflection reflectance fresnel values according to the default standard\n         * empirically know to work well :-)\n         */\n        set: function (value) {\n            var reflectionWeight = value;\n            if (reflectionWeight < 0.5) {\n                reflectionWeight = reflectionWeight * 2.0;\n                this.reflectionReflectance0 = BackgroundMaterial.StandardReflectance0 * reflectionWeight;\n                this.reflectionReflectance90 = BackgroundMaterial.StandardReflectance90 * reflectionWeight;\n            }\n            else {\n                reflectionWeight = reflectionWeight * 2.0 - 1.0;\n                this.reflectionReflectance0 = BackgroundMaterial.StandardReflectance0 + (1.0 - BackgroundMaterial.StandardReflectance0) * reflectionWeight;\n                this.reflectionReflectance90 = BackgroundMaterial.StandardReflectance90 + (1.0 - BackgroundMaterial.StandardReflectance90) * reflectionWeight;\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BackgroundMaterial.prototype, \"fovMultiplier\", {\n        /**\n         * The current fov(field of view) multiplier, 0.0 - 2.0. Defaults to 1.0. Lower values \"zoom in\" and higher values \"zoom out\".\n         * Best used when trying to implement visual zoom effects like fish-eye or binoculars while not adjusting camera fov.\n         * Recommended to be keep at 1.0 except for special cases.\n         */\n        get: function () {\n            return this._fovMultiplier;\n        },\n        set: function (value) {\n            if (isNaN(value)) {\n                value = 1.0;\n            }\n            this._fovMultiplier = Math.max(0.0, Math.min(2.0, value));\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Attaches a new image processing configuration to the PBR Material.\n     * @param configuration (if null the scene configuration will be use)\n     */\n    BackgroundMaterial.prototype._attachImageProcessingConfiguration = function (configuration) {\n        var _this = this;\n        if (configuration === this._imageProcessingConfiguration) {\n            return;\n        }\n        // Detaches observer.\n        if (this._imageProcessingConfiguration && this._imageProcessingObserver) {\n            this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver);\n        }\n        // Pick the scene configuration if needed.\n        if (!configuration) {\n            this._imageProcessingConfiguration = this.getScene().imageProcessingConfiguration;\n        }\n        else {\n            this._imageProcessingConfiguration = configuration;\n        }\n        // Attaches observer.\n        if (this._imageProcessingConfiguration) {\n            this._imageProcessingObserver = this._imageProcessingConfiguration.onUpdateParameters.add(function () {\n                _this._computePrimaryColorFromPerceptualColor();\n                _this._markAllSubMeshesAsImageProcessingDirty();\n            });\n        }\n    };\n    Object.defineProperty(BackgroundMaterial.prototype, \"imageProcessingConfiguration\", {\n        /**\n         * Gets the image processing configuration used either in this material.\n         */\n        get: function () {\n            return this._imageProcessingConfiguration;\n        },\n        /**\n         * Sets the Default image processing configuration used either in the this material.\n         *\n         * If sets to null, the scene one is in use.\n         */\n        set: function (value) {\n            this._attachImageProcessingConfiguration(value);\n            // Ensure the effect will be rebuilt.\n            this._markAllSubMeshesAsTexturesDirty();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BackgroundMaterial.prototype, \"cameraColorCurvesEnabled\", {\n        /**\n         * Gets whether the color curves effect is enabled.\n         */\n        get: function () {\n            return this.imageProcessingConfiguration.colorCurvesEnabled;\n        },\n        /**\n         * Sets whether the color curves effect is enabled.\n         */\n        set: function (value) {\n            this.imageProcessingConfiguration.colorCurvesEnabled = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BackgroundMaterial.prototype, \"cameraColorGradingEnabled\", {\n        /**\n         * Gets whether the color grading effect is enabled.\n         */\n        get: function () {\n            return this.imageProcessingConfiguration.colorGradingEnabled;\n        },\n        /**\n         * Gets whether the color grading effect is enabled.\n         */\n        set: function (value) {\n            this.imageProcessingConfiguration.colorGradingEnabled = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BackgroundMaterial.prototype, \"cameraToneMappingEnabled\", {\n        /**\n         * Gets whether tonemapping is enabled or not.\n         */\n        get: function () {\n            return this._imageProcessingConfiguration.toneMappingEnabled;\n        },\n        /**\n         * Sets whether tonemapping is enabled or not\n         */\n        set: function (value) {\n            this._imageProcessingConfiguration.toneMappingEnabled = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BackgroundMaterial.prototype, \"cameraExposure\", {\n        /**\n         * The camera exposure used on this material.\n         * This property is here and not in the camera to allow controlling exposure without full screen post process.\n         * This corresponds to a photographic exposure.\n         */\n        get: function () {\n            return this._imageProcessingConfiguration.exposure;\n        },\n        /**\n         * The camera exposure used on this material.\n         * This property is here and not in the camera to allow controlling exposure without full screen post process.\n         * This corresponds to a photographic exposure.\n         */\n        set: function (value) {\n            this._imageProcessingConfiguration.exposure = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BackgroundMaterial.prototype, \"cameraContrast\", {\n        /**\n         * Gets The camera contrast used on this material.\n         */\n        get: function () {\n            return this._imageProcessingConfiguration.contrast;\n        },\n        /**\n         * Sets The camera contrast used on this material.\n         */\n        set: function (value) {\n            this._imageProcessingConfiguration.contrast = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BackgroundMaterial.prototype, \"cameraColorGradingTexture\", {\n        /**\n         * Gets the Color Grading 2D Lookup Texture.\n         */\n        get: function () {\n            return this._imageProcessingConfiguration.colorGradingTexture;\n        },\n        /**\n         * Sets the Color Grading 2D Lookup Texture.\n         */\n        set: function (value) {\n            this.imageProcessingConfiguration.colorGradingTexture = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BackgroundMaterial.prototype, \"cameraColorCurves\", {\n        /**\n         * The color grading curves provide additional color adjustment that is applied after any color grading transform (3D LUT).\n         * They allow basic adjustment of saturation and small exposure adjustments, along with color filter tinting to provide white balance adjustment or more stylistic effects.\n         * These are similar to controls found in many professional imaging or colorist software. The global controls are applied to the entire image. For advanced tuning, extra controls are provided to adjust the shadow, midtone and highlight areas of the image;\n         * corresponding to low luminance, medium luminance, and high luminance areas respectively.\n         */\n        get: function () {\n            return this.imageProcessingConfiguration.colorCurves;\n        },\n        /**\n         * The color grading curves provide additional color adjustment that is applied after any color grading transform (3D LUT).\n         * They allow basic adjustment of saturation and small exposure adjustments, along with color filter tinting to provide white balance adjustment or more stylistic effects.\n         * These are similar to controls found in many professional imaging or colorist software. The global controls are applied to the entire image. For advanced tuning, extra controls are provided to adjust the shadow, midtone and highlight areas of the image;\n         * corresponding to low luminance, medium luminance, and high luminance areas respectively.\n         */\n        set: function (value) {\n            this.imageProcessingConfiguration.colorCurves = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BackgroundMaterial.prototype, \"hasRenderTargetTextures\", {\n        /**\n         * Gets a boolean indicating that current material needs to register RTT\n         */\n        get: function () {\n            if (this._diffuseTexture && this._diffuseTexture.isRenderTarget) {\n                return true;\n            }\n            if (this._reflectionTexture && this._reflectionTexture.isRenderTarget) {\n                return true;\n            }\n            return false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * The entire material has been created in order to prevent overdraw.\n     * @returns false\n     */\n    BackgroundMaterial.prototype.needAlphaTesting = function () {\n        return true;\n    };\n    /**\n     * The entire material has been created in order to prevent overdraw.\n     * @returns true if blending is enable\n     */\n    BackgroundMaterial.prototype.needAlphaBlending = function () {\n        return this.alpha < 1 || (this._diffuseTexture != null && this._diffuseTexture.hasAlpha) || this._shadowOnly;\n    };\n    /**\n     * Checks whether the material is ready to be rendered for a given mesh.\n     * @param mesh The mesh to render\n     * @param subMesh The submesh to check against\n     * @param useInstances Specify wether or not the material is used with instances\n     * @returns true if all the dependencies are ready (Textures, Effects...)\n     */\n    BackgroundMaterial.prototype.isReadyForSubMesh = function (mesh, subMesh, useInstances) {\n        if (useInstances === void 0) { useInstances = false; }\n        if (subMesh.effect && this.isFrozen) {\n            if (subMesh.effect._wasPreviouslyReady) {\n                return true;\n            }\n        }\n        if (!subMesh.materialDefines) {\n            subMesh.materialDefines = new BackgroundMaterialDefines();\n        }\n        var scene = this.getScene();\n        var defines = subMesh.materialDefines;\n        if (this._isReadyForSubMesh(subMesh)) {\n            return true;\n        }\n        var engine = scene.getEngine();\n        // Lights\n        MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, false, this._maxSimultaneousLights);\n        defines._needNormals = true;\n        // Multiview\n        MaterialHelper.PrepareDefinesForMultiview(scene, defines);\n        // Textures\n        if (defines._areTexturesDirty) {\n            defines._needUVs = false;\n            if (scene.texturesEnabled) {\n                if (scene.getEngine().getCaps().textureLOD) {\n                    defines.TEXTURELODSUPPORT = true;\n                }\n                if (this._diffuseTexture && MaterialFlags.DiffuseTextureEnabled) {\n                    if (!this._diffuseTexture.isReadyOrNotBlocking()) {\n                        return false;\n                    }\n                    MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture, defines, \"DIFFUSE\");\n                    defines.DIFFUSEHASALPHA = this._diffuseTexture.hasAlpha;\n                    defines.GAMMADIFFUSE = this._diffuseTexture.gammaSpace;\n                    defines.OPACITYFRESNEL = this._opacityFresnel;\n                }\n                else {\n                    defines.DIFFUSE = false;\n                    defines.DIFFUSEHASALPHA = false;\n                    defines.GAMMADIFFUSE = false;\n                    defines.OPACITYFRESNEL = false;\n                }\n                var reflectionTexture = this._reflectionTexture;\n                if (reflectionTexture && MaterialFlags.ReflectionTextureEnabled) {\n                    if (!reflectionTexture.isReadyOrNotBlocking()) {\n                        return false;\n                    }\n                    defines.REFLECTION = true;\n                    defines.GAMMAREFLECTION = reflectionTexture.gammaSpace;\n                    defines.RGBDREFLECTION = reflectionTexture.isRGBD;\n                    defines.REFLECTIONBLUR = this._reflectionBlur > 0;\n                    defines.LODINREFLECTIONALPHA = reflectionTexture.lodLevelInAlpha;\n                    defines.EQUIRECTANGULAR_RELFECTION_FOV = this.useEquirectangularFOV;\n                    defines.REFLECTIONBGR = this.switchToBGR;\n                    if (reflectionTexture.coordinatesMode === Texture.INVCUBIC_MODE) {\n                        defines.INVERTCUBICMAP = true;\n                    }\n                    defines.REFLECTIONMAP_3D = reflectionTexture.isCube;\n                    defines.REFLECTIONMAP_OPPOSITEZ = defines.REFLECTIONMAP_3D && this.getScene().useRightHandedSystem ? !reflectionTexture.invertZ : reflectionTexture.invertZ;\n                    switch (reflectionTexture.coordinatesMode) {\n                        case Texture.EXPLICIT_MODE:\n                            defines.REFLECTIONMAP_EXPLICIT = true;\n                            break;\n                        case Texture.PLANAR_MODE:\n                            defines.REFLECTIONMAP_PLANAR = true;\n                            break;\n                        case Texture.PROJECTION_MODE:\n                            defines.REFLECTIONMAP_PROJECTION = true;\n                            break;\n                        case Texture.SKYBOX_MODE:\n                            defines.REFLECTIONMAP_SKYBOX = true;\n                            break;\n                        case Texture.SPHERICAL_MODE:\n                            defines.REFLECTIONMAP_SPHERICAL = true;\n                            break;\n                        case Texture.EQUIRECTANGULAR_MODE:\n                            defines.REFLECTIONMAP_EQUIRECTANGULAR = true;\n                            break;\n                        case Texture.FIXED_EQUIRECTANGULAR_MODE:\n                            defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = true;\n                            break;\n                        case Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:\n                            defines.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = true;\n                            break;\n                        case Texture.CUBIC_MODE:\n                        case Texture.INVCUBIC_MODE:\n                        default:\n                            defines.REFLECTIONMAP_CUBIC = true;\n                            break;\n                    }\n                    if (this.reflectionFresnel) {\n                        defines.REFLECTIONFRESNEL = true;\n                        defines.REFLECTIONFALLOFF = this.reflectionFalloffDistance > 0;\n                        this._reflectionControls.x = this.reflectionAmount;\n                        this._reflectionControls.y = this.reflectionReflectance0;\n                        this._reflectionControls.z = this.reflectionReflectance90;\n                        this._reflectionControls.w = 1 / this.reflectionFalloffDistance;\n                    }\n                    else {\n                        defines.REFLECTIONFRESNEL = false;\n                        defines.REFLECTIONFALLOFF = false;\n                    }\n                }\n                else {\n                    defines.REFLECTION = false;\n                    defines.REFLECTIONFRESNEL = false;\n                    defines.REFLECTIONFALLOFF = false;\n                    defines.REFLECTIONBLUR = false;\n                    defines.REFLECTIONMAP_3D = false;\n                    defines.REFLECTIONMAP_SPHERICAL = false;\n                    defines.REFLECTIONMAP_PLANAR = false;\n                    defines.REFLECTIONMAP_CUBIC = false;\n                    defines.REFLECTIONMAP_PROJECTION = false;\n                    defines.REFLECTIONMAP_SKYBOX = false;\n                    defines.REFLECTIONMAP_EXPLICIT = false;\n                    defines.REFLECTIONMAP_EQUIRECTANGULAR = false;\n                    defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = false;\n                    defines.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = false;\n                    defines.INVERTCUBICMAP = false;\n                    defines.REFLECTIONMAP_OPPOSITEZ = false;\n                    defines.LODINREFLECTIONALPHA = false;\n                    defines.GAMMAREFLECTION = false;\n                    defines.RGBDREFLECTION = false;\n                }\n            }\n            defines.PREMULTIPLYALPHA = this.alphaMode === 7 || this.alphaMode === 8;\n            defines.USERGBCOLOR = this._useRGBColor;\n            defines.NOISE = this._enableNoise;\n        }\n        if (defines._areLightsDirty) {\n            defines.USEHIGHLIGHTANDSHADOWCOLORS = !this._useRGBColor && (this._primaryColorShadowLevel !== 0 || this._primaryColorHighlightLevel !== 0);\n            defines.BACKMAT_SHADOWONLY = this._shadowOnly;\n        }\n        if (defines._areImageProcessingDirty && this._imageProcessingConfiguration) {\n            if (!this._imageProcessingConfiguration.isReady()) {\n                return false;\n            }\n            this._imageProcessingConfiguration.prepareDefines(defines);\n        }\n        // Misc.\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(mesh), defines);\n        // Values that need to be evaluated on every frame\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances, null, subMesh.getRenderingMesh().hasThinInstances);\n        // Attribs\n        if (MaterialHelper.PrepareDefinesForAttributes(mesh, defines, false, true, false)) {\n            if (mesh) {\n                if (!scene.getEngine().getCaps().standardDerivatives && !mesh.isVerticesDataPresent(VertexBuffer.NormalKind)) {\n                    mesh.createNormals(true);\n                    Logger.Warn(\"BackgroundMaterial: Normals have been created for the mesh: \" + mesh.name);\n                }\n            }\n        }\n        // Get correct effect\n        if (defines.isDirty) {\n            defines.markAsProcessed();\n            scene.resetCachedMaterial();\n            // Fallbacks\n            var fallbacks = new EffectFallbacks();\n            if (defines.FOG) {\n                fallbacks.addFallback(0, \"FOG\");\n            }\n            if (defines.POINTSIZE) {\n                fallbacks.addFallback(1, \"POINTSIZE\");\n            }\n            if (defines.MULTIVIEW) {\n                fallbacks.addFallback(0, \"MULTIVIEW\");\n            }\n            MaterialHelper.HandleFallbacksForShadows(defines, fallbacks, this._maxSimultaneousLights);\n            //Attributes\n            var attribs = [VertexBuffer.PositionKind];\n            if (defines.NORMAL) {\n                attribs.push(VertexBuffer.NormalKind);\n            }\n            if (defines.UV1) {\n                attribs.push(VertexBuffer.UVKind);\n            }\n            if (defines.UV2) {\n                attribs.push(VertexBuffer.UV2Kind);\n            }\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\n            var uniforms = [\n                \"world\",\n                \"view\",\n                \"viewProjection\",\n                \"vEyePosition\",\n                \"vLightsType\",\n                \"vFogInfos\",\n                \"vFogColor\",\n                \"pointSize\",\n                \"vClipPlane\",\n                \"vClipPlane2\",\n                \"vClipPlane3\",\n                \"vClipPlane4\",\n                \"vClipPlane5\",\n                \"vClipPlane6\",\n                \"mBones\",\n                \"vPrimaryColor\",\n                \"vPrimaryColorShadow\",\n                \"vReflectionInfos\",\n                \"reflectionMatrix\",\n                \"vReflectionMicrosurfaceInfos\",\n                \"fFovMultiplier\",\n                \"shadowLevel\",\n                \"alpha\",\n                \"vBackgroundCenter\",\n                \"vReflectionControl\",\n                \"vDiffuseInfos\",\n                \"diffuseMatrix\",\n            ];\n            var samplers = [\"diffuseSampler\", \"reflectionSampler\", \"reflectionSamplerLow\", \"reflectionSamplerHigh\"];\n            var uniformBuffers = [\"Material\", \"Scene\"];\n            if (ImageProcessingConfiguration) {\n                ImageProcessingConfiguration.PrepareUniforms(uniforms, defines);\n                ImageProcessingConfiguration.PrepareSamplers(samplers, defines);\n            }\n            MaterialHelper.PrepareUniformsAndSamplersList({\n                uniformsNames: uniforms,\n                uniformBuffersNames: uniformBuffers,\n                samplers: samplers,\n                defines: defines,\n                maxSimultaneousLights: this._maxSimultaneousLights,\n            });\n            var join = defines.toString();\n            var effect = scene.getEngine().createEffect(\"background\", {\n                attributes: attribs,\n                uniformsNames: uniforms,\n                uniformBuffersNames: uniformBuffers,\n                samplers: samplers,\n                defines: join,\n                fallbacks: fallbacks,\n                onCompiled: this.onCompiled,\n                onError: this.onError,\n                indexParameters: { maxSimultaneousLights: this._maxSimultaneousLights },\n            }, engine);\n            subMesh.setEffect(effect, defines, this._materialContext);\n            this.buildUniformLayout();\n        }\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\n            return false;\n        }\n        defines._renderId = scene.getRenderId();\n        subMesh.effect._wasPreviouslyReady = true;\n        return true;\n    };\n    /**\n     * Compute the primary color according to the chosen perceptual color.\n     */\n    BackgroundMaterial.prototype._computePrimaryColorFromPerceptualColor = function () {\n        if (!this.__perceptualColor) {\n            return;\n        }\n        this._primaryColor.copyFrom(this.__perceptualColor);\n        // Revert gamma space.\n        this._primaryColor.toLinearSpaceToRef(this._primaryColor);\n        // Revert image processing configuration.\n        if (this._imageProcessingConfiguration) {\n            // Revert Exposure.\n            this._primaryColor.scaleToRef(1 / this._imageProcessingConfiguration.exposure, this._primaryColor);\n        }\n        this._computePrimaryColors();\n    };\n    /**\n     * Compute the highlights and shadow colors according to their chosen levels.\n     */\n    BackgroundMaterial.prototype._computePrimaryColors = function () {\n        if (this._primaryColorShadowLevel === 0 && this._primaryColorHighlightLevel === 0) {\n            return;\n        }\n        // Find the highlight color based on the configuration.\n        this._primaryColor.scaleToRef(this._primaryColorShadowLevel, this._primaryShadowColor);\n        this._primaryColor.subtractToRef(this._primaryShadowColor, this._primaryShadowColor);\n        // Find the shadow color based on the configuration.\n        this._white.subtractToRef(this._primaryColor, this._primaryHighlightColor);\n        this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel, this._primaryHighlightColor);\n        this._primaryColor.addToRef(this._primaryHighlightColor, this._primaryHighlightColor);\n    };\n    /**\n     * Build the uniform buffer used in the material.\n     */\n    BackgroundMaterial.prototype.buildUniformLayout = function () {\n        // Order is important !\n        this._uniformBuffer.addUniform(\"vPrimaryColor\", 4);\n        this._uniformBuffer.addUniform(\"vPrimaryColorShadow\", 4);\n        this._uniformBuffer.addUniform(\"vDiffuseInfos\", 2);\n        this._uniformBuffer.addUniform(\"vReflectionInfos\", 2);\n        this._uniformBuffer.addUniform(\"diffuseMatrix\", 16);\n        this._uniformBuffer.addUniform(\"reflectionMatrix\", 16);\n        this._uniformBuffer.addUniform(\"vReflectionMicrosurfaceInfos\", 3);\n        this._uniformBuffer.addUniform(\"fFovMultiplier\", 1);\n        this._uniformBuffer.addUniform(\"pointSize\", 1);\n        this._uniformBuffer.addUniform(\"shadowLevel\", 1);\n        this._uniformBuffer.addUniform(\"alpha\", 1);\n        this._uniformBuffer.addUniform(\"vBackgroundCenter\", 3);\n        this._uniformBuffer.addUniform(\"vReflectionControl\", 4);\n        this._uniformBuffer.create();\n    };\n    /**\n     * Unbind the material.\n     */\n    BackgroundMaterial.prototype.unbind = function () {\n        if (this._diffuseTexture && this._diffuseTexture.isRenderTarget) {\n            this._uniformBuffer.setTexture(\"diffuseSampler\", null);\n        }\n        if (this._reflectionTexture && this._reflectionTexture.isRenderTarget) {\n            this._uniformBuffer.setTexture(\"reflectionSampler\", null);\n        }\n        _super.prototype.unbind.call(this);\n    };\n    /**\n     * Bind only the world matrix to the material.\n     * @param world The world matrix to bind.\n     */\n    BackgroundMaterial.prototype.bindOnlyWorldMatrix = function (world) {\n        this._activeEffect.setMatrix(\"world\", world);\n    };\n    /**\n     * Bind the material for a dedicated submeh (every used meshes will be considered opaque).\n     * @param world The world matrix to bind.\n     * @param mesh\n     * @param subMesh The submesh to bind for.\n     */\n    BackgroundMaterial.prototype.bindForSubMesh = function (world, mesh, subMesh) {\n        var scene = this.getScene();\n        var defines = subMesh.materialDefines;\n        if (!defines) {\n            return;\n        }\n        var effect = subMesh.effect;\n        if (!effect) {\n            return;\n        }\n        this._activeEffect = effect;\n        // Matrices\n        this.bindOnlyWorldMatrix(world);\n        // Bones\n        MaterialHelper.BindBonesParameters(mesh, this._activeEffect);\n        var mustRebind = this._mustRebind(scene, effect, mesh.visibility);\n        if (mustRebind) {\n            this._uniformBuffer.bindToEffect(effect, \"Material\");\n            this.bindViewProjection(effect);\n            var reflectionTexture = this._reflectionTexture;\n            if (!this._uniformBuffer.useUbo || !this.isFrozen || !this._uniformBuffer.isSync) {\n                // Texture uniforms\n                if (scene.texturesEnabled) {\n                    if (this._diffuseTexture && MaterialFlags.DiffuseTextureEnabled) {\n                        this._uniformBuffer.updateFloat2(\"vDiffuseInfos\", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level);\n                        MaterialHelper.BindTextureMatrix(this._diffuseTexture, this._uniformBuffer, \"diffuse\");\n                    }\n                    if (reflectionTexture && MaterialFlags.ReflectionTextureEnabled) {\n                        this._uniformBuffer.updateMatrix(\"reflectionMatrix\", reflectionTexture.getReflectionTextureMatrix());\n                        this._uniformBuffer.updateFloat2(\"vReflectionInfos\", reflectionTexture.level, this._reflectionBlur);\n                        this._uniformBuffer.updateFloat3(\"vReflectionMicrosurfaceInfos\", reflectionTexture.getSize().width, reflectionTexture.lodGenerationScale, reflectionTexture.lodGenerationOffset);\n                    }\n                }\n                if (this.shadowLevel > 0) {\n                    this._uniformBuffer.updateFloat(\"shadowLevel\", this.shadowLevel);\n                }\n                this._uniformBuffer.updateFloat(\"alpha\", this.alpha);\n                // Point size\n                if (this.pointsCloud) {\n                    this._uniformBuffer.updateFloat(\"pointSize\", this.pointSize);\n                }\n                if (defines.USEHIGHLIGHTANDSHADOWCOLORS) {\n                    this._uniformBuffer.updateColor4(\"vPrimaryColor\", this._primaryHighlightColor, 1.0);\n                    this._uniformBuffer.updateColor4(\"vPrimaryColorShadow\", this._primaryShadowColor, 1.0);\n                }\n                else {\n                    this._uniformBuffer.updateColor4(\"vPrimaryColor\", this._primaryColor, 1.0);\n                }\n            }\n            this._uniformBuffer.updateFloat(\"fFovMultiplier\", this._fovMultiplier);\n            // Textures\n            if (scene.texturesEnabled) {\n                if (this._diffuseTexture && MaterialFlags.DiffuseTextureEnabled) {\n                    this._uniformBuffer.setTexture(\"diffuseSampler\", this._diffuseTexture);\n                }\n                if (reflectionTexture && MaterialFlags.ReflectionTextureEnabled) {\n                    if (defines.REFLECTIONBLUR && defines.TEXTURELODSUPPORT) {\n                        this._uniformBuffer.setTexture(\"reflectionSampler\", reflectionTexture);\n                    }\n                    else if (!defines.REFLECTIONBLUR) {\n                        this._uniformBuffer.setTexture(\"reflectionSampler\", reflectionTexture);\n                    }\n                    else {\n                        this._uniformBuffer.setTexture(\"reflectionSampler\", reflectionTexture._lodTextureMid || reflectionTexture);\n                        this._uniformBuffer.setTexture(\"reflectionSamplerLow\", reflectionTexture._lodTextureLow || reflectionTexture);\n                        this._uniformBuffer.setTexture(\"reflectionSamplerHigh\", reflectionTexture._lodTextureHigh || reflectionTexture);\n                    }\n                    if (defines.REFLECTIONFRESNEL) {\n                        this._uniformBuffer.updateFloat3(\"vBackgroundCenter\", this.sceneCenter.x, this.sceneCenter.y, this.sceneCenter.z);\n                        this._uniformBuffer.updateFloat4(\"vReflectionControl\", this._reflectionControls.x, this._reflectionControls.y, this._reflectionControls.z, this._reflectionControls.w);\n                    }\n                }\n            }\n            // Clip plane\n            MaterialHelper.BindClipPlane(this._activeEffect, scene);\n            scene.bindEyePosition(effect);\n        }\n        else if (scene.getEngine()._features.needToAlwaysBindUniformBuffers) {\n            this._uniformBuffer.bindToEffect(effect, \"Material\");\n            this._needToBindSceneUbo = true;\n        }\n        if (mustRebind || !this.isFrozen) {\n            if (scene.lightsEnabled) {\n                MaterialHelper.BindLights(scene, mesh, this._activeEffect, defines, this._maxSimultaneousLights);\n            }\n            // View\n            this.bindView(effect);\n            // Fog\n            MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect, true);\n            // image processing\n            if (this._imageProcessingConfiguration) {\n                this._imageProcessingConfiguration.bind(this._activeEffect);\n            }\n        }\n        this._afterBind(mesh, this._activeEffect);\n        this._uniformBuffer.update();\n    };\n    /**\n     * Checks to see if a texture is used in the material.\n     * @param texture - Base texture to use.\n     * @returns - Boolean specifying if a texture is used in the material.\n     */\n    BackgroundMaterial.prototype.hasTexture = function (texture) {\n        if (_super.prototype.hasTexture.call(this, texture)) {\n            return true;\n        }\n        if (this._reflectionTexture === texture) {\n            return true;\n        }\n        if (this._diffuseTexture === texture) {\n            return true;\n        }\n        return false;\n    };\n    /**\n     * Dispose the material.\n     * @param forceDisposeEffect Force disposal of the associated effect.\n     * @param forceDisposeTextures Force disposal of the associated textures.\n     */\n    BackgroundMaterial.prototype.dispose = function (forceDisposeEffect, forceDisposeTextures) {\n        if (forceDisposeEffect === void 0) { forceDisposeEffect = false; }\n        if (forceDisposeTextures === void 0) { forceDisposeTextures = false; }\n        if (forceDisposeTextures) {\n            if (this.diffuseTexture) {\n                this.diffuseTexture.dispose();\n            }\n            if (this.reflectionTexture) {\n                this.reflectionTexture.dispose();\n            }\n        }\n        this._renderTargets.dispose();\n        if (this._imageProcessingConfiguration && this._imageProcessingObserver) {\n            this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver);\n        }\n        _super.prototype.dispose.call(this, forceDisposeEffect);\n    };\n    /**\n     * Clones the material.\n     * @param name The cloned name.\n     * @returns The cloned material.\n     */\n    BackgroundMaterial.prototype.clone = function (name) {\n        var _this = this;\n        return SerializationHelper.Clone(function () { return new BackgroundMaterial(name, _this.getScene()); }, this);\n    };\n    /**\n     * Serializes the current material to its JSON representation.\n     * @returns The JSON representation.\n     */\n    BackgroundMaterial.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        serializationObject.customType = \"BABYLON.BackgroundMaterial\";\n        return serializationObject;\n    };\n    /**\n     * Gets the class name of the material\n     * @returns \"BackgroundMaterial\"\n     */\n    BackgroundMaterial.prototype.getClassName = function () {\n        return \"BackgroundMaterial\";\n    };\n    /**\n     * Parse a JSON input to create back a background material.\n     * @param source The JSON data to parse\n     * @param scene The scene to create the parsed material in\n     * @param rootUrl The root url of the assets the material depends upon\n     * @returns the instantiated BackgroundMaterial.\n     */\n    BackgroundMaterial.Parse = function (source, scene, rootUrl) {\n        return SerializationHelper.Parse(function () { return new BackgroundMaterial(source.name, scene); }, source, scene, rootUrl);\n    };\n    /**\n     * Standard reflectance value at parallel view angle.\n     */\n    BackgroundMaterial.StandardReflectance0 = 0.05;\n    /**\n     * Standard reflectance value at grazing angle.\n     */\n    BackgroundMaterial.StandardReflectance90 = 0.5;\n    __decorate([\n        serializeAsColor3()\n    ], BackgroundMaterial.prototype, \"_primaryColor\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\n    ], BackgroundMaterial.prototype, \"primaryColor\", void 0);\n    __decorate([\n        serializeAsColor3()\n    ], BackgroundMaterial.prototype, \"__perceptualColor\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_primaryColorShadowLevel\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_primaryColorHighlightLevel\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\n    ], BackgroundMaterial.prototype, \"primaryColorHighlightLevel\", null);\n    __decorate([\n        serializeAsTexture()\n    ], BackgroundMaterial.prototype, \"_reflectionTexture\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"reflectionTexture\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_reflectionBlur\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"reflectionBlur\", void 0);\n    __decorate([\n        serializeAsTexture()\n    ], BackgroundMaterial.prototype, \"_diffuseTexture\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"diffuseTexture\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"shadowLights\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_shadowLevel\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"shadowLevel\", void 0);\n    __decorate([\n        serializeAsVector3()\n    ], BackgroundMaterial.prototype, \"_sceneCenter\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"sceneCenter\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_opacityFresnel\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"opacityFresnel\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_reflectionFresnel\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"reflectionFresnel\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_reflectionFalloffDistance\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"reflectionFalloffDistance\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_reflectionAmount\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"reflectionAmount\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_reflectionReflectance0\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"reflectionReflectance0\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_reflectionReflectance90\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"reflectionReflectance90\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_useRGBColor\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"useRGBColor\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_enableNoise\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"enableNoise\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_maxSimultaneousLights\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    ], BackgroundMaterial.prototype, \"maxSimultaneousLights\", void 0);\n    __decorate([\n        serialize()\n    ], BackgroundMaterial.prototype, \"_shadowOnly\", void 0);\n    __decorate([\n        expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\n    ], BackgroundMaterial.prototype, \"shadowOnly\", void 0);\n    __decorate([\n        serializeAsImageProcessingConfiguration()\n    ], BackgroundMaterial.prototype, \"_imageProcessingConfiguration\", void 0);\n    return BackgroundMaterial;\n}(PushMaterial));\nexport { BackgroundMaterial };\nRegisterClass(\"BABYLON.BackgroundMaterial\", BackgroundMaterial);\n//# sourceMappingURL=backgroundMaterial.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { Texture } from \"../../../Textures/texture.js\";\n/**\n * Base block used as input for post process\n */\nvar CurrentScreenBlock = /** @class */ (function (_super) {\n    __extends(CurrentScreenBlock, _super);\n    /**\n     * Create a new CurrentScreenBlock\n     * @param name defines the block name\n     */\n    function CurrentScreenBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.VertexAndFragment) || this;\n        _this._samplerName = \"textureSampler\";\n        /**\n         * Gets or sets a boolean indicating if content needs to be converted to gamma space\n         */\n        _this.convertToGammaSpace = false;\n        /**\n         * Gets or sets a boolean indicating if content needs to be converted to linear space\n         */\n        _this.convertToLinearSpace = false;\n        _this._isUnique = false;\n        _this.registerInput(\"uv\", NodeMaterialBlockConnectionPointTypes.Vector2, false, NodeMaterialBlockTargets.VertexAndFragment);\n        _this.registerOutput(\"rgba\", NodeMaterialBlockConnectionPointTypes.Color4, NodeMaterialBlockTargets.Neutral);\n        _this.registerOutput(\"rgb\", NodeMaterialBlockConnectionPointTypes.Color3, NodeMaterialBlockTargets.Neutral);\n        _this.registerOutput(\"r\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Neutral);\n        _this.registerOutput(\"g\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Neutral);\n        _this.registerOutput(\"b\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Neutral);\n        _this.registerOutput(\"a\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Neutral);\n        _this._inputs[0].acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Vector3);\n        _this._inputs[0].acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Vector4);\n        _this._inputs[0]._prioritizeVertex = false;\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    CurrentScreenBlock.prototype.getClassName = function () {\n        return \"CurrentScreenBlock\";\n    };\n    Object.defineProperty(CurrentScreenBlock.prototype, \"uv\", {\n        /**\n         * Gets the uv input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CurrentScreenBlock.prototype, \"rgba\", {\n        /**\n         * Gets the rgba output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CurrentScreenBlock.prototype, \"rgb\", {\n        /**\n         * Gets the rgb output component\n         */\n        get: function () {\n            return this._outputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CurrentScreenBlock.prototype, \"r\", {\n        /**\n         * Gets the r output component\n         */\n        get: function () {\n            return this._outputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CurrentScreenBlock.prototype, \"g\", {\n        /**\n         * Gets the g output component\n         */\n        get: function () {\n            return this._outputs[3];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CurrentScreenBlock.prototype, \"b\", {\n        /**\n         * Gets the b output component\n         */\n        get: function () {\n            return this._outputs[4];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(CurrentScreenBlock.prototype, \"a\", {\n        /**\n         * Gets the a output component\n         */\n        get: function () {\n            return this._outputs[5];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Initialize the block and prepare the context for build\n     * @param state defines the state that will be used for the build\n     */\n    CurrentScreenBlock.prototype.initialize = function (state) {\n        state._excludeVariableName(\"textureSampler\");\n    };\n    Object.defineProperty(CurrentScreenBlock.prototype, \"target\", {\n        get: function () {\n            if (!this.uv.isConnected) {\n                return NodeMaterialBlockTargets.VertexAndFragment;\n            }\n            if (this.uv.sourceBlock.isInput) {\n                return NodeMaterialBlockTargets.VertexAndFragment;\n            }\n            return NodeMaterialBlockTargets.Fragment;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    CurrentScreenBlock.prototype.prepareDefines = function (mesh, nodeMaterial, defines) {\n        defines.setValue(this._linearDefineName, this.convertToGammaSpace, true);\n        defines.setValue(this._gammaDefineName, this.convertToLinearSpace, true);\n    };\n    CurrentScreenBlock.prototype.isReady = function () {\n        if (this.texture && !this.texture.isReadyOrNotBlocking()) {\n            return false;\n        }\n        return true;\n    };\n    CurrentScreenBlock.prototype._injectVertexCode = function (state) {\n        var uvInput = this.uv;\n        if (uvInput.connectedPoint.ownerBlock.isInput) {\n            var uvInputOwnerBlock = uvInput.connectedPoint.ownerBlock;\n            if (!uvInputOwnerBlock.isAttribute) {\n                state._emitUniformFromString(uvInput.associatedVariableName, \"vec2\");\n            }\n        }\n        this._mainUVName = \"vMain\" + uvInput.associatedVariableName;\n        state._emitVaryingFromString(this._mainUVName, \"vec2\");\n        state.compilationString += \"\".concat(this._mainUVName, \" = \").concat(uvInput.associatedVariableName, \".xy;\\r\\n\");\n        if (!this._outputs.some(function (o) { return o.isConnectedInVertexShader; })) {\n            return;\n        }\n        this._writeTextureRead(state, true);\n        for (var _i = 0, _a = this._outputs; _i < _a.length; _i++) {\n            var output = _a[_i];\n            if (output.hasEndpoints) {\n                this._writeOutput(state, output, output.name, true);\n            }\n        }\n    };\n    CurrentScreenBlock.prototype._writeTextureRead = function (state, vertexMode) {\n        if (vertexMode === void 0) { vertexMode = false; }\n        var uvInput = this.uv;\n        if (vertexMode) {\n            if (state.target === NodeMaterialBlockTargets.Fragment) {\n                return;\n            }\n            state.compilationString += \"vec4 \".concat(this._tempTextureRead, \" = texture2D(\").concat(this._samplerName, \", \").concat(uvInput.associatedVariableName, \");\\r\\n\");\n            return;\n        }\n        if (this.uv.ownerBlock.target === NodeMaterialBlockTargets.Fragment) {\n            state.compilationString += \"vec4 \".concat(this._tempTextureRead, \" = texture2D(\").concat(this._samplerName, \", \").concat(uvInput.associatedVariableName, \");\\r\\n\");\n            return;\n        }\n        state.compilationString += \"vec4 \".concat(this._tempTextureRead, \" = texture2D(\").concat(this._samplerName, \", \").concat(this._mainUVName, \");\\r\\n\");\n    };\n    CurrentScreenBlock.prototype._writeOutput = function (state, output, swizzle, vertexMode) {\n        if (vertexMode === void 0) { vertexMode = false; }\n        if (vertexMode) {\n            if (state.target === NodeMaterialBlockTargets.Fragment) {\n                return;\n            }\n            state.compilationString += \"\".concat(this._declareOutput(output, state), \" = \").concat(this._tempTextureRead, \".\").concat(swizzle, \";\\r\\n\");\n            return;\n        }\n        if (this.uv.ownerBlock.target === NodeMaterialBlockTargets.Fragment) {\n            state.compilationString += \"\".concat(this._declareOutput(output, state), \" = \").concat(this._tempTextureRead, \".\").concat(swizzle, \";\\r\\n\");\n            return;\n        }\n        state.compilationString += \"\".concat(this._declareOutput(output, state), \" = \").concat(this._tempTextureRead, \".\").concat(swizzle, \";\\r\\n\");\n        state.compilationString += \"#ifdef \".concat(this._linearDefineName, \"\\r\\n\");\n        state.compilationString += \"\".concat(output.associatedVariableName, \" = toGammaSpace(\").concat(output.associatedVariableName, \");\\r\\n\");\n        state.compilationString += \"#endif\\r\\n\";\n        state.compilationString += \"#ifdef \".concat(this._gammaDefineName, \"\\r\\n\");\n        state.compilationString += \"\".concat(output.associatedVariableName, \" = toLinearSpace(\").concat(output.associatedVariableName, \");\\r\\n\");\n        state.compilationString += \"#endif\\r\\n\";\n    };\n    CurrentScreenBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        this._tempTextureRead = state._getFreeVariableName(\"tempTextureRead\");\n        if (state.sharedData.blockingBlocks.indexOf(this) < 0) {\n            state.sharedData.blockingBlocks.push(this);\n        }\n        if (state.sharedData.textureBlocks.indexOf(this) < 0) {\n            state.sharedData.textureBlocks.push(this);\n        }\n        if (state.sharedData.blocksWithDefines.indexOf(this) < 0) {\n            state.sharedData.blocksWithDefines.push(this);\n        }\n        if (state.target !== NodeMaterialBlockTargets.Fragment) {\n            // Vertex\n            state._emit2DSampler(this._samplerName);\n            this._injectVertexCode(state);\n            return;\n        }\n        // Fragment\n        if (!this._outputs.some(function (o) { return o.isConnectedInFragmentShader; })) {\n            return;\n        }\n        state._emit2DSampler(this._samplerName);\n        this._linearDefineName = state._getFreeDefineName(\"ISLINEAR\");\n        this._gammaDefineName = state._getFreeDefineName(\"ISGAMMA\");\n        var comments = \"//\".concat(this.name);\n        state._emitFunctionFromInclude(\"helperFunctions\", comments);\n        this._writeTextureRead(state);\n        for (var _i = 0, _a = this._outputs; _i < _a.length; _i++) {\n            var output = _a[_i];\n            if (output.hasEndpoints) {\n                this._writeOutput(state, output, output.name);\n            }\n        }\n        return this;\n    };\n    CurrentScreenBlock.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        serializationObject.convertToGammaSpace = this.convertToGammaSpace;\n        serializationObject.convertToLinearSpace = this.convertToLinearSpace;\n        if (this.texture && !this.texture.isRenderTarget) {\n            serializationObject.texture = this.texture.serialize();\n        }\n        return serializationObject;\n    };\n    CurrentScreenBlock.prototype._deserialize = function (serializationObject, scene, rootUrl) {\n        _super.prototype._deserialize.call(this, serializationObject, scene, rootUrl);\n        this.convertToGammaSpace = serializationObject.convertToGammaSpace;\n        this.convertToLinearSpace = !!serializationObject.convertToLinearSpace;\n        if (serializationObject.texture) {\n            rootUrl = serializationObject.texture.url.indexOf(\"data:\") === 0 ? \"\" : rootUrl;\n            this.texture = Texture.Parse(serializationObject.texture, scene, rootUrl);\n        }\n    };\n    return CurrentScreenBlock;\n}(NodeMaterialBlock));\nexport { CurrentScreenBlock };\nRegisterClass(\"BABYLON.CurrentScreenBlock\", CurrentScreenBlock);\n//# sourceMappingURL=currentScreenBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialSystemValues } from \"../../Enums/nodeMaterialSystemValues.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { MaterialHelper } from \"../../../materialHelper.js\";\nimport { InputBlock } from \"../Input/inputBlock.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport \"../../../../Shaders/ShadersInclude/fogFragmentDeclaration.js\";\n/**\n * Block used to add support for scene fog\n */\nvar FogBlock = /** @class */ (function (_super) {\n    __extends(FogBlock, _super);\n    /**\n     * Create a new FogBlock\n     * @param name defines the block name\n     */\n    function FogBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.VertexAndFragment, false) || this;\n        // Vertex\n        _this.registerInput(\"worldPosition\", NodeMaterialBlockConnectionPointTypes.Vector4, false, NodeMaterialBlockTargets.Vertex);\n        _this.registerInput(\"view\", NodeMaterialBlockConnectionPointTypes.Matrix, false, NodeMaterialBlockTargets.Vertex);\n        // Fragment\n        _this.registerInput(\"input\", NodeMaterialBlockConnectionPointTypes.Color3, false, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"fogColor\", NodeMaterialBlockConnectionPointTypes.Color3, false, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"output\", NodeMaterialBlockConnectionPointTypes.Color3, NodeMaterialBlockTargets.Fragment);\n        _this.input.acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Color4);\n        _this.fogColor.acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Color4);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    FogBlock.prototype.getClassName = function () {\n        return \"FogBlock\";\n    };\n    Object.defineProperty(FogBlock.prototype, \"worldPosition\", {\n        /**\n         * Gets the world position input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FogBlock.prototype, \"view\", {\n        /**\n         * Gets the view input component\n         */\n        get: function () {\n            return this._inputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FogBlock.prototype, \"input\", {\n        /**\n         * Gets the color input component\n         */\n        get: function () {\n            return this._inputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FogBlock.prototype, \"fogColor\", {\n        /**\n         * Gets the fog color input component\n         */\n        get: function () {\n            return this._inputs[3];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FogBlock.prototype, \"output\", {\n        /**\n         * Gets the output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    FogBlock.prototype.autoConfigure = function (material) {\n        if (!this.view.isConnected) {\n            var viewInput = material.getInputBlockByPredicate(function (b) { return b.systemValue === NodeMaterialSystemValues.View; });\n            if (!viewInput) {\n                viewInput = new InputBlock(\"view\");\n                viewInput.setAsSystemValue(NodeMaterialSystemValues.View);\n            }\n            viewInput.output.connectTo(this.view);\n        }\n        if (!this.fogColor.isConnected) {\n            var fogColorInput = material.getInputBlockByPredicate(function (b) { return b.systemValue === NodeMaterialSystemValues.FogColor; });\n            if (!fogColorInput) {\n                fogColorInput = new InputBlock(\"fogColor\", undefined, NodeMaterialBlockConnectionPointTypes.Color3);\n                fogColorInput.setAsSystemValue(NodeMaterialSystemValues.FogColor);\n            }\n            fogColorInput.output.connectTo(this.fogColor);\n        }\n    };\n    FogBlock.prototype.prepareDefines = function (mesh, nodeMaterial, defines) {\n        var scene = mesh.getScene();\n        defines.setValue(\"FOG\", nodeMaterial.fogEnabled && MaterialHelper.GetFogState(mesh, scene));\n    };\n    FogBlock.prototype.bind = function (effect, nodeMaterial, mesh) {\n        if (!mesh) {\n            return;\n        }\n        var scene = mesh.getScene();\n        effect.setFloat4(this._fogParameters, scene.fogMode, scene.fogStart, scene.fogEnd, scene.fogDensity);\n    };\n    FogBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        if (state.target === NodeMaterialBlockTargets.Fragment) {\n            state.sharedData.blocksWithDefines.push(this);\n            state.sharedData.bindableBlocks.push(this);\n            state._emitFunctionFromInclude(\"fogFragmentDeclaration\", \"//\".concat(this.name), {\n                removeUniforms: true,\n                removeVaryings: true,\n                removeIfDef: false,\n                replaceStrings: [{ search: /float CalcFogFactor\\(\\)/, replace: \"float CalcFogFactor(vec3 vFogDistance, vec4 vFogInfos)\" }],\n            });\n            var tempFogVariablename = state._getFreeVariableName(\"fog\");\n            var color = this.input;\n            var fogColor = this.fogColor;\n            this._fogParameters = state._getFreeVariableName(\"fogParameters\");\n            var output = this._outputs[0];\n            state._emitUniformFromString(this._fogParameters, \"vec4\");\n            state.compilationString += \"#ifdef FOG\\r\\n\";\n            state.compilationString += \"float \".concat(tempFogVariablename, \" = CalcFogFactor(\").concat(this._fogDistanceName, \", \").concat(this._fogParameters, \");\\r\\n\");\n            state.compilationString +=\n                this._declareOutput(output, state) +\n                    \" = \".concat(tempFogVariablename, \" * \").concat(color.associatedVariableName, \".rgb + (1.0 - \").concat(tempFogVariablename, \") * \").concat(fogColor.associatedVariableName, \".rgb;\\r\\n\");\n            state.compilationString += \"#else\\r\\n\".concat(this._declareOutput(output, state), \" =  \").concat(color.associatedVariableName, \".rgb;\\r\\n\");\n            state.compilationString += \"#endif\\r\\n\";\n        }\n        else {\n            var worldPos = this.worldPosition;\n            var view = this.view;\n            this._fogDistanceName = state._getFreeVariableName(\"vFogDistance\");\n            state._emitVaryingFromString(this._fogDistanceName, \"vec3\");\n            state.compilationString += \"\".concat(this._fogDistanceName, \" = (\").concat(view.associatedVariableName, \" * \").concat(worldPos.associatedVariableName, \").xyz;\\r\\n\");\n        }\n        return this;\n    };\n    return FogBlock;\n}(NodeMaterialBlock));\nexport { FogBlock };\nRegisterClass(\"BABYLON.FogBlock\", FogBlock);\n//# sourceMappingURL=fogBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { MaterialHelper } from \"../../../materialHelper.js\";\nimport { NodeMaterialSystemValues } from \"../../Enums/nodeMaterialSystemValues.js\";\nimport { InputBlock } from \"../Input/inputBlock.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport \"../../../../Shaders/ShadersInclude/lightFragmentDeclaration.js\";\nimport \"../../../../Shaders/ShadersInclude/lightVxFragmentDeclaration.js\";\nimport \"../../../../Shaders/ShadersInclude/lightUboDeclaration.js\";\nimport \"../../../../Shaders/ShadersInclude/lightVxUboDeclaration.js\";\nimport \"../../../../Shaders/ShadersInclude/lightFragment.js\";\nimport \"../../../../Shaders/ShadersInclude/helperFunctions.js\";\nimport \"../../../../Shaders/ShadersInclude/lightsFragmentFunctions.js\";\nimport \"../../../../Shaders/ShadersInclude/shadowsFragmentFunctions.js\";\nimport \"../../../../Shaders/ShadersInclude/shadowsVertex.js\";\n/**\n * Block used to add light in the fragment shader\n */\nvar LightBlock = /** @class */ (function (_super) {\n    __extends(LightBlock, _super);\n    /**\n     * Create a new LightBlock\n     * @param name defines the block name\n     */\n    function LightBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.VertexAndFragment) || this;\n        _this._isUnique = true;\n        _this.registerInput(\"worldPosition\", NodeMaterialBlockConnectionPointTypes.Vector4, false, NodeMaterialBlockTargets.Vertex);\n        _this.registerInput(\"worldNormal\", NodeMaterialBlockConnectionPointTypes.Vector4, false, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"cameraPosition\", NodeMaterialBlockConnectionPointTypes.Vector3, false, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"glossiness\", NodeMaterialBlockConnectionPointTypes.Float, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"glossPower\", NodeMaterialBlockConnectionPointTypes.Float, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"diffuseColor\", NodeMaterialBlockConnectionPointTypes.Color3, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"specularColor\", NodeMaterialBlockConnectionPointTypes.Color3, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"view\", NodeMaterialBlockConnectionPointTypes.Matrix, true);\n        _this.registerOutput(\"diffuseOutput\", NodeMaterialBlockConnectionPointTypes.Color3, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"specularOutput\", NodeMaterialBlockConnectionPointTypes.Color3, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"shadow\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Fragment);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    LightBlock.prototype.getClassName = function () {\n        return \"LightBlock\";\n    };\n    Object.defineProperty(LightBlock.prototype, \"worldPosition\", {\n        /**\n         * Gets the world position input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LightBlock.prototype, \"worldNormal\", {\n        /**\n         * Gets the world normal input component\n         */\n        get: function () {\n            return this._inputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LightBlock.prototype, \"cameraPosition\", {\n        /**\n         * Gets the camera (or eye) position component\n         */\n        get: function () {\n            return this._inputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LightBlock.prototype, \"glossiness\", {\n        /**\n         * Gets the glossiness component\n         */\n        get: function () {\n            return this._inputs[3];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LightBlock.prototype, \"glossPower\", {\n        /**\n         * Gets the glossiness power component\n         */\n        get: function () {\n            return this._inputs[4];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LightBlock.prototype, \"diffuseColor\", {\n        /**\n         * Gets the diffuse color component\n         */\n        get: function () {\n            return this._inputs[5];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LightBlock.prototype, \"specularColor\", {\n        /**\n         * Gets the specular color component\n         */\n        get: function () {\n            return this._inputs[6];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LightBlock.prototype, \"view\", {\n        /**\n         * Gets the view matrix component\n         */\n        get: function () {\n            return this._inputs[7];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LightBlock.prototype, \"diffuseOutput\", {\n        /**\n         * Gets the diffuse output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LightBlock.prototype, \"specularOutput\", {\n        /**\n         * Gets the specular output component\n         */\n        get: function () {\n            return this._outputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(LightBlock.prototype, \"shadow\", {\n        /**\n         * Gets the shadow output component\n         */\n        get: function () {\n            return this._outputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    LightBlock.prototype.autoConfigure = function (material) {\n        if (!this.cameraPosition.isConnected) {\n            var cameraPositionInput = material.getInputBlockByPredicate(function (b) { return b.systemValue === NodeMaterialSystemValues.CameraPosition; });\n            if (!cameraPositionInput) {\n                cameraPositionInput = new InputBlock(\"cameraPosition\");\n                cameraPositionInput.setAsSystemValue(NodeMaterialSystemValues.CameraPosition);\n            }\n            cameraPositionInput.output.connectTo(this.cameraPosition);\n        }\n    };\n    LightBlock.prototype.prepareDefines = function (mesh, nodeMaterial, defines) {\n        if (!defines._areLightsDirty) {\n            return;\n        }\n        var scene = mesh.getScene();\n        if (!this.light) {\n            MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, true, nodeMaterial.maxSimultaneousLights);\n        }\n        else {\n            var state = {\n                needNormals: false,\n                needRebuild: false,\n                lightmapMode: false,\n                shadowEnabled: false,\n                specularEnabled: false,\n            };\n            MaterialHelper.PrepareDefinesForLight(scene, mesh, this.light, this._lightId, defines, true, state);\n            if (state.needRebuild) {\n                defines.rebuild();\n            }\n        }\n    };\n    LightBlock.prototype.updateUniformsAndSamples = function (state, nodeMaterial, defines, uniformBuffers) {\n        for (var lightIndex = 0; lightIndex < nodeMaterial.maxSimultaneousLights; lightIndex++) {\n            if (!defines[\"LIGHT\" + lightIndex]) {\n                break;\n            }\n            var onlyUpdateBuffersList = state.uniforms.indexOf(\"vLightData\" + lightIndex) >= 0;\n            MaterialHelper.PrepareUniformsAndSamplersForLight(lightIndex, state.uniforms, state.samplers, defines[\"PROJECTEDLIGHTTEXTURE\" + lightIndex], uniformBuffers, onlyUpdateBuffersList);\n        }\n    };\n    LightBlock.prototype.bind = function (effect, nodeMaterial, mesh) {\n        if (!mesh) {\n            return;\n        }\n        var scene = mesh.getScene();\n        if (!this.light) {\n            MaterialHelper.BindLights(scene, mesh, effect, true, nodeMaterial.maxSimultaneousLights);\n        }\n        else {\n            MaterialHelper.BindLight(this.light, this._lightId, scene, effect, true);\n        }\n    };\n    LightBlock.prototype._injectVertexCode = function (state) {\n        var worldPos = this.worldPosition;\n        var comments = \"//\".concat(this.name);\n        // Declaration\n        if (!this.light) {\n            // Emit for all lights\n            state._emitFunctionFromInclude(state.supportUniformBuffers ? \"lightVxUboDeclaration\" : \"lightVxFragmentDeclaration\", comments, {\n                repeatKey: \"maxSimultaneousLights\",\n            });\n            this._lightId = 0;\n            state.sharedData.dynamicUniformBlocks.push(this);\n        }\n        else {\n            this._lightId = (state.counters[\"lightCounter\"] !== undefined ? state.counters[\"lightCounter\"] : -1) + 1;\n            state.counters[\"lightCounter\"] = this._lightId;\n            state._emitFunctionFromInclude(state.supportUniformBuffers ? \"lightVxUboDeclaration\" : \"lightVxFragmentDeclaration\", comments, {\n                replaceStrings: [{ search: /{X}/g, replace: this._lightId.toString() }],\n            }, this._lightId.toString());\n        }\n        // Inject code in vertex\n        var worldPosVaryingName = \"v_\" + worldPos.associatedVariableName;\n        if (state._emitVaryingFromString(worldPosVaryingName, \"vec4\")) {\n            state.compilationString += \"\".concat(worldPosVaryingName, \" = \").concat(worldPos.associatedVariableName, \";\\r\\n\");\n        }\n        if (this.light) {\n            state.compilationString += state._emitCodeFromInclude(\"shadowsVertex\", comments, {\n                replaceStrings: [\n                    { search: /{X}/g, replace: this._lightId.toString() },\n                    { search: /worldPos/g, replace: worldPos.associatedVariableName },\n                ],\n            });\n        }\n        else {\n            state.compilationString += \"vec4 worldPos = \".concat(worldPos.associatedVariableName, \";\\r\\n\");\n            if (this.view.isConnected) {\n                state.compilationString += \"mat4 view = \".concat(this.view.associatedVariableName, \";\\r\\n\");\n            }\n            state.compilationString += state._emitCodeFromInclude(\"shadowsVertex\", comments, {\n                repeatKey: \"maxSimultaneousLights\",\n            });\n        }\n    };\n    LightBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        if (state.target !== NodeMaterialBlockTargets.Fragment) {\n            // Vertex\n            this._injectVertexCode(state);\n            return;\n        }\n        // Fragment\n        state.sharedData.forcedBindableBlocks.push(this);\n        state.sharedData.blocksWithDefines.push(this);\n        var comments = \"//\".concat(this.name);\n        var worldPos = this.worldPosition;\n        state._emitFunctionFromInclude(\"helperFunctions\", comments);\n        state._emitFunctionFromInclude(\"lightsFragmentFunctions\", comments, {\n            replaceStrings: [{ search: /vPositionW/g, replace: \"v_\" + worldPos.associatedVariableName + \".xyz\" }],\n        });\n        state._emitFunctionFromInclude(\"shadowsFragmentFunctions\", comments, {\n            replaceStrings: [{ search: /vPositionW/g, replace: \"v_\" + worldPos.associatedVariableName + \".xyz\" }],\n        });\n        if (!this.light) {\n            // Emit for all lights\n            state._emitFunctionFromInclude(state.supportUniformBuffers ? \"lightUboDeclaration\" : \"lightFragmentDeclaration\", comments, {\n                repeatKey: \"maxSimultaneousLights\",\n            });\n        }\n        else {\n            state._emitFunctionFromInclude(state.supportUniformBuffers ? \"lightUboDeclaration\" : \"lightFragmentDeclaration\", comments, {\n                replaceStrings: [{ search: /{X}/g, replace: this._lightId.toString() }],\n            }, this._lightId.toString());\n        }\n        // Code\n        if (this._lightId === 0) {\n            if (state._registerTempVariable(\"viewDirectionW\")) {\n                state.compilationString += \"vec3 viewDirectionW = normalize(\".concat(this.cameraPosition.associatedVariableName, \" - \").concat(\"v_\" + worldPos.associatedVariableName, \".xyz);\\r\\n\");\n            }\n            state.compilationString += \"lightingInfo info;\\r\\n\";\n            state.compilationString += \"float shadow = 1.;\\r\\n\";\n            state.compilationString += \"float glossiness = \".concat(this.glossiness.isConnected ? this.glossiness.associatedVariableName : \"1.0\", \" * \").concat(this.glossPower.isConnected ? this.glossPower.associatedVariableName : \"1024.0\", \";\\r\\n\");\n            state.compilationString += \"vec3 diffuseBase = vec3(0., 0., 0.);\\r\\n\";\n            state.compilationString += \"vec3 specularBase = vec3(0., 0., 0.);\\r\\n\";\n            state.compilationString += \"vec3 normalW = \".concat(this.worldNormal.associatedVariableName, \".xyz;\\r\\n\");\n        }\n        if (this.light) {\n            state.compilationString += state._emitCodeFromInclude(\"lightFragment\", comments, {\n                replaceStrings: [{ search: /{X}/g, replace: this._lightId.toString() }],\n            });\n        }\n        else {\n            state.compilationString += state._emitCodeFromInclude(\"lightFragment\", comments, {\n                repeatKey: \"maxSimultaneousLights\",\n            });\n        }\n        var diffuseOutput = this.diffuseOutput;\n        var specularOutput = this.specularOutput;\n        state.compilationString +=\n            this._declareOutput(diffuseOutput, state) + \" = diffuseBase\".concat(this.diffuseColor.isConnected ? \" * \" + this.diffuseColor.associatedVariableName : \"\", \";\\r\\n\");\n        if (specularOutput.hasEndpoints) {\n            state.compilationString +=\n                this._declareOutput(specularOutput, state) + \" = specularBase\".concat(this.specularColor.isConnected ? \" * \" + this.specularColor.associatedVariableName : \"\", \";\\r\\n\");\n        }\n        if (this.shadow.hasEndpoints) {\n            state.compilationString += this._declareOutput(this.shadow, state) + \" = shadow;\\r\\n\";\n        }\n        return this;\n    };\n    LightBlock.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        if (this.light) {\n            serializationObject.lightId = this.light.id;\n        }\n        return serializationObject;\n    };\n    LightBlock.prototype._deserialize = function (serializationObject, scene, rootUrl) {\n        _super.prototype._deserialize.call(this, serializationObject, scene, rootUrl);\n        if (serializationObject.lightId) {\n            this.light = scene.getLightById(serializationObject.lightId);\n        }\n    };\n    return LightBlock;\n}(NodeMaterialBlock));\nexport { LightBlock };\nRegisterClass(\"BABYLON.LightBlock\", LightBlock);\n//# sourceMappingURL=lightBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialConnectionPointDirection } from \"../../nodeMaterialBlockConnectionPoint.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { Texture } from \"../../../Textures/texture.js\";\n\nimport { NodeMaterial } from \"../../nodeMaterial.js\";\nimport { NodeMaterialConnectionPointCustomObject } from \"../../nodeMaterialConnectionPointCustomObject.js\";\nimport { EngineStore } from \"../../../../Engines/engineStore.js\";\n/**\n * Block used to provide an image for a TextureBlock\n */\nvar ImageSourceBlock = /** @class */ (function (_super) {\n    __extends(ImageSourceBlock, _super);\n    /**\n     * Creates a new ImageSourceBlock\n     * @param name defines the block name\n     */\n    function ImageSourceBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.VertexAndFragment) || this;\n        _this.registerOutput(\"source\", NodeMaterialBlockConnectionPointTypes.Object, NodeMaterialBlockTargets.VertexAndFragment, new NodeMaterialConnectionPointCustomObject(\"source\", _this, NodeMaterialConnectionPointDirection.Output, ImageSourceBlock, \"ImageSourceBlock\"));\n        return _this;\n    }\n    Object.defineProperty(ImageSourceBlock.prototype, \"texture\", {\n        /**\n         * Gets or sets the texture associated with the node\n         */\n        get: function () {\n            return this._texture;\n        },\n        set: function (texture) {\n            var _this = this;\n            var _a;\n            if (this._texture === texture) {\n                return;\n            }\n            var scene = (_a = texture === null || texture === void 0 ? void 0 : texture.getScene()) !== null && _a !== void 0 ? _a : EngineStore.LastCreatedScene;\n            if (!texture && scene) {\n                scene.markAllMaterialsAsDirty(1, function (mat) {\n                    return mat.hasTexture(_this._texture);\n                });\n            }\n            this._texture = texture;\n            if (texture && scene) {\n                scene.markAllMaterialsAsDirty(1, function (mat) {\n                    return mat.hasTexture(texture);\n                });\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ImageSourceBlock.prototype, \"samplerName\", {\n        /**\n         * Gets the sampler name associated with this image source\n         */\n        get: function () {\n            return this._samplerName;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ImageSourceBlock.prototype.bind = function (effect) {\n        if (!this.texture) {\n            return;\n        }\n        effect.setTexture(this._samplerName, this.texture);\n    };\n    ImageSourceBlock.prototype.isReady = function () {\n        if (this.texture && !this.texture.isReadyOrNotBlocking()) {\n            return false;\n        }\n        return true;\n    };\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    ImageSourceBlock.prototype.getClassName = function () {\n        return \"ImageSourceBlock\";\n    };\n    Object.defineProperty(ImageSourceBlock.prototype, \"source\", {\n        /**\n         * Gets the output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ImageSourceBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        if (state.target === NodeMaterialBlockTargets.Vertex) {\n            this._samplerName = state._getFreeVariableName(this.name + \"Sampler\");\n            // Declarations\n            state.sharedData.blockingBlocks.push(this);\n            state.sharedData.textureBlocks.push(this);\n            state.sharedData.bindableBlocks.push(this);\n        }\n        state._emit2DSampler(this._samplerName);\n        return this;\n    };\n    ImageSourceBlock.prototype._dumpPropertiesCode = function () {\n        var codeString = _super.prototype._dumpPropertiesCode.call(this);\n        if (!this.texture) {\n            return codeString;\n        }\n        codeString += \"\".concat(this._codeVariableName, \".texture = new BABYLON.Texture(\\\"\").concat(this.texture.name, \"\\\", null, \").concat(this.texture.noMipmap, \", \").concat(this.texture.invertY, \", \").concat(this.texture.samplingMode, \");\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.wrapU = \").concat(this.texture.wrapU, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.wrapV = \").concat(this.texture.wrapV, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.uAng = \").concat(this.texture.uAng, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.vAng = \").concat(this.texture.vAng, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.wAng = \").concat(this.texture.wAng, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.uOffset = \").concat(this.texture.uOffset, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.vOffset = \").concat(this.texture.vOffset, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.uScale = \").concat(this.texture.uScale, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.vScale = \").concat(this.texture.vScale, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.coordinatesMode = \").concat(this.texture.coordinatesMode, \";\\r\\n\");\n        return codeString;\n    };\n    ImageSourceBlock.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        if (this.texture && !this.texture.isRenderTarget && this.texture.getClassName() !== \"VideoTexture\") {\n            serializationObject.texture = this.texture.serialize();\n        }\n        return serializationObject;\n    };\n    ImageSourceBlock.prototype._deserialize = function (serializationObject, scene, rootUrl) {\n        _super.prototype._deserialize.call(this, serializationObject, scene, rootUrl);\n        if (serializationObject.texture && !NodeMaterial.IgnoreTexturesAtLoadTime && serializationObject.texture.url !== undefined) {\n            rootUrl = serializationObject.texture.url.indexOf(\"data:\") === 0 ? \"\" : rootUrl;\n            this.texture = Texture.Parse(serializationObject.texture, scene, rootUrl);\n        }\n    };\n    return ImageSourceBlock;\n}(NodeMaterialBlock));\nexport { ImageSourceBlock };\nRegisterClass(\"BABYLON.ImageSourceBlock\", ImageSourceBlock);\n//# sourceMappingURL=imageSourceBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { NodeMaterialConnectionPointDirection } from \"../../nodeMaterialBlockConnectionPoint.js\";\nimport { NodeMaterial } from \"../../nodeMaterial.js\";\nimport { InputBlock } from \"../Input/inputBlock.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { Texture } from \"../../../Textures/texture.js\";\nimport { NodeMaterialModes } from \"../../Enums/nodeMaterialModes.js\";\n\nimport \"../../../../Shaders/ShadersInclude/helperFunctions.js\";\nimport { ImageSourceBlock } from \"./imageSourceBlock.js\";\nimport { NodeMaterialConnectionPointCustomObject } from \"../../nodeMaterialConnectionPointCustomObject.js\";\nimport { EngineStore } from \"../../../../Engines/engineStore.js\";\n/**\n * Block used to read a texture from a sampler\n */\nvar TextureBlock = /** @class */ (function (_super) {\n    __extends(TextureBlock, _super);\n    /**\n     * Create a new TextureBlock\n     * @param name defines the block name\n     * @param fragmentOnly\n     */\n    function TextureBlock(name, fragmentOnly) {\n        if (fragmentOnly === void 0) { fragmentOnly = false; }\n        var _this = _super.call(this, name, fragmentOnly ? NodeMaterialBlockTargets.Fragment : NodeMaterialBlockTargets.VertexAndFragment) || this;\n        _this._convertToGammaSpace = false;\n        _this._convertToLinearSpace = false;\n        /**\n         * Gets or sets a boolean indicating if multiplication of texture with level should be disabled\n         */\n        _this.disableLevelMultiplication = false;\n        _this._fragmentOnly = fragmentOnly;\n        _this.registerInput(\"uv\", NodeMaterialBlockConnectionPointTypes.Vector2, false, NodeMaterialBlockTargets.VertexAndFragment);\n        _this.registerInput(\"source\", NodeMaterialBlockConnectionPointTypes.Object, true, NodeMaterialBlockTargets.VertexAndFragment, new NodeMaterialConnectionPointCustomObject(\"source\", _this, NodeMaterialConnectionPointDirection.Input, ImageSourceBlock, \"ImageSourceBlock\"));\n        _this.registerOutput(\"rgba\", NodeMaterialBlockConnectionPointTypes.Color4, NodeMaterialBlockTargets.Neutral);\n        _this.registerOutput(\"rgb\", NodeMaterialBlockConnectionPointTypes.Color3, NodeMaterialBlockTargets.Neutral);\n        _this.registerOutput(\"r\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Neutral);\n        _this.registerOutput(\"g\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Neutral);\n        _this.registerOutput(\"b\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Neutral);\n        _this.registerOutput(\"a\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Neutral);\n        _this.registerOutput(\"level\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Neutral);\n        _this._inputs[0].acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Vector3);\n        _this._inputs[0].acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Vector4);\n        _this._inputs[0]._prioritizeVertex = !fragmentOnly;\n        return _this;\n    }\n    Object.defineProperty(TextureBlock.prototype, \"texture\", {\n        /**\n         * Gets or sets the texture associated with the node\n         */\n        get: function () {\n            var _a;\n            if (this.source.isConnected) {\n                return ((_a = this.source.connectedPoint) === null || _a === void 0 ? void 0 : _a.ownerBlock).texture;\n            }\n            return this._texture;\n        },\n        set: function (texture) {\n            var _this = this;\n            var _a;\n            if (this._texture === texture) {\n                return;\n            }\n            var scene = (_a = texture === null || texture === void 0 ? void 0 : texture.getScene()) !== null && _a !== void 0 ? _a : EngineStore.LastCreatedScene;\n            if (!texture && scene) {\n                scene.markAllMaterialsAsDirty(1, function (mat) {\n                    return mat.hasTexture(_this._texture);\n                });\n            }\n            this._texture = texture;\n            if (texture && scene) {\n                scene.markAllMaterialsAsDirty(1, function (mat) {\n                    return mat.hasTexture(texture);\n                });\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"samplerName\", {\n        /**\n         * Gets the sampler name associated with this texture\n         */\n        get: function () {\n            if (this._imageSource) {\n                return this._imageSource.samplerName;\n            }\n            return this._samplerName;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"hasImageSource\", {\n        /**\n         * Gets a boolean indicating that this block is linked to an ImageSourceBlock\n         */\n        get: function () {\n            return !!this._imageSource;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"convertToGammaSpace\", {\n        get: function () {\n            return this._convertToGammaSpace;\n        },\n        /**\n         * Gets or sets a boolean indicating if content needs to be converted to gamma space\n         */\n        set: function (value) {\n            var _this = this;\n            var _a;\n            if (value === this._convertToGammaSpace) {\n                return;\n            }\n            this._convertToGammaSpace = value;\n            if (this.texture) {\n                var scene = (_a = this.texture.getScene()) !== null && _a !== void 0 ? _a : EngineStore.LastCreatedScene;\n                scene === null || scene === void 0 ? void 0 : scene.markAllMaterialsAsDirty(1, function (mat) {\n                    return mat.hasTexture(_this.texture);\n                });\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"convertToLinearSpace\", {\n        get: function () {\n            return this._convertToLinearSpace;\n        },\n        /**\n         * Gets or sets a boolean indicating if content needs to be converted to linear space\n         */\n        set: function (value) {\n            var _this = this;\n            var _a;\n            if (value === this._convertToLinearSpace) {\n                return;\n            }\n            this._convertToLinearSpace = value;\n            if (this.texture) {\n                var scene = (_a = this.texture.getScene()) !== null && _a !== void 0 ? _a : EngineStore.LastCreatedScene;\n                scene === null || scene === void 0 ? void 0 : scene.markAllMaterialsAsDirty(1, function (mat) {\n                    return mat.hasTexture(_this.texture);\n                });\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    TextureBlock.prototype.getClassName = function () {\n        return \"TextureBlock\";\n    };\n    Object.defineProperty(TextureBlock.prototype, \"uv\", {\n        /**\n         * Gets the uv input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"source\", {\n        /**\n         * Gets the source input component\n         */\n        get: function () {\n            return this._inputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"rgba\", {\n        /**\n         * Gets the rgba output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"rgb\", {\n        /**\n         * Gets the rgb output component\n         */\n        get: function () {\n            return this._outputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"r\", {\n        /**\n         * Gets the r output component\n         */\n        get: function () {\n            return this._outputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"g\", {\n        /**\n         * Gets the g output component\n         */\n        get: function () {\n            return this._outputs[3];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"b\", {\n        /**\n         * Gets the b output component\n         */\n        get: function () {\n            return this._outputs[4];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"a\", {\n        /**\n         * Gets the a output component\n         */\n        get: function () {\n            return this._outputs[5];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"level\", {\n        /**\n         * Gets the level output component\n         */\n        get: function () {\n            return this._outputs[6];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TextureBlock.prototype, \"target\", {\n        get: function () {\n            if (this._fragmentOnly) {\n                return NodeMaterialBlockTargets.Fragment;\n            }\n            // TextureBlock has a special optimizations for uvs that come from the vertex shaders as they can be packed into a single varyings.\n            // But we need to detect uvs coming from fragment then\n            if (!this.uv.isConnected) {\n                return NodeMaterialBlockTargets.VertexAndFragment;\n            }\n            if (this.uv.sourceBlock.isInput) {\n                return NodeMaterialBlockTargets.VertexAndFragment;\n            }\n            var parent = this.uv.connectedPoint;\n            while (parent) {\n                if (parent.target === NodeMaterialBlockTargets.Fragment) {\n                    return NodeMaterialBlockTargets.Fragment;\n                }\n                if (parent.target === NodeMaterialBlockTargets.Vertex) {\n                    return NodeMaterialBlockTargets.VertexAndFragment;\n                }\n                if (parent.target === NodeMaterialBlockTargets.Neutral || parent.target === NodeMaterialBlockTargets.VertexAndFragment) {\n                    var parentBlock = parent.ownerBlock;\n                    if (parentBlock.target === NodeMaterialBlockTargets.Fragment) {\n                        return NodeMaterialBlockTargets.Fragment;\n                    }\n                    parent = null;\n                    for (var _i = 0, _a = parentBlock.inputs; _i < _a.length; _i++) {\n                        var input = _a[_i];\n                        if (input.connectedPoint) {\n                            parent = input.connectedPoint;\n                            break;\n                        }\n                    }\n                }\n            }\n            return NodeMaterialBlockTargets.VertexAndFragment;\n        },\n        set: function (value) { },\n        enumerable: false,\n        configurable: true\n    });\n    TextureBlock.prototype.autoConfigure = function (material) {\n        if (!this.uv.isConnected) {\n            if (material.mode === NodeMaterialModes.PostProcess) {\n                var uvInput = material.getBlockByPredicate(function (b) { return b.name === \"uv\"; });\n                if (uvInput) {\n                    uvInput.connectTo(this);\n                }\n            }\n            else {\n                var attributeName_1 = material.mode === NodeMaterialModes.Particle ? \"particle_uv\" : \"uv\";\n                var uvInput = material.getInputBlockByPredicate(function (b) { return b.isAttribute && b.name === attributeName_1; });\n                if (!uvInput) {\n                    uvInput = new InputBlock(\"uv\");\n                    uvInput.setAsAttribute(attributeName_1);\n                }\n                uvInput.output.connectTo(this.uv);\n            }\n        }\n    };\n    TextureBlock.prototype.initializeDefines = function (mesh, nodeMaterial, defines) {\n        if (!defines._areTexturesDirty) {\n            return;\n        }\n        if (this._mainUVDefineName !== undefined) {\n            defines.setValue(this._mainUVDefineName, false, true);\n        }\n    };\n    TextureBlock.prototype.prepareDefines = function (mesh, nodeMaterial, defines) {\n        if (!defines._areTexturesDirty) {\n            return;\n        }\n        if (!this.texture || !this.texture.getTextureMatrix) {\n            if (this._isMixed) {\n                defines.setValue(this._defineName, false, true);\n                defines.setValue(this._mainUVDefineName, true, true);\n            }\n            return;\n        }\n        var toGamma = this.convertToGammaSpace && this.texture && !this.texture.gammaSpace;\n        var toLinear = this.convertToLinearSpace && this.texture && this.texture.gammaSpace;\n        // Not a bug... Name defines the texture space not the required conversion\n        defines.setValue(this._linearDefineName, toGamma, true);\n        defines.setValue(this._gammaDefineName, toLinear, true);\n        if (this._isMixed) {\n            if (!this.texture.getTextureMatrix().isIdentityAs3x2()) {\n                defines.setValue(this._defineName, true);\n                if (defines[this._mainUVDefineName] == undefined) {\n                    defines.setValue(this._mainUVDefineName, false, true);\n                }\n            }\n            else {\n                defines.setValue(this._defineName, false, true);\n                defines.setValue(this._mainUVDefineName, true, true);\n            }\n        }\n    };\n    TextureBlock.prototype.isReady = function () {\n        if (this.texture && !this.texture.isReadyOrNotBlocking()) {\n            return false;\n        }\n        return true;\n    };\n    TextureBlock.prototype.bind = function (effect) {\n        if (!this.texture) {\n            return;\n        }\n        if (this._isMixed) {\n            effect.setFloat(this._textureInfoName, this.texture.level);\n            effect.setMatrix(this._textureTransformName, this.texture.getTextureMatrix());\n        }\n        if (!this._imageSource) {\n            effect.setTexture(this._samplerName, this.texture);\n        }\n    };\n    Object.defineProperty(TextureBlock.prototype, \"_isMixed\", {\n        get: function () {\n            return this.target !== NodeMaterialBlockTargets.Fragment;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    TextureBlock.prototype._injectVertexCode = function (state) {\n        var uvInput = this.uv;\n        // Inject code in vertex\n        this._defineName = state._getFreeDefineName(\"UVTRANSFORM\");\n        this._mainUVDefineName = \"VMAIN\" + uvInput.associatedVariableName.toUpperCase();\n        this._mainUVName = \"vMain\" + uvInput.associatedVariableName;\n        this._transformedUVName = state._getFreeVariableName(\"transformedUV\");\n        this._textureTransformName = state._getFreeVariableName(\"textureTransform\");\n        this._textureInfoName = state._getFreeVariableName(\"textureInfoName\");\n        this.level.associatedVariableName = this._textureInfoName;\n        state._emitVaryingFromString(this._transformedUVName, \"vec2\", this._defineName);\n        state._emitVaryingFromString(this._mainUVName, \"vec2\", this._mainUVDefineName);\n        state._emitUniformFromString(this._textureTransformName, \"mat4\", this._defineName);\n        state.compilationString += \"#ifdef \".concat(this._defineName, \"\\r\\n\");\n        state.compilationString += \"\".concat(this._transformedUVName, \" = vec2(\").concat(this._textureTransformName, \" * vec4(\").concat(uvInput.associatedVariableName, \".xy, 1.0, 0.0));\\r\\n\");\n        state.compilationString += \"#elif defined(\".concat(this._mainUVDefineName, \")\\r\\n\");\n        state.compilationString += \"\".concat(this._mainUVName, \" = \").concat(uvInput.associatedVariableName, \".xy;\\r\\n\");\n        state.compilationString += \"#endif\\r\\n\";\n        if (!this._outputs.some(function (o) { return o.isConnectedInVertexShader; })) {\n            return;\n        }\n        this._writeTextureRead(state, true);\n        for (var _i = 0, _a = this._outputs; _i < _a.length; _i++) {\n            var output = _a[_i];\n            if (output.hasEndpoints && output.name !== \"level\") {\n                this._writeOutput(state, output, output.name, true);\n            }\n        }\n    };\n    TextureBlock.prototype._generateTextureLookup = function (state) {\n        var samplerName = this.samplerName;\n        state.compilationString += \"#ifdef \".concat(this._defineName, \"\\r\\n\");\n        state.compilationString += \"vec4 \".concat(this._tempTextureRead, \" = texture2D(\").concat(samplerName, \", \").concat(this._transformedUVName, \");\\r\\n\");\n        state.compilationString += \"#elif defined(\".concat(this._mainUVDefineName, \")\\r\\n\");\n        state.compilationString += \"vec4 \".concat(this._tempTextureRead, \" = texture2D(\").concat(samplerName, \", \").concat(this._mainUVName ? this._mainUVName : this.uv.associatedVariableName, \");\\r\\n\");\n        state.compilationString += \"#endif\\r\\n\";\n    };\n    TextureBlock.prototype._writeTextureRead = function (state, vertexMode) {\n        if (vertexMode === void 0) { vertexMode = false; }\n        var uvInput = this.uv;\n        if (vertexMode) {\n            if (state.target === NodeMaterialBlockTargets.Fragment) {\n                return;\n            }\n            this._generateTextureLookup(state);\n            return;\n        }\n        if (this.uv.ownerBlock.target === NodeMaterialBlockTargets.Fragment) {\n            state.compilationString += \"vec4 \".concat(this._tempTextureRead, \" = texture2D(\").concat(this.samplerName, \", \").concat(uvInput.associatedVariableName, \");\\r\\n\");\n            return;\n        }\n        this._generateTextureLookup(state);\n    };\n    TextureBlock.prototype._generateConversionCode = function (state, output, swizzle) {\n        if (swizzle !== \"a\") {\n            // no conversion if the output is \"a\" (alpha)\n            if (!this.texture || !this.texture.gammaSpace) {\n                state.compilationString += \"#ifdef \".concat(this._linearDefineName, \"\\n                    \").concat(output.associatedVariableName, \" = toGammaSpace(\").concat(output.associatedVariableName, \");\\n                    #endif\\n                \");\n            }\n            state.compilationString += \"#ifdef \".concat(this._gammaDefineName, \"\\n                \").concat(output.associatedVariableName, \" = toLinearSpace(\").concat(output.associatedVariableName, \");\\n                #endif\\n            \");\n        }\n    };\n    TextureBlock.prototype._writeOutput = function (state, output, swizzle, vertexMode) {\n        if (vertexMode === void 0) { vertexMode = false; }\n        if (vertexMode) {\n            if (state.target === NodeMaterialBlockTargets.Fragment) {\n                return;\n            }\n            state.compilationString += \"\".concat(this._declareOutput(output, state), \" = \").concat(this._tempTextureRead, \".\").concat(swizzle, \";\\r\\n\");\n            this._generateConversionCode(state, output, swizzle);\n            return;\n        }\n        if (this.uv.ownerBlock.target === NodeMaterialBlockTargets.Fragment) {\n            state.compilationString += \"\".concat(this._declareOutput(output, state), \" = \").concat(this._tempTextureRead, \".\").concat(swizzle, \";\\r\\n\");\n            this._generateConversionCode(state, output, swizzle);\n            return;\n        }\n        var complement = \"\";\n        if (!this.disableLevelMultiplication) {\n            complement = \" * \".concat(this._textureInfoName);\n        }\n        state.compilationString += \"\".concat(this._declareOutput(output, state), \" = \").concat(this._tempTextureRead, \".\").concat(swizzle).concat(complement, \";\\r\\n\");\n        this._generateConversionCode(state, output, swizzle);\n    };\n    TextureBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        if (this.source.isConnected) {\n            this._imageSource = this.source.connectedPoint.ownerBlock;\n        }\n        else {\n            this._imageSource = null;\n        }\n        if (state.target === NodeMaterialBlockTargets.Vertex || this._fragmentOnly || (state.target === NodeMaterialBlockTargets.Fragment && this._tempTextureRead === undefined)) {\n            this._tempTextureRead = state._getFreeVariableName(\"tempTextureRead\");\n            this._linearDefineName = state._getFreeDefineName(\"ISLINEAR\");\n            this._gammaDefineName = state._getFreeDefineName(\"ISGAMMA\");\n        }\n        if ((!this._isMixed && state.target === NodeMaterialBlockTargets.Fragment) || (this._isMixed && state.target === NodeMaterialBlockTargets.Vertex)) {\n            if (!this._imageSource) {\n                this._samplerName = state._getFreeVariableName(this.name + \"Sampler\");\n                state._emit2DSampler(this._samplerName);\n            }\n            // Declarations\n            state.sharedData.blockingBlocks.push(this);\n            state.sharedData.textureBlocks.push(this);\n            state.sharedData.blocksWithDefines.push(this);\n            state.sharedData.bindableBlocks.push(this);\n        }\n        if (state.target !== NodeMaterialBlockTargets.Fragment) {\n            // Vertex\n            this._injectVertexCode(state);\n            return;\n        }\n        // Fragment\n        if (!this._outputs.some(function (o) { return o.isConnectedInFragmentShader; })) {\n            return;\n        }\n        if (this._isMixed && !this._imageSource) {\n            // Reexport the sampler\n            state._emit2DSampler(this._samplerName);\n        }\n        var comments = \"//\".concat(this.name);\n        state._emitFunctionFromInclude(\"helperFunctions\", comments);\n        if (this._isMixed) {\n            state._emitUniformFromString(this._textureInfoName, \"float\");\n        }\n        this._writeTextureRead(state);\n        for (var _i = 0, _a = this._outputs; _i < _a.length; _i++) {\n            var output = _a[_i];\n            if (output.hasEndpoints && output.name !== \"level\") {\n                this._writeOutput(state, output, output.name);\n            }\n        }\n        return this;\n    };\n    TextureBlock.prototype._dumpPropertiesCode = function () {\n        var codeString = _super.prototype._dumpPropertiesCode.call(this);\n        codeString += \"\".concat(this._codeVariableName, \".convertToGammaSpace = \").concat(this.convertToGammaSpace, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".convertToLinearSpace = \").concat(this.convertToLinearSpace, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".disableLevelMultiplication = \").concat(this.disableLevelMultiplication, \";\\r\\n\");\n        if (!this.texture) {\n            return codeString;\n        }\n        codeString += \"\".concat(this._codeVariableName, \".texture = new BABYLON.Texture(\\\"\").concat(this.texture.name, \"\\\", null, \").concat(this.texture.noMipmap, \", \").concat(this.texture.invertY, \", \").concat(this.texture.samplingMode, \");\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.wrapU = \").concat(this.texture.wrapU, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.wrapV = \").concat(this.texture.wrapV, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.uAng = \").concat(this.texture.uAng, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.vAng = \").concat(this.texture.vAng, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.wAng = \").concat(this.texture.wAng, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.uOffset = \").concat(this.texture.uOffset, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.vOffset = \").concat(this.texture.vOffset, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.uScale = \").concat(this.texture.uScale, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.vScale = \").concat(this.texture.vScale, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".texture.coordinatesMode = \").concat(this.texture.coordinatesMode, \";\\r\\n\");\n        return codeString;\n    };\n    TextureBlock.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        serializationObject.convertToGammaSpace = this.convertToGammaSpace;\n        serializationObject.convertToLinearSpace = this.convertToLinearSpace;\n        serializationObject.fragmentOnly = this._fragmentOnly;\n        serializationObject.disableLevelMultiplication = this.disableLevelMultiplication;\n        if (!this.hasImageSource && this.texture && !this.texture.isRenderTarget && this.texture.getClassName() !== \"VideoTexture\") {\n            serializationObject.texture = this.texture.serialize();\n        }\n        return serializationObject;\n    };\n    TextureBlock.prototype._deserialize = function (serializationObject, scene, rootUrl) {\n        _super.prototype._deserialize.call(this, serializationObject, scene, rootUrl);\n        this.convertToGammaSpace = serializationObject.convertToGammaSpace;\n        this.convertToLinearSpace = !!serializationObject.convertToLinearSpace;\n        this._fragmentOnly = !!serializationObject.fragmentOnly;\n        this.disableLevelMultiplication = !!serializationObject.disableLevelMultiplication;\n        if (serializationObject.texture && !NodeMaterial.IgnoreTexturesAtLoadTime && serializationObject.texture.url !== undefined) {\n            rootUrl = serializationObject.texture.url.indexOf(\"data:\") === 0 ? \"\" : rootUrl;\n            this.texture = Texture.Parse(serializationObject.texture, scene, rootUrl);\n        }\n    };\n    return TextureBlock;\n}(NodeMaterialBlock));\nexport { TextureBlock };\nRegisterClass(\"BABYLON.TextureBlock\", TextureBlock);\n//# sourceMappingURL=textureBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { InputBlock } from \"../Input/inputBlock.js\";\nimport { NodeMaterialSystemValues } from \"../../Enums/nodeMaterialSystemValues.js\";\nimport { ReflectionTextureBaseBlock } from \"./reflectionTextureBaseBlock.js\";\n/**\n * Block used to read a reflection texture from a sampler\n */\nvar ReflectionTextureBlock = /** @class */ (function (_super) {\n    __extends(ReflectionTextureBlock, _super);\n    /**\n     * Create a new ReflectionTextureBlock\n     * @param name defines the block name\n     */\n    function ReflectionTextureBlock(name) {\n        var _this = _super.call(this, name) || this;\n        _this.registerInput(\"position\", NodeMaterialBlockConnectionPointTypes.Vector3, false, NodeMaterialBlockTargets.Vertex);\n        _this.registerInput(\"worldPosition\", NodeMaterialBlockConnectionPointTypes.Vector4, false, NodeMaterialBlockTargets.Vertex);\n        _this.registerInput(\"worldNormal\", NodeMaterialBlockConnectionPointTypes.Vector4, false, NodeMaterialBlockTargets.Fragment); // Flagging as fragment as the normal can be changed by fragment code\n        _this.registerInput(\"world\", NodeMaterialBlockConnectionPointTypes.Matrix, false, NodeMaterialBlockTargets.Vertex);\n        _this.registerInput(\"cameraPosition\", NodeMaterialBlockConnectionPointTypes.Vector3, false, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"view\", NodeMaterialBlockConnectionPointTypes.Matrix, false, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"rgb\", NodeMaterialBlockConnectionPointTypes.Color3, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"rgba\", NodeMaterialBlockConnectionPointTypes.Color4, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"r\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"g\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"b\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"a\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Fragment);\n        _this._inputs[0].acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Vector4);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    ReflectionTextureBlock.prototype.getClassName = function () {\n        return \"ReflectionTextureBlock\";\n    };\n    Object.defineProperty(ReflectionTextureBlock.prototype, \"position\", {\n        /**\n         * Gets the world position input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReflectionTextureBlock.prototype, \"worldPosition\", {\n        /**\n         * Gets the world position input component\n         */\n        get: function () {\n            return this._inputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReflectionTextureBlock.prototype, \"worldNormal\", {\n        /**\n         * Gets the world normal input component\n         */\n        get: function () {\n            return this._inputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReflectionTextureBlock.prototype, \"world\", {\n        /**\n         * Gets the world input component\n         */\n        get: function () {\n            return this._inputs[3];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReflectionTextureBlock.prototype, \"cameraPosition\", {\n        /**\n         * Gets the camera (or eye) position component\n         */\n        get: function () {\n            return this._inputs[4];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReflectionTextureBlock.prototype, \"view\", {\n        /**\n         * Gets the view input component\n         */\n        get: function () {\n            return this._inputs[5];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReflectionTextureBlock.prototype, \"rgb\", {\n        /**\n         * Gets the rgb output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReflectionTextureBlock.prototype, \"rgba\", {\n        /**\n         * Gets the rgba output component\n         */\n        get: function () {\n            return this._outputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReflectionTextureBlock.prototype, \"r\", {\n        /**\n         * Gets the r output component\n         */\n        get: function () {\n            return this._outputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReflectionTextureBlock.prototype, \"g\", {\n        /**\n         * Gets the g output component\n         */\n        get: function () {\n            return this._outputs[3];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReflectionTextureBlock.prototype, \"b\", {\n        /**\n         * Gets the b output component\n         */\n        get: function () {\n            return this._outputs[4];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ReflectionTextureBlock.prototype, \"a\", {\n        /**\n         * Gets the a output component\n         */\n        get: function () {\n            return this._outputs[5];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ReflectionTextureBlock.prototype.autoConfigure = function (material) {\n        _super.prototype.autoConfigure.call(this, material);\n        if (!this.cameraPosition.isConnected) {\n            var cameraPositionInput = material.getInputBlockByPredicate(function (b) { return b.systemValue === NodeMaterialSystemValues.CameraPosition; });\n            if (!cameraPositionInput) {\n                cameraPositionInput = new InputBlock(\"cameraPosition\");\n                cameraPositionInput.setAsSystemValue(NodeMaterialSystemValues.CameraPosition);\n            }\n            cameraPositionInput.output.connectTo(this.cameraPosition);\n        }\n    };\n    ReflectionTextureBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        if (!this.texture) {\n            state.compilationString += this.writeOutputs(state, \"vec3(0.)\");\n            return this;\n        }\n        if (state.target !== NodeMaterialBlockTargets.Fragment) {\n            state.compilationString += this.handleVertexSide(state);\n            return this;\n        }\n        this.handleFragmentSideInits(state);\n        var normalWUnit = state._getFreeVariableName(\"normalWUnit\");\n        state.compilationString += \"vec4 \".concat(normalWUnit, \" = normalize(\").concat(this.worldNormal.associatedVariableName, \");\\r\\n\");\n        state.compilationString += this.handleFragmentSideCodeReflectionCoords(normalWUnit);\n        state.compilationString += this.handleFragmentSideCodeReflectionColor(undefined, \"\");\n        state.compilationString += this.writeOutputs(state, this._reflectionColorName);\n        return this;\n    };\n    return ReflectionTextureBlock;\n}(ReflectionTextureBaseBlock));\nexport { ReflectionTextureBlock };\nRegisterClass(\"BABYLON.ReflectionTextureBlock\", ReflectionTextureBlock);\n//# sourceMappingURL=reflectionTextureBlock.js.map","import { __decorate, __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { editableInPropertyPage, PropertyTypeForEdition } from \"../../nodeMaterialDecorator.js\";\n/**\n * Block used to retrieve the depth (zbuffer) of the scene\n * @since 5.0.0\n */\nvar SceneDepthBlock = /** @class */ (function (_super) {\n    __extends(SceneDepthBlock, _super);\n    /**\n     * Create a new SceneDepthBlock\n     * @param name defines the block name\n     */\n    function SceneDepthBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.VertexAndFragment) || this;\n        _this._samplerName = \"textureSampler\";\n        /**\n         * Defines if the depth renderer should be setup in non linear mode\n         */\n        _this.useNonLinearDepth = false;\n        /**\n         * Defines if the depth renderer should be setup in full 32 bits float mode\n         */\n        _this.force32itsFloat = false;\n        _this._isUnique = true;\n        _this.registerInput(\"uv\", NodeMaterialBlockConnectionPointTypes.Vector2, false, NodeMaterialBlockTargets.VertexAndFragment);\n        _this.registerOutput(\"depth\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Neutral);\n        _this._inputs[0].acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Vector3);\n        _this._inputs[0].acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Vector4);\n        _this._inputs[0]._prioritizeVertex = false;\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    SceneDepthBlock.prototype.getClassName = function () {\n        return \"SceneDepthBlock\";\n    };\n    Object.defineProperty(SceneDepthBlock.prototype, \"uv\", {\n        /**\n         * Gets the uv input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SceneDepthBlock.prototype, \"depth\", {\n        /**\n         * Gets the depth output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Initialize the block and prepare the context for build\n     * @param state defines the state that will be used for the build\n     */\n    SceneDepthBlock.prototype.initialize = function (state) {\n        state._excludeVariableName(\"textureSampler\");\n    };\n    Object.defineProperty(SceneDepthBlock.prototype, \"target\", {\n        get: function () {\n            if (!this.uv.isConnected) {\n                return NodeMaterialBlockTargets.VertexAndFragment;\n            }\n            if (this.uv.sourceBlock.isInput) {\n                return NodeMaterialBlockTargets.VertexAndFragment;\n            }\n            return NodeMaterialBlockTargets.Fragment;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    SceneDepthBlock.prototype._getTexture = function (scene) {\n        var depthRenderer = scene.enableDepthRenderer(undefined, this.useNonLinearDepth, this.force32itsFloat);\n        return depthRenderer.getDepthMap();\n    };\n    SceneDepthBlock.prototype.bind = function (effect, nodeMaterial) {\n        var texture = this._getTexture(nodeMaterial.getScene());\n        effect.setTexture(this._samplerName, texture);\n    };\n    SceneDepthBlock.prototype._injectVertexCode = function (state) {\n        var uvInput = this.uv;\n        if (uvInput.connectedPoint.ownerBlock.isInput) {\n            var uvInputOwnerBlock = uvInput.connectedPoint.ownerBlock;\n            if (!uvInputOwnerBlock.isAttribute) {\n                state._emitUniformFromString(uvInput.associatedVariableName, \"vec\" + (uvInput.type === NodeMaterialBlockConnectionPointTypes.Vector3 ? \"3\" : uvInput.type === NodeMaterialBlockConnectionPointTypes.Vector4 ? \"4\" : \"2\"));\n            }\n        }\n        this._mainUVName = \"vMain\" + uvInput.associatedVariableName;\n        state._emitVaryingFromString(this._mainUVName, \"vec2\");\n        state.compilationString += \"\".concat(this._mainUVName, \" = \").concat(uvInput.associatedVariableName, \".xy;\\r\\n\");\n        if (!this._outputs.some(function (o) { return o.isConnectedInVertexShader; })) {\n            return;\n        }\n        this._writeTextureRead(state, true);\n        for (var _i = 0, _a = this._outputs; _i < _a.length; _i++) {\n            var output = _a[_i];\n            if (output.hasEndpoints) {\n                this._writeOutput(state, output, \"r\", true);\n            }\n        }\n    };\n    SceneDepthBlock.prototype._writeTextureRead = function (state, vertexMode) {\n        if (vertexMode === void 0) { vertexMode = false; }\n        var uvInput = this.uv;\n        if (vertexMode) {\n            if (state.target === NodeMaterialBlockTargets.Fragment) {\n                return;\n            }\n            state.compilationString += \"vec4 \".concat(this._tempTextureRead, \" = texture2D(\").concat(this._samplerName, \", \").concat(uvInput.associatedVariableName, \".xy);\\r\\n\");\n            return;\n        }\n        if (this.uv.ownerBlock.target === NodeMaterialBlockTargets.Fragment) {\n            state.compilationString += \"vec4 \".concat(this._tempTextureRead, \" = texture2D(\").concat(this._samplerName, \", \").concat(uvInput.associatedVariableName, \".xy);\\r\\n\");\n            return;\n        }\n        state.compilationString += \"vec4 \".concat(this._tempTextureRead, \" = texture2D(\").concat(this._samplerName, \", \").concat(this._mainUVName, \");\\r\\n\");\n    };\n    SceneDepthBlock.prototype._writeOutput = function (state, output, swizzle, vertexMode) {\n        if (vertexMode === void 0) { vertexMode = false; }\n        if (vertexMode) {\n            if (state.target === NodeMaterialBlockTargets.Fragment) {\n                return;\n            }\n            state.compilationString += \"\".concat(this._declareOutput(output, state), \" = \").concat(this._tempTextureRead, \".\").concat(swizzle, \";\\r\\n\");\n            return;\n        }\n        if (this.uv.ownerBlock.target === NodeMaterialBlockTargets.Fragment) {\n            state.compilationString += \"\".concat(this._declareOutput(output, state), \" = \").concat(this._tempTextureRead, \".\").concat(swizzle, \";\\r\\n\");\n            return;\n        }\n        state.compilationString += \"\".concat(this._declareOutput(output, state), \" = \").concat(this._tempTextureRead, \".\").concat(swizzle, \";\\r\\n\");\n    };\n    SceneDepthBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        this._tempTextureRead = state._getFreeVariableName(\"tempTextureRead\");\n        if (state.sharedData.bindableBlocks.indexOf(this) < 0) {\n            state.sharedData.bindableBlocks.push(this);\n        }\n        if (state.target !== NodeMaterialBlockTargets.Fragment) {\n            // Vertex\n            state._emit2DSampler(this._samplerName);\n            this._injectVertexCode(state);\n            return;\n        }\n        // Fragment\n        if (!this._outputs.some(function (o) { return o.isConnectedInFragmentShader; })) {\n            return;\n        }\n        state._emit2DSampler(this._samplerName);\n        this._writeTextureRead(state);\n        for (var _i = 0, _a = this._outputs; _i < _a.length; _i++) {\n            var output = _a[_i];\n            if (output.hasEndpoints) {\n                this._writeOutput(state, output, \"r\");\n            }\n        }\n        return this;\n    };\n    SceneDepthBlock.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        serializationObject.useNonLinearDepth = this.useNonLinearDepth;\n        serializationObject.force32itsFloat = this.force32itsFloat;\n        return serializationObject;\n    };\n    SceneDepthBlock.prototype._deserialize = function (serializationObject, scene, rootUrl) {\n        _super.prototype._deserialize.call(this, serializationObject, scene, rootUrl);\n        this.useNonLinearDepth = serializationObject.useNonLinearDepth;\n        this.force32itsFloat = serializationObject.force32itsFloat;\n    };\n    __decorate([\n        editableInPropertyPage(\"Use non linear depth\", PropertyTypeForEdition.Boolean, \"ADVANCED\", {\n            notifiers: { activatePreviewCommand: true, callback: function (scene) { return scene.disableDepthRenderer(); } },\n        })\n    ], SceneDepthBlock.prototype, \"useNonLinearDepth\", void 0);\n    __decorate([\n        editableInPropertyPage(\"Force 32 bits float\", PropertyTypeForEdition.Boolean, \"ADVANCED\", {\n            notifiers: { activatePreviewCommand: true, callback: function (scene) { return scene.disableDepthRenderer(); } },\n        })\n    ], SceneDepthBlock.prototype, \"force32itsFloat\", void 0);\n    return SceneDepthBlock;\n}(NodeMaterialBlock));\nexport { SceneDepthBlock };\nRegisterClass(\"BABYLON.SceneDepthBlock\", SceneDepthBlock);\n//# sourceMappingURL=sceneDepthBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { MaterialHelper } from \"../../../materialHelper.js\";\n/**\n * Block used to implement clip planes\n */\nvar ClipPlanesBlock = /** @class */ (function (_super) {\n    __extends(ClipPlanesBlock, _super);\n    /**\n     * Create a new ClipPlanesBlock\n     * @param name defines the block name\n     */\n    function ClipPlanesBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.VertexAndFragment, true) || this;\n        _this.registerInput(\"worldPosition\", NodeMaterialBlockConnectionPointTypes.Vector4, false);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    ClipPlanesBlock.prototype.getClassName = function () {\n        return \"ClipPlanesBlock\";\n    };\n    /**\n     * Initialize the block and prepare the context for build\n     * @param state defines the state that will be used for the build\n     */\n    ClipPlanesBlock.prototype.initialize = function (state) {\n        state._excludeVariableName(\"vClipPlane\");\n        state._excludeVariableName(\"fClipDistance\");\n        state._excludeVariableName(\"vClipPlane2\");\n        state._excludeVariableName(\"fClipDistance2\");\n        state._excludeVariableName(\"vClipPlane3\");\n        state._excludeVariableName(\"fClipDistance3\");\n        state._excludeVariableName(\"vClipPlane4\");\n        state._excludeVariableName(\"fClipDistance4\");\n        state._excludeVariableName(\"vClipPlane5\");\n        state._excludeVariableName(\"fClipDistance5\");\n        state._excludeVariableName(\"vClipPlane6\");\n        state._excludeVariableName(\"fClipDistance6\");\n    };\n    Object.defineProperty(ClipPlanesBlock.prototype, \"worldPosition\", {\n        /**\n         * Gets the worldPosition input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ClipPlanesBlock.prototype, \"target\", {\n        get: function () {\n            return NodeMaterialBlockTargets.VertexAndFragment;\n        },\n        set: function (value) { },\n        enumerable: false,\n        configurable: true\n    });\n    ClipPlanesBlock.prototype.prepareDefines = function (mesh, nodeMaterial, defines) {\n        var scene = mesh.getScene();\n        var useClipPlane1 = scene.clipPlane !== undefined && scene.clipPlane !== null;\n        var useClipPlane2 = scene.clipPlane2 !== undefined && scene.clipPlane2 !== null;\n        var useClipPlane3 = scene.clipPlane3 !== undefined && scene.clipPlane3 !== null;\n        var useClipPlane4 = scene.clipPlane4 !== undefined && scene.clipPlane4 !== null;\n        var useClipPlane5 = scene.clipPlane5 !== undefined && scene.clipPlane5 !== null;\n        var useClipPlane6 = scene.clipPlane6 !== undefined && scene.clipPlane6 !== null;\n        defines.setValue(\"CLIPPLANE\", useClipPlane1, true);\n        defines.setValue(\"CLIPPLANE2\", useClipPlane2, true);\n        defines.setValue(\"CLIPPLANE3\", useClipPlane3, true);\n        defines.setValue(\"CLIPPLANE4\", useClipPlane4, true);\n        defines.setValue(\"CLIPPLANE5\", useClipPlane5, true);\n        defines.setValue(\"CLIPPLANE6\", useClipPlane6, true);\n    };\n    ClipPlanesBlock.prototype.bind = function (effect, nodeMaterial, mesh) {\n        if (!mesh) {\n            return;\n        }\n        var scene = mesh.getScene();\n        MaterialHelper.BindClipPlane(effect, scene);\n    };\n    ClipPlanesBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        var comments = \"//\".concat(this.name);\n        if (state.target !== NodeMaterialBlockTargets.Fragment) {\n            // Vertex\n            var worldPos = this.worldPosition;\n            state._emitFunctionFromInclude(\"clipPlaneVertexDeclaration\", comments, {\n                replaceStrings: [{ search: /uniform vec4 vClipPlane\\d*;/g, replace: \"\" }],\n            });\n            state.compilationString += state._emitCodeFromInclude(\"clipPlaneVertex\", comments, {\n                replaceStrings: [{ search: /worldPos/g, replace: worldPos.associatedVariableName }],\n            });\n            state._emitUniformFromString(\"vClipPlane\", \"vec4\");\n            state._emitUniformFromString(\"vClipPlane2\", \"vec4\");\n            state._emitUniformFromString(\"vClipPlane3\", \"vec4\");\n            state._emitUniformFromString(\"vClipPlane4\", \"vec4\");\n            state._emitUniformFromString(\"vClipPlane5\", \"vec4\");\n            state._emitUniformFromString(\"vClipPlane6\", \"vec4\");\n            return;\n        }\n        // Fragment\n        state.sharedData.bindableBlocks.push(this);\n        state.sharedData.blocksWithDefines.push(this);\n        state._emitFunctionFromInclude(\"clipPlaneFragmentDeclaration\", comments);\n        state.compilationString += state._emitCodeFromInclude(\"clipPlaneFragment\", comments);\n        return this;\n    };\n    return ClipPlanesBlock;\n}(NodeMaterialBlock));\nexport { ClipPlanesBlock };\nRegisterClass(\"BABYLON.ClipPlanesBlock\", ClipPlanesBlock);\n//# sourceMappingURL=clipPlanesBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { InputBlock } from \"../Input/inputBlock.js\";\nimport { NodeMaterialSystemValues } from \"../../Enums/nodeMaterialSystemValues.js\";\n\nimport \"../../../../Shaders/ShadersInclude/reflectionFunction.js\";\nimport { CubeTexture } from \"../../../Textures/cubeTexture.js\";\nimport { Texture } from \"../../../Textures/texture.js\";\nimport { EngineStore } from \"../../../../Engines/engineStore.js\";\n/**\n * Base block used to read a reflection texture from a sampler\n */\nvar ReflectionTextureBaseBlock = /** @class */ (function (_super) {\n    __extends(ReflectionTextureBaseBlock, _super);\n    /**\n     * Create a new ReflectionTextureBaseBlock\n     * @param name defines the block name\n     */\n    function ReflectionTextureBaseBlock(name) {\n        return _super.call(this, name, NodeMaterialBlockTargets.VertexAndFragment) || this;\n    }\n    Object.defineProperty(ReflectionTextureBaseBlock.prototype, \"texture\", {\n        /**\n         * Gets or sets the texture associated with the node\n         */\n        get: function () {\n            return this._texture;\n        },\n        set: function (texture) {\n            var _this = this;\n            var _a;\n            if (this._texture === texture) {\n                return;\n            }\n            var scene = (_a = texture === null || texture === void 0 ? void 0 : texture.getScene()) !== null && _a !== void 0 ? _a : EngineStore.LastCreatedScene;\n            if (!texture && scene) {\n                scene.markAllMaterialsAsDirty(1, function (mat) {\n                    return mat.hasTexture(_this._texture);\n                });\n            }\n            this._texture = texture;\n            if (texture && scene) {\n                scene.markAllMaterialsAsDirty(1, function (mat) {\n                    return mat.hasTexture(texture);\n                });\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    ReflectionTextureBaseBlock.prototype.getClassName = function () {\n        return \"ReflectionTextureBaseBlock\";\n    };\n    ReflectionTextureBaseBlock.prototype._getTexture = function () {\n        return this.texture;\n    };\n    ReflectionTextureBaseBlock.prototype.autoConfigure = function (material) {\n        if (!this.position.isConnected) {\n            var positionInput = material.getInputBlockByPredicate(function (b) { return b.isAttribute && b.name === \"position\"; });\n            if (!positionInput) {\n                positionInput = new InputBlock(\"position\");\n                positionInput.setAsAttribute();\n            }\n            positionInput.output.connectTo(this.position);\n        }\n        if (!this.world.isConnected) {\n            var worldInput = material.getInputBlockByPredicate(function (b) { return b.systemValue === NodeMaterialSystemValues.World; });\n            if (!worldInput) {\n                worldInput = new InputBlock(\"world\");\n                worldInput.setAsSystemValue(NodeMaterialSystemValues.World);\n            }\n            worldInput.output.connectTo(this.world);\n        }\n        if (this.view && !this.view.isConnected) {\n            var viewInput = material.getInputBlockByPredicate(function (b) { return b.systemValue === NodeMaterialSystemValues.View; });\n            if (!viewInput) {\n                viewInput = new InputBlock(\"view\");\n                viewInput.setAsSystemValue(NodeMaterialSystemValues.View);\n            }\n            viewInput.output.connectTo(this.view);\n        }\n    };\n    ReflectionTextureBaseBlock.prototype.prepareDefines = function (mesh, nodeMaterial, defines) {\n        if (!defines._areTexturesDirty) {\n            return;\n        }\n        var texture = this._getTexture();\n        if (!texture || !texture.getTextureMatrix) {\n            return;\n        }\n        defines.setValue(this._define3DName, texture.isCube, true);\n        defines.setValue(this._defineLocalCubicName, texture.boundingBoxSize ? true : false, true);\n        defines.setValue(this._defineExplicitName, texture.coordinatesMode === 0, true);\n        defines.setValue(this._defineSkyboxName, texture.coordinatesMode === 5, true);\n        defines.setValue(this._defineCubicName, texture.coordinatesMode === 3 || texture.coordinatesMode === 6, true);\n        defines.setValue(\"INVERTCUBICMAP\", texture.coordinatesMode === 6, true);\n        defines.setValue(this._defineSphericalName, texture.coordinatesMode === 1, true);\n        defines.setValue(this._definePlanarName, texture.coordinatesMode === 2, true);\n        defines.setValue(this._defineProjectionName, texture.coordinatesMode === 4, true);\n        defines.setValue(this._defineEquirectangularName, texture.coordinatesMode === 7, true);\n        defines.setValue(this._defineEquirectangularFixedName, texture.coordinatesMode === 8, true);\n        defines.setValue(this._defineMirroredEquirectangularFixedName, texture.coordinatesMode === 9, true);\n    };\n    ReflectionTextureBaseBlock.prototype.isReady = function () {\n        var texture = this._getTexture();\n        if (texture && !texture.isReadyOrNotBlocking()) {\n            return false;\n        }\n        return true;\n    };\n    ReflectionTextureBaseBlock.prototype.bind = function (effect, nodeMaterial, mesh) {\n        var texture = this._getTexture();\n        if (!mesh || !texture) {\n            return;\n        }\n        effect.setMatrix(this._reflectionMatrixName, texture.getReflectionTextureMatrix());\n        if (texture.isCube) {\n            effect.setTexture(this._cubeSamplerName, texture);\n        }\n        else {\n            effect.setTexture(this._2DSamplerName, texture);\n        }\n        if (texture.boundingBoxSize) {\n            var cubeTexture = texture;\n            effect.setVector3(this._reflectionPositionName, cubeTexture.boundingBoxPosition);\n            effect.setVector3(this._reflectionSizeName, cubeTexture.boundingBoxSize);\n        }\n    };\n    /**\n     * Gets the code to inject in the vertex shader\n     * @param state current state of the node material building\n     * @returns the shader code\n     */\n    ReflectionTextureBaseBlock.prototype.handleVertexSide = function (state) {\n        this._define3DName = state._getFreeDefineName(\"REFLECTIONMAP_3D\");\n        this._defineCubicName = state._getFreeDefineName(\"REFLECTIONMAP_CUBIC\");\n        this._defineSphericalName = state._getFreeDefineName(\"REFLECTIONMAP_SPHERICAL\");\n        this._definePlanarName = state._getFreeDefineName(\"REFLECTIONMAP_PLANAR\");\n        this._defineProjectionName = state._getFreeDefineName(\"REFLECTIONMAP_PROJECTION\");\n        this._defineExplicitName = state._getFreeDefineName(\"REFLECTIONMAP_EXPLICIT\");\n        this._defineEquirectangularName = state._getFreeDefineName(\"REFLECTIONMAP_EQUIRECTANGULAR\");\n        this._defineLocalCubicName = state._getFreeDefineName(\"USE_LOCAL_REFLECTIONMAP_CUBIC\");\n        this._defineMirroredEquirectangularFixedName = state._getFreeDefineName(\"REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\");\n        this._defineEquirectangularFixedName = state._getFreeDefineName(\"REFLECTIONMAP_EQUIRECTANGULAR_FIXED\");\n        this._defineSkyboxName = state._getFreeDefineName(\"REFLECTIONMAP_SKYBOX\");\n        this._defineOppositeZ = state._getFreeDefineName(\"REFLECTIONMAP_OPPOSITEZ\");\n        this._reflectionMatrixName = state._getFreeVariableName(\"reflectionMatrix\");\n        state._emitUniformFromString(this._reflectionMatrixName, \"mat4\");\n        var code = \"\";\n        var worldPosVaryingName = \"v_\" + this.worldPosition.associatedVariableName;\n        if (state._emitVaryingFromString(worldPosVaryingName, \"vec4\")) {\n            code += \"\".concat(worldPosVaryingName, \" = \").concat(this.worldPosition.associatedVariableName, \";\\r\\n\");\n        }\n        this._positionUVWName = state._getFreeVariableName(\"positionUVW\");\n        this._directionWName = state._getFreeVariableName(\"directionW\");\n        if (state._emitVaryingFromString(this._positionUVWName, \"vec3\", this._defineSkyboxName)) {\n            code += \"#ifdef \".concat(this._defineSkyboxName, \"\\r\\n\");\n            code += \"\".concat(this._positionUVWName, \" = \").concat(this.position.associatedVariableName, \".xyz;\\r\\n\");\n            code += \"#endif\\r\\n\";\n        }\n        if (state._emitVaryingFromString(this._directionWName, \"vec3\", \"defined(\".concat(this._defineEquirectangularFixedName, \") || defined(\").concat(this._defineMirroredEquirectangularFixedName, \")\"))) {\n            code += \"#if defined(\".concat(this._defineEquirectangularFixedName, \") || defined(\").concat(this._defineMirroredEquirectangularFixedName, \")\\r\\n\");\n            code += \"\".concat(this._directionWName, \" = normalize(vec3(\").concat(this.world.associatedVariableName, \" * vec4(\").concat(this.position.associatedVariableName, \".xyz, 0.0)));\\r\\n\");\n            code += \"#endif\\r\\n\";\n        }\n        return code;\n    };\n    /**\n     * Handles the inits for the fragment code path\n     * @param state node material build state\n     */\n    ReflectionTextureBaseBlock.prototype.handleFragmentSideInits = function (state) {\n        state.sharedData.blockingBlocks.push(this);\n        state.sharedData.textureBlocks.push(this);\n        // Samplers\n        this._cubeSamplerName = state._getFreeVariableName(this.name + \"CubeSampler\");\n        state.samplers.push(this._cubeSamplerName);\n        this._2DSamplerName = state._getFreeVariableName(this.name + \"2DSampler\");\n        state.samplers.push(this._2DSamplerName);\n        state._samplerDeclaration += \"#ifdef \".concat(this._define3DName, \"\\r\\n\");\n        state._samplerDeclaration += \"uniform samplerCube \".concat(this._cubeSamplerName, \";\\r\\n\");\n        state._samplerDeclaration += \"#else\\r\\n\";\n        state._samplerDeclaration += \"uniform sampler2D \".concat(this._2DSamplerName, \";\\r\\n\");\n        state._samplerDeclaration += \"#endif\\r\\n\";\n        // Fragment\n        state.sharedData.blocksWithDefines.push(this);\n        state.sharedData.bindableBlocks.push(this);\n        var comments = \"//\".concat(this.name);\n        state._emitFunction(\"ReciprocalPI\", \"#define RECIPROCAL_PI2 0.15915494\", \"\");\n        state._emitFunctionFromInclude(\"helperFunctions\", comments);\n        state._emitFunctionFromInclude(\"reflectionFunction\", comments, {\n            replaceStrings: [{ search: /vec3 computeReflectionCoords/g, replace: \"void DUMMYFUNC\" }],\n        });\n        this._reflectionColorName = state._getFreeVariableName(\"reflectionColor\");\n        this._reflectionVectorName = state._getFreeVariableName(\"reflectionUVW\");\n        this._reflectionCoordsName = state._getFreeVariableName(\"reflectionCoords\");\n        this._reflectionPositionName = state._getFreeVariableName(\"vReflectionPosition\");\n        state._emitUniformFromString(this._reflectionPositionName, \"vec3\");\n        this._reflectionSizeName = state._getFreeVariableName(\"vReflectionPosition\");\n        state._emitUniformFromString(this._reflectionSizeName, \"vec3\");\n    };\n    /**\n     * Generates the reflection coords code for the fragment code path\n     * @param worldNormalVarName name of the world normal variable\n     * @param worldPos name of the world position variable. If not provided, will use the world position connected to this block\n     * @param onlyReflectionVector if true, generates code only for the reflection vector computation, not for the reflection coordinates\n     * @param doNotEmitInvertZ if true, does not emit the invertZ code\n     * @returns the shader code\n     */\n    ReflectionTextureBaseBlock.prototype.handleFragmentSideCodeReflectionCoords = function (worldNormalVarName, worldPos, onlyReflectionVector, doNotEmitInvertZ) {\n        if (onlyReflectionVector === void 0) { onlyReflectionVector = false; }\n        if (doNotEmitInvertZ === void 0) { doNotEmitInvertZ = false; }\n        if (!worldPos) {\n            worldPos = \"v_\".concat(this.worldPosition.associatedVariableName);\n        }\n        var reflectionMatrix = this._reflectionMatrixName;\n        var direction = \"normalize(\".concat(this._directionWName, \")\");\n        var positionUVW = \"\".concat(this._positionUVWName);\n        var vEyePosition = \"\".concat(this.cameraPosition.associatedVariableName);\n        var view = \"\".concat(this.view.associatedVariableName);\n        worldNormalVarName += \".xyz\";\n        var code = \"\\n            #ifdef \".concat(this._defineMirroredEquirectangularFixedName, \"\\n                vec3 \").concat(this._reflectionVectorName, \" = computeMirroredFixedEquirectangularCoords(\").concat(worldPos, \", \").concat(worldNormalVarName, \", \").concat(direction, \");\\n            #endif\\n\\n            #ifdef \").concat(this._defineEquirectangularFixedName, \"\\n                vec3 \").concat(this._reflectionVectorName, \" = computeFixedEquirectangularCoords(\").concat(worldPos, \", \").concat(worldNormalVarName, \", \").concat(direction, \");\\n            #endif\\n\\n            #ifdef \").concat(this._defineEquirectangularName, \"\\n                vec3 \").concat(this._reflectionVectorName, \" = computeEquirectangularCoords(\").concat(worldPos, \", \").concat(worldNormalVarName, \", \").concat(vEyePosition, \".xyz, \").concat(reflectionMatrix, \");\\n            #endif\\n\\n            #ifdef \").concat(this._defineSphericalName, \"\\n                vec3 \").concat(this._reflectionVectorName, \" = computeSphericalCoords(\").concat(worldPos, \", \").concat(worldNormalVarName, \", \").concat(view, \", \").concat(reflectionMatrix, \");\\n            #endif\\n\\n            #ifdef \").concat(this._definePlanarName, \"\\n                vec3 \").concat(this._reflectionVectorName, \" = computePlanarCoords(\").concat(worldPos, \", \").concat(worldNormalVarName, \", \").concat(vEyePosition, \".xyz, \").concat(reflectionMatrix, \");\\n            #endif\\n\\n            #ifdef \").concat(this._defineCubicName, \"\\n                #ifdef \").concat(this._defineLocalCubicName, \"\\n                    vec3 \").concat(this._reflectionVectorName, \" = computeCubicLocalCoords(\").concat(worldPos, \", \").concat(worldNormalVarName, \", \").concat(vEyePosition, \".xyz, \").concat(reflectionMatrix, \", \").concat(this._reflectionSizeName, \", \").concat(this._reflectionPositionName, \");\\n                #else\\n                vec3 \").concat(this._reflectionVectorName, \" = computeCubicCoords(\").concat(worldPos, \", \").concat(worldNormalVarName, \", \").concat(vEyePosition, \".xyz, \").concat(reflectionMatrix, \");\\n                #endif\\n            #endif\\n\\n            #ifdef \").concat(this._defineProjectionName, \"\\n                vec3 \").concat(this._reflectionVectorName, \" = computeProjectionCoords(\").concat(worldPos, \", \").concat(view, \", \").concat(reflectionMatrix, \");\\n            #endif\\n\\n            #ifdef \").concat(this._defineSkyboxName, \"\\n                vec3 \").concat(this._reflectionVectorName, \" = computeSkyBoxCoords(\").concat(positionUVW, \", \").concat(reflectionMatrix, \");\\n            #endif\\n\\n            #ifdef \").concat(this._defineExplicitName, \"\\n                vec3 \").concat(this._reflectionVectorName, \" = vec3(0, 0, 0);\\n            #endif\\r\\n\");\n        if (!doNotEmitInvertZ) {\n            code += \"#ifdef \".concat(this._defineOppositeZ, \"\\n                \").concat(this._reflectionVectorName, \".z *= -1.0;\\n            #endif\\r\\n\");\n        }\n        if (!onlyReflectionVector) {\n            code += \"\\n                #ifdef \".concat(this._define3DName, \"\\n                    vec3 \").concat(this._reflectionCoordsName, \" = \").concat(this._reflectionVectorName, \";\\n                #else\\n                    vec2 \").concat(this._reflectionCoordsName, \" = \").concat(this._reflectionVectorName, \".xy;\\n                    #ifdef \").concat(this._defineProjectionName, \"\\n                        \").concat(this._reflectionCoordsName, \" /= \").concat(this._reflectionVectorName, \".z;\\n                    #endif\\n                    \").concat(this._reflectionCoordsName, \".y = 1.0 - \").concat(this._reflectionCoordsName, \".y;\\n                #endif\\r\\n\");\n        }\n        return code;\n    };\n    /**\n     * Generates the reflection color code for the fragment code path\n     * @param lodVarName name of the lod variable\n     * @param swizzleLookupTexture swizzle to use for the final color variable\n     * @returns the shader code\n     */\n    ReflectionTextureBaseBlock.prototype.handleFragmentSideCodeReflectionColor = function (lodVarName, swizzleLookupTexture) {\n        if (swizzleLookupTexture === void 0) { swizzleLookupTexture = \".rgb\"; }\n        var colorType = \"vec\" + (swizzleLookupTexture.length === 0 ? \"4\" : swizzleLookupTexture.length - 1);\n        var code = \"\".concat(colorType, \" \").concat(this._reflectionColorName, \";\\n            #ifdef \").concat(this._define3DName, \"\\r\\n\");\n        if (lodVarName) {\n            code += \"\".concat(this._reflectionColorName, \" = textureCubeLodEXT(\").concat(this._cubeSamplerName, \", \").concat(this._reflectionVectorName, \", \").concat(lodVarName, \")\").concat(swizzleLookupTexture, \";\\r\\n\");\n        }\n        else {\n            code += \"\".concat(this._reflectionColorName, \" = textureCube(\").concat(this._cubeSamplerName, \", \").concat(this._reflectionVectorName, \")\").concat(swizzleLookupTexture, \";\\r\\n\");\n        }\n        code += \"\\n            #else\\r\\n\";\n        if (lodVarName) {\n            code += \"\".concat(this._reflectionColorName, \" = texture2DLodEXT(\").concat(this._2DSamplerName, \", \").concat(this._reflectionCoordsName, \", \").concat(lodVarName, \")\").concat(swizzleLookupTexture, \";\\r\\n\");\n        }\n        else {\n            code += \"\".concat(this._reflectionColorName, \" = texture2D(\").concat(this._2DSamplerName, \", \").concat(this._reflectionCoordsName, \")\").concat(swizzleLookupTexture, \";\\r\\n\");\n        }\n        code += \"#endif\\r\\n\";\n        return code;\n    };\n    /**\n     * Generates the code corresponding to the connected output points\n     * @param state node material build state\n     * @param varName name of the variable to output\n     * @returns the shader code\n     */\n    ReflectionTextureBaseBlock.prototype.writeOutputs = function (state, varName) {\n        var code = \"\";\n        if (state.target === NodeMaterialBlockTargets.Fragment) {\n            for (var _i = 0, _a = this._outputs; _i < _a.length; _i++) {\n                var output = _a[_i];\n                if (output.hasEndpoints) {\n                    code += \"\".concat(this._declareOutput(output, state), \" = \").concat(varName, \".\").concat(output.name, \";\\r\\n\");\n                }\n            }\n        }\n        return code;\n    };\n    ReflectionTextureBaseBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        return this;\n    };\n    ReflectionTextureBaseBlock.prototype._dumpPropertiesCode = function () {\n        var codeString = _super.prototype._dumpPropertiesCode.call(this);\n        if (!this.texture) {\n            return codeString;\n        }\n        if (this.texture.isCube) {\n            var forcedExtension = this.texture.forcedExtension;\n            codeString += \"\".concat(this._codeVariableName, \".texture = new BABYLON.CubeTexture(\\\"\").concat(this.texture.name, \"\\\", undefined, undefined, \").concat(this.texture.noMipmap, \", null, undefined, undefined, undefined, \").concat(this.texture._prefiltered, \", \").concat(forcedExtension ? '\"' + forcedExtension + '\"' : \"null\", \");\\r\\n\");\n        }\n        else {\n            codeString += \"\".concat(this._codeVariableName, \".texture = new BABYLON.Texture(\\\"\").concat(this.texture.name, \"\\\", null);\\r\\n\");\n        }\n        codeString += \"\".concat(this._codeVariableName, \".texture.coordinatesMode = \").concat(this.texture.coordinatesMode, \";\\r\\n\");\n        return codeString;\n    };\n    ReflectionTextureBaseBlock.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        if (this.texture && !this.texture.isRenderTarget) {\n            serializationObject.texture = this.texture.serialize();\n        }\n        return serializationObject;\n    };\n    ReflectionTextureBaseBlock.prototype._deserialize = function (serializationObject, scene, rootUrl) {\n        _super.prototype._deserialize.call(this, serializationObject, scene, rootUrl);\n        if (serializationObject.texture) {\n            rootUrl = serializationObject.texture.url.indexOf(\"data:\") === 0 ? \"\" : rootUrl;\n            if (serializationObject.texture.isCube) {\n                this.texture = CubeTexture.Parse(serializationObject.texture, scene, rootUrl);\n            }\n            else {\n                this.texture = Texture.Parse(serializationObject.texture, scene, rootUrl);\n            }\n        }\n    };\n    return ReflectionTextureBaseBlock;\n}(NodeMaterialBlock));\nexport { ReflectionTextureBaseBlock };\nRegisterClass(\"BABYLON.ReflectionTextureBaseBlock\", ReflectionTextureBaseBlock);\n//# sourceMappingURL=reflectionTextureBaseBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { NodeMaterialConnectionPointDirection } from \"../../nodeMaterialBlockConnectionPoint.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { NodeMaterialConnectionPointCustomObject } from \"../../nodeMaterialConnectionPointCustomObject.js\";\nimport { NodeMaterialSystemValues } from \"../../Enums/nodeMaterialSystemValues.js\";\nimport { InputBlock } from \"../Input/inputBlock.js\";\n/**\n * Block used to implement TBN matrix\n */\nvar TBNBlock = /** @class */ (function (_super) {\n    __extends(TBNBlock, _super);\n    /**\n     * Create a new TBNBlock\n     * @param name defines the block name\n     */\n    function TBNBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment, true) || this;\n        _this.registerInput(\"normal\", NodeMaterialBlockConnectionPointTypes.Vector4, false);\n        _this.normal.acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Vector3);\n        _this.registerInput(\"tangent\", NodeMaterialBlockConnectionPointTypes.Vector4, false);\n        _this.registerInput(\"world\", NodeMaterialBlockConnectionPointTypes.Matrix, false);\n        _this.registerOutput(\"TBN\", NodeMaterialBlockConnectionPointTypes.Object, NodeMaterialBlockTargets.Fragment, new NodeMaterialConnectionPointCustomObject(\"TBN\", _this, NodeMaterialConnectionPointDirection.Output, TBNBlock, \"TBNBlock\"));\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    TBNBlock.prototype.getClassName = function () {\n        return \"TBNBlock\";\n    };\n    /**\n     * Initialize the block and prepare the context for build\n     * @param state defines the state that will be used for the build\n     */\n    TBNBlock.prototype.initialize = function (state) {\n        state._excludeVariableName(\"tbnNormal\");\n        state._excludeVariableName(\"tbnTangent\");\n        state._excludeVariableName(\"tbnBitangent\");\n        state._excludeVariableName(\"TBN\");\n    };\n    Object.defineProperty(TBNBlock.prototype, \"normal\", {\n        /**\n         * Gets the normal input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TBNBlock.prototype, \"tangent\", {\n        /**\n         * Gets the tangent input component\n         */\n        get: function () {\n            return this._inputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TBNBlock.prototype, \"world\", {\n        /**\n         * Gets the world matrix input component\n         */\n        get: function () {\n            return this._inputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TBNBlock.prototype, \"TBN\", {\n        /**\n         * Gets the TBN output component\n         */\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TBNBlock.prototype, \"target\", {\n        get: function () {\n            return NodeMaterialBlockTargets.Fragment;\n        },\n        set: function (value) { },\n        enumerable: false,\n        configurable: true\n    });\n    TBNBlock.prototype.autoConfigure = function (material) {\n        if (!this.world.isConnected) {\n            var worldInput = material.getInputBlockByPredicate(function (b) { return b.isSystemValue && b.systemValue === NodeMaterialSystemValues.World; });\n            if (!worldInput) {\n                worldInput = new InputBlock(\"world\");\n                worldInput.setAsSystemValue(NodeMaterialSystemValues.World);\n            }\n            worldInput.output.connectTo(this.world);\n        }\n        if (!this.normal.isConnected) {\n            var normalInput = material.getInputBlockByPredicate(function (b) { return b.isAttribute && b.name === \"normal\"; });\n            if (!normalInput) {\n                normalInput = new InputBlock(\"normal\");\n                normalInput.setAsAttribute(\"normal\");\n            }\n            normalInput.output.connectTo(this.normal);\n        }\n        if (!this.tangent.isConnected) {\n            var tangentInput = material.getInputBlockByPredicate(function (b) { return b.isAttribute && b.name === \"tangent\" && b.type === NodeMaterialBlockConnectionPointTypes.Vector4; });\n            if (!tangentInput) {\n                tangentInput = new InputBlock(\"tangent\");\n                tangentInput.setAsAttribute(\"tangent\");\n            }\n            tangentInput.output.connectTo(this.tangent);\n        }\n    };\n    TBNBlock.prototype.prepareDefines = function (mesh, nodeMaterial, defines) {\n        var _a, _b, _c, _d;\n        var normal = this.normal;\n        var tangent = this.tangent;\n        var normalAvailable = normal.isConnected;\n        if (((_a = normal.connectInputBlock) === null || _a === void 0 ? void 0 : _a.isAttribute) && !mesh.isVerticesDataPresent((_b = normal.connectInputBlock) === null || _b === void 0 ? void 0 : _b.name)) {\n            normalAvailable = false;\n        }\n        var tangentAvailable = tangent.isConnected;\n        if (((_c = tangent.connectInputBlock) === null || _c === void 0 ? void 0 : _c.isAttribute) && !mesh.isVerticesDataPresent((_d = tangent.connectInputBlock) === null || _d === void 0 ? void 0 : _d.name)) {\n            tangentAvailable = false;\n        }\n        var useTBNBlock = normalAvailable && tangentAvailable;\n        defines.setValue(\"TBNBLOCK\", useTBNBlock, true);\n    };\n    TBNBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        var normal = this.normal;\n        var tangent = this.tangent;\n        var world = this.world;\n        var TBN = this.TBN;\n        // Fragment\n        if (state.target === NodeMaterialBlockTargets.Fragment) {\n            state.compilationString += \"\\n                // \".concat(this.name, \"\\n                vec3 tbnNormal = normalize(\").concat(normal.associatedVariableName, \").xyz;\\n                vec3 tbnTangent = normalize(\").concat(tangent.associatedVariableName, \".xyz);\\n                vec3 tbnBitangent = cross(tbnNormal, tbnTangent) * \").concat(tangent.associatedVariableName, \".w;\\n                mat3 \").concat(TBN.associatedVariableName, \" = mat3(\").concat(world.associatedVariableName, \") * mat3(tbnTangent, tbnBitangent, tbnNormal);\\n            \");\n            state.sharedData.blocksWithDefines.push(this);\n        }\n        return this;\n    };\n    return TBNBlock;\n}(NodeMaterialBlock));\nexport { TBNBlock };\nRegisterClass(\"BABYLON.TBNBlock\", TBNBlock);\n//# sourceMappingURL=TBNBlock.js.map","import { __decorate, __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { editableInPropertyPage, PropertyTypeForEdition } from \"../../nodeMaterialDecorator.js\";\nimport { MaterialHelper } from \"../../../materialHelper.js\";\n/**\n * Block used to output the final color\n */\nvar FragmentOutputBlock = /** @class */ (function (_super) {\n    __extends(FragmentOutputBlock, _super);\n    /**\n     * Create a new FragmentOutputBlock\n     * @param name defines the block name\n     */\n    function FragmentOutputBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment, true) || this;\n        /** Gets or sets a boolean indicating if content needs to be converted to gamma space */\n        _this.convertToGammaSpace = false;\n        /** Gets or sets a boolean indicating if content needs to be converted to linear space */\n        _this.convertToLinearSpace = false;\n        /** Gets or sets a boolean indicating if logarithmic depth should be used */\n        _this.useLogarithmicDepth = false;\n        _this.registerInput(\"rgba\", NodeMaterialBlockConnectionPointTypes.Color4, true);\n        _this.registerInput(\"rgb\", NodeMaterialBlockConnectionPointTypes.Color3, true);\n        _this.registerInput(\"a\", NodeMaterialBlockConnectionPointTypes.Float, true);\n        _this.rgb.acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Float);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    FragmentOutputBlock.prototype.getClassName = function () {\n        return \"FragmentOutputBlock\";\n    };\n    /**\n     * Initialize the block and prepare the context for build\n     * @param state defines the state that will be used for the build\n     */\n    FragmentOutputBlock.prototype.initialize = function (state) {\n        state._excludeVariableName(\"logarithmicDepthConstant\");\n        state._excludeVariableName(\"vFragmentDepth\");\n    };\n    Object.defineProperty(FragmentOutputBlock.prototype, \"rgba\", {\n        /**\n         * Gets the rgba input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FragmentOutputBlock.prototype, \"rgb\", {\n        /**\n         * Gets the rgb input component\n         */\n        get: function () {\n            return this._inputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FragmentOutputBlock.prototype, \"a\", {\n        /**\n         * Gets the a input component\n         */\n        get: function () {\n            return this._inputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    FragmentOutputBlock.prototype.prepareDefines = function (mesh, nodeMaterial, defines) {\n        defines.setValue(this._linearDefineName, this.convertToLinearSpace, true);\n        defines.setValue(this._gammaDefineName, this.convertToGammaSpace, true);\n    };\n    FragmentOutputBlock.prototype.bind = function (effect, nodeMaterial, mesh) {\n        if (this.useLogarithmicDepth && mesh) {\n            MaterialHelper.BindLogDepth(undefined, effect, mesh.getScene());\n        }\n    };\n    FragmentOutputBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        var rgba = this.rgba;\n        var rgb = this.rgb;\n        var a = this.a;\n        state.sharedData.hints.needAlphaBlending = rgba.isConnected || a.isConnected;\n        state.sharedData.blocksWithDefines.push(this);\n        if (this.useLogarithmicDepth) {\n            state._emitUniformFromString(\"logarithmicDepthConstant\", \"float\");\n            state._emitVaryingFromString(\"vFragmentDepth\", \"float\");\n            state.sharedData.bindableBlocks.push(this);\n        }\n        this._linearDefineName = state._getFreeDefineName(\"CONVERTTOLINEAR\");\n        this._gammaDefineName = state._getFreeDefineName(\"CONVERTTOGAMMA\");\n        var comments = \"//\".concat(this.name);\n        state._emitFunctionFromInclude(\"helperFunctions\", comments);\n        if (rgba.connectedPoint) {\n            if (a.isConnected) {\n                state.compilationString += \"gl_FragColor = vec4(\".concat(rgba.associatedVariableName, \".rgb, \").concat(a.associatedVariableName, \");\\r\\n\");\n            }\n            else {\n                state.compilationString += \"gl_FragColor = \".concat(rgba.associatedVariableName, \";\\r\\n\");\n            }\n        }\n        else if (rgb.connectedPoint) {\n            var aValue = \"1.0\";\n            if (a.connectedPoint) {\n                aValue = a.associatedVariableName;\n            }\n            if (rgb.connectedPoint.type === NodeMaterialBlockConnectionPointTypes.Float) {\n                state.compilationString += \"gl_FragColor = vec4(\".concat(rgb.associatedVariableName, \", \").concat(rgb.associatedVariableName, \", \").concat(rgb.associatedVariableName, \", \").concat(aValue, \");\\r\\n\");\n            }\n            else {\n                state.compilationString += \"gl_FragColor = vec4(\".concat(rgb.associatedVariableName, \", \").concat(aValue, \");\\r\\n\");\n            }\n        }\n        else {\n            state.sharedData.checks.notConnectedNonOptionalInputs.push(rgba);\n        }\n        state.compilationString += \"#ifdef \".concat(this._linearDefineName, \"\\r\\n\");\n        state.compilationString += \"gl_FragColor = toLinearSpace(gl_FragColor);\\r\\n\";\n        state.compilationString += \"#endif\\r\\n\";\n        state.compilationString += \"#ifdef \".concat(this._gammaDefineName, \"\\r\\n\");\n        state.compilationString += \"gl_FragColor = toGammaSpace(gl_FragColor);\\r\\n\";\n        state.compilationString += \"#endif\\r\\n\";\n        if (this.useLogarithmicDepth) {\n            state.compilationString += \"gl_FragDepthEXT = log2(vFragmentDepth) * logarithmicDepthConstant * 0.5;\\r\\n\";\n        }\n        return this;\n    };\n    FragmentOutputBlock.prototype._dumpPropertiesCode = function () {\n        var codeString = _super.prototype._dumpPropertiesCode.call(this);\n        codeString += \"\".concat(this._codeVariableName, \".convertToGammaSpace = \").concat(this.convertToGammaSpace, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".convertToLinearSpace = \").concat(this.convertToLinearSpace, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".useLogarithmicDepth = \").concat(this.useLogarithmicDepth, \";\\r\\n\");\n        return codeString;\n    };\n    FragmentOutputBlock.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        serializationObject.convertToGammaSpace = this.convertToGammaSpace;\n        serializationObject.convertToLinearSpace = this.convertToLinearSpace;\n        serializationObject.useLogarithmicDepth = this.useLogarithmicDepth;\n        return serializationObject;\n    };\n    FragmentOutputBlock.prototype._deserialize = function (serializationObject, scene, rootUrl) {\n        var _a;\n        _super.prototype._deserialize.call(this, serializationObject, scene, rootUrl);\n        this.convertToGammaSpace = serializationObject.convertToGammaSpace;\n        this.convertToLinearSpace = serializationObject.convertToLinearSpace;\n        this.useLogarithmicDepth = (_a = serializationObject.useLogarithmicDepth) !== null && _a !== void 0 ? _a : false;\n    };\n    __decorate([\n        editableInPropertyPage(\"Convert to gamma space\", PropertyTypeForEdition.Boolean, \"PROPERTIES\", { notifiers: { update: true } })\n    ], FragmentOutputBlock.prototype, \"convertToGammaSpace\", void 0);\n    __decorate([\n        editableInPropertyPage(\"Convert to linear space\", PropertyTypeForEdition.Boolean, \"PROPERTIES\", { notifiers: { update: true } })\n    ], FragmentOutputBlock.prototype, \"convertToLinearSpace\", void 0);\n    __decorate([\n        editableInPropertyPage(\"Use logarithmic depth\", PropertyTypeForEdition.Boolean, \"PROPERTIES\")\n    ], FragmentOutputBlock.prototype, \"useLogarithmicDepth\", void 0);\n    return FragmentOutputBlock;\n}(NodeMaterialBlock));\nexport { FragmentOutputBlock };\nRegisterClass(\"BABYLON.FragmentOutputBlock\", FragmentOutputBlock);\n//# sourceMappingURL=fragmentOutputBlock.js.map","import { __decorate, __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { editableInPropertyPage, PropertyTypeForEdition } from \"../../nodeMaterialDecorator.js\";\nimport \"../../../../Shaders/ShadersInclude/helperFunctions.js\";\nimport \"../../../../Shaders/ShadersInclude/imageProcessingDeclaration.js\";\nimport \"../../../../Shaders/ShadersInclude/imageProcessingFunctions.js\";\n/**\n * Block used to add image processing support to fragment shader\n */\nvar ImageProcessingBlock = /** @class */ (function (_super) {\n    __extends(ImageProcessingBlock, _super);\n    /**\n     * Create a new ImageProcessingBlock\n     * @param name defines the block name\n     */\n    function ImageProcessingBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment) || this;\n        /**\n         * Defines if the input should be converted to linear space (default: true)\n         */\n        _this.convertInputToLinearSpace = true;\n        _this.registerInput(\"color\", NodeMaterialBlockConnectionPointTypes.Color4);\n        _this.registerOutput(\"output\", NodeMaterialBlockConnectionPointTypes.Color4);\n        _this._inputs[0].acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Color3);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    ImageProcessingBlock.prototype.getClassName = function () {\n        return \"ImageProcessingBlock\";\n    };\n    Object.defineProperty(ImageProcessingBlock.prototype, \"color\", {\n        /**\n         * Gets the color input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ImageProcessingBlock.prototype, \"output\", {\n        /**\n         * Gets the output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Initialize the block and prepare the context for build\n     * @param state defines the state that will be used for the build\n     */\n    ImageProcessingBlock.prototype.initialize = function (state) {\n        state._excludeVariableName(\"exposureLinear\");\n        state._excludeVariableName(\"contrast\");\n        state._excludeVariableName(\"vInverseScreenSize\");\n        state._excludeVariableName(\"vignetteSettings1\");\n        state._excludeVariableName(\"vignetteSettings2\");\n        state._excludeVariableName(\"vCameraColorCurveNegative\");\n        state._excludeVariableName(\"vCameraColorCurveNeutral\");\n        state._excludeVariableName(\"vCameraColorCurvePositive\");\n        state._excludeVariableName(\"txColorTransform\");\n        state._excludeVariableName(\"colorTransformSettings\");\n    };\n    ImageProcessingBlock.prototype.isReady = function (mesh, nodeMaterial, defines) {\n        if (defines._areImageProcessingDirty && nodeMaterial.imageProcessingConfiguration) {\n            if (!nodeMaterial.imageProcessingConfiguration.isReady()) {\n                return false;\n            }\n        }\n        return true;\n    };\n    ImageProcessingBlock.prototype.prepareDefines = function (mesh, nodeMaterial, defines) {\n        if (defines._areImageProcessingDirty && nodeMaterial.imageProcessingConfiguration) {\n            nodeMaterial.imageProcessingConfiguration.prepareDefines(defines);\n        }\n    };\n    ImageProcessingBlock.prototype.bind = function (effect, nodeMaterial, mesh) {\n        if (!mesh) {\n            return;\n        }\n        if (!nodeMaterial.imageProcessingConfiguration) {\n            return;\n        }\n        nodeMaterial.imageProcessingConfiguration.bind(effect);\n    };\n    ImageProcessingBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        // Register for defines\n        state.sharedData.blocksWithDefines.push(this);\n        // Register for blocking\n        state.sharedData.blockingBlocks.push(this);\n        // Register for binding\n        state.sharedData.bindableBlocks.push(this);\n        // Uniforms\n        state.uniforms.push(\"exposureLinear\");\n        state.uniforms.push(\"contrast\");\n        state.uniforms.push(\"vInverseScreenSize\");\n        state.uniforms.push(\"vignetteSettings1\");\n        state.uniforms.push(\"vignetteSettings2\");\n        state.uniforms.push(\"vCameraColorCurveNegative\");\n        state.uniforms.push(\"vCameraColorCurveNeutral\");\n        state.uniforms.push(\"vCameraColorCurvePositive\");\n        state.uniforms.push(\"txColorTransform\");\n        state.uniforms.push(\"colorTransformSettings\");\n        // Emit code\n        var color = this.color;\n        var output = this._outputs[0];\n        var comments = \"//\".concat(this.name);\n        state._emitFunctionFromInclude(\"helperFunctions\", comments);\n        state._emitFunctionFromInclude(\"imageProcessingDeclaration\", comments);\n        state._emitFunctionFromInclude(\"imageProcessingFunctions\", comments);\n        if (color.connectedPoint.type === NodeMaterialBlockConnectionPointTypes.Color4 || color.connectedPoint.type === NodeMaterialBlockConnectionPointTypes.Vector4) {\n            state.compilationString += \"\".concat(this._declareOutput(output, state), \" = \").concat(color.associatedVariableName, \";\\r\\n\");\n        }\n        else {\n            state.compilationString += \"\".concat(this._declareOutput(output, state), \" = vec4(\").concat(color.associatedVariableName, \", 1.0);\\r\\n\");\n        }\n        state.compilationString += \"#ifdef IMAGEPROCESSINGPOSTPROCESS\\r\\n\";\n        if (this.convertInputToLinearSpace) {\n            state.compilationString += \"\".concat(output.associatedVariableName, \".rgb = toLinearSpace(\").concat(color.associatedVariableName, \".rgb);\\r\\n\");\n        }\n        state.compilationString += \"#else\\r\\n\";\n        state.compilationString += \"#ifdef IMAGEPROCESSING\\r\\n\";\n        if (this.convertInputToLinearSpace) {\n            state.compilationString += \"\".concat(output.associatedVariableName, \".rgb = toLinearSpace(\").concat(color.associatedVariableName, \".rgb);\\r\\n\");\n        }\n        state.compilationString += \"\".concat(output.associatedVariableName, \" = applyImageProcessing(\").concat(output.associatedVariableName, \");\\r\\n\");\n        state.compilationString += \"#endif\\r\\n\";\n        state.compilationString += \"#endif\\r\\n\";\n        return this;\n    };\n    ImageProcessingBlock.prototype._dumpPropertiesCode = function () {\n        var codeString = _super.prototype._dumpPropertiesCode.call(this);\n        codeString += \"\".concat(this._codeVariableName, \".convertInputToLinearSpace = \").concat(this.convertInputToLinearSpace, \";\\r\\n\");\n        return codeString;\n    };\n    ImageProcessingBlock.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        serializationObject.convertInputToLinearSpace = this.convertInputToLinearSpace;\n        return serializationObject;\n    };\n    ImageProcessingBlock.prototype._deserialize = function (serializationObject, scene, rootUrl) {\n        var _a;\n        _super.prototype._deserialize.call(this, serializationObject, scene, rootUrl);\n        this.convertInputToLinearSpace = (_a = serializationObject.convertInputToLinearSpace) !== null && _a !== void 0 ? _a : true;\n    };\n    __decorate([\n        editableInPropertyPage(\"Convert input to linear space\", PropertyTypeForEdition.Boolean, \"ADVANCED\")\n    ], ImageProcessingBlock.prototype, \"convertInputToLinearSpace\", void 0);\n    return ImageProcessingBlock;\n}(NodeMaterialBlock));\nexport { ImageProcessingBlock };\nRegisterClass(\"BABYLON.ImageProcessingBlock\", ImageProcessingBlock);\n//# sourceMappingURL=imageProcessingBlock.js.map","import { __decorate, __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { NodeMaterialConnectionPointDirection } from \"../../nodeMaterialBlockConnectionPoint.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { InputBlock } from \"../Input/inputBlock.js\";\nimport { editableInPropertyPage, PropertyTypeForEdition } from \"../../nodeMaterialDecorator.js\";\nimport { NodeMaterialConnectionPointCustomObject } from \"../../nodeMaterialConnectionPointCustomObject.js\";\nimport { TBNBlock } from \"./TBNBlock.js\";\nimport \"../../../../Shaders/ShadersInclude/bumpFragmentMainFunctions.js\";\nimport \"../../../../Shaders/ShadersInclude/bumpFragmentFunctions.js\";\nimport \"../../../../Shaders/ShadersInclude/bumpFragment.js\";\n/**\n * Block used to perturb normals based on a normal map\n */\nvar PerturbNormalBlock = /** @class */ (function (_super) {\n    __extends(PerturbNormalBlock, _super);\n    /**\n     * Create a new PerturbNormalBlock\n     * @param name defines the block name\n     */\n    function PerturbNormalBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment) || this;\n        _this._tangentSpaceParameterName = \"\";\n        /** Gets or sets a boolean indicating that normal should be inverted on X axis */\n        _this.invertX = false;\n        /** Gets or sets a boolean indicating that normal should be inverted on Y axis */\n        _this.invertY = false;\n        /** Gets or sets a boolean indicating that parallax occlusion should be enabled */\n        _this.useParallaxOcclusion = false;\n        _this._isUnique = true;\n        // Vertex\n        _this.registerInput(\"worldPosition\", NodeMaterialBlockConnectionPointTypes.Vector4, false);\n        _this.registerInput(\"worldNormal\", NodeMaterialBlockConnectionPointTypes.Vector4, false);\n        _this.registerInput(\"worldTangent\", NodeMaterialBlockConnectionPointTypes.Vector4, true);\n        _this.registerInput(\"uv\", NodeMaterialBlockConnectionPointTypes.Vector2, false);\n        _this.registerInput(\"normalMapColor\", NodeMaterialBlockConnectionPointTypes.Color3, false);\n        _this.registerInput(\"strength\", NodeMaterialBlockConnectionPointTypes.Float, false);\n        _this.registerInput(\"viewDirection\", NodeMaterialBlockConnectionPointTypes.Vector3, true);\n        _this.registerInput(\"parallaxScale\", NodeMaterialBlockConnectionPointTypes.Float, true);\n        _this.registerInput(\"parallaxHeight\", NodeMaterialBlockConnectionPointTypes.Float, true);\n        _this.registerInput(\"TBN\", NodeMaterialBlockConnectionPointTypes.Object, true, NodeMaterialBlockTargets.VertexAndFragment, new NodeMaterialConnectionPointCustomObject(\"TBN\", _this, NodeMaterialConnectionPointDirection.Input, TBNBlock, \"TBNBlock\"));\n        // Fragment\n        _this.registerOutput(\"output\", NodeMaterialBlockConnectionPointTypes.Vector4);\n        _this.registerOutput(\"uvOffset\", NodeMaterialBlockConnectionPointTypes.Vector2);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    PerturbNormalBlock.prototype.getClassName = function () {\n        return \"PerturbNormalBlock\";\n    };\n    Object.defineProperty(PerturbNormalBlock.prototype, \"worldPosition\", {\n        /**\n         * Gets the world position input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PerturbNormalBlock.prototype, \"worldNormal\", {\n        /**\n         * Gets the world normal input component\n         */\n        get: function () {\n            return this._inputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PerturbNormalBlock.prototype, \"worldTangent\", {\n        /**\n         * Gets the world tangent input component\n         */\n        get: function () {\n            return this._inputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PerturbNormalBlock.prototype, \"uv\", {\n        /**\n         * Gets the uv input component\n         */\n        get: function () {\n            return this._inputs[3];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PerturbNormalBlock.prototype, \"normalMapColor\", {\n        /**\n         * Gets the normal map color input component\n         */\n        get: function () {\n            return this._inputs[4];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PerturbNormalBlock.prototype, \"strength\", {\n        /**\n         * Gets the strength input component\n         */\n        get: function () {\n            return this._inputs[5];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PerturbNormalBlock.prototype, \"viewDirection\", {\n        /**\n         * Gets the view direction input component\n         */\n        get: function () {\n            return this._inputs[6];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PerturbNormalBlock.prototype, \"parallaxScale\", {\n        /**\n         * Gets the parallax scale input component\n         */\n        get: function () {\n            return this._inputs[7];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PerturbNormalBlock.prototype, \"parallaxHeight\", {\n        /**\n         * Gets the parallax height input component\n         */\n        get: function () {\n            return this._inputs[8];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PerturbNormalBlock.prototype, \"TBN\", {\n        /**\n         * Gets the TBN input component\n         */\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        get: function () {\n            return this._inputs[9];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PerturbNormalBlock.prototype, \"output\", {\n        /**\n         * Gets the output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(PerturbNormalBlock.prototype, \"uvOffset\", {\n        /**\n         * Gets the uv offset output component\n         */\n        get: function () {\n            return this._outputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    PerturbNormalBlock.prototype.prepareDefines = function (mesh, nodeMaterial, defines) {\n        var normalSamplerName = this.normalMapColor.connectedPoint._ownerBlock.samplerName;\n        var useParallax = this.viewDirection.isConnected && ((this.useParallaxOcclusion && normalSamplerName) || (!this.useParallaxOcclusion && this.parallaxHeight.isConnected));\n        defines.setValue(\"BUMP\", true);\n        defines.setValue(\"PARALLAX\", useParallax, true);\n        defines.setValue(\"PARALLAXOCCLUSION\", this.useParallaxOcclusion, true);\n    };\n    PerturbNormalBlock.prototype.bind = function (effect, nodeMaterial) {\n        if (nodeMaterial.getScene()._mirroredCameraPosition) {\n            effect.setFloat2(this._tangentSpaceParameterName, this.invertX ? 1.0 : -1.0, this.invertY ? 1.0 : -1.0);\n        }\n        else {\n            effect.setFloat2(this._tangentSpaceParameterName, this.invertX ? -1.0 : 1.0, this.invertY ? -1.0 : 1.0);\n        }\n    };\n    PerturbNormalBlock.prototype.autoConfigure = function (material) {\n        if (!this.uv.isConnected) {\n            var uvInput = material.getInputBlockByPredicate(function (b) { return b.isAttribute && b.name === \"uv\"; });\n            if (!uvInput) {\n                uvInput = new InputBlock(\"uv\");\n                uvInput.setAsAttribute();\n            }\n            uvInput.output.connectTo(this.uv);\n        }\n        if (!this.strength.isConnected) {\n            var strengthInput = new InputBlock(\"strength\");\n            strengthInput.value = 1.0;\n            strengthInput.output.connectTo(this.strength);\n        }\n    };\n    PerturbNormalBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        var comments = \"//\".concat(this.name);\n        var uv = this.uv;\n        var worldPosition = this.worldPosition;\n        var worldNormal = this.worldNormal;\n        var worldTangent = this.worldTangent;\n        state.sharedData.blocksWithDefines.push(this);\n        state.sharedData.bindableBlocks.push(this);\n        this._tangentSpaceParameterName = state._getFreeDefineName(\"tangentSpaceParameter\");\n        state._emitUniformFromString(this._tangentSpaceParameterName, \"vec2\");\n        var normalSamplerName = this.normalMapColor.connectedPoint._ownerBlock.samplerName;\n        var useParallax = this.viewDirection.isConnected && ((this.useParallaxOcclusion && normalSamplerName) || (!this.useParallaxOcclusion && this.parallaxHeight.isConnected));\n        var replaceForParallaxInfos = !this.parallaxScale.isConnectedToInputBlock\n            ? \"0.05\"\n            : this.parallaxScale.connectInputBlock.isConstant\n                ? state._emitFloat(this.parallaxScale.connectInputBlock.value)\n                : this.parallaxScale.associatedVariableName;\n        var replaceForBumpInfos = this.strength.isConnectedToInputBlock && this.strength.connectInputBlock.isConstant\n            ? \"\\r\\n#if !defined(NORMALXYSCALE)\\r\\n1.0/\\r\\n#endif\\r\\n\".concat(state._emitFloat(this.strength.connectInputBlock.value))\n            : \"\\r\\n#if !defined(NORMALXYSCALE)\\r\\n1.0/\\r\\n#endif\\r\\n\".concat(this.strength.associatedVariableName);\n        state._emitExtension(\"derivatives\", \"#extension GL_OES_standard_derivatives : enable\");\n        var tangentReplaceString = { search: /defined\\(TANGENT\\)/g, replace: worldTangent.isConnected ? \"defined(TANGENT)\" : \"defined(IGNORE)\" };\n        var tbnVarying = { search: /varying mat3 vTBN/g, replace: \"\" };\n        var TBN = this.TBN;\n        if (TBN.isConnected) {\n            state.compilationString += \"\\n            #ifdef TBNBLOCK\\n            mat3 vTBN = \".concat(TBN.associatedVariableName, \";\\n            #endif\\n            \");\n        }\n        else if (worldTangent.isConnected) {\n            state.compilationString += \"vec3 tbnNormal = normalize(\".concat(worldNormal.associatedVariableName, \".xyz);\\r\\n\");\n            state.compilationString += \"vec3 tbnTangent = normalize(\".concat(worldTangent.associatedVariableName, \".xyz);\\r\\n\");\n            state.compilationString += \"vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\\r\\n\";\n            state.compilationString += \"mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\\r\\n\";\n        }\n        state._emitFunctionFromInclude(\"bumpFragmentMainFunctions\", comments, {\n            replaceStrings: [tangentReplaceString, tbnVarying],\n        });\n        state._emitFunctionFromInclude(\"bumpFragmentFunctions\", comments, {\n            replaceStrings: [\n                { search: /#include<samplerFragmentDeclaration>\\(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump\\)/g, replace: \"\" },\n                { search: /uniform sampler2D bumpSampler;/g, replace: \"\" },\n                {\n                    search: /vec2 parallaxOcclusion\\(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale\\)/g,\n                    replace: \"#define inline\\r\\nvec2 parallaxOcclusion(vec3 vViewDirCoT, vec3 vNormalCoT, vec2 texCoord, float parallaxScale, sampler2D bumpSampler)\",\n                },\n                { search: /vec2 parallaxOffset\\(vec3 viewDir,float heightScale\\)/g, replace: \"vec2 parallaxOffset(vec3 viewDir, float heightScale, float height_)\" },\n                { search: /texture2D\\(bumpSampler,vBumpUV\\)\\.w/g, replace: \"height_\" },\n            ],\n        });\n        var uvForPerturbNormal = !useParallax || !normalSamplerName ? this.normalMapColor.associatedVariableName : \"texture2D(\".concat(normalSamplerName, \", \").concat(uv.associatedVariableName, \" + uvOffset).xyz\");\n        state.compilationString += this._declareOutput(this.output, state) + \" = vec4(0.);\\r\\n\";\n        state.compilationString += state._emitCodeFromInclude(\"bumpFragment\", comments, {\n            replaceStrings: [\n                { search: /perturbNormal\\(TBN,texture2D\\(bumpSampler,vBumpUV\\+uvOffset\\).xyz,vBumpInfos.y\\)/g, replace: \"perturbNormal(TBN, \".concat(uvForPerturbNormal, \", vBumpInfos.y)\") },\n                {\n                    search: /parallaxOcclusion\\(invTBN\\*-viewDirectionW,invTBN\\*normalW,vBumpUV,vBumpInfos.z\\)/g,\n                    replace: \"parallaxOcclusion((invTBN * -viewDirectionW), (invTBN * normalW), vBumpUV, vBumpInfos.z, \".concat(useParallax && this.useParallaxOcclusion ? normalSamplerName : \"bumpSampler\", \")\"),\n                },\n                {\n                    search: /parallaxOffset\\(invTBN\\*viewDirectionW,vBumpInfos\\.z\\)/g,\n                    replace: \"parallaxOffset(invTBN * viewDirectionW, vBumpInfos.z, \".concat(useParallax ? this.parallaxHeight.associatedVariableName : \"0.\", \")\"),\n                },\n                { search: /vTangentSpaceParams/g, replace: this._tangentSpaceParameterName },\n                { search: /vBumpInfos.y/g, replace: replaceForBumpInfos },\n                { search: /vBumpInfos.z/g, replace: replaceForParallaxInfos },\n                { search: /vBumpUV/g, replace: uv.associatedVariableName },\n                { search: /vPositionW/g, replace: worldPosition.associatedVariableName + \".xyz\" },\n                { search: /normalW=/g, replace: this.output.associatedVariableName + \".xyz = \" },\n                { search: /mat3\\(normalMatrix\\)\\*normalW/g, replace: \"mat3(normalMatrix) * \" + this.output.associatedVariableName + \".xyz\" },\n                { search: /normalW/g, replace: worldNormal.associatedVariableName + \".xyz\" },\n                { search: /viewDirectionW/g, replace: useParallax ? this.viewDirection.associatedVariableName : \"vec3(0.)\" },\n                tangentReplaceString,\n            ],\n        });\n        return this;\n    };\n    PerturbNormalBlock.prototype._dumpPropertiesCode = function () {\n        var codeString = _super.prototype._dumpPropertiesCode.call(this) + \"\".concat(this._codeVariableName, \".invertX = \").concat(this.invertX, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".invertY = \").concat(this.invertY, \";\\r\\n\");\n        codeString += \"\".concat(this._codeVariableName, \".useParallaxOcclusion = \").concat(this.useParallaxOcclusion, \";\\r\\n\");\n        return codeString;\n    };\n    PerturbNormalBlock.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        serializationObject.invertX = this.invertX;\n        serializationObject.invertY = this.invertY;\n        serializationObject.useParallaxOcclusion = this.useParallaxOcclusion;\n        return serializationObject;\n    };\n    PerturbNormalBlock.prototype._deserialize = function (serializationObject, scene, rootUrl) {\n        _super.prototype._deserialize.call(this, serializationObject, scene, rootUrl);\n        this.invertX = serializationObject.invertX;\n        this.invertY = serializationObject.invertY;\n        this.useParallaxOcclusion = !!serializationObject.useParallaxOcclusion;\n    };\n    __decorate([\n        editableInPropertyPage(\"Invert X axis\", PropertyTypeForEdition.Boolean, \"PROPERTIES\", { notifiers: { update: false } })\n    ], PerturbNormalBlock.prototype, \"invertX\", void 0);\n    __decorate([\n        editableInPropertyPage(\"Invert Y axis\", PropertyTypeForEdition.Boolean, \"PROPERTIES\", { notifiers: { update: false } })\n    ], PerturbNormalBlock.prototype, \"invertY\", void 0);\n    __decorate([\n        editableInPropertyPage(\"Use parallax occlusion\", PropertyTypeForEdition.Boolean)\n    ], PerturbNormalBlock.prototype, \"useParallaxOcclusion\", void 0);\n    return PerturbNormalBlock;\n}(NodeMaterialBlock));\nexport { PerturbNormalBlock };\nRegisterClass(\"BABYLON.PerturbNormalBlock\", PerturbNormalBlock);\n//# sourceMappingURL=perturbNormalBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\n/**\n * Block used to discard a pixel if a value is smaller than a cutoff\n */\nvar DiscardBlock = /** @class */ (function (_super) {\n    __extends(DiscardBlock, _super);\n    /**\n     * Create a new DiscardBlock\n     * @param name defines the block name\n     */\n    function DiscardBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment, true) || this;\n        _this.registerInput(\"value\", NodeMaterialBlockConnectionPointTypes.Float, true);\n        _this.registerInput(\"cutoff\", NodeMaterialBlockConnectionPointTypes.Float, true);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    DiscardBlock.prototype.getClassName = function () {\n        return \"DiscardBlock\";\n    };\n    Object.defineProperty(DiscardBlock.prototype, \"value\", {\n        /**\n         * Gets the color input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DiscardBlock.prototype, \"cutoff\", {\n        /**\n         * Gets the cutoff input component\n         */\n        get: function () {\n            return this._inputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    DiscardBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        state.sharedData.hints.needAlphaTesting = true;\n        if (!this.cutoff.isConnected || !this.value.isConnected) {\n            return;\n        }\n        state.compilationString += \"if (\".concat(this.value.associatedVariableName, \" < \").concat(this.cutoff.associatedVariableName, \") discard;\\r\\n\");\n        return this;\n    };\n    return DiscardBlock;\n}(NodeMaterialBlock));\nexport { DiscardBlock };\nRegisterClass(\"BABYLON.DiscardBlock\", DiscardBlock);\n//# sourceMappingURL=discardBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\n/**\n * Block used to test if the fragment shader is front facing\n */\nvar FrontFacingBlock = /** @class */ (function (_super) {\n    __extends(FrontFacingBlock, _super);\n    /**\n     * Creates a new FrontFacingBlock\n     * @param name defines the block name\n     */\n    function FrontFacingBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment) || this;\n        _this.registerOutput(\"output\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Fragment);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    FrontFacingBlock.prototype.getClassName = function () {\n        return \"FrontFacingBlock\";\n    };\n    Object.defineProperty(FrontFacingBlock.prototype, \"output\", {\n        /**\n         * Gets the output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    FrontFacingBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        if (state.target === NodeMaterialBlockTargets.Vertex) {\n            throw \"FrontFacingBlock must only be used in a fragment shader\";\n        }\n        var output = this._outputs[0];\n        state.compilationString += this._declareOutput(output, state) + \" = gl_FrontFacing ? 1.0 : 0.0;\\r\\n\";\n        return this;\n    };\n    return FrontFacingBlock;\n}(NodeMaterialBlock));\nexport { FrontFacingBlock };\nRegisterClass(\"BABYLON.FrontFacingBlock\", FrontFacingBlock);\n//# sourceMappingURL=frontFacingBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\n/**\n * Block used to get the derivative value on x and y of a given input\n */\nvar DerivativeBlock = /** @class */ (function (_super) {\n    __extends(DerivativeBlock, _super);\n    /**\n     * Create a new DerivativeBlock\n     * @param name defines the block name\n     */\n    function DerivativeBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment) || this;\n        _this.registerInput(\"input\", NodeMaterialBlockConnectionPointTypes.AutoDetect, false);\n        _this.registerOutput(\"dx\", NodeMaterialBlockConnectionPointTypes.BasedOnInput);\n        _this.registerOutput(\"dy\", NodeMaterialBlockConnectionPointTypes.BasedOnInput);\n        _this._outputs[0]._typeConnectionSource = _this._inputs[0];\n        _this._outputs[1]._typeConnectionSource = _this._inputs[0];\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    DerivativeBlock.prototype.getClassName = function () {\n        return \"DerivativeBlock\";\n    };\n    Object.defineProperty(DerivativeBlock.prototype, \"input\", {\n        /**\n         * Gets the input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DerivativeBlock.prototype, \"dx\", {\n        /**\n         * Gets the derivative output on x\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DerivativeBlock.prototype, \"dy\", {\n        /**\n         * Gets the derivative output on y\n         */\n        get: function () {\n            return this._outputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    DerivativeBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        var dx = this._outputs[0];\n        var dy = this._outputs[1];\n        state._emitExtension(\"derivatives\", \"#extension GL_OES_standard_derivatives : enable\");\n        if (dx.hasEndpoints) {\n            state.compilationString += this._declareOutput(dx, state) + \" = dFdx(\".concat(this.input.associatedVariableName, \");\\r\\n\");\n        }\n        if (dy.hasEndpoints) {\n            state.compilationString += this._declareOutput(dy, state) + \" = dFdy(\".concat(this.input.associatedVariableName, \");\\r\\n\");\n        }\n        return this;\n    };\n    return DerivativeBlock;\n}(NodeMaterialBlock));\nexport { DerivativeBlock };\nRegisterClass(\"BABYLON.DerivativeBlock\", DerivativeBlock);\n//# sourceMappingURL=derivativeBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\n/**\n * Block used to make gl_FragCoord available\n */\nvar FragCoordBlock = /** @class */ (function (_super) {\n    __extends(FragCoordBlock, _super);\n    /**\n     * Creates a new FragCoordBlock\n     * @param name defines the block name\n     */\n    function FragCoordBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment) || this;\n        _this.registerOutput(\"xy\", NodeMaterialBlockConnectionPointTypes.Vector2, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"xyz\", NodeMaterialBlockConnectionPointTypes.Vector3, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"xyzw\", NodeMaterialBlockConnectionPointTypes.Vector4, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"x\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"y\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"z\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"w\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Fragment);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    FragCoordBlock.prototype.getClassName = function () {\n        return \"FragCoordBlock\";\n    };\n    Object.defineProperty(FragCoordBlock.prototype, \"xy\", {\n        /**\n         * Gets the xy component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FragCoordBlock.prototype, \"xyz\", {\n        /**\n         * Gets the xyz component\n         */\n        get: function () {\n            return this._outputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FragCoordBlock.prototype, \"xyzw\", {\n        /**\n         * Gets the xyzw component\n         */\n        get: function () {\n            return this._outputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FragCoordBlock.prototype, \"x\", {\n        /**\n         * Gets the x component\n         */\n        get: function () {\n            return this._outputs[3];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FragCoordBlock.prototype, \"y\", {\n        /**\n         * Gets the y component\n         */\n        get: function () {\n            return this._outputs[4];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FragCoordBlock.prototype, \"z\", {\n        /**\n         * Gets the z component\n         */\n        get: function () {\n            return this._outputs[5];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(FragCoordBlock.prototype, \"output\", {\n        /**\n         * Gets the w component\n         */\n        get: function () {\n            return this._outputs[6];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    FragCoordBlock.prototype.writeOutputs = function (state) {\n        var code = \"\";\n        for (var _i = 0, _a = this._outputs; _i < _a.length; _i++) {\n            var output = _a[_i];\n            if (output.hasEndpoints) {\n                code += \"\".concat(this._declareOutput(output, state), \" = gl_FragCoord.\").concat(output.name, \";\\r\\n\");\n            }\n        }\n        return code;\n    };\n    FragCoordBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        if (state.target === NodeMaterialBlockTargets.Vertex) {\n            throw \"FragCoordBlock must only be used in a fragment shader\";\n        }\n        state.compilationString += this.writeOutputs(state);\n        return this;\n    };\n    return FragCoordBlock;\n}(NodeMaterialBlock));\nexport { FragCoordBlock };\nRegisterClass(\"BABYLON.FragCoordBlock\", FragCoordBlock);\n//# sourceMappingURL=fragCoordBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\n/**\n * Block used to get the screen sizes\n */\nvar ScreenSizeBlock = /** @class */ (function (_super) {\n    __extends(ScreenSizeBlock, _super);\n    /**\n     * Creates a new ScreenSizeBlock\n     * @param name defines the block name\n     */\n    function ScreenSizeBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment) || this;\n        _this.registerOutput(\"xy\", NodeMaterialBlockConnectionPointTypes.Vector2, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"x\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Fragment);\n        _this.registerOutput(\"y\", NodeMaterialBlockConnectionPointTypes.Float, NodeMaterialBlockTargets.Fragment);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    ScreenSizeBlock.prototype.getClassName = function () {\n        return \"ScreenSizeBlock\";\n    };\n    Object.defineProperty(ScreenSizeBlock.prototype, \"xy\", {\n        /**\n         * Gets the xy component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ScreenSizeBlock.prototype, \"x\", {\n        /**\n         * Gets the x component\n         */\n        get: function () {\n            return this._outputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ScreenSizeBlock.prototype, \"y\", {\n        /**\n         * Gets the y component\n         */\n        get: function () {\n            return this._outputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ScreenSizeBlock.prototype.bind = function (effect) {\n        var engine = this._scene.getEngine();\n        effect.setFloat2(this._varName, engine.getRenderWidth(), engine.getRenderHeight());\n    };\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    ScreenSizeBlock.prototype.writeOutputs = function (state, varName) {\n        var code = \"\";\n        for (var _i = 0, _a = this._outputs; _i < _a.length; _i++) {\n            var output = _a[_i];\n            if (output.hasEndpoints) {\n                code += \"\".concat(this._declareOutput(output, state), \" = \").concat(varName, \".\").concat(output.name, \";\\r\\n\");\n            }\n        }\n        return code;\n    };\n    ScreenSizeBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        this._scene = state.sharedData.scene;\n        if (state.target === NodeMaterialBlockTargets.Vertex) {\n            throw \"ScreenSizeBlock must only be used in a fragment shader\";\n        }\n        state.sharedData.bindableBlocks.push(this);\n        this._varName = state._getFreeVariableName(\"screenSize\");\n        state._emitUniformFromString(this._varName, \"vec2\");\n        state.compilationString += this.writeOutputs(state, this._varName);\n        return this;\n    };\n    return ScreenSizeBlock;\n}(NodeMaterialBlock));\nexport { ScreenSizeBlock };\nRegisterClass(\"BABYLON.ScreenSizeBlock\", ScreenSizeBlock);\n//# sourceMappingURL=screenSizeBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { NodeMaterialSystemValues } from \"../../Enums/nodeMaterialSystemValues.js\";\nimport { InputBlock } from \"../Input/inputBlock.js\";\n/**\n * Block used to transform a vector3 or a vector4 into screen space\n */\nvar ScreenSpaceBlock = /** @class */ (function (_super) {\n    __extends(ScreenSpaceBlock, _super);\n    /**\n     * Creates a new ScreenSpaceBlock\n     * @param name defines the block name\n     */\n    function ScreenSpaceBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment) || this;\n        _this.registerInput(\"vector\", NodeMaterialBlockConnectionPointTypes.Vector3);\n        _this.registerInput(\"worldViewProjection\", NodeMaterialBlockConnectionPointTypes.Matrix);\n        _this.registerOutput(\"output\", NodeMaterialBlockConnectionPointTypes.Vector2);\n        _this.registerOutput(\"x\", NodeMaterialBlockConnectionPointTypes.Float);\n        _this.registerOutput(\"y\", NodeMaterialBlockConnectionPointTypes.Float);\n        _this.inputs[0].acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Vector4);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    ScreenSpaceBlock.prototype.getClassName = function () {\n        return \"ScreenSpaceBlock\";\n    };\n    Object.defineProperty(ScreenSpaceBlock.prototype, \"vector\", {\n        /**\n         * Gets the vector input\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ScreenSpaceBlock.prototype, \"worldViewProjection\", {\n        /**\n         * Gets the worldViewProjection transform input\n         */\n        get: function () {\n            return this._inputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ScreenSpaceBlock.prototype, \"output\", {\n        /**\n         * Gets the output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ScreenSpaceBlock.prototype, \"x\", {\n        /**\n         * Gets the x output component\n         */\n        get: function () {\n            return this._outputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ScreenSpaceBlock.prototype, \"y\", {\n        /**\n         * Gets the y output component\n         */\n        get: function () {\n            return this._outputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ScreenSpaceBlock.prototype.autoConfigure = function (material) {\n        if (!this.worldViewProjection.isConnected) {\n            var worldViewProjectionInput = material.getInputBlockByPredicate(function (b) { return b.systemValue === NodeMaterialSystemValues.WorldViewProjection; });\n            if (!worldViewProjectionInput) {\n                worldViewProjectionInput = new InputBlock(\"worldViewProjection\");\n                worldViewProjectionInput.setAsSystemValue(NodeMaterialSystemValues.WorldViewProjection);\n            }\n            worldViewProjectionInput.output.connectTo(this.worldViewProjection);\n        }\n    };\n    ScreenSpaceBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        var vector = this.vector;\n        var worldViewProjection = this.worldViewProjection;\n        if (!vector.connectedPoint) {\n            return;\n        }\n        var worldViewProjectionName = worldViewProjection.associatedVariableName;\n        var tempVariableName = state._getFreeVariableName(\"screenSpaceTemp\");\n        switch (vector.connectedPoint.type) {\n            case NodeMaterialBlockConnectionPointTypes.Vector3:\n                state.compilationString += \"vec4 \".concat(tempVariableName, \" = \").concat(worldViewProjectionName, \" * vec4(\").concat(vector.associatedVariableName, \", 1.0);\\r\\n\");\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Vector4:\n                state.compilationString += \"vec4 \".concat(tempVariableName, \" = \").concat(worldViewProjectionName, \" * \").concat(vector.associatedVariableName, \";\\r\\n\");\n                break;\n        }\n        state.compilationString += \"\".concat(tempVariableName, \".xy /= \").concat(tempVariableName, \".w;\");\n        state.compilationString += \"\".concat(tempVariableName, \".xy = \").concat(tempVariableName, \".xy * 0.5 + vec2(0.5, 0.5);\");\n        if (this.output.hasEndpoints) {\n            state.compilationString += this._declareOutput(this.output, state) + \" = \".concat(tempVariableName, \".xy;\\r\\n\");\n        }\n        if (this.x.hasEndpoints) {\n            state.compilationString += this._declareOutput(this.x, state) + \" = \".concat(tempVariableName, \".x;\\r\\n\");\n        }\n        if (this.y.hasEndpoints) {\n            state.compilationString += this._declareOutput(this.y, state) + \" = \".concat(tempVariableName, \".y;\\r\\n\");\n        }\n        return this;\n    };\n    return ScreenSpaceBlock;\n}(NodeMaterialBlock));\nexport { ScreenSpaceBlock };\nRegisterClass(\"BABYLON.ScreenSpaceBlock\", ScreenSpaceBlock);\n//# sourceMappingURL=screenSpaceBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { InputBlock } from \"../Input/inputBlock.js\";\nimport { Vector2 } from \"../../../../Maths/math.vector.js\";\n/**\n * Block used to generate a twirl\n */\nvar TwirlBlock = /** @class */ (function (_super) {\n    __extends(TwirlBlock, _super);\n    /**\n     * Creates a new TwirlBlock\n     * @param name defines the block name\n     */\n    function TwirlBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment) || this;\n        _this.registerInput(\"input\", NodeMaterialBlockConnectionPointTypes.Vector2);\n        _this.registerInput(\"strength\", NodeMaterialBlockConnectionPointTypes.Float);\n        _this.registerInput(\"center\", NodeMaterialBlockConnectionPointTypes.Vector2);\n        _this.registerInput(\"offset\", NodeMaterialBlockConnectionPointTypes.Vector2);\n        _this.registerOutput(\"output\", NodeMaterialBlockConnectionPointTypes.Vector2);\n        _this.registerOutput(\"x\", NodeMaterialBlockConnectionPointTypes.Float);\n        _this.registerOutput(\"y\", NodeMaterialBlockConnectionPointTypes.Float);\n        return _this;\n    }\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    TwirlBlock.prototype.getClassName = function () {\n        return \"TwirlBlock\";\n    };\n    Object.defineProperty(TwirlBlock.prototype, \"input\", {\n        /**\n         * Gets the input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TwirlBlock.prototype, \"strength\", {\n        /**\n         * Gets the strength component\n         */\n        get: function () {\n            return this._inputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TwirlBlock.prototype, \"center\", {\n        /**\n         * Gets the center component\n         */\n        get: function () {\n            return this._inputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TwirlBlock.prototype, \"offset\", {\n        /**\n         * Gets the offset component\n         */\n        get: function () {\n            return this._inputs[3];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TwirlBlock.prototype, \"output\", {\n        /**\n         * Gets the output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TwirlBlock.prototype, \"x\", {\n        /**\n         * Gets the x output component\n         */\n        get: function () {\n            return this._outputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(TwirlBlock.prototype, \"y\", {\n        /**\n         * Gets the y output component\n         */\n        get: function () {\n            return this._outputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    TwirlBlock.prototype.autoConfigure = function () {\n        if (!this.center.isConnected) {\n            var centerInput = new InputBlock(\"center\");\n            centerInput.value = new Vector2(0.5, 0.5);\n            centerInput.output.connectTo(this.center);\n        }\n        if (!this.strength.isConnected) {\n            var strengthInput = new InputBlock(\"strength\");\n            strengthInput.value = 1.0;\n            strengthInput.output.connectTo(this.strength);\n        }\n        if (!this.offset.isConnected) {\n            var offsetInput = new InputBlock(\"offset\");\n            offsetInput.value = new Vector2(0, 0);\n            offsetInput.output.connectTo(this.offset);\n        }\n    };\n    TwirlBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        var tempDelta = state._getFreeVariableName(\"delta\");\n        var tempAngle = state._getFreeVariableName(\"angle\");\n        var tempX = state._getFreeVariableName(\"x\");\n        var tempY = state._getFreeVariableName(\"y\");\n        var tempResult = state._getFreeVariableName(\"result\");\n        state.compilationString += \"\\n            vec2 \".concat(tempDelta, \" = \").concat(this.input.associatedVariableName, \" - \").concat(this.center.associatedVariableName, \";\\n            float \").concat(tempAngle, \" = \").concat(this.strength.associatedVariableName, \" * length(\").concat(tempDelta, \");\\n            float \").concat(tempX, \" = cos(\").concat(tempAngle, \") * \").concat(tempDelta, \".x - sin(\").concat(tempAngle, \") * \").concat(tempDelta, \".y;\\n            float \").concat(tempY, \" = sin(\").concat(tempAngle, \") * \").concat(tempDelta, \".x + cos(\").concat(tempAngle, \") * \").concat(tempDelta, \".y;\\n            vec2 \").concat(tempResult, \" = vec2(\").concat(tempX, \" + \").concat(this.center.associatedVariableName, \".x + \").concat(this.offset.associatedVariableName, \".x, \").concat(tempY, \" + \").concat(this.center.associatedVariableName, \".y + \").concat(this.offset.associatedVariableName, \".y);\\n        \");\n        if (this.output.hasEndpoints) {\n            state.compilationString += this._declareOutput(this.output, state) + \" = \".concat(tempResult, \";\\r\\n\");\n        }\n        if (this.x.hasEndpoints) {\n            state.compilationString += this._declareOutput(this.x, state) + \" = \".concat(tempResult, \".x;\\r\\n\");\n        }\n        if (this.y.hasEndpoints) {\n            state.compilationString += this._declareOutput(this.y, state) + \" = \".concat(tempResult, \".y;\\r\\n\");\n        }\n        return this;\n    };\n    return TwirlBlock;\n}(NodeMaterialBlock));\nexport { TwirlBlock };\nRegisterClass(\"BABYLON.TwirlBlock\", TwirlBlock);\n//# sourceMappingURL=twirlBlock.js.map","/**\n * Enum defining the type of animations supported by InputBlock\n */\nexport var AnimatedInputBlockTypes;\n(function (AnimatedInputBlockTypes) {\n    /** No animation */\n    AnimatedInputBlockTypes[AnimatedInputBlockTypes[\"None\"] = 0] = \"None\";\n    /** Time based animation. Will only work for floats */\n    AnimatedInputBlockTypes[AnimatedInputBlockTypes[\"Time\"] = 1] = \"Time\";\n})(AnimatedInputBlockTypes || (AnimatedInputBlockTypes = {}));\n//# sourceMappingURL=animatedInputBlockTypes.js.map","import { __extends } from \"tslib\";\n/* eslint-disable @typescript-eslint/naming-convention */\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialBlockConnectionPointMode } from \"../../Enums/nodeMaterialBlockConnectionPointMode.js\";\nimport { NodeMaterialSystemValues } from \"../../Enums/nodeMaterialSystemValues.js\";\nimport { Matrix, Vector2, Vector3, Vector4 } from \"../../../../Maths/math.vector.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { GetClass, RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { Color3, Color4, TmpColors } from \"../../../../Maths/math.js\";\nimport { AnimatedInputBlockTypes } from \"./animatedInputBlockTypes.js\";\nimport { Observable } from \"../../../../Misc/observable.js\";\nvar remapAttributeName = {\n    position2d: \"position\",\n    particle_uv: \"vUV\",\n    particle_color: \"vColor\",\n    particle_texturemask: \"textureMask\",\n    particle_positionw: \"vPositionW\",\n};\nvar attributeInFragmentOnly = {\n    particle_uv: true,\n    particle_color: true,\n    particle_texturemask: true,\n    particle_positionw: true,\n};\nvar attributeAsUniform = {\n    particle_texturemask: true,\n};\n/**\n * Block used to expose an input value\n */\nvar InputBlock = /** @class */ (function (_super) {\n    __extends(InputBlock, _super);\n    /**\n     * Creates a new InputBlock\n     * @param name defines the block name\n     * @param target defines the target of that block (Vertex by default)\n     * @param type defines the type of the input (can be set to NodeMaterialBlockConnectionPointTypes.AutoDetect)\n     */\n    function InputBlock(name, target, type) {\n        if (target === void 0) { target = NodeMaterialBlockTargets.Vertex; }\n        if (type === void 0) { type = NodeMaterialBlockConnectionPointTypes.AutoDetect; }\n        var _this = _super.call(this, name, target, false, true) || this;\n        _this._mode = NodeMaterialBlockConnectionPointMode.Undefined;\n        _this._animationType = AnimatedInputBlockTypes.None;\n        /** Gets or set a value used to limit the range of float values */\n        _this.min = 0;\n        /** Gets or set a value used to limit the range of float values */\n        _this.max = 0;\n        /** Gets or set a value indicating that this input can only get 0 and 1 values */\n        _this.isBoolean = false;\n        /** Gets or sets a value used by the Node Material editor to determine how to configure the current value if it is a matrix */\n        _this.matrixMode = 0;\n        /** @hidden */\n        _this._systemValue = null;\n        /** Gets or sets a boolean indicating that the value of this input will not change after a build */\n        _this.isConstant = false;\n        /** Gets or sets the group to use to display this block in the Inspector */\n        _this.groupInInspector = \"\";\n        /** Gets an observable raised when the value is changed */\n        _this.onValueChangedObservable = new Observable();\n        /** Gets or sets a boolean indicating if content needs to be converted to gamma space (for color3/4 only) */\n        _this.convertToGammaSpace = false;\n        /** Gets or sets a boolean indicating if content needs to be converted to linear space (for color3/4 only) */\n        _this.convertToLinearSpace = false;\n        _this._type = type;\n        _this.setDefaultValue();\n        _this.registerOutput(\"output\", type);\n        return _this;\n    }\n    Object.defineProperty(InputBlock.prototype, \"type\", {\n        /**\n         * Gets or sets the connection point type (default is float)\n         */\n        get: function () {\n            if (this._type === NodeMaterialBlockConnectionPointTypes.AutoDetect) {\n                if (this.isUniform && this.value != null) {\n                    if (!isNaN(this.value)) {\n                        this._type = NodeMaterialBlockConnectionPointTypes.Float;\n                        return this._type;\n                    }\n                    switch (this.value.getClassName()) {\n                        case \"Vector2\":\n                            this._type = NodeMaterialBlockConnectionPointTypes.Vector2;\n                            return this._type;\n                        case \"Vector3\":\n                            this._type = NodeMaterialBlockConnectionPointTypes.Vector3;\n                            return this._type;\n                        case \"Vector4\":\n                            this._type = NodeMaterialBlockConnectionPointTypes.Vector4;\n                            return this._type;\n                        case \"Color3\":\n                            this._type = NodeMaterialBlockConnectionPointTypes.Color3;\n                            return this._type;\n                        case \"Color4\":\n                            this._type = NodeMaterialBlockConnectionPointTypes.Color4;\n                            return this._type;\n                        case \"Matrix\":\n                            this._type = NodeMaterialBlockConnectionPointTypes.Matrix;\n                            return this._type;\n                    }\n                }\n                if (this.isAttribute) {\n                    switch (this.name) {\n                        case \"position\":\n                        case \"normal\":\n                        case \"particle_positionw\":\n                            this._type = NodeMaterialBlockConnectionPointTypes.Vector3;\n                            return this._type;\n                        case \"uv\":\n                        case \"uv2\":\n                        case \"uv3\":\n                        case \"uv4\":\n                        case \"uv5\":\n                        case \"uv6\":\n                        case \"position2d\":\n                        case \"particle_uv\":\n                            this._type = NodeMaterialBlockConnectionPointTypes.Vector2;\n                            return this._type;\n                        case \"matricesIndices\":\n                        case \"matricesWeights\":\n                        case \"world0\":\n                        case \"world1\":\n                        case \"world2\":\n                        case \"world3\":\n                        case \"tangent\":\n                            this._type = NodeMaterialBlockConnectionPointTypes.Vector4;\n                            return this._type;\n                        case \"color\":\n                        case \"instanceColor\":\n                        case \"particle_color\":\n                        case \"particle_texturemask\":\n                            this._type = NodeMaterialBlockConnectionPointTypes.Color4;\n                            return this._type;\n                    }\n                }\n                if (this.isSystemValue) {\n                    switch (this._systemValue) {\n                        case NodeMaterialSystemValues.World:\n                        case NodeMaterialSystemValues.WorldView:\n                        case NodeMaterialSystemValues.WorldViewProjection:\n                        case NodeMaterialSystemValues.View:\n                        case NodeMaterialSystemValues.ViewProjection:\n                        case NodeMaterialSystemValues.Projection:\n                            this._type = NodeMaterialBlockConnectionPointTypes.Matrix;\n                            return this._type;\n                        case NodeMaterialSystemValues.CameraPosition:\n                            this._type = NodeMaterialBlockConnectionPointTypes.Vector3;\n                            return this._type;\n                        case NodeMaterialSystemValues.FogColor:\n                            this._type = NodeMaterialBlockConnectionPointTypes.Color3;\n                            return this._type;\n                        case NodeMaterialSystemValues.DeltaTime:\n                        case NodeMaterialSystemValues.MaterialAlpha:\n                            this._type = NodeMaterialBlockConnectionPointTypes.Float;\n                            return this._type;\n                        case NodeMaterialSystemValues.CameraParameters:\n                            this._type = NodeMaterialBlockConnectionPointTypes.Vector4;\n                            return this._type;\n                    }\n                }\n            }\n            return this._type;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Validates if a name is a reserve word.\n     * @param newName the new name to be given to the node.\n     * @returns false if the name is a reserve word, else true.\n     */\n    InputBlock.prototype.validateBlockName = function (newName) {\n        if (!this.isAttribute) {\n            return _super.prototype.validateBlockName.call(this, newName);\n        }\n        return true;\n    };\n    Object.defineProperty(InputBlock.prototype, \"output\", {\n        /**\n         * Gets the output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Set the source of this connection point to a vertex attribute\n     * @param attributeName defines the attribute name (position, uv, normal, etc...). If not specified it will take the connection point name\n     * @returns the current connection point\n     */\n    InputBlock.prototype.setAsAttribute = function (attributeName) {\n        this._mode = NodeMaterialBlockConnectionPointMode.Attribute;\n        if (attributeName) {\n            this.name = attributeName;\n        }\n        return this;\n    };\n    /**\n     * Set the source of this connection point to a system value\n     * @param value define the system value to use (world, view, etc...) or null to switch to manual value\n     * @returns the current connection point\n     */\n    InputBlock.prototype.setAsSystemValue = function (value) {\n        this.systemValue = value;\n        return this;\n    };\n    Object.defineProperty(InputBlock.prototype, \"value\", {\n        /**\n         * Gets or sets the value of that point.\n         * Please note that this value will be ignored if valueCallback is defined\n         */\n        get: function () {\n            return this._storedValue;\n        },\n        set: function (value) {\n            if (this.type === NodeMaterialBlockConnectionPointTypes.Float) {\n                if (this.isBoolean) {\n                    value = value ? 1 : 0;\n                }\n                else if (this.min !== this.max) {\n                    value = Math.max(this.min, value);\n                    value = Math.min(this.max, value);\n                }\n            }\n            this._storedValue = value;\n            this._mode = NodeMaterialBlockConnectionPointMode.Uniform;\n            this.onValueChangedObservable.notifyObservers(this);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(InputBlock.prototype, \"valueCallback\", {\n        /**\n         * Gets or sets a callback used to get the value of that point.\n         * Please note that setting this value will force the connection point to ignore the value property\n         */\n        get: function () {\n            return this._valueCallback;\n        },\n        set: function (value) {\n            this._valueCallback = value;\n            this._mode = NodeMaterialBlockConnectionPointMode.Uniform;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(InputBlock.prototype, \"associatedVariableName\", {\n        /**\n         * Gets or sets the associated variable name in the shader\n         */\n        get: function () {\n            return this._associatedVariableName;\n        },\n        set: function (value) {\n            this._associatedVariableName = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(InputBlock.prototype, \"animationType\", {\n        /** Gets or sets the type of animation applied to the input */\n        get: function () {\n            return this._animationType;\n        },\n        set: function (value) {\n            this._animationType = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(InputBlock.prototype, \"isUndefined\", {\n        /**\n         * Gets a boolean indicating that this connection point not defined yet\n         */\n        get: function () {\n            return this._mode === NodeMaterialBlockConnectionPointMode.Undefined;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(InputBlock.prototype, \"isUniform\", {\n        /**\n         * Gets or sets a boolean indicating that this connection point is coming from an uniform.\n         * In this case the connection point name must be the name of the uniform to use.\n         * Can only be set on inputs\n         */\n        get: function () {\n            return this._mode === NodeMaterialBlockConnectionPointMode.Uniform;\n        },\n        set: function (value) {\n            this._mode = value ? NodeMaterialBlockConnectionPointMode.Uniform : NodeMaterialBlockConnectionPointMode.Undefined;\n            this.associatedVariableName = \"\";\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(InputBlock.prototype, \"isAttribute\", {\n        /**\n         * Gets or sets a boolean indicating that this connection point is coming from an attribute.\n         * In this case the connection point name must be the name of the attribute to use\n         * Can only be set on inputs\n         */\n        get: function () {\n            return this._mode === NodeMaterialBlockConnectionPointMode.Attribute;\n        },\n        set: function (value) {\n            this._mode = value ? NodeMaterialBlockConnectionPointMode.Attribute : NodeMaterialBlockConnectionPointMode.Undefined;\n            this.associatedVariableName = \"\";\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(InputBlock.prototype, \"isVarying\", {\n        /**\n         * Gets or sets a boolean indicating that this connection point is generating a varying variable.\n         * Can only be set on exit points\n         */\n        get: function () {\n            return this._mode === NodeMaterialBlockConnectionPointMode.Varying;\n        },\n        set: function (value) {\n            this._mode = value ? NodeMaterialBlockConnectionPointMode.Varying : NodeMaterialBlockConnectionPointMode.Undefined;\n            this.associatedVariableName = \"\";\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(InputBlock.prototype, \"isSystemValue\", {\n        /**\n         * Gets a boolean indicating that the current connection point is a system value\n         */\n        get: function () {\n            return this._systemValue != null;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(InputBlock.prototype, \"systemValue\", {\n        /**\n         * Gets or sets the current well known value or null if not defined as a system value\n         */\n        get: function () {\n            return this._systemValue;\n        },\n        set: function (value) {\n            this._mode = NodeMaterialBlockConnectionPointMode.Uniform;\n            this.associatedVariableName = \"\";\n            this._systemValue = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    InputBlock.prototype.getClassName = function () {\n        return \"InputBlock\";\n    };\n    /**\n     * Animate the input if animationType !== None\n     * @param scene defines the rendering scene\n     */\n    InputBlock.prototype.animate = function (scene) {\n        switch (this._animationType) {\n            case AnimatedInputBlockTypes.Time: {\n                if (this.type === NodeMaterialBlockConnectionPointTypes.Float) {\n                    this.value += scene.getAnimationRatio() * 0.01;\n                }\n                break;\n            }\n        }\n    };\n    InputBlock.prototype._emitDefine = function (define) {\n        if (define[0] === \"!\") {\n            return \"#ifndef \".concat(define.substring(1), \"\\r\\n\");\n        }\n        return \"#ifdef \".concat(define, \"\\r\\n\");\n    };\n    InputBlock.prototype.initialize = function () {\n        this.associatedVariableName = \"\";\n    };\n    /**\n     * Set the input block to its default value (based on its type)\n     */\n    InputBlock.prototype.setDefaultValue = function () {\n        switch (this.type) {\n            case NodeMaterialBlockConnectionPointTypes.Float:\n                this.value = 0;\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Vector2:\n                this.value = Vector2.Zero();\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Vector3:\n                this.value = Vector3.Zero();\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Vector4:\n                this.value = Vector4.Zero();\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Color3:\n                this.value = Color3.White();\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Color4:\n                this.value = new Color4(1, 1, 1, 1);\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Matrix:\n                this.value = Matrix.Identity();\n                break;\n        }\n    };\n    InputBlock.prototype._emitConstant = function (state) {\n        switch (this.type) {\n            case NodeMaterialBlockConnectionPointTypes.Float:\n                return \"\".concat(state._emitFloat(this.value));\n            case NodeMaterialBlockConnectionPointTypes.Vector2:\n                return \"vec2(\".concat(this.value.x, \", \").concat(this.value.y, \")\");\n            case NodeMaterialBlockConnectionPointTypes.Vector3:\n                return \"vec3(\".concat(this.value.x, \", \").concat(this.value.y, \", \").concat(this.value.z, \")\");\n            case NodeMaterialBlockConnectionPointTypes.Vector4:\n                return \"vec4(\".concat(this.value.x, \", \").concat(this.value.y, \", \").concat(this.value.z, \", \").concat(this.value.w, \")\");\n            case NodeMaterialBlockConnectionPointTypes.Color3:\n                TmpColors.Color3[0].set(this.value.r, this.value.g, this.value.b);\n                if (this.convertToGammaSpace) {\n                    TmpColors.Color3[0].toGammaSpaceToRef(TmpColors.Color3[0]);\n                }\n                if (this.convertToLinearSpace) {\n                    TmpColors.Color3[0].toLinearSpaceToRef(TmpColors.Color3[0]);\n                }\n                return \"vec3(\".concat(TmpColors.Color3[0].r, \", \").concat(TmpColors.Color3[0].g, \", \").concat(TmpColors.Color3[0].b, \")\");\n            case NodeMaterialBlockConnectionPointTypes.Color4:\n                TmpColors.Color4[0].set(this.value.r, this.value.g, this.value.b, this.value.a);\n                if (this.convertToGammaSpace) {\n                    TmpColors.Color4[0].toGammaSpaceToRef(TmpColors.Color4[0]);\n                }\n                if (this.convertToLinearSpace) {\n                    TmpColors.Color4[0].toLinearSpaceToRef(TmpColors.Color4[0]);\n                }\n                return \"vec4(\".concat(TmpColors.Color4[0].r, \", \").concat(TmpColors.Color4[0].g, \", \").concat(TmpColors.Color4[0].b, \", \").concat(TmpColors.Color4[0].a, \")\");\n        }\n        return \"\";\n    };\n    Object.defineProperty(InputBlock.prototype, \"_noContextSwitch\", {\n        /** @hidden */\n        get: function () {\n            return attributeInFragmentOnly[this.name];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    InputBlock.prototype._emit = function (state, define) {\n        var _a;\n        // Uniforms\n        if (this.isUniform) {\n            if (!this.associatedVariableName) {\n                this.associatedVariableName = state._getFreeVariableName(\"u_\" + this.name);\n            }\n            if (this.isConstant) {\n                if (state.constants.indexOf(this.associatedVariableName) !== -1) {\n                    return;\n                }\n                state.constants.push(this.associatedVariableName);\n                state._constantDeclaration += this._declareOutput(this.output, state) + \" = \".concat(this._emitConstant(state), \";\\r\\n\");\n                return;\n            }\n            if (state.uniforms.indexOf(this.associatedVariableName) !== -1) {\n                return;\n            }\n            state.uniforms.push(this.associatedVariableName);\n            if (define) {\n                state._uniformDeclaration += this._emitDefine(define);\n            }\n            state._uniformDeclaration += \"uniform \".concat(state._getGLType(this.type), \" \").concat(this.associatedVariableName, \";\\r\\n\");\n            if (define) {\n                state._uniformDeclaration += \"#endif\\r\\n\";\n            }\n            // well known\n            var hints = state.sharedData.hints;\n            if (this._systemValue !== null && this._systemValue !== undefined) {\n                switch (this._systemValue) {\n                    case NodeMaterialSystemValues.WorldView:\n                        hints.needWorldViewMatrix = true;\n                        break;\n                    case NodeMaterialSystemValues.WorldViewProjection:\n                        hints.needWorldViewProjectionMatrix = true;\n                        break;\n                }\n            }\n            else {\n                if (this._animationType !== AnimatedInputBlockTypes.None) {\n                    state.sharedData.animatedInputs.push(this);\n                }\n            }\n            return;\n        }\n        // Attribute\n        if (this.isAttribute) {\n            this.associatedVariableName = (_a = remapAttributeName[this.name]) !== null && _a !== void 0 ? _a : this.name;\n            if (this.target === NodeMaterialBlockTargets.Vertex && state._vertexState) {\n                // Attribute for fragment need to be carried over by varyings\n                if (attributeInFragmentOnly[this.name]) {\n                    if (attributeAsUniform[this.name]) {\n                        state._emitUniformFromString(this.associatedVariableName, state._getGLType(this.type), define);\n                    }\n                    else {\n                        state._emitVaryingFromString(this.associatedVariableName, state._getGLType(this.type), define);\n                    }\n                }\n                else {\n                    this._emit(state._vertexState, define);\n                }\n                return;\n            }\n            if (state.attributes.indexOf(this.associatedVariableName) !== -1) {\n                return;\n            }\n            state.attributes.push(this.associatedVariableName);\n            if (attributeInFragmentOnly[this.name]) {\n                if (attributeAsUniform[this.name]) {\n                    state._emitUniformFromString(this.associatedVariableName, state._getGLType(this.type), define);\n                }\n                else {\n                    state._emitVaryingFromString(this.associatedVariableName, state._getGLType(this.type), define);\n                }\n            }\n            else {\n                if (define) {\n                    state._attributeDeclaration += this._emitDefine(define);\n                }\n                state._attributeDeclaration += \"attribute \".concat(state._getGLType(this.type), \" \").concat(this.associatedVariableName, \";\\r\\n\");\n                if (define) {\n                    state._attributeDeclaration += \"#endif\\r\\n\";\n                }\n            }\n        }\n    };\n    /**\n     * @param effect\n     * @param world\n     * @param worldView\n     * @param worldViewProjection\n     * @hidden\n     */\n    InputBlock.prototype._transmitWorld = function (effect, world, worldView, worldViewProjection) {\n        if (!this._systemValue) {\n            return;\n        }\n        var variableName = this.associatedVariableName;\n        switch (this._systemValue) {\n            case NodeMaterialSystemValues.World:\n                effect.setMatrix(variableName, world);\n                break;\n            case NodeMaterialSystemValues.WorldView:\n                effect.setMatrix(variableName, worldView);\n                break;\n            case NodeMaterialSystemValues.WorldViewProjection:\n                effect.setMatrix(variableName, worldViewProjection);\n                break;\n        }\n    };\n    /**\n     * @param effect\n     * @param scene\n     * @param material\n     * @hidden\n     */\n    InputBlock.prototype._transmit = function (effect, scene, material) {\n        if (this.isAttribute) {\n            return;\n        }\n        var variableName = this.associatedVariableName;\n        if (this._systemValue) {\n            switch (this._systemValue) {\n                case NodeMaterialSystemValues.World:\n                case NodeMaterialSystemValues.WorldView:\n                case NodeMaterialSystemValues.WorldViewProjection:\n                    return;\n                case NodeMaterialSystemValues.View:\n                    effect.setMatrix(variableName, scene.getViewMatrix());\n                    break;\n                case NodeMaterialSystemValues.Projection:\n                    effect.setMatrix(variableName, scene.getProjectionMatrix());\n                    break;\n                case NodeMaterialSystemValues.ViewProjection:\n                    effect.setMatrix(variableName, scene.getTransformMatrix());\n                    break;\n                case NodeMaterialSystemValues.CameraPosition:\n                    scene.bindEyePosition(effect, variableName, true);\n                    break;\n                case NodeMaterialSystemValues.FogColor:\n                    effect.setColor3(variableName, scene.fogColor);\n                    break;\n                case NodeMaterialSystemValues.DeltaTime:\n                    effect.setFloat(variableName, scene.deltaTime / 1000.0);\n                    break;\n                case NodeMaterialSystemValues.CameraParameters:\n                    if (scene.activeCamera) {\n                        effect.setFloat4(variableName, scene.getEngine().hasOriginBottomLeft ? -1 : 1, scene.activeCamera.minZ, scene.activeCamera.maxZ, 1 / scene.activeCamera.maxZ);\n                    }\n                    break;\n                case NodeMaterialSystemValues.MaterialAlpha:\n                    effect.setFloat(variableName, material.alpha);\n                    break;\n            }\n            return;\n        }\n        var value = this._valueCallback ? this._valueCallback() : this._storedValue;\n        if (value === null) {\n            return;\n        }\n        switch (this.type) {\n            case NodeMaterialBlockConnectionPointTypes.Float:\n                effect.setFloat(variableName, value);\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Int:\n                effect.setInt(variableName, value);\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Color3:\n                TmpColors.Color3[0].set(this.value.r, this.value.g, this.value.b);\n                if (this.convertToGammaSpace) {\n                    TmpColors.Color3[0].toGammaSpaceToRef(TmpColors.Color3[0]);\n                }\n                if (this.convertToLinearSpace) {\n                    TmpColors.Color3[0].toLinearSpaceToRef(TmpColors.Color3[0]);\n                }\n                effect.setColor3(variableName, TmpColors.Color3[0]);\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Color4:\n                TmpColors.Color4[0].set(this.value.r, this.value.g, this.value.b, this.value.a);\n                if (this.convertToGammaSpace) {\n                    TmpColors.Color4[0].toGammaSpaceToRef(TmpColors.Color4[0]);\n                }\n                if (this.convertToLinearSpace) {\n                    TmpColors.Color4[0].toLinearSpaceToRef(TmpColors.Color4[0]);\n                }\n                effect.setDirectColor4(variableName, TmpColors.Color4[0]);\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Vector2:\n                effect.setVector2(variableName, value);\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Vector3:\n                effect.setVector3(variableName, value);\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Vector4:\n                effect.setVector4(variableName, value);\n                break;\n            case NodeMaterialBlockConnectionPointTypes.Matrix:\n                effect.setMatrix(variableName, value);\n                break;\n        }\n    };\n    InputBlock.prototype._buildBlock = function (state) {\n        _super.prototype._buildBlock.call(this, state);\n        if (this.isUniform || this.isSystemValue) {\n            state.sharedData.inputBlocks.push(this);\n        }\n        this._emit(state);\n    };\n    InputBlock.prototype._dumpPropertiesCode = function () {\n        var variableName = this._codeVariableName;\n        if (this.isAttribute) {\n            return _super.prototype._dumpPropertiesCode.call(this) + \"\".concat(variableName, \".setAsAttribute(\\\"\").concat(this.name, \"\\\");\\r\\n\");\n        }\n        if (this.isSystemValue) {\n            return _super.prototype._dumpPropertiesCode.call(this) + \"\".concat(variableName, \".setAsSystemValue(BABYLON.NodeMaterialSystemValues.\").concat(NodeMaterialSystemValues[this._systemValue], \");\\r\\n\");\n        }\n        if (this.isUniform) {\n            var codes = [];\n            var valueString = \"\";\n            switch (this.type) {\n                case NodeMaterialBlockConnectionPointTypes.Float:\n                    valueString = \"\".concat(this.value);\n                    break;\n                case NodeMaterialBlockConnectionPointTypes.Vector2:\n                    valueString = \"new BABYLON.Vector2(\".concat(this.value.x, \", \").concat(this.value.y, \")\");\n                    break;\n                case NodeMaterialBlockConnectionPointTypes.Vector3:\n                    valueString = \"new BABYLON.Vector3(\".concat(this.value.x, \", \").concat(this.value.y, \", \").concat(this.value.z, \")\");\n                    break;\n                case NodeMaterialBlockConnectionPointTypes.Vector4:\n                    valueString = \"new BABYLON.Vector4(\".concat(this.value.x, \", \").concat(this.value.y, \", \").concat(this.value.z, \", \").concat(this.value.w, \")\");\n                    break;\n                case NodeMaterialBlockConnectionPointTypes.Color3:\n                    valueString = \"new BABYLON.Color3(\".concat(this.value.r, \", \").concat(this.value.g, \", \").concat(this.value.b, \")\");\n                    if (this.convertToGammaSpace) {\n                        valueString += \".toGammaSpace()\";\n                    }\n                    if (this.convertToLinearSpace) {\n                        valueString += \".toLinearSpace()\";\n                    }\n                    break;\n                case NodeMaterialBlockConnectionPointTypes.Color4:\n                    valueString = \"new BABYLON.Color4(\".concat(this.value.r, \", \").concat(this.value.g, \", \").concat(this.value.b, \", \").concat(this.value.a, \")\");\n                    if (this.convertToGammaSpace) {\n                        valueString += \".toGammaSpace()\";\n                    }\n                    if (this.convertToLinearSpace) {\n                        valueString += \".toLinearSpace()\";\n                    }\n                    break;\n                case NodeMaterialBlockConnectionPointTypes.Matrix:\n                    valueString = \"BABYLON.Matrix.FromArray([\".concat(this.value.m, \"])\");\n                    break;\n            }\n            // Common Property \"Value\"\n            codes.push(\"\".concat(variableName, \".value = \").concat(valueString));\n            // Float-Value-Specific Properties\n            if (this.type === NodeMaterialBlockConnectionPointTypes.Float) {\n                codes.push(\"\".concat(variableName, \".min = \").concat(this.min), \"\".concat(variableName, \".max = \").concat(this.max), \"\".concat(variableName, \".isBoolean = \").concat(this.isBoolean), \"\".concat(variableName, \".matrixMode = \").concat(this.matrixMode), \"\".concat(variableName, \".animationType = BABYLON.AnimatedInputBlockTypes.\").concat(AnimatedInputBlockTypes[this.animationType]));\n            }\n            // Common Property \"Type\"\n            codes.push(\"\".concat(variableName, \".isConstant = \").concat(this.isConstant));\n            codes.push(\"\");\n            return _super.prototype._dumpPropertiesCode.call(this) + codes.join(\";\\r\\n\");\n        }\n        return _super.prototype._dumpPropertiesCode.call(this);\n    };\n    InputBlock.prototype.dispose = function () {\n        this.onValueChangedObservable.clear();\n        _super.prototype.dispose.call(this);\n    };\n    InputBlock.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        serializationObject.type = this.type;\n        serializationObject.mode = this._mode;\n        serializationObject.systemValue = this._systemValue;\n        serializationObject.animationType = this._animationType;\n        serializationObject.min = this.min;\n        serializationObject.max = this.max;\n        serializationObject.isBoolean = this.isBoolean;\n        serializationObject.matrixMode = this.matrixMode;\n        serializationObject.isConstant = this.isConstant;\n        serializationObject.groupInInspector = this.groupInInspector;\n        serializationObject.convertToGammaSpace = this.convertToGammaSpace;\n        serializationObject.convertToLinearSpace = this.convertToLinearSpace;\n        if (this._storedValue != null && this._mode === NodeMaterialBlockConnectionPointMode.Uniform) {\n            if (this._storedValue.asArray) {\n                serializationObject.valueType = \"BABYLON.\" + this._storedValue.getClassName();\n                serializationObject.value = this._storedValue.asArray();\n            }\n            else {\n                serializationObject.valueType = \"number\";\n                serializationObject.value = this._storedValue;\n            }\n        }\n        return serializationObject;\n    };\n    InputBlock.prototype._deserialize = function (serializationObject, scene, rootUrl) {\n        this._mode = serializationObject.mode;\n        _super.prototype._deserialize.call(this, serializationObject, scene, rootUrl);\n        this._type = serializationObject.type;\n        this._systemValue = serializationObject.systemValue || serializationObject.wellKnownValue;\n        this._animationType = serializationObject.animationType;\n        this.min = serializationObject.min || 0;\n        this.max = serializationObject.max || 0;\n        this.isBoolean = !!serializationObject.isBoolean;\n        this.matrixMode = serializationObject.matrixMode || 0;\n        this.isConstant = !!serializationObject.isConstant;\n        this.groupInInspector = serializationObject.groupInInspector || \"\";\n        this.convertToGammaSpace = !!serializationObject.convertToGammaSpace;\n        this.convertToLinearSpace = !!serializationObject.convertToLinearSpace;\n        // Tangents back compat\n        if (serializationObject.name === \"tangent\" &&\n            serializationObject.mode === NodeMaterialBlockConnectionPointMode.Attribute &&\n            serializationObject.type === NodeMaterialBlockConnectionPointTypes.Vector3) {\n            this._type = NodeMaterialBlockConnectionPointTypes.Vector4;\n        }\n        if (!serializationObject.valueType) {\n            return;\n        }\n        if (serializationObject.valueType === \"number\") {\n            this._storedValue = serializationObject.value;\n        }\n        else {\n            var valueType = GetClass(serializationObject.valueType);\n            if (valueType) {\n                this._storedValue = valueType.FromArray(serializationObject.value);\n            }\n        }\n    };\n    return InputBlock;\n}(NodeMaterialBlock));\nexport { InputBlock };\nRegisterClass(\"BABYLON.InputBlock\", InputBlock);\n//# sourceMappingURL=inputBlock.js.map","import { __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialConnectionPointDirection } from \"../../nodeMaterialBlockConnectionPoint.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { NodeMaterialConnectionPointCustomObject } from \"../../nodeMaterialConnectionPointCustomObject.js\";\nimport { TBNBlock } from \"../Fragment/TBNBlock.js\";\n/**\n * Block used to implement the anisotropy module of the PBR material\n */\nvar AnisotropyBlock = /** @class */ (function (_super) {\n    __extends(AnisotropyBlock, _super);\n    /**\n     * Create a new AnisotropyBlock\n     * @param name defines the block name\n     */\n    function AnisotropyBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment) || this;\n        _this._isUnique = true;\n        _this.registerInput(\"intensity\", NodeMaterialBlockConnectionPointTypes.Float, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"direction\", NodeMaterialBlockConnectionPointTypes.Vector2, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"uv\", NodeMaterialBlockConnectionPointTypes.Vector2, true); // need this property and the next one in case there's no PerturbNormal block connected to the main PBR block\n        _this.registerInput(\"worldTangent\", NodeMaterialBlockConnectionPointTypes.Vector4, true);\n        _this.registerInput(\"TBN\", NodeMaterialBlockConnectionPointTypes.Object, true, NodeMaterialBlockTargets.VertexAndFragment, new NodeMaterialConnectionPointCustomObject(\"TBN\", _this, NodeMaterialConnectionPointDirection.Input, TBNBlock, \"TBNBlock\"));\n        _this.registerOutput(\"anisotropy\", NodeMaterialBlockConnectionPointTypes.Object, NodeMaterialBlockTargets.Fragment, new NodeMaterialConnectionPointCustomObject(\"anisotropy\", _this, NodeMaterialConnectionPointDirection.Output, AnisotropyBlock, \"AnisotropyBlock\"));\n        return _this;\n    }\n    /**\n     * Initialize the block and prepare the context for build\n     * @param state defines the state that will be used for the build\n     */\n    AnisotropyBlock.prototype.initialize = function (state) {\n        state._excludeVariableName(\"anisotropicOut\");\n        state._excludeVariableName(\"TBN\");\n    };\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    AnisotropyBlock.prototype.getClassName = function () {\n        return \"AnisotropyBlock\";\n    };\n    Object.defineProperty(AnisotropyBlock.prototype, \"intensity\", {\n        /**\n         * Gets the intensity input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(AnisotropyBlock.prototype, \"direction\", {\n        /**\n         * Gets the direction input component\n         */\n        get: function () {\n            return this._inputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(AnisotropyBlock.prototype, \"uv\", {\n        /**\n         * Gets the uv input component\n         */\n        get: function () {\n            return this._inputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(AnisotropyBlock.prototype, \"worldTangent\", {\n        /**\n         * Gets the worldTangent input component\n         */\n        get: function () {\n            return this._inputs[3];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(AnisotropyBlock.prototype, \"TBN\", {\n        /**\n         * Gets the TBN input component\n         */\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        get: function () {\n            return this._inputs[4];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(AnisotropyBlock.prototype, \"anisotropy\", {\n        /**\n         * Gets the anisotropy object output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    AnisotropyBlock.prototype._generateTBNSpace = function (state) {\n        var code = \"\";\n        var comments = \"//\".concat(this.name);\n        var uv = this.uv;\n        var worldPosition = this.worldPositionConnectionPoint;\n        var worldNormal = this.worldNormalConnectionPoint;\n        var worldTangent = this.worldTangent;\n        if (!uv.isConnected) {\n            // we must set the uv input as optional because we may not end up in this method (in case a PerturbNormal block is linked to the PBR material)\n            // in which case uv is not required. But if we do come here, we do need the uv, so we have to raise an error but not with throw, else\n            // it will stop the building of the node material and will lead to errors in the editor!\n            console.error(\"You must connect the 'uv' input of the Anisotropy block!\");\n        }\n        state._emitExtension(\"derivatives\", \"#extension GL_OES_standard_derivatives : enable\");\n        var tangentReplaceString = { search: /defined\\(TANGENT\\)/g, replace: worldTangent.isConnected ? \"defined(TANGENT)\" : \"defined(IGNORE)\" };\n        var TBN = this.TBN;\n        if (TBN.isConnected) {\n            state.compilationString += \"\\n            #ifdef TBNBLOCK\\n            mat3 vTBN = \".concat(TBN.associatedVariableName, \";\\n            #endif\\n            \");\n        }\n        else if (worldTangent.isConnected) {\n            code += \"vec3 tbnNormal = normalize(\".concat(worldNormal.associatedVariableName, \".xyz);\\r\\n\");\n            code += \"vec3 tbnTangent = normalize(\".concat(worldTangent.associatedVariableName, \".xyz);\\r\\n\");\n            code += \"vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\\r\\n\";\n            code += \"mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\\r\\n\";\n        }\n        code += \"\\n            #if defined(\".concat(worldTangent.isConnected ? \"TANGENT\" : \"IGNORE\", \") && defined(NORMAL)\\n                mat3 TBN = vTBN;\\n            #else\\n                mat3 TBN = cotangent_frame(\").concat(worldNormal.associatedVariableName + \".xyz\", \", \").concat(\"v_\" + worldPosition.associatedVariableName + \".xyz\", \", \").concat(uv.isConnected ? uv.associatedVariableName : \"vec2(0.)\", \", vec2(1., 1.));\\n            #endif\\r\\n\");\n        state._emitFunctionFromInclude(\"bumpFragmentMainFunctions\", comments, {\n            replaceStrings: [tangentReplaceString],\n        });\n        return code;\n    };\n    /**\n     * Gets the main code of the block (fragment side)\n     * @param state current state of the node material building\n     * @param generateTBNSpace if true, the code needed to create the TBN coordinate space is generated\n     * @returns the shader code\n     */\n    AnisotropyBlock.prototype.getCode = function (state, generateTBNSpace) {\n        if (generateTBNSpace === void 0) { generateTBNSpace = false; }\n        var code = \"\";\n        if (generateTBNSpace) {\n            code += this._generateTBNSpace(state);\n        }\n        var intensity = this.intensity.isConnected ? this.intensity.associatedVariableName : \"1.0\";\n        var direction = this.direction.isConnected ? this.direction.associatedVariableName : \"vec2(1., 0.)\";\n        code += \"anisotropicOutParams anisotropicOut;\\n            anisotropicBlock(\\n                vec3(\".concat(direction, \", \").concat(intensity, \"),\\n            #ifdef ANISOTROPIC_TEXTURE\\n                vec3(0.),\\n            #endif\\n                TBN,\\n                normalW,\\n                viewDirectionW,\\n                anisotropicOut\\n            );\\r\\n\");\n        return code;\n    };\n    AnisotropyBlock.prototype.prepareDefines = function (mesh, nodeMaterial, defines) {\n        _super.prototype.prepareDefines.call(this, mesh, nodeMaterial, defines);\n        defines.setValue(\"ANISOTROPIC\", true);\n        defines.setValue(\"ANISOTROPIC_TEXTURE\", false, true);\n    };\n    AnisotropyBlock.prototype._buildBlock = function (state) {\n        if (state.target === NodeMaterialBlockTargets.Fragment) {\n            state.sharedData.blocksWithDefines.push(this);\n        }\n        return this;\n    };\n    return AnisotropyBlock;\n}(NodeMaterialBlock));\nexport { AnisotropyBlock };\nRegisterClass(\"BABYLON.AnisotropyBlock\", AnisotropyBlock);\n//# sourceMappingURL=anisotropyBlock.js.map","import { __decorate, __extends } from \"tslib\";\nimport { NodeMaterialBlock } from \"../../nodeMaterialBlock.js\";\nimport { NodeMaterialBlockConnectionPointTypes } from \"../../Enums/nodeMaterialBlockConnectionPointTypes.js\";\nimport { NodeMaterialConnectionPointDirection } from \"../../nodeMaterialBlockConnectionPoint.js\";\nimport { NodeMaterialBlockTargets } from \"../../Enums/nodeMaterialBlockTargets.js\";\nimport { RegisterClass } from \"../../../../Misc/typeStore.js\";\nimport { InputBlock } from \"../Input/inputBlock.js\";\nimport { NodeMaterialConnectionPointCustomObject } from \"../../nodeMaterialConnectionPointCustomObject.js\";\nimport { PBRClearCoatConfiguration } from \"../../../PBR/pbrClearCoatConfiguration.js\";\nimport { editableInPropertyPage, PropertyTypeForEdition } from \"../../nodeMaterialDecorator.js\";\nimport { TBNBlock } from \"../Fragment/TBNBlock.js\";\n/**\n * Block used to implement the clear coat module of the PBR material\n */\nvar ClearCoatBlock = /** @class */ (function (_super) {\n    __extends(ClearCoatBlock, _super);\n    /**\n     * Create a new ClearCoatBlock\n     * @param name defines the block name\n     */\n    function ClearCoatBlock(name) {\n        var _this = _super.call(this, name, NodeMaterialBlockTargets.Fragment) || this;\n        /**\n         * Defines if the F0 value should be remapped to account for the interface change in the material.\n         */\n        _this.remapF0OnInterfaceChange = true;\n        _this._isUnique = true;\n        _this.registerInput(\"intensity\", NodeMaterialBlockConnectionPointTypes.Float, false, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"roughness\", NodeMaterialBlockConnectionPointTypes.Float, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"indexOfRefraction\", NodeMaterialBlockConnectionPointTypes.Float, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"normalMapColor\", NodeMaterialBlockConnectionPointTypes.Color3, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"uv\", NodeMaterialBlockConnectionPointTypes.Vector2, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"tintColor\", NodeMaterialBlockConnectionPointTypes.Color3, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"tintAtDistance\", NodeMaterialBlockConnectionPointTypes.Float, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"tintThickness\", NodeMaterialBlockConnectionPointTypes.Float, true, NodeMaterialBlockTargets.Fragment);\n        _this.registerInput(\"worldTangent\", NodeMaterialBlockConnectionPointTypes.Vector4, true);\n        _this.registerInput(\"worldNormal\", NodeMaterialBlockConnectionPointTypes.Vector4, true);\n        _this.worldNormal.acceptedConnectionPointTypes.push(NodeMaterialBlockConnectionPointTypes.Vector3);\n        _this.registerInput(\"TBN\", NodeMaterialBlockConnectionPointTypes.Object, true, NodeMaterialBlockTargets.VertexAndFragment, new NodeMaterialConnectionPointCustomObject(\"TBN\", _this, NodeMaterialConnectionPointDirection.Input, TBNBlock, \"TBNBlock\"));\n        _this.registerOutput(\"clearcoat\", NodeMaterialBlockConnectionPointTypes.Object, NodeMaterialBlockTargets.Fragment, new NodeMaterialConnectionPointCustomObject(\"clearcoat\", _this, NodeMaterialConnectionPointDirection.Output, ClearCoatBlock, \"ClearCoatBlock\"));\n        return _this;\n    }\n    /**\n     * Initialize the block and prepare the context for build\n     * @param state defines the state that will be used for the build\n     */\n    ClearCoatBlock.prototype.initialize = function (state) {\n        state._excludeVariableName(\"clearcoatOut\");\n        state._excludeVariableName(\"vClearCoatParams\");\n        state._excludeVariableName(\"vClearCoatTintParams\");\n        state._excludeVariableName(\"vClearCoatRefractionParams\");\n        state._excludeVariableName(\"vClearCoatTangentSpaceParams\");\n        state._excludeVariableName(\"vGeometricNormaClearCoatW\");\n    };\n    /**\n     * Gets the current class name\n     * @returns the class name\n     */\n    ClearCoatBlock.prototype.getClassName = function () {\n        return \"ClearCoatBlock\";\n    };\n    Object.defineProperty(ClearCoatBlock.prototype, \"intensity\", {\n        /**\n         * Gets the intensity input component\n         */\n        get: function () {\n            return this._inputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ClearCoatBlock.prototype, \"roughness\", {\n        /**\n         * Gets the roughness input component\n         */\n        get: function () {\n            return this._inputs[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ClearCoatBlock.prototype, \"indexOfRefraction\", {\n        /**\n         * Gets the ior input component\n         */\n        get: function () {\n            return this._inputs[2];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ClearCoatBlock.prototype, \"normalMapColor\", {\n        /**\n         * Gets the bump texture input component\n         */\n        get: function () {\n            return this._inputs[3];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ClearCoatBlock.prototype, \"uv\", {\n        /**\n         * Gets the uv input component\n         */\n        get: function () {\n            return this._inputs[4];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ClearCoatBlock.prototype, \"tintColor\", {\n        /**\n         * Gets the tint color input component\n         */\n        get: function () {\n            return this._inputs[5];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ClearCoatBlock.prototype, \"tintAtDistance\", {\n        /**\n         * Gets the tint \"at distance\" input component\n         */\n        get: function () {\n            return this._inputs[6];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ClearCoatBlock.prototype, \"tintThickness\", {\n        /**\n         * Gets the tint thickness input component\n         */\n        get: function () {\n            return this._inputs[7];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ClearCoatBlock.prototype, \"worldTangent\", {\n        /**\n         * Gets the world tangent input component\n         */\n        get: function () {\n            return this._inputs[8];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ClearCoatBlock.prototype, \"worldNormal\", {\n        /**\n         * Gets the world normal input component\n         */\n        get: function () {\n            return this._inputs[9];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ClearCoatBlock.prototype, \"TBN\", {\n        /**\n         * Gets the TBN input component\n         */\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        get: function () {\n            return this._inputs[10];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ClearCoatBlock.prototype, \"clearcoat\", {\n        /**\n         * Gets the clear coat object output component\n         */\n        get: function () {\n            return this._outputs[0];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    ClearCoatBlock.prototype.autoConfigure = function () {\n        if (!this.intensity.isConnected) {\n            var intensityInput = new InputBlock(\"ClearCoat intensity\", NodeMaterialBlockTargets.Fragment, NodeMaterialBlockConnectionPointTypes.Float);\n            intensityInput.value = 1;\n            intensityInput.output.connectTo(this.intensity);\n        }\n    };\n    ClearCoatBlock.prototype.prepareDefines = function (mesh, nodeMaterial, defines) {\n        _super.prototype.prepareDefines.call(this, mesh, nodeMaterial, defines);\n        defines.setValue(\"CLEARCOAT\", true);\n        defines.setValue(\"CLEARCOAT_TEXTURE\", false, true);\n        defines.setValue(\"CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE\", true, true);\n        defines.setValue(\"CLEARCOAT_TINT\", this.tintColor.isConnected || this.tintThickness.isConnected || this.tintAtDistance.isConnected, true);\n        defines.setValue(\"CLEARCOAT_BUMP\", this.normalMapColor.isConnected, true);\n        defines.setValue(\"CLEARCOAT_DEFAULTIOR\", this.indexOfRefraction.isConnected ? this.indexOfRefraction.connectInputBlock.value === PBRClearCoatConfiguration._DefaultIndexOfRefraction : true, true);\n        defines.setValue(\"CLEARCOAT_REMAP_F0\", this.remapF0OnInterfaceChange, true);\n    };\n    ClearCoatBlock.prototype.bind = function (effect, nodeMaterial, mesh) {\n        var _a, _b;\n        _super.prototype.bind.call(this, effect, nodeMaterial, mesh);\n        // Clear Coat Refraction params\n        var indexOfRefraction = (_b = (_a = this.indexOfRefraction.connectInputBlock) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : PBRClearCoatConfiguration._DefaultIndexOfRefraction;\n        var a = 1 - indexOfRefraction;\n        var b = 1 + indexOfRefraction;\n        var f0 = Math.pow(-a / b, 2); // Schlicks approx: (ior1 - ior2) / (ior1 + ior2) where ior2 for air is close to vacuum = 1.\n        var eta = 1 / indexOfRefraction;\n        effect.setFloat4(\"vClearCoatRefractionParams\", f0, eta, a, b);\n        // Clear Coat tangent space params\n        var mainPBRBlock = this.clearcoat.hasEndpoints ? this.clearcoat.endpoints[0].ownerBlock : null;\n        var perturbedNormalBlock = (mainPBRBlock === null || mainPBRBlock === void 0 ? void 0 : mainPBRBlock.perturbedNormal.isConnected) ? mainPBRBlock.perturbedNormal.connectedPoint.ownerBlock : null;\n        if (this._scene._mirroredCameraPosition) {\n            effect.setFloat2(\"vClearCoatTangentSpaceParams\", (perturbedNormalBlock === null || perturbedNormalBlock === void 0 ? void 0 : perturbedNormalBlock.invertX) ? 1.0 : -1.0, (perturbedNormalBlock === null || perturbedNormalBlock === void 0 ? void 0 : perturbedNormalBlock.invertY) ? 1.0 : -1.0);\n        }\n        else {\n            effect.setFloat2(\"vClearCoatTangentSpaceParams\", (perturbedNormalBlock === null || perturbedNormalBlock === void 0 ? void 0 : perturbedNormalBlock.invertX) ? -1.0 : 1.0, (perturbedNormalBlock === null || perturbedNormalBlock === void 0 ? void 0 : perturbedNormalBlock.invertY) ? -1.0 : 1.0);\n        }\n    };\n    ClearCoatBlock.prototype._generateTBNSpace = function (state, worldPositionVarName, worldNormalVarName) {\n        var code = \"\";\n        var comments = \"//\".concat(this.name);\n        var worldTangent = this.worldTangent;\n        state._emitExtension(\"derivatives\", \"#extension GL_OES_standard_derivatives : enable\");\n        var tangentReplaceString = { search: /defined\\(TANGENT\\)/g, replace: worldTangent.isConnected ? \"defined(TANGENT)\" : \"defined(IGNORE)\" };\n        var TBN = this.TBN;\n        if (TBN.isConnected) {\n            state.compilationString += \"\\n            #ifdef TBNBLOCK\\n            mat3 vTBN = \".concat(TBN.associatedVariableName, \";\\n            #endif\\n            \");\n        }\n        else if (worldTangent.isConnected) {\n            code += \"vec3 tbnNormal = normalize(\".concat(worldNormalVarName, \".xyz);\\r\\n\");\n            code += \"vec3 tbnTangent = normalize(\".concat(worldTangent.associatedVariableName, \".xyz);\\r\\n\");\n            code += \"vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\\r\\n\";\n            code += \"mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\\r\\n\";\n        }\n        state._emitFunctionFromInclude(\"bumpFragmentMainFunctions\", comments, {\n            replaceStrings: [tangentReplaceString],\n        });\n        return code;\n    };\n    /**\n     * Gets the main code of the block (fragment side)\n     * @param state current state of the node material building\n     * @param ccBlock instance of a ClearCoatBlock or null if the code must be generated without an active clear coat module\n     * @param reflectionBlock instance of a ReflectionBlock null if the code must be generated without an active reflection module\n     * @param worldPosVarName name of the variable holding the world position\n     * @param generateTBNSpace if true, the code needed to create the TBN coordinate space is generated\n     * @param vTBNAvailable indicate that the vTBN variable is already existing because it has already been generated by another block (PerturbNormal or Anisotropy)\n     * @param worldNormalVarName name of the variable holding the world normal\n     * @returns the shader code\n     */\n    ClearCoatBlock.GetCode = function (state, ccBlock, reflectionBlock, worldPosVarName, generateTBNSpace, vTBNAvailable, worldNormalVarName) {\n        var code = \"\";\n        var intensity = (ccBlock === null || ccBlock === void 0 ? void 0 : ccBlock.intensity.isConnected) ? ccBlock.intensity.associatedVariableName : \"1.\";\n        var roughness = (ccBlock === null || ccBlock === void 0 ? void 0 : ccBlock.roughness.isConnected) ? ccBlock.roughness.associatedVariableName : \"0.\";\n        var normalMapColor = (ccBlock === null || ccBlock === void 0 ? void 0 : ccBlock.normalMapColor.isConnected) ? ccBlock.normalMapColor.associatedVariableName : \"vec3(0.)\";\n        var uv = (ccBlock === null || ccBlock === void 0 ? void 0 : ccBlock.uv.isConnected) ? ccBlock.uv.associatedVariableName : \"vec2(0.)\";\n        var tintColor = (ccBlock === null || ccBlock === void 0 ? void 0 : ccBlock.tintColor.isConnected) ? ccBlock.tintColor.associatedVariableName : \"vec3(1.)\";\n        var tintThickness = (ccBlock === null || ccBlock === void 0 ? void 0 : ccBlock.tintThickness.isConnected) ? ccBlock.tintThickness.associatedVariableName : \"1.\";\n        var tintAtDistance = (ccBlock === null || ccBlock === void 0 ? void 0 : ccBlock.tintAtDistance.isConnected) ? ccBlock.tintAtDistance.associatedVariableName : \"1.\";\n        var tintTexture = \"vec4(0.)\";\n        if (ccBlock) {\n            state._emitUniformFromString(\"vClearCoatRefractionParams\", \"vec4\");\n            state._emitUniformFromString(\"vClearCoatTangentSpaceParams\", \"vec2\");\n            var normalShading = ccBlock.worldNormal;\n            code += \"vec3 vGeometricNormaClearCoatW = \".concat(normalShading.isConnected ? \"normalize(\" + normalShading.associatedVariableName + \".xyz)\" : \"geometricNormalW\", \";\\r\\n\");\n        }\n        else {\n            code += \"vec3 vGeometricNormaClearCoatW = geometricNormalW;\\r\\n\";\n        }\n        if (generateTBNSpace && ccBlock) {\n            code += ccBlock._generateTBNSpace(state, worldPosVarName, worldNormalVarName);\n            vTBNAvailable = ccBlock.worldTangent.isConnected;\n        }\n        code += \"clearcoatOutParams clearcoatOut;\\n\\n        #ifdef CLEARCOAT\\n            vec2 vClearCoatParams = vec2(\".concat(intensity, \", \").concat(roughness, \");\\n            vec4 vClearCoatTintParams = vec4(\").concat(tintColor, \", \").concat(tintThickness, \");\\n\\n            clearcoatBlock(\\n                \").concat(worldPosVarName, \".xyz,\\n                vGeometricNormaClearCoatW,\\n                viewDirectionW,\\n                vClearCoatParams,\\n                specularEnvironmentR0,\\n            #ifdef CLEARCOAT_TEXTURE\\n                vec2(0.),\\n            #endif\\n            #ifdef CLEARCOAT_TINT\\n                vClearCoatTintParams,\\n                \").concat(tintAtDistance, \",\\n                vClearCoatRefractionParams,\\n                #ifdef CLEARCOAT_TINT_TEXTURE\\n                    \").concat(tintTexture, \",\\n                #endif\\n            #endif\\n            #ifdef CLEARCOAT_BUMP\\n                vec2(0., 1.),\\n                vec4(\").concat(normalMapColor, \", 0.),\\n                \").concat(uv, \",\\n                #if defined(\").concat(vTBNAvailable ? \"TANGENT\" : \"IGNORE\", \") && defined(NORMAL)\\n                    vTBN,\\n                #else\\n                    vClearCoatTangentSpaceParams,\\n                #endif\\n                #ifdef OBJECTSPACE_NORMALMAP\\n                    normalMatrix,\\n                #endif\\n            #endif\\n            #if defined(FORCENORMALFORWARD) && defined(NORMAL)\\n                faceNormal,\\n            #endif\\n            #ifdef REFLECTION\\n                \").concat(reflectionBlock === null || reflectionBlock === void 0 ? void 0 : reflectionBlock._vReflectionMicrosurfaceInfosName, \",\\n                \").concat(reflectionBlock === null || reflectionBlock === void 0 ? void 0 : reflectionBlock._vReflectionInfosName, \",\\n                \").concat(reflectionBlock === null || reflectionBlock === void 0 ? void 0 : reflectionBlock.reflectionColor, \",\\n                vLightingIntensity,\\n                #ifdef \").concat(reflectionBlock === null || reflectionBlock === void 0 ? void 0 : reflectionBlock._define3DName, \"\\n                    \").concat(reflectionBlock === null || reflectionBlock === void 0 ? void 0 : reflectionBlock._cubeSamplerName, \",\\n                #else\\n                    \").concat(reflectionBlock === null || reflectionBlock === void 0 ? void 0 : reflectionBlock._2DSamplerName, \",\\n                #endif\\n                #ifndef LODBASEDMICROSFURACE\\n                    #ifdef \").concat(reflectionBlock === null || reflectionBlock === void 0 ? void 0 : reflectionBlock._define3DName, \"\\n                        \").concat(reflectionBlock === null || reflectionBlock === void 0 ? void 0 : reflectionBlock._cubeSamplerName, \",\\n                        \").concat(reflectionBlock === null || reflectionBlock === void 0 ? void 0 : reflectionBlock._cubeSamplerName, \",\\n                    #else\\n                        \").concat(reflectionBlock === null || reflectionBlock === void 0 ? void 0 : reflectionBlock._2DSamplerName, \",\\n                        \").concat(reflectionBlock === null || reflectionBlock === void 0 ? void 0 : reflectionBlock._2DSamplerName, \",\\n                    #endif\\n                #endif\\n            #endif\\n            #if defined(ENVIRONMENTBRDF) && !defined(\").concat(reflectionBlock === null || reflectionBlock === void 0 ? void 0 : reflectionBlock._defineSkyboxName, \")\\n                #ifdef RADIANCEOCCLUSION\\n                    ambientMonochrome,\\n                #endif\\n            #endif\\n            #if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\\n                (gl_FrontFacing ? 1. : -1.),\\n            #endif\\n                clearcoatOut\\n            );\\n        #else\\n            clearcoatOut.specularEnvironmentR0 = specularEnvironmentR0;\\n        #endif\\r\\n\");\n        return code;\n    };\n    ClearCoatBlock.prototype._buildBlock = function (state) {\n        this._scene = state.sharedData.scene;\n        if (state.target === NodeMaterialBlockTargets.Fragment) {\n            state.sharedData.bindableBlocks.push(this);\n            state.sharedData.blocksWithDefines.push(this);\n        }\n        return this;\n    };\n    ClearCoatBlock.prototype._dumpPropertiesCode = function () {\n        var codeString = _super.prototype._dumpPropertiesCode.call(this);\n        codeString += \"\".concat(this._codeVariableName, \".remapF0OnInterfaceChange = \").concat(this.remapF0OnInterfaceChange, \";\\r\\n\");\n        return codeString;\n    };\n    ClearCoatBlock.prototype.serialize = function () {\n        var serializationObject = _super.prototype.serialize.call(this);\n        serializationObject.remapF0OnInterfaceChange = this.remapF0OnInterfaceChange;\n        return serializationObject;\n    };\n    ClearCoatBlock.prototype._deserialize = function (serializationObject, scene, rootUrl) {\n        var _a;\n        _super.prototype._deserialize.call(this, serializationObject, scene, rootUrl);\n        this.remapF0OnInterfaceChange = (_a = serializationObject.remapF0OnInterfaceChange) !== null && _a !== void 0 ? _a : true;\n    };\n    __decorate([\n        editableInPropertyPage(\"Remap F0 on interface change\", PropertyTypeForEdition.Boolean, \"ADVANCED\")\n    ], ClearCoatBlock.prototype, \"remapF0OnInterfaceChange\", void 0);\n    return ClearCoatBlock;\n}(NodeMaterialBlock));\nexport { ClearCoatBlock };\nRegisterClass(\"BABYLON.ClearCoatBlock\", ClearCoatBlock);\n//# sourceMappingURL=clearCoatBlock.js.map"],"names":["LensFlare","size","position","color","imgUrl","system","this","alphaMode","texture","getScene","_system","engine","scene","getEngine","_drawWrapper","effect","createEffect","lensFlares","push","AddFlare","prototype","dispose","index","indexOf","splice","LensFlareSystem","name","emitter","Array","borderLimit","viewportBorder","layerMask","_vertexBuffers","_isEnabled","_scene","_SceneComponentInitialization","_emitter","id","lensFlareSystems","meshesSelectionPredicate","m","activeCamera","material","isVisible","isEnabled","isBlocker","vertices","_createIndexBuffer","Object","defineProperty","get","enumerable","configurable","indices","_indexBuffer","createIndexBuffer","set","value","getEmitter","setEmitter","newEmitter","getEmitterPosition","getAbsolutePosition","computeEffectivePosition","globalViewport","getTransformMatrix","_positionX","x","_positionY","y","getViewMatrix","width","height","rhs","useRightHandedSystem","z","_isVisible","direction","subtract","globalPosition","distance","length","normalize","ray","pickInfo","pickWithRay","hit","render","awayX","awayY","viewport","toGlobal","getRenderWidth","getRenderHeight","away","intensity","centerX","centerY","distX","distY","setState","setDepthBuffer","flare","isReady","enableEffect","bindBuffers","setAlphaMode","cw","ch","getAspectRatio","cx","cy","viewportMatrix","setMatrix","setTexture","setFloat4","r","g","b","drawElementsType","rebuild","_a","key","_rebuild","vertexBuffer","_releaseBuffer","Parse","parsedLensFlareSystem","rootUrl","getLastEntryById","emitterId","lensFlareSystem","flares","parsedFlare","textureName","serialize","serializationObject","asArray","_","parsedData","container","undefined","cache","lf","getLensFlareSystemById","toRemove","newLensFlareSystem","LensFlareSystemSceneComponent","register","_afterCameraDrawStage","registerStep","_draw","addFromContainer","_this","forEach","o","addLensFlareSystem","removeFromContainer","removeLensFlareSystem","_i","lensFlareSystems_1","camera","lensFlaresEnabled","lensFlareSystems_2","component","_getComponent","_addComponent","ShadowGenerator","mapSize","light","usefullFloatFirst","onBeforeShadowMapRenderObservable","onAfterShadowMapRenderObservable","onBeforeShadowMapRenderMeshObservable","onAfterShadowMapRenderMeshObservable","_bias","_normalBias","_blurBoxOffset","_blurScale","_blurKernel","_useKernelBlur","_filter","FILTER_NONE","_filteringQuality","QUALITY_HIGH","_contactHardeningLightSizeUVRatio","_darkness","_transparencyShadow","enableSoftTransparentShadow","useOpacityTextureForTransparentShadow","frustumEdgeFalloff","forceBackFacesOnly","_lightDirection","_viewMatrix","_projectionMatrix","_transformMatrix","_cachedPosition","Number","MAX_VALUE","_cachedDirection","_currentFaceIndex","_currentFaceIndexCache","_defaultTextureMatrix","_mapSize","_light","_shadowGenerator","_useUBO","supportsUniformBuffers","_sceneUBOs","createSceneUniformBuffer","concat","caps","getCaps","textureFloatRender","textureFloatLinearFiltering","_textureType","textureHalfFloatRender","textureHalfFloatLinearFiltering","_initializeGenerator","_applyFilterValues","bias","normalBias","_disposeBlurPostProcesses","_depthScale","getDepthScale","_validateFilter","filter","needCube","FILTER_BLUREXPONENTIALSHADOWMAP","useExponentialShadowMap","FILTER_BLURCLOSEEXPONENTIALSHADOWMAP","useCloseExponentialShadowMap","FILTER_PCF","FILTER_PCSS","usePoissonSampling","_features","supportShadowSamplers","_markMeshesAsLightDirty","FILTER_POISSONSAMPLING","FILTER_EXPONENTIALSHADOWMAP","FILTER_CLOSEEXPONENTIALSHADOWMAP","filteringQuality","contactHardeningLightSizeUVRatio","setDarkness","getDarkness","darkness","setTransparencyShadow","transparent","getShadowMap","_shadowMap","getShadowMapForRendering","_shadowMap2","getClassName","CLASSNAME","addShadowCaster","mesh","includeDescendants","renderList","getChildMeshes","childMesh","removeShadowCaster","getChildren","child","getLight","recreateShadowMap","_initializeShadowMap","_createTargetRenderTexture","supportDepthStencilTexture","createDepthStencilTexture","useReverseDepthBuffer","wrapU","wrapV","anisotropicFilteringLevel","updateSamplingMode","renderParticles","ignoreCameraViewport","_storedUniqueId","uniqueId","customRenderFunction","_renderForShadowMap","bind","customIsReadyFunction","onBeforeBindObservable","add","_currentSceneUBO","getSceneUniformBuffer","_debugPushGroup","call","currentRenderPassId","onBeforeRenderObservable","faceIndex","setSceneUniformBuffer","setColorWrite","setTransformMatrix","unbindEffect","finalizeSceneUbo","onAfterUnbindObservable","_b","updateTransformMatrix","useBlurExponentialShadowMap","useBlurCloseExponentialShadowMap","shadowMap","postProcessManager","directRender","_blurPostProcesses","renderTarget","unBindFramebuffer","_debugPopGroup","clearZero","clearOne","onClearObservable","clear","onResizeObservable","rtt","getRenderSize","i","setRenderingAutoClearDepthStencil","_initializeBlurRTTAndPostProcesses","targetSize","blurScale","useKernelBlur","_kernelBlurXPostprocess","blurKernel","externalTextureSamplerBinding","onApplyObservable","_kernelBlurYPostprocess","autoClear","packedFloat","_boxBlurPostprocess","setFloat2","opaqueSubMeshes","alphaTestSubMeshes","transparentSubMeshes","depthOnlySubMeshes","_renderSubMeshForShadowMap","data","getEffectiveMesh","_internalAbstractMeshDataInfo","_isActiveIntermediate","_bindCustomEffectForRenderSubMeshForShadowMap","subMesh","isTransparent","renderingMesh","getRenderingMesh","effectiveMesh","getMaterial","verticesCount","_renderId","getRenderId","detNeg","_getWorldMatrixDeterminant","sideOrientation","overrideMaterialSideOrientation","reverseSideOrientation","backFaceCulling","cullBackFaces","batch","_getInstancesRenderList","_id","getReplacementMesh","mustReturn","hardwareInstancedRendering","instancedArrays","visibleInstances","hasThinInstances","customAllowRendering","shadowDepthWrapper","drawWrapper","getEffect","_getDrawWrapper","effect_1","_bind","fillMode","setFloat3","depthScale","getTypeID","setVector3","getDepthMinZ","getDepthMaxZ","setFloat","visibility","alpha","_setMainDrawWrapperOverride","standalone","baseMaterial","bindForSubMesh","getWorldMatrix","opacityTexture","getTextureMatrix","needAlphaTesting","alphaTexture","getAlphaTestTexture","useBones","computeBonesUsingShaders","skeleton","isUsingTextureForMatrices","boneTexture","getTransformMatrixTexture","bones","setMatrices","getTransformMatrices","morphTargetManager","isUsingTextureForTargets","bindUniformBuffer","world_1","getMeshUniformBuffer","bindToEffect","transferToEffect","notifyObservers","_processRendering","isInstance","worldOverride","resetRefreshCounter","forceCompilation","onCompiled","options","localOptions","useInstances","subMeshes","renderList_1","apply","currentIndex","checkReady","needAlphaBlendingForMesh","getMesh","setTimeout","forceCompilationAsync","Promise","resolve","_isReadyCustomDefines","defines","_prepareShadowDefines","usePercentageCloserFiltering","useContactHardeningShadow","isVerticesDataPresent","isReadyForSubMesh","subMeshEffect","cachedDefines","attribs","nonUniformScaling","alphaCutOff","DEFAULT_ALPHA_CUTOFF","coordinatesIndex","fallbacks","numBoneInfluencers","addCPUSkinningFallback","manager","morphInfluencers","numInfluencers","clipPlane","clipPlane2","clipPlane3","clipPlane4","clipPlane5","clipPlane6","customShaderOptions","define","join","shaderName","uniforms","samplers","attributes","_c","_d","attrib","_e","_f","uniform","_g","_h","sampler","uniformsNames","uniformBuffersNames","onError","indexParameters","maxSimultaneousMorphTargets","setEffect","prepareDefines","lightIndex","shadowsEnabled","shadowEnabled","QUALITY_LOW","QUALITY_MEDIUM","bindShadowLight","setDepthStencilTexture","_uniformBuffer","updateFloat4","getSize","updateFloat2","_currentRenderId","lightPosition","computeTransformedInformation","transformedPosition","getShadowDirection","Math","abs","needProjectionMatrixCompute","equals","copyFrom","setShadowProjectionMatrix","multiplyToRef","_disposeRTTandPostProcesses","renderList_2","_disposeSceneUBOs","className","lightId","transparencyShadow","blurBoxOffset","meshIndex","parsedShadowGenerator","constr","getLightById","shadowGenerator","getMeshesById","useVarianceShadowMap","useBlurVarianceShadowMap","N","DirectionalLight","_super","_shadowFrustumSize","_shadowOrthoScale","autoUpdateExtends","autoCalcShadowZBounds","_orthoLeft","_orthoRight","MIN_VALUE","_orthoTop","_orthoBottom","scale","forceProjectionMatrixCompute","left","right","top","bottom","_setDefaultShadowProjectionMatrix","matrix","viewMatrix","shadowFrustumSize","_setDefaultFixedFrustumShadowProjectionMatrix","_setDefaultAutoExtendShadowProjectionMatrix","shadowMinZ","minZ","shadowMaxZ","maxZ","isNDCHalfZRange","tempVector3","boundingBox","getBoundingInfo","vectorsWorld","_shadowMinZ","_shadowMaxZ","xOffset","yOffset","shadowOrthoScale","_buildUniformLayout","addUniform","create","transformedDirection","transferToNodeMaterialEffect","lightDataUniformName","prepareLightSpecificDefines","HemisphericLight","groundColor","setDirectionToTarget","target","getShadowGenerator","_effect","normalizeDirection","updateColor3","computeWorldMatrix","_worldMatrix","UpDir","ZeroVec","tmpv1","tmpv2","tmpMatrix","CascadedShadowGenerator","usefulFloatFirst","IsSupported","_numCascades","min","max","MIN_CASCADES_COUNT","MAX_CASCADES_COUNT","_recreateSceneUBOs","_freezeShadowCastersBoundingInfo","freeze","_freezeShadowCastersBoundingInfoObservable","remove","_computeShadowCastersBoundingInfo","_scbiMin","copyFromFloats","_scbiMax","minimizeInPlace","minimumWorld","maximizeInPlace","maximumWorld","meshes","receiveShadows","_shadowCastersBoundingInfo","reConstruct","boundingInfo","setMinMaxDistance","_minDistance","_maxDistance","_breaksAreDirty","getCascadeMinExtents","cascadeIndex","_cascadeMinExtents","getCascadeMaxExtents","_cascadeMaxExtents","_debug","dbg","_depthClamp","_cascadeBlendPercentage","_lambda","lambda","getCascadeViewMatrix","cascadeNum","_viewMatrices","getCascadeProjectionMatrix","_projectionMatrices","getCascadeTransformMatrix","_transformMatrices","setDepthRenderer","depthRenderer","_depthRenderer","_depthReducer","_autoCalcDepthBounds","deactivate","onAfterReductionPerformed","minmax","activate","getDepthMap","refreshRate","splitFrustum","_splitFrustum","near","far","cameraRange","minDistance","range","ratio","_cascades","p","log","pow","d","prevBreakDistance","breakDistance","_viewSpaceFrustumsZ","_frustumLengths","_computeMatrices","_computeFrustumInWorldSpace","_computeCascadeFrustum","subtractToRef","_frustumCenter","addToRef","_shadowCameraPos","update","scaleInPlace","round","subtractInPlace","copyToArray","_transformMatricesAsArray","prevSplitDist","splitDist","invViewProj","getTransformationMatrix","cornerIndexOffset","cornerIndex","_FrustumCornersNDCSpace","_frustumCornersWorldSpace","addInPlace","stabilizeCascades","sphereRadius","dist","ceil","lightCameraPos","supportCSM","_j","_k","_l","_m","_o","_p","_q","_r","_s","_t","_u","_v","penumbraDarkness","DEFAULT_CASCADES_COUNT","freezeShadowCastersBoundingInfo","_currentLayer","layers","numCascades","Float32Array","_lightSizeUVCorrection","_depthCorrection","layer","debug","cascadeBlendPercentage","setArray","setArray2","depthClamp","autoCalcDepthBounds","maxDistance","shadowGenerators","ShadowGeneratorSceneComponent","_gatherRenderTargetsStage","_gatherRenderTargets","lights_1","lights","renderTargets","textures","Light","diffuse","specular","falloffType","FALLOFF_DEFAULT","_range","_inverseSquaredRange","_photometricScale","_intensityMode","INTENSITYMODE_AUTOMATIC","_radius","renderPriority","_shadowEnabled","_excludeWithLayerMask","_includeOnlyWithLayerMask","_lightmapMode","_excludedMeshesIds","_includedOnlyMeshesIds","_isLight","addLight","includedOnlyMeshes","excludedMeshes","_resyncMeshes","_computePhotometricScale","_includedOnlyMeshes","_hookArrayForIncludedOnly","_excludedMeshes","_hookArrayForExcluded","transferTexturesToEffect","_bindLight","useSpecular","iAsString","toString","needUpdate","_lastUseSpecular","useUbo","scaledIntensity","getScaledIntensity","scaleToRef","updateColor4","radius","fullDetails","ret","animations","_syncParentEnabledState","isDisposed","setEnabled","canAffectMesh","includeOnlyWithLayerMask","excludeWithLayerMask","doNotRecurse","disposeMaterialAndTextures","stopAnimation","_parentContainer","_removeLightSource","removeLight","clone","newParent","constructor","GetConstructorFromName","clonedLight","parent","onClonedObservable","type","parentId","excludedMeshesIds","includedOnlyMeshesIds","ranges","serializeAnimationRanges","constructorFunc","parsedLight","_waitingParentId","lightmapMode","animationIndex","parsedAnimation","internalClass","autoAnimate","beginAnimation","autoAnimateFrom","autoAnimateTo","autoAnimateLoop","autoAnimateSpeed","array","oldPush","items","arguments","result","items_1","item","_resyncLightSource","oldSplice","deleteCount","deleted","deleted_1","array_1","lightSources","_markSubMeshesAsLightDirty","_getPhotometricScale","resetCachedMaterial","photometricScale","lightTypeID","photometricMode","intensityMode","LIGHTTYPEID_DIRECTIONALLIGHT","INTENSITYMODE_ILLUMINANCE","INTENSITYMODE_LUMINOUSINTENSITY","LIGHTTYPEID_POINTLIGHT","LIGHTTYPEID_SPOTLIGHT","INTENSITYMODE_LUMINOUSPOWER","PI","INTENSITYMODE_LUMINANCE","apexAngleRadians","cos","LIGHTTYPEID_HEMISPHERICLIGHT","_reorderLightsInScene","_renderPriority","requireLightSorting","sortLightsByPriority","FALLOFF_PHYSICAL","FALLOFF_GLTF","FALLOFF_STANDARD","LIGHTMAP_DEFAULT","LIGHTMAP_SPECULAR","LIGHTMAP_SHADOWSONLY","LightConstants","CompareLightsPriority","a","PointLight","_shadowAngle","_direction","previousNeedCube","shadowAngle","ShadowLight","_needProjectionMatrixCompute","_setPosition","_position","_setDirection","getRotation","xaxis","yaxis","_initCache","_cache","_isSynchronized","force","isSynchronized","_updateCache","_markSyncedWithParent","_worldMatrixDeterminantIsDirty","customProjectionMatrixBuilder","SpotLight","angle","exponent","_innerAngle","_projectionTextureMatrix","_projectionTextureLightNear","_projectionTextureLightFar","_projectionTextureUpDirection","_projectionTextureViewLightDirty","_projectionTextureProjectionLightDirty","_projectionTextureDirty","_projectionTextureViewTargetVector","_projectionTextureViewLightMatrix","_projectionTextureProjectionLightMatrix","_projectionTextureScalingMatrix","_angle","_cosHalfAngle","_computeAngleValues","_shadowAngleScale","_projectionTexture","_IsProceduralTexture","executeWhenCompiled","_IsTexture","onLoadObservable","addOnce","onGeneratedObservable","projection","_computeProjectionTextureViewLightMatrix","_computeProjectionTextureProjectionLightMatrix","lightFar","projectionTextureLightFar","lightNear","projectionTextureLightNear","P","Q","S","tan","_computeProjectionTextureMatrix","u","uScale","v","vScale","_lightAngleScale","_lightAngleOffset","projectionTexture","DefaultLoadingScreen","_renderingCanvas","_loadingText","_loadingDivBackgroundColor","_resizeLoadingUI","canvasRect","getBoundingClientRect","canvasPositioning","window","getComputedStyle","_loadingDiv","style","displayLoadingUI","document","createElement","opacity","transition","pointerEvents","display","gridTemplateRows","gridTemplateColumns","justifyItems","alignItems","_loadingTextDiv","marginTop","fontFamily","fontSize","textAlign","zIndex","innerHTML","appendChild","_style","getElementsByTagName","svgSupport","SVGSVGElement","imgBack","Image","DefaultLogoUrl","src","gridColumn","gridRow","transform","imageSpinnerContainer","imgSpinner","DefaultSpinnerUrl","animation","webkitAnimation","transformOrigin","webkitTransformOrigin","logoSize","w","h","loadingSize","addEventListener","backgroundColor","body","hideLoadingUI","parentElement","removeChild","removeEventListener","text","canvas","_BabylonLoaderRegistered","BabylonFileLoaderConfiguration","LoaderInjectedPhysicsEngine","tempIndexContainer","tempMaterialIndexContainer","parseMaterialByPredicate","predicate","materials","parsedMaterial","logOperation","operation","producer","file","version","exporter_version","loadDetailLevels","mastermesh","_waitingData","lods","ids","lodmeshes","wasenabled","distances","culling","lodid","lodmesh","getMeshById","addLODLevel","findParent","findMaterial","materialId","getLastMaterialById","loadAssetContainer","addToScene","JSON","parse","environmentTexture","isPBR","environmentTextureType","hdrSize","environmentTextureSize","hdrTexture","match","environmentTexturePrefilterOnLoad","environmentTextureRotationY","rotationY","endsWith","compressedTexture","environmentTextureForcedExtension","cubeTexture","createDefaultSkybox","skyboxScale","skyboxBlurLevel","environmentIntensity","reflectionProbes","parsedReflectionProbe","reflectionProbe","mat","getActiveTextures","t","multiMaterials","parsedMultiMaterial","mmat","morphTargetManagers","managerData","skeletons","parsedSkeleton","geometries","addedGeometry","vertexData","parsedVertexData","transformNodes","parsedTransformNode","node","parsedMesh","hasInstances","instances","instance","cameras","parsedCamera","postProcesses","parsedPostProcess","postProcess","animationGroups","parsedAnimationGroup","animationGroup","transformNode","multimat","_waitingSubMaterialsUniqueIds","subMaterial","subMaterials","_waitingMaterialId","_hasWaitingData","bone","_waitingTransformNodeId","linkTransformNode","currentMesh","freezeWorldMatrix","excludedIndex","excludedMesh","includedOnlyIndex","includedOnlyMesh","actions","err","msg","Log","removeAllFromScene","extensions","canDirectLoad","importMesh","meshesNames","particleSystems","fullDetails_1","isArray","hierarchyIds","loadedTransformNodes","loadedSkeletonsIds","loadedMaterialsIds","loadedMaterialsUniqueIds","loadedMorphTargetsIds","_loop_1","names","isDescendantOf","geometryId","found_1","geometryType","parsedGeometryData","materialUniqueId","materialArray_1","materialFound","loadSubMaterial_1","subMatId","multimatIndex","multimatCache","materialsUniqueIds","skeletonId","skeletonIndex","skeletonCache","morphTargetManagerId","morphTargetIndex","morphTargetCache","parsedMorphTarget","morphTarget","loadedTransformNodeIndex","loadedTransformNodes_1","parser","parsedParticleSystem","load","useDelayedTextureLoading","clearColor","ambientColor","gravity","fogMode","fogColor","fogStart","fogEnd","fogDensity","physicsEnabled","physicsPlugin","physicsEngine","physicsGravity","enablePhysics","metadata","collisionsEnabled","activeCameraID","setActiveCameraById","SceneLoaderAnimationGroupLoadingMode","SceneLoader","GetDefaultPlugin","_RegisteredPlugins","_GetPluginForExtension","extension","registeredPlugin","_GetPluginForDirectLoad","plugin","_GetPluginForFilename","sceneFilename","queryStringPosition","substring","dotPosition","lastIndexOf","toLowerCase","_GetDirectLoad","substr","_FormatErrorMessage","fileInfo","message","exception","errorMessage","url","_LoadData","onSuccess","onProgress","onDispose","pluginExtension","directLoad","createPlugin","OnPluginActivatedObservable","then","catch","error","useArrayBuffer","isBinary","dataCallback","responseURL","request","pluginDisposed","onDisposeObservable","abort","manifestChecked","errorCallback","statusText","fileOrUrl","loadFile","_loadFile","canUseOfflineSupport","enableOfflineSupport","exceptionFound","disableOfflineSupportExceptionRules","test","offlineProvider","disableManifestCheck","_GetFileInfo","sceneFile","startsWith","filename","GetPluginForExtension","IsPluginForExtensionAvailable","RegisterPlugin","extensions_1","keys","ImportMesh","meshNames","loadingToken","_addPendingData","disposeHandler","_removePendingData","errorHandler","progressHandler","event","e","successHandler","importedMeshesFiles","rewriteRootURL","syncedPlugin","loadingPluginName","importMeshAsync","ImportMeshAsync","reject","Error","Load","Append","LoadAsync","ShowLoadingScreen","_ShowingLoadingScreen","executeWhenReady","loadAsync","AppendAsync","LoadAssetContainer","assets","assetContainer","loadAssetContainerAsync","LoadAssetContainerAsync","ImportAnimations","overwriteAnimations","animationGroupLoadingMode","targetConverter","Clean","animatables","reset","stopAllAnimations","slice","getNodes","Stop","stop","Sync","restart","NoSync","startingIndexForNewAnimatables","mergeAnimationsTo","onAnimationFileImportedObservable","ImportAnimationsAsync","NO_LOGGING","MINIMAL_LOGGING","SUMMARY_LOGGING","DETAILED_LOGGING","SceneLoaderFlags","_ForceFullSceneLoadingForIncremental","_ShowLoadingScreen","_LoggingLevel","_CleanBoneMatrixWeights","BackgroundMaterialDefines","DIFFUSE","DIFFUSEDIRECTUV","GAMMADIFFUSE","DIFFUSEHASALPHA","OPACITYFRESNEL","REFLECTIONBLUR","REFLECTIONFRESNEL","REFLECTIONFALLOFF","TEXTURELODSUPPORT","PREMULTIPLYALPHA","USERGBCOLOR","USEHIGHLIGHTANDSHADOWCOLORS","BACKMAT_SHADOWONLY","NOISE","REFLECTIONBGR","IMAGEPROCESSING","VIGNETTE","VIGNETTEBLENDMODEMULTIPLY","VIGNETTEBLENDMODEOPAQUE","TONEMAPPING","TONEMAPPING_ACES","CONTRAST","COLORCURVES","COLORGRADING","COLORGRADING3D","SAMPLER3DGREENDEPTH","SAMPLER3DBGRMAP","IMAGEPROCESSINGPOSTPROCESS","SKIPFINALCOLORCLAMP","EXPOSURE","MULTIVIEW","REFLECTION","REFLECTIONMAP_3D","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_PLANAR","REFLECTIONMAP_CUBIC","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED","INVERTCUBICMAP","REFLECTIONMAP_OPPOSITEZ","LODINREFLECTIONALPHA","GAMMAREFLECTION","RGBDREFLECTION","EQUIRECTANGULAR_RELFECTION_FOV","MAINUV1","MAINUV2","UV1","UV2","CLIPPLANE","CLIPPLANE2","CLIPPLANE3","CLIPPLANE4","CLIPPLANE5","CLIPPLANE6","POINTSIZE","FOG","NORMAL","NUM_BONE_INFLUENCERS","BonesPerMesh","INSTANCES","SHADOWFLOAT","LOGARITHMICDEPTH","NONUNIFORMSCALING","ALPHATEST","BackgroundMaterial","primaryColor","_primaryColorShadowLevel","_primaryColorHighlightLevel","reflectionTexture","reflectionBlur","diffuseTexture","_shadowLights","shadowLights","shadowLevel","sceneCenter","opacityFresnel","reflectionFresnel","reflectionFalloffDistance","reflectionAmount","reflectionReflectance0","reflectionReflectance90","useRGBColor","enableNoise","_fovMultiplier","useEquirectangularFOV","_maxSimultaneousLights","maxSimultaneousLights","_shadowOnly","shadowOnly","_imageProcessingObserver","switchToBGR","_renderTargets","_reflectionControls","_white","_primaryShadowColor","_primaryHighlightColor","_attachImageProcessingConfiguration","getRenderTargetTextures","_diffuseTexture","isRenderTarget","_reflectionTexture","__perceptualColor","_computePrimaryColorFromPerceptualColor","_markAllSubMeshesAsLightsDirty","_computePrimaryColors","reflectionWeight","StandardReflectance0","StandardReflectance90","isNaN","configuration","_imageProcessingConfiguration","onUpdateParameters","imageProcessingConfiguration","_markAllSubMeshesAsImageProcessingDirty","_markAllSubMeshesAsTexturesDirty","colorCurvesEnabled","colorGradingEnabled","toneMappingEnabled","exposure","contrast","colorGradingTexture","colorCurves","needAlphaBlending","hasAlpha","isFrozen","_wasPreviouslyReady","materialDefines","_isReadyForSubMesh","_needNormals","_areTexturesDirty","_needUVs","texturesEnabled","textureLOD","isReadyOrNotBlocking","gammaSpace","_opacityFresnel","isRGBD","_reflectionBlur","lodLevelInAlpha","coordinatesMode","isCube","invertZ","_useRGBColor","_enableNoise","_areLightsDirty","_areImageProcessingDirty","pointsCloud","fogEnabled","_shouldTurnAlphaTestOn","standardDerivatives","createNormals","isDirty","markAsProcessed","addFallback","uniformBuffers","_materialContext","buildUniformLayout","_primaryColor","toLinearSpaceToRef","unbind","bindOnlyWorldMatrix","world","_activeEffect","mustRebind","_mustRebind","bindViewProjection","isSync","level","updateMatrix","getReflectionTextureMatrix","updateFloat3","lodGenerationScale","lodGenerationOffset","updateFloat","pointSize","_lodTextureMid","_lodTextureLow","_lodTextureHigh","bindEyePosition","needToAlwaysBindUniformBuffers","_needToBindSceneUbo","lightsEnabled","bindView","_afterBind","hasTexture","forceDisposeEffect","forceDisposeTextures","customType","source","CurrentScreenBlock","_samplerName","convertToGammaSpace","convertToLinearSpace","_isUnique","registerInput","registerOutput","_inputs","acceptedConnectionPointTypes","_prioritizeVertex","_outputs","initialize","state","_excludeVariableName","uv","isConnected","sourceBlock","isInput","nodeMaterial","setValue","_linearDefineName","_gammaDefineName","_injectVertexCode","uvInput","connectedPoint","ownerBlock","isAttribute","_emitUniformFromString","associatedVariableName","_mainUVName","_emitVaryingFromString","compilationString","some","isConnectedInVertexShader","_writeTextureRead","output","hasEndpoints","_writeOutput","vertexMode","_tempTextureRead","swizzle","_declareOutput","_buildBlock","_getFreeVariableName","sharedData","blockingBlocks","textureBlocks","blocksWithDefines","_emit2DSampler","isConnectedInFragmentShader","_getFreeDefineName","comments","_emitFunctionFromInclude","_deserialize","FogBlock","input","autoConfigure","view","viewInput","getInputBlockByPredicate","systemValue","setAsSystemValue","connectTo","fogColorInput","_fogParameters","bindableBlocks","removeUniforms","removeVaryings","removeIfDef","replaceStrings","search","replace","tempFogVariablename","_fogDistanceName","worldPos","worldPosition","LightBlock","cameraPosition","cameraPositionInput","needNormals","needRebuild","specularEnabled","_lightId","updateUniformsAndSamples","onlyUpdateBuffersList","counters","supportUniformBuffers","repeatKey","dynamicUniformBlocks","worldPosVaryingName","_emitCodeFromInclude","forcedBindableBlocks","_registerTempVariable","glossiness","glossPower","worldNormal","diffuseOutput","specularOutput","diffuseColor","specularColor","shadow","ImageSourceBlock","_texture","markAllMaterialsAsDirty","_dumpPropertiesCode","codeString","_codeVariableName","noMipmap","invertY","samplingMode","uAng","vAng","wAng","uOffset","vOffset","TextureBlock","fragmentOnly","_convertToGammaSpace","_convertToLinearSpace","disableLevelMultiplication","_fragmentOnly","_imageSource","samplerName","parentBlock","inputs","mode","getBlockByPredicate","attributeName_1","setAsAttribute","initializeDefines","_mainUVDefineName","toGamma","toLinear","_isMixed","isIdentityAs3x2","_defineName","_textureInfoName","_textureTransformName","toUpperCase","_transformedUVName","_generateTextureLookup","_generateConversionCode","complement","hasImageSource","ReflectionTextureBlock","writeOutputs","handleVertexSide","handleFragmentSideInits","normalWUnit","handleFragmentSideCodeReflectionCoords","handleFragmentSideCodeReflectionColor","_reflectionColorName","SceneDepthBlock","useNonLinearDepth","force32itsFloat","_getTexture","enableDepthRenderer","notifiers","activatePreviewCommand","callback","disableDepthRenderer","ClipPlanesBlock","useClipPlane1","useClipPlane2","useClipPlane3","useClipPlane4","useClipPlane5","useClipPlane6","ReflectionTextureBaseBlock","positionInput","worldInput","_define3DName","_defineLocalCubicName","boundingBoxSize","_defineExplicitName","_defineSkyboxName","_defineCubicName","_defineSphericalName","_definePlanarName","_defineProjectionName","_defineEquirectangularName","_defineEquirectangularFixedName","_defineMirroredEquirectangularFixedName","_reflectionMatrixName","_cubeSamplerName","_2DSamplerName","_reflectionPositionName","boundingBoxPosition","_reflectionSizeName","_defineOppositeZ","code","_positionUVWName","_directionWName","_samplerDeclaration","_emitFunction","_reflectionVectorName","_reflectionCoordsName","worldNormalVarName","onlyReflectionVector","doNotEmitInvertZ","reflectionMatrix","positionUVW","vEyePosition","lodVarName","swizzleLookupTexture","colorType","varName","forcedExtension","_prefiltered","TBNBlock","normal","isSystemValue","normalInput","tangent","tangentInput","normalAvailable","connectInputBlock","tangentAvailable","useTBNBlock","TBN","FragmentOutputBlock","useLogarithmicDepth","rgb","rgba","hints","aValue","checks","notConnectedNonOptionalInputs","ImageProcessingBlock","convertInputToLinearSpace","PerturbNormalBlock","_tangentSpaceParameterName","invertX","useParallaxOcclusion","normalSamplerName","normalMapColor","_ownerBlock","useParallax","viewDirection","parallaxHeight","_mirroredCameraPosition","strength","strengthInput","worldTangent","replaceForParallaxInfos","parallaxScale","isConnectedToInputBlock","isConstant","_emitFloat","replaceForBumpInfos","_emitExtension","tangentReplaceString","uvForPerturbNormal","DiscardBlock","cutoff","FrontFacingBlock","DerivativeBlock","_typeConnectionSource","dx","dy","FragCoordBlock","ScreenSizeBlock","_varName","ScreenSpaceBlock","worldViewProjection","worldViewProjectionInput","vector","worldViewProjectionName","tempVariableName","TwirlBlock","center","centerInput","offset","offsetInput","tempDelta","tempAngle","tempX","tempY","tempResult","AnimatedInputBlockTypes","remapAttributeName","position2d","particle_uv","particle_color","particle_texturemask","particle_positionw","attributeInFragmentOnly","attributeAsUniform","InputBlock","_mode","_animationType","isBoolean","matrixMode","_systemValue","groupInInspector","onValueChangedObservable","_type","setDefaultValue","isUniform","validateBlockName","newName","attributeName","_storedValue","_valueCallback","_associatedVariableName","animate","getAnimationRatio","_emitDefine","_emitConstant","_emit","constants","_constantDeclaration","_uniformDeclaration","_getGLType","needWorldViewMatrix","needWorldViewProjectionMatrix","animatedInputs","_vertexState","_attributeDeclaration","_transmitWorld","worldView","variableName","_transmit","getProjectionMatrix","setColor3","deltaTime","hasOriginBottomLeft","setInt","setDirectColor4","setVector2","setVector4","inputBlocks","codes","valueString","animationType","valueType","wellKnownValue","FromArray","AnisotropyBlock","_generateTBNSpace","worldPositionConnectionPoint","worldNormalConnectionPoint","getCode","generateTBNSpace","ClearCoatBlock","remapF0OnInterfaceChange","intensityInput","tintColor","tintThickness","tintAtDistance","indexOfRefraction","f0","eta","mainPBRBlock","clearcoat","endpoints","perturbedNormalBlock","perturbedNormal","worldPositionVarName","GetCode","ccBlock","reflectionBlock","worldPosVarName","vTBNAvailable","roughness","normalShading","_vReflectionMicrosurfaceInfosName","_vReflectionInfosName","reflectionColor"],"sourceRoot":""}