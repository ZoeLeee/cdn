"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8737],{62457:()=>{},49576:(e,t,r)=>{r.d(t,{I6:()=>B,LN:()=>b,Oz:()=>C});var n,i=r(31191),s=r(37290),o=r(72208),a=r(7949),u=r(73803),c=r(41364),h=r(13514),d=r(62897),l=r(71892),_=r(84318),p=r(61159),f=r(15210),m=r(57710),g=r(48743),E=r(73005),v=r(72759),T=r(46223),y=r(61319),x=new d.y$;"undefined"==typeof self||Object.prototype.hasOwnProperty.call(self,"_native")||Object.defineProperty(self,"_native",{get:function(){return n},set:function(e){(n=e)&&x.notifyObservers(n)}});function b(){return new Promise((function(e){"undefined"==typeof _native?x.addOnce((function(t){return e(t)})):e(_native)}))}function C(e,t){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(r){switch(r.label){case 0:return[4,b()];case 1:return r.sent()[e]=t,[2]}}))}))}var A=function(){function e(e){this.isAsync=!1,this.isReady=!1,this._valueCache={},this.engine=e}return e.prototype._getVertexShaderCode=function(){return null},e.prototype._getFragmentShaderCode=function(){return null},e.prototype._handlesSpectorRebuildCallback=function(e){throw new Error("Not implemented")},e.prototype._fillEffectInformation=function(e,t,r,n,i,s,o,a){var u,c=this.engine;if(c.supportsUniformBuffers)for(var h in t)e.bindUniformBlock(h,t[h]);for(this.engine.getUniforms(this,r).forEach((function(e,t){n[r[t]]=e})),this._uniforms=n,u=0;u<i.length;u++){null==e.getUniform(i[u])&&(i.splice(u,1),u--)}i.forEach((function(e,t){s[e]=t})),a.push.apply(a,c.getAttributes(this,o))},e.prototype.dispose=function(){this._uniforms={}},e.prototype._cacheMatrix=function(e,t){var r=this._valueCache[e],n=t.updateFlag;return(void 0===r||r!==n)&&(this._valueCache[e]=n,!0)},e.prototype._cacheFloat2=function(e,t,r){var n=this._valueCache[e];if(!n)return n=[t,r],this._valueCache[e]=n,!0;var i=!1;return n[0]!==t&&(n[0]=t,i=!0),n[1]!==r&&(n[1]=r,i=!0),i},e.prototype._cacheFloat3=function(e,t,r,n){var i=this._valueCache[e];if(!i)return i=[t,r,n],this._valueCache[e]=i,!0;var s=!1;return i[0]!==t&&(i[0]=t,s=!0),i[1]!==r&&(i[1]=r,s=!0),i[2]!==n&&(i[2]=n,s=!0),s},e.prototype._cacheFloat4=function(e,t,r,n,i){var s=this._valueCache[e];if(!s)return s=[t,r,n,i],this._valueCache[e]=s,!0;var o=!1;return s[0]!==t&&(s[0]=t,o=!0),s[1]!==r&&(s[1]=r,o=!0),s[2]!==n&&(s[2]=n,o=!0),s[3]!==i&&(s[3]=i,o=!0),o},e.prototype.setInt=function(e,t){var r=this._valueCache[e];void 0!==r&&r===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)},e.prototype.setInt2=function(e,t,r){this._cacheFloat2(e,t,r)&&(this.engine.setInt2(this._uniforms[e],t,r)||(this._valueCache[e]=null))},e.prototype.setInt3=function(e,t,r,n){this._cacheFloat3(e,t,r,n)&&(this.engine.setInt3(this._uniforms[e],t,r,n)||(this._valueCache[e]=null))},e.prototype.setInt4=function(e,t,r,n,i){this._cacheFloat4(e,t,r,n,i)&&(this.engine.setInt4(this._uniforms[e],t,r,n,i)||(this._valueCache[e]=null))},e.prototype.setIntArray=function(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)},e.prototype.setIntArray2=function(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)},e.prototype.setIntArray3=function(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)},e.prototype.setIntArray4=function(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)},e.prototype.setFloatArray=function(e,t){this._valueCache[e]=null,this.engine.setFloatArray(this._uniforms[e],t)},e.prototype.setFloatArray2=function(e,t){this._valueCache[e]=null,this.engine.setFloatArray2(this._uniforms[e],t)},e.prototype.setFloatArray3=function(e,t){this._valueCache[e]=null,this.engine.setFloatArray3(this._uniforms[e],t)},e.prototype.setFloatArray4=function(e,t){this._valueCache[e]=null,this.engine.setFloatArray4(this._uniforms[e],t)},e.prototype.setArray=function(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)},e.prototype.setArray2=function(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)},e.prototype.setArray3=function(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)},e.prototype.setArray4=function(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)},e.prototype.setMatrices=function(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))},e.prototype.setMatrix=function(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.toArray())||(this._valueCache[e]=null))},e.prototype.setMatrix3x3=function(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)},e.prototype.setMatrix2x2=function(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)},e.prototype.setFloat=function(e,t){var r=this._valueCache[e];void 0!==r&&r===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)},e.prototype.setBool=function(e,t){var r=this._valueCache[e];void 0!==r&&r===t||this.engine.setInt(this._uniforms[e],t?1:0)&&(this._valueCache[e]=t?1:0)},e.prototype.setVector2=function(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))},e.prototype.setFloat2=function(e,t,r){this._cacheFloat2(e,t,r)&&(this.engine.setFloat2(this._uniforms[e],t,r)||(this._valueCache[e]=null))},e.prototype.setVector3=function(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))},e.prototype.setFloat3=function(e,t,r,n){this._cacheFloat3(e,t,r,n)&&(this.engine.setFloat3(this._uniforms[e],t,r,n)||(this._valueCache[e]=null))},e.prototype.setVector4=function(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))},e.prototype.setQuaternion=function(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))},e.prototype.setFloat4=function(e,t,r,n,i){this._cacheFloat4(e,t,r,n,i)&&(this.engine.setFloat4(this._uniforms[e],t,r,n,i)||(this._valueCache[e]=null))},e.prototype.setColor3=function(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))},e.prototype.setColor4=function(e,t,r){this._cacheFloat4(e,t.r,t.g,t.b,r)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,r)||(this._valueCache[e]=null))},e.prototype.setDirectColor4=function(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))},e}(),R=function(e){function t(t,r,n,i){var s=e.call(this,t,r,n,i)||this;return s.__framebuffer=null,s.__framebufferDepthStencil=null,s._engine=i,s}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"_framebuffer",{get:function(){return this.__framebuffer},set:function(e){this.__framebuffer&&this._engine._releaseFramebufferObjects(this.__framebuffer),this.__framebuffer=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_framebufferDepthStencil",{get:function(){return this.__framebufferDepthStencil},set:function(e){this.__framebufferDepthStencil&&this._engine._releaseFramebufferObjects(this.__framebufferDepthStencil),this.__framebufferDepthStencil=e},enumerable:!1,configurable:!0}),t.prototype.dispose=function(t){void 0===t&&(t=!1),this._framebuffer=null,this._framebufferDepthStencil=null,e.prototype.dispose.call(this,t)},t}(E.r),S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.ZT)(t,e),t}(c.h),w=function(){function e(e){this._engine=e,this._pending=new Array,this._isCommandBufferScopeActive=!1,this._commandStream=B._createNativeDataStream(),this._engine.setCommandDataStream(this._commandStream)}return e.prototype.beginCommandScope=function(){if(this._isCommandBufferScopeActive)throw new Error("Command scope already active.");this._isCommandBufferScopeActive=!0},e.prototype.endCommandScope=function(){if(!this._isCommandBufferScopeActive)throw new Error("Command scope is not active.");this._isCommandBufferScopeActive=!1,this._submit()},e.prototype.startEncodingCommand=function(e){this._commandStream.writeNativeData(e)},e.prototype.encodeCommandArgAsUInt32=function(e){this._commandStream.writeUint32(e)},e.prototype.encodeCommandArgAsUInt32s=function(e){this._commandStream.writeUint32Array(e)},e.prototype.encodeCommandArgAsInt32=function(e){this._commandStream.writeInt32(e)},e.prototype.encodeCommandArgAsInt32s=function(e){this._commandStream.writeInt32Array(e)},e.prototype.encodeCommandArgAsFloat32=function(e){this._commandStream.writeFloat32(e)},e.prototype.encodeCommandArgAsFloat32s=function(e){this._commandStream.writeFloat32Array(e)},e.prototype.encodeCommandArgAsNativeData=function(e){this._commandStream.writeNativeData(e),this._pending.push(e)},e.prototype.finishEncodingCommand=function(){this._isCommandBufferScopeActive||this._submit()},e.prototype._submit=function(){this._engine.submitCommands(),this._pending.length=0},e}(),B=function(e){function t(r){void 0===r&&(r={});var n=e.call(this,null,!1,void 0,r.adaptToDeviceRatio)||this;if(n._engine=new _native.Engine,n._camera=_native.Camera?new _native.Camera:null,n._commandBufferEncoder=new w(n._engine),n._boundBuffersVertexArray=null,n._currentDepthTest=_native.Engine.DEPTH_TEST_LEQUAL,n._stencilTest=!1,n._stencilMask=255,n._stencilFunc=519,n._stencilFuncRef=0,n._stencilFuncMask=255,n._stencilOpStencilFail=7680,n._stencilOpDepthFail=7680,n._stencilOpStencilDepthPass=7681,n._zOffset=0,n._zOffsetUnits=0,n._depthWrite=!0,_native.Engine.PROTOCOL_VERSION!==t.PROTOCOL_VERSION)throw new Error("Protocol version mismatch: ".concat(_native.Engine.PROTOCOL_VERSION," (Native) !== ").concat(t.PROTOCOL_VERSION," (JS)"));n._webGLVersion=2,n.disableUniformBuffers=!0,n._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:_native.Engine.CAPS_LIMITS_MAX_TEXTURE_SIZE,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!0,astc:null,pvrtc:null,etc1:null,etc2:null,bptc:null,maxAnisotropy:16,uintIndices:!0,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!0,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!0,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!0,instancedArrays:!1,supportOcclusionQuery:!1,canUseTimestampForTimerQuery:!1,blendMinMax:!1,maxMSAASamples:1,canUseGLInstanceID:!0,canUseGLVertexID:!0,supportComputeShaders:!1,supportSRGBBuffers:!0,supportTransformFeedbacks:!1,textureMaxLevel:!1,texture2DArrayMaxLayerCount:_native.Engine.CAPS_LIMITS_MAX_TEXTURE_LAYERS},n._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:!1,supportDepthStencilTexture:!1,supportShadowSamplers:!1,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:!1,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:!1,basisNeedsPOT:!1,support3DTextures:!1,needTypeSuffixInShaderConstants:!1,supportMSAA:!1,supportSSAO2:!1,supportExtendedTextureFormats:!1,supportSwitchCaseInShader:!1,supportSyncTextureRead:!1,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!0,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!0,_collectUbosUpdatedInFrame:!1},h.w1.Log("Babylon Native (v"+s.D.Version+") launched"),h.w1.LoadScript=function(e,t,r,n){h.w1.LoadFile(e,(function(e){Function(e).apply(null),t&&t()}),void 0,void 0,!1,(function(e,t){r&&r("LoadScript Error",t)}))},"undefined"==typeof URL&&(window.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(window.Blob=function(e){return e});var i=window&&window.devicePixelRatio||1;n._hardwareScalingLevel=r.adaptToDeviceRatio?i:1,n.resize();var o=n.getDepthFunction();return o&&n.setDepthFunction(o),n._shaderProcessor=new g.C,n.onNewSceneAddedObservable.add((function(e){var t=e.render;e.render=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];n._commandBufferEncoder.beginCommandScope(),t.apply(e,r),n._commandBufferEncoder.endCommandScope()}})),n}return(0,i.ZT)(t,e),t.prototype.getHardwareScalingLevel=function(){return this._engine.getHardwareScalingLevel()},t.prototype.setHardwareScalingLevel=function(e){this._engine.setHardwareScalingLevel(e)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._boundBuffersVertexArray&&this._deleteVertexArray(this._boundBuffersVertexArray),this._engine.dispose()},t._createNativeDataStream=function(){return new v.e},t.prototype._queueNewFrame=function(e,t){return t.requestAnimationFrame&&t!==window?t.requestAnimationFrame(e):this._engine.requestAnimationFrame(e),0},t.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._currentFramebuffer&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_UNBINDFRAMEBUFFER),this._commandBufferEncoder.encodeCommandArgAsNativeData(this._currentFramebuffer),this._commandBufferEncoder.finishEncodingCommand()),e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_BINDFRAMEBUFFER),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.finishEncodingCommand()),this._currentFramebuffer=e)},t.prototype.getHostDocument=function(){return null},t.prototype.clear=function(e,t,r,n){if(void 0===n&&(n=!1),this.useReverseDepthBuffer)throw new Error("reverse depth buffer is not currently implemented");this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_CLEAR),this._commandBufferEncoder.encodeCommandArgAsUInt32(t&&e?1:0),this._commandBufferEncoder.encodeCommandArgAsFloat32(e?e.r:0),this._commandBufferEncoder.encodeCommandArgAsFloat32(e?e.g:0),this._commandBufferEncoder.encodeCommandArgAsFloat32(e?e.b:0),this._commandBufferEncoder.encodeCommandArgAsFloat32(e?e.a:1),this._commandBufferEncoder.encodeCommandArgAsUInt32(r?1:0),this._commandBufferEncoder.encodeCommandArgAsFloat32(1),this._commandBufferEncoder.encodeCommandArgAsUInt32(n?1:0),this._commandBufferEncoder.encodeCommandArgAsUInt32(0),this._commandBufferEncoder.finishEncodingCommand()},t.prototype.createIndexBuffer=function(e,t){var r=this._normalizeIndexData(e),n=new S;return n.references=1,n.is32Bits=4===r.BYTES_PER_ELEMENT,r.byteLength&&(n.nativeIndexBuffer=this._engine.createIndexBuffer(r.buffer,r.byteOffset,r.byteLength,n.is32Bits,null!=t&&t)),n},t.prototype.createVertexBuffer=function(e,t){var r=ArrayBuffer.isView(e)?e:new Float32Array(e),n=new S;return n.references=1,r.byteLength&&(n.nativeVertexBuffer=this._engine.createVertexBuffer(r.buffer,r.byteOffset,r.byteLength,null!=t&&t)),n},t.prototype._recordVertexArrayObject=function(e,t,r,n){r&&this._engine.recordIndexBuffer(e,r.nativeIndexBuffer);for(var i=n.getAttributesNames(),s=0;s<i.length;s++){var o=n.getAttributeLocation(s);if(o>=0){var a=t[i[s]];if(a){var u=a.getBuffer();u&&this._engine.recordVertexBuffer(e,u.nativeVertexBuffer,o,a.byteOffset,a.byteStride,a.getSize(),this._getNativeAttribType(a.type),a.normalized,a.getInstanceDivisor())}}}},t.prototype.bindBuffers=function(e,t,r){this._boundBuffersVertexArray&&this._deleteVertexArray(this._boundBuffersVertexArray),this._boundBuffersVertexArray=this._engine.createVertexArray(),this._recordVertexArrayObject(this._boundBuffersVertexArray,e,t,r),this.bindVertexArrayObject(this._boundBuffersVertexArray)},t.prototype.recordVertexArrayObject=function(e,t,r){var n=this._engine.createVertexArray();return this._recordVertexArrayObject(n,e,t,r),n},t.prototype._deleteVertexArray=function(e){this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DELETEVERTEXARRAY),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.finishEncodingCommand()},t.prototype.bindVertexArrayObject=function(e){this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_BINDVERTEXARRAY),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.finishEncodingCommand()},t.prototype.releaseVertexArrayObject=function(e){this._deleteVertexArray(e)},t.prototype.getAttributes=function(e,t){var r=e;return this._engine.getAttributes(r.nativeProgram,t)},t.prototype.drawElementsType=function(e,t,r,n){this._drawCalls.addCount(1,!1),this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DRAWINDEXED),this._commandBufferEncoder.encodeCommandArgAsUInt32(e),this._commandBufferEncoder.encodeCommandArgAsUInt32(t),this._commandBufferEncoder.encodeCommandArgAsUInt32(r),this._commandBufferEncoder.finishEncodingCommand()},t.prototype.drawArraysType=function(e,t,r,n){this._drawCalls.addCount(1,!1),this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DRAW),this._commandBufferEncoder.encodeCommandArgAsUInt32(e),this._commandBufferEncoder.encodeCommandArgAsUInt32(t),this._commandBufferEncoder.encodeCommandArgAsUInt32(r),this._commandBufferEncoder.finishEncodingCommand()},t.prototype.createPipelineContext=function(){return new A(this)},t.prototype.createMaterialContext=function(){},t.prototype.createDrawContext=function(){},t.prototype._preparePipelineContext=function(e,t,r,n,i,s,o,a,u){var c=e;c.nativeProgram=n?this.createRawShaderProgram(e,t,r,void 0,u):this.createShaderProgram(e,t,r,a,void 0,u)},t.prototype._isRenderingStateCompiled=function(e){return!0},t.prototype._executeWhenRenderingStateIsCompiled=function(e,t){t()},t.prototype.createRawShaderProgram=function(e,t,r,n,i){throw void 0===i&&(i=null),new Error("Not Supported")},t.prototype.createShaderProgram=function(e,t,r,n,i,s){void 0===s&&(s=null),this.onBeforeShaderCompilationObservable.notifyObservers(this);var o=new m.Z(t);o.processCode(),t=o.code;var a=new m.Z(r);a.processCode(),r=a.code,t=p.B._ConcatenateShader(t,n),r=p.B._ConcatenateShader(r,n);var u=this._engine.createProgram(t,r);return this.onAfterShaderCompilationObservable.notifyObservers(this),u},t.prototype.inlineShaderCode=function(e){var t=new m.Z(e);return t.debug=!1,t.processCode(),t.code},t.prototype._setProgram=function(e){this._currentProgram!==e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETPROGRAM),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.finishEncodingCommand(),this._currentProgram=e)},t.prototype._deletePipelineContext=function(e){var t=e;t&&t.nativeProgram&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DELETEPROGRAM),this._commandBufferEncoder.encodeCommandArgAsNativeData(t.nativeProgram),this._commandBufferEncoder.finishEncodingCommand())},t.prototype.getUniforms=function(e,t){var r=e;return this._engine.getUniforms(r.nativeProgram,t)},t.prototype.bindUniformBlock=function(e,t,r){throw new Error("Not Implemented")},t.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.nativeProgram);for(var r=e.getSamplers(),n=0;n<r.length;n++){var i=e.getUniform(r[n]);i&&(this._boundUniforms[n]=i)}this._currentEffect=null},t.prototype.setMatrix=function(e,t){if(e){var r=t.toArray();this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETMATRIX),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsFloat32s(r),this._commandBufferEncoder.finishEncodingCommand()}},t.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._engine.getRenderWidth()},t.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._engine.getRenderHeight()},t.prototype.setViewport=function(e,t,r){this._cachedViewport=e,this._engine.setViewPort(e.x,e.y,e.width,e.height)},t.prototype.setState=function(e,t,r,n,i,s,o){var a,u;void 0===t&&(t=0),void 0===n&&(n=!1),void 0===o&&(o=0),this._zOffset=t,this._zOffsetUnits=o,this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETSTATE),this._commandBufferEncoder.encodeCommandArgAsUInt32(e?1:0),this._commandBufferEncoder.encodeCommandArgAsFloat32(t),this._commandBufferEncoder.encodeCommandArgAsFloat32(o),this._commandBufferEncoder.encodeCommandArgAsUInt32(null===(u=null!==(a=this.cullBackFaces)&&void 0!==a?a:i)||void 0===u||u?1:0),this._commandBufferEncoder.encodeCommandArgAsUInt32(n?1:0),this._commandBufferEncoder.finishEncodingCommand()},t.prototype.getInputElementClientRect=function(){return{bottom:this.getRenderHeight(),height:this.getRenderHeight(),left:0,right:this.getRenderWidth(),top:0,width:this.getRenderWidth(),x:0,y:0,toJSON:function(){}}},t.prototype.setZOffset=function(e){e!==this._zOffset&&(this._zOffset=e,this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETZOFFSET),this._commandBufferEncoder.encodeCommandArgAsFloat32(this.useReverseDepthBuffer?-e:e),this._commandBufferEncoder.finishEncodingCommand())},t.prototype.getZOffset=function(){return this._zOffset},t.prototype.setZOffsetUnits=function(e){e!==this._zOffsetUnits&&(this._zOffsetUnits=e,this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETZOFFSETUNITS),this._commandBufferEncoder.encodeCommandArgAsFloat32(this.useReverseDepthBuffer?-e:e),this._commandBufferEncoder.finishEncodingCommand())},t.prototype.getZOffsetUnits=function(){return this._zOffsetUnits},t.prototype.setDepthBuffer=function(e){this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETDEPTHTEST),this._commandBufferEncoder.encodeCommandArgAsUInt32(e?this._currentDepthTest:_native.Engine.DEPTH_TEST_ALWAYS),this._commandBufferEncoder.finishEncodingCommand()},t.prototype.getDepthWrite=function(){return this._depthWrite},t.prototype.getDepthFunction=function(){switch(this._currentDepthTest){case _native.Engine.DEPTH_TEST_NEVER:return 512;case _native.Engine.DEPTH_TEST_ALWAYS:return 519;case _native.Engine.DEPTH_TEST_GREATER:return 516;case _native.Engine.DEPTH_TEST_GEQUAL:return 518;case _native.Engine.DEPTH_TEST_NOTEQUAL:return 517;case _native.Engine.DEPTH_TEST_EQUAL:return 514;case _native.Engine.DEPTH_TEST_LESS:return 513;case _native.Engine.DEPTH_TEST_LEQUAL:return 515}return null},t.prototype.setDepthFunction=function(e){var t=0;switch(e){case 512:t=_native.Engine.DEPTH_TEST_NEVER;break;case 519:t=_native.Engine.DEPTH_TEST_ALWAYS;break;case 516:t=_native.Engine.DEPTH_TEST_GREATER;break;case 518:t=_native.Engine.DEPTH_TEST_GEQUAL;break;case 517:t=_native.Engine.DEPTH_TEST_NOTEQUAL;break;case 514:t=_native.Engine.DEPTH_TEST_EQUAL;break;case 513:t=_native.Engine.DEPTH_TEST_LESS;break;case 515:t=_native.Engine.DEPTH_TEST_LEQUAL}this._currentDepthTest=t,this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETDEPTHTEST),this._commandBufferEncoder.encodeCommandArgAsUInt32(this._currentDepthTest),this._commandBufferEncoder.finishEncodingCommand()},t.prototype.setDepthWrite=function(e){this._depthWrite=e,this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETDEPTHWRITE),this._commandBufferEncoder.encodeCommandArgAsUInt32(Number(e)),this._commandBufferEncoder.finishEncodingCommand()},t.prototype.setColorWrite=function(e){this._colorWrite=e,this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETCOLORWRITE),this._commandBufferEncoder.encodeCommandArgAsUInt32(Number(e)),this._commandBufferEncoder.finishEncodingCommand()},t.prototype.getColorWrite=function(){return this._colorWrite},t.prototype.applyStencil=function(){this._setStencil(this._stencilMask,this._getStencilOpFail(this._stencilOpStencilFail),this._getStencilDepthFail(this._stencilOpDepthFail),this._getStencilDepthPass(this._stencilOpStencilDepthPass),this._getStencilFunc(this._stencilFunc),this._stencilFuncRef)},t.prototype._setStencil=function(e,t,r,n,i,s){this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETSTENCIL),this._commandBufferEncoder.encodeCommandArgAsUInt32(e),this._commandBufferEncoder.encodeCommandArgAsUInt32(t),this._commandBufferEncoder.encodeCommandArgAsUInt32(r),this._commandBufferEncoder.encodeCommandArgAsUInt32(n),this._commandBufferEncoder.encodeCommandArgAsUInt32(i),this._commandBufferEncoder.encodeCommandArgAsUInt32(s),this._commandBufferEncoder.finishEncodingCommand()},t.prototype.setStencilBuffer=function(e){this._stencilTest=e,e?this.applyStencil():this._setStencil(255,_native.Engine.STENCIL_OP_FAIL_S_KEEP,_native.Engine.STENCIL_OP_FAIL_Z_KEEP,_native.Engine.STENCIL_OP_PASS_Z_KEEP,_native.Engine.STENCIL_TEST_ALWAYS,0)},t.prototype.getStencilBuffer=function(){return this._stencilTest},t.prototype.getStencilOperationPass=function(){return this._stencilOpStencilDepthPass},t.prototype.setStencilOperationPass=function(e){this._stencilOpStencilDepthPass=e,this.applyStencil()},t.prototype.setStencilMask=function(e){this._stencilMask=e,this.applyStencil()},t.prototype.setStencilFunction=function(e){this._stencilFunc=e,this.applyStencil()},t.prototype.setStencilFunctionReference=function(e){this._stencilFuncRef=e,this.applyStencil()},t.prototype.setStencilFunctionMask=function(e){this._stencilFuncMask=e},t.prototype.setStencilOperationFail=function(e){this._stencilOpStencilFail=e,this.applyStencil()},t.prototype.setStencilOperationDepthFail=function(e){this._stencilOpDepthFail=e,this.applyStencil()},t.prototype.getStencilMask=function(){return this._stencilMask},t.prototype.getStencilFunction=function(){return this._stencilFunc},t.prototype.getStencilFunctionReference=function(){return this._stencilFuncRef},t.prototype.getStencilFunctionMask=function(){return this._stencilFuncMask},t.prototype.getStencilOperationFail=function(){return this._stencilOpStencilFail},t.prototype.getStencilOperationDepthFail=function(){return this._stencilOpDepthFail},t.prototype.setAlphaConstants=function(e,t,r,n){throw new Error("Setting alpha blend constant color not yet implemented.")},t.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e){var r=this._getNativeAlphaMode(e);this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETBLENDMODE),this._commandBufferEncoder.encodeCommandArgAsUInt32(r),this._commandBufferEncoder.finishEncodingCommand(),t||this.setDepthWrite(0===e),this._alphaMode=e}},t.prototype.getAlphaMode=function(){return this._alphaMode},t.prototype.setInt=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETINT),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsInt32(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setIntArray=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETINTARRAY),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsInt32s(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setIntArray2=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETINTARRAY2),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsInt32s(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setIntArray3=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETINTARRAY3),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsInt32s(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setIntArray4=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETINTARRAY4),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsInt32s(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setFloatArray=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOATARRAY),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsFloat32s(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setFloatArray2=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOATARRAY2),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsFloat32s(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setFloatArray3=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOATARRAY3),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsFloat32s(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setFloatArray4=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOATARRAY4),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsFloat32s(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setArray=function(e,t){return!!e&&this.setFloatArray(e,new Float32Array(t))},t.prototype.setArray2=function(e,t){return!!e&&this.setFloatArray2(e,new Float32Array(t))},t.prototype.setArray3=function(e,t){return!!e&&this.setFloatArray3(e,new Float32Array(t))},t.prototype.setArray4=function(e,t){return!!e&&this.setFloatArray4(e,new Float32Array(t))},t.prototype.setMatrices=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETMATRICES),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsFloat32s(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setMatrix3x3=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETMATRIX3X3),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsFloat32s(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setMatrix2x2=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETMATRIX2X2),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsFloat32s(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setFloat=function(e,t){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOAT),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsFloat32(t),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setFloat2=function(e,t,r){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOAT2),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsFloat32(t),this._commandBufferEncoder.encodeCommandArgAsFloat32(r),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setFloat3=function(e,t,r,n){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOAT3),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsFloat32(t),this._commandBufferEncoder.encodeCommandArgAsFloat32(r),this._commandBufferEncoder.encodeCommandArgAsFloat32(n),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setFloat4=function(e,t,r,n,i){return!!e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETFLOAT4),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsFloat32(t),this._commandBufferEncoder.encodeCommandArgAsFloat32(r),this._commandBufferEncoder.encodeCommandArgAsFloat32(n),this._commandBufferEncoder.encodeCommandArgAsFloat32(i),this._commandBufferEncoder.finishEncodingCommand(),!0)},t.prototype.setColor3=function(e,t){return!!e&&(this.setFloat3(e,t.r,t.g,t.b),!0)},t.prototype.setColor4=function(e,t,r){return!!e&&(this.setFloat4(e,t.r,t.g,t.b,r),!0)},t.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,e&&(this._currentProgram=null,this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},t.prototype._createTexture=function(){return this._engine.createTexture()},t.prototype._deleteTexture=function(e){e&&this._engine.deleteTexture(e)},t.prototype.updateDynamicTexture=function(e,t,r,n,i){if(void 0===n&&(n=!1),void 0===n&&(n=!1),e&&e._hardwareTexture){var s=t.getCanvasTexture(),o=e._hardwareTexture.underlyingResource;this._engine.copyTexture(o,s),e.isReady=!0}},t.prototype.createDynamicTexture=function(e,t,r,n){return e=Math.max(e,1),t=Math.max(t,1),this.createRawTexture(new Uint8Array(e*t*4),e,t,5,!1,!1,n)},t.prototype.createVideoElement=function(e){return this._camera?this._camera.createVideo(e):null},t.prototype.updateVideoTexture=function(e,t,r){if(e&&e._hardwareTexture&&this._camera){var n=e._hardwareTexture.underlyingResource;this._camera.updateVideoTexture(n,t,r)}},t.prototype.createRawTexture=function(e,t,r,n,i,s,o,u,c,h,d){void 0===u&&(u=null),void 0===c&&(c=0),void 0===h&&(h=0),void 0===d&&(d=!1);var l=new a.l(this,a.S.Raw);if(l.format=n,l.generateMipMaps=i,l.samplingMode=o,l.invertY=s,l.baseWidth=t,l.baseHeight=r,l.width=l.baseWidth,l.height=l.baseHeight,l._compression=u,l.type=c,l._useSRGBBuffer=this._getUseSRGBBuffer(d,!i),this.updateRawTexture(l,e,n,s,u,c,l._useSRGBBuffer),l._hardwareTexture){var _=l._hardwareTexture.underlyingResource,p=this._getNativeSamplingMode(o);this._setTextureSampling(_,p)}return this._internalTexturesCache.push(l),l},t.prototype.createRawTexture2DArray=function(e,t,r,n,i,s,o,u,c,h){void 0===c&&(c=null),void 0===h&&(h=0);var d=new a.l(this,a.S.Raw2DArray);if(d.baseWidth=t,d.baseHeight=r,d.baseDepth=n,d.width=t,d.height=r,d.depth=n,d.format=i,d.type=h,d.generateMipMaps=s,d.samplingMode=u,d.is2DArray=!0,d._hardwareTexture){var l=d._hardwareTexture.underlyingResource;this._engine.loadRawTexture2DArray(l,e,t,r,n,this._getNativeTextureFormat(i,h),s,o);var _=this._getNativeSamplingMode(u);this._setTextureSampling(l,_)}return d.isReady=!0,this._internalTexturesCache.push(d),d},t.prototype.updateRawTexture=function(e,t,r,n,i,s,o){if(void 0===i&&(i=null),void 0===s&&(s=0),void 0===o&&(o=!1),e){if(t&&e._hardwareTexture){var a=e._hardwareTexture.underlyingResource;this._engine.loadRawTexture(a,t,e.width,e.height,this._getNativeTextureFormat(r,s),e.generateMipMaps,e.invertY)}e.isReady=!0}},t.prototype.createTexture=function(e,t,r,n,i,o,u,c,d,l,p,m,g,E,v){var T=this;void 0===i&&(i=3),void 0===o&&(o=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===l&&(l=null),void 0===p&&(p=null),void 0===v&&(v=!1);var y="data:"===(e=e||"").substr(0,5),x=y&&-1!==e.indexOf(";base64,"),b=d||new a.l(this,a.S.Url),C=e;!this._transformTextureUrl||x||d||c||(e=this._transformTextureUrl(e));for(var A=e.lastIndexOf("."),R=p||(A>-1?e.substring(A).toLowerCase():""),S=null,w=0,B=s.D._TextureLoaders;w<B.length;w++){var F=B[w];if(F.canLoad(R)){S=F;break}}n&&n._addPendingData(b),b.url=e,b.generateMipMaps=!t,b.samplingMode=i,b.invertY=r,b._useSRGBBuffer=this._getUseSRGBBuffer(v,t),this.doNotHandleContextLost||(b._buffer=c);var P=null;o&&!d&&(P=b.onLoadedObservable.add(o)),d||this._internalTexturesCache.push(b);if(S)throw new Error("Loading textures from IInternalTextureLoader not yet implemented.");var M=function(e){if(b._hardwareTexture){var s=b._hardwareTexture.underlyingResource;T._engine.loadTexture(s,e,!t,r,v,(function(){b.baseWidth=T._engine.getTextureWidth(s),b.baseHeight=T._engine.getTextureHeight(s),b.width=b.baseWidth,b.height=b.baseHeight,b.isReady=!0;var e=T._getNativeSamplingMode(i);T._setTextureSampling(s,e),n&&n._removePendingData(b),b.onLoadedObservable.notifyObservers(b),b.onLoadedObservable.clear()}),(function(){throw new Error("Could not load a native texture.")}))}else n&&n._removePendingData(b)};if(y&&c)if(c instanceof ArrayBuffer)M(new Uint8Array(c));else if(ArrayBuffer.isView(c))M(c);else{if("string"!=typeof c)throw new Error("Unsupported buffer type");M(new Uint8Array(h.w1.DecodeBase64(c)))}else x?M(new Uint8Array(h.w1.DecodeBase64(e))):this._loadFile(e,(function(e){return M(new Uint8Array(e))}),void 0,void 0,!0,(function(r,s){!function(r,s){n&&n._removePendingData(b),e===C?(P&&b.onLoadedObservable.remove(P),f.l.UseFallbackTexture&&T.createTexture(f.l.FallbackTexture,t,b.invertY,n,i,null,u,c,b),u&&u((r||"Unknown error")+(f.l.UseFallbackTexture?" - Fallback texture was used":""),s)):(_.Y.Warn("Failed to load ".concat(e,", falling back to ").concat(C)),T.createTexture(C,t,b.invertY,n,i,o,u,c,b,l,p,m,g))}("Unable to load "+(r&&r.responseURL,s))}));return b},t.prototype.wrapNativeTexture=function(e){var t=new y.B(e,this._gl),r=new a.l(this,a.S.Unknown,!0);return r._hardwareTexture=t,r.isReady=!0,r},t.prototype.wrapWebGLTexture=function(){throw new Error("wrapWebGLTexture is not supported, use wrapNativeTexture instead.")},t.prototype._createDepthStencilTexture=function(e,t,r){var n=r,i=new a.l(this,a.S.DepthStencil),s=e.width||e,o=e.height||e,u=this._engine.createFrameBuffer(i._hardwareTexture.underlyingResource,s,o,_native.Engine.TEXTURE_FORMAT_RGBA8,!1,!0,!1);return n._framebufferDepthStencil=u,i},t.prototype._releaseFramebufferObjects=function(e){e&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DELETEFRAMEBUFFER),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.finishEncodingCommand())},t.prototype._createImageBitmapFromSource=function(e,t){var r=this;return new Promise((function(t,n){var i=r.createCanvasImage();i.onload=function(){try{var e=r._engine.createImageBitmap(i);t(e)}catch(e){n("Error loading image ".concat(i.src," with exception: ").concat(e))}},i.onerror=function(e){n("Error loading image ".concat(i.src," with exception: ").concat(e))},i.src=e}))},t.prototype.createImageBitmap=function(e,t){var r=this;return new Promise((function(t,n){if(Array.isArray(e)){var i=e;if(i.length){var s=r._engine.createImageBitmap(i[0]);if(s)return void t(s)}}n("Unsupported data for createImageBitmap.")}))},t.prototype.resizeImageBitmap=function(e,t,r){return this._engine.resizeImageBitmap(e,t,r)},t.prototype.createCubeTexture=function(e,t,r,n,i,s,o,c,d,_,p,f,m,g){var E=this;void 0===i&&(i=null),void 0===s&&(s=null),void 0===c&&(c=null),void 0===d&&(d=!1),void 0===_&&(_=0),void 0===p&&(p=0),void 0===f&&(f=null),void 0===g&&(g=!1);var v=f||new a.l(this,a.S.Cube);v.isCube=!0,v.url=e,v.generateMipMaps=!n,v._lodGenerationScale=_,v._lodGenerationOffset=p,this._doNotHandleContextLost||(v._extension=c,v._files=r);var T=e.lastIndexOf(".");if(".env"===(c||(T>-1?e.substring(T).toLowerCase():""))){if(r&&6===r.length)throw new Error("Multi-file loading not allowed on env files.");this._loadFile(e,(function(e){return function(e){var t=(0,l.qJ)(e);v.width=t.width,v.height=t.width,(0,l.qC)(v,t);var r=t.specular;if(!r)throw new Error("Nothing else parsed so far");v._lodGenerationScale=r.lodGenerationScale;var n=(0,l.Do)(e,t);v.format=5,v.type=0,v.generateMipMaps=!0,v.getEngine().updateTextureSamplingMode(u.x.TRILINEAR_SAMPLINGMODE,v),v._isRGBD=!0,v.invertY=!0,E._engine.loadCubeTextureWithMips(v._hardwareTexture.underlyingResource,n,!1,g,(function(){v.isReady=!0,i&&i()}),(function(){throw new Error("Could not load a native cube texture.")}))}(new Uint8Array(e))}),void 0,void 0,!0,(function(e,t){s&&e&&s(e.status+" "+e.statusText,t)}))}else{if(!r||6!==r.length)throw new Error("Cannot load cubemap because 6 files were not defined");var y=[r[0],r[3],r[1],r[4],r[2],r[5]];Promise.all(y.map((function(e){return h.w1.LoadFileAsync(e).then((function(e){return new Uint8Array(e)}))}))).then((function(e){return new Promise((function(t,r){E._engine.loadCubeTexture(v._hardwareTexture.underlyingResource,e,!n,!0,g,t,r)}))})).then((function(){v.isReady=!0,i&&i()}),(function(e){s&&s("Failed to load cubemap: ".concat(e.message),e)}))}return this._internalTexturesCache.push(v),v},t.prototype._createHardwareRenderTargetWrapper=function(e,t,r){var n=new R(e,t,r,this);return this._renderTargetWrapperCache.push(n),n},t.prototype.createRenderTargetTexture=function(e,t){var r=this._createHardwareRenderTargetWrapper(!1,!1,e),n={};void 0!==t&&"object"==typeof t?(n.generateMipMaps=t.generateMipMaps,n.generateDepthBuffer=void 0===t.generateDepthBuffer||t.generateDepthBuffer,n.generateStencilBuffer=n.generateDepthBuffer&&t.generateStencilBuffer,n.type=void 0===t.type?0:t.type,n.samplingMode=void 0===t.samplingMode?3:t.samplingMode,n.format=void 0===t.format?5:t.format):(n.generateMipMaps=t,n.generateDepthBuffer=!0,n.generateStencilBuffer=!1,n.type=0,n.samplingMode=3,n.format=5),(1!==n.type||this._caps.textureFloatLinearFiltering)&&(2!==n.type||this._caps.textureHalfFloatLinearFiltering)||(n.samplingMode=1);var i=new a.l(this,a.S.RenderTarget),s=e.width||e,o=e.height||e;1!==n.type||this._caps.textureFloat||(n.type=0,_.Y.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var u=this._engine.createFrameBuffer(i._hardwareTexture.underlyingResource,s,o,this._getNativeTextureFormat(n.format,n.type),!!n.generateStencilBuffer,n.generateDepthBuffer,!!n.generateMipMaps);return r._framebuffer=u,r._generateDepthBuffer=n.generateDepthBuffer,r._generateStencilBuffer=!!n.generateStencilBuffer,i.baseWidth=s,i.baseHeight=o,i.width=s,i.height=o,i.isReady=!0,i.samples=1,i.generateMipMaps=!!n.generateMipMaps,i.samplingMode=n.samplingMode,i.type=n.type,i.format=n.format,this._internalTexturesCache.push(i),r.setTextures(i),r},t.prototype.updateTextureSamplingMode=function(e,t){if(t._hardwareTexture){var r=this._getNativeSamplingMode(e);this._setTextureSampling(t._hardwareTexture.underlyingResource,r)}t.samplingMode=e},t.prototype.bindFramebuffer=function(e,t,r,n,i){var s=e;if(t)throw new Error("Cuboid frame buffers are not yet supported in NativeEngine.");if(r||n)throw new Error("Required width/height for frame buffers not yet supported in NativeEngine.");s._framebufferDepthStencil?this._bindUnboundFramebuffer(s._framebufferDepthStencil):this._bindUnboundFramebuffer(s._framebuffer)},t.prototype.unBindFramebuffer=function(e,t,r){void 0===t&&(t=!1),r&&r(),this._bindUnboundFramebuffer(null)},t.prototype.createDynamicVertexBuffer=function(e){return this.createVertexBuffer(e,!0)},t.prototype.updateDynamicIndexBuffer=function(e,t,r){void 0===r&&(r=0);var n=e,i=this._normalizeIndexData(t);n.is32Bits=4===i.BYTES_PER_ELEMENT,this._engine.updateDynamicIndexBuffer(n.nativeIndexBuffer,i.buffer,i.byteOffset,i.byteLength,r)},t.prototype.updateDynamicVertexBuffer=function(e,t,r,n){var i=e,s=ArrayBuffer.isView(t)?t:new Float32Array(t);this._engine.updateDynamicVertexBuffer(i.nativeVertexBuffer,s.buffer,s.byteOffset+(null!=r?r:0),null!=n?n:s.byteLength)},t.prototype._setTexture=function(e,t,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1);var i,s=this._boundUniforms[e];if(!s)return!1;if(!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._setTextureCore(s,null)),!1;if(t.video)this._activeChannel=e,t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;return i=n?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,this._activeChannel=e,!(!i||!i._hardwareTexture)&&(this._setTextureWrapMode(i._hardwareTexture.underlyingResource,this._getAddressMode(t.wrapU),this._getAddressMode(t.wrapV),this._getAddressMode(t.wrapR)),this._updateAnisotropicLevel(t),this._setTextureCore(s,i._hardwareTexture.underlyingResource),!0)},t.prototype._setTextureSampling=function(e,t){this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETTEXTURESAMPLING),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsUInt32(t),this._commandBufferEncoder.finishEncodingCommand()},t.prototype._setTextureWrapMode=function(e,t,r,n){this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETTEXTUREWRAPMODE),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsUInt32(t),this._commandBufferEncoder.encodeCommandArgAsUInt32(r),this._commandBufferEncoder.encodeCommandArgAsUInt32(n),this._commandBufferEncoder.finishEncodingCommand()},t.prototype._setTextureCore=function(e,t){this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETTEXTURE),this._commandBufferEncoder.encodeCommandArgAsNativeData(e),this._commandBufferEncoder.encodeCommandArgAsNativeData(t),this._commandBufferEncoder.finishEncodingCommand()},t.prototype._updateAnisotropicLevel=function(e){var t=e.getInternalTexture(),r=e.anisotropicFilteringLevel;t&&t._hardwareTexture&&t._cachedAnisotropicFilteringLevel!==r&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_SETTEXTUREANISOTROPICLEVEL),this._commandBufferEncoder.encodeCommandArgAsNativeData(t._hardwareTexture.underlyingResource),this._commandBufferEncoder.encodeCommandArgAsUInt32(r),this._commandBufferEncoder.finishEncodingCommand(),t._cachedAnisotropicFilteringLevel=r)},t.prototype._getAddressMode=function(e){switch(e){case 1:return _native.Engine.ADDRESS_MODE_WRAP;case 0:return _native.Engine.ADDRESS_MODE_CLAMP;case 2:return _native.Engine.ADDRESS_MODE_MIRROR;default:throw new Error("Unexpected wrap mode: "+e+".")}},t.prototype._bindTexture=function(e,t){var r=this._boundUniforms[e];if(r&&t&&t._hardwareTexture){var n=t._hardwareTexture.underlyingResource;this._setTextureCore(r,n)}},t.prototype._deleteBuffer=function(e){e.nativeIndexBuffer&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DELETEINDEXBUFFER),this._commandBufferEncoder.encodeCommandArgAsNativeData(e.nativeIndexBuffer),this._commandBufferEncoder.finishEncodingCommand(),delete e.nativeIndexBuffer),e.nativeVertexBuffer&&(this._commandBufferEncoder.startEncodingCommand(_native.Engine.COMMAND_DELETEVERTEXBUFFER),this._commandBufferEncoder.encodeCommandArgAsNativeData(e.nativeVertexBuffer),this._commandBufferEncoder.finishEncodingCommand(),delete e.nativeVertexBuffer)},t.prototype.createCanvas=function(e,t){if(!_native.Canvas)throw new Error("Native Canvas plugin not available.");var r=new _native.Canvas;return r.width=e,r.height=t,r},t.prototype.createCanvasImage=function(){if(!_native.Canvas)throw new Error("Native Canvas plugin not available.");return new _native.Image},t.prototype.updateTextureData=function(e,t,r,n,i,s,o,a,u){throw void 0===o&&(o=0),void 0===a&&(a=0),void 0===u&&(u=!1),new Error("updateTextureData not implemented.")},t.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,n,i,s,o){throw void 0===s&&(s=0),void 0===o&&(o=0),new Error("_uploadCompressedDataToTextureDirectly not implemented.")},t.prototype._uploadDataToTextureDirectly=function(e,t,r,n){throw void 0===r&&(r=0),void 0===n&&(n=0),new Error("_uploadDataToTextureDirectly not implemented.")},t.prototype._uploadArrayBufferViewToTexture=function(e,t,r,n){throw void 0===r&&(r=0),void 0===n&&(n=0),new Error("_uploadArrayBufferViewToTexture not implemented.")},t.prototype._uploadImageToTexture=function(e,t,r,n){throw void 0===r&&(r=0),void 0===n&&(n=0),new Error("_uploadArrayBufferViewToTexture not implemented.")},t.prototype._getNativeSamplingMode=function(e){switch(e){case 1:return _native.Engine.TEXTURE_NEAREST_NEAREST;case 2:return _native.Engine.TEXTURE_LINEAR_LINEAR;case 3:return _native.Engine.TEXTURE_LINEAR_LINEAR_MIPLINEAR;case 4:return _native.Engine.TEXTURE_NEAREST_NEAREST_MIPNEAREST;case 5:return _native.Engine.TEXTURE_NEAREST_LINEAR_MIPNEAREST;case 6:return _native.Engine.TEXTURE_NEAREST_LINEAR_MIPLINEAR;case 7:return _native.Engine.TEXTURE_NEAREST_LINEAR;case 8:return _native.Engine.TEXTURE_NEAREST_NEAREST_MIPLINEAR;case 9:return _native.Engine.TEXTURE_LINEAR_NEAREST_MIPNEAREST;case 10:return _native.Engine.TEXTURE_LINEAR_NEAREST_MIPLINEAR;case 11:return _native.Engine.TEXTURE_LINEAR_LINEAR_MIPNEAREST;case 12:return _native.Engine.TEXTURE_LINEAR_NEAREST;default:throw new Error("Unsupported sampling mode: ".concat(e,"."))}},t.prototype._getStencilFunc=function(e){switch(e){case 513:return _native.Engine.STENCIL_TEST_LESS;case 515:return _native.Engine.STENCIL_TEST_LEQUAL;case 514:return _native.Engine.STENCIL_TEST_EQUAL;case 518:return _native.Engine.STENCIL_TEST_GEQUAL;case 516:return _native.Engine.STENCIL_TEST_GREATER;case 517:return _native.Engine.STENCIL_TEST_NOTEQUAL;case 512:return _native.Engine.STENCIL_TEST_NEVER;case 519:return _native.Engine.STENCIL_TEST_ALWAYS;default:throw new Error("Unsupported stencil func mode: ".concat(e,"."))}},t.prototype._getStencilOpFail=function(e){switch(e){case 7680:return _native.Engine.STENCIL_OP_FAIL_S_KEEP;case 0:return _native.Engine.STENCIL_OP_FAIL_S_ZERO;case 7681:return _native.Engine.STENCIL_OP_FAIL_S_REPLACE;case 7682:return _native.Engine.STENCIL_OP_FAIL_S_INCR;case 7683:return _native.Engine.STENCIL_OP_FAIL_S_DECR;case 5386:return _native.Engine.STENCIL_OP_FAIL_S_INVERT;case 34055:return _native.Engine.STENCIL_OP_FAIL_S_INCRSAT;case 34056:return _native.Engine.STENCIL_OP_FAIL_S_DECRSAT;default:throw new Error("Unsupported stencil OpFail mode: ".concat(e,"."))}},t.prototype._getStencilDepthFail=function(e){switch(e){case 7680:return _native.Engine.STENCIL_OP_FAIL_Z_KEEP;case 0:return _native.Engine.STENCIL_OP_FAIL_Z_ZERO;case 7681:return _native.Engine.STENCIL_OP_FAIL_Z_REPLACE;case 7682:return _native.Engine.STENCIL_OP_FAIL_Z_INCR;case 7683:return _native.Engine.STENCIL_OP_FAIL_Z_DECR;case 5386:return _native.Engine.STENCIL_OP_FAIL_Z_INVERT;case 34055:return _native.Engine.STENCIL_OP_FAIL_Z_INCRSAT;case 34056:return _native.Engine.STENCIL_OP_FAIL_Z_DECRSAT;default:throw new Error("Unsupported stencil depthFail mode: ".concat(e,"."))}},t.prototype._getStencilDepthPass=function(e){switch(e){case 7680:return _native.Engine.STENCIL_OP_PASS_Z_KEEP;case 0:return _native.Engine.STENCIL_OP_PASS_Z_ZERO;case 7681:return _native.Engine.STENCIL_OP_PASS_Z_REPLACE;case 7682:return _native.Engine.STENCIL_OP_PASS_Z_INCR;case 7683:return _native.Engine.STENCIL_OP_PASS_Z_DECR;case 5386:return _native.Engine.STENCIL_OP_PASS_Z_INVERT;case 34055:return _native.Engine.STENCIL_OP_PASS_Z_INCRSAT;case 34056:return _native.Engine.STENCIL_OP_PASS_Z_DECRSAT;default:throw new Error("Unsupported stencil opPass mode: ".concat(e,"."))}},t.prototype._getNativeTextureFormat=function(e,t){if(4==e&&0==t)return _native.Engine.TEXTURE_FORMAT_RGB8;if(5==e&&0==t)return _native.Engine.TEXTURE_FORMAT_RGBA8;if(5==e&&1==t)return _native.Engine.TEXTURE_FORMAT_RGBA32F;throw new T.LH("Unsupported texture format or type: format ".concat(e,", type ").concat(t,"."),T.SM.UnsupportedTextureError)},t.prototype._getNativeAlphaMode=function(e){switch(e){case 0:return _native.Engine.ALPHA_DISABLE;case 1:return _native.Engine.ALPHA_ADD;case 2:return _native.Engine.ALPHA_COMBINE;case 3:return _native.Engine.ALPHA_SUBTRACT;case 4:return _native.Engine.ALPHA_MULTIPLY;case 5:return _native.Engine.ALPHA_MAXIMIZED;case 6:return _native.Engine.ALPHA_ONEONE;case 7:return _native.Engine.ALPHA_PREMULTIPLIED;case 8:return _native.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF;case 9:return _native.Engine.ALPHA_INTERPOLATE;case 10:return _native.Engine.ALPHA_SCREENMODE;default:throw new Error("Unsupported alpha mode: ".concat(e,"."))}},t.prototype._getNativeAttribType=function(e){switch(e){case o.o.BYTE:return _native.Engine.ATTRIB_TYPE_INT8;case o.o.UNSIGNED_BYTE:return _native.Engine.ATTRIB_TYPE_UINT8;case o.o.SHORT:return _native.Engine.ATTRIB_TYPE_INT16;case o.o.UNSIGNED_SHORT:return _native.Engine.ATTRIB_TYPE_UINT16;case o.o.FLOAT:return _native.Engine.ATTRIB_TYPE_FLOAT;default:throw new Error("Unsupported attribute type: ".concat(e,"."))}},t.prototype.getFontOffset=function(e){return{ascent:0,height:0,descent:0}},t.PROTOCOL_VERSION=6,t}(s.D)},79488:(e,t,r)=>{r.d(t,{S:()=>l,r:()=>d});var n=r(31191),i=r(84318),s=r(37290),o=r(7949),a=r(41364),u=r(20298),c=r(67759),h=r(73005),d=function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4},l=function(e){function t(t){void 0===t&&(t=new d);var r=e.call(this,null)||this;s.D.Instances.push(r),void 0===t.deterministicLockstep&&(t.deterministicLockstep=!1),void 0===t.lockstepMaxSteps&&(t.lockstepMaxSteps=4),r._options=t,u.Z.SetMatrixPrecision(!!t.useHighPrecisionMatrix),r._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:512,maxCubemapTextureSize:512,maxRenderTextureSize:512,maxVertexAttribs:16,maxVaryingVectors:16,maxFragmentUniformVectors:16,maxVertexUniformVectors:16,standardDerivatives:!1,astc:null,pvrtc:null,etc1:null,etc2:null,bptc:null,maxAnisotropy:0,uintIndices:!1,fragmentDepthSupported:!1,highPrecisionShaderSupported:!0,colorBufferFloat:!1,textureFloat:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloat:!1,textureHalfFloatLinearFiltering:!1,textureHalfFloatRender:!1,textureLOD:!1,drawBuffersExtension:!1,depthTextureExtension:!1,vertexArrayObject:!1,instancedArrays:!1,supportOcclusionQuery:!1,canUseTimestampForTimerQuery:!1,maxMSAASamples:1,blendMinMax:!1,canUseGLInstanceID:!1,canUseGLVertexID:!1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:!1,textureMaxLevel:!1,texture2DArrayMaxLayerCount:128},r._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:!1,supportDepthStencilTexture:!1,supportShadowSamplers:!1,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:!1,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:!1,basisNeedsPOT:!1,support3DTextures:!1,needTypeSuffixInShaderConstants:!1,supportMSAA:!1,supportSSAO2:!1,supportExtendedTextureFormats:!1,supportSwitchCaseInShader:!1,supportSyncTextureRead:!1,needsInvertingBitmap:!1,useUBOBindingCache:!1,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!0,_collectUbosUpdatedInFrame:!1},i.Y.Log("Babylon.js v".concat(s.D.Version," - Null engine"));var n="undefined"!=typeof self?self:"undefined"!=typeof global?global:window;return"undefined"==typeof URL&&(n.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(n.Blob=function(){}),r}return(0,n.ZT)(t,e),t.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},t.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},t.prototype.getHardwareScalingLevel=function(){return 1},t.prototype.createVertexBuffer=function(e){var t=new a.h;return t.references=1,t},t.prototype.createIndexBuffer=function(e){var t=new a.h;return t.references=1,t},t.prototype.clear=function(e,t,r,n){void 0===n&&(n=!1)},t.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},t.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},t.prototype.setViewport=function(e,t,r){this._cachedViewport=e},t.prototype.createShaderProgram=function(e,t,r,n,i){return{__SPECTOR_rebuildProgram:null}},t.prototype.getUniforms=function(e,t){return[]},t.prototype.getAttributes=function(e,t){return[]},t.prototype.bindSamplers=function(e){this._currentEffect=null},t.prototype.enableEffect=function(e){e=null!==e&&c.q.IsWrapper(e)?e.effect:e,this._currentEffect=e,e&&(e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},t.prototype.setState=function(e,t,r,n,i,s,o){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===o&&(o=0)},t.prototype.setIntArray=function(e,t){return!0},t.prototype.setIntArray2=function(e,t){return!0},t.prototype.setIntArray3=function(e,t){return!0},t.prototype.setIntArray4=function(e,t){return!0},t.prototype.setFloatArray=function(e,t){return!0},t.prototype.setFloatArray2=function(e,t){return!0},t.prototype.setFloatArray3=function(e,t){return!0},t.prototype.setFloatArray4=function(e,t){return!0},t.prototype.setArray=function(e,t){return!0},t.prototype.setArray2=function(e,t){return!0},t.prototype.setArray3=function(e,t){return!0},t.prototype.setArray4=function(e,t){return!0},t.prototype.setMatrices=function(e,t){return!0},t.prototype.setMatrix3x3=function(e,t){return!0},t.prototype.setMatrix2x2=function(e,t){return!0},t.prototype.setFloat=function(e,t){return!0},t.prototype.setFloat2=function(e,t,r){return!0},t.prototype.setFloat3=function(e,t,r,n){return!0},t.prototype.setBool=function(e,t){return!0},t.prototype.setFloat4=function(e,t,r,n,i){return!0},t.prototype.setAlphaMode=function(e,t){void 0===t&&(t=!1),this._alphaMode!==e&&(this.alphaState.alphaBlend=0!==e,t||this.setDepthWrite(0===e),this._alphaMode=e)},t.prototype.bindBuffers=function(e,t,r){},t.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,e&&(this._currentProgram=null,this._stencilStateComposer.reset(),this.depthCullingState.reset(),this.alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},t.prototype.draw=function(e,t,r,n){},t.prototype.drawElementsType=function(e,t,r,n){},t.prototype.drawArraysType=function(e,t,r,n){},t.prototype._createTexture=function(){return{}},t.prototype._releaseTexture=function(e){},t.prototype.createTexture=function(e,t,r,n,i,s,a,u,c,h,d,l){void 0===i&&(i=3),void 0===s&&(s=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===h&&(h=null),void 0===d&&(d=null);var _=new o.l(this,o.S.Url),p=String(e);return _.url=p,_.generateMipMaps=!t,_.samplingMode=i,_.invertY=r,_.baseWidth=this._options.textureSize,_.baseHeight=this._options.textureSize,_.width=this._options.textureSize,_.height=this._options.textureSize,h&&(_.format=h),_.isReady=!0,s&&setTimeout((function(){s()})),this._internalTexturesCache.push(_),_},t.prototype._createHardwareRenderTargetWrapper=function(e,t,r){var n=new h.r(e,t,r,this);return this._renderTargetWrapperCache.push(n),n},t.prototype.createRenderTargetTexture=function(e,t){var r=this._createHardwareRenderTargetWrapper(!1,!1,e),n={};void 0!==t&&"object"==typeof t?(n.generateMipMaps=t.generateMipMaps,n.generateDepthBuffer=void 0===t.generateDepthBuffer||t.generateDepthBuffer,n.generateStencilBuffer=n.generateDepthBuffer&&t.generateStencilBuffer,n.type=void 0===t.type?0:t.type,n.samplingMode=void 0===t.samplingMode?3:t.samplingMode):(n.generateMipMaps=t,n.generateDepthBuffer=!0,n.generateStencilBuffer=!1,n.type=0,n.samplingMode=3);var i=new o.l(this,o.S.RenderTarget),s=e.width||e,a=e.height||e;return r._generateDepthBuffer=n.generateDepthBuffer,r._generateStencilBuffer=!!n.generateStencilBuffer,i.baseWidth=s,i.baseHeight=a,i.width=s,i.height=a,i.isReady=!0,i.samples=1,i.generateMipMaps=!!n.generateMipMaps,i.samplingMode=n.samplingMode,i.type=n.type,this._internalTexturesCache.push(i),r},t.prototype.updateTextureSamplingMode=function(e,t){t.samplingMode=e},t.prototype.createRawTexture=function(e,t,r,n,i,s,a,u,c,h,d){void 0===u&&(u=null),void 0===c&&(c=0),void 0===h&&(h=0),void 0===d&&(d=!1);var l=new o.l(this,o.S.Raw);return l.baseWidth=t,l.baseHeight=r,l.width=t,l.height=r,l.format=n,l.generateMipMaps=i,l.samplingMode=a,l.invertY=s,l._compression=u,l.type=c,l._useSRGBBuffer=d,this._doNotHandleContextLost||(l._bufferView=e),l},t.prototype.updateRawTexture=function(e,t,r,n,i,s,o){void 0===i&&(i=null),void 0===s&&(s=0),void 0===o&&(o=!1),e&&(e._bufferView=t,e.format=r,e.invertY=n,e._compression=i,e.type=s,e._useSRGBBuffer=o)},t.prototype.bindFramebuffer=function(e,t,r,n,i){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._currentFramebuffer=null,this._cachedViewport&&!i&&this.setViewport(this._cachedViewport,r,n)},t.prototype.unBindFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null,r&&r(),this._currentFramebuffer=null},t.prototype.createDynamicVertexBuffer=function(e){var t=new a.h;return t.references=1,t.capacity=1,t},t.prototype.updateDynamicTexture=function(e,t,r,n,i){void 0===n&&(n=!1)},t.prototype.areAllEffectsReady=function(){return!0},t.prototype.getError=function(){return 0},t.prototype._getUnpackAlignement=function(){return 1},t.prototype._unpackFlipY=function(e){},t.prototype.updateDynamicIndexBuffer=function(e,t,r){void 0===r&&(r=0)},t.prototype.updateDynamicVertexBuffer=function(e,t,r,n){},t.prototype._bindTextureDirectly=function(e,t){return this._boundTexturesCache[this._activeChannel]!==t&&(this._boundTexturesCache[this._activeChannel]=t,!0)},t.prototype._bindTexture=function(e,t){e<0||this._bindTextureDirectly(0,t)},t.prototype._deleteBuffer=function(e){},t.prototype.releaseEffects=function(){},t.prototype.displayLoadingUI=function(){},t.prototype.hideLoadingUI=function(){},Object.defineProperty(t.prototype,"loadingUIText",{set:function(e){},enumerable:!1,configurable:!0}),t.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,n,i,s,o){void 0===s&&(s=0),void 0===o&&(o=0)},t.prototype._uploadDataToTextureDirectly=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0)},t.prototype._uploadArrayBufferViewToTexture=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0)},t.prototype._uploadImageToTexture=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0)},t}(s.D)},20298:(e,t,r)=>{r.d(t,{Z:()=>n});var n=function(){function e(){}return e.SetMatrixPrecision=function(t){if(e.MatrixTrackPrecisionChange=!1,t&&!e.MatrixUse64Bits&&e.MatrixTrackedMatrices)for(var r=0;r<e.MatrixTrackedMatrices.length;++r){var n=e.MatrixTrackedMatrices[r],i=n._m;n._m=new Array(16);for(var s=0;s<16;++s)n._m[s]=i[s]}e.MatrixUse64Bits=t,e.MatrixCurrentType=e.MatrixUse64Bits?Array:Float32Array,e.MatrixTrackedMatrices=null},e.MatrixUse64Bits=!1,e.MatrixTrackPrecisionChange=!0,e.MatrixCurrentType=Float32Array,e.MatrixTrackedMatrices=[],e}()},73005:(e,t,r)=>{r.d(t,{r:()=>i});var n=r(7949),i=function(){function e(e,t,r,n){this._textures=null,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=e,this._isCube=t,this._size=r,this._engine=n,this._depthStencilTexture=null}return Object.defineProperty(e.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthStencilTextureWithStencil",{get:function(){return this._depthStencilTextureWithStencil},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCube",{get:function(){return this._isCube},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMulti",{get:function(){return this._isMulti},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"is2DArray",{get:function(){return this.layers>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._size.width||this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._size.height||this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layers",{get:function(){return this._size.layers||0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){var e,t;return null!==(t=null===(e=this._textures)||void 0===e?void 0:e[0])&&void 0!==t?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textures",{get:function(){return this._textures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"samples",{get:function(){var e,t;return null!==(t=null===(e=this.texture)||void 0===e?void 0:e.samples)&&void 0!==t?t:1},enumerable:!1,configurable:!0}),e.prototype.setSamples=function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=!1),this.samples!==e||r?this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,e,t):this._engine.updateRenderTargetTextureSampleCount(this,e):e},e.prototype.setTextures=function(e){Array.isArray(e)?this._textures=e:this._textures=e?[e]:null},e.prototype.setTexture=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=!0),this._textures||(this._textures=[]),this._textures[t]&&r&&this._textures[t].dispose(),this._textures[t]=e},e.prototype.createDepthStencilTexture=function(e,t,r,n,i){var s;return void 0===e&&(e=0),void 0===t&&(t=!0),void 0===r&&(r=!1),void 0===n&&(n=1),void 0===i&&(i=14),null===(s=this._depthStencilTexture)||void 0===s||s.dispose(),this._depthStencilTextureWithStencil=r,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:r,isCube:this._isCube,samples:n,depthTextureFormat:i},this),this._depthStencilTexture},e.prototype._shareDepth=function(e){this._depthStencilTexture&&(e._depthStencilTexture&&e._depthStencilTexture.dispose(),e._depthStencilTexture=this._depthStencilTexture,this._depthStencilTexture.incrementReferences())},e.prototype._swapAndDie=function(e){this.texture&&this.texture._swapAndDie(e),this._textures=null,this.dispose(!0)},e.prototype._cloneRenderTargetWrapper=function(){var e,t,r,i,s,o,a=null;if(this._isMulti){var u=this.textures;if(u&&u.length>0){var c=!1,h=u.length,d=u[u.length-1]._source;d!==n.S.Depth&&d!==n.S.DepthStencil||(c=!0,h--);for(var l=[],_=[],p=0;p<h;++p){var f=u[p];l.push(f.samplingMode),_.push(f.type)}var m={samplingModes:l,generateMipMaps:u[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:c,types:_,textureCount:h},g={width:this.width,height:this.height};a=this._engine.createMultipleRenderTarget(g,m)}}else{var E={};if(E.generateDepthBuffer=this._generateDepthBuffer,E.generateMipMaps=null!==(t=null===(e=this.texture)||void 0===e?void 0:e.generateMipMaps)&&void 0!==t&&t,E.generateStencilBuffer=this._generateStencilBuffer,E.samplingMode=null===(r=this.texture)||void 0===r?void 0:r.samplingMode,E.type=null===(i=this.texture)||void 0===i?void 0:i.type,E.format=null===(s=this.texture)||void 0===s?void 0:s.format,this.isCube)a=this._engine.createRenderTargetCubeTexture(this.width,E);else{g={width:this.width,height:this.height,layers:this.is2DArray?null===(o=this.texture)||void 0===o?void 0:o.depth:void 0};a=this._engine.createRenderTargetTexture(g,E)}a.texture.isReady=!0}return a},e.prototype._swapRenderTargetWrapper=function(e){if(this._textures&&e._textures)for(var t=0;t<this._textures.length;++t)this._textures[t]._swapAndDie(e._textures[t],!1),e._textures[t].isReady=!0;this._depthStencilTexture&&e._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(e._depthStencilTexture),e._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null},e.prototype._rebuild=function(){var e=this._cloneRenderTargetWrapper();if(e){if(this._depthStencilTexture){var t=this._depthStencilTexture.samplingMode,r=2===t||3===t||11===t;e.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,r,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples)}this.samples>1&&e.setSamples(this.samples),e._swapRenderTargetWrapper(this),e.dispose()}},e.prototype.releaseTextures=function(){var e,t;if(this._textures)for(var r=0;null!==(t=r<(null===(e=this._textures)||void 0===e?void 0:e.length))&&void 0!==t&&t;++r)this._textures[r].dispose();this._textures=null},e.prototype.dispose=function(e){var t;void 0===e&&(e=!1),e||(null===(t=this._depthStencilTexture)||void 0===t||t.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)},e}()},69543:(e,t,r)=>{r.d(t,{v:()=>i});var n=r(41659),i=function(){function e(){}return e.GetShadersRepository=function(t){return void 0===t&&(t=n.x.GLSL),t===n.x.GLSL?e.ShadersRepository:e.ShadersRepositoryWGSL},e.GetShadersStore=function(t){return void 0===t&&(t=n.x.GLSL),t===n.x.GLSL?e.ShadersStore:e.ShadersStoreWGSL},e.GetIncludesShadersStore=function(t){return void 0===t&&(t=n.x.GLSL),t===n.x.GLSL?e.IncludesShadersStore:e.IncludesShadersStoreWGSL},e.ShadersRepository="src/Shaders/",e.ShadersStore={},e.IncludesShadersStore={},e.ShadersRepositoryWGSL="src/ShadersWGSL/",e.ShadersStoreWGSL={},e.IncludesShadersStoreWGSL={},e}()},61159:(e,t,r)=>{r.d(t,{B:()=>C});var n=r(31191),i=r(15210),s=r(9256),o=r(77851),a=r(62897),u=r(29507),c=r(40185),h=r(88405),d=r(7949),l=r(84318),_=r(80352),p=r(98619),f=r(48743),m=r(21254),g=r(86830),E=r(20298),v=r(61319),T=r(67759),y=r(61625),x=r(41659),b=function(){},C=function(){function e(t,r,n,i){var s=this;this._name="WebGL",this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=null,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this.disableUniformBuffers=!1,this.onDisposeObservable=new a.y$,this._frameId=0,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new a.y$,this.onContextRestoredObservable=new a.y$,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new u.k,this._stencilStateComposer=new y.C,this._stencilState=new c.s,this._alphaState=new h.Q,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._renderTargetWrapperCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._activeRequests=new Array,this._adaptToDeviceRatio=!1,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new a.y$,this._isWebGPU=!1,this._snapshotRenderingMode=0,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={};var o=null;if(n=n||{},this._creationOptions=n,this._adaptToDeviceRatio=null!=i&&i,this._stencilStateComposer.stencilGlobal=this._stencilState,E.Z.SetMatrixPrecision(!!n.useHighPrecisionMatrix),t){if(i=i||n.adaptToDeviceRatio||!1,t.getContext){if(o=t,this._renderingCanvas=o,void 0!==r&&(n.antialias=r),void 0===n.deterministicLockstep&&(n.deterministicLockstep=!1),void 0===n.lockstepMaxSteps&&(n.lockstepMaxSteps=4),void 0===n.timeStep&&(n.timeStep=1/60),void 0===n.preserveDrawingBuffer&&(n.preserveDrawingBuffer=!1),void 0===n.audioEngine&&(n.audioEngine=!0),void 0!==n.audioEngineOptions&&void 0!==n.audioEngineOptions.audioContext&&(this._audioContext=n.audioEngineOptions.audioContext),void 0!==n.audioEngineOptions&&void 0!==n.audioEngineOptions.audioDestination&&(this._audioDestination=n.audioEngineOptions.audioDestination),void 0===n.stencil&&(n.stencil=!0),!1===n.premultipliedAlpha&&(this.premultipliedAlpha=!1),void 0===n.xrCompatible&&(n.xrCompatible=!0),this._doNotHandleContextLost=!!n.doNotHandleContextLost,navigator&&navigator.userAgent){this._checkForMobile=function(){var e=navigator.userAgent;s.hostInformation.isMobile=-1!==e.indexOf("Mobile")||-1!==e.indexOf("Mac")&&(0,_.n5)()&&"ontouchend"in document},this._checkForMobile(),(0,_.CG)()&&window.addEventListener("resize",this._checkForMobile);for(var d=navigator.userAgent,m=0,g=e.ExceptionList;m<g.length;m++){var v=g[m],T=v.key,x=v.targets;if(new RegExp(T).test(d)){if(v.capture&&v.captureConstraint){var C=v.capture,A=v.captureConstraint,R=new RegExp(C).exec(d);if(R&&R.length>0)if(parseInt(R[R.length-1])>=A)continue}for(var S=0,w=x;S<w.length;S++){switch(w[S]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":n.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),s._contextWasLost=!0,l.Y.Warn("WebGL context lost."),s.onContextLostObservable.notifyObservers(s)},this._onContextRestored=function(){s._restoreEngineAfterContextLost(s._initGLContext.bind(s))},o.addEventListener("webglcontextlost",this._onContextLost,!1),o.addEventListener("webglcontextrestored",this._onContextRestored,!1),n.powerPreference="high-performance"),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._badDesktopOS&&(n.xrCompatible=!1),!n.disableWebGL2Support)try{this._gl=o.getContext("webgl2",n)||o.getContext("experimental-webgl2",n),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(e){}if(!this._gl){if(!o)throw new Error("The provided canvas is null or undefined.");try{this._gl=o.getContext("webgl",n)||o.getContext("experimental-webgl",n)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";var B=this._gl.getContextAttributes();B&&(n.stencil=B.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==n.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=n.useHighPrecisionFloats);var F=(0,_.CG)()&&window.devicePixelRatio||1,P=n.limitDeviceRatio||F;this._hardwareScalingLevel=i?1/Math.min(P,F):1,this.resize(),this._isStencilEnable=!!n.stencil,this._initGLContext(),this._initFeatures();for(var M=0;M<this._caps.maxVertexAttribs;M++)this._currentBufferPointers[M]=new b;this._shaderProcessor=this.webGLVersion>1?new f.C:new p.f,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent);var L="Babylon.js v".concat(e.Version);this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",L)}}return Object.defineProperty(e,"NpmPackage",{get:function(){return"babylonjs@5.11.0"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return"5.11.0"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){var e=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ShadersRepository",{get:function(){return s.Q.ShadersRepository},set:function(e){s.Q.ShadersRepository=e},enumerable:!1,configurable:!0}),e.prototype._getShaderProcessor=function(e){return this._shaderProcessor},Object.defineProperty(e.prototype,"useReverseDepthBuffer",{get:function(){return this._useReverseDepthBuffer},set:function(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,this._depthCullingState.depthFunc=e?518:515)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameId",{get:function(){return this._frameId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),e.prototype.getCreationOptions=function(){return this._creationOptions},Object.defineProperty(e.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeRenderLoops",{get:function(){return this._activeRenderLoops},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isWebGPU",{get:function(){return this._isWebGPU},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shaderPlatformName",{get:function(){return this._shaderPlatformName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"snapshotRendering",{get:function(){return!1},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"snapshotRenderingMode",{get:function(){return this._snapshotRenderingMode},set:function(e){this._snapshotRenderingMode=e},enumerable:!1,configurable:!0}),e.prototype.snapshotRenderingReset=function(){this.snapshotRendering=!1},e._CreateCanvas=function(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);var r=document.createElement("canvas");return r.width=e,r.height=t,r},e.prototype.createCanvas=function(t,r){return e._CreateCanvas(t,r)},e.prototype.createCanvasImage=function(){return document.createElement("img")},e.prototype._restoreEngineAfterContextLost=function(e){var t=this;setTimeout((function(){return(0,n.mG)(t,void 0,void 0,(function(){var t,r,i,s,o;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:return this._dummyFramebuffer=null,t=this._depthCullingState.depthTest,r=this._depthCullingState.depthFunc,i=this._depthCullingState.depthMask,s=this._stencilState.stencilTest,[4,e()];case 1:return n.sent(),this._rebuildEffects(),null===(o=this._rebuildComputeEffects)||void 0===o||o.call(this),this._rebuildInternalTextures(),this._rebuildRenderTargetWrappers(),this._rebuildBuffers(),this.wipeCaches(!0),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=r,this._depthCullingState.depthMask=i,this._stencilState.stencilTest=s,l.Y.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1,[2]}}))}))}),0)},e.prototype._sharedInit=function(e,t,r){this._renderingCanvas=e},e.prototype._getShaderProcessingContext=function(e){return null},e.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++){t[e]._rebuild()}},e.prototype._rebuildRenderTargetWrappers=function(){for(var e=0,t=this._renderTargetWrapperCache.slice();e<t.length;e++){t[e]._rebuild()}},e.prototype._rebuildEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e];t._pipelineContext=null,t._wasPreviouslyReady=!1,t._prepareEffect()}s.Q.ResetCache()},e.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects){if(!this._compiledEffects[e].isReady())return!1}return!0},e.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++){t[e]._rebuild()}for(var r=0,n=this._storageBuffers;r<n.length;r++){n[r]._rebuild()}},e.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?256:128},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var r=0;r<16;r++)this._gl["COLOR_ATTACHMENT"+r+"_WEBGL"]=t["COLOR_ATTACHMENT"+r+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var n=this._gl.getExtension("WEBGL_depth_texture");null!=n&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=n.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var i=this._gl.getExtension("OES_vertex_array_object");null!=i&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=i.createVertexArrayOES.bind(i),this._gl.bindVertexArray=i.bindVertexArrayOES.bind(i),this._gl.deleteVertexArray=i.deleteVertexArrayOES.bind(i))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var s=this._gl.getExtension("ANGLE_instanced_arrays");null!=s?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=s.drawArraysInstancedANGLE.bind(s),this._gl.drawElementsInstanced=s.drawElementsInstancedANGLE.bind(s),this._gl.vertexAttribDivisor=s.vertexAttribDivisorANGLE.bind(s)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var o=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),a=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);o&&a&&(this._caps.highPrecisionShaderSupported=0!==o.precision&&0!==a.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var u=this._gl.getExtension("EXT_blend_minmax");null!=u&&(this._caps.blendMinMax=!0,this._gl.MAX=u.MAX_EXT,this._gl.MIN=u.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0;else{var c=this._gl.getExtension("EXT_sRGB");null!=c&&(this._caps.supportSRGBBuffers=!0,this._gl.SRGB=c.SRGB_EXT,this._gl.SRGB8=c.SRGB_ALPHA_EXT,this._gl.SRGB8_ALPHA8=c.SRGB_ALPHA_EXT)}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!(!this._creationOptions||!this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var h=0;h<this._maxSimultaneousTextures;h++)this._nextFreeTextureSlots.push(h)},e.prototype._initFeatures=function(){this._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,_collectUbosUpdatedInFrame:!1}},Object.defineProperty(e.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(e.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),e.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=this.createCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},e.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},e.prototype.getInfo=function(){return this.getGlInfo()},e.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},e.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},e.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},e.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},e.prototype.getCaps=function(){return this._caps},e.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},e.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++){(0,this._activeRenderLoops[t])()}this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},e.prototype.getRenderingCanvas=function(){return this._renderingCanvas},e.prototype.getAudioContext=function(){return this._audioContext},e.prototype.getAudioDestination=function(){return this._audioDestination},e.prototype.getHostWindow=function(){return(0,_.CG)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},e.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},e.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},e.prototype._queueNewFrame=function(t,r){return e.QueueNewFrame(t,r)},e.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},e.prototype.clear=function(e,t,r,n){void 0===n&&(n=!1);var i=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=i;var s=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),s|=this._gl.COLOR_BUFFER_BIT),r&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),s|=this._gl.DEPTH_BUFFER_BIT),n&&(this._gl.clearStencil(0),s|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(s)},e.prototype._viewport=function(e,t,r,n){e===this._viewportCached.x&&t===this._viewportCached.y&&r===this._viewportCached.z&&n===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=n,this._gl.viewport(e,t,r,n))},e.prototype.setViewport=function(e,t,r){var n=t||this.getRenderWidth(),i=r||this.getRenderHeight(),s=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(s*n,o*i,n*e.width,i*e.height)},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._frameId++},e.prototype.resize=function(e){var t,r;if(void 0===e&&(e=!1),this._adaptToDeviceRatio){var n=(0,_.CG)()&&window.devicePixelRatio||1,i=this._creationOptions.limitDeviceRatio||n;this._hardwareScalingLevel=this._adaptToDeviceRatio?1/Math.min(i,n):1}(0,_.CG)()?(t=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,r=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(t=this._renderingCanvas?this._renderingCanvas.width:100,r=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(t/this._hardwareScalingLevel,r/this._hardwareScalingLevel,e)},e.prototype.setSize=function(e,t,r){return void 0===r&&(r=!1),!!this._renderingCanvas&&(e|=0,t|=0,!(!r&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t)&&(this._renderingCanvas.width=e,this._renderingCanvas.height=t,!0))},e.prototype.bindFramebuffer=function(e,t,r,n,i,s,o){var a,u,c,h,d;void 0===t&&(t=0),void 0===s&&(s=0),void 0===o&&(o=0);var l=e;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(l._MSAAFramebuffer?l._MSAAFramebuffer:l._framebuffer);var _=this._gl;e.is2DArray?_.framebufferTextureLayer(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,null===(a=e.texture._hardwareTexture)||void 0===a?void 0:a.underlyingResource,s,o):e.isCube&&_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+t,null===(u=e.texture._hardwareTexture)||void 0===u?void 0:u.underlyingResource,s);var p=e._depthStencilTexture;if(p){var f=e._depthStencilTextureWithStencil?_.DEPTH_STENCIL_ATTACHMENT:_.DEPTH_ATTACHMENT;e.is2DArray?_.framebufferTextureLayer(_.FRAMEBUFFER,f,null===(c=p._hardwareTexture)||void 0===c?void 0:c.underlyingResource,s,o):e.isCube?_.framebufferTexture2D(_.FRAMEBUFFER,f,_.TEXTURE_CUBE_MAP_POSITIVE_X+t,null===(h=p._hardwareTexture)||void 0===h?void 0:h.underlyingResource,s):_.framebufferTexture2D(_.FRAMEBUFFER,f,_.TEXTURE_2D,null===(d=p._hardwareTexture)||void 0===d?void 0:d.underlyingResource,s)}this._cachedViewport&&!i?this.setViewport(this._cachedViewport,r,n):(r||(r=e.width,s&&(r/=Math.pow(2,s))),n||(n=e.height,s&&(n/=Math.pow(2,s))),this._viewport(0,0,r,n)),this.wipeCaches()},e.prototype.setState=function(e,t,r,n,i,s,o){var a,u;void 0===t&&(t=0),void 0===n&&(n=!1),void 0===o&&(o=0),(this._depthCullingState.cull!==e||r)&&(this._depthCullingState.cull=e);var c=null===(u=null!==(a=this.cullBackFaces)&&void 0!==a?a:i)||void 0===u||u?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==c||r)&&(this._depthCullingState.cullFace=c),this.setZOffset(t),this.setZOffsetUnits(o);var h=n?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==h||r)&&(this._depthCullingState.frontFace=h),this._stencilStateComposer.stencilMaterial=s},e.prototype.setZOffset=function(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e},e.prototype.getZOffset=function(){var e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e},e.prototype.setZOffsetUnits=function(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e},e.prototype.getZOffsetUnits=function(){var e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e},e.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},e.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return null===this._currentFramebuffer},e.prototype.generateMipmaps=function(e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)},e.prototype.unBindFramebuffer=function(e,t,r){var n;void 0===t&&(t=!1);var i=e;this._currentRenderTarget=null;var s=this._gl;if(i._MSAAFramebuffer){if(e.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(e,t,r);s.bindFramebuffer(s.READ_FRAMEBUFFER,i._MSAAFramebuffer),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,i._framebuffer),s.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,s.COLOR_BUFFER_BIT,s.NEAREST)}!(null===(n=e.texture)||void 0===n?void 0:n.generateMipMaps)||t||e.isCube||this.generateMipmaps(e.texture),r&&(i._MSAAFramebuffer&&this._bindUnboundFramebuffer(i._framebuffer),r()),this._bindUnboundFramebuffer(null)},e.prototype.flushFramebuffer=function(){this._gl.flush()},e.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},e.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},e.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},e.prototype._createVertexBuffer=function(e,t){var r=this._gl.createBuffer();if(!r)throw new Error("Unable to create vertex buffer");var n=new m.M(r);return this.bindArrayBuffer(n),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),this._resetVertexBufferBinding(),n.references=1,n},e.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},e.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},e.prototype.createIndexBuffer=function(e,t){var r=this._gl.createBuffer(),n=new m.M(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(n);var i=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),n.references=1,n.is32Bits=4===i.BYTES_PER_ELEMENT,n},e.prototype._normalizeIndexData=function(e){if(2===e.BYTES_PER_ELEMENT)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},e.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)},e.prototype.bindUniformBlock=function(e,t,r){var n=e.program,i=this._gl.getUniformBlockIndex(n,t);this._gl.uniformBlockBinding(n,i,r)},e.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},e.prototype._bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},e.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},e.prototype._vertexAttribPointer=function(e,t,r,n,i,s,o){var a=this._currentBufferPointers[t];if(a){var u=!1;a.active?(a.buffer!==e&&(a.buffer=e,u=!0),a.size!==r&&(a.size=r,u=!0),a.type!==n&&(a.type=n,u=!0),a.normalized!==i&&(a.normalized=i,u=!0),a.stride!==s&&(a.stride=s,u=!0),a.offset!==o&&(a.offset=o,u=!0)):(u=!0,a.active=!0,a.index=t,a.size=r,a.type=n,a.normalized=i,a.stride=s,a.offset=o,a.buffer=e),(u||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,r,n,i,s,o))}},e.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},e.prototype._bindVertexBuffersAttributes=function(e,t,r){var n=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var i=0;i<n.length;i++){var s=t.getAttributeLocation(i);if(s>=0){var o=n[i],a=null;if(r&&(a=r[o]),a||(a=e[o]),!a)continue;this._gl.enableVertexAttribArray(s),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[s]=!0);var u=a.getBuffer();u&&(this._vertexAttribPointer(u,s,a.getSize(),a.type,a.normalized,a.byteStride,a.byteOffset),a.getIsInstanced()&&(this._gl.vertexAttribDivisor(s,a.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(u))))}}},e.prototype.recordVertexArrayObject=function(e,t,r,n){var i=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(i),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,r,n),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),i},e.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},e.prototype.bindBuffersDirectly=function(e,t,r,n,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i;var s=i.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var o=0,a=0;a<s;a++)if(a<r.length){var u=i.getAttributeLocation(a);u>=0&&(this._gl.enableVertexAttribArray(u),this._vertexAttribArraysEnabled[u]=!0,this._vertexAttribPointer(e,u,r[a],this._gl.FLOAT,!1,n,o)),o+=4*r[a]}}this._bindIndexBufferWithCache(t)},e.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},e.prototype.bindBuffers=function(e,t,r,n){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(e,r,n)),this._bindIndexBufferWithCache(t)},e.prototype.unbindInstanceAttributes=function(){for(var e,t=0,r=this._currentInstanceLocations.length;t<r;t++){var n=this._currentInstanceBuffers[t];e!=n&&n.references&&(e=n,this.bindArrayBuffer(n));var i=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(i,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},e.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},e.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)},e.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},e.prototype.updateAndBindInstancesBuffer=function(e,t,r){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==r[0].index)this.bindInstancesBuffer(e,r,!0);else for(var n=0;n<4;n++){var i=r[n];this._vertexAttribArraysEnabled[i]||(this._gl.enableVertexAttribArray(i),this._vertexAttribArraysEnabled[i]=!0),this._vertexAttribPointer(e,i,4,this._gl.FLOAT,!1,64,16*n),this._gl.vertexAttribDivisor(i,1),this._currentInstanceLocations.push(i),this._currentInstanceBuffers.push(e)}},e.prototype.bindInstancesBuffer=function(e,t,r){void 0===r&&(r=!0),this.bindArrayBuffer(e);var n=0;if(r)for(var i=0;i<t.length;i++){n+=4*(s=t[i]).attributeSize}for(i=0;i<t.length;i++){var s;void 0===(s=t[i]).index&&(s.index=this._currentEffect.getAttributeLocationByName(s.attributeName)),s.index<0||(this._vertexAttribArraysEnabled[s.index]||(this._gl.enableVertexAttribArray(s.index),this._vertexAttribArraysEnabled[s.index]=!0),this._vertexAttribPointer(e,s.index,s.attributeSize,s.attributeType||this._gl.FLOAT,s.normalized||!1,n,s.offset),this._gl.vertexAttribDivisor(s.index,void 0===s.divisor?1:s.divisor),this._currentInstanceLocations.push(s.index),this._currentInstanceBuffers.push(e))}},e.prototype.disableInstanceAttributeByName=function(e){if(this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}},e.prototype.disableInstanceAttribute=function(e){for(var t,r=!1;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),r=!0,t=this._currentInstanceLocations.indexOf(e);r&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},e.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},e.prototype.draw=function(e,t,r,n){this.drawElementsType(e?0:1,t,r,n)},e.prototype.drawPointClouds=function(e,t,r){this.drawArraysType(2,e,t,r)},e.prototype.drawUnIndexed=function(e,t,r,n){this.drawArraysType(e?0:1,t,r,n)},e.prototype.drawElementsType=function(e,t,r,n){this.applyStates(),this._reportDrawCall();var i=this._drawMode(e),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;n?this._gl.drawElementsInstanced(i,r,s,t*o,n):this._gl.drawElements(i,r,s,t*o)},e.prototype.drawArraysType=function(e,t,r,n){this.applyStates(),this._reportDrawCall();var i=this._drawMode(e);n?this._gl.drawArraysInstanced(i,t,r,n):this._gl.drawArrays(i,t,r)},e.prototype._drawMode=function(e){switch(e){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}},e.prototype._reportDrawCall=function(){},e.prototype._releaseEffect=function(e){if(this._compiledEffects[e._key]){delete this._compiledEffects[e._key];var t=e.getPipelineContext();t&&this._deletePipelineContext(t)}},e.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},e.prototype._getGlobalDefines=function(e){if(e)return this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,void(this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER);var t="";return this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+="\n"),t+="#define USE_REVERSE_DEPTHBUFFER"),t},e.prototype.createEffect=function(e,t,r,n,i,o,a,u,c,h){var d;void 0===h&&(h=x.x.GLSL);var l=e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e,_=e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e,p=this._getGlobalDefines(),f=null!==(d=null!=i?i:t.defines)&&void 0!==d?d:"";p&&(f+=p);var m=l+"+"+_+"@"+f;if(this._compiledEffects[m]){var g=this._compiledEffects[m];return a&&g.isReady()&&a(g),g}var E=new s.Q(e,t,r,n,this,i,o,a,u,c,m,h);return this._compiledEffects[m]=E,E},e._ConcatenateShader=function(e,t,r){return void 0===r&&(r=""),r+(t?t+"\n":"")+e},e.prototype._compileShader=function(t,r,n,i){return this._compileRawShader(e._ConcatenateShader(t,n,i),r)},e.prototype._compileRawShader=function(e,t){var r=this._gl,n=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!n){for(var i=r.NO_ERROR,s=r.NO_ERROR;(s=r.getError())!==r.NO_ERROR;)i=s;throw new Error("Something went wrong while creating a gl ".concat(t," shader object. gl error=").concat(i,", gl isContextLost=").concat(r.isContextLost(),", _contextWasLost=").concat(this._contextWasLost))}return r.shaderSource(n,e),r.compileShader(n),n},e.prototype._getShaderSource=function(e){return this._gl.getShaderSource(e)},e.prototype.createRawShaderProgram=function(e,t,r,n,i){void 0===i&&(i=null),n=n||this._gl;var s=this._compileRawShader(t,"vertex"),o=this._compileRawShader(r,"fragment");return this._createShaderProgram(e,s,o,n,i)},e.prototype.createShaderProgram=function(e,t,r,n,i,s){void 0===s&&(s=null),i=i||this._gl;var o=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",a=this._compileShader(t,"vertex",n,o),u=this._compileShader(r,"fragment",n,o);return this._createShaderProgram(e,a,u,i,s)},e.prototype.inlineShaderCode=function(e){return e},e.prototype.createPipelineContext=function(e){var t=new g.y;return t.engine=this,this._caps.parallelShaderCompile&&(t.isParallelCompiled=!0),t},e.prototype.createMaterialContext=function(){},e.prototype.createDrawContext=function(){},e.prototype._createShaderProgram=function(e,t,r,n,i){void 0===i&&(i=null);var s=n.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");return n.attachShader(s,t),n.attachShader(s,r),n.linkProgram(s),e.context=n,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),s},e.prototype._finalizePipelineContext=function(e){var t=e.context,r=e.vertexShader,n=e.fragmentShader,i=e.program;if(!t.getProgramParameter(i,t.LINK_STATUS)){var s,o;if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS))if(s=this._gl.getShaderInfoLog(r))throw e.vertexCompilationError=s,new Error("VERTEX SHADER "+s);if(!this._gl.getShaderParameter(n,this._gl.COMPILE_STATUS))if(s=this._gl.getShaderInfoLog(n))throw e.fragmentCompilationError=s,new Error("FRAGMENT SHADER "+s);if(o=t.getProgramInfoLog(i))throw e.programLinkError=o,new Error(o)}if(this.validateShaderPrograms&&(t.validateProgram(i),!t.getProgramParameter(i,t.VALIDATE_STATUS)&&(o=t.getProgramInfoLog(i))))throw e.programValidationError=o,new Error(o);t.deleteShader(r),t.deleteShader(n),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},e.prototype._preparePipelineContext=function(e,t,r,n,i,s,o,a,u,c){var h=e;h.program=n?this.createRawShaderProgram(h,t,r,void 0,u):this.createShaderProgram(h,t,r,a,void 0,u),h.program.__SPECTOR_rebuildProgram=o},e.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},e.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var r=e;if(r.isParallelCompiled){var n=r.onCompiled;r.onCompiled=n?function(){n(),t()}:t}else t()},e.prototype.getUniforms=function(e,t){for(var r=new Array,n=e,i=0;i<t.length;i++)r.push(this._gl.getUniformLocation(n.program,t[i]));return r},e.prototype.getAttributes=function(e,t){for(var r=[],n=e,i=0;i<t.length;i++)try{r.push(this._gl.getAttribLocation(n.program,t[i]))}catch(e){r.push(-1)}return r},e.prototype.enableEffect=function(e){(e=null!==e&&T.q.IsWrapper(e)?e.effect:e)&&e!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},e.prototype.setInt=function(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)},e.prototype.setInt2=function(e,t,r){return!!e&&(this._gl.uniform2i(e,t,r),!0)},e.prototype.setInt3=function(e,t,r,n){return!!e&&(this._gl.uniform3i(e,t,r,n),!0)},e.prototype.setInt4=function(e,t,r,n,i){return!!e&&(this._gl.uniform4i(e,t,r,n,i),!0)},e.prototype.setIntArray=function(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)},e.prototype.setIntArray2=function(e,t){return!(!e||t.length%2!=0)&&(this._gl.uniform2iv(e,t),!0)},e.prototype.setIntArray3=function(e,t){return!(!e||t.length%3!=0)&&(this._gl.uniform3iv(e,t),!0)},e.prototype.setIntArray4=function(e,t){return!(!e||t.length%4!=0)&&(this._gl.uniform4iv(e,t),!0)},e.prototype.setArray=function(e,t){return!!e&&(!(t.length<1)&&(this._gl.uniform1fv(e,t),!0))},e.prototype.setArray2=function(e,t){return!(!e||t.length%2!=0)&&(this._gl.uniform2fv(e,t),!0)},e.prototype.setArray3=function(e,t){return!(!e||t.length%3!=0)&&(this._gl.uniform3fv(e,t),!0)},e.prototype.setArray4=function(e,t){return!(!e||t.length%4!=0)&&(this._gl.uniform4fv(e,t),!0)},e.prototype.setMatrices=function(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)},e.prototype.setMatrix3x3=function(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)},e.prototype.setMatrix2x2=function(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)},e.prototype.setFloat=function(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)},e.prototype.setFloat2=function(e,t,r){return!!e&&(this._gl.uniform2f(e,t,r),!0)},e.prototype.setFloat3=function(e,t,r,n){return!!e&&(this._gl.uniform3f(e,t,r,n),!0)},e.prototype.setFloat4=function(e,t,r,n,i){return!!e&&(this._gl.uniform4f(e,t,r,n,i),!0)},e.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}},e.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},e.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(e.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilStateComposer",{get:function(){return this._stencilStateComposer},enumerable:!1,configurable:!0}),e.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},e.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},e.prototype._getSamplingParameters=function(e,t){var r=this._gl,n=r.NEAREST,i=r.NEAREST;switch(e){case 11:n=r.LINEAR,i=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 3:n=r.LINEAR,i=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 8:n=r.NEAREST,i=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 4:n=r.NEAREST,i=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 5:n=r.NEAREST,i=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 6:n=r.NEAREST,i=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 7:n=r.NEAREST,i=r.LINEAR;break;case 1:n=r.NEAREST,i=r.NEAREST;break;case 9:n=r.LINEAR,i=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 10:n=r.LINEAR,i=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 2:n=r.LINEAR,i=r.LINEAR;break;case 12:n=r.LINEAR,i=r.NEAREST}return{min:i,mag:n}},e.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},e.prototype._createHardwareTexture=function(){return new v.B(this._createTexture(),this._gl)},e.prototype._createInternalTexture=function(e,t,r,n){void 0===r&&(r=!0),void 0===n&&(n=d.S.Unknown);var i={};void 0!==t&&"object"==typeof t?(i.generateMipMaps=t.generateMipMaps,i.type=void 0===t.type?0:t.type,i.samplingMode=void 0===t.samplingMode?3:t.samplingMode,i.format=void 0===t.format?5:t.format,i.useSRGBBuffer=void 0!==t.useSRGBBuffer&&t.useSRGBBuffer):(i.generateMipMaps=t,i.type=0,i.samplingMode=3,i.format=5,i.useSRGBBuffer=!1),i.useSRGBBuffer=i.useSRGBBuffer&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU),(1!==i.type||this._caps.textureFloatLinearFiltering)&&(2!==i.type||this._caps.textureHalfFloatLinearFiltering)||(i.samplingMode=1),1!==i.type||this._caps.textureFloat||(i.type=0,l.Y.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));var s=this._gl,o=new d.l(this,n);o._useSRGBBuffer=!!i.useSRGBBuffer;var a=e.width||e,u=e.height||e,c=e.layers||0,h=this._getSamplingParameters(i.samplingMode,!!i.generateMipMaps),_=0!==c?s.TEXTURE_2D_ARRAY:s.TEXTURE_2D,p=this._getRGBABufferInternalSizedFormat(i.type,i.format,i.useSRGBBuffer),f=this._getInternalFormat(i.format),m=this._getWebGLTextureType(i.type);return this._bindTextureDirectly(_,o),0!==c?(o.is2DArray=!0,s.texImage3D(_,0,p,a,u,c,0,f,m,null)):s.texImage2D(_,0,p,a,u,0,f,m,null),s.texParameteri(_,s.TEXTURE_MAG_FILTER,h.mag),s.texParameteri(_,s.TEXTURE_MIN_FILTER,h.min),s.texParameteri(_,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(_,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),i.generateMipMaps&&this._gl.generateMipmap(_),this._bindTextureDirectly(_,null),o.baseWidth=a,o.baseHeight=u,o.width=a,o.height=u,o.depth=c,o.isReady=!0,o.samples=1,o.generateMipMaps=!!i.generateMipMaps,o.samplingMode=i.samplingMode,o.type=i.type,o.format=i.format,this._internalTexturesCache.push(o),o},e.prototype._getUseSRGBBuffer=function(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||t)},e.prototype._createTextureBase=function(t,r,n,s,o,a,u,c,h,_,p,f,m,g,E,v){var T=this;void 0===o&&(o=3),void 0===a&&(a=null),void 0===u&&(u=null),void 0===_&&(_=null),void 0===p&&(p=null),void 0===f&&(f=null),void 0===m&&(m=null);var y="data:"===(t=t||"").substr(0,5),x="blob:"===t.substr(0,5),b=y&&-1!==t.indexOf(";base64,"),C=p||new d.l(this,d.S.Url),A=t;!this._transformTextureUrl||b||p||_||(t=this._transformTextureUrl(t)),A!==t&&(C._originalUrl=A);var R=t.lastIndexOf("."),S=m||(R>-1?t.substring(R).toLowerCase():""),w=null;S.indexOf("?")>-1&&(S=S.split("?")[0]);for(var B=0,F=e._TextureLoaders;B<F.length;B++){var P=F[B];if(P.canLoad(S,g)){w=P;break}}s&&s._addPendingData(C),C.url=t,C.generateMipMaps=!r,C.samplingMode=o,C.invertY=n,C._useSRGBBuffer=this._getUseSRGBBuffer(!!v,r),this._doNotHandleContextLost||(C._buffer=_);var M=null;a&&!p&&(M=C.onLoadedObservable.add(a)),p||this._internalTexturesCache.push(C);var L=function(e,n){s&&s._removePendingData(C),t===A?(M&&C.onLoadedObservable.remove(M),i.l.UseFallbackTexture&&T._createTextureBase(i.l.FallbackTexture,r,C.invertY,s,o,null,u,c,h,_,C),e=(e||"Unknown error")+(i.l.UseFallbackTexture?" - Fallback texture was used":""),C.onErrorObservable.notifyObservers({message:e,exception:n}),u&&u(e,n)):(l.Y.Warn("Failed to load ".concat(t,", falling back to ").concat(A)),T._createTextureBase(A,r,C.invertY,s,o,a,u,c,h,_,C,f,m,g,E,v))};if(w){var D=function(e){w.loadData(e,C,(function(e,t,r,n,i,a){a?L("TextureLoader failed to load data"):c(C,S,s,{width:e,height:t},C.invertY,!r,n,(function(){return i(),!1}),o)}),E)};_?_ instanceof ArrayBuffer?D(new Uint8Array(_)):ArrayBuffer.isView(_)?D(_):u&&u("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(t,(function(e){return D(new Uint8Array(e))}),void 0,s?s.offlineProvider:void 0,!0,(function(e,t){L("Unable to load "+(e&&e.responseURL,t))}))}else{var I=function(e){x&&!T._doNotHandleContextLost&&(C._buffer=e),c(C,S,s,e,C.invertY,r,!1,h,o)};!y||b?_&&("string"==typeof _.decoding||_.close)?I(_):e._FileToolsLoadImage(t,I,L,s?s.offlineProvider:null,g,C.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"==typeof _||_ instanceof ArrayBuffer||ArrayBuffer.isView(_)||_ instanceof Blob?e._FileToolsLoadImage(_,I,L,s?s.offlineProvider:null,g,C.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):_&&I(_)}return C},e.prototype.createTexture=function(e,t,r,n,i,s,o,a,u,c,h,l,_,p,f){var m=this;return void 0===i&&(i=3),void 0===s&&(s=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===h&&(h=null),this._createTextureBase(e,t,r,n,i,s,o,this._prepareWebGLTexture.bind(this),(function(e,t,r,i,s,o){var a=m._gl,u=r.width===e&&r.height===t,h=c?m._getInternalFormat(c,s._useSRGBBuffer):".jpg"!==i||s._useSRGBBuffer?s._useSRGBBuffer?a.SRGB8_ALPHA8:a.RGBA:a.RGB,l=c?m._getInternalFormat(c):".jpg"!==i||s._useSRGBBuffer?a.RGBA:a.RGB;if(s._useSRGBBuffer&&1===m.webGLVersion&&(l=h),u)return a.texImage2D(a.TEXTURE_2D,0,h,l,a.UNSIGNED_BYTE,r),!1;var _=m._caps.maxTextureSize;if(r.width>_||r.height>_||!m._supportsHardwareTextureRescaling)return m._prepareWorkingCanvas(),!(!m._workingCanvas||!m._workingContext)&&(m._workingCanvas.width=e,m._workingCanvas.height=t,m._workingContext.drawImage(r,0,0,r.width,r.height,0,0,e,t),a.texImage2D(a.TEXTURE_2D,0,h,l,a.UNSIGNED_BYTE,m._workingCanvas),s.width=e,s.height=t,!1);var p=new d.l(m,d.S.Temp);return m._bindTextureDirectly(a.TEXTURE_2D,p,!0),a.texImage2D(a.TEXTURE_2D,0,h,l,a.UNSIGNED_BYTE,r),m._rescaleTexture(p,s,n,h,(function(){m._releaseTexture(p),m._bindTextureDirectly(a.TEXTURE_2D,s,!0),o()})),!0}),a,u,c,h,l,_,f)},e._FileToolsLoadImage=function(e,t,r,n,i,s){throw(0,o.S)("FileTools")},e.prototype._rescaleTexture=function(e,t,r,n,i){},e.prototype.createRawTexture=function(e,t,r,n,i,s,a,u,c,h,d){throw void 0===u&&(u=null),void 0===c&&(c=0),void 0===h&&(h=0),void 0===d&&(d=!1),(0,o.S)("Engine.RawTexture")},e.prototype.createRawCubeTexture=function(e,t,r,n,i,s,a,u){throw void 0===u&&(u=null),(0,o.S)("Engine.RawTexture")},e.prototype.createRawTexture3D=function(e,t,r,n,i,s,a,u,c,h){throw void 0===c&&(c=null),void 0===h&&(h=0),(0,o.S)("Engine.RawTexture")},e.prototype.createRawTexture2DArray=function(e,t,r,n,i,s,a,u,c,h){throw void 0===c&&(c=null),void 0===h&&(h=0),(0,o.S)("Engine.RawTexture")},e.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},e.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},e.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},e.prototype.updateTextureSamplingMode=function(e,t,r){void 0===r&&(r=!1);var n=this._getTextureTarget(t),i=this._getSamplingParameters(e,t.generateMipMaps||r);this._setTextureParameterInteger(n,this._gl.TEXTURE_MAG_FILTER,i.mag,t),this._setTextureParameterInteger(n,this._gl.TEXTURE_MIN_FILTER,i.min),r&&(t.generateMipMaps=!0,this._gl.generateMipmap(n)),this._bindTextureDirectly(n,null),t.samplingMode=e},e.prototype.updateTextureDimensions=function(e,t,r,n){void 0===n&&(n=1)},e.prototype.updateTextureWrappingMode=function(e,t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var i=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==r&&(this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(r),e),e._cachedWrapV=r),(e.is2DArray||e.is3D)&&null!==n&&(this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(n),e),e._cachedWrapR=n),this._bindTextureDirectly(i,null)},e.prototype._setupDepthStencilTexture=function(e,t,r,n,i,s){void 0===s&&(s=1);var o=t.width||t,a=t.height||t,u=t.layers||0;e.baseWidth=o,e.baseHeight=a,e.width=o,e.height=a,e.is2DArray=u>0,e.depth=u,e.isReady=!0,e.samples=s,e.generateMipMaps=!1,e.samplingMode=n?2:1,e.type=0,e._comparisonFunction=i;var c=this._gl,h=this._getTextureTarget(e),d=this._getSamplingParameters(e.samplingMode,!1);c.texParameteri(h,c.TEXTURE_MAG_FILTER,d.mag),c.texParameteri(h,c.TEXTURE_MIN_FILTER,d.min),c.texParameteri(h,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(h,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),0===i?(c.texParameteri(h,c.TEXTURE_COMPARE_FUNC,515),c.texParameteri(h,c.TEXTURE_COMPARE_MODE,c.NONE)):(c.texParameteri(h,c.TEXTURE_COMPARE_FUNC,i),c.texParameteri(h,c.TEXTURE_COMPARE_MODE,c.COMPARE_REF_TO_TEXTURE))},e.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,n,i,s,o){void 0===s&&(s=0),void 0===o&&(o=0);var a=this._gl,u=a.TEXTURE_2D;if(e.isCube&&(u=a.TEXTURE_CUBE_MAP_POSITIVE_X+s),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=a.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1}this._gl.compressedTexImage2D(u,o,t,r,n,0,i)},e.prototype._uploadDataToTextureDirectly=function(e,t,r,n,i,s){void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=!1);var o=this._gl,a=this._getWebGLTextureType(e.type),u=this._getInternalFormat(e.format),c=void 0===i?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(i,e._useSRGBBuffer);this._unpackFlipY(e.invertY);var h=o.TEXTURE_2D;e.isCube&&(h=o.TEXTURE_CUBE_MAP_POSITIVE_X+r);var d=Math.round(Math.log(e.width)*Math.LOG2E),l=Math.round(Math.log(e.height)*Math.LOG2E),_=s?e.width:Math.pow(2,Math.max(d-n,0)),p=s?e.height:Math.pow(2,Math.max(l-n,0));o.texImage2D(h,n,c,_,p,0,u,a,t)},e.prototype.updateTextureData=function(e,t,r,n,i,s,o,a,u){void 0===o&&(o=0),void 0===a&&(a=0),void 0===u&&(u=!1);var c=this._gl,h=this._getWebGLTextureType(e.type),d=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var l=c.TEXTURE_2D;e.isCube&&(l=c.TEXTURE_CUBE_MAP_POSITIVE_X+o),this._bindTextureDirectly(l,e,!0),c.texSubImage2D(l,a,r,n,i,s,d,h,t),u&&this._gl.generateMipmap(l),this._bindTextureDirectly(l,null)},e.prototype._uploadArrayBufferViewToTexture=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i=this._gl,s=e.isCube?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D;this._bindTextureDirectly(s,e,!0),this._uploadDataToTextureDirectly(e,t,r,n),this._bindTextureDirectly(s,null,!0)},e.prototype._prepareWebGLTextureContinuation=function(e,t,r,n,i){var s=this._gl;if(s){var o=this._getSamplingParameters(i,!r);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o.min),r||n||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},e.prototype._prepareWebGLTexture=function(t,r,n,i,s,o,a,u,c){var h=this;void 0===c&&(c=3);var d=this.getCaps().maxTextureSize,l=Math.min(d,this.needPOTTextures?e.GetExponentOfTwo(i.width,d):i.width),_=Math.min(d,this.needPOTTextures?e.GetExponentOfTwo(i.height,d):i.height),p=this._gl;p&&(t._hardwareTexture?(this._bindTextureDirectly(p.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===s||!!s),t.baseWidth=i.width,t.baseHeight=i.height,t.width=l,t.height=_,t.isReady=!0,u(l,_,i,r,t,(function(){h._prepareWebGLTextureContinuation(t,n,o,a,c)}))||this._prepareWebGLTextureContinuation(t,n,o,a,c)):n&&n._removePendingData(t))},e.prototype._setupFramebufferDepthAttachments=function(e,t,r,n,i){void 0===i&&(i=1);var s=this._gl;if(e&&t)return this._createRenderBuffer(r,n,i,s.DEPTH_STENCIL,s.DEPTH24_STENCIL8,s.DEPTH_STENCIL_ATTACHMENT);if(t){var o=s.DEPTH_COMPONENT16;return this._webGLVersion>1&&(o=s.DEPTH_COMPONENT32F),this._createRenderBuffer(r,n,i,o,o,s.DEPTH_ATTACHMENT)}return e?this._createRenderBuffer(r,n,i,s.STENCIL_INDEX8,s.STENCIL_INDEX8,s.STENCIL_ATTACHMENT):null},e.prototype._createRenderBuffer=function(e,t,r,n,i,s,o){void 0===o&&(o=!0);var a=this._gl,u=a.createRenderbuffer();return a.bindRenderbuffer(a.RENDERBUFFER,u),r>1&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(a.RENDERBUFFER,r,i,e,t):a.renderbufferStorage(a.RENDERBUFFER,n,e,t),a.framebufferRenderbuffer(a.FRAMEBUFFER,s,a.RENDERBUFFER,u),o&&a.bindRenderbuffer(a.RENDERBUFFER,null),u},e.prototype._releaseTexture=function(e){var t;this._deleteTexture(null===(t=e._hardwareTexture)||void 0===t?void 0:t.underlyingResource),this.unbindAllTextures();var r=this._internalTexturesCache.indexOf(e);-1!==r&&this._internalTexturesCache.splice(r,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},e.prototype._releaseRenderTargetWrapper=function(e){var t=this._renderTargetWrapperCache.indexOf(e);-1!==t&&this._renderTargetWrapperCache.splice(t,1)},e.prototype._deleteTexture=function(e){e&&this._gl.deleteTexture(e)},e.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},e.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var r=e.getSamplers(),n=0;n<r.length;n++){var i=e.getUniform(r[n]);i&&(this._boundUniforms[n]=i)}this._currentEffect=null},e.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},e.prototype._bindTextureDirectly=function(e,t,r,n){var i,s;void 0===r&&(r=!1),void 0===n&&(n=!1);var o=!1,a=t&&t._associatedChannel>-1;if(r&&a&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||n){if(this._activateCurrentTexture(),t&&t.isMultiview)throw"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,null!==(s=null===(i=null==t?void 0:t._hardwareTexture)||void 0===i?void 0:i.underlyingResource)&&void 0!==s?s:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else r&&(o=!0,this._activateCurrentTexture());return a&&!r&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),o},e.prototype._bindTexture=function(e,t,r){if(void 0!==e){t&&(t._associatedChannel=e),this._activeChannel=e;var n=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(n,t)}},e.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},e.prototype.setTexture=function(e,t,r,n){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,r))},e.prototype._bindSamplerUniformToChannel=function(e,t){var r=this._boundUniforms[e];r&&r._currentState!==t&&(this._gl.uniform1i(r,t),r._currentState=t)},e.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},e.prototype._setTexture=function(e,t,r,n,i){if(void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===i&&(i=""),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;var s;s=n?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!r&&s&&(s._associatedChannel=e);var o=!0;this._boundTexturesCache[e]===s&&(r||this._bindSamplerUniformToChannel(s._associatedChannel,e),o=!1),this._activeChannel=e;var a=this._getTextureTarget(s);if(o&&this._bindTextureDirectly(a,s,r),s&&!s.isMultiview){if(s.isCube&&s._cachedCoordinatesMode!==t.coordinatesMode){s._cachedCoordinatesMode=t.coordinatesMode;var u=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=u,t.wrapV=u}s._cachedWrapU!==t.wrapU&&(s._cachedWrapU=t.wrapU,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),s)),s._cachedWrapV!==t.wrapV&&(s._cachedWrapV=t.wrapV,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),s)),s.is3D&&s._cachedWrapR!==t.wrapR&&(s._cachedWrapR=t.wrapR,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),s)),this._setAnisotropicLevel(a,s,t.anisotropicFilteringLevel)}return!0},e.prototype.setTextureArray=function(e,t,r,n){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(var i=0;i<r.length;i++){var s=r[i].getInternalTexture();s?(this._textureUnits[i]=e+i,s._associatedChannel=e+i):this._textureUnits[i]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var o=0;o<r.length;o++)this._setTexture(this._textureUnits[o],r[o],!0)}},e.prototype._setAnisotropicLevel=function(e,t,r){var n=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(r=1),n&&t._cachedAnisotropicFilteringLevel!==r&&(this._setTextureParameterFloat(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=r)},e.prototype._setTextureParameterFloat=function(e,t,r,n){this._bindTextureDirectly(e,n,!0,!0),this._gl.texParameterf(e,t,r)},e.prototype._setTextureParameterInteger=function(e,t,r,n){n&&this._bindTextureDirectly(e,n,!0,!0),this._gl.texParameteri(e,t,r)},e.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}},e.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},e.prototype.dispose=function(){var e;this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),null===(e=this.releaseComputeEffects)||void 0===e||e.call(this),this.unbindAllAttributes(),this._boundUniforms=[],(0,_.CG)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),window.removeEventListener("resize",this._checkForMobile)),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,s.Q.ResetCache();for(var t=0,r=this._activeRequests;t<r.length;t++){r[t].abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},e.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},e.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},e.prototype.getError=function(){return this._gl.getError()},e.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},e.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},e.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var r=!0,n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var s=t.checkFramebufferStatus(t.FRAMEBUFFER);if((r=(r=r&&s===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),r=r&&t.getError()===t.NO_ERROR),r){t.bindFramebuffer(t.FRAMEBUFFER,null);var o=t.RGBA,a=t.UNSIGNED_BYTE,u=new Uint8Array(4);t.readPixels(0,0,1,1,o,a,u),r=r&&t.getError()===t.NO_ERROR}for(t.deleteTexture(n),t.deleteFramebuffer(i),t.bindFramebuffer(t.FRAMEBUFFER,null);!r&&t.getError()!==t.NO_ERROR;);return r},e.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},e.prototype._getInternalFormat=function(e,t){void 0===t&&(t=!1);var r=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:r=this._gl.ALPHA;break;case 1:r=this._gl.LUMINANCE;break;case 2:r=this._gl.LUMINANCE_ALPHA;break;case 6:r=this._gl.RED;break;case 7:r=this._gl.RG;break;case 4:r=t?this._gl.SRGB:this._gl.RGB;break;case 5:r=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:r=this._gl.RED_INTEGER;break;case 9:r=this._gl.RG_INTEGER;break;case 10:r=this._gl.RGB_INTEGER;break;case 11:r=this._gl.RGBA_INTEGER}return r},e.prototype._getRGBABufferInternalSizedFormat=function(e,t,r){if(void 0===r&&(r=!1),1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return r?this._gl.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return r?this._gl.SRGB8:this._gl.RGB8;case 5:return r?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return r?this._gl.SRGB8_ALPHA8:this._gl.RGBA8},e.prototype._getRGBAMultiSampleBufferFormat=function(e){return 1===e?this._gl.RGBA32F:2===e?this._gl.RGBA16F:this._gl.RGBA8},e.prototype._loadFile=function(t,r,n,i,s,o){var a=this,u=e._FileToolsLoadFile(t,r,n,i,s,o);return this._activeRequests.push(u),u.onCompleteObservable.add((function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)})),u},e._FileToolsLoadFile=function(e,t,r,n,i,s){throw(0,o.S)("FileTools")},e.prototype.readPixels=function(e,t,r,n,i,s){void 0===i&&(i=!0),void 0===s&&(s=!0);var o=i?4:3,a=i?this._gl.RGBA:this._gl.RGB,u=new Uint8Array(n*r*o);return s&&this.flushFramebuffer(),this._gl.readPixels(e,t,r,n,a,this._gl.UNSIGNED_BYTE,u),Promise.resolve(u)},Object.defineProperty(e,"IsSupportedAsync",{get:function(){return Promise.resolve(this.isSupported())},enumerable:!1,configurable:!0}),Object.defineProperty(e,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),e.isSupported=function(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(e,"HasMajorPerformanceCaveat",{get:function(){if(null===this._HasMajorPerformanceCaveat)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(e){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),e.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},e.NearestPOT=function(t){var r=e.CeilingPOT(t),n=e.FloorPOT(t);return r-t>t-n?n:r},e.GetExponentOfTwo=function(t,r,n){var i;switch(void 0===n&&(n=2),n){case 1:i=e.FloorPOT(t);break;case 2:i=e.NearestPOT(t);break;default:i=e.CeilingPOT(t)}return Math.min(i,r)},e.QueueNewFrame=function(e,t){return(0,_.CG)()?(t||(t=window),t.requestPostAnimationFrame?t.requestPostAnimationFrame(e):t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,16)},e.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,_.n5)()?document:null},e.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],e._TextureLoaders=[],e.CollisionsEpsilon=.001,e._IsSupported=null,e._HasMajorPerformanceCaveat=null,e}()},60100:(e,t,r)=>{r.d(t,{f:()=>W});var n=r(31191),i=r(84318),s=r(80352),o=r(6307),a=r(37290),u=r(7949),c=r(9256),h=r(8724),d=r(72208),l=r(88934),_=r(86937),p=r(15212),f=r(94274),m=r(13514),g=r(72089),E=r(11564),v=r(19015),T=r(83353),y=r(54231),x=r(20955),b=r(85801),C=r(86980),A=r(58203),R=r(67759),S=r(9460),w=r(59345),B=r(66970),F=r(62274),P=r(81987),M=r(73750),L=r(85900),D=r(62897),I=r(57710),O=r(59412),U=r(50113),N=r(41659),G=r(44344),V=r(20298),W=function(e){function t(t,r){void 0===r&&(r={});var n,o,u,c,d=this;if((d=e.call(this,null)||this)._uploadEncoderDescriptor={label:"upload"},d._renderEncoderDescriptor={label:"render"},d._renderTargetEncoderDescriptor={label:"renderTarget"},d._clearDepthValue=1,d._clearReverseDepthValue=0,d._clearStencilValue=0,d._defaultSampleCount=4,d._glslang=null,d._tintWASM=null,d._compiledComputeEffects={},d._counters={numEnableEffects:0,numEnableDrawWrapper:0,numBundleCreationNonCompatMode:0,numBundleReuseNonCompatMode:0},d.countersLastFrame={numEnableEffects:0,numEnableDrawWrapper:0,numBundleCreationNonCompatMode:0,numBundleReuseNonCompatMode:0},d.numMaxUncapturedErrors=20,d._commandBuffers=[null,null,null],d._currentRenderPass=null,d._mainRenderPassWrapper=new y.B,d._rttRenderPassWrapper=new y.B,d._pendingDebugCommands=[],d._onAfterUnbindFrameBufferObservable=new D.y$,d._currentOverrideVertexBuffers=null,d._currentIndexBuffer=null,d._colorWriteLocal=!0,d._forceEnableEffect=!1,d.dbgShowShaderCode=!1,d.dbgSanityChecks=!0,d.dbgVerboseLogsForFirstFrames=!1,d.dbgVerboseLogsNumFrames=10,d.dbgLogIfNotDrawWrapper=!0,d.dbgShowEmptyEnableEffectCalls=!0,d._viewportsCurrent=[{x:0,y:0,w:0,h:0},{x:0,y:0,w:0,h:0}],d._scissorsCurrent=[{x:0,y:0,w:0,h:0},{x:0,y:0,w:0,h:0}],d._scissorCached={x:0,y:0,z:0,w:0},d._stencilRefsCurrent=[-1,-1],d._blendColorsCurrent=[[null,null,null,null],[null,null,null,null]],d._name="WebGPU",d.isNDCHalfZRange=!0,d.hasOriginBottomLeft=!1,r.deviceDescriptor=r.deviceDescriptor||{},r.swapChainFormat=r.swapChainFormat||h.EV.BGRA8Unorm,r.antialiasing=void 0===r.antialiasing||r.antialiasing,r.stencil=null===(n=r.stencil)||void 0===n||n,r.enableGPUDebugMarkers=null!==(o=r.enableGPUDebugMarkers)&&void 0!==o&&o,V.Z.SetMatrixPrecision(!!r.useHighPrecisionMatrix),i.Y.Log("Babylon.js v".concat(a.D.Version," - ").concat(d.description," engine")),!navigator.gpu)return i.Y.Error("WebGPU is not supported by your browser."),d;d._isWebGPU=!0,d._shaderPlatformName="WEBGPU",void 0===r.deterministicLockstep&&(r.deterministicLockstep=!1),void 0===r.lockstepMaxSteps&&(r.lockstepMaxSteps=4),void 0===r.audioEngine&&(r.audioEngine=!0),d._deterministicLockstep=r.deterministicLockstep,d._lockstepMaxSteps=r.lockstepMaxSteps,d._timeStep=r.timeStep||1/60,d._doNotHandleContextLost=!!r.doNotHandleContextLost,d._canvas=t,d._options=r,d.premultipliedAlpha=null===(u=r.premultipliedAlpha)||void 0===u||u;var l=(0,s.CG)()&&window.devicePixelRatio||1,f=r.limitDeviceRatio||l,m=null!==(c=r.adaptToDeviceRatio)&&void 0!==c&&c;return d._hardwareScalingLevel=m?1/Math.min(f,l):1,d._mainPassSampleCount=r.antialiasing?d._defaultSampleCount:1,d._isStencilEnable=r.stencil,d._sharedInit(t,!!r.doNotHandleTouchAction,r.audioEngine),d._shaderProcessor=new _.s,d._shaderProcessorWGSL=new p.o,d}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"snapshotRenderingMode",{get:function(){return this._snapshotRendering.mode},set:function(e){this._snapshotRendering.mode=e},enumerable:!1,configurable:!0}),t.prototype.snapshotRenderingReset=function(){this._snapshotRendering.reset()},Object.defineProperty(t.prototype,"snapshotRendering",{get:function(){return this._snapshotRendering.enabled},set:function(e){this._snapshotRendering.enabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disableCacheSamplers",{get:function(){return!!this._cacheSampler&&this._cacheSampler.disabled},set:function(e){this._cacheSampler&&(this._cacheSampler.disabled=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disableCacheRenderPipelines",{get:function(){return!!this._cacheRenderPipeline&&this._cacheRenderPipeline.disabled},set:function(e){this._cacheRenderPipeline&&(this._cacheRenderPipeline.disabled=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disableCacheBindGroups",{get:function(){return!!this._cacheBindGroups&&this._cacheBindGroups.disabled},set:function(e){this._cacheBindGroups&&(this._cacheBindGroups.disabled=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsSupportedAsync",{get:function(){return navigator.gpu?navigator.gpu.requestAdapter().then((function(e){return!!e}),(function(){return!1})).catch((function(){return!1})):Promise.resolve(!1)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsSupported",{get:function(){return i.Y.Warn("You must call IsSupportedAsync for WebGPU!"),!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportsUniformBuffers",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportedExtensions",{get:function(){return this._adapterSupportedExtensions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enabledExtensions",{get:function(){return this._deviceEnabledExtensions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this.name+this.version},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return 1},enumerable:!1,configurable:!0}),t.prototype.getInfo=function(){return{vendor:"unknown vendor",renderer:"unknown renderer",version:"unknown version"}},Object.defineProperty(t.prototype,"compatibilityMode",{get:function(){return this._compatibilityMode},set:function(e){this._compatibilityMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentSampleCount",{get:function(){return this._currentRenderTarget?this._currentRenderTarget.samples:this._mainPassSampleCount},enumerable:!1,configurable:!0}),t.CreateAsync=function(e,r){void 0===r&&(r={});var n=new t(e,r);return new Promise((function(e){n.initAsync(r.glslangOptions,r.twgslOptions).then((function(){return e(n)}))}))},t.prototype.initAsync=function(e,r){var n,s=this;return this._initGlslang(null!=e?e:null===(n=this._options)||void 0===n?void 0:n.glslangOptions).then((function(e){var n;return s._glslang=e,s._tintWASM=t.UseTWGSL?new O.S:null,s._tintWASM?s._tintWASM.initTwgsl(null!=r?r:null===(n=s._options)||void 0===n?void 0:n.twgslOptions).then((function(){return navigator.gpu.requestAdapter(s._options)}),(function(e){throw i.Y.Error("Can not initialize twgsl!"),i.Y.Error(e),Error("WebGPU initializations stopped.")})):navigator.gpu.requestAdapter(s._options)}),(function(e){throw i.Y.Error("Can not initialize glslang!"),i.Y.Error(e),Error("WebGPU initializations stopped.")})).then((function(e){var t;if(e){s._adapter=e,s._adapterSupportedExtensions=[],null===(t=s._adapter.features)||void 0===t||t.forEach((function(e){return s._adapterSupportedExtensions.push(e)}));var r=s._options.deviceDescriptor;if(null==r?void 0:r.requiredFeatures){for(var n=[],i=0,o=r.requiredFeatures;i<o.length;i++){var a=o[i];-1!==s._adapterSupportedExtensions.indexOf(a)&&n.push(a)}r.requiredFeatures=n}return s._adapter.requestDevice(s._options.deviceDescriptor)}throw"Could not retrieve a WebGPU adapter (adapter is null)."})).then((function(e){var t,r;s._device=e,s._deviceEnabledExtensions=[],null===(t=s._device.features)||void 0===t||t.forEach((function(e){return s._deviceEnabledExtensions.push(e)}));var n=-1;s._device.addEventListener("uncapturederror",(function(e){++n<s.numMaxUncapturedErrors?i.Y.Warn("WebGPU uncaptured error (".concat(n+1,"): ").concat(e.error," - ").concat(e.error.message)):n++===s.numMaxUncapturedErrors&&i.Y.Warn("WebGPU uncaptured error: too many warnings (".concat(s.numMaxUncapturedErrors,"), no more warnings will be reported to the console for this engine."))})),s._doNotHandleContextLost||null===(r=s._device.lost)||void 0===r||r.then((function(e){s._contextWasLost=!0,i.Y.Warn("WebGPU context lost. "+e),s.onContextLostObservable.notifyObservers(s),s._restoreEngineAfterContextLost(s.initAsync.bind(s))}))}),(function(e){i.Y.Error("Could not retrieve a WebGPU device."),i.Y.Error(e)})).then((function(){s._bufferManager=new E.V(s._device),s._textureHelper=new g.D(s._device,s._glslang,s._tintWASM,s._bufferManager),s._cacheSampler=new x.W(s._device),s._cacheBindGroups=new B.C(s._device,s._cacheSampler,s),s._timestampQuery=new M.b(s._device,s._bufferManager),s._occlusionQuery=s._device.createQuerySet?new L.D(s,s._device,s._bufferManager):void 0,s._bundleList=new P.nt(s._device),s._bundleListRenderTarget=new P.nt(s._device),s._snapshotRendering=new G.w(s,s._snapshotRenderingMode,s._bundleList,s._bundleListRenderTarget),s._ubInvertY=s._bufferManager.createBuffer(new Float32Array([-1,0]),h.FB.Uniform|h.FB.CopyDst),s._ubDontInvertY=s._bufferManager.createBuffer(new Float32Array([1,0]),h.FB.Uniform|h.FB.CopyDst),s.dbgVerboseLogsForFirstFrames&&void 0===s._count&&(s._count=0),s._uploadEncoder=s._device.createCommandEncoder(s._uploadEncoderDescriptor),s._renderEncoder=s._device.createCommandEncoder(s._renderEncoderDescriptor),s._renderTargetEncoder=s._device.createCommandEncoder(s._renderTargetEncoderDescriptor),s._emptyVertexBuffer=new d.o(s,[0],"",!1,!1,1,!1,0,1),s._initializeLimits(),s._cacheRenderPipeline=new b.H(s._device,s._emptyVertexBuffer,!s._caps.textureFloatLinearFiltering),s._depthCullingState=new A.K(s._cacheRenderPipeline),s._stencilStateComposer=new C.F(s._cacheRenderPipeline),s._stencilStateComposer.stencilGlobal=s._stencilState,s._depthCullingState.depthTest=!0,s._depthCullingState.depthFunc=515,s._depthCullingState.depthMask=!0,s._textureHelper.setCommandEncoder(s._uploadEncoder),s._clearQuad=new F.T(s._device,s,s._emptyVertexBuffer),s._defaultDrawContext=s.createDrawContext(),s._currentDrawContext=s._defaultDrawContext,s._defaultMaterialContext=s.createMaterialContext(),s._currentMaterialContext=s._defaultMaterialContext,s._initializeContextAndSwapChain(),s._initializeMainAttachments(),s.resize()})).catch((function(e){i.Y.Error("Can not create WebGPU Device and/or context."),i.Y.Error(e),console.trace}))},t.prototype._initGlslang=function(e){return e=e||{},(e=(0,n.pi)((0,n.pi)({},t._GLSLslangDefaultOptions),e)).glslang?Promise.resolve(e.glslang):self.glslang?self.glslang(e.wasmPath):e.jsPath&&e.wasmPath?(0,s.CG)()?m.w1.LoadScriptAsync(e.jsPath).then((function(){return self.glslang(e.wasmPath)})):(importScripts(e.jsPath),self.glslang(e.wasmPath)):Promise.reject("gslang is not available.")},t.prototype._initializeLimits=function(){this._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:8192,maxCubemapTextureSize:2048,maxRenderTextureSize:8192,maxVertexAttribs:16,maxVaryingVectors:15,maxFragmentUniformVectors:1024,maxVertexUniformVectors:1024,standardDerivatives:!0,astc:this._deviceEnabledExtensions.indexOf(h.eS.TextureCompressionASTC)>=0||void 0,s3tc:this._deviceEnabledExtensions.indexOf(h.eS.TextureCompressionBC)>=0||void 0,pvrtc:null,etc1:null,etc2:this._deviceEnabledExtensions.indexOf(h.eS.TextureCompressionETC2)>=0||void 0,bptc:this._deviceEnabledExtensions.indexOf(h.eS.TextureCompressionBC)>=0||void 0,maxAnisotropy:4,uintIndices:!0,fragmentDepthSupported:!0,highPrecisionShaderSupported:!0,colorBufferFloat:!0,textureFloat:!0,textureFloatLinearFiltering:!1,textureFloatRender:!0,textureHalfFloat:!0,textureHalfFloatLinearFiltering:!0,textureHalfFloatRender:!0,textureLOD:!0,drawBuffersExtension:!0,depthTextureExtension:!0,vertexArrayObject:!1,instancedArrays:!0,timerQuery:"undefined"!=typeof BigUint64Array&&-1!==this.enabledExtensions.indexOf(h.eS.TimestampQuery)||void 0,supportOcclusionQuery:"undefined"!=typeof BigUint64Array,canUseTimestampForTimerQuery:!0,multiview:!1,oculusMultiview:!1,parallelShaderCompile:void 0,blendMinMax:!0,maxMSAASamples:4,canUseGLInstanceID:!0,canUseGLVertexID:!0,supportComputeShaders:!0,supportSRGBBuffers:!0,supportTransformFeedbacks:!1,textureMaxLevel:!0,texture2DArrayMaxLayerCount:2048},this._caps.parallelShaderCompile=null,this._features={forceBitmapOverHTMLImageElement:!0,supportRenderAndCopyToLodForFloatTextures:!0,supportDepthStencilTexture:!0,supportShadowSamplers:!0,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:!0,trackUbosInFrame:!0,checkUbosContentBeforeUpload:!0,supportCSM:!0,basisNeedsPOT:!1,support3DTextures:!0,needTypeSuffixInShaderConstants:!0,supportMSAA:!0,supportSSAO2:!0,supportExtendedTextureFormats:!0,supportSwitchCaseInShader:!0,supportSyncTextureRead:!1,needsInvertingBitmap:!1,useUBOBindingCache:!1,needShaderCodeInlining:!0,needToAlwaysBindUniformBuffers:!0,supportRenderPasses:!0,_collectUbosUpdatedInFrame:!1}},t.prototype._initializeContextAndSwapChain=function(){this._context=this._canvas.getContext("webgpu"),this._configureContext(),this._colorFormat=this._options.swapChainFormat,this._mainRenderPassWrapper.colorAttachmentGPUTextures=[new v.Z],this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].format=this._colorFormat},t.prototype._initializeMainAttachments=function(){var e;this._mainTextureExtends={width:this.getRenderWidth(),height:this.getRenderHeight(),depthOrArrayLayers:1};var t,r=new Float32Array([this.getRenderHeight()]);if(this._bufferManager.setSubData(this._ubInvertY,4,r),this._bufferManager.setSubData(this._ubDontInvertY,4,r),this._options.antialiasing){var n={size:this._mainTextureExtends,mipLevelCount:1,sampleCount:this._mainPassSampleCount,dimension:h.kd.E2d,format:this._options.swapChainFormat,usage:h.v2.RenderAttachment};null===(e=this._mainTexture)||void 0===e||e.destroy(),this._mainTexture=this._device.createTexture(n),t=[{view:this._mainTexture.createView(),clearValue:new o.HE(0,0,0,1),loadOp:h.Ws.Clear,storeOp:h.EG.Store}]}else t=[{view:void 0,clearValue:new o.HE(0,0,0,1),loadOp:h.Ws.Clear,storeOp:h.EG.Store}];this._mainRenderPassWrapper.depthTextureFormat=this.isStencilEnable?h.EV.Depth24PlusStencil8:h.EV.Depth32Float,this._setDepthTextureFormat(this._mainRenderPassWrapper);var i={size:this._mainTextureExtends,mipLevelCount:1,sampleCount:this._mainPassSampleCount,dimension:h.kd.E2d,format:this._mainRenderPassWrapper.depthTextureFormat,usage:h.v2.RenderAttachment};this._depthTexture&&this._depthTexture.destroy(),this._depthTexture=this._device.createTexture(i);var s={view:this._depthTexture.createView(),depthClearValue:this._clearDepthValue,depthLoadOp:h.Ws.Clear,depthStoreOp:h.EG.Store,stencilClearValue:this._clearStencilValue,stencilLoadOp:this.isStencilEnable?h.Ws.Clear:void 0,stencilStoreOp:this.isStencilEnable?h.EG.Store:void 0};this._mainRenderPassWrapper.renderPassDescriptor={colorAttachments:t,depthStencilAttachment:s},null!==this._mainRenderPassWrapper.renderPass&&this._endMainRenderPass()},t.prototype._configureContext=function(){this._context.configure({device:this._device,format:this._options.swapChainFormat,usage:h.v2.RenderAttachment|h.v2.CopySrc,compositingAlphaMode:this.premultipliedAlpha?h.nw.Premultiplied:h.nw.Opaque})},t.prototype.setSize=function(t,r,n){return void 0===n&&(n=!1),!!e.prototype.setSize.call(this,t,r,n)&&(this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||(this._count,this.dbgVerboseLogsNumFrames)),this._initializeMainAttachments(),this.snapshotRendering&&this.snapshotRenderingReset(),!0)},t.prototype._getShaderProcessor=function(e){return e===N.x.WGSL?this._shaderProcessorWGSL:this._shaderProcessor},t.prototype._getShaderProcessingContext=function(e){return new f.d(e)},t.prototype.applyStates=function(){this._stencilStateComposer.apply(),this._cacheRenderPipeline.setAlphaBlendEnabled(this._alphaState.alphaBlend)},t.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._forceEnableEffect=!0,this._currentIndexBuffer=null,this._currentOverrideVertexBuffers=null,this._cacheRenderPipeline.setBuffers(null,null,null),e&&(this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=515,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters,this._alphaState._blendEquationParameters),this._cacheRenderPipeline.setAlphaBlendEnabled(!1),this.setColorWrite(!0)),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},t.prototype.setColorWrite=function(e){this._colorWriteLocal=e,this._cacheRenderPipeline.setWriteMask(e?15:0)},t.prototype.getColorWrite=function(){return this._colorWriteLocal},t.prototype._resetCurrentViewport=function(e){this._viewportsCurrent[e].x=0,this._viewportsCurrent[e].y=0,this._viewportsCurrent[e].w=0,this._viewportsCurrent[e].h=0,1===e&&(this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0)},t.prototype._mustUpdateViewport=function(e){var t=e===this._mainRenderPassWrapper.renderPass?0:1,r=this._viewportCached.x,n=this._viewportCached.y,i=this._viewportCached.z,s=this._viewportCached.w,o=this._viewportsCurrent[t].x!==r||this._viewportsCurrent[t].y!==n||this._viewportsCurrent[t].w!==i||this._viewportsCurrent[t].h!==s;return o&&(this._viewportsCurrent[t].x=this._viewportCached.x,this._viewportsCurrent[t].y=this._viewportCached.y,this._viewportsCurrent[t].w=this._viewportCached.z,this._viewportsCurrent[t].h=this._viewportCached.w),o},t.prototype._applyViewport=function(e){var t=Math.floor(this._viewportCached.y),r=Math.floor(this._viewportCached.w);this._currentRenderTarget||(t=this.getRenderHeight()-t-r),e.setViewport(Math.floor(this._viewportCached.x),t,Math.floor(this._viewportCached.z),r,0,1),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||(this._count,this.dbgVerboseLogsNumFrames))},t.prototype._viewport=function(e,t,r,n){this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=n},t.prototype._resetCurrentScissor=function(e){this._scissorsCurrent[e].x=0,this._scissorsCurrent[e].y=0,this._scissorsCurrent[e].w=0,this._scissorsCurrent[e].h=0},t.prototype._mustUpdateScissor=function(e){var t=e===this._mainRenderPassWrapper.renderPass?0:1,r=this._scissorCached.x,n=this._scissorCached.y,i=this._scissorCached.z,s=this._scissorCached.w,o=this._scissorsCurrent[t].x!==r||this._scissorsCurrent[t].y!==n||this._scissorsCurrent[t].w!==i||this._scissorsCurrent[t].h!==s;return o&&(this._scissorsCurrent[t].x=this._scissorCached.x,this._scissorsCurrent[t].y=this._scissorCached.y,this._scissorsCurrent[t].w=this._scissorCached.z,this._scissorsCurrent[t].h=this._scissorCached.w),o},t.prototype._applyScissor=function(e){e.setScissorRect(this._scissorCached.x,this._currentRenderTarget?this._scissorCached.y:this.getRenderHeight()-this._scissorCached.w-this._scissorCached.y,this._scissorCached.z,this._scissorCached.w),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||(this._count,this.dbgVerboseLogsNumFrames))},t.prototype._scissorIsActive=function(){return 0!==this._scissorCached.x||0!==this._scissorCached.y||0!==this._scissorCached.z||0!==this._scissorCached.w},t.prototype.enableScissor=function(e,t,r,n){this._scissorCached.x=e,this._scissorCached.y=t,this._scissorCached.z=r,this._scissorCached.w=n},t.prototype.disableScissor=function(){this._scissorCached.x=0,this._scissorCached.y=0,this._scissorCached.z=0,this._scissorCached.w=0,this._resetCurrentScissor(0),this._resetCurrentScissor(1)},t.prototype._resetCurrentStencilRef=function(e){this._stencilRefsCurrent[e]=-1},t.prototype._mustUpdateStencilRef=function(e){var t=e===this._mainRenderPassWrapper.renderPass?0:1,r=this._stencilStateComposer.funcRef!==this._stencilRefsCurrent[t];return r&&(this._stencilRefsCurrent[t]=this._stencilStateComposer.funcRef),r},t.prototype._applyStencilRef=function(e){var t;e.setStencilReference(null!==(t=this._stencilStateComposer.funcRef)&&void 0!==t?t:0)},t.prototype._resetCurrentColorBlend=function(e){this._blendColorsCurrent[e][0]=this._blendColorsCurrent[e][1]=this._blendColorsCurrent[e][2]=this._blendColorsCurrent[e][3]=null},t.prototype._mustUpdateBlendColor=function(e){var t=e===this._mainRenderPassWrapper.renderPass?0:1,r=this._alphaState._blendConstants,n=r[0]!==this._blendColorsCurrent[t][0]||r[1]!==this._blendColorsCurrent[t][1]||r[2]!==this._blendColorsCurrent[t][2]||r[3]!==this._blendColorsCurrent[t][3];return n&&(this._blendColorsCurrent[t][0]=r[0],this._blendColorsCurrent[t][1]=r[1],this._blendColorsCurrent[t][2]=r[2],this._blendColorsCurrent[t][3]=r[3]),n},t.prototype._applyBlendColor=function(e){e.setBlendConstant(this._alphaState._blendConstants)},t.prototype.clear=function(e,t,r,n){void 0===n&&(n=!1),e&&void 0===e.a&&(e.a=1);var i=this._scissorIsActive();this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||(this._count,this.dbgVerboseLogsNumFrames)),this._currentRenderTarget?i?(this._rttRenderPassWrapper.renderPass||this._startRenderTargetRenderPass(this._currentRenderTarget,!1,t?e:null,r,n),this.compatibilityMode?this._applyScissor(this._currentRenderPass):this._bundleListRenderTarget.addItem(new P.me(this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w)),this._clearFullQuad(t?e:null,r,n)):(this._currentRenderPass&&this._endRenderTargetRenderPass(),this._startRenderTargetRenderPass(this._currentRenderTarget,!0,t?e:null,r,n)):(this._mainRenderPassWrapper.renderPass&&i||this._startMainRenderPass(!i,t?e:null,r,n),i&&(this.compatibilityMode?this._applyScissor(this._currentRenderPass):this._bundleList.addItem(new P.me(this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w)),this._clearFullQuad(t?e:null,r,n)))},t.prototype._clearFullQuad=function(e,t,r){var n,i,s,o=this.compatibilityMode?this._getCurrentRenderPass():null,a=0===this._getCurrentRenderPassIndex()?this._bundleList:this._bundleListRenderTarget;this._clearQuad.setColorFormat(this._colorFormat),this._clearQuad.setDepthStencilFormat(this._depthTextureFormat),this._clearQuad.setMRTAttachments(null!==(n=this._cacheRenderPipeline.mrtAttachments)&&void 0!==n?n:[],null!==(i=this._cacheRenderPipeline.mrtTextureArray)&&void 0!==i?i:[],this._cacheRenderPipeline.mrtTextureCount),this.compatibilityMode?o.setStencilReference(this._clearStencilValue):a.addItem(new P.vr(this._clearStencilValue));var u=this._clearQuad.clear(o,e,t,r,this.currentSampleCount);this.compatibilityMode?this._applyStencilRef(o):(a.addBundle(u),a.addItem(new P.vr(null!==(s=this._stencilStateComposer.funcRef)&&void 0!==s?s:0)),this._reportDrawCall())},t.prototype.createVertexBuffer=function(e){var t;return t=e instanceof Array?new Float32Array(e):e instanceof ArrayBuffer?new Uint8Array(e):e,this._bufferManager.createBuffer(t,h.FB.Vertex|h.FB.CopyDst)},t.prototype.createDynamicVertexBuffer=function(e){return this.createVertexBuffer(e)},t.prototype.createIndexBuffer=function(e){var t,r=!0;e instanceof Uint32Array||e instanceof Int32Array?t=e:e instanceof Uint16Array?(t=e,r=!1):e.length>65535?t=new Uint32Array(e):(t=new Uint16Array(e),r=!1);var n=this._bufferManager.createBuffer(t,h.FB.Index|h.FB.CopyDst);return n.is32Bits=r,n},t.prototype._createBuffer=function(e,t){var r;r=e instanceof Array?new Float32Array(e):e instanceof ArrayBuffer?new Uint8Array(e):e;var n=0;return 1&t&&(n|=h.FB.CopySrc),2&t&&(n|=h.FB.CopyDst),4&t&&(n|=h.FB.Uniform),8&t&&(n|=h.FB.Vertex),16&t&&(n|=h.FB.Index),32&t&&(n|=h.FB.Storage),this._bufferManager.createBuffer(r,n)},t.prototype.bindBuffersDirectly=function(){throw"Not implemented on WebGPU"},t.prototype.updateAndBindInstancesBuffer=function(){throw"Not implemented on WebGPU"},t.prototype.bindBuffers=function(e,t,r,n){this._currentIndexBuffer=t,this._currentOverrideVertexBuffers=null!=n?n:null,this._cacheRenderPipeline.setBuffers(e,t,this._currentOverrideVertexBuffers)},t.prototype._releaseBuffer=function(e){return this._bufferManager.releaseBuffer(e)},t.prototype.createEffect=function(e,t,r,n,i,s,o,a,u,h){var d;void 0===h&&(h=N.x.GLSL);var l=e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e,_=e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e,p=this._getGlobalDefines(),f=null!==(d=null!=i?i:t.defines)&&void 0!==d?d:"";p&&(f+="\n"+p);var m=l+"+"+_+"@"+f;if(this._compiledEffects[m]){var g=this._compiledEffects[m];return o&&g.isReady()&&o(g),g}var E=new c.Q(e,t,r,n,this,i,s,o,a,u,m,h);return this._compiledEffects[m]=E,E},t.prototype._compileRawShaderToSpirV=function(e,t){return this._glslang.compileGLSL(e,t)},t.prototype._compileShaderToSpirV=function(e,t,r,n){return this._compileRawShaderToSpirV(n+(r?r+"\n":"")+e,t)},t.prototype._getWGSLShader=function(e,t,r){return(r=r?"//"+r.split("\n").join("\n//")+"\n":"")+e},t.prototype._createPipelineStageDescriptor=function(e,t,r){return this._tintWASM&&r===N.x.GLSL&&(e=this._tintWASM.convertSpirV2WGSL(e),t=this._tintWASM.convertSpirV2WGSL(t)),{vertexStage:{module:this._device.createShaderModule({code:e}),entryPoint:"main"},fragmentStage:{module:this._device.createShaderModule({code:t}),entryPoint:"main"}}},t.prototype._compileRawPipelineStageDescriptor=function(e,t,r){var n=r===N.x.GLSL?this._compileRawShaderToSpirV(e,"vertex"):e,i=r===N.x.GLSL?this._compileRawShaderToSpirV(t,"fragment"):t;return this._createPipelineStageDescriptor(n,i,r)},t.prototype._compilePipelineStageDescriptor=function(e,t,r,n){this.onBeforeShaderCompilationObservable.notifyObservers(this);var i="#version 450\n",s=n===N.x.GLSL?this._compileShaderToSpirV(e,"vertex",r,i):this._getWGSLShader(e,"vertex",r),o=n===N.x.GLSL?this._compileShaderToSpirV(t,"fragment",r,i):this._getWGSLShader(t,"fragment",r),a=this._createPipelineStageDescriptor(s,o,n);return this.onAfterShaderCompilationObservable.notifyObservers(this),a},t.prototype.createRawShaderProgram=function(){throw"Not available on WebGPU"},t.prototype.createShaderProgram=function(){throw"Not available on WebGPU"},t.prototype.inlineShaderCode=function(e){var t=new I.Z(e);return t.debug=!1,t.processCode(),t.code},t.prototype.createPipelineContext=function(e){return new l.$(e,this)},t.prototype.createMaterialContext=function(){return new S.D},t.prototype.createDrawContext=function(){return new w.g(this._bufferManager)},t.prototype._preparePipelineContext=function(e,t,r,n,i,s,o,a){var u=e,c=u.shaderProcessingContext.shaderLanguage;this.dbgShowShaderCode,u.sources={fragment:r,vertex:t,rawVertex:i,rawFragment:s},u.stages=n?this._compileRawPipelineStageDescriptor(t,r,c):this._compilePipelineStageDescriptor(t,r,a,c)},t.prototype.getAttributes=function(e,t){for(var r=new Array(t.length),n=e,i=0;i<t.length;i++){var s=t[i],o=n.shaderProcessingContext.availableAttributes[s];void 0!==o&&(r[i]=o)}return r},t.prototype.enableEffect=function(e){if(e){var t=!0;if(R.q.IsWrapper(e)){if(!e.effect||e.effect===this._currentEffect&&e.materialContext===this._currentMaterialContext&&e.drawContext===this._currentDrawContext&&!this._forceEnableEffect){if(!e.effect&&this.dbgShowEmptyEnableEffectCalls)throw"Invalid call to enableEffect: the effect property is empty!";return}if(t=e.effect!==this._currentEffect,this._currentEffect=e.effect,this._currentMaterialContext=e.materialContext,this._currentDrawContext=e.drawContext,this._counters.numEnableDrawWrapper++,!this._currentMaterialContext)throw"Invalid call to enableEffect: the materialContext property is empty!"}else t=e!==this._currentEffect,this._currentEffect=e,this._currentMaterialContext=this._defaultMaterialContext,this._currentDrawContext=this._defaultDrawContext,this._counters.numEnableEffects++,this.dbgLogIfNotDrawWrapper&&i.Y.Warn("enableEffect has been called with an Effect and not a Wrapper! effect.uniqueId=".concat(e.uniqueId,", effect.name=").concat(e.name,", effect.name.vertex=").concat(e.name.vertex,", effect.name.fragment=").concat(e.name.fragment),10);this._stencilStateComposer.stencilMaterial=void 0,this._forceEnableEffect=!t&&!this._forceEnableEffect&&this._forceEnableEffect,t&&(this._currentEffect.onBind&&this._currentEffect.onBind(this._currentEffect),this._currentEffect._onBindObservable&&this._currentEffect._onBindObservable.notifyObservers(this._currentEffect))}},t.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},t.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},t.prototype._deletePipelineContext=function(e){e&&e.dispose()},Object.defineProperty(t.prototype,"needPOTTextures",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype._createHardwareTexture=function(){return new v.Z},t.prototype._releaseTexture=function(e){var t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),this._textureHelper.releaseTexture(e)},t.prototype._getRGBABufferInternalSizedFormat=function(){return 5},t.prototype.updateTextureComparisonFunction=function(e,t){e._comparisonFunction=t},t.prototype._createInternalTexture=function(e,t,r,n){var s,o,a;void 0===r&&(r=!0),void 0===n&&(n=u.S.Unknown);var c={};void 0!==t&&"object"==typeof t?(c.generateMipMaps=t.generateMipMaps,c.type=void 0===t.type?0:t.type,c.samplingMode=void 0===t.samplingMode?3:t.samplingMode,c.format=void 0===t.format?5:t.format,c.samples=null!==(s=t.samples)&&void 0!==s?s:1,c.creationFlags=null!==(o=t.creationFlags)&&void 0!==o?o:0,c.useSRGBBuffer=null!==(a=t.useSRGBBuffer)&&void 0!==a&&a):(c.generateMipMaps=t,c.type=0,c.samplingMode=3,c.format=5,c.samples=1,c.creationFlags=0,c.useSRGBBuffer=!1),(1!==c.type||this._caps.textureFloatLinearFiltering)&&(2!==c.type||this._caps.textureHalfFloatLinearFiltering)||(c.samplingMode=1),1!==c.type||this._caps.textureFloat||(c.type=0,i.Y.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));var h=new u.l(this,n),d=e.width||e,l=e.height||e,_=e.layers||0;return h.baseWidth=d,h.baseHeight=l,h.width=d,h.height=l,h.depth=_,h.isReady=!0,h.samples=c.samples,h.generateMipMaps=!!c.generateMipMaps,h.samplingMode=c.samplingMode,h.type=c.type,h.format=c.format,h.is2DArray=_>0,h._cachedWrapU=0,h._cachedWrapV=0,h._useSRGBBuffer=c.useSRGBBuffer,this._internalTexturesCache.push(h),r||this._textureHelper.createGPUTextureForInternalTexture(h,d,l,_||1,c.creationFlags),h},t.prototype.createTexture=function(e,t,r,n,i,s,o,a,u,c,h,d,l,_,p){var f=this;return void 0===i&&(i=3),void 0===s&&(s=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===h&&(h=null),this._createTextureBase(e,t,r,n,i,s,o,(function(e,t,r,n,i,s,o,a){var u,h=n;if(e.baseWidth=h.width,e.baseHeight=h.height,e.width=h.width,e.height=h.height,e.format=null!=c?c:-1,a(e.width,e.height,h,t,e,(function(){})),null===(u=e._hardwareTexture)||void 0===u?void 0:u.underlyingResource)s||o||f._generateMipmaps(e,f._uploadEncoder);else{var d=f._textureHelper.createGPUTextureForInternalTexture(e,h.width,h.height,void 0,_);g.D.IsImageBitmap(h)&&(f._textureHelper.updateTexture(h,e,h.width,h.height,e.depth,d.format,0,0,i,!1,0,0),s||o||f._generateMipmaps(e,f._uploadEncoder))}r&&r._removePendingData(e),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}),(function(){return!1}),a,u,c,h,d,l,p)},t.prototype.wrapWebGPUTexture=function(e){var t=new v.Z(e),r=new u.l(this,u.S.Unknown,!0);return r._hardwareTexture=t,r.isReady=!0,r},t.prototype.wrapWebGLTexture=function(){throw new Error("wrapWebGLTexture is not supported, use wrapWebGPUTexture instead.")},t.prototype.generateMipMapsForCubemap=function(e){var t;e.generateMipMaps&&((null===(t=e._hardwareTexture)||void 0===t?void 0:t.underlyingResource)||this._textureHelper.createGPUTextureForInternalTexture(e),this._generateMipmaps(e,e.source===u.S.RenderTarget||e.source===u.S.MultiRenderTarget?this._renderTargetEncoder:void 0))},t.prototype.updateTextureSamplingMode=function(e,t,r){void 0===r&&(r=!1),r&&(t.generateMipMaps=!0,this._generateMipmaps(t)),t.samplingMode=e},t.prototype.updateTextureWrappingMode=function(e,t,r,n){void 0===r&&(r=null),void 0===n&&(n=null),null!==t&&(e._cachedWrapU=t),null!==r&&(e._cachedWrapV=r),(e.is2DArray||e.is3D)&&null!==n&&(e._cachedWrapR=n)},t.prototype.updateTextureDimensions=function(e,t,r,n){if(void 0===n&&(n=1),e._hardwareTexture&&(e.width!==t||e.height!==r||e.depth!==n)){var i=e._hardwareTexture.textureAdditionalUsages;e._hardwareTexture.release(),this._textureHelper.createGPUTextureForInternalTexture(e,t,r,n,i)}},t.prototype._setInternalTexture=function(e,t,r){if(r=null!=r?r:e,this._currentEffect){var n=this._currentEffect._pipelineContext.shaderProcessingContext.availableTextures[r];if(this._currentMaterialContext.setTexture(e,t),n&&n.autoBindSampler){var i=r+U.e.AutoSamplerSuffix;this._currentMaterialContext.setSampler(i,t)}}},t.prototype.setTexture=function(e,t,r,n){this._setTexture(e,r,!1,!1,n,n)},t.prototype.setTextureArray=function(e,t,r,n){for(var i=0;i<r.length;i++)this._setTexture(-1,r[i],!0,!1,n+i.toString(),n)},t.prototype._setTexture=function(e,t,r,n,i,s){if(void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===i&&(i=""),s=null!=s?s:i,this._currentEffect){if(!t)return this._currentMaterialContext.setTexture(i,null),!1;if(t.video)t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;var o=null;if((o=n?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture)&&!o.isMultiview){if(o.isCube&&o._cachedCoordinatesMode!==t.coordinatesMode){o._cachedCoordinatesMode=t.coordinatesMode;var a=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=a,t.wrapV=a}o._cachedWrapU=t.wrapU,o._cachedWrapV=t.wrapV,o.is3D&&(o._cachedWrapR=t.wrapR),this._setAnisotropicLevel(0,o,t.anisotropicFilteringLevel)}this._setInternalTexture(i,o,s)}else this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||(this._count,this.dbgVerboseLogsNumFrames));return!0},t.prototype._setAnisotropicLevel=function(e,t,r){t._cachedAnisotropicFilteringLevel!==r&&(t._cachedAnisotropicFilteringLevel=Math.min(r,this._caps.maxAnisotropy))},t.prototype._bindTexture=function(e,t,r){void 0!==e&&this._setInternalTexture(r,t)},t.prototype.generateMipmaps=function(e){this._generateMipmaps(e,this._renderTargetEncoder)},t.prototype._generateMipmaps=function(e,t){var r=e._hardwareTexture;if(r){t=null!=t?t:this._currentRenderTarget&&!this._currentRenderPass?this._renderTargetEncoder:this._currentRenderPass?this._uploadEncoder:this._renderEncoder;var n=e._hardwareTexture.format,i=g.D.ComputeNumMipmapLevels(e.width,e.height);this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||(this._count,this.dbgVerboseLogsNumFrames)),e.isCube?this._textureHelper.generateCubeMipmaps(r,n,i,t):this._textureHelper.generateMipmaps(r,n,i,0,t)}},t.prototype.updateTextureData=function(e,t,r,n,i,s,o,a,u){var c;void 0===o&&(o=0),void 0===a&&(a=0),void 0===u&&(u=!1);var h=e._hardwareTexture;(null===(c=e._hardwareTexture)||void 0===c?void 0:c.underlyingResource)||(h=this._textureHelper.createGPUTextureForInternalTexture(e));var d=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(d,e,i,s,e.depth,h.format,o,a,e.invertY,!1,r,n),u&&this._generateMipmaps(e,this._renderTargetEncoder)},t.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,n,i,s,o){var a;void 0===s&&(s=0),void 0===o&&(o=0);var u=e._hardwareTexture;(null===(a=e._hardwareTexture)||void 0===a?void 0:a.underlyingResource)||(e.format=t,u=this._textureHelper.createGPUTextureForInternalTexture(e,r,n));var c=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);this._textureHelper.updateTexture(c,e,r,n,e.depth,u.format,s,o,!1,!1,0,0)},t.prototype._uploadDataToTextureDirectly=function(e,t,r,n,i,s){var o;void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=!1);var a=Math.round(Math.log(e.width)*Math.LOG2E),u=Math.round(Math.log(e.height)*Math.LOG2E),c=s?e.width:Math.pow(2,Math.max(a-n,0)),h=s?e.height:Math.pow(2,Math.max(u-n,0)),d=e._hardwareTexture;(null===(o=e._hardwareTexture)||void 0===o?void 0:o.underlyingResource)||(d=this._textureHelper.createGPUTextureForInternalTexture(e,c,h));var l=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(l,e,c,h,e.depth,d.format,r,n,e.invertY,!1,0,0)},t.prototype._uploadArrayBufferViewToTexture=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this._uploadDataToTextureDirectly(e,t,r,n)},t.prototype._uploadImageToTexture=function(e,t,r,n){var i;void 0===r&&(r=0),void 0===n&&(n=0);var s=e._hardwareTexture;(null===(i=e._hardwareTexture)||void 0===i?void 0:i.underlyingResource)||(s=this._textureHelper.createGPUTextureForInternalTexture(e));var o=t,a=Math.ceil(e.width/(1<<n)),u=Math.ceil(e.height/(1<<n));this._textureHelper.updateTexture(o,e,a,u,e.depth,s.format,r,n,e.invertY,!1,0,0)},t.prototype.readPixels=function(e,t,r,n,i,s){void 0===i&&(i=!0),void 0===s&&(s=!0);var o=(this._rttRenderPassWrapper.renderPass?this._rttRenderPassWrapper:this._mainRenderPassWrapper).colorAttachmentGPUTextures[0];if(!o)return Promise.resolve(new Uint8Array(0));var a=o.underlyingResource,u=o.format;return a?(s&&this.flushFramebuffer(),this._textureHelper.readPixels(a,e,t,r,n,u)):Promise.resolve(new Uint8Array(0))},t.prototype.beginFrame=function(){e.prototype.beginFrame.call(this)},t.prototype.endFrame=function(){if(this._snapshotRendering.endFrame(this._mainRenderPassWrapper.renderPass),this._endMainRenderPass(),this._timestampQuery.endFrame(this._renderEncoder),this.flushFramebuffer(!1),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||(this._count,this.dbgVerboseLogsNumFrames)),this._textureHelper.destroyDeferredTextures(),this._bufferManager.destroyDeferredBuffers(),this._features._collectUbosUpdatedInFrame){if(this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||this._count<this.dbgVerboseLogsNumFrames)){var t=[];for(var r in T.M._UpdatedUbosInFrame)t.push(r+":"+T.M._UpdatedUbosInFrame[r])}T.M._UpdatedUbosInFrame={}}this.countersLastFrame.numEnableEffects=this._counters.numEnableEffects,this.countersLastFrame.numEnableDrawWrapper=this._counters.numEnableDrawWrapper,this.countersLastFrame.numBundleCreationNonCompatMode=this._counters.numBundleCreationNonCompatMode,this.countersLastFrame.numBundleReuseNonCompatMode=this._counters.numBundleReuseNonCompatMode,this._counters.numEnableEffects=0,this._counters.numEnableDrawWrapper=0,this._counters.numBundleCreationNonCompatMode=0,this._counters.numBundleReuseNonCompatMode=0,this._cacheRenderPipeline.endFrame(),this._cacheBindGroups.endFrame(),this._pendingDebugCommands.length=0,e.prototype.endFrame.call(this),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),this._count,this.dbgVerboseLogsNumFrames,this._count<this.dbgVerboseLogsNumFrames&&(this._count++,this._count,this.dbgVerboseLogsNumFrames))},t.prototype.flushFramebuffer=function(e){void 0===e&&(e=!0);var t=!this._currentRenderPass,r=0;this._currentRenderPass&&this._currentRenderTarget&&(r|=1,this._endRenderTargetRenderPass()),this._mainRenderPassWrapper.renderPass&&(r|=2,this._endMainRenderPass()),this._commandBuffers[0]=this._uploadEncoder.finish(),this._commandBuffers[1]=this._renderTargetEncoder.finish(),this._commandBuffers[2]=this._renderEncoder.finish(),this._device.queue.submit(this._commandBuffers),this._uploadEncoder=this._device.createCommandEncoder(this._uploadEncoderDescriptor),this._renderEncoder=this._device.createCommandEncoder(this._renderEncoderDescriptor),this._renderTargetEncoder=this._device.createCommandEncoder(this._renderTargetEncoderDescriptor),this._timestampQuery.startFrame(this._uploadEncoder),this._textureHelper.setCommandEncoder(this._uploadEncoder),this._bundleList.reset(),this._bundleListRenderTarget.reset(),e&&(2&r&&this._startMainRenderPass(!1),1&r&&this._startRenderTargetRenderPass(this._currentRenderTarget,!1,null,!1,!1),t&&this._currentRenderTarget&&(this._currentRenderPass=null))},t.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return null===this._currentRenderTarget},t.prototype._startRenderTargetRenderPass=function(e,t,r,i,s){var o,a,u,c=e,d=c._depthStencilTexture,l=null==d?void 0:d._hardwareTexture,_=null==l?void 0:l.underlyingResource,p=null==l?void 0:l.msaaTexture,f=null==_?void 0:_.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor),m=null==p?void 0:p.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor),E=!!l&&g.D.HasStencilAspect(l.format),v=[];this.useReverseDepthBuffer&&this.setDepthFunctionToGreaterOrEqual();var T=t&&r,y=t&&i,x=t&&s;if(c._attachments&&c.isMulti){this._mrtAttachments&&0!==this._mrtAttachments.length||(this._mrtAttachments=c._defaultAttachments);for(var b=0;b<this._mrtAttachments.length;++b){var C=this._mrtAttachments[b],A=c.textures[b],R=null==A?void 0:A._hardwareTexture,S=null==R?void 0:R.underlyingResource;if(R&&S){var w=(0,n.pi)((0,n.pi)({},this._rttRenderPassWrapper.colorAttachmentViewDescriptor),{format:R.format}),B=R.msaaTexture,F=S.createView(w),P=null==B?void 0:B.createView(w);v.push({view:P||F,resolveTarget:B?F:void 0,clearValue:0!==C&&T?r:void 0,loadOp:0!==C&&T?h.Ws.Clear:h.Ws.Load,storeOp:h.EG.Store})}}this._cacheRenderPipeline.setMRT(c.textures,this._mrtAttachments.length),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)}else{if(D=c.texture){var M=D._hardwareTexture,L=M.underlyingResource;B=M.msaaTexture,F=L.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor),P=null==B?void 0:B.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor);v.push({view:P||F,resolveTarget:B?F:void 0,clearValue:T?r:void 0,loadOp:T?h.Ws.Clear:h.Ws.Load,storeOp:h.EG.Store})}else v.push(null)}if(null===(o=this._debugPushGroup)||void 0===o||o.call(this,"render target pass",1),this._rttRenderPassWrapper.renderPassDescriptor={colorAttachments:v,depthStencilAttachment:d&&_?{view:m||f,depthClearValue:y?this.useReverseDepthBuffer?this._clearReverseDepthValue:this._clearDepthValue:void 0,depthLoadOp:y?h.Ws.Clear:h.Ws.Load,depthStoreOp:h.EG.Store,stencilClearValue:c._depthStencilTextureWithStencil&&x?this._clearStencilValue:void 0,stencilLoadOp:E?c._depthStencilTextureWithStencil&&x?h.Ws.Clear:h.Ws.Load:void 0,stencilStoreOp:E?h.EG.Store:void 0}:void 0,occlusionQuerySet:(null===(a=this._occlusionQuery)||void 0===a?void 0:a.hasQueries)?this._occlusionQuery.querySet:void 0},this._rttRenderPassWrapper.renderPass=this._renderTargetEncoder.beginRenderPass(this._rttRenderPassWrapper.renderPassDescriptor),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||this._count<this.dbgVerboseLogsNumFrames))var D=c.texture;this._currentRenderPass=this._rttRenderPassWrapper.renderPass,null===(u=this._debugFlushPendingCommands)||void 0===u||u.call(this),this._resetCurrentViewport(1),this._resetCurrentScissor(1),this._resetCurrentStencilRef(1),this._resetCurrentColorBlend(1),l&&g.D.HasStencilAspect(l.format)||(this._stencilStateComposer.enabled=!1)},t.prototype._endRenderTargetRenderPass=function(){var e,t;if(this._currentRenderPass){var r=null===(e=this._currentRenderTarget.texture)||void 0===e?void 0:e._hardwareTexture;!r||this._snapshotRendering.endRenderTargetPass(this._currentRenderPass,r)||this.compatibilityMode||(this._bundleListRenderTarget.run(this._currentRenderPass),this._bundleListRenderTarget.reset()),this._currentRenderPass.end(),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||(this._count,this.dbgVerboseLogsNumFrames)),null===(t=this._debugPopGroup)||void 0===t||t.call(this,1),this._resetCurrentViewport(1),this._resetCurrentScissor(1),this._resetCurrentStencilRef(1),this._resetCurrentColorBlend(1),this._currentRenderPass=null,this._rttRenderPassWrapper.reset()}},t.prototype._getCurrentRenderPass=function(){return this._currentRenderTarget&&!this._currentRenderPass?this._startRenderTargetRenderPass(this._currentRenderTarget,!1,null,!1,!1):this._currentRenderPass||this._startMainRenderPass(!1),this._currentRenderPass},t.prototype._getCurrentRenderPassIndex=function(){return null===this._currentRenderPass?-1:this._currentRenderPass===this._mainRenderPassWrapper.renderPass?0:1},t.prototype._startMainRenderPass=function(e,t,r,n){var i,s,o;this._mainRenderPassWrapper.renderPass&&this._endMainRenderPass(),this.useReverseDepthBuffer&&this.setDepthFunctionToGreaterOrEqual();var a=e&&t,u=e&&r,c=e&&n;this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].clearValue=a?t:void 0,this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].loadOp=a?h.Ws.Clear:h.Ws.Load,this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.depthClearValue=u?this.useReverseDepthBuffer?this._clearReverseDepthValue:this._clearDepthValue:void 0,this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.depthLoadOp=u?h.Ws.Clear:h.Ws.Load,this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.stencilClearValue=c?this._clearStencilValue:void 0,this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.stencilLoadOp=this.isStencilEnable?c?h.Ws.Clear:h.Ws.Load:void 0,this._mainRenderPassWrapper.renderPassDescriptor.occlusionQuerySet=(null===(i=this._occlusionQuery)||void 0===i?void 0:i.hasQueries)?this._occlusionQuery.querySet:void 0,this._swapChainTexture=this._context.getCurrentTexture(),this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].set(this._swapChainTexture),this._options.antialiasing?this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].resolveTarget=this._swapChainTexture.createView():this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].view=this._swapChainTexture.createView(),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||(this._count,this.dbgVerboseLogsNumFrames)),null===(s=this._debugPushGroup)||void 0===s||s.call(this,"main pass",0),this._currentRenderPass=this._renderEncoder.beginRenderPass(this._mainRenderPassWrapper.renderPassDescriptor),this._mainRenderPassWrapper.renderPass=this._currentRenderPass,null===(o=this._debugFlushPendingCommands)||void 0===o||o.call(this),this._resetCurrentViewport(0),this._resetCurrentScissor(0),this._resetCurrentStencilRef(0),this._resetCurrentColorBlend(0),this._isStencilEnable||(this._stencilStateComposer.enabled=!1)},t.prototype._endMainRenderPass=function(){var e;null!==this._mainRenderPassWrapper.renderPass&&(this._snapshotRendering.endMainRenderPass(),this.compatibilityMode||this._snapshotRendering.play||(this._bundleList.run(this._mainRenderPassWrapper.renderPass),this._bundleList.reset()),this._mainRenderPassWrapper.renderPass.end(),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||(this._count,this.dbgVerboseLogsNumFrames)),null===(e=this._debugPopGroup)||void 0===e||e.call(this,0),this._resetCurrentViewport(0),this._resetCurrentScissor(0),this._resetCurrentStencilRef(0),this._resetCurrentColorBlend(0),this._mainRenderPassWrapper.renderPass===this._currentRenderPass&&(this._currentRenderPass=null),this._mainRenderPassWrapper.reset(!1))},t.prototype.bindFramebuffer=function(e,t,r,n,i,s,o){var a;void 0===t&&(t=0),void 0===s&&(s=0),void 0===o&&(o=0);var u=null===(a=e.texture)||void 0===a?void 0:a._hardwareTexture;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,u&&(u._currentLayer=e.isCube?6*o+t:o),this._rttRenderPassWrapper.colorAttachmentGPUTextures[0]=u,this._rttRenderPassWrapper.depthTextureFormat=this._currentRenderTarget._depthStencilTexture?g.D.GetWebGPUTextureFormat(-1,this._currentRenderTarget._depthStencilTexture.format):void 0,this._setDepthTextureFormat(this._rttRenderPassWrapper),this._setColorFormat(this._rttRenderPassWrapper),this._rttRenderPassWrapper.colorAttachmentViewDescriptor={format:this._colorFormat,dimension:h.p_.E2d,mipLevelCount:1,baseArrayLayer:e.isCube?6*o+t:o,baseMipLevel:s,arrayLayerCount:1,aspect:h.H7.All},this._rttRenderPassWrapper.depthAttachmentViewDescriptor={format:this._depthTextureFormat,dimension:h.p_.E2d,mipLevelCount:1,baseArrayLayer:e.isCube?6*o+t:o,baseMipLevel:0,arrayLayerCount:1,aspect:h.H7.All},this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||(this._count,this.dbgVerboseLogsNumFrames)),this._currentRenderPass=null,this.snapshotRendering&&1===this.snapshotRenderingMode&&this._getCurrentRenderPass(),this._cachedViewport&&!i?this.setViewport(this._cachedViewport,r,n):(r||(r=e.width,s&&(r/=Math.pow(2,s))),n||(n=e.height,s&&(n/=Math.pow(2,s))),this._viewport(0,0,r,n)),this.wipeCaches()},t.prototype.unBindFramebuffer=function(e,t,r){var n;void 0===t&&(t=!1);var i=this._currentRenderTarget;this._currentRenderTarget=null,r&&r(),this._currentRenderTarget=i,this._currentRenderPass&&this._currentRenderPass!==this._mainRenderPassWrapper.renderPass&&this._endRenderTargetRenderPass(),!(null===(n=e.texture)||void 0===n?void 0:n.generateMipMaps)||t||e.isCube||this._generateMipmaps(e.texture),this._currentRenderTarget=null,this._onAfterUnbindFrameBufferObservable.notifyObservers(this),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||(this._count,this.dbgVerboseLogsNumFrames)),this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments),this._currentRenderPass=this._mainRenderPassWrapper.renderPass,this._setDepthTextureFormat(this._mainRenderPassWrapper),this._setColorFormat(this._mainRenderPassWrapper)},t.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):(this._currentRenderPass=this._mainRenderPassWrapper.renderPass,this._setDepthTextureFormat(this._mainRenderPassWrapper),this._setColorFormat(this._mainRenderPassWrapper)),this._currentRenderPass&&this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},t.prototype._setColorFormat=function(e){var t,r,n=null!==(r=null===(t=e.colorAttachmentGPUTextures[0])||void 0===t?void 0:t.format)&&void 0!==r?r:null;this._cacheRenderPipeline.setColorFormat(n),this._colorFormat!==n&&(this._colorFormat=n)},t.prototype._setDepthTextureFormat=function(e){this._cacheRenderPipeline.setDepthStencilFormat(e.depthTextureFormat),this._depthTextureFormat!==e.depthTextureFormat&&(this._depthTextureFormat=e.depthTextureFormat)},t.prototype.setDitheringState=function(){},t.prototype.setRasterizerState=function(){},t.prototype.setState=function(e,t,r,n,i,s,o){var a,u;void 0===t&&(t=0),void 0===n&&(n=!1),void 0===o&&(o=0),(this._depthCullingState.cull!==e||r)&&(this._depthCullingState.cull=e);var c=null===(u=null!==(a=this.cullBackFaces)&&void 0!==a?a:i)||void 0===u||u?1:2;(this._depthCullingState.cullFace!==c||r)&&(this._depthCullingState.cullFace=c),this.setZOffset(t),this.setZOffsetUnits(o);var h=n?this._currentRenderTarget?1:2:this._currentRenderTarget?2:1;(this._depthCullingState.frontFace!==h||r)&&(this._depthCullingState.frontFace=h),this._stencilStateComposer.stencilMaterial=s},t.prototype._applyRenderPassChanges=function(e,t){var r,n=this._mustUpdateViewport(e),i=this._mustUpdateScissor(e),s=!!this._stencilStateComposer.enabled&&this._mustUpdateStencilRef(e),o=!!this._alphaState.alphaBlend&&this._mustUpdateBlendColor(e);t?(n&&t.addItem(new P.fv(this._viewportCached.x,this._viewportCached.y,this._viewportCached.z,this._viewportCached.w)),i&&t.addItem(new P.me(this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w)),s&&t.addItem(new P.vr(null!==(r=this._stencilStateComposer.funcRef)&&void 0!==r?r:0)),o&&t.addItem(new P.kP(this._alphaState._blendConstants.slice()))):(n&&this._applyViewport(e),i&&this._applyScissor(e),s&&this._applyStencilRef(e),o&&this._applyBlendColor(e))},t.prototype._draw=function(e,t,r,n,i){var s,o=this._getCurrentRenderPass(),a=0===this._getCurrentRenderPassIndex()?this._bundleList:this._bundleListRenderTarget;this.applyStates();var u=this._currentEffect._pipelineContext;if(this.bindUniformBufferBase(this._currentRenderTarget?this._ubInvertY:this._ubDontInvertY,0,U.e.InternalsUBOName),u.uniformBuffer&&(u.uniformBuffer.update(),this.bindUniformBufferBase(u.uniformBuffer.getBuffer(),0,U.e.LeftOvertUBOName)),this._snapshotRendering.play)this._reportDrawCall();else{!this.compatibilityMode&&(this._currentDrawContext.isDirty(this._currentMaterialContext.updateId)||this._currentMaterialContext.isDirty||this._currentMaterialContext.forceBindGroupCreation)&&(this._currentDrawContext.fastBundle=void 0);var c=o;if(!this.compatibilityMode&&this._currentDrawContext.fastBundle||this._snapshotRendering.record){if(this._applyRenderPassChanges(o,a),!this._snapshotRendering.record)return this._counters.numBundleReuseNonCompatMode++,this._currentDrawContext.indirectDrawBuffer&&this._currentDrawContext.setIndirectData(n,i||1,r),a.addBundle(this._currentDrawContext.fastBundle),void this._reportDrawCall();c=a.getBundleEncoder(this._cacheRenderPipeline.colorFormats,this._depthTextureFormat,this.currentSampleCount),a.numDrawCalls++}var d=0;if(!this._caps.textureFloatLinearFiltering&&this._currentMaterialContext.hasFloatTextures)for(var l=1,_=0;_<u.shaderProcessingContext.textureNames.length;++_){var p=u.shaderProcessingContext.textureNames[_],f=null===(s=this._currentMaterialContext.textures[p])||void 0===s?void 0:s.texture;1===(null==f?void 0:f.type)&&(d|=l),l<<=1}var m=this._cacheRenderPipeline.getRenderPipeline(t,this._currentEffect,this.currentSampleCount,d),g=this._cacheBindGroups.getBindGroups(u,this._currentDrawContext,this._currentMaterialContext);this._snapshotRendering.record||(this._applyRenderPassChanges(o,this.compatibilityMode?null:a),this.compatibilityMode||(this._counters.numBundleCreationNonCompatMode++,c=this._device.createRenderBundleEncoder({colorFormats:this._cacheRenderPipeline.colorFormats,depthStencilFormat:this._depthTextureFormat,sampleCount:this.currentSampleCount}))),c.setPipeline(m),this._currentIndexBuffer&&c.setIndexBuffer(this._currentIndexBuffer.underlyingResource,this._currentIndexBuffer.is32Bits?h.iD.Uint32:h.iD.Uint16,0);for(var E=this._cacheRenderPipeline.vertexBuffers,v=0;v<E.length;v++){var T=E[v],y=T.getBuffer();y&&c.setVertexBuffer(v,y.underlyingResource,T._validOffsetRange?0:T.byteOffset)}for(_=0;_<g.length;_++)c.setBindGroup(_,g[_]);var x=!this.compatibilityMode&&!this._snapshotRendering.record;x&&this._currentDrawContext.indirectDrawBuffer?(this._currentDrawContext.setIndirectData(n,i||1,r),0===e?c.drawIndexedIndirect(this._currentDrawContext.indirectDrawBuffer,0):c.drawIndirect(this._currentDrawContext.indirectDrawBuffer,0)):0===e?c.drawIndexed(n,i||1,r,0,0):c.draw(n,i||1,r,0),x&&(this._currentDrawContext.fastBundle=c.finish(),a.addBundle(this._currentDrawContext.fastBundle)),this._reportDrawCall()}},t.prototype.drawElementsType=function(e,t,r,n){void 0===n&&(n=1),this._draw(0,e,t,r,n)},t.prototype.drawArraysType=function(e,t,r,n){void 0===n&&(n=1),this._currentIndexBuffer=null,this._draw(1,e,t,r,n)},t.prototype.dispose=function(){var t,r,n;null===(t=this._mainTexture)||void 0===t||t.destroy(),null===(r=this._mainTextureLastCopy)||void 0===r||r.destroy(),null===(n=this._depthTexture)||void 0===n||n.destroy(),e.prototype.dispose.call(this)},t.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._canvas.width},t.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._canvas.height},t.prototype.getRenderingCanvas=function(){return this._canvas},t.prototype.getError=function(){return 0},t.prototype.bindSamplers=function(){},t.prototype._bindTextureDirectly=function(){return!1},t.prototype.areAllEffectsReady=function(){return!0},t.prototype._executeWhenRenderingStateIsCompiled=function(e,t){t()},t.prototype._isRenderingStateCompiled=function(){return!0},t.prototype._getUnpackAlignement=function(){return 1},t.prototype._unpackFlipY=function(){},t.prototype._bindUnboundFramebuffer=function(){throw"_bindUnboundFramebuffer is not implementedin WebGPU! You probably want to use restoreDefaultFramebuffer or unBindFramebuffer instead"},t.prototype._getSamplingParameters=function(){throw"_getSamplingParameters is not available in WebGPU"},t.prototype.getUniforms=function(){return[]},t.prototype.setIntArray=function(){return!1},t.prototype.setIntArray2=function(){return!1},t.prototype.setIntArray3=function(){return!1},t.prototype.setIntArray4=function(){return!1},t.prototype.setArray=function(){return!1},t.prototype.setArray2=function(){return!1},t.prototype.setArray3=function(){return!1},t.prototype.setArray4=function(){return!1},t.prototype.setMatrices=function(){return!1},t.prototype.setMatrix3x3=function(){return!1},t.prototype.setMatrix2x2=function(){return!1},t.prototype.setFloat=function(){return!1},t.prototype.setFloat2=function(){return!1},t.prototype.setFloat3=function(){return!1},t.prototype.setFloat4=function(){return!1},t._GLSLslangDefaultOptions={jsPath:"https://preview.babylonjs.com/glslang/glslang.js",wasmPath:"https://preview.babylonjs.com/glslang/glslang.wasm"},t.UseTWGSL=!0,t}(a.D)}}]);