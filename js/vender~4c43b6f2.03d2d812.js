"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[729],{27720:(e,t,r)=>{r.d(t,{R:()=>n});var i=r(31191),n=function(e){function t(t,r,i){var n=e.call(this,null)||this;return n._renderTarget=null,n._engine=t,n._renderTargetOptions=i,n.resize(r),n}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!1,configurable:!0}),t.prototype.resize=function(e){var t;null===(t=this._renderTarget)||void 0===t||t.dispose(),this._renderTarget=null,this._texture=null,this._size=e,this._engine&&(this._renderTarget=this._engine.createRenderTargetTexture(this._size,this._renderTargetOptions)),this._texture=this.renderTarget.texture},t.prototype.getInternalTexture=function(){return this._texture},t.prototype.getClassName=function(){return"ThinRenderTargetTexture"},t.prototype.dispose=function(e){var t;void 0===e&&(e=!1),null===(t=this._renderTarget)||void 0===t||t.dispose(!0),this._renderTarget=null,e||this.dispose()},t}(r(58039).g)},58039:(e,t,r)=>{r.d(t,{g:()=>n});var i=r(76144),n=function(){function e(e){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=i.$.Zero(),this._cachedBaseSize=i.$.Zero(),this._initialSamplingMode=2,this._texture=e,this._texture&&(this._engine=this._texture.getEngine())}return Object.defineProperty(e.prototype,"wrapU",{get:function(){return this._wrapU},set:function(e){this._wrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapV",{get:function(){return this._wrapV},set:function(e){this._wrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinatesMode",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(e){this._texture&&(this._texture.isCube=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"ThinTexture"},e.prototype.isReady=function(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},e.prototype.delayLoad=function(){},e.prototype.getInternalTexture=function(){return this._texture},e.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},e.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)},Object.defineProperty(e.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!1,configurable:!0}),e.prototype.updateSamplingMode=function(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)},e.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},e.prototype.dispose=function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)},e}()},9100:(e,t,r)=>{r.d(t,{f:()=>l});var i=r(31191),n=r(62897),s=r(13514),o=r(84318),a=r(73803);r(52858),r(25008);function u(e){for(;e.firstChild;)e.removeChild(e.firstChild);e.srcObject=null,e.src="",e.removeAttribute("src")}var l=function(e){function t(t,r,n,o,u,l,h,f){void 0===o&&(o=!1),void 0===u&&(u=!1),void 0===l&&(l=a.x.TRILINEAR_SAMPLINGMODE),void 0===h&&(h={});var p=e.call(this,null,n,!o,u)||this;p._onUserActionRequestedObservable=null,p._stillImageCaptured=!1,p._displayingPosterTexture=!1,p._frameId=-1,p._currentSrc=null,p._errorFound=!1,p._createInternalTexture=function(){if(null!=p._texture){if(!p._displayingPosterTexture)return;p._texture.dispose(),p._displayingPosterTexture=!1}if(!p._getEngine().needPOTTextures||s.w1.IsExponentOfTwo(p.video.videoWidth)&&s.w1.IsExponentOfTwo(p.video.videoHeight)?(p.wrapU=a.x.WRAP_ADDRESSMODE,p.wrapV=a.x.WRAP_ADDRESSMODE):(p.wrapU=a.x.CLAMP_ADDRESSMODE,p.wrapV=a.x.CLAMP_ADDRESSMODE,p._generateMipMaps=!1),p._texture=p._getEngine().createDynamicTexture(p.video.videoWidth,p.video.videoHeight,p._generateMipMaps,p.samplingMode),p.video.autoplay||p._settings.poster)p._updateInternalTexture(),p.onLoadObservable.hasObservers()&&p.onLoadObservable.notifyObservers(p);else{var e=p.video.onplaying,t=p.video.muted;p.video.muted=!0,p.video.onplaying=function(){p.video.muted=t,p.video.onplaying=e,p._updateInternalTexture(),p._errorFound||p.video.pause(),p.onLoadObservable.hasObservers()&&p.onLoadObservable.notifyObservers(p)},p._handlePlay()}},p._reset=function(){null!=p._texture&&(p._displayingPosterTexture||(p._texture.dispose(),p._texture=null))},p._updateInternalTexture=function(){if(null!=p._texture&&!(p.video.readyState<p.video.HAVE_CURRENT_DATA||p._displayingPosterTexture)){var e=p.getScene().getFrameId();p._frameId!==e&&(p._frameId=e,p._getEngine().updateVideoTexture(p._texture,p.video,p._invertY))}},p._settings=(0,i.pi)({autoPlay:!0,loop:!0,autoUpdateTexture:!0},h),p._onError=f,p._generateMipMaps=o,p._initialSamplingMode=l,p.autoUpdateTexture=p._settings.autoUpdateTexture,p._currentSrc=r,p.name=t||p._getName(r),p.video=p._getVideo(r),p._settings.poster&&(p.video.poster=p._settings.poster),void 0!==p._settings.autoPlay&&(p.video.autoplay=p._settings.autoPlay),void 0!==p._settings.loop&&(p.video.loop=p._settings.loop),void 0!==p._settings.muted&&(p.video.muted=p._settings.muted),p.video.setAttribute("playsinline",""),p.video.addEventListener("paused",p._updateInternalTexture),p.video.addEventListener("seeked",p._updateInternalTexture),p.video.addEventListener("emptied",p._reset),p._createInternalTextureOnEvent=p._settings.poster&&!p._settings.autoPlay?"play":"canplay",p.video.addEventListener(p._createInternalTextureOnEvent,p._createInternalTexture),p._settings.autoPlay&&p._handlePlay();var c=p.video.readyState>=p.video.HAVE_CURRENT_DATA;return!p._settings.poster||p._settings.autoPlay&&c?c&&p._createInternalTexture():(p._texture=p._getEngine().createTexture(p._settings.poster,!1,!p.invertY,n),p._displayingPosterTexture=!0),p}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"onUserActionRequestedObservable",{get:function(){return this._onUserActionRequestedObservable||(this._onUserActionRequestedObservable=new n.y$),this._onUserActionRequestedObservable},enumerable:!1,configurable:!0}),t.prototype._processError=function(e){this._errorFound=!0,this._onError?this._onError(null==e?void 0:e.message):o.Y.Error(null==e?void 0:e.message)},t.prototype._handlePlay=function(){var e=this;this._errorFound=!1,this.video.play().catch((function(t){if("NotAllowedError"===(null==t?void 0:t.name)){if(e._onUserActionRequestedObservable&&e._onUserActionRequestedObservable.hasObservers())return void e._onUserActionRequestedObservable.notifyObservers(e);if(!e.video.muted)return o.Y.Warn("Unable to autoplay a video with sound. Trying again with muted turned true"),e.video.muted=!0,e._errorFound=!1,void e.video.play().catch((function(t){e._processError(t)}))}e._processError(t)}))},t.prototype.getClassName=function(){return"VideoTexture"},t.prototype._getName=function(e){return e instanceof HTMLVideoElement?e.currentSrc:"object"==typeof e?e.toString():e},t.prototype._getVideo=function(e){if(e.isNative)return e;if(e instanceof HTMLVideoElement)return s.w1.SetCorsBehavior(e.currentSrc,e),e;var t=document.createElement("video");return"string"==typeof e?(s.w1.SetCorsBehavior(e,t),t.src=e):(s.w1.SetCorsBehavior(e[0],t),e.forEach((function(e){var r=document.createElement("source");r.src=e,t.appendChild(r)}))),this.onDisposeObservable.addOnce((function(){u(t)})),t},t.prototype._rebuild=function(){this.update()},t.prototype.update=function(){this.autoUpdateTexture&&this.updateTexture(!0)},t.prototype.updateTexture=function(e){e&&(this.video.paused&&this._stillImageCaptured||(this._stillImageCaptured=!0,this._updateInternalTexture()))},t.prototype.updateURL=function(e){this.video.src=e,this._currentSrc=e},t.prototype.clone=function(){return new t(this.name,this._currentSrc,this.getScene(),this._generateMipMaps,this.invertY,this.samplingMode,this._settings)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._currentSrc=null,this._onUserActionRequestedObservable&&(this._onUserActionRequestedObservable.clear(),this._onUserActionRequestedObservable=null),this.video.removeEventListener(this._createInternalTextureOnEvent,this._createInternalTexture),this.video.removeEventListener("paused",this._updateInternalTexture),this.video.removeEventListener("seeked",this._updateInternalTexture),this.video.removeEventListener("emptied",this._reset),this.video.pause()},t.CreateFromStreamAsync=function(e,r,i,n){void 0===n&&(n=!0);var s=e.getEngine().createVideoElement(i);return e.getEngine()._badOS&&(document.body.appendChild(s),s.style.transform="scale(0.0001, 0.0001)",s.style.opacity="0",s.style.position="fixed",s.style.bottom="0px",s.style.right="0px"),s.setAttribute("autoplay",""),s.setAttribute("muted","true"),s.setAttribute("playsinline",""),s.muted=!0,void 0!==s.mozSrcObject?s.mozSrcObject=r:"object"==typeof s.srcObject?s.srcObject=r:(window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,s.src=window.URL&&window.URL.createObjectURL(r)),new Promise((function(r){var i=function(){var o=new t("video",s,e,!0,n);e.getEngine()._badOS&&o.onDisposeObservable.addOnce((function(){s.remove()})),o.onDisposeObservable.addOnce((function(){u(s)})),r(o),s.removeEventListener("playing",i)};s.addEventListener("playing",i),s.play()}))},t.CreateFromWebCamAsync=function(e,t,r,i){var n,s=this;if(void 0===r&&(r=!1),void 0===i&&(i=!0),t&&t.deviceId&&(n={exact:t.deviceId}),navigator.mediaDevices)return navigator.mediaDevices.getUserMedia({video:t,audio:r}).then((function(r){return s.CreateFromStreamAsync(e,r,t,i)}));var a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return a&&a({video:{deviceId:n,width:{min:t&&t.minWidth||256,max:t&&t.maxWidth||640},height:{min:t&&t.minHeight||256,max:t&&t.maxHeight||480}},audio:r},(function(r){return s.CreateFromStreamAsync(e,r,t,i)}),(function(e){o.Y.Error(e.name)})),Promise.reject("No support for userMedia on this device")},t.CreateFromWebCam=function(e,t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=!0),this.CreateFromWebCamAsync(e,r,i,n).then((function(e){t&&t(e)})).catch((function(e){o.Y.Error(e.name)}))},t}(a.x)},36195:(e,t,r)=>{r.d(t,{U:()=>o});var i=r(31191),n=r(96969),s=r(15631),o=function(){function e(){this._dirty=!0,this._tempColor=new s.HE(0,0,0,0),this._globalCurve=new s.HE(0,0,0,0),this._highlightsCurve=new s.HE(0,0,0,0),this._midtonesCurve=new s.HE(0,0,0,0),this._shadowsCurve=new s.HE(0,0,0,0),this._positiveCurve=new s.HE(0,0,0,0),this._negativeCurve=new s.HE(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(e.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"ColorCurves"},e.Bind=function(e,t,r,i,n){void 0===r&&(r="vCameraColorCurvePositive"),void 0===i&&(i="vCameraColorCurveNeutral"),void 0===n&&(n="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(r,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(i,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(n,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},e.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},e.prototype._getColorGradingDataToRef=function(t,r,i,n,s){null!=t&&(t=e._Clamp(t,0,360),r=e._Clamp(r,-100,100),i=e._Clamp(i,-100,100),n=e._Clamp(n,-100,100),r=e._ApplyColorGradingSliderNonlinear(r),r*=.5,n=e._ApplyColorGradingSliderNonlinear(n),r<0&&(r*=-1,t=(t+180)%360),e._FromHSBToRef(t,r,50+.25*n,s),s.scaleToRef(2,s),s.a=1+.01*i)},e._ApplyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100},e._FromHSBToRef=function(t,r,i,n){var s=e._Clamp(t,0,360),o=e._Clamp(r/100,0,1),a=e._Clamp(i/100,0,1);if(0===o)n.r=a,n.g=a,n.b=a;else{s/=60;var u=Math.floor(s),l=s-u,h=a*(1-o),f=a*(1-o*l),p=a*(1-o*(1-l));switch(u){case 0:n.r=a,n.g=p,n.b=h;break;case 1:n.r=f,n.g=a,n.b=h;break;case 2:n.r=h,n.g=a,n.b=p;break;case 3:n.r=h,n.g=f,n.b=a;break;case 4:n.r=p,n.g=h,n.b=a;break;default:n.r=a,n.g=h,n.b=f}}n.a=1},e._Clamp=function(e,t,r){return Math.min(Math.max(e,t),r)},e.prototype.clone=function(){return n.p4.Clone((function(){return new e}),this)},e.prototype.serialize=function(){return n.p4.Serialize(this)},e.Parse=function(t){return n.p4.Parse((function(){return new e}),t,null,null)},(0,i.gn)([(0,n.qC)()],e.prototype,"_globalHue",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_globalDensity",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_globalSaturation",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_globalExposure",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_highlightsHue",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_highlightsDensity",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_highlightsSaturation",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_highlightsExposure",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_midtonesHue",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_midtonesDensity",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_midtonesSaturation",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_midtonesExposure",void 0),e}();n.p4._ColorCurvesParser=o.Parse},67759:(e,t,r)=>{r.d(t,{q:()=>i});var i=function(){function e(e,t){void 0===t&&(t=!0),this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}return e.IsWrapper=function(e){return void 0===e.getPipelineContext},e.GetEffect=function(e){return void 0===e.getPipelineContext?e.effect:e},e.prototype.setEffect=function(e,t,r){var i;void 0===r&&(r=!0),this.effect=e,void 0!==t&&(this.defines=t),r&&(null===(i=this.drawContext)||void 0===i||i.reset())},e.prototype.dispose=function(){var e;null===(e=this.drawContext)||void 0===e||e.dispose()},e}()},9256:(e,t,r)=>{r.d(t,{Q:()=>l});var i=r(62897),n=r(80352),s=r(84318),o=r(91153),a=r(69543),u=r(41659),l=function(){function e(t,r,s,l,h,f,p,c,d,_,m,g){void 0===l&&(l=null),void 0===f&&(f=null),void 0===p&&(p=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===m&&(m=""),void 0===g&&(g=u.x.GLSL);var b,y,E,v=this;this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new i.y$,this.onErrorObservable=new i.y$,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._isDisposed=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this.name=t,this._key=m;var T,x,A=void 0,C=null;if(r.attributes){var P=r;if(this._engine=s,this._attributesNames=P.attributes,this._uniformsNames=P.uniformsNames.concat(P.samplers),this._samplerList=P.samplers.slice(),this.defines=P.defines,this.onError=P.onError,this.onCompiled=P.onCompiled,this._fallbacks=P.fallbacks,this._indexParameters=P.indexParameters,this._transformFeedbackVaryings=P.transformFeedbackVaryings||null,this._multiTarget=!!P.multiTarget,this._shaderLanguage=null!==(b=P.shaderLanguage)&&void 0!==b?b:u.x.GLSL,P.uniformBuffersNames){this._uniformBuffersNamesList=P.uniformBuffersNames.slice();for(var S=0;S<P.uniformBuffersNames.length;S++)this._uniformBuffersNames[P.uniformBuffersNames[S]]=S}C=null!==(y=P.processFinalCode)&&void 0!==y?y:null,A=null!==(E=P.processCodeAfterIncludes)&&void 0!==E?E:void 0}else this._engine=h,this.defines=null==f?"":f,this._uniformsNames=s.concat(l),this._samplerList=l?l.slice():[],this._attributesNames=r,this._uniformBuffersNamesList=[],this._shaderLanguage=g,this.onError=d,this.onCompiled=c,this._indexParameters=_,this._fallbacks=p;this._attributeLocationByName={},this.uniqueId=e._UniqueIdSeed++;var M=(0,n.CG)()?this._engine.getHostDocument():null;t.vertexSource?T="source:"+t.vertexSource:t.vertexElement?(T=M?M.getElementById(t.vertexElement):null)||(T=t.vertexElement):T=t.vertex||t,t.fragmentSource?x="source:"+t.fragmentSource:t.fragmentElement?(x=M?M.getElementById(t.fragmentElement):null)||(x=t.fragmentElement):x=t.fragment||t,this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage);var O={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:a.v.GetShadersRepository(this._shaderLanguage),includesShadersStore:a.v.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:A},I=[void 0,void 0],R=function(){if(I[0]&&I[1]){O.isFragment=!0;var e=I[0],r=I[1];o.L.Process(r,O,(function(r){C&&(r=C("fragment",r));var i=o.L.Finalize(e,r,O);v._useFinalCode(i.vertexCode,i.fragmentCode,t)}),v._engine)}};this._loadShader(T,"Vertex","",(function(e){o.L.Initialize(O),o.L.Process(e,O,(function(t){v._rawVertexSourceCode=e,C&&(t=C("vertex",t)),I[0]=t,R()}),v._engine)})),this._loadShader(x,"Fragment","Pixel",(function(e){v._rawFragmentSourceCode=e,I[1]=e,R()}))}return Object.defineProperty(e,"ShadersRepository",{get:function(){return a.v.ShadersRepository},set:function(e){a.v.ShadersRepository=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new i.y$),this._onBindObservable},enumerable:!1,configurable:!0}),e.prototype._useFinalCode=function(e,t,r){if(r){var i=r.vertexElement||r.vertex||r.spectorName||r,n=r.fragmentElement||r.fragment||r.spectorName||r;this._vertexSourceCode=(this._shaderLanguage===u.x.WGSL?"//":"")+"#define SHADER_NAME vertex:"+i+"\n"+e,this._fragmentSourceCode=(this._shaderLanguage===u.x.WGSL?"//":"")+"#define SHADER_NAME fragment:"+n+"\n"+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),e.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},e.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},e.prototype.getEngine=function(){return this._engine},e.prototype.getPipelineContext=function(){return this._pipelineContext},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(e){return this._attributes[e]},e.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},e.prototype.getAttributesCount=function(){return this._attributes.length},e.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},e.prototype.getUniform=function(e){return this._uniforms[e]},e.prototype.getSamplers=function(){return this._samplerList},e.prototype.getUniformNames=function(){return this._uniformsNames},e.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},e.prototype.getIndexParameters=function(){return this._indexParameters},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},e.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add((function(t){e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){t._checkIsReady(null)}),16))},e.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(t){return void this._processCompilationErrors(t,e)}this._isDisposed||setTimeout((function(){t._checkIsReady(e)}),16)},e.prototype._loadShader=function(e,t,r,i){if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return void i((0,n.v)(e));if("source:"!==e.substr(0,7))if("base64:"!==e.substr(0,7)){var s,o=a.v.GetShadersStore(this._shaderLanguage);if(o[e+t+"Shader"])i(o[e+t+"Shader"]);else if(r&&o[e+r+"Shader"])i(o[e+r+"Shader"]);else s="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:a.v.GetShadersRepository(this._shaderLanguage)+e,this._engine._loadFile(s+"."+t.toLowerCase()+".fx",i)}else{i(window.atob(e.substr(7)))}else i(e.substr(7))},Object.defineProperty(e.prototype,"vertexSourceCode",{get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(t=null===(e=this._pipelineContext)||void 0===e?void 0:e._getVertexShaderCode())&&void 0!==t?t:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fragmentSourceCode",{get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(t=null===(e=this._pipelineContext)||void 0===e?void 0:e._getFragmentShaderCode())&&void 0!==t?t:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),e.prototype._rebuildProgram=function(e,t,r,i){var n=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){i&&i(t)},this.onCompiled=function(){var e=n.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);n._pipelineContext._handlesSpectorRebuildCallback(r)},this._fallbacks=null,this._prepareEffect()},e.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,r=this.defines,i=this._pipelineContext;this._isReady=!1;try{var n=this._engine;this._pipelineContext=n.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key;var s=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?n._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,s,null,this._transformFeedbackVaryings,this._key):n._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,s,r,this._transformFeedbackVaryings,this._key),n._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(e._attributes=[],e._pipelineContext._fillEffectInformation(e,e._uniformBuffersNames,e._uniformsNames,e._uniforms,e._samplerList,e._samplers,t,e._attributes),t)for(var r=0;r<t.length;r++){var s=t[r];e._attributeLocationByName[s]=e._attributes[r]}n.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),i&&e.getEngine()._deletePipelineContext(i)})),this._pipelineContext.isAsync&&this._checkIsReady(i)}catch(e){this._processCompilationErrors(e,i)}},e.prototype._getShaderCodeAndErrorLine=function(e,t,r){var i=r?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,n=null;if(t&&e){var s=t.match(i);if(s&&2===s.length){var o=parseInt(s[1]),a=e.split("\n",-1);a.length>=o&&(n="Offending line [".concat(o,"] in ").concat(r?"fragment":"vertex"," code: ").concat(a[o-1]))}}return[e,n]},e.prototype._processCompilationErrors=function(t,r){var i,n,o,a,u;void 0===r&&(r=null),this._compilationError=t.message;var l=this._attributesNames,h=this._fallbacks;if(s.Y.Error("Unable to compile effect:"),s.Y.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),s.Y.Error("Attributes: "+l.map((function(e){return" "+e}))),s.Y.Error("Defines:\r\n"+this.defines),e.LogShaderCodeOnCompilationError){var f=null,p=null,c=null;(null===(o=this._pipelineContext)||void 0===o?void 0:o._getVertexShaderCode())&&(c=(i=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],f=i[1],c&&(s.Y.Error("Vertex code:"),s.Y.Error(c))),(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode())&&(c=(n=this._getShaderCodeAndErrorLine(null===(u=this._pipelineContext)||void 0===u?void 0:u._getFragmentShaderCode(),this._compilationError,!0))[0],p=n[1],c&&(s.Y.Error("Fragment code:"),s.Y.Error(c))),f&&s.Y.Error(f),p&&s.Y.Error(p)}s.Y.Error("Error: "+this._compilationError),r&&(this._pipelineContext=r,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),h?(this._pipelineContext=null,h.hasMoreFallbacks?(this._allFallbacksProcessed=!1,s.Y.Error("Trying next fallback."),this.defines=h.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!1,configurable:!0}),e.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t,e)},e.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)},e.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)},e.prototype.setTextureArray=function(e,t){var r=e+"Ex";if(-1===this._samplerList.indexOf(r+"0")){for(var i=this._samplerList.indexOf(e),n=1;n<t.length;n++){var s=r+(n-1).toString();this._samplerList.splice(i+n,0,s)}for(var o=0,a=0,u=this._samplerList;a<u.length;a++){var l=u[a];this._samplers[l]=o,o+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)},e.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)},e.prototype.bindUniformBuffer=function(t,r){var i=this._uniformBuffersNames[r];void 0===i||e._BaseCache[i]===t&&this._engine._features.useUBOBindingCache||(e._BaseCache[i]=t,this._engine.bindUniformBufferBase(t,i,r))},e.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},e.prototype.setInt=function(e,t){return this._pipelineContext.setInt(e,t),this},e.prototype.setInt2=function(e,t,r){return this._pipelineContext.setInt2(e,t,r),this},e.prototype.setInt3=function(e,t,r,i){return this._pipelineContext.setInt3(e,t,r,i),this},e.prototype.setInt4=function(e,t,r,i,n){return this._pipelineContext.setInt4(e,t,r,i,n),this},e.prototype.setIntArray=function(e,t){return this._pipelineContext.setIntArray(e,t),this},e.prototype.setIntArray2=function(e,t){return this._pipelineContext.setIntArray2(e,t),this},e.prototype.setIntArray3=function(e,t){return this._pipelineContext.setIntArray3(e,t),this},e.prototype.setIntArray4=function(e,t){return this._pipelineContext.setIntArray4(e,t),this},e.prototype.setFloatArray=function(e,t){return this._pipelineContext.setArray(e,t),this},e.prototype.setFloatArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},e.prototype.setFloatArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},e.prototype.setFloatArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},e.prototype.setArray=function(e,t){return this._pipelineContext.setArray(e,t),this},e.prototype.setArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},e.prototype.setArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},e.prototype.setArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},e.prototype.setMatrices=function(e,t){return this._pipelineContext.setMatrices(e,t),this},e.prototype.setMatrix=function(e,t){return this._pipelineContext.setMatrix(e,t),this},e.prototype.setMatrix3x3=function(e,t){return this._pipelineContext.setMatrix3x3(e,t),this},e.prototype.setMatrix2x2=function(e,t){return this._pipelineContext.setMatrix2x2(e,t),this},e.prototype.setFloat=function(e,t){return this._pipelineContext.setFloat(e,t),this},e.prototype.setBool=function(e,t){return this._pipelineContext.setInt(e,t?1:0),this},e.prototype.setVector2=function(e,t){return this._pipelineContext.setVector2(e,t),this},e.prototype.setFloat2=function(e,t,r){return this._pipelineContext.setFloat2(e,t,r),this},e.prototype.setVector3=function(e,t){return this._pipelineContext.setVector3(e,t),this},e.prototype.setFloat3=function(e,t,r,i){return this._pipelineContext.setFloat3(e,t,r,i),this},e.prototype.setVector4=function(e,t){return this._pipelineContext.setVector4(e,t),this},e.prototype.setQuaternion=function(e,t){return this._pipelineContext.setQuaternion(e,t),this},e.prototype.setFloat4=function(e,t,r,i,n){return this._pipelineContext.setFloat4(e,t,r,i,n),this},e.prototype.setColor3=function(e,t){return this._pipelineContext.setColor3(e,t),this},e.prototype.setColor4=function(e,t,r){return this._pipelineContext.setColor4(e,t,r),this},e.prototype.setDirectColor4=function(e,t){return this._pipelineContext.setDirectColor4(e,t),this},e.prototype.dispose=function(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseEffect(this),this._isDisposed=!0},e.RegisterShader=function(e,t,r,i){void 0===i&&(i=u.x.GLSL),t&&(a.v.GetShadersStore(i)["".concat(e,"PixelShader")]=t),r&&(a.v.GetShadersStore(i)["".concat(e,"VertexShader")]=r)},e.ResetCache=function(){e._BaseCache={}},e.LogShaderCodeOnCompilationError=!0,e._UniqueIdSeed=0,e._BaseCache={},e.ShadersStore=a.v.ShadersStore,e.IncludesShadersStore=a.v.IncludesShadersStore,e}()},38309:(e,t,r)=>{r.d(t,{L:()=>i});var i=function(){function e(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return e.prototype.unBindMesh=function(){this._mesh=null},e.prototype.addFallback=function(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)},e.prototype.addCPUSkinningFallback=function(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)},Object.defineProperty(e.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!1,configurable:!0}),e.prototype.reduce=function(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;for(var r=this._mesh.getScene(),i=0;i<r.meshes.length;i++){var n=r.meshes[i];if(n.material){if(n.computeBonesUsingShaders&&0!==n.numBoneInfluencers)if(n.material.getEffect()===t)n.computeBonesUsingShaders=!1;else if(n.subMeshes)for(var s=0,o=n.subMeshes;s<o.length;s++){if(o[s].effect===t){n.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&n.computeBonesUsingShaders&&n.numBoneInfluencers>0&&(n.computeBonesUsingShaders=!1)}}else{var a=this._defines[this._currentRank];if(a)for(i=0;i<a.length;i++)e=e.replace("#define "+a[i],"");this._currentRank++}return e},e}()},77232:(e,t,r)=>{r.d(t,{H:()=>h,I:()=>l});var i=r(31191),n=r(72208),s=r(66513),o=r(62897),a=r(9256),u=r(67759),l=(r(80196),function(){function e(t,r){var o;void 0===r&&(r=e._DefaultOptions);var a=this;this._engine=t,this._fullscreenViewport=new s.l(0,0,1,1),r=(0,i.pi)((0,i.pi)({},e._DefaultOptions),r),this._vertexBuffers=((o={})[n.o.PositionKind]=new n.o(t,r.positions,n.o.PositionKind,!1,!1,2),o),this._indexBuffer=t.createIndexBuffer(r.indices),this._onContextRestoredObserver=t.onContextRestoredObservable.add((function(){for(var e in a._indexBuffer=t.createIndexBuffer(r.indices),a._vertexBuffers){a._vertexBuffers[e]._rebuild()}}))}return e.prototype.setViewport=function(e){void 0===e&&(e=this._fullscreenViewport),this._engine.setViewport(e)},e.prototype.bindBuffers=function(e){this._engine.bindBuffers(this._vertexBuffers,this._indexBuffer,e)},e.prototype.applyEffectWrapper=function(e){this._engine.depthCullingState.depthTest=!1,this._engine.stencilState.stencilTest=!1,this._engine.enableEffect(e._drawWrapper),this.bindBuffers(e.effect),e.onApplyObservable.notifyObservers({})},e.prototype.restoreStates=function(){this._engine.depthCullingState.depthTest=!0,this._engine.stencilState.stencilTest=!0},e.prototype.draw=function(){this._engine.drawElementsType(0,0,6)},e.prototype._isRenderTargetTexture=function(e){return void 0!==e.renderTarget},e.prototype.render=function(e,t){if(void 0===t&&(t=null),e.effect.isReady()){this.setViewport();var r=null===t?null:this._isRenderTargetTexture(t)?t.renderTarget:t;r&&this._engine.bindFramebuffer(r),this.applyEffectWrapper(e),this.draw(),r&&this._engine.unBindFramebuffer(r),this.restoreStates()}},e.prototype.dispose=function(){var e=this._vertexBuffers[n.o.PositionKind];e&&(e.dispose(),delete this._vertexBuffers[n.o.PositionKind]),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this._engine.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)},e._DefaultOptions={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]},e}()),h=function(){function e(e){var t,r=this;this.onApplyObservable=new o.y$;var i=e.uniformNames||[];e.vertexShader?t={fragmentSource:e.fragmentShader,vertexSource:e.vertexShader,spectorName:e.name||"effectWrapper"}:(i.push("scale"),t={fragmentSource:e.fragmentShader,vertex:"postprocess",spectorName:e.name||"effectWrapper"},this.onApplyObservable.add((function(){r.effect.setFloat2("scale",1,1)})));var n=e.defines?e.defines.join("\n"):"";this._drawWrapper=new u.q(e.engine),e.useShaderStore?(t.fragment=t.fragmentSource,t.vertex||(t.vertex=t.vertexSource),delete t.fragmentSource,delete t.vertexSource,this.effect=e.engine.createEffect(t,e.attributeNames||["position"],i,e.samplerNames,n,void 0,e.onCompiled,void 0,void 0,e.shaderLanguage)):(this.effect=new a.Q(t,e.attributeNames||["position"],i,e.samplerNames,e.engine,n,void 0,e.onCompiled,void 0,void 0,void 0,e.shaderLanguage),this._onContextRestoredObserver=e.engine.onContextRestoredObservable.add((function(){r.effect._pipelineContext=null,r.effect._wasPreviouslyReady=!1,r.effect._prepareEffect()})))}return Object.defineProperty(e.prototype,"effect",{get:function(){return this._drawWrapper.effect},set:function(e){this._drawWrapper.effect=e},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.effect.dispose()},e}()},90622:(e,t,r)=>{r.d(t,{$:()=>f,b:()=>h});var i=r(31191),n=r(96969),s=r(62897),o=r(13514),a=r(15631),u=r(64849),l=r(36195),h=function(e){function t(){var t=e.call(this)||this;return t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,i.ZT)(t,e),t}(u.H),f=function(){function e(){this.colorCurves=new l.U,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=e.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new a.HE(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=e.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new s.y$}return Object.defineProperty(e.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skipFinalColorClamp",{get:function(){return this._skipFinalColorClamp},set:function(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),e.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},e.prototype.getClassName=function(){return"ImageProcessingConfiguration"},e.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),t.VIGNETTE&&(e.push("vInverseScreenSize"),e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&l.U.PrepareUniforms(e)},e.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},e.prototype.prepareDefines=function(t,r){if(void 0===r&&(r=!1),r!==this.applyByPostProcess||!this._isEnabled)return t.VIGNETTE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.IMAGEPROCESSING=!1,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===e._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,t.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType===e.TONEMAPPING_ACES)t.TONEMAPPING_ACES=!0;else t.TONEMAPPING_ACES=!1;t.CONTRAST=1!==this.contrast,t.EXPOSURE=1!==this.exposure,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,t.IMAGEPROCESSING=t.VIGNETTE||t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING},e.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},e.prototype.bind=function(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&l.U.Bind(this.colorCurves,e),this._vignetteEnabled){var r=1/e.getEngine().getRenderWidth(),i=1/e.getEngine().getRenderHeight();e.setFloat2("vInverseScreenSize",r,i);var n=null!=t?t:i/r,s=Math.tan(.5*this.vignetteCameraFov),a=s*n,u=Math.sqrt(a*s);a=o.w1.Mix(a,u,this.vignetteStretch),s=o.w1.Mix(s,u,this.vignetteStretch),e.setFloat4("vignetteSettings1",a,s,-a*this.vignetteCentreX,-s*this.vignetteCentreY);var h=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,h)}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);var f=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(f-1)/f,.5/f,f,this.colorGradingTexture.level)}},e.prototype.clone=function(){return n.p4.Clone((function(){return new e}),this)},e.prototype.serialize=function(){return n.p4.Serialize(this)},e.Parse=function(t){return n.p4.Parse((function(){return new e}),t,null,null)},Object.defineProperty(e,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),e.TONEMAPPING_STANDARD=0,e.TONEMAPPING_ACES=1,e._VIGNETTEMODE_MULTIPLY=0,e._VIGNETTEMODE_OPAQUE=1,(0,i.gn)([(0,n.N$)()],e.prototype,"colorCurves",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_colorCurvesEnabled",void 0),(0,i.gn)([(0,n.oU)("colorGradingTexture")],e.prototype,"_colorGradingTexture",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_colorGradingEnabled",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_colorGradingWithGreenDepth",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_colorGradingBGR",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_exposure",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_toneMappingEnabled",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_toneMappingType",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_contrast",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"vignetteStretch",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"vignetteCentreX",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"vignetteCentreY",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"vignetteWeight",void 0),(0,i.gn)([(0,n.XX)()],e.prototype,"vignetteColor",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"vignetteCameraFov",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_vignetteBlendMode",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_vignetteEnabled",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_skipFinalColorClamp",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_applyByPostProcess",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_isEnabled",void 0),e}();n.p4._ImageProcessingConfigurationParser=f.Parse},86075:(e,t,r)=>{r.d(t,{SXg:()=>S.SX,cU0:()=>S.cU,pkP:()=>S.pk,xDD:()=>S.xD,Iij:()=>i.I,VL4:()=>A.VL,QcV:()=>S.Qc,K0_:()=>S.K0,N_3:()=>S.N_,x1T:()=>S.x1,QTo:()=>S.QT,UBy:()=>n.U,Ek2:()=>A.Ek,d_6:()=>S.d_,vFz:()=>S.vF,T05:()=>S.T0,GLq:()=>S.GL,Ksf:()=>S.Ks,BtG:()=>A.Bt,K0:()=>S.LP,wxV:()=>S.wx,XVo:()=>A.XV,mH:()=>S.mH,qiK:()=>S.qi,pi9:()=>B.p,els:()=>S.el,yay:()=>S.y,x4y:()=>S.x4,ORj:()=>S.OR,qXw:()=>I.q,ci9:()=>A.ci,Qmf:()=>o.Q,LUf:()=>s.L,IWo:()=>M.I,H2K:()=>M.H,Kov:()=>S.Ko,_NX:()=>A._N,xnb:()=>A.xn,rYf:()=>S.rY,Mk4:()=>S.Mk,gch:()=>S.gc,fMA:()=>S.fM,px:()=>f,RK4:()=>S.RK,utX:()=>S.ut,Uy:()=>S.Uy,ev7:()=>A.ev,udn:()=>A.ud,sUv:()=>A.sU,rE$:()=>S.rE,$YL:()=>p.$,b8n:()=>p.b,SVb:()=>S.SV,S7L:()=>S.S7,DAH:()=>S.DA,l7_:()=>A.l7,SZW:()=>A.SZ,u0P:()=>S.u0,JLG:()=>S.JL,blg:()=>S.bl,FTg:()=>S.FT,F5T:()=>c.F,iMC:()=>y.iM,dqE:()=>y.dq,Hgv:()=>d.H,GiX:()=>B.G,k6g:()=>P.k,G$p:()=>m.G,f4Y:()=>y.f4,neh:()=>L.n,BKQ:()=>N.BK,AiU:()=>y.Ai,HRV:()=>y.HR,cLi:()=>S.cL,Kum:()=>S.Ku,dlz:()=>S.dl,h1U:()=>A.h1,jKW:()=>S.jK,Utc:()=>S.Ut,G2s:()=>g.G,Kdn:()=>A.Kd,U5n:()=>S.U5,fgV:()=>S.fg,Dbg:()=>S.Db,Oie:()=>S.Oi,knA:()=>S.kn,MXb:()=>S.MX,Epn:()=>S.Ep,uWh:()=>S.uW,VTJ:()=>S.VT,WSY:()=>S.WS,CBt:()=>S.CB,Abm:()=>S.Ab,nOv:()=>S.nO,a84:()=>S.a8,wSv:()=>S.wS,$lO:()=>S.$l,_8k:()=>A._8,DtL:()=>S.Dt,AQ:()=>S.AQ,o_u:()=>b.o,m82:()=>S.m8,uaB:()=>y.u,my6:()=>y.my,PvR:()=>y.Pv,Ye:()=>y.Ye,Bm_:()=>y.Bm,YVB:()=>y.YV,rpb:()=>y.rp,MAc:()=>S.MA,q9t:()=>y.q9,B4R:()=>y.B4,aVT:()=>y.aV,uOX:()=>y.uO,DGL:()=>S.DG,paE:()=>S.p,PVD:()=>S.PV,hBo:()=>S.hB,Yeu:()=>S.Ye,Fwk:()=>S.Fw,gi1:()=>A.gi,O7V:()=>A.O7,ULE:()=>S.UL,auf:()=>E.a,VZf:()=>S.VZ,Nkl:()=>A.Nk,lMF:()=>A.lM,eoS:()=>A.eo,FdB:()=>A.Fd,xS5:()=>S.xS,sHY:()=>S.sH,Jcg:()=>S.Jc,TBH:()=>S.TB,YFM:()=>S.YF,bcL:()=>S.bc,zA4:()=>A.zA,rsS:()=>N.rs,wzm:()=>S.wz,_iX:()=>A._i,zCT:()=>S.zC,tcv:()=>S.tc,aoI:()=>S.ao,r0z:()=>S.r0,eGW:()=>S.eG,EHI:()=>S.EH,xeF:()=>v.x,jyz:()=>T.j,FWn:()=>F,gms:()=>S.gm,r2G:()=>S.r2,SVE:()=>S.Hp,KuD:()=>x.K,RLV:()=>x.R,nLX:()=>S.nL,lr4:()=>S.lr,FFf:()=>S.FF,vBF:()=>S.vB,xEZ:()=>A.xE,Mcz:()=>S.Mc,PtD:()=>A.Pt,ppD:()=>A.pp,aJx:()=>A.aJ,O64:()=>_.O,R8x:()=>A.R8,guC:()=>A.gu,mM6:()=>S.mM,SYc:()=>S.SY,pF7:()=>S.pF,tO3:()=>S.tO,Ms4:()=>C.M,Dhx:()=>N.Dh,jDn:()=>N.jD,tvr:()=>S.tv,RxX:()=>S.Rx,tGn:()=>S.tG,fO1:()=>A.fO,dCj:()=>S.dC,rv:()=>S.rv,Iky:()=>S.Ik,g5:()=>S.g5,Euh:()=>S.Eu,tlW:()=>A.tl,sdx:()=>A.sd,vzg:()=>A.vz,h4G:()=>A.h4,ccn:()=>A.cc,_DL:()=>A._D,W5O:()=>Q,agc:()=>j,UgH:()=>q,p3y:()=>z,vMn:()=>Y,YWN:()=>X,njn:()=>K,pv5:()=>S.pv});var i=r(99625),n=r(36195),s=r(38309),o=r(9256),a=r(1101),u=r(15631),l=r(37290),h=r(96969),f=function(){function e(e){void 0===e&&(e={}),this._isEnabled=!0,this.bias=void 0===e.bias?0:e.bias,this.power=void 0===e.power?1:e.power,this.leftColor=e.leftColor||u.Wo.White(),this.rightColor=e.rightColor||u.Wo.Black(),!1===e.isEnabled&&(this.isEnabled=!1)}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,l.D.MarkAllMaterialsAsDirty(20))},enumerable:!1,configurable:!0}),e.prototype.clone=function(){var t=new e;return a.j.DeepCopy(this,t),t},e.prototype.equals=function(e){return e&&this.bias===e.bias&&this.power===e.power&&this.leftColor.equals(e.leftColor)&&this.rightColor.equals(e.rightColor)&&this.isEnabled===e.isEnabled},e.prototype.serialize=function(){return{isEnabled:this.isEnabled,leftColor:this.leftColor.asArray(),rightColor:this.rightColor.asArray(),bias:this.bias,power:this.power}},e.Parse=function(t){return new e({isEnabled:t.isEnabled,leftColor:u.Wo.FromArray(t.leftColor),rightColor:u.Wo.FromArray(t.rightColor),bias:t.bias,power:t.power||1})},e}();h.p4._FresnelParametersParser=f.Parse;var p=r(90622),c=r(98163),d=r(64849),_=r(91901),m=r(90360),g=r(91855),b=r(74995),y=r(48450),E=r(74375),v=r(41659),T=r(54067),x=r(3085),A=r(13120),C=r(83353),P=r(46110),S=r(16943),M=r(77232),O=r(54007),I=r(67759),R=r(15210),D=function(){function e(){this.mm=new Map}return e.prototype.get=function(e,t){var r=this.mm.get(e);if(void 0!==r)return r.get(t)},e.prototype.set=function(e,t,r){var i=this.mm.get(e);void 0===i&&this.mm.set(e,i=new Map),i.set(t,r)},e}(),F=function(){function e(e,t,r){var i=this;this._baseMaterial=e,this._scene=null!=t?t:R.l.LastCreatedScene,this._options=r,this._subMeshToEffect=new Map,this._subMeshToDepthWrapper=new D,this._meshes=new Map,this._onEffectCreatedObserver=this._baseMaterial.onEffectCreatedObservable.add((function(e){var t,r=null===(t=e.subMesh)||void 0===t?void 0:t.getMesh();r&&!i._meshes.has(r)&&i._meshes.set(r,r.onDisposeObservable.add((function(e){for(var t=i._subMeshToEffect.keys(),r=t.next();!0!==r.done;r=t.next()){var n=r.value;(null==n?void 0:n.getMesh())===e&&(i._subMeshToEffect.delete(n),i._subMeshToDepthWrapper.mm.delete(n))}}))),i._subMeshToEffect.set(e.subMesh,[e.effect,i._scene.getEngine().currentRenderPassId]),i._subMeshToDepthWrapper.mm.delete(e.subMesh)}))}return Object.defineProperty(e.prototype,"standalone",{get:function(){var e,t;return null!==(t=null===(e=this._options)||void 0===e?void 0:e.standalone)&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"baseMaterial",{get:function(){return this._baseMaterial},enumerable:!1,configurable:!0}),e.prototype.getEffect=function(e,t,r){var i,n=null===(i=this._subMeshToDepthWrapper.mm.get(e))||void 0===i?void 0:i.get(t);if(!n)return null;var s=n.drawWrapper[r];return s||(s=n.drawWrapper[r]=new I.q(this._scene.getEngine())).setEffect(n.mainDrawWrapper.effect,n.mainDrawWrapper.defines),s},e.prototype.isReadyForSubMesh=function(e,t,r,i,n){var s,o;return!(this.standalone&&!this._baseMaterial.isReadyForSubMesh(e.getMesh(),e,i))&&(null!==(o=null===(s=this._makeEffect(e,t,r,n))||void 0===s?void 0:s.isReady())&&void 0!==o&&o)},e.prototype.dispose=function(){this._baseMaterial.onEffectCreatedObservable.remove(this._onEffectCreatedObserver),this._onEffectCreatedObserver=null;for(var e=this._meshes.entries(),t=e.next();!0!==t.done;t=e.next()){var r=t.value,i=r[0],n=r[1];i.onDisposeObservable.remove(n)}},e.prototype._makeEffect=function(e,t,r,i){var n,s,a,u=this._scene.getEngine(),l=this._subMeshToEffect.get(e);if(!l)return null;var h=l[0],f=l[1],p=this._subMeshToDepthWrapper.get(e,r);if(!p){var c=new I.q(u);c.defines=null!==(s=null===(n=e._getDrawWrapper(f))||void 0===n?void 0:n.defines)&&void 0!==s?s:null,(p={drawWrapper:[],mainDrawWrapper:c,depthDefines:"",token:(0,O.f)()}).drawWrapper[i]=c,this._subMeshToDepthWrapper.set(e,r,p)}var d=t.join("\n");if(p.mainDrawWrapper.effect&&d===p.depthDefines)return p.mainDrawWrapper.effect;p.depthDefines=d;var _=h.rawVertexSourceCode,m=h.rawFragmentSourceCode,g=this._options&&this._options.remappedVariables?"#include<shadowMapVertexNormalBias>(".concat(this._options.remappedVariables.join(","),")"):o.Q.IncludesShadersStore.shadowMapVertexNormalBias,b=this._options&&this._options.remappedVariables?"#include<shadowMapVertexMetric>(".concat(this._options.remappedVariables.join(","),")"):o.Q.IncludesShadersStore.shadowMapVertexMetric,y=this._options&&this._options.remappedVariables?"#include<shadowMapFragmentSoftTransparentShadow>(".concat(this._options.remappedVariables.join(","),")"):o.Q.IncludesShadersStore.shadowMapFragmentSoftTransparentShadow,E=o.Q.IncludesShadersStore.shadowMapFragment;_=(_=-1!==(_=(_=_.replace(/void\s+?main/g,o.Q.IncludesShadersStore.shadowMapVertexExtraDeclaration+"\r\nvoid main")).replace(/#define SHADOWDEPTH_NORMALBIAS|#define CUSTOM_VERTEX_UPDATE_WORLDPOS/g,g)).indexOf("#define SHADOWDEPTH_METRIC")?_.replace(/#define SHADOWDEPTH_METRIC/g,b):_.replace(/}\s*$/g,b+"\r\n}")).replace(/#define SHADER_NAME.*?\n|out vec4 glFragColor;\n/g,"");var v=m.indexOf("#define SHADOWDEPTH_SOFTTRANSPARENTSHADOW")>=0||m.indexOf("#define CUSTOM_FRAGMENT_BEFORE_FOG")>=0,T=-1!==m.indexOf("#define SHADOWDEPTH_FRAGMENT"),x="";v?m=m.replace(/#define SHADOWDEPTH_SOFTTRANSPARENTSHADOW|#define CUSTOM_FRAGMENT_BEFORE_FOG/g,y):x=y+"\r\n",m=m.replace(/void\s+?main/g,o.Q.IncludesShadersStore.shadowMapFragmentExtraDeclaration+"\r\nvoid main"),T?m=m.replace(/#define SHADOWDEPTH_FRAGMENT/g,E):x+=E+"\r\n",x&&(m=m.replace(/}\s*$/g,x+"}")),m=m.replace(/#define SHADER_NAME.*?\n|out vec4 glFragColor;\n/g,"");var A=h.getUniformNames().slice();A.push("biasAndScaleSM","depthValuesSM","lightDataSM","softTransparentShadowSM"),p.mainDrawWrapper.effect=u.createEffect({vertexSource:_,fragmentSource:m,vertexToken:p.token,fragmentToken:p.token},{attributes:h.getAttributesNames(),uniformsNames:A,uniformBuffersNames:h.getUniformBuffersNames(),samplers:h.getSamplers(),defines:d+"\n"+h.defines.replace("#define SHADOWS","").replace(/#define SHADOW\d/g,""),indexParameters:h.getIndexParameters()},u);for(var C=0;C<p.drawWrapper.length;++C)C!==i&&(null===(a=p.drawWrapper[C])||void 0===a||a.setEffect(p.mainDrawWrapper.effect,p.mainDrawWrapper.defines));return p.mainDrawWrapper.effect},e}(),L=r(32836),N=r(76045),B=r(16977),U=r(59990),k=r(12746),w=r(58152),G=r(13283),V=r(91878),H=r(73744),W=r(70741);function j(e){return e instanceof k.m?new U.u(e):null}function q(e){return e instanceof k.m?new w.d(e):null}function z(e){return e instanceof k.m?new G.Y(e):null}function Y(e){return e instanceof k.m?new V.B(e):null}function X(e){return e instanceof k.m?new H.B(e):null}function K(e){return e instanceof k.m?new W.u(e):null}function Q(e){return e instanceof k.m||e instanceof x.K?new B.p(e):null}},16977:(e,t,r)=>{r.d(t,{G:()=>h,p:()=>f});var i=r(31191),n=r(98163),s=r(96969),o=r(46110),a=r(90360),u=r(64849),l=r(32836),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.DETAIL=!1,t.DETAILDIRECTUV=0,t.DETAIL_NORMALBLENDMETHOD=0,t}return(0,i.ZT)(t,e),t}(u.H),f=function(e){function t(t,r){void 0===r&&(r=!0);var i=e.call(this,t,"DetailMap",140,new h,r)||this;return i._texture=null,i.diffuseBlendLevel=1,i.roughnessBlendLevel=1,i.bumpLevel=1,i._normalBlendMethod=n.F.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,i._isEnabled=!1,i.isEnabled=!1,i._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1],i}return(0,i.ZT)(t,e),t.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},t.prototype.isReadyForSubMesh=function(e,t,r){return!this._isEnabled||!(e._areTexturesDirty&&t.texturesEnabled&&r.getCaps().standardDerivatives&&this._texture&&o.k.DetailTextureEnabled&&!this._texture.isReady())},t.prototype.prepareDefines=function(e,t){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;var r=t.getEngine();e._areTexturesDirty&&(r.getCaps().standardDerivatives&&this._texture&&o.k.DetailTextureEnabled&&this._isEnabled?(a.G.PrepareDefinesForMergedUV(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1},t.prototype.bindForSubMesh=function(e,t){if(this._isEnabled){var r=this._material.isFrozen;e.useUbo&&r&&e.isSync||this._texture&&o.k.DetailTextureEnabled&&(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),a.G.BindTextureMatrix(this._texture,e,"detail")),t.texturesEnabled&&this._texture&&o.k.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture)}},t.prototype.hasTexture=function(e){return this._texture===e},t.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture)},t.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)},t.prototype.dispose=function(e){var t;e&&(null===(t=this._texture)||void 0===t||t.dispose())},t.prototype.getClassName=function(){return"DetailMapConfiguration"},t.prototype.getSamplers=function(e){e.push("detailSampler")},t.prototype.getUniforms=function(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}},(0,i.gn)([(0,s.oU)("detailTexture"),(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"texture",void 0),(0,i.gn)([(0,s.qC)()],t.prototype,"diffuseBlendLevel",void 0),(0,i.gn)([(0,s.qC)()],t.prototype,"roughnessBlendLevel",void 0),(0,i.gn)([(0,s.qC)()],t.prototype,"bumpLevel",void 0),(0,i.gn)([(0,s.qC)(),(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"normalBlendMethod",void 0),(0,i.gn)([(0,s.qC)(),(0,s.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isEnabled",void 0),t}(l.n)},98163:(e,t,r)=>{r.d(t,{F:()=>m});var i=r(31191),n=r(96969),s=r(13514),o=r(62897),a=r(15210),u=r(68345),l=r(83353),h=r(84318),f=r(62464),p=r(90360),c=r(67759),d=function(){function e(){this.reset()}return e.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681},Object.defineProperty(e.prototype,"func",{get:function(){return this._func},set:function(e){this._func=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcRef",{get:function(){return this._funcRef},set:function(e){this._funcRef=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcMask",{get:function(){return this._funcMask},set:function(e){this._funcMask=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(e){this._opStencilFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(e){this._opDepthFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"MaterialStencilState"},e.prototype.copyTo=function(e){n.p4.Clone((function(){return e}),this)},e.prototype.serialize=function(){return n.p4.Serialize(this)},e.prototype.parse=function(e,t,r){var i=this;n.p4.Parse((function(){return i}),e,t,r)},(0,i.gn)([(0,n.qC)()],e.prototype,"func",null),(0,i.gn)([(0,n.qC)()],e.prototype,"funcRef",null),(0,i.gn)([(0,n.qC)()],e.prototype,"funcMask",null),(0,i.gn)([(0,n.qC)()],e.prototype,"opStencilFail",null),(0,i.gn)([(0,n.qC)()],e.prototype,"opDepthFail",null),(0,i.gn)([(0,n.qC)()],e.prototype,"opStencilDepthPass",null),(0,i.gn)([(0,n.qC)()],e.prototype,"mask",null),(0,i.gn)([(0,n.qC)()],e.prototype,"enabled",null),e}(),_=r(67555),m=function(){function e(t,r,i){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new o.y$,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new d,this._useUBO=!1,this._fillMode=e.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=function(){},this._callbackPluginEventIsReadyForSubMesh=function(){},this._callbackPluginEventPrepareDefines=function(){},this._callbackPluginEventPrepareDefinesBeforeAttributes=function(){},this._callbackPluginEventHardBindForSubMesh=function(){},this._callbackPluginEventBindForSubMesh=function(){},this._callbackPluginEventHasRenderTargetTextures=function(){},this._callbackPluginEventFillRenderTargetTextures=function(){},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=t;var n=r||a.l.LastCreatedScene;n&&(this._scene=n,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=t||s.w1.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new c.q(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._scene.useRightHandedSystem?this.sideOrientation=e.ClockWiseSideOrientation:this.sideOrientation=e.CounterClockWiseSideOrientation,this._uniformBuffer=new l.M(this._scene.getEngine(),void 0,void 0,t),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),e.OnEventObservable.notifyObservers(this,_.S.Created))}return Object.defineProperty(e.prototype,"canRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){if(this._alpha!==t){var r=this._alpha;this._alpha=t,1!==r&&1!==t||this.markAsDirty(e.MiscDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cullBackFaces",{get:function(){return this._cullBackFaces},set:function(t){this._cullBackFaces!==t&&(this._cullBackFaces=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRenderTargetTextures",{get:function(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new o.y$),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBind",{set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new o.y$),this._onUnBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onEffectCreatedObservable",{get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new o.y$),this._onEffectCreatedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPrePassCapable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wireframe",{get:function(){switch(this._fillMode){case e.WireFrameFillMode:case e.LineListDrawMode:case e.LineLoopDrawMode:case e.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(t){this.fillMode=t?e.WireFrameFillMode:e.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case e.PointFillMode:case e.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(t){this.fillMode=t?e.PointFillMode:e.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillMode",{get:function(){return this._fillMode},set:function(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!1,configurable:!0}),e.prototype._getDrawWrapper=function(){return this._drawWrapper},e.prototype._setDrawWrapper=function(e){this._drawWrapper=e},e.prototype.toString=function(e){return"Name: "+this.name},e.prototype.getClassName=function(){return"Material"},Object.defineProperty(e.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),e.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},e.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},e.prototype.isReady=function(e,t){return!0},e.prototype.isReadyForSubMesh=function(e,t,r){var i=t.materialDefines;return!!i&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=i,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)},e.prototype.getEffect=function(){return this._drawWrapper.effect},e.prototype.getScene=function(){return this._scene},Object.defineProperty(e.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._forceAlphaTest=t===e.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_disableAlphaBlending",{get:function(){return this._transparencyMode===e.MATERIAL_OPAQUE||this._transparencyMode===e.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),e.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&this.alpha<1},e.prototype.needAlphaBlendingForMesh=function(e){return!(this._disableAlphaBlending&&e.visibility>=1)&&(this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha)},e.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest},e.prototype._shouldTurnAlphaTestOn=function(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()},e.prototype.getAlphaTestTexture=function(){return null},e.prototype.markDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var r=t[e];if(r.subMeshes)for(var i=0,n=r.subMeshes;i<n.length;i++){var s=n[i];s.getMaterial()===this&&(s.effect&&(s.effect._wasPreviouslyReady=!1))}}},e.prototype._preBind=function(t,r){void 0===r&&(r=null);var i=this._scene.getEngine(),n=(null==r?this.sideOrientation:r)===e.ClockWiseSideOrientation;return i.enableEffect(t||this._getDrawWrapper()),i.setState(this.backFaceCulling,this.zOffset,!1,n,this.cullBackFaces,this.stencil,this.zOffsetUnits),n},e.prototype.bind=function(e,t){},e.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(_.S.PrepareUniformBuffer,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0},e.prototype.bindForSubMesh=function(e,t,r){r.effect&&(this._eventInfo.subMesh=r,this._callbackPluginEventBindForSubMesh(this._eventInfo))},e.prototype.bindOnlyWorldMatrix=function(e){},e.prototype.bindView=function(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.getScene().getViewMatrix())},e.prototype.bindViewProjection=function(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.setMatrix("projection",this.getScene().getProjectionMatrix()))},e.prototype.bindEyePosition=function(e,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,t)},e.prototype._afterBind=function(e,t){if(void 0===t&&(t=null),this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,p.G.BindSceneUniformBuffer(t,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){var r=this._scene.getEngine();this._cachedDepthWriteState=r.getDepthWrite(),r.setDepthWrite(!1)}if(this.disableColorWrite){r=this._scene.getEngine();this._cachedColorWriteState=r.getColorWrite(),r.setColorWrite(!1)}if(0!==this.depthFunction){r=this._scene.getEngine();this._cachedDepthFunctionState=r.getDepthFunction()||0,r.setDepthFunction(this.depthFunction)}},e.prototype.unbind=function(){(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction)&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState);this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState);this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)},e.prototype.getAnimatables=function(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(_.S.GetAnimatables,this._eventInfo),this._eventInfo.animatables},e.prototype.getActiveTextures=function(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(_.S.GetActiveTextures,this._eventInfo),this._eventInfo.activeTextures},e.prototype.hasTexture=function(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(_.S.HasTexture,this._eventInfo),this._eventInfo.hasTexture},e.prototype.clone=function(e){return null},e.prototype.getBindedMeshes=function(){var e=this;if(this.meshMap){var t=new Array;for(var r in this.meshMap){var i=this.meshMap[r];i&&t.push(i)}return t}return this._scene.meshes.filter((function(t){return t.material===e}))},e.prototype.forceCompilation=function(e,t,r,n){var s=this,o=(0,i.pi)({clipPlane:!1,useInstances:!1},r),a=this.getScene(),l=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;var h=function(){if(s._scene&&s._scene.getEngine()){var r=a.clipPlane;if(o.clipPlane&&(a.clipPlane=new f.J(0,0,0,1)),s._storeEffectOnSubMeshes){var i=!0,p=null;if(e.subMeshes){var c=new u.P(0,0,0,0,0,e,void 0,!1,!1);c.materialDefines&&(c.materialDefines._renderId=-1),s.isReadyForSubMesh(e,c,o.useInstances)||(c.effect&&c.effect.getCompilationError()&&c.effect.allFallbacksProcessed()?p=c.effect.getCompilationError():(i=!1,setTimeout(h,16)))}i&&(s.allowShaderHotSwapping=l,p&&n&&n(p),t&&t(s))}else s.isReady()?(s.allowShaderHotSwapping=l,t&&t(s)):setTimeout(h,16);o.clipPlane&&(a.clipPlane=r)}};h()},e.prototype.forceCompilationAsync=function(e,t){var r=this;return new Promise((function(i,n){r.forceCompilation(e,(function(){i()}),t,(function(e){n(e)}))}))},e.prototype.markAsDirty=function(t){this.getScene().blockMaterialDirtyMechanism||(e._DirtyCallbackArray.length=0,t&e.TextureDirtyFlag&&e._DirtyCallbackArray.push(e._TextureDirtyCallBack),t&e.LightDirtyFlag&&e._DirtyCallbackArray.push(e._LightsDirtyCallBack),t&e.FresnelDirtyFlag&&e._DirtyCallbackArray.push(e._FresnelDirtyCallBack),t&e.AttributesDirtyFlag&&e._DirtyCallbackArray.push(e._AttributeDirtyCallBack),t&e.MiscDirtyFlag&&e._DirtyCallbackArray.push(e._MiscDirtyCallBack),t&e.PrePassDirtyFlag&&e._DirtyCallbackArray.push(e._PrePassDirtyCallBack),e._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(e._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},e.prototype.resetDrawCache=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var r=t[e];if(r.subMeshes)for(var i=0,n=r.subMeshes;i<n.length;i++){var s=n[i];s.getMaterial()===this&&s.resetDrawCache()}}},e.prototype._markAllSubMeshesAsDirty=function(e){if(!this.getScene().blockMaterialDirtyMechanism)for(var t=0,r=this.getScene().meshes;t<r.length;t++){var i=r[t];if(i.subMeshes)for(var n=0,s=i.subMeshes;n<s.length;n++){var o=s[n];if(o.getMaterial(!1)===this)for(var a=0,u=o._drawWrappers;a<u.length;a++){var l=u[a];l&&l.defines&&l.defines.markAllAsDirty&&(this._materialContext===l.materialContext&&e(l.defines))}}}},e.prototype._markScenePrePassDirty=function(){if(!this.getScene().blockMaterialDirtyMechanism){var e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}},e.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(e._AllDirtyCallBack)},e.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(e._ImageProcessingDirtyCallBack)},e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(e._TextureDirtyCallBack)},e.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(e._FresnelDirtyCallBack)},e.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(e._FresnelAndMiscDirtyCallBack)},e.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(e._LightsDirtyCallBack)},e.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(e._AttributeDirtyCallBack)},e.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)},e.prototype._markAllSubMeshesAsPrePassDirty=function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)},e.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(e._TextureAndMiscDirtyCallBack)},e.prototype.setPrePassRenderer=function(e){return!1},e.prototype.dispose=function(e,t,r){var i=this.getScene();if(i.stopAnimation(this),i.freeProcessedMaterials(),i.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(_.S.Disposed,this._eventInfo),this._parentContainer){var n=this._parentContainer.materials.indexOf(this);n>-1&&this._parentContainer.materials.splice(n,1),this._parentContainer=null}if(!0!==r)if(this.meshMap)for(var s in this.meshMap){(u=this.meshMap[s])&&(u.material=null,this.releaseVertexArrayObject(u,e))}else for(var o=0,a=i.meshes;o<a.length;o++){var u;(u=a[o]).material!==this||u.sourceMesh||(u.material=null,this.releaseVertexArrayObject(u,e))}this._uniformBuffer.dispose(),e&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()},e.prototype.releaseVertexArrayObject=function(e,t){if(e.geometry){var r=e.geometry;if(this._storeEffectOnSubMeshes)for(var i=0,n=e.subMeshes;i<n.length;i++){var s=n[i];r._releaseVertexArrayObject(s.effect),t&&s.effect&&s.effect.dispose()}else r._releaseVertexArrayObject(this._drawWrapper.effect)}},e.prototype.serialize=function(){var e=n.p4.Serialize(this);return e.stencil=this.stencil.serialize(),e.uniqueId=this.uniqueId,e},e.Parse=function(e,t,r){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return h.Y.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";var i=s.w1.Instantiate(e.customType).Parse(e,t,r);return i._loadedUniqueId=e.uniqueId,i},e.TriangleFillMode=0,e.WireFrameFillMode=1,e.PointFillMode=2,e.PointListDrawMode=3,e.LineListDrawMode=4,e.LineLoopDrawMode=5,e.LineStripDrawMode=6,e.TriangleStripDrawMode=7,e.TriangleFanDrawMode=8,e.ClockWiseSideOrientation=0,e.CounterClockWiseSideOrientation=1,e.TextureDirtyFlag=1,e.LightDirtyFlag=2,e.FresnelDirtyFlag=4,e.AttributesDirtyFlag=8,e.MiscDirtyFlag=16,e.PrePassDirtyFlag=32,e.AllDirtyFlag=63,e.MATERIAL_OPAQUE=0,e.MATERIAL_ALPHATEST=1,e.MATERIAL_ALPHABLEND=2,e.MATERIAL_ALPHATESTANDBLEND=3,e.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,e.MATERIAL_NORMALBLENDMETHOD_RNM=1,e.OnEventObservable=new o.y$,e._AllDirtyCallBack=function(e){return e.markAllAsDirty()},e._ImageProcessingDirtyCallBack=function(e){return e.markAsImageProcessingDirty()},e._TextureDirtyCallBack=function(e){return e.markAsTexturesDirty()},e._FresnelDirtyCallBack=function(e){return e.markAsFresnelDirty()},e._MiscDirtyCallBack=function(e){return e.markAsMiscDirty()},e._PrePassDirtyCallBack=function(e){return e.markAsPrePassDirty()},e._LightsDirtyCallBack=function(e){return e.markAsLightDirty()},e._AttributeDirtyCallBack=function(e){return e.markAsAttributesDirty()},e._FresnelAndMiscDirtyCallBack=function(t){e._FresnelDirtyCallBack(t),e._MiscDirtyCallBack(t)},e._TextureAndMiscDirtyCallBack=function(t){e._TextureDirtyCallBack(t),e._MiscDirtyCallBack(t)},e._DirtyCallbackArray=[],e._RunDirtyCallBacks=function(t){for(var r=0,i=e._DirtyCallbackArray;r<i.length;r++){(0,i[r])(t)}},(0,i.gn)([(0,n.qC)()],e.prototype,"id",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"uniqueId",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"name",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"metadata",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"checkReadyOnEveryCall",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"checkReadyOnlyOnce",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"state",void 0),(0,i.gn)([(0,n.qC)("alpha")],e.prototype,"_alpha",void 0),(0,i.gn)([(0,n.qC)("backFaceCulling")],e.prototype,"_backFaceCulling",void 0),(0,i.gn)([(0,n.qC)("cullBackFaces")],e.prototype,"_cullBackFaces",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"sideOrientation",void 0),(0,i.gn)([(0,n.qC)("alphaMode")],e.prototype,"_alphaMode",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"_needDepthPrePass",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"disableDepthWrite",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"disableColorWrite",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"forceDepthWrite",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"depthFunction",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"separateCullingPass",void 0),(0,i.gn)([(0,n.qC)("fogEnabled")],e.prototype,"_fogEnabled",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"pointSize",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"zOffset",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"zOffsetUnits",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"pointsCloud",null),(0,i.gn)([(0,n.qC)()],e.prototype,"fillMode",null),(0,i.gn)([(0,n.qC)()],e.prototype,"transparencyMode",null),e}()},64849:(e,t,r)=>{r.d(t,{H:()=>i});var i=function(){function e(e){if(this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=e,e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&this._setDefaultValue(t)}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),e.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},e.prototype.markAsUnprocessed=function(){this._isDirty=!0},e.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsLightDirty=function(e){void 0===e&&(e=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0},e.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},e.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},e.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},e.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},e.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},e.prototype.rebuild=function(){this._keys=[];for(var e=0,t=Object.keys(this);e<t.length;e++){var r=t[e];"_"!==r[0]&&this._keys.push(r)}if(this._externalProperties)for(var i in this._externalProperties)-1===this._keys.indexOf(i)&&this._keys.push(i)},e.prototype.isEqual=function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var r=this._keys[t];if(this[r]!==e[r])return!1}return!0},e.prototype.cloneTo=function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var r=this._keys[t];e[r]=this[r]}},e.prototype.reset=function(){var e=this;this._keys.forEach((function(t){return e._setDefaultValue(t)}))},e.prototype._setDefaultValue=function(e){var t,r,i,n,s,o=null!==(i=null===(r=null===(t=this._externalProperties)||void 0===t?void 0:t[e])||void 0===r?void 0:r.type)&&void 0!==i?i:typeof this[e],a=null===(s=null===(n=this._externalProperties)||void 0===n?void 0:n[e])||void 0===s?void 0:s.default;switch(o){case"number":this[e]=null!=a?a:0;break;case"string":this[e]=null!=a?a:"";break;default:this[e]=null!=a&&a}},e.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var r=this._keys[t],i=this[r];switch(typeof i){case"number":case"string":e+="#define "+r+" "+i+"\n";break;default:i&&(e+="#define "+r+"\n")}}return e},e}()},46110:(e,t,r)=>{r.d(t,{k:()=>n});var i=r(37290),n=function(){function e(){}return Object.defineProperty(e,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DetailTextureEnabled",{get:function(){return this._DetailTextureEnabled},set:function(e){this._DetailTextureEnabled!==e&&(this._DetailTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,i.D.MarkAllMaterialsAsDirty(4))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"RefractionIntensityTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(e){this._RefractionIntensityTextureEnabled!==e&&(this._RefractionIntensityTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"TranslucencyIntensityTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(e){this._TranslucencyIntensityTextureEnabled!==e&&(this._TranslucencyIntensityTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"IridescenceTextureEnabled",{get:function(){return this._IridescenceTextureEnabled},set:function(e){this._IridescenceTextureEnabled!==e&&(this._IridescenceTextureEnabled=e,i.D.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),e._DiffuseTextureEnabled=!0,e._DetailTextureEnabled=!0,e._AmbientTextureEnabled=!0,e._OpacityTextureEnabled=!0,e._ReflectionTextureEnabled=!0,e._EmissiveTextureEnabled=!0,e._SpecularTextureEnabled=!0,e._BumpTextureEnabled=!0,e._LightmapTextureEnabled=!0,e._RefractionTextureEnabled=!0,e._ColorGradingTextureEnabled=!0,e._FresnelEnabled=!0,e._ClearCoatTextureEnabled=!0,e._ClearCoatBumpTextureEnabled=!0,e._ClearCoatTintTextureEnabled=!0,e._SheenTextureEnabled=!0,e._AnisotropicTextureEnabled=!0,e._ThicknessTextureEnabled=!0,e._RefractionIntensityTextureEnabled=!0,e._TranslucencyIntensityTextureEnabled=!0,e._IridescenceTextureEnabled=!0,e}()},90360:(e,t,r)=>{r.d(t,{G:()=>f});var i=r(84318),n=r(2055),s=r(65273),o=r(15210),a=r(72208),u=r(43812),l=r(15631),h=r(91901),f=function(){function e(){}return e.BindSceneUniformBuffer=function(e,t){t.bindToEffect(e,"Scene")},e.PrepareDefinesForMergedUV=function(e,t,r){t._needUVs=!0,t[r]=!0,e.getTextureMatrix().isIdentityAs3x2()?(t[r+"DIRECTUV"]=e.coordinatesIndex+1,t["MAINUV"+(e.coordinatesIndex+1)]=!0):t[r+"DIRECTUV"]=0},e.BindTextureMatrix=function(e,t,r){var i=e.getTextureMatrix();t.updateMatrix(r+"Matrix",i)},e.GetFogState=function(e,t){return t.fogEnabled&&e.applyFog&&t.fogMode!==s.x.FOGMODE_NONE},e.PrepareDefinesForMisc=function(e,t,r,i,n,s,o){o._areMiscDirty&&(o.LOGARITHMICDEPTH=r,o.POINTSIZE=i,o.FOG=n&&this.GetFogState(e,t),o.NONUNIFORMSCALING=e.nonUniformScaling,o.ALPHATEST=s)},e.PrepareDefinesForFrameBoundValues=function(e,t,r,i,n,s){void 0===n&&(n=null),void 0===s&&(s=!1);var o,a,u,l,h,f,p=!1;o=null==n?void 0!==e.clipPlane&&null!==e.clipPlane:n,a=null==n?void 0!==e.clipPlane2&&null!==e.clipPlane2:n,u=null==n?void 0!==e.clipPlane3&&null!==e.clipPlane3:n,l=null==n?void 0!==e.clipPlane4&&null!==e.clipPlane4:n,h=null==n?void 0!==e.clipPlane5&&null!==e.clipPlane5:n,f=null==n?void 0!==e.clipPlane6&&null!==e.clipPlane6:n,r.CLIPPLANE!==o&&(r.CLIPPLANE=o,p=!0),r.CLIPPLANE2!==a&&(r.CLIPPLANE2=a,p=!0),r.CLIPPLANE3!==u&&(r.CLIPPLANE3=u,p=!0),r.CLIPPLANE4!==l&&(r.CLIPPLANE4=l,p=!0),r.CLIPPLANE5!==h&&(r.CLIPPLANE5=h,p=!0),r.CLIPPLANE6!==f&&(r.CLIPPLANE6=f,p=!0),r.DEPTHPREPASS!==!t.getColorWrite()&&(r.DEPTHPREPASS=!r.DEPTHPREPASS,p=!0),r.INSTANCES!==i&&(r.INSTANCES=i,p=!0),r.INSTANCESCOLOR&&!r.INSTANCES&&(r.INSTANCESCOLOR=!1,p=!0),r.THIN_INSTANCES!==s&&(r.THIN_INSTANCES=s,p=!0),p&&r.markAsUnprocessed()},e.PrepareDefinesForBones=function(e,t){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;var r=void 0!==t.BONETEXTURE;if(e.skeleton.isUsingTextureForMatrices&&r)t.BONETEXTURE=!0;else{t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!r&&void 0;var i=e.getScene().prePassRenderer;if(i&&i.enabled){var n=-1===i.excludedSkinnedMesh.indexOf(e);t.BONES_VELOCITY_ENABLED=n}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0},e.PrepareDefinesForMorphTargets=function(e,t){var r=e.morphTargetManager;r?(t.MORPHTARGETS_UV=r.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=r.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=r.supportsNormals&&t.NORMAL,t.MORPHTARGETS=r.numInfluencers>0,t.NUM_MORPH_INFLUENCERS=r.numInfluencers,t.MORPHTARGETS_TEXTURE=r.isUsingTextureForTargets):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)},e.PrepareDefinesForBakedVertexAnimation=function(e,t){var r=e.bakedVertexAnimationManager;t.BAKED_VERTEX_ANIMATION_TEXTURE=!(!r||!r.isEnabled)},e.PrepareDefinesForAttributes=function(e,t,r,i,n,s,o){if(void 0===n&&(n=!1),void 0===s&&(s=!0),void 0===o&&(o=!0),!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent(a.o.NormalKind),t._needNormals&&e.isVerticesDataPresent(a.o.TangentKind)&&(t.TANGENT=!0);for(var u=1;u<=6;++u)t["UV"+u]=!!t._needUVs&&e.isVerticesDataPresent("uv".concat(1===u?"":u));if(r){var l=e.useVertexColors&&e.isVerticesDataPresent(a.o.ColorKind);t.VERTEXCOLOR=l,t.VERTEXALPHA=e.hasVertexAlpha&&l&&s}return e.isVerticesDataPresent(a.o.ColorInstanceKind)&&(e.hasInstances||e.hasThinInstances)&&(t.INSTANCESCOLOR=!0),i&&this.PrepareDefinesForBones(e,t),n&&this.PrepareDefinesForMorphTargets(e,t),o&&this.PrepareDefinesForBakedVertexAnimation(e,t),!0},e.PrepareDefinesForMultiview=function(e,t){if(e.activeCamera){var r=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=r&&t.markAsUnprocessed()}},e.PrepareDefinesForOIT=function(e,t,r){var i=t.ORDER_INDEPENDENT_TRANSPARENCY,n=t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;t.ORDER_INDEPENDENT_TRANSPARENCY=e.useOrderIndependentTransparency&&r,t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!e.getEngine().getCaps().textureFloatLinearFiltering,i===t.ORDER_INDEPENDENT_TRANSPARENCY&&n===t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||t.markAsUnprocessed()},e.PrepareDefinesForPrePass=function(e,t,r){var i=t.PREPASS;if(t._arePrePassDirty){var n=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&r){t.PREPASS=!0,t.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount;for(var s=0;s<n.length;s++){var o=e.prePassRenderer.getIndex(n[s].type);-1!==o?(t[n[s].define]=!0,t[n[s].index]=o):t[n[s].define]=!1}}else{t.PREPASS=!1;for(s=0;s<n.length;s++)t[n[s].define]=!1}t.PREPASS!=i&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}},e.PrepareDefinesForLight=function(e,t,r,i,n,s,o){switch(o.needNormals=!0,void 0===n["LIGHT"+i]&&(o.needRebuild=!0),n["LIGHT"+i]=!0,n["SPOTLIGHT"+i]=!1,n["HEMILIGHT"+i]=!1,n["POINTLIGHT"+i]=!1,n["DIRLIGHT"+i]=!1,r.prepareLightSpecificDefines(n,i),n["LIGHT_FALLOFF_PHYSICAL"+i]=!1,n["LIGHT_FALLOFF_GLTF"+i]=!1,n["LIGHT_FALLOFF_STANDARD"+i]=!1,r.falloffType){case u._.FALLOFF_GLTF:n["LIGHT_FALLOFF_GLTF"+i]=!0;break;case u._.FALLOFF_PHYSICAL:n["LIGHT_FALLOFF_PHYSICAL"+i]=!0;break;case u._.FALLOFF_STANDARD:n["LIGHT_FALLOFF_STANDARD"+i]=!0}if(s&&!r.specular.equalsFloats(0,0,0)&&(o.specularEnabled=!0),n["SHADOW"+i]=!1,n["SHADOWCSM"+i]=!1,n["SHADOWCSMDEBUG"+i]=!1,n["SHADOWCSMNUM_CASCADES"+i]=!1,n["SHADOWCSMUSESHADOWMAXZ"+i]=!1,n["SHADOWCSMNOBLEND"+i]=!1,n["SHADOWCSM_RIGHTHANDED"+i]=!1,n["SHADOWPCF"+i]=!1,n["SHADOWPCSS"+i]=!1,n["SHADOWPOISSON"+i]=!1,n["SHADOWESM"+i]=!1,n["SHADOWCLOSEESM"+i]=!1,n["SHADOWCUBE"+i]=!1,n["SHADOWLOWQUALITY"+i]=!1,n["SHADOWMEDIUMQUALITY"+i]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&r.shadowEnabled){var a=r.getShadowGenerator();if(a){var l=a.getShadowMap();l&&l.renderList&&l.renderList.length>0&&(o.shadowEnabled=!0,a.prepareDefines(n,i))}}r.lightmapMode!=u._.LIGHTMAP_DEFAULT?(o.lightmapMode=!0,n["LIGHTMAPEXCLUDED"+i]=!0,n["LIGHTMAPNOSPECULAR"+i]=r.lightmapMode==u._.LIGHTMAP_SHADOWSONLY):(n["LIGHTMAPEXCLUDED"+i]=!1,n["LIGHTMAPNOSPECULAR"+i]=!1)},e.PrepareDefinesForLights=function(e,t,r,i,n,s){if(void 0===n&&(n=4),void 0===s&&(s=!1),!r._areLightsDirty)return r._needNormals;var o=0,a={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!s)for(var u=0,l=t.lightSources;u<l.length;u++){var h=l[u];if(this.PrepareDefinesForLight(e,t,h,o,r,i,a),++o===n)break}r.SPECULARTERM=a.specularEnabled,r.SHADOWS=a.shadowEnabled;for(var f=o;f<n;f++)void 0!==r["LIGHT"+f]&&(r["LIGHT"+f]=!1,r["HEMILIGHT"+f]=!1,r["POINTLIGHT"+f]=!1,r["DIRLIGHT"+f]=!1,r["SPOTLIGHT"+f]=!1,r["SHADOW"+f]=!1,r["SHADOWCSM"+f]=!1,r["SHADOWCSMDEBUG"+f]=!1,r["SHADOWCSMNUM_CASCADES"+f]=!1,r["SHADOWCSMUSESHADOWMAXZ"+f]=!1,r["SHADOWCSMNOBLEND"+f]=!1,r["SHADOWCSM_RIGHTHANDED"+f]=!1,r["SHADOWPCF"+f]=!1,r["SHADOWPCSS"+f]=!1,r["SHADOWPOISSON"+f]=!1,r["SHADOWESM"+f]=!1,r["SHADOWCLOSEESM"+f]=!1,r["SHADOWCUBE"+f]=!1,r["SHADOWLOWQUALITY"+f]=!1,r["SHADOWMEDIUMQUALITY"+f]=!1);var p=e.getEngine().getCaps();return void 0===r.SHADOWFLOAT&&(a.needRebuild=!0),r.SHADOWFLOAT=a.shadowEnabled&&(p.textureFloatRender&&p.textureFloatLinearFiltering||p.textureHalfFloatRender&&p.textureHalfFloatLinearFiltering),r.LIGHTMAPEXCLUDED=a.lightmapMode,a.needRebuild&&r.rebuild(),a.needNormals},e.PrepareUniformsAndSamplersForLight=function(e,t,r,i,n,s){void 0===n&&(n=null),void 0===s&&(s=!1),n&&n.push("Light"+e),s||(t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),r.push("shadowSampler"+e),r.push("depthSampler"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),i&&(r.push("projectionLightSampler"+e),t.push("textureProjectionMatrix"+e)))},e.PrepareUniformsAndSamplersList=function(e,t,r,i){var n;void 0===i&&(i=4);var s=null;if(e.uniformsNames){var o=e;n=o.uniformsNames,s=o.uniformBuffersNames,t=o.samplers,r=o.defines,i=o.maxSimultaneousLights||0}else n=e,t||(t=[]);for(var a=0;a<i&&r["LIGHT"+a];a++)this.PrepareUniformsAndSamplersForLight(a,n,t,r["PROJECTEDLIGHTTEXTURE"+a],s);r.NUM_MORPH_INFLUENCERS&&n.push("morphTargetInfluences"),r.BAKED_VERTEX_ANIMATION_TEXTURE&&(n.push("bakedVertexAnimationSettings"),n.push("bakedVertexAnimationTextureSizeInverted"),n.push("bakedVertexAnimationTime"),t.push("bakedVertexAnimationTexture"))},e.HandleFallbacksForShadows=function(e,t,r,i){void 0===r&&(r=4),void 0===i&&(i=0);for(var n=0,s=0;s<r&&e["LIGHT"+s];s++)s>0&&(n=i+s,t.addFallback(n,"LIGHT"+s)),e.SHADOWS||(e["SHADOW"+s]&&t.addFallback(i,"SHADOW"+s),e["SHADOWPCF"+s]&&t.addFallback(i,"SHADOWPCF"+s),e["SHADOWPCSS"+s]&&t.addFallback(i,"SHADOWPCSS"+s),e["SHADOWPOISSON"+s]&&t.addFallback(i,"SHADOWPOISSON"+s),e["SHADOWESM"+s]&&t.addFallback(i,"SHADOWESM"+s),e["SHADOWCLOSEESM"+s]&&t.addFallback(i,"SHADOWCLOSEESM"+s));return n++},e.PrepareAttributesForMorphTargetsInfluencers=function(e,t,r){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=r,this.PrepareAttributesForMorphTargets(e,t,this._TmpMorphInfluencers)},e.PrepareAttributesForMorphTargets=function(e,t,r){var n=r.NUM_MORPH_INFLUENCERS;if(n>0&&o.l.LastCreatedEngine){var s=o.l.LastCreatedEngine.getCaps().maxVertexAttribs,u=t.morphTargetManager;if(null==u?void 0:u.isUsingTextureForTargets)return;for(var l=u&&u.supportsNormals&&r.NORMAL,h=u&&u.supportsTangents&&r.TANGENT,f=u&&u.supportsUVs&&r.UV1,p=0;p<n;p++)e.push(a.o.PositionKind+p),l&&e.push(a.o.NormalKind+p),h&&e.push(a.o.TangentKind+p),f&&e.push(a.o.UVKind+"_"+p),e.length>s&&i.Y.Error("Cannot add more vertex attributes for mesh "+t.name)}},e.PrepareAttributesForBakedVertexAnimation=function(e,t,r){r.BAKED_VERTEX_ANIMATION_TEXTURE&&r.INSTANCES&&e.push("bakedVertexAnimationSettingsInstanced")},e.PrepareAttributesForBones=function(e,t,r,i){r.NUM_BONE_INFLUENCERS>0&&(i.addCPUSkinningFallback(0,t),e.push(a.o.MatricesIndicesKind),e.push(a.o.MatricesWeightsKind),r.NUM_BONE_INFLUENCERS>4&&(e.push(a.o.MatricesIndicesExtraKind),e.push(a.o.MatricesWeightsExtraKind)))},e.PrepareAttributesForInstances=function(e,t){(t.INSTANCES||t.THIN_INSTANCES)&&this.PushAttributesForInstances(e,!!t.PREPASS_VELOCITY),t.INSTANCESCOLOR&&e.push(a.o.ColorInstanceKind)},e.PushAttributesForInstances=function(e,t){void 0===t&&(t=!1),e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"),t&&(e.push("previousWorld0"),e.push("previousWorld1"),e.push("previousWorld2"),e.push("previousWorld3"))},e.BindLightProperties=function(e,t,r){e.transferToEffect(t,r+"")},e.BindLight=function(e,t,r,i,n,s){void 0===s&&(s=!0),e._bindLight(t,r,i,n,s)},e.BindLights=function(e,t,r,i,n){void 0===n&&(n=4);for(var s=Math.min(t.lightSources.length,n),o=0;o<s;o++){var a=t.lightSources[o];this.BindLight(a,o,e,r,"boolean"==typeof i?i:i.SPECULARTERM,t.receiveShadows)}},e.BindFogParameters=function(e,t,r,i){void 0===i&&(i=!1),e.fogEnabled&&t.applyFog&&e.fogMode!==s.x.FOGMODE_NONE&&(r.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),i?(e.fogColor.toLinearSpaceToRef(this._TempFogColor),r.setColor3("vFogColor",this._TempFogColor)):r.setColor3("vFogColor",e.fogColor))},e.BindBonesParameters=function(t,r,i){if(r&&t&&(t.computeBonesUsingShaders&&r._bonesComputationForcedToCPU&&(t.computeBonesUsingShaders=!1),t.useBones&&t.computeBonesUsingShaders&&t.skeleton)){var n=t.skeleton;if(n.isUsingTextureForMatrices&&r.getUniformIndex("boneTextureWidth")>-1){var s=n.getTransformMatrixTexture(t);r.setTexture("boneSampler",s),r.setFloat("boneTextureWidth",4*(n.bones.length+1))}else{var o=n.getTransformMatrices(t);o&&(r.setMatrices("mBones",o),i&&t.getScene().prePassRenderer&&t.getScene().prePassRenderer.getIndex(2)&&(i.previousBones[t.uniqueId]||(i.previousBones[t.uniqueId]=o.slice()),r.setMatrices("mPreviousBones",i.previousBones[t.uniqueId]),e._CopyBonesTransformationMatrices(o,i.previousBones[t.uniqueId])))}}},e._CopyBonesTransformationMatrices=function(e,t){return t.set(e),t},e.BindMorphTargetParameters=function(e,t){var r=e.morphTargetManager;e&&r&&t.setFloatArray("morphTargetInfluences",r.influences)},e.BindLogDepth=function(e,t,r){if(!e||e.LOGARITHMICDEPTH){var s=r.activeCamera;s.mode===n.V.ORTHOGRAPHIC_CAMERA&&i.Y.Error("Logarithmic depth is not compatible with orthographic cameras!",20),t.setFloat("logarithmicDepthConstant",2/(Math.log(s.maxZ+1)/Math.LN2))}},e.BindClipPlane=function(e,t){h.O.BindClipPlane(e,t)},e._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},e._TempFogColor=l.Wo.Black(),e}()},32836:(e,t,r)=>{r.d(t,{n:()=>o});var i=r(31191),n=r(96969),s=r(76045),o=function(){function e(e,t,r,i,n,o){void 0===n&&(n=!0),void 0===o&&(o=!1),this.priority=500,this.registerForExtraEvents=!1,this._material=e,this.name=t,this.priority=r,e.pluginManager||(e.pluginManager=new s.BK(e)),this._pluginDefineNames=i,this._pluginManager=e.pluginManager,n&&this._pluginManager._addPlugin(this),o&&this._enable(!0),this.markAllDefinesAsDirty=e._dirtyCallbacks[63]}return e.prototype._enable=function(e){e&&this._pluginManager._activatePlugin(this)},e.prototype.getClassName=function(){return"MaterialPluginBase"},e.prototype.isReadyForSubMesh=function(e,t,r,i){return!0},e.prototype.hardBindForSubMesh=function(e,t,r,i){},e.prototype.bindForSubMesh=function(e,t,r,i){},e.prototype.dispose=function(e){},e.prototype.getCustomCode=function(e){return null},e.prototype.collectDefines=function(e){if(this._pluginDefineNames)for(var t=0,r=Object.keys(this._pluginDefineNames);t<r.length;t++){var i=r[t];if("_"!==i[0]){var n=typeof this._pluginDefineNames[i];e[i]={type:"number"===n?"number":"string"===n?"string":"boolean"===n?"boolean":"object",default:this._pluginDefineNames[i]}}}},e.prototype.prepareDefinesBeforeAttributes=function(e,t,r){},e.prototype.prepareDefines=function(e,t,r){},e.prototype.hasTexture=function(e){return!1},e.prototype.hasRenderTargetTextures=function(){return!1},e.prototype.fillRenderTargetTextures=function(e){},e.prototype.getActiveTextures=function(e){},e.prototype.getAnimatables=function(e){},e.prototype.addFallbacks=function(e,t,r){return r},e.prototype.getSamplers=function(e){},e.prototype.getAttributes=function(e){},e.prototype.getUniformBuffersNames=function(e){},e.prototype.getUniforms=function(){return{}},e.prototype.copyTo=function(e){n.p4.Clone((function(){return e}),this)},e.prototype.serialize=function(){return n.p4.Serialize(this)},e.prototype.parse=function(e,t,r){var i=this;n.p4.Parse((function(){return i}),e,t,r)},(0,i.gn)([(0,n.qC)()],e.prototype,"name",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"priority",void 0),(0,i.gn)([(0,n.qC)()],e.prototype,"registerForExtraEvents",void 0),e}()},67555:(e,t,r)=>{var i;r.d(t,{S:()=>i}),function(e){e[e.Created=1]="Created",e[e.Disposed=2]="Disposed",e[e.GetDefineNames=4]="GetDefineNames",e[e.PrepareUniformBuffer=8]="PrepareUniformBuffer",e[e.IsReadyForSubMesh=16]="IsReadyForSubMesh",e[e.PrepareDefines=32]="PrepareDefines",e[e.BindForSubMesh=64]="BindForSubMesh",e[e.PrepareEffect=128]="PrepareEffect",e[e.GetAnimatables=256]="GetAnimatables",e[e.GetActiveTextures=512]="GetActiveTextures",e[e.HasTexture=1024]="HasTexture",e[e.FillRenderTargetTextures=2048]="FillRenderTargetTextures",e[e.HasRenderTargetTextures=4096]="HasRenderTargetTextures",e[e.HardBindForSubMesh=8192]="HardBindForSubMesh"}(i||(i={}))},76045:(e,t,r)=>{r.d(t,{BK:()=>s,Dh:()=>h,jD:()=>l,rs:()=>u});var i=r(98163),n=r(67555),s=function(){function e(e){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=e,this._scene=e.getScene(),this._engine=this._scene.getEngine()}return e.prototype._addPlugin=function(t){for(var r=0;r<this._plugins.length;++r)if(this._plugins[r].name===t.name)throw'Plugin "'.concat(t.name,'" already added to the material "').concat(this._material.name,'"!');if(this._material._uniformBufferLayoutBuilt)throw'The plugin "'.concat(t.name,'" can\'t be added to the material "').concat(this._material.name,'" because this material has already been used for rendering! Please add plugins to materials before any rendering with this material occurs.');var i=t.getClassName();e._MaterialPluginClassToMainDefine[i]||(e._MaterialPluginClassToMainDefine[i]="MATERIALPLUGIN_"+ ++e._MaterialPluginCounter),this._material._callbackPluginEventGeneric=this._handlePluginEvent.bind(this),this._plugins.push(t),this._plugins.sort((function(e,t){return e.priority-t.priority})),this._codeInjectionPoints={};var n={};n[e._MaterialPluginClassToMainDefine[i]]={type:"boolean",default:!0};for(var s=0,o=this._plugins;s<o.length;s++){var a=o[s];a.collectDefines(n),this._collectPointNames("vertex",a.getCustomCode("vertex")),this._collectPointNames("fragment",a.getCustomCode("fragment"))}this._defineNamesFromPlugins=n},e.prototype._activatePlugin=function(e){-1===this._activePlugins.indexOf(e)&&(this._activePlugins.push(e),this._activePlugins.sort((function(e,t){return e.priority-t.priority})),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),e.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(e),this._activePluginsForExtraEvents.sort((function(e,t){return e.priority-t.priority})),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))},e.prototype.getPlugin=function(e){for(var t=0;t<this._plugins.length;++t)if(this._plugins[t].name===e)return this._plugins[t];return null},e.prototype._handlePluginEventIsReadyForSubMesh=function(e){for(var t=!0,r=0,i=this._activePlugins;r<i.length;r++){var n=i[r];t=t&&n.isReadyForSubMesh(e.defines,this._scene,this._engine,e.subMesh)}e.isReadyForSubMesh=t},e.prototype._handlePluginEventPrepareDefinesBeforeAttributes=function(e){for(var t=0,r=this._activePlugins;t<r.length;t++){r[t].prepareDefinesBeforeAttributes(e.defines,this._scene,e.mesh)}},e.prototype._handlePluginEventPrepareDefines=function(e){for(var t=0,r=this._activePlugins;t<r.length;t++){r[t].prepareDefines(e.defines,this._scene,e.mesh)}},e.prototype._handlePluginEventHardBindForSubMesh=function(e){for(var t=0,r=this._activePluginsForExtraEvents;t<r.length;t++){r[t].hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}},e.prototype._handlePluginEventBindForSubMesh=function(e){for(var t=0,r=this._activePlugins;t<r.length;t++){r[t].bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,e.subMesh)}},e.prototype._handlePluginEventHasRenderTargetTextures=function(e){for(var t=!1,r=0,i=this._activePluginsForExtraEvents;r<i.length;r++){if(t=i[r].hasRenderTargetTextures())break}e.hasRenderTargetTextures=t},e.prototype._handlePluginEventFillRenderTargetTextures=function(e){for(var t=0,r=this._activePluginsForExtraEvents;t<r.length;t++){r[t].fillRenderTargetTextures(e.renderTargets)}},e.prototype._handlePluginEvent=function(e,t){var r,i,s;switch(e){case n.S.GetActiveTextures:for(var o=t,a=0,u=this._activePlugins;a<u.length;a++){(b=u[a]).getActiveTextures(o.activeTextures)}break;case n.S.GetAnimatables:o=t;for(var l=0,h=this._activePlugins;l<h.length;l++){(b=h[l]).getAnimatables(o.animatables)}break;case n.S.HasTexture:o=t;for(var f=!1,p=0,c=this._activePlugins;p<c.length;p++){if(f=(b=c[p]).hasTexture(o.texture))break}o.hasTexture=f;break;case n.S.Disposed:o=t;for(var d=0,_=this._plugins;d<_.length;d++){(b=_[d]).dispose(o.forceDisposeTextures)}break;case n.S.GetDefineNames:(o=t).defineNames=this._defineNamesFromPlugins;break;case n.S.PrepareEffect:o=t;for(var m=0,g=this._activePlugins;m<g.length;m++){var b=g[m];o.fallbackRank=b.addFallbacks(o.defines,o.fallbacks,o.fallbackRank),b.getAttributes(o.attributes)}this._uniformList.length>0&&(r=o.uniforms).push.apply(r,this._uniformList),this._samplerList.length>0&&(i=o.samplers).push.apply(i,this._samplerList),this._uboList.length>0&&(s=o.uniformBuffersNames).push.apply(s,this._uboList),o.customCode=this._injectCustomCode(o.customCode);break;case n.S.PrepareUniformBuffer:o=t;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];for(var y=0,E=this._plugins;y<E.length;y++){var v=(b=E[y]).getUniforms();if(v){if(v.ubo)for(var T=0,x=v.ubo;T<x.length;T++){var A=x[T];o.ubo.addUniform(A.name,A.size),this._uboDeclaration+="".concat(A.type," ").concat(A.name,";\r\n"),this._uniformList.push(A.name)}v.vertex&&(this._vertexDeclaration+=v.vertex+"\r\n"),v.fragment&&(this._fragmentDeclaration+=v.fragment+"\r\n")}b.getSamplers(this._samplerList),b.getUniformBuffersNames(this._uboList)}}},e.prototype._collectPointNames=function(e,t){if(t)for(var r in t)this._codeInjectionPoints[e]||(this._codeInjectionPoints[e]={}),this._codeInjectionPoints[e][r]=!0},e.prototype._injectCustomCode=function(e){var t=this;return function(r,i){var n;e&&(i=e(r,i)),t._uboDeclaration&&(i=i.replace("#define ADDITIONAL_UBO_DECLARATION",t._uboDeclaration)),t._vertexDeclaration&&(i=i.replace("#define ADDITIONAL_VERTEX_DECLARATION",t._vertexDeclaration)),t._fragmentDeclaration&&(i=i.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",t._fragmentDeclaration));var s=null===(n=t._codeInjectionPoints)||void 0===n?void 0:n[r];if(!s)return i;for(var o in s){for(var a="",u=0,l=t._activePlugins;u<l.length;u++){var h=l[u].getCustomCode(r);(null==h?void 0:h[o])&&(a+=h[o]+"\r\n")}if(a.length>0)if("!"===o.charAt(0))for(var f=new RegExp(o.substring(1),"g"),p=f.exec(i);null!==p;){for(var c=a,d=0;d<p.length;++d)c=c.replace("$"+d,p[d]);i=i.replace(p[0],c),p=f.exec(i)}else{var _="#define "+o;i=i.replace(_,"\r\n"+a+"\r\n"+_)}}return i}},e._MaterialPluginClassToMainDefine={},e._MaterialPluginCounter=0,e}(),o=4826==r.j?[]:null,a=!1;function u(e,t){a||(i.F.OnEventObservable.add((function(e){for(var t=0,r=o;t<r.length;t++){(0,r[t][1])(e)}}),n.S.Created),a=!0);var r=o.filter((function(t){var r=t[0];t[1];return r===e}));r.length>0?r[0][1]=t:o.push([e,t])}function l(e){for(var t=0;t<o.length;++t)if(o[t][0]===e)return o.splice(t,1),!0;return!1}function h(){o.length=0}},91855:(e,t,r)=>{r.d(t,{G:()=>a});var i=r(31191),n=r(98163),s=r(20163),o=r(48620),a=function(e){function t(t,r){var i=e.call(this,t,r,!0)||this;return i._waitingSubMaterialsUniqueIds=[],i.getScene().multiMaterials.push(i),i.subMaterials=new Array,i._storeEffectOnSubMeshes=!0,i}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(e){this._subMaterials=e,this._hookArray(e)},enumerable:!1,configurable:!0}),t.prototype.getChildren=function(){return this.subMaterials},t.prototype._hookArray=function(e){var t=this,r=e.push;e.push=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var s=r.apply(e,i);return t._markAllSubMeshesAsTexturesDirty(),s};var i=e.splice;e.splice=function(r,n){var s=i.apply(e,[r,n]);return t._markAllSubMeshesAsTexturesDirty(),s}},t.prototype.getSubMaterial=function(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]},t.prototype.getActiveTextures=function(){var t;return(t=e.prototype.getActiveTextures.call(this)).concat.apply(t,this.subMaterials.map((function(e){return e?e.getActiveTextures():[]})))},t.prototype.hasTexture=function(t){var r;if(e.prototype.hasTexture.call(this,t))return!0;for(var i=0;i<this.subMaterials.length;i++)if(null===(r=this.subMaterials[i])||void 0===r?void 0:r.hasTexture(t))return!0;return!1},t.prototype.getClassName=function(){return"MultiMaterial"},t.prototype.isReadyForSubMesh=function(e,t,r){for(var i=0;i<this.subMaterials.length;i++){var n=this.subMaterials[i];if(n){if(n._storeEffectOnSubMeshes){if(!n.isReadyForSubMesh(e,t,r))return!1;continue}if(!n.isReady(e))return!1}}return!0},t.prototype.clone=function(e,r){for(var i=new t(e,this.getScene()),n=0;n<this.subMaterials.length;n++){var s=null,o=this.subMaterials[n];s=r&&o?o.clone(e+"-"+o.name):this.subMaterials[n],i.subMaterials.push(s)}return i},t.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,s.$&&(e.tags=s.$.GetTags(this)),e.materialsUniqueIds=[],e.materials=[];for(var t=0;t<this.subMaterials.length;t++){var r=this.subMaterials[t];r?(e.materialsUniqueIds.push(r.uniqueId),e.materials.push(r.id)):(e.materialsUniqueIds.push(null),e.materials.push(null))}return e},t.prototype.dispose=function(t,r,i){var n=this.getScene();if(n){if(i)for(var s=0;s<this.subMaterials.length;s++){var o=this.subMaterials[s];o&&o.dispose(t,r)}var a=n.multiMaterials.indexOf(this);a>=0&&n.multiMaterials.splice(a,1),e.prototype.dispose.call(this,t,r)}},t.ParseMultiMaterial=function(e,r){var i=new t(e.name,r);return i.id=e.id,i._loadedUniqueId=e.uniqueId,s.$&&s.$.AddTagsTo(i,e.tags),e.materialsUniqueIds?i._waitingSubMaterialsUniqueIds=e.materialsUniqueIds:e.materials.forEach((function(e){return i.subMaterials.push(r.getLastMaterialById(e))})),i},t}(n.F);(0,o.H)("BABYLON.MultiMaterial",a)},94028:(e,t,r)=>{r.d(t,{o:()=>i});var i=function(){function e(){this.previousWorldMatrices={},this.previousBones={}}return e.AddUniforms=function(e){e.push("previousWorld","previousViewProjection","mPreviousBones")},e.AddSamplers=function(e){},e.prototype.bindForSubMesh=function(e,t,r,i,n){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&-1!==t.prePassRenderer.getIndex(2)){this.previousWorldMatrices[r.uniqueId]||(this.previousWorldMatrices[r.uniqueId]=i.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());var s=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=s.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(t.getTransformMatrix())):this._lastUpdateFrameId!==s.frameId&&(this._lastUpdateFrameId=s.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),e.setMatrix("previousWorld",this.previousWorldMatrices[r.uniqueId]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[r.uniqueId]=i.clone()}},e}()},74375:(e,t,r)=>{r.d(t,{a:()=>s});var i=r(31191),n=r(58095),s=function(e){function t(t,r,i){void 0===i&&(i=!0);var s=e.call(this,t,r)||this;return s._normalMatrix=new n.y3,s._storeEffectOnSubMeshes=i,s}return(0,i.ZT)(t,e),t.prototype.getEffect=function(){return this._storeEffectOnSubMeshes?this._activeEffect:e.prototype.getEffect.call(this)},t.prototype.isReady=function(e,t){return!!e&&(!this._storeEffectOnSubMeshes||(!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t)))},t.prototype._isReadyForSubMesh=function(e){var t=e.materialDefines;return!(this.checkReadyOnEveryCall||!e.effect||!t||t._renderId!==this.getScene().getRenderId())},t.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},t.prototype.bindOnlyNormalMatrix=function(e){this._activeEffect.setMatrix("normalMatrix",e)},t.prototype.bind=function(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])},t.prototype._afterBind=function(t,r){void 0===r&&(r=null),e.prototype._afterBind.call(this,t,r),this.getScene()._cachedEffect=r},t.prototype._mustRebind=function(e,t,r){return void 0===r&&(r=1),e.isCachedMaterialInvalid(this,t,r)},t}(r(98163).F)},41659:(e,t,r)=>{var i;r.d(t,{x:()=>i}),function(e){e[e.GLSL=0]="GLSL",e[e.WGSL=1]="WGSL"}(i||(i={}))},54067:(e,t,r)=>{r.d(t,{j:()=>m});var i=r(31191),n=r(96969),s=r(58095),o=r(72208),a=r(73803),u=r(90360),l=r(48620),h=r(15631),f=r(38309),p=r(51912),c=r(74375),d=r(15210),_={effect:null,subMesh:null},m=function(e){function t(t,r,n,o,a){void 0===o&&(o={}),void 0===a&&(a=!0);var u=e.call(this,t,r,a)||this;return u._textures={},u._textureArrays={},u._externalTextures={},u._floats={},u._ints={},u._floatsArrays={},u._colors3={},u._colors3Arrays={},u._colors4={},u._colors4Arrays={},u._vectors2={},u._vectors3={},u._vectors4={},u._matrices={},u._matrixArrays={},u._matrices3x3={},u._matrices2x2={},u._vectors2Arrays={},u._vectors3Arrays={},u._vectors4Arrays={},u._uniformBuffers={},u._textureSamplers={},u._storageBuffers={},u._cachedWorldViewMatrix=new s.y3,u._cachedWorldViewProjectionMatrix=new s.y3,u._multiview=!1,u._shaderPath=n,u._options=(0,i.pi)({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1},o),u}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"shaderPath",{get:function(){return this._shaderPath},set:function(e){this._shaderPath=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"ShaderMaterial"},t.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},t.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},t.prototype._checkUniform=function(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)},t.prototype.setTexture=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this},t.prototype.setTextureArray=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this},t.prototype.setExternalTexture=function(e,t){return-1===this._options.externalTextures.indexOf(e)&&this._options.externalTextures.push(e),this._externalTextures[e]=t,this},t.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},t.prototype.setInt=function(e,t){return this._checkUniform(e),this._ints[e]=t,this},t.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},t.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},t.prototype.setColor3Array=function(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce((function(e,t){return t.toArray(e,e.length),e}),[]),this},t.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},t.prototype.setColor4Array=function(e,t){return this._checkUniform(e),this._colors4Arrays[e]=t.reduce((function(e,t){return t.toArray(e,e.length),e}),[]),this},t.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},t.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},t.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[e]=t,this},t.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},t.prototype.setMatrices=function(e,t){this._checkUniform(e);for(var r=new Float32Array(16*t.length),i=0;i<t.length;i++){t[i].copyToArray(r,16*i)}return this._matrixArrays[e]=r,this},t.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this},t.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this},t.prototype.setArray2=function(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this},t.prototype.setArray3=function(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this},t.prototype.setArray4=function(e,t){return this._checkUniform(e),this._vectors4Arrays[e]=t,this},t.prototype.setUniformBuffer=function(e,t){return-1===this._options.uniformBuffers.indexOf(e)&&this._options.uniformBuffers.push(e),this._uniformBuffers[e]=t,this},t.prototype.setTextureSampler=function(e,t){return-1===this._options.samplerObjects.indexOf(e)&&this._options.samplerObjects.push(e),this._textureSamplers[e]=t,this},t.prototype.setStorageBuffer=function(e,t){return-1===this._options.storageBuffers.indexOf(e)&&this._options.storageBuffers.push(e),this._storageBuffers[e]=t,this},t.prototype.isReadyForSubMesh=function(e,t,r){return this.isReady(e,r,t)},t.prototype.isReady=function(e,t,r){var i,n,s,a,l=r&&this._storeEffectOnSubMeshes;if(this.isFrozen)if(l){if(r.effect&&r.effect._wasPreviouslyReady)return!0}else{var h=this._drawWrapper.effect;if(h&&h._wasPreviouslyReady&&this._effectUsesInstances===t)return!0}var p=this.getScene(),c=p.getEngine(),d=[],m=[],g=new f.L,b=this._shaderPath,y=this._options.uniforms,E=this._options.uniformBuffers,v=this._options.samplers;c.getCaps().multiview&&p.activeCamera&&p.activeCamera.outputRenderTarget&&p.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,d.push("#define MULTIVIEW"),-1!==this._options.uniforms.indexOf("viewProjection")&&-1===this._options.uniforms.indexOf("viewProjectionR")&&this._options.uniforms.push("viewProjectionR"));for(var T=0;T<this._options.defines.length;T++){var x=0===this._options.defines[T].indexOf("#define")?this._options.defines[T]:"#define ".concat(this._options.defines[T]);d.push(x)}for(T=0;T<this._options.attributes.length;T++)m.push(this._options.attributes[T]);if(e&&e.isVerticesDataPresent(o.o.ColorKind)&&(m.push(o.o.ColorKind),d.push("#define VERTEXCOLOR")),t&&(d.push("#define INSTANCES"),u.G.PushAttributesForInstances(m),(null==e?void 0:e.hasThinInstances)&&(d.push("#define THIN_INSTANCES"),e&&e.isVerticesDataPresent(o.o.ColorInstanceKind)&&(m.push(o.o.ColorInstanceKind),d.push("#define INSTANCESCOLOR")))),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){m.push(o.o.MatricesIndicesKind),m.push(o.o.MatricesWeightsKind),e.numBoneInfluencers>4&&(m.push(o.o.MatricesIndicesExtraKind),m.push(o.o.MatricesWeightsExtraKind));var A=e.skeleton;d.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),g.addCPUSkinningFallback(0,e),A.isUsingTextureForMatrices?(d.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(d.push("#define BonesPerMesh "+(A.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else d.push("#define NUM_BONE_INFLUENCERS 0");var C=0,P=e?e.morphTargetManager:null;if(P){var S=P.supportsUVs&&-1!==d.indexOf("#define UV1"),M=P.supportsTangents&&-1!==d.indexOf("#define TANGENT"),O=P.supportsNormals&&-1!==d.indexOf("#define NORMAL");C=P.numInfluencers,S&&d.push("#define MORPHTARGETS_UV"),M&&d.push("#define MORPHTARGETS_TANGENT"),O&&d.push("#define MORPHTARGETS_NORMAL"),C>0&&d.push("#define MORPHTARGETS"),P.isUsingTextureForTargets&&(d.push("#define MORPHTARGETS_TEXTURE"),-1===this._options.uniforms.indexOf("morphTargetTextureIndices")&&this._options.uniforms.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),d.push("#define NUM_MORPH_INFLUENCERS "+C);for(T=0;T<C;T++)m.push(o.o.PositionKind+T),O&&m.push(o.o.NormalKind+T),M&&m.push(o.o.TangentKind+T),S&&m.push(o.o.UVKind+"_"+T);C>0&&((y=y.slice()).push("morphTargetInfluences"),y.push("morphTargetTextureInfo"),y.push("morphTargetTextureIndices"))}else d.push("#define NUM_MORPH_INFLUENCERS 0");if(e){var I=e.bakedVertexAnimationManager;I&&I.isEnabled&&(d.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===this._options.uniforms.indexOf("bakedVertexAnimationSettings")&&this._options.uniforms.push("bakedVertexAnimationSettings"),-1===this._options.uniforms.indexOf("bakedVertexAnimationTextureSizeInverted")&&this._options.uniforms.push("bakedVertexAnimationTextureSizeInverted"),-1===this._options.uniforms.indexOf("bakedVertexAnimationTime")&&this._options.uniforms.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),u.G.PrepareAttributesForBakedVertexAnimation(m,e,d)}for(var R in this._textures)if(!this._textures[R].isReady())return!1;e&&this._shouldTurnAlphaTestOn(e)&&d.push("#define ALPHATEST"),(null===this._options.useClipPlane&&p.clipPlane||this._options.useClipPlane)&&(d.push("#define CLIPPLANE"),-1===y.indexOf("vClipPlane")&&y.push("vClipPlane")),(null===this._options.useClipPlane&&p.clipPlane2||this._options.useClipPlane)&&(d.push("#define CLIPPLANE2"),-1===y.indexOf("vClipPlane2")&&y.push("vClipPlane2")),(null===this._options.useClipPlane&&p.clipPlane3||this._options.useClipPlane)&&(d.push("#define CLIPPLANE3"),-1===y.indexOf("vClipPlane3")&&y.push("vClipPlane3")),(null===this._options.useClipPlane&&p.clipPlane4||this._options.useClipPlane)&&(d.push("#define CLIPPLANE4"),-1===y.indexOf("vClipPlane4")&&y.push("vClipPlane4")),(null===this._options.useClipPlane&&p.clipPlane5||this._options.useClipPlane)&&(d.push("#define CLIPPLANE5"),-1===y.indexOf("vClipPlane5")&&y.push("vClipPlane5")),(null===this._options.useClipPlane&&p.clipPlane6||this._options.useClipPlane)&&(d.push("#define CLIPPLANE6"),-1===y.indexOf("vClipPlane6")&&y.push("vClipPlane6")),this.customShaderNameResolve&&(y=y.slice(),E=E.slice(),v=v.slice(),b=this.customShaderNameResolve(b,y,E,v,d,m));var D=l?r._getDrawWrapper():this._drawWrapper,F=null!==(i=null==D?void 0:D.effect)&&void 0!==i?i:null,L=null!==(n=null==D?void 0:D.defines)&&void 0!==n?n:null,N=d.join("\n"),B=F;return L!==N&&(B=c.createEffect(b,{attributes:m,uniformsNames:y,uniformBuffersNames:E,samplers:v,defines:N,fallbacks:g,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:C},shaderLanguage:this._options.shaderLanguage},c),l?r.setEffect(B,N,this._materialContext):D&&D.setEffect(B,N),this._onEffectCreatedObservable&&(_.effect=B,_.subMesh=null!==(s=null!=r?r:null==e?void 0:e.subMeshes[0])&&void 0!==s?s:null,this._onEffectCreatedObservable.notifyObservers(_))),this._effectUsesInstances=!!t,null!==(a=!(null==B?void 0:B.isReady()))&&void 0!==a&&!a&&(F!==B&&p.resetCachedMaterial(),B._wasPreviouslyReady=!0,!0)},t.prototype.bindOnlyWorldMatrix=function(e,t){var r=this.getScene(),i=null!=t?t:this.getEffect();i&&(-1!==this._options.uniforms.indexOf("world")&&i.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(r.getViewMatrix(),this._cachedWorldViewMatrix),i.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(e.multiplyToRef(r.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),i.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)))},t.prototype.bindForSubMesh=function(e,t,r){var i;this.bind(e,t,null===(i=r._drawWrapperOverride)||void 0===i?void 0:i.effect,r)},t.prototype.bind=function(e,t,r,i){var n,s=i&&this._storeEffectOnSubMeshes,o=null!=r?r:s?i.effect:this.getEffect();if(o){this._activeEffect=o,this.bindOnlyWorldMatrix(e,r);var a=this._options.uniformBuffers,l=!1;if(o&&a&&a.length>0&&this.getScene().getEngine().supportsUniformBuffers)for(var h=0;h<a.length;++h){switch(a[h]){case"Mesh":t&&(t.getMeshUniformBuffer().bindToEffect(o,"Mesh"),t.transferToEffect(e));break;case"Scene":u.G.BindSceneUniformBuffer(o,this.getScene().getSceneUniformBuffer()),this.getScene().finalizeSceneUbo(),l=!0}}var f=t&&s?this._mustRebind(this.getScene(),o,t.visibility):this.getScene().getCachedMaterial()!==this;if(o&&f){var p;for(p in l||-1===this._options.uniforms.indexOf("view")||o.setMatrix("view",this.getScene().getViewMatrix()),l||-1===this._options.uniforms.indexOf("projection")||o.setMatrix("projection",this.getScene().getProjectionMatrix()),l||-1===this._options.uniforms.indexOf("viewProjection")||(o.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._multiview&&o.setMatrix("viewProjectionR",this.getScene()._transformMatrixR)),this.getScene().activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&o.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition),u.G.BindBonesParameters(t,o),u.G.BindClipPlane(o,this.getScene()),this._textures)o.setTexture(p,this._textures[p]);for(p in this._textureArrays)o.setTextureArray(p,this._textureArrays[p]);for(p in this._externalTextures)o.setExternalTexture(p,this._externalTextures[p]);for(p in this._ints)o.setInt(p,this._ints[p]);for(p in this._floats)o.setFloat(p,this._floats[p]);for(p in this._floatsArrays)o.setArray(p,this._floatsArrays[p]);for(p in this._colors3)o.setColor3(p,this._colors3[p]);for(p in this._colors3Arrays)o.setArray3(p,this._colors3Arrays[p]);for(p in this._colors4){var c=this._colors4[p];o.setFloat4(p,c.r,c.g,c.b,c.a)}for(p in this._colors4Arrays)o.setArray4(p,this._colors4Arrays[p]);for(p in this._vectors2)o.setVector2(p,this._vectors2[p]);for(p in this._vectors3)o.setVector3(p,this._vectors3[p]);for(p in this._vectors4)o.setVector4(p,this._vectors4[p]);for(p in this._matrices)o.setMatrix(p,this._matrices[p]);for(p in this._matrixArrays)o.setMatrices(p,this._matrixArrays[p]);for(p in this._matrices3x3)o.setMatrix3x3(p,this._matrices3x3[p]);for(p in this._matrices2x2)o.setMatrix2x2(p,this._matrices2x2[p]);for(p in this._vectors2Arrays)o.setArray2(p,this._vectors2Arrays[p]);for(p in this._vectors3Arrays)o.setArray3(p,this._vectors3Arrays[p]);for(p in this._vectors4Arrays)o.setArray4(p,this._vectors4Arrays[p]);for(p in this._uniformBuffers){var d=this._uniformBuffers[p].getBuffer();d&&o.bindUniformBuffer(d,p)}for(p in this._textureSamplers)o.setTextureSampler(p,this._textureSamplers[p]);for(p in this._storageBuffers)o.setStorageBuffer(p,this._storageBuffers[p])}if(o&&t&&(f||!this.isFrozen)){var _=t.morphTargetManager;_&&_.numInfluencers>0&&u.G.BindMorphTargetParameters(t,o);var m=t.bakedVertexAnimationManager;m&&m.isEnabled&&(null===(n=t.bakedVertexAnimationManager)||void 0===n||n.bind(o,this._effectUsesInstances))}this._afterBind(t,o)}},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);for(var r in this._textures)t.push(this._textures[r]);for(var i in this._textureArrays)for(var n=this._textureArrays[i],s=0;s<n.length;s++)t.push(n[s]);return t},t.prototype.hasTexture=function(t){if(e.prototype.hasTexture.call(this,t))return!0;for(var r in this._textures)if(this._textures[r]===t)return!0;for(var i in this._textureArrays)for(var n=this._textureArrays[i],s=0;s<n.length;s++)if(n[s]===t)return!0;return!1},t.prototype.clone=function(e){var r=this,s=n.p4.Clone((function(){return new t(e,r.getScene(),r._shaderPath,r._options,r._storeEffectOnSubMeshes)}),this);for(var o in s.name=e,s.id=e,"object"==typeof s._shaderPath&&(s._shaderPath=(0,i.pi)({},s._shaderPath)),this._options=(0,i.pi)({},this._options),Object.keys(this._options).forEach((function(e){var t=r._options[e];Array.isArray(t)&&(r._options[e]=t.slice(0))})),this.stencil.copyTo(s.stencil),this._textures)s.setTexture(o,this._textures[o]);for(var o in this._textureArrays)s.setTextureArray(o,this._textureArrays[o]);for(var o in this._externalTextures)s.setExternalTexture(o,this._externalTextures[o]);for(var o in this._ints)s.setInt(o,this._ints[o]);for(var o in this._floats)s.setFloat(o,this._floats[o]);for(var o in this._floatsArrays)s.setFloats(o,this._floatsArrays[o]);for(var o in this._colors3)s.setColor3(o,this._colors3[o]);for(var o in this._colors3Arrays)s._colors3Arrays[o]=this._colors3Arrays[o];for(var o in this._colors4)s.setColor4(o,this._colors4[o]);for(var o in this._colors4Arrays)s._colors4Arrays[o]=this._colors4Arrays[o];for(var o in this._vectors2)s.setVector2(o,this._vectors2[o]);for(var o in this._vectors3)s.setVector3(o,this._vectors3[o]);for(var o in this._vectors4)s.setVector4(o,this._vectors4[o]);for(var o in this._matrices)s.setMatrix(o,this._matrices[o]);for(var o in this._matrixArrays)s._matrixArrays[o]=this._matrixArrays[o].slice();for(var o in this._matrices3x3)s.setMatrix3x3(o,this._matrices3x3[o]);for(var o in this._matrices2x2)s.setMatrix2x2(o,this._matrices2x2[o]);for(var o in this._vectors2Arrays)s.setArray2(o,this._vectors2Arrays[o]);for(var o in this._vectors3Arrays)s.setArray3(o,this._vectors3Arrays[o]);for(var o in this._vectors4Arrays)s.setArray4(o,this._vectors4Arrays[o]);for(var o in this._uniformBuffers)s.setUniformBuffer(o,this._uniformBuffers[o]);for(var o in this._textureSamplers)s.setTextureSampler(o,this._textureSamplers[o]);for(var o in this._storageBuffers)s.setStorageBuffer(o,this._storageBuffers[o]);return s},t.prototype.dispose=function(t,r,i){if(r){var n;for(n in this._textures)this._textures[n].dispose();for(n in this._textureArrays)for(var s=this._textureArrays[n],o=0;o<s.length;o++)s[o].dispose()}this._textures={},e.prototype.dispose.call(this,t,r,i)},t.prototype.serialize=function(){var e,t=n.p4.Serialize(this);for(e in t.customType="BABYLON.ShaderMaterial",t.uniqueId=this.uniqueId,t.options=this._options,t.shaderPath=this._shaderPath,t.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,t.stencil=this.stencil.serialize(),t.textures={},this._textures)t.textures[e]=this._textures[e].serialize();for(e in t.textureArrays={},this._textureArrays){t.textureArrays[e]=[];for(var r=this._textureArrays[e],i=0;i<r.length;i++)t.textureArrays[e].push(r[i].serialize())}for(e in t.ints={},this._ints)t.ints[e]=this._ints[e];for(e in t.floats={},this._floats)t.floats[e]=this._floats[e];for(e in t.FloatArrays={},this._floatsArrays)t.FloatArrays[e]=this._floatsArrays[e];for(e in t.colors3={},this._colors3)t.colors3[e]=this._colors3[e].asArray();for(e in t.colors3Arrays={},this._colors3Arrays)t.colors3Arrays[e]=this._colors3Arrays[e];for(e in t.colors4={},this._colors4)t.colors4[e]=this._colors4[e].asArray();for(e in t.colors4Arrays={},this._colors4Arrays)t.colors4Arrays[e]=this._colors4Arrays[e];for(e in t.vectors2={},this._vectors2)t.vectors2[e]=this._vectors2[e].asArray();for(e in t.vectors3={},this._vectors3)t.vectors3[e]=this._vectors3[e].asArray();for(e in t.vectors4={},this._vectors4)t.vectors4[e]=this._vectors4[e].asArray();for(e in t.matrices={},this._matrices)t.matrices[e]=this._matrices[e].asArray();for(e in t.matrixArray={},this._matrixArrays)t.matrixArray[e]=this._matrixArrays[e];for(e in t.matrices3x3={},this._matrices3x3)t.matrices3x3[e]=this._matrices3x3[e];for(e in t.matrices2x2={},this._matrices2x2)t.matrices2x2[e]=this._matrices2x2[e];for(e in t.vectors2Arrays={},this._vectors2Arrays)t.vectors2Arrays[e]=this._vectors2Arrays[e];for(e in t.vectors3Arrays={},this._vectors3Arrays)t.vectors3Arrays[e]=this._vectors3Arrays[e];for(e in t.vectors4Arrays={},this._vectors4Arrays)t.vectors4Arrays[e]=this._vectors4Arrays[e];return t},t.Parse=function(e,r,i){var o,u=n.p4.Parse((function(){return new t(e.name,r,e.shaderPath,e.options,e.storeEffectOnSubMeshes)}),e,r,i);for(o in e.stencil&&u.stencil.parse(e.stencil,r,i),e.textures)u.setTexture(o,a.x.Parse(e.textures[o],r,i));for(o in e.textureArrays){for(var l=e.textureArrays[o],f=new Array,p=0;p<l.length;p++)f.push(a.x.Parse(l[p],r,i));u.setTextureArray(o,f)}for(o in e.ints)u.setInt(o,e.ints[o]);for(o in e.floats)u.setFloat(o,e.floats[o]);for(o in e.floatsArrays)u.setFloats(o,e.floatsArrays[o]);for(o in e.colors3)u.setColor3(o,h.Wo.FromArray(e.colors3[o]));for(o in e.colors3Arrays){var c=e.colors3Arrays[o].reduce((function(e,t,r){return r%3==0?e.push([t]):e[e.length-1].push(t),e}),[]).map((function(e){return h.Wo.FromArray(e)}));u.setColor3Array(o,c)}for(o in e.colors4)u.setColor4(o,h.HE.FromArray(e.colors4[o]));for(o in e.colors4Arrays){c=e.colors4Arrays[o].reduce((function(e,t,r){return r%4==0?e.push([t]):e[e.length-1].push(t),e}),[]).map((function(e){return h.HE.FromArray(e)}));u.setColor4Array(o,c)}for(o in e.vectors2)u.setVector2(o,s.FM.FromArray(e.vectors2[o]));for(o in e.vectors3)u.setVector3(o,s.P.FromArray(e.vectors3[o]));for(o in e.vectors4)u.setVector4(o,s.Lt.FromArray(e.vectors4[o]));for(o in e.matrices)u.setMatrix(o,s.y3.FromArray(e.matrices[o]));for(o in e.matrixArray)u._matrixArrays[o]=new Float32Array(e.matrixArray[o]);for(o in e.matrices3x3)u.setMatrix3x3(o,e.matrices3x3[o]);for(o in e.matrices2x2)u.setMatrix2x2(o,e.matrices2x2[o]);for(o in e.vectors2Arrays)u.setArray2(o,e.vectors2Arrays[o]);for(o in e.vectors3Arrays)u.setArray3(o,e.vectors3Arrays[o]);for(o in e.vectors4Arrays)u.setArray4(o,e.vectors4Arrays[o]);return u},t.ParseFromFileAsync=function(e,t,r,i){var n=this;return void 0===i&&(i=""),new Promise((function(s,o){var a=new p.g;a.addEventListener("readystatechange",(function(){if(4==a.readyState)if(200==a.status){var t=JSON.parse(a.responseText),u=n.Parse(t,r||d.l.LastCreatedScene,i);e&&(u.name=e),s(u)}else o("Unable to load the ShaderMaterial")})),a.open("GET",t),a.send()}))},t.CreateFromSnippetAsync=function(e,t,r){var i=this;return void 0===r&&(r=""),new Promise((function(n,s){var o=new p.g;o.addEventListener("readystatechange",(function(){if(4==o.readyState)if(200==o.status){var a=JSON.parse(JSON.parse(o.responseText).jsonPayload),u=JSON.parse(a.shaderMaterial),l=i.Parse(u,t||d.l.LastCreatedScene,r);l.snippetId=e,n(l)}else s("Unable to load the snippet "+e)})),o.open("GET",i.SnippetUrl+"/"+e.replace(/#/g,"/")),o.send()}))},t.SnippetUrl="https://snippet.babylonjs.com",t}(c.a);(0,l.H)("BABYLON.ShaderMaterial",m)},3085:(e,t,r)=>{r.d(t,{K:()=>A,R:()=>x});var i=r(31191),n=r(96969),s=r(7788),o=r(65273),a=r(58095),u=r(15631),l=r(72208),h=r(94028),f=r(90622),p=r(98163),c=r(67555),d=r(64849),_=r(74375),m=r(90360),g=r(73803),b=r(48620),y=r(46110),E=(r(25526),r(80882),r(38309)),v=r(16977),T={effect:null,subMesh:null},x=function(e){function t(t){var r=e.call(this,t)||this;return r.MAINUV1=!1,r.MAINUV2=!1,r.MAINUV3=!1,r.MAINUV4=!1,r.MAINUV5=!1,r.MAINUV6=!1,r.DIFFUSE=!1,r.DIFFUSEDIRECTUV=0,r.BAKED_VERTEX_ANIMATION_TEXTURE=!1,r.AMBIENT=!1,r.AMBIENTDIRECTUV=0,r.OPACITY=!1,r.OPACITYDIRECTUV=0,r.OPACITYRGB=!1,r.REFLECTION=!1,r.EMISSIVE=!1,r.EMISSIVEDIRECTUV=0,r.SPECULAR=!1,r.SPECULARDIRECTUV=0,r.BUMP=!1,r.BUMPDIRECTUV=0,r.PARALLAX=!1,r.PARALLAXOCCLUSION=!1,r.SPECULAROVERALPHA=!1,r.CLIPPLANE=!1,r.CLIPPLANE2=!1,r.CLIPPLANE3=!1,r.CLIPPLANE4=!1,r.CLIPPLANE5=!1,r.CLIPPLANE6=!1,r.ALPHATEST=!1,r.DEPTHPREPASS=!1,r.ALPHAFROMDIFFUSE=!1,r.POINTSIZE=!1,r.FOG=!1,r.SPECULARTERM=!1,r.DIFFUSEFRESNEL=!1,r.OPACITYFRESNEL=!1,r.REFLECTIONFRESNEL=!1,r.REFRACTIONFRESNEL=!1,r.EMISSIVEFRESNEL=!1,r.FRESNEL=!1,r.NORMAL=!1,r.TANGENT=!1,r.UV1=!1,r.UV2=!1,r.UV3=!1,r.UV4=!1,r.UV5=!1,r.UV6=!1,r.VERTEXCOLOR=!1,r.VERTEXALPHA=!1,r.NUM_BONE_INFLUENCERS=0,r.BonesPerMesh=0,r.BONETEXTURE=!1,r.BONES_VELOCITY_ENABLED=!1,r.INSTANCES=!1,r.THIN_INSTANCES=!1,r.INSTANCESCOLOR=!1,r.GLOSSINESS=!1,r.ROUGHNESS=!1,r.EMISSIVEASILLUMINATION=!1,r.LINKEMISSIVEWITHDIFFUSE=!1,r.REFLECTIONFRESNELFROMSPECULAR=!1,r.LIGHTMAP=!1,r.LIGHTMAPDIRECTUV=0,r.OBJECTSPACE_NORMALMAP=!1,r.USELIGHTMAPASSHADOWMAP=!1,r.REFLECTIONMAP_3D=!1,r.REFLECTIONMAP_SPHERICAL=!1,r.REFLECTIONMAP_PLANAR=!1,r.REFLECTIONMAP_CUBIC=!1,r.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,r.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,r.REFLECTIONMAP_PROJECTION=!1,r.REFLECTIONMAP_SKYBOX=!1,r.REFLECTIONMAP_EXPLICIT=!1,r.REFLECTIONMAP_EQUIRECTANGULAR=!1,r.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,r.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,r.REFLECTIONMAP_OPPOSITEZ=!1,r.INVERTCUBICMAP=!1,r.LOGARITHMICDEPTH=!1,r.REFRACTION=!1,r.REFRACTIONMAP_3D=!1,r.REFLECTIONOVERALPHA=!1,r.TWOSIDEDLIGHTING=!1,r.SHADOWFLOAT=!1,r.MORPHTARGETS=!1,r.MORPHTARGETS_NORMAL=!1,r.MORPHTARGETS_TANGENT=!1,r.MORPHTARGETS_UV=!1,r.NUM_MORPH_INFLUENCERS=0,r.MORPHTARGETS_TEXTURE=!1,r.NONUNIFORMSCALING=!1,r.PREMULTIPLYALPHA=!1,r.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,r.ALPHABLEND=!0,r.PREPASS=!1,r.PREPASS_IRRADIANCE=!1,r.PREPASS_IRRADIANCE_INDEX=-1,r.PREPASS_ALBEDO_SQRT=!1,r.PREPASS_ALBEDO_SQRT_INDEX=-1,r.PREPASS_DEPTH=!1,r.PREPASS_DEPTH_INDEX=-1,r.PREPASS_NORMAL=!1,r.PREPASS_NORMAL_INDEX=-1,r.PREPASS_POSITION=!1,r.PREPASS_POSITION_INDEX=-1,r.PREPASS_VELOCITY=!1,r.PREPASS_VELOCITY_INDEX=-1,r.PREPASS_REFLECTIVITY=!1,r.PREPASS_REFLECTIVITY_INDEX=-1,r.SCENE_MRT_COUNT=0,r.RGBDLIGHTMAP=!1,r.RGBDREFLECTION=!1,r.RGBDREFRACTION=!1,r.IMAGEPROCESSING=!1,r.VIGNETTE=!1,r.VIGNETTEBLENDMODEMULTIPLY=!1,r.VIGNETTEBLENDMODEOPAQUE=!1,r.TONEMAPPING=!1,r.TONEMAPPING_ACES=!1,r.CONTRAST=!1,r.COLORCURVES=!1,r.COLORGRADING=!1,r.COLORGRADING3D=!1,r.SAMPLER3DGREENDEPTH=!1,r.SAMPLER3DBGRMAP=!1,r.IMAGEPROCESSINGPOSTPROCESS=!1,r.SKIPFINALCOLORCLAMP=!1,r.MULTIVIEW=!1,r.ORDER_INDEPENDENT_TRANSPARENCY=!1,r.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,r.IS_REFLECTION_LINEAR=!1,r.IS_REFRACTION_LINEAR=!1,r.EXPOSURE=!1,r.rebuild(),r}return(0,i.ZT)(t,e),t.prototype.setReflectionMode=function(e){for(var t=0,r=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];t<r.length;t++){var i=r[t];this[i]=i===e}},t}(d.H),A=function(e){function t(r,i){var n=e.call(this,r,i)||this;return n._diffuseTexture=null,n._ambientTexture=null,n._opacityTexture=null,n._reflectionTexture=null,n._emissiveTexture=null,n._specularTexture=null,n._bumpTexture=null,n._lightmapTexture=null,n._refractionTexture=null,n.ambientColor=new u.Wo(0,0,0),n.diffuseColor=new u.Wo(1,1,1),n.specularColor=new u.Wo(1,1,1),n.emissiveColor=new u.Wo(0,0,0),n.specularPower=64,n._useAlphaFromDiffuseTexture=!1,n._useEmissiveAsIllumination=!1,n._linkEmissiveWithDiffuse=!1,n._useSpecularOverAlpha=!1,n._useReflectionOverAlpha=!1,n._disableLighting=!1,n._useObjectSpaceNormalMap=!1,n._useParallax=!1,n._useParallaxOcclusion=!1,n.parallaxScaleBias=.05,n._roughness=0,n.indexOfRefraction=.98,n.invertRefractionY=!0,n.alphaCutOff=.4,n._useLightmapAsShadowmap=!1,n._useReflectionFresnelFromSpecular=!1,n._useGlossinessFromSpecularMapAlpha=!1,n._maxSimultaneousLights=4,n._invertNormalMapX=!1,n._invertNormalMapY=!1,n._twoSidedLighting=!1,n._renderTargets=new s.t(16),n._worldViewProjectionMatrix=a.y3.Zero(),n._globalAmbientColor=new u.Wo(0,0,0),n._cacheHasRenderTargetTextures=!1,n.detailMap=new v.p(n),n._attachImageProcessingConfiguration(null),n.prePassConfiguration=new h.o,n.getRenderTargetTextures=function(){return n._renderTargets.reset(),t.ReflectionTextureEnabled&&n._reflectionTexture&&n._reflectionTexture.isRenderTarget&&n._renderTargets.push(n._reflectionTexture),t.RefractionTextureEnabled&&n._refractionTexture&&n._refractionTexture.isRenderTarget&&n._renderTargets.push(n._refractionTexture),n._eventInfo.renderTargets=n._renderTargets,n._callbackPluginEventFillRenderTargetTextures(n._eventInfo),n._renderTargets},n}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){t._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(t.prototype,"isPrePassCapable",{get:function(){return!this.disableDepthWrite},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!!(t.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(t.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!1,configurable:!0}),t.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)},t.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===p.F.MATERIAL_ALPHATEST)},t.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==p.F.MATERIAL_OPAQUE},t.prototype._hasAlphaChannel=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture},t.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},t.prototype.isReadyForSubMesh=function(e,r,i){if(void 0===i&&(i=!1),this._uniformBufferLayoutBuilt||this.buildUniformLayout(),r.effect&&this.isFrozen&&r.effect._wasPreviouslyReady)return!0;r.materialDefines||(this._callbackPluginEventGeneric(c.S.GetDefineNames,this._eventInfo),r.materialDefines=new x(this._eventInfo.defineNames));var n=this.getScene(),s=r.materialDefines;if(this._isReadyForSubMesh(r))return!0;var o=n.getEngine();s._needNormals=m.G.PrepareDefinesForLights(n,e,s,!0,this._maxSimultaneousLights,this._disableLighting),m.G.PrepareDefinesForMultiview(n,s);var a=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if(m.G.PrepareDefinesForPrePass(n,s,this.canRenderToMRT&&!a),m.G.PrepareDefinesForOIT(n,s,a),s._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,s._needUVs=!1;for(var u=1;u<=6;++u)s["MAINUV"+u]=!1;if(n.texturesEnabled){if(this._diffuseTexture&&t.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;m.G.PrepareDefinesForMergedUV(this._diffuseTexture,s,"DIFFUSE")}else s.DIFFUSE=!1;if(this._ambientTexture&&t.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;m.G.PrepareDefinesForMergedUV(this._ambientTexture,s,"AMBIENT")}else s.AMBIENT=!1;if(this._opacityTexture&&t.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;m.G.PrepareDefinesForMergedUV(this._opacityTexture,s,"OPACITY"),s.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else s.OPACITY=!1;if(this._reflectionTexture&&t.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(s._needNormals=!0,s.REFLECTION=!0,s.ROUGHNESS=this._roughness>0,s.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,s.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===g.x.INVCUBIC_MODE,s.REFLECTIONMAP_3D=this._reflectionTexture.isCube,s.REFLECTIONMAP_OPPOSITEZ=s.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,s.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case g.x.EXPLICIT_MODE:s.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case g.x.PLANAR_MODE:s.setReflectionMode("REFLECTIONMAP_PLANAR");break;case g.x.PROJECTION_MODE:s.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case g.x.SKYBOX_MODE:s.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case g.x.SPHERICAL_MODE:s.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case g.x.EQUIRECTANGULAR_MODE:s.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case g.x.FIXED_EQUIRECTANGULAR_MODE:s.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case g.x.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:s.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case g.x.CUBIC_MODE:case g.x.INVCUBIC_MODE:default:s.setReflectionMode("REFLECTIONMAP_CUBIC")}s.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else s.REFLECTION=!1,s.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&t.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;m.G.PrepareDefinesForMergedUV(this._emissiveTexture,s,"EMISSIVE")}else s.EMISSIVE=!1;if(this._lightmapTexture&&t.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;m.G.PrepareDefinesForMergedUV(this._lightmapTexture,s,"LIGHTMAP"),s.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,s.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else s.LIGHTMAP=!1;if(this._specularTexture&&t.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;m.G.PrepareDefinesForMergedUV(this._specularTexture,s,"SPECULAR"),s.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else s.SPECULAR=!1;if(n.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&t.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;m.G.PrepareDefinesForMergedUV(this._bumpTexture,s,"BUMP"),s.PARALLAX=this._useParallax,s.PARALLAXOCCLUSION=this._useParallaxOcclusion,s.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else s.BUMP=!1;if(this._refractionTexture&&t.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;s._needUVs=!0,s.REFRACTION=!0,s.REFRACTIONMAP_3D=this._refractionTexture.isCube,s.RGBDREFRACTION=this._refractionTexture.isRGBD,s.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else s.REFRACTION=!1;s.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else s.DIFFUSE=!1,s.AMBIENT=!1,s.OPACITY=!1,s.REFLECTION=!1,s.EMISSIVE=!1,s.LIGHTMAP=!1,s.BUMP=!1,s.REFRACTION=!1;s.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),s.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,s.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,s.SPECULAROVERALPHA=this._useSpecularOverAlpha,s.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,s.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,s.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(e)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=s,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(s._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(s),s.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,s.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(s._areFresnelDirty&&(t.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(s.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,s.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,s.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,s.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,s.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,s.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,s._needNormals=!0,s.FRESNEL=!0):s.FRESNEL=!1),m.G.PrepareDefinesForMisc(e,n,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,s),m.G.PrepareDefinesForFrameBoundValues(n,o,s,i,null,r.getRenderingMesh().hasThinInstances),this._eventInfo.defines=s,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),m.G.PrepareDefinesForAttributes(e,s,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo),s.isDirty){var p=s._areLightsDisposed;s.markAsProcessed();var d=new E.L;s.REFLECTION&&d.addFallback(0,"REFLECTION"),s.SPECULAR&&d.addFallback(0,"SPECULAR"),s.BUMP&&d.addFallback(0,"BUMP"),s.PARALLAX&&d.addFallback(1,"PARALLAX"),s.PARALLAXOCCLUSION&&d.addFallback(0,"PARALLAXOCCLUSION"),s.SPECULAROVERALPHA&&d.addFallback(0,"SPECULAROVERALPHA"),s.FOG&&d.addFallback(1,"FOG"),s.POINTSIZE&&d.addFallback(0,"POINTSIZE"),s.LOGARITHMICDEPTH&&d.addFallback(0,"LOGARITHMICDEPTH"),m.G.HandleFallbacksForShadows(s,d,this._maxSimultaneousLights),s.SPECULARTERM&&d.addFallback(0,"SPECULARTERM"),s.DIFFUSEFRESNEL&&d.addFallback(1,"DIFFUSEFRESNEL"),s.OPACITYFRESNEL&&d.addFallback(2,"OPACITYFRESNEL"),s.REFLECTIONFRESNEL&&d.addFallback(3,"REFLECTIONFRESNEL"),s.EMISSIVEFRESNEL&&d.addFallback(4,"EMISSIVEFRESNEL"),s.FRESNEL&&d.addFallback(4,"FRESNEL"),s.MULTIVIEW&&d.addFallback(0,"MULTIVIEW");var _=[l.o.PositionKind];s.NORMAL&&_.push(l.o.NormalKind),s.TANGENT&&_.push(l.o.TangentKind);for(u=1;u<=6;++u)s["UV"+u]&&_.push("uv".concat(1===u?"":u));s.VERTEXCOLOR&&_.push(l.o.ColorKind),m.G.PrepareAttributesForBones(_,e,s,d),m.G.PrepareAttributesForInstances(_,s),m.G.PrepareAttributesForMorphTargets(_,e,s),m.G.PrepareAttributesForBakedVertexAnimation(_,e,s);var b="default",y=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],v=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],A=["Material","Scene","Mesh"];this._eventInfo.fallbacks=d,this._eventInfo.fallbackRank=0,this._eventInfo.defines=s,this._eventInfo.uniforms=y,this._eventInfo.attributes=_,this._eventInfo.samplers=v,this._eventInfo.uniformBuffersNames=A,this._eventInfo.customCode=void 0,this._callbackPluginEventGeneric(c.S.PrepareEffect,this._eventInfo),h.o.AddUniforms(y),h.o.AddSamplers(v),f.$&&(f.$.PrepareUniforms(y,s),f.$.PrepareSamplers(v,s)),m.G.PrepareUniformsAndSamplersList({uniformsNames:y,uniformBuffersNames:A,samplers:v,defines:s,maxSimultaneousLights:this._maxSimultaneousLights});var C={};this.customShaderNameResolve&&(b=this.customShaderNameResolve(b,y,A,v,s,_,C));var P=s.toString(),S=r.effect,M=n.getEngine().createEffect(b,{attributes:_,uniformsNames:y,uniformBuffersNames:A,samplers:v,defines:P,fallbacks:d,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:s.NUM_MORPH_INFLUENCERS},processFinalCode:C.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:s.PREPASS},o);if(M)if(this._onEffectCreatedObservable&&(T.effect=M,T.subMesh=r,this._onEffectCreatedObservable.notifyObservers(T)),this.allowShaderHotSwapping&&S&&!M.isReady()){if(M=S,s.markAsUnprocessed(),p)return s._areLightsDisposed=!0,!1}else n.resetCachedMaterial(),r.setEffect(M,s,this._materialContext)}return!(!r.effect||!r.effect.isReady())&&(s._renderId=n.getRenderId(),r.effect._wasPreviouslyReady=!0,!0)},t.prototype.buildUniformLayout=function(){var t=this._uniformBuffer;t.addUniform("diffuseLeftColor",4),t.addUniform("diffuseRightColor",4),t.addUniform("opacityParts",4),t.addUniform("reflectionLeftColor",4),t.addUniform("reflectionRightColor",4),t.addUniform("refractionLeftColor",4),t.addUniform("refractionRightColor",4),t.addUniform("emissiveLeftColor",4),t.addUniform("emissiveRightColor",4),t.addUniform("vDiffuseInfos",2),t.addUniform("vAmbientInfos",2),t.addUniform("vOpacityInfos",2),t.addUniform("vReflectionInfos",2),t.addUniform("vReflectionPosition",3),t.addUniform("vReflectionSize",3),t.addUniform("vEmissiveInfos",2),t.addUniform("vLightmapInfos",2),t.addUniform("vSpecularInfos",2),t.addUniform("vBumpInfos",3),t.addUniform("diffuseMatrix",16),t.addUniform("ambientMatrix",16),t.addUniform("opacityMatrix",16),t.addUniform("reflectionMatrix",16),t.addUniform("emissiveMatrix",16),t.addUniform("lightmapMatrix",16),t.addUniform("specularMatrix",16),t.addUniform("bumpMatrix",16),t.addUniform("vTangentSpaceParams",2),t.addUniform("pointSize",1),t.addUniform("alphaCutOff",1),t.addUniform("refractionMatrix",16),t.addUniform("vRefractionInfos",4),t.addUniform("vRefractionPosition",3),t.addUniform("vRefractionSize",3),t.addUniform("vSpecularColor",4),t.addUniform("vEmissiveColor",3),t.addUniform("vDiffuseColor",4),t.addUniform("vAmbientColor",3),e.prototype.buildUniformLayout.call(this)},t.prototype.bindForSubMesh=function(e,r,i){var n,s=this.getScene(),a=i.materialDefines;if(a){var l=i.effect;if(l){this._activeEffect=l,r.getMeshUniformBuffer().bindToEffect(l,"Mesh"),r.transferToEffect(e),this._uniformBuffer.bindToEffect(l,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,s,r,e,this.isFrozen),this._eventInfo.subMesh=i,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),a.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var h=this._mustRebind(s,l,r.visibility);m.G.BindBonesParameters(r,l);var f=this._uniformBuffer;if(h){if(this.bindViewProjection(l),!f.useUbo||!this.isFrozen||!f.isSync){if(t.FresnelEnabled&&a.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(f.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),f.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&f.updateColor4("opacityParts",new u.Wo(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(f.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),f.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(f.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),f.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(f.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),f.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),s.texturesEnabled){if(this._diffuseTexture&&t.DiffuseTextureEnabled&&(f.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),m.G.BindTextureMatrix(this._diffuseTexture,f,"diffuse")),this._ambientTexture&&t.AmbientTextureEnabled&&(f.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),m.G.BindTextureMatrix(this._ambientTexture,f,"ambient")),this._opacityTexture&&t.OpacityTextureEnabled&&(f.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),m.G.BindTextureMatrix(this._opacityTexture,f,"opacity")),this._hasAlphaChannel()&&f.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&t.ReflectionTextureEnabled&&(f.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),f.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var p=this._reflectionTexture;f.updateVector3("vReflectionPosition",p.boundingBoxPosition),f.updateVector3("vReflectionSize",p.boundingBoxSize)}if(this._emissiveTexture&&t.EmissiveTextureEnabled&&(f.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),m.G.BindTextureMatrix(this._emissiveTexture,f,"emissive")),this._lightmapTexture&&t.LightmapTextureEnabled&&(f.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),m.G.BindTextureMatrix(this._lightmapTexture,f,"lightmap")),this._specularTexture&&t.SpecularTextureEnabled&&(f.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),m.G.BindTextureMatrix(this._specularTexture,f,"specular")),this._bumpTexture&&s.getEngine().getCaps().standardDerivatives&&t.BumpTextureEnabled&&(f.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),m.G.BindTextureMatrix(this._bumpTexture,f,"bump"),s._mirroredCameraPosition?f.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):f.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&t.RefractionTextureEnabled){var c=1;if(this._refractionTexture.isCube||(f.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(c=this._refractionTexture.depth)),f.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,c,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){p=this._refractionTexture;f.updateVector3("vRefractionPosition",p.boundingBoxPosition),f.updateVector3("vRefractionSize",p.boundingBoxSize)}}}this.pointsCloud&&f.updateFloat("pointSize",this.pointSize),a.SPECULARTERM&&f.updateColor4("vSpecularColor",this.specularColor,this.specularPower),f.updateColor3("vEmissiveColor",t.EmissiveTextureEnabled?this.emissiveColor:u.Wo.BlackReadOnly),f.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),s.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),f.updateColor3("vAmbientColor",this._globalAmbientColor)}s.texturesEnabled&&(this._diffuseTexture&&t.DiffuseTextureEnabled&&l.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&t.AmbientTextureEnabled&&l.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&t.OpacityTextureEnabled&&l.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&t.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?l.setTexture("reflectionCubeSampler",this._reflectionTexture):l.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&t.EmissiveTextureEnabled&&l.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&t.LightmapTextureEnabled&&l.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&t.SpecularTextureEnabled&&l.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&s.getEngine().getCaps().standardDerivatives&&t.BumpTextureEnabled&&l.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&t.RefractionTextureEnabled&&(this._refractionTexture.isCube?l.setTexture("refractionCubeSampler",this._refractionTexture):l.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(r)&&this.getScene().depthPeelingRenderer.bind(l),this._eventInfo.subMesh=i,this._callbackPluginEventBindForSubMesh(this._eventInfo),m.G.BindClipPlane(l,s),this.bindEyePosition(l)}else s.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!h&&this.isFrozen||(s.lightsEnabled&&!this._disableLighting&&m.G.BindLights(s,r,l,a,this._maxSimultaneousLights),(s.fogEnabled&&r.applyFog&&s.fogMode!==o.x.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||r.receiveShadows||a.PREPASS)&&this.bindView(l),m.G.BindFogParameters(s,r,l),a.NUM_MORPH_INFLUENCERS&&m.G.BindMorphTargetParameters(r,l),a.BAKED_VERTEX_ANIMATION_TEXTURE&&(null===(n=r.bakedVertexAnimationManager)||void 0===n||n.bind(l,a.INSTANCES)),this.useLogarithmicDepth&&m.G.BindLogDepth(a,l,s),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(r,this._activeEffect),f.update()}}},t.prototype.getAnimatables=function(){var t=e.prototype.getAnimatables.call(this);return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&t.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&t.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&t.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&t.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&t.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&t.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&t.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&t.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&t.push(this._refractionTexture),t},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),this._ambientTexture&&t.push(this._ambientTexture),this._opacityTexture&&t.push(this._opacityTexture),this._reflectionTexture&&t.push(this._reflectionTexture),this._emissiveTexture&&t.push(this._emissiveTexture),this._specularTexture&&t.push(this._specularTexture),this._bumpTexture&&t.push(this._bumpTexture),this._lightmapTexture&&t.push(this._lightmapTexture),this._refractionTexture&&t.push(this._refractionTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this._diffuseTexture===t||(this._ambientTexture===t||(this._opacityTexture===t||(this._reflectionTexture===t||(this._emissiveTexture===t||(this._specularTexture===t||(this._bumpTexture===t||(this._lightmapTexture===t||this._refractionTexture===t))))))))},t.prototype.dispose=function(t,r){var i,n,s,o,a,u,l,h,f;r&&(null===(i=this._diffuseTexture)||void 0===i||i.dispose(),null===(n=this._ambientTexture)||void 0===n||n.dispose(),null===(s=this._opacityTexture)||void 0===s||s.dispose(),null===(o=this._reflectionTexture)||void 0===o||o.dispose(),null===(a=this._emissiveTexture)||void 0===a||a.dispose(),null===(u=this._specularTexture)||void 0===u||u.dispose(),null===(l=this._bumpTexture)||void 0===l||l.dispose(),null===(h=this._lightmapTexture)||void 0===h||h.dispose(),null===(f=this._refractionTexture)||void 0===f||f.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t,r)},t.prototype.clone=function(e){var r=this,i=n.p4.Clone((function(){return new t(e,r.getScene())}),this);return i.name=e,i.id=e,this.stencil.copyTo(i.stencil),i},t.Parse=function(e,r,i){var s=n.p4.Parse((function(){return new t(e.name,r)}),e,r,i);return e.stencil&&s.stencil.parse(e.stencil,r,i),s},Object.defineProperty(t,"DiffuseTextureEnabled",{get:function(){return y.k.DiffuseTextureEnabled},set:function(e){y.k.DiffuseTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DetailTextureEnabled",{get:function(){return y.k.DetailTextureEnabled},set:function(e){y.k.DetailTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"AmbientTextureEnabled",{get:function(){return y.k.AmbientTextureEnabled},set:function(e){y.k.AmbientTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"OpacityTextureEnabled",{get:function(){return y.k.OpacityTextureEnabled},set:function(e){y.k.OpacityTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ReflectionTextureEnabled",{get:function(){return y.k.ReflectionTextureEnabled},set:function(e){y.k.ReflectionTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"EmissiveTextureEnabled",{get:function(){return y.k.EmissiveTextureEnabled},set:function(e){y.k.EmissiveTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"SpecularTextureEnabled",{get:function(){return y.k.SpecularTextureEnabled},set:function(e){y.k.SpecularTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BumpTextureEnabled",{get:function(){return y.k.BumpTextureEnabled},set:function(e){y.k.BumpTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LightmapTextureEnabled",{get:function(){return y.k.LightmapTextureEnabled},set:function(e){y.k.LightmapTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"RefractionTextureEnabled",{get:function(){return y.k.RefractionTextureEnabled},set:function(e){y.k.RefractionTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ColorGradingTextureEnabled",{get:function(){return y.k.ColorGradingTextureEnabled},set:function(e){y.k.ColorGradingTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"FresnelEnabled",{get:function(){return y.k.FresnelEnabled},set:function(e){y.k.FresnelEnabled=e},enumerable:!1,configurable:!0}),(0,i.gn)([(0,n.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"diffuseTexture",void 0),(0,i.gn)([(0,n.oU)("ambientTexture")],t.prototype,"_ambientTexture",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTexture",void 0),(0,i.gn)([(0,n.oU)("opacityTexture")],t.prototype,"_opacityTexture",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"opacityTexture",void 0),(0,i.gn)([(0,n.oU)("reflectionTexture")],t.prototype,"_reflectionTexture",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),(0,i.gn)([(0,n.oU)("emissiveTexture")],t.prototype,"_emissiveTexture",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),(0,i.gn)([(0,n.oU)("specularTexture")],t.prototype,"_specularTexture",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"specularTexture",void 0),(0,i.gn)([(0,n.oU)("bumpTexture")],t.prototype,"_bumpTexture",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),(0,i.gn)([(0,n.oU)("lightmapTexture")],t.prototype,"_lightmapTexture",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"lightmapTexture",void 0),(0,i.gn)([(0,n.oU)("refractionTexture")],t.prototype,"_refractionTexture",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"refractionTexture",void 0),(0,i.gn)([(0,n.n9)("ambient")],t.prototype,"ambientColor",void 0),(0,i.gn)([(0,n.n9)("diffuse")],t.prototype,"diffuseColor",void 0),(0,i.gn)([(0,n.n9)("specular")],t.prototype,"specularColor",void 0),(0,i.gn)([(0,n.n9)("emissive")],t.prototype,"emissiveColor",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"specularPower",void 0),(0,i.gn)([(0,n.qC)("useAlphaFromDiffuseTexture")],t.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"useAlphaFromDiffuseTexture",void 0),(0,i.gn)([(0,n.qC)("useEmissiveAsIllumination")],t.prototype,"_useEmissiveAsIllumination",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useEmissiveAsIllumination",void 0),(0,i.gn)([(0,n.qC)("linkEmissiveWithDiffuse")],t.prototype,"_linkEmissiveWithDiffuse",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"linkEmissiveWithDiffuse",void 0),(0,i.gn)([(0,n.qC)("useSpecularOverAlpha")],t.prototype,"_useSpecularOverAlpha",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useSpecularOverAlpha",void 0),(0,i.gn)([(0,n.qC)("useReflectionOverAlpha")],t.prototype,"_useReflectionOverAlpha",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useReflectionOverAlpha",void 0),(0,i.gn)([(0,n.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,i.gn)([(0,n.qC)("useObjectSpaceNormalMap")],t.prototype,"_useObjectSpaceNormalMap",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useObjectSpaceNormalMap",void 0),(0,i.gn)([(0,n.qC)("useParallax")],t.prototype,"_useParallax",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallax",void 0),(0,i.gn)([(0,n.qC)("useParallaxOcclusion")],t.prototype,"_useParallaxOcclusion",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallaxOcclusion",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"parallaxScaleBias",void 0),(0,i.gn)([(0,n.qC)("roughness")],t.prototype,"_roughness",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"indexOfRefraction",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"invertRefractionY",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"alphaCutOff",void 0),(0,i.gn)([(0,n.qC)("useLightmapAsShadowmap")],t.prototype,"_useLightmapAsShadowmap",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),(0,i.gn)([(0,n.qQ)("diffuseFresnelParameters")],t.prototype,"_diffuseFresnelParameters",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"diffuseFresnelParameters",void 0),(0,i.gn)([(0,n.qQ)("opacityFresnelParameters")],t.prototype,"_opacityFresnelParameters",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsFresnelAndMiscDirty")],t.prototype,"opacityFresnelParameters",void 0),(0,i.gn)([(0,n.qQ)("reflectionFresnelParameters")],t.prototype,"_reflectionFresnelParameters",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"reflectionFresnelParameters",void 0),(0,i.gn)([(0,n.qQ)("refractionFresnelParameters")],t.prototype,"_refractionFresnelParameters",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"refractionFresnelParameters",void 0),(0,i.gn)([(0,n.qQ)("emissiveFresnelParameters")],t.prototype,"_emissiveFresnelParameters",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"emissiveFresnelParameters",void 0),(0,i.gn)([(0,n.qC)("useReflectionFresnelFromSpecular")],t.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"useReflectionFresnelFromSpecular",void 0),(0,i.gn)([(0,n.qC)("useGlossinessFromSpecularMapAlpha")],t.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,i.gn)([(0,n.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),(0,i.gn)([(0,n.qC)("invertNormalMapX")],t.prototype,"_invertNormalMapX",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),(0,i.gn)([(0,n.qC)("invertNormalMapY")],t.prototype,"_invertNormalMapY",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),(0,i.gn)([(0,n.qC)("twoSidedLighting")],t.prototype,"_twoSidedLighting",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"twoSidedLighting",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"useLogarithmicDepth",null),t}(_.a);(0,b.H)("BABYLON.StandardMaterial",A),o.x.DefaultMaterialFactory=function(e){return new A("default material",e)}},91901:(e,t,r)=>{r.d(t,{O:()=>i});var i=function(){function e(){}return e.BindClipPlane=function(e,t){if(t.clipPlane){var r=t.clipPlane;e.setFloat4("vClipPlane",r.normal.x,r.normal.y,r.normal.z,r.d)}if(t.clipPlane2){r=t.clipPlane2;e.setFloat4("vClipPlane2",r.normal.x,r.normal.y,r.normal.z,r.d)}if(t.clipPlane3){r=t.clipPlane3;e.setFloat4("vClipPlane3",r.normal.x,r.normal.y,r.normal.z,r.d)}if(t.clipPlane4){r=t.clipPlane4;e.setFloat4("vClipPlane4",r.normal.x,r.normal.y,r.normal.z,r.d)}if(t.clipPlane5){r=t.clipPlane5;e.setFloat4("vClipPlane5",r.normal.x,r.normal.y,r.normal.z,r.d)}if(t.clipPlane6){r=t.clipPlane6;e.setFloat4("vClipPlane6",r.normal.x,r.normal.y,r.normal.z,r.d)}},e}()},83353:(e,t,r)=>{r.d(t,{M:()=>s});var i=r(84318),n=r(13514),s=(r(78459),function(){function e(e,t,r,i,n){void 0===n&&(n=!1),this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers||n,this._dynamic=r,this._name=null!=i?i:"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform)}return Object.defineProperty(e.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),e.prototype.isDynamic=function(){return void 0!==this._dynamic},e.prototype.getData=function(){return this._bufferData},e.prototype.getBuffer=function(){return this._buffer},e.prototype._fillAlignment=function(e){var t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){var r=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var i=this._uniformLocationPointer-r,n=0;n<i;n++)this._data.push(0)}},e.prototype.addUniform=function(e,t,r){if(void 0===r&&(r=0),!this._noUBO&&void 0===this._uniformLocations[e]){var i;if(r>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;if(this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:r},16==t)t*=r;else t=t*r+(4-t)*r;i=[];for(var n=0;n<t;n++)i.push(0)}else{if(t instanceof Array)t=(i=t).length;else{i=[];for(n=0;n<t;n++)i.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(n=0;n<t;n++)this._data.push(i[n]);this._needSync=!0}},e.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},e.prototype.addFloat2=function(e,t,r){var i=[t,r];this.addUniform(e,i)},e.prototype.addFloat3=function(e,t,r,i){var n=[t,r,i];this.addUniform(e,n)},e.prototype.addColor3=function(e,t){var r=[t.r,t.g,t.b];this.addUniform(e,r)},e.prototype.addColor4=function(e,t,r){var i=[t.r,t.g,t.b,r];this.addUniform(e,i)},e.prototype.addVector3=function(e,t){var r=[t.x,t.y,t.z];this.addUniform(e,r)},e.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},e.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},e.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},e.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))},Object.defineProperty(e.prototype,"_numBuffers",{get:function(){return this._buffers.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_indexBuffer",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),e.prototype._buffersEqual=function(e,t){for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0},e.prototype._copyBuffer=function(e,t){for(var r=0;r<e.length;++r)t[r]=e[r]},e.prototype.update=function(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(e._UpdatedUbosInFrame[this._name]||(e._UpdatedUbosInFrame[this._name]=0),e._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()},e.prototype._createNewBuffer=function(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()},e.prototype._checkNewFrame=function(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)},e.prototype.updateUniform=function(e,t,r){this._checkNewFrame();var s=this._uniformLocations[e];if(void 0===s){if(this._buffer)return void i.Y.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,r),s=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(a=0;a<r;a++)this._bufferData[s+a]=t[a];else{for(var o=!1,a=0;a<r;a++)(16===r&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[s+a]!==n.w1.FloatRound(t[a]))&&(o=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[s+a]=t[a]);this._needSync=this._needSync||o}},e.prototype.updateUniformArray=function(e,t,r){this._checkNewFrame();var s=this._uniformLocations[e];if(void 0!==s){this._buffer||this.create();var o=this._uniformArraySizes[e];if(this._dynamic)for(h=0;h<r;h++)this._bufferData[s+h]=t[h];else{for(var a=!1,u=0,l=0,h=0;h<r;h++)if(this._bufferData[s+4*l+u]!==n.w1.FloatRound(t[h])&&(a=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[s+4*l+u]=t[h]),++u===o.strideSize){for(;u<4;u++)this._bufferData[s+4*l+u]=0;u=0,l++}this._needSync=this._needSync||a}}else i.Y.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform.")},e.prototype._cacheMatrix=function(e,t){this._checkNewFrame();var r=this._valueCache[e],i=t.updateFlag;return(void 0===r||r!==i)&&(this._valueCache[e]=i,!0)},e.prototype._updateMatrix3x3ForUniform=function(t,r){for(var i=0;i<3;i++)e._TempBuffer[4*i]=r[3*i],e._TempBuffer[4*i+1]=r[3*i+1],e._TempBuffer[4*i+2]=r[3*i+2],e._TempBuffer[4*i+3]=0;this.updateUniform(t,e._TempBuffer,12)},e.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},e.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},e.prototype._updateMatrix2x2ForUniform=function(t,r){for(var i=0;i<2;i++)e._TempBuffer[4*i]=r[2*i],e._TempBuffer[4*i+1]=r[2*i+1],e._TempBuffer[4*i+2]=0,e._TempBuffer[4*i+3]=0;this.updateUniform(t,e._TempBuffer,8)},e.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},e.prototype._updateFloatForUniform=function(t,r){e._TempBuffer[0]=r,this.updateUniform(t,e._TempBuffer,1)},e.prototype._updateFloat2ForEffect=function(e,t,r,i){void 0===i&&(i=""),this._currentEffect.setFloat2(e+i,t,r)},e.prototype._updateFloat2ForUniform=function(t,r,i){e._TempBuffer[0]=r,e._TempBuffer[1]=i,this.updateUniform(t,e._TempBuffer,2)},e.prototype._updateFloat3ForEffect=function(e,t,r,i,n){void 0===n&&(n=""),this._currentEffect.setFloat3(e+n,t,r,i)},e.prototype._updateFloat3ForUniform=function(t,r,i,n){e._TempBuffer[0]=r,e._TempBuffer[1]=i,e._TempBuffer[2]=n,this.updateUniform(t,e._TempBuffer,3)},e.prototype._updateFloat4ForEffect=function(e,t,r,i,n,s){void 0===s&&(s=""),this._currentEffect.setFloat4(e+s,t,r,i,n)},e.prototype._updateFloat4ForUniform=function(t,r,i,n,s){e._TempBuffer[0]=r,e._TempBuffer[1]=i,e._TempBuffer[2]=n,e._TempBuffer[3]=s,this.updateUniform(t,e._TempBuffer,4)},e.prototype._updateFloatArrayForEffect=function(e,t){this._currentEffect.setFloatArray(e,t)},e.prototype._updateFloatArrayForUniform=function(e,t){this.updateUniformArray(e,t,t.length)},e.prototype._updateArrayForEffect=function(e,t){this._currentEffect.setArray(e,t)},e.prototype._updateArrayForUniform=function(e,t){this.updateUniformArray(e,t,t.length)},e.prototype._updateIntArrayForEffect=function(e,t){this._currentEffect.setIntArray(e,t)},e.prototype._updateIntArrayForUniform=function(t,r){e._TempBufferInt32View.set(r),this.updateUniformArray(t,e._TempBuffer,r.length)},e.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},e.prototype._updateMatrixForUniform=function(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.toArray(),16)},e.prototype._updateMatricesForEffect=function(e,t){this._currentEffect.setMatrices(e,t)},e.prototype._updateMatricesForUniform=function(e,t){this.updateUniform(e,t,t.length)},e.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},e.prototype._updateVector3ForUniform=function(t,r){e._TempBuffer[0]=r.x,e._TempBuffer[1]=r.y,e._TempBuffer[2]=r.z,this.updateUniform(t,e._TempBuffer,3)},e.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},e.prototype._updateVector4ForUniform=function(t,r){e._TempBuffer[0]=r.x,e._TempBuffer[1]=r.y,e._TempBuffer[2]=r.z,e._TempBuffer[3]=r.w,this.updateUniform(t,e._TempBuffer,4)},e.prototype._updateColor3ForEffect=function(e,t,r){void 0===r&&(r=""),this._currentEffect.setColor3(e+r,t)},e.prototype._updateColor3ForUniform=function(t,r){e._TempBuffer[0]=r.r,e._TempBuffer[1]=r.g,e._TempBuffer[2]=r.b,this.updateUniform(t,e._TempBuffer,3)},e.prototype._updateColor4ForEffect=function(e,t,r,i){void 0===i&&(i=""),this._currentEffect.setColor4(e+i,t,r)},e.prototype._updateDirectColor4ForEffect=function(e,t,r){void 0===r&&(r=""),this._currentEffect.setDirectColor4(e+r,t)},e.prototype._updateColor4ForUniform=function(t,r,i){e._TempBuffer[0]=r.r,e._TempBuffer[1]=r.g,e._TempBuffer[2]=r.b,e._TempBuffer[3]=i,this.updateUniform(t,e._TempBuffer,4)},e.prototype._updateDirectColor4ForUniform=function(t,r){e._TempBuffer[0]=r.r,e._TempBuffer[1]=r.g,e._TempBuffer[2]=r.b,e._TempBuffer[3]=r.a,this.updateUniform(t,e._TempBuffer,4)},e.prototype._updateIntForEffect=function(e,t,r){void 0===r&&(r=""),this._currentEffect.setInt(e+r,t)},e.prototype._updateIntForUniform=function(t,r){e._TempBufferInt32View[0]=r,this.updateUniform(t,e._TempBuffer,1)},e.prototype._updateInt2ForEffect=function(e,t,r,i){void 0===i&&(i=""),this._currentEffect.setInt2(e+i,t,r)},e.prototype._updateInt2ForUniform=function(t,r,i){e._TempBufferInt32View[0]=r,e._TempBufferInt32View[1]=i,this.updateUniform(t,e._TempBuffer,2)},e.prototype._updateInt3ForEffect=function(e,t,r,i,n){void 0===n&&(n=""),this._currentEffect.setInt3(e+n,t,r,i)},e.prototype._updateInt3ForUniform=function(t,r,i,n){e._TempBufferInt32View[0]=r,e._TempBufferInt32View[1]=i,e._TempBufferInt32View[2]=n,this.updateUniform(t,e._TempBuffer,3)},e.prototype._updateInt4ForEffect=function(e,t,r,i,n,s){void 0===s&&(s=""),this._currentEffect.setInt4(e+s,t,r,i,n)},e.prototype._updateInt4ForUniform=function(t,r,i,n,s){e._TempBufferInt32View[0]=r,e._TempBufferInt32View[1]=i,e._TempBufferInt32View[2]=n,e._TempBufferInt32View[3]=s,this.updateUniform(t,e._TempBuffer,4)},e.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},e.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},e.prototype.bindToEffect=function(e,t){this._currentEffect=e,this._currentEffectName=t},e.prototype.bindUniformBuffer=function(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)},e.prototype.unbindEffect=function(){this._currentEffect=void 0,this._currentEffectName=void 0},e.prototype.setDataBuffer=function(e){if(!this._buffers)return this._buffer===e;for(var t=0;t<this._buffers.length;++t){if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1},e.prototype.dispose=function(){if(!this._noUBO){var e=this._engine._uniformBuffers,t=e.indexOf(this);if(-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(var r=0;r<this._buffers.length;++r){var i=this._buffers[r][0];this._engine._releaseBuffer(i)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},e._UpdatedUbosInFrame={},e._MAX_UNIFORM_SIZE=256,e._TempBuffer=new Float32Array(e._MAX_UNIFORM_SIZE),e._TempBufferInt32View=new Uint32Array(e._TempBuffer.buffer),e}())},38649:(e,t,r)=>{r.d(t,{c:()=>i});var i=function(){function e(e){this._isUbo(e)?(this.setMatrix3x3=e.updateMatrix3x3.bind(e),this.setMatrix2x2=e.updateMatrix2x2.bind(e),this.setFloat=e.updateFloat.bind(e),this.setFloat2=e.updateFloat2.bind(e),this.setFloat3=e.updateFloat3.bind(e),this.setFloat4=e.updateFloat4.bind(e),this.setFloatArray=e.updateFloatArray.bind(e),this.setArray=e.updateArray.bind(e),this.setIntArray=e.updateIntArray.bind(e),this.setMatrix=e.updateMatrix.bind(e),this.setMatrices=e.updateMatrices.bind(e),this.setVector3=e.updateVector3.bind(e),this.setVector4=e.updateVector4.bind(e),this.setColor3=e.updateColor3.bind(e),this.setColor4=e.updateColor4.bind(e),this.setDirectColor4=e.updateDirectColor4.bind(e),this.setInt=e.updateInt.bind(e),this.setInt2=e.updateInt2.bind(e),this.setInt3=e.updateInt3.bind(e),this.setInt4=e.updateInt4.bind(e)):(this.setMatrix3x3=e.setMatrix3x3.bind(e),this.setMatrix2x2=e.setMatrix2x2.bind(e),this.setFloat=e.setFloat.bind(e),this.setFloat2=e.setFloat2.bind(e),this.setFloat3=e.setFloat3.bind(e),this.setFloat4=e.setFloat4.bind(e),this.setFloatArray=e.setFloatArray.bind(e),this.setArray=e.setArray.bind(e),this.setIntArray=e.setIntArray.bind(e),this.setMatrix=e.setMatrix.bind(e),this.setMatrices=e.setMatrices.bind(e),this.setVector3=e.setVector3.bind(e),this.setVector4=e.setVector4.bind(e),this.setColor3=e.setColor3.bind(e),this.setColor4=e.setColor4.bind(e),this.setDirectColor4=e.setDirectColor4.bind(e),this.setInt=e.setInt.bind(e),this.setInt2=e.setInt2.bind(e),this.setInt3=e.setInt3.bind(e),this.setInt4=e.setInt4.bind(e))}return e.prototype._isUbo=function(e){return void 0!==e.addUniform},e}()}}]);