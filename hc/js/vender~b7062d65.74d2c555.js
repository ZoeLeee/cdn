"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3336],{72693:(e,t,i)=>{i.d(t,{o:()=>n,p:()=>r});var r=function(){function e(){}return e.COPY=1,e.CUT=2,e.PASTE=3,e}(),n=function(){function e(e,t){this.type=e,this.event=t}return e.GetTypeFromCharacter=function(e){switch(e){case 67:return r.COPY;case 86:return r.PASTE;case 88:return r.CUT;default:return-1}},e}()},49671:(e,t,i)=>{var r;i.d(t,{G:()=>n,g:()=>r}),function(e){e[e.PointerMove=0]="PointerMove",e[e.PointerDown=1]="PointerDown",e[e.PointerUp=2]="PointerUp"}(r||(r={}));var n=function(){function e(){}return e.DOM_DELTA_PIXEL=0,e.DOM_DELTA_LINE=1,e.DOM_DELTA_PAGE=2,e}()},32050:(e,t,i)=>{i.d(t,{CU:()=>n.CU,FV:()=>n.FV,GV:()=>s.G,NG:()=>r.NG,OG:()=>r.OG,R5:()=>n.R5,WZ:()=>r.WZ,gE:()=>s.g,kD:()=>n.kD,oF:()=>o.o,py:()=>o.p});var r=i(63737),n=i(76324),o=i(72693),s=i(49671)},63737:(e,t,i)=>{i.d(t,{NG:()=>o,OG:()=>n,WZ:()=>s});var r=i(31191),n=function(){function e(){}return e.KEYDOWN=1,e.KEYUP=2,e}(),o=function(e,t){this.type=e,this.event=t},s=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.type=t,r.event=i,r.skipOnKeyboardObservable=!1,r}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"skipOnPointerObservable",{get:function(){return this.skipOnKeyboardObservable},set:function(e){this.skipOnKeyboardObservable=e},enumerable:!1,configurable:!0}),t}(o)},76324:(e,t,i)=>{i.d(t,{CU:()=>s,FV:()=>a,R5:()=>h,kD:()=>o});var r=i(31191),n=i(58095),o=function(){function e(){}return e.POINTERDOWN=1,e.POINTERUP=2,e.POINTERMOVE=4,e.POINTERWHEEL=8,e.POINTERPICK=16,e.POINTERTAP=32,e.POINTERDOUBLETAP=64,e}(),s=function(e,t){this.type=e,this.event=t},a=function(e){function t(t,i,r,o){var s=e.call(this,t,i)||this;return s.ray=null,s.skipOnPointerObservable=!1,s.localPosition=new n.FM(r,o),s}return(0,r.ZT)(t,e),t}(s),h=function(e){function t(t,i,r){var n=e.call(this,t,i)||this;return n.pickInfo=r,n}return(0,r.ZT)(t,e),t}(s)},94557:(e,t,i)=>{i.d(t,{K4:()=>c,wc:()=>r,zn:()=>d});var r,n=i(31191),o=i(62897),s=i(58095),a=i(1316),h=i(15210),l=i(34987);!function(e){e[e.VIVE=0]="VIVE",e[e.OCULUS=1]="OCULUS",e[e.WINDOWS=2]="WINDOWS",e[e.GEAR_VR=3]="GEAR_VR",e[e.DAYDREAM=4]="DAYDREAM",e[e.GENERIC=5]="GENERIC"}(r||(r={}));var d=function(){function e(){}return e.InitiateController=function(e){for(var t=0,i=this._ControllerFactories;t<i.length;t++){var r=i[t];if(r.canCreate(e))return r.create(e)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(e);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."},e._ControllerFactories=[],e._DefaultControllerFactory=null,e}(),c=function(e){function t(t){var i=e.call(this,t.id,t.index,t)||this;return i.isXR=!1,i._deviceRoomPosition=s.P.Zero(),i._deviceRoomRotationQuaternion=new s._f,i.devicePosition=s.P.Zero(),i.deviceRotationQuaternion=new s._f,i.deviceScaleFactor=1,i._trackPosition=!0,i._maxRotationDistFromHeadset=Math.PI/5,i._draggedRoomRotation=0,i._leftHandSystemQuaternion=new s._f,i._deviceToWorld=s.y3.Identity(),i._pointingPoseNode=null,i._workingMatrix=s.y3.Identity(),i._meshAttachedObservable=new o.y$,i.type=l.nJ.POSE_ENABLED,i.controllerType=r.GENERIC,i.position=s.P.Zero(),i.rotationQuaternion=new s._f,i._calculatedPosition=s.P.Zero(),i._calculatedRotation=new s._f,s._f.RotationYawPitchRollToRef(Math.PI,0,0,i._leftHandSystemQuaternion),i}return(0,n.ZT)(t,e),t.prototype._disableTrackPosition=function(e){this._trackPosition&&(this._calculatedPosition.copyFrom(e),this._trackPosition=!1)},t.prototype.update=function(){e.prototype.update.call(this),this._updatePoseAndMesh()},t.prototype._updatePoseAndMesh=function(){if(!this.isXR){var e=this.browserGamepad.pose;if(this.updateFromDevice(e),!this._trackPosition&&h.l.LastCreatedScene&&h.l.LastCreatedScene.activeCamera&&h.l.LastCreatedScene.activeCamera.devicePosition){var t=h.l.LastCreatedScene.activeCamera;if(t._computeDevicePosition(),this._deviceToWorld.setTranslation(t.devicePosition),t.deviceRotationQuaternion){t._deviceRoomRotationQuaternion.toEulerAnglesToRef(s.jp.Vector3[0]);var i=Math.atan2(Math.sin(s.jp.Vector3[0].y-this._draggedRoomRotation),Math.cos(s.jp.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(i)>this._maxRotationDistFromHeadset){var r=i-(i<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=r;var n=Math.sin(-r),o=Math.cos(-r);this._calculatedPosition.x=this._calculatedPosition.x*o-this._calculatedPosition.z*n,this._calculatedPosition.z=this._calculatedPosition.x*n+this._calculatedPosition.z*o}}}s.P.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),s._f.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))}},t.prototype.updateFromDevice=function(e){if(!this.isXR&&e){this.rawPose=e,e.position&&(this._deviceRoomPosition.copyFromFloats(e.position[0],e.position[1],-e.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var t=this.rawPose;e.orientation&&t.orientation&&4===t.orientation.length&&(this._deviceRoomRotationQuaternion.copyFromFloats(t.orientation[0],t.orientation[1],-t.orientation[2],-t.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},t.prototype.attachToMesh=function(e){if(this._mesh&&(this._mesh.parent=null),this._mesh=e,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new s._f),!this.isXR&&(this._updatePoseAndMesh(),this._pointingPoseNode)){for(var t=[],i=this._pointingPoseNode;i.parent;)t.push(i.parent),i=i.parent;t.reverse().forEach((function(e){e.computeWorldMatrix(!0)}))}this._meshAttachedObservable.notifyObservers(e)},t.prototype.attachToPoseControlledCamera=function(e){this._poseControlledCamera=e,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},t.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),t.prototype.getForwardRay=function(e){if(void 0===e&&(e=100),!this.mesh)return new a.z(s.P.Zero(),new s.P(0,0,1),e);var t=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),i=t.getTranslation(),r=new s.P(0,0,-1),n=s.P.TransformNormal(r,t),o=s.P.Normalize(n);return new a.z(i,o,e)},t.POINTING_POSE="POINTING_POSE",t}(l.nJ)},97338:(e,t,i)=>{i.d(t,{T:()=>o});var r=i(31191),n=i(62897),o=function(e){function t(t){var i=e.call(this,t)||this;return i.onTriggerStateChangedObservable=new n.y$,i.onMainButtonStateChangedObservable=new n.y$,i.onSecondaryButtonStateChangedObservable=new n.y$,i.onPadStateChangedObservable=new n.y$,i.onPadValuesChangedObservable=new n.y$,i.pad={x:0,y:0},i._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},i._buttons=new Array(t.buttons.length),i.hand=t.hand,i}return(0,r.ZT)(t,e),t.prototype.onButtonStateChange=function(e){this._onButtonStateChange=e},Object.defineProperty(t.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!1,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._setButtonValue(this.browserGamepad.buttons[t],this._buttons[t],t);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},t.prototype._setButtonValue=function(e,t,i){e||(e={pressed:!1,touched:!1,value:0}),t?(this._checkChanges(e,t),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,i,e),this._handleButtonChange(i,e,this._changes)),this._buttons[i].pressed=e.pressed,this._buttons[i].touched=e.touched,this._buttons[i].value=e.value<1e-8?0:e.value):this._buttons[i]={pressed:e.pressed,touched:e.touched,value:e.value}},t.prototype._checkChanges=function(e,t){return this._changes.pressChanged=e.pressed!==t.pressed,this._changes.touchChanged=e.touched!==t.touched,this._changes.valueChanged=e.value!==t.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._defaultModel=null,this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},t}(i(94557).K4)},46680:(e,t,i)=>{i.d(t,{K4:()=>n,NF:()=>r,Xq:()=>h});var r,n,o=i(31191),s=i(62897),a=i(34987);!function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.Share=8]="Share",e[e.Options=9]="Options",e[e.LeftStick=10]="LeftStick",e[e.RightStick=11]="RightStick"}(r||(r={})),function(e){e[e.Up=12]="Up",e[e.Down=13]="Down",e[e.Left=14]="Left",e[e.Right=15]="Right"}(n||(n={}));var h=function(e){function t(t,i,r){var n=e.call(this,t.replace("STANDARD GAMEPAD","SONY PLAYSTATION DUALSHOCK"),i,r,0,1,2,3)||this;return n._leftTrigger=0,n._rightTrigger=0,n.onButtonDownObservable=new s.y$,n.onButtonUpObservable=new s.y$,n.onPadDownObservable=new s.y$,n.onPadUpObservable=new s.y$,n._buttonCross=0,n._buttonCircle=0,n._buttonSquare=0,n._buttonTriangle=0,n._buttonShare=0,n._buttonOptions=0,n._buttonL1=0,n._buttonR1=0,n._buttonLeftStick=0,n._buttonRightStick=0,n._dPadUp=0,n._dPadDown=0,n._dPadLeft=0,n._dPadRight=0,n.type=a.nJ.DUALSHOCK,n}return(0,o.ZT)(t,e),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!1,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e},t.prototype._setDPadValue=function(e,t,i){return e!==t&&(1===e&&(this._ondpaddown&&this._ondpaddown(i),this.onPadDownObservable.notifyObservers(i)),0===e&&(this._ondpadup&&this._ondpadup(i),this.onPadUpObservable.notifyObservers(i))),e},Object.defineProperty(t.prototype,"buttonCross",{get:function(){return this._buttonCross},set:function(e){this._buttonCross=this._setButtonValue(e,this._buttonCross,r.Cross)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonCircle",{get:function(){return this._buttonCircle},set:function(e){this._buttonCircle=this._setButtonValue(e,this._buttonCircle,r.Circle)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonSquare",{get:function(){return this._buttonSquare},set:function(e){this._buttonSquare=this._setButtonValue(e,this._buttonSquare,r.Square)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonTriangle",{get:function(){return this._buttonTriangle},set:function(e){this._buttonTriangle=this._setButtonValue(e,this._buttonTriangle,r.Triangle)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonOptions",{get:function(){return this._buttonOptions},set:function(e){this._buttonOptions=this._setButtonValue(e,this._buttonOptions,r.Options)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonShare",{get:function(){return this._buttonShare},set:function(e){this._buttonShare=this._setButtonValue(e,this._buttonShare,r.Share)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonL1",{get:function(){return this._buttonL1},set:function(e){this._buttonL1=this._setButtonValue(e,this._buttonL1,r.L1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonR1",{get:function(){return this._buttonR1},set:function(e){this._buttonR1=this._setButtonValue(e,this._buttonR1,r.R1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,r.LeftStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,r.RightStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,n.Up)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,n.Down)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,n.Left)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,n.Right)},enumerable:!1,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this),this.buttonCross=this.browserGamepad.buttons[0].value,this.buttonCircle=this.browserGamepad.buttons[1].value,this.buttonSquare=this.browserGamepad.buttons[2].value,this.buttonTriangle=this.browserGamepad.buttons[3].value,this.buttonL1=this.browserGamepad.buttons[4].value,this.buttonR1=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonShare=this.browserGamepad.buttons[8].value,this.buttonOptions=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(a.nJ)},34987:(e,t,i)=>{i.d(t,{If:()=>a,nJ:()=>s,zD:()=>o});var r=i(31191),n=i(62897),o=function(e,t){this.x=e,this.y=t},s=function(){function e(t,i,r,n,o,s,a){void 0===n&&(n=0),void 0===o&&(o=1),void 0===s&&(s=2),void 0===a&&(a=3),this.id=t,this.index=i,this.browserGamepad=r,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=e.GAMEPAD,this._leftStickAxisX=n,this._leftStickAxisY=o,this._rightStickAxisX=s,this._rightStickAxisY=a,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!1,configurable:!0}),e.prototype.onleftstickchanged=function(e){this._onleftstickchanged=e},e.prototype.onrightstickchanged=function(e){this._onrightstickchanged=e},Object.defineProperty(e.prototype,"leftStick",{get:function(){return this._leftStick},set:function(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightStick",{get:function(){return this._rightStick},set:function(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e},enumerable:!1,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},e.prototype.dispose=function(){},e.GAMEPAD=0,e.GENERIC=1,e.XBOX=2,e.POSE_ENABLED=3,e.DUALSHOCK=4,e}(),a=function(e){function t(t,i,r){var o=e.call(this,t,i,r)||this;return o.onButtonDownObservable=new n.y$,o.onButtonUpObservable=new n.y$,o.type=s.GENERIC,o._buttons=new Array(r.buttons.length),o}return(0,r.ZT)(t,e),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype._setButtonValue=function(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e},t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.browserGamepad.buttons[t].value,this._buttons[t],t)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},t}(s)},13310:(e,t,i)=>{i.d(t,{v:()=>c});var r=i(62897),n=i(80352),o=i(94557),s=i(76576),a=i(34987),h=i(37290),l=i(46680),d=i(13514),c=function(){function e(e){var t=this;if(this._scene=e,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new r.y$,(0,n.CG)()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator&&(navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads)):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new r.y$((function(e){for(var i in t._babylonGamepads){var r=t._babylonGamepads[i];r&&r._isConnected&&t.onGamepadConnectedObservable.notifyObserver(e,r)}})),this._onGamepadConnectedEvent=function(e){var i,r=e.gamepad;r.index in t._babylonGamepads&&t._babylonGamepads[r.index].isConnected||(t._babylonGamepads[r.index]?((i=t._babylonGamepads[r.index]).browserGamepad=r,i._isConnected=!0):i=t._addNewGamepad(r),t.onGamepadConnectedObservable.notifyObservers(i),t._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=function(e){var i=e.gamepad;for(var r in t._babylonGamepads)if(t._babylonGamepads[r].index===i.index){var n=t._babylonGamepads[r];n._isConnected=!1,t.onGamepadDisconnectedObservable.notifyObservers(n),n.dispose&&n.dispose();break}},this._gamepadSupport)if(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported){var i=this._scene?this._scene.getEngine().getHostWindow():window;i&&(i.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),i.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1))}else this._startMonitoringGamepads()}return Object.defineProperty(e.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!1,configurable:!0}),e.prototype.getGamepadByType=function(e){void 0===e&&(e=a.nJ.XBOX);for(var t=0,i=this._babylonGamepads;t<i.length;t++){var r=i[t];if(r&&r.type===e)return r}return null},e.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach((function(e){e.dispose()})),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},e.prototype._addNewGamepad=function(e){var t;this._oneGamepadConnected||(this._oneGamepadConnected=!0);var i=-1!==e.id.search("054c")&&-1===e.id.search("0ce6"),r=-1!==e.id.search("Xbox One");return t=r||-1!==e.id.search("Xbox 360")||-1!==e.id.search("xinput")||-1!==e.id.search("045e")&&-1===e.id.search("Surface Dock")?new s.FI(e.id,e.index,e,r):i?new l.Xq(e.id,e.index,e):e.pose?o.zn.InitiateController(e):new a.If(e.id,e.index,e),this._babylonGamepads[t.index]=t,t},e.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var e=this;for(var t in this._updateGamepadObjects(),this._babylonGamepads){var i=this._babylonGamepads[t];if(i&&i.isConnected)try{i.update()}catch(e){-1===this._loggedErrors.indexOf(i.index)&&(d.w1.Warn("Error updating gamepad ".concat(i.id)),this._loggedErrors.push(i.index))}}this._isMonitoring&&!this._scene&&h.D.QueueNewFrame((function(){e._checkGamepadsStatus()}))},e.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++){var i=e[t];if(i)if(this._babylonGamepads[i.index])this._babylonGamepads[t].browserGamepad=i,this._babylonGamepads[t].isConnected||(this._babylonGamepads[t]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[t]));else{var r=this._addNewGamepad(i);this.onGamepadConnectedObservable.notifyObservers(r)}}},e}()},93197:(e,t,i)=>{i.d(t,{j:()=>d});var r=i(65273),n=i(85627),o=i(13310),s=i(93151),a=i(61660),h=i(50532),l=i(75537);Object.defineProperty(r.x.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new o.v(this);var e=this._getComponent(n.l.NAME_GAMEPAD);e||(e=new d(this),this._addComponent(e))}return this._gamepadManager},enumerable:!0,configurable:!0}),s.a.prototype.addGamepad=function(){return this.add(new a.c),this},h.$.prototype.addGamepad=function(){return this.add(new l.R),this};var d=function(){function e(e){this.name=n.l.NAME_GAMEPAD,this.scene=e}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(n.l.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){var e=this.scene._gamepadManager;e&&(e.dispose(),this.scene._gamepadManager=null)},e.prototype._beforeCameraUpdate=function(){var e=this.scene._gamepadManager;e&&e._isMonitoring&&e._checkGamepadsStatus()},e}()},26449:(e,t,i)=>{i.d(t,{wR:()=>h,NF:()=>T.NF,K4:()=>T.K4,Xq:()=>T.Xq,nJ:()=>M.nJ,v$:()=>P.v,jB:()=>O.j,N0:()=>c,MS:()=>u,If:()=>M.If,bJ:()=>f,Ui:()=>a.K4,zn:()=>a.zn,wc:()=>a.wc,zD:()=>M.zD,lG:()=>g,T8:()=>s.T,Bp:()=>v,jh:()=>y,nR:()=>x.nR,_Q:()=>x._Q,FI:()=>x.FI});var r=i(31191),n=i(84318),o=i(63407),s=i(97338),a=i(94557),h=function(e){function t(t){var i=e.call(this,t)||this;return i.controllerType=a.wc.DAYDREAM,i}return(0,r.ZT)(t,e),t.prototype.initControllerMesh=function(e,i){var r=this;o.n.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,(function(e){r._defaultModel=e[1],r.attachToMesh(r._defaultModel),i&&i(r._defaultModel)}))},t.prototype._handleButtonChange=function(e,t){if(0===e){var i=this.onTriggerStateChangedObservable;i&&i.notifyObservers(t)}else n.Y.Warn("Unrecognized Daydream button index: ".concat(e))},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Daydream",t}(s.T);a.zn._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(h.GAMEPAD_ID_PREFIX)},create:function(e){return new h(e)}});var l=i(58095),d=i(91243),c=function(e){function t(t){var i=e.call(this,t)||this;return i._buttonIndexToObservableNameMap=["onPadStateChangedObservable","onTriggerStateChangedObservable"],i.controllerType=a.wc.GEAR_VR,i._calculatedPosition=new l.P("left"==i.hand?-.15:.15,-.5,.25),i._disableTrackPosition(i._calculatedPosition),i}return(0,r.ZT)(t,e),t.prototype.initControllerMesh=function(e,i){var r=this;o.n.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,(function(t){var n=new d.Kj("",e);t[1].parent=n,t[1].position.z=-.15,r._defaultModel=n,r.attachToMesh(r._defaultModel),i&&i(r._defaultModel)}))},t.prototype._handleButtonChange=function(e,t){if(e<this._buttonIndexToObservableNameMap.length){var i=this[this._buttonIndexToObservableNameMap[e]];i&&i.notifyObservers(t)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Gear VR",t}(s.T);a.zn._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(c.GAMEPAD_ID_PREFIX)||-1!==e.id.indexOf("Oculus Go")||-1!==e.id.indexOf("Vive Focus")},create:function(e){return new c(e)}});var u=function(e){function t(t){return e.call(this,t)||this}return(0,r.ZT)(t,e),t.prototype.initControllerMesh=function(e,i){var r=this;o.n.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,(function(e){r._defaultModel=e[1],r.attachToMesh(r._defaultModel),i&&i(r._defaultModel)}))},t.prototype._handleButtonChange=function(e,t){},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t}(s.T);a.zn._DefaultControllerFactory=function(e){return new u(e)};var p=i(62897),_=i(15210),f=function(e){function t(t){var i=e.call(this,t)||this;return i.onSecondaryTriggerStateChangedObservable=new p.y$,i.onThumbRestChangedObservable=new p.y$,i.controllerType=a.wc.OCULUS,i}return(0,r.ZT)(t,e),t.prototype.initControllerMesh=function(e,i){var r,n=this;r="left"===this.hand?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,o.n.ImportMesh("",t._IsQuest?t.QUEST_MODEL_BASE_URL:t.MODEL_BASE_URL,r,e,(function(e){n._defaultModel=t._IsQuest?e[0]:e[1],n.attachToMesh(n._defaultModel),i&&i(n._defaultModel)}))},Object.defineProperty(t.prototype,"onAButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onXButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onYButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!1,configurable:!0}),t.prototype._handleButtonChange=function(e,i){var r=i,n="right"===this.hand?-1:1;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(r);case 1:return!t._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=.2*-r.value,this._defaultModel.getChildren()[3].position.y=.005*-r.value,this._defaultModel.getChildren()[3].position.z=.005*-r.value),void this.onTriggerStateChangedObservable.notifyObservers(r);case 2:return!t._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=n*r.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(r);case 3:return!t._IsQuest&&this._defaultModel&&(r.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),void this.onMainButtonStateChangedObservable.notifyObservers(r);case 4:return!t._IsQuest&&this._defaultModel&&(r.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(r);case 5:return void this.onThumbRestChangedObservable.notifyObservers(r)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t.QUEST_MODEL_BASE_URL="https://controllers.babylonjs.com/oculusQuest/",t._IsQuest=!1,t}(s.T);a.zn._ControllerFactories.push({canCreate:function(e){return _.l.LastCreatedEngine&&_.l.LastCreatedEngine._vrDisplay&&"Oculus Quest"===_.l.LastCreatedEngine._vrDisplay.displayName&&(f._IsQuest=!0),-1!==e.id.indexOf("Oculus Touch")},create:function(e){return new f(e)}});var g=function(e){function t(t){var i=e.call(this,t)||this;return i.controllerType=a.wc.VIVE,i._invertLeftStickY=!0,i}return(0,r.ZT)(t,e),t.prototype.initControllerMesh=function(e,i){var r=this;o.n.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,(function(e){r._defaultModel=e[1],r.attachToMesh(r._defaultModel),i&&i(r._defaultModel)}))},Object.defineProperty(t.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!1,configurable:!0}),t.prototype._handleButtonChange=function(e,t){var i=t;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(i);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-i.value),void this.onTriggerStateChangedObservable.notifyObservers(i);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(i);case 3:return this._defaultModel&&(i.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(i)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(s.T);a.zn._ControllerFactories.push({canCreate:function(e){return-1!==e.id.toLowerCase().indexOf("openvr")},create:function(e){return new g(e)}});var b=i(1316),m=function(){this.buttonMeshes={},this.axisMeshes={}},v=function(e){function t(t){var i=e.call(this,t)||this;return i._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:a.K4.POINTING_POSE},i.onTrackpadChangedObservable=new p.y$,i.onTrackpadValuesChangedObservable=new p.y$,i.trackpad={x:0,y:0},i.controllerType=a.wc.WINDOWS,i._loadedMeshInfo=null,i}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!1,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_X")],this.trackpad.y=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_Y")],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.update=function(){if(e.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var t=0;t<this._mapping.axisMeshNames.length;t++)this._lerpAxisTransform(t,this.browserGamepad.axes[t])},t.prototype._handleButtonChange=function(e,t){var i=this._mapping.buttons[e];if(i){this._updateTrackpad();var r=this[this._mapping.buttonObservableNames[i]];r&&r.notifyObservers(t),this._lerpButtonTransform(i,t.value)}},t.prototype._lerpButtonTransform=function(e,t){if(this._loadedMeshInfo){var i=this._loadedMeshInfo.buttonMeshes[e];i&&i.unpressed.rotationQuaternion&&i.pressed.rotationQuaternion&&i.value.rotationQuaternion&&(l._f.SlerpToRef(i.unpressed.rotationQuaternion,i.pressed.rotationQuaternion,t,i.value.rotationQuaternion),l.P.LerpToRef(i.unpressed.position,i.pressed.position,t,i.value.position))}},t.prototype._lerpAxisTransform=function(e,t){if(this._loadedMeshInfo){var i=this._loadedMeshInfo.axisMeshes[e];if(i&&i.min.rotationQuaternion&&i.max.rotationQuaternion&&i.value.rotationQuaternion){var r=.5*t+.5;l._f.SlerpToRef(i.min.rotationQuaternion,i.max.rotationQuaternion,r,i.value.rotationQuaternion),l.P.LerpToRef(i.min.position,i.max.position,r,i.value.position)}}},t.prototype.initControllerMesh=function(e,i,r){var s,a,h=this;if(void 0===r&&(r=!1),o.n.IsPluginForExtensionAvailable(".glb")){var l="default";if(this.id&&!r){var d=this.id.match(t.GAMEPAD_ID_PATTERN);l=d&&d[0]||l}a="left"===this.hand?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,s=t.MODEL_BASE_URL+l+"/"}else n.Y.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),s=u.MODEL_BASE_URL,a=u.MODEL_FILENAME;o.n.ImportMesh("",s,a,e,(function(t){h._loadedMeshInfo=h._processModel(e,t),h._loadedMeshInfo&&(h._defaultModel=h._loadedMeshInfo.rootNode,h.attachToMesh(h._defaultModel),i&&i(h._defaultModel))}),null,(function(e,t){n.Y.Log(t),n.Y.Warn("Failed to retrieve controller model from the remote server: "+s+a),r||h.initControllerMesh(e,i,!0)}))},t.prototype._processModel=function(e,t){for(var i=null,r=new d.Kj(this.id+" "+this.hand,e),o=null,s=0;s<t.length;s++){var a=t[s];if(!a.parent){a.isPickable=!1,o=a;break}}return o?(o.setParent(r),i=this._createMeshInfo(r)):n.Y.Warn("Could not find root node in model file."),i},t.prototype._createMeshInfo=function(e){var t,i=new m;for(i.rootNode=e,i.buttonMeshes={},i.axisMeshes={},t=0;t<this._mapping.buttons.length;t++){var r=this._mapping.buttonMeshNames[this._mapping.buttons[t]];if(r){var o=d(e,r);if(o){var s={index:t,value:c(o,"VALUE"),pressed:c(o,"PRESSED"),unpressed:c(o,"UNPRESSED")};s.value&&s.pressed&&s.unpressed?i.buttonMeshes[this._mapping.buttons[t]]=s:n.Y.Warn("Missing button submesh under mesh with name: "+r+"(VALUE: "+!!s.value+", PRESSED: "+!!s.pressed+", UNPRESSED:"+!!s.unpressed+")")}else n.Y.Warn("Missing button mesh with name: "+r)}else n.Y.Log("Skipping unknown button at index: "+t+" with mapped name: "+this._mapping.buttons[t])}for(t=0;t<this._mapping.axisMeshNames.length;t++){var a=this._mapping.axisMeshNames[t];if(a){var h=d(e,a);if(h){var l={index:t,value:c(h,"VALUE"),min:c(h,"MIN"),max:c(h,"MAX")};l.value&&l.min&&l.max?i.axisMeshes[t]=l:n.Y.Warn("Missing axis submesh under mesh with name: "+a+"(VALUE: "+!!l.value+", MIN: "+!!l.min+", MAX:"+!!l.max+")")}else n.Y.Warn("Missing axis mesh with name: "+a)}else n.Y.Log("Skipping unknown axis at index: "+t)}return i.pointingPoseNode=d(e,this._mapping.pointingPoseMeshName),i.pointingPoseNode?this._pointingPoseNode=i.pointingPoseNode:n.Y.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),i;function d(e,t){return e.getChildren((function(e){return e.name===t}),!1)[0]}function c(e,t){return e.getChildren((function(e){return e.name==t}),!0)[0]}},t.prototype.getForwardRay=function(t){if(void 0===t&&(t=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return e.prototype.getForwardRay.call(this,t);var i=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),r=i.getTranslation(),n=new l.P(0,0,-1),o=l.P.TransformNormal(n,i),s=l.P.Normalize(o);return new b.z(r,s,t)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear(),this.onTrackpadValuesChangedObservable.clear()},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",t.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,t}(s.T),y=function(e){function t(t){var i=e.call(this,t)||this;return i._mapping={buttons:["trigger","grip","trackpad","thumbstick","menu"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onThumbstickStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y","THUMBSTICK_X","THUMBSTICK_Y"],pointingPoseMeshName:a.K4.POINTING_POSE},i.thumbstickValues={x:0,y:0},i.onThumbstickStateChangedObservable=new p.y$,i.onThumbstickValuesChangedObservable=new p.y$,i.onTrackpadChangedObservable=i.onPadStateChangedObservable,i.onTrackpadValuesChangedObservable=i.onPadValuesChangedObservable,i}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onThumbstickStateChangedObservable},enumerable:!1,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.thumbstickValues.x&&this.browserGamepad.axes[3]==this.thumbstickValues.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onThumbstickValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onThumbstickStateChangedObservable.clear(),this.onThumbstickValuesChangedObservable.clear()},t}(v);a.zn._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(v.GAMEPAD_ID_PREFIX)},create:function(e){return new v(e)}});var M=i(34987),P=i(13310),O=i(93197),x=i(76576),T=i(46680)},76576:(e,t,i)=>{i.d(t,{FI:()=>h,_Q:()=>n,nR:()=>r});var r,n,o=i(31191),s=i(62897),a=i(34987);!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LB=4]="LB",e[e.RB=5]="RB",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LeftStick=10]="LeftStick",e[e.RightStick=11]="RightStick"}(r||(r={})),function(e){e[e.Up=12]="Up",e[e.Down=13]="Down",e[e.Left=14]="Left",e[e.Right=15]="Right"}(n||(n={}));var h=function(e){function t(t,i,r,n){void 0===n&&(n=!1);var o=e.call(this,t,i,r,0,1,2,3)||this;return o._leftTrigger=0,o._rightTrigger=0,o.onButtonDownObservable=new s.y$,o.onButtonUpObservable=new s.y$,o.onPadDownObservable=new s.y$,o.onPadUpObservable=new s.y$,o._buttonA=0,o._buttonB=0,o._buttonX=0,o._buttonY=0,o._buttonBack=0,o._buttonStart=0,o._buttonLB=0,o._buttonRB=0,o._buttonLeftStick=0,o._buttonRightStick=0,o._dPadUp=0,o._dPadDown=0,o._dPadLeft=0,o._dPadRight=0,o._isXboxOnePad=!1,o.type=a.nJ.XBOX,o._isXboxOnePad=n,o}return(0,o.ZT)(t,e),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!1,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e},t.prototype._setDPadValue=function(e,t,i){return e!==t&&(1===e&&(this._ondpaddown&&this._ondpaddown(i),this.onPadDownObservable.notifyObservers(i)),0===e&&(this._ondpadup&&this._ondpadup(i),this.onPadUpObservable.notifyObservers(i))),e},Object.defineProperty(t.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,r.A)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,r.B)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,r.X)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,r.Y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,r.Start)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,r.Back)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,r.LB)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,r.RB)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,r.LeftStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,r.RightStick)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,n.Up)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,n.Down)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,n.Left)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,n.Right)},enumerable:!1,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this),this._isXboxOnePad,this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(a.nJ)},9148:(e,t,i)=>{i.d(t,{u:()=>_});var r=i(31191),n=i(62897),o=i(58095),s=i(30700),a=i(91243),h=i(62845),l=i(63654),d=i(20440),c=i(85527),u=i(3085),p=i(15631),_=function(e){function t(i,r,s,h,d){void 0===r&&(r=p.Wo.Gray()),void 0===s&&(s=c.x.DefaultUtilityLayer),void 0===h&&(h=null),void 0===d&&(d=1);var _,f=this;(f=e.call(this,s)||this)._pointerObserver=null,f.snapDistance=0,f.onSnapObservable=new n.y$,f._isEnabled=!0,f._parent=null,f._dragging=!1,f._parent=h,f._coloredMaterial=new u.K("",s.utilityLayerScene),f._coloredMaterial.diffuseColor=r,f._coloredMaterial.specularColor=r.subtract(new p.Wo(.1,.1,.1)),f._hoverMaterial=new u.K("",s.utilityLayerScene),f._hoverMaterial.diffuseColor=p.Wo.Yellow(),f._disableMaterial=new u.K("",s.utilityLayerScene),f._disableMaterial.diffuseColor=p.Wo.Gray(),f._disableMaterial.alpha=.4;var g=t._CreateArrow(s.utilityLayerScene,f._coloredMaterial,d),b=t._CreateArrow(s.utilityLayerScene,f._coloredMaterial,d+4,!0);f._gizmoMesh=new a.Kj("",s.utilityLayerScene),f._gizmoMesh.addChild(g),f._gizmoMesh.addChild(b),f._gizmoMesh.lookAt(f._rootMesh.position.add(i)),f._gizmoMesh.scaling.scaleInPlace(1/3),f._gizmoMesh.parent=f._rootMesh;var m=0,v=new o.P,y=new o.P,M={snapDistance:0};f.dragBehavior=new l.M({dragAxis:i}),f.dragBehavior.moveAttached=!1,f.dragBehavior.updateDragPlane=!1,f._rootMesh.addBehavior(f.dragBehavior),f.dragBehavior.onDragObservable.add((function(e){if(f.attachedNode){f._handlePivot();var t=!1;if(0==f.snapDistance)f.attachedNode.getWorldMatrix().getTranslationToRef(y),y.addInPlace(e.delta),f.dragBehavior.validateDrag(y)&&(f.attachedNode.position&&f.attachedNode.position.addInPlaceFromFloats(e.delta.x,e.delta.y,e.delta.z),f.attachedNode.getWorldMatrix().addTranslationFromFloats(e.delta.x,e.delta.y,e.delta.z),f.attachedNode.updateCache(),t=!0);else if(m+=e.dragDistance,Math.abs(m)>f.snapDistance){var i=Math.floor(Math.abs(m)/f.snapDistance);m%=f.snapDistance,e.delta.normalizeToRef(v),v.scaleInPlace(f.snapDistance*i),f.attachedNode.getWorldMatrix().getTranslationToRef(y),y.addInPlace(v),f.dragBehavior.validateDrag(y)&&(f.attachedNode.getWorldMatrix().addTranslationFromFloats(v.x,v.y,v.z),f.attachedNode.updateCache(),M.snapDistance=f.snapDistance*i,f.onSnapObservable.notifyObservers(M),t=!0)}t&&f._matrixChanged()}})),f.dragBehavior.onDragStartObservable.add((function(){f._dragging=!0})),f.dragBehavior.onDragEndObservable.add((function(){f._dragging=!1}));var P=s._getSharedGizmoLight();P.includedOnlyMeshes=P.includedOnlyMeshes.concat(f._rootMesh.getChildMeshes(!1));var O={gizmoMeshes:g.getChildMeshes(),colliderMeshes:b.getChildMeshes(),material:f._coloredMaterial,hoverMaterial:f._hoverMaterial,disableMaterial:f._disableMaterial,active:!1,dragBehavior:f.dragBehavior};return null===(_=f._parent)||void 0===_||_.addToAxisCache(b,O),f._pointerObserver=s.utilityLayerScene.onPointerObservable.add((function(e){var t;if(!f._customMeshSet&&(f._isHovered=!(-1==O.colliderMeshes.indexOf(null===(t=null==e?void 0:e.pickInfo)||void 0===t?void 0:t.pickedMesh)),!f._parent)){var i=f.dragBehavior.enabled?f._isHovered||f._dragging?f._hoverMaterial:f._coloredMaterial:f._disableMaterial;f._setGizmoMeshMaterial(O.gizmoMeshes,i)}})),f.dragBehavior.onEnabledObservable.add((function(e){f._setGizmoMeshMaterial(O.gizmoMeshes,e?O.material:O.disableMaterial)})),f}return(0,r.ZT)(t,e),t._CreateArrow=function(e,t,i,r){void 0===i&&(i=1),void 0===r&&(r=!1);var n=new s.Y("arrow",e),o=(0,h.wf)("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375*(1+(i-1)/4),tessellation:96},e),a=(0,h.wf)("cylinder",{diameterTop:.005*i,height:.275,diameterBottom:.005*i,tessellation:96},e);return o.parent=n,o.material=t,o.rotation.x=Math.PI/2,o.position.z+=.3,a.parent=n,a.material=t,a.position.z+=.1375,a.rotation.x=Math.PI/2,r&&(a.visibility=0,o.visibility=0),n},t._CreateArrowInstance=function(e,t){for(var i=new s.Y("arrow",e),r=0,n=t.getChildMeshes();r<n.length;r++){var o=n[r];o.createInstance(o.name).parent=i}return i},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):(this.attachedMesh=null,this.attachedNode=null)},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach((function(e){e&&e.dispose()})),e.prototype.dispose.call(this)},t}(d.t)},20440:(e,t,i)=>{i.d(t,{t:()=>h});var r=i(58095),n=i(91243),o=i(85527),s=i(76324),a=i(43812),h=function(){function e(e){void 0===e&&(e=o.x.DefaultUtilityLayer);var t=this;this.gizmoLayer=e,this._attachedMesh=null,this._attachedNode=null,this._customRotationQuaternion=null,this._scaleRatio=1,this._isHovered=!1,this._customMeshSet=!1,this._updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this.updateScale=!0,this._interactionsEnabled=!0,this._tempQuaternion=new r._f(0,0,0,1),this._tempVector=new r.P,this._tempVector2=new r.P,this._tempMatrix1=new r.y3,this._tempMatrix2=new r.y3,this._rightHandtoLeftHandMatrix=r.y3.RotationY(Math.PI),this._rootMesh=new n.Kj("gizmoRootNode",e.utilityLayerScene),this._rootMesh.rotationQuaternion=r._f.Identity(),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add((function(){t._update()}))}return Object.defineProperty(e.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(e){this._scaleRatio=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHovered",{get:function(){return this._isHovered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(e){this._attachedMesh=e,e&&(this._attachedNode=e),this._rootMesh.setEnabled(!!e),this._attachedNodeChanged(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attachedNode",{get:function(){return this._attachedNode},set:function(e){this._attachedNode=e,this._attachedMesh=null,this._rootMesh.setEnabled(!!e),this._attachedNodeChanged(e)},enumerable:!1,configurable:!0}),e.prototype.setCustomMesh=function(e){if(e.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach((function(e){e.dispose()})),e.parent=this._rootMesh,this._customMeshSet=!0},Object.defineProperty(e.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(e){this._updateGizmoRotationToMatchAttachedMesh=e},enumerable:!1,configurable:!0}),e.prototype._attachedNodeChanged=function(e){},Object.defineProperty(e.prototype,"customRotationQuaternion",{get:function(){return this._customRotationQuaternion},set:function(e){this._customRotationQuaternion=e},enumerable:!1,configurable:!0}),e.prototype._update=function(){if(this.attachedNode){var t=this.attachedNode;if(this.attachedMesh&&(t=this.attachedMesh||this.attachedNode),this.updateGizmoPositionToMatchAttachedMesh){var i=t.getWorldMatrix().getRow(3),n=i?i.toVector3():new r.P(0,0,0);this._rootMesh.position.copyFrom(n)}if(this.updateGizmoRotationToMatchAttachedMesh){var o=t._isMesh||"AbstractMesh"===t.getClassName()||"TransformNode"===t.getClassName()||"InstancedMesh"===t.getClassName()?t:void 0;t.getWorldMatrix().decompose(void 0,this._rootMesh.rotationQuaternion,void 0,e.PreserveScaling?o:void 0)}else this._customRotationQuaternion?this._rootMesh.rotationQuaternion.copyFrom(this._customRotationQuaternion):this._rootMesh.rotationQuaternion.set(0,0,0,1);if(this.updateScale){var s=this.gizmoLayer.utilityLayerScene.activeCamera,a=s.globalPosition;s.devicePosition&&(a=s.devicePosition),this._rootMesh.position.subtractToRef(a,this._tempVector);var h=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(h,h,h),t._getWorldMatrixDeterminant()<0&&!e.PreserveScaling&&(this._rootMesh.scaling.y*=-1)}else this._rootMesh.scaling.setAll(this.scaleRatio)}},e.prototype._handlePivot=function(){var e=this._attachedNode;e.isUsingPivotMatrix&&e.isUsingPivotMatrix()&&e.position&&e.getWorldMatrix().setTranslation(e.position)},e.prototype._matrixChanged=function(){if(this._attachedNode)if(this._attachedNode._isCamera){var t=this._attachedNode,i=void 0,n=void 0;if(t.parent){var o=this._tempMatrix2;t.parent._worldMatrix.invertToRef(o),this._attachedNode._worldMatrix.multiplyToRef(o,this._tempMatrix1),i=this._tempMatrix1}else i=this._attachedNode._worldMatrix;if(t.getScene().useRightHandedSystem?(this._rightHandtoLeftHandMatrix.multiplyToRef(i,this._tempMatrix2),n=this._tempMatrix2):n=i,n.decompose(this._tempVector2,this._tempQuaternion,this._tempVector),"FreeCamera"===this._attachedNode.getClassName()||"FlyCamera"===this._attachedNode.getClassName()||"ArcFollowCamera"===this._attachedNode.getClassName()||"TargetCamera"===this._attachedNode.getClassName()||"TouchCamera"===this._attachedNode.getClassName()||"UniversalCamera"===this._attachedNode.getClassName()){var s=this._attachedNode;s.rotation=this._tempQuaternion.toEulerAngles(),s.rotationQuaternion&&(s.rotationQuaternion.copyFrom(this._tempQuaternion),s.rotationQuaternion.normalize())}t.position.copyFrom(this._tempVector)}else if(this._attachedNode._isMesh||"AbstractMesh"===this._attachedNode.getClassName()||"TransformNode"===this._attachedNode.getClassName()||"InstancedMesh"===this._attachedNode.getClassName()){var h=this._attachedNode;if(h.parent){o=this._tempMatrix1;var l=this._tempMatrix2;h.parent.getWorldMatrix().invertToRef(o),this._attachedNode.getWorldMatrix().multiplyToRef(o,l),l.decompose(this._tempVector,this._tempQuaternion,h.position,e.PreserveScaling?h:void 0)}else this._attachedNode._worldMatrix.decompose(this._tempVector,this._tempQuaternion,h.position,e.PreserveScaling?h:void 0);h.scaling.copyFrom(this._tempVector),h.billboardMode||(h.rotationQuaternion?(h.rotationQuaternion.copyFrom(this._tempQuaternion),h.rotationQuaternion.normalize()):h.rotation=this._tempQuaternion.toEulerAngles())}else if("Bone"===this._attachedNode.getClassName()){var d=this._attachedNode,c=d.getParent();if(c){var u=this._tempMatrix1,p=this._tempMatrix2;c.getWorldMatrix().invertToRef(u),d.getWorldMatrix().multiplyToRef(u,p),d.getLocalMatrix().copyFrom(p)}else{d.getLocalMatrix().copyFrom(d.getWorldMatrix())}d.markAsDirty()}else{var _=this._attachedNode;if(_.getTypeID){var f=_.getTypeID();if(f===a._.LIGHTTYPEID_DIRECTIONALLIGHT||f===a._.LIGHTTYPEID_SPOTLIGHT||f===a._.LIGHTTYPEID_POINTLIGHT){var g=_.parent;if(g){u=this._tempMatrix1;var b=this._tempMatrix2;g.getWorldMatrix().invertToRef(u),_.getWorldMatrix().multiplyToRef(u,b),b.decompose(void 0,this._tempQuaternion,this._tempVector)}else this._attachedNode._worldMatrix.decompose(void 0,this._tempQuaternion,this._tempVector);_.position=new r.P(this._tempVector.x,this._tempVector.y,this._tempVector.z),_.direction&&(_.direction=new r.P(_.direction.x,_.direction.y,_.direction.z))}}}},e.prototype._setGizmoMeshMaterial=function(e,t){e&&e.forEach((function(e){e.material=t,e.color&&(e.color=t.diffuseColor)}))},e.GizmoAxisPointerObserver=function(e,t){var i=!1;return e.utilityLayerScene.onPointerObservable.add((function(e){var r,n;if(e.pickInfo){if(e.type===s.kD.POINTERMOVE){if(i)return;t.forEach((function(t){var i,r;if(t.colliderMeshes&&t.gizmoMeshes){var n=-1!=(null===(i=t.colliderMeshes)||void 0===i?void 0:i.indexOf(null===(r=null==e?void 0:e.pickInfo)||void 0===r?void 0:r.pickedMesh)),o=t.dragBehavior.enabled?n||t.active?t.hoverMaterial:t.material:t.disableMaterial;t.gizmoMeshes.forEach((function(e){e.material=o,e.color&&(e.color=o.diffuseColor)}))}}))}if(e.type===s.kD.POINTERDOWN)if(t.has(null===(r=e.pickInfo.pickedMesh)||void 0===r?void 0:r.parent))i=!0,t.get(null===(n=e.pickInfo.pickedMesh)||void 0===n?void 0:n.parent).active=!0,t.forEach((function(t){var i,r,n=(-1!=(null===(i=t.colliderMeshes)||void 0===i?void 0:i.indexOf(null===(r=null==e?void 0:e.pickInfo)||void 0===r?void 0:r.pickedMesh))||t.active)&&t.dragBehavior.enabled?t.hoverMaterial:t.disableMaterial;t.gizmoMeshes.forEach((function(e){e.material=n,e.color&&(e.color=n.diffuseColor)}))}));e.type===s.kD.POINTERUP&&t.forEach((function(e){e.active=!1,i=!1,e.gizmoMeshes.forEach((function(t){t.material=e.dragBehavior.enabled?e.material:e.disableMaterial,t.color&&(t.color=e.material.diffuseColor)}))}))}}))},e.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},e.PreserveScaling=!1,e}()},42121:(e,t,i)=>{i.d(t,{uy:()=>r.u,$K:()=>f,CP:()=>P,kP:()=>j,tb:()=>u.t,q1:()=>k,SU:()=>U,xW:()=>z,Af:()=>R,Xh:()=>B,xf:()=>E,qu:()=>L});var r=i(9148),n=i(31191),o=i(62897),s=i(58095),a=i(91243),h=i(8451),l=i(62845),d=i(3085),c=i(63654),u=i(20440),p=i(85527),_=i(15631),f=function(e){function t(t,i,r,n,h){void 0===i&&(i=_.Wo.Gray()),void 0===r&&(r=p.x.DefaultUtilityLayer),void 0===n&&(n=null),void 0===h&&(h=1);var l,f,g,b,m,v,y,M=this;(M=e.call(this,r)||this)._pointerObserver=null,M.snapDistance=0,M.onSnapObservable=new o.y$,M.uniformScaling=!1,M.sensitivity=1,M.dragScale=1,M._isEnabled=!0,M._parent=null,M._dragging=!1,M._tmpVector=new s.P,M._tmpMatrix=new s.y3,M._tmpMatrix2=new s.y3,M._parent=n,M._coloredMaterial=new d.K("",r.utilityLayerScene),M._coloredMaterial.diffuseColor=i,M._coloredMaterial.specularColor=i.subtract(new _.Wo(.1,.1,.1)),M._hoverMaterial=new d.K("",r.utilityLayerScene),M._hoverMaterial.diffuseColor=_.Wo.Yellow(),M._disableMaterial=new d.K("",r.utilityLayerScene),M._disableMaterial.diffuseColor=_.Wo.Gray(),M._disableMaterial.alpha=.4,M._gizmoMesh=new a.Kj("axis",r.utilityLayerScene);var P=M._createGizmoMesh(M._gizmoMesh,h),O=P.arrowMesh,x=P.arrowTail,T=M._createGizmoMesh(M._gizmoMesh,h+4,!0);M._gizmoMesh.lookAt(M._rootMesh.position.add(t)),M._rootMesh.addChild(M._gizmoMesh,u.t.PreserveScaling),M._gizmoMesh.scaling.scaleInPlace(1/3);var S=O.position.clone(),C=x.position.clone(),w=x.scaling.clone(),R=function(e){var t=e*(3/M._rootMesh.scaling.length())*6;O.position.z+=t/3.5,x.scaling.y+=t,M.dragScale=x.scaling.y,x.position.z=O.position.z/2},E=function(){O.position.set(S.x,S.y,S.z),x.position.set(C.x,C.y,C.z),x.scaling.set(w.x,w.y,w.z),M.dragScale=x.scaling.y,M._dragging=!1};M.dragBehavior=new c.M({dragAxis:t}),M.dragBehavior.moveAttached=!1,M.dragBehavior.updateDragPlane=!1,M._rootMesh.addBehavior(M.dragBehavior);var D=0,z=new s.P,B={snapDistance:0};M.dragBehavior.onDragObservable.add((function(e){if(M.attachedNode){M._handlePivot();var i=M.sensitivity*e.dragDistance*(3*M.scaleRatio/M._rootMesh.scaling.length()),r=!1,n=0;M.uniformScaling?z.setAll(.57735):z.copyFrom(t),0==M.snapDistance?z.scaleToRef(i,z):(D+=i,Math.abs(D)>M.snapDistance?(n=Math.floor(Math.abs(D)/M.snapDistance),D<0&&(n*=-1),D%=M.snapDistance,z.scaleToRef(M.snapDistance*n,z),r=!0):z.scaleInPlace(0)),s.y3.ScalingToRef(1+z.x,1+z.y,1+z.z,M._tmpMatrix2),M._tmpMatrix2.multiplyToRef(M.attachedNode.getWorldMatrix(),M._tmpMatrix);var o=M.attachedNode._isMesh?M.attachedNode:void 0;M._tmpMatrix.decompose(M._tmpVector,void 0,void 0,u.t.PreserveScaling?o:void 0);var a=1e5;Math.abs(M._tmpVector.x)<a&&Math.abs(M._tmpVector.y)<a&&Math.abs(M._tmpVector.z)<a&&M.attachedNode.getWorldMatrix().copyFrom(M._tmpMatrix),r&&(B.snapDistance=M.snapDistance*n,M.onSnapObservable.notifyObservers(B)),M._matrixChanged()}})),M.dragBehavior.onDragStartObservable.add((function(){M._dragging=!0})),M.dragBehavior.onDragObservable.add((function(e){return R(e.dragDistance)})),M.dragBehavior.onDragEndObservable.add(E),null===(g=null===(f=null===(l=null==n?void 0:n.uniformScaleGizmo)||void 0===l?void 0:l.dragBehavior)||void 0===f?void 0:f.onDragObservable)||void 0===g||g.add((function(e){return R(e.delta.y)})),null===(v=null===(m=null===(b=null==n?void 0:n.uniformScaleGizmo)||void 0===b?void 0:b.dragBehavior)||void 0===m?void 0:m.onDragEndObservable)||void 0===v||v.add(E);var A={gizmoMeshes:[O,x],colliderMeshes:[T.arrowMesh,T.arrowTail],material:M._coloredMaterial,hoverMaterial:M._hoverMaterial,disableMaterial:M._disableMaterial,active:!1,dragBehavior:M.dragBehavior};null===(y=M._parent)||void 0===y||y.addToAxisCache(M._gizmoMesh,A),M._pointerObserver=r.utilityLayerScene.onPointerObservable.add((function(e){var t;if(!M._customMeshSet&&(M._isHovered=!(-1==A.colliderMeshes.indexOf(null===(t=null==e?void 0:e.pickInfo)||void 0===t?void 0:t.pickedMesh)),!M._parent)){var i=M.dragBehavior.enabled?M._isHovered||M._dragging?M._hoverMaterial:M._coloredMaterial:M._disableMaterial;M._setGizmoMeshMaterial(A.gizmoMeshes,i)}})),M.dragBehavior.onEnabledObservable.add((function(e){M._setGizmoMeshMaterial(A.gizmoMeshes,e?M._coloredMaterial:M._disableMaterial)}));var L=r._getSharedGizmoLight();return L.includedOnlyMeshes=L.includedOnlyMeshes.concat(M._rootMesh.getChildMeshes()),M}return(0,n.ZT)(t,e),t.prototype._createGizmoMesh=function(e,t,i){void 0===i&&(i=!1);var r=(0,h.NR)("yPosMesh",{size:.4*(1+(t-1)/4)},this.gizmoLayer.utilityLayerScene),n=(0,l.wf)("cylinder",{diameterTop:.005*t,height:.275,diameterBottom:.005*t,tessellation:96},this.gizmoLayer.utilityLayerScene);return r.scaling.scaleInPlace(.1),r.material=this._coloredMaterial,r.rotation.x=Math.PI/2,r.position.z+=.3,n.material=this._coloredMaterial,n.position.z+=.1375,n.rotation.x=Math.PI/2,i&&(r.visibility=0,n.visibility=0),e.addChild(r),e.addChild(n),{arrowMesh:r,arrowTail:n}},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):(this.attachedMesh=null,this.attachedNode=null)},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach((function(e){e&&e.dispose()})),e.prototype.dispose.call(this)},t.prototype.setCustomMesh=function(t,i){var r=this;void 0===i&&(i=!1),e.prototype.setCustomMesh.call(this,t),i&&(this._rootMesh.getChildMeshes().forEach((function(e){e.material=r._coloredMaterial,e.color&&(e.color=r._coloredMaterial.diffuseColor)})),this._customMeshSet=!1)},t}(u.t),g=i(84318),b=i(71419),m=i(48087),v=i(9866),y=i(11337),M=i(48154),P=function(e){function t(t,i){void 0===t&&(t=_.Wo.Gray()),void 0===i&&(i=p.x.DefaultKeepDepthUtilityLayer);var r=e.call(this,i)||this;r._boundingDimensions=new s.P(1,1,1),r._renderObserver=null,r._pointerObserver=null,r._scaleDragSpeed=.2,r._tmpQuaternion=new s._f,r._tmpVector=new s.P(0,0,0),r._tmpRotationMatrix=new s.y3,r.ignoreChildren=!1,r.includeChildPredicate=null,r.rotationSphereSize=.1,r.scaleBoxSize=.1,r.fixedDragMeshScreenSize=!1,r.fixedDragMeshBoundsSize=!1,r.fixedDragMeshScreenSizeDistanceFactor=10,r.onDragStartObservable=new o.y$,r.onScaleBoxDragObservable=new o.y$,r.onScaleBoxDragEndObservable=new o.y$,r.onRotationSphereDragObservable=new o.y$,r.onRotationSphereDragEndObservable=new o.y$,r.scalePivot=null,r._axisFactor=new s.P(1,1,1),r._existingMeshScale=new s.P,r._dragMesh=null,r._pointerDragBehavior=new c.M,r.updateScale=!1,r._anchorMesh=new b.x("anchor",i.utilityLayerScene),r._coloredMaterial=new d.K("",i.utilityLayerScene),r._coloredMaterial.disableLighting=!0,r._hoverColoredMaterial=new d.K("",i.utilityLayerScene),r._hoverColoredMaterial.disableLighting=!0,r._lineBoundingBox=new b.x("",i.utilityLayerScene),r._lineBoundingBox.rotationQuaternion=new s._f;var n=[];n.push((0,v.nL)("lines",{points:[new s.P(0,0,0),new s.P(r._boundingDimensions.x,0,0)]},i.utilityLayerScene)),n.push((0,v.nL)("lines",{points:[new s.P(0,0,0),new s.P(0,r._boundingDimensions.y,0)]},i.utilityLayerScene)),n.push((0,v.nL)("lines",{points:[new s.P(0,0,0),new s.P(0,0,r._boundingDimensions.z)]},i.utilityLayerScene)),n.push((0,v.nL)("lines",{points:[new s.P(r._boundingDimensions.x,0,0),new s.P(r._boundingDimensions.x,r._boundingDimensions.y,0)]},i.utilityLayerScene)),n.push((0,v.nL)("lines",{points:[new s.P(r._boundingDimensions.x,0,0),new s.P(r._boundingDimensions.x,0,r._boundingDimensions.z)]},i.utilityLayerScene)),n.push((0,v.nL)("lines",{points:[new s.P(0,r._boundingDimensions.y,0),new s.P(r._boundingDimensions.x,r._boundingDimensions.y,0)]},i.utilityLayerScene)),n.push((0,v.nL)("lines",{points:[new s.P(0,r._boundingDimensions.y,0),new s.P(0,r._boundingDimensions.y,r._boundingDimensions.z)]},i.utilityLayerScene)),n.push((0,v.nL)("lines",{points:[new s.P(0,0,r._boundingDimensions.z),new s.P(r._boundingDimensions.x,0,r._boundingDimensions.z)]},i.utilityLayerScene)),n.push((0,v.nL)("lines",{points:[new s.P(0,0,r._boundingDimensions.z),new s.P(0,r._boundingDimensions.y,r._boundingDimensions.z)]},i.utilityLayerScene)),n.push((0,v.nL)("lines",{points:[new s.P(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new s.P(0,r._boundingDimensions.y,r._boundingDimensions.z)]},i.utilityLayerScene)),n.push((0,v.nL)("lines",{points:[new s.P(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new s.P(r._boundingDimensions.x,0,r._boundingDimensions.z)]},i.utilityLayerScene)),n.push((0,v.nL)("lines",{points:[new s.P(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new s.P(r._boundingDimensions.x,r._boundingDimensions.y,0)]},i.utilityLayerScene)),n.forEach((function(e){e.color=t,e.position.addInPlace(new s.P(-r._boundingDimensions.x/2,-r._boundingDimensions.y/2,-r._boundingDimensions.z/2)),e.isPickable=!1,r._lineBoundingBox.addChild(e)})),r._rootMesh.addChild(r._lineBoundingBox),r.setColor(t),r._rotateSpheresParent=new b.x("",i.utilityLayerScene),r._rotateSpheresParent.rotationQuaternion=new s._f;for(var a=function(e){var t=(0,m.Qk)("",{diameter:1},i.utilityLayerScene);t.rotationQuaternion=new s._f,t.material=l._coloredMaterial,t.isNearGrabbable=!0;var n=new c.M({});n.moveAttached=!1,n.updateDragPlane=!1,t.addBehavior(n);var o=new s.P(1,0,0),a=0;n.onDragStartObservable.add((function(){o.copyFrom(t.forward),a=0})),n.onDragObservable.add((function(t){if(r.onRotationSphereDragObservable.notifyObservers({}),r.attachedMesh){var i=r.attachedMesh.parent;if(i&&i.scaling&&i.scaling.isNonUniformWithinEpsilon(.001))return void g.Y.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");y.m._RemoveAndStorePivotPoint(r.attachedMesh);var n=o,h=t.dragPlaneNormal.scale(s.P.Dot(t.dragPlaneNormal,n)),l=n.subtract(h).normalizeToNew(),d=s.P.Dot(l,t.delta)<0?Math.abs(t.delta.length()):-Math.abs(t.delta.length());d=d/r._boundingDimensions.length()*r._anchorMesh.scaling.length(),r.attachedMesh.rotationQuaternion||(r.attachedMesh.rotationQuaternion=s._f.RotationYawPitchRoll(r.attachedMesh.rotation.y,r.attachedMesh.rotation.x,r.attachedMesh.rotation.z)),r._anchorMesh.rotationQuaternion||(r._anchorMesh.rotationQuaternion=s._f.RotationYawPitchRoll(r._anchorMesh.rotation.y,r._anchorMesh.rotation.x,r._anchorMesh.rotation.z)),a+=d,Math.abs(a)<=2*Math.PI&&(e>=8?s._f.RotationYawPitchRollToRef(0,0,d,r._tmpQuaternion):e>=4?s._f.RotationYawPitchRollToRef(d,0,0,r._tmpQuaternion):s._f.RotationYawPitchRollToRef(0,d,0,r._tmpQuaternion),r._anchorMesh.addChild(r.attachedMesh,u.t.PreserveScaling),r._anchorMesh.getScene().useRightHandedSystem&&r._tmpQuaternion.conjugateInPlace(),r._anchorMesh.rotationQuaternion.multiplyToRef(r._tmpQuaternion,r._anchorMesh.rotationQuaternion),r._anchorMesh.removeChild(r.attachedMesh,u.t.PreserveScaling),r.attachedMesh.setParent(i,u.t.PreserveScaling)),r.updateBoundingBox(),y.m._RestorePivotPoint(r.attachedMesh)}r._updateDummy()})),n.onDragStartObservable.add((function(){r.onDragStartObservable.notifyObservers({}),r._selectNode(t)})),n.onDragEndObservable.add((function(){r.onRotationSphereDragEndObservable.notifyObservers({}),r._selectNode(null),r._updateDummy()})),l._rotateSpheresParent.addChild(t)},l=this,f=0;f<12;f++)a(f);r._rootMesh.addChild(r._rotateSpheresParent),r._scaleBoxesParent=new b.x("",i.utilityLayerScene),r._scaleBoxesParent.rotationQuaternion=new s._f;for(f=0;f<3;f++)for(var M=0;M<3;M++)for(var P=function(e){var t=(1===f?1:0)+(1===M?1:0)+(1===e?1:0);if(1===t||3===t)return"continue";var n=(0,h.NR)("",{size:1},i.utilityLayerScene);n.material=O._coloredMaterial,n.metadata=2===t,n.isNearGrabbable=!0;var o=new s.P(f-1,M-1,e-1).normalize(),a=new c.M({dragAxis:o});a.updateDragPlane=!1,a.moveAttached=!1,n.addBehavior(a),a.onDragObservable.add((function(e){if(r.onScaleBoxDragObservable.notifyObservers({}),r.attachedMesh){var i=r.attachedMesh.parent;if(i&&i.scaling&&i.scaling.isNonUniformWithinEpsilon(.001))return void g.Y.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");y.m._RemoveAndStorePivotPoint(r.attachedMesh);var a=e.dragDistance/r._boundingDimensions.length()*r._anchorMesh.scaling.length(),h=new s.P(a,a,a);2===t&&(h.x*=Math.abs(o.x),h.y*=Math.abs(o.y),h.z*=Math.abs(o.z)),h.scaleInPlace(r._scaleDragSpeed),h.multiplyInPlace(r._axisFactor),r.updateBoundingBox(),r.scalePivot?(r.attachedMesh.getWorldMatrix().getRotationMatrixToRef(r._tmpRotationMatrix),r._boundingDimensions.scaleToRef(.5,r._tmpVector),s.P.TransformCoordinatesToRef(r._tmpVector,r._tmpRotationMatrix,r._tmpVector),r._anchorMesh.position.subtractInPlace(r._tmpVector),r._boundingDimensions.multiplyToRef(r.scalePivot,r._tmpVector),s.P.TransformCoordinatesToRef(r._tmpVector,r._tmpRotationMatrix,r._tmpVector),r._anchorMesh.position.addInPlace(r._tmpVector)):(n.absolutePosition.subtractToRef(r._anchorMesh.position,r._tmpVector),r._anchorMesh.position.subtractInPlace(r._tmpVector)),r._anchorMesh.addChild(r.attachedMesh,u.t.PreserveScaling),r._anchorMesh.scaling.addInPlace(h),(r._anchorMesh.scaling.x<0||r._anchorMesh.scaling.y<0||r._anchorMesh.scaling.z<0)&&r._anchorMesh.scaling.subtractInPlace(h),r._anchorMesh.removeChild(r.attachedMesh,u.t.PreserveScaling),r.attachedMesh.setParent(i,u.t.PreserveScaling),y.m._RestorePivotPoint(r.attachedMesh)}r._updateDummy()})),a.onDragStartObservable.add((function(){r.onDragStartObservable.notifyObservers({}),r._selectNode(n)})),a.onDragEndObservable.add((function(){r.onScaleBoxDragEndObservable.notifyObservers({}),r._selectNode(null),r._updateDummy()})),O._scaleBoxesParent.addChild(n)},O=this,x=0;x<3;x++)P(x);r._rootMesh.addChild(r._scaleBoxesParent);var T=new Array;return r._pointerObserver=i.utilityLayerScene.onPointerObservable.add((function(e){T[e.event.pointerId]?e.pickInfo&&e.pickInfo.pickedMesh!=T[e.event.pointerId]&&(T[e.event.pointerId].material=r._coloredMaterial,delete T[e.event.pointerId]):r._rotateSpheresParent.getChildMeshes().concat(r._scaleBoxesParent.getChildMeshes()).forEach((function(t){e.pickInfo&&e.pickInfo.pickedMesh==t&&(T[e.event.pointerId]=t,t.material=r._hoverColoredMaterial)}))})),r._renderObserver=r.gizmoLayer.originalScene.onBeforeRenderObservable.add((function(){r.attachedMesh&&!r._existingMeshScale.equals(r.attachedMesh.scaling)?r.updateBoundingBox():(r.fixedDragMeshScreenSize||r.fixedDragMeshBoundsSize)&&(r._updateRotationSpheres(),r._updateScaleBoxes()),r._dragMesh&&r.attachedMesh&&r._pointerDragBehavior.dragging&&(r._lineBoundingBox.position.rotateByQuaternionToRef(r._rootMesh.rotationQuaternion,r._tmpVector),r.attachedMesh.setAbsolutePosition(r._dragMesh.position.add(r._tmpVector.scale(-1))))})),r.updateBoundingBox(),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"axisFactor",{get:function(){return this._axisFactor},set:function(e){this._axisFactor=e;for(var t=this._scaleBoxesParent.getChildMeshes(),i=0,r=0;r<3;r++)for(var n=0;n<3;n++)for(var o=0;o<3;o++){var a=(1===r?1:0)+(1===n?1:0)+(1===o?1:0);if(1!==a&&3!==a){if(t[i]){var h=new s.P(r-1,n-1,o-1);h.multiplyInPlace(this._axisFactor),t[i].setEnabled(h.lengthSquared()>M.kn)}i++}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleDragSpeed",{get:function(){return this._scaleDragSpeed},set:function(e){this._scaleDragSpeed=e},enumerable:!1,configurable:!0}),t.prototype.setColor=function(e){this._coloredMaterial.emissiveColor=e,this._hoverColoredMaterial.emissiveColor=e.clone().add(new _.Wo(.3,.3,.3)),this._lineBoundingBox.getChildren().forEach((function(t){t.color&&(t.color=e)}))},t.prototype._attachedNodeChanged=function(e){var t=this;if(e){this._anchorMesh.scaling.setAll(1),y.m._RemoveAndStorePivotPoint(e);var i=e.parent;this._anchorMesh.addChild(e,u.t.PreserveScaling),this._anchorMesh.removeChild(e,u.t.PreserveScaling),e.setParent(i,u.t.PreserveScaling),y.m._RestorePivotPoint(e),this.updateBoundingBox(),e.getChildMeshes(!1).forEach((function(e){e.markAsDirty("scaling")})),this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce((function(){t._updateDummy()}))}this.attachedMesh||g.Y.Warn("Using the attachedNode attribute in BoundingBoxGizmo is not supported. Please use attachedMesh instead.")},t.prototype._selectNode=function(e){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach((function(t){t.isVisible=!e||t==e}))},t.prototype.updateBoundingBox=function(){if(this.attachedMesh){y.m._RemoveAndStorePivotPoint(this.attachedMesh);var e=this.attachedMesh.parent;this.attachedMesh.setParent(null,u.t.PreserveScaling),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=s._f.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=s._f.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var t=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);t.max.subtractToRef(t.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((t.max.x+t.min.x)/2,(t.max.y+t.min.y)/2,(t.max.z+t.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),this.attachedMesh.setParent(e,u.t.PreserveScaling)}this._updateRotationSpheres(),this._updateScaleBoxes(),this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),y.m._RestorePivotPoint(this.attachedMesh))},t.prototype._updateRotationSpheres=function(){for(var e=this._rotateSpheresParent.getChildMeshes(),t=0;t<3;t++)for(var i=0;i<2;i++)for(var r=0;r<2;r++){var n=4*t+2*i+r;if(0==t&&(e[n].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*i,this._boundingDimensions.z*r),e[n].position.addInPlace(new s.P(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[n].lookAt(s.P.Cross(e[n].position.normalizeToNew(),s.P.Right()).normalizeToNew().add(e[n].position))),1==t&&(e[n].position.set(this._boundingDimensions.x*i,this._boundingDimensions.y/2,this._boundingDimensions.z*r),e[n].position.addInPlace(new s.P(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[n].lookAt(s.P.Cross(e[n].position.normalizeToNew(),s.P.Up()).normalizeToNew().add(e[n].position))),2==t&&(e[n].position.set(this._boundingDimensions.x*i,this._boundingDimensions.y*r,this._boundingDimensions.z/2),e[n].position.addInPlace(new s.P(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[n].lookAt(s.P.Cross(e[n].position.normalizeToNew(),s.P.Forward()).normalizeToNew().add(e[n].position))),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[n].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var o=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[n].scaling.set(o,o,o)}else this.fixedDragMeshBoundsSize?e[n].scaling.set(this.rotationSphereSize*this._boundingDimensions.x,this.rotationSphereSize*this._boundingDimensions.y,this.rotationSphereSize*this._boundingDimensions.z):e[n].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}},t.prototype._updateScaleBoxes=function(){for(var e=this._scaleBoxesParent.getChildMeshes(),t=0,i=0;i<3;i++)for(var r=0;r<3;r++)for(var n=0;n<3;n++){var o=(1===i?1:0)+(1===r?1:0)+(1===n?1:0);if(1!==o&&3!==o){if(e[t])if(e[t].position.set(this._boundingDimensions.x*(i/2),this._boundingDimensions.y*(r/2),this._boundingDimensions.z*(n/2)),e[t].position.addInPlace(new s.P(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[t].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var a=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[t].scaling.set(a,a,a)}else this.fixedDragMeshBoundsSize?e[t].scaling.set(this.scaleBoxSize*this._boundingDimensions.x,this.scaleBoxSize*this._boundingDimensions.y,this.scaleBoxSize*this._boundingDimensions.z):e[t].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize);t++}}},t.prototype.setEnabledRotationAxis=function(e){this._rotateSpheresParent.getChildMeshes().forEach((function(t,i){i<4?t.setEnabled(-1!=e.indexOf("x")):i<8?t.setEnabled(-1!=e.indexOf("y")):t.setEnabled(-1!=e.indexOf("z"))}))},t.prototype.setEnabledScaling=function(e,t){void 0===t&&(t=!1),this._scaleBoxesParent.getChildMeshes().forEach((function(i){var r=e;t&&!0===i.metadata&&(r=!1),i.setEnabled(r)}))},t.prototype._updateDummy=function(){this._dragMesh&&(this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition()),this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling),this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion))},t.prototype.enableDragBehavior=function(){this._dragMesh=(0,h.NR)("dummy",{size:1},this.gizmoLayer.utilityLayerScene),this._dragMesh.visibility=0,this._dragMesh.rotationQuaternion=new s._f,this._pointerDragBehavior.useObjectOrientationForDragging=!1,this._dragMesh.addBehavior(this._pointerDragBehavior)},t.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),this._dragMesh&&this._dragMesh.dispose(),e.prototype.dispose.call(this)},t.MakeNotPickableAndWrapInBoundingBox=function(e){var t=function(e){e.isPickable=!1,e.getChildMeshes().forEach((function(e){t(e)}))};t(e),e.rotationQuaternion||(e.rotationQuaternion=s._f.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z));var i=e.position.clone(),r=e.rotationQuaternion.clone();e.rotationQuaternion.set(0,0,0,1),e.position.set(0,0,0);var n=(0,h.NR)("box",{size:1},e.getScene()),o=e.getHierarchyBoundingVectors();return o.max.subtractToRef(o.min,n.scaling),0===n.scaling.y&&(n.scaling.y=M.kn),0===n.scaling.x&&(n.scaling.x=M.kn),0===n.scaling.z&&(n.scaling.z=M.kn),n.position.set((o.max.x+o.min.x)/2,(o.max.y+o.min.y)/2,(o.max.z+o.min.z)/2),e.addChild(n),e.rotationQuaternion.copyFrom(r),e.position.copyFrom(i),e.removeChild(n),n.addChild(e),n.visibility=0,n},t.prototype.setCustomMesh=function(){g.Y.Error("Custom meshes are not supported on this gizmo")},t}(u.t),O=i(76324),x=i(52597),T=i(54067),S=i(9256),C=i(46719),w=i(49353),R=function(e){function t(i,r,n,h,l,f,g){void 0===r&&(r=_.Wo.Gray()),void 0===n&&(n=p.x.DefaultUtilityLayer),void 0===h&&(h=32),void 0===l&&(l=null),void 0===f&&(f=!1),void 0===g&&(g=1);var b,m=this;(m=e.call(this,n)||this)._pointerObserver=null,m.snapDistance=0,m.onSnapObservable=new o.y$,m.angle=0,m._isEnabled=!0,m._parent=null,m._dragging=!1,m._angles=new s.P,m._parent=l,m._coloredMaterial=new d.K("",n.utilityLayerScene),m._coloredMaterial.diffuseColor=r,m._coloredMaterial.specularColor=r.subtract(new _.Wo(.1,.1,.1)),m._hoverMaterial=new d.K("",n.utilityLayerScene),m._hoverMaterial.diffuseColor=_.Wo.Yellow(),m._disableMaterial=new d.K("",n.utilityLayerScene),m._disableMaterial.diffuseColor=_.Wo.Gray(),m._disableMaterial.alpha=.4,m._gizmoMesh=new a.Kj("",n.utilityLayerScene);var v=m._createGizmoMesh(m._gizmoMesh,g,h),y=v.rotationMesh,M=v.collider;m._rotationDisplayPlane=(0,C.pT)("rotationDisplay",{size:.6,updatable:!1},m.gizmoLayer.utilityLayerScene),m._rotationDisplayPlane.rotation.z=.5*Math.PI,m._rotationDisplayPlane.parent=m._gizmoMesh,m._rotationDisplayPlane.setEnabled(!1),S.Q.ShadersStore.rotationGizmoVertexShader=t._RotationGizmoVertexShader,S.Q.ShadersStore.rotationGizmoFragmentShader=t._RotationGizmoFragmentShader,m._rotationShaderMaterial=new T.j("shader",m.gizmoLayer.utilityLayerScene,{vertex:"rotationGizmo",fragment:"rotationGizmo"},{attributes:["position","uv"],uniforms:["worldViewProjection","angles"]}),m._rotationShaderMaterial.backFaceCulling=!1,m._rotationDisplayPlane.material=m._rotationShaderMaterial,m._rotationDisplayPlane.visibility=.999,m._gizmoMesh.lookAt(m._rootMesh.position.add(i)),m._rootMesh.addChild(m._gizmoMesh,u.t.PreserveScaling),m._gizmoMesh.scaling.scaleInPlace(1/3),m.dragBehavior=new c.M({dragPlaneNormal:i}),m.dragBehavior.moveAttached=!1,m.dragBehavior.maxDragAngle=t.MaxDragAngle,m.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,m._rootMesh.addBehavior(m.dragBehavior);var P=new s.P,O=new s.y3,x=new s.P,w=new s.P;m.dragBehavior.onDragStartObservable.add((function(e){m.attachedNode&&(P.copyFrom(e.dragPlanePoint),m._rotationDisplayPlane.setEnabled(!0),m._rotationDisplayPlane.getWorldMatrix().invertToRef(O),s.P.TransformCoordinatesToRef(e.dragPlanePoint,O,P),m._angles.x=Math.atan2(P.y,P.x)+Math.PI,m._angles.y=0,m._angles.z=m.updateGizmoRotationToMatchAttachedMesh?1:0,m._dragging=!0,P.copyFrom(e.dragPlanePoint),m._rotationShaderMaterial.setVector3("angles",m._angles),m.angle=0)})),m.dragBehavior.onDragEndObservable.add((function(){m._dragging=!1,m._rotationDisplayPlane.setEnabled(!1)}));var R={snapDistance:0},E=0,D=new s.y3,z=new s._f;m.dragBehavior.onDragObservable.add((function(e){if(m.attachedNode){var t=new s.P(1,1,1),r=new s._f(0,0,0,1),o=new s.P(0,0,0);m._handlePivot(),m.attachedNode.getWorldMatrix().decompose(t,r,o);var a=e.dragPlanePoint.subtract(o).normalize(),h=P.subtract(o).normalize(),l=s.P.Cross(a,h),d=s.P.Dot(a,h),c=Math.atan2(l.length(),d);x.copyFrom(i),w.copyFrom(i),m.updateGizmoRotationToMatchAttachedMesh&&(r.toRotationMatrix(O),w=s.P.TransformCoordinates(x,O));var u=!1;if(n.utilityLayerScene.activeCamera){var p=n.utilityLayerScene.activeCamera.position.subtract(o).normalize();s.P.Dot(p,w)>0&&(x.scaleInPlace(-1),w.scaleInPlace(-1),u=!0)}s.P.Dot(w,l)>0&&(c=-c);var _=!1;if(0!=m.snapDistance)if(E+=c,Math.abs(E)>m.snapDistance){var f=Math.floor(Math.abs(E)/m.snapDistance);E<0&&(f*=-1),E%=m.snapDistance,c=m.snapDistance*f,_=!0}else c=0;var g=Math.sin(c/2);if(z.set(x.x*g,x.y*g,x.z*g,Math.cos(c/2)),D.determinant()>0){var b=new s.P;z.toEulerAnglesToRef(b),s._f.RotationYawPitchRollToRef(b.y,-b.x,-b.z,z)}m.updateGizmoRotationToMatchAttachedMesh?r.multiplyToRef(z,r):z.multiplyToRef(r,r),m.attachedNode.getWorldMatrix().copyFrom(s.y3.Compose(t,r,o)),P.copyFrom(e.dragPlanePoint),_&&(R.snapDistance=c,m.onSnapObservable.notifyObservers(R)),m._angles.y+=c,m.angle+=u?-c:c,m._rotationShaderMaterial.setVector3("angles",m._angles),m._matrixChanged()}}));var B=n._getSharedGizmoLight();B.includedOnlyMeshes=B.includedOnlyMeshes.concat(m._rootMesh.getChildMeshes(!1));var A={colliderMeshes:[M],gizmoMeshes:[y],material:m._coloredMaterial,hoverMaterial:m._hoverMaterial,disableMaterial:m._disableMaterial,active:!1,dragBehavior:m.dragBehavior};return null===(b=m._parent)||void 0===b||b.addToAxisCache(m._gizmoMesh,A),m._pointerObserver=n.utilityLayerScene.onPointerObservable.add((function(e){var i;if(!m._customMeshSet&&(m.dragBehavior.maxDragAngle=t.MaxDragAngle,m._isHovered=!(-1==A.colliderMeshes.indexOf(null===(i=null==e?void 0:e.pickInfo)||void 0===i?void 0:i.pickedMesh)),!m._parent)){var r=A.dragBehavior.enabled?m._isHovered||m._dragging?m._hoverMaterial:m._coloredMaterial:m._disableMaterial;m._setGizmoMeshMaterial(A.gizmoMeshes,r)}})),m.dragBehavior.onEnabledObservable.add((function(e){m._setGizmoMeshMaterial(A.gizmoMeshes,e?m._coloredMaterial:m._disableMaterial)})),m}return(0,n.ZT)(t,e),t.prototype._createGizmoMesh=function(e,t,i){var r=(0,w.eu)("ignore",{diameter:.6,thickness:.03*t,tessellation:i},this.gizmoLayer.utilityLayerScene);r.visibility=0;var n=(0,w.eu)("",{diameter:.6,thickness:.005*t,tessellation:i},this.gizmoLayer.utilityLayerScene);return n.material=this._coloredMaterial,n.rotation.x=Math.PI/2,r.rotation.x=Math.PI/2,e.addChild(n,u.t.PreserveScaling),e.addChild(r,u.t.PreserveScaling),{rotationMesh:n,collider:r}},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._gizmoMesh&&this._gizmoMesh.dispose(),this._rotationDisplayPlane&&this._rotationDisplayPlane.dispose(),this._rotationShaderMaterial&&this._rotationShaderMaterial.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach((function(e){e&&e.dispose()})),e.prototype.dispose.call(this)},t.MaxDragAngle=9*Math.PI/20,t._RotationGizmoVertexShader="\n        precision highp float;\n        attribute vec3 position;\n        attribute vec2 uv;\n        uniform mat4 worldViewProjection;\n        varying vec3 vPosition;\n        varying vec2 vUV;\n        void main(void) {\n            gl_Position = worldViewProjection * vec4(position, 1.0);\n            vUV = uv;\n        }",t._RotationGizmoFragmentShader="\n        precision highp float;\n        varying vec2 vUV;\n        varying vec3 vPosition;\n        uniform vec3 angles;\n        #define twopi 6.283185307\n        void main(void) {\n            vec2 uv = vUV - vec2(0.5);\n            float angle = atan(uv.y, uv.x) + 3.141592;\n            float delta = gl_FrontFacing ? angles.y : -angles.y;\n            float begin = angles.x - delta * angles.z;\n            float start = (begin < (begin + delta)) ? begin : (begin + delta);\n            float end = (begin > (begin + delta)) ? begin : (begin + delta);\n            float len = sqrt(dot(uv,uv));\n            float opacity = 1. - step(0.5, len);\n\n            float base = abs(floor(start / twopi)) * twopi;\n            start += base;\n            end += base;\n\n            float intensity = 0.;\n            for (int i = 0; i < 5; i++)\n            {\n                intensity += max(step(start, angle) - step(end, angle), 0.);\n                angle += twopi;\n            }\n            gl_FragColor = vec4(1.,1.,0., min(intensity * 0.25, 0.8)) * opacity;\n        }",t}(u.t),E=function(e){function t(t,i,r,n,a,h){void 0===t&&(t=p.x.DefaultUtilityLayer),void 0===i&&(i=32),void 0===r&&(r=!1),void 0===n&&(n=1);var l=e.call(this,t)||this;l.onDragStartObservable=new o.y$,l.onDragEndObservable=new o.y$,l._observables=[],l._gizmoAxisCache=new Map;var d=h&&h.xOptions&&h.xOptions.color?h.xOptions.color:_.Wo.Red().scale(.5),c=h&&h.yOptions&&h.yOptions.color?h.yOptions.color:_.Wo.Green().scale(.5),f=h&&h.zOptions&&h.zOptions.color?h.zOptions.color:_.Wo.Blue().scale(.5);return l.xGizmo=new R(new s.P(1,0,0),d,t,i,l,r,n),l.yGizmo=new R(new s.P(0,1,0),c,t,i,l,r,n),l.zGizmo=new R(new s.P(0,0,1),f,t,i,l,r,n),[l.xGizmo,l.yGizmo,l.zGizmo].forEach((function(e){h&&null!=h.updateScale&&(e.updateScale=h.updateScale),e.dragBehavior.onDragStartObservable.add((function(){l.onDragStartObservable.notifyObservers({})})),e.dragBehavior.onDragEndObservable.add((function(){l.onDragEndObservable.notifyObservers({})}))})),l.attachedMesh=null,l.attachedNode=null,a?a.addToAxisCache(l._gizmoAxisCache):u.t.GizmoAxisPointerObserver(t,l._gizmoAxisCache),l}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(e){this._meshAttached=e,this._nodeAttached=e,this._checkBillboardTransform(),[this.xGizmo,this.yGizmo,this.zGizmo].forEach((function(t){t.isEnabled?t.attachedMesh=e:t.attachedMesh=null}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(e){this._meshAttached=null,this._nodeAttached=e,this._checkBillboardTransform(),[this.xGizmo,this.yGizmo,this.zGizmo].forEach((function(t){t.isEnabled?t.attachedNode=e:t.attachedNode=null}))},enumerable:!1,configurable:!0}),t.prototype._checkBillboardTransform=function(){this._nodeAttached&&this._nodeAttached.billboardMode},Object.defineProperty(t.prototype,"isHovered",{get:function(){var e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo].forEach((function(t){e=e||t.isHovered})),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!1,configurable:!0}),t.prototype.addToAxisCache=function(e,t){this._gizmoAxisCache.set(e,t)},t.prototype.dispose=function(){var e=this;this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear(),this._observables.forEach((function(t){e.gizmoLayer.utilityLayerScene.onPointerObservable.remove(t)}))},t.prototype.setCustomMesh=function(){g.Y.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},t}(u.t),D=i(30700),z=function(e){function t(i,r,n,a){void 0===r&&(r=_.Wo.Gray()),void 0===n&&(n=p.x.DefaultUtilityLayer),void 0===a&&(a=null);var h,l=this;(l=e.call(this,n)||this)._pointerObserver=null,l.snapDistance=0,l.onSnapObservable=new o.y$,l._isEnabled=!1,l._parent=null,l._dragging=!1,l._parent=a,l._coloredMaterial=new d.K("",n.utilityLayerScene),l._coloredMaterial.diffuseColor=r,l._coloredMaterial.specularColor=r.subtract(new _.Wo(.1,.1,.1)),l._hoverMaterial=new d.K("",n.utilityLayerScene),l._hoverMaterial.diffuseColor=_.Wo.Yellow(),l._disableMaterial=new d.K("",n.utilityLayerScene),l._disableMaterial.diffuseColor=_.Wo.Gray(),l._disableMaterial.alpha=.4,l._gizmoMesh=t._CreatePlane(n.utilityLayerScene,l._coloredMaterial),l._gizmoMesh.lookAt(l._rootMesh.position.add(i)),l._gizmoMesh.scaling.scaleInPlace(1/3),l._gizmoMesh.parent=l._rootMesh;var u=0,f=new s.P,g={snapDistance:0};l.dragBehavior=new c.M({dragPlaneNormal:i}),l.dragBehavior.moveAttached=!1,l._rootMesh.addBehavior(l.dragBehavior),l.dragBehavior.onDragObservable.add((function(e){if(l.attachedNode){if(l._handlePivot(),0==l.snapDistance)l.attachedNode.getWorldMatrix().addTranslationFromFloats(e.delta.x,e.delta.y,e.delta.z);else if(u+=e.dragDistance,Math.abs(u)>l.snapDistance){var t=Math.floor(Math.abs(u)/l.snapDistance);u%=l.snapDistance,e.delta.normalizeToRef(f),f.scaleInPlace(l.snapDistance*t),l.attachedNode.getWorldMatrix().addTranslationFromFloats(f.x,f.y,f.z),g.snapDistance=l.snapDistance*t,l.onSnapObservable.notifyObservers(g)}l._matrixChanged()}})),l.dragBehavior.onDragStartObservable.add((function(){l._dragging=!0})),l.dragBehavior.onDragEndObservable.add((function(){l._dragging=!1}));var b=n._getSharedGizmoLight();b.includedOnlyMeshes=b.includedOnlyMeshes.concat(l._rootMesh.getChildMeshes(!1));var m={gizmoMeshes:l._gizmoMesh.getChildMeshes(),colliderMeshes:l._gizmoMesh.getChildMeshes(),material:l._coloredMaterial,hoverMaterial:l._hoverMaterial,disableMaterial:l._disableMaterial,active:!1,dragBehavior:l.dragBehavior};return null===(h=l._parent)||void 0===h||h.addToAxisCache(l._gizmoMesh,m),l._pointerObserver=n.utilityLayerScene.onPointerObservable.add((function(e){var t;if(!l._customMeshSet&&(l._isHovered=!(-1==m.colliderMeshes.indexOf(null===(t=null==e?void 0:e.pickInfo)||void 0===t?void 0:t.pickedMesh)),!l._parent)){var i=m.dragBehavior.enabled?l._isHovered||l._dragging?l._hoverMaterial:l._coloredMaterial:l._disableMaterial;l._setGizmoMeshMaterial(m.gizmoMeshes,i)}})),l.dragBehavior.onEnabledObservable.add((function(e){l._setGizmoMeshMaterial(m.gizmoMeshes,e?l._coloredMaterial:l._disableMaterial)})),l}return(0,n.ZT)(t,e),t._CreatePlane=function(e,t){var i=new D.Y("plane",e),r=(0,C.pT)("dragPlane",{width:.1375,height:.1375,sideOrientation:2},e);return r.material=t,r.parent=i,i},t.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e,e?this._parent&&(this.attachedNode=this._parent.attachedNode):this.attachedNode=null},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this),this._gizmoMesh&&this._gizmoMesh.dispose(),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach((function(e){e&&e.dispose()}))},t}(u.t),B=function(e){function t(t,i,n){void 0===t&&(t=p.x.DefaultUtilityLayer),void 0===i&&(i=1);var a=e.call(this,t)||this;return a._meshAttached=null,a._nodeAttached=null,a._observables=[],a._gizmoAxisCache=new Map,a.onDragStartObservable=new o.y$,a.onDragEndObservable=new o.y$,a._planarGizmoEnabled=!1,a.xGizmo=new r.u(new s.P(1,0,0),_.Wo.Red().scale(.5),t,a,i),a.yGizmo=new r.u(new s.P(0,1,0),_.Wo.Green().scale(.5),t,a,i),a.zGizmo=new r.u(new s.P(0,0,1),_.Wo.Blue().scale(.5),t,a,i),a.xPlaneGizmo=new z(new s.P(1,0,0),_.Wo.Red().scale(.5),a.gizmoLayer,a),a.yPlaneGizmo=new z(new s.P(0,1,0),_.Wo.Green().scale(.5),a.gizmoLayer,a),a.zPlaneGizmo=new z(new s.P(0,0,1),_.Wo.Blue().scale(.5),a.gizmoLayer,a),[a.xGizmo,a.yGizmo,a.zGizmo,a.xPlaneGizmo,a.yPlaneGizmo,a.zPlaneGizmo].forEach((function(e){e.dragBehavior.onDragStartObservable.add((function(){a.onDragStartObservable.notifyObservers({})})),e.dragBehavior.onDragEndObservable.add((function(){a.onDragEndObservable.notifyObservers({})}))})),a.attachedMesh=null,n?n.addToAxisCache(a._gizmoAxisCache):u.t.GizmoAxisPointerObserver(t,a._gizmoAxisCache),a}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(e){this._meshAttached=e,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(t){t.isEnabled?t.attachedMesh=e:t.attachedMesh=null}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(e){this._meshAttached=null,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(t){t.isEnabled?t.attachedNode=e:t.attachedNode=null}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHovered",{get:function(){var e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(t){e=e||t.isHovered})),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"planarGizmoEnabled",{get:function(){return this._planarGizmoEnabled},set:function(e){var t=this;this._planarGizmoEnabled=e,[this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(i){i&&(i.isEnabled=e,e&&(i.attachedMesh?i.attachedMesh=t.attachedMesh:i.attachedNode=t.attachedNode))}),this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(e){this._updateGizmoRotationToMatchAttachedMesh=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(t){t&&(t.updateGizmoRotationToMatchAttachedMesh=e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(e){this._snapDistance=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(t){t&&(t.snapDistance=e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(e){this._scaleRatio=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(t){t&&(t.scaleRatio=e)}))},enumerable:!1,configurable:!0}),t.prototype.addToAxisCache=function(e,t){this._gizmoAxisCache.set(e,t)},t.prototype.dispose=function(){var e=this;[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach((function(e){e&&e.dispose()})),this._observables.forEach((function(t){e.gizmoLayer.utilityLayerScene.onPointerObservable.remove(t)})),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t.prototype.setCustomMesh=function(){g.Y.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo,gizmo.xPlaneGizmo, gizmo.yPlaneGizmo, gizmo.zPlaneGizmo)")},t}(u.t),A=i(57891),L=function(e){function t(t,i,r){void 0===t&&(t=p.x.DefaultUtilityLayer),void 0===i&&(i=1);var n=e.call(this,t)||this;return n._meshAttached=null,n._nodeAttached=null,n._sensitivity=1,n._observables=[],n._gizmoAxisCache=new Map,n.onDragStartObservable=new o.y$,n.onDragEndObservable=new o.y$,n.uniformScaleGizmo=n._createUniformScaleMesh(),n.xGizmo=new f(new s.P(1,0,0),_.Wo.Red().scale(.5),t,n,i),n.yGizmo=new f(new s.P(0,1,0),_.Wo.Green().scale(.5),t,n,i),n.zGizmo=new f(new s.P(0,0,1),_.Wo.Blue().scale(.5),t,n,i),[n.xGizmo,n.yGizmo,n.zGizmo,n.uniformScaleGizmo].forEach((function(e){e.dragBehavior.onDragStartObservable.add((function(){n.onDragStartObservable.notifyObservers({})})),e.dragBehavior.onDragEndObservable.add((function(){n.onDragEndObservable.notifyObservers({})}))})),n.attachedMesh=null,n.attachedNode=null,r?r.addToAxisCache(n._gizmoAxisCache):u.t.GizmoAxisPointerObserver(t,n._gizmoAxisCache),n}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(e){this._meshAttached=e,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(t){t.isEnabled?t.attachedMesh=e:t.attachedMesh=null}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(e){this._meshAttached=null,this._nodeAttached=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(t){t.isEnabled?t.attachedNode=e:t.attachedNode=null}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHovered",{get:function(){var e=!1;return[this.xGizmo,this.yGizmo,this.zGizmo].forEach((function(t){e=e||t.isHovered})),e},enumerable:!1,configurable:!0}),t.prototype._createUniformScaleMesh=function(){this._coloredMaterial=new d.K("",this.gizmoLayer.utilityLayerScene),this._coloredMaterial.diffuseColor=_.Wo.Gray(),this._hoverMaterial=new d.K("",this.gizmoLayer.utilityLayerScene),this._hoverMaterial.diffuseColor=_.Wo.Yellow(),this._disableMaterial=new d.K("",this.gizmoLayer.utilityLayerScene),this._disableMaterial.diffuseColor=_.Wo.Gray(),this._disableMaterial.alpha=.4;var e=new f(new s.P(0,1,0),_.Wo.Gray().scale(.5),this.gizmoLayer,this);e.updateGizmoRotationToMatchAttachedMesh=!1,e.uniformScaling=!0,this._uniformScalingMesh=(0,A.sh)("uniform",{type:1},e.gizmoLayer.utilityLayerScene),this._uniformScalingMesh.scaling.scaleInPlace(.01),this._uniformScalingMesh.visibility=0,this._octahedron=(0,A.sh)("",{type:1},e.gizmoLayer.utilityLayerScene),this._octahedron.scaling.scaleInPlace(.007),this._uniformScalingMesh.addChild(this._octahedron),e.setCustomMesh(this._uniformScalingMesh,!0);var t=this.gizmoLayer._getSharedGizmoLight();t.includedOnlyMeshes=t.includedOnlyMeshes.concat(this._octahedron);var i={gizmoMeshes:[this._octahedron,this._uniformScalingMesh],colliderMeshes:[this._uniformScalingMesh],material:this._coloredMaterial,hoverMaterial:this._hoverMaterial,disableMaterial:this._disableMaterial,active:!1,dragBehavior:e.dragBehavior};return this.addToAxisCache(e._rootMesh,i),e},Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(e){e?(this._updateGizmoRotationToMatchAttachedMesh=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(t){t&&(t.updateGizmoRotationToMatchAttachedMesh=e)}))):g.Y.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported.")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(e){this._snapDistance=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(t){t&&(t.snapDistance=e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(e){this._scaleRatio=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(t){t&&(t.scaleRatio=e)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sensitivity",{get:function(){return this._sensitivity},set:function(e){this._sensitivity=e,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(t){t&&(t.sensitivity=e)}))},enumerable:!1,configurable:!0}),t.prototype.addToAxisCache=function(e,t){this._gizmoAxisCache.set(e,t)},t.prototype.dispose=function(){var e=this;[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach((function(e){e&&e.dispose()})),this._observables.forEach((function(t){e.gizmoLayer.utilityLayerScene.onPointerObservable.remove(t)})),this.onDragStartObservable.clear(),this.onDragEndObservable.clear(),[this._uniformScalingMesh,this._octahedron].forEach((function(e){e&&e.dispose()})),[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach((function(e){e&&e.dispose()}))},t}(u.t),k=function(){function e(e,t,i,r){void 0===t&&(t=1),void 0===i&&(i=p.x.DefaultUtilityLayer),void 0===r&&(r=p.x.DefaultKeepDepthUtilityLayer),this._scene=e,this.clearGizmoOnEmptyPointerEvent=!1,this.enableAutoPicking=!0,this.onAttachedToMeshObservable=new o.y$,this.onAttachedToNodeObservable=new o.y$,this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObservers=[],this._attachedMesh=null,this._attachedNode=null,this._boundingBoxColor=_.Wo.FromHexString("#0984e3"),this._thickness=1,this._scaleRatio=1,this._gizmoAxisCache=new Map,this.boundingBoxDragBehavior=new x.K,this.attachableMeshes=null,this.attachableNodes=null,this.usePointerToAttachGizmos=!0,this._defaultUtilityLayer=i,this._defaultKeepDepthUtilityLayer=r,this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._thickness=t,this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null};var n=this._attachToMeshPointerObserver(e),s=u.t.GizmoAxisPointerObserver(this._defaultUtilityLayer,this._gizmoAxisCache);this._pointerObservers=[n,s]}return Object.defineProperty(e.prototype,"keepDepthUtilityLayer",{get:function(){return this._defaultKeepDepthUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"utilityLayer",{get:function(){return this._defaultUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHovered",{get:function(){var e=!1;for(var t in this.gizmos){var i=this.gizmos[t];if(i&&i.isHovered){e=!0;break}}return e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(e){this._scaleRatio=e,[this.gizmos.positionGizmo,this.gizmos.rotationGizmo,this.gizmos.scaleGizmo].forEach((function(t){t&&(t.scaleRatio=e)}))},enumerable:!1,configurable:!0}),e.prototype._attachToMeshPointerObserver=function(e){var t=this;return e.onPointerObservable.add((function(e){if(t.usePointerToAttachGizmos&&e.type==O.kD.POINTERDOWN)if(e.pickInfo&&e.pickInfo.pickedMesh){if(t.enableAutoPicking){var i=e.pickInfo.pickedMesh;if(null==t.attachableMeshes)for(;i&&null!=i.parent;)i=i.parent;else{var r=!1;t.attachableMeshes.forEach((function(e){i&&(i==e||i.isDescendantOf(e))&&(i=e,r=!0)})),r||(i=null)}i instanceof b.x?t._attachedMesh!=i&&t.attachToMesh(i):t.clearGizmoOnEmptyPointerEvent&&t.attachToMesh(null)}}else t.clearGizmoOnEmptyPointerEvent&&t.attachToMesh(null)}))},e.prototype.attachToMesh=function(e){for(var t in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=e,this._attachedNode=null,this.gizmos){var i=this.gizmos[t];i&&this._gizmosEnabled[t]&&(i.attachedMesh=e)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToMeshObservable.notifyObservers(e)},e.prototype.attachToNode=function(e){for(var t in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=null,this._attachedNode=e,this.gizmos){var i=this.gizmos[t];i&&this._gizmosEnabled[t]&&(i.attachedNode=e)}this.boundingBoxGizmoEnabled&&this._attachedNode&&this._attachedNode.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToNodeObservable.notifyObservers(e)},Object.defineProperty(e.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(e){e?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new B(this._defaultUtilityLayer,this._thickness,this)),this._attachedNode?this.gizmos.positionGizmo.attachedNode=this._attachedNode:this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedNode=null),this._gizmosEnabled.positionGizmo=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(e){e?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new E(this._defaultUtilityLayer,32,!1,this._thickness,this)),this._attachedNode?this.gizmos.rotationGizmo.attachedNode=this._attachedNode:this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedNode=null),this._gizmosEnabled.rotationGizmo=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(e){e?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new L(this._defaultUtilityLayer,this._thickness,this),this._attachedNode?this.gizmos.scaleGizmo.attachedNode=this._attachedNode:this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedNode=null),this._gizmosEnabled.scaleGizmo=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(e){e?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new P(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this._attachedMesh?this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh:this.gizmos.boundingBoxGizmo.attachedNode=this._attachedNode,this._attachedMesh?(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior)):this._attachedNode&&(this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this._attachedMesh?this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior):this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this.gizmos.boundingBoxGizmo.attachedNode=null),this._gizmosEnabled.boundingBoxGizmo=e},enumerable:!1,configurable:!0}),e.prototype.addToAxisCache=function(e){var t=this;e.size>0&&e.forEach((function(e,i){t._gizmoAxisCache.set(i,e)}))},e.prototype.dispose=function(){var e,t,i=this;for(var r in this._pointerObservers.forEach((function(e){i._scene.onPointerObservable.remove(e)})),this.gizmos){var n=this.gizmos[r];n&&n.dispose()}this._defaultKeepDepthUtilityLayer!==p.x._DefaultKeepDepthUtilityLayer&&(null===(e=this._defaultKeepDepthUtilityLayer)||void 0===e||e.dispose()),this._defaultUtilityLayer!==p.x._DefaultUtilityLayer&&(null===(t=this._defaultUtilityLayer)||void 0===t||t.dispose()),this.boundingBoxDragBehavior.detach(),this.onAttachedToMeshObservable.clear()},e}(),G=i(51356),I=i(258),N=i(54557),F=i(96761),U=function(e){function t(t){void 0===t&&(t=p.x.DefaultUtilityLayer);var i=e.call(this,t)||this;return i._cachedPosition=new s.P,i._cachedForward=new s.P(0,0,1),i._pointerObserver=null,i.onClickedObservable=new o.y$,i._light=null,i.attachedMesh=new b.x("",i.gizmoLayer.utilityLayerScene),i._attachedMeshParent=new D.Y("parent",i.gizmoLayer.utilityLayerScene),i.attachedMesh.parent=i._attachedMeshParent,i._material=new d.K("light",i.gizmoLayer.utilityLayerScene),i._material.diffuseColor=new _.Wo(.5,.5,.5),i._material.specularColor=new _.Wo(.1,.1,.1),i._pointerObserver=t.utilityLayerScene.onPointerObservable.add((function(e){i._light&&(i._isHovered=!(!e.pickInfo||-1==i._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)),i._isHovered&&0===e.event.button&&i.onClickedObservable.notifyObservers(i._light))}),O.kD.POINTERDOWN),i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"attachedNode",{get:function(){return this.attachedMesh},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"light",{get:function(){return this._light},set:function(e){var i=this;if(this._light=e,e){this._lightMesh&&this._lightMesh.dispose(),e instanceof G.e?this._lightMesh=t._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene):e instanceof I.O?this._lightMesh=t._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene):e instanceof F.P?this._lightMesh=t._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene):this._lightMesh=t._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene),this._lightMesh.getChildMeshes(!1).forEach((function(e){e.material=i._material})),this._lightMesh.parent=this._rootMesh;var r=this.gizmoLayer._getSharedGizmoLight();r.includedOnlyMeshes=r.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(!1)),this._lightMesh.rotationQuaternion=new s._f,this.attachedMesh.reservedDataStore||(this.attachedMesh.reservedDataStore={}),this.attachedMesh.reservedDataStore.lightGizmo=this,e.parent&&this._attachedMeshParent.freezeWorldMatrix(e.parent.getWorldMatrix()),e.position&&(this.attachedMesh.position.copyFrom(e.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)),e.direction&&(this.attachedMesh.setDirection(e.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward)),this._update()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),t.prototype._update=function(){if(e.prototype._update.call(this),this._light){if(this._light.parent&&this._attachedMeshParent.freezeWorldMatrix(this._light.parent.getWorldMatrix()),this._light.position)if(this.attachedMesh.position.equals(this._cachedPosition))this.attachedMesh.position.copyFrom(this._light.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position);else{var t=this.attachedMesh.position;this._light.position=new s.P(t.x,t.y,t.z),this._cachedPosition.copyFrom(this.attachedMesh.position)}if(this._light.direction)if(s.P.DistanceSquared(this.attachedMesh.forward,this._cachedForward)>1e-4){var i=this.attachedMesh.forward;this._light.direction=new s.P(i.x,i.y,i.z),this._cachedForward.copyFrom(this.attachedMesh.forward)}else s.P.DistanceSquared(this.attachedMesh.forward,this._light.direction)>1e-4&&(this.attachedMesh.setDirection(this._light.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward))}},t.prototype.dispose=function(){this.onClickedObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this._material.dispose(),e.prototype.dispose.call(this),this._attachedMeshParent.dispose()},t._CreateHemisphericLightMesh=function(e){var i=new a.Kj("hemisphereLight",e),r=(0,N.q)(i.name,{segments:10,diameter:1},e);return r.position.z=-.15,r.rotation.x=Math.PI/2,r.parent=i,this._CreateLightLines(3,e).parent=i,i.scaling.scaleInPlace(t._Scale),i.rotation.x=Math.PI/2,i},t._CreatePointLightMesh=function(e){var i=new a.Kj("pointLight",e),r=(0,m.Qk)(i.name,{segments:10,diameter:1},e);return r.rotation.x=Math.PI/2,r.parent=i,this._CreateLightLines(5,e).parent=i,i.scaling.scaleInPlace(t._Scale),i.rotation.x=Math.PI/2,i},t._CreateSpotLightMesh=function(e){var i=new a.Kj("spotLight",e);(0,m.Qk)(i.name,{segments:10,diameter:1},e).parent=i;var r=(0,N.q)(i.name,{segments:10,diameter:2},e);return r.parent=i,r.rotation.x=-Math.PI/2,this._CreateLightLines(2,e).parent=i,i.scaling.scaleInPlace(t._Scale),i.rotation.x=Math.PI/2,i},t._CreateDirectionalLightMesh=function(e){var i=new a.Kj("directionalLight",e),r=new a.Kj(i.name,e);r.parent=i,(0,m.Qk)(i.name,{diameter:1.2,segments:10},e).parent=r;var n=(0,l.wf)(i.name,{updatable:!1,height:6,diameterTop:.3,diameterBottom:.3,tessellation:6,subdivisions:1},e);n.parent=r;var o=n.clone(i.name);o.scaling.y=.5,o.position.x+=1.25;var s=n.clone(i.name);s.scaling.y=.5,s.position.x+=-1.25;var h=(0,l.wf)(i.name,{updatable:!1,height:1,diameterTop:0,diameterBottom:.6,tessellation:6,subdivisions:1},e);return h.position.y+=3,h.parent=r,(o=h.clone(i.name)).position.y=1.5,o.position.x+=1.25,(s=h.clone(i.name)).position.y=1.5,s.position.x+=-1.25,r.scaling.scaleInPlace(t._Scale),r.rotation.z=Math.PI/2,r.rotation.y=Math.PI/2,i},t._Scale=.007,t._CreateLightLines=function(e,t){var i=new a.Kj("root",t);i.rotation.x=Math.PI/2;var r=new a.Kj("linePivot",t);r.parent=i;var n=(0,l.wf)("line",{updatable:!1,height:2,diameterTop:.2,diameterBottom:.3,tessellation:6,subdivisions:1},t);if(n.position.y=n.scaling.y/2+1.2,n.parent=r,e<2)return r;for(var o=0;o<4;o++){var s=r.clone("lineParentClone");s.rotation.z=Math.PI/4,s.rotation.y=Math.PI/2+Math.PI/2*o,s.getChildMeshes()[0].scaling.y=.5,s.getChildMeshes()[0].scaling.x=s.getChildMeshes()[0].scaling.z=.8,s.getChildMeshes()[0].position.y=s.getChildMeshes()[0].scaling.y/2+1.2}if(e<3)return i;for(o=0;o<4;o++){var h=r.clone("linePivotClone");h.rotation.z=Math.PI/2,h.rotation.y=Math.PI/2*o}if(e<4)return i;for(o=0;o<4;o++){var d=r.clone("linePivotClone");d.rotation.z=Math.PI+Math.PI/4,d.rotation.y=Math.PI/2+Math.PI/2*o,d.getChildMeshes()[0].scaling.y=.5,d.getChildMeshes()[0].scaling.x=d.getChildMeshes()[0].scaling.z=.8,d.getChildMeshes()[0].position.y=d.getChildMeshes()[0].scaling.y/2+1.2}return e<5||(r.clone("linePivotClone").rotation.z=Math.PI),i},t}(u.t),V=i(6307),j=function(e){function t(t){void 0===t&&(t=p.x.DefaultUtilityLayer);var i=e.call(this,t)||this;return i._pointerObserver=null,i.onClickedObservable=new o.y$,i._camera=null,i._invProjection=new V.y3,i._material=new d.K("cameraGizmoMaterial",i.gizmoLayer.utilityLayerScene),i._material.diffuseColor=new _.Wo(.5,.5,.5),i._material.specularColor=new _.Wo(.1,.1,.1),i._pointerObserver=t.utilityLayerScene.onPointerObservable.add((function(e){i._camera&&(i._isHovered=!(!e.pickInfo||-1==i._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)),i._isHovered&&0===e.event.button&&i.onClickedObservable.notifyObservers(i._camera))}),O.kD.POINTERDOWN),i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"displayFrustum",{get:function(){return this._cameraLinesMesh.isEnabled()},set:function(e){this._cameraLinesMesh.setEnabled(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(e){var i=this;if(this._camera=e,this.attachedNode=e,e){this._cameraMesh&&this._cameraMesh.dispose(),this._cameraLinesMesh&&this._cameraLinesMesh.dispose(),this._cameraMesh=t._CreateCameraMesh(this.gizmoLayer.utilityLayerScene),this._cameraLinesMesh=t._CreateCameraFrustum(this.gizmoLayer.utilityLayerScene),this._cameraMesh.getChildMeshes(!1).forEach((function(e){e.material=i._material})),this._cameraMesh.parent=this._rootMesh,this._cameraLinesMesh.parent=this._rootMesh,this.gizmoLayer.utilityLayerScene.activeCamera&&this.gizmoLayer.utilityLayerScene.activeCamera.maxZ<1.5*e.maxZ&&(this.gizmoLayer.utilityLayerScene.activeCamera.maxZ=1.5*e.maxZ),this.attachedNode.reservedDataStore||(this.attachedNode.reservedDataStore={}),this.attachedNode.reservedDataStore.cameraGizmo=this;var r=this.gizmoLayer._getSharedGizmoLight();r.includedOnlyMeshes=r.includedOnlyMeshes.concat(this._cameraMesh.getChildMeshes(!1)),this._update()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),t.prototype._update=function(){e.prototype._update.call(this),this._camera&&(this._camera.getProjectionMatrix().invertToRef(this._invProjection),this._cameraLinesMesh.setPivotMatrix(this._invProjection,!1),this._cameraLinesMesh.scaling.x=1/this._rootMesh.scaling.x,this._cameraLinesMesh.scaling.y=1/this._rootMesh.scaling.y,this._cameraLinesMesh.scaling.z=1/this._rootMesh.scaling.z,this._cameraMesh.parent=null,this._cameraMesh.rotation.y=.5*Math.PI*(this._camera.getScene().useRightHandedSystem?1:-1),this._cameraMesh.parent=this._rootMesh)},t.prototype.dispose=function(){this.onClickedObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this._cameraMesh&&this._cameraMesh.dispose(),this._cameraLinesMesh&&this._cameraLinesMesh.dispose(),this._material.dispose(),e.prototype.dispose.call(this)},t._CreateCameraMesh=function(e){var i=new a.Kj("rootCameraGizmo",e),r=new a.Kj(i.name,e);r.parent=i,(0,h.NR)(i.name,{width:1,height:.8,depth:.5},e).parent=r;var n=(0,l.wf)(i.name,{height:.5,diameterTop:.8,diameterBottom:.8},e);n.parent=r,n.position.y=.3,n.position.x=-.6,n.rotation.x=.5*Math.PI;var o=(0,l.wf)(i.name,{height:.5,diameterTop:.6,diameterBottom:.6},e);o.parent=r,o.position.y=.5,o.position.x=.4,o.rotation.x=.5*Math.PI;var s=(0,l.wf)(i.name,{height:.5,diameterTop:.5,diameterBottom:.5},e);return s.parent=r,s.position.y=0,s.position.x=.6,s.rotation.z=.5*Math.PI,i.scaling.scaleInPlace(t._Scale),r.position.x=-.9,i},t._CreateCameraFrustum=function(e){var t=new a.Kj("rootCameraGizmo",e),i=new a.Kj(t.name,e);i.parent=t;for(var r=0;r<4;r+=2)for(var n=0;n<4;n+=2){var o=(0,v.nL)("lines",{points:[new s.P(-1+n,-1+r,-1),new s.P(-1+n,-1+r,1)]},e);o.parent=i,o.alwaysSelectAsActiveMesh=!0,o.isPickable=!1,(o=(0,v.nL)("lines",{points:[new s.P(-1,-1+n,-1+r),new s.P(1,-1+n,-1+r)]},e)).parent=i,o.alwaysSelectAsActiveMesh=!0,o.isPickable=!1,(o=(0,v.nL)("lines",{points:[new s.P(-1+n,-1,-1+r),new s.P(-1+n,1,-1+r)]},e)).parent=i,o.alwaysSelectAsActiveMesh=!0,o.isPickable=!1}return t},t._Scale=.05,t}(u.t)},58774:(e,t,i)=>{i.d(t,{gZ:()=>b,lV:()=>P,E7:()=>A,ye:()=>D});var r=i(31191),n=i(62897),o=i(78443),s=i(58095),a=i(15631),h=i(91243),l=i(39126),d=i(73803),c=i(92159),u=i(44394),p=i(17713),_=i(46719),f=i(8451),g=i(62464),b=function(){function e(t,i){var o=this;this._errorHandler=function(e,t){o.onErrorObservable.notifyObservers({message:e,exception:t})},this._options=(0,r.pi)((0,r.pi)({},e._GetDefaultOptions()),t),this._scene=i,this.onErrorObservable=new n.y$,this._setupBackground(),this._setupImageProcessing()}return e._GetDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._GroundTextureCDNUrl,groundColor:new a.Wo(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:0,groundYBias:1e-5,createSkybox:!0,skyboxSize:20,skyboxTexture:this._SkyboxTextureCDNUrl,skyboxColor:new a.Wo(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:s.P.Zero(),setupImageProcessing:!0,environmentTexture:this._EnvironmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(e.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skybox",{get:function(){return this._skybox},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ground",{get:function(){return this._ground},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!1,configurable:!0}),e.prototype.updateOptions=function(e){var t=(0,r.pi)((0,r.pi)({},this._options),e);this._ground&&!t.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!t.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=t.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!t.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!t.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=t.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!t.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=t.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=t,this._setupBackground(),this._setupImageProcessing()},e.prototype.setMainColor=function(e){this.groundMaterial&&(this.groundMaterial.primaryColor=e),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=e),this.groundMirror&&(this.groundMirror.clearColor=new a.HE(e.r,e.g,e.b,1))},e.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},e.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture)if(this._options.environmentTexture instanceof l.V)this._scene.environmentTexture=this._options.environmentTexture;else{var e=u.B.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=e}},e.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new h.Kj("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var e=this._getSceneSize();this._options.createGround&&(this._setupGround(e),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(e),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(e),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=e.rootPosition.x,this._rootMesh.position.z=e.rootPosition.z,this._rootMesh.position.y=e.rootPosition.y},e.prototype._getSceneSize=function(){var e=this,t=this._options.groundSize,i=this._options.skyboxSize,r=this._options.rootPosition;if(!this._scene.meshes||1===this._scene.meshes.length)return{groundSize:t,skyboxSize:i,rootPosition:r};var n=this._scene.getWorldExtends((function(t){return t!==e._ground&&t!==e._rootMesh&&t!==e._skybox})),s=n.max.subtract(n.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof o.Y&&this._scene.activeCamera.upperRadiusLimit&&(i=t=2*this._scene.activeCamera.upperRadiusLimit);var a=s.length();a>t&&(i=t=2*a),t*=1.1,i*=1.5,(r=n.min.add(s.scale(.5))).y=n.min.y-this._options.groundYBias}return{groundSize:t,skyboxSize:i,rootPosition:r}},e.prototype._setupGround=function(e){var t=this;this._ground&&!this._ground.isDisposed()||(this._ground=(0,_.pT)("BackgroundPlane",{size:e.groundSize},this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add((function(){t._ground=null}))),this._ground.receiveShadows=this._options.enableGroundShadow},e.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new p.I("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=8,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},e.prototype._setupGroundDiffuseTexture=function(){this._groundMaterial&&(this._groundTexture||(this._options.groundTexture instanceof l.V?this._groundMaterial.diffuseTexture=this._options.groundTexture:(this._groundTexture=new d.x(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._groundTexture.gammaSpace=!1,this._groundTexture.hasAlpha=!0,this._groundMaterial.diffuseTexture=this._groundTexture)))},e.prototype._setupGroundMirrorTexture=function(e){var t=d.x.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new c.h("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,d.x.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new g.J(0,-1,0,e.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=t,this._groundMirror.wrapV=t,this._groundMirror.renderList))for(var i=0;i<this._scene.meshes.length;i++){var r=this._scene.meshes[i];r!==this._ground&&r!==this._skybox&&r!==this._rootMesh&&this._groundMirror.renderList.push(r)}var n=this._options.groundColor.toGammaSpace();this._groundMirror.clearColor=new a.HE(n.r,n.g,n.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},e.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},e.prototype._setupSkybox=function(e){var t=this;this._skybox&&!this._skybox.isDisposed()||(this._skybox=(0,f.NR)("BackgroundSkybox",{size:e.skyboxSize,sideOrientation:h.Kj.BACKSIDE},this._scene),this._skybox.onDisposeObservable.add((function(){t._skybox=null}))),this._skybox.parent=this._rootMesh},e.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new p.I("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},e.prototype._setupSkyboxReflectionTexture=function(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof l.V?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new u.B(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=d.x.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))},e.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},e._GroundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",e._SkyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",e._EnvironmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env",e}(),m=i(30700),v=i(48087),y=i(6307),M=function(e){function t(i,r,o,a,l){void 0===l&&(l=null);var d=e.call(this,i,a)||this;d.onError=l,d._halfDome=!1,d._crossEye=!1,d._useDirectMapping=!1,d._textureMode=t.MODE_MONOSCOPIC,d._onBeforeCameraRenderObserver=null,d.onLoadErrorObservable=new n.y$,d.onLoadObservable=new n.y$,a=d.getScene(),i=i||"textureDome",o.resolution=0|Math.abs(o.resolution)||32,o.clickToPlay=Boolean(o.clickToPlay),o.autoPlay=void 0===o.autoPlay||Boolean(o.autoPlay),o.loop=void 0===o.loop||Boolean(o.loop),o.size=Math.abs(o.size)||(a.activeCamera?.48*a.activeCamera.maxZ:1e3),void 0===o.useDirectMapping?d._useDirectMapping=!0:d._useDirectMapping=o.useDirectMapping,void 0===o.faceForward&&(o.faceForward=!0),d._setReady(!1),o.mesh?d._mesh=o.mesh:d._mesh=(0,v.Qk)(i+"_mesh",{segments:o.resolution,diameter:o.size,updatable:!1,sideOrientation:h.Kj.BACKSIDE},a);var c=d._material=new p.I(i+"_material",a);c.useEquirectangularFOV=!0,c.fovMultiplier=1,c.opacityFresnel=!1;var u=d._initTexture(r,a,o);if(d.texture=u,d._mesh.material=c,d._mesh.parent=d,d._halfDomeMask=(0,v.Qk)("",{slice:.5,diameter:.98*o.size,segments:2*o.resolution,sideOrientation:h.Kj.BACKSIDE},a),d._halfDomeMask.rotate(y.RD.X,-Math.PI/2),d._halfDomeMask.parent=d._mesh,d._halfDome=!!o.halfDomeMode,d._halfDomeMask.setEnabled(d._halfDome),d._crossEye=!!o.crossEyeMode,d._texture.anisotropicFilteringLevel=1,d._texture.onLoadObservable.addOnce((function(){d._setReady(!0)})),o.faceForward&&a.activeCamera){var _=a.activeCamera,f=s.P.Forward(),g=s.P.TransformNormal(f,_.getViewMatrix());g.normalize(),d.rotation.y=Math.acos(s.P.Dot(f,g))}return d._changeTextureMode(d._textureMode),d}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._useDirectMapping?(this._texture.wrapU=d.x.CLAMP_ADDRESSMODE,this._texture.wrapV=d.x.CLAMP_ADDRESSMODE,this._material.diffuseTexture=this._texture):(this._texture.coordinatesMode=d.x.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,this._texture.wrapV=d.x.CLAMP_ADDRESSMODE,this._material.reflectionTexture=this._texture),this._changeTextureMode(this._textureMode))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(e){this._material.fovMultiplier=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureMode",{get:function(){return this._textureMode},set:function(e){this._textureMode!==e&&this._changeTextureMode(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfDome",{get:function(){return this._halfDome},set:function(e){this._halfDome=e,this._halfDomeMask.setEnabled(e),this._changeTextureMode(this._textureMode)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"crossEye",{get:function(){return this._crossEye},set:function(e){this._crossEye=e,this._changeTextureMode(this._textureMode)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),t.prototype._changeTextureMode=function(e){var i=this;switch(this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._textureMode=e,this._texture.uScale=1,this._texture.vScale=1,this._texture.uOffset=0,this._texture.vOffset=0,this._texture.vAng=0,e){case t.MODE_MONOSCOPIC:this._halfDome&&(this._texture.uScale=2,this._texture.uOffset=-1);break;case t.MODE_SIDEBYSIDE:this._texture.uScale=this._halfDome?.99999:.5;var r=this._halfDome?0:.5,n=this._halfDome?-.5:0;this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add((function(e){var t=e.isRightCamera;i._crossEye&&(t=!t),i._texture.uOffset=t?r:n}));break;case t.MODE_TOPBOTTOM:this._texture.vScale=this._halfDome?.99999:.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add((function(e){var t=e.isRightCamera;i._crossEye&&(t=!t),i._texture.vOffset=t?.5:0}))}},t.prototype.dispose=function(t,i){void 0===i&&(i=!1),this._texture.dispose(),this._mesh.dispose(),this._material.dispose(),this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this.onLoadErrorObservable.clear(),this.onLoadObservable.clear(),e.prototype.dispose.call(this,t,i)},t.MODE_MONOSCOPIC=0,t.MODE_TOPBOTTOM=1,t.MODE_SIDEBYSIDE=2,t}(m.Y),P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"photoTexture",{get:function(){return this.texture},set:function(e){this.texture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageMode",{get:function(){return this.textureMode},set:function(e){this.textureMode=e},enumerable:!1,configurable:!0}),t.prototype._initTexture=function(e,t,i){var r=this;return new d.x(e,t,!i.generateMipMaps,!this._useDirectMapping,void 0,(function(){r.onLoadObservable.notifyObservers()}),(function(e,t){r.onLoadErrorObservable.notifyObservers(e||"Unknown error occured"),r.onError&&r.onError(e,t)}))},t.MODE_MONOSCOPIC=M.MODE_MONOSCOPIC,t.MODE_TOPBOTTOM=M.MODE_TOPBOTTOM,t.MODE_SIDEBYSIDE=M.MODE_SIDEBYSIDE,t}(M),O=i(84318),x=i(65273),T=i(3085),S=i(47914),C=i(51356),w=i(78098),R=i(12110),E=(i(22189),i(19195),i(25025),i(33102)),D=!0;x.x.prototype.createDefaultLight=function(e){if(void 0===e&&(e=!1),e&&this.lights)for(var t=0;t<this.lights.length;t++)this.lights[t].dispose();0===this.lights.length&&new C.e("default light",s.P.Up(),this)},x.x.prototype.createDefaultCamera=function(e,t,i){if(void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=!1),t&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){var r=this.getWorldExtends((function(e){return e.isVisible&&e.isEnabled()})),n=r.max.subtract(r.min),a=r.min.add(n.scale(.5)),h=void 0,l=1.5*n.length();if(isFinite(l)||(l=1,a.copyFromFloats(0,0,0)),e){var d=new o.Y("default camera",-Math.PI/2,Math.PI/2,l,a,this);d.lowerRadiusLimit=.01*l,d.wheelPrecision=100/l,h=d}else{var c=new w.c("default camera",new s.P(a.x,a.y,-l),this);c.setTarget(a),h=c}h.minZ=.01*l,h.maxZ=1e3*l,h.speed=.2*l,this.activeCamera=h,i&&h.attachControl()}},x.x.prototype.createDefaultCameraOrLight=function(e,t,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=!1),this.createDefaultLight(t),this.createDefaultCamera(e,t,i)},x.x.prototype.createDefaultSkybox=function(e,t,i,r,n){if(void 0===t&&(t=!1),void 0===i&&(i=1e3),void 0===r&&(r=0),void 0===n&&(n=!0),!e)return O.Y.Warn("Can not create default skybox without environment texture."),null;n&&e&&(this.environmentTexture=e);var o=(0,f.NR)("hdrSkyBox",{size:i},this);if(t){var s=new S.Y("skyBox",this);s.backFaceCulling=!1,s.reflectionTexture=e.clone(),s.reflectionTexture&&(s.reflectionTexture.coordinatesMode=d.x.SKYBOX_MODE),s.microSurface=1-r,s.disableLighting=!0,s.twoSidedLighting=!0,o.material=s}else{var a=new T.K("skyBox",this);a.backFaceCulling=!1,a.reflectionTexture=e.clone(),a.reflectionTexture&&(a.reflectionTexture.coordinatesMode=d.x.SKYBOX_MODE),a.disableLighting=!0,o.material=a}return o.isPickable=!1,o.infiniteDistance=!0,o.ignoreCameraMaxZ=!0,o},x.x.prototype.createDefaultEnvironment=function(e){return b?new b(e,this):null},x.x.prototype.createDefaultVRExperience=function(e){return void 0===e&&(e={}),new R.F(this,e)},x.x.prototype.createDefaultXRExperienceAsync=function(e){return void 0===e&&(e={}),E.B.CreateAsync(this,e).then((function(e){return e}))};var z=i(9100),B=i(76324),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"videoTexture",{get:function(){return this._texture},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoMode",{get:function(){return this.textureMode},set:function(e){this.textureMode=e},enumerable:!1,configurable:!0}),t.prototype._initTexture=function(e,t,i){var r=this,n={loop:i.loop,autoPlay:i.autoPlay,autoUpdateTexture:!0,poster:i.poster},o=new z.f((this.name||"videoDome")+"_texture",e,t,i.generateMipMaps,this._useDirectMapping,d.x.TRILINEAR_SAMPLINGMODE,n);return i.clickToPlay&&(this._pointerObserver=t.onPointerObservable.add((function(e){e.type!==B.kD.POINTERUP&&r._texture.video.play()}))),this._textureObserver=o.onLoadObservable.add((function(){r.onLoadObservable.notifyObservers()})),o},t.prototype.dispose=function(t,i){void 0===i&&(i=!1),this._texture.onLoadObservable.remove(this._textureObserver),this._scene.onPointerObservable.remove(this._pointerObserver),e.prototype.dispose.call(this,t,i)},t.MODE_MONOSCOPIC=M.MODE_MONOSCOPIC,t.MODE_TOPBOTTOM=M.MODE_TOPBOTTOM,t.MODE_SIDEBYSIDE=M.MODE_SIDEBYSIDE,t}(M)},55526:(e,t,i)=>{i.d(t,{$:()=>p});var r=i(76324),n=i(72544),o=i(5292),s=i(58095),a=i(23954),h=i(63737),l=i(33097),d=i(38784),c=i(15210),u=function(){function e(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(e.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!1,configurable:!0}),e}(),p=function(){function e(e){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new s.FM(0,0),this._previousStartingPointerPosition=new s.FM(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._deviceSourceManager=null,this._scene=e||c.l.LastCreatedScene,this._scene}return Object.defineProperty(e.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),e.prototype.getMeshUnderPointerByPointerId=function(e){return this._meshUnderPointerId[e]||null},Object.defineProperty(e.prototype,"unTranslatedPointer",{get:function(){return new s.FM(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerX",{get:function(){return this._pointerX},set:function(e){this._pointerX=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerY",{get:function(){return this._pointerY},set:function(e){this._pointerY=e},enumerable:!1,configurable:!0}),e.prototype._updatePointerPosition=function(e){var t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},e.prototype._processPointerMove=function(e,t){var i=this._scene,n=i.getEngine(),o=n.getInputElement();o&&(o.tabIndex=n.canvasTabIndex,i.doNotHandleCursors||(o.style.cursor=i.defaultCursor));var s=!!(e&&e.hit&&e.pickedMesh);if(s){if(i.setPointerOverMesh(e.pickedMesh,t.pointerId,e),!i.doNotHandleCursors&&o&&this._pointerOverMesh){var a=this._pointerOverMesh._getActionManagerForTrigger();a&&a.hasPointerTriggers&&(o.style.cursor=a.hoverCursor||i.hoverCursor)}}else i.setPointerOverMesh(null,t.pointerId,e);for(var h=0,l=i._pointerMoveStage;h<l.length;h++){e=l[h].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,s,o)}if(e){var d="wheel"===t.type||"mousewheel"===t.type||"DOMMouseScroll"===t.type?r.kD.POINTERWHEEL:r.kD.POINTERMOVE;if(i.onPointerMove&&i.onPointerMove(t,e,d),i.onPointerObservable.hasObservers()){var c=new r.R5(d,t,e);this._setRayOnPointerInfo(c),i.onPointerObservable.notifyObservers(c,d)}}},e.prototype._setRayOnPointerInfo=function(e){var t=this._scene;e.pickInfo&&!e.pickInfo._pickingUnavailable&&(e.pickInfo.ray||(e.pickInfo.ray=t.createPickingRay(e.event.offsetX,e.event.offsetY,s.y3.Identity(),t.activeCamera)))},e.prototype._checkPrePointerObservable=function(e,t,i){var n=this._scene,o=new r.FV(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(o.ray=e.ray,e.originMesh&&(o.nearInteractionPickingInfo=e)),n.onPrePointerObservable.notifyObservers(o,i),!!o.skipOnPointerObservable},e.prototype.simulatePointerMove=function(e,t){var i=new PointerEvent("pointermove",t);i.inputIndex=l.Fz.Move,this._checkPrePointerObservable(e,i,r.kD.POINTERMOVE)||this._processPointerMove(e,i)},e.prototype.simulatePointerDown=function(e,t){var i=new PointerEvent("pointerdown",t);i.inputIndex=i.button+2,this._checkPrePointerObservable(e,i,r.kD.POINTERDOWN)||this._processPointerDown(e,i)},e.prototype._processPointerDown=function(t,i){var n=this,o=this._scene;if(t&&t.hit&&t.pickedMesh){this._pickedDownMesh=t.pickedMesh;var s=t.pickedMesh._getActionManagerForTrigger();if(s){if(s.hasPickTriggers)switch(s.processTrigger(5,a.V.CreateNew(t.pickedMesh,i)),i.button){case 0:s.processTrigger(2,a.V.CreateNew(t.pickedMesh,i));break;case 1:s.processTrigger(4,a.V.CreateNew(t.pickedMesh,i));break;case 2:s.processTrigger(3,a.V.CreateNew(t.pickedMesh,i))}s.hasSpecificTrigger(8)&&window.setTimeout((function(){var t=o.pick(n._unTranslatedPointerX,n._unTranslatedPointerY,(function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===n._pickedDownMesh}),!1,o.cameraToUseForPointers);t&&t.hit&&t.pickedMesh&&s&&0!==n._totalPointersPressed&&Date.now()-n._startingPointerTime>e.LongPressDelay&&!n._isPointerSwiping()&&(n._startingPointerTime=0,s.processTrigger(8,a.V.CreateNew(t.pickedMesh,i)))}),e.LongPressDelay)}}else for(var h=0,l=o._pointerDownStage;h<l.length;h++){t=l[h].action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,i)}if(t){var d=r.kD.POINTERDOWN;if(o.onPointerDown&&o.onPointerDown(i,t,d),o.onPointerObservable.hasObservers()){var c=new r.R5(d,i,t);this._setRayOnPointerInfo(c),o.onPointerObservable.notifyObservers(c,d)}}},e.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>e.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>e.DragMovementThreshold},e.prototype.simulatePointerUp=function(e,t,i){var n=new PointerEvent("pointerup",t);n.inputIndex=l.Fz.Move;var o=new u;i?o.doubleClick=!0:o.singleClick=!0,this._checkPrePointerObservable(e,n,r.kD.POINTERUP)||this._processPointerUp(e,n,o)},e.prototype._processPointerUp=function(e,t,i){var n=this._scene;if(e&&e.hit&&e.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(n.onPointerPick&&n.onPointerPick(t,e),i.singleClick&&!i.ignore&&n.onPointerObservable.hasObservers())){var o=r.kD.POINTERPICK,s=new r.R5(o,t,e);this._setRayOnPointerInfo(s),n.onPointerObservable.notifyObservers(s,o)}var h=e.pickedMesh._getActionManagerForTrigger();if(h&&!i.ignore){h.processTrigger(7,a.V.CreateNew(e.pickedMesh,t,e)),!i.hasSwiped&&i.singleClick&&h.processTrigger(1,a.V.CreateNew(e.pickedMesh,t,e));var l=e.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&l&&l.processTrigger(6,a.V.CreateNew(e.pickedMesh,t,e))}}else if(!i.ignore)for(var d=0,c=n._pointerUpStage;d<c.length;d++){e=c[d].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t)}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var u=this._pickedDownMesh._getActionManagerForTrigger(16);u&&u.processTrigger(16,a.V.CreateNew(this._pickedDownMesh,t))}var p=0;if(n.onPointerObservable.hasObservers()){if(!i.ignore&&!i.hasSwiped&&(i.singleClick&&n.onPointerObservable.hasSpecificMask(r.kD.POINTERTAP)?p=r.kD.POINTERTAP:i.doubleClick&&n.onPointerObservable.hasSpecificMask(r.kD.POINTERDOUBLETAP)&&(p=r.kD.POINTERDOUBLETAP),p)){s=new r.R5(p,t,e);this._setRayOnPointerInfo(s),n.onPointerObservable.notifyObservers(s,p)}if(!i.ignore){p=r.kD.POINTERUP;s=new r.R5(p,t,e);this._setRayOnPointerInfo(s),n.onPointerObservable.notifyObservers(s,p)}}n.onPointerUp&&!i.ignore&&n.onPointerUp(t,e,p)},e.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._pointerCaptures[e]},e.prototype.attachControl=function(t,i,s,c){var p=this;void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===s&&(s=!0),void 0===c&&(c=null);var _=this._scene,f=_.getEngine();c||(c=f.getInputElement()),this._alreadyAttached&&this.detachControl(),c&&(this._alreadyAttachedTo=c),this._deviceSourceManager=new d.U(f),this._initActionManager=function(e){if(!p._meshPickProceed){var t=_.skipPointerUpPicking?null:_.pick(p._unTranslatedPointerX,p._unTranslatedPointerY,_.pointerUpPredicate,!1,_.cameraToUseForPointers);p._currentPickResult=t,t&&(e=t.hit&&t.pickedMesh?t.pickedMesh._getActionManagerForTrigger():null),p._meshPickProceed=!0}return e},this._delayedSimpleClick=function(t,i,r){(Date.now()-p._previousStartingPointerTime>e.DoubleClickDelay&&!p._doubleClickOccured||t!==p._previousButtonPressed)&&(p._doubleClickOccured=!1,i.singleClick=!0,i.ignore=!1,r(i,p._currentPickResult))},this._initClickEvent=function(t,i,o,s){var a=new u;p._currentPickResult=null;var h=null,l=t.hasSpecificMask(r.kD.POINTERPICK)||i.hasSpecificMask(r.kD.POINTERPICK)||t.hasSpecificMask(r.kD.POINTERTAP)||i.hasSpecificMask(r.kD.POINTERTAP)||t.hasSpecificMask(r.kD.POINTERDOUBLETAP)||i.hasSpecificMask(r.kD.POINTERDOUBLETAP);!l&&n.O&&(h=p._initActionManager(h,a))&&(l=h.hasPickTriggers);var d=!1;if(l){var c=o.button;if(a.hasSwiped=p._isPointerSwiping(),!a.hasSwiped){var _=!e.ExclusiveDoubleClickMode;_||(_=!t.hasSpecificMask(r.kD.POINTERDOUBLETAP)&&!i.hasSpecificMask(r.kD.POINTERDOUBLETAP))&&!n.O.HasSpecificTrigger(6)&&(h=p._initActionManager(h,a))&&(_=!h.hasSpecificTrigger(6)),_?(Date.now()-p._previousStartingPointerTime>e.DoubleClickDelay||c!==p._previousButtonPressed)&&(a.singleClick=!0,s(a,p._currentPickResult),d=!0):(p._previousDelayedSimpleClickTimeout=p._delayedSimpleClickTimeout,p._delayedSimpleClickTimeout=window.setTimeout(p._delayedSimpleClick.bind(p,c,a,s),e.DoubleClickDelay));var f=t.hasSpecificMask(r.kD.POINTERDOUBLETAP)||i.hasSpecificMask(r.kD.POINTERDOUBLETAP);!f&&n.O.HasSpecificTrigger(6)&&(h=p._initActionManager(h,a))&&(f=h.hasSpecificTrigger(6)),f&&(c===p._previousButtonPressed&&Date.now()-p._previousStartingPointerTime<e.DoubleClickDelay&&!p._doubleClickOccured?(a.hasSwiped||p._isPointerSwiping()?(p._doubleClickOccured=!1,p._previousStartingPointerTime=p._startingPointerTime,p._previousStartingPointerPosition.x=p._startingPointerPosition.x,p._previousStartingPointerPosition.y=p._startingPointerPosition.y,p._previousButtonPressed=c,e.ExclusiveDoubleClickMode?(p._previousDelayedSimpleClickTimeout&&clearTimeout(p._previousDelayedSimpleClickTimeout),p._previousDelayedSimpleClickTimeout=p._delayedSimpleClickTimeout,s(a,p._previousPickResult)):s(a,p._currentPickResult)):(p._previousStartingPointerTime=0,p._doubleClickOccured=!0,a.doubleClick=!0,a.ignore=!1,e.ExclusiveDoubleClickMode&&p._previousDelayedSimpleClickTimeout&&clearTimeout(p._previousDelayedSimpleClickTimeout),p._previousDelayedSimpleClickTimeout=p._delayedSimpleClickTimeout,s(a,p._currentPickResult)),d=!0):(p._doubleClickOccured=!1,p._previousStartingPointerTime=p._startingPointerTime,p._previousStartingPointerPosition.x=p._startingPointerPosition.x,p._previousStartingPointerPosition.y=p._startingPointerPosition.y,p._previousButtonPressed=c))}}d||s(a,p._currentPickResult)},this._onPointerMove=function(e){if(void 0===e.pointerId&&(e.pointerId=0),p._updatePointerPosition(e),!p._checkPrePointerObservable(null,e,"wheel"===e.type||"mousewheel"===e.type||"DOMMouseScroll"===e.type?r.kD.POINTERWHEEL:r.kD.POINTERMOVE)&&(_.cameraToUseForPointers||_.activeCamera))if(_.skipPointerMovePicking)p._processPointerMove(new o.p,e);else{_.pointerMovePredicate||(_.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||_.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!_.cameraToUseForPointers||0!=(_.cameraToUseForPointers.layerMask&e.layerMask))});var t=_.pick(p._unTranslatedPointerX,p._unTranslatedPointerY,_.pointerMovePredicate,!1,_.cameraToUseForPointers,_.pointerMoveTrianglePredicate);p._processPointerMove(t,e)}},this._onPointerDown=function(e){var t;(p._totalPointersPressed++,p._pickedDownMesh=null,p._meshPickProceed=!1,void 0===e.pointerId&&(e.pointerId=0),p._updatePointerPosition(e),_.preventDefaultOnPointerDown&&c&&(e.preventDefault(),c.focus()),p._startingPointerPosition.x=p._pointerX,p._startingPointerPosition.y=p._pointerY,p._startingPointerTime=Date.now(),p._checkPrePointerObservable(null,e,r.kD.POINTERDOWN))||(_.cameraToUseForPointers||_.activeCamera)&&(p._pointerCaptures[e.pointerId]=!0,_.pointerDownPredicate||(_.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!_.cameraToUseForPointers||0!=(_.cameraToUseForPointers.layerMask&e.layerMask))}),p._pickedDownMesh=null,t=_.skipPointerDownPicking?new o.p:_.pick(p._unTranslatedPointerX,p._unTranslatedPointerY,_.pointerDownPredicate,!1,_.cameraToUseForPointers),p._processPointerDown(t,e))},this._onPointerUp=function(e){0!==p._totalPointersPressed&&(p._totalPointersPressed--,p._pickedUpMesh=null,p._meshPickProceed=!1,void 0===e.pointerId&&(e.pointerId=0),p._updatePointerPosition(e),_.preventDefaultOnPointerUp&&c&&(e.preventDefault(),c.focus()),p._initClickEvent(_.onPrePointerObservable,_.onPointerObservable,e,(function(t,i){if(_.onPrePointerObservable.hasObservers()&&!t.ignore){if(!t.hasSwiped){if(t.singleClick&&_.onPrePointerObservable.hasSpecificMask(r.kD.POINTERTAP)&&p._checkPrePointerObservable(null,e,r.kD.POINTERTAP))return;if(t.doubleClick&&_.onPrePointerObservable.hasSpecificMask(r.kD.POINTERDOUBLETAP)&&p._checkPrePointerObservable(null,e,r.kD.POINTERDOUBLETAP))return}if(p._checkPrePointerObservable(null,e,r.kD.POINTERUP))return}!p._pointerCaptures[e.pointerId]&&e.buttons>0||(p._pointerCaptures[e.pointerId]=!1,(_.cameraToUseForPointers||_.activeCamera)&&(_.pointerUpPredicate||(_.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!_.cameraToUseForPointers||0!=(_.cameraToUseForPointers.layerMask&e.layerMask))}),!p._meshPickProceed&&(n.O&&n.O.HasTriggers||_.onPointerObservable.hasObservers())&&p._initActionManager(null,t),i||(i=p._currentPickResult),p._processPointerUp(i,e,t),p._previousPickResult=p._currentPickResult))})))},this._onKeyDown=function(e){var t=h.OG.KEYDOWN;if(_.onPreKeyboardObservable.hasObservers()){var i=new h.WZ(t,e);if(_.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(_.onKeyboardObservable.hasObservers()){i=new h.NG(t,e);_.onKeyboardObservable.notifyObservers(i,t)}_.actionManager&&_.actionManager.processTrigger(14,a.V.CreateNewFromScene(_,e))},this._onKeyUp=function(e){var t=h.OG.KEYUP;if(_.onPreKeyboardObservable.hasObservers()){var i=new h.WZ(t,e);if(_.onPreKeyboardObservable.notifyObservers(i,t),i.skipOnKeyboardObservable)return}if(_.onKeyboardObservable.hasObservers()){i=new h.NG(t,e);_.onKeyboardObservable.notifyObservers(i,t)}_.actionManager&&_.actionManager.processTrigger(15,a.V.CreateNewFromScene(_,e))},this._deviceSourceManager.onDeviceConnectedObservable.add((function(e){e.deviceType===l.Yi.Mouse?e.onInputChangedObservable.add((function(r){r.inputIndex===l.Fz.LeftClick||r.inputIndex===l.Fz.MiddleClick||r.inputIndex===l.Fz.RightClick?i&&1===e.getInput(r.inputIndex)?p._onPointerDown(r):t&&0===e.getInput(r.inputIndex)&&p._onPointerUp(r):s&&(r.inputIndex===l.Fz.Move?p._onPointerMove(r):r.inputIndex!==l.Fz.MouseWheelX&&r.inputIndex!==l.Fz.MouseWheelY&&r.inputIndex!==l.Fz.MouseWheelZ||p._onPointerMove(r))})):e.deviceType===l.Yi.Touch?e.onInputChangedObservable.add((function(r){r.inputIndex===l.Fz.LeftClick&&(i&&1===e.getInput(r.inputIndex)?p._onPointerDown(r):t&&0===e.getInput(r.inputIndex)&&p._onPointerUp(r)),s&&r.inputIndex===l.Fz.Move&&p._onPointerMove(r)})):e.deviceType===l.Yi.Keyboard&&e.onInputChangedObservable.add((function(e){"keydown"===e.type?p._onKeyDown(e):"keyup"===e.type&&p._onKeyUp(e)}))})),this._alreadyAttached=!0},e.prototype.detachControl=function(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)},e.prototype.setPointerOverMesh=function(e,t,i){if(void 0===t&&(t=0),this._meshUnderPointerId[t]!==e){var r,n=this._meshUnderPointerId[t];n&&(r=n._getActionManagerForTrigger(10))&&r.processTrigger(10,a.V.CreateNew(n,void 0,{pointerId:t})),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,(r=e._getActionManagerForTrigger(9))&&r.processTrigger(9,a.V.CreateNew(e,void 0,{pointerId:t,pickResult:i}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null)}},e.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},e.prototype._invalidateMesh=function(e){for(var t in this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null),this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]},e.DragMovementThreshold=10,e.LongPressDelay=500,e.DoubleClickDelay=300,e.ExclusiveDoubleClickMode=!1,e}()},97164:(e,t,i)=>{i.d(t,{P:()=>n});var r=i(82577),n=function(){function e(e){this.engine=e,this._captureGPUFrameTime=!1,this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new r.z,this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(e.prototype,"gpuFrameTimeCounter",{get:function(){return this.engine.getGPUFrameTimeCounter()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(e){e!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=e,this.engine.captureGPUFrameTime(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(e){var t=this;e!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=e,e?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add((function(){t._shaderCompilationTime.fetchNewFrame(),t._shaderCompilationTime.beginMonitoring()})),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add((function(){t._shaderCompilationTime.endMonitoring()}))):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},e}()},70127:(e,t,i)=>{i.d(t,{Cy:()=>n.C,Pj:()=>r.P,Wh:()=>o.W});var r=i(97164),n=i(93525),o=i(98467)},93525:(e,t,i)=>{i.d(t,{C:()=>o});var r=i(13514),n=i(82577),o=function(){function e(e){var t=this;this.scene=e,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new n.z,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new n.z,this._captureFrameTime=!1,this._frameTime=new n.z,this._captureRenderTime=!1,this._renderTime=new n.z,this._captureInterFrameTime=!1,this._interFrameTime=new n.z,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new n.z,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new n.z,this._capturePhysicsTime=!1,this._physicsTime=new n.z,this._captureAnimationsTime=!1,this._animationsTime=new n.z,this._captureCameraRenderTime=!1,this._cameraRenderTime=new n.z,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=e.onBeforeAnimationsObservable.add((function(){t._captureActiveMeshesEvaluationTime&&t._activeMeshesEvaluationTime.fetchNewFrame(),t._captureRenderTargetsRenderTime&&t._renderTargetsRenderTime.fetchNewFrame(),t._captureFrameTime&&(r.w1.StartPerformanceCounter("Scene rendering"),t._frameTime.beginMonitoring()),t._captureInterFrameTime&&t._interFrameTime.endMonitoring(),t._captureParticlesRenderTime&&t._particlesRenderTime.fetchNewFrame(),t._captureSpritesRenderTime&&t._spritesRenderTime.fetchNewFrame(),t._captureAnimationsTime&&t._animationsTime.beginMonitoring(),t.scene.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=e.onAfterRenderObservable.add((function(){t._captureFrameTime&&(r.w1.EndPerformanceCounter("Scene rendering"),t._frameTime.endMonitoring()),t._captureRenderTime&&t._renderTime.endMonitoring(!1),t._captureInterFrameTime&&t._interFrameTime.beginMonitoring()}))}return Object.defineProperty(e.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(e){var t=this;e!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=e,e?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add((function(){r.w1.StartPerformanceCounter("Active meshes evaluation"),t._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add((function(){r.w1.EndPerformanceCounter("Active meshes evaluation"),t._activeMeshesEvaluationTime.endMonitoring()}))):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(e){var t=this;e!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=e,e?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add((function(){r.w1.StartPerformanceCounter("Render targets rendering"),t._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add((function(){r.w1.EndPerformanceCounter("Render targets rendering"),t._renderTargetsRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(e){var t=this;e!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=e,e?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add((function(){r.w1.StartPerformanceCounter("Particles"),t._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add((function(){r.w1.EndPerformanceCounter("Particles"),t._particlesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(e){var t=this;e!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=e,this.scene.spriteManagers&&(e?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add((function(){r.w1.StartPerformanceCounter("Sprites"),t._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add((function(){r.w1.EndPerformanceCounter("Sprites"),t._spritesRenderTime.endMonitoring(!1)}))):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(e){var t=this;e!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=e,e?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add((function(){r.w1.StartPerformanceCounter("Physics"),t._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add((function(){r.w1.EndPerformanceCounter("Physics"),t._physicsTime.endMonitoring()}))):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(e){var t=this;e!==this._captureAnimationsTime&&(this._captureAnimationsTime=e,e?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add((function(){t._animationsTime.endMonitoring()})):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(e){this._captureFrameTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(e){this._captureInterFrameTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(e){var t=this;e!==this._captureRenderTime&&(this._captureRenderTime=e,e?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add((function(){t._renderTime.beginMonitoring(),r.w1.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add((function(){t._renderTime.endMonitoring(!1),r.w1.EndPerformanceCounter("Main render")}))):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(e){var t=this;e!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=e,e?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add((function(e){t._cameraRenderTime.beginMonitoring(),r.w1.StartPerformanceCounter("Rendering camera ".concat(e.name))})),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add((function(e){t._cameraRenderTime.endMonitoring(!1),r.w1.EndPerformanceCounter("Rendering camera ".concat(e.name))}))):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},e}()},98467:(e,t,i)=>{i.d(t,{W:()=>r});var r=function(){this._timeElapsedQueryEnded=!1}},31999:(e,t,i)=>{i.d(t,{w:()=>m});var r=i(31191),n=i(96969),o=i(13514),s=i(62897),a=i(15631),h=i(37290),l=i(15210),d=i(72208),c=i(73803),u=i(63784),p=i(98163),_=i(90360),f=(i(92857),i(89010),i(77851)),g=i(38309),b=i(67759),m=function(){function e(t,i){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new a.HE},this.neutralColor=new a.HE,this.isEnabled=!0,this.disableBoundingBoxesFromEffectLayer=!1,this.onDisposeObservable=new s.y$,this.onBeforeRenderMainTextureObservable=new s.y$,this.onBeforeComposeObservable=new s.y$,this.onBeforeRenderMeshToEffect=new s.y$,this.onAfterRenderMeshToEffect=new s.y$,this.onAfterComposeObservable=new s.y$,this.onSizeChangedObservable=new s.y$,this._materialForRendering={},this.name=t,this._scene=i||l.l.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._mergeDrawWrapper=[],this._generateIndexBuffer(),this._generateVertexBuffer()}return Object.defineProperty(e.prototype,"camera",{get:function(){return this._effectLayerOptions.camera},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._effectLayerOptions.renderingGroupId},set:function(e){this._effectLayerOptions.renderingGroupId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mainTexture",{get:function(){return this._mainTexture},enumerable:!1,configurable:!0}),e.prototype.setMaterialForRendering=function(e,t){if(this._mainTexture.setMaterialForRendering(e,t),Array.isArray(e))for(var i=0;i<e.length;++i){var r=e[i];t?this._materialForRendering[r.uniqueId]=[r,t]:delete this._materialForRendering[r.uniqueId]}else t?this._materialForRendering[e.uniqueId]=[e,t]:delete this._materialForRendering[e.uniqueId]},e.prototype._numInternalDraws=function(){return 1},e.prototype._init=function(e){this._effectLayerOptions=(0,r.pi)({mainTextureRatio:.5,alphaBlendingMode:2,camera:null,renderingGroupId:-1},e),this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses()},e.prototype._generateIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._engine.createIndexBuffer(e)},e.prototype._generateVertexBuffer=function(){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1);var t=new d.o(this._engine,e,d.o.PositionKind,!1,!1,2);this._vertexBuffers[d.o.PositionKind]=t},e.prototype._setMainTextureSize=function(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?h.D.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?h.D.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)},e.prototype._createMainTexture=function(){var e=this;for(var t in this._mainTexture=new u._("EffectLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,0),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=c.x.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=c.x.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(c.x.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._materialForRendering){var i=this._materialForRendering[t],r=i[0],n=i[1];this._mainTexture.setMaterialForRendering(r,n)}if(this._mainTexture.customIsReadyFunction=function(t,i){if(!t.isReady(!1))return!1;if(0===i&&t.subMeshes)for(var r=0;r<t.subMeshes.length;++r){var n=t.subMeshes[r],o=n.getMaterial(),s=n.getRenderingMesh();if(o){var a=s._getInstancesRenderList(n._id,!!n.getReplacementMesh()).hardwareInstancedRendering[n._id]||s.hasThinInstances;if(e._setEmissiveTextureAndColor(s,n,o),!e._isReady(n,a,e._emissiveTextureAndColor.texture))return!1}}return!0},this._mainTexture.customRenderFunction=function(t,i,r,n){var o;e.onBeforeRenderMainTextureObservable.notifyObservers(e);var s=e._scene.getEngine();if(n.length){for(s.setColorWrite(!1),o=0;o<n.length;o++)e._renderSubMesh(n.data[o]);s.setColorWrite(!0)}for(o=0;o<t.length;o++)e._renderSubMesh(t.data[o]);for(o=0;o<i.length;o++)e._renderSubMesh(i.data[o]);var a=s.getAlphaMode();for(o=0;o<r.length;o++)e._renderSubMesh(r.data[o],!0);s.setAlphaMode(a)},this._mainTexture.onClearObservable.add((function(t){t.clear(e.neutralColor,!0,!0,!0)})),this._scene.getBoundingBoxRenderer){var o=this._scene.getBoundingBoxRenderer().enabled;this._mainTexture.onBeforeBindObservable.add((function(){e._scene.getBoundingBoxRenderer().enabled=!e.disableBoundingBoxesFromEffectLayer&&o})),this._mainTexture.onAfterUnbindObservable.add((function(){e._scene.getBoundingBoxRenderer().enabled=o}))}},e.prototype._addCustomEffectDefines=function(e){},e.prototype._isReady=function(e,t,i){var r,n=this._scene.getEngine(),o=e.getMesh(),s=null===(r=o._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===r?void 0:r[n.currentRenderPassId];if(s)return s.isReadyForSubMesh(o,e,t);var a=e.getMaterial();if(!a)return!1;if(this._useMeshMaterial(e.getRenderingMesh()))return a.isReadyForSubMesh(e.getMesh(),e,t);var h=[],l=[d.o.PositionKind],c=!1,u=!1;if(a){var f=a.needAlphaTesting(),b=a.getAlphaTestTexture(),m=b&&b.hasAlpha&&(a.useAlphaFromDiffuseTexture||a._useAlphaFromAlbedoTexture);b&&(f||m)&&(h.push("#define DIFFUSE"),o.isVerticesDataPresent(d.o.UV2Kind)&&1===b.coordinatesIndex?(h.push("#define DIFFUSEUV2"),u=!0):o.isVerticesDataPresent(d.o.UVKind)&&(h.push("#define DIFFUSEUV1"),c=!0),f&&(h.push("#define ALPHATEST"),h.push("#define ALPHATESTVALUE 0.4")),b.gammaSpace||h.push("#define DIFFUSE_ISLINEAR"));var v=a.opacityTexture;v&&(h.push("#define OPACITY"),o.isVerticesDataPresent(d.o.UV2Kind)&&1===v.coordinatesIndex?(h.push("#define OPACITYUV2"),u=!0):o.isVerticesDataPresent(d.o.UVKind)&&(h.push("#define OPACITYUV1"),c=!0))}i&&(h.push("#define EMISSIVE"),o.isVerticesDataPresent(d.o.UV2Kind)&&1===i.coordinatesIndex?(h.push("#define EMISSIVEUV2"),u=!0):o.isVerticesDataPresent(d.o.UVKind)&&(h.push("#define EMISSIVEUV1"),c=!0),i.gammaSpace||h.push("#define EMISSIVE_ISLINEAR")),o.useVertexColors&&o.isVerticesDataPresent(d.o.ColorKind)&&o.hasVertexAlpha&&a.transparencyMode!==p.F.MATERIAL_OPAQUE&&(l.push(d.o.ColorKind),h.push("#define VERTEXALPHA")),c&&(l.push(d.o.UVKind),h.push("#define UV1")),u&&(l.push(d.o.UV2Kind),h.push("#define UV2"));var y=new g.L;if(o.useBones&&o.computeBonesUsingShaders){l.push(d.o.MatricesIndicesKind),l.push(d.o.MatricesWeightsKind),o.numBoneInfluencers>4&&(l.push(d.o.MatricesIndicesExtraKind),l.push(d.o.MatricesWeightsExtraKind)),h.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers);var M=o.skeleton;M&&M.isUsingTextureForMatrices?h.push("#define BONETEXTURE"):h.push("#define BonesPerMesh "+(M?M.bones.length+1:0)),o.numBoneInfluencers>0&&y.addCPUSkinningFallback(0,o)}else h.push("#define NUM_BONE_INFLUENCERS 0");var P=o.morphTargetManager,O=0;P&&P.numInfluencers>0&&(h.push("#define MORPHTARGETS"),O=P.numInfluencers,h.push("#define NUM_MORPH_INFLUENCERS "+O),P.isUsingTextureForTargets&&h.push("#define MORPHTARGETS_TEXTURE"),_.G.PrepareAttributesForMorphTargetsInfluencers(l,o,O)),t&&(h.push("#define INSTANCES"),_.G.PushAttributesForInstances(l),e.getRenderingMesh().hasThinInstances&&h.push("#define THIN_INSTANCES")),this._addCustomEffectDefines(h);var x=e._getDrawWrapper(void 0,!0),T=x.defines,S=h.join("\n");return T!==S&&x.setEffect(this._engine.createEffect("glowMapGeneration",l,["world","mBones","viewProjection","glowColor","morphTargetInfluences","boneTextureWidth","diffuseMatrix","emissiveMatrix","opacityMatrix","opacityIntensity","morphTargetTextureInfo","morphTargetTextureIndices"],["diffuseSampler","emissiveSampler","opacitySampler","boneSampler","morphTargets"],S,y,void 0,void 0,{maxSimultaneousMorphTargets:O}),S),x.effect.isReady()},e.prototype.render=function(){for(var e=0;e<this._postProcesses.length;e++)if(!this._postProcesses[e].isReady())return;var t=this._scene.getEngine(),i=this._numInternalDraws(),r=!0;for(e=0;e<i;++e){(o=this._mergeDrawWrapper[e])||(o=this._mergeDrawWrapper[e]=new b.q(this._engine)).setEffect(this._createMergeEffect()),r=r&&o.effect.isReady()}if(r){this.onBeforeComposeObservable.notifyObservers(this);var n=t.getAlphaMode();for(e=0;e<i;++e){var o=this._mergeDrawWrapper[e];t.enableEffect(o),t.setState(!1),t.bindBuffers(this._vertexBuffers,this._indexBuffer,o.effect),t.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(o.effect,e)}t.setAlphaMode(n),this.onAfterComposeObservable.notifyObservers(this);var s=this._mainTexture.getSize();this._setMainTextureSize(),s.width===this._mainTextureDesiredSize.width&&s.height===this._mainTextureDesiredSize.height||0===this._mainTextureDesiredSize.width||0===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}},e.prototype.hasMesh=function(e){return-1===this.renderingGroupId||e.renderingGroupId===this.renderingGroupId},e.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},e.prototype._shouldRenderMesh=function(e){return!0},e.prototype._canRenderMesh=function(e,t){return!t.needAlphaBlendingForMesh(e)},e.prototype._shouldRenderEmissiveTextureForMesh=function(){return!0},e.prototype._renderSubMesh=function(e,t){var i,r;if(void 0===t&&(t=!1),this.shouldRender()){var n=e.getMaterial(),o=e.getMesh(),s=e.getReplacementMesh(),a=e.getRenderingMesh(),h=e.getEffectiveMesh(),l=this._scene,d=l.getEngine();if(h._internalAbstractMeshDataInfo._isActiveIntermediate=!1,n&&this._canRenderMesh(a,n)){var c=null!==(i=a.overrideMaterialSideOrientation)&&void 0!==i?i:n.sideOrientation;h._getWorldMatrixDeterminant()<0&&(c=c===p.F.ClockWiseSideOrientation?p.F.CounterClockWiseSideOrientation:p.F.ClockWiseSideOrientation);var u=c===p.F.ClockWiseSideOrientation;d.setState(n.backFaceCulling,n.zOffset,void 0,u,n.cullBackFaces,void 0,n.zOffsetUnits);var f=a._getInstancesRenderList(e._id,!!s);if(!f.mustReturn&&this._shouldRenderMesh(a)){var g=f.hardwareInstancedRendering[e._id]||a.hasThinInstances;if(this._setEmissiveTextureAndColor(a,e,n),this.onBeforeRenderMeshToEffect.notifyObservers(o),this._useMeshMaterial(a))a.render(e,g,s||void 0);else if(this._isReady(e,g,this._emissiveTextureAndColor.texture)){var b=null===(r=h._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===r?void 0:r[d.currentRenderPassId],m=e._getDrawWrapper();if(!m&&b&&(m=b._getDrawWrapper()),!m)return;var v=m.effect;if(d.enableEffect(m),!g){var y=l.forcePointsCloud?p.F.PointFillMode:l.forceWireframe?p.F.WireFrameFillMode:n.fillMode;a._bind(e,v,y)}if(b?b.bindForSubMesh(h.getWorldMatrix(),h,e):(v.setMatrix("viewProjection",l.getTransformMatrix()),v.setMatrix("world",h.getWorldMatrix()),v.setFloat4("glowColor",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a)),!b){var M=n.needAlphaTesting(),P=n.getAlphaTestTexture(),O=P&&P.hasAlpha&&(n.useAlphaFromDiffuseTexture||n._useAlphaFromAlbedoTexture);if(P&&(M||O))v.setTexture("diffuseSampler",P),(x=P.getTextureMatrix())&&v.setMatrix("diffuseMatrix",x);var x,T=n.opacityTexture;if(T)v.setTexture("opacitySampler",T),v.setFloat("opacityIntensity",T.level),(x=T.getTextureMatrix())&&v.setMatrix("opacityMatrix",x);if(this._emissiveTextureAndColor.texture&&(v.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),v.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),a.useBones&&a.computeBonesUsingShaders&&a.skeleton){var S=a.skeleton;if(S.isUsingTextureForMatrices){var C=S.getTransformMatrixTexture(a);if(!C)return;v.setTexture("boneSampler",C),v.setFloat("boneTextureWidth",4*(S.bones.length+1))}else v.setMatrices("mBones",S.getTransformMatrices(a))}_.G.BindMorphTargetParameters(a,v),a.morphTargetManager&&a.morphTargetManager.isUsingTextureForTargets&&a.morphTargetManager._bind(v),t&&d.setAlphaMode(n.alphaMode)}a._processRendering(h,e,v,n.fillMode,f,g,(function(e,t){return v.setMatrix("world",t)}))}else this._mainTexture.resetRefreshCounter();this.onAfterRenderMeshToEffect.notifyObservers(o)}}}},e.prototype._useMeshMaterial=function(e){return!1},e.prototype._rebuild=function(){var e=this._vertexBuffers[d.o.PositionKind];e&&e._rebuild(),this._generateIndexBuffer()},e.prototype._disposeTextureAndPostProcesses=function(){this._mainTexture.dispose();for(var e=0;e<this._postProcesses.length;e++)this._postProcesses[e]&&this._postProcesses[e].dispose();this._postProcesses=[];for(e=0;e<this._textures.length;e++)this._textures[e]&&this._textures[e].dispose();this._textures=[]},e.prototype.dispose=function(){var e=this._vertexBuffers[d.o.PositionKind];e&&(e.dispose(),this._vertexBuffers[d.o.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);for(var t=0,i=this._mergeDrawWrapper;t<i.length;t++){i[t].dispose()}this._mergeDrawWrapper=[],this._disposeTextureAndPostProcesses();var r=this._scene.effectLayers.indexOf(this,0);r>-1&&this._scene.effectLayers.splice(r,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onBeforeRenderMeshToEffect.clear(),this.onAfterRenderMeshToEffect.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},e.prototype.getClassName=function(){return"EffectLayer"},e.Parse=function(e,t,i){return o.w1.Instantiate(e.customType).Parse(e,t,i)},e._SceneComponentInitialization=function(e){throw(0,f.S)("EffectLayerSceneComponent")},(0,r.gn)([(0,n.qC)()],e.prototype,"name",void 0),(0,r.gn)([(0,n.XX)()],e.prototype,"neutralColor",void 0),(0,r.gn)([(0,n.qC)()],e.prototype,"isEnabled",void 0),(0,r.gn)([(0,n.VE)()],e.prototype,"camera",null),(0,r.gn)([(0,n.qC)()],e.prototype,"renderingGroupId",null),(0,r.gn)([(0,n.qC)()],e.prototype,"disableBoundingBoxesFromEffectLayer",void 0),e}()},79221:(e,t,i)=>{i.d(t,{p:()=>h});var r=i(2055),n=i(85627),o=i(31999),s=i(57755),a=i(15210);s.p.AddParser(n.l.NAME_EFFECTLAYER,(function(e,t,i,r){if(e.effectLayers){i.effectLayers||(i.effectLayers=new Array);for(var n=0;n<e.effectLayers.length;n++){var s=o.w.Parse(e.effectLayers[n],t,r);i.effectLayers.push(s)}}})),s.p.prototype.removeEffectLayer=function(e){var t=this.effectLayers.indexOf(e);return-1!==t&&this.effectLayers.splice(t,1),t},s.p.prototype.addEffectLayer=function(e){this.effectLayers.push(e)};var h=function(){function e(e){this.name=n.l.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=e||a.l.LastCreatedScene,this.scene&&(this._engine=this.scene.getEngine(),this.scene.effectLayers=new Array)}return e.prototype.register=function(){this.scene._isReadyForMeshStage.registerStep(n.l.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(n.l.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(n.l.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(n.l.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(n.l.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(n.l.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)},e.prototype.rebuild=function(){for(var e=0,t=this.scene.effectLayers;e<t.length;e++){t[e]._rebuild()}},e.prototype.serialize=function(e){e.effectLayers=[];for(var t=0,i=this.scene.effectLayers;t<i.length;t++){var r=i[t];r.serialize&&e.effectLayers.push(r.serialize())}},e.prototype.addFromContainer=function(e){var t=this;e.effectLayers&&e.effectLayers.forEach((function(e){t.scene.addEffectLayer(e)}))},e.prototype.removeFromContainer=function(e,t){var i=this;e.effectLayers&&e.effectLayers.forEach((function(e){i.scene.removeEffectLayer(e),t&&e.dispose()}))},e.prototype.dispose=function(){for(var e=this.scene.effectLayers;e.length;)e[0].dispose()},e.prototype._isReadyForMesh=function(e,t){for(var i=this._engine.currentRenderPassId,r=0,n=this.scene.effectLayers;r<n.length;r++){var o=n[r];if(o.hasMesh(e)){var s=o._mainTexture;this._engine.currentRenderPassId=s.renderPassId;for(var a=0,h=e.subMeshes;a<h.length;a++){var l=h[a];if(!o.isReady(l,t))return this._engine.currentRenderPassId=i,!1}}}return this._engine.currentRenderPassId=i,!0},e.prototype._renderMainTexture=function(e){this._renderEffects=!1,this._needStencil=!1;var t=!1,i=this.scene.effectLayers;if(i&&i.length>0){this._previousStencilState=this._engine.getStencilBuffer();for(var n=0,o=i;n<o.length;n++){var s=o[n];if(s.shouldRender()&&(!s.camera||s.camera.cameraRigMode===r.V.RIG_MODE_NONE&&e===s.camera||s.camera.cameraRigMode!==r.V.RIG_MODE_NONE&&s.camera._rigCameras.indexOf(e)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||s.needStencil();var a=s._mainTexture;a._shouldRender()&&(this.scene.incrementRenderId(),a.render(!1,!1),t=!0)}}this.scene.incrementRenderId()}return t},e.prototype._setStencil=function(){this._needStencil&&this._engine.setStencilBuffer(!0)},e.prototype._setStencilBack=function(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)},e.prototype._draw=function(e){if(this._renderEffects){this._engine.setDepthBuffer(!1);for(var t=this.scene.effectLayers,i=0;i<t.length;i++){var r=t[i];r.renderingGroupId===e&&r.shouldRender()&&r.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCamera=function(){this._renderEffects&&this._draw(-1)},e.prototype._drawRenderingGroup=function(e){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(e)},e}();o.w._SceneComponentInitialization=function(e){var t=e._getComponent(n.l.NAME_EFFECTLAYER);t||(t=new h(e),e._addComponent(t))}},19442:(e,t,i)=>{i.d(t,{c:()=>g});var r=i(31191),n=i(96969),o=i(58095),s=i(72208),a=i(73803),h=i(63784),l=i(98163),d=i(442),c=i(31999),u=i(57755),p=i(48620),_=i(37290),f=i(15631);i(92626),i(38482),i(79221);u.p.prototype.getGlowLayerByName=function(e){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===e&&this.effectLayers[t].getEffectName()===g.EffectName)return this.effectLayers[t];return null};var g=function(e){function t(i,n,o){var s=e.call(this,i,n)||this;return s._intensity=1,s._includedOnlyMeshes=[],s._excludedMeshes=[],s._meshesUsingTheirOwnMaterials=[],s.neutralColor=new f.HE(0,0,0,1),s._options=(0,r.pi)({mainTextureRatio:t.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1,ldrMerge:!1,alphaBlendingMode:1},o),s._init({alphaBlendingMode:s._options.alphaBlendingMode,camera:s._options.camera,mainTextureFixedSize:s._options.mainTextureFixedSize,mainTextureRatio:s._options.mainTextureRatio,renderingGroupId:s._options.renderingGroupId}),s}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"blurKernelSize",{get:function(){return this._horizontalBlurPostprocess1.kernel},set:function(e){this._horizontalBlurPostprocess1.kernel=e,this._verticalBlurPostprocess1.kernel=e,this._horizontalBlurPostprocess2.kernel=e,this._verticalBlurPostprocess2.kernel=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._intensity},set:function(e){this._intensity=e},enumerable:!1,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){var e="#define EMISSIVE \n";return this._options.ldrMerge&&(e+="#define LDR \n"),this._engine.createEffect("glowMapMerge",[s.o.PositionKind],["offset"],["textureSampler","textureSampler2"],e)},t.prototype._createTextureAndPostProcesses=function(){var e=this,t=this._mainTextureDesiredSize.width,i=this._mainTextureDesiredSize.height;t=this._engine.needPOTTextures?_.D.GetExponentOfTwo(t,this._maxSize):t,i=this._engine.needPOTTextures?_.D.GetExponentOfTwo(i,this._maxSize):i;var r=0;r=this._engine.getCaps().textureHalfFloatRender?2:0,this._blurTexture1=new h._("GlowLayerBlurRTT",{width:t,height:i},this._scene,!1,!0,r),this._blurTexture1.wrapU=a.x.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=a.x.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(a.x.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;var n=Math.floor(t/2),s=Math.floor(i/2);this._blurTexture2=new h._("GlowLayerBlurRTT2",{width:n,height:s},this._scene,!1,!0,r),this._blurTexture2.wrapU=a.x.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=a.x.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(a.x.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2],this._horizontalBlurPostprocess1=new d.i("GlowLayerHBP1",new o.FM(1,0),this._options.blurKernelSize/2,{width:t,height:i},null,a.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,r),this._horizontalBlurPostprocess1.width=t,this._horizontalBlurPostprocess1.height=i,this._horizontalBlurPostprocess1.externalTextureSamplerBinding=!0,this._horizontalBlurPostprocess1.onApplyObservable.add((function(t){t.setTexture("textureSampler",e._mainTexture)})),this._verticalBlurPostprocess1=new d.i("GlowLayerVBP1",new o.FM(0,1),this._options.blurKernelSize/2,{width:t,height:i},null,a.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,r),this._horizontalBlurPostprocess2=new d.i("GlowLayerHBP2",new o.FM(1,0),this._options.blurKernelSize/2,{width:n,height:s},null,a.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,r),this._horizontalBlurPostprocess2.width=n,this._horizontalBlurPostprocess2.height=s,this._horizontalBlurPostprocess2.externalTextureSamplerBinding=!0,this._horizontalBlurPostprocess2.onApplyObservable.add((function(t){t.setTexture("textureSampler",e._blurTexture1)})),this._verticalBlurPostprocess2=new d.i("GlowLayerVBP2",new o.FM(0,1),this._options.blurKernelSize/2,{width:n,height:s},null,a.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,r),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add((function(){var t=e._blurTexture1.renderTarget;if(t){e._scene.postProcessManager.directRender(e._postProcesses1,t,!0);var i=e._blurTexture2.renderTarget;i&&e._scene.postProcessManager.directRender(e._postProcesses2,i,!0),e._engine.unBindFramebuffer(null!=i?i:t,!0)}})),this._postProcesses.map((function(e){e.autoClear=!1}))},t.prototype.isReady=function(t,i){var r=t.getMaterial(),n=t.getRenderingMesh();if(!r||!n)return!1;var o=r.emissiveTexture;return e.prototype._isReady.call(this,t,i,o)},t.prototype.needStencil=function(){return!1},t.prototype._canRenderMesh=function(e,t){return!0},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture1),e.setTexture("textureSampler2",this._blurTexture2),e.setFloat("offset",this._intensity);var t=this._engine,i=t.getStencilBuffer();t.setStencilBuffer(!1),t.drawElementsType(l.F.TriangleFillMode,0,6),t.setStencilBuffer(i)},t.prototype._setEmissiveTextureAndColor=function(e,t,i){var r,n=1;(this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(e,t,i):i?(this._emissiveTextureAndColor.texture=i.emissiveTexture,this._emissiveTextureAndColor.texture&&(n=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector)?this.customEmissiveColorSelector(e,t,i,this._emissiveTextureAndColor.color):i.emissiveColor?(n*=null!==(r=i.emissiveIntensity)&&void 0!==r?r:1,this._emissiveTextureAndColor.color.set(i.emissiveColor.r*n,i.emissiveColor.g*n,i.emissiveColor.b*n,i.alpha)):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)},t.prototype._shouldRenderMesh=function(e){return this.hasMesh(e)},t.prototype._addCustomEffectDefines=function(e){e.push("#define GLOW")},t.prototype.addExcludedMesh=function(e){-1===this._excludedMeshes.indexOf(e.uniqueId)&&this._excludedMeshes.push(e.uniqueId)},t.prototype.removeExcludedMesh=function(e){var t=this._excludedMeshes.indexOf(e.uniqueId);-1!==t&&this._excludedMeshes.splice(t,1)},t.prototype.addIncludedOnlyMesh=function(e){-1===this._includedOnlyMeshes.indexOf(e.uniqueId)&&this._includedOnlyMeshes.push(e.uniqueId)},t.prototype.removeIncludedOnlyMesh=function(e){var t=this._includedOnlyMeshes.indexOf(e.uniqueId);-1!==t&&this._includedOnlyMeshes.splice(t,1)},t.prototype.hasMesh=function(t){return!!e.prototype.hasMesh.call(this,t)&&(this._includedOnlyMeshes.length?-1!==this._includedOnlyMeshes.indexOf(t.uniqueId):!this._excludedMeshes.length||-1===this._excludedMeshes.indexOf(t.uniqueId))},t.prototype._useMeshMaterial=function(e){return 0!=this._meshesUsingTheirOwnMaterials.length&&this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId)>-1},t.prototype.referenceMeshToUseItsOwnMaterial=function(e){var t=this;e.resetDrawCache(this._mainTexture.renderPassId),this._meshesUsingTheirOwnMaterials.push(e.uniqueId),e.onDisposeObservable.add((function(){t._disposeMesh(e)}))},t.prototype.unReferenceMeshFromUsingItsOwnMaterial=function(e){for(var t=this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId);t>=0;)this._meshesUsingTheirOwnMaterials.splice(t,1),t=this._meshesUsingTheirOwnMaterials.indexOf(e.uniqueId);e.resetDrawCache(this._mainTexture.renderPassId)},t.prototype._disposeMesh=function(e){this.removeIncludedOnlyMesh(e),this.removeExcludedMesh(e)},t.prototype.getClassName=function(){return"GlowLayer"},t.prototype.serialize=function(){var e,t=n.p4.Serialize(this);if(t.customType="BABYLON.GlowLayer",t.includedMeshes=[],this._includedOnlyMeshes.length)for(e=0;e<this._includedOnlyMeshes.length;e++){(i=this._scene.getMeshByUniqueId(this._includedOnlyMeshes[e]))&&t.includedMeshes.push(i.id)}if(t.excludedMeshes=[],this._excludedMeshes.length)for(e=0;e<this._excludedMeshes.length;e++){var i;(i=this._scene.getMeshByUniqueId(this._excludedMeshes[e]))&&t.excludedMeshes.push(i.id)}return t},t.Parse=function(e,i,r){var o,s=n.p4.Parse((function(){return new t(e.name,i,e.options)}),e,i,r);for(o=0;o<e.excludedMeshes.length;o++){(a=i.getMeshById(e.excludedMeshes[o]))&&s.addExcludedMesh(a)}for(o=0;o<e.includedMeshes.length;o++){var a;(a=i.getMeshById(e.includedMeshes[o]))&&s.addIncludedOnlyMesh(a)}return s},t.EffectName="GlowLayer",t.DefaultBlurKernelSize=32,t.DefaultTextureRatio=.5,(0,r.gn)([(0,n.qC)()],t.prototype,"blurKernelSize",null),(0,r.gn)([(0,n.qC)()],t.prototype,"intensity",null),(0,r.gn)([(0,n.qC)("options")],t.prototype,"_options",void 0),t}(c.w);(0,p.H)("BABYLON.GlowLayer",g)},84550:(e,t,i)=>{i.d(t,{wv:()=>r.w,pt:()=>n.p,cM:()=>o.c,H1:()=>O,mh:()=>x.m,Ni:()=>T.N});var r=i(31999),n=i(79221),o=i(19442),s=i(31191),a=i(96969),h=i(62897),l=i(58095),d=i(37290),c=i(72208),u=i(98163),p=i(73803),_=i(63784),f=i(16142),g=i(89815),b=i(442),m=i(57755),v=i(84318),y=i(48620),M=i(15631);i(92626),i(38482),i(80636);m.p.prototype.getHighlightLayerByName=function(e){for(var t,i=0;i<(null===(t=this.effectLayers)||void 0===t?void 0:t.length);i++)if(this.effectLayers[i].name===e&&this.effectLayers[i].getEffectName()===O.EffectName)return this.effectLayers[i];return null};var P=function(e){function t(t,i,r,n,o,s,a,h){void 0===s&&(s=p.x.BILINEAR_SAMPLINGMODE);var l=e.call(this,t,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,n,o,s,a,h)||this;return l.direction=i,l.kernel=r,l.onApplyObservable.add((function(e){e.setFloat2("screenSize",l.width,l.height),e.setVector2("direction",l.direction),e.setFloat("blurWidth",l.kernel)})),l}return(0,s.ZT)(t,e),t}(f.D),O=function(e){function t(i,r,n){var o=e.call(this,i,r)||this;return o.name=i,o.innerGlow=!0,o.outerGlow=!0,o.onBeforeBlurObservable=new h.y$,o.onAfterBlurObservable=new h.y$,o._instanceGlowingMeshStencilReference=t.GlowingMeshStencilReference++,o._meshes={},o._excludedMeshes={},o.neutralColor=t.NeutralColor,o._engine.isStencilEnable||v.Y.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new Engine(canvas, antialias, { stencil: true }"),o._options=(0,s.pi)({mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:2,camera:null,renderingGroupId:-1},n),o._init({alphaBlendingMode:o._options.alphaBlendingMode,camera:o._options.camera,mainTextureFixedSize:o._options.mainTextureFixedSize,mainTextureRatio:o._options.mainTextureRatio,renderingGroupId:o._options.renderingGroupId}),o._shouldRender=!1,o}return(0,s.ZT)(t,e),Object.defineProperty(t.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(e){this._horizontalBlurPostprocess.kernel=e,this._options.blurHorizontalSize=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(e){this._verticalBlurPostprocess.kernel=e,this._options.blurVerticalSize=e},enumerable:!1,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._numInternalDraws=function(){return 2},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[c.o.PositionKind],["offset"],["textureSampler"],this._options.isStroke?"#define STROKE \n":void 0)},t.prototype._createTextureAndPostProcesses=function(){var e=this,t=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,i=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;t=this._engine.needPOTTextures?d.D.GetExponentOfTwo(t,this._maxSize):t,i=this._engine.needPOTTextures?d.D.GetExponentOfTwo(i,this._maxSize):i;var r=0;r=this._engine.getCaps().textureHalfFloatRender?2:0,this._blurTexture=new _._("HighlightLayerBlurRTT",{width:t,height:i},this._scene,!1,!0,r),this._blurTexture.wrapU=p.x.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=p.x.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(p.x.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],2===this._options.alphaBlendingMode?(this._downSamplePostprocess=new g.Q("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,p.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.externalTextureSamplerBinding=!0,this._downSamplePostprocess.onApplyObservable.add((function(t){t.setTexture("textureSampler",e._mainTexture)})),this._horizontalBlurPostprocess=new P("HighlightLayerHBP",new l.FM(1,0),this._options.blurHorizontalSize,1,null,p.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add((function(e){e.setFloat2("screenSize",t,i)})),this._verticalBlurPostprocess=new P("HighlightLayerVBP",new l.FM(0,1),this._options.blurVerticalSize,1,null,p.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add((function(e){e.setFloat2("screenSize",t,i)})),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new b.i("HighlightLayerHBP",new l.FM(1,0),this._options.blurHorizontalSize/2,{width:t,height:i},null,p.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,r),this._horizontalBlurPostprocess.width=t,this._horizontalBlurPostprocess.height=i,this._horizontalBlurPostprocess.externalTextureSamplerBinding=!0,this._horizontalBlurPostprocess.onApplyObservable.add((function(t){t.setTexture("textureSampler",e._mainTexture)})),this._verticalBlurPostprocess=new b.i("HighlightLayerVBP",new l.FM(0,1),this._options.blurVerticalSize/2,{width:t,height:i},null,p.x.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,r),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add((function(){e.onBeforeBlurObservable.notifyObservers(e);var t=e._blurTexture.renderTarget;t&&(e._scene.postProcessManager.directRender(e._postProcesses,t,!0),e._engine.unBindFramebuffer(t,!0)),e.onAfterBlurObservable.notifyObservers(e)})),this._postProcesses.map((function(e){e.autoClear=!1}))},t.prototype.needStencil=function(){return!0},t.prototype.isReady=function(t,i){var r=t.getMaterial(),n=t.getRenderingMesh();if(!r||!n||!this._meshes)return!1;var o=null,s=this._meshes[n.uniqueId];return s&&s.glowEmissiveOnly&&r&&(o=r.emissiveTexture),e.prototype._isReady.call(this,t,i,o)},t.prototype._internalRender=function(e,t){e.setTexture("textureSampler",this._blurTexture);var i=this._engine;i.cacheStencilState(),i.setStencilOperationPass(7681),i.setStencilOperationFail(7680),i.setStencilOperationDepthFail(7680),i.setStencilMask(0),i.setStencilBuffer(!0),i.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&0===t&&(e.setFloat("offset",0),i.setStencilFunction(517),i.drawElementsType(u.F.TriangleFillMode,0,6)),this.innerGlow&&1===t&&(e.setFloat("offset",1),i.setStencilFunction(514),i.drawElementsType(u.F.TriangleFillMode,0,6)),i.restoreStencilState()},t.prototype.shouldRender=function(){return!!e.prototype.shouldRender.call(this)&&!!this._meshes},t.prototype._shouldRenderMesh=function(t){return(!this._excludedMeshes||!this._excludedMeshes[t.uniqueId])&&!!e.prototype.hasMesh.call(this,t)},t.prototype._canRenderMesh=function(e,t){return!0},t.prototype._addCustomEffectDefines=function(e){e.push("#define HIGHLIGHT")},t.prototype._setEmissiveTextureAndColor=function(e,t,i){var r=this._meshes[e.uniqueId];r?this._emissiveTextureAndColor.color.set(r.color.r,r.color.g,r.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),r&&r.glowEmissiveOnly&&i?(this._emissiveTextureAndColor.texture=i.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null},t.prototype.addExcludedMesh=function(e){this._excludedMeshes&&(this._excludedMeshes[e.uniqueId]||(this._excludedMeshes[e.uniqueId]={mesh:e,beforeBind:e.onBeforeBindObservable.add((function(e){e.getEngine().setStencilBuffer(!1)})),afterRender:e.onAfterRenderObservable.add((function(e){e.getEngine().setStencilBuffer(!0)}))}))},t.prototype.removeExcludedMesh=function(e){if(this._excludedMeshes){var t=this._excludedMeshes[e.uniqueId];t&&(t.beforeBind&&e.onBeforeBindObservable.remove(t.beforeBind),t.afterRender&&e.onAfterRenderObservable.remove(t.afterRender)),this._excludedMeshes[e.uniqueId]=null}},t.prototype.hasMesh=function(t){return!!this._meshes&&(!!e.prototype.hasMesh.call(this,t)&&(void 0!==this._meshes[t.uniqueId]&&null!==this._meshes[t.uniqueId]))},t.prototype.addMesh=function(e,t,i){var r=this;if(void 0===i&&(i=!1),this._meshes){var n=this._meshes[e.uniqueId];n?n.color=t:(this._meshes[e.uniqueId]={mesh:e,color:t,observerHighlight:e.onBeforeBindObservable.add((function(e){r.isEnabled&&(r._excludedMeshes&&r._excludedMeshes[e.uniqueId]?r._defaultStencilReference(e):e.getScene().getEngine().setStencilFunctionReference(r._instanceGlowingMeshStencilReference))})),observerDefault:e.onAfterRenderObservable.add((function(e){r.isEnabled&&r._defaultStencilReference(e)})),glowEmissiveOnly:i},e.onDisposeObservable.add((function(){r._disposeMesh(e)}))),this._shouldRender=!0}},t.prototype.removeMesh=function(e){if(this._meshes){var t=this._meshes[e.uniqueId];for(var i in t&&(t.observerHighlight&&e.onBeforeBindObservable.remove(t.observerHighlight),t.observerDefault&&e.onAfterRenderObservable.remove(t.observerDefault),delete this._meshes[e.uniqueId]),this._shouldRender=!1,this._meshes)if(this._meshes[i]){this._shouldRender=!0;break}}},t.prototype.removeAllMeshes=function(){if(this._meshes)for(var e in this._meshes)if(Object.prototype.hasOwnProperty.call(this._meshes,e)){var t=this._meshes[e];t&&this.removeMesh(t.mesh)}},t.prototype._defaultStencilReference=function(e){e.getScene().getEngine().setStencilFunctionReference(t.NormalMeshStencilReference)},t.prototype._disposeMesh=function(e){this.removeMesh(e),this.removeExcludedMesh(e)},t.prototype.dispose=function(){if(this._meshes){for(var t in this._meshes){(i=this._meshes[t])&&i.mesh&&(i.observerHighlight&&i.mesh.onBeforeBindObservable.remove(i.observerHighlight),i.observerDefault&&i.mesh.onAfterRenderObservable.remove(i.observerDefault))}this._meshes=null}if(this._excludedMeshes){for(var t in this._excludedMeshes){var i;(i=this._excludedMeshes[t])&&(i.beforeBind&&i.mesh.onBeforeBindObservable.remove(i.beforeBind),i.afterRender&&i.mesh.onAfterRenderObservable.remove(i.afterRender))}this._excludedMeshes=null}e.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"HighlightLayer"},t.prototype.serialize=function(){var e=a.p4.Serialize(this);if(e.customType="BABYLON.HighlightLayer",e.meshes=[],this._meshes)for(var t in this._meshes){var i=this._meshes[t];i&&e.meshes.push({glowEmissiveOnly:i.glowEmissiveOnly,color:i.color.asArray(),meshId:i.mesh.id})}if(e.excludedMeshes=[],this._excludedMeshes)for(var r in this._excludedMeshes){var n=this._excludedMeshes[r];n&&e.excludedMeshes.push(n.mesh.id)}return e},t.Parse=function(e,i,r){var n,o=a.p4.Parse((function(){return new t(e.name,i,e.options)}),e,i,r);for(n=0;n<e.excludedMeshes.length;n++){(s=i.getMeshById(e.excludedMeshes[n]))&&o.addExcludedMesh(s)}for(n=0;n<e.meshes.length;n++){var s,h=e.meshes[n];(s=i.getMeshById(h.meshId))&&o.addMesh(s,M.Wo.FromArray(h.color),h.glowEmissiveOnly)}return o},t.EffectName="HighlightLayer",t.NeutralColor=new M.HE(0,0,0,0),t.GlowingMeshStencilReference=2,t.NormalMeshStencilReference=1,(0,s.gn)([(0,a.qC)()],t.prototype,"innerGlow",void 0),(0,s.gn)([(0,a.qC)()],t.prototype,"outerGlow",void 0),(0,s.gn)([(0,a.qC)()],t.prototype,"blurHorizontalSize",null),(0,s.gn)([(0,a.qC)()],t.prototype,"blurVerticalSize",null),(0,s.gn)([(0,a.qC)("options")],t.prototype,"_options",void 0),t}(r.w);(0,y.H)("BABYLON.HighlightLayer",O);var x=i(15772),T=i(36912)},15772:(e,t,i)=>{i.d(t,{m:()=>p});var r=i(62897),n=i(58095),o=i(15631),s=i(15210),a=i(72208),h=i(98163),l=i(73803),d=i(85627),c=i(36912),u=i(67759),p=(i(27393),i(36441),function(){function e(e,t,i,h,p){this.name=e,this.scale=new n.FM(1,1),this.offset=new n.FM(0,0),this.alphaBlendingMode=2,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this.isEnabled=!0,this._vertexBuffers={},this.onDisposeObservable=new r.y$,this.onBeforeRenderObservable=new r.y$,this.onAfterRenderObservable=new r.y$,this.texture=t?new l.x(t,i,!0):null,this.isBackground=void 0===h||h,this.color=void 0===p?new o.HE(1,1,1,1):p,this._scene=i||s.l.LastCreatedScene;var _=this._scene._getComponent(d.l.NAME_LAYER);_||(_=new c.N(this._scene),this._scene._addComponent(_)),this._scene.layers.push(this);var f=this._scene.getEngine();this._drawWrapper=new u.q(f);var g=[];g.push(1,1),g.push(-1,1),g.push(-1,-1),g.push(1,-1);var b=new a.o(f,g,a.o.PositionKind,!1,!1,2);this._vertexBuffers[a.o.PositionKind]=b,this._createIndexBuffer()}return Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!1,configurable:!0}),e.prototype._createIndexBuffer=function(){var e=this._scene.getEngine(),t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},e.prototype._rebuild=function(){var e=this._vertexBuffers[a.o.PositionKind];e&&e._rebuild(),this._createIndexBuffer()},e.prototype.render=function(){if(this.isEnabled){var e=this._scene.getEngine(),t="";this.alphaTest&&(t="#define ALPHATEST"),this.texture&&!this.texture.gammaSpace&&(t+="\r\n#define LINEAR"),this._previousDefines!==t&&(this._previousDefines=t,this._drawWrapper.effect=e.createEffect("layer",[a.o.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],t));var i=this._drawWrapper.effect;i&&i.isReady()&&this.texture&&this.texture.isReady()&&(this.onBeforeRenderObservable.notifyObservers(this),e.enableEffect(this._drawWrapper),e.setState(!1),i.setTexture("textureSampler",this.texture),i.setMatrix("textureMatrix",this.texture.getTextureMatrix()),i.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),i.setVector2("offset",this.offset),i.setVector2("scale",this.scale),e.bindBuffers(this._vertexBuffers,this._indexBuffer,i),this.alphaTest?e.drawElementsType(h.F.TriangleFillMode,0,6):(e.setAlphaMode(this.alphaBlendingMode),e.drawElementsType(h.F.TriangleFillMode,0,6),e.setAlphaMode(0)),this.onAfterRenderObservable.notifyObservers(this))}},e.prototype.dispose=function(){var e=this._vertexBuffers[a.o.PositionKind];e&&(e.dispose(),this._vertexBuffers[a.o.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var t=this._scene.layers.indexOf(this);this._scene.layers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},e}())},36912:(e,t,i)=>{i.d(t,{N:()=>o});var r=i(85627),n=i(15210),o=function(){function e(e){this.name=r.l.NAME_LAYER,this.scene=e||n.l.LastCreatedScene,this.scene&&(this._engine=this.scene.getEngine(),this.scene.layers=new Array)}return e.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(r.l.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(r.l.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(r.l.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(r.l.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},e.prototype.rebuild=function(){for(var e=0,t=this.scene.layers;e<t.length;e++){t[e]._rebuild()}},e.prototype.dispose=function(){for(var e=this.scene.layers;e.length;)e[0].dispose()},e.prototype._draw=function(e){var t=this.scene.layers;if(t.length){this._engine.setDepthBuffer(!1);for(var i=0,r=t;i<r.length;i++){var n=r[i];e(n)&&n.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCameraPredicate=function(e,t,i){return!e.renderOnlyInRenderTargetTextures&&e.isBackground===t&&0!=(e.layerMask&i)},e.prototype._drawCameraBackground=function(e){var t=this;this._draw((function(i){return t._drawCameraPredicate(i,!0,e.layerMask)}))},e.prototype._drawCameraForeground=function(e){var t=this;this._draw((function(i){return t._drawCameraPredicate(i,!1,e.layerMask)}))},e.prototype._drawRenderTargetPredicate=function(e,t,i,r){return e.renderTargetTextures.length>0&&e.isBackground===t&&e.renderTargetTextures.indexOf(r)>-1&&0!=(e.layerMask&i)},e.prototype._drawRenderTargetBackground=function(e){var t=this;this._draw((function(i){return t._drawRenderTargetPredicate(i,!0,t.scene.activeCamera.layerMask,e)}))},e.prototype._drawRenderTargetForeground=function(e){var t=this;this._draw((function(i){return t._drawRenderTargetPredicate(i,!1,t.scene.activeCamera.layerMask,e)}))},e.prototype.addFromContainer=function(e){var t=this;e.layers&&e.layers.forEach((function(e){t.scene.layers.push(e)}))},e.prototype.removeFromContainer=function(e,t){var i=this;void 0===t&&(t=!1),e.layers&&e.layers.forEach((function(e){var r=i.scene.layers.indexOf(e);-1!==r&&i.scene.layers.splice(r,1),t&&e.dispose()}))},e}()}}]);