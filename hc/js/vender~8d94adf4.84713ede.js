"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1801],{65301:(e,t,n)=>{n.d(t,{IG:()=>a,mp:()=>m,Pq:()=>d});var r=n(15631),o=n(73803),i=n(3085),a=function(){function e(){this.materials=[]}return e.prototype.parseMTL=function(t,n,o,a){if(!(n instanceof ArrayBuffer)){for(var s,l=n.split("\n"),c=/\s+/,u=null,f=0;f<l.length;f++){var d=l[f].trim();if(0!==d.length&&"#"!==d.charAt(0)){var h=d.indexOf(" "),p=h>=0?d.substring(0,h):d;p=p.toLowerCase();var _=h>=0?d.substring(h+1).trim():"";if("newmtl"===p)u&&this.materials.push(u),t._blockEntityCollection=!!a,(u=new i.K(_,t))._parentContainer=a,t._blockEntityCollection=!1;else if("kd"===p&&u)s=_.split(c,3).map(parseFloat),u.diffuseColor=r.Wo.FromArray(s);else if("ka"===p&&u)s=_.split(c,3).map(parseFloat),u.ambientColor=r.Wo.FromArray(s);else if("ks"===p&&u)s=_.split(c,3).map(parseFloat),u.specularColor=r.Wo.FromArray(s);else if("ke"===p&&u)s=_.split(c,3).map(parseFloat),u.emissiveColor=r.Wo.FromArray(s);else if("ns"===p&&u)u.specularPower=parseFloat(_);else if("d"===p&&u)u.alpha=parseFloat(_);else if("map_ka"===p&&u)u.ambientTexture=e._GetTexture(o,_,t);else if("map_kd"===p&&u)u.diffuseTexture=e._GetTexture(o,_,t);else if("map_ks"===p&&u)u.specularTexture=e._GetTexture(o,_,t);else if("map_ns"===p);else if("map_bump"===p&&u){var m=_.split(c),v=m.indexOf("-bm"),y=null;v>=0&&(y=m[v+1],m.splice(v,2)),u.bumpTexture=e._GetTexture(o,m.join(" "),t),u.bumpTexture&&null!==y&&(u.bumpTexture.level=parseFloat(y))}else"map_d"===p&&u&&(u.opacityTexture=e._GetTexture(o,_,t))}}u&&this.materials.push(u)}},e._GetTexture=function(t,n,r){if(!n)return null;var i=t;if("file:"===t){var a=n.lastIndexOf("\\");-1===a&&(a=n.lastIndexOf("/")),i+=a>-1?n.substr(a+1):n}else i+=n;return new o.x(i,r,!1,e.INVERT_TEXTURE_Y)},e.INVERT_TEXTURE_Y=!0,e}(),s=n(72208),l=n(58095),c=n(63946),u=n(91243),f=n(89209),d=function(){function e(e,t,n){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new r.HE(.5,.5,.5,1),this._materialToUse=e,this._babylonMeshesArray=t,this._loadingOptions=n}return e.prototype._isInArray=function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});var n=e[t[0]].normals.indexOf(t[1]);return-1===n?-1:e[t[0]].idx[n]},e.prototype._isInArrayUV=function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});var n=e[t[0]].normals.indexOf(t[1]);return 1!=n&&t[2]===e[t[0]].uv[n]?e[t[0]].idx[n]:-1},e.prototype._setData=function(e,t,n,r,o,i,a){var s;-1===(s=this._loadingOptions.optimizeWithUV?this._isInArrayUV(this._tuplePosNorm,[e,n,t]):this._isInArray(this._tuplePosNorm,[e,n]))?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(r),this._wrappedUvsForBabylon.push(o),this._wrappedNormalsForBabylon.push(i),void 0!==a&&this._wrappedColorsForBabylon.push(a),this._tuplePosNorm[e].normals.push(n),this._tuplePosNorm[e].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[e].uv.push(t)):this._indicesForBabylon.push(s)},e.prototype._unwrapData=function(){for(var e=0;e<this._wrappedPositionForBabylon.length;e++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[e].x,this._wrappedPositionForBabylon[e].y,this._wrappedPositionForBabylon[e].z),this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[e].x,this._wrappedNormalsForBabylon[e].y,this._wrappedNormalsForBabylon[e].z),this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[e].x,this._wrappedUvsForBabylon[e].y),this._loadingOptions.importVertexColors&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[e].r,this._wrappedColorsForBabylon[e].g,this._wrappedColorsForBabylon[e].b,this._wrappedColorsForBabylon[e].a);this._wrappedPositionForBabylon=[],this._wrappedNormalsForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0},e.prototype._getTriangles=function(e,t){for(var n=t;n<e.length-1;n++)this._triangles.push(e[0],e[n],e[n+1])},e.prototype._setDataForCurrentFaceWithPattern1=function(e,t){this._getTriangles(e,t);for(var n=0;n<this._triangles.length;n++){var r=parseInt(this._triangles[n])-1;this._setData(r,0,0,this._positions[r],l.FM.Zero(),l.P.Up(),this._loadingOptions.importVertexColors?this._colors[r]:void 0)}this._triangles=[]},e.prototype._setDataForCurrentFaceWithPattern2=function(e,t){this._getTriangles(e,t);for(var n=0;n<this._triangles.length;n++){var r=this._triangles[n].split("/"),o=parseInt(r[0])-1,i=parseInt(r[1])-1;this._setData(o,i,0,this._positions[o],this._uvs[i],l.P.Up(),this._loadingOptions.importVertexColors?this._colors[o]:void 0)}this._triangles=[]},e.prototype._setDataForCurrentFaceWithPattern3=function(e,t){this._getTriangles(e,t);for(var n=0;n<this._triangles.length;n++){var r=this._triangles[n].split("/"),o=parseInt(r[0])-1,i=parseInt(r[1])-1,a=parseInt(r[2])-1;this._setData(o,i,a,this._positions[o],this._uvs[i],this._normals[a])}this._triangles=[]},e.prototype._setDataForCurrentFaceWithPattern4=function(e,t){this._getTriangles(e,t);for(var n=0;n<this._triangles.length;n++){var r=this._triangles[n].split("//"),o=parseInt(r[0])-1,i=parseInt(r[1])-1;this._setData(o,1,i,this._positions[o],l.FM.Zero(),this._normals[i],this._loadingOptions.importVertexColors?this._colors[o]:void 0)}this._triangles=[]},e.prototype._setDataForCurrentFaceWithPattern5=function(e,t){this._getTriangles(e,t);for(var n=0;n<this._triangles.length;n++){var r=this._triangles[n].split("/"),o=this._positions.length+parseInt(r[0]),i=this._uvs.length+parseInt(r[1]),a=this._normals.length+parseInt(r[2]);this._setData(o,i,a,this._positions[o],this._uvs[i],this._normals[a],this._loadingOptions.importVertexColors?this._colors[o]:void 0)}this._triangles=[]},e.prototype._addPreviousObjMesh=function(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice(),this._handledMesh.uvs=this._unwrappedUVForBabylon.slice(),this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._indicesForBabylon=[],this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[])},e.prototype._optimizeNormals=function(e){var t=e.getVerticesData(s.o.PositionKind),n=e.getVerticesData(s.o.NormalKind),r={};if(t&&n){for(var o=0;o<t.length/3;o++){(c=r[a=t[3*o+0]+"_"+t[3*o+1]+"_"+t[3*o+2]])||(c=[],r[a]=c),c.push(o)}var i=new l.P;for(var a in r){var c;if(!((c=r[a]).length<2)){var u=c[0];for(o=1;o<c.length;++o){var f=c[o];n[3*u+0]+=n[3*f+0],n[3*u+1]+=n[3*f+1],n[3*u+2]+=n[3*f+2]}i.copyFromFloats(n[3*u+0],n[3*u+1],n[3*u+2]),i.normalize();for(o=0;o<c.length;++o){n[3*(f=c[o])+0]=i.x,n[3*f+1]=i.y,n[3*f+2]=i.z}}}e.setVerticesData(s.o.NormalKind,n)}},e.prototype.parse=function(t,n,o,a,s){for(var d,h=n.split("\n"),p=0;p<h.length;p++){var _=h[p].trim().replace(/\s\s/g," "),m=void 0;if(0!==_.length&&"#"!==_.charAt(0))if(e.VertexPattern.test(_)){if(m=_.match(/[^ ]+/g),this._positions.push(new l.P(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]))),this._loadingOptions.importVertexColors)if(m.length>=7){var v=parseFloat(m[4]),y=parseFloat(m[5]),g=parseFloat(m[6]);this._colors.push(new r.HE(v>1?v/255:v,y>1?y/255:y,g>1?g/255:g,7===m.length||void 0===m[7]?1:parseFloat(m[7])))}else this._colors.push(this._grayColor)}else if(null!==(m=e.NormalPattern.exec(_)))this._normals.push(new l.P(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])));else if(null!==(m=e.UVPattern.exec(_)))this._uvs.push(new l.FM(parseFloat(m[1])*this._loadingOptions.UVScaling.x,parseFloat(m[2])*this._loadingOptions.UVScaling.y));else if(null!==(m=e.FacePattern3.exec(_)))this._setDataForCurrentFaceWithPattern3(m[1].trim().split(" "),1);else if(null!==(m=e.FacePattern4.exec(_)))this._setDataForCurrentFaceWithPattern4(m[1].trim().split(" "),1);else if(null!==(m=e.FacePattern5.exec(_)))this._setDataForCurrentFaceWithPattern5(m[1].trim().split(" "),1);else if(null!==(m=e.FacePattern2.exec(_)))this._setDataForCurrentFaceWithPattern2(m[1].trim().split(" "),1);else if(null!==(m=e.FacePattern1.exec(_)))this._setDataForCurrentFaceWithPattern1(m[1].trim().split(" "),1);else if(e.GroupDescriptor.test(_)||e.ObjectDescriptor.test(_)){var b={name:_.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:this._materialNameFromObj};this._addPreviousObjMesh(),this._meshesFromObj.push(b),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else if(e.UseMtlDescriptor.test(_)){if(this._materialNameFromObj=_.substring(7).trim(),!this._isFirstMaterial||!this._hasMeshes){this._addPreviousObjMesh();b={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,colors:void 0,materialName:this._materialNameFromObj};this._increment++,this._meshesFromObj.push(b),this._hasMeshes=!0}this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)}else e.MtlLibGroupDescriptor.test(_)?s(_.substring(7).trim()):e.SmoothDescriptor.test(_)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._handledMesh.normals=this._unwrappedNormalsForBabylon,this._handledMesh.uvs=this._unwrappedUVForBabylon,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon)),!this._hasMeshes){var A=null;if(this._indicesForBabylon.length)this._indicesForBabylon.reverse(),this._unwrapData();else{for(var E=0,T=this._positions;E<T.length;E++){var x=T[E];this._unwrappedPositionsForBabylon.push(x.x,x.y,x.z)}if(this._normals.length)for(var C=0,S=this._normals;C<S.length;C++){var P=S[C];this._unwrappedNormalsForBabylon.push(P.x,P.y,P.z)}if(this._uvs.length)for(var O=0,M=this._uvs;O<M.length;O++){var L=M[O];this._unwrappedUVForBabylon.push(L.x,L.y)}if(this._colors.length)for(var F=0,N=this._colors;F<N.length;F++){var w=N[F];this._unwrappedColorsForBabylon.push(w.r,w.g,w.b,w.a)}this._materialNameFromObj||((A=new i.K(c.Z.RandomId(),o)).pointsCloud=!0,this._materialNameFromObj=A.name,this._normals.length||(A.disableLighting=!0,A.emissiveColor=r.Wo.White()))}this._meshesFromObj.push({name:c.Z.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:A})}for(var I=0;I<this._meshesFromObj.length;I++){if(t&&this._meshesFromObj[I].name)if(t instanceof Array){if(-1===t.indexOf(this._meshesFromObj[I].name))continue}else if(this._meshesFromObj[I].name!==t)continue;this._handledMesh=this._meshesFromObj[I],o._blockEntityCollection=!!a;var R=new u.Kj(this._meshesFromObj[I].name,o);if(R._parentContainer=a,o._blockEntityCollection=!1,this._materialToUse.push(this._meshesFromObj[I].materialName),0!==(null===(d=this._handledMesh.positions)||void 0===d?void 0:d.length)){var D=new f.x;if(D.uvs=this._handledMesh.uvs,D.indices=this._handledMesh.indices,D.positions=this._handledMesh.positions,this._loadingOptions.computeNormals){var B=new Array;f.x.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,B),D.normals=B}else D.normals=this._handledMesh.normals;this._loadingOptions.importVertexColors&&(D.colors=this._handledMesh.colors),D.applyToMesh(R),this._loadingOptions.invertY&&(R.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(R),this._babylonMeshesArray.push(R),this._handledMesh.directMaterial&&(R.material=this._handledMesh.directMaterial)}else this._babylonMeshesArray.push(R)}},e.ObjectDescriptor=/^o/,e.GroupDescriptor=/^g/,e.MtlLibGroupDescriptor=/^mtllib /,e.UseMtlDescriptor=/^usemtl /,e.SmoothDescriptor=/^s /,e.VertexPattern=/v(\s+[\d|.|+|\-|e|E]+){3,7}/,e.NormalPattern=/vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,e.UVPattern=/vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,e.FacePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,e.FacePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,e.FacePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,e.FacePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,e.FacePattern5=/f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,e}(),h=n(13514),p=n(63407),_=n(7701),m=function(){function e(t){this.name="obj",this.extensions=".obj",this._assetContainer=null,this._loadingOptions=t||e._DefaultLoadingOptions}return Object.defineProperty(e,"INVERT_TEXTURE_Y",{get:function(){return a.INVERT_TEXTURE_Y},set:function(e){a.INVERT_TEXTURE_Y=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"_DefaultLoadingOptions",{get:function(){return{computeNormals:e.COMPUTE_NORMALS,optimizeNormals:e.OPTIMIZE_NORMALS,importVertexColors:e.IMPORT_VERTEX_COLORS,invertY:e.INVERT_Y,invertTextureY:e.INVERT_TEXTURE_Y,UVScaling:e.UV_SCALING,materialLoadingFailsSilently:e.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:e.OPTIMIZE_WITH_UV,skipMaterials:e.SKIP_MATERIALS}},enumerable:!1,configurable:!0}),e.prototype._loadMTL=function(e,t,n,r){var o=t+e;h.w1.LoadFile(o,n,void 0,void 0,!1,(function(e,t){r(o,t)}))},e.prototype.createPlugin=function(){return new e(e._DefaultLoadingOptions)},e.prototype.canDirectLoad=function(){return!1},e.prototype.importMeshAsync=function(e,t,n,r){return this._parseSolid(e,t,n,r).then((function(e){return{meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[]}}))},e.prototype.loadAsync=function(e,t,n){return this.importMeshAsync(null,e,t,n).then((function(){}))},e.prototype.loadAssetContainerAsync=function(e,t,n){var r=this,o=new _.TJ(e);return this._assetContainer=o,this.importMeshAsync(null,e,t,n).then((function(e){return e.meshes.forEach((function(e){return o.meshes.push(e)})),e.meshes.forEach((function(e){var t=e.material;t&&(-1==o.materials.indexOf(t)&&(o.materials.push(t),t.getActiveTextures().forEach((function(e){-1==o.textures.indexOf(e)&&o.textures.push(e)}))))})),r._assetContainer=null,o})).catch((function(e){throw r._assetContainer=null,e}))},e.prototype._parseSolid=function(e,t,n,r){var o=this,i="",s=new a,l=new Array,c=[];new d(l,c,this._loadingOptions).parse(e,n,t,this._assetContainer,(function(e){i=e}));var u=[];return""===i||this._loadingOptions.skipMaterials||u.push(new Promise((function(e,n){o._loadMTL(i,r,(function(a){try{s.parseMTL(t,a,r,o._assetContainer);for(var u=0;u<s.materials.length;u++){for(var f=0,d=[],p=void 0;(p=l.indexOf(s.materials[u].name,f))>-1;)d.push(p),f=p+1;if(-1===p&&0===d.length)s.materials[u].dispose();else for(var _=0;_<d.length;_++){var m=c[d[_]],v=s.materials[u];m.material=v,m.getTotalIndices()||(v.pointsCloud=!0)}}e()}catch(t){h.w1.Warn("Error processing MTL file: '".concat(i,"'")),o._loadingOptions.materialLoadingFailsSilently?e():n(t)}}),(function(t,r){h.w1.Warn("Error downloading MTL file: '".concat(i,"'")),o._loadingOptions.materialLoadingFailsSilently?e():n(r)}))}))),Promise.all(u).then((function(){return c}))},e.OPTIMIZE_WITH_UV=!0,e.INVERT_Y=!1,e.IMPORT_VERTEX_COLORS=!1,e.COMPUTE_NORMALS=!1,e.OPTIMIZE_NORMALS=!1,e.UV_SCALING=new l.FM(1,1),e.SKIP_MATERIALS=!1,e.MATERIAL_LOADING_FAILS_SILENTLY=!0,e}();p.n&&p.n.RegisterPlugin(new m)},5515:(e,t,n)=>{n.d(t,{a:()=>l});var r=n(13514),o=n(72208),i=n(91243),a=n(63407),s=n(7701),l=function(){function e(){this.solidPattern=/solid (\S*)([\S\s]*?)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.name="stl",this.extensions={".stl":{isBinary:!0}}}return e.prototype.importMesh=function(e,t,n,o,a){var s;if("string"!=typeof n){if(this._isBinary(n)){var l=new i.Kj("stlmesh",t);return this._parseBinary(l,n),a&&a.push(l),!0}for(var c=new Uint8Array(n),u="",f=0;f<n.byteLength;f++)u+=String.fromCharCode(c[f]);n=u}for(;s=this.solidPattern.exec(n);){var d=s[1];if(d!=s[3])return r.w1.Error("Error in STL, solid name != endsolid name"),!1;if(e&&d)if(e instanceof Array){if(!e.indexOf(d))continue}else if(d!==e)continue;d=d||"stlmesh";l=new i.Kj(d,t);this._parseASCII(l,s[2]),a&&a.push(l)}return!0},e.prototype.load=function(e,t,n){return this.importMesh(null,e,t,n,null)},e.prototype.loadAssetContainer=function(e,t,n){var r=new s.TJ(e);return e._blockEntityCollection=!0,this.importMesh(null,e,t,n,r.meshes),e._blockEntityCollection=!1,r},e.prototype._isBinary=function(e){var t=new DataView(e);if(t.byteLength<=80)return!1;if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;for(var n=t.byteLength,r=0;r<n;r++)if(t.getUint8(r)>127)return!0;return!1},e.prototype._parseBinary=function(t,n){for(var r=new DataView(n),i=r.getUint32(80,!0),a=0,s=new Float32Array(3*i*3),l=new Float32Array(3*i*3),c=new Uint32Array(3*i),u=0,f=0;f<i;f++){for(var d=84+50*f,h=r.getFloat32(d,!0),p=r.getFloat32(d+4,!0),_=r.getFloat32(d+8,!0),m=1;m<=3;m++){var v=d+12*m;s[a]=r.getFloat32(v,!0),l[a]=h,e.DO_NOT_ALTER_FILE_COORDINATES?(s[a+1]=r.getFloat32(v+4,!0),s[a+2]=r.getFloat32(v+8,!0),l[a+1]=p,l[a+2]=_):(s[a+2]=r.getFloat32(v+4,!0),s[a+1]=r.getFloat32(v+8,!0),l[a+2]=p,l[a+1]=_),a+=3}c[u]=u++,c[u]=u++,c[u]=u++}t.setVerticesData(o.o.PositionKind,s),t.setVerticesData(o.o.NormalKind,l),t.setIndices(c),t.computeWorldMatrix(!0)},e.prototype._parseASCII=function(t,n){for(var r,i=[],a=[],s=[],l=0;r=this.facetsPattern.exec(n);){var c=r[1],u=this.normalPattern.exec(c);if(this.normalPattern.lastIndex=0,u){for(var f=[Number(u[1]),Number(u[5]),Number(u[3])],d=void 0;d=this.vertexPattern.exec(c);)e.DO_NOT_ALTER_FILE_COORDINATES?(i.push(Number(d[1]),Number(d[3]),Number(d[5])),a.push(f[0],f[2],f[1])):(i.push(Number(d[1]),Number(d[5]),Number(d[3])),a.push(f[0],f[1],f[2]));s.push(l++,l++,l++),this.vertexPattern.lastIndex=0}}this.facetsPattern.lastIndex=0,t.setVerticesData(o.o.PositionKind,i),t.setVerticesData(o.o.NormalKind,a),t.setIndices(s),t.computeWorldMatrix(!0)},e.DO_NOT_ALTER_FILE_COORDINATES=!1,e}();a.n&&a.n.RegisterPlugin(new l)},58603:(e,t,n)=>{n.d(t,{ms:()=>r,VW:()=>o,ey:()=>b,B2:()=>p,em:()=>h,zA:()=>_,JM:()=>m});var r={};n.r(r),n.d(r,{EBlendingFunction:()=>O,EComponentType:()=>A,ECullingType:()=>P,EParameterType:()=>T,EShaderType:()=>E,ETextureFilterType:()=>C,ETextureFormat:()=>S,ETextureWrapMode:()=>x,GLTFBinaryExtension:()=>Pe,GLTFLoader:()=>Ce,GLTFLoaderBase:()=>xe,GLTFLoaderExtension:()=>Se,GLTFMaterialsCommonExtension:()=>Oe,GLTFUtils:()=>ee});var o={};n.r(o),n.d(o,{ArrayItem:()=>Be,EXT_lights_image_based:()=>He,EXT_mesh_gpu_instancing:()=>Ke,EXT_meshopt_compression:()=>qe,EXT_texture_webp:()=>Ze,ExtrasAsMetadata:()=>Yt,GLTFLoader:()=>Ve,KHR_draco_mesh_compression:()=>$e,KHR_lights:()=>nt,KHR_materials_clearcoat:()=>lt,KHR_materials_emissive_strength:()=>dt,KHR_materials_ior:()=>yt,KHR_materials_iridescence:()=>ut,KHR_materials_pbrSpecularGlossiness:()=>ot,KHR_materials_sheen:()=>pt,KHR_materials_specular:()=>mt,KHR_materials_translucency:()=>St,KHR_materials_transmission:()=>xt,KHR_materials_unlit:()=>at,KHR_materials_variants:()=>bt,KHR_materials_volume:()=>Ot,KHR_mesh_quantization:()=>Lt,KHR_texture_basisu:()=>Nt,KHR_texture_transform:()=>It,KHR_xmp_json_ld:()=>Dt,MSFT_audio_emitter:()=>kt,MSFT_lod:()=>Ht,MSFT_minecraftMesh:()=>Kt,MSFT_sRGBFactors:()=>Xt});var i=n(62897),a=n(13514),s=n(63407),l=n(7701),c=n(84318),u=n(21879);function f(e,t,n,r){var o={externalResourceFunction:function(e){return r(e).then((function(e){return new Uint8Array(e)}))}};return n&&(o.uri="file:"===t?n:t+n),e instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(e),o):GLTFValidator.validateString(e,o)}function d(){var e=[];onmessage=function(t){var n=t.data;switch(n.id){case"init":importScripts(n.url);break;case"validate":f(n.data,n.rootUrl,n.fileName,(function(t){return new Promise((function(n,r){var o=e.length;e.push({resolve:n,reject:r}),postMessage({id:"getExternalResource",index:o,uri:t})}))})).then((function(e){postMessage({id:"validate.resolve",value:e})}),(function(e){postMessage({id:"validate.reject",reason:e})}));break;case"getExternalResource.resolve":e[n.index].resolve(n.value);break;case"getExternalResource.reject":e[n.index].reject(n.reason)}}}var h,p,_,m=function(){function e(){}return e.ValidateAsync=function(e,t,n,r){var o=this;return"function"==typeof Worker?new Promise((function(i,a){var s="".concat(f,"(").concat(d,")()"),l=URL.createObjectURL(new Blob([s],{type:"application/javascript"})),c=new Worker(l),u=function(e){c.removeEventListener("error",u),c.removeEventListener("message",h),a(e)},h=function(e){var t=e.data;switch(t.id){case"getExternalResource":r(t.uri).then((function(e){c.postMessage({id:"getExternalResource.resolve",index:t.index,value:e},[e])}),(function(e){c.postMessage({id:"getExternalResource.reject",index:t.index,reason:e})}));break;case"validate.resolve":c.removeEventListener("error",u),c.removeEventListener("message",h),i(t.value),c.terminate();break;case"validate.reject":c.removeEventListener("error",u),c.removeEventListener("message",h),a(t.reason),c.terminate()}};c.addEventListener("error",u),c.addEventListener("message",h),c.postMessage({id:"init",url:o.Configuration.url}),c.postMessage({id:"validate",data:e,rootUrl:t,fileName:n})})):(this._LoadScriptPromise||(this._LoadScriptPromise=a.w1.LoadScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((function(){return f(e,t,n,r)})))},e.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"},e}(),v=n(79245),y=n(46223);function g(e,t,n){try{return Promise.resolve(new Uint8Array(e,t,n))}catch(e){return Promise.reject(e)}}!function(e){e[e.AUTO=0]="AUTO",e[e.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(h||(h={})),function(e){e[e.NONE=0]="NONE",e[e.FIRST=1]="FIRST",e[e.ALL=2]="ALL"}(p||(p={})),function(e){e[e.LOADING=0]="LOADING",e[e.READY=1]="READY",e[e.COMPLETE=2]="COMPLETE"}(_||(_={}));var b=function(){function e(){this.onParsedObservable=new i.y$,this.coordinateSystemMode=h.AUTO,this.animationStartMode=p.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.onMeshLoadedObservable=new i.y$,this.onSkinLoadedObservable=new i.y$,this.onTextureLoadedObservable=new i.y$,this.onMaterialLoadedObservable=new i.y$,this.onCameraLoadedObservable=new i.y$,this.onCompleteObservable=new i.y$,this.onErrorObservable=new i.y$,this.onDisposeObservable=new i.y$,this.onExtensionLoadedObservable=new i.y$,this.validate=!1,this.onValidatedObservable=new i.y$,this._loader=null,this._state=null,this._requests=new Array,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this.onLoaderStateChangedObservable=new i.y$,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(e.prototype,"onParsed",{set:function(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMeshLoaded",{set:function(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onTextureLoaded",{set:function(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMaterialLoaded",{set:function(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onCameraLoaded",{set:function(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{set:function(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{set:function(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onExtensionLoaded",{set:function(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onValidated",{set:function(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null);for(var e=0,t=this._requests;e<t.length;e++){t[e].abort()}this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},e.prototype.loadFile=function(e,t,n,r,o,s){var l=this;this._progressCallback=r;var f=t.name?"file:":a.w1.GetFolderPath(t),d=t.name||a.w1.GetFilename(t);if(o){if(this.useRangeRequests){this.validate&&c.Y.Warn("glTF validation is not supported when range requests are enabled");var h={abort:function(){},onCompleteObservable:new i.y$},p={readAsync:function(n,r){return new Promise((function(o,i){l._loadFile(e,t,(function(e){o(new Uint8Array(e))}),!0,(function(e){i(e)}),(function(e){e.setRequestHeader("Range","bytes=".concat(n,"-").concat(n+r-1))}))}))},byteLength:0};return this._unpackBinaryAsync(new u.d(p)).then((function(e){h.onCompleteObservable.notifyObservers(h),n(e)}),s?function(e){return s(void 0,e)}:void 0),h}return this._loadFile(e,t,(function(t){l._validate(e,t,f,d),l._unpackBinaryAsync(new u.d({readAsync:function(e,n){return g(t,e,n)},byteLength:t.byteLength})).then((function(e){n(e)}),s?function(e){return s(void 0,e)}:void 0)}),!0,s)}return this._loadFile(e,t,(function(t){l._validate(e,t,f,d),n({json:l._parseJson(t)})}),o,s)},e.prototype.importMeshAsync=function(e,t,n,r,o,i){var a=this;return Promise.resolve().then((function(){return a.onParsedObservable.notifyObservers(n),a.onParsedObservable.clear(),a._log("Loading ".concat(i||"")),a._loader=a._getLoader(n),a._loader.importMeshAsync(e,t,null,n,r,o,i)}))},e.prototype.loadAsync=function(e,t,n,r,o){var i=this;return Promise.resolve().then((function(){return i.onParsedObservable.notifyObservers(t),i.onParsedObservable.clear(),i._log("Loading ".concat(o||"")),i._loader=i._getLoader(t),i._loader.loadAsync(e,t,n,r,o)}))},e.prototype.loadAssetContainerAsync=function(e,t,n,r,o){var i=this;return Promise.resolve().then((function(){i.onParsedObservable.notifyObservers(t),i.onParsedObservable.clear(),i._log("Loading ".concat(o||"")),i._loader=i._getLoader(t);var a=new l.TJ(e),s=[];i.onMaterialLoadedObservable.add((function(e){s.push(e)}));var c=[];i.onTextureLoadedObservable.add((function(e){c.push(e)}));var u=[];return i.onCameraLoadedObservable.add((function(e){u.push(e)})),i._loader.importMeshAsync(null,e,a,t,n,r,o).then((function(e){return Array.prototype.push.apply(a.geometries,e.geometries),Array.prototype.push.apply(a.meshes,e.meshes),Array.prototype.push.apply(a.particleSystems,e.particleSystems),Array.prototype.push.apply(a.skeletons,e.skeletons),Array.prototype.push.apply(a.animationGroups,e.animationGroups),Array.prototype.push.apply(a.materials,s),Array.prototype.push.apply(a.textures,c),Array.prototype.push.apply(a.lights,e.lights),Array.prototype.push.apply(a.transformNodes,e.transformNodes),Array.prototype.push.apply(a.cameras,u),a}))}))},e.prototype.canDirectLoad=function(t){return-1!==t.indexOf("asset")&&-1!==t.indexOf("version")||t.startsWith("data:base64,"+e._MagicBase64Encoded)||t.startsWith("data:;base64,"+e._MagicBase64Encoded)||t.startsWith("data:application/octet-stream;base64,"+e._MagicBase64Encoded)||t.startsWith("data:model/gltf-binary;base64,"+e._MagicBase64Encoded)},e.prototype.directLoad=function(t,n){if(n.startsWith("base64,"+e._MagicBase64Encoded)||n.startsWith(";base64,"+e._MagicBase64Encoded)||n.startsWith("application/octet-stream;base64,"+e._MagicBase64Encoded)||n.startsWith("model/gltf-binary;base64,"+e._MagicBase64Encoded)){var r=(0,v.$K)(n);return this._validate(t,r),this._unpackBinaryAsync(new u.d({readAsync:function(e,t){return g(r,e,t)},byteLength:r.byteLength}))}return this._validate(t,n),Promise.resolve({json:this._parseJson(n)})},e.prototype.createPlugin=function(){return new e},Object.defineProperty(e.prototype,"loaderState",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.whenCompleteAsync=function(){var e=this;return new Promise((function(t,n){e.onCompleteObservable.addOnce((function(){t()})),e.onErrorObservable.addOnce((function(e){n(e)}))}))},e.prototype._setState=function(e){this._state!==e&&(this._state=e,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(_[this._state]))},e.prototype._loadFile=function(e,t,n,r,o,i){var a=this,s=e._loadFile(t,n,(function(e){a._onProgress(e,s)}),!0,r,o,i);return s.onCompleteObservable.add((function(e){a._requests.splice(a._requests.indexOf(e),1)})),this._requests.push(s),s},e.prototype._onProgress=function(e,t){if(this._progressCallback){t._lengthComputable=e.lengthComputable,t._loaded=e.loaded,t._total=e.total;for(var n=!0,r=0,o=0,i=0,a=this._requests;i<a.length;i++){var s=a[i];if(void 0===s._lengthComputable||void 0===s._loaded||void 0===s._total)return;n=n&&s._lengthComputable,r+=s._loaded,o+=s._total}this._progressCallback({lengthComputable:n,loaded:r,total:n?o:0})}},e.prototype._validate=function(e,t,n,r){var o=this;void 0===n&&(n=""),void 0===r&&(r=""),this.validate&&(this._startPerformanceCounter("Validate JSON"),m.ValidateAsync(t,n,r,(function(t){return o.preprocessUrlAsync(n+t).then((function(t){return e._loadFileAsync(t,void 0,!0,!0)}))})).then((function(e){o._endPerformanceCounter("Validate JSON"),o.onValidatedObservable.notifyObservers(e),o.onValidatedObservable.clear()}),(function(e){o._endPerformanceCounter("Validate JSON"),a.w1.Warn("Failed to validate: ".concat(e.message)),o.onValidatedObservable.clear()})))},e.prototype._getLoader=function(t){var n=t.json.asset||{};this._log("Asset version: ".concat(n.version)),n.minVersion&&this._log("Asset minimum version: ".concat(n.minVersion)),n.generator&&this._log("Asset generator: ".concat(n.generator));var r=e._parseVersion(n.version);if(!r)throw new Error("Invalid version: "+n.version);if(void 0!==n.minVersion){var o=e._parseVersion(n.minVersion);if(!o)throw new Error("Invalid minimum version: "+n.minVersion);if(e._compareVersion(o,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+n.minVersion)}var i={1:e._CreateGLTF1Loader,2:e._CreateGLTF2Loader}[r.major];if(!i)throw new Error("Unsupported version: "+n.version);return i(this)},e.prototype._parseJson=function(e){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: ".concat(e.length));var t=JSON.parse(e);return this._endPerformanceCounter("Parse JSON"),t},e.prototype._unpackBinaryAsync=function(e){var t=this;return this._startPerformanceCounter("Unpack Binary"),e.loadAsync(20).then((function(){var n=e.readUint32();if(1179937895!==n)throw new y.LH("Unexpected magic: "+n,y.SM.GLTFLoaderUnexpectedMagicError);var r=e.readUint32();t.loggingEnabled&&t._log("Binary version: ".concat(r));var o,i=e.readUint32();if(0!==e.buffer.byteLength&&i!==e.buffer.byteLength)throw new Error("Length in header does not match actual data length: ".concat(i," != ").concat(e.buffer.byteLength));switch(r){case 1:o=t._unpackBinaryV1Async(e,i);break;case 2:o=t._unpackBinaryV2Async(e,i);break;default:throw new Error("Unsupported version: "+r)}return t._endPerformanceCounter("Unpack Binary"),o}))},e.prototype._unpackBinaryV1Async=function(e,t){var n=e.readUint32(),r=e.readUint32();if(0!==r)throw new Error("Unexpected content format: ".concat(r));var o=t-e.byteOffset,i={json:this._parseJson(e.readString(n)),bin:null};if(0!==o){var a=e.byteOffset;i.bin={readAsync:function(t,n){return e.buffer.readAsync(a+t,n)},byteLength:o}}return Promise.resolve(i)},e.prototype._unpackBinaryV2Async=function(e,t){var n=this,r=1313821514,o=5130562,i=e.readUint32();if(e.readUint32()!==r)throw new Error("First chunk format is not JSON");return e.byteOffset+i===t?e.loadAsync(i).then((function(){return{json:n._parseJson(e.readString(i)),bin:null}})):e.loadAsync(i+8).then((function(){var a={json:n._parseJson(e.readString(i)),bin:null},s=function(){var n=e.readUint32();switch(e.readUint32()){case r:throw new Error("Unexpected JSON chunk");case o:var i=e.byteOffset;a.bin={readAsync:function(t,n){return e.buffer.readAsync(i+t,n)},byteLength:n},e.skipBytes(n);break;default:e.skipBytes(n)}return e.byteOffset!==t?e.loadAsync(8).then(s):Promise.resolve(a)};return s()}))},e._parseVersion=function(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};var t=(e+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null},e._compareVersion=function(e,t){return e.major>t.major?1:e.major<t.major?-1:e.minor>t.minor?1:e.minor<t.minor?-1:0},e.prototype._logOpen=function(e){this._log(e),this._logIndentLevel++},e.prototype._logClose=function(){--this._logIndentLevel},e.prototype._logEnabled=function(t){var n=e._logSpaces.substr(0,2*this._logIndentLevel);c.Y.Log("".concat(n).concat(t))},e.prototype._logDisabled=function(e){},e.prototype._startPerformanceCounterEnabled=function(e){a.w1.StartPerformanceCounter(e)},e.prototype._startPerformanceCounterDisabled=function(e){},e.prototype._endPerformanceCounterEnabled=function(e){a.w1.EndPerformanceCounter(e)},e.prototype._endPerformanceCounterDisabled=function(e){},e.IncrementalLoading=!0,e.HomogeneousCoordinates=!1,e._MagicBase64Encoded="Z2xURg",e._logSpaces="                                ",e}();s.n&&s.n.RegisterPlugin(new b);var A,E,T,x,C,S,P,O,M=n(31191);!function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.FLOAT=5126]="FLOAT"}(A||(A={})),function(e){e[e.FRAGMENT=35632]="FRAGMENT",e[e.VERTEX=35633]="VERTEX"}(E||(E={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D"}(T||(T={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.REPEAT=10497]="REPEAT"}(x||(x={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9728]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(C||(C={})),function(e){e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"}(S||(S={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(P||(P={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(O||(O={}));var L,F=n(58095),N=n(15631),w=n(2055),I=n(78098),R=n(18770),D=n(48017),B=n(52106),V=n(9256),U=n(98163),G=n(91855),k=n(3085),W=n(54067),H=n(73803),j=n(89209),K=n(72208),z=n(63946),X=n(68345),q=n(71419),Y=n(91243),Z=n(51356),Q=n(258),J=n(65064),$=n(96761),ee=function(){function e(){}return e.SetMatrix=function(e,t,n,r,o){var i=null;if("MODEL"===n.semantic?i=t.getWorldMatrix():"PROJECTION"===n.semantic?i=e.getProjectionMatrix():"VIEW"===n.semantic?i=e.getViewMatrix():"MODELVIEWINVERSETRANSPOSE"===n.semantic?i=F.y3.Transpose(t.getWorldMatrix().multiply(e.getViewMatrix()).invert()):"MODELVIEW"===n.semantic?i=t.getWorldMatrix().multiply(e.getViewMatrix()):"MODELVIEWPROJECTION"===n.semantic?i=t.getWorldMatrix().multiply(e.getTransformMatrix()):"MODELINVERSE"===n.semantic?i=t.getWorldMatrix().invert():"VIEWINVERSE"===n.semantic?i=e.getViewMatrix().invert():"PROJECTIONINVERSE"===n.semantic?i=e.getProjectionMatrix().invert():"MODELVIEWINVERSE"===n.semantic?i=t.getWorldMatrix().multiply(e.getViewMatrix()).invert():"MODELVIEWPROJECTIONINVERSE"===n.semantic?i=t.getWorldMatrix().multiply(e.getTransformMatrix()).invert():"MODELINVERSETRANSPOSE"===n.semantic&&(i=F.y3.Transpose(t.getWorldMatrix().invert())),i)switch(n.type){case T.FLOAT_MAT2:o.setMatrix2x2(r,F.y3.GetAsMatrix2x2(i));break;case T.FLOAT_MAT3:o.setMatrix3x3(r,F.y3.GetAsMatrix3x3(i));break;case T.FLOAT_MAT4:o.setMatrix(r,i)}},e.SetUniform=function(e,t,n,r){switch(r){case T.FLOAT:return e.setFloat(t,n),!0;case T.FLOAT_VEC2:return e.setVector2(t,F.FM.FromArray(n)),!0;case T.FLOAT_VEC3:return e.setVector3(t,F.P.FromArray(n)),!0;case T.FLOAT_VEC4:return e.setVector4(t,F.Lt.FromArray(n)),!0;default:return!1}},e.GetWrapMode=function(e){switch(e){case x.CLAMP_TO_EDGE:return H.x.CLAMP_ADDRESSMODE;case x.MIRRORED_REPEAT:return H.x.MIRROR_ADDRESSMODE;case x.REPEAT:default:return H.x.WRAP_ADDRESSMODE}},e.GetByteStrideFromType=function(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}},e.GetTextureFilterMode=function(e){switch(e){case C.LINEAR:case C.LINEAR_MIPMAP_NEAREST:case C.LINEAR_MIPMAP_LINEAR:return H.x.TRILINEAR_SAMPLINGMODE;case C.NEAREST:case C.NEAREST_MIPMAP_NEAREST:return H.x.NEAREST_SAMPLINGMODE;default:return H.x.BILINEAR_SAMPLINGMODE}},e.GetBufferFromBufferView=function(e,t,n,r,o){n=t.byteOffset+n;var i=e.loadedBufferViews[t.buffer];if(n+r>i.byteLength)throw new Error("Buffer access is out of range");var a=i.buffer;switch(n+=i.byteOffset,o){case A.BYTE:return new Int8Array(a,n,r);case A.UNSIGNED_BYTE:return new Uint8Array(a,n,r);case A.SHORT:return new Int16Array(a,n,r);case A.UNSIGNED_SHORT:return new Uint16Array(a,n,r);default:return new Float32Array(a,n,r)}},e.GetBufferFromAccessor=function(t,n){var r=t.bufferViews[n.bufferView],o=n.count*e.GetByteStrideFromType(n);return e.GetBufferFromBufferView(t,r,n.byteOffset,o,n.componentType)},e.DecodeBufferToText=function(e){for(var t="",n=e.byteLength,r=0;r<n;++r)t+=String.fromCharCode(e[r]);return t},e.GetDefaultMaterial=function(t){if(!e._DefaultMaterial){V.Q.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n"),V.Q.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join("\n");var n={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array,needAlphaBlending:!1};e._DefaultMaterial=new W.j("GLTFDefaultMaterial",t,{vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},n),e._DefaultMaterial.setColor4("u_emission",new N.HE(.5,.5,.5,1))}return e._DefaultMaterial},e._DefaultMaterial=null,e}(),te=n(34941);!function(e){e[e.IDENTIFIER=1]="IDENTIFIER",e[e.UNKNOWN=2]="UNKNOWN",e[e.END_OF_INPUT=3]="END_OF_INPUT"}(L||(L={}));var ne=function(){function e(e){this._pos=0,this.currentToken=L.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=e,this._maxPos=e.length}return e.prototype.getNextToken=function(){if(this.isEnd())return L.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=L.UNKNOWN,"_"===this.currentString||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=L.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||"_"===this.currentString);)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken},e.prototype.peek=function(){return this._toParse[this._pos]},e.prototype.read=function(){return this._toParse[this._pos++]},e.prototype.forward=function(){this._pos++},e.prototype.isEnd=function(){return this._pos>=this._maxPos},e}(),re=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],oe=["world","view","projection","worldView","worldViewProjection","mBones"],ie=["translation","rotation","scale"],ae=["position","rotationQuaternion","scaling"],se=function(e,t,n){for(var r in e){var o=e[r];n[t][r]=o}},le=function(e){if(e)for(var t=0;t<e.length/2;t++)e[2*t+1]=1-e[2*t+1]},ce=function(e){if("NORMAL"===e.semantic)return"normal";if("POSITION"===e.semantic)return"position";if("JOINT"===e.semantic)return"matricesIndices";if("WEIGHT"===e.semantic)return"matricesWeights";if("COLOR"===e.semantic)return"color";if(e.semantic&&-1!==e.semantic.indexOf("TEXCOORD_")){var t=Number(e.semantic.split("_")[1]);return"uv"+(0===t?"":t+1)}return null},ue=function(e){var t=null;if(e.translation||e.rotation||e.scale){var n=F.P.FromArray(e.scale||[1,1,1]),r=F._f.FromArray(e.rotation||[0,0,0,1]),o=F.P.FromArray(e.translation||[0,0,0]);t=F.y3.Compose(n,r,o)}else t=F.y3.FromArray(e.matrix);return t},fe=function(e,t,n,r){for(var o=0;o<r.bones.length;o++)if(r.bones[o].name===n)return r.bones[o];var i=e.nodes;for(var a in i){var s=i[a];if(s.jointName){var l=s.children;for(o=0;o<l.length;o++){var c=e.nodes[l[o]];if(c.jointName&&c.jointName===n){var u=ue(s),f=new D.N(s.name||"",r,fe(e,t,s.jointName,r),u);return f.id=a,f}}}}return null},de=function(e,t){for(var n=0;n<e.length;n++)for(var r=e[n],o=0;o<r.node.children.length;o++){if(r.node.children[o]===t)return r.bone}return null},he=function(e,t){var n=e.nodes,r=n[t];if(r)return{node:r,id:t};for(var o in n)if((r=n[o]).jointName===t)return{node:r,id:o};return null},pe=function(e,t){for(var n=0;n<e.jointNames.length;n++)if(e.jointNames[n]===t)return!0;return!1},_e=function(e,t,n,r){if(r||(r=new B.O(t.name||"","",e.scene)),!t.babylonSkeleton)return r;var o=[],i=[];!function(e,t,n,r){for(var o in e.nodes){var i=e.nodes[o],a=o;if(i.jointName&&!pe(n,i.jointName)){var s=ue(i),l=new D.N(i.name||"",t,null,s);l.id=a,r.push({bone:l,node:i,id:a})}}for(var c=0;c<r.length;c++)for(var u=r[c],f=u.node.children,d=0;d<f.length;d++){for(var h=null,p=0;p<r.length;p++)if(r[p].id===f[d]){h=r[p];break}h&&(h.bone._parent=u.bone,u.bone.children.push(h.bone))}}(e,r,t,o),r.bones=[];for(var s=0;s<t.jointNames.length;s++){if(b=he(e,t.jointNames[s])){var l=b.node;if(l){var c=b.id,u=e.scene.getBoneById(c);if(u)r.bones.push(u);else{for(var f=!1,d=null,h=0;h<s;h++){var p=he(e,t.jointNames[h]);if(p){var _=p.node;if(_){var m=_.children;if(m){f=!1;for(var v=0;v<m.length;v++)if(m[v]===c){d=fe(e,t,t.jointNames[h],r),f=!0;break}if(f)break}}else a.w1.Warn("Joint named "+t.jointNames[h]+" does not exist when looking for parent")}}var y=ue(l);!d&&o.length>0&&(d=de(o,c))&&-1===i.indexOf(d)&&i.push(d),new D.N(l.jointName||"",r,d,y).id=c}}else a.w1.Warn("Joint named "+t.jointNames[s]+" does not exist")}}var g=r.bones;r.bones=[];for(s=0;s<t.jointNames.length;s++){var b;if(b=he(e,t.jointNames[s]))for(h=0;h<g.length;h++)if(g[h].id===b.id){r.bones.push(g[h]);break}}r.prepare();for(s=0;s<i.length;s++)r.bones.push(i[s]);return r},me=function(e,t,n,r,o){if(o||(e.scene._blockEntityCollection=!!e.assetContainer,(o=new Y.Kj(t.name||"",e.scene))._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,o.id=r),!t.babylonNode)return o;for(var i,a=[],s=null,l=new Array,c=new Array,u=new Array,f=new Array,d=0;d<n.length;d++){var h=n[d];if(M=e.meshes[h])for(var p=0;p<M.primitives.length;p++){var _=new j.x,m=M.primitives[p];m.mode;var v=m.attributes,y=null,g=null;for(var A in v)if(y=e.accessors[v[A]],g=ee.GetBufferFromAccessor(e,y),"NORMAL"===A)_.normals=new Float32Array(g.length),_.normals.set(g);else if("POSITION"===A){if(b.HomogeneousCoordinates){_.positions=new Float32Array(g.length-g.length/4);for(var E=0;E<g.length;E+=4)_.positions[E]=g[E],_.positions[E+1]=g[E+1],_.positions[E+2]=g[E+2]}else _.positions=new Float32Array(g.length),_.positions.set(g);c.push(_.positions.length)}else if(-1!==A.indexOf("TEXCOORD_")){var T=Number(A.split("_")[1]),x=K.o.UVKind+(0===T?"":T+1),C=new Float32Array(g.length);C.set(g),le(C),_.set(C,x)}else"JOINT"===A?(_.matricesIndices=new Float32Array(g.length),_.matricesIndices.set(g)):"WEIGHT"===A?(_.matricesWeights=new Float32Array(g.length),_.matricesWeights.set(g)):"COLOR"===A&&(_.colors=new Float32Array(g.length),_.colors.set(g));if(y=e.accessors[m.indices])g=ee.GetBufferFromAccessor(e,y),_.indices=new Int32Array(g.length),_.indices.set(g),f.push(_.indices.length);else{var S=[];for(E=0;E<_.positions.length/3;E++)S.push(E);_.indices=new Int32Array(S),f.push(_.indices.length)}s?s.merge(_):s=_;var P=e.scene.getMaterialById(m.material);a.push(null===P?ee.GetDefaultMaterial(e.scene):P),l.push(0===l.length?0:l[l.length-1]+c[c.length-2]),u.push(0===u.length?0:u[u.length-1]+f[f.length-2])}}e.scene._blockEntityCollection=!!e.assetContainer,a.length>1?(i=new G.G("multimat"+r,e.scene)).subMaterials=a:i=new k.K("multimat"+r,e.scene),1===a.length&&(i=a[0]),i._parentContainer=e.assetContainer,o.material||(o.material=i),new z.Z(r,e.scene,s,!1,o),o.computeWorldMatrix(!0),e.scene._blockEntityCollection=!1,o.subMeshes=[];var O=0;for(d=0;d<n.length;d++){var M;h=n[d];if(M=e.meshes[h])for(p=0;p<M.primitives.length;p++)M.primitives[p].mode,X.P.AddToMesh(O,l[O],c[O],u[O],f[O],o,o,!0),O++}return o},ve=function(e,t,n,r){e.position&&(e.position=t),(e.rotationQuaternion||e.rotation)&&(e.rotationQuaternion=n),e.scaling&&(e.scaling=r)},ye=function(e,t,n){var r=null;if(e.importOnlyMeshes&&(t.skin||t.meshes)&&e.importMeshesNames&&e.importMeshesNames.length>0&&-1===e.importMeshesNames.indexOf(t.name||""))return null;if(t.skin){if(t.meshes){var o=e.skins[t.skin];(i=me(e,t,t.meshes,n,t.babylonNode)).skeleton=e.scene.getLastSkeletonById(t.skin),null===i.skeleton&&(i.skeleton=_e(e,o,0,o.babylonSkeleton),o.babylonSkeleton||(o.babylonSkeleton=i.skeleton)),r=i}}else if(t.meshes){var i;r=i=me(e,t,t.mesh?[t.mesh]:t.meshes,n,t.babylonNode)}else if(!t.light||t.babylonNode||e.importOnlyMeshes){if(t.camera&&!t.babylonNode&&!e.importOnlyMeshes){var a=e.cameras[t.camera];if(a){if(e.scene._blockEntityCollection=!!e.assetContainer,"orthographic"===a.type){var s=new I.c(t.camera,F.P.Zero(),e.scene,!1);s.name=t.name||"",s.mode=w.V.ORTHOGRAPHIC_CAMERA,s.attachControl(),r=s,s._parentContainer=e.assetContainer}else if("perspective"===a.type){var l=a[a.type],c=new I.c(t.camera,F.P.Zero(),e.scene,!1);c.name=t.name||"",c.attachControl(),l.aspectRatio||(l.aspectRatio=e.scene.getEngine().getRenderWidth()/e.scene.getEngine().getRenderHeight()),l.znear&&l.zfar&&(c.maxZ=l.zfar,c.minZ=l.znear),r=c,c._parentContainer=e.assetContainer}e.scene._blockEntityCollection=!1}}}else{var u=e.lights[t.light];if(u)if("ambient"===u.type){var f=u[u.type],d=new Z.e(t.light,F.P.Zero(),e.scene);d.name=t.name||"",f.color&&(d.diffuse=N.Wo.FromArray(f.color)),r=d}else if("directional"===u.type){var h=u[u.type],p=new Q.O(t.light,F.P.Zero(),e.scene);p.name=t.name||"",h.color&&(p.diffuse=N.Wo.FromArray(h.color)),r=p}else if("point"===u.type){var _=u[u.type],m=new J.c(t.light,F.P.Zero(),e.scene);m.name=t.name||"",_.color&&(m.diffuse=N.Wo.FromArray(_.color)),r=m}else if("spot"===u.type){var v=u[u.type],y=new $.P(t.light,F.P.Zero(),F.P.Zero(),0,0,e.scene);y.name=t.name||"",v.color&&(y.diffuse=N.Wo.FromArray(v.color)),v.fallOfAngle&&(y.angle=v.fallOfAngle),v.fallOffExponent&&(y.exponent=v.fallOffExponent),r=y}}if(!t.jointName){if(t.babylonNode)return t.babylonNode;if(null===r){e.scene._blockEntityCollection=!!e.assetContainer;var g=new Y.Kj(t.name||"",e.scene);g._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,t.babylonNode=g,r=g}}if(null!==r){if(t.matrix&&r instanceof Y.Kj)!function(e,t){if(t.matrix){var n=new F.P(0,0,0),r=new F._f,o=new F.P(0,0,0);F.y3.FromArray(t.matrix).decompose(o,r,n),ve(e,n,r,o)}else t.translation&&t.rotation&&t.scale&&ve(e,F.P.FromArray(t.translation),F._f.FromArray(t.rotation),F.P.FromArray(t.scale));e.computeWorldMatrix(!0)}(r,t);else{var b=t.translation||[0,0,0],A=t.rotation||[0,0,0,1],E=t.scale||[1,1,1];ve(r,F.P.FromArray(b),F._f.FromArray(A),F.P.FromArray(E))}r.updateCache(!0),t.babylonNode=r}return r},ge=function(e,t,n,r){void 0===r&&(r=!1);var o=e.nodes[t],i=null;if(r=!(e.importOnlyMeshes&&!r&&e.importMeshesNames)||(-1!==e.importMeshesNames.indexOf(o.name||"")||0===e.importMeshesNames.length),!o.jointName&&r&&null!==(i=ye(e,o,t))&&(i.id=t,i.parent=n),o.children)for(var a=0;a<o.children.length;a++)ge(e,o.children[a],i,r)},be=function(e){var t=e.currentScene;if(t)for(var n=0;n<t.nodes.length;n++)ge(e,t.nodes[n],null);else for(var r in e.scenes){t=e.scenes[r];for(n=0;n<t.nodes.length;n++)ge(e,t.nodes[n],null)}!function(e){for(var t in e.animations){var n=e.animations[t];if(n.channels&&n.samplers)for(var r=null,o=0;o<n.channels.length;o++){var i=n.channels[o],s=n.samplers[i.sampler];if(s){var l=null,c=null;n.parameters?(l=n.parameters[s.input],c=n.parameters[s.output]):(l=s.input,c=s.output);var u=ee.GetBufferFromAccessor(e,e.accessors[l]),f=ee.GetBufferFromAccessor(e,e.accessors[c]),d=i.target.id,h=e.scene.getNodeById(d);if(null===h&&(h=e.scene.getNodeByName(d)),null!==h){var p=h instanceof D.N,_=i.target.path,m=ie.indexOf(_);-1!==m&&(_=ae[m]);var v=R.f.ANIMATIONTYPE_MATRIX;p||("rotationQuaternion"===_?(v=R.f.ANIMATIONTYPE_QUATERNION,h.rotationQuaternion=new F._f):v=R.f.ANIMATIONTYPE_VECTOR3);var y=null,g=[],b=0,A=!1;p&&r&&r.getKeys().length===u.length&&(y=r,A=!0),A||(e.scene._blockEntityCollection=!!e.assetContainer,y=new R.f(t,p?"_matrix":_,1,v,R.f.ANIMATIONLOOPMODE_CYCLE),e.scene._blockEntityCollection=!1);for(var E=0;E<u.length;E++){var T=null;if("rotationQuaternion"===_?(T=F._f.FromArray([f[b],f[b+1],f[b+2],f[b+3]]),b+=4):(T=F.P.FromArray([f[b],f[b+1],f[b+2]]),b+=3),p){var x=h,C=F.P.Zero(),S=new F._f,P=F.P.Zero(),O=x.getBaseMatrix();A&&r&&(O=r.getKeys()[E].value),O.decompose(P,S,C),"position"===_?C=T:"rotationQuaternion"===_?S=T:P=T,T=F.y3.Compose(P,S,C)}A?r&&(r.getKeys()[E].value=T):g.push({frame:u[E],value:T})}!A&&y&&(y.setKeys(g),h.animations.push(y)),r=y,e.scene.stopAnimation(h),e.scene.beginAnimation(h,0,u[u.length-1],!0,1)}else a.w1.Warn("Creating animation named "+t+". But cannot find node named "+d+" to attach to")}}}}(e);for(n=0;n<e.scene.skeletons.length;n++){var o=e.scene.skeletons[n];e.scene.beginAnimation(o,0,Number.MAX_VALUE,!0,1)}},Ae=function(e,t,n,r,o,i){return function(a){!function(e,t,n,r,o){var i=r.values||n.parameters,a=n.uniforms,s=function(n){var s=o[n],l=s.type,c=i[a[n]];if(void 0===c&&(c=s.value),!c)return"continue";var u=function(e){return function(n){s.value&&e&&(t.setTexture(e,n),delete o[e])}};l===T.SAMPLER_2D?Se.LoadTextureAsync(e,r.values?c:s.value,u(n),(function(){return u(null)})):s.value&&ee.SetUniform(t,n,r.values?c:s.value,l)&&delete o[n]};for(var l in o)s(l)}(e,t,n,r,o),t.onBind=function(a){!function(e,t,n,r,o,i,a){var s=i.values||o.parameters;for(var l in n){var c=n[l],u=c.type;if(u===T.FLOAT_MAT2||u===T.FLOAT_MAT3||u===T.FLOAT_MAT4)if(!c.semantic||c.source||c.node){if(c.semantic&&(c.source||c.node)){var f=t.scene.getNodeByName(c.source||c.node||"");if(null===f&&(f=t.scene.getNodeById(c.source||c.node||"")),null===f)continue;ee.SetMatrix(t.scene,f,c,l,r.getEffect())}}else ee.SetMatrix(t.scene,e,c,l,r.getEffect());else{var d=s[o.uniforms[l]];if(!d)continue;if(u===T.SAMPLER_2D){var h=t.textures[i.values?d:c.value].babylonTexture;if(null==h)continue;r.getEffect().setTexture(l,h)}else ee.SetUniform(r.getEffect(),l,d,u)}}a(r)}(a,e,o,t,n,r,i)}}},Ee=function(e,t,n){for(var r in t.uniforms){var o=t.uniforms[r],i=t.parameters[o];if(e.currentIdentifier===r&&i.semantic&&!i.source&&!i.node){var a=re.indexOf(i.semantic);if(-1!==a)return delete n[r],oe[a]}}return e.currentIdentifier},Te=function(e){for(var t in e.materials)Se.LoadMaterialAsync(e,t,(function(){}),(function(){}))},xe=function(){function e(){}return e.CreateRuntime=function(e,t,n){var r={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:t,rootUrl:n,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],assetContainer:null};return e.extensions&&se(e.extensions,"extensions",r),e.extensionsUsed&&se(e.extensionsUsed,"extensionsUsed",r),e.buffers&&function(e,t){for(var n in e){var r=e[n];t.buffers[n]=r,t.buffersCount++}}(e.buffers,r),e.bufferViews&&se(e.bufferViews,"bufferViews",r),e.accessors&&se(e.accessors,"accessors",r),e.meshes&&se(e.meshes,"meshes",r),e.lights&&se(e.lights,"lights",r),e.cameras&&se(e.cameras,"cameras",r),e.nodes&&se(e.nodes,"nodes",r),e.images&&se(e.images,"images",r),e.textures&&se(e.textures,"textures",r),e.shaders&&function(e,t){for(var n in e){var r=e[n];t.shaders[n]=r,t.shaderscount++}}(e.shaders,r),e.programs&&se(e.programs,"programs",r),e.samplers&&se(e.samplers,"samplers",r),e.techniques&&se(e.techniques,"techniques",r),e.materials&&se(e.materials,"materials",r),e.animations&&se(e.animations,"animations",r),e.skins&&se(e.skins,"skins",r),e.scenes&&(r.scenes=e.scenes),e.scene&&e.scenes&&(r.currentScene=e.scenes[e.scene]),r},e.LoadBufferAsync=function(e,t,n,r,o){var i=e.buffers[t];a.w1.IsBase64(i.uri)?setTimeout((function(){return n(new Uint8Array(a.w1.DecodeBase64(i.uri)))})):a.w1.LoadFile(e.rootUrl+i.uri,(function(e){return n(new Uint8Array(e))}),o,void 0,!0,(function(e){e&&r(e.status+" "+e.statusText)}))},e.LoadTextureBufferAsync=function(e,t,n,r){var o=e.textures[t];if(o&&o.source)if(o.babylonTexture)n(null);else{var i=e.images[o.source];a.w1.IsBase64(i.uri)?setTimeout((function(){return n(new Uint8Array(a.w1.DecodeBase64(i.uri)))})):a.w1.LoadFile(e.rootUrl+i.uri,(function(e){return n(new Uint8Array(e))}),void 0,void 0,!0,(function(e){e&&r(e.status+" "+e.statusText)}))}else r("")},e.CreateTextureAsync=function(e,t,n,r){var o=e.textures[t];if(o.babylonTexture)r(o.babylonTexture);else{var i=e.samplers[o.sampler],a=i.minFilter===C.NEAREST_MIPMAP_NEAREST||i.minFilter===C.NEAREST_MIPMAP_LINEAR||i.minFilter===C.LINEAR_MIPMAP_NEAREST||i.minFilter===C.LINEAR_MIPMAP_LINEAR,s=H.x.BILINEAR_SAMPLINGMODE,l=null==n?new Blob:new Blob([n]),c=URL.createObjectURL(l),u=function(){return URL.revokeObjectURL(c)},f=new H.x(c,e.scene,!a,!0,s,u,u);void 0!==i.wrapS&&(f.wrapU=ee.GetWrapMode(i.wrapS)),void 0!==i.wrapT&&(f.wrapV=ee.GetWrapMode(i.wrapT)),f.name=t,o.babylonTexture=f,r(f)}},e.LoadShaderStringAsync=function(e,t,n,r){var o=e.shaders[t];if(a.w1.IsBase64(o.uri)){var i=atob(o.uri.split(",")[1]);n&&n(i)}else a.w1.LoadFile(e.rootUrl+o.uri,n,void 0,void 0,!1,(function(e){e&&r&&r(e.status+" "+e.statusText)}))},e.LoadMaterialAsync=function(e,t,n,r){var o=e.materials[t];if(o.technique){var i=e.techniques[o.technique];if(!i){e.scene._blockEntityCollection=!!e.assetContainer;var a=new k.K(t,e.scene);return a._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,a.diffuseColor=new N.Wo(.5,.5,.5),a.sideOrientation=U.F.CounterClockWiseSideOrientation,void n(a)}var s=e.programs[i.program],l=i.states,c=V.Q.ShadersStore[s.vertexShader+"VertexShader"],u=V.Q.ShadersStore[s.fragmentShader+"PixelShader"],f="",d="",h=new ne(c),p=new ne(u),_={},m=[],v=[],y=[];for(var g in i.uniforms){var b=i.uniforms[g],A=i.parameters[b];if(_[g]=A,!A.semantic||A.node||A.source)A.type===T.SAMPLER_2D?y.push(g):m.push(g);else{var E=re.indexOf(A.semantic);-1!==E?(m.push(oe[E]),delete _[g]):m.push(g)}}for(var x in i.attributes){var C=i.attributes[x];if((F=i.parameters[C]).semantic){var S=ce(F);S&&v.push(S)}}for(;!h.isEnd()&&h.getNextToken();){if(h.currentToken===L.IDENTIFIER){var M=!1;for(var x in i.attributes){C=i.attributes[x];var F=i.parameters[C];if(h.currentIdentifier===x&&F.semantic){f+=ce(F),M=!0;break}}M||(f+=Ee(h,i,_))}else f+=h.currentString}for(;!p.isEnd()&&p.getNextToken();){p.currentToken===L.IDENTIFIER?d+=Ee(p,i,_):d+=p.currentString}var w={vertex:s.vertexShader+t,fragment:s.fragmentShader+t},I={attributes:v,uniforms:m,samplers:y,needAlphaBlending:l&&l.enable&&-1!==l.enable.indexOf(3042)};V.Q.ShadersStore[s.vertexShader+t+"VertexShader"]=f,V.Q.ShadersStore[s.fragmentShader+t+"PixelShader"]=d;var R=new W.j(t,e.scene,w,I);if(R.onError=function(e,t,n){return function(r,o){t.dispose(!0),n("Cannot compile program named "+e.name+". Error: "+o+". Default material will be applied")}}(s,R,r),R.onCompiled=Ae(e,R,i,o,_,n),R.sideOrientation=U.F.CounterClockWiseSideOrientation,l&&l.functions){var D=l.functions;D.cullFace&&D.cullFace[0]!==P.BACK&&(R.backFaceCulling=!1);var B=D.blendFuncSeparate;B&&(B[0]===O.SRC_ALPHA&&B[1]===O.ONE_MINUS_SRC_ALPHA&&B[2]===O.ONE&&B[3]===O.ONE?R.alphaMode=te.g.ALPHA_COMBINE:B[0]===O.ONE&&B[1]===O.ONE&&B[2]===O.ZERO&&B[3]===O.ONE?R.alphaMode=te.g.ALPHA_ONEONE:B[0]===O.SRC_ALPHA&&B[1]===O.ONE&&B[2]===O.ZERO&&B[3]===O.ONE?R.alphaMode=te.g.ALPHA_ADD:B[0]===O.ZERO&&B[1]===O.ONE_MINUS_SRC_COLOR&&B[2]===O.ONE&&B[3]===O.ONE?R.alphaMode=te.g.ALPHA_SUBTRACT:B[0]===O.DST_COLOR&&B[1]===O.ZERO&&B[2]===O.ONE&&B[3]===O.ONE?R.alphaMode=te.g.ALPHA_MULTIPLY:B[0]===O.SRC_ALPHA&&B[1]===O.ONE_MINUS_SRC_COLOR&&B[2]===O.ONE&&B[3]===O.ONE&&(R.alphaMode=te.g.ALPHA_MAXIMIZED))}}else r&&r("No technique found.")},e}(),Ce=function(){function e(){}return e.RegisterExtension=function(t){e.Extensions[t.name]?a.w1.Error('Tool with the same name "'+t.name+'" already exists'):e.Extensions[t.name]=t},e.prototype.dispose=function(){},e.prototype._importMeshAsync=function(e,t,n,r,o,i,s,l){var c=this;return t.useRightHandedSystem=!0,Se.LoadRuntimeAsync(t,n,r,(function(t){t.assetContainer=o,t.importOnlyMeshes=!0,""===e?t.importMeshesNames=[]:"string"==typeof e?t.importMeshesNames=[e]:!e||e instanceof Array?(t.importMeshesNames=[],a.w1.Warn("Argument meshesNames must be of type string or string[]")):t.importMeshesNames=[e],c._createNodes(t);var n=new Array,r=new Array;for(var s in t.nodes){var l=t.nodes[s];l.babylonNode instanceof q.x&&n.push(l.babylonNode)}for(var u in t.skins){var f=t.skins[u];f.babylonSkeleton instanceof B.O&&r.push(f.babylonSkeleton)}c._loadBuffersAsync(t,(function(){c._loadShadersAsync(t,(function(){Te(t),be(t),!b.IncrementalLoading&&i&&i(n,r)}))})),b.IncrementalLoading&&i&&i(n,r)}),l),!0},e.prototype.importMeshAsync=function(e,t,n,r,o,i){var a=this;return new Promise((function(s,l){a._importMeshAsync(e,t,r,o,n,(function(e,t){s({meshes:e,particleSystems:[],skeletons:t,animationGroups:[],lights:[],transformNodes:[],geometries:[]})}),i,(function(e){l(new Error(e))}))}))},e.prototype._loadAsync=function(e,t,n,r,o,i){var a=this;e.useRightHandedSystem=!0,Se.LoadRuntimeAsync(e,t,n,(function(e){Se.LoadRuntimeExtensionsAsync(e,(function(){a._createNodes(e),a._loadBuffersAsync(e,(function(){a._loadShadersAsync(e,(function(){Te(e),be(e),b.IncrementalLoading||r()}))})),b.IncrementalLoading&&r()}),i)}),i)},e.prototype.loadAsync=function(e,t,n,r){var o=this;return new Promise((function(i,a){o._loadAsync(e,t,n,(function(){i()}),r,(function(e){a(new Error(e))}))}))},e.prototype._loadShadersAsync=function(e,t){var n=!1,r=function(n,r){Se.LoadShaderStringAsync(e,n,(function(o){o instanceof ArrayBuffer||(e.loadedShaderCount++,o&&(V.Q.ShadersStore[n+(r.type===E.VERTEX?"VertexShader":"PixelShader")]=o),e.loadedShaderCount===e.shaderscount&&t())}),(function(){a.w1.Error("Error when loading shader program named "+n+" located at "+r.uri)}))};for(var o in e.shaders){n=!0;var i=e.shaders[o];i?r.bind(this,o,i)():a.w1.Error("No shader named: "+o)}n||t()},e.prototype._loadBuffersAsync=function(e,t){var n=!1,r=function(n,r){Se.LoadBufferAsync(e,n,(function(o){e.loadedBufferCount++,o&&(o.byteLength!=e.buffers[n].byteLength&&a.w1.Error("Buffer named "+n+" is length "+o.byteLength+". Expected: "+r.byteLength),e.loadedBufferViews[n]=o),e.loadedBufferCount===e.buffersCount&&t()}),(function(){a.w1.Error("Error when loading buffer named "+n+" located at "+r.uri)}))};for(var o in e.buffers){n=!0;var i=e.buffers[o];i?r.bind(this,o,i)():a.w1.Error("No buffer named: "+o)}n||t()},e.prototype._createNodes=function(e){var t=e.currentScene;if(t)for(var n=0;n<t.nodes.length;n++)ge(e,t.nodes[n],null);else for(var r in e.scenes){t=e.scenes[r];for(n=0;n<t.nodes.length;n++)ge(e,t.nodes[n],null)}},e.Extensions={},e}(),Se=function(){function e(e){this._name=e}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),e.prototype.loadRuntimeAsync=function(e,t,n,r,o){return!1},e.prototype.loadRuntimeExtensionsAsync=function(e,t,n){return!1},e.prototype.loadBufferAsync=function(e,t,n,r,o){return!1},e.prototype.loadTextureBufferAsync=function(e,t,n,r){return!1},e.prototype.createTextureAsync=function(e,t,n,r,o){return!1},e.prototype.loadShaderStringAsync=function(e,t,n,r){return!1},e.prototype.loadMaterialAsync=function(e,t,n,r){return!1},e.LoadRuntimeAsync=function(t,n,r,o,i){e._ApplyExtensions((function(e){return e.loadRuntimeAsync(t,n,r,o,i)}),(function(){setTimeout((function(){o&&o(xe.CreateRuntime(n.json,t,r))}))}))},e.LoadRuntimeExtensionsAsync=function(t,n,r){e._ApplyExtensions((function(e){return e.loadRuntimeExtensionsAsync(t,n,r)}),(function(){setTimeout((function(){n()}))}))},e.LoadBufferAsync=function(t,n,r,o,i){e._ApplyExtensions((function(e){return e.loadBufferAsync(t,n,r,o,i)}),(function(){xe.LoadBufferAsync(t,n,r,o,i)}))},e.LoadTextureAsync=function(t,n,r,o){e._LoadTextureBufferAsync(t,n,(function(i){i&&e._CreateTextureAsync(t,n,i,r,o)}),o)},e.LoadShaderStringAsync=function(t,n,r,o){e._ApplyExtensions((function(e){return e.loadShaderStringAsync(t,n,r,o)}),(function(){xe.LoadShaderStringAsync(t,n,r,o)}))},e.LoadMaterialAsync=function(t,n,r,o){e._ApplyExtensions((function(e){return e.loadMaterialAsync(t,n,r,o)}),(function(){xe.LoadMaterialAsync(t,n,r,o)}))},e._LoadTextureBufferAsync=function(t,n,r,o){e._ApplyExtensions((function(e){return e.loadTextureBufferAsync(t,n,r,o)}),(function(){xe.LoadTextureBufferAsync(t,n,r,o)}))},e._CreateTextureAsync=function(t,n,r,o,i){e._ApplyExtensions((function(e){return e.createTextureAsync(t,n,r,o,i)}),(function(){xe.CreateTextureAsync(t,n,r,o)}))},e._ApplyExtensions=function(e,t){for(var n in Ce.Extensions){if(e(Ce.Extensions[n]))return}t()},e}();b._CreateGLTF1Loader=function(){return new Ce};var Pe=function(e){function t(){return e.call(this,"KHR_binary_glTF")||this}return(0,M.ZT)(t,e),t.prototype.loadRuntimeAsync=function(e,t,n,r){var o=t.json.extensionsUsed;return!(!o||-1===o.indexOf(this.name)||!t.bin)&&(this._bin=t.bin,r(xe.CreateRuntime(t.json,e,n)),!0)},t.prototype.loadBufferAsync=function(e,t,n,r){return-1!==e.extensionsUsed.indexOf(this.name)&&("binary_glTF"===t&&(this._bin.readAsync(0,this._bin.byteLength).then(n,(function(e){return r(e.message)})),!0))},t.prototype.loadTextureBufferAsync=function(e,t,n){var r=e.textures[t],o=e.images[r.source];if(!o.extensions||!(this.name in o.extensions))return!1;var i=o.extensions[this.name],a=e.bufferViews[i.bufferView];return n(ee.GetBufferFromBufferView(e,a,0,a.byteLength,A.UNSIGNED_BYTE)),!0},t.prototype.loadShaderStringAsync=function(e,t,n){var r=e.shaders[t];if(!r.extensions||!(this.name in r.extensions))return!1;var o=r.extensions[this.name],i=e.bufferViews[o.bufferView],a=ee.GetBufferFromBufferView(e,i,0,i.byteLength,A.UNSIGNED_BYTE);return setTimeout((function(){var e=ee.DecodeBufferToText(a);n(e)})),!0},t}(Se);Ce.RegisterExtension(new Pe);var Oe=function(e){function t(){return e.call(this,"KHR_materials_common")||this}return(0,M.ZT)(t,e),t.prototype.loadRuntimeExtensionsAsync=function(e){if(!e.extensions)return!1;var t=e.extensions[this.name];if(!t)return!1;var n=t.lights;if(n)for(var r in n){var o=n[r];switch(o.type){case"ambient":var i=new Z.e(o.name,new F.P(0,1,0),e.scene),s=o.ambient;s&&(i.diffuse=N.Wo.FromArray(s.color||[1,1,1]));break;case"point":var l=new J.c(o.name,new F.P(10,10,10),e.scene),c=o.point;c&&(l.diffuse=N.Wo.FromArray(c.color||[1,1,1]));break;case"directional":var u=new Q.O(o.name,new F.P(0,-1,0),e.scene),f=o.directional;f&&(u.diffuse=N.Wo.FromArray(f.color||[1,1,1]));break;case"spot":var d=o.spot;if(d)new $.P(o.name,new F.P(0,10,0),new F.P(0,-1,0),d.fallOffAngle||Math.PI,d.fallOffExponent||0,e.scene).diffuse=N.Wo.FromArray(d.color||[1,1,1]);break;default:a.w1.Warn('GLTF Material Common extension: light type "'+o.type+"\u201d not supported")}}return!1},t.prototype.loadMaterialAsync=function(e,t,n,r){var o=e.materials[t];if(!o||!o.extensions)return!1;var i=o.extensions[this.name];if(!i)return!1;var a=new k.K(t,e.scene);return a.sideOrientation=U.F.CounterClockWiseSideOrientation,"CONSTANT"===i.technique&&(a.disableLighting=!0),a.backFaceCulling=void 0!==i.doubleSided&&!i.doubleSided,a.alpha=void 0===i.values.transparency?1:i.values.transparency,a.specularPower=void 0===i.values.shininess?0:i.values.shininess,"string"==typeof i.values.ambient?this._loadTexture(e,i.values.ambient,a,"ambientTexture",r):a.ambientColor=N.Wo.FromArray(i.values.ambient||[0,0,0]),"string"==typeof i.values.diffuse?this._loadTexture(e,i.values.diffuse,a,"diffuseTexture",r):a.diffuseColor=N.Wo.FromArray(i.values.diffuse||[0,0,0]),"string"==typeof i.values.emission?this._loadTexture(e,i.values.emission,a,"emissiveTexture",r):a.emissiveColor=N.Wo.FromArray(i.values.emission||[0,0,0]),"string"==typeof i.values.specular?this._loadTexture(e,i.values.specular,a,"specularTexture",r):a.specularColor=N.Wo.FromArray(i.values.specular||[0,0,0]),!0},t.prototype._loadTexture=function(e,t,n,r,o){xe.LoadTextureBufferAsync(e,t,(function(o){xe.CreateTextureAsync(e,t,o,(function(e){return n[r]=e}))}),o)},t}(Se);Ce.RegisterExtension(new Oe);var Me=n(94138),Le=n(4849),Fe=n(47914),Ne=n(30700),we=n(8471),Ie=n(27398),Re=n(45345),De=n(91859),Be=function(){function e(){}return e.Get=function(e,t,n){if(!t||null==n||!t[n])throw new Error("".concat(e,": Failed to find index (").concat(n,")"));return t[n]},e.Assign=function(e){if(e)for(var t=0;t<e.length;t++)e[t].index=t},e}(),Ve=function(){function e(e){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=e}return e.RegisterExtension=function(t,n){e.UnregisterExtension(t)&&c.Y.Warn("Extension with the name '".concat(t,"' already exists")),e._RegisteredExtensions[t]={factory:n}},e.UnregisterExtension=function(t){return!!e._RegisteredExtensions[t]&&(delete e._RegisteredExtensions[t],!0)},Object.defineProperty(e.prototype,"gltf",{get:function(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bin",{get:function(){return this._bin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"babylonScene",{get:function(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((function(e){return e.dispose&&e.dispose()})),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())},e.prototype.importMeshAsync=function(e,t,n,r,o,i,a){var s=this;return void 0===a&&(a=""),Promise.resolve().then((function(){s._babylonScene=t,s._assetContainer=n,s._loadData(r);var i=null;if(e){var l={};if(s._gltf.nodes)for(var c=0,u=s._gltf.nodes;c<u.length;c++){var f=u[c];f.name&&(l[f.name]=f.index)}i=(e instanceof Array?e:[e]).map((function(e){var t=l[e];if(void 0===t)throw new Error("Failed to find node '".concat(e,"'"));return t}))}return s._loadAsync(o,a,i,(function(){return{meshes:s._getMeshes(),particleSystems:[],skeletons:s._getSkeletons(),animationGroups:s._getAnimationGroups(),lights:s._babylonLights,transformNodes:s._getTransformNodes(),geometries:s._getGeometries()}}))}))},e.prototype.loadAsync=function(e,t,n,r,o){var i=this;return void 0===o&&(o=""),Promise.resolve().then((function(){return i._babylonScene=e,i._loadData(t),i._loadAsync(n,o,null,(function(){}))}))},e.prototype._loadAsync=function(e,t,n,r){var o=this;return Promise.resolve().then((function(){o._rootUrl=e,o._uniqueRootUrl=!e.startsWith("file:")&&t?e:"".concat(e).concat(Date.now(),"/"),o._fileName=t,o._loadExtensions(),o._checkExtensions();var i="".concat(_[_.LOADING]," => ").concat(_[_.READY]),s="".concat(_[_.LOADING]," => ").concat(_[_.COMPLETE]);o._parent._startPerformanceCounter(i),o._parent._startPerformanceCounter(s),o._parent._setState(_.LOADING),o._extensionsOnLoading();var l=new Array,c=o._babylonScene.blockMaterialDirtyMechanism;if(o._babylonScene.blockMaterialDirtyMechanism=!0,!o.parent.loadOnlyMaterials)if(n)l.push(o.loadSceneAsync("/nodes",{nodes:n,index:-1}));else if(null!=o._gltf.scene||o._gltf.scenes&&o._gltf.scenes[0]){var u=Be.Get("/scene",o._gltf.scenes,o._gltf.scene||0);l.push(o.loadSceneAsync("/scenes/".concat(u.index),u))}if(!o.parent.skipMaterials&&o.parent.loadAllMaterials&&o._gltf.materials)for(var f=0;f<o._gltf.materials.length;++f){var d=o._gltf.materials[f],h="/materials/"+f,p=U.F.TriangleFillMode;l.push(o._loadMaterialAsync(h,d,null,p,(function(){})))}return o._babylonScene.blockMaterialDirtyMechanism=c,o._parent.compileMaterials&&l.push(o._compileMaterialsAsync()),o._parent.compileShadowGenerators&&l.push(o._compileShadowGeneratorsAsync()),Promise.all(l).then((function(){return o._rootBabylonMesh&&o._rootBabylonMesh.setEnabled(!0),o._extensionsOnReady(),o._parent._setState(_.READY),o._startAnimations(),r()})).then((function(e){return o._parent._endPerformanceCounter(i),a.w1.SetImmediate((function(){o._disposed||Promise.all(o._completePromises).then((function(){o._parent._endPerformanceCounter(s),o._parent._setState(_.COMPLETE),o._parent.onCompleteObservable.notifyObservers(void 0),o._parent.onCompleteObservable.clear(),o.dispose()}),(function(e){o._parent.onErrorObservable.notifyObservers(e),o._parent.onErrorObservable.clear(),o.dispose()}))})),e}))})).catch((function(e){throw o._disposed||(o._parent.onErrorObservable.notifyObservers(e),o._parent.onErrorObservable.clear(),o.dispose()),e}))},e.prototype._loadData=function(e){if(this._gltf=e.json,this._setupData(),e.bin){var t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){var n=t[0];(n.byteLength<e.bin.byteLength-3||n.byteLength>e.bin.byteLength)&&c.Y.Warn("Binary buffer length (".concat(n.byteLength,") from JSON does not match chunk length (").concat(e.bin.byteLength,")")),this._bin=e.bin}else c.Y.Warn("Unexpected BIN chunk")}},e.prototype._setupData=function(){if(Be.Assign(this._gltf.accessors),Be.Assign(this._gltf.animations),Be.Assign(this._gltf.buffers),Be.Assign(this._gltf.bufferViews),Be.Assign(this._gltf.cameras),Be.Assign(this._gltf.images),Be.Assign(this._gltf.materials),Be.Assign(this._gltf.meshes),Be.Assign(this._gltf.nodes),Be.Assign(this._gltf.samplers),Be.Assign(this._gltf.scenes),Be.Assign(this._gltf.skins),Be.Assign(this._gltf.textures),this._gltf.nodes){for(var e={},t=0,n=this._gltf.nodes;t<n.length;t++){if((l=n[t]).children)for(var r=0,o=l.children;r<o.length;r++){e[o[r]]=l.index}}for(var i=this._createRootNode(),a=0,s=this._gltf.nodes;a<s.length;a++){var l,c=e[(l=s[a]).index];l.parent=void 0===c?i:this._gltf.nodes[c]}}},e.prototype._loadExtensions=function(){for(var t in e._RegisteredExtensions){var n=e._RegisteredExtensions[t].factory(this);n.name!==t&&c.Y.Warn("The name of the glTF loader extension instance does not match the registered name: ".concat(n.name," !== ").concat(t)),this._extensions.push(n),this._parent.onExtensionLoadedObservable.notifyObservers(n)}this._extensions.sort((function(e,t){return(e.order||Number.MAX_VALUE)-(t.order||Number.MAX_VALUE)})),this._parent.onExtensionLoadedObservable.clear()},e.prototype._checkExtensions=function(){if(this._gltf.extensionsRequired)for(var e=function(e){if(!t._extensions.some((function(t){return t.name===e&&t.enabled})))throw new Error("Require extension ".concat(e," is not available"))},t=this,n=0,r=this._gltf.extensionsRequired;n<r.length;n++){e(r[n])}},e.prototype._createRootNode=function(){this._babylonScene._blockEntityCollection=!!this._assetContainer,this._rootBabylonMesh=new Y.Kj("__root__",this._babylonScene),this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);var t={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case h.AUTO:this._babylonScene.useRightHandedSystem||(t.rotation=[0,1,0,0],t.scale=[1,1,-1],e._LoadTransform(t,this._rootBabylonMesh));break;case h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode (".concat(this._parent.coordinateSystemMode,")"))}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),t},e.prototype.loadSceneAsync=function(e,t){var n=this,r=this._extensionsLoadSceneAsync(e,t);if(r)return r;var o=new Array;if(this.logOpen("".concat(e," ").concat(t.name||"")),t.nodes)for(var i=0,a=t.nodes;i<a.length;i++){var s=a[i],l=Be.Get("".concat(e,"/nodes/").concat(s),this._gltf.nodes,s);o.push(this.loadNodeAsync("/nodes/".concat(l.index),l,(function(e){e.parent=n._rootBabylonMesh})))}for(var c=0,u=this._postSceneLoadActions;c<u.length;c++){(0,u[c])()}return o.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(o).then((function(){}))},e.prototype._forEachPrimitive=function(e,t){if(e._primitiveBabylonMeshes)for(var n=0,r=e._primitiveBabylonMeshes;n<r.length;n++){t(r[n])}},e.prototype._getGeometries=function(){var e=new Array,t=this._gltf.nodes;if(t)for(var n=0,r=t;n<r.length;n++){var o=r[n];this._forEachPrimitive(o,(function(t){var n=t.geometry;n&&-1===e.indexOf(n)&&e.push(n)}))}return e},e.prototype._getMeshes=function(){var e=new Array;this._rootBabylonMesh&&e.push(this._rootBabylonMesh);var t=this._gltf.nodes;if(t)for(var n=0,r=t;n<r.length;n++){var o=r[n];this._forEachPrimitive(o,(function(t){e.push(t)}))}return e},e.prototype._getTransformNodes=function(){var e=new Array,t=this._gltf.nodes;if(t)for(var n=0,r=t;n<r.length;n++){var o=r[n];o._babylonTransformNode&&"TransformNode"===o._babylonTransformNode.getClassName()&&e.push(o._babylonTransformNode),o._babylonTransformNodeForSkin&&e.push(o._babylonTransformNodeForSkin)}return e},e.prototype._getSkeletons=function(){var e=new Array,t=this._gltf.skins;if(t)for(var n=0,r=t;n<r.length;n++){var o=r[n];o._data&&e.push(o._data.babylonSkeleton)}return e},e.prototype._getAnimationGroups=function(){var e=new Array,t=this._gltf.animations;if(t)for(var n=0,r=t;n<r.length;n++){var o=r[n];o._babylonAnimationGroup&&e.push(o._babylonAnimationGroup)}return e},e.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case p.NONE:break;case p.FIRST:0!==(e=this._getAnimationGroups()).length&&e[0].start(!0);break;case p.ALL:for(var e,t=0,n=e=this._getAnimationGroups();t<n.length;t++){n[t].start(!0)}break;default:return void c.Y.Error("Invalid animation start mode (".concat(this._parent.animationStartMode,")"))}},e.prototype.loadNodeAsync=function(t,n,r){var o=this;void 0===r&&(r=function(){});var i=this._extensionsLoadNodeAsync(t,n,r);if(i)return i;if(n._babylonTransformNode)throw new Error("".concat(t,": Invalid recursive node hierarchy"));var a=new Array;this.logOpen("".concat(t," ").concat(n.name||""));var s=function(i){if(e.AddPointerMetadata(i,t),e._LoadTransform(n,i),null!=n.camera){var s=Be.Get("".concat(t,"/camera"),o._gltf.cameras,n.camera);a.push(o.loadCameraAsync("/cameras/".concat(s.index),s,(function(e){e.parent=i})))}if(n.children)for(var l=0,c=n.children;l<c.length;l++){var u=c[l],f=Be.Get("".concat(t,"/children/").concat(u),o._gltf.nodes,u);a.push(o.loadNodeAsync("/nodes/".concat(f.index),f,(function(e){e.parent=i})))}r(i)};if(null==n.mesh||null!=n.skin){var l=n.name||"node".concat(n.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var c=new Ne.Y(l,this._babylonScene);c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,null==n.mesh?n._babylonTransformNode=c:n._babylonTransformNodeForSkin=c,s(c)}if(null!=n.mesh)if(null==n.skin){var u=Be.Get("".concat(t,"/mesh"),this._gltf.meshes,n.mesh);a.push(this._loadMeshAsync("/meshes/".concat(u.index),n,u,s))}else{u=Be.Get("".concat(t,"/mesh"),this._gltf.meshes,n.mesh);a.push(this._loadMeshAsync("/meshes/".concat(u.index),n,u,(function(e){var r=n._babylonTransformNodeForSkin,i=Be.Get("".concat(t,"/skin"),o._gltf.skins,n.skin);a.push(o._loadSkinAsync("/skins/".concat(i.index),n,i,(function(t){o._forEachPrimitive(n,(function(e){e.skeleton=t})),o._postSceneLoadActions.push((function(){if(null!=i.skeleton){var t=Be.Get("/skins/".concat(i.index,"/skeleton"),o._gltf.nodes,i.skeleton).parent;n.index===t.index?e.parent=n._babylonTransformNodeForSkin.parent:e.parent=t._babylonTransformNode}else e.parent=o._rootBabylonMesh;o._parent.onSkinLoadedObservable.notifyObservers({node:r,skinnedNode:e})}))})))})))}return this.logClose(),Promise.all(a).then((function(){return o._forEachPrimitive(n,(function(e){e.geometry&&e.geometry.useBoundingInfoFromGeometry?e._updateBoundingInfo():e.refreshBoundingInfo(!0)})),n._babylonTransformNode}))},e.prototype._loadMeshAsync=function(e,t,n,r){var o=n.primitives;if(!o||!o.length)throw new Error("".concat(e,": Primitives are missing"));null==o[0].index&&Be.Assign(o);var i=new Array;this.logOpen("".concat(e," ").concat(n.name||""));var a=t.name||"node".concat(t.index);if(1===o.length){var s=n.primitives[0];i.push(this._loadMeshPrimitiveAsync("".concat(e,"/primitives/").concat(s.index),a,t,n,s,(function(e){t._babylonTransformNode=e,t._primitiveBabylonMeshes=[e]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,t._babylonTransformNode=new Ne.Y(a,this._babylonScene),t._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._primitiveBabylonMeshes=[];for(var l=0,c=o;l<c.length;l++){s=c[l];i.push(this._loadMeshPrimitiveAsync("".concat(e,"/primitives/").concat(s.index),"".concat(a,"_primitive").concat(s.index),t,n,s,(function(e){e.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(e)})))}}return r(t._babylonTransformNode),this.logClose(),Promise.all(i).then((function(){return t._babylonTransformNode}))},e.prototype._loadMeshPrimitiveAsync=function(t,n,r,o,i,a){var s=this,l=this._extensionsLoadMeshPrimitiveAsync(t,n,r,o,i,a);if(l)return l;this.logOpen("".concat(t));var c,u,f=0===this._disableInstancedMesh&&this._parent.createInstances&&null==r.skin&&!o.primitives[0].targets;if(f&&i._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,(c=i._instanceData.babylonSourceMesh.createInstance(n))._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u=i._instanceData.promise;else{var d=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;var h=new Y.Kj(n,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?U.F.CounterClockWiseSideOrientation:U.F.ClockWiseSideOrientation,this._createMorphTargets(t,r,o,i,h),d.push(this._loadVertexDataAsync(t,i,h).then((function(e){return s._loadMorphTargetsAsync(t,i,h,e).then((function(){s._disposed||(s._babylonScene._blockEntityCollection=!!s._assetContainer,e.applyToMesh(h),e._parentContainer=s._assetContainer,s._babylonScene._blockEntityCollection=!1)}))})));var p=e._GetDrawMode(t,i.mode);if(null==i.material){var _=this._defaultBabylonMaterialData[p];_||(_=this._createDefaultMaterial("__GLTFLoader._default",p),this._parent.onMaterialLoadedObservable.notifyObservers(_),this._defaultBabylonMaterialData[p]=_),h.material=_}else if(!this.parent.skipMaterials){var m=Be.Get("".concat(t,"/material"),this._gltf.materials,i.material);d.push(this._loadMaterialAsync("/materials/".concat(m.index),m,h,p,(function(e){h.material=e})))}u=Promise.all(d),f&&(i._instanceData={babylonSourceMesh:h,promise:u}),c=h}return e.AddPointerMetadata(c,t),this._parent.onMeshLoadedObservable.notifyObservers(c),a(c),this.logClose(),u.then((function(){return c}))},e.prototype._loadVertexDataAsync=function(e,t,n){var r=this,o=this._extensionsLoadVertexDataAsync(e,t,n);if(o)return o;var i=t.attributes;if(!i)throw new Error("".concat(e,": Attributes are missing"));var a=new Array,s=new z.Z(n.name,this._babylonScene);if(null==t.indices)n.isUnIndexed=!0;else{var l=Be.Get("".concat(e,"/indices"),this._gltf.accessors,t.indices);a.push(this._loadIndicesAccessorAsync("/accessors/".concat(l.index),l).then((function(e){s.setIndices(e)})))}var c=function(t,o,l){if(null!=i[t]){n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(o)&&n._delayInfo.push(o);var c=Be.Get("".concat(e,"/attributes/").concat(t),r._gltf.accessors,i[t]);a.push(r._loadVertexAccessorAsync("/accessors/".concat(c.index),c,o).then((function(e){if(e.getKind()===K.o.PositionKind&&!r.parent.alwaysComputeBoundingBox&&!n.skeleton){var t=c.min,o=c.max;if(void 0!==t&&void 0!==o){if(c.normalized&&5126!==c.componentType){var i=1;switch(c.componentType){case 5120:i=127;break;case 5121:i=255;break;case 5122:i=32767;break;case 5123:i=65535}for(var a=0;a<3;++a)t[a]=Math.max(t[a]/i,-1),o[a]=Math.max(o[a]/i,-1)}var l=F.jp.Vector3[0],u=F.jp.Vector3[1];l.copyFromFloats.apply(l,t),u.copyFromFloats.apply(u,o),s._boundingInfo=new De.j(l,u),s.useBoundingInfoFromGeometry=!0}}s.setVerticesBuffer(e,c.count)}))),o==K.o.MatricesIndicesExtraKind&&(n.numBoneInfluencers=8),l&&l(c)}};return c("POSITION",K.o.PositionKind),c("NORMAL",K.o.NormalKind),c("TANGENT",K.o.TangentKind),c("TEXCOORD_0",K.o.UVKind),c("TEXCOORD_1",K.o.UV2Kind),c("TEXCOORD_2",K.o.UV3Kind),c("TEXCOORD_3",K.o.UV4Kind),c("TEXCOORD_4",K.o.UV5Kind),c("TEXCOORD_5",K.o.UV6Kind),c("JOINTS_0",K.o.MatricesIndicesKind),c("WEIGHTS_0",K.o.MatricesWeightsKind),c("JOINTS_1",K.o.MatricesIndicesExtraKind),c("WEIGHTS_1",K.o.MatricesWeightsExtraKind),c("COLOR_0",K.o.ColorKind,(function(e){"VEC4"===e.type&&(n.hasVertexAlpha=!0)})),Promise.all(a).then((function(){return s}))},e.prototype._createMorphTargets=function(e,t,n,r,o){if(r.targets){if(null==t._numMorphTargets)t._numMorphTargets=r.targets.length;else if(r.targets.length!==t._numMorphTargets)throw new Error("".concat(e,": Primitives do not have the same number of targets"));var i=n.extras?n.extras.targetNames:null;o.morphTargetManager=new Ie.O(o.getScene()),o.morphTargetManager.areUpdatesFrozen=!0;for(var a=0;a<r.targets.length;a++){var s=t.weights?t.weights[a]:n.weights?n.weights[a]:0,l=i?i[a]:"morphTarget".concat(a);o.morphTargetManager.addTarget(new we.Y(l,s,o.getScene()))}}},e.prototype._loadMorphTargetsAsync=function(e,t,n,r){if(!t.targets)return Promise.resolve();for(var o=new Array,i=n.morphTargetManager,a=0;a<i.numTargets;a++){var s=i.getTarget(a);o.push(this._loadMorphTargetVertexDataAsync("".concat(e,"/targets/").concat(a),r,t.targets[a],s))}return Promise.all(o).then((function(){i.areUpdatesFrozen=!1}))},e.prototype._loadMorphTargetVertexDataAsync=function(e,t,n,r){var o=this,i=new Array,a=function(r,a,s){if(null!=n[r]){var l=t.getVertexBuffer(a);if(l){var c=Be.Get("".concat(e,"/").concat(r),o._gltf.accessors,n[r]);i.push(o._loadFloatAccessorAsync("/accessors/".concat(c.index),c).then((function(e){s(l,e)})))}}};return a("POSITION",K.o.PositionKind,(function(e,t){var n=new Float32Array(t.length);e.forEach(t.length,(function(e,r){n[r]=t[r]+e})),r.setPositions(n)})),a("NORMAL",K.o.NormalKind,(function(e,t){var n=new Float32Array(t.length);e.forEach(n.length,(function(e,r){n[r]=t[r]+e})),r.setNormals(n)})),a("TANGENT",K.o.TangentKind,(function(e,t){var n=new Float32Array(t.length/3*4),o=0;e.forEach(t.length/3*4,(function(e,r){(r+1)%4!=0&&(n[o]=t[o]+e,o++)})),r.setTangents(n)})),Promise.all(i).then((function(){}))},e._LoadTransform=function(e,t){if(null==e.skin){var n=F.P.Zero(),r=F._f.Identity(),o=F.P.One();if(e.matrix)F.y3.FromArray(e.matrix).decompose(o,r,n);else e.translation&&(n=F.P.FromArray(e.translation)),e.rotation&&(r=F._f.FromArray(e.rotation)),e.scale&&(o=F.P.FromArray(e.scale));t.position=n,t.rotationQuaternion=r,t.scaling=o}},e.prototype._loadSkinAsync=function(e,t,n,r){var o=this,i=this._extensionsLoadSkinAsync(e,t,n);if(i)return i;if(n._data)return r(n._data.babylonSkeleton),n._data.promise;var a="skeleton".concat(n.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var s=new B.O(n.name||a,a,this._babylonScene);s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(e,n,s);var l=this._loadSkinInverseBindMatricesDataAsync(e,n).then((function(e){o._updateBoneMatrices(s,e)}));return n._data={babylonSkeleton:s,promise:l},r(s),l},e.prototype._loadBones=function(e,t,n){if(null==t.skeleton||this._parent.alwaysComputeSkeletonRootNode){var r=this._findSkeletonRootNode("".concat(e,"/joints"),t.joints);if(r)if(void 0===t.skeleton)t.skeleton=r.index;else{var o=Be.Get("".concat(e,"/skeleton"),this._gltf.nodes,t.skeleton);o===r||function(e,t){for(;t.parent;t=t.parent)if(t.parent===e)return!0;return!1}(o,r)||(c.Y.Warn("".concat(e,"/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root")),t.skeleton=r.index)}else c.Y.Warn("".concat(e,": Failed to find common root"))}for(var i={},a=0,s=t.joints;a<s.length;a++){var l=s[a],u=Be.Get("".concat(e,"/joints/").concat(l),this._gltf.nodes,l);this._loadBone(u,t,n,i)}},e.prototype._findSkeletonRootNode=function(e,t){if(0===t.length)return null;for(var n={},r=0,o=t;r<o.length;r++){for(var i=o[r],a=new Array,s=Be.Get("".concat(e,"/").concat(i),this._gltf.nodes,i);-1!==s.index;)a.unshift(s),s=s.parent;n[i]=a}for(var l=null,c=0;;++c){if(c>=(a=n[t[0]]).length)return l;s=a[c];for(var u=1;u<t.length;++u)if(c>=(a=n[t[u]]).length||s!==a[c])return l;l=s}},e.prototype._loadBone=function(e,t,n,r){var o=r[e.index];if(o)return o;var i=null;e.index!==t.skeleton&&(e.parent&&-1!==e.parent.index?i=this._loadBone(e.parent,t,n,r):void 0!==t.skeleton&&c.Y.Warn("/skins/".concat(t.index,"/skeleton: Skeleton node is not a common root")));var a=t.joints.indexOf(e.index);return o=new D.N(e.name||"joint".concat(e.index),n,i,this._getNodeMatrix(e),null,null,a),r[e.index]=o,this._postSceneLoadActions.push((function(){o.linkTransformNode(e._babylonTransformNode)})),o},e.prototype._loadSkinInverseBindMatricesDataAsync=function(e,t){if(null==t.inverseBindMatrices)return Promise.resolve(null);var n=Be.Get("".concat(e,"/inverseBindMatrices"),this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/".concat(n.index),n)},e.prototype._updateBoneMatrices=function(e,t){for(var n=0,r=e.bones;n<r.length;n++){var o=r[n],i=F.y3.Identity(),a=o._index;t&&-1!==a&&(F.y3.FromArrayToRef(t,16*a,i),i.invertToRef(i));var s=o.getParent();s&&i.multiplyToRef(s.getInvertedAbsoluteTransform(),i),o.updateMatrix(i,!1,!1),o._updateDifferenceMatrix(void 0,!1)}},e.prototype._getNodeMatrix=function(e){return e.matrix?F.y3.FromArray(e.matrix):F.y3.Compose(e.scale?F.P.FromArray(e.scale):F.P.One(),e.rotation?F._f.FromArray(e.rotation):F._f.Identity(),e.translation?F.P.FromArray(e.translation):F.P.Zero())},e.prototype.loadCameraAsync=function(t,n,r){void 0===r&&(r=function(){});var o=this._extensionsLoadCameraAsync(t,n,r);if(o)return o;var i=new Array;this.logOpen("".concat(t," ").concat(n.name||"")),this._babylonScene._blockEntityCollection=!!this._assetContainer;var a=new I.c(n.name||"camera".concat(n.index),F.P.Zero(),this._babylonScene,!1);switch(a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.ignoreParentScaling=!0,a.rotation=new F.P(0,Math.PI,0),n.type){case"perspective":var s=n.perspective;if(!s)throw new Error("".concat(t,": Camera perspective properties are missing"));a.fov=s.yfov,a.minZ=s.znear,a.maxZ=s.zfar||0;break;case"orthographic":if(!n.orthographic)throw new Error("".concat(t,": Camera orthographic properties are missing"));a.mode=w.V.ORTHOGRAPHIC_CAMERA,a.orthoLeft=-n.orthographic.xmag,a.orthoRight=n.orthographic.xmag,a.orthoBottom=-n.orthographic.ymag,a.orthoTop=n.orthographic.ymag,a.minZ=n.orthographic.znear,a.maxZ=n.orthographic.zfar;break;default:throw new Error("".concat(t,": Invalid camera type (").concat(n.type,")"))}return e.AddPointerMetadata(a,t),this._parent.onCameraLoadedObservable.notifyObservers(a),r(a),this.logClose(),Promise.all(i).then((function(){return a}))},e.prototype._loadAnimationsAsync=function(){var e=this._gltf.animations;if(!e)return Promise.resolve();for(var t=new Array,n=0;n<e.length;n++){var r=e[n];t.push(this.loadAnimationAsync("/animations/".concat(r.index),r).then((function(e){0===e.targetedAnimations.length&&e.dispose()})))}return Promise.all(t).then((function(){}))},e.prototype.loadAnimationAsync=function(e,t){var n=this._extensionsLoadAnimationAsync(e,t);if(n)return n;this._babylonScene._blockEntityCollection=!!this._assetContainer;var r=new Le.O(t.name||"animation".concat(t.index),this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonAnimationGroup=r;var o=new Array;Be.Assign(t.channels),Be.Assign(t.samplers);for(var i=0,a=t.channels;i<a.length;i++){var s=a[i];o.push(this._loadAnimationChannelAsync("".concat(e,"/channels/").concat(s.index),e,t,s,r))}return Promise.all(o).then((function(){return r.normalize(0),r}))},e.prototype._loadAnimationChannelAsync=function(e,t,n,r,o,i){var a=this;if(void 0===i&&(i=null),null==r.target.node)return Promise.resolve();var s=Be.Get("".concat(e,"/target/node"),this._gltf.nodes,r.target.node);if("weights"===r.target.path&&!s._numMorphTargets||"weights"!==r.target.path&&!s._babylonTransformNode)return Promise.resolve();var l=Be.Get("".concat(e,"/sampler"),n.samplers,r.sampler);return this._loadAnimationSamplerAsync("".concat(t,"/samplers/").concat(r.sampler),l).then((function(t){var n,l;switch(r.target.path){case"translation":n="position",l=R.f.ANIMATIONTYPE_VECTOR3;break;case"rotation":n="rotationQuaternion",l=R.f.ANIMATIONTYPE_QUATERNION;break;case"scale":n="scaling",l=R.f.ANIMATIONTYPE_VECTOR3;break;case"weights":n="influence",l=R.f.ANIMATIONTYPE_FLOAT;break;default:throw new Error("".concat(e,"/target/path: Invalid value (").concat(r.target.path,")"))}var c,u,f=0;switch(n){case"position":c=function(e){var n=F.P.FromArray(t.output,f).scaleInPlace(e);return f+=3,n};break;case"rotationQuaternion":c=function(e){var n=F._f.FromArray(t.output,f).scaleInPlace(e);return f+=4,n};break;case"scaling":c=function(e){var n=F.P.FromArray(t.output,f).scaleInPlace(e);return f+=3,n};break;case"influence":c=function(e){for(var n=new Array(s._numMorphTargets),r=0;r<s._numMorphTargets;r++)n[r]=t.output[f++]*e;return n}}switch(t.interpolation){case"STEP":u=function(e){return{frame:t.input[e]*a.parent.targetFps,value:c(1),interpolation:Re.N.STEP}};break;case"LINEAR":u=function(e){return{frame:t.input[e]*a.parent.targetFps,value:c(1)}};break;case"CUBICSPLINE":var d=1/a.parent.targetFps;u=function(e){return{frame:t.input[e]*a.parent.targetFps,inTangent:c(d),value:c(1),outTangent:c(d)}}}for(var h=new Array(t.input.length),p=0;p<t.input.length;p++)h[p]=u(p);if("influence"===n)for(var _=function(e){var t="".concat(o.name,"_channel").concat(o.targetedAnimations.length),r=new R.f(t,n,a.parent.targetFps,l);r.setKeys(h.map((function(t){return{frame:t.frame,inTangent:t.inTangent?t.inTangent[e]:void 0,value:t.value[e],outTangent:t.outTangent?t.outTangent[e]:void 0,interpolation:t.interpolation}}))),a._forEachPrimitive(s,(function(t){var n=t;if(n.morphTargetManager){var i=n.morphTargetManager.getTarget(e),a=r.clone();i.animations.push(a),o.addTargetedAnimation(a,i)}}))},m=0;m<s._numMorphTargets;m++)_(m);else{var v="".concat(o.name,"_channel").concat(o.targetedAnimations.length),y=new R.f(v,n,a.parent.targetFps,l);y.setKeys(h),null!=i&&null!=i.animations?(i.animations.push(y),o.addTargetedAnimation(y,i)):(s._babylonTransformNode.animations.push(y),o.addTargetedAnimation(y,s._babylonTransformNode))}}))},e.prototype._loadAnimationSamplerAsync=function(e,t){if(t._data)return t._data;var n=t.interpolation||"LINEAR";switch(n){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error("".concat(e,"/interpolation: Invalid value (").concat(t.interpolation,")"))}var r=Be.Get("".concat(e,"/input"),this._gltf.accessors,t.input),o=Be.Get("".concat(e,"/output"),this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync("/accessors/".concat(r.index),r),this._loadFloatAccessorAsync("/accessors/".concat(o.index),o)]).then((function(e){var t=e[0],r=e[1];return{input:t,interpolation:n,output:r}})),t._data},e.prototype.loadBufferAsync=function(e,t,n,r){var o=this._extensionsLoadBufferAsync(e,t,n,r);if(o)return o;if(!t._data)if(t.uri)t._data=this.loadUriAsync("".concat(e,"/uri"),t,t.uri);else{if(!this._bin)throw new Error("".concat(e,": Uri is missing or the binary glTF is missing its binary chunk"));t._data=this._bin.readAsync(0,t.byteLength)}return t._data.then((function(t){try{return new Uint8Array(t.buffer,t.byteOffset+n,r)}catch(t){throw new Error("".concat(e,": ").concat(t.message))}}))},e.prototype.loadBufferViewAsync=function(e,t){var n=this._extensionsLoadBufferViewAsync(e,t);if(n)return n;if(t._data)return t._data;var r=Be.Get("".concat(e,"/buffer"),this._gltf.buffers,t.buffer);return t._data=this.loadBufferAsync("/buffers/".concat(r.index),r,t.byteOffset||0,t.byteLength),t._data},e.prototype._loadAccessorAsync=function(t,n,r){var o=this;if(n._data)return n._data;var i=e._GetNumComponents(t,n.type),a=i*K.o.GetTypeByteLength(n.componentType),s=i*n.count;if(null==n.bufferView)n._data=Promise.resolve(new r(s));else{var l=Be.Get("".concat(t,"/bufferView"),this._gltf.bufferViews,n.bufferView);n._data=this.loadBufferViewAsync("/bufferViews/".concat(l.index),l).then((function(o){if(5126!==n.componentType||n.normalized||l.byteStride&&l.byteStride!==a){var c=new r(s);return K.o.ForEach(o,n.byteOffset||0,l.byteStride||a,i,n.componentType,c.length,n.normalized||!1,(function(e,t){c[t]=e})),c}return e._GetTypedArray(t,n.componentType,o,n.byteOffset,s)}))}if(n.sparse){var c=n.sparse;n._data=n._data.then((function(s){var l=s,u=Be.Get("".concat(t,"/sparse/indices/bufferView"),o._gltf.bufferViews,c.indices.bufferView),f=Be.Get("".concat(t,"/sparse/values/bufferView"),o._gltf.bufferViews,c.values.bufferView);return Promise.all([o.loadBufferViewAsync("/bufferViews/".concat(u.index),u),o.loadBufferViewAsync("/bufferViews/".concat(f.index),f)]).then((function(o){var s,u=o[0],f=o[1],d=e._GetTypedArray("".concat(t,"/sparse/indices"),c.indices.componentType,u,c.indices.byteOffset,c.count),h=i*c.count;if(5126!==n.componentType||n.normalized){var p=e._GetTypedArray("".concat(t,"/sparse/values"),n.componentType,f,c.values.byteOffset,h);s=new r(h),K.o.ForEach(p,0,a,i,n.componentType,s.length,n.normalized||!1,(function(e,t){s[t]=e}))}else s=e._GetTypedArray("".concat(t,"/sparse/values"),n.componentType,f,c.values.byteOffset,h);for(var _=0,m=0;m<d.length;m++)for(var v=d[m]*i,y=0;y<i;y++)l[v++]=s[_++];return l}))}))}return n._data},e.prototype._loadFloatAccessorAsync=function(e,t){return this._loadAccessorAsync(e,t,Float32Array)},e.prototype._loadIndicesAccessorAsync=function(t,n){if("SCALAR"!==n.type)throw new Error("".concat(t,"/type: Invalid value ").concat(n.type));if(5121!==n.componentType&&5123!==n.componentType&&5125!==n.componentType)throw new Error("".concat(t,"/componentType: Invalid value ").concat(n.componentType));if(n._data)return n._data;if(n.sparse){var r=e._GetTypedArrayConstructor("".concat(t,"/componentType"),n.componentType);n._data=this._loadAccessorAsync(t,n,r)}else{var o=Be.Get("".concat(t,"/bufferView"),this._gltf.bufferViews,n.bufferView);n._data=this.loadBufferViewAsync("/bufferViews/".concat(o.index),o).then((function(r){return e._GetTypedArray(t,n.componentType,r,n.byteOffset,n.count)}))}return n._data},e.prototype._loadVertexBufferViewAsync=function(e){if(e._babylonBuffer)return e._babylonBuffer;var t=this._babylonScene.getEngine();return e._babylonBuffer=this.loadBufferViewAsync("/bufferViews/".concat(e.index),e).then((function(e){return new K.l(t,e,!1)})),e._babylonBuffer},e.prototype._loadVertexAccessorAsync=function(t,n,r){var o;if(null===(o=n._babylonVertexBuffer)||void 0===o?void 0:o[r])return n._babylonVertexBuffer[r];n._babylonVertexBuffer||(n._babylonVertexBuffer={});var i=this._babylonScene.getEngine();if(n.sparse)n._babylonVertexBuffer[r]=this._loadFloatAccessorAsync(t,n).then((function(e){return new K.o(i,e,r,!1)}));else if(r===K.o.MatricesIndicesKind||r===K.o.MatricesIndicesExtraKind)n._babylonVertexBuffer[r]=this._loadFloatAccessorAsync(t,n).then((function(e){return new K.o(i,e,r,!1)}));else{var a=Be.Get("".concat(t,"/bufferView"),this._gltf.bufferViews,n.bufferView);n._babylonVertexBuffer[r]=this._loadVertexBufferViewAsync(a).then((function(o){var s=e._GetNumComponents(t,n.type);return new K.o(i,o,r,!1,!1,a.byteStride,!1,n.byteOffset,s,n.componentType,n.normalized,!0,1,!0)}))}return n._babylonVertexBuffer[r]},e.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(e,t,n){if(!(n instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));var r=new Array;return t&&(t.baseColorFactor?(n.albedoColor=N.Wo.FromArray(t.baseColorFactor),n.alpha=t.baseColorFactor[3]):n.albedoColor=N.Wo.White(),n.metallic=null==t.metallicFactor?1:t.metallicFactor,n.roughness=null==t.roughnessFactor?1:t.roughnessFactor,t.baseColorTexture&&r.push(this.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),t.baseColorTexture,(function(e){e.name="".concat(n.name," (Base Color)"),n.albedoTexture=e}))),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture.nonColorData=!0,r.push(this.loadTextureInfoAsync("".concat(e,"/metallicRoughnessTexture"),t.metallicRoughnessTexture,(function(e){e.name="".concat(n.name," (Metallic Roughness)"),n.metallicTexture=e}))),n.useMetallnessFromMetallicTextureBlue=!0,n.useRoughnessFromMetallicTextureGreen=!0,n.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(r).then((function(){}))},e.prototype._loadMaterialAsync=function(t,n,r,o,i){void 0===i&&(i=function(){});var a=this._extensionsLoadMaterialAsync(t,n,r,o,i);if(a)return a;n._data=n._data||{};var s=n._data[o];if(!s){this.logOpen("".concat(t," ").concat(n.name||""));var l=this.createMaterial(t,n,o);s={babylonMaterial:l,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,n,l)},n._data[o]=s,e.AddPointerMetadata(l,t),this._parent.onMaterialLoadedObservable.notifyObservers(l),this.logClose()}return r&&(s.babylonMeshes.push(r),r.onDisposeObservable.addOnce((function(){var e=s.babylonMeshes.indexOf(r);-1!==e&&s.babylonMeshes.splice(e,1)}))),i(s.babylonMaterial),s.promise.then((function(){return s.babylonMaterial}))},e.prototype._createDefaultMaterial=function(e,t){this._babylonScene._blockEntityCollection=!!this._assetContainer;var n=new Fe.Y(e,this._babylonScene);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.fillMode=t,n.enableSpecularAntiAliasing=!0,n.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,n.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,n.transparencyMode=Fe.Y.PBRMATERIAL_OPAQUE,n.metallic=1,n.roughness=1,n},e.prototype.createMaterial=function(e,t,n){var r=this._extensionsCreateMaterial(e,t,n);if(r)return r;var o=t.name||"material".concat(t.index);return this._createDefaultMaterial(o,n)},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this._extensionsLoadMaterialPropertiesAsync(e,t,n);if(r)return r;var o=new Array;return o.push(this.loadMaterialBasePropertiesAsync(e,t,n)),t.pbrMetallicRoughness&&o.push(this._loadMaterialMetallicRoughnessPropertiesAsync("".concat(e,"/pbrMetallicRoughness"),t.pbrMetallicRoughness,n)),this.loadMaterialAlphaProperties(e,t,n),Promise.all(o).then((function(){}))},e.prototype.loadMaterialBasePropertiesAsync=function(e,t,n){if(!(n instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));var r=new Array;return n.emissiveColor=t.emissiveFactor?N.Wo.FromArray(t.emissiveFactor):new N.Wo(0,0,0),t.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),t.normalTexture&&(t.normalTexture.nonColorData=!0,r.push(this.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,(function(e){e.name="".concat(n.name," (Normal)"),n.bumpTexture=e}))),n.invertNormalMapX=!this._babylonScene.useRightHandedSystem,n.invertNormalMapY=this._babylonScene.useRightHandedSystem,null!=t.normalTexture.scale&&n.bumpTexture&&(n.bumpTexture.level=t.normalTexture.scale),n.forceIrradianceInFragment=!0),t.occlusionTexture&&(t.occlusionTexture.nonColorData=!0,r.push(this.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,(function(e){e.name="".concat(n.name," (Occlusion)"),n.ambientTexture=e}))),n.useAmbientInGrayScale=!0,null!=t.occlusionTexture.strength&&(n.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&r.push(this.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,(function(e){e.name="".concat(n.name," (Emissive)"),n.emissiveTexture=e}))),Promise.all(r).then((function(){}))},e.prototype.loadMaterialAlphaProperties=function(e,t,n){if(!(n instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));switch(t.alphaMode||"OPAQUE"){case"OPAQUE":n.transparencyMode=Fe.Y.PBRMATERIAL_OPAQUE;break;case"MASK":n.transparencyMode=Fe.Y.PBRMATERIAL_ALPHATEST,n.alphaCutOff=null==t.alphaCutoff?.5:t.alphaCutoff,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0);break;case"BLEND":n.transparencyMode=Fe.Y.PBRMATERIAL_ALPHABLEND,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0,n.useAlphaFromAlbedoTexture=!0);break;default:throw new Error("".concat(e,"/alphaMode: Invalid value (").concat(t.alphaMode,")"))}},e.prototype.loadTextureInfoAsync=function(t,n,r){var o=this;void 0===r&&(r=function(){});var i=this._extensionsLoadTextureInfoAsync(t,n,r);if(i)return i;if(this.logOpen("".concat(t)),n.texCoord>=6)throw new Error("".concat(t,"/texCoord: Invalid value (").concat(n.texCoord,")"));var a=Be.Get("".concat(t,"/index"),this._gltf.textures,n.index);a._textureInfo=n;var s=this._loadTextureAsync("/textures/".concat(n.index),a,(function(i){i.coordinatesIndex=n.texCoord||0,e.AddPointerMetadata(i,t),o._parent.onTextureLoadedObservable.notifyObservers(i),r(i)}));return this.logClose(),s},e.prototype._loadTextureAsync=function(t,n,r){void 0===r&&(r=function(){});var o=this._extensionsLoadTextureAsync(t,n,r);if(o)return o;this.logOpen("".concat(t," ").concat(n.name||""));var i=null==n.sampler?e.DefaultSampler:Be.Get("".concat(t,"/sampler"),this._gltf.samplers,n.sampler),a=Be.Get("".concat(t,"/source"),this._gltf.images,n.source),s=this._createTextureAsync(t,i,a,r,void 0,!n._textureInfo.nonColorData);return this.logClose(),s},e.prototype._createTextureAsync=function(e,t,n,r,o,i){var a=this;void 0===r&&(r=function(){});var s=this._loadSampler("/samplers/".concat(t.index),t),l=new Array,c=new Me.B;this._babylonScene._blockEntityCollection=!!this._assetContainer;var u={noMipmap:s.noMipMaps,invertY:!1,samplingMode:s.samplingMode,onLoad:function(){a._disposed||c.resolve()},onError:function(t,n){a._disposed||c.reject(new Error("".concat(e,": ").concat(n&&n.message?n.message:t||"Failed to load texture")))},mimeType:n.mimeType,loaderOptions:o,useSRGBBuffer:!!i&&this._parent.useSRGBBuffers},f=new H.x(null,this._babylonScene,u);return f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.push(c.promise),l.push(this.loadImageAsync("/images/".concat(n.index),n).then((function(e){var t=n.uri||"".concat(a._fileName,"#image").concat(n.index),r="data:".concat(a._uniqueRootUrl).concat(t);f.updateURL(r,e)}))),f.wrapU=s.wrapU,f.wrapV=s.wrapV,r(f),Promise.all(l).then((function(){return f}))},e.prototype._loadSampler=function(t,n){return n._data||(n._data={noMipMaps:9728===n.minFilter||9729===n.minFilter,samplingMode:e._GetTextureSamplingMode(t,n),wrapU:e._GetTextureWrapMode("".concat(t,"/wrapS"),n.wrapS),wrapV:e._GetTextureWrapMode("".concat(t,"/wrapT"),n.wrapT)}),n._data},e.prototype.loadImageAsync=function(e,t){if(!t._data){if(this.logOpen("".concat(e," ").concat(t.name||"")),t.uri)t._data=this.loadUriAsync("".concat(e,"/uri"),t,t.uri);else{var n=Be.Get("".concat(e,"/bufferView"),this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync("/bufferViews/".concat(n.index),n)}this.logClose()}return t._data},e.prototype.loadUriAsync=function(t,n,r){var o=this,i=this._extensionsLoadUriAsync(t,n,r);if(i)return i;if(!e._ValidateUri(r))throw new Error("".concat(t,": '").concat(r,"' is invalid"));if((0,v.VL)(r)){var a=new Uint8Array((0,v.$K)(r));return this.log("".concat(t,": Decoded ").concat(r.substr(0,64),"... (").concat(a.length," bytes)")),Promise.resolve(a)}return this.log("".concat(t,": Loading ").concat(r)),this._parent.preprocessUrlAsync(this._rootUrl+r).then((function(e){return new Promise((function(n,i){o._parent._loadFile(o._babylonScene,e,(function(e){o._disposed||(o.log("".concat(t,": Loaded ").concat(r," (").concat(e.byteLength," bytes)")),n(new Uint8Array(e)))}),!0,(function(e){i(new v.eh("".concat(t,": Failed to load '").concat(r,"'").concat(e?": "+e.status+" "+e.statusText:""),e))}))}))}))},e.AddPointerMetadata=function(e,t){var n=e.metadata=e.metadata||{},r=n.gltf=n.gltf||{};(r.pointers=r.pointers||[]).push(t)},e._GetTextureWrapMode=function(e,t){switch(t=null==t?10497:t){case 33071:return H.x.CLAMP_ADDRESSMODE;case 33648:return H.x.MIRROR_ADDRESSMODE;case 10497:return H.x.WRAP_ADDRESSMODE;default:return c.Y.Warn("".concat(e,": Invalid value (").concat(t,")")),H.x.WRAP_ADDRESSMODE}},e._GetTextureSamplingMode=function(e,t){var n=null==t.magFilter?9729:t.magFilter,r=null==t.minFilter?9987:t.minFilter;if(9729===n)switch(r){case 9728:return H.x.LINEAR_NEAREST;case 9729:return H.x.LINEAR_LINEAR;case 9984:return H.x.LINEAR_NEAREST_MIPNEAREST;case 9985:return H.x.LINEAR_LINEAR_MIPNEAREST;case 9986:return H.x.LINEAR_NEAREST_MIPLINEAR;case 9987:return H.x.LINEAR_LINEAR_MIPLINEAR;default:return c.Y.Warn("".concat(e,"/minFilter: Invalid value (").concat(r,")")),H.x.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==n&&c.Y.Warn("".concat(e,"/magFilter: Invalid value (").concat(n,")")),r){case 9728:return H.x.NEAREST_NEAREST;case 9729:return H.x.NEAREST_LINEAR;case 9984:return H.x.NEAREST_NEAREST_MIPNEAREST;case 9985:return H.x.NEAREST_LINEAR_MIPNEAREST;case 9986:return H.x.NEAREST_NEAREST_MIPLINEAR;case 9987:return H.x.NEAREST_LINEAR_MIPLINEAR;default:return c.Y.Warn("".concat(e,"/minFilter: Invalid value (").concat(r,")")),H.x.NEAREST_NEAREST_MIPNEAREST}},e._GetTypedArrayConstructor=function(e,t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error("".concat(e,": Invalid component type ").concat(t))}},e._GetTypedArray=function(t,n,r,o,i){var a=r.buffer;o=r.byteOffset+(o||0);var s=e._GetTypedArrayConstructor("".concat(t,"/componentType"),n),l=K.o.GetTypeByteLength(n);return o%l!=0?(c.Y.Warn("".concat(t,": Copying buffer as byte offset (").concat(o,") is not a multiple of component type byte length (").concat(l,")")),new s(a.slice(o,o+i*l),0)):new s(a,o,i)},e._GetNumComponents=function(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error("".concat(e,": Invalid type (").concat(t,")"))},e._ValidateUri=function(e){return a.w1.IsBase64(e)||-1===e.indexOf("..")},e._GetDrawMode=function(e,t){switch(null==t&&(t=4),t){case 0:return U.F.PointListDrawMode;case 1:return U.F.LineListDrawMode;case 2:return U.F.LineLoopDrawMode;case 3:return U.F.LineStripDrawMode;case 4:return U.F.TriangleFillMode;case 5:return U.F.TriangleStripDrawMode;case 6:return U.F.TriangleFanDrawMode}throw new Error("".concat(e,": Invalid mesh primitive mode (").concat(t,")"))},e.prototype._compileMaterialsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile materials");var t=new Array;if(this._gltf.materials)for(var n=0,r=this._gltf.materials;n<r.length;n++){var o=r[n];if(o._data)for(var i in o._data)for(var a=o._data[i],s=0,l=a.babylonMeshes;s<l.length;s++){var c=l[s];c.computeWorldMatrix(!0);var u=a.babylonMaterial;t.push(u.forceCompilationAsync(c)),t.push(u.forceCompilationAsync(c,{useInstances:!0})),this._parent.useClipPlane&&(t.push(u.forceCompilationAsync(c,{clipPlane:!0})),t.push(u.forceCompilationAsync(c,{clipPlane:!0,useInstances:!0})))}}return Promise.all(t).then((function(){e._parent._endPerformanceCounter("Compile materials")}))},e.prototype._compileShadowGeneratorsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var t=new Array,n=0,r=this._babylonScene.lights;n<r.length;n++){var o=r[n].getShadowGenerator();o&&t.push(o.forceCompilationAsync())}return Promise.all(t).then((function(){e._parent._endPerformanceCounter("Compile shadow generators")}))},e.prototype._forEachExtensions=function(e){for(var t=0,n=this._extensions;t<n.length;t++){var r=n[t];r.enabled&&e(r)}},e.prototype._applyExtensions=function(e,t,n){for(var r=0,o=this._extensions;r<o.length;r++){var i=o[r];if(i.enabled){var a="".concat(i.name,".").concat(t),s=e;s._activeLoaderExtensionFunctions=s._activeLoaderExtensionFunctions||{};var l=s._activeLoaderExtensionFunctions;if(!l[a]){l[a]=!0;try{var c=n(i);if(c)return c}finally{delete l[a]}}}}return null},e.prototype._extensionsOnLoading=function(){this._forEachExtensions((function(e){return e.onLoading&&e.onLoading()}))},e.prototype._extensionsOnReady=function(){this._forEachExtensions((function(e){return e.onReady&&e.onReady()}))},e.prototype._extensionsLoadSceneAsync=function(e,t){return this._applyExtensions(t,"loadScene",(function(n){return n.loadSceneAsync&&n.loadSceneAsync(e,t)}))},e.prototype._extensionsLoadNodeAsync=function(e,t,n){return this._applyExtensions(t,"loadNode",(function(r){return r.loadNodeAsync&&r.loadNodeAsync(e,t,n)}))},e.prototype._extensionsLoadCameraAsync=function(e,t,n){return this._applyExtensions(t,"loadCamera",(function(r){return r.loadCameraAsync&&r.loadCameraAsync(e,t,n)}))},e.prototype._extensionsLoadVertexDataAsync=function(e,t,n){return this._applyExtensions(t,"loadVertexData",(function(r){return r._loadVertexDataAsync&&r._loadVertexDataAsync(e,t,n)}))},e.prototype._extensionsLoadMeshPrimitiveAsync=function(e,t,n,r,o,i){return this._applyExtensions(o,"loadMeshPrimitive",(function(a){return a._loadMeshPrimitiveAsync&&a._loadMeshPrimitiveAsync(e,t,n,r,o,i)}))},e.prototype._extensionsLoadMaterialAsync=function(e,t,n,r,o){return this._applyExtensions(t,"loadMaterial",(function(i){return i._loadMaterialAsync&&i._loadMaterialAsync(e,t,n,r,o)}))},e.prototype._extensionsCreateMaterial=function(e,t,n){return this._applyExtensions(t,"createMaterial",(function(r){return r.createMaterial&&r.createMaterial(e,t,n)}))},e.prototype._extensionsLoadMaterialPropertiesAsync=function(e,t,n){return this._applyExtensions(t,"loadMaterialProperties",(function(r){return r.loadMaterialPropertiesAsync&&r.loadMaterialPropertiesAsync(e,t,n)}))},e.prototype._extensionsLoadTextureInfoAsync=function(e,t,n){return this._applyExtensions(t,"loadTextureInfo",(function(r){return r.loadTextureInfoAsync&&r.loadTextureInfoAsync(e,t,n)}))},e.prototype._extensionsLoadTextureAsync=function(e,t,n){return this._applyExtensions(t,"loadTexture",(function(r){return r._loadTextureAsync&&r._loadTextureAsync(e,t,n)}))},e.prototype._extensionsLoadAnimationAsync=function(e,t){return this._applyExtensions(t,"loadAnimation",(function(n){return n.loadAnimationAsync&&n.loadAnimationAsync(e,t)}))},e.prototype._extensionsLoadSkinAsync=function(e,t,n){return this._applyExtensions(n,"loadSkin",(function(r){return r._loadSkinAsync&&r._loadSkinAsync(e,t,n)}))},e.prototype._extensionsLoadUriAsync=function(e,t,n){return this._applyExtensions(t,"loadUri",(function(r){return r._loadUriAsync&&r._loadUriAsync(e,t,n)}))},e.prototype._extensionsLoadBufferViewAsync=function(e,t){return this._applyExtensions(t,"loadBufferView",(function(n){return n.loadBufferViewAsync&&n.loadBufferViewAsync(e,t)}))},e.prototype._extensionsLoadBufferAsync=function(e,t,n,r){return this._applyExtensions(t,"loadBuffer",(function(o){return o.loadBufferAsync&&o.loadBufferAsync(e,t,n,r)}))},e.LoadExtensionAsync=function(e,t,n,r){if(!t.extensions)return null;var o=t.extensions[n];return o?r("".concat(e,"/extensions/").concat(n),o):null},e.LoadExtraAsync=function(e,t,n,r){if(!t.extras)return null;var o=t.extras[n];return o?r("".concat(e,"/extras/").concat(n),o):null},e.prototype.isExtensionUsed=function(e){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(e)},e.prototype.logOpen=function(e){this._parent._logOpen(e)},e.prototype.logClose=function(){this._parent._logClose()},e.prototype.log=function(e){this._parent._log(e)},e.prototype.startPerformanceCounter=function(e){this._parent._startPerformanceCounter(e)},e.prototype.endPerformanceCounter=function(e){this._parent._endPerformanceCounter(e)},e._RegisteredExtensions={},e.DefaultSampler={index:-1},e}();b._CreateGLTF2Loader=function(e){return new Ve(e)};var Ue=n(72739),Ge=n(69314),ke=n(68254),We="EXT_lights_image_based",He=function(){function e(e){this.name=We,this._loader=e,this.enabled=this._loader.isExtensionUsed(We)}return e.prototype.dispose=function(){this._loader=null,delete this._lights},e.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._lights=t.lights}},e.prototype.loadSceneAsync=function(e,t){var n=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(r,o){var i=new Array;i.push(n._loader.loadSceneAsync(e,t)),n._loader.logOpen("".concat(r));var a=Be.Get("".concat(r,"/light"),n._lights,o.light);return i.push(n._loadLightAsync("/extensions/".concat(n.name,"/lights/").concat(o.light),a).then((function(e){n._loader.babylonScene.environmentTexture=e}))),n._loader.logClose(),Promise.all(i).then((function(){}))}))},e.prototype._loadLightAsync=function(e,t){var n=this;if(!t._loaded){var r=new Array;this._loader.logOpen("".concat(e));for(var o=new Array(t.specularImages.length),i=function(n){var i=t.specularImages[n];o[n]=new Array(i.length);for(var s=function(t){var s="".concat(e,"/specularImages/").concat(n,"/").concat(t);a._loader.logOpen("".concat(s));var l=i[t],c=Be.Get(s,a._loader.gltf.images,l);r.push(a._loader.loadImageAsync("/images/".concat(l),c).then((function(e){o[n][t]=e}))),a._loader.logClose()},l=0;l<i.length;l++)s(l)},a=this,s=0;s<t.specularImages.length;s++)i(s);this._loader.logClose(),t._loaded=Promise.all(r).then((function(){var r=new ke.N(n._loader.babylonScene,null,t.specularImageSize);if(r.name=t.name||"environment",t._babylonTexture=r,null!=t.intensity&&(r.level=t.intensity),t.rotation){var i=F._f.FromArray(t.rotation);n._loader.babylonScene.useRightHandedSystem||(i=F._f.Inverse(i)),F.y3.FromQuaternionToRef(i,r.getReflectionTextureMatrix())}if(!t.irradianceCoefficients)throw new Error("".concat(e,": Irradiance coefficients are missing"));var a=Ge._.FromArray(t.irradianceCoefficients);a.scaleInPlace(t.intensity),a.convertIrradianceToLambertianRadiance();var s=Ge.i.FromHarmonics(a),l=(o.length-1)/Ue.R.Log2(t.specularImageSize);return r.updateRGBDAsync(o,s,l)}))}return t._loaded.then((function(){return t._babylonTexture}))},e}();Ve.RegisterExtension(We,(function(e){return new He(e)}));n(83236);var je="EXT_mesh_gpu_instancing",Ke=function(){function e(e){this.name=je,this._loader=e,this.enabled=this._loader.isExtensionUsed(je)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadNodeAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(e,o){r._loader._disableInstancedMesh++;var i=r._loader.loadNodeAsync("/nodes/".concat(t.index),t,n);if(r._loader._disableInstancedMesh--,!t._primitiveBabylonMeshes)return i;var a=new Array,s=0,l=function(t){if(null!=o.attributes[t]){var n=Be.Get("".concat(e,"/attributes/").concat(t),r._loader.gltf.accessors,o.attributes[t]);if(a.push(r._loader._loadFloatAccessorAsync("/accessors/".concat(n.bufferView),n)),0===s)s=n.count;else if(s!==n.count)throw new Error("".concat(e,"/attributes: Instance buffer accessors do not have the same count."))}else a.push(Promise.resolve(null))};return l("TRANSLATION"),l("ROTATION"),l("SCALE"),i.then((function(e){return Promise.all(a).then((function(n){var r=n[0],o=n[1],i=n[2],a=new Float32Array(16*s);F.jp.Vector3[0].copyFromFloats(0,0,0),F.jp.Quaternion[0].copyFromFloats(0,0,0,1),F.jp.Vector3[1].copyFromFloats(1,1,1);for(var l=0;l<s;++l)r&&F.P.FromArrayToRef(r,3*l,F.jp.Vector3[0]),o&&F._f.FromArrayToRef(o,4*l,F.jp.Quaternion[0]),i&&F.P.FromArrayToRef(i,3*l,F.jp.Vector3[1]),F.y3.ComposeToRef(F.jp.Vector3[1],F.jp.Quaternion[0],F.jp.Vector3[0],F.jp.Matrix[0]),F.jp.Matrix[0].copyToArray(a,16*l);for(var c=0,u=t._primitiveBabylonMeshes;c<u.length;c++){u[c].thinInstanceSetBuffer("matrix",a,16,!0)}return e}))}))}))},e}();Ve.RegisterExtension(je,(function(e){return new Ke(e)}));var ze=n(76304),Xe="EXT_meshopt_compression",qe=function(){function e(e){this.name=Xe,this.enabled=e.isExtensionUsed(Xe),this._loader=e}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadBufferViewAsync=function(e,t){var n=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(r,o){var i=t;if(i._meshOptData)return i._meshOptData;var a=Be.Get("".concat(e,"/buffer"),n._loader.gltf.buffers,o.buffer);return i._meshOptData=n._loader.loadBufferAsync("/buffers/".concat(a.index),a,o.byteOffset||0,o.byteLength).then((function(e){return ze.K.Default.decodeGltfBufferAsync(e,o.count,o.byteStride,o.mode,o.filter)})),i._meshOptData}))},e}();Ve.RegisterExtension(Xe,(function(e){return new qe(e)}));var Ye="EXT_texture_webp",Ze=function(){function e(e){this.name=Ye,this._loader=e,this.enabled=e.isExtensionUsed(Ye)}return e.prototype.dispose=function(){this._loader=null},e.prototype._loadTextureAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){var a=null==t.sampler?Ve.DefaultSampler:Be.Get("".concat(e,"/sampler"),r._loader.gltf.samplers,t.sampler),s=Be.Get("".concat(o,"/source"),r._loader.gltf.images,i.source);return r._loader._createTextureAsync(e,a,s,(function(e){n(e)}),void 0,!t._textureInfo.nonColorData)}))},e}();Ve.RegisterExtension(Ye,(function(e){return new Ze(e)}));var Qe=n(73848),Je="KHR_draco_mesh_compression",$e=function(){function e(e){this.name=Je,this._loader=e,this.enabled=Qe.J.DecoderAvailable&&this._loader.isExtensionUsed(Je)}return e.prototype.dispose=function(){delete this.dracoCompression,this._loader=null},e.prototype._loadVertexDataAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){if(null!=t.mode){if(5!==t.mode&&4!==t.mode)throw new Error("".concat(e,": Unsupported mode ").concat(t.mode));if(5===t.mode)throw new Error("".concat(e,": Mode ").concat(t.mode," is not currently supported"))}var a={},s={},l=function(o,l){var c=i.attributes[o];if(void 0!==c&&void 0!==t.attributes[o]){a[l]=c;var u=Be.Get("".concat(e,"/attributes/").concat(o),r._loader.gltf.accessors,t.attributes[o]);if(u.normalized&&5126!==u.componentType){var f=1;switch(u.componentType){case 5120:f=127;break;case 5121:f=255;break;case 5122:f=32767;break;case 5123:f=65535}s[l]=f}n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(l)&&n._delayInfo.push(l)}};l("POSITION",K.o.PositionKind),l("NORMAL",K.o.NormalKind),l("TANGENT",K.o.TangentKind),l("TEXCOORD_0",K.o.UVKind),l("TEXCOORD_1",K.o.UV2Kind),l("TEXCOORD_2",K.o.UV3Kind),l("TEXCOORD_3",K.o.UV4Kind),l("TEXCOORD_4",K.o.UV5Kind),l("TEXCOORD_5",K.o.UV6Kind),l("JOINTS_0",K.o.MatricesIndicesKind),l("WEIGHTS_0",K.o.MatricesWeightsKind),l("COLOR_0",K.o.ColorKind);var c=Be.Get(o,r._loader.gltf.bufferViews,i.bufferView);return c._dracoBabylonGeometry||(c._dracoBabylonGeometry=r._loader.loadBufferViewAsync("/bufferViews/".concat(c.index),c).then((function(t){return(r.dracoCompression||Qe.J.Default).decodeMeshAsync(t,a,s).then((function(e){var t=new z.Z(n.name,r._loader.babylonScene);return e.applyToGeometry(t),t})).catch((function(t){throw new Error("".concat(e,": ").concat(t.message))}))}))),c._dracoBabylonGeometry}))},e}();Ve.RegisterExtension(Je,(function(e){return new $e(e)}));var et=n(43812),tt="KHR_lights_punctual",nt=function(){function e(e){this.name=tt,this._loader=e,this.enabled=this._loader.isExtensionUsed(tt)}return e.prototype.dispose=function(){this._loader=null,delete this._lights},e.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._lights=t.lights}},e.prototype.loadNodeAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){return r._loader.loadNodeAsync(e,t,(function(e){var t,a=Be.Get(o,r._lights,i.light),s=a.name||e.name;switch(r._loader.babylonScene._blockEntityCollection=!!r._loader._assetContainer,a.type){case"directional":t=new Q.O(s,F.P.Backward(),r._loader.babylonScene);break;case"point":t=new J.c(s,F.P.Zero(),r._loader.babylonScene);break;case"spot":var l=new $.P(s,F.P.Zero(),F.P.Backward(),0,1,r._loader.babylonScene);l.angle=2*(a.spot&&a.spot.outerConeAngle||Math.PI/4),l.innerAngle=2*(a.spot&&a.spot.innerConeAngle||0),t=l;break;default:throw r._loader.babylonScene._blockEntityCollection=!1,new Error("".concat(o,": Invalid light type (").concat(a.type,")"))}t._parentContainer=r._loader._assetContainer,r._loader.babylonScene._blockEntityCollection=!1,t.falloffType=et._.FALLOFF_GLTF,t.diffuse=a.color?N.Wo.FromArray(a.color):N.Wo.White(),t.intensity=null==a.intensity?1:a.intensity,t.range=null==a.range?Number.MAX_VALUE:a.range,t.parent=e,r._loader._babylonLights.push(t),Ve.AddPointerMetadata(t,o),n(e)}))}))},e}();Ve.RegisterExtension(tt,(function(e){return new nt(e)}));var rt="KHR_materials_pbrSpecularGlossiness",ot=function(){function e(e){this.name=rt,this.order=200,this._loader=e,this.enabled=this._loader.isExtensionUsed(rt)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){var a=new Array;return a.push(r._loader.loadMaterialBasePropertiesAsync(e,t,n)),a.push(r._loadSpecularGlossinessPropertiesAsync(o,t,i,n)),r._loader.loadMaterialAlphaProperties(e,t,n),Promise.all(a).then((function(){}))}))},e.prototype._loadSpecularGlossinessPropertiesAsync=function(e,t,n,r){if(!(r instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));var o=new Array;return r.metallic=null,r.roughness=null,n.diffuseFactor?(r.albedoColor=N.Wo.FromArray(n.diffuseFactor),r.alpha=n.diffuseFactor[3]):r.albedoColor=N.Wo.White(),r.reflectivityColor=n.specularFactor?N.Wo.FromArray(n.specularFactor):N.Wo.White(),r.microSurface=null==n.glossinessFactor?1:n.glossinessFactor,n.diffuseTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/diffuseTexture"),n.diffuseTexture,(function(e){e.name="".concat(r.name," (Diffuse)"),r.albedoTexture=e}))),n.specularGlossinessTexture&&(o.push(this._loader.loadTextureInfoAsync("".concat(e,"/specularGlossinessTexture"),n.specularGlossinessTexture,(function(e){e.name="".concat(r.name," (Specular Glossiness)"),r.reflectivityTexture=e,r.reflectivityTexture.hasAlpha=!0}))),r.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(o).then((function(){}))},e}();Ve.RegisterExtension(rt,(function(e){return new ot(e)}));var it="KHR_materials_unlit",at=function(){function e(e){this.name=it,this.order=210,this._loader=e,this.enabled=this._loader.isExtensionUsed(it)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(){return r._loadUnlitPropertiesAsync(e,t,n)}))},e.prototype._loadUnlitPropertiesAsync=function(e,t,n){if(!(n instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));var r=new Array;n.unlit=!0;var o=t.pbrMetallicRoughness;return o&&(o.baseColorFactor?(n.albedoColor=N.Wo.FromArray(o.baseColorFactor),n.alpha=o.baseColorFactor[3]):n.albedoColor=N.Wo.White(),o.baseColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),o.baseColorTexture,(function(e){e.name="".concat(n.name," (Base Color)"),n.albedoTexture=e})))),t.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,t,n),Promise.all(r).then((function(){}))},e}();Ve.RegisterExtension(it,(function(e){return new at(e)}));var st="KHR_materials_clearcoat",lt=function(){function e(e){this.name=st,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(st)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){var a=new Array;return a.push(r._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(r._loadClearCoatPropertiesAsync(o,i,n)),Promise.all(a).then((function(){}))}))},e.prototype._loadClearCoatPropertiesAsync=function(e,t,n){if(!(n instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));var r=new Array;return n.clearCoat.isEnabled=!0,n.clearCoat.useRoughnessFromMainTexture=!1,n.clearCoat.remapF0OnInterfaceChange=!1,null!=t.clearcoatFactor?n.clearCoat.intensity=t.clearcoatFactor:n.clearCoat.intensity=0,t.clearcoatTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/clearcoatTexture"),t.clearcoatTexture,(function(e){e.name="".concat(n.name," (ClearCoat Intensity)"),n.clearCoat.texture=e}))),null!=t.clearcoatRoughnessFactor?n.clearCoat.roughness=t.clearcoatRoughnessFactor:n.clearCoat.roughness=0,t.clearcoatRoughnessTexture&&(t.clearcoatRoughnessTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync("".concat(e,"/clearcoatRoughnessTexture"),t.clearcoatRoughnessTexture,(function(e){e.name="".concat(n.name," (ClearCoat Roughness)"),n.clearCoat.textureRoughness=e})))),t.clearcoatNormalTexture&&(t.clearcoatNormalTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync("".concat(e,"/clearcoatNormalTexture"),t.clearcoatNormalTexture,(function(e){e.name="".concat(n.name," (ClearCoat Normal)"),n.clearCoat.bumpTexture=e}))),n.invertNormalMapX=!n.getScene().useRightHandedSystem,n.invertNormalMapY=n.getScene().useRightHandedSystem,null!=t.clearcoatNormalTexture.scale&&(n.clearCoat.bumpTexture.level=t.clearcoatNormalTexture.scale)),Promise.all(r).then((function(){}))},e}();Ve.RegisterExtension(st,(function(e){return new lt(e)}));var ct="KHR_materials_iridescence",ut=function(){function e(e){this.name=ct,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(ct)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){var a=new Array;return a.push(r._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(r._loadIridescencePropertiesAsync(o,i,n)),Promise.all(a).then((function(){}))}))},e.prototype._loadIridescencePropertiesAsync=function(e,t,n){var r,o,i,a,s;if(!(n instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));var l=new Array;return n.iridescence.isEnabled=!0,n.iridescence.intensity=null!==(r=t.iridescenceFactor)&&void 0!==r?r:0,n.iridescence.indexOfRefraction=null!==(i=null!==(o=t.iridescenceIor)&&void 0!==o?o:t.iridescenceIOR)&&void 0!==i?i:1.3,n.iridescence.minimumThickness=null!==(a=t.iridescenceThicknessMinimum)&&void 0!==a?a:100,n.iridescence.maximumThickness=null!==(s=t.iridescenceThicknessMaximum)&&void 0!==s?s:400,t.iridescenceTexture&&l.push(this._loader.loadTextureInfoAsync("".concat(e,"/iridescenceTexture"),t.iridescenceTexture,(function(e){e.name="".concat(n.name," (Iridescence Intensity)"),n.iridescence.texture=e}))),t.iridescenceThicknessTexture&&l.push(this._loader.loadTextureInfoAsync("".concat(e,"/iridescenceThicknessTexture"),t.iridescenceThicknessTexture,(function(e){e.name="".concat(n.name," (Iridescence Thickness)"),n.iridescence.thicknessTexture=e}))),Promise.all(l).then((function(){}))},e}();Ve.RegisterExtension(ct,(function(e){return new ut(e)}));var ft="KHR_materials_emissive_strength",dt=function(){function e(e){this.name=ft,this.order=170,this._loader=e,this.enabled=this._loader.isExtensionUsed(ft)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){return r._loader.loadMaterialPropertiesAsync(e,t,n).then((function(){r._loadEmissiveProperties(o,i,n)}))}))},e.prototype._loadEmissiveProperties=function(e,t,n){if(!(n instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));void 0!==t.emissiveStrength&&n.emissiveColor.scaleToRef(t.emissiveStrength,n.emissiveColor)},e}();Ve.RegisterExtension(ft,(function(e){return new dt(e)}));var ht="KHR_materials_sheen",pt=function(){function e(e){this.name=ht,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(ht)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){var a=new Array;return a.push(r._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(r._loadSheenPropertiesAsync(o,i,n)),Promise.all(a).then((function(){}))}))},e.prototype._loadSheenPropertiesAsync=function(e,t,n){if(!(n instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));var r=new Array;return n.sheen.isEnabled=!0,n.sheen.intensity=1,null!=t.sheenColorFactor?n.sheen.color=N.Wo.FromArray(t.sheenColorFactor):n.sheen.color=N.Wo.Black(),t.sheenColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/sheenColorTexture"),t.sheenColorTexture,(function(e){e.name="".concat(n.name," (Sheen Color)"),n.sheen.texture=e}))),void 0!==t.sheenRoughnessFactor?n.sheen.roughness=t.sheenRoughnessFactor:n.sheen.roughness=0,t.sheenRoughnessTexture&&(t.sheenRoughnessTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync("".concat(e,"/sheenRoughnessTexture"),t.sheenRoughnessTexture,(function(e){e.name="".concat(n.name," (Sheen Roughness)"),n.sheen.textureRoughness=e})))),n.sheen.albedoScaling=!0,n.sheen.useRoughnessFromMainTexture=!1,Promise.all(r).then((function(){}))},e}();Ve.RegisterExtension(ht,(function(e){return new pt(e)}));var _t="KHR_materials_specular",mt=function(){function e(e){this.name=_t,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(_t)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){var a=new Array;return a.push(r._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(r._loadSpecularPropertiesAsync(o,i,n)),Promise.all(a).then((function(){}))}))},e.prototype._loadSpecularPropertiesAsync=function(e,t,n){if(!(n instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));var r=new Array;return void 0!==t.specularFactor&&(n.metallicF0Factor=t.specularFactor),void 0!==t.specularColorFactor&&(n.metallicReflectanceColor=N.Wo.FromArray(t.specularColorFactor)),t.specularTexture&&(t.specularTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync("".concat(e,"/specularTexture"),t.specularTexture,(function(e){e.name="".concat(n.name," (Specular F0 Strength)"),n.metallicReflectanceTexture=e,n.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),t.specularColorTexture&&r.push(this._loader.loadTextureInfoAsync("".concat(e,"/specularColorTexture"),t.specularColorTexture,(function(e){e.name="".concat(n.name," (Specular F0 Color)"),n.reflectanceTexture=e}))),Promise.all(r).then((function(){}))},e}();Ve.RegisterExtension(_t,(function(e){return new mt(e)}));var vt="KHR_materials_ior",yt=function(){function e(e){this.name=vt,this.order=180,this._loader=e,this.enabled=this._loader.isExtensionUsed(vt)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){var a=new Array;return a.push(r._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(r._loadIorPropertiesAsync(o,i,n)),Promise.all(a).then((function(){}))}))},e.prototype._loadIorPropertiesAsync=function(t,n,r){if(!(r instanceof Fe.Y))throw new Error("".concat(t,": Material type not supported"));return void 0!==n.ior?r.indexOfRefraction=n.ior:r.indexOfRefraction=e._DEFAULT_IOR,Promise.resolve()},e._DEFAULT_IOR=1.5,e}();Ve.RegisterExtension(vt,(function(e){return new yt(e)}));var gt="KHR_materials_variants",bt=function(){function e(e){this.name=gt,this._loader=e,this.enabled=this._loader.isExtensionUsed(gt)}return e.prototype.dispose=function(){this._loader=null},e.GetAvailableVariants=function(e){var t=this._GetExtensionMetadata(e);return t?Object.keys(t.variants):[]},e.prototype.getAvailableVariants=function(t){return e.GetAvailableVariants(t)},e.SelectVariant=function(e,t){var n=this._GetExtensionMetadata(e);if(!n)throw new Error("Cannot select variant on a glTF mesh that does not have the ".concat(gt," extension"));var r=function(e){var t=n.variants[e];if(t)for(var r=0,o=t;r<o.length;r++){var i=o[r];i.mesh.material=i.material}};if(t instanceof Array)for(var o=0,i=t;o<i.length;o++){r(i[o])}else r(t);n.lastSelected=t},e.prototype.selectVariant=function(t,n){return e.SelectVariant(t,n)},e.Reset=function(e){var t=this._GetExtensionMetadata(e);if(!t)throw new Error("Cannot reset on a glTF mesh that does not have the ".concat(gt," extension"));for(var n=0,r=t.original;n<r.length;n++){var o=r[n];o.mesh.material=o.material}t.lastSelected=null},e.prototype.reset=function(t){return e.Reset(t)},e.GetLastSelectedVariant=function(e){var t=this._GetExtensionMetadata(e);if(!t)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the ".concat(gt," extension"));return t.lastSelected},e.prototype.getLastSelectedVariant=function(t){return e.GetLastSelectedVariant(t)},e._GetExtensionMetadata=function(e){var t,n;return(null===(n=null===(t=null==e?void 0:e.metadata)||void 0===t?void 0:t.gltf)||void 0===n?void 0:n.KHR_materials_variants)||null},e.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._variants=t.variants}},e.prototype._loadMeshPrimitiveAsync=function(t,n,r,o,i,a){var s=this;return Ve.LoadExtensionAsync(t,i,this.name,(function(l,c){var u=new Array;return u.push(s._loader._loadMeshPrimitiveAsync(t,n,r,o,i,(function(n){if(a(n),n instanceof Y.Kj){var r=Ve._GetDrawMode(t,i.mode),o=s._loader.rootBabylonMesh,f=o?o.metadata=o.metadata||{}:{},d=f.gltf=f.gltf||{},h=d.KHR_materials_variants=d.KHR_materials_variants||{lastSelected:null,original:[],variants:{}};h.original.push({mesh:n,material:n.material});for(var p=function(t){var i=c.mappings[t],a=Be.Get("".concat(l,"/mappings/").concat(t,"/material"),s._loader.gltf.materials,i.material);u.push(s._loader._loadMaterialAsync("#/materials/".concat(i.material),a,n,r,(function(t){for(var r=function(r){var a=i.variants[r],l=Be.Get("/extensions/".concat(gt,"/variants/").concat(a),s._variants,a);h.variants[l.name]=h.variants[l.name]||[],h.variants[l.name].push({mesh:n,material:t}),n.onClonedObservable.add((function(t){var r=t,i=null,a=r;do{if(!(a=a.parent))return;i=e._GetExtensionMetadata(a)}while(null===i);if(o&&i===e._GetExtensionMetadata(o)){for(var s in a.metadata={},o.metadata)a.metadata[s]=o.metadata[s];for(var s in a.metadata.gltf=[],o.metadata.gltf)a.metadata.gltf[s]=o.metadata.gltf[s];a.metadata.gltf.KHR_materials_variants={lastSelected:null,original:[],variants:{}};for(var c=0,u=i.original;c<u.length;c++){var f=u[c];a.metadata.gltf.KHR_materials_variants.original.push({mesh:f.mesh,material:f.material})}for(var s in i.variants)if(Object.prototype.hasOwnProperty.call(i.variants,s)){a.metadata.gltf.KHR_materials_variants.variants[s]=[];for(var d=0,h=i.variants[s];d<h.length;d++){var p=h[d];a.metadata.gltf.KHR_materials_variants.variants[s].push({mesh:p.mesh,material:p.material})}}i=a.metadata.gltf.KHR_materials_variants}for(var _=0,m=i.original;_<m.length;_++){(g=m[_]).mesh===n&&(g.mesh=r)}for(var v=0,y=i.variants[l.name];v<y.length;v++){var g;(g=y[v]).mesh===n&&(g.mesh=r)}}))},a=0;a<i.variants.length;++a)r(a)})))},_=0;_<c.mappings.length;++_)p(_)}}))),Promise.all(u).then((function(e){return e[0]}))}))},e}();Ve.RegisterExtension(gt,(function(e){return new bt(e)}));var At=n(63784),Et=function(){function e(t,n){var r=this;this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options=(0,M.pi)((0,M.pi)({},e._GetDefaultOptions()),t),this._scene=n,this._scene._transmissionHelper=this,this.onErrorObservable=new i.y$,this._scene.onDisposeObservable.addOnce((function(){r.dispose()})),this._parseScene(),this._setupRenderTargets()}return e._GetDefaultOptions=function(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:te.g.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}},e.prototype.updateOptions=function(e){var t=this;if(Object.keys(e).filter((function(n){return t._options[n]!==e[n]})).length){var n=(0,M.pi)((0,M.pi)({},this._options),e),r=this._options;this._options=n,n.renderSize===r.renderSize&&n.renderTargetTextureType===r.renderTargetTextureType&&n.generateMipmaps===r.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=n.samples,this._opaqueRenderTarget.lodGenerationScale=n.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=n.lodGenerationOffset):this._setupRenderTargets()}},e.prototype.getOpaqueTarget=function(){return this._opaqueRenderTarget},e.prototype._shouldRenderAsTransmission=function(e){return!!e&&!!(e instanceof Fe.Y&&e.subSurface.isRefractionEnabled)},e.prototype._addMesh=function(e){var t=this;this._materialObservers[e.uniqueId]=e.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),a.w1.SetImmediate((function(){t._shouldRenderAsTransmission(e.material)?(e.material.refractionTexture=t._opaqueRenderTarget,t._transparentMeshesCache.push(e)):t._opaqueMeshesCache.push(e)}))},e.prototype._removeMesh=function(e){e.onMaterialChangedObservable.remove(this._materialObservers[e.uniqueId]),delete this._materialObservers[e.uniqueId];var t=this._transparentMeshesCache.indexOf(e);-1!==t&&this._transparentMeshesCache.splice(t,1),-1!==(t=this._opaqueMeshesCache.indexOf(e))&&this._opaqueMeshesCache.splice(t,1)},e.prototype._parseScene=function(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))},e.prototype._onMeshMaterialChanged=function(e){var t=this._transparentMeshesCache.indexOf(e),n=this._opaqueMeshesCache.indexOf(e);this._shouldRenderAsTransmission(e.material)?(e.material instanceof Fe.Y&&(e.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==n?(this._opaqueMeshesCache.splice(n,1),this._transparentMeshesCache.push(e)):-1===t&&this._transparentMeshesCache.push(e)):-1!==t?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(e)):-1===n&&this._opaqueMeshesCache.push(e)},e.prototype._setupRenderTargets=function(){var e,t,n,r,o=this;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new At._("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=null!==(t=null===(e=this._options.clearColor)||void 0===e?void 0:e.clone())&&void 0!==t?t:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.onBeforeBindObservable.add((function(e){r=o._scene.environmentIntensity,o._scene.environmentIntensity=1,n=o._scene.imageProcessingConfiguration.applyByPostProcess,o._options.clearColor?e.clearColor.copyFrom(o._options.clearColor):o._scene.clearColor.toLinearSpaceToRef(e.clearColor),o._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((function(){o._scene.environmentIntensity=r,o._scene.imageProcessingConfiguration._applyByPostProcess=n})),this._transparentMeshesCache.forEach((function(e){o._shouldRenderAsTransmission(e.material)&&(e.material.refractionTexture=o._opaqueRenderTarget)}))},e.prototype.dispose=function(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]},e}(),Tt="KHR_materials_transmission",xt=function(){function e(e){this.name=Tt,this.order=175,this._loader=e,this.enabled=this._loader.isExtensionUsed(Tt),this.enabled&&(e.parent.transparencyAsCoverage=!0)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){var a=new Array;return a.push(r._loader.loadMaterialBasePropertiesAsync(e,t,n)),a.push(r._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(r._loadTransparentPropertiesAsync(o,t,n,i)),Promise.all(a).then((function(){}))}))},e.prototype._loadTransparentPropertiesAsync=function(e,t,n,r){if(!(n instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));var o=n;if(o.subSurface.isRefractionEnabled=!0,o.subSurface.volumeIndexOfRefraction=1,o.subSurface.useAlbedoToTintRefraction=!0,void 0===r.transmissionFactor)return o.subSurface.refractionIntensity=0,o.subSurface.isRefractionEnabled=!1,Promise.resolve();o.subSurface.refractionIntensity=r.transmissionFactor;var i=o.getScene();return o.subSurface.refractionIntensity&&!i._transmissionHelper&&new Et({},o.getScene()),o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=0,r.transmissionTexture?(r.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(e,"/transmissionTexture"),r.transmissionTexture,void 0).then((function(e){o.subSurface.refractionIntensityTexture=e,o.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()},e}();Ve.RegisterExtension(Tt,(function(e){return new xt(e)}));var Ct="KHR_materials_translucency",St=function(){function e(e){this.name=Ct,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ct),this.enabled&&(e.parent.transparencyAsCoverage=!0)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){var a=new Array;return a.push(r._loader.loadMaterialBasePropertiesAsync(e,t,n)),a.push(r._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(r._loadTranslucentPropertiesAsync(o,t,n,i)),Promise.all(a).then((function(){}))}))},e.prototype._loadTranslucentPropertiesAsync=function(e,t,n,r){if(!(n instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));var o=n;return o.subSurface.isTranslucencyEnabled=!0,o.subSurface.volumeIndexOfRefraction=1,o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=0,o.subSurface.useAlbedoToTintTranslucency=!0,void 0===r.translucencyFactor?(o.subSurface.translucencyIntensity=0,o.subSurface.isTranslucencyEnabled=!1,Promise.resolve()):(o.subSurface.translucencyIntensity=r.translucencyFactor,r.translucencyTexture?(r.translucencyTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(e,"/translucencyTexture"),r.translucencyTexture).then((function(e){o.subSurface.translucencyIntensityTexture=e}))):Promise.resolve())},e}();Ve.RegisterExtension(Ct,(function(e){return new St(e)}));var Pt="KHR_materials_volume",Ot=function(){function e(e){this.name=Pt,this.order=173,this._loader=e,this.enabled=this._loader.isExtensionUsed(Pt),this.enabled&&this._loader._disableInstancedMesh++}return e.prototype.dispose=function(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){var a=new Array;return a.push(r._loader.loadMaterialBasePropertiesAsync(e,t,n)),a.push(r._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(r._loadVolumePropertiesAsync(o,t,n,i)),Promise.all(a).then((function(){}))}))},e.prototype._loadVolumePropertiesAsync=function(e,t,n,r){if(!(n instanceof Fe.Y))throw new Error("".concat(e,": Material type not supported"));if(!n.subSurface.isRefractionEnabled&&!n.subSurface.isTranslucencyEnabled||!r.thicknessFactor)return Promise.resolve();n.subSurface.volumeIndexOfRefraction=n.indexOfRefraction;var o=void 0!==r.attenuationDistance?r.attenuationDistance:Number.MAX_VALUE;return n.subSurface.tintColorAtDistance=o,void 0!==r.attenuationColor&&3==r.attenuationColor.length&&n.subSurface.tintColor.copyFromFloats(r.attenuationColor[0],r.attenuationColor[1],r.attenuationColor[2]),n.subSurface.minimumThickness=0,n.subSurface.maximumThickness=r.thicknessFactor,n.subSurface.useThicknessAsDepth=!0,r.thicknessTexture?(r.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(e,"/thicknessTexture"),r.thicknessTexture).then((function(e){n.subSurface.thicknessTexture=e,n.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()},e}();Ve.RegisterExtension(Pt,(function(e){return new Ot(e)}));var Mt="KHR_mesh_quantization",Lt=function(){function e(e){this.name=Mt,this.enabled=e.isExtensionUsed(Mt)}return e.prototype.dispose=function(){},e}();Ve.RegisterExtension(Mt,(function(e){return new Lt(e)}));var Ft="KHR_texture_basisu",Nt=function(){function e(e){this.name=Ft,this._loader=e,this.enabled=e.isExtensionUsed(Ft)}return e.prototype.dispose=function(){this._loader=null},e.prototype._loadTextureAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){var a=null==t.sampler?Ve.DefaultSampler:Be.Get("".concat(e,"/sampler"),r._loader.gltf.samplers,t.sampler),s=Be.Get("".concat(o,"/source"),r._loader.gltf.images,i.source);return r._loader._createTextureAsync(e,a,s,(function(e){n(e)}),t._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!t._textureInfo.nonColorData)}))},e}();Ve.RegisterExtension(Ft,(function(e){return new Nt(e)}));var wt="KHR_texture_transform",It=function(){function e(e){this.name=wt,this._loader=e,this.enabled=this._loader.isExtensionUsed(wt)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadTextureInfoAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(o,i){return r._loader.loadTextureInfoAsync(e,t,(function(e){if(!(e instanceof H.x))throw new Error("".concat(o,": Texture type not supported"));i.offset&&(e.uOffset=i.offset[0],e.vOffset=i.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,i.rotation&&(e.wAng=-i.rotation),i.scale&&(e.uScale=i.scale[0],e.vScale=i.scale[1]),null!=i.texCoord&&(e.coordinatesIndex=i.texCoord),n(e)}))}))},e}();Ve.RegisterExtension(wt,(function(e){return new It(e)}));var Rt="KHR_xmp_json_ld",Dt=function(){function e(e){this.name=Rt,this.order=100,this._loader=e,this.enabled=this._loader.isExtensionUsed(Rt)}return e.prototype.dispose=function(){this._loader=null},e.prototype.onLoading=function(){var e,t,n;if(null!==this._loader.rootBabylonMesh){var r=null===(e=this._loader.gltf.extensions)||void 0===e?void 0:e.KHR_xmp_json_ld,o=null===(n=null===(t=this._loader.gltf.asset)||void 0===t?void 0:t.extensions)||void 0===n?void 0:n.KHR_xmp_json_ld;if(r&&o){var i=+o.packet;r.packets&&i<r.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=r.packets[i])}}},e}();Ve.RegisterExtension(Rt,(function(e){return new Dt(e)}));var Bt=n(80508),Vt=n(5007),Ut=n(59020),Gt="MSFT_audio_emitter",kt=function(){function e(e){this.name=Gt,this._loader=e,this.enabled=this._loader.isExtensionUsed(Gt)}return e.prototype.dispose=function(){this._loader=null,this._clips=null,this._emitters=null},e.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._clips=t.clips,this._emitters=t.emitters,Be.Assign(this._clips),Be.Assign(this._emitters)}},e.prototype.loadSceneAsync=function(e,t){var n=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(r,o){var i=new Array;i.push(n._loader.loadSceneAsync(e,t));for(var a=0,s=o.emitters;a<s.length;a++){var l=s[a],c=Be.Get("".concat(r,"/emitters"),n._emitters,l);if(null!=c.refDistance||null!=c.maxDistance||null!=c.rolloffFactor||null!=c.distanceModel||null!=c.innerAngle||null!=c.outerAngle)throw new Error("".concat(r,": Direction or Distance properties are not allowed on emitters attached to a scene"));i.push(n._loadEmitterAsync("".concat(r,"/emitters/").concat(c.index),c))}return Promise.all(i).then((function(){}))}))},e.prototype.loadNodeAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(e,o){var i=new Array;return r._loader.loadNodeAsync(e,t,(function(t){for(var s=function(n){var o=Be.Get("".concat(e,"/emitters"),r._emitters,n);i.push(r._loadEmitterAsync("".concat(e,"/emitters/").concat(o.index),o).then((function(){for(var e=0,n=o._babylonSounds;e<n.length;e++){var r=n[e];r.attachToMesh(t),null==o.innerAngle&&null==o.outerAngle||(r.setLocalDirectionToMesh(F.P.Forward()),r.setDirectionalCone(2*a.w1.ToDegrees(null==o.innerAngle?Math.PI:o.innerAngle),2*a.w1.ToDegrees(null==o.outerAngle?Math.PI:o.outerAngle),0))}})))},l=0,c=o.emitters;l<c.length;l++){s(c[l])}n(t)})).then((function(e){return Promise.all(i).then((function(){return e}))}))}))},e.prototype.loadAnimationAsync=function(e,t){var n=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(r,o){return n._loader.loadAnimationAsync(e,t).then((function(i){var a=new Array;Be.Assign(o.events);for(var s=0,l=o.events;s<l.length;s++){var c=l[s];a.push(n._loadAnimationEventAsync("".concat(r,"/events/").concat(c.index),e,t,c,i))}return Promise.all(a).then((function(){return i}))}))}))},e.prototype._loadClipAsync=function(e,t){if(t._objectURL)return t._objectURL;var n;if(t.uri)n=this._loader.loadUriAsync(e,t,t.uri);else{var r=Be.Get("".concat(e,"/bufferView"),this._loader.gltf.bufferViews,t.bufferView);n=this._loader.loadBufferViewAsync("/bufferViews/".concat(r.index),r)}return t._objectURL=n.then((function(e){return URL.createObjectURL(new Blob([e],{type:t.mimeType}))})),t._objectURL},e.prototype._loadEmitterAsync=function(e,t){var n=this;if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){for(var r=new Array,o=t.name||"emitter".concat(t.index),i={loop:!1,autoplay:!1,volume:null==t.volume?1:t.volume},s=function(e){var a="/extensions/".concat(l.name,"/clips"),s=Be.Get(a,l._clips,t.clips[e].clip);r.push(l._loadClipAsync("".concat(a,"/").concat(t.clips[e].clip),s).then((function(r){var a=t._babylonSounds[e]=new Vt.$(o,r,n._loader.babylonScene,null,i);a.refDistance=t.refDistance||1,a.maxDistance=t.maxDistance||256,a.rolloffFactor=t.rolloffFactor||1,a.distanceModel=t.distanceModel||"exponential"})))},l=this,c=0;c<t.clips.length;c++)s(c);var u=Promise.all(r).then((function(){var e=t.clips.map((function(e){return e.weight||1})),n=new Ut.s(t.loop||!1,t._babylonSounds,e);t.innerAngle&&(n.directionalConeInnerAngle=2*a.w1.ToDegrees(t.innerAngle)),t.outerAngle&&(n.directionalConeOuterAngle=2*a.w1.ToDegrees(t.outerAngle)),t.volume&&(n.volume=t.volume),t._babylonData.sound=n}));t._babylonData={loaded:u}}return t._babylonData.loaded},e.prototype._getEventAction=function(e,t,n,r,o){switch(n){case"play":return function(e){var n=(o||0)+(e-r);t.play(n)};case"stop":return function(){t.stop()};case"pause":return function(){t.pause()};default:throw new Error("".concat(e,": Unsupported action ").concat(n))}},e.prototype._loadAnimationEventAsync=function(e,t,n,r,o){var i=this;if(0==o.targetedAnimations.length)return Promise.resolve();var a=o.targetedAnimations[0],s=r.emitter,l=Be.Get("/extensions/".concat(this.name,"/emitters"),this._emitters,s);return this._loadEmitterAsync(e,l).then((function(){var t=l._babylonData.sound;if(t){var n=new Bt.O(r.time,i._getEventAction(e,t,r.action,r.time,r.startOffset));a.animation.addEvent(n),o.onAnimationGroupEndObservable.add((function(){t.stop()})),o.onAnimationGroupPauseObservable.add((function(){t.pause()}))}}))},e}();Ve.RegisterExtension(Gt,(function(e){return new kt(e)}));var Wt="MSFT_lod",Ht=function(){function e(e){this.name=Wt,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new i.y$,this.onMaterialLODsLoadedObservable=new i.y$,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=e,this.enabled=this._loader.isExtensionUsed(Wt)}return e.prototype.dispose=function(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},e.prototype.onReady=function(){for(var e=this,t=function(t){var r=Promise.all(n._nodePromiseLODs[t]).then((function(){0!==t&&(e._loader.endPerformanceCounter("Node LOD ".concat(t)),e._loader.log("Loaded node LOD ".concat(t))),e.onNodeLODsLoadedObservable.notifyObservers(t),t!==e._nodePromiseLODs.length-1&&(e._loader.startPerformanceCounter("Node LOD ".concat(t+1)),e._loadBufferLOD(e._nodeBufferLODs,t+1),e._nodeSignalLODs[t]&&e._nodeSignalLODs[t].resolve())}));n._loader._completePromises.push(r)},n=this,r=0;r<this._nodePromiseLODs.length;r++)t(r);var o=function(t){var n=Promise.all(i._materialPromiseLODs[t]).then((function(){0!==t&&(e._loader.endPerformanceCounter("Material LOD ".concat(t)),e._loader.log("Loaded material LOD ".concat(t))),e.onMaterialLODsLoadedObservable.notifyObservers(t),t!==e._materialPromiseLODs.length-1&&(e._loader.startPerformanceCounter("Material LOD ".concat(t+1)),e._loadBufferLOD(e._materialBufferLODs,t+1),e._materialSignalLODs[t]&&e._materialSignalLODs[t].resolve())}));i._loader._completePromises.push(n)},i=this;for(r=0;r<this._materialPromiseLODs.length;r++)o(r)},e.prototype.loadSceneAsync=function(e,t){var n=this._loader.loadSceneAsync(e,t);return this._loadBufferLOD(this._bufferLODs,0),n},e.prototype.loadNodeAsync=function(e,t,n){var r=this;return Ve.LoadExtensionAsync(e,t,this.name,(function(e,o){var i,a=r._getLODs(e,t,r._loader.gltf.nodes,o.ids);r._loader.logOpen("".concat(e));for(var s=function(e){var t=a[e];0!==e&&(r._nodeIndexLOD=e,r._nodeSignalLODs[e]=r._nodeSignalLODs[e]||new Me.B);var o=r._loader.loadNodeAsync("/nodes/".concat(t.index),t,(function(e){n(e),e.setEnabled(!1)})).then((function(t){if(0!==e){var n=a[e-1];n._babylonTransformNode&&(r._disposeTransformNode(n._babylonTransformNode),delete n._babylonTransformNode)}return t.setEnabled(!0),t}));r._nodePromiseLODs[e]=r._nodePromiseLODs[e]||[],0===e?i=o:(r._nodeIndexLOD=null,r._nodePromiseLODs[e].push(o))},l=0;l<a.length;l++)s(l);return r._loader.logClose(),i}))},e.prototype._loadMaterialAsync=function(e,t,n,r,o){var i=this;return this._nodeIndexLOD?null:Ve.LoadExtensionAsync(e,t,this.name,(function(e,a){var s,l=i._getLODs(e,t,i._loader.gltf.materials,a.ids);i._loader.logOpen("".concat(e));for(var c=function(e){var t=l[e];0!==e&&(i._materialIndexLOD=e);var a=i._loader._loadMaterialAsync("/materials/".concat(t.index),t,n,r,(function(t){0===e&&o(t)})).then((function(t){if(0!==e){o(t);var n=l[e-1]._data;n[r]&&(i._disposeMaterials([n[r].babylonMaterial]),delete n[r])}return t}));i._materialPromiseLODs[e]=i._materialPromiseLODs[e]||[],0===e?s=a:(i._materialIndexLOD=null,i._materialPromiseLODs[e].push(a))},u=0;u<l.length;u++)c(u);return i._loader.logClose(),s}))},e.prototype._loadUriAsync=function(e,t,n){var r=this;if(null!==this._nodeIndexLOD){this._loader.log("deferred");var o=this._nodeIndexLOD-1;return this._nodeSignalLODs[o]=this._nodeSignalLODs[o]||new Me.B,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((function(){return r._loader.loadUriAsync(e,t,n)}))}if(null!==this._materialIndexLOD){this._loader.log("deferred");o=this._materialIndexLOD-1;return this._materialSignalLODs[o]=this._materialSignalLODs[o]||new Me.B,this._materialSignalLODs[o].promise.then((function(){return r._loader.loadUriAsync(e,t,n)}))}return null},e.prototype.loadBufferAsync=function(e,t,n,r){if(this._loader.parent.useRangeRequests&&!t.uri){if(!this._loader.bin)throw new Error("".concat(e,": Uri is missing or the binary glTF is missing its binary chunk"));var o=function(e,t){var o=n,i=o+r-1,a=e[t];return a?(a.start=Math.min(a.start,o),a.end=Math.max(a.end,i)):(a={start:o,end:i,loaded:new Me.B},e[t]=a),a.loaded.promise.then((function(e){return new Uint8Array(e.buffer,e.byteOffset+n-a.start,r)}))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?o(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?o(this._materialBufferLODs,this._materialIndexLOD):o(this._bufferLODs,0)}return null},e.prototype._loadBufferLOD=function(e,t){var n=e[t];n&&(this._loader.log("Loading buffer range [".concat(n.start,"-").concat(n.end,"]")),this._loader.bin.readAsync(n.start,n.end-n.start+1).then((function(e){n.loaded.resolve(e)}),(function(e){n.loaded.reject(e)})))},e.prototype._getLODs=function(e,t,n,r){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var o=new Array,i=r.length-1;i>=0;i--)if(o.push(Be.Get("".concat(e,"/ids/").concat(r[i]),n,r[i])),o.length===this.maxLODsToLoad)return o;return o.push(t),o},e.prototype._disposeTransformNode=function(e){var t=this,n=new Array,r=e.material;r&&n.push(r);for(var o=0,i=e.getChildMeshes();o<i.length;o++){var a=i[o];a.material&&n.push(a.material)}e.dispose();var s=n.filter((function(e){return t._loader.babylonScene.meshes.every((function(t){return t.material!=e}))}));this._disposeMaterials(s)},e.prototype._disposeMaterials=function(e){for(var t={},n=0,r=e;n<r.length;n++){for(var o=0,i=(u=r[n]).getActiveTextures();o<i.length;o++){var a=i[o];t[a.uniqueId]=a}u.dispose()}for(var s in t)for(var l=0,c=this._loader.babylonScene.materials;l<c.length;l++){var u;(u=c[l]).hasTexture(t[s])&&delete t[s]}for(var s in t)t[s].dispose()},e}();Ve.RegisterExtension(Wt,(function(e){return new Ht(e)}));var jt="MSFT_minecraftMesh",Kt=function(){function e(e){this.name=jt,this._loader=e,this.enabled=this._loader.isExtensionUsed(jt)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtraAsync(e,t,this.name,(function(o,i){if(i){if(!(n instanceof Fe.Y))throw new Error("".concat(o,": Material type not supported"));var a=r._loader.loadMaterialPropertiesAsync(e,t,n);return n.needAlphaBlending()&&(n.forceDepthWrite=!0,n.separateCullingPass=!0),n.backFaceCulling=n.forceDepthWrite,n.twoSidedLighting=!0,a}return null}))},e}();Ve.RegisterExtension(jt,(function(e){return new Kt(e)}));var zt="MSFT_sRGBFactors",Xt=function(){function e(e){this.name=zt,this._loader=e,this.enabled=this._loader.isExtensionUsed(zt)}return e.prototype.dispose=function(){this._loader=null},e.prototype.loadMaterialPropertiesAsync=function(e,t,n){var r=this;return Ve.LoadExtraAsync(e,t,this.name,(function(o,i){if(i){if(!(n instanceof Fe.Y))throw new Error("".concat(o,": Material type not supported"));var a=r._loader.loadMaterialPropertiesAsync(e,t,n);return n.albedoTexture||n.albedoColor.toLinearSpaceToRef(n.albedoColor),n.reflectivityTexture||n.reflectivityColor.toLinearSpaceToRef(n.reflectivityColor),a}return null}))},e}();Ve.RegisterExtension(zt,(function(e){return new Xt(e)}));var qt="ExtrasAsMetadata",Yt=function(){function e(e){this.name=qt,this.enabled=!0,this._loader=e}return e.prototype._assignExtras=function(e,t){if(t.extras&&Object.keys(t.extras).length>0){var n=e.metadata=e.metadata||{};(n.gltf=n.gltf||{}).extras=t.extras}},e.prototype.dispose=function(){this._loader=null},e.prototype.loadNodeAsync=function(e,t,n){var r=this;return this._loader.loadNodeAsync(e,t,(function(e){r._assignExtras(e,t),n(e)}))},e.prototype.loadCameraAsync=function(e,t,n){var r=this;return this._loader.loadCameraAsync(e,t,(function(e){r._assignExtras(e,t),n(e)}))},e.prototype.createMaterial=function(e,t,n){var r=this._loader.createMaterial(e,t,n);return this._assignExtras(r,t),r},e}();Ve.RegisterExtension(qt,(function(e){return new Yt(e)}))},23556:(e,t,n)=>{n.r(t),n.d(t,{GLTF1:()=>r.ms,GLTF2:()=>r.VW,GLTFFileLoader:()=>r.ey,GLTFLoaderAnimationStartMode:()=>r.B2,GLTFLoaderCoordinateSystemMode:()=>r.em,GLTFLoaderState:()=>r.zA,GLTFValidation:()=>r.JM,MTLFileLoader:()=>o.IG,OBJFileLoader:()=>o.mp,STLFileLoader:()=>i.a,SolidParser:()=>o.Pq});var r=n(58603),o=n(65301),i=n(5515)},77889:(e,t,n)=>{n.r(t),n.d(t,{CellMaterial:()=>y,CustomMaterial:()=>T,CustomShaderStructure:()=>A,FireMaterial:()=>w,FurMaterial:()=>U,GradientMaterial:()=>H,GridMaterial:()=>X,LavaMaterial:()=>q.n,MixMaterial:()=>Y.t,NormalMaterial:()=>Z.o,PBRCustomMaterial:()=>P,ShaderAlebdoParts:()=>S,ShaderSpecialParts:()=>E,ShadowOnlyMaterial:()=>Q.O,SimpleMaterial:()=>J.q,SkyMaterial:()=>$.f,TerrainMaterial:()=>ee.F,TriPlanarMaterial:()=>te.P,WaterMaterial:()=>ne.H});var r=n(31191),o=n(96969),i=n(15631),a=n(64849),s=n(90360),l=n(74375),c=n(46110),u=n(72208),f=n(65273),d=n(48620),h=n(69543),p=(n(54081),n(46545),n(46462),n(43921),n(6506),n(67528),n(62495),n(37513),n(62348),n(87954),n(85019),n(34140),"precision highp float;\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\nvec3 computeCustomDiffuseLighting(lightingInfo info,vec3 diffuseBase,float shadow)\n{\ndiffuseBase=info.diffuse*shadow;\n#ifdef CELLBASIC\nfloat level=1.0;\nif (info.ndl<0.5)\nlevel=0.5;\ndiffuseBase.rgb*vec3(level,level,level);\n#else\nfloat ToonThresholds[4];\nToonThresholds[0]=0.95;\nToonThresholds[1]=0.5;\nToonThresholds[2]=0.2;\nToonThresholds[3]=0.03;\nfloat ToonBrightnessLevels[5];\nToonBrightnessLevels[0]=1.0;\nToonBrightnessLevels[1]=0.8;\nToonBrightnessLevels[2]=0.6;\nToonBrightnessLevels[3]=0.35;\nToonBrightnessLevels[4]=0.2;\nif (info.ndl>ToonThresholds[0])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[0];\n}\nelse if (info.ndl>ToonThresholds[1])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[1];\n}\nelse if (info.ndl>ToonThresholds[2])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[2];\n}\nelse if (info.ndl>ToonThresholds[3])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[3];\n}\nelse\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[4];\n}\n#endif\nreturn max(diffuseBase,vec3(0.2));\n}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\nlightingInfo info;\nvec3 diffuseBase=vec3(0.,0.,0.);\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif \n#include<lightFragment>[0..maxSimultaneousLights]\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}");h.v.ShadersStore.cellPixelShader=p;n(51802),n(67196),n(4511),n(52974),n(74255),n(97236),n(59725),n(35211),n(95441),n(97220),n(16744),n(53035);var _="precision highp float;\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x==0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";h.v.ShadersStore.cellVertexShader=_;var m=n(38309),v=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.INSTANCESCOLOR=!1,t.NDOTL=!0,t.CUSTOMUSERLIGHTING=!0,t.CELLBASIC=!0,t.DEPTHPREPASS=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,r.ZT)(t,e),t}(a.H),y=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.diffuseColor=new i.Wo(1,1,1),r._computeHighLevel=!1,r._disableLighting=!1,r._maxSimultaneousLights=4,r}return(0,r.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new v);var r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;var i=o.getEngine();if(r._areTexturesDirty&&(r._needUVs=!1,o.texturesEnabled&&this._diffuseTexture&&c.k.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;r._needUVs=!0,r.DIFFUSE=!0}if(r.CELLBASIC=!this.computeHighLevel,s.G.PrepareDefinesForMisc(e,o,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),r),r._needNormals=s.G.PrepareDefinesForLights(o,e,r,!1,this._maxSimultaneousLights,this._disableLighting),s.G.PrepareDefinesForFrameBoundValues(o,i,r,!!n),s.G.PrepareDefinesForAttributes(e,r,!0,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();var a=new m.L;r.FOG&&a.addFallback(1,"FOG"),s.G.HandleFallbacksForShadows(r,a,this.maxSimultaneousLights),r.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];r.NORMAL&&l.push(u.o.NormalKind),r.UV1&&l.push(u.o.UVKind),r.UV2&&l.push(u.o.UV2Kind),r.VERTEXCOLOR&&l.push(u.o.ColorKind),s.G.PrepareAttributesForBones(l,e,r,a),s.G.PrepareAttributesForInstances(l,r);var f=r.toString(),d=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix"],h=["diffuseSampler"],p=new Array;s.G.PrepareUniformsAndSamplersList({uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:r,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(o.getEngine().createEffect("cell",{attributes:l,uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:f,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights-1}},i),r,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(r._renderId=o.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n.materialDefines;if(o){var i=n.effect;i&&(this._activeEffect=i,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),s.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(r,i)&&(this._diffuseTexture&&c.k.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),s.G.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),r.bindEyePosition(i)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.lightsEnabled&&!this.disableLighting&&s.G.BindLights(r,t,this._activeEffect,o,this._maxSimultaneousLights),r.fogEnabled&&t.applyFog&&r.fogMode!==f.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),s.G.BindFogParameters(r,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._diffuseTexture===t},t.prototype.dispose=function(t){this._diffuseTexture&&this._diffuseTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.getClassName=function(){return"CellMaterial"},t.prototype.clone=function(e){var n=this;return o.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.CellMaterial",t},t.Parse=function(e,n,r){return o.p4.Parse((function(){return new t(e.name,n)}),e,n,r)},(0,r.gn)([(0,o.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,r.gn)([(0,o.n9)("diffuse")],t.prototype,"diffuseColor",void 0),(0,r.gn)([(0,o.qC)("computeHighLevel")],t.prototype,"_computeHighLevel",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"computeHighLevel",void 0),(0,r.gn)([(0,o.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,r.gn)([(0,o.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(l.a);(0,d.H)("BABYLON.CellMaterial",y);var g=n(9256),b=n(3085),A=function(){},E=function(){},T=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.CustomParts=new E,r.customShaderNameResolve=r.Builder,r.FragmentShader=g.Q.ShadersStore.defaultPixelShader,r.VertexShader=g.Q.ShadersStore.defaultVertexShader,r}return(0,r.ZT)(t,e),t.prototype.AttachAfterBind=function(e,t){if(this._newUniformInstances)for(var n in this._newUniformInstances){"vec2"==(r=n.toString().split("-"))[0]?t.setVector2(r[1],this._newUniformInstances[n]):"vec3"==r[0]?t.setVector3(r[1],this._newUniformInstances[n]):"vec4"==r[0]?t.setVector4(r[1],this._newUniformInstances[n]):"mat4"==r[0]?t.setMatrix(r[1],this._newUniformInstances[n]):"float"==r[0]&&t.setFloat(r[1],this._newUniformInstances[n])}if(this._newSamplerInstances)for(var n in this._newSamplerInstances){var r;"sampler2D"==(r=n.toString().split("-"))[0]&&this._newSamplerInstances[n].isReady&&this._newSamplerInstances[n].isReady()&&t.setTexture(r[1],this._newSamplerInstances[n])}},t.prototype.ReviewUniform=function(e,t){if("uniform"==e&&this._newUniforms)for(var n=0;n<this._newUniforms.length;n++)-1==this._customUniform[n].indexOf("sampler")&&t.push(this._newUniforms[n]);if("sampler"==e&&this._newUniforms)for(n=0;n<this._newUniforms.length;n++)-1!=this._customUniform[n].indexOf("sampler")&&t.push(this._newUniforms[n]);return t},t.prototype.Builder=function(e,n,r,o,i,a){var s=this;if(a&&this._customAttributes&&this._customAttributes.length>0&&a.push.apply(a,this._customAttributes),this.ReviewUniform("uniform",n),this.ReviewUniform("sampler",o),this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1,t.ShaderIndexer++;var l="custom_"+t.ShaderIndexer,c=this._afterBind.bind(this);return this._afterBind=function(e,t){if(t){s.AttachAfterBind(e,t);try{c(e,t)}catch(t){}}},g.Q.ShadersStore[l+"VertexShader"]=this.VertexShader.replace("#define CUSTOM_VERTEX_BEGIN",this.CustomParts.Vertex_Begin?this.CustomParts.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Vertex_Definitions?this.CustomParts.Vertex_Definitions:"")).replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.CustomParts.Vertex_MainBegin?this.CustomParts.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.CustomParts.Vertex_Before_PositionUpdated?this.CustomParts.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.CustomParts.Vertex_Before_NormalUpdated?this.CustomParts.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.CustomParts.Vertex_MainEnd?this.CustomParts.Vertex_MainEnd:""),this.CustomParts.Vertex_After_WorldPosComputed&&(g.Q.ShadersStore[l+"VertexShader"]=g.Q.ShadersStore[l+"VertexShader"].replace("#define CUSTOM_VERTEX_UPDATE_WORLDPOS",this.CustomParts.Vertex_After_WorldPosComputed)),g.Q.ShadersStore[l+"PixelShader"]=this.FragmentShader.replace("#define CUSTOM_FRAGMENT_BEGIN",this.CustomParts.Fragment_Begin?this.CustomParts.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.CustomParts.Fragment_MainBegin?this.CustomParts.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Fragment_Definitions?this.CustomParts.Fragment_Definitions:"")).replace("#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE",this.CustomParts.Fragment_Custom_Diffuse?this.CustomParts.Fragment_Custom_Diffuse:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.CustomParts.Fragment_Custom_Alpha?this.CustomParts.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.CustomParts.Fragment_Before_Lights?this.CustomParts.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.CustomParts.Fragment_Before_FragColor?this.CustomParts.Fragment_Before_FragColor:"").replace("#define CUSTOM_FRAGMENT_MAIN_END",this.CustomParts.Fragment_MainEnd?this.CustomParts.Fragment_MainEnd:""),this.CustomParts.Fragment_Before_Fog&&(g.Q.ShadersStore[l+"PixelShader"]=g.Q.ShadersStore[l+"PixelShader"].replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.CustomParts.Fragment_Before_Fog)),this._isCreatedShader=!0,this._createdShaderName=l,l},t.prototype.AddUniform=function(e,t,n){return this._customUniform||(this._customUniform=new Array,this._newUniforms=new Array,this._newSamplerInstances={},this._newUniformInstances={}),n&&(-1!=t.indexOf("sampler")?this._newSamplerInstances[t+"-"+e]=n:this._newUniformInstances[t+"-"+e]=n),this._customUniform.push("uniform "+t+" "+e+";"),this._newUniforms.push(e),this},t.prototype.AddAttribute=function(e){return this._customAttributes||(this._customAttributes=[]),this._customAttributes.push(e),this},t.prototype.Fragment_Begin=function(e){return this.CustomParts.Fragment_Begin=e,this},t.prototype.Fragment_Definitions=function(e){return this.CustomParts.Fragment_Definitions=e,this},t.prototype.Fragment_MainBegin=function(e){return this.CustomParts.Fragment_MainBegin=e,this},t.prototype.Fragment_MainEnd=function(e){return this.CustomParts.Fragment_MainEnd=e,this},t.prototype.Fragment_Custom_Diffuse=function(e){return this.CustomParts.Fragment_Custom_Diffuse=e.replace("result","diffuseColor"),this},t.prototype.Fragment_Custom_Alpha=function(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this},t.prototype.Fragment_Before_Lights=function(e){return this.CustomParts.Fragment_Before_Lights=e,this},t.prototype.Fragment_Before_Fog=function(e){return this.CustomParts.Fragment_Before_Fog=e,this},t.prototype.Fragment_Before_FragColor=function(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this},t.prototype.Vertex_Begin=function(e){return this.CustomParts.Vertex_Begin=e,this},t.prototype.Vertex_Definitions=function(e){return this.CustomParts.Vertex_Definitions=e,this},t.prototype.Vertex_MainBegin=function(e){return this.CustomParts.Vertex_MainBegin=e,this},t.prototype.Vertex_Before_PositionUpdated=function(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this},t.prototype.Vertex_Before_NormalUpdated=function(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this},t.prototype.Vertex_After_WorldPosComputed=function(e){return this.CustomParts.Vertex_After_WorldPosComputed=e,this},t.prototype.Vertex_MainEnd=function(e){return this.CustomParts.Vertex_MainEnd=e,this},t.ShaderIndexer=1,t}(b.K);(0,d.H)("BABYLON.CustomMaterial",T);var x=n(47914),C=n(57710),S=function(){},P=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.CustomParts=new S,r.customShaderNameResolve=r.Builder,r.FragmentShader=g.Q.ShadersStore.pbrPixelShader,r.VertexShader=g.Q.ShadersStore.pbrVertexShader,r.FragmentShader=r.FragmentShader.replace(/#include<pbrBlockAlbedoOpacity>/g,g.Q.IncludesShadersStore.pbrBlockAlbedoOpacity),r.FragmentShader=r.FragmentShader.replace(/#include<pbrBlockReflectivity>/g,g.Q.IncludesShadersStore.pbrBlockReflectivity),r.FragmentShader=r.FragmentShader.replace(/#include<pbrBlockFinalColorComposition>/g,g.Q.IncludesShadersStore.pbrBlockFinalColorComposition),r}return(0,r.ZT)(t,e),t.prototype.AttachAfterBind=function(e,t){if(this._newUniformInstances)for(var n in this._newUniformInstances){"vec2"==(r=n.toString().split("-"))[0]?t.setVector2(r[1],this._newUniformInstances[n]):"vec3"==r[0]?t.setVector3(r[1],this._newUniformInstances[n]):"vec4"==r[0]?t.setVector4(r[1],this._newUniformInstances[n]):"mat4"==r[0]?t.setMatrix(r[1],this._newUniformInstances[n]):"float"==r[0]&&t.setFloat(r[1],this._newUniformInstances[n])}if(this._newSamplerInstances)for(var n in this._newSamplerInstances){var r;"sampler2D"==(r=n.toString().split("-"))[0]&&this._newSamplerInstances[n].isReady&&this._newSamplerInstances[n].isReady()&&t.setTexture(r[1],this._newSamplerInstances[n])}},t.prototype.ReviewUniform=function(e,t){if("uniform"==e&&this._newUniforms)for(var n=0;n<this._newUniforms.length;n++)-1==this._customUniform[n].indexOf("sampler")&&t.push(this._newUniforms[n]);if("sampler"==e&&this._newUniforms)for(n=0;n<this._newUniforms.length;n++)-1!=this._customUniform[n].indexOf("sampler")&&t.push(this._newUniforms[n]);return t},t.prototype.Builder=function(e,n,r,o,i,a,s){var l=this;if(s){var c=s.processFinalCode;s.processFinalCode=function(e,t){if("vertex"===e)return c?c(e,t):t;var n=new C.Z(t);return n.inlineToken="#define pbr_inline",n.processCode(),c?c(e,n.code):n.code}}if(a&&this._customAttributes&&this._customAttributes.length>0&&a.push.apply(a,this._customAttributes),this.ReviewUniform("uniform",n),this.ReviewUniform("sampler",o),this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1,t.ShaderIndexer++;var u="custom_"+t.ShaderIndexer,f=this._afterBind.bind(this);return this._afterBind=function(e,t){if(t){l.AttachAfterBind(e,t);try{f(e,t)}catch(t){}}},g.Q.ShadersStore[u+"VertexShader"]=this.VertexShader.replace("#define CUSTOM_VERTEX_BEGIN",this.CustomParts.Vertex_Begin?this.CustomParts.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Vertex_Definitions?this.CustomParts.Vertex_Definitions:"")).replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.CustomParts.Vertex_MainBegin?this.CustomParts.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.CustomParts.Vertex_Before_PositionUpdated?this.CustomParts.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.CustomParts.Vertex_Before_NormalUpdated?this.CustomParts.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.CustomParts.Vertex_MainEnd?this.CustomParts.Vertex_MainEnd:""),this.CustomParts.Vertex_After_WorldPosComputed&&(g.Q.ShadersStore[u+"VertexShader"]=g.Q.ShadersStore[u+"VertexShader"].replace("#define CUSTOM_VERTEX_UPDATE_WORLDPOS",this.CustomParts.Vertex_After_WorldPosComputed)),g.Q.ShadersStore[u+"PixelShader"]=this.FragmentShader.replace("#define CUSTOM_FRAGMENT_BEGIN",this.CustomParts.Fragment_Begin?this.CustomParts.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.CustomParts.Fragment_MainBegin?this.CustomParts.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Fragment_Definitions?this.CustomParts.Fragment_Definitions:"")).replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO",this.CustomParts.Fragment_Custom_Albedo?this.CustomParts.Fragment_Custom_Albedo:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.CustomParts.Fragment_Custom_Alpha?this.CustomParts.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.CustomParts.Fragment_Before_Lights?this.CustomParts.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS",this.CustomParts.Fragment_Custom_MetallicRoughness?this.CustomParts.Fragment_Custom_MetallicRoughness:"").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE",this.CustomParts.Fragment_Custom_MicroSurface?this.CustomParts.Fragment_Custom_MicroSurface:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION",this.CustomParts.Fragment_Before_FinalColorComposition?this.CustomParts.Fragment_Before_FinalColorComposition:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.CustomParts.Fragment_Before_FragColor?this.CustomParts.Fragment_Before_FragColor:"").replace("#define CUSTOM_FRAGMENT_MAIN_END",this.CustomParts.Fragment_MainEnd?this.CustomParts.Fragment_MainEnd:""),this.CustomParts.Fragment_Before_Fog&&(g.Q.ShadersStore[u+"PixelShader"]=g.Q.ShadersStore[u+"PixelShader"].replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.CustomParts.Fragment_Before_Fog)),this._isCreatedShader=!0,this._createdShaderName=u,u},t.prototype.AddUniform=function(e,t,n){return this._customUniform||(this._customUniform=new Array,this._newUniforms=new Array,this._newSamplerInstances={},this._newUniformInstances={}),n&&(-1!=t.indexOf("sampler")?this._newSamplerInstances[t+"-"+e]=n:this._newUniformInstances[t+"-"+e]=n),this._customUniform.push("uniform "+t+" "+e+";"),this._newUniforms.push(e),this},t.prototype.AddAttribute=function(e){return this._customAttributes||(this._customAttributes=[]),this._customAttributes.push(e),this},t.prototype.Fragment_Begin=function(e){return this.CustomParts.Fragment_Begin=e,this},t.prototype.Fragment_Definitions=function(e){return this.CustomParts.Fragment_Definitions=e,this},t.prototype.Fragment_MainBegin=function(e){return this.CustomParts.Fragment_MainBegin=e,this},t.prototype.Fragment_Custom_Albedo=function(e){return this.CustomParts.Fragment_Custom_Albedo=e.replace("result","surfaceAlbedo"),this},t.prototype.Fragment_Custom_Alpha=function(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this},t.prototype.Fragment_Before_Lights=function(e){return this.CustomParts.Fragment_Before_Lights=e,this},t.prototype.Fragment_Custom_MetallicRoughness=function(e){return this.CustomParts.Fragment_Custom_MetallicRoughness=e,this},t.prototype.Fragment_Custom_MicroSurface=function(e){return this.CustomParts.Fragment_Custom_MicroSurface=e,this},t.prototype.Fragment_Before_Fog=function(e){return this.CustomParts.Fragment_Before_Fog=e,this},t.prototype.Fragment_Before_FinalColorComposition=function(e){return this.CustomParts.Fragment_Before_FinalColorComposition=e,this},t.prototype.Fragment_Before_FragColor=function(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this},t.prototype.Fragment_MainEnd=function(e){return this.CustomParts.Fragment_MainEnd=e,this},t.prototype.Vertex_Begin=function(e){return this.CustomParts.Vertex_Begin=e,this},t.prototype.Vertex_Definitions=function(e){return this.CustomParts.Vertex_Definitions=e,this},t.prototype.Vertex_MainBegin=function(e){return this.CustomParts.Vertex_MainBegin=e,this},t.prototype.Vertex_Before_PositionUpdated=function(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this},t.prototype.Vertex_Before_NormalUpdated=function(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this},t.prototype.Vertex_After_WorldPosComputed=function(e){return this.CustomParts.Vertex_After_WorldPosComputed=e,this},t.prototype.Vertex_MainEnd=function(e){return this.CustomParts.Vertex_MainEnd=e,this},t.ShaderIndexer=1,t}(x.Y);(0,d.H)("BABYLON.PBRCustomMaterial",P);var O=n(20163),M=n(73803),L="precision highp float;uniform vec4 vEyePosition;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;uniform sampler2D diffuseSampler;uniform vec2 vDiffuseInfos;\n#endif\nuniform sampler2D distortionSampler;uniform sampler2D opacitySampler;\n#ifdef DIFFUSE\nvarying vec2 vDistortionCoords1;varying vec2 vDistortionCoords2;varying vec2 vDistortionCoords3;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\nvec4 bx2(vec4 x)\n{return vec4(2.0)*x-vec4(1.0);}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=vec4(1.,1.,1.,1.);float alpha=1.0;\n#ifdef DIFFUSE\nconst float distortionAmount0 =0.092;const float distortionAmount1 =0.092;const float distortionAmount2 =0.092;vec2 heightAttenuation=vec2(0.3,0.39);vec4 noise0=texture2D(distortionSampler,vDistortionCoords1);vec4 noise1=texture2D(distortionSampler,vDistortionCoords2);vec4 noise2=texture2D(distortionSampler,vDistortionCoords3);vec4 noiseSum=bx2(noise0)*distortionAmount0+bx2(noise1)*distortionAmount1+bx2(noise2)*distortionAmount2;vec4 perturbedBaseCoords=vec4(vDiffuseUV,0.0,1.0)+noiseSum*(vDiffuseUV.y*heightAttenuation.x+heightAttenuation.y);vec4 opacityColor=texture2D(opacitySampler,perturbedBaseCoords.xy);\n#ifdef ALPHATEST\nif (opacityColor.r<0.1)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor=texture2D(diffuseSampler,perturbedBaseCoords.xy)*2.0;baseColor*=opacityColor;baseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\nvec3 diffuseBase=vec3(1.0,1.0,1.0);\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\nvec4 color=vec4(baseColor.rgb,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}";h.v.ShadersStore.firePixelShader=L;var F="precision highp float;attribute vec3 position;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;uniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\nuniform float time;uniform float speed;\n#ifdef DIFFUSE\nvarying vec2 vDistortionCoords1;varying vec2 vDistortionCoords2;varying vec2 vDistortionCoords3;\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);\n#ifdef DIFFUSE\nvDiffuseUV=uv;vDiffuseUV.y-=0.2;\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#ifdef DIFFUSE\nvec3 layerSpeed=vec3(-0.2,-0.52,-0.1)*speed;vDistortionCoords1.x=uv.x;vDistortionCoords1.y=uv.y+layerSpeed.x*time/1000.0;vDistortionCoords2.x=uv.x;vDistortionCoords2.y=uv.y+layerSpeed.y*time/1000.0;vDistortionCoords3.x=uv.x;vDistortionCoords3.y=uv.y+layerSpeed.z*time/1000.0;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";h.v.ShadersStore.fireVertexShader=F;var N=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.UV1=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.BonesPerMesh=0,t.NUM_BONE_INFLUENCERS=0,t.INSTANCES=!1,t.INSTANCESCOLOR=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,r.ZT)(t,e),t}(a.H),w=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.diffuseColor=new i.Wo(1,1,1),r.speed=1,r._scaledDiffuse=new i.Wo,r._lastTime=0,r}return(0,r.ZT)(t,e),t.prototype.needAlphaBlending=function(){return!1},t.prototype.needAlphaTesting=function(){return!0},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new N);var r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;var i=o.getEngine();if(r._areTexturesDirty&&(r._needUVs=!1,this._diffuseTexture&&c.k.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;r._needUVs=!0,r.DIFFUSE=!0}if(r.ALPHATEST=!!this._opacityTexture,r._areMiscDirty&&(r.POINTSIZE=this.pointsCloud||o.forcePointsCloud,r.FOG=o.fogEnabled&&e.applyFog&&o.fogMode!==f.x.FOGMODE_NONE&&this.fogEnabled),s.G.PrepareDefinesForFrameBoundValues(o,i,r,!!n),s.G.PrepareDefinesForAttributes(e,r,!1,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();var a=new m.L;r.FOG&&a.addFallback(1,"FOG"),r.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];r.UV1&&l.push(u.o.UVKind),r.VERTEXCOLOR&&l.push(u.o.ColorKind),s.G.PrepareAttributesForBones(l,e,r,a),s.G.PrepareAttributesForInstances(l,r);var d=r.toString();t.setEffect(o.getEngine().createEffect("fire",{attributes:l,uniformsNames:["world","view","viewProjection","vEyePosition","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","time","speed"],uniformBuffersNames:[],samplers:["diffuseSampler","distortionSampler","opacitySampler"],defines:d,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:null,maxSimultaneousLights:4,transformFeedbackVaryings:null},i),r,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(r._renderId=o.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene();if(n.materialDefines){var o=n.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),s.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(r,o)&&(this._diffuseTexture&&c.k.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix()),this._activeEffect.setTexture("distortionSampler",this._distortionTexture),this._activeEffect.setTexture("opacitySampler",this._opacityTexture)),s.G.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),r.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*t.visibility),r.fogEnabled&&t.applyFog&&r.fogMode!==f.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),s.G.BindFogParameters(r,t,this._activeEffect),this._lastTime+=r.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime),this._activeEffect.setFloat("speed",this.speed),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._distortionTexture&&this._distortionTexture.animations&&this._distortionTexture.animations.length>0&&e.push(this._distortionTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),this._distortionTexture&&t.push(this._distortionTexture),this._opacityTexture&&t.push(this._opacityTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this._diffuseTexture===t||(this._distortionTexture===t||this._opacityTexture===t))},t.prototype.getClassName=function(){return"FireMaterial"},t.prototype.dispose=function(t){this._diffuseTexture&&this._diffuseTexture.dispose(),this._distortionTexture&&this._distortionTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return o.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.FireMaterial",t.diffuseColor=this.diffuseColor.asArray(),t.speed=this.speed,this._diffuseTexture&&(t._diffuseTexture=this._diffuseTexture.serialize()),this._distortionTexture&&(t._distortionTexture=this._distortionTexture.serialize()),this._opacityTexture&&(t._opacityTexture=this._opacityTexture.serialize()),t},t.Parse=function(e,n,r){var o=new t(e.name,n);return o.diffuseColor=i.Wo.FromArray(e.diffuseColor),o.speed=e.speed,o.alpha=e.alpha,o.id=e.id,O.$.AddTagsTo(o,e.tags),o.backFaceCulling=e.backFaceCulling,o.wireframe=e.wireframe,e._diffuseTexture&&(o._diffuseTexture=M.x.Parse(e._diffuseTexture,n,r)),e._distortionTexture&&(o._distortionTexture=M.x.Parse(e._distortionTexture,n,r)),e._opacityTexture&&(o._opacityTexture=M.x.Parse(e._opacityTexture,n,r)),o},(0,r.gn)([(0,o.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,r.gn)([(0,o.oU)("distortionTexture")],t.prototype,"_distortionTexture",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"distortionTexture",void 0),(0,r.gn)([(0,o.oU)("opacityTexture")],t.prototype,"_opacityTexture",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityTexture",void 0),(0,r.gn)([(0,o.n9)("diffuse")],t.prototype,"diffuseColor",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"speed",void 0),t}(l.a);(0,d.H)("BABYLON.FireMaterial",w);var I=n(58095),R=n(93980),D="precision highp float;uniform vec4 vEyePosition;uniform vec4 vDiffuseColor;uniform vec4 furColor;uniform float furLength;varying vec3 vPositionW;varying float vfur_length;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;uniform sampler2D diffuseSampler;uniform vec2 vDiffuseInfos;\n#endif\n#ifdef HIGHLEVEL\nuniform float furOffset;uniform float furOcclusion;uniform sampler2D furTexture;varying vec2 vFurUV;\n#endif\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<fogFragmentDeclaration>\n#include<clipPlaneFragmentDeclaration>\nfloat Rand(vec3 rv) {float x=dot(rv,vec3(12.9898,78.233,24.65487));return fract(sin(x)*43758.5453);}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);vec4 baseColor=furColor;vec3 diffuseColor=vDiffuseColor.rgb;float alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor*=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef HIGHLEVEL\nvec4 furTextureColor=texture2D(furTexture,vec2(vFurUV.x,vFurUV.y));if (furTextureColor.a<=0.0 || furTextureColor.g<furOffset) {discard;}\nfloat occlusion=mix(0.0,furTextureColor.b*1.2,furOffset);baseColor=vec4(baseColor.xyz*max(occlusion,furOcclusion),1.1-furOffset);\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase.rgb*baseColor.rgb,0.0,1.0);\n#ifdef HIGHLEVEL\nvec4 color=vec4(finalDiffuse,alpha);\n#else\nfloat r=vfur_length/furLength*0.5;vec4 color=vec4(finalDiffuse*(0.5+r),alpha);\n#endif\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}";h.v.ShadersStore.furPixelShader=D;var B="precision highp float;attribute vec3 position;attribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\nuniform float furLength;uniform float furAngle;\n#ifdef HIGHLEVEL\nuniform float furOffset;uniform vec3 furGravity;uniform float furTime;uniform float furSpacing;uniform float furDensity;\n#endif\n#ifdef HEIGHTMAP\nuniform sampler2D heightTexture;\n#endif\n#ifdef HIGHLEVEL\nvarying vec2 vFurUV;\n#endif\n#include<instancesDeclaration>\nuniform mat4 view;uniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;uniform mat4 diffuseMatrix;uniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\nvarying float vfur_length;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nfloat Rand(vec3 rv) {float x=dot(rv,vec3(12.9898,78.233,24.65487));return fract(sin(x)*43758.5453);}\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nfloat r=Rand(position);\n#ifdef HEIGHTMAP\n#if __VERSION__>100\nvfur_length=furLength*texture(heightTexture,uv).x;\n#else\nvfur_length=furLength*texture2D(heightTexture,uv).r;\n#endif\n#else \nvfur_length=(furLength*r);\n#endif\nvec3 tangent1=vec3(normal.y,-normal.x,0);vec3 tangent2=vec3(-normal.z,0,normal.x);r=Rand(tangent1*r);float J=(2.0+4.0*r);r=Rand(tangent2*r);float K=(2.0+2.0*r);tangent1=tangent1*J+tangent2*K;tangent1=normalize(tangent1);vec3 newPosition=position+normal*vfur_length*cos(furAngle)+tangent1*vfur_length*sin(furAngle);\n#ifdef HIGHLEVEL\nvec3 forceDirection=vec3(0.0,0.0,0.0);forceDirection.x=sin(furTime+position.x*0.05)*0.2;forceDirection.y=cos(furTime*0.7+position.y*0.04)*0.2;forceDirection.z=sin(furTime*0.7+position.z*0.04)*0.2;vec3 displacement=vec3(0.0,0.0,0.0);displacement=furGravity+forceDirection;float displacementFactor=pow(furOffset,3.0);vec3 aNormal=normal;aNormal.xyz+=displacement*displacementFactor;newPosition=vec3(newPosition.x,newPosition.y,newPosition.z)+(normalize(aNormal)*furOffset*furSpacing);\n#endif\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\ngl_Position=viewProjection*finalWorld*vec4(newPosition,1.0);vec4 worldPos=finalWorld*vec4(newPosition,1.0);vPositionW=vec3(worldPos);\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x==0.)\n{vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));}\nelse\n{vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));}\n#ifdef HIGHLEVEL\nvFurUV=vDiffuseUV*furDensity;\n#endif\n#else\n#ifdef HIGHLEVEL\nvFurUV=uv*furDensity;\n#endif\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";h.v.ShadersStore.furVertexShader=B;var V=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.HEIGHTMAP=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.INSTANCESCOLOR=!1,t.HIGHLEVEL=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,r.ZT)(t,e),t}(a.H),U=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.diffuseColor=new i.Wo(1,1,1),r.furLength=1,r.furAngle=0,r.furColor=new i.Wo(.44,.21,.02),r.furOffset=0,r.furSpacing=12,r.furGravity=new I.P(0,0,0),r.furSpeed=100,r.furDensity=20,r.furOcclusion=0,r._disableLighting=!1,r._maxSimultaneousLights=4,r.highLevelFur=!0,r._furTime=0,r}return(0,r.ZT)(t,e),Object.defineProperty(t.prototype,"furTime",{get:function(){return this._furTime},set:function(e){this._furTime=e},enumerable:!1,configurable:!0}),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.updateFur=function(){for(var e=1;e<this._meshes.length;e++){var t=this._meshes[e].material;t.furLength=this.furLength,t.furAngle=this.furAngle,t.furGravity=this.furGravity,t.furSpacing=this.furSpacing,t.furSpeed=this.furSpeed,t.furColor=this.furColor,t.diffuseTexture=this.diffuseTexture,t.furTexture=this.furTexture,t.highLevelFur=this.highLevelFur,t.furTime=this.furTime,t.furDensity=this.furDensity}},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new V);var r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;var i=o.getEngine();if(r._areTexturesDirty&&o.texturesEnabled){if(this.diffuseTexture&&c.k.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;r._needUVs=!0,r.DIFFUSE=!0}if(this.heightTexture&&i.getCaps().maxVertexTextureImageUnits){if(!this.heightTexture.isReady())return!1;r._needUVs=!0,r.HEIGHTMAP=!0}}if(this.highLevelFur!==r.HIGHLEVEL&&(r.HIGHLEVEL=!0,r.markAsUnprocessed()),s.G.PrepareDefinesForMisc(e,o,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),r),r._needNormals=s.G.PrepareDefinesForLights(o,e,r,!1,this._maxSimultaneousLights,this._disableLighting),s.G.PrepareDefinesForFrameBoundValues(o,i,r,!!n),s.G.PrepareDefinesForAttributes(e,r,!0,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();var a=new m.L;r.FOG&&a.addFallback(1,"FOG"),s.G.HandleFallbacksForShadows(r,a,this.maxSimultaneousLights),r.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];r.NORMAL&&l.push(u.o.NormalKind),r.UV1&&l.push(u.o.UVKind),r.UV2&&l.push(u.o.UV2Kind),r.VERTEXCOLOR&&l.push(u.o.ColorKind),s.G.PrepareAttributesForBones(l,e,r,a),s.G.PrepareAttributesForInstances(l,r);var f=r.toString(),d=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","furLength","furAngle","furColor","furOffset","furGravity","furTime","furSpacing","furDensity","furOcclusion"],h=["diffuseSampler","heightTexture","furTexture"],p=new Array;s.G.PrepareUniformsAndSamplersList({uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:r,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(o.getEngine().createEffect("fur",{attributes:l,uniformsNames:d,uniformBuffersNames:p,samplers:h,defines:f,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},i),r,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(r._renderId=o.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n.materialDefines;if(o){var i=n.effect;i&&(this._activeEffect=i,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),s.G.BindBonesParameters(t,this._activeEffect),r.getCachedMaterial()!==this&&(this._diffuseTexture&&c.k.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),this._heightTexture&&this._activeEffect.setTexture("heightTexture",this._heightTexture),s.G.BindClipPlane(this._activeEffect,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),r.bindEyePosition(i)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.lightsEnabled&&!this.disableLighting&&s.G.BindLights(r,t,this._activeEffect,o,this.maxSimultaneousLights),r.fogEnabled&&t.applyFog&&r.fogMode!==f.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),s.G.BindFogParameters(r,t,this._activeEffect),this._activeEffect.setFloat("furLength",this.furLength),this._activeEffect.setFloat("furAngle",this.furAngle),this._activeEffect.setColor4("furColor",this.furColor,1),this.highLevelFur&&(this._activeEffect.setVector3("furGravity",this.furGravity),this._activeEffect.setFloat("furOffset",this.furOffset),this._activeEffect.setFloat("furSpacing",this.furSpacing),this._activeEffect.setFloat("furDensity",this.furDensity),this._activeEffect.setFloat("furOcclusion",this.furOcclusion),this._furTime+=this.getScene().getEngine().getDeltaTime()/this.furSpeed,this._activeEffect.setFloat("furTime",this._furTime),this._activeEffect.setTexture("furTexture",this.furTexture)),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.heightTexture&&this.heightTexture.animations&&this.heightTexture.animations.length>0&&e.push(this.heightTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),this._heightTexture&&t.push(this._heightTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this.diffuseTexture===t||this._heightTexture===t)},t.prototype.dispose=function(t){if(this.diffuseTexture&&this.diffuseTexture.dispose(),this._meshes)for(var n=1;n<this._meshes.length;n++){var r=this._meshes[n].material;r&&r.dispose(t),this._meshes[n].dispose()}e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return o.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.FurMaterial",this._meshes&&(t.sourceMeshName=this._meshes[0].name,t.quality=this._meshes.length),t},t.prototype.getClassName=function(){return"FurMaterial"},t.Parse=function(e,n,r){var i=o.p4.Parse((function(){return new t(e.name,n)}),e,n,r);return e.sourceMeshName&&i.highLevelFur&&n.executeWhenReady((function(){var r=n.getMeshByName(e.sourceMeshName);if(r){var o=t.GenerateTexture("Fur Texture",n);i.furTexture=o,t.FurifyMesh(r,e.quality)}})),i},t.GenerateTexture=function(e,t){for(var n=new R.c("FurTexture "+e,256,t,!0),r=n.getContext(),o=0;o<2e4;++o)r.fillStyle="rgba(255, "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", 1)",r.fillRect(Math.random()*n.getSize().width,Math.random()*n.getSize().height,2,2);return n.update(!1),n.wrapU=M.x.WRAP_ADDRESSMODE,n.wrapV=M.x.WRAP_ADDRESSMODE,n},t.FurifyMesh=function(e,n){var r,o=[e],i=e.material;if(!(i instanceof t))throw"The material of the source mesh must be a Fur Material";for(r=1;r<n;r++){var a=new t(i.name+r,e.getScene());e.getScene().materials.pop(),O.$.EnableFor(a),O.$.AddTagsTo(a,"furShellMaterial"),a.furLength=i.furLength,a.furAngle=i.furAngle,a.furGravity=i.furGravity,a.furSpacing=i.furSpacing,a.furSpeed=i.furSpeed,a.furColor=i.furColor,a.diffuseTexture=i.diffuseTexture,a.furOffset=r/n,a.furTexture=i.furTexture,a.highLevelFur=i.highLevelFur,a.furTime=i.furTime,a.furDensity=i.furDensity;var s=e.clone(e.name+r);s.material=a,s.skeleton=e.skeleton,s.position=I.P.Zero(),o.push(s)}for(r=1;r<o.length;r++)o[r].parent=e;return e.material._meshes=o,o},(0,r.gn)([(0,o.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,r.gn)([(0,o.oU)("heightTexture")],t.prototype,"_heightTexture",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"heightTexture",void 0),(0,r.gn)([(0,o.n9)()],t.prototype,"diffuseColor",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"furLength",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"furAngle",void 0),(0,r.gn)([(0,o.n9)()],t.prototype,"furColor",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"furOffset",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"furSpacing",void 0),(0,r.gn)([(0,o.hd)()],t.prototype,"furGravity",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"furSpeed",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"furDensity",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"furOcclusion",void 0),(0,r.gn)([(0,o.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,r.gn)([(0,o.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"highLevelFur",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"furTime",null),t}(l.a);(0,d.H)("BABYLON.FurMaterial",U);var G="precision highp float;\nuniform vec4 vEyePosition;\nuniform vec4 topColor;\nuniform vec4 bottomColor;\nuniform float offset;\nuniform float scale;\nuniform float smoothness;\nvarying vec3 vPositionW;\nvarying vec3 vPosition;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<helperFunctions>\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nfloat h=vPosition.y*scale+offset;\nfloat mysmoothness=clamp(smoothness,0.01,max(smoothness,10.));\nvec4 baseColor=mix(bottomColor,topColor,max(pow(max(h,0.0),mysmoothness),0.0));\nvec3 diffuseColor=baseColor.rgb;\nfloat alpha=baseColor.a;\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef EMISSIVE\nvec3 diffuseBase=baseColor.rgb;\n#else\nvec3 diffuseBase=vec3(0.,0.,0.);\n#endif\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0..maxSimultaneousLights]\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR)\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";h.v.ShadersStore.gradientPixelShader=G;var k="precision highp float;\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\nvarying vec3 vPosition;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\nvPosition=position;\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";h.v.ShadersStore.gradientVertexShader=k;var W=function(e){function t(){var t=e.call(this)||this;return t.EMISSIVE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.INSTANCESCOLOR=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,r.ZT)(t,e),t}(a.H),H=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._maxSimultaneousLights=4,r.topColor=new i.Wo(1,0,0),r.topColorAlpha=1,r.bottomColor=new i.Wo(0,0,1),r.bottomColorAlpha=1,r.offset=0,r.scale=1,r.smoothness=1,r._disableLighting=!1,r}return(0,r.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1||this.topColorAlpha<1||this.bottomColorAlpha<1},t.prototype.needAlphaTesting=function(){return!0},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new W);var r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;var i=o.getEngine();if(s.G.PrepareDefinesForFrameBoundValues(o,i,r,!!n),s.G.PrepareDefinesForMisc(e,o,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),r),r._needNormals=s.G.PrepareDefinesForLights(o,e,r,!1,this._maxSimultaneousLights,this._disableLighting),r.EMISSIVE=this._disableLighting,s.G.PrepareDefinesForAttributes(e,r,!1,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();var a=new m.L;r.FOG&&a.addFallback(1,"FOG"),s.G.HandleFallbacksForShadows(r,a),r.NUM_BONE_INFLUENCERS>0&&a.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];r.NORMAL&&l.push(u.o.NormalKind),r.UV1&&l.push(u.o.UVKind),r.UV2&&l.push(u.o.UV2Kind),r.VERTEXCOLOR&&l.push(u.o.ColorKind),s.G.PrepareAttributesForBones(l,e,r,a),s.G.PrepareAttributesForInstances(l,r);var c=r.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","topColor","bottomColor","offset","smoothness","scale"],d=[],h=new Array;s.G.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:h,samplers:d,defines:r,maxSimultaneousLights:4}),t.setEffect(o.getEngine().createEffect("gradient",{attributes:l,uniformsNames:f,uniformBuffersNames:h,samplers:d,defines:c,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},i),r,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(r._renderId=o.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n.materialDefines;if(o){var i=n.effect;i&&(this._activeEffect=i,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),s.G.BindBonesParameters(t,i),this._mustRebind(r,i)&&(s.G.BindClipPlane(i,r),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),r.bindEyePosition(i)),r.lightsEnabled&&!this.disableLighting&&s.G.BindLights(r,t,this._activeEffect,o,this.maxSimultaneousLights),r.fogEnabled&&t.applyFog&&r.fogMode!==f.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",r.getViewMatrix()),s.G.BindFogParameters(r,t,this._activeEffect),this._activeEffect.setColor4("topColor",this.topColor,this.topColorAlpha),this._activeEffect.setColor4("bottomColor",this.bottomColor,this.bottomColorAlpha),this._activeEffect.setFloat("offset",this.offset),this._activeEffect.setFloat("scale",this.scale),this._activeEffect.setFloat("smoothness",this.smoothness),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){return[]},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return o.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.GradientMaterial",t},t.prototype.getClassName=function(){return"GradientMaterial"},t.Parse=function(e,n,r){return o.p4.Parse((function(){return new t(e.name,n)}),e,n,r)},(0,r.gn)([(0,o.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),(0,r.gn)([(0,o.n9)()],t.prototype,"topColor",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"topColorAlpha",void 0),(0,r.gn)([(0,o.n9)()],t.prototype,"bottomColor",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"bottomColorAlpha",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"offset",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"scale",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"smoothness",void 0),(0,r.gn)([(0,o.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),t}(l.a);(0,d.H)("BABYLON.GradientMaterial",H);var j="#extension GL_OES_standard_derivatives : enable\n#define SQRT2 1.41421356\n#define PI 3.14159\nprecision highp float;\nuniform float visibility;\nuniform vec3 mainColor;\nuniform vec3 lineColor;\nuniform vec4 gridControl;\nuniform vec3 gridOffset;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogFragmentDeclaration>\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\nfloat getDynamicVisibility(float position) {\nfloat majorGridFrequency=gridControl.y;\nif (floor(position+0.5)==floor(position/majorGridFrequency+0.5)*majorGridFrequency)\n{\nreturn 1.0;\n} \nreturn gridControl.z;\n}\nfloat getAnisotropicAttenuation(float differentialLength) {\nconst float maxNumberOfLines=10.0;\nreturn clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);\n}\nfloat isPointOnLine(float position,float differentialLength) {\nfloat fractionPartOfPosition=position-floor(position+0.5); \nfractionPartOfPosition/=differentialLength; \nfractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);\nfloat result=0.5+0.5*cos(fractionPartOfPosition*PI); \nreturn result; \n}\nfloat contributionOnAxis(float position) {\nfloat differentialLength=length(vec2(dFdx(position),dFdy(position)));\ndifferentialLength*=SQRT2; \nfloat result=isPointOnLine(position,differentialLength);\nfloat dynamicVisibility=getDynamicVisibility(position);\nresult*=dynamicVisibility;\nfloat anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);\nresult*=anisotropicAttenuation;\nreturn result;\n}\nfloat normalImpactOnAxis(float x) {\nfloat normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);\nreturn normalImpact;\n}\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\nfloat gridRatio=gridControl.x;\nvec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;\nfloat x=contributionOnAxis(gridPos.x);\nfloat y=contributionOnAxis(gridPos.y);\nfloat z=contributionOnAxis(gridPos.z);\nvec3 normal=normalize(vNormal);\nx*=normalImpactOnAxis(normal.x);\ny*=normalImpactOnAxis(normal.y);\nz*=normalImpactOnAxis(normal.z);\n#ifdef MAX_LINE \nfloat grid=clamp(max(max(x,y),z),0.,1.);\n#else\nfloat grid=clamp(x+y+z,0.,1.);\n#endif\nvec3 color=mix(mainColor,lineColor,grid);\n#ifdef FOG\n#include<fogFragment>\n#endif\nfloat opacity=1.0;\n#ifdef TRANSPARENT\nopacity=clamp(grid,0.08,gridControl.w*grid);\n#endif \n#ifdef OPACITY\nopacity*=texture2D(opacitySampler,vOpacityUV).a;\n#endif \ngl_FragColor=vec4(color.rgb,opacity*visibility);\n#ifdef TRANSPARENT\n#ifdef PREMULTIPLYALPHA\ngl_FragColor.rgb*=opacity;\n#endif\n#else \n#endif\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";h.v.ShadersStore.gridPixelShader=j;var K="precision highp float;\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#include<instancesDeclaration>\nuniform mat4 projection;\nuniform mat4 view;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogVertexDeclaration>\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#include<fogVertex>\nvec4 cameraSpacePosition=view*worldPos;\ngl_Position=projection*cameraSpacePosition;\n#ifdef OPACITY\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\nif (vOpacityInfos.x==0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif \nvPosition=position;\nvNormal=normal;\n#define CUSTOM_VERTEX_MAIN_END\n}";h.v.ShadersStore.gridVertexShader=K;var z=function(e){function t(){var t=e.call(this)||this;return t.OPACITY=!1,t.TRANSPARENT=!1,t.FOG=!1,t.PREMULTIPLYALPHA=!1,t.MAX_LINE=!1,t.UV1=!1,t.UV2=!1,t.INSTANCES=!1,t.THIN_INSTANCES=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}return(0,r.ZT)(t,e),t}(a.H),X=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.mainColor=i.Wo.Black(),r.lineColor=i.Wo.Teal(),r.gridRatio=1,r.gridOffset=I.P.Zero(),r.majorUnitFrequency=10,r.minorUnitVisibility=.33,r.opacity=1,r.preMultiplyAlpha=!1,r.useMaxLine=!1,r._gridControl=new I.Lt(r.gridRatio,r.majorUnitFrequency,r.minorUnitVisibility,r.opacity),r}return(0,r.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.opacity<1||this._opacityTexture&&this._opacityTexture.isReady()},t.prototype.needAlphaBlendingForMesh=function(e){return e.visibility<1||this.needAlphaBlending()},t.prototype.isReadyForSubMesh=function(e,t,n){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new z);var r=t.materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;if(r.TRANSPARENT!==this.opacity<1&&(r.TRANSPARENT=!r.TRANSPARENT,r.markAsUnprocessed()),r.PREMULTIPLYALPHA!=this.preMultiplyAlpha&&(r.PREMULTIPLYALPHA=!r.PREMULTIPLYALPHA,r.markAsUnprocessed()),r.MAX_LINE!==this.useMaxLine&&(r.MAX_LINE=!r.MAX_LINE,r.markAsUnprocessed()),r._areTexturesDirty&&(r._needUVs=!1,o.texturesEnabled&&this._opacityTexture&&c.k.OpacityTextureEnabled)){if(!this._opacityTexture.isReady())return!1;r._needUVs=!0,r.OPACITY=!0}if(s.G.PrepareDefinesForMisc(e,o,!1,!1,this.fogEnabled,!1,r),s.G.PrepareDefinesForFrameBoundValues(o,o.getEngine(),r,!!n),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial(),s.G.PrepareDefinesForAttributes(e,r,!1,!1);var i=[u.o.PositionKind,u.o.NormalKind];r.UV1&&i.push(u.o.UVKind),r.UV2&&i.push(u.o.UV2Kind),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess,s.G.PrepareAttributesForInstances(i,r);var a=r.toString();t.setEffect(o.getEngine().createEffect("grid",i,["projection","mainColor","lineColor","gridControl","gridOffset","vFogInfos","vFogColor","world","view","opacityMatrix","vOpacityInfos","visibility"],["opacitySampler"],a,void 0,this.onCompiled,this.onError),r,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(r._renderId=o.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),o=n.materialDefines;if(o){var i=n.effect;i&&(this._activeEffect=i,this._activeEffect.setFloat("visibility",t.visibility),o.INSTANCES&&!o.THIN_INSTANCE||this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("view",r.getViewMatrix()),this._activeEffect.setMatrix("projection",r.getProjectionMatrix()),this._mustRebind(r,i)&&(this._activeEffect.setColor3("mainColor",this.mainColor),this._activeEffect.setColor3("lineColor",this.lineColor),this._activeEffect.setVector3("gridOffset",this.gridOffset),this._gridControl.x=this.gridRatio,this._gridControl.y=Math.round(this.majorUnitFrequency),this._gridControl.z=this.minorUnitVisibility,this._gridControl.w=this.opacity,this._activeEffect.setVector4("gridControl",this._gridControl),this._opacityTexture&&c.k.OpacityTextureEnabled&&(this._activeEffect.setTexture("opacitySampler",this._opacityTexture),this._activeEffect.setFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),this._activeEffect.setMatrix("opacityMatrix",this._opacityTexture.getTextureMatrix()))),s.G.BindFogParameters(r,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return o.p4.Clone((function(){return new t(e,n.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.GridMaterial",t},t.prototype.getClassName=function(){return"GridMaterial"},t.Parse=function(e,n,r){return o.p4.Parse((function(){return new t(e.name,n)}),e,n,r)},(0,r.gn)([(0,o.n9)()],t.prototype,"mainColor",void 0),(0,r.gn)([(0,o.n9)()],t.prototype,"lineColor",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"gridRatio",void 0),(0,r.gn)([(0,o.hd)()],t.prototype,"gridOffset",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"majorUnitFrequency",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"minorUnitVisibility",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"opacity",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"preMultiplyAlpha",void 0),(0,r.gn)([(0,o.qC)()],t.prototype,"useMaxLine",void 0),(0,r.gn)([(0,o.oU)("opacityTexture")],t.prototype,"_opacityTexture",void 0),(0,r.gn)([(0,o.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityTexture",void 0),t}(l.a);(0,d.H)("BABYLON.GridMaterial",X);var q=n(25175),Y=n(91484),Z=n(10963),Q=n(994),J=n(40345),$=n(70272),ee=n(9673),te=n(97706),ne=n(83610)}}]);