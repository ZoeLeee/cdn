"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8274],{48017:(t,e,i)=>{i.d(e,{N:()=>h});var o=i(31191),n=i(58095),r=i(48939),s=i(17834),a=i(43048),h=function(t){function e(e,i,o,r,s,a,h){void 0===o&&(o=null),void 0===r&&(r=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===h&&(h=null);var c=t.call(this,e,i.getScene())||this;return c.name=e,c.children=new Array,c.animations=new Array,c._index=null,c._absoluteTransform=new n.y3,c._invertedAbsoluteTransform=new n.y3,c._scalingDeterminant=1,c._worldTransform=new n.y3,c._needToDecompose=!0,c._needToCompose=!1,c._linkedTransformNode=null,c._waitingTransformNodeId=null,c._skeleton=i,c._localMatrix=r?r.clone():n.y3.Identity(),c._restPose=s||c._localMatrix.clone(),c._baseMatrix=a||c._localMatrix.clone(),c._index=h,i.bones.push(c),c.setParent(o,!1),(a||r)&&c._updateDifferenceMatrix(),c}return(0,o.ZT)(e,t),Object.defineProperty(e.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(t){this._needToCompose=!1,t.updateFlag!==this._localMatrix.updateFlag&&(this._localMatrix.copyFrom(t),this._markAsDirtyAndDecompose())},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"Bone"},e.prototype.getSkeleton=function(){return this._skeleton},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parentNode},set:function(t){this.setParent(t)},enumerable:!1,configurable:!0}),e.prototype.getParent=function(){return this.parent},e.prototype.getChildren=function(){return this.children},e.prototype.getIndex=function(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index},e.prototype.setParent=function(t,e){if(void 0===e&&(e=!0),this.parent!==t){if(this.parent){var i=this.parent.children.indexOf(this);-1!==i&&this.parent.children.splice(i,1)}this._parentNode=t,this.parent&&this.parent.children.push(this),e&&this._updateDifferenceMatrix(),this.markAsDirty()}},e.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},e.prototype.getBaseMatrix=function(){return this._baseMatrix},e.prototype.getRestPose=function(){return this._restPose},e.prototype.setRestPose=function(t){this._restPose.copyFrom(t)},e.prototype.getBindPose=function(){return this._baseMatrix},e.prototype.setBindPose=function(t){this.updateMatrix(t)},e.prototype.getWorldMatrix=function(){return this._worldTransform},e.prototype.returnToRest=function(){var t;if(this._linkedTransformNode){var e=n.jp.Vector3[0],i=n.jp.Quaternion[0],o=n.jp.Vector3[1];this.getRestPose().decompose(e,i,o),this._linkedTransformNode.position.copyFrom(o),this._linkedTransformNode.rotationQuaternion=null!==(t=this._linkedTransformNode.rotationQuaternion)&&void 0!==t?t:n._f.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(i),this._linkedTransformNode.scaling.copyFrom(e)}else this._matrix=this._restPose},e.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},e.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},e.prototype.linkTransformNode=function(t){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=t,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},e.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(e.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(t){this._decompose(),this._localPosition.copyFrom(t),this._markAsDirtyAndCompose()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.getRotation()},set:function(t){this.setRotation(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(t){this.setRotationQuaternion(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaling",{get:function(){return this.getScale()},set:function(t){this.setScale(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!1,configurable:!0}),e.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=n.P.Zero(),this._localRotation=n._f.Zero(),this._localPosition=n.P.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},e.prototype._compose=function(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,n.y3.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)},e.prototype.updateMatrix=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),this._baseMatrix.copyFrom(t),e&&this._updateDifferenceMatrix(),i?this._matrix=t:this.markAsDirty()},e.prototype._updateDifferenceMatrix=function(t,e){if(void 0===e&&(e=!0),t||(t=this._baseMatrix),this.parent?t.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(t),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),e)for(var i=0;i<this.children.length;i++)this.children[i]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},e.prototype.markAsDirty=function(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this},e.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},e.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},e.prototype.translate=function(t,i,o){void 0===i&&(i=a.T.LOCAL);var r=this.getLocalMatrix();if(i==a.T.LOCAL)r.addAtIndex(12,t.x),r.addAtIndex(13,t.y),r.addAtIndex(14,t.z);else{var s=null;o&&(s=o.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var h=e._TmpMats[0],c=e._TmpVecs[0];this.parent?o&&s?(h.copyFrom(this.parent.getAbsoluteTransform()),h.multiplyToRef(s,h)):h.copyFrom(this.parent.getAbsoluteTransform()):n.y3.IdentityToRef(h),h.setTranslationFromFloats(0,0,0),h.invert(),n.P.TransformCoordinatesToRef(t,h,c),r.addAtIndex(12,c.x),r.addAtIndex(13,c.y),r.addAtIndex(14,c.z)}this._markAsDirtyAndDecompose()},e.prototype.setPosition=function(t,i,o){void 0===i&&(i=a.T.LOCAL);var r=this.getLocalMatrix();if(i==a.T.LOCAL)r.setTranslationFromFloats(t.x,t.y,t.z);else{var s=null;o&&(s=o.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var h=e._TmpMats[0],c=e._TmpVecs[0];this.parent?(o&&s?(h.copyFrom(this.parent.getAbsoluteTransform()),h.multiplyToRef(s,h)):h.copyFrom(this.parent.getAbsoluteTransform()),h.invert()):n.y3.IdentityToRef(h),n.P.TransformCoordinatesToRef(t,h,c),r.setTranslationFromFloats(c.x,c.y,c.z)}this._markAsDirtyAndDecompose()},e.prototype.setAbsolutePosition=function(t,e){this.setPosition(t,a.T.WORLD,e)},e.prototype.scale=function(t,i,o,r){void 0===r&&(r=!1);var s=this.getLocalMatrix(),a=e._TmpMats[0];n.y3.ScalingToRef(t,i,o,a),a.multiplyToRef(s,s),a.invert();for(var h=0,c=this.children;h<c.length;h++){var l=(d=c[h]).getLocalMatrix();l.multiplyToRef(a,l),l.multiplyAtIndex(12,t),l.multiplyAtIndex(13,i),l.multiplyAtIndex(14,o),d._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),r)for(var u=0,p=this.children;u<p.length;u++){var d;(d=p[u]).scale(t,i,o,r)}},e.prototype.setScale=function(t){this._decompose(),this._localScaling.copyFrom(t),this._markAsDirtyAndCompose()},e.prototype.getScale=function(){return this._decompose(),this._localScaling},e.prototype.getScaleToRef=function(t){this._decompose(),t.copyFrom(this._localScaling)},e.prototype.setYawPitchRoll=function(t,i,o,r,s){if(void 0===r&&(r=a.T.LOCAL),r===a.T.LOCAL){var h=e._TmpQuat;return n._f.RotationYawPitchRollToRef(t,i,o,h),void this.setRotationQuaternion(h,r,s)}var c=e._TmpMats[0];if(this._getNegativeRotationToRef(c,s)){var l=e._TmpMats[1];n.y3.RotationYawPitchRollToRef(t,i,o,l),c.multiplyToRef(l,l),this._rotateWithMatrix(l,r,s)}},e.prototype.rotate=function(t,i,o,r){void 0===o&&(o=a.T.LOCAL);var s=e._TmpMats[0];s.setTranslationFromFloats(0,0,0),n.y3.RotationAxisToRef(t,i,s),this._rotateWithMatrix(s,o,r)},e.prototype.setAxisAngle=function(t,i,o,r){if(void 0===o&&(o=a.T.LOCAL),o===a.T.LOCAL){var s=e._TmpQuat;return n._f.RotationAxisToRef(t,i,s),void this.setRotationQuaternion(s,o,r)}var h=e._TmpMats[0];if(this._getNegativeRotationToRef(h,r)){var c=e._TmpMats[1];n.y3.RotationAxisToRef(t,i,c),h.multiplyToRef(c,c),this._rotateWithMatrix(c,o,r)}},e.prototype.setRotation=function(t,e,i){void 0===e&&(e=a.T.LOCAL),this.setYawPitchRoll(t.y,t.x,t.z,e,i)},e.prototype.setRotationQuaternion=function(t,i,o){if(void 0===i&&(i=a.T.LOCAL),i===a.T.LOCAL)return this._decompose(),this._localRotation.copyFrom(t),void this._markAsDirtyAndCompose();var r=e._TmpMats[0];if(this._getNegativeRotationToRef(r,o)){var s=e._TmpMats[1];n.y3.FromQuaternionToRef(t,s),r.multiplyToRef(s,s),this._rotateWithMatrix(s,i,o)}},e.prototype.setRotationMatrix=function(t,i,o){if(void 0===i&&(i=a.T.LOCAL),i===a.T.LOCAL){var r=e._TmpQuat;return n._f.FromRotationMatrixToRef(t,r),void this.setRotationQuaternion(r,i,o)}var s=e._TmpMats[0];if(this._getNegativeRotationToRef(s,o)){var h=e._TmpMats[1];h.copyFrom(t),s.multiplyToRef(t,h),this._rotateWithMatrix(h,i,o)}},e.prototype._rotateWithMatrix=function(t,i,o){void 0===i&&(i=a.T.LOCAL);var n=this.getLocalMatrix(),r=n.m[12],s=n.m[13],h=n.m[14],c=this.getParent(),l=e._TmpMats[3],u=e._TmpMats[4];c&&i==a.T.WORLD?(o?(l.copyFrom(o.getWorldMatrix()),c.getAbsoluteTransform().multiplyToRef(l,l)):l.copyFrom(c.getAbsoluteTransform()),u.copyFrom(l),u.invert(),n.multiplyToRef(l,n),n.multiplyToRef(t,n),n.multiplyToRef(u,n)):i==a.T.WORLD&&o?(l.copyFrom(o.getWorldMatrix()),u.copyFrom(l),u.invert(),n.multiplyToRef(l,n),n.multiplyToRef(t,n),n.multiplyToRef(u,n)):n.multiplyToRef(t,n),n.setTranslationFromFloats(r,s,h),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},e.prototype._getNegativeRotationToRef=function(t,i){var o=e._TmpMats[2];return t.copyFrom(this.getAbsoluteTransform()),i?(t.multiplyToRef(i.getWorldMatrix(),t),n.y3.ScalingToRef(i.scaling.x,i.scaling.y,i.scaling.z,o)):n.y3.IdentityToRef(o),t.invert(),!isNaN(t.m[0])&&(o.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(o,t),!0)},e.prototype.getPosition=function(t,e){void 0===t&&(t=a.T.LOCAL),void 0===e&&(e=null);var i=n.P.Zero();return this.getPositionToRef(t,e,i),i},e.prototype.getPositionToRef=function(t,i,o){if(void 0===t&&(t=a.T.LOCAL),t==a.T.LOCAL){var n=this.getLocalMatrix();o.x=n.m[12],o.y=n.m[13],o.z=n.m[14]}else{var r=null;i&&(r=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=e._TmpMats[0];i&&r?(s.copyFrom(this.getAbsoluteTransform()),s.multiplyToRef(r,s)):s=this.getAbsoluteTransform(),o.x=s.m[12],o.y=s.m[13],o.z=s.m[14]}},e.prototype.getAbsolutePosition=function(t){void 0===t&&(t=null);var e=n.P.Zero();return this.getPositionToRef(a.T.WORLD,t,e),e},e.prototype.getAbsolutePositionToRef=function(t,e){this.getPositionToRef(a.T.WORLD,t,e)},e.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var t=this._skeleton.getPoseMatrix();t&&this._absoluteTransform.multiplyToRef(t,this._absoluteTransform)}for(var e=this.children,i=e.length,o=0;o<i;o++)e[o].computeAbsoluteTransforms()},e.prototype.getDirection=function(t,e){void 0===e&&(e=null);var i=n.P.Zero();return this.getDirectionToRef(t,e,i),i},e.prototype.getDirectionToRef=function(t,i,o){void 0===i&&(i=null);var r=null;i&&(r=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=e._TmpMats[0];s.copyFrom(this.getAbsoluteTransform()),i&&r&&s.multiplyToRef(r,s),n.P.TransformNormalToRef(t,s,o),o.normalize()},e.prototype.getRotation=function(t,e){void 0===t&&(t=a.T.LOCAL),void 0===e&&(e=null);var i=n.P.Zero();return this.getRotationToRef(t,e,i),i},e.prototype.getRotationToRef=function(t,i,o){void 0===t&&(t=a.T.LOCAL),void 0===i&&(i=null);var n=e._TmpQuat;this.getRotationQuaternionToRef(t,i,n),n.toEulerAnglesToRef(o)},e.prototype.getRotationQuaternion=function(t,e){void 0===t&&(t=a.T.LOCAL),void 0===e&&(e=null);var i=n._f.Identity();return this.getRotationQuaternionToRef(t,e,i),i},e.prototype.getRotationQuaternionToRef=function(t,i,o){if(void 0===t&&(t=a.T.LOCAL),void 0===i&&(i=null),t==a.T.LOCAL)this._decompose(),o.copyFrom(this._localRotation);else{var n=e._TmpMats[0],r=this.getAbsoluteTransform();i?r.multiplyToRef(i.getWorldMatrix(),n):n.copyFrom(r),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.decompose(void 0,o,void 0)}},e.prototype.getRotationMatrix=function(t,e){void 0===t&&(t=a.T.LOCAL);var i=n.y3.Identity();return this.getRotationMatrixToRef(t,e,i),i},e.prototype.getRotationMatrixToRef=function(t,i,o){if(void 0===t&&(t=a.T.LOCAL),t==a.T.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(o);else{var n=e._TmpMats[0],r=this.getAbsoluteTransform();i?r.multiplyToRef(i.getWorldMatrix(),n):n.copyFrom(r),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.getRotationMatrixToRef(o)}},e.prototype.getAbsolutePositionFromLocal=function(t,e){void 0===e&&(e=null);var i=n.P.Zero();return this.getAbsolutePositionFromLocalToRef(t,e,i),i},e.prototype.getAbsolutePositionFromLocalToRef=function(t,i,o){void 0===i&&(i=null);var r=null;i&&(r=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=e._TmpMats[0];i&&r?(s.copyFrom(this.getAbsoluteTransform()),s.multiplyToRef(r,s)):s=this.getAbsoluteTransform(),n.P.TransformCoordinatesToRef(t,s,o)},e.prototype.getLocalPositionFromAbsolute=function(t,e){void 0===e&&(e=null);var i=n.P.Zero();return this.getLocalPositionFromAbsoluteToRef(t,e,i),i},e.prototype.getLocalPositionFromAbsoluteToRef=function(t,i,o){void 0===i&&(i=null);var r=null;i&&(r=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=e._TmpMats[0];s.copyFrom(this.getAbsoluteTransform()),i&&r&&s.multiplyToRef(r,s),s.invert(),n.P.TransformCoordinatesToRef(t,s,o)},e.prototype.setCurrentPoseAsRest=function(){this.setRestPose(this.getLocalMatrix())},e._TmpVecs=r.B.BuildArray(2,n.P.Zero),e._TmpQuat=n._f.Identity(),e._TmpMats=r.B.BuildArray(5,n.y3.Identity),e}(s.N)},95358:(t,e,i)=>{i.d(e,{N$:()=>o.N,rl:()=>s,B9:()=>h,Od:()=>c.O});var o=i(48017),n=i(58095),r=i(43048),s=function(){function t(t,e,i){if(this.targetPosition=n.P.Zero(),this.poleTargetPosition=n.P.Zero(),this.poleTargetLocalOffset=n.P.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=n._f.Identity(),this._bone1Mat=n.y3.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=n.P.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=e,this._bone1=e.getParent(),this._bone1){this.mesh=t;var o=e.getPosition();if(e.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,o.x>o.y&&o.x>o.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var s=this._bone1.getScale(),a=this._bone2.getScale();this._bone1Length=this._bone1.length*s.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*a.y*this.mesh.scaling.y}else if(this._bone1.children[0]){t.computeWorldMatrix(!0);var h=this._bone2.children[0].getAbsolutePosition(t),c=this._bone2.getAbsolutePosition(t),l=this._bone1.getAbsolutePosition(t);this._bone1Length=n.P.Distance(h,c),this._bone2Length=n.P.Distance(c,l)}this._bone1.getRotationMatrixToRef(r.T.WORLD,t,this._bone1Mat),this.maxAngle=Math.PI,i&&(i.targetMesh&&(this.targetMesh=i.targetMesh,this.targetMesh.computeWorldMatrix(!0)),i.poleTargetMesh?(this.poleTargetMesh=i.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):i.poleTargetBone?this.poleTargetBone=i.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),i.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(i.poleTargetLocalOffset),i.poleAngle&&(this.poleAngle=i.poleAngle),i.bendAxis&&this._bendAxis.copyFrom(i.bendAxis),i.maxAngle&&(this.maxAngle=i.maxAngle),i.slerpAmount&&(this.slerpAmount=i.slerpAmount))}}return Object.defineProperty(t.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(t){this._setMaxAngle(t)},enumerable:!1,configurable:!0}),t.prototype._setMaxAngle=function(t){t<0&&(t=0),(t>Math.PI||null==t)&&(t=Math.PI),this._maxAngle=t;var e=this._bone1Length,i=this._bone2Length;this._maxReach=Math.sqrt(e*e+i*i-2*e*i*Math.cos(t))},t.prototype.update=function(){var e=this._bone1;if(e){var i=this.targetPosition,o=this.poleTargetPosition,s=t._TmpMats[0],a=t._TmpMats[1];this.targetMesh&&i.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,o):this.poleTargetMesh&&n.P.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),o);var h=t._TmpVecs[0],c=t._TmpVecs[1],l=t._TmpVecs[2],u=t._TmpVecs[3],p=t._TmpVecs[4],d=t._TmpQuat;e.getAbsolutePositionToRef(this.mesh,h),o.subtractToRef(h,p),0==p.x&&0==p.y&&0==p.z?p.y=1:p.normalize(),i.subtractToRef(h,u),u.normalize(),n.P.CrossToRef(u,p,c),c.normalize(),n.P.CrossToRef(u,c,l),l.normalize(),n.y3.FromXYZAxesToRef(l,u,c,s);var _=this._bone1Length,f=this._bone2Length,m=n.P.Distance(h,i);this._maxReach>0&&(m=Math.min(this._maxReach,m));var g=(f*f+m*m-_*_)/(2*f*m),y=(m*m+_*_-f*f)/(2*m*_);g>1&&(g=1),y>1&&(y=1),g<-1&&(g=-1),y<-1&&(y=-1);var v=Math.acos(g),b=Math.acos(y),C=-v-b;if(this._rightHandedSystem)n.y3.RotationYawPitchRollToRef(0,0,this._adjustRoll,a),a.multiplyToRef(s,s),n.y3.RotationAxisToRef(this._bendAxis,b,a),a.multiplyToRef(s,s);else{var R=t._TmpVecs[5];R.copyFrom(this._bendAxis),R.x*=-1,n.y3.RotationAxisToRef(R,-b,a),a.multiplyToRef(s,s)}this.poleAngle&&(n.y3.RotationAxisToRef(u,this.poleAngle,a),s.multiplyToRef(a,s)),this._bone1&&(this.slerpAmount<1?(this._slerping||n._f.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),n._f.FromRotationMatrixToRef(s,d),n._f.SlerpToRef(this._bone1Quat,d,this.slerpAmount,this._bone1Quat),C=this._bone2Ang*(1-this.slerpAmount)+C*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,r.T.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(s,r.T.WORLD,this.mesh),this._bone1Mat.copyFrom(s),this._slerping=!1),this._updateLinkedTransformRotation(this._bone1)),this._bone2.setAxisAngle(this._bendAxis,C,r.T.LOCAL),this._updateLinkedTransformRotation(this._bone2),this._bone2Ang=C}},t.prototype._updateLinkedTransformRotation=function(t){t._linkedTransformNode&&(t._linkedTransformNode.rotationQuaternion||(t._linkedTransformNode.rotationQuaternion=new n._f),t.getRotationQuaternionToRef(r.T.LOCAL,null,t._linkedTransformNode.rotationQuaternion))},t._TmpVecs=[n.P.Zero(),n.P.Zero(),n.P.Zero(),n.P.Zero(),n.P.Zero(),n.P.Zero()],t._TmpQuat=n._f.Identity(),t._TmpMats=[n.y3.Identity(),n.y3.Identity()],t}(),a=i(48939),h=function(){function t(t,e,i,o){if(this.upAxis=n.P.Up(),this.upAxisSpace=r.T.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=n._f.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=n.P.Forward(),this.mesh=t,this.bone=e,this.target=i,o&&(o.adjustYaw&&(this.adjustYaw=o.adjustYaw),o.adjustPitch&&(this.adjustPitch=o.adjustPitch),o.adjustRoll&&(this.adjustRoll=o.adjustRoll),null!=o.maxYaw?this.maxYaw=o.maxYaw:this.maxYaw=Math.PI,null!=o.minYaw?this.minYaw=o.minYaw:this.minYaw=-Math.PI,null!=o.maxPitch?this.maxPitch=o.maxPitch:this.maxPitch=Math.PI,null!=o.minPitch?this.minPitch=o.minPitch:this.minPitch=-Math.PI,null!=o.slerpAmount&&(this.slerpAmount=o.slerpAmount),null!=o.upAxis&&(this.upAxis=o.upAxis),null!=o.upAxisSpace&&(this.upAxisSpace=o.upAxisSpace),null!=o.yawAxis||null!=o.pitchAxis)){var s=r.RD.Y,a=r.RD.X;null!=o.yawAxis&&(s=o.yawAxis.clone()).normalize(),null!=o.pitchAxis&&(a=o.pitchAxis.clone()).normalize();var h=n.P.Cross(a,s);this._transformYawPitch=n.y3.Identity(),n.y3.FromXYZAxesToRef(a,s,h,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}e.getParent()||this.upAxisSpace!=r.T.BONE||(this.upAxisSpace=r.T.LOCAL)}return Object.defineProperty(t.prototype,"minYaw",{get:function(){return this._minYaw},set:function(t){this._minYaw=t,this._minYawSin=Math.sin(t),this._minYawCos=Math.cos(t),null!=this._maxYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(t){this._maxYaw=t,this._maxYawSin=Math.sin(t),this._maxYawCos=Math.cos(t),null!=this._minYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minPitch",{get:function(){return this._minPitch},set:function(t){this._minPitch=t,this._minPitchTan=Math.tan(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(t){this._maxPitch=t,this._maxPitchTan=Math.tan(t)},enumerable:!1,configurable:!0}),t.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)this._firstFrameSkipped=!0;else{var e=this.bone,i=t._TmpVecs[0];e.getAbsolutePositionToRef(this.mesh,i);var o=this.target,s=t._TmpMats[0],a=t._TmpMats[1],h=this.mesh,c=e.getParent(),l=t._TmpVecs[1];l.copyFrom(this.upAxis),this.upAxisSpace==r.T.BONE&&c?(this._transformYawPitch&&n.P.TransformCoordinatesToRef(l,this._transformYawPitchInv,l),c.getDirectionToRef(l,this.mesh,l)):this.upAxisSpace==r.T.LOCAL&&(h.getDirectionToRef(l,l),1==h.scaling.x&&1==h.scaling.y&&1==h.scaling.z||l.normalize());var u=!1,p=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(u=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(p=!0),u||p){var d=t._TmpMats[2],_=t._TmpMats[3];if(this.upAxisSpace==r.T.BONE&&1==l.y&&c)c.getRotationMatrixToRef(r.T.WORLD,this.mesh,d);else if(this.upAxisSpace!=r.T.LOCAL||1!=l.y||c){var f=t._TmpVecs[2];f.copyFrom(this._fowardAxis),this._transformYawPitch&&n.P.TransformCoordinatesToRef(f,this._transformYawPitchInv,f),c?c.getDirectionToRef(f,this.mesh,f):h.getDirectionToRef(f,f);var m=n.P.Cross(l,f);m.normalize(),f=n.P.Cross(m,l),n.y3.FromXYZAxesToRef(m,l,f,d)}else d.copyFrom(h.getWorldMatrix());d.invertToRef(_);var g=null;if(p){var y=t._TmpVecs[3];o.subtractToRef(i,y),n.P.TransformCoordinatesToRef(y,_,y),g=Math.sqrt(y.x*y.x+y.z*y.z);var v=Math.atan2(y.y,g),b=v;v>this._maxPitch?(y.y=this._maxPitchTan*g,b=this._maxPitch):v<this._minPitch&&(y.y=this._minPitchTan*g,b=this._minPitch),v!=b&&(n.P.TransformCoordinatesToRef(y,d,y),y.addInPlace(i),o=y)}if(u){y=t._TmpVecs[4];o.subtractToRef(i,y),n.P.TransformCoordinatesToRef(y,_,y);var C=Math.atan2(y.x,y.z),R=C;if((C>this._maxYaw||C<this._minYaw)&&(null==g&&(g=Math.sqrt(y.x*y.x+y.z*y.z)),this._yawRange>Math.PI?this._isAngleBetween(C,this._maxYaw,this._midYawConstraint)?(y.z=this._maxYawCos*g,y.x=this._maxYawSin*g,R=this._maxYaw):this._isAngleBetween(C,this._midYawConstraint,this._minYaw)&&(y.z=this._minYawCos*g,y.x=this._minYawSin*g,R=this._minYaw):C>this._maxYaw?(y.z=this._maxYawCos*g,y.x=this._maxYawSin*g,R=this._maxYaw):C<this._minYaw&&(y.z=this._minYawCos*g,y.x=this._minYawSin*g,R=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var P=t._TmpVecs[8];P.copyFrom(r.RD.Z),this._transformYawPitch&&n.P.TransformCoordinatesToRef(P,this._transformYawPitchInv,P);var T=t._TmpMats[4];this._boneQuat.toRotationMatrix(T),this.mesh.getWorldMatrix().multiplyToRef(T,T),n.P.TransformCoordinatesToRef(P,T,P),n.P.TransformCoordinatesToRef(P,_,P);var M=Math.atan2(P.x,P.z);if(this._getAngleBetween(M,C)>this._getAngleBetween(M,this._midYawConstraint)){null==g&&(g=Math.sqrt(y.x*y.x+y.z*y.z));var x=this._getAngleBetween(M,this._maxYaw);this._getAngleBetween(M,this._minYaw)<x?(R=M+.75*Math.PI,y.z=Math.cos(R)*g,y.x=Math.sin(R)*g):(R=M-.75*Math.PI,y.z=Math.cos(R)*g,y.x=Math.sin(R)*g)}}C!=R&&(n.P.TransformCoordinatesToRef(y,d,y),y.addInPlace(i),o=y)}}var O=t._TmpVecs[5],w=t._TmpVecs[6],k=t._TmpVecs[7],S=t._TmpQuat;o.subtractToRef(i,O),O.normalize(),n.P.CrossToRef(l,O,w),w.normalize(),n.P.CrossToRef(O,w,k),k.normalize(),n.y3.FromXYZAxesToRef(w,k,O,s),0===w.x&&0===w.y&&0===w.z||0===k.x&&0===k.y&&0===k.z||0===O.x&&0===O.y&&0===O.z||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(n.y3.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,a),a.multiplyToRef(s,s)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(r.T.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(s,s),n._f.FromRotationMatrixToRef(s,S),n._f.SlerpToRef(this._boneQuat,S,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,r.T.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(s,s),this.bone.setRotationMatrix(s,r.T.WORLD,this.mesh),this._slerping=!1),this._updateLinkedTransformRotation())}},t.prototype._getAngleDiff=function(t,e){var i=e-t;return(i%=2*Math.PI)>Math.PI?i-=2*Math.PI:i<-Math.PI&&(i+=2*Math.PI),i},t.prototype._getAngleBetween=function(t,e){var i=0;return(i=(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)<(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)?e-t:t-e)>Math.PI&&(i=2*Math.PI-i),i},t.prototype._isAngleBetween=function(t,e,i){if(t=(t%=2*Math.PI)<0?t+2*Math.PI:t,(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)<(i=(i%=2*Math.PI)<0?i+2*Math.PI:i)){if(t>e&&t<i)return!0}else if(t>i&&t<e)return!0;return!1},t.prototype._updateLinkedTransformRotation=function(){var t=this.bone;t._linkedTransformNode&&(t._linkedTransformNode.rotationQuaternion||(t._linkedTransformNode.rotationQuaternion=new n._f),t.getRotationQuaternionToRef(r.T.LOCAL,null,t._linkedTransformNode.rotationQuaternion))},t._TmpVecs=a.B.BuildArray(10,n.P.Zero),t._TmpQuat=n._f.Identity(),t._TmpMats=a.B.BuildArray(5,n.y3.Identity),t}(),c=i(52106)},52106:(t,e,i)=>{i.d(e,{O:()=>p});var o=i(48017),n=i(62897),r=i(58095),s=i(15034),a=i(18770),h=i(4906),c=i(15210),l=i(84318),u=i(1101),p=function(){function t(t,e,i){this.name=t,this.id=e,this.bones=new Array,this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=r.y3.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new n.y$,this.bones=[],this._scene=i||c.l.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var o=this._scene.getEngine().getCaps();this._canUseTextureForBones=o.textureFloat&&o.maxVertexTextureImageUnits>0}return Object.defineProperty(t.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(t){this._useTextureToStoreBoneMatrices=t,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"Skeleton"},t.prototype.getChildren=function(){return this.bones.filter((function(t){return!t.getParent()}))},t.prototype.getTransformMatrices=function(t){return this.needInitialSkinMatrix?(t._bonesTransformMatrices||this.prepare(),t._bonesTransformMatrices):(this._transformMatrices||this.prepare(),this._transformMatrices)},t.prototype.getTransformMatrixTexture=function(t){return this.needInitialSkinMatrix&&t._transformMatrixTexture?t._transformMatrixTexture:this._transformMatrixTexture},t.prototype.getScene=function(){return this._scene},t.prototype.toString=function(t){var e="Name: ".concat(this.name,", nBones: ").concat(this.bones.length);if(e+=", nAnimationRanges: ".concat(this._ranges?Object.keys(this._ranges).length:"none"),t){e+=", Ranges: {";var i=!0;for(var o in this._ranges)i&&(e+=", ",i=!1),e+=o;e+="}"}return e},t.prototype.getBoneIndexByName=function(t){for(var e=0,i=this.bones.length;e<i;e++)if(this.bones[e].name===t)return e;return-1},t.prototype.createAnimationRange=function(t,e,i){if(!this._ranges[t]){this._ranges[t]=new h.X(t,e,i);for(var o=0,n=this.bones.length;o<n;o++)this.bones[o].animations[0]&&this.bones[o].animations[0].createRange(t,e,i)}},t.prototype.deleteAnimationRange=function(t,e){void 0===e&&(e=!0);for(var i=0,o=this.bones.length;i<o;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].deleteRange(t,e);this._ranges[t]=null},t.prototype.getAnimationRange=function(t){return this._ranges[t]||null},t.prototype.getAnimationRanges=function(){var t,e=[];for(t in this._ranges)e.push(this._ranges[t]);return e},t.prototype.copyAnimationRange=function(t,e,i){if(void 0===i&&(i=!1),this._ranges[e]||!t.getAnimationRange(e))return!1;var o,n,r=!0,s=this._getHighestAnimationFrame()+1,a={},c=t.bones;for(n=0,o=c.length;n<o;n++)a[c[n].name]=c[n];this.bones.length!==c.length&&(l.Y.Warn("copyAnimationRange: this rig has ".concat(this.bones.length," bones, while source as ").concat(c.length)),r=!1);var u=i&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(n=0,o=this.bones.length;n<o;n++){var p=this.bones[n].name,d=a[p];d?r=r&&this.bones[n].copyAnimationRange(d,e,s,i,u):(l.Y.Warn("copyAnimationRange: not same rig, missing source bone "+p),r=!1)}var _=t.getAnimationRange(e);return _&&(this._ranges[e]=new h.X(e,_.from+s,_.to+s)),r},t.prototype.returnToRest=function(){for(var t=0,e=this.bones;t<e.length;t++){var i=e[t];-1!==i._index&&i.returnToRest()}},t.prototype._getHighestAnimationFrame=function(){for(var t=0,e=0,i=this.bones.length;e<i;e++)if(this.bones[e].animations[0]){var o=this.bones[e].animations[0].getHighestFrame();t<o&&(t=o)}return t},t.prototype.beginAnimation=function(t,e,i,o){var n=this.getAnimationRange(t);return n?this._scene.beginAnimation(this,n.from,n.to,e,i,o):null},t.MakeAnimationAdditive=function(t,e,i){void 0===e&&(e=0);var o=t.getAnimationRange(i);if(!o)return null;for(var n=t._scene.getAllAnimatablesByTarget(t),r=null,s=0;s<n.length;s++){var h=n[s];if(h.fromFrame===(null==o?void 0:o.from)&&h.toFrame===(null==o?void 0:o.to)){r=h;break}}var c=t.getAnimatables();for(s=0;s<c.length;s++){var l=c[s].animations;if(l)for(var u=0;u<l.length;u++)a.f.MakeAnimationAdditive(l[u],e,i)}return r&&(r.isAdditive=!0),t},t.prototype._markAsDirty=function(){this._isDirty=!0},t.prototype._registerMeshWithPoseMatrix=function(t){this._meshesWithPoseMatrix.push(t)},t.prototype._unregisterMeshWithPoseMatrix=function(t){var e=this._meshesWithPoseMatrix.indexOf(t);e>-1&&this._meshesWithPoseMatrix.splice(e,1)},t.prototype._computeTransformMatrices=function(t,e){this.onBeforeComputeObservable.notifyObservers(this);for(var i=0;i<this.bones.length;i++){var o=this.bones[i];o._childUpdateId++;var n=o.getParent();if(n?o.getLocalMatrix().multiplyToRef(n.getWorldMatrix(),o.getWorldMatrix()):e?o.getLocalMatrix().multiplyToRef(e,o.getWorldMatrix()):o.getWorldMatrix().copyFrom(o.getLocalMatrix()),-1!==o._index){var r=null===o._index?i:o._index;o.getInvertedAbsoluteTransform().multiplyToArray(o.getWorldMatrix(),t,16*r)}}this._identity.copyToArray(t,16*this.bones.length)},t.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var t=0,e=this.bones;t<e.length;t++){(u=e[t])._linkedTransformNode&&(u._linkedTransformNode.computeWorldMatrix(),u._matrix=u._linkedTransformNode._localMatrix)}if(this.needInitialSkinMatrix)for(var i=0,o=this._meshesWithPoseMatrix;i<o.length;i++){var n=o[i],a=n.getPoseMatrix(),h=this._isDirty;if(n._bonesTransformMatrices&&n._bonesTransformMatrices.length===16*(this.bones.length+1)||(n._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),h=!0),h){if(this._synchronizedWithMesh!==n){this._synchronizedWithMesh=n;for(var c=0,l=this.bones;c<l.length;c++){var u;if(!(u=l[c]).getParent())u.getBaseMatrix().multiplyToRef(a,r.jp.Matrix[1]),u._updateDifferenceMatrix(r.jp.Matrix[1])}if(this.isUsingTextureForMatrices){var p=4*(this.bones.length+1);n._transformMatrixTexture&&n._transformMatrixTexture.getSize().width===p||(n._transformMatrixTexture&&n._transformMatrixTexture.dispose(),n._transformMatrixTexture=s.l.CreateRGBATexture(n._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(n._bonesTransformMatrices,a),this.isUsingTextureForMatrices&&n._transformMatrixTexture&&n._transformMatrixTexture.update(n._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=s.l.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1},t.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var t=0;t<this.bones.length;t++)this._animatables.push(this.bones[t])}return this._animatables},t.prototype.clone=function(e,i){var n=new t(e,i||e,this._scene);n.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var r=0;r<this.bones.length;r++){var s=this.bones[r],a=null,h=s.getParent();if(h){var c=this.bones.indexOf(h);a=n.bones[c]}var l=new o.N(s.name,n,a,s.getBaseMatrix().clone(),s.getRestPose().clone());l._index=s._index,s._linkedTransformNode&&l.linkTransformNode(s._linkedTransformNode),u.j.DeepCopy(s.animations,l.animations)}if(this._ranges)for(var p in n._ranges={},this._ranges){var d=this._ranges[p];d&&(n._ranges[p]=d.clone())}return this._isDirty=!0,n},t.prototype.enableBlending=function(t){void 0===t&&(t=.01),this.bones.forEach((function(e){e.animations.forEach((function(e){e.enableBlending=!0,e.blendingSpeed=t}))}))},t.prototype.dispose=function(){if(this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._parentContainer){var t=this._parentContainer.skeletons.indexOf(this);t>-1&&this._parentContainer.skeletons.splice(t,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},t.prototype.serialize=function(){var t,e={};e.name=this.name,e.id=this.id,this.dimensionsAtRest&&(e.dimensionsAtRest=this.dimensionsAtRest.asArray()),e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var i=0;i<this.bones.length;i++){var o=this.bones[i],n=o.getParent(),r={parentBoneIndex:n?this.bones.indexOf(n):-1,index:o.getIndex(),name:o.name,id:o.id,matrix:o.getBaseMatrix().toArray(),rest:o.getRestPose().toArray(),linkedTransformNodeId:null===(t=o.getTransformNode())||void 0===t?void 0:t.id};for(var s in e.bones.push(r),o.length&&(r.length=o.length),o.metadata&&(r.metadata=o.metadata),o.animations&&o.animations.length>0&&(r.animation=o.animations[0].serialize()),e.ranges=[],this._ranges){var a=this._ranges[s];if(a){var h={};h.name=s,h.from=a.from,h.to=a.to,e.ranges.push(h)}}}return e},t.Parse=function(e,i){var n,s=new t(e.name,e.id,i);for(e.dimensionsAtRest&&(s.dimensionsAtRest=r.P.FromArray(e.dimensionsAtRest)),s.needInitialSkinMatrix=e.needInitialSkinMatrix,n=0;n<e.bones.length;n++){var h=e.bones[n],c=e.bones[n].index,l=null;h.parentBoneIndex>-1&&(l=s.bones[h.parentBoneIndex]);var u=h.rest?r.y3.FromArray(h.rest):null,p=new o.N(h.name,s,l,r.y3.FromArray(h.matrix),u,null,c);void 0!==h.id&&null!==h.id&&(p.id=h.id),h.length&&(p.length=h.length),h.metadata&&(p.metadata=h.metadata),h.animation&&p.animations.push(a.f.Parse(h.animation)),void 0!==h.linkedTransformNodeId&&null!==h.linkedTransformNodeId&&(s._hasWaitingData=!0,p._waitingTransformNodeId=h.linkedTransformNodeId)}if(e.ranges)for(n=0;n<e.ranges.length;n++){var d=e.ranges[n];s.createAnimationRange(d.name,d.from,d.to)}return s},t.prototype.computeAbsoluteTransforms=function(t){void 0===t&&(t=!1);var e=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=e||t)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=e)},t.prototype.getPoseMatrix=function(){var t=null;return this._meshesWithPoseMatrix.length>0&&(t=this._meshesWithPoseMatrix[0].getPoseMatrix()),t},t.prototype.sortBones=function(){for(var t=new Array,e=new Array(this.bones.length),i=0;i<this.bones.length;i++)this._sortBones(i,t,e);this.bones=t},t.prototype._sortBones=function(t,e,i){if(!i[t]){i[t]=!0;var o=this.bones[t];if(o){void 0===o._index&&(o._index=t);var n=o.getParent();n&&this._sortBones(this.bones.indexOf(n),e,i),e.push(o)}}},t.prototype.setCurrentPoseAsRest=function(){this.bones.forEach((function(t){t.setCurrentPoseAsRest()}))},t}()},72208:(t,e,i)=>{i.d(e,{l:()=>n,o:()=>r});var o=i(41364),n=function(){function t(t,e,i,n,r,s,a,h){void 0===n&&(n=0),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),this._isAlreadyOwned=!1,t.getScene?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=i,this._instanced=s,this._divisor=h||1,e instanceof o.h?(this._data=null,this._buffer=e):(this._data=e,this._buffer=null),this.byteStride=a?n:n*Float32Array.BYTES_PER_ELEMENT,r||this.create()}return t.prototype.createVertexBuffer=function(t,e,i,o,n,s,a){void 0===s&&(s=!1);var h=s?e:e*Float32Array.BYTES_PER_ELEMENT,c=o?s?o:o*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new r(this._engine,this,t,this._updatable,!0,c,void 0===n?this._instanced:n,h,i,void 0,void 0,!0,this._divisor||a)},t.prototype.isUpdatable=function(){return this._updatable},t.prototype.getData=function(){return this._data},t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},t.prototype.create=function(t){void 0===t&&(t=null),!t&&this._buffer||(t=t||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t),this._data=t):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(t),this._data=t):this._buffer=this._engine.createVertexBuffer(t))},t.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},t.prototype.update=function(t){this.create(t)},t.prototype.updateDirectly=function(t,e,i,o){void 0===o&&(o=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t,o?e:e*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=0===e&&void 0===i?t:null)},t.prototype._increaseReferences=function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)},t.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)},t}(),r=function(){function t(e,i,o,r,s,a,h,c,l,u,p,d,_,f){if(void 0===p&&(p=!1),void 0===d&&(d=!1),void 0===_&&(_=1),void 0===f&&(f=!1),i instanceof n?(this._buffer=i,this._ownsBuffer=f):(this._buffer=new n(e,i,r,a,s,h,d),this._ownsBuffer=!0),this.uniqueId=t._Counter++,this._kind=o,null==u){var m=this.getData();this.type=t.FLOAT,m instanceof Int8Array?this.type=t.BYTE:m instanceof Uint8Array?this.type=t.UNSIGNED_BYTE:m instanceof Int16Array?this.type=t.SHORT:m instanceof Uint16Array?this.type=t.UNSIGNED_SHORT:m instanceof Int32Array?this.type=t.INT:m instanceof Uint32Array&&(this.type=t.UNSIGNED_INT)}else this.type=u;var g=t.GetTypeByteLength(this.type);d?(this._size=l||(a?a/g:t.DeduceStride(o)),this.byteStride=a||this._buffer.byteStride||this._size*g,this.byteOffset=c||0):(this._size=l||a||t.DeduceStride(o),this.byteStride=a?a*g:this._buffer.byteStride||this._size*g,this.byteOffset=(c||0)*g),this.normalized=p,this._instanced=void 0!==h&&h,this._instanceDivisor=h?_:0,this._computeHashCode()}return Object.defineProperty(t.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(t){this._instanceDivisor=t,this._instanced=0!=t,this._computeHashCode()},enumerable:!1,configurable:!0}),t.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},t.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},t.prototype.getKind=function(){return this._kind},t.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},t.prototype.getData=function(){return this._buffer.getData()},t.prototype.getFloatData=function(e,i){var o=this.getData();if(!o)return null;var n=this.getSize()*t.GetTypeByteLength(this.type),r=e*this.getSize();if(this.type!==t.FLOAT||this.byteStride!==n){var s=new Float32Array(r);return this.forEach(r,(function(t,e){return s[e]=t})),s}if(!(o instanceof Array||o instanceof Float32Array)||0!==this.byteOffset||o.length!==r){if(o instanceof Array){var a=this.byteOffset/4;return o.slice(a,a+r)}if(o instanceof ArrayBuffer)return new Float32Array(o,this.byteOffset,r);a=o.byteOffset+this.byteOffset;if(i){var h=new Float32Array(r),c=new Float32Array(o.buffer,a,r);return h.set(c),h}var l=a%4;return l&&(a=Math.max(0,a-l)),new Float32Array(o.buffer,a,r)}return i?o.slice():o},t.prototype.getBuffer=function(){return this._buffer.getBuffer()},t.prototype.getStrideSize=function(){return this.byteStride/t.GetTypeByteLength(this.type)},t.prototype.getOffset=function(){return this.byteOffset/t.GetTypeByteLength(this.type)},t.prototype.getSize=function(e){return void 0===e&&(e=!1),e?this._size*t.GetTypeByteLength(this.type):this._size},t.prototype.getIsInstanced=function(){return this._instanced},t.prototype.getInstanceDivisor=function(){return this._instanceDivisor},t.prototype.create=function(t){this._buffer.create(t)},t.prototype.update=function(t){this._buffer.update(t)},t.prototype.updateDirectly=function(t,e,i){void 0===i&&(i=!1),this._buffer.updateDirectly(t,e,void 0,i)},t.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},t.prototype.forEach=function(e,i){t.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,i)},t.DeduceStride=function(e){switch(e){case t.UVKind:case t.UV2Kind:case t.UV3Kind:case t.UV4Kind:case t.UV5Kind:case t.UV6Kind:return 2;case t.NormalKind:case t.PositionKind:return 3;case t.ColorKind:case t.MatricesIndicesKind:case t.MatricesIndicesExtraKind:case t.MatricesWeightsKind:case t.MatricesWeightsExtraKind:case t.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}},t.GetTypeByteLength=function(e){switch(e){case t.BYTE:case t.UNSIGNED_BYTE:return 1;case t.SHORT:case t.UNSIGNED_SHORT:return 2;case t.INT:case t.UNSIGNED_INT:case t.FLOAT:return 4;default:throw new Error("Invalid type '".concat(e,"'"))}},t.ForEach=function(e,i,o,n,r,s,a,h){if(e instanceof Array)for(var c=i/4,l=o/4,u=0;u<s;u+=n){for(var p=0;p<n;p++)h(e[c+p],u+p);c+=l}else{var d=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),_=t.GetTypeByteLength(r);for(u=0;u<s;u+=n){var f=i;for(p=0;p<n;p++){h(t._GetFloatValue(d,r,f,a),u+p),f+=_}i+=o}}},t._GetFloatValue=function(e,i,o,n){switch(i){case t.BYTE:var r=e.getInt8(o);return n&&(r=Math.max(r/127,-1)),r;case t.UNSIGNED_BYTE:r=e.getUint8(o);return n&&(r/=255),r;case t.SHORT:r=e.getInt16(o,!0);return n&&(r=Math.max(r/32767,-1)),r;case t.UNSIGNED_SHORT:r=e.getUint16(o,!0);return n&&(r/=65535),r;case t.INT:return e.getInt32(o,!0);case t.UNSIGNED_INT:return e.getUint32(o,!0);case t.FLOAT:return e.getFloat32(o,!0);default:throw new Error("Invalid component type ".concat(i))}},t._Counter=0,t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.PositionKind="position",t.NormalKind="normal",t.TangentKind="tangent",t.UVKind="uv",t.UV2Kind="uv2",t.UV3Kind="uv3",t.UV4Kind="uv4",t.UV5Kind="uv5",t.UV6Kind="uv6",t.ColorKind="color",t.ColorInstanceKind="instanceColor",t.MatricesIndicesKind="matricesIndices",t.MatricesWeightsKind="matricesWeights",t.MatricesIndicesExtraKind="matricesIndicesExtra",t.MatricesWeightsExtraKind="matricesWeightsExtra",t}()},41364:(t,e,i)=>{i.d(e,{h:()=>o});var o=function(){function t(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=t._Counter++}return Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),t._Counter=0,t}()},71927:(t,e,i)=>{i.d(e,{NB:()=>r.N,hf:()=>n.h,lW:()=>o.l,oZ:()=>o.o});var o=i(72208),n=i(41364),r=i(93752)},93752:(t,e,i)=>{i.d(e,{N:()=>o});var o=function(){function t(t,e,i){void 0===i&&(i=3),this._engine=t,this._engine._storageBuffers.push(this),this._create(e,i)}return t.prototype._create=function(t,e){this._bufferSize=t,this._creationFlags=e,this._buffer=this._engine.createStorageBuffer(t,e)},t.prototype._rebuild=function(){this._create(this._bufferSize,this._creationFlags)},t.prototype.getBuffer=function(){return this._buffer},t.prototype.update=function(t,e,i){this._buffer&&this._engine.updateStorageBuffer(this._buffer,t,e,i)},t.prototype.read=function(t,e,i){return this._engine.readFromStorageBuffer(this._buffer,t,e,i)},t.prototype.dispose=function(){var t=this._engine._storageBuffers,e=t.indexOf(this);-1!==e&&(t[e]=t[t.length-1],t.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null},t}()},23402:(t,e,i)=>{i.d(e,{Y:()=>c});var o=i(31191),n=i(96969),r=i(62897),s=i(76324),a=i(13514),h=i(49671),c=function(){function t(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new r.y$,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}return t.prototype.attachControl=function(t){var e=this;t=a.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(i){if(i.type===s.kD.POINTERWHEEL){var o=i.event,n=o.deltaMode===h.G.DOM_DELTA_LINE?e._ffMultiplier:1;void 0!==o.deltaY?(e._wheelDeltaX+=e.wheelPrecisionX*n*o.deltaX/e._normalize,e._wheelDeltaY-=e.wheelPrecisionY*n*o.deltaY/e._normalize,e._wheelDeltaZ+=e.wheelPrecisionZ*n*o.deltaZ/e._normalize):void 0!==o.wheelDeltaY?(e._wheelDeltaX+=e.wheelPrecisionX*n*o.wheelDeltaX/e._normalize,e._wheelDeltaY-=e.wheelPrecisionY*n*o.wheelDeltaY/e._normalize,e._wheelDeltaZ+=e.wheelPrecisionZ*n*o.wheelDeltaZ/e._normalize):o.wheelDelta&&(e._wheelDeltaY-=e.wheelPrecisionY*o.wheelDelta/e._normalize),o.preventDefault&&(t||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,s.kD.POINTERWHEEL)},t.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()},t.prototype.checkInputs=function(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0},t.prototype.getClassName=function(){return"BaseCameraMouseWheelInput"},t.prototype.getSimpleName=function(){return"mousewheel"},(0,o.gn)([(0,n.qC)()],t.prototype,"wheelPrecisionX",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"wheelPrecisionY",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"wheelPrecisionZ",void 0),t}()},23592:(t,e,i)=>{i.d(e,{O:()=>a});var o=i(31191),n=i(96969),r=i(13514),s=i(76324),a=function(){function t(){this._currentActiveButton=-1,this.buttons=[0,1,2]}return t.prototype.attachControl=function(t){var e=this;t=r.w1.BackCompatCameraNoPreventDefault(arguments);var i=this.camera.getEngine(),o=i.getInputElement(),n=0,a=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(r){var h=r.event,c="touch"===h.pointerType;if(!i.isInVRExclusivePointerMode&&(r.type===s.kD.POINTERMOVE||-1!==e.buttons.indexOf(h.button))){var l=h.srcElement||h.target;if(e._altKey=h.altKey,e._ctrlKey=h.ctrlKey,e._metaKey=h.metaKey,e._shiftKey=h.shiftKey,e._buttonsPressed=h.buttons,i.isPointerLock){var u=h.movementX||h.mozMovementX||h.webkitMovementX||h.msMovementX||0,p=h.movementY||h.mozMovementY||h.webkitMovementY||h.msMovementY||0;e.onTouch(null,u,p),e._pointA=null,e._pointB=null}else if(r.type!==s.kD.POINTERDOWN||-1!==e._currentActiveButton&&!c)if(r.type===s.kD.POINTERDOUBLETAP)e.onDoubleTap(h.pointerType);else if(r.type!==s.kD.POINTERUP||e._currentActiveButton!==h.button&&!c){if(r.type===s.kD.POINTERMOVE)if(t||h.preventDefault(),e._pointA&&null===e._pointB){u=h.clientX-e._pointA.x,p=h.clientY-e._pointA.y;e.onTouch(e._pointA,u,p),e._pointA.x=h.clientX,e._pointA.y=h.clientY}else if(e._pointA&&e._pointB){var d=e._pointA.pointerId===h.pointerId?e._pointA:e._pointB;d.x=h.clientX,d.y=h.clientY;var _=e._pointA.x-e._pointB.x,f=e._pointA.y-e._pointB.y,m=_*_+f*f,g={x:(e._pointA.x+e._pointB.x)/2,y:(e._pointA.y+e._pointB.y)/2,pointerId:h.pointerId,type:r.type};e.onMultiTouch(e._pointA,e._pointB,n,m,a,g),a=g,n=m}}else{try{null==l||l.releasePointerCapture(h.pointerId)}catch(t){}c||(e._pointB=null),i._badOS?e._pointA=e._pointB=null:e._pointB&&e._pointA&&e._pointA.pointerId==h.pointerId?(e._pointA=e._pointB,e._pointB=null):e._pointA&&e._pointB&&e._pointB.pointerId==h.pointerId?e._pointB=null:e._pointA=e._pointB=null,(0!==n||a)&&(e.onMultiTouch(e._pointA,e._pointB,n,0,a,null),n=0,a=null),e._currentActiveButton=-1,e.onButtonUp(h),t||h.preventDefault()}else{try{null==l||l.setPointerCapture(h.pointerId)}catch(t){}null===e._pointA?e._pointA={x:h.clientX,y:h.clientY,pointerId:h.pointerId,type:h.pointerType}:null===e._pointB&&(e._pointB={x:h.clientX,y:h.clientY,pointerId:h.pointerId,type:h.pointerType}),-1!==e._currentActiveButton||c||(e._currentActiveButton=h.button),e.onButtonDown(h),t||(h.preventDefault(),o&&o.focus())}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,s.kD.POINTERDOWN|s.kD.POINTERUP|s.kD.POINTERMOVE|s.kD.POINTERDOUBLETAP),this._onLostFocus=function(){e._pointA=e._pointB=null,n=0,a=null,e.onLostFocus()},this._contextMenuBind=this.onContextMenu.bind(this),o&&o.addEventListener("contextmenu",this._contextMenuBind,!1);var h=this.camera.getScene().getEngine().getHostWindow();h&&r.w1.RegisterTopRootEvents(h,[{name:"blur",handler:this._onLostFocus}])},t.prototype.detachControl=function(){if(this._onLostFocus){var t=this.camera.getScene().getEngine().getHostWindow();t&&r.w1.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._contextMenuBind){var e=this.camera.getScene().getEngine().getInputElement();e&&e.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1},t.prototype.getClassName=function(){return"BaseCameraPointersInput"},t.prototype.getSimpleName=function(){return"pointers"},t.prototype.onDoubleTap=function(t){},t.prototype.onTouch=function(t,e,i){},t.prototype.onMultiTouch=function(t,e,i,o,n,r){},t.prototype.onContextMenu=function(t){t.preventDefault()},t.prototype.onButtonDown=function(t){},t.prototype.onButtonUp=function(t){},t.prototype.onLostFocus=function(){},(0,o.gn)([(0,n.qC)()],t.prototype,"buttons",void 0),t}()},75537:(t,e,i)=>{i.d(e,{R:()=>a});var o=i(31191),n=i(96969),r=i(73321),s=i(34987),a=function(){function t(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40,this._yAxisScale=1}return Object.defineProperty(t.prototype,"invertYAxis",{get:function(){return 1!==this._yAxisScale},set:function(t){this._yAxisScale=t?-1:1},enumerable:!1,configurable:!0}),t.prototype.attachControl=function(){var t=this,e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add((function(e){e.type!==s.nJ.POSE_ENABLED&&(t.gamepad&&e.type!==s.nJ.XBOX||(t.gamepad=e))})),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add((function(e){t.gamepad===e&&(t.gamepad=null)})),this.gamepad=e.getGamepadByType(s.nJ.XBOX)},t.prototype.detachControl=function(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},t.prototype.checkInputs=function(){if(this.gamepad){var t=this.camera,e=this.gamepad.rightStick;if(e){if(0!=e.x){var i=e.x/this.gamepadRotationSensibility;0!=i&&Math.abs(i)>.005&&(t.inertialAlphaOffset+=i)}if(0!=e.y){var o=e.y/this.gamepadRotationSensibility*this._yAxisScale;0!=o&&Math.abs(o)>.005&&(t.inertialBetaOffset+=o)}}var n=this.gamepad.leftStick;if(n&&0!=n.y){var r=n.y/this.gamepadMoveSensibility;0!=r&&Math.abs(r)>.005&&(this.camera.inertialRadiusOffset-=r)}}},t.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},t.prototype.getSimpleName=function(){return"gamepad"},(0,o.gn)([(0,n.qC)()],t.prototype,"gamepadRotationSensibility",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"gamepadMoveSensibility",void 0),t}();r.u.ArcRotateCameraGamepadInput=a},34286:(t,e,i)=>{i.d(e,{v:()=>h});var o=i(31191),n=i(96969),r=i(73321),s=i(63737),a=i(13514),h=function(){function t(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return t.prototype.attachControl=function(t){var e=this;t=a.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){e._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(i){var o,n=i.event;n.metaKey||(i.type===s.OG.KEYDOWN?(e._ctrlPressed=n.ctrlKey,e._altPressed=n.altKey,(-1!==e.keysUp.indexOf(n.keyCode)||-1!==e.keysDown.indexOf(n.keyCode)||-1!==e.keysLeft.indexOf(n.keyCode)||-1!==e.keysRight.indexOf(n.keyCode)||-1!==e.keysReset.indexOf(n.keyCode))&&(-1===(o=e._keys.indexOf(n.keyCode))&&e._keys.push(n.keyCode),n.preventDefault&&(t||n.preventDefault()))):-1===e.keysUp.indexOf(n.keyCode)&&-1===e.keysDown.indexOf(n.keyCode)&&-1===e.keysLeft.indexOf(n.keyCode)&&-1===e.keysRight.indexOf(n.keyCode)&&-1===e.keysReset.indexOf(n.keyCode)||((o=e._keys.indexOf(n.keyCode))>=0&&e._keys.splice(o,1),n.preventDefault&&(t||n.preventDefault())))})))},t.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var i=this._keys[e];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&t.useInputToRestoreState&&t.restoreState()}},t.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},t.prototype.getSimpleName=function(){return"keyboard"},(0,o.gn)([(0,n.qC)()],t.prototype,"keysUp",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"keysDown",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"keysLeft",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"keysRight",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"keysReset",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"panningSensibility",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"zoomingSensibility",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"useAltToZoom",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"angularSpeed",void 0),t}();r.u.ArcRotateCameraKeyboardMoveInput=h},20462:(t,e,i)=>{i.d(e,{F:()=>d});var o=i(31191),n=i(96969),r=i(73321),s=i(76324),a=i(13514),h=i(62464),c=i(58095),l=i(48154),u=i(49671),p=i(72739),d=function(){function t(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._inertialPanning=c.P.Zero()}return t.prototype._computeDeltaFromMouseWheelLegacyEvent=function(t,e){var i=.01*t*this.wheelDeltaPercentage*e;return t>0?i/(1+this.wheelDeltaPercentage):i*(1+this.wheelDeltaPercentage)},t.prototype.attachControl=function(t){var e=this;t=a.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(i){if(i.type===s.kD.POINTERWHEEL){var o=i.event,n=0,r=o,a=0,h=o.deltaMode===u.G.DOM_DELTA_LINE?40:1;if(a=void 0!==o.deltaY?-o.deltaY*h:void 0!==o.wheelDeltaY?-o.wheelDeltaY*h:r.wheelDelta,e.customComputeDeltaFromMouseWheel)n=e.customComputeDeltaFromMouseWheel(a,e,o);else if(e.wheelDeltaPercentage){if((n=e._computeDeltaFromMouseWheelLegacyEvent(a,e.camera.radius))>0){for(var c=e.camera.radius,l=e.camera.inertialRadiusOffset+n,d=0;d<20&&Math.abs(l)>.001;d++)c-=l,l*=e.camera.inertia;c=p.R.Clamp(c,0,Number.MAX_VALUE),n=e._computeDeltaFromMouseWheelLegacyEvent(a,c)}}else n=a/(40*e.wheelPrecision);n&&(e.zoomToMouseLocation&&e._hitPlane?e._zoomToMouse(n):e.camera.inertialRadiusOffset+=n),o.preventDefault&&(t||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,s.kD.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)},t.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},t.prototype.checkInputs=function(){if(this.zoomToMouseLocation){var t=this.camera;0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset&&(this._updateHitPlane(),t.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(t.inertia),this._zeroIfClose(this._inertialPanning))}},t.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},t.prototype.getSimpleName=function(){return"mousewheel"},t.prototype._updateHitPlane=function(){var t=this.camera,e=t.target.subtract(t.position);this._hitPlane=h.J.FromPositionAndNormal(t.target,e)},t.prototype._getPosition=function(){var t,e=this.camera,i=e.getScene(),o=i.createPickingRay(i.pointerX,i.pointerY,c.y3.Identity(),e,!1),n=0;return this._hitPlane&&(n=null!==(t=o.intersectsPlane(this._hitPlane))&&void 0!==t?t:0),o.origin.addInPlace(o.direction.scaleInPlace(n))},t.prototype._zoomToMouse=function(t){var e,i,o=this.camera,n=1-o.inertia;if(o.lowerRadiusLimit){var r=null!==(e=o.lowerRadiusLimit)&&void 0!==e?e:0;o.radius-(o.inertialRadiusOffset+t)/n<r&&(t=(o.radius-r)*n-o.inertialRadiusOffset)}if(o.upperRadiusLimit){var s=null!==(i=o.upperRadiusLimit)&&void 0!==i?i:0;o.radius-(o.inertialRadiusOffset+t)/n>s&&(t=(o.radius-s)*n-o.inertialRadiusOffset)}var a=t/n/o.radius,h=this._getPosition(),l=c.jp.Vector3[6];h.subtractToRef(o.target,l),l.scaleInPlace(a),l.scaleInPlace(n),this._inertialPanning.addInPlace(l),o.inertialRadiusOffset+=t},t.prototype._zeroIfClose=function(t){Math.abs(t.x)<l.kn&&(t.x=0),Math.abs(t.y)<l.kn&&(t.y=0),Math.abs(t.z)<l.kn&&(t.z=0)},(0,o.gn)([(0,n.qC)()],t.prototype,"wheelPrecision",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"zoomToMouseLocation",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"wheelDeltaPercentage",void 0),t}();r.u.ArcRotateCameraMouseWheelInput=d},75105:(t,e,i)=>{i.d(e,{H:()=>s});var o=i(31191),n=i(96969),r=i(73321),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.buttons=[0,1,2],e.angularSensibilityX=1e3,e.angularSensibilityY=1e3,e.pinchPrecision=12,e.pinchDeltaPercentage=0,e.useNaturalPinchZoom=!1,e.pinchZoom=!0,e.panningSensibility=1e3,e.multiTouchPanning=!0,e.multiTouchPanAndZoom=!0,e.pinchInwards=!0,e._isPanClick=!1,e._twoFingerActivityCount=0,e._isPinching=!1,e}return(0,o.ZT)(e,t),e.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},e.prototype._computeMultiTouchPanning=function(t,e){if(0!==this.panningSensibility&&t&&e){var i=e.x-t.x,o=e.y-t.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=o/this.panningSensibility}},e.prototype._computePinchZoom=function(t,i){var o=this.camera.radius||e.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=o*Math.sqrt(t)/Math.sqrt(i):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(i-t)*o*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(i-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)},e.prototype.onTouch=function(t,e,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-e/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=e/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)},e.prototype.onDoubleTap=function(){this.camera.useInputToRestoreState&&this.camera.restoreState()},e.prototype.onMultiTouch=function(t,e,i,o,n,r){0===i&&null===n||0===o&&null===r||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,o),this._computeMultiTouchPanning(n,r)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(o)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,o),this._isPinching=!0):this._computeMultiTouchPanning(n,r)):this.multiTouchPanning?this._computeMultiTouchPanning(n,r):this.pinchZoom&&this._computePinchZoom(i,o))},e.prototype.onButtonDown=function(t){this._isPanClick=t.button===this.camera._panningMouseButton},e.prototype.onButtonUp=function(){this._twoFingerActivityCount=0,this._isPinching=!1},e.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},e.MinimumRadiusForPinch=.001,(0,o.gn)([(0,n.qC)()],e.prototype,"buttons",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"angularSensibilityX",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"angularSensibilityY",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"pinchPrecision",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"pinchDeltaPercentage",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"useNaturalPinchZoom",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"pinchZoom",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"panningSensibility",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"multiTouchPanning",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"multiTouchPanAndZoom",void 0),e}(i(23592).O);r.u.ArcRotateCameraPointersInput=s},39418:(t,e,i)=>{i.d(e,{V:()=>h});var o=i(73321),n=i(58095),r=i(13514),s=i(93151),a=i(62897);s.a.prototype.addDeviceOrientation=function(){return this._deviceOrientationInput||(this._deviceOrientationInput=new h,this.add(this._deviceOrientationInput)),this};var h=function(){function t(){var t=this;this._screenOrientationAngle=0,this._screenQuaternion=new n._f,this._alpha=0,this._beta=0,this._gamma=0,this._onDeviceOrientationChangedObservable=new a.y$,this._orientationChanged=function(){t._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,t._screenOrientationAngle=-r.w1.ToRadians(t._screenOrientationAngle/2),t._screenQuaternion.copyFromFloats(0,Math.sin(t._screenOrientationAngle),0,Math.cos(t._screenOrientationAngle))},this._deviceOrientation=function(e){t._alpha=null!==e.alpha?e.alpha:0,t._beta=null!==e.beta?e.beta:0,t._gamma=null!==e.gamma?e.gamma:0,null!==e.alpha&&t._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTranform=new n._f(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return t.WaitForOrientationChangeAsync=function(t){return new Promise((function(e,i){var o=!1,n=function(){window.removeEventListener("deviceorientation",n),o=!0,e()};t&&setTimeout((function(){o||(window.removeEventListener("deviceorientation",n),i("WaitForOrientationChangeAsync timed out"))}),t),"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"==t?window.addEventListener("deviceorientation",n):r.w1.Warn("Permission not granted.")})).catch((function(t){r.w1.Error(t)})):window.addEventListener("deviceorientation",n)}))},Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(t){var e=this;this._camera=t,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new n._f),this._camera&&this._camera.onDisposeObservable.add((function(){e._onDeviceOrientationChangedObservable.clear()}))},enumerable:!1,configurable:!0}),t.prototype.attachControl=function(){var t=this,e=this.camera.getScene().getEngine().getHostWindow();if(e){var i=function(){e.addEventListener("orientationchange",t._orientationChanged),e.addEventListener("deviceorientation",t._deviceOrientation),t._orientationChanged()};"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"===t?i():r.w1.Warn("Permission not granted.")})).catch((function(t){r.w1.Error(t)})):i()}},t.prototype.detachControl=function(){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0},t.prototype.checkInputs=function(){this._alpha&&(n._f.RotationYawPitchRollToRef(r.w1.ToRadians(this._alpha),r.w1.ToRadians(this._beta),-r.w1.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},t.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},t.prototype.getSimpleName=function(){return"deviceOrientation"},t}();o.u.FreeCameraDeviceOrientationInput=h},61660:(t,e,i)=>{i.d(e,{c:()=>h});var o=i(31191),n=i(96969),r=i(73321),s=i(58095),a=i(34987),h=function(){function t(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this.deadzoneDelta=.1,this._yAxisScale=1,this._cameraTransform=s.y3.Identity(),this._deltaTransform=s.P.Zero(),this._vector3=s.P.Zero(),this._vector2=s.FM.Zero()}return Object.defineProperty(t.prototype,"invertYAxis",{get:function(){return 1!==this._yAxisScale},set:function(t){this._yAxisScale=t?-1:1},enumerable:!1,configurable:!0}),t.prototype.attachControl=function(){var t=this,e=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add((function(e){e.type!==a.nJ.POSE_ENABLED&&(t.gamepad&&e.type!==a.nJ.XBOX||(t.gamepad=e))})),this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add((function(e){t.gamepad===e&&(t.gamepad=null)})),this.gamepad=e.getGamepadByType(a.nJ.XBOX),!this.gamepad&&e.gamepads.length&&(this.gamepad=e.gamepads[0])},t.prototype.detachControl=function(){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},t.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var t=this.camera,e=this.gamepad.leftStick;0!==this.gamepadMoveSensibility&&(e.x=Math.abs(e.x)>this.deadzoneDelta?e.x/this.gamepadMoveSensibility:0,e.y=Math.abs(e.y)>this.deadzoneDelta?e.y/this.gamepadMoveSensibility:0);var i=this.gamepad.rightStick;i&&0!==this.gamepadAngularSensibility?(i.x=Math.abs(i.x)>this.deadzoneDelta?i.x/this.gamepadAngularSensibility:0,i.y=(Math.abs(i.y)>this.deadzoneDelta?i.y/this.gamepadAngularSensibility:0)*this._yAxisScale):i={x:0,y:0},t.rotationQuaternion?t.rotationQuaternion.toRotationMatrix(this._cameraTransform):s.y3.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,this._cameraTransform);var o=50*t._computeLocalCameraSpeed();this._vector3.copyFromFloats(e.x*o,0,-e.y*o),s.P.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),t.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(i.y,i.x),t.cameraRotation.addInPlace(this._vector2)}},t.prototype.getClassName=function(){return"FreeCameraGamepadInput"},t.prototype.getSimpleName=function(){return"gamepad"},(0,o.gn)([(0,n.qC)()],t.prototype,"gamepadAngularSensibility",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"gamepadMoveSensibility",void 0),t}();r.u.FreeCameraGamepadInput=h},3251:(t,e,i)=>{i.d(e,{Y:()=>c});var o=i(31191),n=i(96969),r=i(73321),s=i(63737),a=i(58095),h=i(13514),c=function(){function t(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this._keys=new Array}return t.prototype.attachControl=function(t){var e=this;t=h.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){e._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(i){var o,n=i.event;n.metaKey||(i.type===s.OG.KEYDOWN?-1===e.keysUp.indexOf(n.keyCode)&&-1===e.keysDown.indexOf(n.keyCode)&&-1===e.keysLeft.indexOf(n.keyCode)&&-1===e.keysRight.indexOf(n.keyCode)&&-1===e.keysUpward.indexOf(n.keyCode)&&-1===e.keysDownward.indexOf(n.keyCode)&&-1===e.keysRotateLeft.indexOf(n.keyCode)&&-1===e.keysRotateRight.indexOf(n.keyCode)||(-1===(o=e._keys.indexOf(n.keyCode))&&e._keys.push(n.keyCode),t||n.preventDefault()):-1===e.keysUp.indexOf(n.keyCode)&&-1===e.keysDown.indexOf(n.keyCode)&&-1===e.keysLeft.indexOf(n.keyCode)&&-1===e.keysRight.indexOf(n.keyCode)&&-1===e.keysUpward.indexOf(n.keyCode)&&-1===e.keysDownward.indexOf(n.keyCode)&&-1===e.keysRotateLeft.indexOf(n.keyCode)&&-1===e.keysRotateRight.indexOf(n.keyCode)||((o=e._keys.indexOf(n.keyCode))>=0&&e._keys.splice(o,1),t||n.preventDefault()))})))},t.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var i=this._keys[e],o=t._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?t._localDirection.copyFromFloats(-o,0,0):-1!==this.keysUp.indexOf(i)?t._localDirection.copyFromFloats(0,0,o):-1!==this.keysRight.indexOf(i)?t._localDirection.copyFromFloats(o,0,0):-1!==this.keysDown.indexOf(i)?t._localDirection.copyFromFloats(0,0,-o):-1!==this.keysUpward.indexOf(i)?t._localDirection.copyFromFloats(0,o,0):-1!==this.keysDownward.indexOf(i)?t._localDirection.copyFromFloats(0,-o,0):-1!==this.keysRotateLeft.indexOf(i)?(t._localDirection.copyFromFloats(0,0,0),t.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)&&(t._localDirection.copyFromFloats(0,0,0),t.cameraRotation.y+=this._getLocalRotation()),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),a.P.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},t.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},t.prototype._onLostFocus=function(){this._keys=[]},t.prototype.getSimpleName=function(){return"keyboard"},t.prototype._getLocalRotation=function(){var t=this.rotationSpeed*this._engine.getDeltaTime()/1e3;return this.camera.getScene().useRightHandedSystem&&(t*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(t*=-1),t},(0,o.gn)([(0,n.qC)()],t.prototype,"keysUp",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"keysUpward",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"keysDown",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"keysDownward",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"keysLeft",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"keysRight",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"rotationSpeed",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"keysRotateLeft",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"keysRotateRight",void 0),t}();r.u.FreeCameraKeyboardMoveInput=c},37026:(t,e,i)=>{i.d(e,{A:()=>c});var o=i(31191),n=i(62897),r=i(96969),s=i(73321),a=i(76324),h=i(13514),c=function(){function t(t){void 0===t&&(t=!0),this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new n.y$,this._allowCameraRotation=!0,this._currentActiveButton=-1}return t.prototype.attachControl=function(t){var e=this;t=h.w1.BackCompatCameraNoPreventDefault(arguments);var i=this.camera.getEngine(),o=i.getInputElement();this._pointerInput||(this._pointerInput=function(n){var r=n.event,s="touch"===r.pointerType;if(!i.isInVRExclusivePointerMode&&(e.touchEnabled||!s)&&(n.type===a.kD.POINTERMOVE||-1!==e.buttons.indexOf(r.button))){var h=r.srcElement||r.target;if(n.type!==a.kD.POINTERDOWN||-1!==e._currentActiveButton&&!s)if(n.type!==a.kD.POINTERUP||e._currentActiveButton!==r.button&&!s){if(n.type===a.kD.POINTERMOVE)if(i.isPointerLock&&e._onMouseMove)e._onMouseMove(n.event);else if(e._previousPosition){var c=r.clientX-e._previousPosition.x,l=r.clientY-e._previousPosition.y;e.camera.getScene().useRightHandedSystem&&(c*=-1),e.camera.parent&&e.camera.parent._getWorldMatrixDeterminant()<0&&(c*=-1),e._allowCameraRotation&&(e.camera.cameraRotation.y+=c/e.angularSensibility,e.camera.cameraRotation.x+=l/e.angularSensibility),e.onPointerMovedObservable.notifyObservers({offsetX:c,offsetY:l}),e._previousPosition={x:r.clientX,y:r.clientY},t||r.preventDefault()}}else{try{null==h||h.releasePointerCapture(r.pointerId)}catch(t){}e._currentActiveButton=-1,e._previousPosition=null,t||r.preventDefault()}else{try{null==h||h.setPointerCapture(r.pointerId)}catch(t){}-1===e._currentActiveButton&&(e._currentActiveButton=r.button),e._previousPosition={x:r.clientX,y:r.clientY},t||(r.preventDefault(),o&&o.focus()),i.isPointerLock&&e._onMouseMove&&e._onMouseMove(n.event)}}}),this._onMouseMove=function(o){if(i.isPointerLock&&!i.isInVRExclusivePointerMode){var n=o.movementX||o.mozMovementX||o.webkitMovementX||o.msMovementX||0;e.camera.getScene().useRightHandedSystem&&(n*=-1),e.camera.parent&&e.camera.parent._getWorldMatrixDeterminant()<0&&(n*=-1),e.camera.cameraRotation.y+=n/e.angularSensibility;var r=o.movementY||o.mozMovementY||o.webkitMovementY||o.msMovementY||0;e.camera.cameraRotation.x+=r/e.angularSensibility,e._previousPosition=null,t||o.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,a.kD.POINTERDOWN|a.kD.POINTERUP|a.kD.POINTERMOVE),o&&(this._contextMenuBind=this.onContextMenu.bind(this),o.addEventListener("contextmenu",this._contextMenuBind,!1))},t.prototype.onContextMenu=function(t){t.preventDefault()},t.prototype.detachControl=function(){if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._contextMenuBind){var t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._currentActiveButton=-1},t.prototype.getClassName=function(){return"FreeCameraMouseInput"},t.prototype.getSimpleName=function(){return"mouse"},(0,o.gn)([(0,r.qC)()],t.prototype,"buttons",void 0),(0,o.gn)([(0,r.qC)()],t.prototype,"angularSensibility",void 0),t}();s.u.FreeCameraMouseInput=c},99106:(t,e,i)=>{i.d(e,{A:()=>l});var o,n=i(31191),r=i(96969),s=i(73321),a=i(23402),h=i(58095),c=i(43048);!function(t){t[t.MoveRelative=0]="MoveRelative",t[t.RotateRelative=1]="RotateRelative",t[t.MoveScene=2]="MoveScene"}(o||(o={}));var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._moveRelative=h.P.Zero(),e._rotateRelative=h.P.Zero(),e._moveScene=h.P.Zero(),e._wheelXAction=o.MoveRelative,e._wheelXActionCoordinate=c.c7.X,e._wheelYAction=o.MoveRelative,e._wheelYActionCoordinate=c.c7.Z,e._wheelZAction=null,e._wheelZActionCoordinate=null,e}return(0,n.ZT)(e,t),e.prototype.getClassName=function(){return"FreeCameraMouseWheelInput"},Object.defineProperty(e.prototype,"wheelXMoveRelative",{get:function(){return this._wheelXAction!==o.MoveRelative?null:this._wheelXActionCoordinate},set:function(t){null===t&&this._wheelXAction!==o.MoveRelative||(this._wheelXAction=o.MoveRelative,this._wheelXActionCoordinate=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wheelYMoveRelative",{get:function(){return this._wheelYAction!==o.MoveRelative?null:this._wheelYActionCoordinate},set:function(t){null===t&&this._wheelYAction!==o.MoveRelative||(this._wheelYAction=o.MoveRelative,this._wheelYActionCoordinate=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wheelZMoveRelative",{get:function(){return this._wheelZAction!==o.MoveRelative?null:this._wheelZActionCoordinate},set:function(t){null===t&&this._wheelZAction!==o.MoveRelative||(this._wheelZAction=o.MoveRelative,this._wheelZActionCoordinate=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wheelXRotateRelative",{get:function(){return this._wheelXAction!==o.RotateRelative?null:this._wheelXActionCoordinate},set:function(t){null===t&&this._wheelXAction!==o.RotateRelative||(this._wheelXAction=o.RotateRelative,this._wheelXActionCoordinate=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wheelYRotateRelative",{get:function(){return this._wheelYAction!==o.RotateRelative?null:this._wheelYActionCoordinate},set:function(t){null===t&&this._wheelYAction!==o.RotateRelative||(this._wheelYAction=o.RotateRelative,this._wheelYActionCoordinate=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wheelZRotateRelative",{get:function(){return this._wheelZAction!==o.RotateRelative?null:this._wheelZActionCoordinate},set:function(t){null===t&&this._wheelZAction!==o.RotateRelative||(this._wheelZAction=o.RotateRelative,this._wheelZActionCoordinate=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wheelXMoveScene",{get:function(){return this._wheelXAction!==o.MoveScene?null:this._wheelXActionCoordinate},set:function(t){null===t&&this._wheelXAction!==o.MoveScene||(this._wheelXAction=o.MoveScene,this._wheelXActionCoordinate=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wheelYMoveScene",{get:function(){return this._wheelYAction!==o.MoveScene?null:this._wheelYActionCoordinate},set:function(t){null===t&&this._wheelYAction!==o.MoveScene||(this._wheelYAction=o.MoveScene,this._wheelYActionCoordinate=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wheelZMoveScene",{get:function(){return this._wheelZAction!==o.MoveScene?null:this._wheelZActionCoordinate},set:function(t){null===t&&this._wheelZAction!==o.MoveScene||(this._wheelZAction=o.MoveScene,this._wheelZActionCoordinate=t)},enumerable:!1,configurable:!0}),e.prototype.checkInputs=function(){if(0!==this._wheelDeltaX||0!==this._wheelDeltaY||0!=this._wheelDeltaZ){this._moveRelative.setAll(0),this._rotateRelative.setAll(0),this._moveScene.setAll(0),this._updateCamera(),this.camera.getScene().useRightHandedSystem&&(this._moveRelative.z*=-1);var e=h.y3.Zero();this.camera.getViewMatrix().invertToRef(e);var i=h.P.Zero();h.P.TransformNormalToRef(this._moveRelative,e,i),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(i),this.camera.cameraDirection.addInPlace(this._moveScene),t.prototype.checkInputs.call(this)}},e.prototype._updateCamera=function(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)},e.prototype._updateCameraProperty=function(t,e,i){if(0!==t&&null!==e&&null!==i){var n=null;switch(e){case o.MoveRelative:n=this._moveRelative;break;case o.RotateRelative:n=this._rotateRelative;break;case o.MoveScene:n=this._moveScene}switch(i){case c.c7.X:n.set(t,0,0);break;case c.c7.Y:n.set(0,t,0);break;case c.c7.Z:n.set(0,0,t)}}},(0,n.gn)([(0,r.qC)()],e.prototype,"wheelXMoveRelative",null),(0,n.gn)([(0,r.qC)()],e.prototype,"wheelYMoveRelative",null),(0,n.gn)([(0,r.qC)()],e.prototype,"wheelZMoveRelative",null),(0,n.gn)([(0,r.qC)()],e.prototype,"wheelXRotateRelative",null),(0,n.gn)([(0,r.qC)()],e.prototype,"wheelYRotateRelative",null),(0,n.gn)([(0,r.qC)()],e.prototype,"wheelZRotateRelative",null),(0,n.gn)([(0,r.qC)()],e.prototype,"wheelXMoveScene",null),(0,n.gn)([(0,r.qC)()],e.prototype,"wheelYMoveScene",null),(0,n.gn)([(0,r.qC)()],e.prototype,"wheelZMoveScene",null),e}(a.Y);s.u.FreeCameraMouseWheelInput=l},86009:(t,e,i)=>{i.d(e,{y:()=>c});var o=i(31191),n=i(96969),r=i(73321),s=i(76324),a=i(58095),h=i(13514),c=function(){function t(t){void 0===t&&(t=!1),this.allowMouse=t,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=h.w1.IsSafari()}return t.prototype.attachControl=function(t){var e=this;t=h.w1.BackCompatCameraNoPreventDefault(arguments);var i=null;if(void 0===this._pointerInput&&(this._onLostFocus=function(){e._offsetX=null,e._offsetY=null},this._pointerInput=function(o){var n=o.event,r="mouse"===n.pointerType||e._isSafari&&void 0===n.pointerType;if(e.allowMouse||!r)if(o.type===s.kD.POINTERDOWN){if(t||n.preventDefault(),e._pointerPressed.push(n.pointerId),1!==e._pointerPressed.length)return;i={x:n.clientX,y:n.clientY}}else if(o.type===s.kD.POINTERUP){if(t||n.preventDefault(),-1===(a=e._pointerPressed.indexOf(n.pointerId)))return;if(e._pointerPressed.splice(a,1),0!=a)return;i=null,e._offsetX=null,e._offsetY=null}else if(o.type===s.kD.POINTERMOVE){if(t||n.preventDefault(),!i)return;var a;if(0!=(a=e._pointerPressed.indexOf(n.pointerId)))return;e._offsetX=n.clientX-i.x,e._offsetY=-(n.clientY-i.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,s.kD.POINTERDOWN|s.kD.POINTERUP|s.kD.POINTERMOVE),this._onLostFocus){var o=this.camera.getEngine(),n=o.getInputElement();n&&n.addEventListener("blur",this._onLostFocus)}},t.prototype.detachControl=function(){if(this._pointerInput){if(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus){var t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed=[],this._offsetX=null,this._offsetY=null}},t.prototype.checkInputs=function(){if(null!==this._offsetX&&null!==this._offsetY&&(0!==this._offsetX||0!==this._offsetY)){var t=this.camera;if(t.cameraRotation.y=this._offsetX/this.touchAngularSensibility,this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)t.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{var e=t._computeLocalCameraSpeed(),i=new a.P(0,0,0!==this.touchMoveSensibility?e*this._offsetY/this.touchMoveSensibility:0);a.y3.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(a.P.TransformCoordinates(i,t._cameraRotationMatrix))}}},t.prototype.getClassName=function(){return"FreeCameraTouchInput"},t.prototype.getSimpleName=function(){return"touch"},(0,o.gn)([(0,n.qC)()],t.prototype,"touchAngularSensibility",void 0),(0,o.gn)([(0,n.qC)()],t.prototype,"touchMoveSensibility",void 0),t}();r.u.FreeCameraTouchInput=c},28044:(t,e,i)=>{i.d(e,{S:()=>c});var o=i(58095),n=i(16325),r=i(43792),s=i(372),a=i(84318),h=i(66513);function c(t,e){var i=e.vrCameraMetrics||s.X.GetDefault();t._rigCameras[0]._cameraRigParams.vrMetrics=i,t._rigCameras[0].viewport=new h.l(0,0,.5,1),t._rigCameras[0]._cameraRigParams.vrWorkMatrix=new o.y3,t._rigCameras[0]._cameraRigParams.vrHMatrix=i.leftHMatrix,t._rigCameras[0]._cameraRigParams.vrPreViewMatrix=i.leftPreViewMatrix,t._rigCameras[0].getProjectionMatrix=t._rigCameras[0]._getVRProjectionMatrix,t._rigCameras[1]._cameraRigParams.vrMetrics=i,t._rigCameras[1].viewport=new h.l(.5,0,.5,1),t._rigCameras[1]._cameraRigParams.vrWorkMatrix=new o.y3,t._rigCameras[1]._cameraRigParams.vrHMatrix=i.rightHMatrix,t._rigCameras[1]._cameraRigParams.vrPreViewMatrix=i.rightPreViewMatrix,t._rigCameras[1].getProjectionMatrix=t._rigCameras[1]._getVRProjectionMatrix,i.multiviewEnabled&&(t.getScene().getEngine().getCaps().multiview?(t._useMultiviewToSingleView=!0,t._rigPostProcess=new r.E("VRMultiviewToSingleview",t,i.postProcessScaleFactor)):(a.Y.Warn("Multiview is not supported, falling back to standard rendering"),i.multiviewEnabled=!1)),i.compensateDistortion&&(t._rigCameras[0]._rigPostProcess=new n.T("VR_Distort_Compensation_Left",t._rigCameras[0],!1,i),t._rigCameras[1]._rigPostProcess=new n.T("VR_Distort_Compensation_Right",t._rigCameras[1],!0,i))}},51345:(t,e,i)=>{i.d(e,{j:()=>r});var o=i(58095),n=i(66513);function r(t,e){if(e.vrDisplay){var i=e.vrDisplay.getEyeParameters("left"),r=e.vrDisplay.getEyeParameters("right");t._rigCameras[0].viewport=new n.l(0,0,.5,1),t._rigCameras[0].setCameraRigParameter("left",!0),t._rigCameras[0].setCameraRigParameter("specs",e.specs),t._rigCameras[0].setCameraRigParameter("eyeParameters",i),t._rigCameras[0].setCameraRigParameter("frameData",e.frameData),t._rigCameras[0].setCameraRigParameter("parentCamera",e.parentCamera),t._rigCameras[0]._cameraRigParams.vrWorkMatrix=new o.y3,t._rigCameras[0].getProjectionMatrix=t._getWebVRProjectionMatrix,t._rigCameras[0].parent=t,t._rigCameras[0]._getViewMatrix=t._getWebVRViewMatrix,t._rigCameras[1].viewport=new n.l(.5,0,.5,1),t._rigCameras[1].setCameraRigParameter("eyeParameters",r),t._rigCameras[1].setCameraRigParameter("specs",e.specs),t._rigCameras[1].setCameraRigParameter("frameData",e.frameData),t._rigCameras[1].setCameraRigParameter("parentCamera",e.parentCamera),t._rigCameras[1]._cameraRigParams.vrWorkMatrix=new o.y3,t._rigCameras[1].getProjectionMatrix=t._getWebVRProjectionMatrix,t._rigCameras[1].parent=t,t._rigCameras[1]._getViewMatrix=t._getWebVRViewMatrix}}},372:(t,e,i)=>{i.d(e,{X:()=>n});var o=i(58095),n=function(){function t(){this.compensateDistortion=!0,this.multiviewEnabled=!1}return Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return o.y3.Translation(t,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return o.y3.Translation(-t,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftPreViewMatrix",{get:function(){return o.y3.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightPreViewMatrix",{get:function(){return o.y3.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!1,configurable:!0}),t.GetDefault=function(){var e=new t;return e.hResolution=1280,e.vResolution=800,e.hScreenSize=.149759993,e.vScreenSize=.0935999975,e.vScreenCenter=.0467999987,e.eyeToScreenDistance=.0410000011,e.lensSeparationDistance=.063500002,e.interpupillaryDistance=.064000003,e.distortionK=[1,.219999999,.239999995,0],e.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],e.postProcessScaleFactor=1.714605507808412,e.lensCenterOffset=.151976421,e},t}()},62091:(t,e,i)=>{i.d(e,{i:()=>l});var o=i(31191),n=i(2055),r=i(39821),s=i(372),a=i(58095),h=i(17834),c=i(28044);h.N.AddNodeConstructor("VRDeviceOrientationFreeCamera",(function(t,e){return function(){return new l(t,a.P.Zero(),e)}}));var l=function(t){function e(e,i,o,r,a){void 0===r&&(r=!0),void 0===a&&(a=s.X.GetDefault());var h=t.call(this,e,i,o)||this;return h._setRigMode=c.S.bind(null,h),a.compensateDistortion=r,h.setCameraRigMode(n.V.RIG_MODE_VR,{vrCameraMetrics:a}),h}return(0,o.ZT)(e,t),e.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},e}(r.n)},12110:(t,e,i)=>{i.d(e,{F:()=>L,N:()=>F});var o=i(31191),n=i(84318),r=i(62897),s=i(78098),a=i(86121),h=i(39821),c=i(62091),l=i(58705),u=i(76324),p=i(58095),d=i(15631),_=i(34987),f=i(94557),m=i(97338),g=i(76576),y=i(91243),v=i(1316),b=i(90622),C=i(3085),R=i(93980),P=i(90216),T=i(88916),M=i(18770),x=i(372),O=(i(93197),i(83534),i(43048)),w=i(97654),k=i(9022),S=i(62845),D=i(49353),A=i(41525),I=function(){function t(e,i){if(void 0===i&&(i=null),this.scene=e,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=t._IdCounter++,i)this._gazeTracker=i.clone("gazeTracker");else{this._gazeTracker=(0,D.eu)("gazeTracker",{diameter:.0035,thickness:.0025,tessellation:20,updatable:!1},e),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var o=new C.K("targetMat",e);o.specularColor=d.Wo.Black(),o.emissiveColor=new d.Wo(.7,.7,.7),o.backFaceCulling=!1,this._gazeTracker.material=o}}return t.prototype._getForwardRay=function(t){return new v.z(p.P.Zero(),new p.P(0,0,t))},t.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},t.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},t.prototype._activatePointer=function(){this._activePointer=!0},t.prototype._deactivatePointer=function(){this._activePointer=!1},t.prototype._updatePointerDistance=function(t){void 0===t&&(t=100)},t.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},t._IdCounter=0,t}(),E=function(t){function e(e,i,o){var n=t.call(this,i,o)||this;n.webVRController=e,n._laserPointer=(0,S.wf)("laserPointer",{updatable:!1,height:1,diameterTop:.004,diameterBottom:2e-4,tessellation:20,subdivisions:1},i);var r=new C.K("laserPointerMat",i);if(r.emissiveColor=new d.Wo(.7,.7,.7),r.alpha=.6,n._laserPointer.material=r,n._laserPointer.rotation.x=Math.PI/2,n._laserPointer.position.z=-.5,n._laserPointer.isVisible=!1,n._laserPointer.isPickable=!1,!e.mesh){var s=new y.Kj("preloadControllerMesh",i),a=new y.Kj(f.K4.POINTING_POSE,i);a.rotation.x=-.7,s.addChild(a),e.attachToMesh(s)}return n._setLaserPointerParent(e.mesh),n._meshAttachedObserver=e._meshAttachedObservable.add((function(t){n._setLaserPointerParent(t)})),n}return(0,o.ZT)(e,t),e.prototype._getForwardRay=function(t){return this.webVRController.getForwardRay(t)},e.prototype._activatePointer=function(){t.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},e.prototype._deactivatePointer=function(){t.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},e.prototype._setLaserPointerColor=function(t){this._laserPointer.material.emissiveColor=t},e.prototype._setLaserPointerLightingDisabled=function(t){this._laserPointer.material.disableLighting=t},e.prototype._setLaserPointerParent=function(t){var e=function(t){t.isPickable=!1,t.getChildMeshes().forEach((function(t){e(t)}))};e(t);var i=t.getChildren(void 0,!1),o=t;this.webVRController._pointingPoseNode=null;for(var n=0;n<i.length;n++)if(i[n].name&&i[n].name.indexOf(f.K4.POINTING_POSE)>=0){o=i[n],this.webVRController._pointingPoseNode=o;break}this._laserPointer.parent=o},e.prototype._updatePointerDistance=function(t){void 0===t&&(t=100),this._laserPointer.scaling.y=t,this._laserPointer.position.z=-t/2},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},e}(I),V=function(t){function e(e,i){var o=t.call(this,i)||this;return o._getCamera=e,o}return(0,o.ZT)(e,t),e.prototype._getForwardRay=function(t){var e=this._getCamera();return e?e.getForwardRay(t):new v.z(p.P.Zero(),p.P.Forward())},e}(I),F=function(){},L=function(){function t(e,i){void 0===i&&(i={});var o=this;if(this.webVROptions=i,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.enableGazeEvenWhenNoPointerLock=!1,this.exitVROnDoubleTap=!0,this.onEnteringVRObservable=new r.y$,this.onAfterEnteringVRObservable=new r.y$,this.onExitingVRObservable=new r.y$,this.onControllerMeshLoadedObservable=new r.y$,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._teleportationMode=t.TELEPORTATIONMODE_CONSTANTTIME,this._teleportationTime=122,this._teleportationSpeed=20,this._rotationAllowed=!0,this._teleportBackwardsVector=new p.P(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new p.P(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this._gazeColor=new d.Wo(.7,.7,.7),this._laserColor=new d.Wo(.7,.7,.7),this._pickedLaserColor=new d.Wo(.2,.2,1),this._pickedGazeColor=new d.Wo(0,0,1),this.onNewMeshSelected=new r.y$,this.onMeshSelectedWithController=new r.y$,this.onNewMeshPicked=new r.y$,this.onBeforeCameraTeleport=new r.y$,this.onAfterCameraTeleport=new r.y$,this.onSelectedMeshUnselected=new r.y$,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.updateControllerLaserColor=!0,this.requestPointerLockOnFullScreen=!0,this.xrTestDone=!1,this._onResize=function(){o._moveButtonToBottomRight(),o._fullscreenVRpresenting&&o._webVRready&&o.exitVR()},this._onFullscreenChange=function(){var t=document;void 0!==t.fullscreen?o._fullscreenVRpresenting=document.fullscreen:void 0!==t.mozFullScreen?o._fullscreenVRpresenting=t.mozFullScreen:void 0!==t.webkitIsFullScreen?o._fullscreenVRpresenting=t.webkitIsFullScreen:void 0!==t.msIsFullScreen?o._fullscreenVRpresenting=t.msIsFullScreen:void 0!==document.msFullscreenElement&&(o._fullscreenVRpresenting=document.msFullscreenElement),!o._fullscreenVRpresenting&&o._inputElement&&(o.exitVR(),!o._useCustomVRButton&&o._btnVR&&(o._btnVR.style.top=o._inputElement.offsetTop+o._inputElement.offsetHeight-70+"px",o._btnVR.style.left=o._inputElement.offsetLeft+o._inputElement.offsetWidth-100+"px",o._updateButtonVisibility()))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this._beforeRender=function(){o._leftController&&o._leftController._activePointer&&o._castRayAndSelectObject(o._leftController),o._rightController&&o._rightController._activePointer&&o._castRayAndSelectObject(o._rightController),o._noControllerIsActive&&(o._scene.getEngine().isPointerLock||o.enableGazeEvenWhenNoPointerLock)?o._castRayAndSelectObject(o._cameraGazer):o._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(t){if(t.type!==_.nJ.POSE_ENABLED)t.leftStick&&t.onleftstickchanged((function(t){o._teleportationInitialized&&o.teleportationEnabled&&(!o._leftController&&!o._rightController||o._leftController&&!o._leftController._activePointer&&o._rightController&&!o._rightController._activePointer)&&(o._checkTeleportWithRay(t,o._cameraGazer),o._checkTeleportBackwards(t,o._cameraGazer))})),t.rightStick&&t.onrightstickchanged((function(t){o._teleportationInitialized&&o._checkRotate(t,o._cameraGazer)})),t.type===_.nJ.XBOX&&(t.onbuttondown((function(t){o._interactionsEnabled&&t===g.nR.A&&o._cameraGazer._selectionPointerDown()})),t.onbuttonup((function(t){o._interactionsEnabled&&t===g.nR.A&&o._cameraGazer._selectionPointerUp()})));else{var e=t,i=new E(e,o._scene,o._cameraGazer._gazeTracker);"right"===e.hand||o._leftController&&o._leftController.webVRController!=e?o._rightController=i:o._leftController=i,o._tryEnableInteractionOnController(i)}},this._tryEnableInteractionOnController=function(t){o._interactionsRequested&&!t._interactionsEnabled&&o._enableInteractionOnController(t),o._teleportationRequested&&!t._teleportationEnabled&&o._enableTeleportationOnController(t)},this._onNewGamepadDisconnected=function(t){t instanceof m.T&&("left"===t.hand&&null!=o._leftController&&(o._leftController.dispose(),o._leftController=null),"right"===t.hand&&null!=o._rightController&&(o._rightController.dispose(),o._rightController=null))},this._workingVector=p.P.Zero(),this._workingQuaternion=p._f.Identity(),this._workingMatrix=p.y3.Identity(),n.Y.Warn("WebVR is deprecated. Please avoid using this experience helper and use the WebXR experience helper instead"),this._scene=e,this._inputElement=e.getEngine().getInputElement(),"getVRDisplays"in navigator||void 0!==i.useXR||(i.useXR=!0),void 0===i.createFallbackVRDeviceOrientationFreeCamera&&(i.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===i.createDeviceOrientationCamera&&(i.createDeviceOrientationCamera=!0),void 0===i.laserToggle&&(i.laserToggle=!0),void 0===i.defaultHeight&&(i.defaultHeight=1.7),i.useCustomVRButton&&(this._useCustomVRButton=!0,i.customVRButton&&(this._btnVR=i.customVRButton)),i.rayLength&&(this._rayLength=i.rayLength),this._defaultHeight=i.defaultHeight,i.positionScale&&(this._rayLength*=i.positionScale,this._defaultHeight*=i.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new p.P(0,this._defaultHeight,0),i.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new h.n("deviceOrientationVRHelper",this._position.clone(),e),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof a.C&&this._scene.activeCamera.rotation)){var s=this._scene.activeCamera;s.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(s.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(p._f.RotationYawPitchRoll(s.rotation.y,s.rotation.x,s.rotation.z)),this._deviceOrientationCamera.rotation=s.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._inputElement&&this._scene.activeCamera.attachControl()}else this._existingCamera=this._scene.activeCamera;this.webVROptions.useXR&&navigator.xr?w.g.IsSessionSupportedAsync("immersive-vr").then((function(t){t?(n.Y.Log("Using WebXR. It is recommended to use the WebXRDefaultExperience directly"),e.createDefaultXRExperienceAsync({floorMeshes:i.floorMeshes||[]}).then((function(t){o.xr=t,o.xrTestDone=!0,o._cameraGazer=new V((function(){return o.xr.baseExperience.camera}),e),o.xr.baseExperience.onStateChangedObservable.add((function(t){switch(t){case k.k.ENTERING_XR:o.onEnteringVRObservable.notifyObservers(o),o._interactionsEnabled||o.xr.pointerSelection.detach(),o.xr.pointerSelection.displayLaserPointer=o._displayLaserPointer;break;case k.k.EXITING_XR:o.onExitingVRObservable.notifyObservers(o),o._scene.getEngine().resize();break;case k.k.IN_XR:o._hasEnteredVR=!0;break;case k.k.NOT_IN_XR:o._hasEnteredVR=!1}}))}))):o._completeVRInit(e,i)})):this._completeVRInit(e,i)}return Object.defineProperty(t.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(t){t&&(t.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(t){t&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=t,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(t){this._displayGaze=t,t||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(t){this._displayLaserPointer=t,t?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vrButton",{get:function(){return this._btnVR},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_teleportationRequestInitiated",{get:function(){return this._cameraGazer._teleportationRequestInitiated||null!==this._leftController&&this._leftController._teleportationRequestInitiated||null!==this._rightController&&this._rightController._teleportationRequestInitiated},enumerable:!1,configurable:!0}),t.prototype._completeVRInit=function(t,e){var i=this;if(this.xrTestDone=!0,e.createFallbackVRDeviceOrientationFreeCamera&&(e.useMultiview&&(e.vrDeviceOrientationCameraMetrics||(e.vrDeviceOrientationCameraMetrics=x.X.GetDefault()),e.vrDeviceOrientationCameraMetrics.multiviewEnabled=!0),this._vrDeviceOrientationCamera=new c.i("VRDeviceOrientationVRHelper",this._position,this._scene,!0,e.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._webVRCamera=new l.$("WebVRHelper",this._position,this._scene,e),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new V((function(){return i.currentVRCamera}),t),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var o=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A":"https://cdn.babylonjs.com/Assets/vrButton.png")+"); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";o+=".babylonVRicon.vrdisplaypresenting { display: none; }";var n=document.createElement("style");n.appendChild(document.createTextNode(o)),document.getElementsByTagName("head")[0].appendChild(n),this._moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",(function(){i.isInVRMode?i._scene.getEngine().disableVR():i.enterVR()}));var r=this._scene.getEngine().getHostWindow();r&&(r.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,e.createFallbackVRDeviceOrientationFreeCamera?this._displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add((function(t){t.vrDisplay&&i._displayVRButton()})),this._onKeyDown=function(t){27===t.keyCode&&i.isInVRMode&&i.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add((function(){i._hasEnteredVR&&i.exitVROnDoubleTap&&(i.exitVR(),i._fullscreenVRpresenting&&i._scene.getEngine().exitFullscreen())}),u.kD.POINTERDOUBLETAP,!1),this._onVRDisplayChangedBind=function(t){return i._onVRDisplayChanged(t)},this._onVrDisplayPresentChangeBind=function(){return i._onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){i._webVRrequesting=!0,i._updateButtonVisibility()},this._onVRRequestPresentComplete=function(){i._webVRrequesting=!1,i._updateButtonVisibility()},t.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChangedBind),t.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),t.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),r.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChangeBind),t.onDisposeObservable.add((function(){i.dispose()})),this._webVRCamera.onControllerMeshLoadedObservable.add((function(t){return i._onDefaultMeshLoaded(t)})),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this._updateButtonVisibility(),this._circleEase=new T.qP,this._circleEase.setEasingMode(T.Kp.EASINGMODE_EASEINOUT),this._teleportationEasing=this._circleEase,t.onPointerObservable.add((function(e){i._interactionsEnabled&&t.activeCamera===i.vrDeviceOrientationCamera&&"mouse"===e.event.pointerType&&(e.type===u.kD.POINTERDOWN?i._cameraGazer._selectionPointerDown():e.type===u.kD.POINTERUP&&i._cameraGazer._selectionPointerUp())})),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes}))},t.prototype._onDefaultMeshLoaded=function(t){this._leftController&&this._leftController.webVRController==t&&t.mesh&&this._leftController._setLaserPointerParent(t.mesh),this._rightController&&this._rightController.webVRController==t&&t.mesh&&this._rightController._setLaserPointerParent(t.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(t)}catch(t){n.Y.Warn("Error in your custom logic onControllerMeshLoaded: "+t)}},Object.defineProperty(t.prototype,"isInVRMode",{get:function(){return this.xr&&this.webVROptions.useXR&&this.xr.baseExperience.state===k.k.IN_XR||this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!1,configurable:!0}),t.prototype._onVrDisplayPresentChange=function(){var t=this._scene.getEngine().getVRDevice();if(t){var e=this._webVRpresenting;this._webVRpresenting=t.isPresenting,e&&!this._webVRpresenting&&this.exitVR()}else n.Y.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this._updateButtonVisibility()},t.prototype._onVRDisplayChanged=function(t){this._webVRsupported=t.vrSupported,this._webVRready=!!t.vrDisplay,this._webVRpresenting=t.vrDisplay&&t.vrDisplay.isPresenting,this._updateButtonVisibility()},t.prototype._moveButtonToBottomRight=function(){if(this._inputElement&&!this._useCustomVRButton&&this._btnVR){var t=this._inputElement.getBoundingClientRect();this._btnVR.style.top=t.top+t.height-70+"px",this._btnVR.style.left=t.left+t.width-100+"px"}},t.prototype._displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||!this._btnVR||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},t.prototype._updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},t.prototype.enterVR=function(){var t=this;if(this.xr)this.xr.baseExperience.enterXRAsync("immersive-vr","local-floor",this.xr.renderTarget);else{if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(t){n.Y.Warn("Error in your custom logic onEnteringVR: "+t)}if(this._scene.activeCamera){if(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=p._f.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2e3),this.webVRCamera){var e=this.webVRCamera.deviceRotationQuaternion.toEulerAngles().y,i=p._f.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles().y-e,o=this.webVRCamera.rotationQuaternion.toEulerAngles().y;this.webVRCamera.rotationQuaternion=p._f.FromEulerAngles(0,o+i,0)}this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)}this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._scene.getEngine().onVRRequestPresentComplete.addOnce((function(e){t.onAfterEnteringVRObservable.notifyObservers({success:e})})),this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this._updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce((function(){t.onAfterEnteringVRObservable.notifyObservers({success:!0})}))),this._scene.activeCamera&&this._inputElement&&this._scene.activeCamera.attachControl(),this._interactionsEnabled&&this._scene.registerBeforeRender(this._beforeRender),this._displayLaserPointer&&[this._leftController,this._rightController].forEach((function(t){t&&t._activatePointer()})),this._hasEnteredVR=!0)}},t.prototype.exitVR=function(){if(this.xr)this.xr.baseExperience.exitXRAsync();else if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(t){n.Y.Warn("Error in your custom logic onExitingVR: "+t)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._inputElement&&this._scene.activeCamera.attachControl(),this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this._updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this._beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),[this._leftController,this._rightController].forEach((function(t){t&&t._deactivatePointer()})),this._hasEnteredVR=!1;var t=this._scene.getEngine();t._onVrDisplayPresentChange&&t._onVrDisplayPresentChange()}},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._scene.activeCamera&&(this._scene.activeCamera.position=t)},enumerable:!1,configurable:!0}),t.prototype.enableInteractions=function(){var t=this;if(!this._interactionsEnabled){if(this._interactionsRequested=!0,this.xr)return void(this.xr.baseExperience.state===k.k.IN_XR&&this.xr.pointerSelection.attach());this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(e){return e.isVisible&&(e.isPickable||e.name===t._floorMeshName)},this.meshSelectionPredicate=function(){return!0},this._raySelectionPredicate=function(e){return!!(t._isTeleportationFloor(e)||-1===e.name.indexOf("gazeTracker")&&-1===e.name.indexOf("teleportationTarget")&&-1===e.name.indexOf("torusTeleportation"))&&t.raySelectionPredicate(e)},this._interactionsEnabled=!0}},Object.defineProperty(t.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer||this._rightController&&this._rightController._activePointer)},enumerable:!1,configurable:!0}),t.prototype._isTeleportationFloor=function(t){for(var e=0;e<this._floorMeshesCollection.length;e++)if(this._floorMeshesCollection[e].id===t.id)return!0;return!(!this._floorMeshName||t.name!==this._floorMeshName)},t.prototype.addFloorMesh=function(t){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(t)>-1||this._floorMeshesCollection.push(t))},t.prototype.removeFloorMesh=function(t){if(this._floorMeshesCollection){var e=this._floorMeshesCollection.indexOf(t);-1!==e&&this._floorMeshesCollection.splice(e,1)}},t.prototype.enableTeleportation=function(t){var e=this;if(void 0===t&&(t={}),!this._teleportationInitialized){if(this._teleportationRequested=!0,this.enableInteractions(),this.webVROptions.useXR&&(t.floorMeshes||t.floorMeshName)){var i=t.floorMeshes||[];if(!i.length){var o=this._scene.getMeshByName(t.floorMeshName);o&&i.push(o)}if(this.xr)return i.forEach((function(t){e.xr.teleportation.addFloorMesh(t)})),void(this.xr.teleportation.attached||this.xr.teleportation.attach());if(!this.xrTestDone){var n=function(){e.xrTestDone&&(e._scene.unregisterBeforeRender(n),e.xr?e.xr.teleportation.attached||e.xr.teleportation.attach():e.enableTeleportation(t))};return void this._scene.registerBeforeRender(n)}}t.floorMeshName&&(this._floorMeshName=t.floorMeshName),t.floorMeshes&&(this._floorMeshesCollection=t.floorMeshes),t.teleportationMode&&(this._teleportationMode=t.teleportationMode),t.teleportationTime&&t.teleportationTime>0&&(this._teleportationTime=t.teleportationTime),t.teleportationSpeed&&t.teleportationSpeed>0&&(this._teleportationSpeed=t.teleportationSpeed),void 0!==t.easingFunction&&(this._teleportationEasing=t.easingFunction),null!=this._leftController&&this._enableTeleportationOnController(this._leftController),null!=this._rightController&&this._enableTeleportationOnController(this._rightController);var r=new b.$;r.vignetteColor=new d.HE(0,0,0,0),r.vignetteEnabled=!0,this._postProcessMove=new P.z("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,r),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},t.prototype._enableInteractionOnController=function(t){var e=this;t.webVRController.mesh&&(t._interactionsEnabled=!0,this.isInVRMode&&this._displayLaserPointer&&t._activatePointer(),this.webVROptions.laserToggle&&t.webVRController.onMainButtonStateChangedObservable.add((function(i){e._displayLaserPointer&&1===i.value&&(t._activePointer?t._deactivatePointer():t._activatePointer(),e.displayGaze&&(t._gazeTracker.isVisible=t._activePointer))})),t.webVRController.onTriggerStateChangedObservable.add((function(i){var o=t;e._noControllerIsActive&&(o=e._cameraGazer),o._pointerDownOnMeshAsked?i.value<e._padSensibilityDown&&o._selectionPointerUp():i.value>e._padSensibilityUp&&o._selectionPointerDown()})))},t.prototype._checkTeleportWithRay=function(t,e){this._teleportationRequestInitiated&&!e._teleportationRequestInitiated||(e._teleportationRequestInitiated?Math.sqrt(t.y*t.y+t.x*t.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),e._teleportationRequestInitiated=!1):t.y<-this._padSensibilityUp&&e._dpadPressed&&(e._activatePointer(),e._teleportationRequestInitiated=!0))},t.prototype._checkRotate=function(t,e){e._teleportationRequestInitiated||(e._rotationLeftAsked?t.x>-this._padSensibilityDown&&(e._rotationLeftAsked=!1):t.x<-this._padSensibilityUp&&e._dpadPressed&&(e._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),e._rotationRightAsked?t.x<this._padSensibilityDown&&(e._rotationRightAsked=!1):t.x>this._padSensibilityUp&&e._dpadPressed&&(e._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},t.prototype._checkTeleportBackwards=function(t,e){if(!e._teleportationRequestInitiated)if(t.y>this._padSensibilityUp&&e._dpadPressed){if(!e._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var i=p._f.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),o=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(i=this.currentVRCamera.deviceRotationQuaternion,o=this.currentVRCamera.devicePosition),i.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,p._f.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),p.P.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var n=new v.z(o,this._workingVector),r=this._scene.pickWithRay(n,this._raySelectionPredicate);r&&r.pickedPoint&&r.pickedMesh&&this._isTeleportationFloor(r.pickedMesh)&&r.distance<5&&this.teleportCamera(r.pickedPoint),e._teleportationBackRequestInitiated=!0}}else e._teleportationBackRequestInitiated=!1},t.prototype._enableTeleportationOnController=function(t){var e=this;t.webVRController.mesh&&(t._interactionsEnabled||this._enableInteractionOnController(t),t._interactionsEnabled=!0,t._teleportationEnabled=!0,t.webVRController.controllerType===f.wc.VIVE&&(t._dpadPressed=!1,t.webVRController.onPadStateChangedObservable.add((function(e){t._dpadPressed=e.pressed,t._dpadPressed||(t._rotationLeftAsked=!1,t._rotationRightAsked=!1,t._teleportationBackRequestInitiated=!1)}))),t.webVRController.onPadValuesChangedObservable.add((function(i){e.teleportationEnabled&&(e._checkTeleportBackwards(i,t),e._checkTeleportWithRay(i,t)),e._checkRotate(i,t)})))},t.prototype._createTeleportationCircles=function(){this._teleportationTarget=(0,A.$6)("teleportationTarget",{width:2,height:2,subdivisions:2},this._scene),this._teleportationTarget.isPickable=!1;var t=new R.c("DynamicTexture",512,this._scene,!0);t.hasAlpha=!0;var e=t.getContext();e.beginPath(),e.arc(256,256,200,0,2*Math.PI,!1),e.fillStyle=this._teleportationFillColor,e.fill(),e.lineWidth=10,e.strokeStyle=this._teleportationBorderColor,e.stroke(),e.closePath(),t.update();var i=new C.K("TextPlaneMaterial",this._scene);i.diffuseTexture=t,this._teleportationTarget.material=i;var o=(0,D.eu)("torusTeleportation",{diameter:.75,thickness:.1,tessellation:25,updatable:!1},this._scene);o.isPickable=!1,o.parent=this._teleportationTarget;var n=new M.f("animationInnerCircle","position.y",30,M.f.ANIMATIONTYPE_FLOAT,M.f.ANIMATIONLOOPMODE_CYCLE),r=[];r.push({frame:0,value:0}),r.push({frame:30,value:.4}),r.push({frame:60,value:0}),n.setKeys(r);var s=new T.bi;s.setEasingMode(T.Kp.EASINGMODE_EASEINOUT),n.setEasingFunction(s),o.animations=[],o.animations.push(n),this._scene.beginAnimation(o,0,60,!0),this._hideTeleportationTarget()},t.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},t.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},t.prototype._rotateCamera=function(t){var e=this;if(this.currentVRCamera instanceof s.c){t?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var i=p._f.FromRotationMatrix(p.y3.RotationY(Math.PI/4*this._rotationAngle)),o=new M.f("animationRotation","rotationQuaternion",90,M.f.ANIMATIONTYPE_QUATERNION,M.f.ANIMATIONLOOPMODE_CONSTANT),n=[];n.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),n.push({frame:6,value:i}),o.setKeys(n),o.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(o),this._postProcessMove.animations=[];var r=new M.f("animationPP","vignetteWeight",90,M.f.ANIMATIONTYPE_FLOAT,M.f.ANIMATIONLOOPMODE_CONSTANT),a=[];a.push({frame:0,value:0}),a.push({frame:3,value:4}),a.push({frame:6,value:0}),r.setKeys(a),r.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(r);var h=new M.f("animationPP2","vignetteStretch",90,M.f.ANIMATIONTYPE_FLOAT,M.f.ANIMATIONLOOPMODE_CONSTANT),c=[];c.push({frame:0,value:0}),c.push({frame:3,value:10}),c.push({frame:6,value:0}),h.setKeys(c),h.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(h),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,(function(){e._webVRCamera.detachPostProcess(e._postProcessMove)})),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},t.prototype._moveTeleportationSelectorTo=function(t,e,i){if(t.pickedPoint){e._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(t.pickedPoint),this._teleportationTarget.position.copyFrom(t.pickedPoint));var o=this._convertNormalToDirectionOfRay(t.getNormal(!0,!1),i);if(o){var n=p.P.Cross(O.RD.Y,o),r=p.P.Cross(o,n);p.P.RotationFromAxisToRef(r,o,n,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},t.prototype.teleportCamera=function(e){var i=this;if(this.currentVRCamera instanceof s.c){this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),e.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(e),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector);var o,n;if(this._teleportationMode==t.TELEPORTATIONMODE_CONSTANTSPEED){n=90;var r=p.P.Distance(this.currentVRCamera.position,this._workingVector);o=this._teleportationSpeed/r}else n=Math.round(90*this._teleportationTime/1e3),o=1;this.currentVRCamera.animations=[];var a=new M.f("animationCameraTeleportation","position",90,M.f.ANIMATIONTYPE_VECTOR3,M.f.ANIMATIONLOOPMODE_CONSTANT),h=[{frame:0,value:this.currentVRCamera.position},{frame:n,value:this._workingVector}];a.setKeys(h),a.setEasingFunction(this._teleportationEasing),this.currentVRCamera.animations.push(a),this._postProcessMove.animations=[];var c=Math.round(n/2),l=new M.f("animationPP","vignetteWeight",90,M.f.ANIMATIONTYPE_FLOAT,M.f.ANIMATIONLOOPMODE_CONSTANT),u=[];u.push({frame:0,value:0}),u.push({frame:c,value:8}),u.push({frame:n,value:0}),l.setKeys(u),this._postProcessMove.animations.push(l);var d=new M.f("animationPP2","vignetteStretch",90,M.f.ANIMATIONTYPE_FLOAT,M.f.ANIMATIONLOOPMODE_CONSTANT),_=[];_.push({frame:0,value:0}),_.push({frame:c,value:10}),_.push({frame:n,value:0}),d.setKeys(_),this._postProcessMove.animations.push(d),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,n,!1,o,(function(){i._webVRCamera.detachPostProcess(i._postProcessMove)})),this._scene.beginAnimation(this.currentVRCamera,0,n,!1,o,(function(){i.onAfterCameraTeleport.notifyObservers(i._workingVector)})),this._hideTeleportationTarget()}},t.prototype._convertNormalToDirectionOfRay=function(t,e){t&&(Math.acos(p.P.Dot(t,e.direction))<Math.PI/2&&t.scaleInPlace(-1));return t},t.prototype._castRayAndSelectObject=function(t){if(this.currentVRCamera instanceof s.c){var e=t._getForwardRay(this._rayLength),i=this._scene.pickWithRay(e,this._raySelectionPredicate);if(i&&this._scene.simulatePointerMove(i,{pointerId:t._id}),t._currentHit=i,i&&i.pickedPoint){if(this._displayGaze){var o=1;t._gazeTracker.isVisible=!0,t._isActionableMesh&&(o=3),this.updateGazeTrackerScale&&(t._gazeTracker.scaling.x=i.distance*o,t._gazeTracker.scaling.y=i.distance*o,t._gazeTracker.scaling.z=i.distance*o);var r=this._convertNormalToDirectionOfRay(i.getNormal(),e),a=.002;if(r){var h=p.P.Cross(O.RD.Y,r),c=p.P.Cross(r,h);p.P.RotationFromAxisToRef(c,r,h,t._gazeTracker.rotation)}t._gazeTracker.position.copyFrom(i.pickedPoint),t._gazeTracker.position.x<0?t._gazeTracker.position.x+=a:t._gazeTracker.position.x-=a,t._gazeTracker.position.y<0?t._gazeTracker.position.y+=a:t._gazeTracker.position.y-=a,t._gazeTracker.position.z<0?t._gazeTracker.position.z+=a:t._gazeTracker.position.z-=a}t._updatePointerDistance(i.distance)}else t._updatePointerDistance(),t._gazeTracker.isVisible=!1;if(i&&i.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(i.pickedMesh)&&i.pickedPoint)return t._currentMeshSelected&&!this._isTeleportationFloor(t._currentMeshSelected)&&this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,void(t._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(i,t,e));if(i.pickedMesh!==t._currentMeshSelected)if(this.meshSelectionPredicate(i.pickedMesh)){this.onNewMeshPicked.notifyObservers(i),t._currentMeshSelected=i.pickedMesh,i.pickedMesh.isPickable&&i.pickedMesh.actionManager?(this.changeGazeColor(this._pickedGazeColor),this.changeLaserColor(this._pickedLaserColor),t._isActionableMesh=!0):(this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor),t._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(i.pickedMesh);var l=t;l.webVRController&&this.onMeshSelectedWithController.notifyObservers({mesh:i.pickedMesh,controller:l.webVRController})}catch(t){n.Y.Warn("Error while raising onNewMeshSelected or onMeshSelectedWithController: "+t)}}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}else this._notifySelectedMeshUnselected(t._currentMeshSelected),t._currentMeshSelected=null,this.changeGazeColor(this._gazeColor),this.changeLaserColor(this._laserColor)}},t.prototype._notifySelectedMeshUnselected=function(t){t&&this.onSelectedMeshUnselected.notifyObservers(t)},t.prototype.setLaserColor=function(t,e){void 0===e&&(e=this._pickedLaserColor),this._laserColor=t,this._pickedLaserColor=e},t.prototype.setLaserLightingState=function(t){void 0===t&&(t=!0),this._leftController&&this._leftController._setLaserPointerLightingDisabled(!t),this._rightController&&this._rightController._setLaserPointerLightingDisabled(!t)},t.prototype.setGazeColor=function(t,e){void 0===e&&(e=this._pickedGazeColor),this._gazeColor=t,this._pickedGazeColor=e},t.prototype.changeLaserColor=function(t){this.updateControllerLaserColor&&(this._leftController&&this._leftController._setLaserPointerColor(t),this._rightController&&this._rightController._setLaserPointerColor(t))},t.prototype.changeGazeColor=function(t){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=t,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=t),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=t))},t.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this.xr&&this.xr.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChangeBind),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChangedBind),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this._beforeRender)},t.prototype.getClassName=function(){return"VRExperienceHelper"},t.TELEPORTATIONMODE_CONSTANTTIME=0,t.TELEPORTATIONMODE_CONSTANTSPEED=1,t}()},58705:(t,e,i)=>{i.d(e,{$:()=>m});var o=i(31191),n=i(62897),r=i(78098),s=i(2055),a=i(58095),h=i(34987),c=i(94557),l=i(17834),u=i(51356),p=i(84318),d=i(43792),_=i(13514),f=i(51345);i(99986);l.N.AddNodeConstructor("WebVRFreeCamera",(function(t,e){return function(){return new m(t,a.P.Zero(),e)}})),l.N.AddNodeConstructor("WebVRGamepadCamera",(function(t,e){return function(){return new m(t,a.P.Zero(),e)}}));var m=function(t){function e(e,i,o,r){void 0===r&&(r={});var h=t.call(this,e,i,o)||this;h._webVROptions=r,h._vrDevice=null,h.rawPose=null,h._specsVersion="1.1",h._attached=!1,h._descendants=[],h._deviceRoomPosition=a.P.Zero(),h._deviceRoomRotationQuaternion=a._f.Identity(),h._standingMatrix=null,h.devicePosition=a.P.Zero(),h.deviceRotationQuaternion=a._f.Identity(),h.deviceScaleFactor=1,h._deviceToWorld=a.y3.Identity(),h._worldToDevice=a.y3.Identity(),h.controllers=[],h.onControllersAttachedObservable=new n.y$,h.onControllerMeshLoadedObservable=new n.y$,h.onPoseUpdatedFromDeviceObservable=new n.y$,h._poseSet=!1,h.rigParenting=!0,h._defaultHeight=void 0,h._setRigMode=f.j.bind(null,h),h._detachIfAttached=function(){var t=h.getEngine().getVRDevice();t&&!t.isPresenting&&h.detachControl()},h._workingVector=a.P.Zero(),h._oneVector=a.P.One(),h._workingMatrix=a.y3.Identity(),h._tmpMatrix=new a.y3,h._cache.position=a.P.Zero(),r.defaultHeight&&(h._defaultHeight=r.defaultHeight,h.position.y=h._defaultHeight),h.minZ=.1,5===arguments.length&&(h._webVROptions=arguments[4]),null==h._webVROptions.trackPosition&&(h._webVROptions.trackPosition=!0),null==h._webVROptions.controllerMeshes&&(h._webVROptions.controllerMeshes=!0),null==h._webVROptions.defaultLightingOnControllers&&(h._webVROptions.defaultLightingOnControllers=!0),h.rotationQuaternion=new a._f,h._webVROptions&&h._webVROptions.positionScale&&(h.deviceScaleFactor=h._webVROptions.positionScale);var c=h.getEngine();return h._onVREnabled=function(t){t&&h.initControllers()},c.onVRRequestPresentComplete.add(h._onVREnabled),c.initWebVR().add((function(t){t.vrDisplay&&h._vrDevice!==t.vrDisplay&&(h._vrDevice=t.vrDisplay,h.setCameraRigMode(s.V.RIG_MODE_WEBVR,{parentCamera:h,vrDisplay:h._vrDevice,frameData:h._frameData,specs:h._specsVersion}),h._attached&&h.getEngine().enableVR(h._webVROptions))})),"undefined"!=typeof VRFrameData&&(h._frameData=new VRFrameData),r.useMultiview&&(h.getScene().getEngine().getCaps().multiview?(h._useMultiviewToSingleView=!0,h._rigPostProcess=new d.E("VRMultiviewToSingleview",h,1)):(p.Y.Warn("Multiview is not supported, falling back to standard rendering"),h._useMultiviewToSingleView=!1)),h.getScene().onBeforeCameraRenderObservable.add((function(t){t.parent===h&&h.rigParenting&&(h._descendants=h.getDescendants(!0,(function(t){var e=h.controllers.some((function(e){return e._mesh===t})),i=-1!==h._rigCameras.indexOf(t);return!e&&!i})),h._descendants.forEach((function(e){e.parent=t})))})),h.getScene().onAfterCameraRenderObservable.add((function(t){t.parent===h&&h.rigParenting&&h._descendants.forEach((function(t){t.parent=h}))})),h}return(0,o.ZT)(e,t),e.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},e.prototype.useStandingMatrix=function(t){var e=this;void 0===t&&(t=function(t){}),this.getEngine().initWebVRAsync().then((function(i){i.vrDisplay&&i.vrDisplay.stageParameters&&i.vrDisplay.stageParameters.sittingToStandingTransform&&e._webVROptions.trackPosition?(e._standingMatrix=new a.y3,a.y3.FromFloat32ArrayToRefScaled(i.vrDisplay.stageParameters.sittingToStandingTransform,0,1,e._standingMatrix),e.getScene().useRightHandedSystem||e._standingMatrix&&e._standingMatrix.toggleModelMatrixHandInPlace(),t(!0)):t(!1)}))},e.prototype.useStandingMatrixAsync=function(){var t=this;return new Promise((function(e){t.useStandingMatrix((function(t){e(t)}))}))},e.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),t.prototype.dispose.call(this)},e.prototype.getControllerByName=function(t){for(var e=0,i=this.controllers;e<i.length;e++){var o=i[e];if(o.hand===t)return o}return null},Object.defineProperty(e.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!1,configurable:!0}),e.prototype.getForwardRay=function(e){return void 0===e&&(e=100),this.leftCamera?t.prototype.getForwardRay.call(this,e,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):t.prototype.getForwardRay.call(this,e)},e.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),t.prototype._checkInputs.call(this)},e.prototype.updateFromDevice=function(t){t&&t.orientation&&4===t.orientation.length&&(this.rawPose=t,this._deviceRoomRotationQuaternion.copyFromFloats(t.orientation[0],t.orientation[1],-t.orientation[2],-t.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this._webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},e.prototype.attachControl=function(e){e=_.w1.BackCompatCameraNoPreventDefault(arguments),t.prototype.attachControl.call(this,e),this._attached=!0,e=!s.V.ForceAttachControlToAlwaysPreventDefault&&e,this._vrDevice&&this.getEngine().enableVR(this._webVROptions);var i=this._scene.getEngine().getHostWindow();i&&i.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},e.prototype.detachControl=function(){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),t.prototype.detachControl.call(this),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},e.prototype.getClassName=function(){return"WebVRFreeCamera"},e.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},e.prototype._updateRigCameras=function(){var t=this._rigCameras[0],e=this._rigCameras[1];t.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),t.position.copyFrom(this._deviceRoomPosition),e.position.copyFrom(this._deviceRoomPosition)},e.prototype._correctPositionIfNotTrackPosition=function(t,e){void 0===e&&(e=!1),this.rawPose&&this.rawPose.position&&!this._webVROptions.trackPosition&&(a.y3.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),e||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(t,t))},e.prototype._updateCache=function(e){var i=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this._updateCacheCalled||(this._updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),a.P.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),a.y3.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach((function(t){t._deviceToWorld.copyFrom(i._deviceToWorld),i._correctPositionIfNotTrackPosition(t._deviceToWorld),t.update()}))),e||t.prototype._updateCache.call(this),this._updateCacheCalled=!1},e.prototype._computeDevicePosition=function(){a.P.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},e.prototype.update=function(){this._computeDevicePosition(),a.y3.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),a._f.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),t.prototype.update.call(this)},e.prototype._getViewMatrix=function(){return a.y3.Identity()},e.prototype._getWebVRViewMatrix=function(){var t=this._cameraRigParams.parentCamera;t._updateCache();var e=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return a.y3.FromArrayToRef(e,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||this._webvrViewMatrix.toggleModelMatrixHandInPlace(),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),a.P.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),1!==t.deviceScaleFactor&&(this._webvrViewMatrix.invert(),t.deviceScaleFactor&&(this._webvrViewMatrix.multiplyAtIndex(12,t.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(13,t.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(14,t.deviceScaleFactor)),this._webvrViewMatrix.invert()),t._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),t._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||a.y3.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(t.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},e.prototype._getWebVRProjectionMatrix=function(){var t=this.parent;t._vrDevice.depthNear=t.minZ,t._vrDevice.depthFar=t.maxZ;var e=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return a.y3.FromArrayToRef(e,0,this._projectionMatrix),this.getScene().useRightHandedSystem||this._projectionMatrix.toggleProjectionMatrixHandInPlace(),this._projectionMatrix},e.prototype.initControllers=function(){var t=this;this.controllers=[];var e=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=e.onGamepadDisconnectedObservable.add((function(e){if(e.type===h.nJ.POSE_ENABLED){var i=e;i.defaultModel&&i.defaultModel.setEnabled(!1),"right"===i.hand&&(t._rightController=null),"left"===i.hand&&(t._leftController=null);var o=t.controllers.indexOf(i);-1!==o&&t.controllers.splice(o,1)}})),this._onGamepadConnectedObserver=e.onGamepadConnectedObservable.add((function(e){if(e.type===h.nJ.POSE_ENABLED){var i=e;if(t._webVROptions.trackPosition||(i._disableTrackPosition(new a.P("left"==i.hand?-.15:.15,-.5,.25)),t._updateCacheWhenTrackingDisabledObserver||(t._updateCacheWhenTrackingDisabledObserver=t._scene.onBeforeRenderObservable.add((function(){t._updateCache()})))),i.deviceScaleFactor=t.deviceScaleFactor,i._deviceToWorld.copyFrom(t._deviceToWorld),t._correctPositionIfNotTrackPosition(i._deviceToWorld),t._webVROptions.controllerMeshes&&(i.defaultModel?i.defaultModel.setEnabled(!0):i.initControllerMesh(t.getScene(),(function(e){if(e.scaling.scaleInPlace(t.deviceScaleFactor),t.onControllerMeshLoadedObservable.notifyObservers(i),t._webVROptions.defaultLightingOnControllers){t._lightOnControllers||(t._lightOnControllers=new u.e("vrControllersLight",new a.P(0,1,0),t.getScene()));var o=function(t,e){var i=t.getChildren();i&&0!==i.length&&i.forEach((function(t){e.includedOnlyMeshes.push(t),o(t,e)}))};t._lightOnControllers.includedOnlyMeshes.push(e),o(e,t._lightOnControllers)}}))),i.attachToPoseControlledCamera(t),-1===t.controllers.indexOf(i)){t.controllers.push(i);for(var o=!1,n=0;n<t.controllers.length;n++)t.controllers[n].controllerType===c.wc.VIVE&&(o?t.controllers[n].hand="right":(o=!0,t.controllers[n].hand="left"));t.controllers.length>=2&&t.onControllersAttachedObservable.notifyObservers(t.controllers)}}}))},e}(r.c)},78443:(t,e,i)=>{i.d(e,{Y:()=>g});var o=i(31191),n=i(96969),r=i(62897),s=i(58095),a=i(17834),h=i(91243),c=i(93008),l=i(97391),u=i(81989),p=i(2055),d=i(86121),_=i(50532),f=i(48154),m=i(13514);a.N.AddNodeConstructor("ArcRotateCamera",(function(t,e){return function(){return new g(t,0,0,1,s.P.Zero(),e)}}));var g=function(t){function e(e,i,o,n,a,h,c){void 0===c&&(c=!0);var l=t.call(this,e,s.P.Zero(),h,c)||this;return l.inertialAlphaOffset=0,l.inertialBetaOffset=0,l.inertialRadiusOffset=0,l.lowerAlphaLimit=null,l.upperAlphaLimit=null,l.lowerBetaLimit=.01,l.upperBetaLimit=Math.PI-.01,l.lowerRadiusLimit=null,l.upperRadiusLimit=null,l.inertialPanningX=0,l.inertialPanningY=0,l.pinchToPanMaxDistance=20,l.panningDistanceLimit=null,l.panningOriginTarget=s.P.Zero(),l.panningInertia=.9,l.zoomOnFactor=1,l.targetScreenOffset=s.FM.Zero(),l.allowUpsideDown=!0,l.useInputToRestoreState=!0,l._viewMatrix=new s.y3,l.panningAxis=new s.P(1,1,0),l._transformedDirection=new s.P,l.mapPanning=!1,l.onMeshTargetChangedObservable=new r.y$,l.checkCollisions=!1,l.collisionRadius=new s.P(.5,.5,.5),l._previousPosition=s.P.Zero(),l._collisionVelocity=s.P.Zero(),l._newPosition=s.P.Zero(),l._computationVector=s.P.Zero(),l._onCollisionPositionChange=function(t,e,i){void 0===i&&(i=null),i?(l.setPosition(e),l.onCollide&&l.onCollide(i)):l._previousPosition.copyFrom(l._position);var o=Math.cos(l.alpha),n=Math.sin(l.alpha),r=Math.cos(l.beta),s=Math.sin(l.beta);0===s&&(s=1e-4);var a=l._getTargetPosition();l._computationVector.copyFromFloats(l.radius*o*s,l.radius*r,l.radius*n*s),a.addToRef(l._computationVector,l._newPosition),l._position.copyFrom(l._newPosition);var h=l.upVector;l.allowUpsideDown&&l.beta<0&&(h=(h=h.clone()).negate()),l._computeViewMatrix(l._position,a,h),l._viewMatrix.addAtIndex(12,l.targetScreenOffset.x),l._viewMatrix.addAtIndex(13,l.targetScreenOffset.y),l._collisionTriggered=!1},l._target=s.P.Zero(),a&&l.setTarget(a),l.alpha=i,l.beta=o,l.radius=n,l.getViewMatrix(),l.inputs=new _.$(l),l.inputs.addKeyboard().addMouseWheel().addPointers(),l}return(0,o.ZT)(e,t),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this.setTarget(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"targetHost",{get:function(){return this._targetHost},set:function(t){t&&this.setTarget(t)},enumerable:!1,configurable:!0}),e.prototype.getTarget=function(){return this.target},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this.setPosition(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"upVector",{get:function(){return this._upVector},set:function(t){this._upToYMatrix||(this._yToUpMatrix=new s.y3,this._upToYMatrix=new s.y3,this._upVector=s.P.Zero()),t.normalize(),this._upVector.copyFrom(t),this.setMatUp()},enumerable:!1,configurable:!0}),e.prototype.setMatUp=function(){s.y3.RotationAlignToRef(s.P.UpReadOnly,this._upVector,this._yToUpMatrix),s.y3.RotationAlignToRef(this._upVector,s.P.UpReadOnly,this._upToYMatrix)},Object.defineProperty(e.prototype,"angularSensibilityX",{get:function(){var t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.angularSensibilityX=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angularSensibilityY",{get:function(){var t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.angularSensibilityY=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pinchPrecision",{get:function(){var t=this.inputs.attached.pointers;return t?t.pinchPrecision:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.pinchPrecision=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pinchDeltaPercentage",{get:function(){var t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.pinchDeltaPercentage=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useNaturalPinchZoom",{get:function(){var t=this.inputs.attached.pointers;return!!t&&t.useNaturalPinchZoom},set:function(t){var e=this.inputs.attached.pointers;e&&(e.useNaturalPinchZoom=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"panningSensibility",{get:function(){var t=this.inputs.attached.pointers;return t?t.panningSensibility:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.panningSensibility=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysUp",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysUp:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysUp=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysDown",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysDown:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysDown=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysLeft",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysLeft:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysRight",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysRight:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysRight=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wheelPrecision",{get:function(){var t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0},set:function(t){var e=this.inputs.attached.mousewheel;e&&(e.wheelPrecision=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoomToMouseLocation",{get:function(){var t=this.inputs.attached.mousewheel;return!!t&&t.zoomToMouseLocation},set:function(t){var e=this.inputs.attached.mousewheel;e&&(e.zoomToMouseLocation=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wheelDeltaPercentage",{get:function(){var t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0},set:function(t){var e=this.inputs.attached.mousewheel;e&&(e.wheelDeltaPercentage=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new l.r,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new u.d,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new c.o,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!1,configurable:!0}),e.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache._target=new s.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=s.FM.Zero()},e.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},e.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var t=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(t)}var e=this._getLockedTargetPosition();return e||this._target},e.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),t.prototype.storeState.call(this)},e.prototype._restoreStateValues=function(){return!!t.prototype._restoreStateValues.call(this)&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},e.prototype._isSynchronizedViewMatrix=function(){return!!t.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},e.prototype.attachControl=function(t,e,i,o){var n=this;void 0===i&&(i=!0),void 0===o&&(o=2);var r=arguments;e=m.w1.BackCompatCameraNoPreventDefault(r),this._useCtrlForPanning=i,this._panningMouseButton=o,"boolean"==typeof r[0]&&(r.length>1&&(this._useCtrlForPanning=r[1]),r.length>2&&(this._panningMouseButton=r[2])),this.inputs.attachElement(e),this._reset=function(){n.inertialAlphaOffset=0,n.inertialBetaOffset=0,n.inertialRadiusOffset=0,n.inertialPanningX=0,n.inertialPanningY=0}},e.prototype.detachControl=function(){this.inputs.detachElement(),this._reset&&this._reset()},e.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var e=this.inertialAlphaOffset;this.beta<=0&&(e*=-1),this.getScene().useRightHandedSystem&&(e*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this.alpha+=e,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<f.kn&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<f.kn&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*f.kn&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){var i=new s.P(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),i.multiplyInPlace(this.panningAxis),s.P.TransformNormalToRef(i,this._cameraTransformMatrix,this._transformedDirection),!this.mapPanning&&this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),s.P.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*f.kn&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*f.kn&&(this.inertialPanningY=0)}this._checkLimits(),t.prototype._checkInputs.call(this)}},e.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},e.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||s.P.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);var t=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var e=Math.round((t-this.alpha)/(2*Math.PI));this.alpha+=2*e*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},e.prototype.setPosition=function(t){this._position.equals(t)||(this._position.copyFrom(t),this.rebuildAnglesAndRadius())},e.prototype.setTarget=function(t,e,i,o){var n;if(void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===o&&(o=!1),o=null!==(n=this.overrideCloneAlphaBetaRadius)&&void 0!==n?n:o,t.getBoundingInfo)this._targetBoundingCenter=e?t.getBoundingInfo().boundingBox.centerWorld.clone():null,t.computeWorldMatrix(),this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var r=t,s=this._getTargetPosition();if(s&&!i&&s.equals(r))return;this._targetHost=null,this._target=r,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}o||this.rebuildAnglesAndRadius()},e.prototype._getViewMatrix=function(){var t=Math.cos(this.alpha),e=Math.sin(this.alpha),i=Math.cos(this.beta),o=Math.sin(this.beta);0===o&&(o=1e-4),0===this.radius&&(this.radius=1e-4);var n=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*t*o,this.radius*i,this.radius*e*o),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||s.P.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),n.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var r=this.getScene().collisionCoordinator;this._collider||(this._collider=r.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,r.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var a=this.upVector;this.allowUpsideDown&&o<0&&(a=a.negate()),this._computeViewMatrix(this._position,n,a),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=n,this._viewMatrix},e.prototype.zoomOn=function(t,e){void 0===e&&(e=!1),t=t||this.getScene().meshes;var i=h.Kj.MinMax(t),o=s.P.Distance(i.min,i.max);this.radius=o*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:o},e)},e.prototype.focusOn=function(t,e){var i,o;if(void 0===e&&(e=!1),void 0===t.min){var n=t||this.getScene().meshes;i=h.Kj.MinMax(n),o=s.P.Distance(i.min,i.max)}else{i=t,o=t.distance}this._target=h.Kj.Center(i),e||(this.maxZ=2*o)},e.prototype.createRigCamera=function(t,i){var o=0;switch(this.cameraRigMode){case p.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case p.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case p.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case p.V.RIG_MODE_STEREOSCOPIC_INTERLACED:case p.V.RIG_MODE_VR:o=this._cameraRigParams.stereoHalfAngle*(0===i?1:-1);break;case p.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:o=this._cameraRigParams.stereoHalfAngle*(0===i?-1:1)}var n=new e(t,this.alpha+o,this.beta,this.radius,this._target,this.getScene());return n._cameraRigParams={},n.isRigCamera=!0,n.rigParent=this,n.upVector=this.upVector,n},e.prototype._updateRigCameras=function(){var e=this._rigCameras[0],i=this._rigCameras[1];switch(e.beta=i.beta=this.beta,this.cameraRigMode){case p.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case p.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case p.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case p.V.RIG_MODE_STEREOSCOPIC_INTERLACED:case p.V.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case p.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}t.prototype._updateRigCameras.call(this)},e.prototype.dispose=function(){this.inputs.clear(),t.prototype.dispose.call(this)},e.prototype.getClassName=function(){return"ArcRotateCamera"},(0,o.gn)([(0,n.qC)()],e.prototype,"alpha",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"beta",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"radius",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,o.gn)([(0,n.hd)("target")],e.prototype,"_target",void 0),(0,o.gn)([(0,n.RR)("targetHost")],e.prototype,"_targetHost",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"inertialAlphaOffset",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"inertialBetaOffset",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"inertialRadiusOffset",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"lowerAlphaLimit",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"upperAlphaLimit",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"lowerBetaLimit",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"upperBetaLimit",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"lowerRadiusLimit",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"upperRadiusLimit",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"inertialPanningX",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"inertialPanningY",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"pinchToPanMaxDistance",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"panningDistanceLimit",void 0),(0,o.gn)([(0,n.hd)()],e.prototype,"panningOriginTarget",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"panningInertia",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"zoomToMouseLocation",null),(0,o.gn)([(0,n.qC)()],e.prototype,"zoomOnFactor",void 0),(0,o.gn)([(0,n.QC)()],e.prototype,"targetScreenOffset",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"allowUpsideDown",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"useInputToRestoreState",void 0),e}(d.C)},50532:(t,e,i)=>{i.d(e,{$:()=>a});var o=i(31191),n=i(75105),r=i(34286),s=i(20462),a=function(t){function e(e){return t.call(this,e)||this}return(0,o.ZT)(e,t),e.prototype.addMouseWheel=function(){return this.add(new s.F),this},e.prototype.addPointers=function(){return this.add(new n.H),this},e.prototype.addKeyboard=function(){return this.add(new r.v),this},e}(i(73321).p)},2055:(t,e,i)=>{i.d(e,{V:()=>f});var o=i(31191),n=i(96969),r=i(7788),s=i(13514),a=i(62897),h=i(58095),c=i(17834),l=i(84318),u=i(48620),p=i(77851),d=i(66513),_=i(84319),f=function(t){function e(i,o,n,s){void 0===s&&(s=!0);var c=t.call(this,i,n)||this;return c._position=h.P.Zero(),c._upVector=h.P.Up(),c.orthoLeft=null,c.orthoRight=null,c.orthoBottom=null,c.orthoTop=null,c.fov=.8,c.projectionPlaneTilt=0,c.minZ=1,c.maxZ=1e4,c.inertia=.9,c.mode=e.PERSPECTIVE_CAMERA,c.isIntermediate=!1,c.viewport=new d.l(0,0,1,1),c.layerMask=268435455,c.fovMode=e.FOVMODE_VERTICAL_FIXED,c.cameraRigMode=e.RIG_MODE_NONE,c.customRenderTargets=new Array,c.outputRenderTarget=null,c.onViewMatrixChangedObservable=new a.y$,c.onProjectionMatrixChangedObservable=new a.y$,c.onAfterCheckInputsObservable=new a.y$,c.onRestoreStateObservable=new a.y$,c.isRigCamera=!1,c._rigCameras=new Array,c._webvrViewMatrix=h.y3.Identity(),c._skipRendering=!1,c._projectionMatrix=new h.y3,c._postProcesses=new Array,c._activeMeshes=new r.t(256),c._globalPosition=h.P.Zero(),c._computedViewMatrix=h.y3.Identity(),c._doNotComputeProjectionMatrix=!1,c._transformMatrix=h.y3.Zero(),c._refreshFrustumPlanes=!0,c._absoluteRotation=h._f.Identity(),c._isCamera=!0,c._isLeftCamera=!1,c._isRightCamera=!1,c.getScene().addCamera(c),s&&!c.getScene().activeCamera&&(c.getScene().activeCamera=c),c.position=o,c.renderPassId=c.getScene().getEngine().createRenderPassId("Camera ".concat(i)),c}return(0,o.ZT)(e,t),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"upVector",{get:function(){return this._upVector},set:function(t){this._upVector=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenArea",{get:function(){var t,i,o,n,r=0,s=0;if(this.mode===e.PERSPECTIVE_CAMERA)this.fovMode===e.FOVMODE_VERTICAL_FIXED?(s=2*this.minZ*Math.tan(this.fov/2),r=this.getEngine().getAspectRatio(this)*s):s=(r=2*this.minZ*Math.tan(this.fov/2))/this.getEngine().getAspectRatio(this);else{var a=this.getEngine().getRenderWidth()/2,h=this.getEngine().getRenderHeight()/2;r=(null!==(t=this.orthoRight)&&void 0!==t?t:a)-(null!==(i=this.orthoLeft)&&void 0!==i?i:-a),s=(null!==(o=this.orthoTop)&&void 0!==o?o:h)-(null!==(n=this.orthoBottom)&&void 0!==n?n:-h)}return r*s},enumerable:!1,configurable:!0}),e.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},e.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},e.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},e.prototype.getClassName=function(){return"Camera"},e.prototype.toString=function(t){var e="Name: "+this.name;if(e+=", type: "+this.getClassName(),this.animations)for(var i=0;i<this.animations.length;i++)e+=", animation[0]: "+this.animations[i].toString(t);return e},e.prototype.applyVerticalCorrection=function(){var t=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-t.x:t.x},Object.defineProperty(e.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!1,configurable:!0}),e.prototype.getActiveMeshes=function(){return this._activeMeshes},e.prototype.isActiveMesh=function(t){return-1!==this._activeMeshes.indexOf(t)},e.prototype.isReady=function(e){if(void 0===e&&(e=!1),e)for(var i=0,o=this._postProcesses;i<o.length;i++){var n=o[i];if(n&&!n.isReady())return!1}return t.prototype.isReady.call(this,e)},e.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.position=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new h.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},e.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},e.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},e.prototype._isSynchronizedViewMatrix=function(){return!!t.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},e.prototype._isSynchronizedProjectionMatrix=function(){var t=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!t)return!1;var i=this.getEngine();return t=this.mode===e.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===i.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===i.getRenderWidth()&&this._cache.renderHeight===i.getRenderHeight()},e.prototype.attachControl=function(t,e){},e.prototype.detachControl=function(t){},e.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==e.RIG_MODE_NONE&&this._updateRigCameras()},e.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(e.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!1,configurable:!0}),e.prototype._getFirstPostProcess=function(){for(var t=0;t<this._postProcesses.length;t++)if(null!==this._postProcesses[t])return this._postProcesses[t];return null},e.prototype._cascadePostProcessesToRigCams=function(){var t=this._getFirstPostProcess();t&&t.markTextureDirty();for(var e=0,i=this._rigCameras.length;e<i;e++){var o=this._rigCameras[e],n=o._rigPostProcess;if(n)"pass"===n.getEffectName()&&(o.isIntermediate=0===this._postProcesses.length),o._postProcesses=this._postProcesses.slice(0).concat(n),n.markTextureDirty();else o._postProcesses=this._postProcesses.slice(0)}},e.prototype.attachPostProcess=function(t,e){return void 0===e&&(e=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1?(l.Y.Error("You're trying to reuse a post process not defined as reusable."),0):(null==e||e<0?this._postProcesses.push(t):null===this._postProcesses[e]?this._postProcesses[e]=t:this._postProcesses.splice(e,0,t),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(t))},e.prototype.detachPostProcess=function(t){var e=this._postProcesses.indexOf(t);-1!==e&&(this._postProcesses[e]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()},e.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix},e.prototype._getViewMatrix=function(){return h.y3.Identity()},e.prototype.getViewMatrix=function(t){return!t&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix},e.prototype.freezeProjectionMatrix=function(t){this._doNotComputeProjectionMatrix=!0,void 0!==t&&(this._projectionMatrix=t)},e.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},e.prototype.getProjectionMatrix=function(t){var i,o,n,r,s,a,c,l;if(this._doNotComputeProjectionMatrix||!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var u=this.getEngine(),p=this.getScene();if(this.mode===e.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=u.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1);var d=u.useReverseDepthBuffer;(p.useRightHandedSystem?h.y3.PerspectiveFovRHToRef:h.y3.PerspectiveFovLHToRef)(this.fov,u.getAspectRatio(this),d?this.maxZ:this.minZ,d?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===e.FOVMODE_VERTICAL_FIXED,u.isNDCHalfZRange,this.projectionPlaneTilt,u.useReverseDepthBuffer)}else{var _=u.getRenderWidth()/2,f=u.getRenderHeight()/2;p.useRightHandedSystem?h.y3.OrthoOffCenterRHToRef(null!==(i=this.orthoLeft)&&void 0!==i?i:-_,null!==(o=this.orthoRight)&&void 0!==o?o:_,null!==(n=this.orthoBottom)&&void 0!==n?n:-f,null!==(r=this.orthoTop)&&void 0!==r?r:f,this.minZ,this.maxZ,this._projectionMatrix,u.isNDCHalfZRange):h.y3.OrthoOffCenterLHToRef(null!==(s=this.orthoLeft)&&void 0!==s?s:-_,null!==(a=this.orthoRight)&&void 0!==a?a:_,null!==(c=this.orthoBottom)&&void 0!==c?c:-f,null!==(l=this.orthoTop)&&void 0!==l?l:f,this.minZ,this.maxZ,this._projectionMatrix,u.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=u.getRenderWidth(),this._cache.renderHeight=u.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},e.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},e.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?_.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=_.i.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},e.prototype.isInFrustum=function(t,e){if(void 0===e&&(e=!1),this._updateFrustumPlanes(),e&&this.rigCameras.length>0){var i=!1;return this.rigCameras.forEach((function(e){e._updateFrustumPlanes(),i=i||t.isInFrustum(e._frustumPlanes)})),i}return t.isInFrustum(this._frustumPlanes)},e.prototype.isCompletelyInFrustum=function(t){return this._updateFrustumPlanes(),t.isCompletelyInFrustum(this._frustumPlanes)},e.prototype.getForwardRay=function(t,e,i){throw void 0===t&&(t=100),(0,p.S)("Ray")},e.prototype.getForwardRayToRef=function(t,e,i,o){throw void 0===e&&(e=100),(0,p.S)("Ray")},e.prototype.dispose=function(i,o){for(void 0===o&&(o=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this._parentContainer){var r=this._parentContainer.cameras.indexOf(this);r>-1&&this._parentContainer.cameras.splice(r,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==e.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var s=this._postProcesses.length;--s>=0;){var a=this._postProcesses[s];a&&a.dispose(this)}for(var h=this.customRenderTargets.length;--h>=0;)this.customRenderTargets[h].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),t.prototype.dispose.call(this,i,o)},Object.defineProperty(e.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!1,configurable:!0}),e.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},e.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},e.prototype.setCameraRigMode=function(t,i){if(this.cameraRigMode!==t){for(;this._rigCameras.length>0;){var o=this._rigCameras.pop();o&&o.dispose()}if(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=i.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=s.w1.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==e.RIG_MODE_NONE){var n=this.createRigCamera(this.name+"_L",0);n&&(n._isLeftCamera=!0);var r=this.createRigCamera(this.name+"_R",1);r&&(r._isRightCamera=!0),n&&r&&(this._rigCameras.push(n),this._rigCameras.push(r))}this._setRigMode(i),this._cascadePostProcessesToRigCams(),this.update()}},e.prototype._setRigMode=function(t){},e.prototype._getVRProjectionMatrix=function(){return h.y3.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},e.prototype._updateCameraRotationMatrix=function(){},e.prototype._updateWebVRCameraRotationMatrix=function(){},e.prototype._getWebVRProjectionMatrix=function(){return h.y3.Identity()},e.prototype._getWebVRViewMatrix=function(){return h.y3.Identity()},e.prototype.setCameraRigParameter=function(t,e){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[t]=e,"interaxialDistance"===t&&(this._cameraRigParams.stereoHalfAngle=s.w1.ToRadians(e/.0637))},e.prototype.createRigCamera=function(t,e){return null},e.prototype._updateRigCameras=function(){for(var t=0;t<this._rigCameras.length;t++)this._rigCameras[t].minZ=this.minZ,this._rigCameras[t].maxZ=this.maxZ,this._rigCameras[t].fov=this.fov,this._rigCameras[t].upVector.copyFrom(this.upVector);this.cameraRigMode===e.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},e.prototype._setupInputs=function(){},e.prototype.serialize=function(){var t=n.p4.Serialize(this);return t.uniqueId=this.uniqueId,t.type=this.getClassName(),this.parent&&(t.parentId=this.parent.uniqueId),this.inputs&&this.inputs.serialize(t),n.p4.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.isEnabled=this.isEnabled(),t},e.prototype.clone=function(t,i){void 0===i&&(i=null);var o=n.p4.Clone(e.GetConstructorFromName(this.getClassName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return o.name=t,o.parent=i,this.onClonedObservable.notifyObservers(o),o},e.prototype.getDirection=function(t){var e=h.P.Zero();return this.getDirectionToRef(t,e),e},Object.defineProperty(e.prototype,"absoluteRotation",{get:function(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation},enumerable:!1,configurable:!0}),e.prototype.getDirectionToRef=function(t,e){h.P.TransformNormalToRef(t,this.getWorldMatrix(),e)},e.GetConstructorFromName=function(t,i,o,n,r){void 0===n&&(n=0),void 0===r&&(r=!0);var s=c.N.Construct(t,i,o,{interaxial_distance:n,isStereoscopicSideBySide:r});return s||function(){return e._CreateDefaultParsedCamera(i,o)}},e.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},e.Parse=function(t,i){var o=t.type,r=e.GetConstructorFromName(o,t.name,i,t.interaxial_distance,t.isStereoscopicSideBySide),s=n.p4.Parse(r,t,i);if(void 0!==t.parentId&&(s._waitingParentId=t.parentId),s.inputs&&(s.inputs.parse(t),s._setupInputs()),t.upVector&&(s.upVector=h.P.FromArray(t.upVector)),s.setPosition&&(s.position.copyFromFloats(0,0,0),s.setPosition(h.P.FromArray(t.position))),t.target&&s.setTarget&&s.setTarget(h.P.FromArray(t.target)),t.cameraRigMode){var a=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};s.setCameraRigMode(t.cameraRigMode,a)}if(t.animations){for(var l=0;l<t.animations.length;l++){var p=t.animations[l],d=(0,u.q)("BABYLON.Animation");d&&s.animations.push(d.Parse(p))}c.N.ParseAnimationRanges(s,t,i)}return t.autoAnimate&&i.beginAnimation(s,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&s.setEnabled(t.isEnabled),s},e._CreateDefaultParsedCamera=function(t,e){throw(0,p.S)("UniversalCamera")},e.PERSPECTIVE_CAMERA=0,e.ORTHOGRAPHIC_CAMERA=1,e.FOVMODE_VERTICAL_FIXED=0,e.FOVMODE_HORIZONTAL_FIXED=1,e.RIG_MODE_NONE=0,e.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,e.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,e.RIG_MODE_STEREOSCOPIC_INTERLACED=14,e.RIG_MODE_VR=20,e.RIG_MODE_WEBVR=21,e.RIG_MODE_CUSTOM=22,e.ForceAttachControlToAlwaysPreventDefault=!1,(0,o.gn)([(0,n.hd)("position")],e.prototype,"_position",void 0),(0,o.gn)([(0,n.hd)("upVector")],e.prototype,"_upVector",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"orthoLeft",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"orthoRight",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"orthoBottom",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"orthoTop",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"fov",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"projectionPlaneTilt",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"minZ",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"maxZ",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"inertia",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"mode",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"layerMask",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"fovMode",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"cameraRigMode",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"interaxialDistance",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"isStereoscopicSideBySide",void 0),e}(c.N)},73321:(t,e,i)=>{i.d(e,{p:()=>a,u:()=>s});var o=i(84318),n=i(96969),r=i(2055),s={},a=function(){function t(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=function(){}}return t.prototype.add=function(t){var e=t.getSimpleName();this.attached[e]?o.Y.Warn("camera input of type "+e+" already exists on camera"):(this.attached[e]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl())},t.prototype.remove=function(t){for(var e in this.attached){var i=this.attached[e];i===t&&(i.detachControl(),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}},t.prototype.removeByType=function(t){for(var e in this.attached){var i=this.attached[e];i.getClassName()===t&&(i.detachControl(),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}},t.prototype._addCheckInputs=function(t){var e=this.checkInputs;return function(){e(),t()}},t.prototype.attachInput=function(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)},t.prototype.attachElement=function(t){if(void 0===t&&(t=!1),!this.attachedToElement)for(var e in t=!r.V.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t,this.attached)this.attached[e].attachControl(t)},t.prototype.detachElement=function(t){for(var e in void 0===t&&(t=!1),this.attached)this.attached[e].detachControl(),t&&(this.attached[e].camera=null);this.attachedToElement=!1},t.prototype.rebuildInputCheck=function(){for(var t in this.checkInputs=function(){},this.attached){var e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}},t.prototype.clear=function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}},t.prototype.serialize=function(t){var e={};for(var i in this.attached){var o=this.attached[i],r=n.p4.Serialize(o);e[o.getClassName()]=r}t.inputsmgr=e},t.prototype.parse=function(t){var e=t.inputsmgr;if(e){this.clear();var i=function(t){var i=s[t];if(i){var r=e[t],a=n.p4.Parse((function(){return new i}),r,null);o.add(a)}},o=this;for(var r in e)i(r)}else{var a=function(e){var i=s[h.attached[e].getClassName()];if(i){var o=n.p4.Parse((function(){return new i}),t,null);h.remove(h.attached[e]),h.add(o)}},h=this;for(var r in this.attached)a(r)}},t}()},39821:(t,e,i)=>{i.d(e,{n:()=>h});var o=i(31191),n=i(78098),r=i(58095),s=i(17834),a=(i(39418),i(43048));s.N.AddNodeConstructor("DeviceOrientationCamera",(function(t,e){return function(){return new h(t,r.P.Zero(),e)}}));var h=function(t){function e(e,i,o){var n=t.call(this,e,i,o)||this;return n._tmpDragQuaternion=new r._f,n._disablePointerInputWhenUsingDeviceOrientation=!0,n._dragFactor=0,n._quaternionCache=new r._f,n.inputs.addDeviceOrientation(),n.inputs._deviceOrientationInput&&n.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce((function(){n._disablePointerInputWhenUsingDeviceOrientation&&n.inputs._mouseInput&&(n.inputs._mouseInput._allowCameraRotation=!1,n.inputs._mouseInput.onPointerMovedObservable.add((function(t){0!=n._dragFactor&&(n._initialQuaternion||(n._initialQuaternion=new r._f),r._f.FromEulerAnglesToRef(0,t.offsetX*n._dragFactor,0,n._tmpDragQuaternion),n._initialQuaternion.multiplyToRef(n._tmpDragQuaternion,n._initialQuaternion))})))})),n}return(0,o.ZT)(e,t),Object.defineProperty(e.prototype,"disablePointerInputWhenUsingDeviceOrientation",{get:function(){return this._disablePointerInputWhenUsingDeviceOrientation},set:function(t){this._disablePointerInputWhenUsingDeviceOrientation=t},enumerable:!1,configurable:!0}),e.prototype.enableHorizontalDragging=function(t){void 0===t&&(t=1/300),this._dragFactor=t},e.prototype.getClassName=function(){return"DeviceOrientationCamera"},e.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},e.prototype.resetToCurrentRotation=function(t){var e=this;void 0===t&&(t=a.RD.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new r._f),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach((function(i){t[i]?e._initialQuaternion[i]*=-1:e._initialQuaternion[i]=0})),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},e}(n.c)},78098:(t,e,i)=>{i.d(e,{c:()=>l});var o=i(31191),n=i(96969),r=i(58095),s=i(37290),a=i(86121),h=i(93151),c=i(13514),l=function(t){function e(e,i,o,n){void 0===n&&(n=!0);var a=t.call(this,e,i,o,n)||this;return a.ellipsoid=new r.P(.5,1,.5),a.ellipsoidOffset=new r.P(0,0,0),a.checkCollisions=!1,a.applyGravity=!1,a._needMoveForGravity=!1,a._oldPosition=r.P.Zero(),a._diffPosition=r.P.Zero(),a._newPosition=r.P.Zero(),a._collisionMask=-1,a._onCollisionPositionChange=function(t,e,i){void 0===i&&(i=null);var o;o=e,a._newPosition.copyFrom(o),a._newPosition.subtractToRef(a._oldPosition,a._diffPosition),a._diffPosition.length()>s.D.CollisionsEpsilon&&(a.position.addInPlace(a._diffPosition),a.onCollide&&i&&a.onCollide(i))},a.inputs=new h.a(a),a.inputs.addKeyboard().addMouse(),a}return(0,o.ZT)(e,t),Object.defineProperty(e.prototype,"angularSensibility",{get:function(){var t=this.inputs.attached.mouse;return t?t.angularSensibility:0},set:function(t){var e=this.inputs.attached.mouse;e&&(e.angularSensibility=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysUp",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysUp:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysUp=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysUpward",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysUpward:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysUpward=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysDown",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysDown:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysDown=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysDownward",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysDownward:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysDownward=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysLeft",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysLeft:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysRight",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysRight:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysRight=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysRotateLeft",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysRotateLeft:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysRotateLeft=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysRotateRight",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysRotateRight:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysRotateRight=t)},enumerable:!1,configurable:!0}),e.prototype.attachControl=function(t,e){e=c.w1.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(e)},e.prototype.detachControl=function(){this.inputs.detachElement(),this.cameraDirection=new r.P(0,0,0),this.cameraRotation=new r.FM(0,0)},Object.defineProperty(e.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(t){this._collisionMask=isNaN(t)?-1:t},enumerable:!1,configurable:!0}),e.prototype._collideWithWorld=function(t){(this.parent?r.P.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var e=this.getScene().collisionCoordinator;this._collider||(this._collider=e.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var i=t;this.applyGravity&&(i=t.add(this.getScene().gravity)),e.getNewPosition(this._oldPosition,i,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},e.prototype._checkInputs=function(){this._localDirection||(this._localDirection=r.P.Zero(),this._transformedDirection=r.P.Zero()),this.inputs.checkInputs(),t.prototype._checkInputs.call(this)},e.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},e.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):t.prototype._updatePosition.call(this)},e.prototype.dispose=function(){this.inputs.clear(),t.prototype.dispose.call(this)},e.prototype.getClassName=function(){return"FreeCamera"},(0,o.gn)([(0,n.hd)()],e.prototype,"ellipsoid",void 0),(0,o.gn)([(0,n.hd)()],e.prototype,"ellipsoidOffset",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"checkCollisions",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"applyGravity",void 0),e}(a.C)},93151:(t,e,i)=>{i.d(e,{a:()=>c});var o=i(31191),n=i(73321),r=i(3251),s=i(37026),a=i(99106),h=i(86009),c=function(t){function e(e){var i=t.call(this,e)||this;return i._mouseInput=null,i._mouseWheelInput=null,i}return(0,o.ZT)(e,t),e.prototype.addKeyboard=function(){return this.add(new r.Y),this},e.prototype.addMouse=function(t){return void 0===t&&(t=!0),this._mouseInput||(this._mouseInput=new s.A(t),this.add(this._mouseInput)),this},e.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},e.prototype.addMouseWheel=function(){return this._mouseWheelInput||(this._mouseWheelInput=new a.A,this.add(this._mouseWheelInput)),this},e.prototype.removeMouseWheel=function(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this},e.prototype.addTouch=function(){return this.add(new h.y),this},e.prototype.clear=function(){t.prototype.clear.call(this),this._mouseInput=null},e}(n.p)},94474:(t,e,i)=>{i.d(e,{uA:()=>K,Z5:()=>$,T3:()=>J,HE:()=>tt,YR:()=>q,Yf:()=>L.Y,Rs:()=>r.R,$m:()=>l.$,vh:()=>s.v,F7:()=>a.F,Hn:()=>h.H,u_:()=>p,Y$:()=>o.Y,O6:()=>n.O,V1:()=>I.V,u7:()=>c.u,pq:()=>c.p,nz:()=>N.n,gO:()=>W,wV:()=>z,H6:()=>g,g7:()=>b,i0:()=>j,bF:()=>Z,IF:()=>C,o9:()=>R,Sb:()=>P,cE:()=>V.c,V:()=>T.V,cb:()=>M.c,a8:()=>D.a,YE:()=>x.Y,AY:()=>O.A,AG:()=>w.A,y2:()=>k.y,on:()=>A,iB:()=>U,ND:()=>mt.N,zX:()=>nt,Kj:()=>rt,GW:()=>st,NZ:()=>ct,z0:()=>at,CF:()=>E.C,HC:()=>F.H,xc:()=>G.x,XL:()=>ut.X,MB:()=>dt,iq:()=>_t.i,$0:()=>ft,FG:()=>mt.F,dL:()=>lt,$f:()=>gt.$,i5:()=>Q,kz:()=>ot,SB:()=>pt.S,jE:()=>yt.j});var o=i(23402),n=i(23592),r=i(75537),s=i(34286),a=i(20462),h=i(75105),c=i(73321),l=i(50532),u=i(13514);l.$.prototype.addVRDeviceOrientation=function(){return this.add(new p),this};var p=function(){function t(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return t.prototype.attachControl=function(t){var e=this;t=u.w1.BackCompatCameraNoPreventDefault(arguments),this.camera.attachControl(t);var i=this.camera.getScene().getEngine().getHostWindow();i&&("undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"===t?i.addEventListener("deviceorientation",e._deviceOrientationHandler):u.w1.Warn("Permission not granted.")})).catch((function(t){u.w1.Error(t)})):i.addEventListener("deviceorientation",this._deviceOrientationHandler))},t.prototype._onOrientationEvent=function(t){null!==t.alpha&&(this._alpha=(0|+t.alpha)*this.alphaCorrection),null!==t.gamma&&(this._gamma=(0|+t.gamma)*this.gammaCorrection),this._dirty=!0},t.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},t.prototype.detachControl=function(){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},t.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},t.prototype.getSimpleName=function(){return"VRDeviceOrientation"},t}();c.u.ArcRotateCameraVRDeviceOrientationInput=p;var d=i(31191),_=i(96969),f=i(63737),m=i(58095),g=function(){function t(){this.keysForward=[87],this.keysBackward=[83],this.keysUp=[69],this.keysDown=[81],this.keysRight=[68],this.keysLeft=[65],this._keys=new Array}return t.prototype.attachControl=function(t){var e=this;t=u.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){e._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(i){var o,n=i.event;i.type===f.OG.KEYDOWN?-1===e.keysForward.indexOf(n.keyCode)&&-1===e.keysBackward.indexOf(n.keyCode)&&-1===e.keysUp.indexOf(n.keyCode)&&-1===e.keysDown.indexOf(n.keyCode)&&-1===e.keysLeft.indexOf(n.keyCode)&&-1===e.keysRight.indexOf(n.keyCode)||(-1===(o=e._keys.indexOf(n.keyCode))&&e._keys.push(n.keyCode),t||n.preventDefault()):-1===e.keysForward.indexOf(n.keyCode)&&-1===e.keysBackward.indexOf(n.keyCode)&&-1===e.keysUp.indexOf(n.keyCode)&&-1===e.keysDown.indexOf(n.keyCode)&&-1===e.keysLeft.indexOf(n.keyCode)&&-1===e.keysRight.indexOf(n.keyCode)||((o=e._keys.indexOf(n.keyCode))>=0&&e._keys.splice(o,1),t||n.preventDefault())})))},t.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.getClassName=function(){return"FlyCameraKeyboardInput"},t.prototype._onLostFocus=function(){this._keys=[]},t.prototype.getSimpleName=function(){return"keyboard"},t.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var i=this._keys[e],o=t._computeLocalCameraSpeed();-1!==this.keysForward.indexOf(i)?t._localDirection.copyFromFloats(0,0,o):-1!==this.keysBackward.indexOf(i)?t._localDirection.copyFromFloats(0,0,-o):-1!==this.keysUp.indexOf(i)?t._localDirection.copyFromFloats(0,o,0):-1!==this.keysDown.indexOf(i)?t._localDirection.copyFromFloats(0,-o,0):-1!==this.keysRight.indexOf(i)?t._localDirection.copyFromFloats(o,0,0):-1!==this.keysLeft.indexOf(i)&&t._localDirection.copyFromFloats(-o,0,0),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),m.P.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},(0,d.gn)([(0,_.qC)()],t.prototype,"keysForward",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysBackward",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysUp",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysDown",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysRight",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysLeft",void 0),t}();c.u.FlyCameraKeyboardInput=g;var y=i(76324),v=i(43048),b=function(){function t(){this.buttons=[0,1,2],this.buttonsYaw=[-1,0,1],this.buttonsPitch=[-1,0,1],this.buttonsRoll=[2],this.activeButton=-1,this.angularSensibility=1e3,this._previousPosition=null}return t.prototype.attachControl=function(t){var e=this;t=u.w1.BackCompatCameraNoPreventDefault(arguments),this._noPreventDefault=t,this._observer=this.camera.getScene().onPointerObservable.add((function(t){e._pointerInput(t)}),y.kD.POINTERDOWN|y.kD.POINTERUP|y.kD.POINTERMOVE),this._rollObserver=this.camera.getScene().onBeforeRenderObservable.add((function(){e.camera.rollCorrect&&e.camera.restoreRoll(e.camera.rollCorrect)}))},t.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this.camera.getScene().onBeforeRenderObservable.remove(this._rollObserver),this._observer=null,this._rollObserver=null,this._previousPosition=null,this._noPreventDefault=void 0)},t.prototype.getClassName=function(){return"FlyCameraMouseInput"},t.prototype.getSimpleName=function(){return"mouse"},t.prototype._pointerInput=function(t){var e=t.event,i=this.camera.getEngine();if(!i.isInVRExclusivePointerMode&&(this.touchEnabled||"touch"!==e.pointerType)&&(t.type===y.kD.POINTERMOVE||-1!==this.buttons.indexOf(e.button))){var o=e.srcElement||e.target;if(t.type===y.kD.POINTERDOWN){try{null==o||o.setPointerCapture(e.pointerId)}catch(e){}this._previousPosition={x:e.clientX,y:e.clientY},this.activeButton=e.button,this._noPreventDefault||(e.preventDefault(),this._element.focus()),i.isPointerLock&&this._onMouseMove(t.event)}else if(t.type===y.kD.POINTERUP){try{null==o||o.releasePointerCapture(e.pointerId)}catch(e){}this.activeButton=-1,this._previousPosition=null,this._noPreventDefault||e.preventDefault()}else if(t.type===y.kD.POINTERMOVE){if(!this._previousPosition)return void(i.isPointerLock&&this._onMouseMove(t.event));var n=e.clientX-this._previousPosition.x,r=e.clientY-this._previousPosition.y;this._rotateCamera(n,r),this._previousPosition={x:e.clientX,y:e.clientY},this._noPreventDefault||e.preventDefault()}}},t.prototype._onMouseMove=function(t){var e=this.camera.getEngine();if(e.isPointerLock&&!e.isInVRExclusivePointerMode){var i=t.movementX||t.mozMovementX||t.webkitMovementX||t.msMovementX||0,o=t.movementY||t.mozMovementY||t.webkitMovementY||t.msMovementY||0;this._rotateCamera(i,o),this._previousPosition=null,this._noPreventDefault||t.preventDefault()}},t.prototype._rotateCamera=function(t,e){var i=this,o=this.camera;this.camera.getScene().useRightHandedSystem&&(t*=-1),o.parent&&o.parent._getWorldMatrixDeterminant()<0&&(t*=-1);var n,r=t/this.angularSensibility,s=e/this.angularSensibility,a=m._f.RotationYawPitchRoll(o.rotation.y,o.rotation.x,o.rotation.z);if(this.buttonsPitch.some((function(t){return t===i.activeButton}))&&(n=m._f.RotationAxis(v.RD.X,s),a.multiplyInPlace(n)),this.buttonsYaw.some((function(t){return t===i.activeButton}))){n=m._f.RotationAxis(v.RD.Y,r),a.multiplyInPlace(n);var h=o.bankedTurnLimit+o._trackRoll;if(o.bankedTurn&&-h<o.rotation.z&&o.rotation.z<h){var c=o.bankedTurnMultiplier*-r;n=m._f.RotationAxis(v.RD.Z,c),a.multiplyInPlace(n)}}this.buttonsRoll.some((function(t){return t===i.activeButton}))&&(n=m._f.RotationAxis(v.RD.Z,-r),o._trackRoll-=r,a.multiplyInPlace(n)),a.toEulerAnglesToRef(o.rotation)},(0,d.gn)([(0,_.qC)()],t.prototype,"buttons",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"angularSensibility",void 0),t}();c.u.FlyCameraMouseInput=b;var C=function(){function t(){this.keysHeightOffsetIncr=[38],this.keysHeightOffsetDecr=[40],this.keysHeightOffsetModifierAlt=!1,this.keysHeightOffsetModifierCtrl=!1,this.keysHeightOffsetModifierShift=!1,this.keysRotationOffsetIncr=[37],this.keysRotationOffsetDecr=[39],this.keysRotationOffsetModifierAlt=!1,this.keysRotationOffsetModifierCtrl=!1,this.keysRotationOffsetModifierShift=!1,this.keysRadiusIncr=[40],this.keysRadiusDecr=[38],this.keysRadiusModifierAlt=!0,this.keysRadiusModifierCtrl=!1,this.keysRadiusModifierShift=!1,this.heightSensibility=1,this.rotationSensibility=1,this.radiusSensibility=1,this._keys=new Array}return t.prototype.attachControl=function(t){var e=this;t=u.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((function(){e._keys=[]})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((function(i){var o,n=i.event;n.metaKey||(i.type===f.OG.KEYDOWN?(e._ctrlPressed=n.ctrlKey,e._altPressed=n.altKey,e._shiftPressed=n.shiftKey,(-1!==e.keysHeightOffsetIncr.indexOf(n.keyCode)||-1!==e.keysHeightOffsetDecr.indexOf(n.keyCode)||-1!==e.keysRotationOffsetIncr.indexOf(n.keyCode)||-1!==e.keysRotationOffsetDecr.indexOf(n.keyCode)||-1!==e.keysRadiusIncr.indexOf(n.keyCode)||-1!==e.keysRadiusDecr.indexOf(n.keyCode))&&(-1===(o=e._keys.indexOf(n.keyCode))&&e._keys.push(n.keyCode),n.preventDefault&&(t||n.preventDefault()))):-1===e.keysHeightOffsetIncr.indexOf(n.keyCode)&&-1===e.keysHeightOffsetDecr.indexOf(n.keyCode)&&-1===e.keysRotationOffsetIncr.indexOf(n.keyCode)&&-1===e.keysRotationOffsetDecr.indexOf(n.keyCode)&&-1===e.keysRadiusIncr.indexOf(n.keyCode)&&-1===e.keysRadiusDecr.indexOf(n.keyCode)||((o=e._keys.indexOf(n.keyCode))>=0&&e._keys.splice(o,1),n.preventDefault&&(t||n.preventDefault())))})))},t.prototype.detachControl=function(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.checkInputs=function(){var t=this;this._onKeyboardObserver&&this._keys.forEach((function(e){-1!==t.keysHeightOffsetIncr.indexOf(e)&&t._modifierHeightOffset()?t.camera.heightOffset+=t.heightSensibility:-1!==t.keysHeightOffsetDecr.indexOf(e)&&t._modifierHeightOffset()?t.camera.heightOffset-=t.heightSensibility:-1!==t.keysRotationOffsetIncr.indexOf(e)&&t._modifierRotationOffset()?(t.camera.rotationOffset+=t.rotationSensibility,t.camera.rotationOffset%=360):-1!==t.keysRotationOffsetDecr.indexOf(e)&&t._modifierRotationOffset()?(t.camera.rotationOffset-=t.rotationSensibility,t.camera.rotationOffset%=360):-1!==t.keysRadiusIncr.indexOf(e)&&t._modifierRadius()?t.camera.radius+=t.radiusSensibility:-1!==t.keysRadiusDecr.indexOf(e)&&t._modifierRadius()&&(t.camera.radius-=t.radiusSensibility)}))},t.prototype.getClassName=function(){return"FollowCameraKeyboardMoveInput"},t.prototype.getSimpleName=function(){return"keyboard"},t.prototype._modifierHeightOffset=function(){return this.keysHeightOffsetModifierAlt===this._altPressed&&this.keysHeightOffsetModifierCtrl===this._ctrlPressed&&this.keysHeightOffsetModifierShift===this._shiftPressed},t.prototype._modifierRotationOffset=function(){return this.keysRotationOffsetModifierAlt===this._altPressed&&this.keysRotationOffsetModifierCtrl===this._ctrlPressed&&this.keysRotationOffsetModifierShift===this._shiftPressed},t.prototype._modifierRadius=function(){return this.keysRadiusModifierAlt===this._altPressed&&this.keysRadiusModifierCtrl===this._ctrlPressed&&this.keysRadiusModifierShift===this._shiftPressed},(0,d.gn)([(0,_.qC)()],t.prototype,"keysHeightOffsetIncr",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysHeightOffsetDecr",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysHeightOffsetModifierAlt",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysHeightOffsetModifierCtrl",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysHeightOffsetModifierShift",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysRotationOffsetIncr",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysRotationOffsetDecr",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysRotationOffsetModifierAlt",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysRotationOffsetModifierCtrl",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysRotationOffsetModifierShift",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysRadiusIncr",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysRadiusDecr",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysRadiusModifierAlt",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysRadiusModifierCtrl",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"keysRadiusModifierShift",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"heightSensibility",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"rotationSensibility",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"radiusSensibility",void 0),t}();c.u.FollowCameraKeyboardMoveInput=C;var R=function(){function t(){this.axisControlRadius=!0,this.axisControlHeight=!1,this.axisControlRotation=!1,this.wheelPrecision=3,this.wheelDeltaPercentage=0}return t.prototype.attachControl=function(t){var e=this;t=u.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(i){if(i.type===y.kD.POINTERWHEEL){var o=i.event,n=0,r=Math.max(-1,Math.min(1,o.deltaY||o.wheelDelta||-o.detail));e.wheelDeltaPercentage?e.axisControlRadius?n=.01*r*e.wheelDeltaPercentage*e.camera.radius:e.axisControlHeight?n=.01*r*e.wheelDeltaPercentage*e.camera.heightOffset:e.axisControlRotation&&(n=.01*r*e.wheelDeltaPercentage*e.camera.rotationOffset):n=r*e.wheelPrecision,n&&(e.axisControlRadius?e.camera.radius+=n:e.axisControlHeight?e.camera.heightOffset-=n:e.axisControlRotation&&(e.camera.rotationOffset-=n)),o.preventDefault&&(t||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,y.kD.POINTERWHEEL)},t.prototype.detachControl=function(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},t.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},t.prototype.getSimpleName=function(){return"mousewheel"},(0,d.gn)([(0,_.qC)()],t.prototype,"axisControlRadius",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"axisControlHeight",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"axisControlRotation",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"wheelPrecision",void 0),(0,d.gn)([(0,_.qC)()],t.prototype,"wheelDeltaPercentage",void 0),t}();c.u.FollowCameraMouseWheelInput=R;var P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.angularSensibilityX=1,e.angularSensibilityY=1,e.pinchPrecision=1e4,e.pinchDeltaPercentage=0,e.axisXControlRadius=!1,e.axisXControlHeight=!1,e.axisXControlRotation=!0,e.axisYControlRadius=!1,e.axisYControlHeight=!0,e.axisYControlRotation=!1,e.axisPinchControlRadius=!0,e.axisPinchControlHeight=!1,e.axisPinchControlRotation=!1,e.warningEnable=!0,e._warningCounter=0,e}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"FollowCameraPointersInput"},e.prototype.onTouch=function(t,e,i){this._warning(),this.axisXControlRotation?this.camera.rotationOffset+=e/this.angularSensibilityX:this.axisYControlRotation&&(this.camera.rotationOffset+=i/this.angularSensibilityX),this.axisXControlHeight?this.camera.heightOffset+=e/this.angularSensibilityY:this.axisYControlHeight&&(this.camera.heightOffset+=i/this.angularSensibilityY),this.axisXControlRadius?this.camera.radius-=e/this.angularSensibilityY:this.axisYControlRadius&&(this.camera.radius-=i/this.angularSensibilityY)},e.prototype.onMultiTouch=function(t,e,i,o,n,r){if(!(0===i&&null===n||0===o&&null===r)){var s=(o-i)/(this.pinchPrecision*(this.angularSensibilityX+this.angularSensibilityY)/2);this.pinchDeltaPercentage?(s*=.01*this.pinchDeltaPercentage,this.axisPinchControlRotation&&(this.camera.rotationOffset+=s*this.camera.rotationOffset),this.axisPinchControlHeight&&(this.camera.heightOffset+=s*this.camera.heightOffset),this.axisPinchControlRadius&&(this.camera.radius-=s*this.camera.radius)):(this.axisPinchControlRotation&&(this.camera.rotationOffset+=s),this.axisPinchControlHeight&&(this.camera.heightOffset+=s),this.axisPinchControlRadius&&(this.camera.radius-=s))}},e.prototype._warning=function(){if(this.warningEnable&&this._warningCounter++%100==0);},(0,d.gn)([(0,_.qC)()],e.prototype,"angularSensibilityX",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"angularSensibilityY",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"pinchPrecision",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"pinchDeltaPercentage",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"axisXControlRadius",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"axisXControlHeight",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"axisXControlRotation",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"axisYControlRadius",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"axisYControlHeight",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"axisYControlRotation",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"axisPinchControlRadius",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"axisPinchControlHeight",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"axisPinchControlRotation",void 0),e}(n.O);c.u.FollowCameraPointersInput=P;var T=i(39418),M=i(61660),x=i(3251),O=i(37026),w=i(99106),k=i(86009),S=i(59711),D=i(93151);D.a.prototype.addVirtualJoystick=function(){return this.add(new A),this};var A=function(){function t(){}return t.prototype.getLeftJoystick=function(){return this._leftjoystick},t.prototype.getRightJoystick=function(){return this._rightjoystick},t.prototype.checkInputs=function(){if(this._leftjoystick){var t=this.camera,e=50*t._computeLocalCameraSpeed(),i=m.y3.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),o=m.P.TransformCoordinates(new m.P(this._leftjoystick.deltaPosition.x*e,this._leftjoystick.deltaPosition.y*e,this._leftjoystick.deltaPosition.z*e),i);t.cameraDirection=t.cameraDirection.add(o),t.cameraRotation=t.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},t.prototype.attachControl=function(){this._leftjoystick=new S.N(!0),this._leftjoystick.setAxisForUpDown(S.h.Z),this._leftjoystick.setAxisForLeftRight(S.h.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new S.N(!1),this._rightjoystick.setAxisForUpDown(S.h.X),this._rightjoystick.setAxisForLeftRight(S.h.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},t.prototype.detachControl=function(){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},t.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},t.prototype.getSimpleName=function(){return"virtualJoystick"},t}();c.u.FreeCameraVirtualJoystickInput=A;var I=i(2055),E=i(86121),V=i(78098),F=i(94925),L=i(78443),N=i(39821),B=i(37290),z=function(t){function e(e){return t.call(this,e)||this}return(0,d.ZT)(e,t),e.prototype.addKeyboard=function(){return this.add(new g),this},e.prototype.addMouse=function(){return this.add(new b),this},e}(c.p),W=function(t){function e(e,i,o,n){void 0===n&&(n=!0);var r=t.call(this,e,i,o,n)||this;return r.ellipsoid=new m.P(1,1,1),r.ellipsoidOffset=new m.P(0,0,0),r.checkCollisions=!1,r.applyGravity=!1,r.cameraDirection=m.P.Zero(),r._trackRoll=0,r.rollCorrect=100,r.bankedTurn=!1,r.bankedTurnLimit=Math.PI/2,r.bankedTurnMultiplier=1,r._needMoveForGravity=!1,r._oldPosition=m.P.Zero(),r._diffPosition=m.P.Zero(),r._newPosition=m.P.Zero(),r._collisionMask=-1,r._onCollisionPositionChange=function(t,e,i){void 0===i&&(i=null);var o;o=e,r._newPosition.copyFrom(o),r._newPosition.subtractToRef(r._oldPosition,r._diffPosition),r._diffPosition.length()>B.D.CollisionsEpsilon&&(r.position.addInPlace(r._diffPosition),r.onCollide&&i&&r.onCollide(i))},r.inputs=new z(r),r.inputs.addKeyboard().addMouse(),r}return(0,d.ZT)(e,t),Object.defineProperty(e.prototype,"angularSensibility",{get:function(){var t=this.inputs.attached.mouse;return t?t.angularSensibility:0},set:function(t){var e=this.inputs.attached.mouse;e&&(e.angularSensibility=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysForward",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysForward:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysForward=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysBackward",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysBackward:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysBackward=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysUp",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysUp:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysUp=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysDown",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysDown:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysDown=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysLeft",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysLeft:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysRight",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysRight:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysRight=t)},enumerable:!1,configurable:!0}),e.prototype.attachControl=function(t,e){e=u.w1.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(e)},e.prototype.detachControl=function(){this.inputs.detachElement(),this.cameraDirection=new m.P(0,0,0)},Object.defineProperty(e.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(t){this._collisionMask=isNaN(t)?-1:t},enumerable:!1,configurable:!0}),e.prototype._collideWithWorld=function(t){(this.parent?m.P.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var e=this.getScene().collisionCoordinator;this._collider||(this._collider=e.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var i=t;this.applyGravity&&(i=t.add(this.getScene().gravity)),e.getNewPosition(this._oldPosition,i,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},e.prototype._checkInputs=function(){this._localDirection||(this._localDirection=m.P.Zero(),this._transformedDirection=m.P.Zero()),this.inputs.checkInputs(),t.prototype._checkInputs.call(this)},e.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},e.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):t.prototype._updatePosition.call(this)},e.prototype.restoreRoll=function(t){var e=this._trackRoll,i=e-this.rotation.z;Math.abs(i)>=.001&&(this.rotation.z+=i/t,Math.abs(e-this.rotation.z)<=.001&&(this.rotation.z=e))},e.prototype.dispose=function(){this.inputs.clear(),t.prototype.dispose.call(this)},e.prototype.getClassName=function(){return"FlyCamera"},(0,d.gn)([(0,_.hd)()],e.prototype,"ellipsoid",void 0),(0,d.gn)([(0,_.hd)()],e.prototype,"ellipsoidOffset",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"checkCollisions",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"applyGravity",void 0),e}(E.C),Y=i(17834),Z=function(t){function e(e){return t.call(this,e)||this}return(0,d.ZT)(e,t),e.prototype.addKeyboard=function(){return this.add(new C),this},e.prototype.addMouseWheel=function(){return this.add(new R),this},e.prototype.addPointers=function(){return this.add(new P),this},e.prototype.addVRDeviceOrientation=function(){return this},e}(c.p);Y.N.AddNodeConstructor("FollowCamera",(function(t,e){return function(){return new j(t,m.P.Zero(),e)}})),Y.N.AddNodeConstructor("ArcFollowCamera",(function(t,e){return function(){return new q(t,0,0,1,null,e)}}));var j=function(t){function e(e,i,o,n){void 0===n&&(n=null);var r=t.call(this,e,i,o)||this;return r.radius=12,r.lowerRadiusLimit=null,r.upperRadiusLimit=null,r.rotationOffset=0,r.lowerRotationOffsetLimit=null,r.upperRotationOffsetLimit=null,r.heightOffset=4,r.lowerHeightOffsetLimit=null,r.upperHeightOffsetLimit=null,r.cameraAcceleration=.05,r.maxCameraSpeed=20,r.lockedTarget=n,r.inputs=new Z(r),r.inputs.addKeyboard().addMouseWheel().addPointers(),r}return(0,d.ZT)(e,t),e.prototype._follow=function(t){if(t){var e=m.jp.Matrix[0];t.absoluteRotationQuaternion.toRotationMatrix(e);var i=Math.atan2(e.m[8],e.m[10]),o=u.w1.ToRadians(this.rotationOffset)+i,n=t.getAbsolutePosition(),r=n.x+Math.sin(o)*this.radius,s=n.z+Math.cos(o)*this.radius,a=r-this.position.x,h=n.y+this.heightOffset-this.position.y,c=s-this.position.z,l=a*this.cameraAcceleration*2,p=h*this.cameraAcceleration,d=c*this.cameraAcceleration*2;(l>this.maxCameraSpeed||l<-this.maxCameraSpeed)&&(l=l<1?-this.maxCameraSpeed:this.maxCameraSpeed),(p>this.maxCameraSpeed||p<-this.maxCameraSpeed)&&(p=p<1?-this.maxCameraSpeed:this.maxCameraSpeed),(d>this.maxCameraSpeed||d<-this.maxCameraSpeed)&&(d=d<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new m.P(this.position.x+l,this.position.y+p,this.position.z+d),this.setTarget(n)}},e.prototype.attachControl=function(t,e){e=u.w1.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(e),this._reset=function(){}},e.prototype.detachControl=function(){this.inputs.detachElement(),this._reset&&this._reset()},e.prototype._checkInputs=function(){this.inputs.checkInputs(),this._checkLimits(),t.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},e.prototype._checkLimits=function(){null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit),null!==this.lowerHeightOffsetLimit&&this.heightOffset<this.lowerHeightOffsetLimit&&(this.heightOffset=this.lowerHeightOffsetLimit),null!==this.upperHeightOffsetLimit&&this.heightOffset>this.upperHeightOffsetLimit&&(this.heightOffset=this.upperHeightOffsetLimit),null!==this.lowerRotationOffsetLimit&&this.rotationOffset<this.lowerRotationOffsetLimit&&(this.rotationOffset=this.lowerRotationOffsetLimit),null!==this.upperRotationOffsetLimit&&this.rotationOffset>this.upperRotationOffsetLimit&&(this.rotationOffset=this.upperRotationOffsetLimit)},e.prototype.getClassName=function(){return"FollowCamera"},(0,d.gn)([(0,_.qC)()],e.prototype,"radius",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"lowerRadiusLimit",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"upperRadiusLimit",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"rotationOffset",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"lowerRotationOffsetLimit",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"upperRotationOffsetLimit",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"heightOffset",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"lowerHeightOffsetLimit",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"upperHeightOffsetLimit",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"cameraAcceleration",void 0),(0,d.gn)([(0,_.qC)()],e.prototype,"maxCameraSpeed",void 0),(0,d.gn)([(0,_.RR)("lockedTargetId")],e.prototype,"lockedTarget",void 0),e}(E.C),q=function(t){function e(e,i,o,n,r,s){var a=t.call(this,e,m.P.Zero(),s)||this;return a.alpha=i,a.beta=o,a.radius=n,a._cartesianCoordinates=m.P.Zero(),a.setMeshTarget(r),a}return(0,d.ZT)(e,t),e.prototype.setMeshTarget=function(t){this._meshTarget=t,this._follow()},e.prototype._follow=function(){if(this._meshTarget){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var t=this._meshTarget.getAbsolutePosition();this.position=t.add(this._cartesianCoordinates),this.setTarget(t)}},e.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this._follow()},e.prototype.getClassName=function(){return"ArcFollowCamera"},e}(E.C),G=i(71143);Y.N.AddNodeConstructor("GamepadCamera",(function(t,e){return function(){return new U(t,m.P.Zero(),e)}}));var U=function(t){function e(e,i,o){return t.call(this,e,i,o)||this}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"GamepadCamera"},e}(G.x),H=i(89815),X=i(92151);function Q(t){t._rigCameras[0]._rigPostProcess=new H.Q(t.name+"_passthru",1,t._rigCameras[0]),t._rigCameras[1]._rigPostProcess=new X.k(t.name+"_anaglyph",1,t._rigCameras)}Y.N.AddNodeConstructor("AnaglyphArcRotateCamera",(function(t,e,i){return function(){return new K(t,0,0,1,m.P.Zero(),i.interaxial_distance,e)}}));var K=function(t){function e(e,i,o,n,r,s,a){var h=t.call(this,e,i,o,n,r,a)||this;return h._setRigMode=Q.bind(null,h),h.interaxialDistance=s,h.setCameraRigMode(I.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:s}),h}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},e}(L.Y);Y.N.AddNodeConstructor("AnaglyphFreeCamera",(function(t,e,i){return function(){return new $(t,m.P.Zero(),i.interaxial_distance,e)}}));var $=function(t){function e(e,i,o,n){var r=t.call(this,e,i,n)||this;return r._setRigMode=Q.bind(null,r),r.interaxialDistance=o,r.setCameraRigMode(I.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:o}),r}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"AnaglyphFreeCamera"},e}(V.c);Y.N.AddNodeConstructor("AnaglyphGamepadCamera",(function(t,e,i){return function(){return new J(t,m.P.Zero(),i.interaxial_distance,e)}}));var J=function(t){function e(e,i,o,n){var r=t.call(this,e,i,n)||this;return r._setRigMode=Q.bind(null,r),r.interaxialDistance=o,r.setCameraRigMode(I.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:o}),r}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},e}(U);Y.N.AddNodeConstructor("AnaglyphUniversalCamera",(function(t,e,i){return function(){return new tt(t,m.P.Zero(),i.interaxial_distance,e)}}));var tt=function(t){function e(e,i,o,n){var r=t.call(this,e,i,n)||this;return r._setRigMode=Q.bind(null,r),r.interaxialDistance=o,r.setCameraRigMode(I.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:o}),r}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},e}(G.x),et=i(66513),it=i(280);function ot(t){var e=t.cameraRigMode===I.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||t.cameraRigMode===I.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED,i=t.cameraRigMode===I.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;t.cameraRigMode===I.V.RIG_MODE_STEREOSCOPIC_INTERLACED?(t._rigCameras[0]._rigPostProcess=new H.Q(t.name+"_passthru",1,t._rigCameras[0]),t._rigCameras[1]._rigPostProcess=new it.i(t.name+"_stereoInterlace",t._rigCameras,!1,!0)):(t._rigCameras[i?1:0].viewport=new et.l(0,0,e?.5:1,e?1:.5),t._rigCameras[i?0:1].viewport=new et.l(e?.5:0,e?0:.5,e?.5:1,e?1:.5))}Y.N.AddNodeConstructor("StereoscopicArcRotateCamera",(function(t,e,i){return function(){return new nt(t,0,0,1,m.P.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,e)}}));var nt=function(t){function e(e,i,o,n,r,s,a,h){var c=t.call(this,e,i,o,n,r,h)||this;return c._setRigMode=ot.bind(null,c),c.interaxialDistance=s,c.isStereoscopicSideBySide=a,c.setCameraRigMode(a?I.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:I.V.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:s}),c}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},e}(L.Y);Y.N.AddNodeConstructor("StereoscopicFreeCamera",(function(t,e,i){return function(){return new rt(t,m.P.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,e)}}));var rt=function(t){function e(e,i,o,n,r){var s=t.call(this,e,i,r)||this;return s._setRigMode=ot.bind(null,s),s.interaxialDistance=o,s.isStereoscopicSideBySide=n,s.setCameraRigMode(n?I.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:I.V.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:o}),s}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"StereoscopicFreeCamera"},e}(V.c);Y.N.AddNodeConstructor("StereoscopicGamepadCamera",(function(t,e,i){return function(){return new st(t,m.P.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,e)}}));var st=function(t){function e(e,i,o,n,r){var s=t.call(this,e,i,r)||this;return s._setRigMode=ot.bind(null,s),s.interaxialDistance=o,s.isStereoscopicSideBySide=n,s.setCameraRigMode(n?I.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:I.V.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:o}),s}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},e}(U);Y.N.AddNodeConstructor("StereoscopicFreeCamera",(function(t,e,i){return function(){return new at(t,m.P.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,e)}}));var at=function(t){function e(e,i,o,n,r){var s=t.call(this,e,i,r)||this;return s._setRigMode=ot.bind(null,s),s.interaxialDistance=o,s.isStereoscopicSideBySide=n,s.setCameraRigMode(n?I.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:I.V.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:o}),s}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},e}(G.x),ht=i(30700),ct=function(t){function e(e,i,o,n,r){void 0===n&&(n=1),void 0===r&&(r=.065);var s=t.call(this,e,i,o)||this;return s._distanceBetweenEyes=r,s._distanceToProjectionPlane=n,s.setCameraRigMode(I.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL,{stereoHalfAngle:0}),s._cameraRigParams.stereoHalfAngle=0,s._cameraRigParams.interaxialDistance=r,s}return(0,d.ZT)(e,t),Object.defineProperty(e.prototype,"distanceBetweenEyes",{get:function(){return this._distanceBetweenEyes},set:function(t){this._distanceBetweenEyes=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distanceToProjectionPlane",{get:function(){return this._distanceToProjectionPlane},set:function(t){this._distanceToProjectionPlane=t},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},e.prototype.createRigCamera=function(t){var e=new E.C(t,m.P.Zero(),this.getScene()),i=new ht.Y("tm_"+t,this.getScene());return e.parent=i,i.setPivotMatrix(m.y3.Identity(),!1),e.isRigCamera=!0,e.rigParent=this,e},e.prototype._updateRigCameras=function(){for(var t=0;t<this._rigCameras.length;t++){var e=this._rigCameras[t];e.minZ=this.minZ,e.maxZ=this.maxZ,e.fov=this.fov,e.upVector.copyFrom(this.upVector),e.rotationQuaternion?e.rotationQuaternion.copyFrom(this.rotationQuaternion):e.rotation.copyFrom(this.rotation),this._updateCamera(this._rigCameras[t],t)}},e.prototype._updateCamera=function(t,e){var i=this.distanceBetweenEyes/2,o=i/this.distanceToProjectionPlane;t.position.copyFrom(this.position),t.position.addInPlaceFromFloats(0===e?-i:i,0,-this._distanceToProjectionPlane);var n=t.parent,r=n.getPivotMatrix();r.setTranslationFromFloats(0===e?i:-i,0,0),r.setRowFromFloats(2,0===e?o:-o,0,1,0),n.setPivotMatrix(r,!1)},e.prototype._setRigMode=function(){this._rigCameras[0].viewport=new et.l(0,0,.5,1),this._rigCameras[1].viewport=new et.l(.5,0,.5,1);for(var t=0;t<this._rigCameras.length;t++)this._updateCamera(this._rigCameras[t],t)},e}(G.x);Y.N.AddNodeConstructor("VirtualJoysticksCamera",(function(t,e){return function(){return new lt(t,m.P.Zero(),e)}}));var lt=function(t){function e(e,i,o){var n=t.call(this,e,i,o)||this;return n.inputs.addVirtualJoystick(),n}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"VirtualJoysticksCamera"},e}(V.c),ut=i(372),pt=i(28044);Y.N.AddNodeConstructor("VRDeviceOrientationArcRotateCamera",(function(t,e){return function(){return new dt(t,0,0,1,m.P.Zero(),e)}}));var dt=function(t){function e(e,i,o,n,r,s,a,h){void 0===a&&(a=!0),void 0===h&&(h=ut.X.GetDefault());var c=t.call(this,e,i,o,n,r,s)||this;return c._setRigMode=pt.S.bind(null,c),h.compensateDistortion=a,c.setCameraRigMode(I.V.RIG_MODE_VR,{vrCameraMetrics:h}),c.inputs.addVRDeviceOrientation(),c}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},e}(L.Y),_t=i(62091);i(93197);Y.N.AddNodeConstructor("VRDeviceOrientationGamepadCamera",(function(t,e){return function(){return new ft(t,m.P.Zero(),e)}}));var ft=function(t){function e(e,i,o,n,r){void 0===n&&(n=!0),void 0===r&&(r=ut.X.GetDefault());var s=t.call(this,e,i,o,n,r)||this;return s._setRigMode=pt.S.bind(null,s),s.inputs.addGamepad(),s}return(0,d.ZT)(e,t),e.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},e}(_t.i),mt=i(12110),gt=i(58705),yt=i(51345)},86121:(t,e,i)=>{i.d(e,{C:()=>c});var o=i(31191),n=i(96969),r=i(2055),s=i(58095),a=i(48154),h=i(43048),c=function(t){function e(e,i,o,n){void 0===n&&(n=!0);var r=t.call(this,e,i,o,n)||this;return r._tmpUpVector=s.P.Zero(),r._tmpTargetVector=s.P.Zero(),r.cameraDirection=new s.P(0,0,0),r.cameraRotation=new s.FM(0,0),r.ignoreParentScaling=!1,r.updateUpVectorFromRotation=!1,r._tmpQuaternion=new s._f,r.rotation=new s.P(0,0,0),r.speed=2,r.noRotationConstraint=!1,r.invertRotation=!1,r.inverseRotationSpeed=.2,r.lockedTarget=null,r._currentTarget=s.P.Zero(),r._initialFocalDistance=1,r._viewMatrix=s.y3.Zero(),r._camMatrix=s.y3.Zero(),r._cameraTransformMatrix=s.y3.Zero(),r._cameraRotationMatrix=s.y3.Zero(),r._referencePoint=new s.P(0,0,1),r._transformedReferencePoint=s.P.Zero(),r._defaultUp=s.P.Up(),r._cachedRotationZ=0,r._cachedQuaternionRotationZ=0,r}return(0,o.ZT)(e,t),e.prototype.getFrontPosition=function(t){this.getWorldMatrix();var e=this.getTarget().subtract(this.position);return e.normalize(),e.scaleInPlace(t),this.globalPosition.add(e)},e.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},e.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),t.prototype.storeState.call(this)},e.prototype._restoreStateValues=function(){return!!t.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},e.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.lockedTarget=new s.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new s.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new s._f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},e.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this);var i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},e.prototype._isSynchronizedViewMatrix=function(){if(!t.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},e.prototype._computeLocalCameraSpeed=function(){var t=this.getEngine();return this.speed*Math.sqrt(t.getDeltaTime()/(100*t.getFps()))},e.prototype.setTarget=function(t){this.upVector.normalize(),this._initialFocalDistance=t.subtract(this.position).length(),this.position.z===t.z&&(this.position.z+=a.kn),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),s.y3.LookAtLHToRef(this.position,t,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var e=t.subtract(this.position);e.x>=0?this.rotation.y=-Math.atan(e.z/e.x)+Math.PI/2:this.rotation.y=-Math.atan(e.z/e.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&s._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},Object.defineProperty(e.prototype,"target",{get:function(){return this.getTarget()},set:function(t){this.setTarget(t)},enumerable:!1,configurable:!0}),e.prototype.getTarget=function(){return this._currentTarget},e.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},e.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(s.jp.Matrix[0]),s.P.TransformNormalToRef(this.cameraDirection,s.jp.Matrix[0],s.jp.Vector3[0]),void this.position.addInPlace(s.jp.Vector3[0]);this.position.addInPlace(this.cameraDirection)},e.prototype._checkInputs=function(){var e=this.invertRotation?-this.inverseRotationSpeed:1,i=this._decideIfNeedsToMove(),o=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(i&&this._updatePosition(),o){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*e,this.rotation.y+=this.cameraRotation.y*e,!this.noRotationConstraint){var n=1.570796;this.rotation.x>n&&(this.rotation.x=n),this.rotation.x<-n&&(this.rotation.x=-n)}if(this.rotationQuaternion)this.rotation.lengthSquared()&&s._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}i&&(Math.abs(this.cameraDirection.x)<this.speed*a.kn&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*a.kn&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*a.kn&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),o&&(Math.abs(this.cameraRotation.x)<this.speed*a.kn&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*a.kn&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),t.prototype._checkInputs.call(this)},e.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):s.y3.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},e.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return s.P.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},e.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),s.P.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?h.RD.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(s._f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),h.RD.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},e.prototype._computeViewMatrix=function(t,e,i){if(this.ignoreParentScaling){if(this.parent){var o=this.parent.getWorldMatrix();s.P.TransformCoordinatesToRef(t,o,this._globalPosition),s.P.TransformCoordinatesToRef(e,o,this._tmpTargetVector),s.P.TransformNormalToRef(i,o,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t),this._tmpTargetVector.copyFrom(e),this._tmpUpVector.copyFrom(i);this.getScene().useRightHandedSystem?s.y3.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):s.y3.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?s.y3.LookAtRHToRef(t,e,i,this._viewMatrix):s.y3.LookAtLHToRef(t,e,i,this._viewMatrix),this.parent){o=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(o,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t)},e.prototype.createRigCamera=function(t,i){if(this.cameraRigMode!==r.V.RIG_MODE_NONE){var o=new e(t,this.position.clone(),this.getScene());return o.isRigCamera=!0,o.rigParent=this,this.cameraRigMode!==r.V.RIG_MODE_VR&&this.cameraRigMode!==r.V.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new s._f),o._cameraRigParams={},o.rotationQuaternion=new s._f),o}return null},e.prototype._updateRigCameras=function(){var e=this._rigCameras[0],i=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case r.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case r.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case r.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case r.V.RIG_MODE_STEREOSCOPIC_INTERLACED:var o=this.cameraRigMode===r.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,n=this.cameraRigMode===r.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*o,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*n,i);break;case r.V.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),i.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),i.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),i.position.copyFrom(this.position)}t.prototype._updateRigCameras.call(this)},e.prototype._getRigCamPositionAndTarget=function(t,i){this.getTarget().subtractToRef(this.position,e._TargetFocalPoint),e._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var o=e._TargetFocalPoint.addInPlace(this.position);s.y3.TranslationToRef(-o.x,-o.y,-o.z,e._TargetTransformMatrix),e._TargetTransformMatrix.multiplyToRef(s.y3.RotationAxis(i.upVector,t),e._RigCamTransformMatrix),s.y3.TranslationToRef(o.x,o.y,o.z,e._TargetTransformMatrix),e._RigCamTransformMatrix.multiplyToRef(e._TargetTransformMatrix,e._RigCamTransformMatrix),s.P.TransformCoordinatesToRef(this.position,e._RigCamTransformMatrix,i.position),i.setTarget(o)},e.prototype.getClassName=function(){return"TargetCamera"},e._RigCamTransformMatrix=new s.y3,e._TargetTransformMatrix=new s.y3,e._TargetFocalPoint=new s.P,(0,o.gn)([(0,n.hd)()],e.prototype,"rotation",void 0),(0,o.gn)([(0,n.qC)()],e.prototype,"speed",void 0),(0,o.gn)([(0,n.RR)("lockedTargetId")],e.prototype,"lockedTarget",void 0),e}(r.V)},94925:(t,e,i)=>{i.d(e,{H:()=>s});var o=i(31191),n=i(78098),r=i(58095);i(17834).N.AddNodeConstructor("TouchCamera",(function(t,e){return function(){return new s(t,r.P.Zero(),e)}}));var s=function(t){function e(e,i,o){var n=t.call(this,e,i,o)||this;return n.inputs.addTouch(),n._setupInputs(),n}return(0,o.ZT)(e,t),Object.defineProperty(e.prototype,"touchAngularSensibility",{get:function(){var t=this.inputs.attached.touch;return t?t.touchAngularSensibility:0},set:function(t){var e=this.inputs.attached.touch;e&&(e.touchAngularSensibility=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"touchMoveSensibility",{get:function(){var t=this.inputs.attached.touch;return t?t.touchMoveSensibility:0},set:function(t){var e=this.inputs.attached.touch;e&&(e.touchMoveSensibility=t)},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"TouchCamera"},e.prototype._setupInputs=function(){var t=this.inputs.attached.touch,e=this.inputs.attached.mouse;e?e.touchEnabled=!1:t.allowMouse=!0},e}(n.c)},71143:(t,e,i)=>{i.d(e,{x:()=>h});var o=i(31191),n=i(94925),r=i(17834),s=i(58095),a=i(2055);i(93197);r.N.AddNodeConstructor("FreeCamera",(function(t,e){return function(){return new h(t,s.P.Zero(),e)}}));var h=function(t){function e(e,i,o){var n=t.call(this,e,i,o)||this;return n.inputs.addGamepad(),n}return(0,o.ZT)(e,t),Object.defineProperty(e.prototype,"gamepadAngularSensibility",{get:function(){var t=this.inputs.attached.gamepad;return t?t.gamepadAngularSensibility:0},set:function(t){var e=this.inputs.attached.gamepad;e&&(e.gamepadAngularSensibility=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gamepadMoveSensibility",{get:function(){var t=this.inputs.attached.gamepad;return t?t.gamepadMoveSensibility:0},set:function(t){var e=this.inputs.attached.gamepad;e&&(e.gamepadMoveSensibility=t)},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"UniversalCamera"},e}(n.H);a.V._CreateDefaultParsedCamera=function(t,e){return new h(t,s.P.Zero(),e)}},71218:(t,e,i)=>{i.d(e,{YM:()=>a,u0:()=>l,cO:()=>p.c,pO:()=>u.p,am:()=>d.a});var o,n=i(58095),r=i(62464),s=(o={root:0,found:!1},function(t,e,i,n){o.root=0,o.found=!1;var r=e*e-4*t*i;if(r<0)return o;var s=Math.sqrt(r),a=(-e-s)/(2*t),h=(-e+s)/(2*t);if(a>h){var c=h;h=a,a=c}return a>0&&a<n?(o.root=a,o.found=!0,o):h>0&&h<n?(o.root=h,o.found=!0,o):o}),a=function(){function t(){this._collisionPoint=n.P.Zero(),this._planeIntersectionPoint=n.P.Zero(),this._tempVector=n.P.Zero(),this._tempVector2=n.P.Zero(),this._tempVector3=n.P.Zero(),this._tempVector4=n.P.Zero(),this._edge=n.P.Zero(),this._baseToVertex=n.P.Zero(),this._destinationPoint=n.P.Zero(),this._slidePlaneNormal=n.P.Zero(),this._displacementVector=n.P.Zero(),this._radius=n.P.One(),this._retry=0,this._basePointWorld=n.P.Zero(),this._velocityWorld=n.P.Zero(),this._normalizedVelocity=n.P.Zero(),this._collisionMask=-1}return Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(t){this._collisionMask=isNaN(t)?-1:t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!1,configurable:!0}),t.prototype._initialize=function(t,e,i){this._velocity=e,this._velocitySquaredLength=this._velocity.lengthSquared();var o=Math.sqrt(this._velocitySquaredLength);0===o||1===o?this._normalizedVelocity.copyFromFloats(e._x,e._y,e._z):e.scaleToRef(1/o,this._normalizedVelocity),this._basePoint=t,t.multiplyToRef(this._radius,this._basePointWorld),e.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=i,this.collisionFound=!1},t.prototype._checkPointInTriangle=function(t,e,i,o,r){e.subtractToRef(t,this._tempVector),i.subtractToRef(t,this._tempVector2),n.P.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var s=n.P.Dot(this._tempVector4,r);return!(s<0)&&(o.subtractToRef(t,this._tempVector3),n.P.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((s=n.P.Dot(this._tempVector4,r))<0)&&(n.P.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(s=n.P.Dot(this._tempVector4,r))>=0))},t.prototype._canDoCollision=function(t,e,i,o){var r=n.P.Distance(this._basePointWorld,t),s=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(r>this._velocityWorldLength+s+e)&&!!function(t,e,i,o){return!(t.x>i.x+o||i.x-o>e.x||t.y>i.y+o||i.y-o>e.y||t.z>i.z+o||i.z-o>e.z)}(i,o,this._basePointWorld,this._velocityWorldLength+s)},t.prototype._testTriangle=function(e,i,o,a,h,c,l){var u,p=!1;i||(i=[]),i[e]||(i[e]=new r.J(0,0,0,0),i[e].copyFromPoints(o,a,h));var d=i[e];if(c||d.isFrontFacingTo(this._normalizedVelocity,0)){var _=d.signedDistanceTo(this._basePoint),f=n.P.Dot(d.normal,this._velocity);if(!(t.DoubleSidedCheck&&f>1e-4)){if(0==f){if(Math.abs(_)>=1)return;p=!0,u=0}else{var m=(1-_)/f;if((u=(-1-_)/f)>m){var g=m;m=u,u=g}if(u>1||m<0)return;u<0&&(u=0),u>1&&(u=1)}this._collisionPoint.copyFromFloats(0,0,0);var y=!1,v=1;if(p||(this._basePoint.subtractToRef(d.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(u,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,o,a,h,d.normal)&&(y=!0,v=u,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!y){var b=this._velocitySquaredLength;this._basePoint.subtractToRef(o,this._tempVector);var C=2*n.P.Dot(this._velocity,this._tempVector),R=this._tempVector.lengthSquared()-1,P=s(b,C,R,v);P.found&&(v=P.root,y=!0,this._collisionPoint.copyFrom(o)),this._basePoint.subtractToRef(a,this._tempVector),C=2*n.P.Dot(this._velocity,this._tempVector),R=this._tempVector.lengthSquared()-1,(P=s(b,C,R,v)).found&&(v=P.root,y=!0,this._collisionPoint.copyFrom(a)),this._basePoint.subtractToRef(h,this._tempVector),C=2*n.P.Dot(this._velocity,this._tempVector),R=this._tempVector.lengthSquared()-1,(P=s(b,C,R,v)).found&&(v=P.root,y=!0,this._collisionPoint.copyFrom(h)),a.subtractToRef(o,this._edge),o.subtractToRef(this._basePoint,this._baseToVertex);var T,M=this._edge.lengthSquared(),x=n.P.Dot(this._edge,this._velocity),O=n.P.Dot(this._edge,this._baseToVertex);if(b=M*-this._velocitySquaredLength+x*x,C=2*(M*n.P.Dot(this._velocity,this._baseToVertex)-x*O),R=M*(1-this._baseToVertex.lengthSquared())+O*O,(P=s(b,C,R,v)).found)(T=(x*P.root-O)/M)>=0&&T<=1&&(v=P.root,y=!0,this._edge.scaleInPlace(T),o.addToRef(this._edge,this._collisionPoint));if(h.subtractToRef(a,this._edge),a.subtractToRef(this._basePoint,this._baseToVertex),M=this._edge.lengthSquared(),x=n.P.Dot(this._edge,this._velocity),O=n.P.Dot(this._edge,this._baseToVertex),b=M*-this._velocitySquaredLength+x*x,C=2*(M*n.P.Dot(this._velocity,this._baseToVertex)-x*O),R=M*(1-this._baseToVertex.lengthSquared())+O*O,(P=s(b,C,R,v)).found)(T=(x*P.root-O)/M)>=0&&T<=1&&(v=P.root,y=!0,this._edge.scaleInPlace(T),a.addToRef(this._edge,this._collisionPoint));if(o.subtractToRef(h,this._edge),h.subtractToRef(this._basePoint,this._baseToVertex),M=this._edge.lengthSquared(),x=n.P.Dot(this._edge,this._velocity),O=n.P.Dot(this._edge,this._baseToVertex),b=M*-this._velocitySquaredLength+x*x,C=2*(M*n.P.Dot(this._velocity,this._baseToVertex)-x*O),R=M*(1-this._baseToVertex.lengthSquared())+O*O,(P=s(b,C,R,v)).found)(T=(x*P.root-O)/M)>=0&&T<=1&&(v=P.root,y=!0,this._edge.scaleInPlace(T),h.addToRef(this._edge,this._collisionPoint))}if(y){var w=v*v*this._velocitySquaredLength;(!this.collisionFound||w<this._nearestDistanceSquared)&&(l.collisionResponse&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistanceSquared=w,this._nearestDistance=Math.sqrt(w),this.collisionFound=!0),this.collidedMesh=l)}}}},t.prototype._collide=function(t,e,i,o,n,r,s,a,h,c){if(void 0===c&&(c=!1),c)if(i&&0!==i.length)for(d=o;d<n-2;d+=1){var l=i[d],u=i[d+1],p=i[d+2];if(4294967295!==p){_=e[l],f=e[u],m=e[p];_&&f&&m&&((h?1:0)^d%2?this._testTriangle(d,t,_,f,m,s,a):this._testTriangle(d,t,f,_,m,s,a))}else d+=2}else for(var d=0;d<e.length-2;d+=1){var _=e[d],f=e[d+1],m=e[d+2];_&&f&&m&&((h?1:0)^d%2?this._testTriangle(d,t,_,f,m,s,a):this._testTriangle(d,t,f,_,m,s,a))}else if(i&&0!==i.length)for(d=o;d<n;d+=3){_=e[i[d]-r],f=e[i[d+1]-r],m=e[i[d+2]-r];h?this._testTriangle(d,t,_,f,m,s,a):this._testTriangle(d,t,m,f,_,s,a)}else for(var d=0;d<e.length;d+=3){var _=e[d],f=e[d+1],m=e[d+2];h?this._testTriangle(d,t,_,f,m,s,a):this._testTriangle(d,t,m,f,_,s,a)}},t.prototype._getResponse=function(t,e){t.addToRef(e,this._destinationPoint),e.scaleInPlace(this._nearestDistance/e.length()),this._basePoint.addToRef(e,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(r.J.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,e)},t.DoubleSidedCheck=!1,t}(),h=i(65273),c=i(37290),l=function(){function t(){this._scaledPosition=n.P.Zero(),this._scaledVelocity=n.P.Zero(),this._finalPosition=n.P.Zero()}return t.prototype.getNewPosition=function(t,e,i,o,n,r,s){t.divideToRef(i._radius,this._scaledPosition),e.divideToRef(i._radius,this._scaledVelocity),i.collidedMesh=null,i._retry=0,i._initialVelocity=this._scaledVelocity,i._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,o,this._finalPosition,n),this._finalPosition.multiplyInPlace(i._radius),r(s,this._finalPosition,i.collidedMesh)},t.prototype.createCollider=function(){return new a},t.prototype.init=function(t){this._scene=t},t.prototype._collideWithWorld=function(t,e,i,o,n,r){void 0===r&&(r=null);var s=10*c.D.CollisionsEpsilon;if(i._retry>=o)n.copyFrom(t);else{var a=r?r.collisionMask:i.collisionMask;i._initialize(t,e,s);for(var h=r&&r.surroundingMeshes||this._scene.meshes,l=0;l<h.length;l++){var u=h[l];u.isEnabled()&&u.checkCollisions&&u.subMeshes&&u!==r&&0!=(a&u.collisionGroup)&&u._checkCollision(i)}i.collisionFound?(0===e.x&&0===e.y&&0===e.z||i._getResponse(t,e),e.length()<=s?n.copyFrom(t):(i._retry++,this._collideWithWorld(t,e,i,o,n,r))):t.addToRef(e,n)}},t}();h.x.CollisionCoordinatorFactory=function(){return new l};var u=i(5292),p=i(94184),d=i(72521)},94184:(t,e,i)=>{i.d(e,{c:()=>o});var o=function(t,e,i){this.bu=t,this.bv=e,this.distance=i,this.faceId=0,this.subMeshId=0}},72521:(t,e,i)=>{i.d(e,{a:()=>n});var o=i(58095),n=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new o.P(0,0,0),this._diffPositionForCollisions=new o.P(0,0,0),this._collisionResponse=!0}},5292:(t,e,i)=>{i.d(e,{p:()=>r});var o=i(58095),n=i(72208),r=function(){function t(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}return t.prototype.getNormal=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(n.o.NormalKind))return null;var i,r=this.pickedMesh.getIndices();if(!r)return null;if(e){var s=this.pickedMesh.getVerticesData(n.o.NormalKind),a=o.P.FromArray(s,3*r[3*this.faceId]),h=o.P.FromArray(s,3*r[3*this.faceId+1]),c=o.P.FromArray(s,3*r[3*this.faceId+2]);a=a.scale(this.bu),h=h.scale(this.bv),c=c.scale(1-this.bu-this.bv),i=new o.P(a.x+h.x+c.x,a.y+h.y+c.y,a.z+h.z+c.z)}else{var l=this.pickedMesh.getVerticesData(n.o.PositionKind),u=o.P.FromArray(l,3*r[3*this.faceId]),p=o.P.FromArray(l,3*r[3*this.faceId+1]),d=o.P.FromArray(l,3*r[3*this.faceId+2]),_=u.subtract(p),f=d.subtract(p);i=o.P.Cross(_,f)}if(t){var m=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(o.jp.Matrix[0].copyFrom(m),(m=o.jp.Matrix[0]).setTranslationFromFloats(0,0,0),m.invert(),m.transposeToRef(o.jp.Matrix[1]),m=o.jp.Matrix[1]),i=o.P.TransformNormal(i,m)}return i.normalize(),i},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(n.o.UVKind))return null;var t=this.pickedMesh.getIndices();if(!t)return null;var e=this.pickedMesh.getVerticesData(n.o.UVKind);if(!e)return null;var i=o.FM.FromArray(e,2*t[3*this.faceId]),r=o.FM.FromArray(e,2*t[3*this.faceId+1]),s=o.FM.FromArray(e,2*t[3*this.faceId+2]);return i=i.scale(this.bu),r=r.scale(this.bv),s=s.scale(1-this.bu-this.bv),new o.FM(i.x+r.x+s.x,i.y+r.y+s.y)},t}()},47884:(t,e,i)=>{i.d(e,{e:()=>o});var o=function(){function t(){}return t.UseOpenGLOrientationForUV=!1,t}()},77840:(t,e,i)=>{i.d(e,{e:()=>o.e});var o=i(47884)},27154:(t,e,i)=>{i.d(e,{n:()=>c});var o=i(84318),n=i(62897),r=i(80352),s=i(91153),a=i(69543),h=i(41659),c=function(){function t(e,i,o,c){void 0===c&&(c="");var l,u,p,d=this;this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.uniqueId=0,this.onCompileObservable=new n.y$,this.onErrorObservable=new n.y$,this.onBindObservable=new n.y$,this._wasPreviouslyReady=!1,this._isReady=!1,this._compilationError="",this._key="",this._computeSourceCodeOverride="",this._pipelineContext=null,this._computeSourceCode="",this._rawComputeSourceCode="",this._shaderLanguage=h.x.WGSL,this.name=e,this._key=c,this._engine=o,this.uniqueId=t._UniqueIdSeed++,this.defines=null!==(l=i.defines)&&void 0!==l?l:"",this.onError=i.onError,this.onCompiled=i.onCompiled,this._entryPoint=null!==(u=i.entryPoint)&&void 0!==u?u:"main",this._shaderStore=a.v.GetShadersStore(this._shaderLanguage),this._shaderRepository=a.v.GetShadersRepository(this._shaderLanguage),this._includeShaderStore=a.v.GetIncludesShadersStore(this._shaderLanguage);var _=(0,r.CG)()?this._engine.getHostDocument():null;e.computeSource?p="source:"+e.computeSource:e.computeElement?(p=_?_.getElementById(e.computeElement):null)||(p=e.computeElement):p=e.compute||e;var f={defines:this.defines.split("\n"),indexParameters:void 0,isFragment:!1,shouldUseHighPrecisionShader:!1,processor:null,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:this._shaderRepository,includesShadersStore:this._includeShaderStore,version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:null,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer};this._loadShader(p,"Compute","",(function(t){s.L.Initialize(f),s.L.PreProcess(t,f,(function(o){d._rawComputeSourceCode=t,i.processFinalCode&&(o=i.processFinalCode(o));var n=s.L.Finalize(o,"",f);d._useFinalCode(n.vertexCode,e)}),d._engine)}))}return t.prototype._useFinalCode=function(t,e){if(e){var i=e.computeElement||e.compute||e.spectorName||e;this._computeSourceCode="//#define SHADER_NAME compute:"+i+"\n"+t}else this._computeSourceCode=t;this._prepareEffect()},Object.defineProperty(t.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),t.prototype.isReady=function(){try{return this._isReadyInternal()}catch(t){return!1}},t.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},t.prototype.getEngine=function(){return this._engine},t.prototype.getPipelineContext=function(){return this._pipelineContext},t.prototype.getCompilationError=function(){return this._compilationError},t.prototype.executeWhenCompiled=function(t){var e=this;this.isReady()?t(this):(this.onCompileObservable.add((function(e){t(e)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){e._checkIsReady(null)}),16))},t.prototype._checkIsReady=function(t){var e=this;try{if(this._isReadyInternal())return}catch(e){return void this._processCompilationErrors(e,t)}setTimeout((function(){e._checkIsReady(t)}),16)},t.prototype._loadShader=function(t,e,i,o){var n;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return void o((0,r.v)(t));"source:"!==t.substr(0,7)?"base64:"!==t.substr(0,7)?this._shaderStore[t+e+"Shader"]?o(this._shaderStore[t+e+"Shader"]):i&&this._shaderStore[t+i+"Shader"]?o(this._shaderStore[t+i+"Shader"]):(n="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:this._shaderRepository+t,this._engine._loadFile(n+"."+e.toLowerCase()+".fx",o)):o(window.atob(t.substr(7))):o(t.substr(7))},Object.defineProperty(t.prototype,"computeSourceCode",{get:function(){var t,e;return this._computeSourceCodeOverride?this._computeSourceCodeOverride:null!==(e=null===(t=this._pipelineContext)||void 0===t?void 0:t._getComputeShaderCode())&&void 0!==e?e:this._computeSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rawComputeSourceCode",{get:function(){return this._rawComputeSourceCode},enumerable:!1,configurable:!0}),t.prototype._prepareEffect=function(){var t=this,e=this.defines,i=this._pipelineContext;this._isReady=!1;try{var o=this._engine;this._pipelineContext=o.createComputePipelineContext(),this._pipelineContext._name=this._key,o._prepareComputePipelineContext(this._pipelineContext,this._computeSourceCodeOverride?this._computeSourceCodeOverride:this._computeSourceCode,this._rawComputeSourceCode,this._computeSourceCodeOverride?null:e,this._entryPoint),o._executeWhenComputeStateIsCompiled(this._pipelineContext,(function(){t._compilationError="",t._isReady=!0,t.onCompiled&&t.onCompiled(t),t.onCompileObservable.notifyObservers(t),t.onCompileObservable.clear(),i&&t.getEngine()._deleteComputePipelineContext(i)})),this._pipelineContext.isAsync&&this._checkIsReady(i)}catch(t){this._processCompilationErrors(t,i)}},t.prototype._getShaderCodeAndErrorLine=function(t,e){var i=null;if(e&&t){var o=e.match(/COMPUTE SHADER ERROR: 0:(\d+?):/);if(o&&2===o.length){var n=parseInt(o[1]),r=t.split("\n",-1);r.length>=n&&(i="Offending line [".concat(n,"] in compute code: ").concat(r[n-1]))}}return[t,i]},t.prototype._processCompilationErrors=function(e,i){var n,r;if(void 0===i&&(i=null),this._compilationError=e.message,o.Y.Error("Unable to compile compute effect:"),o.Y.Error("Defines:\r\n"+this.defines),t.LogShaderCodeOnCompilationError){var s=null,a=null;(null===(r=this._pipelineContext)||void 0===r?void 0:r._getComputeShaderCode())&&(a=(n=this._getShaderCodeAndErrorLine(this._pipelineContext._getComputeShaderCode(),this._compilationError))[0],s=n[1],a&&(o.Y.Error("Compute code:"),o.Y.Error(a))),s&&o.Y.Error(s)}o.Y.Error("Error: "+this._compilationError),i&&(this._pipelineContext=i,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this))},t.prototype.dispose=function(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseComputeEffect(this)},t.RegisterShader=function(t,e){a.v.GetShadersStore(h.x.WGSL)["".concat(t,"ComputeShader")]=e},t._UniqueIdSeed=0,t.LogShaderCodeOnCompilationError=!0,t}()},73821:(t,e,i)=>{i.d(e,{U:()=>u});var o=i(31191),n=i(96969),r=i(48620),s=i(34435),a=i(73803),h=i(46310),c=i(84318),l=i(90729),u=function(){function t(t,e,i,n){void 0===n&&(n={}),this._bindings={},this._samplers={},this._contextIsDirty=!1,this.onCompiled=null,this.onError=null,this.name=t,this._engine=e,this.uniqueId=h.K.UniqueId,this._engine.getCaps().supportComputeShaders?n.bindingsMapping?(this._context=e.createComputeContext(),this._shaderPath=i,this._options=(0,o.pi)({bindingsMapping:{},defines:[]},n)):c.Y.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):c.Y.Error("This engine does not support compute shaders!")}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shaderPath",{get:function(){return this._shaderPath},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"ComputeShader"},t.prototype.setTexture=function(t,e,i){void 0===i&&(i=!0);var o=this._bindings[t];this._bindings[t]={type:i?s.t.Texture:s.t.TextureWithoutSampler,object:e,indexInGroupEntries:null==o?void 0:o.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!o||o.object!==e||o.type!==this._bindings[t].type)},t.prototype.setStorageTexture=function(t,e){var i=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==e),this._bindings[t]={type:s.t.StorageTexture,object:e,indexInGroupEntries:null==i?void 0:i.indexInGroupEntries}},t.prototype.setUniformBuffer=function(t,e){var i=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==e),this._bindings[t]={type:s.t.UniformBuffer,object:e,indexInGroupEntries:null==i?void 0:i.indexInGroupEntries}},t.prototype.setStorageBuffer=function(t,e){var i=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==e),this._bindings[t]={type:s.t.StorageBuffer,object:e,indexInGroupEntries:null==i?void 0:i.indexInGroupEntries}},t.prototype.setTextureSampler=function(t,e){var i=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!i||!e.compareSampler(i.object)),this._bindings[t]={type:s.t.Sampler,object:e,indexInGroupEntries:null==i?void 0:i.indexInGroupEntries}},t.prototype.isReady=function(){var t=this._effect;for(var e in this._bindings){var i=this._bindings[e],o=i.type,n=i.object;switch(o){case s.t.Texture:case s.t.TextureWithoutSampler:case s.t.StorageTexture:if(!n.isReady())return!1}}var r=[],a=this._shaderPath;if(this._options.defines)for(var h=0;h<this._options.defines.length;h++)r.push(this._options.defines[h]);var c=r.join("\n");return this._cachedDefines!==c&&(this._cachedDefines=c,t=this._engine.createComputeEffect(a,{defines:c,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=t),!!t.isReady()},t.prototype.dispatch=function(t,e,i){var o;if(!this.isReady())return!1;for(var n in this._bindings){var r=this._bindings[n];if(!this._options.bindingsMapping[n])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+n+"'");if(r.type===s.t.Texture){var a=this._samplers[n],h=r.object;a&&h._texture&&a.compareSampler(h._texture)||(this._samplers[n]=(new l.a).setParameters(h.wrapU,h.wrapV,h.wrapR,h.anisotropicFilteringLevel,h._texture.samplingMode,null===(o=h._texture)||void 0===o?void 0:o._comparisonFunction),this._contextIsDirty=!0)}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),this._engine.computeDispatch(this._effect,this._context,this._bindings,t,e,i,this._options.bindingsMapping),!0},t.prototype.dispatchWhenReady=function(t,e,i,o){var n=this;return void 0===o&&(o=10),new Promise((function(r){var s=function(){n.dispatch(t,e,i)?r():setTimeout(s,o)};s()}))},t.prototype.serialize=function(){var t=n.p4.Serialize(this);for(var e in t.options=this._options,t.shaderPath=this._shaderPath,t.bindings={},t.textures={},this._bindings){var i=this._bindings[e],o=i.object;switch(i.type){case s.t.Texture:case s.t.TextureWithoutSampler:case s.t.StorageTexture:var r=o.serialize();r&&(t.textures[e]=r,t.bindings[e]={type:i.type});case s.t.UniformBuffer:}}return t},t.Parse=function(e,i,o){var r=n.p4.Parse((function(){return new t(e.name,i.getEngine(),e.shaderPath,e.options)}),e,i,o);for(var h in e.textures){var c=e.bindings[h],l=a.x.Parse(e.textures[h],i,o);c.type===s.t.Texture?r.setTexture(h,l):c.type===s.t.TextureWithoutSampler?r.setTexture(h,l,!1):r.setStorageTexture(h,l)}return r},(0,o.gn)([(0,n.qC)()],t.prototype,"name",void 0),t}();(0,r.H)("BABYLON.ComputeShader",u)},93553:(t,e,i)=>{i.d(e,{U:()=>n.U,n:()=>o.n});var o=i(27154),n=i(73821)},33178:(t,e,i)=>{i.d(e,{k:()=>s});var o=i(48939),n=i(58095),r=i(48154),s=function(){function t(t,e,i){this.vectors=o.B.BuildArray(8,n.P.Zero),this.center=n.P.Zero(),this.centerWorld=n.P.Zero(),this.extendSize=n.P.Zero(),this.extendSizeWorld=n.P.Zero(),this.directions=o.B.BuildArray(3,n.P.Zero),this.vectorsWorld=o.B.BuildArray(8,n.P.Zero),this.minimumWorld=n.P.Zero(),this.maximumWorld=n.P.Zero(),this.minimum=n.P.Zero(),this.maximum=n.P.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(t,e,i)}return t.prototype.reConstruct=function(t,e,i){var o=t.x,r=t.y,s=t.z,a=e.x,h=e.y,c=e.z,l=this.vectors;this.minimum.copyFromFloats(o,r,s),this.maximum.copyFromFloats(a,h,c),l[0].copyFromFloats(o,r,s),l[1].copyFromFloats(a,h,c),l[2].copyFromFloats(a,r,s),l[3].copyFromFloats(o,h,s),l[4].copyFromFloats(o,r,c),l[5].copyFromFloats(a,h,s),l[6].copyFromFloats(o,h,c),l[7].copyFromFloats(a,r,c),e.addToRef(t,this.center).scaleInPlace(.5),e.subtractToRef(t,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||n.y3.IdentityReadOnly,this._update(this._worldMatrix)},t.prototype.scale=function(e){var i=t._TmpVector3,o=this.maximum.subtractToRef(this.minimum,i[0]),n=o.length();o.normalizeFromLength(n);var r=n*e,s=o.scaleInPlace(.5*r),a=this.center.subtractToRef(s,i[1]),h=this.center.addToRef(s,i[2]);return this.reConstruct(a,h,this._worldMatrix),this},t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(t){var e=this.minimumWorld,i=this.maximumWorld,o=this.directions,r=this.vectorsWorld,s=this.vectors;if(t.isIdentity()){e.copyFrom(this.minimum),i.copyFrom(this.maximum);for(a=0;a<8;++a)r[a].copyFrom(s[a]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{e.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(var a=0;a<8;++a){var h=r[a];n.P.TransformCoordinatesToRef(s[a],t,h),e.minimizeInPlace(h),i.maximizeInPlace(h)}i.subtractToRef(e,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(e,this.centerWorld).scaleInPlace(.5)}n.P.FromArrayToRef(t.m,0,o[0]),n.P.FromArrayToRef(t.m,4,o[1]),n.P.FromArrayToRef(t.m,8,o[2]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.isCompletelyInFrustum=function(e){return t.IsCompletelyInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t){var e=this.minimumWorld,i=this.maximumWorld,o=e.x,n=e.y,s=e.z,a=i.x,h=i.y,c=i.z,l=t.x,u=t.y,p=t.z,d=-r.kn;return!(a-l<d||d>l-o)&&(!(h-u<d||d>u-n)&&!(c-p<d||d>p-s))},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(t,e){var i=this.minimumWorld,o=this.maximumWorld,n=i.x,r=i.y,s=i.z,a=o.x,h=o.y,c=o.z,l=t.x,u=t.y,p=t.z,d=e.x,_=e.y,f=e.z;return!(a<l||n>d)&&(!(h<u||r>_)&&!(c<p||s>f))},t.prototype.dispose=function(){var t,e;null===(t=this._drawWrapperFront)||void 0===t||t.dispose(),null===(e=this._drawWrapperBack)||void 0===e||e.dispose()},t.Intersects=function(t,e){return t.intersectsMinMax(e.minimumWorld,e.maximumWorld)},t.IntersectsSphere=function(e,i,o,r){var s=t._TmpVector3[0];return n.P.ClampToRef(o,e,i,s),n.P.DistanceSquared(o,s)<=r*r},t.IsCompletelyInFrustum=function(t,e){for(var i=0;i<6;++i)for(var o=e[i],n=0;n<8;++n)if(o.dotCoordinate(t[n])<0)return!1;return!0},t.IsInFrustum=function(t,e){for(var i=0;i<6;++i){for(var o=!0,n=e[i],r=0;r<8;++r)if(n.dotCoordinate(t[r])>=0){o=!1;break}if(o)return!1}return!0},t._TmpVector3=o.B.BuildArray(3,n.P.Zero),t}()},91859:(t,e,i)=>{i.d(e,{j:()=>u});var o=i(48939),n=i(58095),r=i(33178),s=i(14750),a={min:0,max:0},h={min:0,max:0},c=function(t,e,i){var o=n.P.Dot(e.centerWorld,t),r=Math.abs(n.P.Dot(e.directions[0],t))*e.extendSize.x+Math.abs(n.P.Dot(e.directions[1],t))*e.extendSize.y+Math.abs(n.P.Dot(e.directions[2],t))*e.extendSize.z;i.min=o-r,i.max=o+r},l=function(t,e,i){return c(t,e,a),c(t,i,h),!(a.min>h.max||h.min>a.max)},u=function(){function t(t,e,i){this._isLocked=!1,this.boundingBox=new r.k(t,e,i),this.boundingSphere=new s.K(t,e,i)}return t.prototype.reConstruct=function(t,e,i){this.boundingBox.reConstruct(t,e,i),this.boundingSphere.reConstruct(t,e,i)},Object.defineProperty(t.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLocked",{get:function(){return this._isLocked},set:function(t){this._isLocked=t},enumerable:!1,configurable:!0}),t.prototype.update=function(t){this._isLocked||(this.boundingBox._update(t),this.boundingSphere._update(t))},t.prototype.centerOn=function(e,i){var o=t._TmpVector3[0].copyFrom(e).subtractInPlace(i),n=t._TmpVector3[1].copyFrom(e).addInPlace(i);return this.boundingBox.reConstruct(o,n,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(o,n,this.boundingBox.getWorldMatrix()),this},t.prototype.encapsulate=function(t){var e=n.P.Minimize(this.minimum,t),i=n.P.Maximize(this.maximum,t);return this.reConstruct(e,i,this.boundingBox.getWorldMatrix()),this},t.prototype.encapsulateBoundingInfo=function(t){return this.encapsulate(t.boundingBox.centerWorld.subtract(t.boundingBox.extendSizeWorld)),this.encapsulate(t.boundingBox.centerWorld.add(t.boundingBox.extendSizeWorld)),this},t.prototype.scale=function(t){return this.boundingBox.scale(t),this.boundingSphere.scale(t),this},t.prototype.isInFrustum=function(t,e){return void 0===e&&(e=0),!(2!==e&&3!==e||!this.boundingSphere.isCenterInFrustum(t))||!!this.boundingSphere.isInFrustum(t)&&(!(1!==e&&3!==e)||this.boundingBox.isInFrustum(t))},Object.defineProperty(t.prototype,"diagonalLength",{get:function(){var e=this.boundingBox;return e.maximumWorld.subtractToRef(e.minimumWorld,t._TmpVector3[0]).length()},enumerable:!1,configurable:!0}),t.prototype.isCompletelyInFrustum=function(t){return this.boundingBox.isCompletelyInFrustum(t)},t.prototype._checkCollision=function(t){return t._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(t){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(t)&&!!this.boundingBox.intersectsPoint(t))},t.prototype.intersects=function(t,e){if(!s.K.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!r.k.Intersects(this.boundingBox,t.boundingBox))return!1;if(!e)return!0;var i=this.boundingBox,o=t.boundingBox;return!!l(i.directions[0],i,o)&&(!!l(i.directions[1],i,o)&&(!!l(i.directions[2],i,o)&&(!!l(o.directions[0],i,o)&&(!!l(o.directions[1],i,o)&&(!!l(o.directions[2],i,o)&&(!!l(n.P.Cross(i.directions[0],o.directions[0]),i,o)&&(!!l(n.P.Cross(i.directions[0],o.directions[1]),i,o)&&(!!l(n.P.Cross(i.directions[0],o.directions[2]),i,o)&&(!!l(n.P.Cross(i.directions[1],o.directions[0]),i,o)&&(!!l(n.P.Cross(i.directions[1],o.directions[1]),i,o)&&(!!l(n.P.Cross(i.directions[1],o.directions[2]),i,o)&&(!!l(n.P.Cross(i.directions[2],o.directions[0]),i,o)&&(!!l(n.P.Cross(i.directions[2],o.directions[1]),i,o)&&!!l(n.P.Cross(i.directions[2],o.directions[2]),i,o))))))))))))))},t._TmpVector3=o.B.BuildArray(2,n.P.Zero),t}()},14750:(t,e,i)=>{i.d(e,{K:()=>r});var o=i(48939),n=i(58095),r=function(){function t(t,e,i){this.center=n.P.Zero(),this.centerWorld=n.P.Zero(),this.minimum=n.P.Zero(),this.maximum=n.P.Zero(),this.reConstruct(t,e,i)}return t.prototype.reConstruct=function(t,e,i){this.minimum.copyFrom(t),this.maximum.copyFrom(e);var o=n.P.Distance(t,e);e.addToRef(t,this.center).scaleInPlace(.5),this.radius=.5*o,this._update(i||n.y3.IdentityReadOnly)},t.prototype.scale=function(e){var i=this.radius*e,o=t._TmpVector3,n=o[0].setAll(i),r=this.center.subtractToRef(n,o[1]),s=this.center.addToRef(n,o[2]);return this.reConstruct(r,s,this._worldMatrix),this},t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype._update=function(e){if(e.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{n.P.TransformCoordinatesToRef(this.center,e,this.centerWorld);var i=t._TmpVector3[0];n.P.TransformNormalFromFloatsToRef(1,1,1,e,i),this.radiusWorld=Math.max(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z))*this.radius}},t.prototype.isInFrustum=function(t){for(var e=this.centerWorld,i=this.radiusWorld,o=0;o<6;o++)if(t[o].dotCoordinate(e)<=-i)return!1;return!0},t.prototype.isCenterInFrustum=function(t){for(var e=this.centerWorld,i=0;i<6;i++)if(t[i].dotCoordinate(e)<0)return!1;return!0},t.prototype.intersectsPoint=function(t){var e=n.P.DistanceSquared(this.centerWorld,t);return!(this.radiusWorld*this.radiusWorld<e)},t.Intersects=function(t,e){var i=n.P.DistanceSquared(t.centerWorld,e.centerWorld),o=t.radiusWorld+e.radiusWorld;return!(o*o<i)},t.CreateFromCenterAndRadius=function(e,i,o){this._TmpVector3[0].copyFrom(e),this._TmpVector3[1].copyFromFloats(0,0,i),this._TmpVector3[2].copyFrom(e),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);var r=new t(this._TmpVector3[0],this._TmpVector3[2]);return r._worldMatrix=o||n.y3.Identity(),r},t._TmpVector3=o.B.BuildArray(3,n.P.Zero),t}()},25235:(t,e,i)=>{i.d(e,{kB:()=>o.k,jF:()=>n.j,KM:()=>r.K,Vu:()=>c,b2:()=>h,Zb:()=>f,zH:()=>p.z});var o=i(33178),n=i(91859),r=i(14750),s=i(7788),a=i(58095),h=function(){function t(t,e,i,o,n,r){this.entries=new Array,this._boundingVectors=new Array,this._capacity=i,this._depth=o,this._maxDepth=n,this._creationFunc=r,this._minPoint=t,this._maxPoint=e,this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors[2].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[3].y=e.y,this._boundingVectors.push(t.clone()),this._boundingVectors[4].z=e.z,this._boundingVectors.push(e.clone()),this._boundingVectors[5].z=t.z,this._boundingVectors.push(e.clone()),this._boundingVectors[6].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[7].y=t.y}return Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!1,configurable:!0}),t.prototype.addEntry=function(t){if(this.blocks)for(var e=0;e<this.blocks.length;e++){this.blocks[e].addEntry(t)}else this._creationFunc(t,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},t.prototype.removeEntry=function(t){if(this.blocks)for(var e=0;e<this.blocks.length;e++){this.blocks[e].removeEntry(t)}else{var i=this.entries.indexOf(t);i>-1&&this.entries.splice(i,1)}},t.prototype.addEntries=function(t){for(var e=0;e<t.length;e++){var i=t[e];this.addEntry(i)}},t.prototype.select=function(t,e,i){if(o.k.IsInFrustum(this._boundingVectors,t)){if(this.blocks){for(var n=0;n<this.blocks.length;n++){this.blocks[n].select(t,e,i)}return}i?e.concat(this.entries):e.concatWithNoDuplicate(this.entries)}},t.prototype.intersects=function(t,e,i,n){if(o.k.IntersectsSphere(this._minPoint,this._maxPoint,t,e)){if(this.blocks){for(var r=0;r<this.blocks.length;r++){this.blocks[r].intersects(t,e,i,n)}return}n?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}},t.prototype.intersectsRay=function(t,e){if(t.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var i=0;i<this.blocks.length;i++){this.blocks[i].intersectsRay(t,e)}return}e.concatWithNoDuplicate(this.entries)}},t.prototype.createInnerBlocks=function(){t._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},t._CreateBlocks=function(e,i,o,n,r,s,h,c){h.blocks=new Array;for(var l=new a.P((i.x-e.x)/2,(i.y-e.y)/2,(i.z-e.z)/2),u=0;u<2;u++)for(var p=0;p<2;p++)for(var d=0;d<2;d++){var _=new t(e.add(l.multiplyByFloats(u,p,d)),e.add(l.multiplyByFloats(u+1,p+1,d+1)),n,r+1,s,c);_.addEntries(o),h.blocks.push(_)}},t}(),c=function(){function t(t,e,i){void 0===i&&(i=2),this.maxDepth=i,this.dynamicContent=new Array,this._maxBlockCapacity=e||64,this._selectionContent=new s.f(1024),this._creationFunc=t}return t.prototype.update=function(t,e,i){h._CreateBlocks(t,e,i,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},t.prototype.addMesh=function(t){for(var e=0;e<this.blocks.length;e++){this.blocks[e].addEntry(t)}},t.prototype.removeMesh=function(t){for(var e=0;e<this.blocks.length;e++){this.blocks[e].removeEntry(t)}},t.prototype.select=function(t,e){this._selectionContent.reset();for(var i=0;i<this.blocks.length;i++){this.blocks[i].select(t,this._selectionContent,e)}return e?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersects=function(t,e,i){this._selectionContent.reset();for(var o=0;o<this.blocks.length;o++){this.blocks[o].intersects(t,e,this._selectionContent,i)}return i?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersectsRay=function(t){this._selectionContent.reset();for(var e=0;e<this.blocks.length;e++){this.blocks[e].intersectsRay(t,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.CreationFuncForMeshes=function(t,e){var i=t.getBoundingInfo();!t.isBlocked&&i.boundingBox.intersectsMinMax(e.minPoint,e.maxPoint)&&e.entries.push(t)},t.CreationFuncForSubMeshes=function(t,e){t.getBoundingInfo().boundingBox.intersectsMinMax(e.minPoint,e.maxPoint)&&e.entries.push(t)},t}(),l=i(65273),u=i(71419),p=i(1316),d=i(85627),_=i(15210);l.x.prototype.createOrUpdateSelectionOctree=function(t,e){void 0===t&&(t=64),void 0===e&&(e=2);var i=this._getComponent(d.l.NAME_OCTREE);i||(i=new f(this),this._addComponent(i)),this._selectionOctree||(this._selectionOctree=new c(c.CreationFuncForMeshes,t,e));var o=this.getWorldExtends();return this._selectionOctree.update(o.min,o.max,this.meshes),this._selectionOctree},Object.defineProperty(l.x.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),u.x.prototype.createOrUpdateSubmeshesOctree=function(t,e){void 0===t&&(t=64),void 0===e&&(e=2);var i=this.getScene(),o=i._getComponent(d.l.NAME_OCTREE);o||(o=new f(i),i._addComponent(o)),this._submeshesOctree||(this._submeshesOctree=new c(c.CreationFuncForSubMeshes,t,e)),this.computeWorldMatrix(!0);var n=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(n.minimumWorld,n.maximumWorld,this.subMeshes),this._submeshesOctree};var f=function(){function t(t){this.name=d.l.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new p.z(a.P.Zero(),new a.P(1,1,1)),(t=t||_.l.LastCreatedScene)&&(this.scene=t,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this))}return t.prototype.register=function(){var t=this;this.scene.onMeshRemovedObservable.add((function(e){var i=t.scene.selectionOctree;if(null!=i){var o=i.dynamicContent.indexOf(e);-1!==o&&i.dynamicContent.splice(o,1)}})),this.scene.onMeshImportedObservable.add((function(e){var i=t.scene.selectionOctree;null!=i&&i.addMesh(e)}))},t.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},t.prototype.getActiveSubMeshCandidates=function(t){return t._submeshesOctree&&t.useOctreeForRenderingSelection?t._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(t)},t.prototype.getIntersectingSubMeshCandidates=function(t,e){return t._submeshesOctree&&t.useOctreeForPicking?(p.z.TransformToRef(e,t.getWorldMatrix(),this._tempRay),t._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(t)},t.prototype.getCollidingSubMeshCandidates=function(t,e){if(t._submeshesOctree&&t.useOctreeForCollisions){var i=e._velocityWorldLength+Math.max(e._radius.x,e._radius.y,e._radius.z);return t._submeshesOctree.intersects(e._basePointWorld,i)}return this.scene._getDefaultSubMeshCandidates(t)},t.prototype.rebuild=function(){},t.prototype.dispose=function(){},t}()},1316:(t,e,i)=>{i.d(e,{z:()=>l});var o=i(48939),n=i(58095),r=i(5292),s=i(94184),a=i(65273),h=i(2055),c=i(15210),l=function(){function t(t,e,i){void 0===i&&(i=Number.MAX_VALUE),this.origin=t,this.direction=e,this.length=i}return t.prototype.clone=function(){return new t(this.origin.clone(),this.direction.clone(),this.length)},t.prototype.intersectsBoxMinMax=function(e,i,o){void 0===o&&(o=0);var n,r,s,a,h=t._TmpVector3[0].copyFromFloats(e.x-o,e.y-o,e.z-o),c=t._TmpVector3[1].copyFromFloats(i.x+o,i.y+o,i.z+o),l=0,u=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<h.x||this.origin.x>c.x)return!1}else if(n=1/this.direction.x,r=(h.x-this.origin.x)*n,(s=(c.x-this.origin.x)*n)===-1/0&&(s=1/0),r>s&&(a=r,r=s,s=a),(l=Math.max(r,l))>(u=Math.min(s,u)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<h.y||this.origin.y>c.y)return!1}else if(n=1/this.direction.y,r=(h.y-this.origin.y)*n,(s=(c.y-this.origin.y)*n)===-1/0&&(s=1/0),r>s&&(a=r,r=s,s=a),(l=Math.max(r,l))>(u=Math.min(s,u)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<h.z||this.origin.z>c.z)return!1}else if(n=1/this.direction.z,r=(h.z-this.origin.z)*n,(s=(c.z-this.origin.z)*n)===-1/0&&(s=1/0),r>s&&(a=r,r=s,s=a),(l=Math.max(r,l))>(u=Math.min(s,u)))return!1;return!0},t.prototype.intersectsBox=function(t,e){return void 0===e&&(e=0),this.intersectsBoxMinMax(t.minimum,t.maximum,e)},t.prototype.intersectsSphere=function(t,e){void 0===e&&(e=0);var i=t.center.x-this.origin.x,o=t.center.y-this.origin.y,n=t.center.z-this.origin.z,r=i*i+o*o+n*n,s=t.radius+e,a=s*s;if(r<=a)return!0;var h=i*this.direction.x+o*this.direction.y+n*this.direction.z;return!(h<0)&&r-h*h<=a},t.prototype.intersectsTriangle=function(e,i,o){var r=t._TmpVector3[0],a=t._TmpVector3[1],h=t._TmpVector3[2],c=t._TmpVector3[3],l=t._TmpVector3[4];i.subtractToRef(e,r),o.subtractToRef(e,a),n.P.CrossToRef(this.direction,a,h);var u=n.P.Dot(r,h);if(0===u)return null;var p=1/u;this.origin.subtractToRef(e,c);var d=n.P.Dot(c,h)*p;if(d<0||d>1)return null;n.P.CrossToRef(c,r,l);var _=n.P.Dot(this.direction,l)*p;if(_<0||d+_>1)return null;var f=n.P.Dot(a,l)*p;return f>this.length?null:new s.c(1-d-_,d,f)},t.prototype.intersectsPlane=function(t){var e,i=n.P.Dot(t.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;var o=n.P.Dot(t.normal,this.origin);return(e=(-t.d-o)/i)<0?e<-9.99999997475243e-7?null:0:e},t.prototype.intersectsAxis=function(t,e){switch(void 0===e&&(e=0),t){case"y":return(i=(this.origin.y-e)/this.direction.y)>0?null:new n.P(this.origin.x+this.direction.x*-i,e,this.origin.z+this.direction.z*-i);case"x":return(i=(this.origin.x-e)/this.direction.x)>0?null:new n.P(e,this.origin.y+this.direction.y*-i,this.origin.z+this.direction.z*-i);case"z":var i;return(i=(this.origin.z-e)/this.direction.z)>0?null:new n.P(this.origin.x+this.direction.x*-i,this.origin.y+this.direction.y*-i,e);default:return null}},t.prototype.intersectsMesh=function(e,i){var o=n.jp.Matrix[0];return e.getWorldMatrix().invertToRef(o),this._tmpRay?t.TransformToRef(this,o,this._tmpRay):this._tmpRay=t.Transform(this,o),e.intersects(this._tmpRay,i)},t.prototype.intersectsMeshes=function(t,e,i){i?i.length=0:i=[];for(var o=0;o<t.length;o++){var n=this.intersectsMesh(t[o],e);n.hit&&i.push(n)}return i.sort(this._comparePickingInfo),i},t.prototype._comparePickingInfo=function(t,e){return t.distance<e.distance?-1:t.distance>e.distance?1:0},t.prototype.intersectionSegment=function(e,i,o){var r=this.origin,s=n.jp.Vector3[0],a=n.jp.Vector3[1],h=n.jp.Vector3[2],c=n.jp.Vector3[3];i.subtractToRef(e,s),this.direction.scaleToRef(t._Rayl,h),r.addToRef(h,a),e.subtractToRef(r,c);var l,u,p=n.P.Dot(s,s),d=n.P.Dot(s,h),_=n.P.Dot(h,h),f=n.P.Dot(s,c),m=n.P.Dot(h,c),g=p*_-d*d,y=g,v=g;g<t._Smallnum?(l=0,y=1,u=m,v=_):(u=p*m-d*f,(l=d*m-_*f)<0?(l=0,u=m,v=_):l>y&&(l=y,u=m+d,v=_)),u<0?(u=0,-f<0?l=0:-f>p?l=y:(l=-f,y=p)):u>v&&(u=v,-f+d<0?l=0:-f+d>p?l=y:(l=-f+d,y=p));var b=Math.abs(l)<t._Smallnum?0:l/y,C=Math.abs(u)<t._Smallnum?0:u/v,R=n.jp.Vector3[4];h.scaleToRef(C,R);var P=n.jp.Vector3[5];s.scaleToRef(b,P),P.addInPlace(c);var T=n.jp.Vector3[6];return P.subtractToRef(R,T),C>0&&C<=this.length&&T.lengthSquared()<o*o?P.length():-1},t.prototype.update=function(e,i,o,r,s,a,h,c){if(void 0===c&&(c=!1),c){t._RayDistant||(t._RayDistant=t.Zero()),t._RayDistant.unprojectRayToRef(e,i,o,r,n.y3.IdentityReadOnly,a,h);var l=n.jp.Matrix[0];s.invertToRef(l),t.TransformToRef(t._RayDistant,l,this)}else this.unprojectRayToRef(e,i,o,r,s,a,h);return this},t.Zero=function(){return new t(n.P.Zero(),n.P.Zero())},t.CreateNew=function(e,i,o,n,r,s,a){return t.Zero().update(e,i,o,n,r,s,a)},t.CreateNewFromTo=function(e,i,o){void 0===o&&(o=n.y3.IdentityReadOnly);var r=i.subtract(e),s=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);return r.normalize(),t.Transform(new t(e,r,s),o)},t.Transform=function(e,i){var o=new t(new n.P(0,0,0),new n.P(0,0,0));return t.TransformToRef(e,i,o),o},t.TransformToRef=function(t,e,i){n.P.TransformCoordinatesToRef(t.origin,e,i.origin),n.P.TransformNormalToRef(t.direction,e,i.direction),i.length=t.length;var o=i.direction,r=o.length();if(0!==r&&1!==r){var s=1/r;o.x*=s,o.y*=s,o.z*=s,i.length*=r}},t.prototype.unprojectRayToRef=function(t,e,i,o,r,s,a){var h,l=n.jp.Matrix[0];r.multiplyToRef(s,l),l.multiplyToRef(a,l),l.invert();var u=n.jp.Vector3[0];u.x=t/i*2-1,u.y=-(e/o*2-1),u.z=(null===(h=c.l.LastCreatedEngine)||void 0===h?void 0:h.isNDCHalfZRange)?0:-1;var p=n.jp.Vector3[1].copyFromFloats(u.x,u.y,1-1e-8),d=n.jp.Vector3[2],_=n.jp.Vector3[3];n.P._UnprojectFromInvertedMatrixToRef(u,l,d),n.P._UnprojectFromInvertedMatrixToRef(p,l,_),this.origin.copyFrom(d),_.subtractToRef(d,this.direction),this.direction.normalize()},t._TmpVector3=o.B.BuildArray(6,n.P.Zero),t._RayDistant=t.Zero(),t._Smallnum=1e-8,t._Rayl=1e9,t}();a.x.prototype.createPickingRay=function(t,e,i,o,n){void 0===n&&(n=!1);var r=l.Zero();return this.createPickingRayToRef(t,e,i,r,o,n),r},a.x.prototype.createPickingRayToRef=function(t,e,i,o,r,s,a){void 0===s&&(s=!1),void 0===a&&(a=!1);var h=this.getEngine();if(!r){if(!this.activeCamera)return this;r=this.activeCamera}var c=r.viewport.toGlobal(h.getRenderWidth(),h.getRenderHeight());return t=t/h.getHardwareScalingLevel()-c.x,e=e/h.getHardwareScalingLevel()-(h.getRenderHeight()-c.y-c.height),o.update(t,e,c.width,c.height,i||n.y3.IdentityReadOnly,s?n.y3.IdentityReadOnly:r.getViewMatrix(),r.getProjectionMatrix(),a),this},a.x.prototype.createPickingRayInCameraSpace=function(t,e,i){var o=l.Zero();return this.createPickingRayInCameraSpaceToRef(t,e,o,i),o},a.x.prototype.createPickingRayInCameraSpaceToRef=function(t,e,i,o){if(!r.p)return this;var s=this.getEngine();if(!o){if(!this.activeCamera)throw new Error("Active camera not set");o=this.activeCamera}var a=o.viewport.toGlobal(s.getRenderWidth(),s.getRenderHeight()),h=n.y3.Identity();return t=t/s.getHardwareScalingLevel()-a.x,e=e/s.getHardwareScalingLevel()-(s.getRenderHeight()-a.y-a.height),i.update(t,e,a.width,a.height,h,h,o.getProjectionMatrix()),this},a.x.prototype._internalPickForMesh=function(t,e,i,o,n,r,s,a){var h=e(o,i.enableDistantPicking),c=i.intersects(h,n,s,r,o,a);return c&&c.hit?!n&&null!=t&&c.distance>=t.distance?null:c:null},a.x.prototype._internalPick=function(t,e,i,o,s){if(!r.p)return null;for(var a=null,h=0;h<this.meshes.length;h++){var c=this.meshes[h];if(e){if(!e(c))continue}else if(!c.isEnabled()||!c.isVisible||!c.isPickable)continue;var l,u=c.getWorldMatrix();if(c.hasThinInstances&&c.thinInstanceEnablePicking){if(l=this._internalPickForMesh(a,t,c,u,!0,!0,s)){if(o)return l;for(var p=n.jp.Matrix[1],d=c.thinInstanceGetWorldMatrices(),_=0;_<d.length;_++){d[_].multiplyToRef(u,p);var f=this._internalPickForMesh(a,t,c,p,i,o,s,!0);if(f&&((a=f).thinInstanceIndex=_,i))return a}}}else if((l=this._internalPickForMesh(a,t,c,u,i,o,s))&&(a=l,i))return a}return a||new r.p},a.x.prototype._internalMultiPick=function(t,e,i){if(!r.p)return null;for(var o=new Array,s=0;s<this.meshes.length;s++){var a=this.meshes[s];if(e){if(!e(a))continue}else if(!a.isEnabled()||!a.isVisible||!a.isPickable)continue;var h,c=a.getWorldMatrix();if(a.hasThinInstances&&a.thinInstanceEnablePicking){if(h=this._internalPickForMesh(null,t,a,c,!0,!0,i))for(var l=n.jp.Matrix[1],u=a.thinInstanceGetWorldMatrices(),p=0;p<u.length;p++){u[p].multiplyToRef(c,l);var d=this._internalPickForMesh(null,t,a,l,!1,!1,i,!0);d&&(d.thinInstanceIndex=p,o.push(d))}}else(h=this._internalPickForMesh(null,t,a,c,!1,!1,i))&&o.push(h)}return o},a.x.prototype.pickWithBoundingInfo=function(t,e,i,o,s){var a=this;if(!r.p)return null;var h=this._internalPick((function(i){return a._tempPickingRay||(a._tempPickingRay=l.Zero()),a.createPickingRayToRef(t,e,i,a._tempPickingRay,s||null),a._tempPickingRay}),i,o,!0);return h&&(h.ray=this.createPickingRay(t,e,n.y3.Identity(),s||null)),h},a.x.prototype.pick=function(t,e,i,o,s,a,h){var c=this;if(void 0===h&&(h=!1),!r.p)return null;var u=this._internalPick((function(i,o){return c._tempPickingRay||(c._tempPickingRay=l.Zero()),c.createPickingRayToRef(t,e,i,c._tempPickingRay,s||null,!1,o),c._tempPickingRay}),i,o,!1,a);return u&&(u.ray=this.createPickingRay(t,e,n.y3.Identity(),s||null)),u},a.x.prototype.pickWithRay=function(t,e,i,o){var r=this,s=this._internalPick((function(e){return r._pickWithRayInverseMatrix||(r._pickWithRayInverseMatrix=n.y3.Identity()),e.invertToRef(r._pickWithRayInverseMatrix),r._cachedRayForTransform||(r._cachedRayForTransform=l.Zero()),l.TransformToRef(t,r._pickWithRayInverseMatrix,r._cachedRayForTransform),r._cachedRayForTransform}),e,i,!1,o);return s&&(s.ray=t),s},a.x.prototype.multiPick=function(t,e,i,o,n){var r=this;return this._internalMultiPick((function(i){return r.createPickingRay(t,e,i,o||null)}),i,n)},a.x.prototype.multiPickWithRay=function(t,e,i){var o=this;return this._internalMultiPick((function(e){return o._pickWithRayInverseMatrix||(o._pickWithRayInverseMatrix=n.y3.Identity()),e.invertToRef(o._pickWithRayInverseMatrix),o._cachedRayForTransform||(o._cachedRayForTransform=l.Zero()),l.TransformToRef(t,o._pickWithRayInverseMatrix,o._cachedRayForTransform),o._cachedRayForTransform}),e,i)},h.V.prototype.getForwardRay=function(t,e,i){return void 0===t&&(t=100),this.getForwardRayToRef(new l(n.P.Zero(),n.P.Zero(),t),t,e,i)},h.V.prototype.getForwardRayToRef=function(t,e,i,o){return void 0===e&&(e=100),i||(i=this.getWorldMatrix()),t.length=e,o?t.origin.copyFrom(o):t.origin.copyFrom(this.position),n.jp.Vector3[2].set(0,0,this._scene.useRightHandedSystem?-1:1),n.P.TransformNormalToRef(n.jp.Vector3[2],i,n.jp.Vector3[3]),n.P.NormalizeToRef(n.jp.Vector3[3],t.direction),t}}}]);