"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6499],{48450:(e,t,r)=>{r.d(t,{iM:()=>i.i,dq:()=>l.d,f4:()=>h.f,Ai:()=>f.A,HR:()=>T.H,u:()=>i.u,my:()=>n.m,Pv:()=>u,Ye:()=>l.Y,Bm:()=>h.B,YV:()=>c.Y,rp:()=>n.r,q9:()=>p,B4:()=>f.B,aV:()=>_,uO:()=>T.u});var i=r(59990),n=r(12746),s=r(31191),a=r(96969),o=r(15631),u=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.maxSimultaneousLights=4,i.disableLighting=!1,i.invertNormalMapX=!1,i.invertNormalMapY=!1,i.emissiveColor=new o.Wo(0,0,0),i.occlusionStrength=1,i.useLightmapAsShadowmap=!1,i._useAlphaFromAlbedoTexture=!0,i._useAmbientInGrayScale=!0,i}return(0,s.ZT)(t,e),Object.defineProperty(t.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(e){this._twoSidedLighting!==e&&(this._twoSidedLighting=e,this.backFaceCulling=!e,this._markAllSubMeshesAsTexturesDirty())},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},(0,s.gn)([(0,a.qC)(),(0,a.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),(0,s.gn)([(0,a.qC)(),(0,a.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,s.gn)([(0,a.oU)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],t.prototype,"environmentTexture",void 0),(0,s.gn)([(0,a.qC)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),(0,s.gn)([(0,a.qC)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),(0,s.gn)([(0,a.oU)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],t.prototype,"normalTexture",void 0),(0,s.gn)([(0,a.n9)("emissive"),(0,a.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),(0,s.gn)([(0,a.oU)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),(0,s.gn)([(0,a.qC)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],t.prototype,"occlusionStrength",void 0),(0,s.gn)([(0,a.oU)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],t.prototype,"occlusionTexture",void 0),(0,s.gn)([(0,a.qC)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],t.prototype,"alphaCutOff",void 0),(0,s.gn)([(0,a.qC)()],t.prototype,"doubleSided",null),(0,s.gn)([(0,a.oU)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),(0,s.gn)([(0,a.qC)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),t}(n.m),l=r(13283),h=r(91878),c=r(47914),d=r(48620),p=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i._useRoughnessFromMetallicTextureAlpha=!1,i._useRoughnessFromMetallicTextureGreen=!0,i._useMetallnessFromMetallicTextureBlue=!0,i.metallic=1,i.roughness=1,i}return(0,s.ZT)(t,e),t.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},t.prototype.clone=function(e){var r=this,i=a.p4.Clone((function(){return new t(e,r.getScene())}),this);return i.id=e,i.name=e,this.clearCoat.copyTo(i.clearCoat),this.anisotropy.copyTo(i.anisotropy),this.brdf.copyTo(i.brdf),this.sheen.copyTo(i.sheen),this.subSurface.copyTo(i.subSurface),i},t.prototype.serialize=function(){var e=a.p4.Serialize(this);return e.customType="BABYLON.PBRMetallicRoughnessMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e.subSurface=this.subSurface.serialize(),e.iridescence=this.iridescence.serialize(),e},t.Parse=function(e,r,i){var n=a.p4.Parse((function(){return new t(e.name,r)}),e,r,i);return e.clearCoat&&n.clearCoat.parse(e.clearCoat,r,i),e.anisotropy&&n.anisotropy.parse(e.anisotropy,r,i),e.brdf&&n.brdf.parse(e.brdf,r,i),e.sheen&&n.sheen.parse(e.sheen,r,i),e.subSurface&&n.subSurface.parse(e.subSurface,r,i),e.iridescence&&n.iridescence.parse(e.iridescence,r,i),n},(0,s.gn)([(0,a.n9)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"baseColor",void 0),(0,s.gn)([(0,a.oU)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"baseTexture",void 0),(0,s.gn)([(0,a.qC)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),(0,s.gn)([(0,a.qC)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),(0,s.gn)([(0,a.oU)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],t.prototype,"metallicRoughnessTexture",void 0),t}(u);(0,d.H)("BABYLON.PBRMetallicRoughnessMaterial",p);var _=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i._useMicroSurfaceFromReflectivityMapAlpha=!0,i}return(0,s.ZT)(t,e),Object.defineProperty(t.prototype,"useMicroSurfaceFromReflectivityMapAlpha",{get:function(){return this._useMicroSurfaceFromReflectivityMapAlpha},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},t.prototype.clone=function(e){var r=this,i=a.p4.Clone((function(){return new t(e,r.getScene())}),this);return i.id=e,i.name=e,this.clearCoat.copyTo(i.clearCoat),this.anisotropy.copyTo(i.anisotropy),this.brdf.copyTo(i.brdf),this.sheen.copyTo(i.sheen),this.subSurface.copyTo(i.subSurface),i},t.prototype.serialize=function(){var e=a.p4.Serialize(this);return e.customType="BABYLON.PBRSpecularGlossinessMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e.subSurface=this.subSurface.serialize(),e.iridescence=this.iridescence.serialize(),e},t.Parse=function(e,r,i){var n=a.p4.Parse((function(){return new t(e.name,r)}),e,r,i);return e.clearCoat&&n.clearCoat.parse(e.clearCoat,r,i),e.anisotropy&&n.anisotropy.parse(e.anisotropy,r,i),e.brdf&&n.brdf.parse(e.brdf,r,i),e.sheen&&n.sheen.parse(e.sheen,r,i),e.subSurface&&n.subSurface.parse(e.subSurface,r,i),e.iridescence&&n.iridescence.parse(e.iridescence,r,i),n},(0,s.gn)([(0,a.n9)("diffuse"),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"diffuseColor",void 0),(0,s.gn)([(0,a.oU)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"diffuseTexture",void 0),(0,s.gn)([(0,a.n9)("specular"),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],t.prototype,"specularColor",void 0),(0,s.gn)([(0,a.qC)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_microSurface")],t.prototype,"glossiness",void 0),(0,s.gn)([(0,a.oU)(),(0,a.wz)("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],t.prototype,"specularGlossinessTexture",void 0),t}(u);(0,d.H)("BABYLON.PBRSpecularGlossinessMaterial",_);var f=r(73744),T=r(70741)},59990:(e,t,r)=>{r.d(t,{i:()=>h,u:()=>c});var i=r(31191),n=r(96969),s=r(72208),a=r(58095),o=r(46110),u=r(90360),l=r(32836),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ANISOTROPIC=!1,t.ANISOTROPIC_TEXTURE=!1,t.ANISOTROPIC_TEXTUREDIRECTUV=0,t.MAINUV1=!1,t}return(0,i.ZT)(t,e),t}(r(64849).H),c=function(e){function t(t,r){void 0===r&&(r=!0);var i=e.call(this,t,"PBRAnisotropic",110,new h,r)||this;return i._isEnabled=!1,i.isEnabled=!1,i.intensity=1,i.direction=new a.FM(1,0),i._texture=null,i.texture=null,i._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1],i}return(0,i.ZT)(t,e),t.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},t.prototype.isReadyForSubMesh=function(e,t){return!this._isEnabled||!(e._areTexturesDirty&&t.texturesEnabled&&this._texture&&o.k.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},t.prototype.prepareDefinesBeforeAttributes=function(e,t,r){this._isEnabled?(e.ANISOTROPIC=this._isEnabled,this._isEnabled&&!r.isVerticesDataPresent(s.o.TangentKind)&&(e._needUVs=!0,e.MAINUV1=!0),e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&o.k.AnisotropicTextureEnabled?u.G.PrepareDefinesForMergedUV(this._texture,e,"ANISOTROPIC_TEXTURE"):e.ANISOTROPIC_TEXTURE=!1)):(e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1)},t.prototype.bindForSubMesh=function(e,t){if(this._isEnabled){var r=this._material.isFrozen;e.useUbo&&r&&e.isSync||(this._texture&&o.k.AnisotropicTextureEnabled&&(e.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),u.G.BindTextureMatrix(this._texture,e,"anisotropy")),e.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),t.texturesEnabled&&this._texture&&o.k.AnisotropicTextureEnabled&&e.setTexture("anisotropySampler",this._texture)}},t.prototype.hasTexture=function(e){return this._texture===e},t.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture)},t.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)},t.prototype.dispose=function(e){e&&this._texture&&this._texture.dispose()},t.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},t.prototype.addFallbacks=function(e,t,r){return e.ANISOTROPIC&&t.addFallback(r++,"ANISOTROPIC"),r},t.prototype.getSamplers=function(e){e.push("anisotropySampler")},t.prototype.getUniforms=function(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}},(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isEnabled",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"intensity",void 0),(0,i.gn)([(0,n.QC)()],t.prototype,"direction",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"texture",void 0),t}(l.n)},58152:(e,t,r)=>{r.d(t,{d:()=>u});var i=r(31191),n=r(96969),s=r(64849),a=r(32836),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.BRDF_V_HEIGHT_CORRELATED=!1,t.MS_BRDF_ENERGY_CONSERVATION=!1,t.SPHERICAL_HARMONICS=!1,t.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,t}return(0,i.ZT)(t,e),t}(s.H),u=function(e){function t(r,i){void 0===i&&(i=!0);var n=e.call(this,r,"PBRBRDF",90,new o,i)||this;return n._useEnergyConservation=t.DEFAULT_USE_ENERGY_CONSERVATION,n.useEnergyConservation=t.DEFAULT_USE_ENERGY_CONSERVATION,n._useSmithVisibilityHeightCorrelated=t.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,n.useSmithVisibilityHeightCorrelated=t.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,n._useSphericalHarmonics=t.DEFAULT_USE_SPHERICAL_HARMONICS,n.useSphericalHarmonics=t.DEFAULT_USE_SPHERICAL_HARMONICS,n._useSpecularGlossinessInputEnergyConservation=t.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,n.useSpecularGlossinessInputEnergyConservation=t.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,n._internalMarkAllSubMeshesAsMiscDirty=r._dirtyCallbacks[16],n._enable(!0),n}return(0,i.ZT)(t,e),t.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},t.prototype.prepareDefines=function(e){e.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,e.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,e.SPHERICAL_HARMONICS=this._useSphericalHarmonics,e.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation},t.prototype.getClassName=function(){return"PBRBRDFConfiguration"},t.DEFAULT_USE_ENERGY_CONSERVATION=!0,t.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,t.DEFAULT_USE_SPHERICAL_HARMONICS=!0,t.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useEnergyConservation",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useSphericalHarmonics",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsMiscDirty")],t.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),t}(a.n)},12746:(e,t,r)=>{r.d(t,{m:()=>P,r:()=>L});var i=r(31191),n=r(96969),s=r(84318),a=r(7788),o=r(73556),u=r(65273),l=r(58095),h=r(72208),c=r(58152),d=r(94028),p=r(15631),_=r(72739),f=r(90622),T=r(98163),g=r(67555),m=r(64849),x=r(74375),E=r(90360),v=r(73803),R=r(46110),y=(r(7023),r(34995),r(29854),r(38309)),A=r(13283),S=r(91878),b=r(59990),C=r(73744),M=r(70741),I=r(16977),O={effect:null,subMesh:null},L=function(e){function t(t){var r=e.call(this,t)||this;return r.PBR=!0,r.NUM_SAMPLES="0",r.REALTIME_FILTERING=!1,r.MAINUV1=!1,r.MAINUV2=!1,r.MAINUV3=!1,r.MAINUV4=!1,r.MAINUV5=!1,r.MAINUV6=!1,r.UV1=!1,r.UV2=!1,r.UV3=!1,r.UV4=!1,r.UV5=!1,r.UV6=!1,r.ALBEDO=!1,r.GAMMAALBEDO=!1,r.ALBEDODIRECTUV=0,r.VERTEXCOLOR=!1,r.BAKED_VERTEX_ANIMATION_TEXTURE=!1,r.AMBIENT=!1,r.AMBIENTDIRECTUV=0,r.AMBIENTINGRAYSCALE=!1,r.OPACITY=!1,r.VERTEXALPHA=!1,r.OPACITYDIRECTUV=0,r.OPACITYRGB=!1,r.ALPHATEST=!1,r.DEPTHPREPASS=!1,r.ALPHABLEND=!1,r.ALPHAFROMALBEDO=!1,r.ALPHATESTVALUE="0.5",r.SPECULAROVERALPHA=!1,r.RADIANCEOVERALPHA=!1,r.ALPHAFRESNEL=!1,r.LINEARALPHAFRESNEL=!1,r.PREMULTIPLYALPHA=!1,r.EMISSIVE=!1,r.EMISSIVEDIRECTUV=0,r.GAMMAEMISSIVE=!1,r.REFLECTIVITY=!1,r.REFLECTIVITY_GAMMA=!1,r.REFLECTIVITYDIRECTUV=0,r.SPECULARTERM=!1,r.MICROSURFACEFROMREFLECTIVITYMAP=!1,r.MICROSURFACEAUTOMATIC=!1,r.LODBASEDMICROSFURACE=!1,r.MICROSURFACEMAP=!1,r.MICROSURFACEMAPDIRECTUV=0,r.METALLICWORKFLOW=!1,r.ROUGHNESSSTOREINMETALMAPALPHA=!1,r.ROUGHNESSSTOREINMETALMAPGREEN=!1,r.METALLNESSSTOREINMETALMAPBLUE=!1,r.AOSTOREINMETALMAPRED=!1,r.METALLIC_REFLECTANCE=!1,r.METALLIC_REFLECTANCE_GAMMA=!1,r.METALLIC_REFLECTANCEDIRECTUV=0,r.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,r.REFLECTANCE=!1,r.REFLECTANCE_GAMMA=!1,r.REFLECTANCEDIRECTUV=0,r.ENVIRONMENTBRDF=!1,r.ENVIRONMENTBRDF_RGBD=!1,r.NORMAL=!1,r.TANGENT=!1,r.BUMP=!1,r.BUMPDIRECTUV=0,r.OBJECTSPACE_NORMALMAP=!1,r.PARALLAX=!1,r.PARALLAXOCCLUSION=!1,r.NORMALXYSCALE=!0,r.LIGHTMAP=!1,r.LIGHTMAPDIRECTUV=0,r.USELIGHTMAPASSHADOWMAP=!1,r.GAMMALIGHTMAP=!1,r.RGBDLIGHTMAP=!1,r.REFLECTION=!1,r.REFLECTIONMAP_3D=!1,r.REFLECTIONMAP_SPHERICAL=!1,r.REFLECTIONMAP_PLANAR=!1,r.REFLECTIONMAP_CUBIC=!1,r.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,r.REFLECTIONMAP_PROJECTION=!1,r.REFLECTIONMAP_SKYBOX=!1,r.REFLECTIONMAP_EXPLICIT=!1,r.REFLECTIONMAP_EQUIRECTANGULAR=!1,r.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,r.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,r.INVERTCUBICMAP=!1,r.USESPHERICALFROMREFLECTIONMAP=!1,r.USEIRRADIANCEMAP=!1,r.USESPHERICALINVERTEX=!1,r.REFLECTIONMAP_OPPOSITEZ=!1,r.LODINREFLECTIONALPHA=!1,r.GAMMAREFLECTION=!1,r.RGBDREFLECTION=!1,r.LINEARSPECULARREFLECTION=!1,r.RADIANCEOCCLUSION=!1,r.HORIZONOCCLUSION=!1,r.INSTANCES=!1,r.THIN_INSTANCES=!1,r.INSTANCESCOLOR=!1,r.PREPASS=!1,r.PREPASS_IRRADIANCE=!1,r.PREPASS_IRRADIANCE_INDEX=-1,r.PREPASS_ALBEDO_SQRT=!1,r.PREPASS_ALBEDO_SQRT_INDEX=-1,r.PREPASS_DEPTH=!1,r.PREPASS_DEPTH_INDEX=-1,r.PREPASS_NORMAL=!1,r.PREPASS_NORMAL_INDEX=-1,r.PREPASS_POSITION=!1,r.PREPASS_POSITION_INDEX=-1,r.PREPASS_VELOCITY=!1,r.PREPASS_VELOCITY_INDEX=-1,r.PREPASS_REFLECTIVITY=!1,r.PREPASS_REFLECTIVITY_INDEX=-1,r.SCENE_MRT_COUNT=0,r.NUM_BONE_INFLUENCERS=0,r.BonesPerMesh=0,r.BONETEXTURE=!1,r.BONES_VELOCITY_ENABLED=!1,r.NONUNIFORMSCALING=!1,r.MORPHTARGETS=!1,r.MORPHTARGETS_NORMAL=!1,r.MORPHTARGETS_TANGENT=!1,r.MORPHTARGETS_UV=!1,r.NUM_MORPH_INFLUENCERS=0,r.MORPHTARGETS_TEXTURE=!1,r.IMAGEPROCESSING=!1,r.VIGNETTE=!1,r.VIGNETTEBLENDMODEMULTIPLY=!1,r.VIGNETTEBLENDMODEOPAQUE=!1,r.TONEMAPPING=!1,r.TONEMAPPING_ACES=!1,r.CONTRAST=!1,r.COLORCURVES=!1,r.COLORGRADING=!1,r.COLORGRADING3D=!1,r.SAMPLER3DGREENDEPTH=!1,r.SAMPLER3DBGRMAP=!1,r.IMAGEPROCESSINGPOSTPROCESS=!1,r.SKIPFINALCOLORCLAMP=!1,r.EXPOSURE=!1,r.MULTIVIEW=!1,r.ORDER_INDEPENDENT_TRANSPARENCY=!1,r.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,r.USEPHYSICALLIGHTFALLOFF=!1,r.USEGLTFLIGHTFALLOFF=!1,r.TWOSIDEDLIGHTING=!1,r.SHADOWFLOAT=!1,r.CLIPPLANE=!1,r.CLIPPLANE2=!1,r.CLIPPLANE3=!1,r.CLIPPLANE4=!1,r.CLIPPLANE5=!1,r.CLIPPLANE6=!1,r.POINTSIZE=!1,r.FOG=!1,r.LOGARITHMICDEPTH=!1,r.FORCENORMALFORWARD=!1,r.SPECULARAA=!1,r.UNLIT=!1,r.DEBUGMODE=0,r.rebuild(),r}return(0,i.ZT)(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0},t}(m.H),P=function(e){function t(r,i){var n=e.call(this,r,i)||this;return n._directIntensity=1,n._emissiveIntensity=1,n._environmentIntensity=1,n._specularIntensity=1,n._lightingInfos=new l.Lt(n._directIntensity,n._emissiveIntensity,n._environmentIntensity,n._specularIntensity),n._disableBumpMap=!1,n._albedoTexture=null,n._ambientTexture=null,n._ambientTextureStrength=1,n._ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,n._opacityTexture=null,n._reflectionTexture=null,n._emissiveTexture=null,n._reflectivityTexture=null,n._metallicTexture=null,n._metallic=null,n._roughness=null,n._metallicF0Factor=1,n._metallicReflectanceColor=p.Wo.White(),n._useOnlyMetallicFromMetallicReflectanceTexture=!1,n._metallicReflectanceTexture=null,n._reflectanceTexture=null,n._microSurfaceTexture=null,n._bumpTexture=null,n._lightmapTexture=null,n._ambientColor=new p.Wo(0,0,0),n._albedoColor=new p.Wo(1,1,1),n._reflectivityColor=new p.Wo(1,1,1),n._reflectionColor=new p.Wo(1,1,1),n._emissiveColor=new p.Wo(0,0,0),n._microSurface=.9,n._useLightmapAsShadowmap=!1,n._useHorizonOcclusion=!0,n._useRadianceOcclusion=!0,n._useAlphaFromAlbedoTexture=!1,n._useSpecularOverAlpha=!0,n._useMicroSurfaceFromReflectivityMapAlpha=!1,n._useRoughnessFromMetallicTextureAlpha=!0,n._useRoughnessFromMetallicTextureGreen=!1,n._useMetallnessFromMetallicTextureBlue=!1,n._useAmbientOcclusionFromMetallicTextureRed=!1,n._useAmbientInGrayScale=!1,n._useAutoMicroSurfaceFromReflectivityMap=!1,n._lightFalloff=t.LIGHTFALLOFF_PHYSICAL,n._useRadianceOverAlpha=!0,n._useObjectSpaceNormalMap=!1,n._useParallax=!1,n._useParallaxOcclusion=!1,n._parallaxScaleBias=.05,n._disableLighting=!1,n._maxSimultaneousLights=4,n._invertNormalMapX=!1,n._invertNormalMapY=!1,n._twoSidedLighting=!1,n._alphaCutOff=.4,n._forceAlphaTest=!1,n._useAlphaFresnel=!1,n._useLinearAlphaFresnel=!1,n._environmentBRDFTexture=null,n._forceIrradianceInFragment=!1,n._realTimeFiltering=!1,n._realTimeFilteringQuality=8,n._forceNormalForward=!1,n._enableSpecularAntiAliasing=!1,n._imageProcessingObserver=null,n._renderTargets=new a.t(16),n._globalAmbientColor=new p.Wo(0,0,0),n._useLogarithmicDepth=!1,n._unlit=!1,n._debugMode=0,n.debugMode=0,n._debugLimit=-1,n._debugFactor=1,n._cacheHasRenderTargetTextures=!1,n.brdf=new c.d(n),n.clearCoat=new A.Y(n),n.iridescence=new S.B(n),n.anisotropy=new b.u(n),n.sheen=new C.B(n),n.subSurface=new M.u(n),n.detailMap=new I.p(n),n._attachImageProcessingConfiguration(null),n.getRenderTargetTextures=function(){return n._renderTargets.reset(),R.k.ReflectionTextureEnabled&&n._reflectionTexture&&n._reflectionTexture.isRenderTarget&&n._renderTargets.push(n._reflectionTexture),n._eventInfo.renderTargets=n._renderTargets,n._callbackPluginEventFillRenderTargetTextures(n._eventInfo),n._renderTargets},n._environmentBRDFTexture=(0,o.$)(n.getScene()),n.prePassConfiguration=new d.o,n}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"realTimeFiltering",{get:function(){return this._realTimeFiltering},set:function(e){this._realTimeFiltering=e,this.markAsDirty(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realTimeFilteringQuality",{get:function(){return this._realTimeFilteringQuality},set:function(e){this._realTimeFilteringQuality=e,this.markAsDirty(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){t._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!!(R.k.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPrePassCapable",{get:function(){return!this.disableDepthWrite},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_disableAlphaBlending",{get:function(){var e;return this._transparencyMode===t.PBRMATERIAL_OPAQUE||this._transparencyMode===t.PBRMATERIAL_ALPHATEST||(null===(e=this.subSurface)||void 0===e?void 0:e.disableAlphaBlending)},enumerable:!1,configurable:!0}),t.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},t.prototype.needAlphaTesting=function(){var e;return!!this._forceAlphaTest||!(null===(e=this.subSurface)||void 0===e?void 0:e.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===t.PBRMATERIAL_ALPHATEST))},t.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==t.PBRMATERIAL_OPAQUE},t.prototype._hasAlphaChannel=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha||null!=this._opacityTexture},t.prototype.getAlphaTestTexture=function(){return this._albedoTexture},t.prototype.isReadyForSubMesh=function(e,t,r){if(this._uniformBufferLayoutBuilt||this.buildUniformLayout(),t.effect&&this.isFrozen&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(this._callbackPluginEventGeneric(g.S.GetDefineNames,this._eventInfo),t.materialDefines=new L(this._eventInfo.defineNames));var i=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;var n=this.getScene(),a=n.getEngine();if(i._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,n.texturesEnabled)){if(this._albedoTexture&&R.k.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&R.k.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&R.k.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var o=this._getReflectionTexture();if(o&&R.k.ReflectionTextureEnabled){if(!o.isReadyOrNotBlocking())return!1;if(o.irradianceTexture&&!o.irradianceTexture.isReadyOrNotBlocking())return!1}if(this._lightmapTexture&&R.k.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&R.k.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(R.k.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(a.getCaps().standardDerivatives&&this._bumpTexture&&R.k.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&R.k.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=i,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(i._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;a.getCaps().standardDerivatives||e.isVerticesDataPresent(h.o.NormalKind)||(e.createNormals(!0),s.Y.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));var u=t.effect,l=i._areLightsDisposed,c=this._prepareEffect(e,i,this.onCompiled,this.onError,r,null,t.getRenderingMesh().hasThinInstances);if(c)if(this._onEffectCreatedObservable&&(O.effect=c,O.subMesh=t,this._onEffectCreatedObservable.notifyObservers(O)),this.allowShaderHotSwapping&&u&&!c.isReady()){if(c=u,i.markAsUnprocessed(),l)return i._areLightsDisposed=!0,!1}else n.resetCachedMaterial(),t.setEffect(c,i,this._materialContext);return!(!t.effect||!t.effect.isReady())&&(i._renderId=n.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},t.prototype.isMetallicWorkflow=function(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)},t.prototype._prepareEffect=function(e,t,r,i,n,s,a){if(void 0===r&&(r=null),void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=null),this._prepareDefines(e,t,n,s,a),!t.isDirty)return null;t.markAsProcessed();var o=this.getScene().getEngine(),u=new y.L,l=0;t.USESPHERICALINVERTEX&&u.addFallback(l++,"USESPHERICALINVERTEX"),t.FOG&&u.addFallback(l,"FOG"),t.SPECULARAA&&u.addFallback(l,"SPECULARAA"),t.POINTSIZE&&u.addFallback(l,"POINTSIZE"),t.LOGARITHMICDEPTH&&u.addFallback(l,"LOGARITHMICDEPTH"),t.PARALLAX&&u.addFallback(l,"PARALLAX"),t.PARALLAXOCCLUSION&&u.addFallback(l++,"PARALLAXOCCLUSION"),t.ENVIRONMENTBRDF&&u.addFallback(l++,"ENVIRONMENTBRDF"),t.TANGENT&&u.addFallback(l++,"TANGENT"),t.BUMP&&u.addFallback(l++,"BUMP"),l=E.G.HandleFallbacksForShadows(t,u,this._maxSimultaneousLights,l++),t.SPECULARTERM&&u.addFallback(l++,"SPECULARTERM"),t.USESPHERICALFROMREFLECTIONMAP&&u.addFallback(l++,"USESPHERICALFROMREFLECTIONMAP"),t.USEIRRADIANCEMAP&&u.addFallback(l++,"USEIRRADIANCEMAP"),t.LIGHTMAP&&u.addFallback(l++,"LIGHTMAP"),t.NORMAL&&u.addFallback(l++,"NORMAL"),t.AMBIENT&&u.addFallback(l++,"AMBIENT"),t.EMISSIVE&&u.addFallback(l++,"EMISSIVE"),t.VERTEXCOLOR&&u.addFallback(l++,"VERTEXCOLOR"),t.MORPHTARGETS&&u.addFallback(l++,"MORPHTARGETS"),t.MULTIVIEW&&u.addFallback(0,"MULTIVIEW");var c=[h.o.PositionKind];t.NORMAL&&c.push(h.o.NormalKind),t.TANGENT&&c.push(h.o.TangentKind);for(var p=1;p<=6;++p)t["UV"+p]&&c.push("uv".concat(1===p?"":p));t.VERTEXCOLOR&&c.push(h.o.ColorKind),t.INSTANCESCOLOR&&c.push(h.o.ColorInstanceKind),E.G.PrepareAttributesForBones(c,e,t,u),E.G.PrepareAttributesForInstances(c,t),E.G.PrepareAttributesForMorphTargets(c,e,t),E.G.PrepareAttributesForBakedVertexAnimation(c,e,t);var _="pbr",T=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],m=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],x=["Material","Scene","Mesh"];this._eventInfo.fallbacks=u,this._eventInfo.fallbackRank=l,this._eventInfo.defines=t,this._eventInfo.uniforms=T,this._eventInfo.attributes=c,this._eventInfo.samplers=m,this._eventInfo.uniformBuffersNames=x,this._eventInfo.customCode=void 0,this._callbackPluginEventGeneric(g.S.PrepareEffect,this._eventInfo),d.o.AddUniforms(T),d.o.AddSamplers(m),f.$&&(f.$.PrepareUniforms(T,t),f.$.PrepareSamplers(m,t)),E.G.PrepareUniformsAndSamplersList({uniformsNames:T,uniformBuffersNames:x,samplers:m,defines:t,maxSimultaneousLights:this._maxSimultaneousLights});var v={};this.customShaderNameResolve&&(_=this.customShaderNameResolve(_,T,x,m,t,c,v));var R=t.toString();return o.createEffect(_,{attributes:c,uniformsNames:T,uniformBuffersNames:x,samplers:m,defines:R,fallbacks:u,onCompiled:r,onError:i,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:t.NUM_MORPH_INFLUENCERS},processFinalCode:v.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:t.PREPASS},o)},t.prototype._prepareDefines=function(e,r,i,n,s){var a;void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=!1);var o=this.getScene(),u=o.getEngine();E.G.PrepareDefinesForLights(o,e,r,!0,this._maxSimultaneousLights,this._disableLighting),r._needNormals=!0,E.G.PrepareDefinesForMultiview(o,r);var l=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if(E.G.PrepareDefinesForPrePass(o,r,this.canRenderToMRT&&!l),E.G.PrepareDefinesForOIT(o,r,l),r.METALLICWORKFLOW=this.isMetallicWorkflow(),r._areTexturesDirty){if(r._needUVs=!1,o.texturesEnabled){o.getEngine().getCaps().textureLOD&&(r.LODBASEDMICROSFURACE=!0),this._albedoTexture&&R.k.DiffuseTextureEnabled?(E.G.PrepareDefinesForMergedUV(this._albedoTexture,r,"ALBEDO"),r.GAMMAALBEDO=this._albedoTexture.gammaSpace):r.ALBEDO=!1,this._ambientTexture&&R.k.AmbientTextureEnabled?(E.G.PrepareDefinesForMergedUV(this._ambientTexture,r,"AMBIENT"),r.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):r.AMBIENT=!1,this._opacityTexture&&R.k.OpacityTextureEnabled?(E.G.PrepareDefinesForMergedUV(this._opacityTexture,r,"OPACITY"),r.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):r.OPACITY=!1;var c=this._getReflectionTexture();if(c&&R.k.ReflectionTextureEnabled){switch(r.REFLECTION=!0,r.GAMMAREFLECTION=c.gammaSpace,r.RGBDREFLECTION=c.isRGBD,r.LODINREFLECTIONALPHA=c.lodLevelInAlpha,r.LINEARSPECULARREFLECTION=c.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(r.NUM_SAMPLES=""+this.realTimeFilteringQuality,u._features.needTypeSuffixInShaderConstants&&(r.NUM_SAMPLES=r.NUM_SAMPLES+"u"),r.REALTIME_FILTERING=!0):r.REALTIME_FILTERING=!1,c.coordinatesMode===v.x.INVCUBIC_MODE&&(r.INVERTCUBICMAP=!0),r.REFLECTIONMAP_3D=c.isCube,r.REFLECTIONMAP_OPPOSITEZ=r.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!c.invertZ:c.invertZ,r.REFLECTIONMAP_CUBIC=!1,r.REFLECTIONMAP_EXPLICIT=!1,r.REFLECTIONMAP_PLANAR=!1,r.REFLECTIONMAP_PROJECTION=!1,r.REFLECTIONMAP_SKYBOX=!1,r.REFLECTIONMAP_SPHERICAL=!1,r.REFLECTIONMAP_EQUIRECTANGULAR=!1,r.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,r.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,c.coordinatesMode){case v.x.EXPLICIT_MODE:r.REFLECTIONMAP_EXPLICIT=!0;break;case v.x.PLANAR_MODE:r.REFLECTIONMAP_PLANAR=!0;break;case v.x.PROJECTION_MODE:r.REFLECTIONMAP_PROJECTION=!0;break;case v.x.SKYBOX_MODE:r.REFLECTIONMAP_SKYBOX=!0;break;case v.x.SPHERICAL_MODE:r.REFLECTIONMAP_SPHERICAL=!0;break;case v.x.EQUIRECTANGULAR_MODE:r.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case v.x.FIXED_EQUIRECTANGULAR_MODE:r.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case v.x.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:r.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case v.x.CUBIC_MODE:case v.x.INVCUBIC_MODE:default:r.REFLECTIONMAP_CUBIC=!0,r.USE_LOCAL_REFLECTIONMAP_CUBIC=!!c.boundingBoxSize}c.coordinatesMode!==v.x.SKYBOX_MODE&&(c.irradianceTexture?(r.USEIRRADIANCEMAP=!0,r.USESPHERICALFROMREFLECTIONMAP=!1):c.isCube&&(r.USESPHERICALFROMREFLECTIONMAP=!0,r.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||o.getEngine().getCaps().maxVaryingVectors<=8?r.USESPHERICALINVERTEX=!1:r.USESPHERICALINVERTEX=!0))}else r.REFLECTION=!1,r.REFLECTIONMAP_3D=!1,r.REFLECTIONMAP_SPHERICAL=!1,r.REFLECTIONMAP_PLANAR=!1,r.REFLECTIONMAP_CUBIC=!1,r.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,r.REFLECTIONMAP_PROJECTION=!1,r.REFLECTIONMAP_SKYBOX=!1,r.REFLECTIONMAP_EXPLICIT=!1,r.REFLECTIONMAP_EQUIRECTANGULAR=!1,r.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,r.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,r.INVERTCUBICMAP=!1,r.USESPHERICALFROMREFLECTIONMAP=!1,r.USEIRRADIANCEMAP=!1,r.USESPHERICALINVERTEX=!1,r.REFLECTIONMAP_OPPOSITEZ=!1,r.LODINREFLECTIONALPHA=!1,r.GAMMAREFLECTION=!1,r.RGBDREFLECTION=!1,r.LINEARSPECULARREFLECTION=!1;if(this._lightmapTexture&&R.k.LightmapTextureEnabled?(E.G.PrepareDefinesForMergedUV(this._lightmapTexture,r,"LIGHTMAP"),r.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,r.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,r.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):r.LIGHTMAP=!1,this._emissiveTexture&&R.k.EmissiveTextureEnabled?(E.G.PrepareDefinesForMergedUV(this._emissiveTexture,r,"EMISSIVE"),r.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):r.EMISSIVE=!1,R.k.SpecularTextureEnabled){if(this._metallicTexture?(E.G.PrepareDefinesForMergedUV(this._metallicTexture,r,"REFLECTIVITY"),r.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,r.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,r.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,r.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,r.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?(E.G.PrepareDefinesForMergedUV(this._reflectivityTexture,r,"REFLECTIVITY"),r.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,r.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,r.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):r.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture){var d=null!==this._metallicReflectanceTexture&&this._metallicReflectanceTexture._texture===(null===(a=this._reflectanceTexture)||void 0===a?void 0:a._texture)&&this._metallicReflectanceTexture.checkTransformsAreIdentical(this._reflectanceTexture);r.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture&&!d,this._metallicReflectanceTexture?(E.G.PrepareDefinesForMergedUV(this._metallicReflectanceTexture,r,"METALLIC_REFLECTANCE"),r.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):r.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&!d&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?(E.G.PrepareDefinesForMergedUV(this._reflectanceTexture,r,"REFLECTANCE"),r.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):r.REFLECTANCE=!1}else r.METALLIC_REFLECTANCE=!1,r.REFLECTANCE=!1;this._microSurfaceTexture?E.G.PrepareDefinesForMergedUV(this._microSurfaceTexture,r,"MICROSURFACEMAP"):r.MICROSURFACEMAP=!1}else r.REFLECTIVITY=!1,r.MICROSURFACEMAP=!1;o.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&R.k.BumpTextureEnabled&&!this._disableBumpMap?(E.G.PrepareDefinesForMergedUV(this._bumpTexture,r,"BUMP"),this._useParallax&&this._albedoTexture&&R.k.DiffuseTextureEnabled?(r.PARALLAX=!0,r.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):r.PARALLAX=!1,r.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):r.BUMP=!1,this._environmentBRDFTexture&&R.k.ReflectionTextureEnabled?(r.ENVIRONMENTBRDF=!0,r.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(r.ENVIRONMENTBRDF=!1,r.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?r.ALPHAFROMALBEDO=!0:r.ALPHAFROMALBEDO=!1}r.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===t.LIGHTFALLOFF_STANDARD?(r.USEPHYSICALLIGHTFALLOFF=!1,r.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===t.LIGHTFALLOFF_GLTF?(r.USEPHYSICALLIGHTFALLOFF=!1,r.USEGLTFLIGHTFALLOFF=!0):(r.USEPHYSICALLIGHTFALLOFF=!0,r.USEGLTFLIGHTFALLOFF=!1),r.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?r.TWOSIDEDLIGHTING=!0:r.TWOSIDEDLIGHTING=!1,r.SPECULARAA=o.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(r._areTexturesDirty||r._areMiscDirty)&&(r.ALPHATESTVALUE="".concat(this._alphaCutOff).concat(this._alphaCutOff%1==0?".":""),r.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,r.ALPHABLEND=this.needAlphaBlendingForMesh(e),r.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,r.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),r._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(r),r.FORCENORMALFORWARD=this._forceNormalForward,r.RADIANCEOCCLUSION=this._useRadianceOcclusion,r.HORIZONOCCLUSION=this._useHorizonOcclusion,r._areMiscDirty&&(E.G.PrepareDefinesForMisc(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,r),r.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!e.isVerticesDataPresent(h.o.NormalKind),r.DEBUGMODE=this._debugMode),E.G.PrepareDefinesForFrameBoundValues(o,u,r,!!i,n,s),this._eventInfo.defines=r,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),E.G.PrepareDefinesForAttributes(e,r,!0,!0,!0,this._transparencyMode!==t.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)},t.prototype.forceCompilation=function(e,t,r){var n=this,s=(0,i.pi)({clipPlane:!1,useInstances:!1},r);this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(g.S.GetDefineNames,this._eventInfo);var a=new L(this._eventInfo.defineNames),o=this._prepareEffect(e,a,void 0,void 0,s.useInstances,s.clipPlane,e.hasThinInstances);this._onEffectCreatedObservable&&(O.effect=o,O.subMesh=null,this._onEffectCreatedObservable.notifyObservers(O)),o.isReady()?t&&t(this):o.onCompileObservable.add((function(){t&&t(n)}))},t.prototype.buildUniformLayout=function(){var t=this._uniformBuffer;t.addUniform("vAlbedoInfos",2),t.addUniform("vAmbientInfos",4),t.addUniform("vOpacityInfos",2),t.addUniform("vEmissiveInfos",2),t.addUniform("vLightmapInfos",2),t.addUniform("vReflectivityInfos",3),t.addUniform("vMicroSurfaceSamplerInfos",2),t.addUniform("vReflectionInfos",2),t.addUniform("vReflectionFilteringInfo",2),t.addUniform("vReflectionPosition",3),t.addUniform("vReflectionSize",3),t.addUniform("vBumpInfos",3),t.addUniform("albedoMatrix",16),t.addUniform("ambientMatrix",16),t.addUniform("opacityMatrix",16),t.addUniform("emissiveMatrix",16),t.addUniform("lightmapMatrix",16),t.addUniform("reflectivityMatrix",16),t.addUniform("microSurfaceSamplerMatrix",16),t.addUniform("bumpMatrix",16),t.addUniform("vTangentSpaceParams",2),t.addUniform("reflectionMatrix",16),t.addUniform("vReflectionColor",3),t.addUniform("vAlbedoColor",4),t.addUniform("vLightingIntensity",4),t.addUniform("vReflectionMicrosurfaceInfos",3),t.addUniform("pointSize",1),t.addUniform("vReflectivityColor",4),t.addUniform("vEmissiveColor",3),t.addUniform("vAmbientColor",3),t.addUniform("vDebugMode",2),t.addUniform("vMetallicReflectanceFactors",4),t.addUniform("vMetallicReflectanceInfos",2),t.addUniform("metallicReflectanceMatrix",16),t.addUniform("vReflectanceInfos",2),t.addUniform("reflectanceMatrix",16),t.addUniform("vSphericalL00",3),t.addUniform("vSphericalL1_1",3),t.addUniform("vSphericalL10",3),t.addUniform("vSphericalL11",3),t.addUniform("vSphericalL2_2",3),t.addUniform("vSphericalL2_1",3),t.addUniform("vSphericalL20",3),t.addUniform("vSphericalL21",3),t.addUniform("vSphericalL22",3),t.addUniform("vSphericalX",3),t.addUniform("vSphericalY",3),t.addUniform("vSphericalZ",3),t.addUniform("vSphericalXX_ZZ",3),t.addUniform("vSphericalYY_ZZ",3),t.addUniform("vSphericalZZ",3),t.addUniform("vSphericalXY",3),t.addUniform("vSphericalYZ",3),t.addUniform("vSphericalZX",3),e.prototype.buildUniformLayout.call(this)},t.prototype.bindForSubMesh=function(e,t,r){var i,n,s,a,o=this.getScene(),l=r.materialDefines;if(l){var h=r.effect;if(h){this._activeEffect=h,t.getMeshUniformBuffer().bindToEffect(h,"Mesh"),t.transferToEffect(e);var c=o.getEngine();this._uniformBuffer.bindToEffect(h,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,o,t,e,this.isFrozen),this._eventInfo.subMesh=r,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),l.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var d=this._mustRebind(o,h,t.visibility);E.G.BindBonesParameters(t,this._activeEffect,this.prePassConfiguration);var f=null,T=this._uniformBuffer;if(d){if(this.bindViewProjection(h),f=this._getReflectionTexture(),!T.useUbo||!this.isFrozen||!T.isSync){if(o.texturesEnabled){if(this._albedoTexture&&R.k.DiffuseTextureEnabled&&(T.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),E.G.BindTextureMatrix(this._albedoTexture,T,"albedo")),this._ambientTexture&&R.k.AmbientTextureEnabled&&(T.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),E.G.BindTextureMatrix(this._ambientTexture,T,"ambient")),this._opacityTexture&&R.k.OpacityTextureEnabled&&(T.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),E.G.BindTextureMatrix(this._opacityTexture,T,"opacity")),f&&R.k.ReflectionTextureEnabled){if(T.updateMatrix("reflectionMatrix",f.getReflectionTextureMatrix()),T.updateFloat2("vReflectionInfos",f.level,0),f.boundingBoxSize){var g=f;T.updateVector3("vReflectionPosition",g.boundingBoxPosition),T.updateVector3("vReflectionSize",g.boundingBoxSize)}if(this.realTimeFiltering){var m=f.getSize().width;T.updateFloat2("vReflectionFilteringInfo",m,_.R.Log2(m))}if(!l.USEIRRADIANCEMAP){var x=f.sphericalPolynomial;if(l.USESPHERICALFROMREFLECTIONMAP&&x)if(l.SPHERICAL_HARMONICS){var v=x.preScaledHarmonics;T.updateVector3("vSphericalL00",v.l00),T.updateVector3("vSphericalL1_1",v.l1_1),T.updateVector3("vSphericalL10",v.l10),T.updateVector3("vSphericalL11",v.l11),T.updateVector3("vSphericalL2_2",v.l2_2),T.updateVector3("vSphericalL2_1",v.l2_1),T.updateVector3("vSphericalL20",v.l20),T.updateVector3("vSphericalL21",v.l21),T.updateVector3("vSphericalL22",v.l22)}else T.updateFloat3("vSphericalX",x.x.x,x.x.y,x.x.z),T.updateFloat3("vSphericalY",x.y.x,x.y.y,x.y.z),T.updateFloat3("vSphericalZ",x.z.x,x.z.y,x.z.z),T.updateFloat3("vSphericalXX_ZZ",x.xx.x-x.zz.x,x.xx.y-x.zz.y,x.xx.z-x.zz.z),T.updateFloat3("vSphericalYY_ZZ",x.yy.x-x.zz.x,x.yy.y-x.zz.y,x.yy.z-x.zz.z),T.updateFloat3("vSphericalZZ",x.zz.x,x.zz.y,x.zz.z),T.updateFloat3("vSphericalXY",x.xy.x,x.xy.y,x.xy.z),T.updateFloat3("vSphericalYZ",x.yz.x,x.yz.y,x.yz.z),T.updateFloat3("vSphericalZX",x.zx.x,x.zx.y,x.zx.z)}T.updateFloat3("vReflectionMicrosurfaceInfos",f.getSize().width,f.lodGenerationScale,f.lodGenerationOffset)}this._emissiveTexture&&R.k.EmissiveTextureEnabled&&(T.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),E.G.BindTextureMatrix(this._emissiveTexture,T,"emissive")),this._lightmapTexture&&R.k.LightmapTextureEnabled&&(T.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),E.G.BindTextureMatrix(this._lightmapTexture,T,"lightmap")),R.k.SpecularTextureEnabled&&(this._metallicTexture?(T.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),E.G.BindTextureMatrix(this._metallicTexture,T,"reflectivity")):this._reflectivityTexture&&(T.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),E.G.BindTextureMatrix(this._reflectivityTexture,T,"reflectivity")),this._metallicReflectanceTexture&&(T.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),E.G.BindTextureMatrix(this._metallicReflectanceTexture,T,"metallicReflectance")),this._reflectanceTexture&&l.REFLECTANCE&&(T.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),E.G.BindTextureMatrix(this._reflectanceTexture,T,"reflectance")),this._microSurfaceTexture&&(T.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),E.G.BindTextureMatrix(this._microSurfaceTexture,T,"microSurfaceSampler"))),this._bumpTexture&&c.getCaps().standardDerivatives&&R.k.BumpTextureEnabled&&!this._disableBumpMap&&(T.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),E.G.BindTextureMatrix(this._bumpTexture,T,"bump"),o._mirroredCameraPosition?T.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):T.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&T.updateFloat("pointSize",this.pointSize),l.METALLICWORKFLOW){p.zZ.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,p.zZ.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,T.updateColor4("vReflectivityColor",p.zZ.Color3[0],1);var y=null!==(n=null===(i=this.subSurface)||void 0===i?void 0:i._indexOfRefraction)&&void 0!==n?n:1.5,A=Math.pow((y-1)/(y+1),2);this._metallicReflectanceColor.scaleToRef(A*this._metallicF0Factor,p.zZ.Color3[0]);var S=this._metallicF0Factor;T.updateColor4("vMetallicReflectanceFactors",p.zZ.Color3[0],S)}else T.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);T.updateColor3("vEmissiveColor",R.k.EmissiveTextureEnabled?this._emissiveColor:p.Wo.BlackReadOnly),T.updateColor3("vReflectionColor",this._reflectionColor),!l.SS_REFRACTION&&(null===(s=this.subSurface)||void 0===s?void 0:s._linkRefractionWithTransparency)?T.updateColor4("vAlbedoColor",this._albedoColor,1):T.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*o.environmentIntensity,this._lightingInfos.w=this._specularIntensity,T.updateVector4("vLightingIntensity",this._lightingInfos),o.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),T.updateColor3("vAmbientColor",this._globalAmbientColor),T.updateFloat2("vDebugMode",this._debugLimit,this._debugFactor)}o.texturesEnabled&&(this._albedoTexture&&R.k.DiffuseTextureEnabled&&T.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&R.k.AmbientTextureEnabled&&T.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&R.k.OpacityTextureEnabled&&T.setTexture("opacitySampler",this._opacityTexture),f&&R.k.ReflectionTextureEnabled&&(l.LODBASEDMICROSFURACE?T.setTexture("reflectionSampler",f):(T.setTexture("reflectionSampler",f._lodTextureMid||f),T.setTexture("reflectionSamplerLow",f._lodTextureLow||f),T.setTexture("reflectionSamplerHigh",f._lodTextureHigh||f)),l.USEIRRADIANCEMAP&&T.setTexture("irradianceSampler",f.irradianceTexture)),l.ENVIRONMENTBRDF&&T.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&R.k.EmissiveTextureEnabled&&T.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&R.k.LightmapTextureEnabled&&T.setTexture("lightmapSampler",this._lightmapTexture),R.k.SpecularTextureEnabled&&(this._metallicTexture?T.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&T.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&T.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&l.REFLECTANCE&&T.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&T.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&c.getCaps().standardDerivatives&&R.k.BumpTextureEnabled&&!this._disableBumpMap&&T.setTexture("bumpSampler",this._bumpTexture)),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.getScene().depthPeelingRenderer.bind(h),this._eventInfo.subMesh=r,this._callbackPluginEventBindForSubMesh(this._eventInfo),E.G.BindClipPlane(this._activeEffect,o),this.bindEyePosition(h)}else o.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!d&&this.isFrozen||(o.lightsEnabled&&!this._disableLighting&&E.G.BindLights(o,t,this._activeEffect,l,this._maxSimultaneousLights),(o.fogEnabled&&t.applyFog&&o.fogMode!==u.x.FOGMODE_NONE||f||t.receiveShadows||l.PREPASS)&&this.bindView(h),E.G.BindFogParameters(o,t,this._activeEffect,!0),l.NUM_MORPH_INFLUENCERS&&E.G.BindMorphTargetParameters(t,this._activeEffect),l.BAKED_VERTEX_ANIMATION_TEXTURE&&(null===(a=t.bakedVertexAnimationManager)||void 0===a||a.bind(h,l.INSTANCES)),this._imageProcessingConfiguration.bind(this._activeEffect),E.G.BindLogDepth(l,this._activeEffect,o)),this._afterBind(t,this._activeEffect),T.update()}}},t.prototype.getAnimatables=function(){var t=e.prototype.getAnimatables.call(this);return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&t.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&t.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&t.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&t.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&t.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?t.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&t.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&t.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&t.push(this._lightmapTexture),t},t.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._albedoTexture&&t.push(this._albedoTexture),this._ambientTexture&&t.push(this._ambientTexture),this._opacityTexture&&t.push(this._opacityTexture),this._reflectionTexture&&t.push(this._reflectionTexture),this._emissiveTexture&&t.push(this._emissiveTexture),this._reflectivityTexture&&t.push(this._reflectivityTexture),this._metallicTexture&&t.push(this._metallicTexture),this._metallicReflectanceTexture&&t.push(this._metallicReflectanceTexture),this._reflectanceTexture&&t.push(this._reflectanceTexture),this._microSurfaceTexture&&t.push(this._microSurfaceTexture),this._bumpTexture&&t.push(this._bumpTexture),this._lightmapTexture&&t.push(this._lightmapTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this._albedoTexture===t||(this._ambientTexture===t||(this._opacityTexture===t||(this._reflectionTexture===t||(this._reflectivityTexture===t||(this._metallicTexture===t||(this._metallicReflectanceTexture===t||(this._reflectanceTexture===t||(this._microSurfaceTexture===t||(this._bumpTexture===t||this._lightmapTexture===t))))))))))},t.prototype.setPrePassRenderer=function(){var e;if(null===(e=this.subSurface)||void 0===e?void 0:e.isScatteringEnabled){var t=this.getScene().enableSubSurfaceForPrePass();return t&&(t.enabled=!0),!0}return!1},t.prototype.dispose=function(t,r){var i,n,s,a,o,u,l,h,c,d,p,_;r&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(i=this._albedoTexture)||void 0===i||i.dispose(),null===(n=this._ambientTexture)||void 0===n||n.dispose(),null===(s=this._opacityTexture)||void 0===s||s.dispose(),null===(a=this._reflectionTexture)||void 0===a||a.dispose(),null===(o=this._emissiveTexture)||void 0===o||o.dispose(),null===(u=this._metallicTexture)||void 0===u||u.dispose(),null===(l=this._reflectivityTexture)||void 0===l||l.dispose(),null===(h=this._bumpTexture)||void 0===h||h.dispose(),null===(c=this._lightmapTexture)||void 0===c||c.dispose(),null===(d=this._metallicReflectanceTexture)||void 0===d||d.dispose(),null===(p=this._reflectanceTexture)||void 0===p||p.dispose(),null===(_=this._microSurfaceTexture)||void 0===_||_.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t,r)},t.PBRMATERIAL_OPAQUE=T.F.MATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=T.F.MATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=T.F.MATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=T.F.MATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,t.LIGHTFALLOFF_PHYSICAL=0,t.LIGHTFALLOFF_GLTF=1,t.LIGHTFALLOFF_STANDARD=2,(0,i.gn)([(0,n.rX)()],t.prototype,"_imageProcessingConfiguration",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsMiscDirty")],t.prototype,"debugMode",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"useLogarithmicDepth",null),t}(x.a)},13283:(e,t,r)=>{r.d(t,{Y:()=>h,d:()=>l});var i=r(31191),n=r(96969),s=r(15631),a=r(46110),o=r(90360),u=r(32836),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.CLEARCOAT=!1,t.CLEARCOAT_DEFAULTIOR=!1,t.CLEARCOAT_TEXTURE=!1,t.CLEARCOAT_TEXTURE_ROUGHNESS=!1,t.CLEARCOAT_TEXTUREDIRECTUV=0,t.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_BUMPDIRECTUV=0,t.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,t.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1,t.CLEARCOAT_REMAP_F0=!1,t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1,t.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,t.CLEARCOAT_TINT_GAMMATEXTURE=!1,t}return(0,i.ZT)(t,e),t}(r(64849).H),h=function(e){function t(r,i){void 0===i&&(i=!0);var n=e.call(this,r,"PBRClearCoat",100,new l,i)||this;return n._isEnabled=!1,n.isEnabled=!1,n.intensity=1,n.roughness=0,n._indexOfRefraction=t._DefaultIndexOfRefraction,n.indexOfRefraction=t._DefaultIndexOfRefraction,n._texture=null,n.texture=null,n._useRoughnessFromMainTexture=!0,n.useRoughnessFromMainTexture=!0,n._textureRoughness=null,n.textureRoughness=null,n._remapF0OnInterfaceChange=!0,n.remapF0OnInterfaceChange=!0,n._bumpTexture=null,n.bumpTexture=null,n._isTintEnabled=!1,n.isTintEnabled=!1,n.tintColor=s.Wo.White(),n.tintColorAtDistance=1,n.tintThickness=1,n._tintTexture=null,n.tintTexture=null,n._internalMarkAllSubMeshesAsTexturesDirty=r._dirtyCallbacks[1],n}return(0,i.ZT)(t,e),t.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},t.prototype.isReadyForSubMesh=function(e,t,r){if(!this._isEnabled)return!0;var i=this._material._disableBumpMap;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&a.k.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&a.k.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(r.getCaps().standardDerivatives&&this._bumpTexture&&a.k.ClearCoatBumpTextureEnabled&&!i&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&a.k.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0},t.prototype.prepareDefines=function(e,r){var i;this._isEnabled?(e.CLEARCOAT=!0,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=null!==this._texture&&this._texture._texture===(null===(i=this._textureRoughness)||void 0===i?void 0:i._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),e.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,e._areTexturesDirty&&r.texturesEnabled&&(this._texture&&a.k.ClearCoatTextureEnabled?o.G.PrepareDefinesForMergedUV(this._texture,e,"CLEARCOAT_TEXTURE"):e.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&a.k.ClearCoatTextureEnabled?o.G.PrepareDefinesForMergedUV(this._textureRoughness,e,"CLEARCOAT_TEXTURE_ROUGHNESS"):e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&a.k.ClearCoatBumpTextureEnabled?o.G.PrepareDefinesForMergedUV(this._bumpTexture,e,"CLEARCOAT_BUMP"):e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===t._DefaultIndexOfRefraction,this._isTintEnabled?(e.CLEARCOAT_TINT=!0,this._tintTexture&&a.k.ClearCoatTintTextureEnabled?(o.G.PrepareDefinesForMergedUV(this._tintTexture,e,"CLEARCOAT_TINT_TEXTURE"),e.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):e.CLEARCOAT_TINT_TEXTURE=!1):(e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1))):(e.CLEARCOAT=!1,e.CLEARCOAT_TEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=!1)},t.prototype.bindForSubMesh=function(e,t,r,i){var n,s,u,l,h,c,d,p;if(this._isEnabled){var _=i.materialDefines,f=this._material.isFrozen,T=this._material._disableBumpMap,g=this._material._invertNormalMapX,m=this._material._invertNormalMapY,x=_.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL;if(!e.useUbo||!f||!e.isSync){x&&a.k.ClearCoatTextureEnabled?(e.updateFloat4("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),o.G.BindTextureMatrix(this._texture,e,"clearCoat")):(this._texture||this._textureRoughness)&&a.k.ClearCoatTextureEnabled&&(e.updateFloat4("vClearCoatInfos",null!==(s=null===(n=this._texture)||void 0===n?void 0:n.coordinatesIndex)&&void 0!==s?s:0,null!==(l=null===(u=this._texture)||void 0===u?void 0:u.level)&&void 0!==l?l:0,null!==(c=null===(h=this._textureRoughness)||void 0===h?void 0:h.coordinatesIndex)&&void 0!==c?c:0,null!==(p=null===(d=this._textureRoughness)||void 0===d?void 0:d.level)&&void 0!==p?p:0),this._texture&&o.G.BindTextureMatrix(this._texture,e,"clearCoat"),!this._textureRoughness||x||_.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE||o.G.BindTextureMatrix(this._textureRoughness,e,"clearCoatRoughness")),this._bumpTexture&&r.getCaps().standardDerivatives&&a.k.ClearCoatTextureEnabled&&!T&&(e.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),o.G.BindTextureMatrix(this._bumpTexture,e,"clearCoatBump"),t._mirroredCameraPosition?e.updateFloat2("vClearCoatTangentSpaceParams",g?1:-1,m?1:-1):e.updateFloat2("vClearCoatTangentSpaceParams",g?-1:1,m?-1:1)),this._tintTexture&&a.k.ClearCoatTintTextureEnabled&&(e.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),o.G.BindTextureMatrix(this._tintTexture,e,"clearCoatTint")),e.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var E=1-this._indexOfRefraction,v=1+this._indexOfRefraction,R=Math.pow(-E/v,2),y=1/this._indexOfRefraction;e.updateFloat4("vClearCoatRefractionParams",R,y,E,v),this._isTintEnabled&&(e.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),e.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}t.texturesEnabled&&(this._texture&&a.k.ClearCoatTextureEnabled&&e.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!x&&!_.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&a.k.ClearCoatTextureEnabled&&e.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&r.getCaps().standardDerivatives&&a.k.ClearCoatBumpTextureEnabled&&!T&&e.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&a.k.ClearCoatTintTextureEnabled&&e.setTexture("clearCoatTintSampler",this._tintTexture))}},t.prototype.hasTexture=function(e){return this._texture===e||(this._textureRoughness===e||(this._bumpTexture===e||this._tintTexture===e))},t.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness),this._bumpTexture&&e.push(this._bumpTexture),this._tintTexture&&e.push(this._tintTexture)},t.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&e.push(this._tintTexture)},t.prototype.dispose=function(e){var t,r,i,n;e&&(null===(t=this._texture)||void 0===t||t.dispose(),null===(r=this._textureRoughness)||void 0===r||r.dispose(),null===(i=this._bumpTexture)||void 0===i||i.dispose(),null===(n=this._tintTexture)||void 0===n||n.dispose())},t.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},t.prototype.addFallbacks=function(e,t,r){return e.CLEARCOAT_BUMP&&t.addFallback(r++,"CLEARCOAT_BUMP"),e.CLEARCOAT_TINT&&t.addFallback(r++,"CLEARCOAT_TINT"),e.CLEARCOAT&&t.addFallback(r++,"CLEARCOAT"),r},t.prototype.getSamplers=function(e){e.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")},t.prototype.getUniforms=function(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}},t._DefaultIndexOfRefraction=1.5,(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isEnabled",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"intensity",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"roughness",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"indexOfRefraction",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"texture",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMainTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"textureRoughness",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"remapF0OnInterfaceChange",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isTintEnabled",void 0),(0,i.gn)([(0,n.n9)()],t.prototype,"tintColor",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"tintColorAtDistance",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"tintThickness",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"tintTexture",void 0),t}(u.n)},91878:(e,t,r)=>{r.d(t,{B:()=>l,f:()=>u});var i=r(31191),n=r(96969),s=r(46110),a=r(90360),o=r(32836),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.IRIDESCENCE=!1,t.IRIDESCENCE_TEXTURE=!1,t.IRIDESCENCE_TEXTUREDIRECTUV=0,t.IRIDESCENCE_THICKNESS_TEXTURE=!1,t.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0,t.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=!1,t}return(0,i.ZT)(t,e),t}(r(64849).H),l=function(e){function t(r,i){void 0===i&&(i=!0);var n=e.call(this,r,"PBRIridescence",110,new u,i)||this;return n._isEnabled=!1,n.isEnabled=!1,n.intensity=1,n.minimumThickness=t._DefaultMinimumThickness,n.maximumThickness=t._DefaultMaximumThickness,n.indexOfRefraction=t._DefaultIndexOfRefraction,n._texture=null,n.texture=null,n._thicknessTexture=null,n.thicknessTexture=null,n._internalMarkAllSubMeshesAsTexturesDirty=r._dirtyCallbacks[1],n}return(0,i.ZT)(t,e),t.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},t.prototype.isReadyForSubMesh=function(e,t){if(!this._isEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&s.k.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&s.k.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0},t.prototype.prepareDefines=function(e,t){var r;this._isEnabled?(e.IRIDESCENCE=!0,e.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=null!==this._texture&&this._texture._texture===(null===(r=this._thicknessTexture)||void 0===r?void 0:r._texture)&&this._texture.checkTransformsAreIdentical(this._thicknessTexture),e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&s.k.IridescenceTextureEnabled?a.G.PrepareDefinesForMergedUV(this._texture,e,"IRIDESCENCE_TEXTURE"):e.IRIDESCENCE_TEXTURE=!1,!e.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&this._thicknessTexture&&s.k.IridescenceTextureEnabled?a.G.PrepareDefinesForMergedUV(this._thicknessTexture,e,"IRIDESCENCE_THICKNESS_TEXTURE"):e.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(e.IRIDESCENCE=!1,e.IRIDESCENCE_TEXTURE=!1,e.IRIDESCENCE_THICKNESS_TEXTURE=!1,e.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=!1)},t.prototype.bindForSubMesh=function(e,t,r,i){var n,o,u,l,h,c,d,p;if(this._isEnabled){var _=i.materialDefines,f=this._material.isFrozen,T=_.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE;e.useUbo&&f&&e.isSync||(T&&s.k.IridescenceTextureEnabled?(e.updateFloat4("vIridescenceInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),a.G.BindTextureMatrix(this._texture,e,"iridescence")):(this._texture||this._thicknessTexture)&&s.k.IridescenceTextureEnabled&&(e.updateFloat4("vIridescenceInfos",null!==(o=null===(n=this._texture)||void 0===n?void 0:n.coordinatesIndex)&&void 0!==o?o:0,null!==(l=null===(u=this._texture)||void 0===u?void 0:u.level)&&void 0!==l?l:0,null!==(c=null===(h=this._thicknessTexture)||void 0===h?void 0:h.coordinatesIndex)&&void 0!==c?c:0,null!==(p=null===(d=this._thicknessTexture)||void 0===d?void 0:d.level)&&void 0!==p?p:0),this._texture&&a.G.BindTextureMatrix(this._texture,e,"iridescence"),!this._thicknessTexture||T||_.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE||a.G.BindTextureMatrix(this._thicknessTexture,e,"iridescenceThickness")),e.updateFloat4("vIridescenceParams",this.intensity,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)),t.texturesEnabled&&(this._texture&&s.k.IridescenceTextureEnabled&&e.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&!T&&!_.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&s.k.IridescenceTextureEnabled&&e.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}},t.prototype.hasTexture=function(e){return this._texture===e||this._thicknessTexture===e},t.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture),this._thicknessTexture&&e.push(this._thicknessTexture)},t.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture)},t.prototype.dispose=function(e){var t,r;e&&(null===(t=this._texture)||void 0===t||t.dispose(),null===(r=this._thicknessTexture)||void 0===r||r.dispose())},t.prototype.getClassName=function(){return"PBRIridescenceConfiguration"},t.prototype.addFallbacks=function(e,t,r){return e.IRIDESCENCE&&t.addFallback(r++,"IRIDESCENCE"),r},t.prototype.getSamplers=function(e){e.push("iridescenceSampler","iridescenceThicknessSampler")},t.prototype.getUniforms=function(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}},t._DefaultMinimumThickness=100,t._DefaultMaximumThickness=400,t._DefaultIndexOfRefraction=1.3,(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isEnabled",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"intensity",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"minimumThickness",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"maximumThickness",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"indexOfRefraction",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"texture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"thicknessTexture",void 0),t}(o.n)},47914:(e,t,r)=>{r.d(t,{Y:()=>l});var i=r(31191),n=r(96969),s=r(73556),a=r(15631),o=r(12746),u=r(48620),l=function(e){function t(r,i){var n=e.call(this,r,i)||this;return n.directIntensity=1,n.emissiveIntensity=1,n.environmentIntensity=1,n.specularIntensity=1,n.disableBumpMap=!1,n.ambientTextureStrength=1,n.ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,n.metallicF0Factor=1,n.metallicReflectanceColor=a.Wo.White(),n.useOnlyMetallicFromMetallicReflectanceTexture=!1,n.ambientColor=new a.Wo(0,0,0),n.albedoColor=new a.Wo(1,1,1),n.reflectivityColor=new a.Wo(1,1,1),n.reflectionColor=new a.Wo(1,1,1),n.emissiveColor=new a.Wo(0,0,0),n.microSurface=1,n.useLightmapAsShadowmap=!1,n.useAlphaFromAlbedoTexture=!1,n.forceAlphaTest=!1,n.alphaCutOff=.4,n.useSpecularOverAlpha=!0,n.useMicroSurfaceFromReflectivityMapAlpha=!1,n.useRoughnessFromMetallicTextureAlpha=!0,n.useRoughnessFromMetallicTextureGreen=!1,n.useMetallnessFromMetallicTextureBlue=!1,n.useAmbientOcclusionFromMetallicTextureRed=!1,n.useAmbientInGrayScale=!1,n.useAutoMicroSurfaceFromReflectivityMap=!1,n.useRadianceOverAlpha=!0,n.useObjectSpaceNormalMap=!1,n.useParallax=!1,n.useParallaxOcclusion=!1,n.parallaxScaleBias=.05,n.disableLighting=!1,n.forceIrradianceInFragment=!1,n.maxSimultaneousLights=4,n.invertNormalMapX=!1,n.invertNormalMapY=!1,n.twoSidedLighting=!1,n.useAlphaFresnel=!1,n.useLinearAlphaFresnel=!1,n.environmentBRDFTexture=null,n.forceNormalForward=!1,n.enableSpecularAntiAliasing=!1,n.useHorizonOcclusion=!0,n.useRadianceOcclusion=!0,n.unlit=!1,n._environmentBRDFTexture=(0,s.$)(n.getScene()),n}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this.subSurface.indexOfRefraction},set:function(e){this.subSurface.indexOfRefraction=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(e){this.subSurface.invertRefractionY=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===o.m.LIGHTFALLOFF_PHYSICAL},set:function(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?o.m.LIGHTFALLOFF_PHYSICAL:o.m.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===o.m.LIGHTFALLOFF_GLTF},set:function(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?o.m.LIGHTFALLOFF_GLTF:o.m.LIGHTFALLOFF_STANDARD)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PBRMaterial"},t.prototype.clone=function(e){var r=this,i=n.p4.Clone((function(){return new t(e,r.getScene())}),this);return i.id=e,i.name=e,this.stencil.copyTo(i.stencil),this.clearCoat.copyTo(i.clearCoat),this.anisotropy.copyTo(i.anisotropy),this.brdf.copyTo(i.brdf),this.sheen.copyTo(i.sheen),this.subSurface.copyTo(i.subSurface),i},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.PBRMaterial",t.clearCoat=this.clearCoat.serialize(),t.anisotropy=this.anisotropy.serialize(),t.brdf=this.brdf.serialize(),t.sheen=this.sheen.serialize(),t.subSurface=this.subSurface.serialize(),t.iridescence=this.iridescence.serialize(),t},t.Parse=function(e,r,i){var s=n.p4.Parse((function(){return new t(e.name,r)}),e,r,i);return e.stencil&&s.stencil.parse(e.stencil,r,i),e.clearCoat&&s.clearCoat.parse(e.clearCoat,r,i),e.anisotropy&&s.anisotropy.parse(e.anisotropy,r,i),e.brdf&&s.brdf.parse(e.brdf,r,i),e.sheen&&s.sheen.parse(e.sheen,r,i),e.subSurface&&s.subSurface.parse(e.subSurface,r,i),e.iridescence&&s.iridescence.parse(e.iridescence,r,i),s},t.PBRMATERIAL_OPAQUE=o.m.PBRMATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=o.m.PBRMATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=o.m.PBRMATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=o.m.PBRMATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=o.m.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"directIntensity",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveIntensity",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentIntensity",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"specularIntensity",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"disableBumpMap",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTexture",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureStrength",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"opacityTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicTexture",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicF0Factor",void 0),(0,i.gn)([(0,n.n9)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicReflectanceColor",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicReflectanceTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectanceTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurfaceTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),(0,i.gn)([(0,n.n9)("ambient"),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientColor",void 0),(0,i.gn)([(0,n.n9)("albedo"),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoColor",void 0),(0,i.gn)([(0,n.n9)("reflectivity"),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityColor",void 0),(0,i.gn)([(0,n.n9)("reflection"),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionColor",void 0),(0,i.gn)([(0,n.n9)("emissive"),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurface",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"useAlphaFromAlbedoTexture",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"forceAlphaTest",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"alphaCutOff",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useSpecularOverAlpha",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientInGrayScale",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"usePhysicalLightFalloff",null),(0,i.gn)([(0,n.qC)()],t.prototype,"useGLTFLightFalloff",null),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOverAlpha",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useObjectSpaceNormalMap",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallax",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallaxOcclusion",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"parallaxScaleBias",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceIrradianceInFragment",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"twoSidedLighting",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAlphaFresnel",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLinearAlphaFresnel",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentBRDFTexture",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceNormalForward",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableSpecularAntiAliasing",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useHorizonOcclusion",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOcclusion",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsMiscDirty")],t.prototype,"unlit",void 0),t}(o.m);(0,u.H)("BABYLON.PBRMaterial",l)},73744:(e,t,r)=>{r.d(t,{A:()=>l,B:()=>h});var i=r(31191),n=r(96969),s=r(15631),a=r(46110),o=r(90360),u=r(32836),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SHEEN=!1,t.SHEEN_TEXTURE=!1,t.SHEEN_GAMMATEXTURE=!1,t.SHEEN_TEXTURE_ROUGHNESS=!1,t.SHEEN_TEXTUREDIRECTUV=0,t.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,t.SHEEN_LINKWITHALBEDO=!1,t.SHEEN_ROUGHNESS=!1,t.SHEEN_ALBEDOSCALING=!1,t.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,t.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1,t}return(0,i.ZT)(t,e),t}(r(64849).H),h=function(e){function t(t,r){void 0===r&&(r=!0);var i=e.call(this,t,"Sheen",120,new l,r)||this;return i._isEnabled=!1,i.isEnabled=!1,i._linkSheenWithAlbedo=!1,i.linkSheenWithAlbedo=!1,i.intensity=1,i.color=s.Wo.White(),i._texture=null,i.texture=null,i._useRoughnessFromMainTexture=!0,i.useRoughnessFromMainTexture=!0,i._roughness=null,i.roughness=null,i._textureRoughness=null,i.textureRoughness=null,i._albedoScaling=!1,i.albedoScaling=!1,i._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1],i}return(0,i.ZT)(t,e),t.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},t.prototype.isReadyForSubMesh=function(e,t){if(!this._isEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&a.k.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&a.k.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0},t.prototype.prepareDefines=function(e,t){var r;this._isEnabled?(e.SHEEN=!0,e.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,e.SHEEN_ROUGHNESS=null!==this._roughness,e.SHEEN_ALBEDOSCALING=this._albedoScaling,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=null!==this._texture&&this._texture._texture===(null===(r=this._textureRoughness)||void 0===r?void 0:r._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness),e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&a.k.SheenTextureEnabled?(o.G.PrepareDefinesForMergedUV(this._texture,e,"SHEEN_TEXTURE"),e.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):e.SHEEN_TEXTURE=!1,this._textureRoughness&&a.k.SheenTextureEnabled?o.G.PrepareDefinesForMergedUV(this._textureRoughness,e,"SHEEN_TEXTURE_ROUGHNESS"):e.SHEEN_TEXTURE_ROUGHNESS=!1)):(e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS=!1,e.SHEEN_LINKWITHALBEDO=!1,e.SHEEN_ROUGHNESS=!1,e.SHEEN_ALBEDOSCALING=!1,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=!1)},t.prototype.bindForSubMesh=function(e,t,r,i){var n,s,u,l,h,c,d,p;if(this._isEnabled){var _=i.materialDefines,f=this._material.isFrozen,T=_.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL;e.useUbo&&f&&e.isSync||(T&&a.k.SheenTextureEnabled?(e.updateFloat4("vSheenInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1),o.G.BindTextureMatrix(this._texture,e,"sheen")):(this._texture||this._textureRoughness)&&a.k.SheenTextureEnabled&&(e.updateFloat4("vSheenInfos",null!==(s=null===(n=this._texture)||void 0===n?void 0:n.coordinatesIndex)&&void 0!==s?s:0,null!==(l=null===(u=this._texture)||void 0===u?void 0:u.level)&&void 0!==l?l:0,null!==(c=null===(h=this._textureRoughness)||void 0===h?void 0:h.coordinatesIndex)&&void 0!==c?c:0,null!==(p=null===(d=this._textureRoughness)||void 0===d?void 0:d.level)&&void 0!==p?p:0),this._texture&&o.G.BindTextureMatrix(this._texture,e,"sheen"),!this._textureRoughness||T||_.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE||o.G.BindTextureMatrix(this._textureRoughness,e,"sheenRoughness")),e.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),null!==this._roughness&&e.updateFloat("vSheenRoughness",this._roughness)),t.texturesEnabled&&(this._texture&&a.k.SheenTextureEnabled&&e.setTexture("sheenSampler",this._texture),this._textureRoughness&&!T&&!_.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&a.k.SheenTextureEnabled&&e.setTexture("sheenRoughnessSampler",this._textureRoughness))}},t.prototype.hasTexture=function(e){return this._texture===e||this._textureRoughness===e},t.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness)},t.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness)},t.prototype.dispose=function(e){var t,r;e&&(null===(t=this._texture)||void 0===t||t.dispose(),null===(r=this._textureRoughness)||void 0===r||r.dispose())},t.prototype.getClassName=function(){return"PBRSheenConfiguration"},t.prototype.addFallbacks=function(e,t,r){return e.SHEEN&&t.addFallback(r++,"SHEEN"),r},t.prototype.getSamplers=function(e){e.push("sheenSampler","sheenRoughnessSampler")},t.prototype.getUniforms=function(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}},(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isEnabled",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"linkSheenWithAlbedo",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"intensity",void 0),(0,i.gn)([(0,n.n9)()],t.prototype,"color",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"texture",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMainTexture",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"textureRoughness",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoScaling",void 0),t}(u.n)},70741:(e,t,r)=>{r.d(t,{H:()=>c,u:()=>d});var i=r(31191),n=r(96969),s=r(15631),a=r(46110),o=r(90360),u=r(72739),l=r(58095),h=r(32836),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SUBSURFACE=!1,t.SS_REFRACTION=!1,t.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=!1,t.SS_TRANSLUCENCY=!1,t.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=!1,t.SS_SCATTERING=!1,t.SS_THICKNESSANDMASK_TEXTURE=!1,t.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,t.SS_HAS_THICKNESS=!1,t.SS_REFRACTIONINTENSITY_TEXTURE=!1,t.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,t.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,t.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,t.SS_REFRACTIONMAP_3D=!1,t.SS_REFRACTIONMAP_OPPOSITEZ=!1,t.SS_LODINREFRACTIONALPHA=!1,t.SS_GAMMAREFRACTION=!1,t.SS_RGBDREFRACTION=!1,t.SS_LINEARSPECULARREFRACTION=!1,t.SS_LINKREFRACTIONTOTRANSPARENCY=!1,t.SS_ALBEDOFORREFRACTIONTINT=!1,t.SS_ALBEDOFORTRANSLUCENCYTINT=!1,t.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,t.SS_USE_THICKNESS_AS_DEPTH=!1,t.SS_MASK_FROM_THICKNESS_TEXTURE=!1,t.SS_USE_GLTF_TEXTURES=!1,t}return(0,i.ZT)(t,e),t}(r(64849).H),d=function(e){function t(t,r){void 0===r&&(r=!0);var i=e.call(this,t,"PBRSubSurface",130,new c,r)||this;return i._isRefractionEnabled=!1,i.isRefractionEnabled=!1,i._isTranslucencyEnabled=!1,i.isTranslucencyEnabled=!1,i._isScatteringEnabled=!1,i.isScatteringEnabled=!1,i._scatteringDiffusionProfileIndex=0,i.refractionIntensity=1,i.translucencyIntensity=1,i.useAlbedoToTintRefraction=!1,i.useAlbedoToTintTranslucency=!1,i._thicknessTexture=null,i.thicknessTexture=null,i._refractionTexture=null,i.refractionTexture=null,i._indexOfRefraction=1.5,i.indexOfRefraction=1.5,i._volumeIndexOfRefraction=-1,i._invertRefractionY=!1,i.invertRefractionY=!1,i._linkRefractionWithTransparency=!1,i.linkRefractionWithTransparency=!1,i.minimumThickness=0,i.maximumThickness=1,i.useThicknessAsDepth=!1,i.tintColor=s.Wo.White(),i.tintColorAtDistance=1,i.diffusionDistance=s.Wo.White(),i._useMaskFromThicknessTexture=!1,i.useMaskFromThicknessTexture=!1,i._refractionIntensityTexture=null,i.refractionIntensityTexture=null,i._translucencyIntensityTexture=null,i.translucencyIntensityTexture=null,i._useGltfStyleTextures=!1,i.useGltfStyleTextures=!1,i._scene=t.getScene(),i.registerForExtraEvents=!0,i._internalMarkAllSubMeshesAsTexturesDirty=t._dirtyCallbacks[1],i._internalMarkScenePrePassDirty=t._dirtyCallbacks[32],i}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"scatteringDiffusionProfile",{get:function(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null},set:function(e){this._scene.enableSubSurfaceForPrePass()&&e&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volumeIndexOfRefraction",{get:function(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction},set:function(e){this._volumeIndexOfRefraction=e>=1?e:-1},enumerable:!1,configurable:!0}),t.prototype._markAllSubMeshesAsTexturesDirty=function(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()},t.prototype._markScenePrePassDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()},t.prototype.isReadyForSubMesh=function(e,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(e._areTexturesDirty&&t.texturesEnabled){if(this._thicknessTexture&&a.k.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var r=this._getRefractionTexture(t);if(r&&a.k.RefractionTextureEnabled&&!r.isReadyOrNotBlocking())return!1}return!0},t.prototype.prepareDefines=function(e,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return e.SUBSURFACE=!1,e.SS_TRANSLUCENCY=!1,e.SS_SCATTERING=!1,void(e.SS_REFRACTION=!1);if(e._areTexturesDirty){e.SUBSURFACE=!0,e.SS_TRANSLUCENCY=this._isTranslucencyEnabled,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=!1,e.SS_SCATTERING=this._isScatteringEnabled,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_HAS_THICKNESS=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE=!1,e.SS_USE_GLTF_TEXTURES=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=!1,e.SS_REFRACTIONMAP_3D=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1;var r=!!this._thicknessTexture&&!!this._refractionIntensityTexture&&this._refractionIntensityTexture.checkTransformsAreIdentical(this._thicknessTexture)&&this._refractionIntensityTexture._texture===this._thicknessTexture._texture,i=!!this._thicknessTexture&&!!this._translucencyIntensityTexture&&this._translucencyIntensityTexture.checkTransformsAreIdentical(this._thicknessTexture)&&this._translucencyIntensityTexture._texture===this._thicknessTexture._texture,n=(r||!this._refractionIntensityTexture)&&(i||!this._translucencyIntensityTexture);if(e._areTexturesDirty&&t.texturesEnabled&&(this._thicknessTexture&&a.k.ThicknessTextureEnabled&&o.G.PrepareDefinesForMergedUV(this._thicknessTexture,e,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&a.k.RefractionIntensityTextureEnabled&&!n&&o.G.PrepareDefinesForMergedUV(this._refractionIntensityTexture,e,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&a.k.TranslucencyIntensityTextureEnabled&&!n&&o.G.PrepareDefinesForMergedUV(this._translucencyIntensityTexture,e,"SS_TRANSLUCENCYINTENSITY_TEXTURE")),e.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!=0,e.SS_MASK_FROM_THICKNESS_TEXTURE=(this._useMaskFromThicknessTexture||!!this._refractionIntensityTexture||!!this._translucencyIntensityTexture)&&n,e.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,e.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=(this._useMaskFromThicknessTexture||!!this._refractionIntensityTexture)&&n,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=(this._useMaskFromThicknessTexture||!!this._translucencyIntensityTexture)&&n,this._isRefractionEnabled&&t.texturesEnabled){var s=this._getRefractionTexture(t);s&&a.k.RefractionTextureEnabled&&(e.SS_REFRACTION=!0,e.SS_REFRACTIONMAP_3D=s.isCube,e.SS_GAMMAREFRACTION=s.gammaSpace,e.SS_RGBDREFRACTION=s.isRGBD,e.SS_LINEARSPECULARREFRACTION=s.linearSpecularLOD,e.SS_REFRACTIONMAP_OPPOSITEZ=s.invertZ,e.SS_LODINREFRACTIONALPHA=s.lodLevelInAlpha,e.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,e.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=s.isCube&&s.boundingBoxSize,e.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(e.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}},t.prototype.hardBindForSubMesh=function(e,t,r,i){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled){i.getRenderingMesh().getWorldMatrix().decompose(l.jp.Vector3[0]);var n=Math.max(Math.abs(l.jp.Vector3[0].x),Math.abs(l.jp.Vector3[0].y),Math.abs(l.jp.Vector3[0].z));e.updateFloat2("vThicknessParam",this.minimumThickness*n,(this.maximumThickness-this.minimumThickness)*n)}},t.prototype.bindForSubMesh=function(e,t,r,i){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled){var n=i.materialDefines,s=this._material.isFrozen,l=this._material.realTimeFiltering,h=n.LODBASEDMICROSFURACE,c=this._getRefractionTexture(t);if(!e.useUbo||!s||!e.isSync){if(this._thicknessTexture&&a.k.ThicknessTextureEnabled&&(e.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),o.G.BindTextureMatrix(this._thicknessTexture,e,"thickness")),this._refractionIntensityTexture&&a.k.RefractionIntensityTextureEnabled&&n.SS_REFRACTIONINTENSITY_TEXTURE&&(e.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),o.G.BindTextureMatrix(this._refractionIntensityTexture,e,"refractionIntensity")),this._translucencyIntensityTexture&&a.k.TranslucencyIntensityTextureEnabled&&n.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(e.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),o.G.BindTextureMatrix(this._translucencyIntensityTexture,e,"translucencyIntensity")),c&&a.k.RefractionTextureEnabled){e.updateMatrix("refractionMatrix",c.getReflectionTextureMatrix());var d=1;c.isCube||c.depth&&(d=c.depth);var p=c.getSize().width,_=this.volumeIndexOfRefraction;if(e.updateFloat4("vRefractionInfos",c.level,1/_,d,this._invertRefractionY?-1:1),e.updateFloat4("vRefractionMicrosurfaceInfos",p,c.lodGenerationScale,c.lodGenerationOffset,1/this.indexOfRefraction),l&&e.updateFloat2("vRefractionFilteringInfo",p,u.R.Log2(p)),c.boundingBoxSize){var f=c;e.updateVector3("vRefractionPosition",f.boundingBoxPosition),e.updateVector3("vRefractionSize",f.boundingBoxSize)}}this._isScatteringEnabled&&e.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),e.updateColor3("vDiffusionDistance",this.diffusionDistance),e.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),e.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0)}t.texturesEnabled&&(this._thicknessTexture&&a.k.ThicknessTextureEnabled&&e.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&a.k.RefractionIntensityTextureEnabled&&n.SS_REFRACTIONINTENSITY_TEXTURE&&e.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&a.k.TranslucencyIntensityTextureEnabled&&n.SS_TRANSLUCENCYINTENSITY_TEXTURE&&e.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),c&&a.k.RefractionTextureEnabled&&(h?e.setTexture("refractionSampler",c):(e.setTexture("refractionSampler",c._lodTextureMid||c),e.setTexture("refractionSamplerLow",c._lodTextureLow||c),e.setTexture("refractionSamplerHigh",c._lodTextureHigh||c))))}},t.prototype._getRefractionTexture=function(e){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?e.environmentTexture:null},Object.defineProperty(t.prototype,"disableAlphaBlending",{get:function(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!1,configurable:!0}),t.prototype.fillRenderTargetTextures=function(e){a.k.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&e.push(this._refractionTexture)},t.prototype.hasTexture=function(e){return this._thicknessTexture===e||this._refractionTexture===e},t.prototype.hasRenderTargetTextures=function(){return!!(a.k.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},t.prototype.getActiveTextures=function(e){this._thicknessTexture&&e.push(this._thicknessTexture),this._refractionTexture&&e.push(this._refractionTexture)},t.prototype.getAnimatables=function(e){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture)},t.prototype.dispose=function(e){e&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},t.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},t.prototype.addFallbacks=function(e,t,r){return e.SS_SCATTERING&&t.addFallback(r++,"SS_SCATTERING"),e.SS_TRANSLUCENCY&&t.addFallback(r++,"SS_TRANSLUCENCY"),r},t.prototype.getSamplers=function(e){e.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},t.prototype.getUniforms=function(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"}]}},(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isRefractionEnabled",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"isTranslucencyEnabled",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markScenePrePassDirty")],t.prototype,"isScatteringEnabled",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"refractionIntensity",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"translucencyIntensity",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"useAlbedoToTintRefraction",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"useAlbedoToTintTranslucency",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"thicknessTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"refractionTexture",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"indexOfRefraction",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"_volumeIndexOfRefraction",void 0),(0,i.gn)([(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"volumeIndexOfRefraction",null),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertRefractionY",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"linkRefractionWithTransparency",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"minimumThickness",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"maximumThickness",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"useThicknessAsDepth",void 0),(0,i.gn)([(0,n.n9)()],t.prototype,"tintColor",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"tintColorAtDistance",void 0),(0,i.gn)([(0,n.n9)()],t.prototype,"diffusionDistance",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMaskFromThicknessTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"refractionIntensityTexture",void 0),(0,i.gn)([(0,n.oU)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"translucencyIntensityTexture",void 0),(0,i.gn)([(0,n.qC)(),(0,n.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useGltfStyleTextures",void 0),t}(h.n)},87224:(e,t,r)=>{r.d(t,{u:()=>o});var i=r(6307),n=r(72739),s=r(77232),a=(r(7860),r(38403),r(84318)),o=function(){function e(e,t){void 0===t&&(t={}),this._lodGenerationOffset=0,this._lodGenerationScale=.8,this.quality=4096,this.hdrScale=1,this._engine=e,this.hdrScale=t.hdrScale||this.hdrScale,this.quality=t.quality||this.quality}return e.prototype._createRenderTarget=function(e){var t=0;this._engine.getCaps().textureHalfFloatRender?t=2:this._engine.getCaps().textureFloatRender&&(t=1);var r=this._engine.createRenderTargetCubeTexture(e,{format:5,type:t,createMipMaps:!0,generateMipMaps:!1,generateDepthBuffer:!1,generateStencilBuffer:!1,samplingMode:1});return this._engine.updateTextureWrappingMode(r.texture,0,0,0),this._engine.updateTextureSamplingMode(3,r.texture,!0),r},e.prototype._prefilterInternal=function(e){var t=e.getSize().width,r=n.R.ILog2(t)+1,s=this._effectWrapper.effect,a=this._createRenderTarget(t);this._effectRenderer.setViewport();var o=e.getInternalTexture();o&&this._engine.updateTextureSamplingMode(3,o,!0),this._effectRenderer.applyEffectWrapper(this._effectWrapper);var u=[[new i.P(0,0,-1),new i.P(0,-1,0),new i.P(1,0,0)],[new i.P(0,0,1),new i.P(0,-1,0),new i.P(-1,0,0)],[new i.P(1,0,0),new i.P(0,0,1),new i.P(0,1,0)],[new i.P(1,0,0),new i.P(0,0,-1),new i.P(0,-1,0)],[new i.P(1,0,0),new i.P(0,-1,0),new i.P(0,0,1)],[new i.P(-1,0,0),new i.P(0,-1,0),new i.P(0,0,-1)]];s.setFloat("hdrScale",this.hdrScale),s.setFloat2("vFilteringInfo",e.getSize().width,r),s.setTexture("inputTexture",e);for(var l=0;l<6;l++){s.setVector3("up",u[l][0]),s.setVector3("right",u[l][1]),s.setVector3("front",u[l][2]);for(var h=0;h<r;h++){this._engine.bindFramebuffer(a,l,void 0,void 0,!0,h),this._effectRenderer.applyEffectWrapper(this._effectWrapper);var c=Math.pow(2,(h-this._lodGenerationOffset)/this._lodGenerationScale)/t;0===h&&(c=0),s.setFloat("alphaG",c),this._effectRenderer.draw()}}return this._effectRenderer.restoreStates(),this._engine.restoreDefaultFramebuffer(),this._engine._releaseTexture(e._texture),a._swapAndDie(e._texture),e._prefiltered=!0,e},e.prototype._createEffect=function(e,t){var r=[];return e.gammaSpace&&r.push("#define GAMMA_INPUT"),r.push("#define NUM_SAMPLES "+this.quality+"u"),new s.H({engine:this._engine,name:"hdrFiltering",vertexShader:"hdrFiltering",fragmentShader:"hdrFiltering",samplerNames:["inputTexture"],uniformNames:["vSampleDirections","vWeights","up","right","front","vFilteringInfo","hdrScale","alphaG"],useShaderStore:!0,defines:r,onCompiled:t})},e.prototype.isReady=function(e){return e.isReady()&&this._effectWrapper.effect.isReady()},e.prototype.prefilter=function(e,t){var r=this;return void 0===t&&(t=null),this._engine._features.allowTexturePrefiltering?new Promise((function(i){r._effectRenderer=new s.I(r._engine),r._effectWrapper=r._createEffect(e),r._effectWrapper.effect.executeWhenCompiled((function(){r._prefilterInternal(e),r._effectRenderer.dispose(),r._effectWrapper.dispose(),i(),t&&t()}))})):(a.Y.Warn("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead."),Promise.reject("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead."))},e}()},22189:(e,t,r)=>{r.d(t,{s:()=>a});var i=r(69314),n=r(37290),s=r(88910),a=function(){function e(){this.supportCascades=!0}return e.prototype.canLoad=function(e){return e.endsWith(".dds")},e.prototype.loadCubeData=function(e,t,r,n){var a,o=t.getEngine(),u=!1,l=1e3;if(Array.isArray(e))for(var h=0;h<e.length;h++){var c=e[h];a=s.N.GetDDSInfo(c),t.width=a.width,t.height=a.height,u=(a.isRGB||a.isLuminance||a.mipmapCount>1)&&t.generateMipMaps,o._unpackFlipY(a.isCompressed),s.N.UploadDDSLevels(o,t,c,a,u,6,-1,h),a.isFourCC||1!==a.mipmapCount?l=a.mipmapCount-1:o.generateMipMapsForCubemap(t)}else{c=e;a=s.N.GetDDSInfo(c),t.width=a.width,t.height=a.height,r&&(a.sphericalPolynomial=new i.i),u=(a.isRGB||a.isLuminance||a.mipmapCount>1)&&t.generateMipMaps,o._unpackFlipY(a.isCompressed),s.N.UploadDDSLevels(o,t,c,a,u,6),a.isFourCC||1!==a.mipmapCount?l=a.mipmapCount-1:o.generateMipMapsForCubemap(t,!1)}o._setCubeMapTextureParams(t,u,l),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),n&&n({isDDS:!0,width:t.width,info:a,data:e,texture:t})},e.prototype.loadData=function(e,t,r){var i=s.N.GetDDSInfo(e),n=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&t.generateMipMaps&&i.width>>i.mipmapCount-1==1;r(i.width,i.height,n,i.isFourCC,(function(){s.N.UploadDDSLevels(t.getEngine(),t,e,i,n,1)}))},e}();n.D._TextureLoaders.push(new a)},19195:(e,t,r)=>{r.d(t,{v:()=>s});var i=r(71892),n=r(37290),s=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(e){return e.endsWith(".env")},e.prototype.loadCubeData=function(e,t,r,n,s){if(!Array.isArray(e)){var a=(0,i.qJ)(e);if(a){t.width=a.width,t.height=a.width;try{(0,i.qC)(t,a),(0,i.Ro)(t,e,a).then((function(){t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),n&&n()}),(function(e){null==s||s("Can not upload environment levels",e)}))}catch(e){null==s||s("Can not upload environment file",e)}}else s&&s("Can not parse the environment file",null)}},e.prototype.loadData=function(){throw".env not supported in 2d."},e}();n.D._TextureLoaders.push(new s)},25025:(e,t,r)=>{r.d(t,{c:()=>o});var i=r(88552),n=r(53669),s=r(37290),a=r(84318);var o=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(e,t){return e.endsWith(".ktx")||e.endsWith(".ktx2")||"image/ktx"===t||"image/ktx2"===t},e.prototype.loadCubeData=function(e,t,r,n){if(!Array.isArray(e)){t._invertVScale=!t.invertY;var s=t.getEngine(),a=new i.k(e,6),o=a.numberOfMipmapLevels>1&&t.generateMipMaps;s._unpackFlipY(!0),a.uploadLevels(t,t.generateMipMaps),t.width=a.pixelWidth,t.height=a.pixelHeight,s._setCubeMapTextureParams(t,o,a.numberOfMipmapLevels-1),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),n&&n()}},e.prototype.loadData=function(e,t,r,s){if(i.k.IsValid(e)){t._invertVScale=!t.invertY;var o=new i.k(e,1),u=function(e){switch(e){case 35916:return 33776;case 35918:return 33778;case 35919:return 33779;case 37493:return 37492;case 37497:return 37496;case 37495:return 37494;case 37840:return 37808;case 36493:return 36492}return null}(o.glInternalFormat);u?(t.format=u,t._useSRGBBuffer=t.getEngine()._getUseSRGBBuffer(!0,t.generateMipMaps),t._gammaSpace=!0):t.format=o.glInternalFormat,r(o.pixelWidth,o.pixelHeight,t.generateMipMaps,!0,(function(){o.uploadLevels(t,t.generateMipMaps)}),o.isInvalid)}else if(n.Z.IsValid(e)){new n.Z(t.getEngine()).uploadAsync(e,t,s).then((function(){r(t.width,t.height,t.generateMipMaps,!0,(function(){}),!1)}),(function(e){a.Y.Warn("Failed to load KTX2 texture data: ".concat(e.message)),r(0,0,!1,!1,(function(){}),!0)}))}else a.Y.Error("texture missing KTX identifier"),r(0,0,!1,!1,(function(){}),!0)},e}();s.D._TextureLoaders.unshift(new o)},19363:(e,t,r)=>{r.d(t,{x:()=>n});var i=r(31191),n=function(e){function t(t,r){void 0===r&&(r=512);var i=e.call(this,"multiview rtt",r,t,!1,!0,0,!1,void 0,!1,!1,!0,void 0,!0)||this;return i._renderTarget=i.getScene().getEngine().createMultiviewRenderTargetTexture(i.getRenderWidth(),i.getRenderHeight()),i._texture=i._renderTarget.texture,i._texture.isMultiview=!0,i._texture.format=5,i.samples=i._getEngine().getCaps().maxSamples||i.samples,i._texture.samples=i._samples,i}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"samples",{set:function(e){this._samples=e},enumerable:!1,configurable:!0}),t.prototype._bindFrameBuffer=function(){this._renderTarget&&this.getScene().getEngine().bindMultiviewFramebuffer(this._renderTarget)},t.prototype.getViewCount=function(){return 2},t}(r(63784)._)},91062:(e,t,r)=>{r.d(t,{g:()=>f});var i=r(31191),n=r(96969),s=r(62897),a=r(72208),o=r(85627),u=r(98163),l=r(73803),h=r(63784),c=r(2971),d=(r(13534),r(74500),r(38513),r(48620)),p=r(15210),_=r(67759),f=function(e){function t(t,r,i,n,u,l,h,d){void 0===u&&(u=null),void 0===l&&(l=!0),void 0===h&&(h=!1),void 0===d&&(d=0);var f=e.call(this,null,n,!l)||this;f.isEnabled=!0,f.autoClear=!0,f.onGeneratedObservable=new s.y$,f.onBeforeGenerationObservable=new s.y$,f.nodeMaterialSource=null,f._textures={},f._currentRefreshId=-1,f._frameId=-1,f._refreshRate=1,f._vertexBuffers={},f._uniforms=new Array,f._samplers=new Array,f._floats={},f._ints={},f._floatsArrays={},f._colors3={},f._colors4={},f._vectors2={},f._vectors3={},f._matrices={},f._fallbackTextureUsed=!1,f._cachedDefines=null,f._contentUpdateId=-1,f._rtWrapper=null;var T=(n=f.getScene()||p.l.LastCreatedScene)._getComponent(o.l.NAME_PROCEDURALTEXTURE);T||(T=new c.O(n),n._addComponent(T)),n.proceduralTextures.push(f),f._fullEngine=n.getEngine(),f.name=t,f.isRenderTarget=!0,f._size=r,f._textureType=d,f._generateMipMaps=l,f._drawWrapper=new _.q(f._fullEngine),f.setFragment(i),f._fallbackTexture=u;var g=f._createRtWrapper(h,r,l,d);f._texture=g.texture;var m=[];return m.push(1,1),m.push(-1,1),m.push(-1,-1),m.push(1,-1),f._vertexBuffers[a.o.PositionKind]=new a.o(f._fullEngine,m,a.o.PositionKind,!1,!1,2),f._createIndexBuffer(),f}return(0,i.ZT)(t,e),t.prototype._createRtWrapper=function(e,t,r,i){return e?(this._rtWrapper=this._fullEngine.createRenderTargetCubeTexture(t,{generateMipMaps:r,generateDepthBuffer:!1,generateStencilBuffer:!1,type:i}),this.setFloat("face",0)):this._rtWrapper=this._fullEngine.createRenderTargetTexture(t,{generateMipMaps:r,generateDepthBuffer:!1,generateStencilBuffer:!1,type:i}),this._rtWrapper},t.prototype.getEffect=function(){return this._drawWrapper.effect},t.prototype._setEffect=function(e){this._drawWrapper.effect=e},t.prototype.getContent=function(){var e=this;return this._contentData&&this._frameId===this._contentUpdateId||(this._contentData?this._contentData.then((function(t){e._contentData=e.readPixels(0,0,t),e._contentUpdateId=e._frameId})):(this._contentData=this.readPixels(0,0),this._contentUpdateId=this._frameId)),this._contentData},t.prototype._createIndexBuffer=function(){var e=this._fullEngine,t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},t.prototype._rebuild=function(){var e=this._vertexBuffers[a.o.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===h._.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=h._.REFRESHRATE_RENDER_ONCE)},t.prototype.reset=function(){var e;null===(e=this._drawWrapper.effect)||void 0===e||e.dispose()},t.prototype._getDefines=function(){return""},t.prototype.isReady=function(){var e,t=this,r=this._fullEngine;if(this.nodeMaterialSource)return this._drawWrapper.effect.isReady();if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;if(!this._texture)return!1;var i=this._getDefines();return!(!this._drawWrapper.effect||i!==this._cachedDefines||!this._drawWrapper.effect.isReady())||(e=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._cachedDefines!==i&&(this._cachedDefines=i,this._drawWrapper.effect=r.createEffect(e,[a.o.PositionKind],this._uniforms,this._samplers,i,void 0,void 0,(function(){var e;null===(e=t._rtWrapper)||void 0===e||e.dispose(),t._rtWrapper=t._texture=null,t._fallbackTexture&&(t._texture=t._fallbackTexture._texture,t._texture&&t._texture.incrementReferences()),t._fallbackTextureUsed=!0}))),this._drawWrapper.effect.isReady())},t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},t.prototype.setFragment=function(e){this._fragment=e},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),t.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,this._frameId++,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)},t.prototype.getRenderSize=function(){return this._size},t.prototype.resize=function(e,t){if(!this._fallbackTextureUsed&&this._rtWrapper&&this._texture){var r=this._texture.isCube;this._rtWrapper.dispose();var i=this._createRtWrapper(r,e,t,this._textureType);this._texture=i.texture,this._size=e,this._generateMipMaps=t}},t.prototype._checkUniform=function(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)},t.prototype.setTexture=function(e,t){return-1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[e]=t,this},t.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},t.prototype.setInt=function(e,t){return this._checkUniform(e),this._ints[e]=t,this},t.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},t.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},t.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},t.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},t.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},t.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},t.prototype.render=function(e){var t,r,i=this.getScene();if(i){var n=this._fullEngine;if(n.enableEffect(this._drawWrapper),this.onBeforeGenerationObservable.notifyObservers(this),n.setState(!1),!this.nodeMaterialSource){for(var s in this._textures)this._drawWrapper.effect.setTexture(s,this._textures[s]);for(var a in this._ints)this._drawWrapper.effect.setInt(a,this._ints[a]);for(var o in this._floats)this._drawWrapper.effect.setFloat(o,this._floats[o]);for(var l in this._floatsArrays)this._drawWrapper.effect.setArray(l,this._floatsArrays[l]);for(var h in this._colors3)this._drawWrapper.effect.setColor3(h,this._colors3[h]);for(var c in this._colors4){var d=this._colors4[c];this._drawWrapper.effect.setFloat4(c,d.r,d.g,d.b,d.a)}for(var p in this._vectors2)this._drawWrapper.effect.setVector2(p,this._vectors2[p]);for(var _ in this._vectors3)this._drawWrapper.effect.setVector3(_,this._vectors3[_]);for(var f in this._matrices)this._drawWrapper.effect.setMatrix(f,this._matrices[f])}if(this._texture&&this._rtWrapper){if(null===(t=n._debugPushGroup)||void 0===t||t.call(n,"procedural texture generation for ".concat(this.name),1),this.isCube)for(var T=0;T<6;T++)n.bindFramebuffer(this._rtWrapper,T,void 0,void 0,!0),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this._drawWrapper.effect.setFloat("face",T),this.autoClear&&n.clear(i.clearColor,!0,!1,!1),n.drawElementsType(u.F.TriangleFillMode,0,6);else n.bindFramebuffer(this._rtWrapper,0,void 0,void 0,!0),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._drawWrapper.effect),this.autoClear&&n.clear(i.clearColor,!0,!1,!1),n.drawElementsType(u.F.TriangleFillMode,0,6);n.unBindFramebuffer(this._rtWrapper,this.isCube),this.isCube&&n.generateMipMapsForCubemap(this._texture),null===(r=n._debugPopGroup)||void 0===r||r.call(n,1),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}}},t.prototype.clone=function(){var e=this.getSize(),r=new t(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.coordinatesMode=this.coordinatesMode,r},t.prototype.dispose=function(){var t=this.getScene();if(t){var r=t.proceduralTextures.indexOf(this);r>=0&&t.proceduralTextures.splice(r,1);var i=this._vertexBuffers[a.o.PositionKind];i&&(i.dispose(),this._vertexBuffers[a.o.PositionKind]=null),this._indexBuffer&&this._fullEngine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),this.onGeneratedObservable.clear(),this.onBeforeGenerationObservable.clear(),e.prototype.dispose.call(this)}},(0,i.gn)([(0,n.qC)()],t.prototype,"isEnabled",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"autoClear",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"_generateMipMaps",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"_size",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"refreshRate",null),t}(l.x);(0,d.H)("BABYLON.ProceduralTexture",f)},2971:(e,t,r)=>{r.d(t,{O:()=>s});var i=r(13514),n=r(85627),s=function(){function e(e){this.name=n.l.NAME_PROCEDURALTEXTURE,this.scene=e,this.scene.proceduralTextures=new Array}return e.prototype.register=function(){this.scene._beforeClearStage.registerStep(n.l.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeClear=function(){if(this.scene.proceduralTexturesEnabled){i.w1.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(var e=0;e<this.scene.proceduralTextures.length;e++){var t=this.scene.proceduralTextures[e];t._shouldRender()&&t.render()}i.w1.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}},e}()},39126:(e,t,r)=>{r.d(t,{V:()=>l});var i=r(31191),n=r(96969),s=r(62897),a=r(58095),o=r(15210),u=r(54007),l=(r(79245),function(e){function t(r){var i=e.call(this,null)||this;return i.metadata=null,i.reservedDataStore=null,i._hasAlpha=!1,i._getAlphaFromRGB=!1,i.level=1,i._coordinatesIndex=0,i._coordinatesMode=0,i.wrapR=1,i.anisotropicFilteringLevel=t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,i._isCube=!1,i._gammaSpace=!0,i.invertZ=!1,i.lodLevelInAlpha=!1,i.isRenderTarget=!1,i._prefiltered=!1,i._forceSerialize=!1,i.animations=new Array,i.onDisposeObservable=new s.y$,i._onDisposeObserver=null,i._scene=null,i._uid=null,i._parentContainer=null,i._loadingError=!1,r?t._IsScene(r)?i._scene=r:i._engine=r:i._scene=o.l.LastCreatedScene,i._scene&&(i.uniqueId=i._scene.getUniqueId(),i._scene.addTexture(i),i._engine=i._scene.getEngine()),i._uid=null,i}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(e){var t=this;this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"getAlphaFromRGB",{get:function(){return this._getAlphaFromRGB},set:function(e){var t=this;this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"coordinatesIndex",{get:function(){return this._coordinatesIndex},set:function(e){var t=this;this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(e){var t=this;this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapU",{get:function(){return this._wrapU},set:function(e){this._wrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapV",{get:function(){return this._wrapV},set:function(e){this._wrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(e){this._texture?this._texture.isCube=e:this._isCube=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gammaSpace",{get:function(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace},set:function(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(e){this._texture&&(this._texture._isRGBD=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(e){this._texture&&(this._texture._linearSpecularLOD=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(e){this._texture&&(this._texture._irradianceTexture=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=(0,u.f)()),this._uid},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return this.name},t.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadingError",{get:function(){return this._loadingError},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!1,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype._getEngine=function(){return this._engine},t.prototype.checkTransformsAreIdentical=function(e){return null!==e},t.prototype.getTextureMatrix=function(){return a.y3.IdentityReadOnly},t.prototype.getReflectionTextureMatrix=function(){return a.y3.IdentityReadOnly},t.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()||this.loadingError},t.prototype.scale=function(e){},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype._getFromCache=function(e,t,r,i,n,s){var a=this._getEngine();if(!a)return null;for(var o=a._getUseSRGBBuffer(!!n,t),u=a.getLoadedTexturesCache(),l=0;l<u.length;l++){var h=u[l];if(!(void 0!==n&&o!==h._useSRGBBuffer||void 0!==i&&i!==h.invertY||h.url!==e||h.generateMipMaps!==!t||r&&r!==h.samplingMode||void 0!==s&&s!==h.isCube))return h.incrementReferences(),h}return null},t.prototype._rebuild=function(){},t.prototype.clone=function(){return null},Object.defineProperty(t.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:5},enumerable:!1,configurable:!0}),t.prototype._markAllSubMeshesAsTexturesDirty=function(){var e=this.getScene();e&&e.markAllMaterialsAsDirty(1)},t.prototype.readPixels=function(e,t,r,i,n,s,a,o,u){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=null),void 0===i&&(i=!0),void 0===n&&(n=!1),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=Number.MAX_VALUE),void 0===u&&(u=Number.MAX_VALUE),!this._texture)return null;var l=this._getEngine();if(!l)return null;var h=this.getSize(),c=h.width,d=h.height;0!==t&&(c/=Math.pow(2,t),d/=Math.pow(2,t),c=Math.round(c),d=Math.round(d)),o=Math.min(c,o),u=Math.min(d,u);try{return this._texture.isCube?l._readTexturePixels(this._texture,o,u,e,t,r,i,n,s,a):l._readTexturePixels(this._texture,o,u,-1,t,r,i,n,s,a)}catch(e){return null}},t.prototype._readPixelsSync=function(e,t,r,i,n){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=null),void 0===i&&(i=!0),void 0===n&&(n=!1),!this._texture)return null;var s=this.getSize(),a=s.width,o=s.height,u=this._getEngine();if(!u)return null;0!=t&&(a/=Math.pow(2,t),o/=Math.pow(2,t),a=Math.round(a),o=Math.round(o));try{return this._texture.isCube?u._readTexturePixelsSync(this._texture,a,o,e,t,r,i,n):u._readTexturePixelsSync(this._texture,a,o,-1,t,r,i,n)}catch(e){return null}},Object.defineProperty(t.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var t=this._scene.textures.indexOf(this);if(t>=0&&this._scene.textures.splice(t,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){var r=this._parentContainer.textures.indexOf(this);r>-1&&this._parentContainer.textures.splice(r,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,e.prototype.dispose.call(this)},t.prototype.serialize=function(){if(!this.name)return null;var e=n.p4.Serialize(this);return n.p4.AppendSerializedAnimations(this,e),e},t.WhenAllReady=function(e,t){var r=e.length;if(0!==r)for(var i=0;i<e.length;i++){var n=e[i];if(n.isReady())0==--r&&t();else{var s=n.onLoadObservable;s?s.addOnce((function(){0==--r&&t()})):0==--r&&t()}}else t()},t._IsScene=function(e){return"Scene"===e.getClassName()},t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,i.gn)([(0,n.qC)()],t.prototype,"uniqueId",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"name",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"metadata",void 0),(0,i.gn)([(0,n.qC)("hasAlpha")],t.prototype,"_hasAlpha",void 0),(0,i.gn)([(0,n.qC)("getAlphaFromRGB")],t.prototype,"_getAlphaFromRGB",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"level",void 0),(0,i.gn)([(0,n.qC)("coordinatesIndex")],t.prototype,"_coordinatesIndex",void 0),(0,i.gn)([(0,n.qC)("coordinatesMode")],t.prototype,"_coordinatesMode",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"wrapU",null),(0,i.gn)([(0,n.qC)()],t.prototype,"wrapV",null),(0,i.gn)([(0,n.qC)()],t.prototype,"wrapR",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"anisotropicFilteringLevel",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"isCube",null),(0,i.gn)([(0,n.qC)()],t.prototype,"is3D",null),(0,i.gn)([(0,n.qC)()],t.prototype,"is2DArray",null),(0,i.gn)([(0,n.qC)()],t.prototype,"gammaSpace",null),(0,i.gn)([(0,n.qC)()],t.prototype,"invertZ",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"lodLevelInAlpha",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"lodGenerationOffset",null),(0,i.gn)([(0,n.qC)()],t.prototype,"lodGenerationScale",null),(0,i.gn)([(0,n.qC)()],t.prototype,"linearSpecularLOD",null),(0,i.gn)([(0,n.oU)()],t.prototype,"irradianceTexture",null),(0,i.gn)([(0,n.qC)()],t.prototype,"isRenderTarget",void 0),t}(r(58039).g))},7023:(e,t,r)=>{var i=r(93354),n=r(39126);n.V.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(n.V.prototype,"sphericalPolynomial",{get:function(){var e=this;if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=i.$.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((function(t){e._texture._sphericalPolynomial=t,e._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0})},44394:(e,t,r)=>{r.d(t,{B:()=>c});var i=r(31191),n=r(96969),s=r(13514),a=r(58095),o=r(39126),u=r(73803),l=r(48620),h=(r(90052),r(62897)),c=function(e){function t(t,r,i,n,s,o,l,c,d,p,_,f,T,g,m){void 0===i&&(i=null),void 0===n&&(n=!1),void 0===s&&(s=null),void 0===o&&(o=null),void 0===l&&(l=null),void 0===c&&(c=5),void 0===d&&(d=!1),void 0===p&&(p=null),void 0===_&&(_=!1),void 0===f&&(f=.8),void 0===T&&(T=0);var x,E=this;return(E=e.call(this,r)||this)._lodScale=.8,E._lodOffset=0,E.onLoadObservable=new h.y$,E.boundingBoxPosition=a.P.Zero(),E._rotationY=0,E._files=null,E._forcedExtension=null,E._extensions=null,E.name=t,E.url=t,E._noMipmap=n,E.hasAlpha=!1,E._format=c,E.isCube=!0,E._textureMatrix=a.y3.Identity(),E._createPolynomials=_,E.coordinatesMode=u.x.CUBIC_MODE,E._extensions=i,E._files=s,E._forcedExtension=p,E._loaderOptions=g,E._useSRGBBuffer=m,E._lodScale=f,E._lodOffset=T,t||s?(E.updateURL(t,p,o,d,l,i,null===(x=E.getScene())||void 0===x?void 0:x.useDelayedTextureLoading,s),E):E}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(a.y3.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forcedExtension",{get:function(){return this._forcedExtension},enumerable:!1,configurable:!0}),t.CreateFromImages=function(e,r,i){var n="";return e.forEach((function(e){return n+=e})),new t(n,r,null,i,e)},t.CreateFromPrefilteredData=function(e,r,i,n){void 0===i&&(i=null),void 0===n&&(n=!0);var s=r.useDelayedTextureLoading;r.useDelayedTextureLoading=!1;var a=new t(e,r,null,!1,null,null,null,void 0,!0,i,n);return r.useDelayedTextureLoading=s,a},t.prototype.getClassName=function(){return"CubeTexture"},t.prototype.updateURL=function(e,t,r,i,n,s,a,o){void 0===r&&(r=null),void 0===i&&(i=!1),void 0===n&&(n=null),void 0===s&&(s=null),void 0===a&&(a=!1),void 0===o&&(o=null),this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,t&&(this._forcedExtension=t);var u=e.lastIndexOf("."),l=t||(u>-1?e.substring(u).toLowerCase():""),h=0===l.indexOf(".dds"),c=0===l.indexOf(".env");if(c?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=i,i&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),o)this._files=o;else if(c||h||s||(s=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,s){for(var d=0;d<s.length;d++)this._files.push(e+s[d]);this._extensions=s}a?(this.delayLoadState=4,this._delayedOnLoad=r,this._delayedOnError=n):this._loadTexture(r,n)},t.prototype.delayLoad=function(e){4===this.delayLoadState&&(e&&(this._forcedExtension=e),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(e){var t,r=this;e.updateFlag!==this._textureMatrix.updateFlag&&(e.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(t=this.getScene())||void 0===t||t.markAllMaterialsAsDirty(1,(function(e){return-1!==e.getActiveTextures().indexOf(r)}))),this._textureMatrix=e)},t.prototype._loadTexture=function(e,t){var r,i=this;void 0===e&&(e=null),void 0===t&&(t=null);var n=this.getScene(),a=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);var o=function(){var t;i.onLoadObservable.notifyObservers(i),a&&(a.dispose(),null===(t=i.getScene())||void 0===t||t.markAllMaterialsAsDirty(1)),e&&e()},l=function(e,r){i._loadingError=!0,i._errorObject={message:e,exception:r},t&&t(e,r),u.x.OnTextureLoadErrorObservable.notifyObservers(i)};this._texture?this._texture.isReady?s.w1.SetImmediate((function(){return o()})):this._texture.onLoadedObservable.add((function(){return o()})):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,n,this._lodScale,this._lodOffset,e,l,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,n,this._files,this._noMipmap,e,l,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer),null===(r=this._texture)||void 0===r||r.onLoadedObservable.add((function(){return i.onLoadObservable.notifyObservers(i)})))},t.Parse=function(e,r,i){var s=n.p4.Parse((function(){var n=!1;return e.prefiltered&&(n=e.prefiltered),new t(i+e.name,r,e.extensions,!1,e.files||null,null,null,void 0,n,e.forcedExtension)}),e,r);if(e.boundingBoxPosition&&(s.boundingBoxPosition=a.P.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(s.boundingBoxSize=a.P.FromArray(e.boundingBoxSize)),e.animations)for(var o=0;o<e.animations.length;o++){var u=e.animations[o],h=(0,l.q)("BABYLON.Animation");h&&s.animations.push(h.Parse(u))}return s},t.prototype.clone=function(){var e=this,r=0,i=n.p4.Clone((function(){var i=new t(e.url,e.getScene()||e._getEngine(),e._extensions,e._noMipmap,e._files);return r=i.uniqueId,i}),this);return i.uniqueId=r,i},(0,i.gn)([(0,n.qC)()],t.prototype,"url",void 0),(0,i.gn)([(0,n.qC)("rotationY")],t.prototype,"rotationY",null),(0,i.gn)([(0,n.qC)("files")],t.prototype,"_files",void 0),(0,i.gn)([(0,n.qC)("forcedExtension")],t.prototype,"_forcedExtension",void 0),(0,i.gn)([(0,n.qC)("extensions")],t.prototype,"_extensions",void 0),(0,i.gn)([(0,n.oQ)("textureMatrix")],t.prototype,"_textureMatrix",void 0),t}(o.V);u.x._CubeTextureParser=c.Parse,(0,l.H)("BABYLON.CubeTexture",c)},93980:(e,t,r)=>{r.d(t,{c:()=>a});var i=r(31191),n=r(84318),s=r(73803),a=(r(25008),function(e){function t(t,r,i,n,a,o,u){void 0===i&&(i=null),void 0===n&&(n=!1),void 0===a&&(a=3),void 0===o&&(o=5);var l=e.call(this,null,i,!n,u,a,void 0,void 0,void 0,void 0,o)||this;l.name=t,l.wrapU=s.x.CLAMP_ADDRESSMODE,l.wrapV=s.x.CLAMP_ADDRESSMODE,l._generateMipMaps=n;var h=l._getEngine();if(!h)return l;r.getContext?(l._canvas=r,l._texture=h.createDynamicTexture(r.width,r.height,n,a)):(l._canvas=h.createCanvas(1,1),r.width||0===r.width?l._texture=h.createDynamicTexture(r.width,r.height,n,a):l._texture=h.createDynamicTexture(r,r,n,a));var c=l.getSize();return l._canvas.width!==c.width&&(l._canvas.width=c.width),l._canvas.height!==c.height&&(l._canvas.height=c.height),l._context=l._canvas.getContext("2d"),l}return(0,i.ZT)(t,e),t.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype._recreate=function(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)},t.prototype.scale=function(e){var t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)},t.prototype.scaleTo=function(e,t){var r=this.getSize();r.width=e,r.height=t,this._recreate(r)},t.prototype.getContext=function(){return this._context},t.prototype.clear=function(){var e=this.getSize();this._context.fillRect(0,0,e.width,e.height)},t.prototype.update=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1),this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===e||e,t,this._format||void 0,void 0,r)},t.prototype.drawText=function(e,t,r,i,n,s,a,o){void 0===o&&(o=!0);var u=this.getSize();if(s&&(this._context.fillStyle=s,this._context.fillRect(0,0,u.width,u.height)),this._context.font=i,null==t){var l=this._context.measureText(e);t=(u.width-l.width)/2}if(null==r){var h=parseInt(i.replace(/\D/g,""));r=u.height/2+h/3.65}this._context.fillStyle=n||"",this._context.fillText(e,t,r),o&&this.update(a)},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var r=this.getSize(),i=new t(this.name,r,e,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i},t.prototype.serialize=function(){var r=this.getScene();r&&!r.isReady()&&n.Y.Warn("The scene must be ready before serializing the dynamic texture");var i=e.prototype.serialize.call(this);return t._IsCanvasElement(this._canvas)&&(i.base64String=this._canvas.toDataURL()),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i},t._IsCanvasElement=function(e){return void 0!==e.toDataURL},t.prototype._rebuild=function(){this.update()},t}(s.x))},87432:(e,t,r)=>{r.d(t,{_:()=>l});var i=r(31191),n=r(19414),s=r(39126),a=r(73803),o=r(13514),u=(r(51392),r(79245)),l=function(e){function t(t,r,i,n,s,u,l){void 0===n&&(n=!1),void 0===s&&(s=!0),void 0===u&&(u=null),void 0===l&&(l=null);var h=e.call(this,r)||this;if(h._onLoad=null,h._onError=null,!t)throw new Error("Image url is not set");return h._coordinatesMode=a.x.CUBIC_MODE,h.name=t,h.url=t,h._size=i,h._noMipmap=n,h.gammaSpace=s,h._onLoad=u,h._onError=l,h.hasAlpha=!1,h.isCube=!0,h._texture=h._getFromCache(t,h._noMipmap,void 0,void 0,void 0,h.isCube),h._texture?u&&(h._texture.isReady?o.w1.SetImmediate((function(){return u()})):h._texture.onLoadedObservable.add(u)):r.useDelayedTextureLoading?h.delayLoadState=4:h._loadImage(h._loadTexture.bind(h),h._onError),h}return(0,i.ZT)(t,e),t.prototype._loadImage=function(e,t){var r=this,i=document.createElement("canvas");(0,u.r6)(this.url,(function(t){r._width=t.width,r._height=t.height,i.width=r._width,i.height=r._height;var n=i.getContext("2d");n.drawImage(t,0,0);var s=n.getImageData(0,0,t.width,t.height);r._buffer=s.data.buffer,i.remove(),e()}),(function(e,i){t&&t("".concat(r.getClassName()," could not be loaded"),i)}),null)},t.prototype._loadTexture=function(){var e=this,r=this.getScene();r&&(this._texture=r.getEngine().createRawCubeTextureFromUrl(this.url,r,this._size,4,r.getEngine().getCaps().textureFloat?1:7,this._noMipmap,(function(){for(var r=e._getFloat32ArrayFromArrayBuffer(e._buffer),i=n.B.ConvertPanoramaToCubemap(r,e._width,e._height,e._size),s=[],a=0;a<6;a++){var o=i[t._FacesMapping[a]];s.push(o)}return s}),null,this._onLoad,this._onError))},t.prototype._getFloat32ArrayFromArrayBuffer=function(e){for(var t=new DataView(e),r=new Float32Array(3*e.byteLength/4),i=0,n=0;n<e.byteLength;n++)(n+1)%4!=0&&(r[i++]=t.getUint8(n)/255);return r},t.prototype.getClassName=function(){return"EquiRectangularCubeTexture"},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var r=new t(this.url,e,this._size,this._noMipmap,this.gammaSpace);return r.level=this.level,r.wrapU=this.wrapU,r.wrapV=this.wrapV,r.coordinatesIndex=this.coordinatesIndex,r.coordinatesMode=this.coordinatesMode,r},t._FacesMapping=["right","left","up","down","front","back"],t}(s.V)},44919:(e,t,r)=>{r.d(t,{x:()=>n});var i=r(7949),n=function(){function e(e){this.useMipMaps=!1,this.type=16,this._video=e,this.uniqueId=i.l._Counter++}return e.IsExternalTexture=function(e){return void 0!==e.underlyingResource},e.prototype.getClassName=function(){return"ExternalTexture"},Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return this._video},enumerable:!1,configurable:!0}),e.prototype.isReady=function(){return this._video.readyState>=this._video.HAVE_CURRENT_DATA},e.prototype.dispose=function(){},e}()},85790:(e,t,r)=>{r.d(t,{e:()=>f});var i=r(31191),n=r(58095),s=r(39126),a=r(73803),o=r(13408),u=r(93354),l=r(48620),h=r(62897),c=r(13514),d=r(48154),p=r(87224),_=r(80949),f=(r(51392),r(7023),function(e){function t(t,r,i,s,o,u,l,d,p){void 0===s&&(s=!1),void 0===o&&(o=!0),void 0===u&&(u=!1),void 0===l&&(l=!1),void 0===d&&(d=null),void 0===p&&(p=null);var _,f=this;return(f=e.call(this,r)||this)._generateHarmonics=!0,f._onError=null,f._isBlocking=!0,f._rotationY=0,f.boundingBoxPosition=n.P.Zero(),f.onLoadObservable=new h.y$,t?(f._coordinatesMode=a.x.CUBIC_MODE,f.name=t,f.url=t,f.hasAlpha=!1,f.isCube=!0,f._textureMatrix=n.y3.Identity(),f._prefilterOnLoad=l,f._onLoad=function(){f.onLoadObservable.notifyObservers(f),d&&d()},f._onError=p,f.gammaSpace=u,f._noMipmap=s,f._size=i,f._generateHarmonics=o,f._texture=f._getFromCache(t,f._noMipmap,void 0,void 0,void 0,f.isCube),f._texture?f._texture.isReady?c.w1.SetImmediate((function(){return f._onLoad()})):f._texture.onLoadedObservable.add(f._onLoad):(null===(_=f.getScene())||void 0===_?void 0:_.useDelayedTextureLoading)?f.delayLoadState=4:f._loadTexture(),f):f}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(n.y3.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"HDRCubeTexture"},t.prototype._loadTexture=function(){var e=this,r=this._getEngine(),i=r.getCaps(),n=0;i.textureFloat&&i.textureFloatLinearFiltering?n=1:i.textureHalfFloat&&i.textureHalfFloatLinearFiltering&&(n=2);if(r._features.allowTexturePrefiltering&&this._prefilterOnLoad){var s=this._onLoad,a=new p.u(r);this._onLoad=function(){a.prefilter(e,s)}}this._texture=r.createRawCubeTextureFromUrl(this.url,this.getScene(),this._size,4,n,this._noMipmap,(function(r){e.lodGenerationOffset=0,e.lodGenerationScale=.8;var i=o.s.GetCubeMapTextureData(r,e._size);if(e._generateHarmonics){var s=u.$.ConvertCubeMapToSphericalPolynomial(i);e.sphericalPolynomial=s}for(var a=[],l=null,h=null,c=0;c<6;c++){2===n?h=new Uint16Array(e._size*e._size*3):0===n&&(l=new Uint8Array(e._size*e._size*3));var p=i[t._FacesMapping[c]];if(e.gammaSpace||h||l)for(var f=0;f<e._size*e._size;f++)if(e.gammaSpace&&(p[3*f+0]=Math.pow(p[3*f+0],d.zp),p[3*f+1]=Math.pow(p[3*f+1],d.zp),p[3*f+2]=Math.pow(p[3*f+2],d.zp)),h&&(h[3*f+0]=(0,_.ay)(p[3*f+0]),h[3*f+1]=(0,_.ay)(p[3*f+1]),h[3*f+2]=(0,_.ay)(p[3*f+2])),l){var T=Math.max(255*p[3*f+0],0),g=Math.max(255*p[3*f+1],0),m=Math.max(255*p[3*f+2],0),x=Math.max(Math.max(T,g),m);if(x>255){var E=255/x;T*=E,g*=E,m*=E}l[3*f+0]=T,l[3*f+1]=g,l[3*f+2]=m}h?a.push(h):l?a.push(l):a.push(p)}return a}),null,this._onLoad,this._onError)},t.prototype.clone=function(){var e=new t(this.url,this.getScene()||this._getEngine(),this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e.coordinatesIndex=this.coordinatesIndex,e.coordinatesMode=this.coordinatesMode,e},t.prototype.delayLoad=function(){4===this.delayLoadState&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this._loadTexture())},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(e){var t,r=this;this._textureMatrix=e,e.updateFlag!==this._textureMatrix.updateFlag&&e.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(t=this.getScene())||void 0===t||t.markAllMaterialsAsDirty(1,(function(e){return-1!==e.getActiveTextures().indexOf(r)})))},t.prototype.dispose=function(){this.onLoadObservable.clear(),e.prototype.dispose.call(this)},t.Parse=function(e,r,i){var s=null;return e.name&&!e.isRenderTarget&&((s=new t(i+e.name,r,e.size,e.noMipmap,e.generateHarmonics,e.useInGammaSpace)).name=e.name,s.hasAlpha=e.hasAlpha,s.level=e.level,s.coordinatesMode=e.coordinatesMode,s.isBlocking=e.isBlocking),s&&(e.boundingBoxPosition&&(s.boundingBoxPosition=n.P.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(s.boundingBoxSize=n.P.FromArray(e.boundingBoxSize)),e.rotationY&&(s.rotationY=e.rotationY)),s},t.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.hasAlpha=this.hasAlpha,e.isCube=!0,e.level=this.level,e.size=this._size,e.coordinatesMode=this.coordinatesMode,e.useInGammaSpace=this.gammaSpace,e.generateHarmonics=this._generateHarmonics,e.customType="BABYLON.HDRCubeTexture",e.noMipmap=this._noMipmap,e.isBlocking=this._isBlocking,e.rotationY=this._rotationY,e},t._FacesMapping=["right","left","up","down","front","back"],t}(s.V));(0,l.H)("BABYLON.HDRCubeTexture",f)},13120:(e,t,r)=>{r.d(t,{VL:()=>i.V,Ek:()=>o,Bt:()=>u.B,XV:()=>B,ci:()=>l.c,_N:()=>h._,xn:()=>c.x,ev:()=>p.e,ud:()=>d.u,sU:()=>f,l7:()=>T.l,SZ:()=>T.S,h1:()=>M.h,Kd:()=>I.K,_8:()=>G,gi:()=>U.g,O7:()=>z.O,Nk:()=>H.N,lM:()=>V.l,eo:()=>Y.e,Fd:()=>X,zA:()=>j,_i:()=>q._,xE:()=>L.x,Pt:()=>D,pp:()=>N,aJ:()=>K.a,R8:()=>Q.R,gu:()=>Z.g,fO:()=>J.f,tl:()=>C,sd:()=>g.s,vz:()=>m.v,h4:()=>A,cc:()=>x.c,_D:()=>R});var i=r(39126),n=(r(7023),r(31191)),s=r(58095),a=r(48620),o=(r(51392),function(e){function t(t,r,i){void 0===i&&(i=null);var n=e.call(this,r)||this;if(!t)return n;if(n._textureMatrix=s.y3.Identity(),n.name=t,n.url=t,n._onLoad=i,n._texture=n._getFromCache(t,!0),n._texture)n._triggerOnLoad();else{var a=n.getScene();a&&a.useDelayedTextureLoading?n.delayLoadState=4:n._loadTexture()}return n}return(0,n.ZT)(t,e),t.prototype._triggerOnLoad=function(){this._onLoad&&this._onLoad()},t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype._load3dlTexture=function(){var e,r=this,i=this._getEngine();e=i._features.support3DTextures?i.createRawTexture3D(null,1,1,1,5,!1,!1,2,null,0):i.createRawTexture(null,1,1,5,!1,!1,2,null,0),this._texture=e,this._texture.isReady=!1,this.isCube=!1,this.is3D=i._features.support3DTextures,this.wrapU=0,this.wrapV=0,this.wrapR=0,this.anisotropicFilteringLevel=1;var n=function(n){if("string"==typeof n){for(var s,a=null,o=null,u=n.split("\n"),l=0,h=0,c=0,d=0,p=0,_=0;_<u.length;_++)if(s=u[_],t._NoneEmptyLineRegex.test(s)&&0!==s.indexOf("#")){var f=s.split(" ");if(0!==l){if(0!=l){var T=Math.max(parseInt(f[0]),0),g=Math.max(parseInt(f[1]),0),m=Math.max(parseInt(f[2]),0);p=Math.max(T,p),p=Math.max(g,p),p=Math.max(m,p);var x=4*(h+d*l+c*l*l);o&&(o[x+0]=T,o[x+1]=g,o[x+2]=m),++c%l==0&&(c=0,++d%l==0&&(h++,d=0))}}else l=f.length,a=new Uint8Array(l*l*l*4),o=new Float32Array(l*l*l*4)}if(o&&a)for(_=0;_<o.length;_++)if(_>0&&(_+1)%4==0)a[_]=255;else{var E=o[_];a[_]=E/p*255}e.is3D?(e.updateSize(l,l,l),i.updateRawTexture3D(e,a,5,!1)):(e.updateSize(l*l,l),i.updateRawTexture(e,a,5,!1)),e.isReady=!0,r._triggerOnLoad()}},s=this.getScene();return s?s._loadFile(this.url,n):i._loadFile(this.url,n),this._texture},t.prototype._loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this._load3dlTexture()},t.prototype.clone=function(){var e=new t(this.url,this.getScene()||this._getEngine());return e.level=this.level,e},t.prototype.delayLoad=function(){4===this.delayLoadState&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,!0),this._texture||this._loadTexture())},t.Parse=function(e,r){var i=null;return e.name&&!e.isRenderTarget&&((i=new t(e.name,r)).name=e.name,i.level=e.level),i},t.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.level=this.level,e.customType="BABYLON.ColorGradingTexture",e},t._NoneEmptyLineRegex=/\S+/,t}(i.V));(0,a.H)("BABYLON.ColorGradingTexture",o);var u=r(44394),l=r(93980),h=r(87432),c=r(44919),d=r(87224),p=r(85790),_=r(62897),f=(r(25008),r(52858),function(e){function t(r,i,a){var o=e.call(this,a.scene||a.engine)||this;return o.onLoadObservable=new _.y$,i&&(a.engine||a.scene)?(a=(0,n.pi)((0,n.pi)({},t._DefaultOptions),a),o._generateMipMaps=a.generateMipMaps,o._samplingMode=a.samplingMode,o._textureMatrix=s.y3.Identity(),o.name=r,o.element=i,o._isVideo=i instanceof HTMLVideoElement,o.anisotropicFilteringLevel=1,o._createInternalTexture(),o):o}return(0,n.ZT)(t,e),t.prototype._createInternalTexture=function(){var e=0,t=0;this._isVideo?(e=this.element.videoWidth,t=this.element.videoHeight):(e=this.element.width,t=this.element.height);var r=this._getEngine();r&&(this._texture=r.createDynamicTexture(e,t,this._generateMipMaps,this._samplingMode)),this.update()},t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.update=function(e){void 0===e&&(e=null);var t=this._getEngine();if(null!=this._texture&&null!=t){var r=this.isReady();if(this._isVideo){var i=this.element;if(i.readyState<i.HAVE_CURRENT_DATA)return;t.updateVideoTexture(this._texture,i,null===e||e)}else{var n=this.element;t.updateDynamicTexture(this._texture,n,null===e||e,!1)}!r&&this.isReady()&&this.onLoadObservable.notifyObservers(this)}},t.prototype.dispose=function(){this.onLoadObservable.clear(),e.prototype.dispose.call(this)},t._DefaultOptions={generateMipMaps:!1,samplingMode:2,engine:null,scene:null},t}(i.V)),T=r(7949),g=r(22189),m=r(19195),x=r(25025),E=r(76755),v=r(37290),R=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(e){return e.endsWith(".tga")},e.prototype.loadCubeData=function(){throw".env not supported in Cube."},e.prototype.loadData=function(e,t,r){var i=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=(0,E.A6)(i);r(n.width,n.height,t.generateMipMaps,!1,(function(){(0,E.Ab)(t,i)}))},e}();v.D._TextureLoaders.push(new R);var y=r(13408),A=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(e){return e.endsWith(".hdr")},e.prototype.loadCubeData=function(){throw".env not supported in Cube."},e.prototype.loadData=function(e,t,r){for(var i=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=y.s.RGBE_ReadHeader(i),s=y.s.RGBE_ReadPixels(i,n),a=n.width*n.height,o=new Float32Array(4*a),u=0;u<a;u+=1)o[4*u]=s[3*u],o[4*u+1]=s[3*u+1],o[4*u+2]=s[3*u+2],o[4*u+3]=1;r(n.width,n.height,t.generateMipMaps,!1,(function(){var e=t.getEngine();t.type=1,t.format=5,t._gammaSpace=!1,e._uploadDataToTextureDirectly(t,o)}))},e}();v.D._TextureLoaders.push(new A);var S=r(21004),b=r(13514),C=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(e){return e.endsWith(".basis")},e.prototype.loadCubeData=function(e,t,r,i,n){if(!Array.isArray(e)){var s=t.getEngine().getCaps(),a={supportedCompressionFormats:{etc1:!!s.etc1,s3tc:!!s.s3tc,pvrtc:!!s.pvrtc,etc2:!!s.etc2}};(0,S.rz)(e,a).then((function(e){var r=e.fileInfo.images[0].levels.length>1&&t.generateMipMaps;(0,S.nG)(t,e),t.getEngine()._setCubeMapTextureParams(t,r),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),i&&i()})).catch((function(e){b.w1.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),t.isReady=!0,n&&n(e)}))}},e.prototype.loadData=function(e,t,r){var i=t.getEngine().getCaps(),n={supportedCompressionFormats:{etc1:!!i.etc1,s3tc:!!i.s3tc,pvrtc:!!i.pvrtc,etc2:!!i.etc2}};(0,S.rz)(e,n).then((function(e){var i=e.fileInfo.images[0].levels[0],n=e.fileInfo.images[0].levels.length>1&&t.generateMipMaps;r(i.width,i.height,n,-1!==e.format,(function(){(0,S.nG)(t,e)}))})).catch((function(){b.w1.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),r(0,0,!1,!1,(function(){}),!0)}))},e}();v.D._TextureLoaders.push(new C);var M=r(92159),I=r(99365),O=r(72208),L=r(73803),P=r(15631),N=function(e,t,r){this.id=e,this.scale=t,this.offset=r},F=r(84318),D=function(){function e(t,r,i,n){var s,a,o,u,l,h,c,d,p,_,f,T,g;return this.name=t,this.meshes=r,this.scene=n,this.options=i,this.options.map=null!==(s=this.options.map)&&void 0!==s?s:["ambientTexture","bumpTexture","diffuseTexture","emissiveTexture","lightmapTexture","opacityTexture","reflectionTexture","refractionTexture","specularTexture"],this.options.uvsIn=null!==(a=this.options.uvsIn)&&void 0!==a?a:O.o.UVKind,this.options.uvsOut=null!==(o=this.options.uvsOut)&&void 0!==o?o:O.o.UVKind,this.options.layout=null!==(u=this.options.layout)&&void 0!==u?u:e.LAYOUT_STRIP,this.options.layout===e.LAYOUT_COLNUM&&(this.options.colnum=null!==(l=this.options.colnum)&&void 0!==l?l:8),this.options.updateInputMeshes=null===(h=this.options.updateInputMeshes)||void 0===h||h,this.options.disposeSources=null===(c=this.options.disposeSources)||void 0===c||c,this._expecting=0,this.options.fillBlanks=null===(d=this.options.fillBlanks)||void 0===d||d,!0===this.options.fillBlanks&&(this.options.customFillColor=null!==(p=this.options.customFillColor)&&void 0!==p?p:"black"),this.options.frameSize=null!==(_=this.options.frameSize)&&void 0!==_?_:256,this.options.paddingRatio=null!==(f=this.options.paddingRatio)&&void 0!==f?f:.0115,this._paddingValue=Math.ceil(this.options.frameSize*this.options.paddingRatio),this._paddingValue%2!=0&&this._paddingValue++,this.options.paddingMode=null!==(T=this.options.paddingMode)&&void 0!==T?T:e.SUBUV_WRAP,this.options.paddingMode===e.SUBUV_COLOR&&(this.options.paddingColor=null!==(g=this.options.paddingColor)&&void 0!==g?g:new P.HE(0,0,0,1)),this.sets={},this.frames=[],this}return e.prototype._createFrames=function(e){for(var t=this,r=this._calculateSize(),i=new s.FM(1,1).divide(r),n=0,a=this._expecting,o=this.meshes.length,u=Object.keys(this.sets),h=0;h<u.length;h++){var c=u[h],d=new l.c(this.name+".TexturePack."+c+"Set",{width:r.x,height:r.y},this.scene,!0,L.x.TRILINEAR_SAMPLINGMODE,v.D.TEXTUREFORMAT_RGBA),p=d.getContext();p.fillStyle="rgba(0,0,0,0)",p.fillRect(0,0,r.x,r.y),d.update(!1),this.sets[c]=d}var _=this.options.frameSize||256,f=this._paddingValue,T=_+2*f;for(h=0;h<o;h++)for(var g=this.meshes[h].material,m=function(s){var o=new l.c("temp",T,x.scene,!0),c=o.getContext(),d=x._getFrameOffset(h),p=function(){n++,o.update(!1);var s=c.getImageData(0,0,T,T),u=t.sets[m];if(u.getContext().putImageData(s,r.x*d.x,r.y*d.y),o.dispose(),u.update(!1),n==a)return t._calculateMeshUVFrames(_,f,r,i,t.options.updateInputMeshes||!1),void e()},m=u[s]||"_blank";if(g&&null!==g[m]){var E=g[m],v=new Image;E instanceof l.c?v.src=E.getContext().canvas.toDataURL("image/png"):v.src=E.url,b.w1.SetCorsBehavior(v.src,v),v.onload=function(){c.fillStyle="rgba(0,0,0,0)",c.fillRect(0,0,T,T),o.update(!1),c.setTransform(1,0,0,-1,0,0);var e=[0,0,1,0,1,1,0,1,-1,1,-1,0,-2,0,-1,1,-1];switch(t.options.paddingMode){case 0:for(var r=0;r<9;r++)c.drawImage(v,0,0,v.width,v.height,f+_*e[r],f+_*e[r+1]-T,_,_);break;case 1:for(var i=0;i<f;i++)c.drawImage(v,0,0,v.width,v.height,i+_*e[0],f-T,_,_),c.drawImage(v,0,0,v.width,v.height,2*f-i,f-T,_,_),c.drawImage(v,0,0,v.width,v.height,f,i-T,_,_),c.drawImage(v,0,0,v.width,v.height,f,2*f-i-T,_,_);c.drawImage(v,0,0,v.width,v.height,f+_*e[0],f+_*e[1]-T,_,_);break;case 2:c.fillStyle=(t.options.paddingColor||P.Wo.Black()).toHexString(),c.fillRect(0,0,T,-T),c.clearRect(f,f,_,_),c.drawImage(v,0,0,v.width,v.height,f+_*e[0],f+_*e[1]-T,_,_)}c.setTransform(1,0,0,1,0,0),p()}}else c.fillStyle="rgba(0,0,0,0)",x.options.fillBlanks&&(c.fillStyle=x.options.customFillColor),c.fillRect(0,0,T,T),p()},x=this,E=0;E<u.length;E++)m(E)},e.prototype._calculateSize=function(){var e=this.meshes.length||0,t=this.options.frameSize||0,r=this._paddingValue||0;switch(this.options.layout){case 0:return new s.FM(t*e+2*r*e,t+2*r);case 1:var i=Math.max(2,Math.ceil(Math.sqrt(e))),n=t*i+2*r*i;return new s.FM(n,n);case 2:var a=this.options.colnum||1,o=Math.max(1,Math.ceil(e/a));return new s.FM(t*a+2*r*a,t*o+2*r*o)}return s.FM.Zero()},e.prototype._calculateMeshUVFrames=function(e,t,r,i,n){for(var a=this.meshes.length,o=0;o<a;o++){var u=this.meshes[o],l=new s.FM(e/r.x,e/r.y),h=i.clone().scale(t),c=this._getFrameOffset(o).add(h),d=new N(o,l,c);this.frames.push(d),n&&(this._updateMeshUV(u,o),this._updateTextureReferences(u))}},e.prototype._getFrameOffset=function(e){var t,r,i,n=this.meshes.length;switch(this.options.layout){case 0:return t=1/n,new s.FM(e*t,0);case 1:var a=Math.max(2,Math.ceil(Math.sqrt(n)));return i=e-(r=Math.floor(e/a))*a,t=1/a,new s.FM(i*t,r*t);case 2:var o=this.options.colnum||1,u=Math.max(1,Math.ceil(n/o));return r=e-(i=Math.floor(e/u))*u,t=new s.FM(1/o,1/u),new s.FM(i*t.x,r*t.y)}return s.FM.Zero()},e.prototype._updateMeshUV=function(e,t){var r=this.frames[t],i=e.getVerticesData(this.options.uvsIn||O.o.UVKind),n=[],s=0;i.length&&(s=i.length||0);for(var a=0;a<s;a+=2)n.push(i[a]*r.scale.x+r.offset.x,i[a+1]*r.scale.y+r.offset.y);e.setVerticesData(this.options.uvsOut||O.o.UVKind,n)},e.prototype._updateTextureReferences=function(e,t){void 0===t&&(t=!1);for(var r=e.material,i=Object.keys(this.sets),n=function(e){e.dispose&&e.dispose()},s=0;s<i.length;s++){var a=i[s];if(t)null!==r[a]&&n(r[a]),r[a]=this.sets[a];else{if(!r)return;null!==r[a]&&(n(r[a]),r[a]=this.sets[a])}}},e.prototype.setMeshToFrame=function(e,t,r){void 0===r&&(r=!1),this._updateMeshUV(e,t),r&&this._updateTextureReferences(e,!0)},e.prototype.processAsync=function(){var e=this;return new Promise((function(t,r){try{if(0===e.meshes.length)return void t();for(var i=0,n=function(r){var n=e.meshes[r],s=n.material;if(!s)return++i===e.meshes.length?{value:e._createFrames(t)}:"continue";s.forceCompilationAsync(n).then((function(){!function(r){if(i++,e.options.map){for(var n=0;n<e.options.map.length;n++)null!==r[e.options.map[n]]&&(e.sets[e.options.map[n]]||(e.sets[e.options.map[n]]=!0),e._expecting++);i===e.meshes.length&&e._createFrames(t)}}(s)}))},s=0;s<e.meshes.length;s++){var a=n(s);if("object"==typeof a)return a.value}}catch(e){return r(e)}}))},e.prototype.dispose=function(){for(var e=Object.keys(this.sets),t=0;t<e.length;t++){var r=e[t];this.sets[r].dispose()}},e.prototype.download=function(e,t){var r=this;void 0===e&&(e="png"),void 0===t&&(t=1),setTimeout((function(){var i={name:r.name,sets:{},options:{},frames:[]},n=Object.keys(r.sets),s=Object.keys(r.options);try{for(var a=0;a<n.length;a++){var o=n[a],u=r.sets[o];i.sets[o]=u.getContext().canvas.toDataURL("image/"+e,t)}for(a=0;a<s.length;a++){var l=s[a];i.options[l]=r.options[l]}for(a=0;a<r.frames.length;a++){var h=r.frames[a];i.frames.push(h.scale.x,h.scale.y,h.offset.x,h.offset.y)}}catch(e){return void F.Y.Warn("Unable to download: "+e)}var c="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(i,null,4)),d=document.createElement("a");d.setAttribute("href",c),d.setAttribute("download",r.name+"_texurePackage.json"),document.body.appendChild(d),d.click(),d.remove()}),0)},e.prototype.updateFromJSON=function(e){try{var t=JSON.parse(e);this.name=t.name;for(var r=Object.keys(t.options),i=0;i<r.length;i++)this.options[r[i]]=t.options[r[i]];for(i=0;i<t.frames.length;i+=4){var n=new N(i/4,new s.FM(t.frames[i],t.frames[i+1]),new s.FM(t.frames[i+2],t.frames[i+3]));this.frames.push(n)}var a=Object.keys(t.sets);for(i=0;i<a.length;i++){var o=new L.x(t.sets[a[i]],this.scene,!1,!1);this.sets[a[i]]=o}}catch(e){F.Y.Warn("Unable to update from JSON: "+e)}},e.LAYOUT_STRIP=0,e.LAYOUT_POWER2=1,e.LAYOUT_COLNUM=2,e.SUBUV_WRAP=0,e.SUBUV_EXTEND=1,e.SUBUV_COLOR=2,e}(),U=r(91062),w=r(51912),B=function(e){function t(t,r,i,n,s,a){var o=e.call(this,t,i,null,n,s,a)||this;return o._animate=!0,o._time=0,o._texturePath=r,o._loadJson(r),o.refreshRate=1,o}return(0,n.ZT)(t,e),t.prototype._loadJson=function(e){var t=this,r=function(){try{t.setFragment(t._texturePath)}catch(e){F.Y.Log("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},i=e+"/config.json",n=new w.g;n.open("GET",i),n.addEventListener("load",(function(){if(200===n.status||n.responseText&&n.responseText.length>0)try{t._config=JSON.parse(n.response),t.updateShaderUniforms(),t.updateTextures(),t.setFragment(t._texturePath+"/custom"),t._animate=t._config.animate,t.refreshRate=t._config.refreshrate}catch(e){r()}else r()}),!1),n.addEventListener("error",(function(){r()}),!1);try{n.send()}catch(e){F.Y.Error("CustomProceduralTexture: Error on XHR send request.")}},t.prototype.isReady=function(){if(!e.prototype.isReady.call(this))return!1;for(var t in this._textures){if(!this._textures[t].isReady())return!1}return!0},t.prototype.render=function(t){var r=this.getScene();this._animate&&r&&(this._time+=.03*r.getAnimationRatio(),this.updateShaderUniforms()),e.prototype.render.call(this,t)},t.prototype.updateTextures=function(){for(var e=0;e<this._config.sampler2Ds.length;e++)this.setTexture(this._config.sampler2Ds[e].sample2Dname,new L.x(this._texturePath+"/"+this._config.sampler2Ds[e].textureRelativeUrl,this.getScene()))},t.prototype.updateShaderUniforms=function(){if(this._config)for(var e=0;e<this._config.uniforms.length;e++){var t=this._config.uniforms[e];switch(t.type){case"float":this.setFloat(t.name,t.value);break;case"color3":this.setColor3(t.name,new P.Wo(t.r,t.g,t.b));break;case"color4":this.setColor4(t.name,new P.HE(t.r,t.g,t.b,t.a));break;case"vector2":this.setVector2(t.name,new s.FM(t.x,t.y));break;case"vector3":this.setVector3(t.name,new s.P(t.x,t.y,t.z))}}this.setFloat("time",this._time)},Object.defineProperty(t.prototype,"animate",{get:function(){return this._animate},set:function(e){this._animate=e},enumerable:!1,configurable:!0}),t}(U.g),k=r(15210),G=(r(4512),function(e){function t(t,r,i,n,s){void 0===r&&(r=256),void 0===i&&(i=k.l.LastCreatedScene);var a=e.call(this,t,r,"noise",i,n,s)||this;return a.time=0,a.brightness=.2,a.octaves=3,a.persistence=.8,a.animationSpeedFactor=1,a.autoClear=!1,a._updateShaderUniforms(),a}return(0,n.ZT)(t,e),t.prototype._updateShaderUniforms=function(){var e=this.getScene();e&&(this.time+=e.getAnimationRatio()*this.animationSpeedFactor*.01,this.setFloat("brightness",this.brightness),this.setFloat("persistence",this.persistence),this.setFloat("timeScale",this.time))},t.prototype._getDefines=function(){return"#define OCTAVES "+(0|this.octaves)},t.prototype.render=function(t){this._updateShaderUniforms(),e.prototype.render.call(this,t)},t.prototype.serialize=function(){var e={customType:"BABYLON.NoiseProceduralTexture"};return e.brightness=this.brightness,e.octaves=this.octaves,e.persistence=this.persistence,e.animationSpeedFactor=this.animationSpeedFactor,e.size=this.getSize().width,e.generateMipMaps=this._generateMipMaps,e.time=this.time,e},t.prototype.clone=function(){var e=this.getSize(),r=new t(this.name,e.width,this.getScene(),this._fallbackTexture?this._fallbackTexture:void 0,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.coordinatesMode=this.coordinatesMode,r.brightness=this.brightness,r.octaves=this.octaves,r.persistence=this.persistence,r.animationSpeedFactor=this.animationSpeedFactor,r.time=this.time,r},t.Parse=function(e,r){var i,n=new t(e.name,e.size,r,void 0,e.generateMipMaps);return n.brightness=e.brightness,n.octaves=e.octaves,n.persistence=e.persistence,n.animationSpeedFactor=e.animationSpeedFactor,n.time=null!==(i=e.time)&&void 0!==i?i:0,n},t}(U.g));(0,a.H)("BABYLON.NoiseProceduralTexture",G);var z=r(2971),H=r(68254),V=r(15034),Y=r(93097),X=function(e){function t(t,r,i,n,s,a,o,u,l,h){void 0===o&&(o=!0),void 0===u&&(u=!1),void 0===l&&(l=L.x.TRILINEAR_SAMPLINGMODE),void 0===h&&(h=0);var c=e.call(this,null,a,!o,u)||this;return c.format=s,c._texture=a.getEngine().createRawTexture3D(t,r,i,n,s,o,u,l,null,h),c.is3D=!0,c}return(0,n.ZT)(t,e),t.prototype.update=function(e){this._texture&&this._getEngine().updateRawTexture3D(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t}(L.x),W=r(62464),q=r(63784),j=function(e){function t(t,r,i,n){var s=e.call(this,t,r,i,n,!0)||this;return s.refractionPlane=new W.J(0,1,0,1),s.depth=2,s.onBeforeRenderObservable.add((function(){s.getScene().clipPlane=s.refractionPlane})),s.onAfterRenderObservable.add((function(){s.getScene().clipPlane=null})),s}return(0,n.ZT)(t,e),t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var r=this.getSize(),i=new t(this.name,r.width,e,this._generateMipMaps);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.refractionPlane=this.refractionPlane.clone(),this.renderList&&(i.renderList=this.renderList.slice(0)),i.depth=this.depth,i},t.prototype.serialize=function(){if(!this.name)return null;var t=e.prototype.serialize.call(this);return t.mirrorPlane=this.refractionPlane.asArray(),t.depth=this.depth,t},t}(q._),K=r(90729),Z=r(58039),Q=r(27720),J=r(9100)},7949:(e,t,r)=>{r.d(t,{S:()=>i,l:()=>o});var i,n=r(31191),s=r(62897),a=r(90729);!function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.DepthStencil=12]="DepthStencil",e[e.CubeRawRGBD=13]="CubeRawRGBD",e[e.Depth=14]="Depth"}(i||(i={}));var o=function(e){function t(r,n,a){void 0===a&&(a=!1);var o=e.call(this)||this;return o.isReady=!1,o.isCube=!1,o.is3D=!1,o.is2DArray=!1,o.isMultiview=!1,o.url="",o.generateMipMaps=!1,o.samples=0,o.type=-1,o.format=-1,o.onLoadedObservable=new s.y$,o.onErrorObservable=new s.y$,o.onRebuildCallback=null,o.width=0,o.height=0,o.depth=0,o.baseWidth=0,o.baseHeight=0,o.baseDepth=0,o.invertY=!1,o._invertVScale=!1,o._associatedChannel=-1,o._source=i.Unknown,o._buffer=null,o._bufferView=null,o._bufferViewArray=null,o._bufferViewArrayArray=null,o._size=0,o._extension="",o._files=null,o._workingCanvas=null,o._workingContext=null,o._cachedCoordinatesMode=null,o._isDisabled=!1,o._compression=null,o._sphericalPolynomial=null,o._sphericalPolynomialPromise=null,o._sphericalPolynomialComputed=!1,o._lodGenerationScale=0,o._lodGenerationOffset=0,o._useSRGBBuffer=!1,o._lodTextureHigh=null,o._lodTextureMid=null,o._lodTextureLow=null,o._isRGBD=!1,o._linearSpecularLOD=!1,o._irradianceTexture=null,o._hardwareTexture=null,o._maxLodLevel=null,o._references=1,o._gammaSpace=null,o._engine=r,o._source=n,o._uniqueId=t._Counter++,a||(o._hardwareTexture=r._createHardwareTexture()),o}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"useMipMaps",{get:function(){return this.generateMipMaps},set:function(e){this.generateMipMaps=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),t.prototype.getEngine=function(){return this._engine},Object.defineProperty(t.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),t.prototype.incrementReferences=function(){this._references++},t.prototype.updateSize=function(e,t,r){void 0===r&&(r=1),this._engine.updateTextureDimensions(this,e,t,r),this.width=e,this.height=t,this.depth=r,this.baseWidth=e,this.baseHeight=t,this.baseDepth=r,this._size=e*t*r},t.prototype._rebuild=function(){var e,t=this;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){var r=this.onRebuildCallback(this),n=function(e){e._swapAndDie(t,!1),t.isReady=r.isReady};r.isAsync?r.proxy.then(n):n(r.proxy)}else{var s;switch(this.source){case i.Temp:break;case i.Url:return void(s=this._engine.createTexture(null!==(e=this._originalUrl)&&void 0!==e?e:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){s._swapAndDie(t,!1),t.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case i.Raw:(s=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,void 0,this._useSRGBBuffer))._swapAndDie(this,!1),this.isReady=!0;break;case i.Raw3D:(s=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case i.Raw2DArray:(s=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case i.Dynamic:(s=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this,!1),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);break;case i.Cube:return void(s=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){s._swapAndDie(t,!1),t.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer));case i.CubeRaw:(s=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this,!1),this.isReady=!0;break;case i.CubeRawRGBD:return;case i.CubePrefiltered:return void((s=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(e){e&&e._swapAndDie(t,!1),t.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}}},t.prototype._swapAndDie=function(e,t){var r;void 0===t&&(t=!0),null===(r=this._hardwareTexture)||void 0===r||r.setUsage(e._source,this.generateMipMaps,this.isCube,this.width,this.height),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var i=this._engine.getLoadedTexturesCache(),n=i.indexOf(this);-1!==n&&i.splice(n,1),-1===(n=i.indexOf(e))&&i.push(e)},t.prototype.dispose=function(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null)},t._Counter=0,t}(a.a)},92159:(e,t,r)=>{r.d(t,{h:()=>l});var i=r(31191),n=r(58095),s=r(73803),a=r(63784),o=r(442),u=r(62464),l=function(e){function t(t,r,i,a,o,l,h){void 0===o&&(o=0),void 0===l&&(l=s.x.BILINEAR_SAMPLINGMODE),void 0===h&&(h=!0);var c=e.call(this,t,r,i,a,!0,o,!1,l,h)||this;if(c.mirrorPlane=new u.J(0,1,0,1),c._transformMatrix=n.y3.Zero(),c._mirrorMatrix=n.y3.Zero(),c._adaptiveBlurKernel=0,c._blurKernelX=0,c._blurKernelY=0,c._blurRatio=1,!(i=c.getScene()))return c;c.ignoreCameraViewport=!0,c._updateGammaSpace(),c._imageProcessingConfigChangeObserver=i.imageProcessingConfiguration.onUpdateParameters.add((function(){c._updateGammaSpace()}));var d,p=i.getEngine();return p.supportsUniformBuffers&&(c._sceneUBO=i.createSceneUniformBuffer('Scene for Mirror Texture (name "'.concat(t,'")'))),c.onBeforeBindObservable.add((function(){var e;null===(e=p._debugPushGroup)||void 0===e||e.call(p,"mirror generation for ".concat(t),1)})),c.onAfterUnbindObservable.add((function(){var e;null===(e=p._debugPopGroup)||void 0===e||e.call(p,1)})),c.onBeforeRenderObservable.add((function(){c._sceneUBO&&(c._currentSceneUBO=i.getSceneUniformBuffer(),i.setSceneUniformBuffer(c._sceneUBO),i.getSceneUniformBuffer().unbindEffect()),n.y3.ReflectionToRef(c.mirrorPlane,c._mirrorMatrix),c._mirrorMatrix.multiplyToRef(i.getViewMatrix(),c._transformMatrix),i.setTransformMatrix(c._transformMatrix,i.getProjectionMatrix()),d=i.clipPlane,i.clipPlane=c.mirrorPlane,i.getEngine().cullBackFaces=!1,i._mirroredCameraPosition=n.P.TransformCoordinates(i.activeCamera.globalPosition,c._mirrorMatrix)})),c.onAfterRenderObservable.add((function(){c._sceneUBO&&i.setSceneUniformBuffer(c._currentSceneUBO),i.updateTransformMatrix(),i.getEngine().cullBackFaces=null,i._mirroredCameraPosition=null,i.clipPlane=d})),c}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(e){this._blurRatio!==e&&(this._blurRatio=e,this._preparePostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"adaptiveBlurKernel",{set:function(e){this._adaptiveBlurKernel=e,this._autoComputeBlurKernel()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurKernel",{set:function(e){this.blurKernelX=e,this.blurKernelY=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(e){this._blurKernelX!==e&&(this._blurKernelX=e,this._preparePostProcesses())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(e){this._blurKernelY!==e&&(this._blurKernelY=e,this._preparePostProcesses())},enumerable:!1,configurable:!0}),t.prototype._autoComputeBlurKernel=function(){var e=this.getScene().getEngine(),t=this.getRenderWidth()/e.getRenderWidth(),r=this.getRenderHeight()/e.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*t,this.blurKernelY=this._adaptiveBlurKernel*r},t.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},t.prototype._updateGammaSpace=function(){var e=this.getScene();e&&(this.gammaSpace=!e.imageProcessingConfiguration.isEnabled||!e.imageProcessingConfiguration.applyByPostProcess)},t.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var e=this.getScene().getEngine(),t=e.getCaps().textureFloatRender&&e.getCaps().textureFloatLinearFiltering?1:2;this._blurX=new o.i("horizontal blur",new n.FM(1,0),this._blurKernelX,this._blurRatio,null,s.x.BILINEAR_SAMPLINGMODE,e,!1,t),this._blurX.autoClear=!1,1===this._blurRatio&&this.samples<2&&this._texture?this._blurX.inputTexture=this._renderTarget:this._blurX.alwaysForcePOT=!0,this._blurY=new o.i("vertical blur",new n.FM(0,1),this._blurKernelY,this._blurRatio,null,s.x.BILINEAR_SAMPLINGMODE,e,!1,t),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=1!==this._blurRatio,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var r=this.getSize(),i=new t(this.name,r.width,e,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return i.hasAlpha=this.hasAlpha,i.level=this.level,i.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(i.renderList=this.renderList.slice(0)),i},t.prototype.serialize=function(){if(!this.name)return null;var t=e.prototype.serialize.call(this);return t.mirrorPlane=this.mirrorPlane.asArray(),t},t.prototype.dispose=function(){var t;e.prototype.dispose.call(this);var r=this.getScene();r&&r.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver),null===(t=this._sceneUBO)||void 0===t||t.dispose()},t}(a._);s.x._CreateMirror=function(e,t,r,i){return new l(e,t,r,i)}},99365:(e,t,r)=>{r.d(t,{K:()=>a});var i=r(31191),n=r(73803),s=r(63784),a=(r(17770),function(e){function t(t,r,i,n,s,a){var o=this,u=!(!s||!s.generateMipMaps)&&s.generateMipMaps,l=!(!s||!s.generateDepthTexture)&&s.generateDepthTexture,h=s&&s.depthTextureFormat?s.depthTextureFormat:15,c=!s||void 0===s.doNotChangeAspectRatio||s.doNotChangeAspectRatio,d=!(!s||!s.drawOnlyOnFirstAttachmentByDefault)&&s.drawOnlyOnFirstAttachmentByDefault;if(!(o=e.call(this,t,r,n,u,c,void 0,void 0,void 0,void 0,void 0,void 0,void 0,!0)||this).isSupported)return o.dispose(),o;var p=[],_=[],f=[];o._initTypes(i,p,_,f,s);var T=!s||void 0===s.generateDepthBuffer||s.generateDepthBuffer,g=!(!s||void 0===s.generateStencilBuffer)&&s.generateStencilBuffer;return o._size=r,o._multiRenderTargetOptions={samplingModes:_,generateMipMaps:u,generateDepthBuffer:T,generateStencilBuffer:g,generateDepthTexture:l,depthTextureFormat:h,types:p,textureCount:i,useSRGBBuffers:f},o._count=i,o._drawOnlyOnFirstAttachmentByDefault=d,i>0&&(o._createInternalTextures(),o._createTextures(a)),o}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"isSupported",{get:function(){var e,t;return null!==(t=null===(e=this._engine)||void 0===e?void 0:e.getCaps().drawBuffersExtension)&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textures",{get:function(){return this._textures},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTexture",{get:function(){return this._textures[this._textures.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapU",{set:function(e){if(this._textures)for(var t=0;t<this._textures.length;t++)this._textures[t].wrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapV",{set:function(e){if(this._textures)for(var t=0;t<this._textures.length;t++)this._textures[t].wrapV=e},enumerable:!1,configurable:!0}),t.prototype._initTypes=function(e,t,r,i,s){for(var a=0;a<e;a++)s&&s.types&&void 0!==s.types[a]?t.push(s.types[a]):t.push(s&&s.defaultType?s.defaultType:0),s&&s.samplingModes&&void 0!==s.samplingModes[a]?r.push(s.samplingModes[a]):r.push(n.x.BILINEAR_SAMPLINGMODE),s&&s.useSRGBBuffers&&void 0!==s.useSRGBBuffers[a]?i.push(s.useSRGBBuffers[a]):i.push(!1)},t.prototype._rebuild=function(e,t){if(void 0===e&&(e=!1),!(this._count<1)){this.releaseInternalTextures(),this._createInternalTextures(),e&&(this._releaseTextures(),this._createTextures(t));for(var r=this._renderTarget.textures,i=0;i<r.length;i++){this._textures[i]._texture=r[i]}1!==this.samples&&this._renderTarget.setSamples(this.samples,!this._drawOnlyOnFirstAttachmentByDefault,!0)}},t.prototype._createInternalTextures=function(){this._renderTarget=this._getEngine().createMultipleRenderTarget(this._size,this._multiRenderTargetOptions,!this._drawOnlyOnFirstAttachmentByDefault),this._texture=this._renderTarget.texture},t.prototype._releaseTextures=function(){if(this._textures)for(var e=0;e<this._textures.length;e++)this._textures[e]._texture=null,this._textures[e].dispose()},t.prototype._createTextures=function(e){var t=this._renderTarget.textures;this._textures=[];for(var r=0;r<t.length;r++){var i=new n.x(null,this.getScene());(null==e?void 0:e[r])&&(i.name=e[r]),i._texture=t[r],this._textures.push(i)}},t.prototype.setInternalTexture=function(e,t,r){void 0===r&&(r=!0),this.renderTarget&&(0===t&&(this._texture=e),this.renderTarget.setTexture(e,t,r),this.textures[t]||(this.textures[t]=new n.x(null,this.getScene())),this.textures[t]._texture=e,this._count=this.renderTarget.textures?this.renderTarget.textures.length:0,this._multiRenderTargetOptions.types&&(this._multiRenderTargetOptions.types[t]=e.type),this._multiRenderTargetOptions.samplingModes&&(this._multiRenderTargetOptions.samplingModes[t]=e.samplingMode),this._multiRenderTargetOptions.useSRGBBuffers&&(this._multiRenderTargetOptions.useSRGBBuffers[t]=e._useSRGBBuffer))},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._renderTarget?this._samples=this._renderTarget.setSamples(e):this._samples=e},enumerable:!1,configurable:!0}),t.prototype.resize=function(e){this._size=e,this._rebuild()},t.prototype.updateCount=function(e,t,r){this._multiRenderTargetOptions.textureCount=e,this._count=e;var i=[],n=[],s=[];this._initTypes(e,i,n,s,t),this._multiRenderTargetOptions.types=i,this._multiRenderTargetOptions.samplingModes=n,this._multiRenderTargetOptions.useSRGBBuffers=s,this._rebuild(!0,r)},t.prototype._unbindFrameBuffer=function(e,t){var r=this;this._renderTarget&&e.unBindMultiColorAttachmentFramebuffer(this._renderTarget,this.isCube,(function(){r.onAfterRenderObservable.notifyObservers(t)}))},t.prototype.dispose=function(t){void 0===t&&(t=!1),this._releaseTextures(),t?this._texture=null:this.releaseInternalTextures(),e.prototype.dispose.call(this)},t.prototype.releaseInternalTextures=function(){var e,t,r=null===(e=this._renderTarget)||void 0===e?void 0:e.textures;if(r){for(var i=r.length-1;i>=0;i--)this._textures[i]._texture=null;null===(t=this._renderTarget)||void 0===t||t.dispose(),this._renderTarget=null}},t}(s._))},52515:(e,t,r)=>{r.d(t,{N:()=>a});var i=r(31191),n=r(99365),s=r(90216),a=function(e){function t(t,r,i,n,s,a){var o=e.call(this,t,i,n,s,a)||this;return o._beforeCompositionPostProcesses=[],o._internalTextureDirty=!1,o.enabled=!1,o.renderTargetTexture=null,o.renderTargetTexture=r,o}return(0,i.ZT)(t,e),t.prototype._createCompositionEffect=function(){this.imageProcessingPostProcess=new s.z("prePassComposition",1,null,void 0,this._engine),this.imageProcessingPostProcess._updateParameters()},t.prototype._checkSize=function(){var e=this._engine.getRenderWidth(!0),t=this._engine.getRenderHeight(!0),r=this.getRenderWidth(),i=this.getRenderHeight();r===e&&i===t||(this.resize({width:e,height:t}),this._internalTextureDirty=!0)},t.prototype.updateCount=function(t,r,i){e.prototype.updateCount.call(this,t,r,i),this._internalTextureDirty=!0},t.prototype._resetPostProcessChain=function(){this._beforeCompositionPostProcesses=[]},t.prototype.dispose=function(){var t=this._scene;if(e.prototype.dispose.call(this),t&&t.prePassRenderer){var r=t.prePassRenderer.renderTargets.indexOf(this);-1!==r&&t.prePassRenderer.renderTargets.splice(r,1)}this.imageProcessingPostProcess&&this.imageProcessingPostProcess.dispose(),this.renderTargetTexture&&(this.renderTargetTexture._prePassRenderTarget=null),this._outputPostProcess&&(this._outputPostProcess.autoClear=!0,this._outputPostProcess.restoreDefaultInputTexture())},t}(n.K)},68254:(e,t,r)=>{r.d(t,{N:()=>u});var i=r(31191),n=r(96969),s=r(71892),a=r(7949),o=r(44394),u=(r(51392),function(e){function t(t,r,i,n,s,a,o,u,l){void 0===n&&(n=5),void 0===s&&(s=0),void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===u&&(u=3),void 0===l&&(l=null);var h=e.call(this,"",t)||this;return h._texture=t.getEngine().createRawCubeTexture(r,i,n,s,a,o,u,l),h}return(0,i.ZT)(t,e),t.prototype.update=function(e,t,r,i,n){void 0===n&&(n=null),this._texture.getEngine().updateRawCubeTexture(this._texture,e,t,r,i,n)},t.prototype.updateRGBDAsync=function(e,t,r,i){return void 0===t&&(t=null),void 0===r&&(r=.8),void 0===i&&(i=0),(0,s.Lf)(this._texture,e,t,r,i).then((function(){}))},t.prototype.clone=function(){var e=this;return n.p4.Clone((function(){var r=e.getScene(),i=e._texture,n=new t(r,i._bufferViewArray,i.width,i.format,i.type,i.generateMipMaps,i.invertY,i.samplingMode,i._compression);return i.source===a.S.CubeRawRGBD&&n.updateRGBDAsync(i._bufferViewArrayArray,i._sphericalPolynomial,i._lodGenerationScale,i._lodGenerationOffset),n}),this)},t}(o.B))},15034:(e,t,r)=>{r.d(t,{l:()=>s});var i=r(31191),n=r(73803),s=(r(51392),function(e){function t(t,r,i,s,a,o,u,l,h,c,d){void 0===o&&(o=!0),void 0===u&&(u=!1),void 0===l&&(l=3),void 0===h&&(h=0);var p=e.call(this,null,a,!o,u,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,c)||this;return p.format=s,p._engine?(p._engine._caps.textureFloatLinearFiltering||1!==h||(l=1),p._engine._caps.textureHalfFloatLinearFiltering||2!==h||(l=1),p._texture=p._engine.createRawTexture(t,r,i,s,o,u,l,null,h,null!=c?c:0,null!=d&&d),p.wrapU=n.x.CLAMP_ADDRESSMODE,p.wrapV=n.x.CLAMP_ADDRESSMODE,p):p}return(0,i.ZT)(t,e),t.prototype.update=function(e){this._getEngine().updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)},t.CreateLuminanceTexture=function(e,r,i,n,s,a,o){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===o&&(o=3),new t(e,r,i,1,n,s,a,o)},t.CreateLuminanceAlphaTexture=function(e,r,i,n,s,a,o){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===o&&(o=3),new t(e,r,i,2,n,s,a,o)},t.CreateAlphaTexture=function(e,r,i,n,s,a,o){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===o&&(o=3),new t(e,r,i,0,n,s,a,o)},t.CreateRGBTexture=function(e,r,i,n,s,a,o,u,l,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===o&&(o=3),void 0===u&&(u=0),void 0===l&&(l=0),void 0===h&&(h=!1),new t(e,r,i,4,n,s,a,o,u,l,h)},t.CreateRGBATexture=function(e,r,i,n,s,a,o,u,l,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===o&&(o=3),void 0===u&&(u=0),void 0===l&&(l=0),void 0===h&&(h=!1),new t(e,r,i,5,n,s,a,o,u,l,h)},t.CreateRGBAStorageTexture=function(e,r,i,n,s,a,o,u,l){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===o&&(o=3),void 0===u&&(u=0),void 0===l&&(l=!1),new t(e,r,i,5,n,s,a,o,u,1,l)},t.CreateRTexture=function(e,r,i,s,a,o,u,l){return void 0===a&&(a=!0),void 0===o&&(o=!1),void 0===u&&(u=n.x.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=1),new t(e,r,i,6,s,a,o,u,l)},t.CreateRStorageTexture=function(e,r,i,s,a,o,u,l){return void 0===a&&(a=!0),void 0===o&&(o=!1),void 0===u&&(u=n.x.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=1),new t(e,r,i,6,s,a,o,u,l,1)},t}(n.x))},93097:(e,t,r)=>{r.d(t,{e:()=>s});var i=r(31191),n=r(73803),s=(r(51392),function(e){function t(t,r,i,s,a,o,u,l,h,c){void 0===u&&(u=!0),void 0===l&&(l=!1),void 0===h&&(h=n.x.TRILINEAR_SAMPLINGMODE),void 0===c&&(c=0);var d=e.call(this,null,o,!u,l)||this;return d.format=a,d._texture=o.getEngine().createRawTexture2DArray(t,r,i,s,a,u,l,h,null,c),d._depth=s,d.is2DArray=!0,d}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"depth",{get:function(){return this._depth},enumerable:!1,configurable:!0}),t.prototype.update=function(e){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t.CreateRGBATexture=function(e,r,i,n,s,a,o,u,l){return void 0===a&&(a=!0),void 0===o&&(o=!1),void 0===u&&(u=3),void 0===l&&(l=0),new t(e,r,i,n,5,s,a,o,u,l)},t}(n.x))},63784:(e,t,r)=>{r.d(t,{_:()=>c});var i=r(31191),n=r(62897),s=r(13514),a=r(58095),o=r(73803),u=r(1421),l=r(70235),h=(r(13534),r(74500),r(37290)),c=function(e){function t(t,r,i,s,u,h,c,d,p,_,f,T,g,m,x,E,v){void 0===u&&(u=!0),void 0===h&&(h=0),void 0===c&&(c=!1),void 0===d&&(d=o.x.TRILINEAR_SAMPLINGMODE),void 0===p&&(p=!0),void 0===_&&(_=!1),void 0===f&&(f=!1),void 0===T&&(T=5),void 0===g&&(g=!1),void 0===E&&(E=!1),void 0===v&&(v=!1);var R,y=this;if((y=e.call(this,null,i,!s,void 0,d,void 0,void 0,void 0,void 0,T)||this).renderParticles=!0,y.renderSprites=!1,y.ignoreCameraViewport=!1,y.onBeforeBindObservable=new n.y$,y.onAfterUnbindObservable=new n.y$,y.onBeforeRenderObservable=new n.y$,y.onAfterRenderObservable=new n.y$,y.onClearObservable=new n.y$,y.onResizeObservable=new n.y$,y._cleared=!1,y.skipInitialClear=!1,y._currentRefreshId=-1,y._refreshRate=1,y._samples=1,y._canRescale=!0,y._renderTarget=null,y.boundingBoxPosition=a.P.Zero(),!(i=y.getScene()))return y;var A=y.getScene().getEngine();return y._coordinatesMode=o.x.PROJECTION_MODE,y.renderList=new Array,y.name=t,y.isRenderTarget=!0,y._initialSizeParameter=r,y._renderPassIds=[],y._isCubeData=c,y._processSizeParameter(r),y.renderPassId=y._renderPassIds[0],y._resizeObserver=A.onResizeObservable.add((function(){})),y._generateMipMaps=!!s,y._doNotChangeAspectRatio=u,y._renderingManager=new l.$(i),y._renderingManager._useSceneAutoClearSetup=!0,f||(y._renderTargetOptions={generateMipMaps:s,type:h,format:null!==(R=y._format)&&void 0!==R?R:void 0,samplingMode:y.samplingMode,generateDepthBuffer:p,generateStencilBuffer:_,samples:m,creationFlags:x,noColorTarget:E,useSRGBBuffer:v},y.samplingMode===o.x.NEAREST_SAMPLINGMODE&&(y.wrapU=o.x.CLAMP_ADDRESSMODE,y.wrapV=o.x.CLAMP_ADDRESSMODE),g||(c?(y._renderTarget=i.getEngine().createRenderTargetCubeTexture(y.getRenderSize(),y._renderTargetOptions),y.coordinatesMode=o.x.INVCUBIC_MODE,y._textureMatrix=a.y3.Identity()):y._renderTarget=i.getEngine().createRenderTargetTexture(y._size,y._renderTargetOptions),y._texture=y._renderTarget.texture,void 0!==m&&(y.samples=m))),y}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"renderList",{get:function(){return this._renderList},set:function(e){this._renderList=e,this._renderList&&this._hookArray(this._renderList)},enumerable:!1,configurable:!0}),t.prototype._hookArray=function(e){var t=this,r=e.push;e.push=function(){for(var i,n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];var a=0===e.length,o=r.apply(e,n);return a&&(null===(i=t.getScene())||void 0===i||i.meshes.forEach((function(e){e._markSubMeshesAsLightDirty()}))),o};var i=e.splice;e.splice=function(r,n){var s,a=i.apply(e,[r,n]);return 0===e.length&&(null===(s=t.getScene())||void 0===s||s.meshes.forEach((function(e){e._markSubMeshesAsLightDirty()}))),a}},Object.defineProperty(t.prototype,"postProcesses",{get:function(){return this._postProcesses},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_prePassEnabled",{get:function(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderPassIds",{get:function(){return this._renderPassIds},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentRefreshId",{get:function(){return this._currentRefreshId},enumerable:!1,configurable:!0}),t.prototype.setMaterialForRendering=function(e,t){var r;r=Array.isArray(e)?e:[e];for(var i=0;i<r.length;++i)for(var n=0;n<this._renderPassIds.length;++n)r[i].setMaterialForRenderPass(this._renderPassIds[n],void 0!==t?Array.isArray(t)?t[n]:t:void 0)},Object.defineProperty(t.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!1,configurable:!0}),t.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthStencilTexture",{get:function(){var e,t;return null!==(t=null===(e=this._renderTarget)||void 0===e?void 0:e._depthStencilTexture)&&void 0!==t?t:null},enumerable:!1,configurable:!0}),t.prototype.createDepthStencilTexture=function(e,t,r,i,n){var s;void 0===e&&(e=0),void 0===t&&(t=!0),void 0===r&&(r=!1),void 0===i&&(i=1),void 0===n&&(n=14),null===(s=this._renderTarget)||void 0===s||s.createDepthStencilTexture(e,t,r,i,n)},t.prototype._releaseRenderPassId=function(){if(this._scene)for(var e=this._scene.getEngine(),t=0;t<this._renderPassIds.length;++t)e.releaseRenderPassId(this._renderPassIds[t]);this._renderPassIds=[]},t.prototype._createRenderPassId=function(){this._releaseRenderPassId();for(var e=this._scene.getEngine(),t=this._isCubeData?6:this.getRenderLayers()||1,r=0;r<t;++r)this._renderPassIds[r]=e.createRenderPassId("RenderTargetTexture - ".concat(this.name,"#").concat(r))},t.prototype._processSizeParameter=function(e){if(e.ratio){this._sizeRatio=e.ratio;var t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=e;this._createRenderPassId()},Object.defineProperty(t.prototype,"samples",{get:function(){var e,t;return null!==(t=null===(e=this._renderTarget)||void 0===e?void 0:e.samples)&&void 0!==t?t:this._samples},set:function(e){this._renderTarget&&(this._samples=this._renderTarget.setSamples(e))},enumerable:!1,configurable:!0}),t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),t.prototype.addPostProcess=function(e){if(!this._postProcessManager){var t=this.getScene();if(!t)return;this._postProcessManager=new u.O(t),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1},t.prototype.clearPostProcesses=function(e){if(void 0===e&&(e=!1),this._postProcesses){if(e)for(var t=0,r=this._postProcesses;t<r.length;t++){r[t].dispose()}this._postProcesses=[]}},t.prototype.removePostProcess=function(e){if(this._postProcesses){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},t.prototype._shouldRender=function(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},t.prototype.getRenderSize=function(){return this.getRenderWidth()},t.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},t.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},t.prototype.getRenderLayers=function(){var e=this._size.layers;return e||0},t.prototype.disableRescaling=function(){this._canRescale=!1},Object.defineProperty(t.prototype,"canRescale",{get:function(){return this._canRescale},enumerable:!1,configurable:!0}),t.prototype.scale=function(e){var t=Math.max(1,this.getRenderSize()*e);this.resize(t)},t.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:e.prototype.getReflectionTextureMatrix.call(this)},t.prototype.resize=function(e){var t,r=this.isCube;null===(t=this._renderTarget)||void 0===t||t.dispose(),this._renderTarget=null;var i=this.getScene();i&&(this._processSizeParameter(e),this._renderTarget=r?i.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):i.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},t.prototype.render=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this._render(e,t)},t.prototype.isReadyForRendering=function(){return this._render(!1,!1,!0)},t.prototype._render=function(e,t,r){var i;void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===r&&(r=!1);var n=this.getScene();if(!n)return r;var s=n.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var a=0;a<this._waitingRenderList.length;a++){var o=this._waitingRenderList[a];(h=n.getMeshById(o))&&this.renderList.push(h)}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];var u=this.getScene();if(!u)return r;var l=u.meshes;for(a=0;a<l.length;a++){var h=l[a];this.renderListPredicate(h)&&this.renderList.push(h)}}var c=s.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);var d=null!==(i=this.activeCamera)&&void 0!==i?i:n.activeCamera;d&&(d!==n.activeCamera&&n.setTransformMatrix(d.getViewMatrix(),d.getProjectionMatrix(!0)),s.setViewport(d.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;var p=r;if(r){n.getViewMatrix()||n.updateTransformMatrix();var _=this.is2DArray?this.getRenderLayers():this.isCube?6:1;for(x=0;x<_&&p;x++){var f=null,T=this.renderList?this.renderList:n.getActiveMeshes().data,g=this.renderList?this.renderList.length:n.getActiveMeshes().length;s.currentRenderPassId=this._renderPassIds[x],this.onBeforeRenderObservable.notifyObservers(x),this.getCustomRenderList&&(f=this.getCustomRenderList(x,T,g)),f||(f=T),this._doNotChangeAspectRatio||n.updateTransformMatrix(!0);for(var m=0;m<f.length&&p;++m){if((h=f[m]).isEnabled()&&!h.isBlocked&&h.isVisible&&h.subMeshes)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(h,this.refreshRate)){p=!1;break}}else if(!h.isReady(!0)){p=!1;break}}this.onAfterRenderObservable.notifyObservers(x)}}else if(this.is2DArray)for(var x=0;x<this.getRenderLayers();x++)this._renderToTarget(0,e,t,x,d),n.incrementRenderId(),n.resetCachedMaterial();else if(this.isCube)for(var E=0;E<6;E++)this._renderToTarget(E,e,t,void 0,d),n.incrementRenderId(),n.resetCachedMaterial();else this._renderToTarget(0,e,t,void 0,d);return this.onAfterUnbindObservable.notifyObservers(this),s.currentRenderPassId=c,n.activeCamera&&((n.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==n.activeCamera)&&n.setTransformMatrix(n.activeCamera.getViewMatrix(),n.activeCamera.getProjectionMatrix(!0)),s.setViewport(n.activeCamera.viewport)),n.resetCachedMaterial(),p},t.prototype._bestReflectionRenderTargetDimension=function(e,t){var r=e*t,i=h.D.NearestPOT(r+16384/(128+r));return Math.min(h.D.FloorPOT(e),i)},t.prototype._prepareRenderingManager=function(e,t,r,i){var n=this.getScene();if(n){this._renderingManager.reset();for(var s=n.getRenderId(),a=0;a<t;a++){var o=e[a];if(o&&!o.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(o,this.refreshRate)){this.resetRefreshCounter();continue}}else if(!o.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!o._internalAbstractMeshDataInfo._currentLODIsUpToDate&&n.activeCamera&&(o._internalAbstractMeshDataInfo._currentLOD=n.customLODSelector?n.customLODSelector(o,this.activeCamera||n.activeCamera):o.getLOD(this.activeCamera||n.activeCamera),o._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!o._internalAbstractMeshDataInfo._currentLOD)continue;var u=o._internalAbstractMeshDataInfo._currentLOD;u._preActivateForIntermediateRendering(s);var l=void 0;if(l=!(!i||!r)&&0==(o.layerMask&r.layerMask),o.isEnabled()&&o.isVisible&&o.subMeshes&&!l&&(u!==o&&u._activate(s,!0),o._activate(s,!0)&&o.subMeshes.length)){o.isAnInstance?o._internalAbstractMeshDataInfo._actAsRegularMesh&&(u=o):u._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,u._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var h=0;h<u.subMeshes.length;h++){var c=u.subMeshes[h];this._renderingManager.dispatch(c,u)}}}}for(var d=0;d<n.particleSystems.length;d++){var p=n.particleSystems[d],_=p.emitter;p.isStarted()&&_&&_.position&&_.isEnabled()&&(e.indexOf(_)>=0&&this._renderingManager.dispatchParticles(p))}}},t.prototype._bindFrameBuffer=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var r=this.getScene();if(r){var i=r.getEngine();this._renderTarget&&i.bindFramebuffer(this._renderTarget,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}},t.prototype._unbindFrameBuffer=function(e,t){var r=this;this._renderTarget&&e.unBindFramebuffer(this._renderTarget,this.isCube,(function(){r.onAfterRenderObservable.notifyObservers(t)}))},t.prototype._prepareFrame=function(e,t,r,i){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):i&&e.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(t,r)},t.prototype._renderToTarget=function(e,t,r,i,n){var a,o,u,l,h,c;void 0===i&&(i=0),void 0===n&&(n=null);var d=this.getScene();if(d){var p=d.getEngine();if(null===(a=p._debugPushGroup)||void 0===a||a.call(p,"render to face #".concat(e," layer #").concat(i),1),this._prepareFrame(d,e,i,t),this.is2DArray?(p.currentRenderPassId=this._renderPassIds[i],this.onBeforeRenderObservable.notifyObservers(i)):(p.currentRenderPassId=this._renderPassIds[e],this.onBeforeRenderObservable.notifyObservers(e)),p.snapshotRendering&&1===p.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(p):this.skipInitialClear||p.clear(this.clearColor||d.clearColor,!0,!0,!0);else{var _=null,f=this.renderList?this.renderList:d.getActiveMeshes().data,T=this.renderList?this.renderList.length:d.getActiveMeshes().length;this.getCustomRenderList&&(_=this.getCustomRenderList(this.is2DArray?i:e,f,T)),_?this._prepareRenderingManager(_,_.length,n,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(f,T,n,!this.renderList),this._defaultRenderListPrepared=!0),_=f);for(var g=0,m=d._beforeRenderTargetClearStage;g<m.length;g++){m[g].action(this,e,i)}this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(p):this.skipInitialClear||p.clear(this.clearColor||d.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||d.updateTransformMatrix(!0);for(var x=0,E=d._beforeRenderTargetDrawStage;x<E.length;x++){E[x].action(this,e,i)}this._renderingManager.render(this.customRenderFunction,_,this.renderParticles,this.renderSprites);for(var v=0,R=d._afterRenderTargetDrawStage;v<R.length;v++){R[v].action(this,e,i)}var y=null!==(u=null===(o=this._texture)||void 0===o?void 0:o.generateMipMaps)&&void 0!==u&&u;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,null!==(l=this._renderTarget)&&void 0!==l?l:void 0,e,this._postProcesses,this.ignoreCameraViewport):t&&d.postProcessManager._finalizeFrame(!1,null!==(h=this._renderTarget)&&void 0!==h?h:void 0,e),this._texture&&(this._texture.generateMipMaps=y),this._doNotChangeAspectRatio||d.updateTransformMatrix(!0),r&&s.w1.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),p)}this._unbindFrameBuffer(p,e),this._texture&&this.isCube&&5===e&&p.generateMipMapsForCubemap(this._texture),null===(c=p._debugPopGroup)||void 0===c||c.call(p,1)}},t.prototype.setRenderingOrder=function(e,t,r,i){void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),this._renderingManager.setRenderingOrder(e,t,r,i)},t.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1},t.prototype.clone=function(){var e=this.getSize(),r=new t(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.coordinatesMode=this.coordinatesMode,this.renderList&&(r.renderList=this.renderList.slice(0)),r},t.prototype.serialize=function(){if(!this.name)return null;var t=e.prototype.serialize.call(this);if(t.renderTargetSize=this.getRenderSize(),t.renderList=[],this.renderList)for(var r=0;r<this.renderList.length;r++)t.renderList.push(this.renderList[r].id);return t},t.prototype.disposeFramebufferObjects=function(){var e;null===(e=this._renderTarget)||void 0===e||e.dispose(!0)},t.prototype.releaseInternalTexture=function(){var e;null===(e=this._renderTarget)||void 0===e||e.releaseTextures(),this._texture=null},t.prototype.dispose=function(){var t;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var r=this.getScene();if(r){var i=r.customRenderTargets.indexOf(this);i>=0&&r.customRenderTargets.splice(i,1);for(var n=0,s=r.cameras;n<s.length;n++){var a=s[n];(i=a.customRenderTargets.indexOf(this))>=0&&a.customRenderTargets.splice(i,1)}null===(t=this._renderTarget)||void 0===t||t.dispose(),this._renderTarget=null,this._texture=null,e.prototype.dispose.call(this)}},t.prototype._rebuild=function(){this.refreshRate===t.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=t.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},t.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},t.prototype.getViewCount=function(){return 1},t.REFRESHRATE_RENDER_ONCE=0,t.REFRESHRATE_RENDER_ONEVERYFRAME=1,t.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,t}(o.x);o.x._CreateRenderTargetTexture=function(e,t,r,i,n){return new c(e,t,r,i)}},73803:(e,t,r)=>{r.d(t,{x:()=>T});var i=r(31191),n=r(96969),s=r(62897),a=r(58095),o=r(39126),u=r(48620),l=r(77851),h=r(44335),c=r(35890),d=r(62464),p=r(29972),_=r(50679),f=r(47884),T=function(e){function t(r,i,n,a,o,u,l,c,d,p,_,T,g,m){void 0===o&&(o=t.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===d&&(d=!1);var x,E,v,R,y,A,S,b,C,M,I=this;(I=e.call(this,i)||this).url=null,I.uOffset=0,I.vOffset=0,I.uScale=1,I.vScale=1,I.uAng=0,I.vAng=0,I.wAng=0,I.uRotationCenter=.5,I.vRotationCenter=.5,I.wRotationCenter=.5,I.homogeneousRotationInUVTransform=!1,I.inspectableCustomProperties=null,I._noMipmap=!1,I._invertY=!1,I._rowGenerationMatrix=null,I._cachedTextureMatrix=null,I._projectionModeMatrix=null,I._t0=null,I._t1=null,I._t2=null,I._cachedUOffset=-1,I._cachedVOffset=-1,I._cachedUScale=0,I._cachedVScale=0,I._cachedUAng=-1,I._cachedVAng=-1,I._cachedWAng=-1,I._cachedProjectionMatrixId=-1,I._cachedURotationCenter=-1,I._cachedVRotationCenter=-1,I._cachedWRotationCenter=-1,I._cachedHomogeneousRotationInUVTransform=!1,I._cachedCoordinatesMode=-1,I._buffer=null,I._deleteBuffer=!1,I._format=null,I._delayedOnLoad=null,I._delayedOnError=null,I.onLoadObservable=new s.y$,I._isBlocking=!0,I.name=r||"",I.url=r;var O=!1,L=null;"object"==typeof n&&null!==n?(M=null!==(x=n.noMipmap)&&void 0!==x&&x,a=null!==(E=n.invertY)&&void 0!==E?E:!f.e.UseOpenGLOrientationForUV,o=null!==(v=n.samplingMode)&&void 0!==v?v:t.TRILINEAR_SAMPLINGMODE,u=null!==(R=n.onLoad)&&void 0!==R?R:null,l=null!==(y=n.onError)&&void 0!==y?y:null,c=null!==(A=n.buffer)&&void 0!==A?A:null,d=null!==(S=n.deleteBuffer)&&void 0!==S&&S,p=n.format,_=n.mimeType,T=n.loaderOptions,g=n.creationFlags,O=null!==(b=n.useSRGBBuffer)&&void 0!==b&&b,L=null!==(C=n.internalTexture)&&void 0!==C?C:null):M=!!n,I._noMipmap=M,I._invertY=void 0===a?!f.e.UseOpenGLOrientationForUV:a,I._initialSamplingMode=o,I._buffer=c,I._deleteBuffer=d,I._mimeType=_,I._loaderOptions=T,I._creationFlags=g,I._useSRGBBuffer=O,I._forcedExtension=m,p&&(I._format=p);var P=I.getScene(),N=I._getEngine();if(!N)return I;N.onBeforeTextureInitObservable.notifyObservers(I);var F=function(){I._texture&&(I._texture._invertVScale&&(I.vScale*=-1,I.vOffset+=1),null!==I._texture._cachedWrapU&&(I.wrapU=I._texture._cachedWrapU,I._texture._cachedWrapU=null),null!==I._texture._cachedWrapV&&(I.wrapV=I._texture._cachedWrapV,I._texture._cachedWrapV=null),null!==I._texture._cachedWrapR&&(I.wrapR=I._texture._cachedWrapR,I._texture._cachedWrapR=null)),I.onLoadObservable.hasObservers()&&I.onLoadObservable.notifyObservers(I),u&&u(),!I.isBlocking&&P&&P.resetCachedMaterial()},D=function(e,r){I._loadingError=!0,I._errorObject={message:e,exception:r},l&&l(e,r),t.OnTextureLoadErrorObservable.notifyObservers(I)};if(!I.url)return I._delayedOnLoad=F,I._delayedOnError=D,I;if(I._texture=null!=L?L:I._getFromCache(I.url,M,o,I._invertY,O),I._texture)if(I._texture.isReady)h.Q.SetImmediate((function(){return F()}));else{var U=I._texture.onLoadedObservable.add(F);I._texture.onErrorObservable.add((function(e){var t;D(e.message,e.exception),null===(t=I._texture)||void 0===t||t.onLoadedObservable.remove(U)}))}else if(P&&P.useDelayedTextureLoading)I.delayLoadState=4,I._delayedOnLoad=F,I._delayedOnError=D;else{try{I._texture=N.createTexture(I.url,M,I._invertY,P,o,F,D,I._buffer,void 0,I._format,I._forcedExtension,_,T,g,O)}catch(e){throw D("error loading",e),e}d&&(I._buffer=null)}return I}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mimeType",{get:function(){return this._mimeType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"invertY",{get:function(){return this._invertY},enumerable:!1,configurable:!0}),t.prototype.updateURL=function(e,t,r,i){void 0===t&&(t=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=i,this.delayLoadState=4,r&&(this._delayedOnLoad=r),this.delayLoad()},t.prototype.delayLoad=function(){if(4===this.delayLoadState){var e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer),this._texture?this._delayedOnLoad&&(this._texture.isReady?h.Q.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}},t.prototype._prepareRowForTextureGeneration=function(e,t,r,i){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,r-=this.wRotationCenter,a.P.TransformCoordinatesFromFloatsToRef(e,t,r,this._rowGenerationMatrix,i),i.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,i.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,i.z+=this.wRotationCenter},t.prototype.checkTransformsAreIdentical=function(e){return null!==e&&this.uOffset===e.uOffset&&this.vOffset===e.vOffset&&this.uScale===e.uScale&&this.vScale===e.vScale&&this.uAng===e.uAng&&this.vAng===e.vAng&&this.wAng===e.wAng},t.prototype.getTextureMatrix=function(e){var t=this;if(void 0===e&&(e=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=a.y3.Zero(),this._rowGenerationMatrix=new a.y3,this._t0=a.P.Zero(),this._t1=a.P.Zero(),this._t2=a.P.Zero()),a.y3.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(a.y3.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,a.jp.Matrix[0]),a.y3.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,a.jp.Matrix[1]),a.y3.ScalingToRef(this._cachedUScale,this._cachedVScale,0,a.jp.Matrix[2]),a.y3.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,a.jp.Matrix[3]),a.jp.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.jp.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.jp.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.jp.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),a.y3.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var r=this.getScene();return r?(r.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})),this._cachedTextureMatrix):this._cachedTextureMatrix},t.prototype.getReflectionTextureMatrix=function(){var e=this,r=this.getScene();if(!r)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==t.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===r.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}this._cachedTextureMatrix||(this._cachedTextureMatrix=a.y3.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=a.y3.Zero());var i=this._cachedCoordinatesMode!==this.coordinatesMode;switch(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case t.PLANAR_MODE:a.y3.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case t.PROJECTION_MODE:a.y3.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var n=r.getProjectionMatrix();this._cachedProjectionMatrixId=n.updateFlag,n.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:a.y3.IdentityToRef(this._cachedTextureMatrix)}return i&&r.markAllMaterialsAsDirty(1,(function(t){return-1!==t.getActiveTextures().indexOf(e)})),this._cachedTextureMatrix},t.prototype.clone=function(){var e=this,r={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return n.p4.Clone((function(){return new t(e._texture?e._texture.url:null,e.getScene(),r)}),this)},t.prototype.serialize=function(){var r=this.name;t.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");var i=e.prototype.serialize.call(this);return i?((t.SerializeBuffers||t.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(i.base64String=this._buffer,i.name=i.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?i.base64String="data:image/png;base64,"+(0,p.Gh)(this._buffer):(t.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(i.base64String=!this._engine||this._engine._features.supportSyncTextureRead?(0,_._u)(this):(0,_.Jj)(this))),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i._creationFlags=this._creationFlags,i._useSRGBBuffer=this._useSRGBBuffer,this.name=r,i):null},t.prototype.getClassName=function(){return"Texture"},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},t.Parse=function(e,r,i){if(e.customType){var s=c.K.Instantiate(e.customType).Parse(e,r,i);return e.samplingMode&&s.updateSamplingMode&&s._samplingMode&&s._samplingMode!==e.samplingMode&&s.updateSamplingMode(e.samplingMode),s}if(e.isCube&&!e.isRenderTarget)return t._CubeTextureParser(e,r,i);if(!e.name&&!e.isRenderTarget)return null;var a=function(){if(o&&o._texture&&(o._texture._cachedWrapU=null,o._texture._cachedWrapV=null,o._texture._cachedWrapR=null),e.samplingMode){var t=e.samplingMode;o&&o.samplingMode!==t&&o.updateSamplingMode(t)}if(o&&e.animations)for(var r=0;r<e.animations.length;r++){var i=e.animations[r],n=(0,u.q)("BABYLON.Animation");n&&o.animations.push(n.Parse(i))}},o=n.p4.Parse((function(){var n,s,o,u,l=!0;if(e.noMipmap&&(l=!1),e.mirrorPlane){var h=t._CreateMirror(e.name,e.renderTargetSize,r,l);return h._waitingRenderList=e.renderList,h.mirrorPlane=d.J.FromArray(e.mirrorPlane),a(),h}if(e.isRenderTarget){var c=null;if(e.isCube){if(r.reflectionProbes)for(var p=0;p<r.reflectionProbes.length;p++){var _=r.reflectionProbes[p];if(_.name===e.name)return _.cubeTexture}}else(c=t._CreateRenderTargetTexture(e.name,e.renderTargetSize,r,l,null!==(n=e._creationFlags)&&void 0!==n?n:0))._waitingRenderList=e.renderList;return a(),c}if(e.base64String)u=t.CreateFromBase64String(e.base64String,e.name,r,!l,e.invertY,e.samplingMode,a,null!==(s=e._creationFlags)&&void 0!==s?s:0,null!==(o=e._useSRGBBuffer)&&void 0!==o&&o);else{var f=void 0;f=e.name&&e.name.indexOf("://")>0?e.name:i+e.name,e.url&&(e.url.startsWith("data:")||t.UseSerializedUrlIfAny)&&(f=e.url),u=new t(f,r,!l,e.invertY,e.samplingMode,a)}return u}),e,r);return o},t.CreateFromBase64String=function(e,r,i,n,s,a,o,u,l,h){return void 0===a&&(a=t.TRILINEAR_SAMPLINGMODE),void 0===o&&(o=null),void 0===u&&(u=null),void 0===l&&(l=5),new t("data:"+r,i,n,s,a,o,u,e,!1,l,void 0,void 0,h)},t.LoadFromDataString=function(e,r,i,n,s,a,o,u,l,h,c){return void 0===n&&(n=!1),void 0===a&&(a=!0),void 0===o&&(o=t.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=null),void 0===l&&(l=null),void 0===h&&(h=5),"data:"!==e.substr(0,5)&&(e="data:"+e),new t(e,i,s,a,o,u,l,r,n,h,void 0,void 0,c)},t.SerializeBuffers=!0,t.ForceSerializeBuffers=!1,t.OnTextureLoadErrorObservable=new s.y$,t._CubeTextureParser=function(e,t,r){throw(0,l.S)("CubeTexture")},t._CreateMirror=function(e,t,r,i){throw(0,l.S)("MirrorTexture")},t._CreateRenderTargetTexture=function(e,t,r,i,n){throw(0,l.S)("RenderTargetTexture")},t.NEAREST_SAMPLINGMODE=1,t.NEAREST_NEAREST_MIPLINEAR=8,t.BILINEAR_SAMPLINGMODE=2,t.LINEAR_LINEAR_MIPNEAREST=11,t.TRILINEAR_SAMPLINGMODE=3,t.LINEAR_LINEAR_MIPLINEAR=3,t.NEAREST_NEAREST_MIPNEAREST=4,t.NEAREST_LINEAR_MIPNEAREST=5,t.NEAREST_LINEAR_MIPLINEAR=6,t.NEAREST_LINEAR=7,t.NEAREST_NEAREST=1,t.LINEAR_NEAREST_MIPNEAREST=9,t.LINEAR_NEAREST_MIPLINEAR=10,t.LINEAR_LINEAR=2,t.LINEAR_NEAREST=12,t.EXPLICIT_MODE=0,t.SPHERICAL_MODE=1,t.PLANAR_MODE=2,t.CUBIC_MODE=3,t.PROJECTION_MODE=4,t.SKYBOX_MODE=5,t.INVCUBIC_MODE=6,t.EQUIRECTANGULAR_MODE=7,t.FIXED_EQUIRECTANGULAR_MODE=8,t.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,t.CLAMP_ADDRESSMODE=0,t.WRAP_ADDRESSMODE=1,t.MIRROR_ADDRESSMODE=2,t.UseSerializedUrlIfAny=!1,(0,i.gn)([(0,n.qC)()],t.prototype,"url",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"uOffset",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"vOffset",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"uScale",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"vScale",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"uAng",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"vAng",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"wAng",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"uRotationCenter",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"vRotationCenter",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"wRotationCenter",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"homogeneousRotationInUVTransform",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"isBlocking",null),t}(o.V);(0,u.H)("BABYLON.Texture",T),n.p4._TextureParser=T.Parse},90729:(e,t,r)=>{r.d(t,{a:()=>i});var i=function(){function e(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}return Object.defineProperty(e.prototype,"wrapU",{get:function(){return this._cachedWrapU},set:function(e){this._cachedWrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapV",{get:function(){return this._cachedWrapV},set:function(e){this._cachedWrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapR",{get:function(){return this._cachedWrapR},set:function(e){this._cachedWrapR=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anisotropicFilteringLevel",{get:function(){return this._cachedAnisotropicFilteringLevel},set:function(e){this._cachedAnisotropicFilteringLevel=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"comparisonFunction",{get:function(){return this._comparisonFunction},set:function(e){this._comparisonFunction=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useMipMaps",{get:function(){return this._useMipMaps},set:function(e){this._useMipMaps=e},enumerable:!1,configurable:!0}),e.prototype.setParameters=function(e,t,r,i,n,s){return void 0===e&&(e=1),void 0===t&&(t=1),void 0===r&&(r=1),void 0===i&&(i=1),void 0===n&&(n=2),void 0===s&&(s=0),this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=r,this._cachedAnisotropicFilteringLevel=i,this.samplingMode=n,this._comparisonFunction=s,this},e.prototype.compareSampler=function(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps},e}()}}]);