"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6471],{43622:(e,t,r)=>{r.d(t,{wM:()=>c,ch:()=>p,bf:()=>m,XB:()=>i,cQ:()=>G,rO:()=>A,lS:()=>B,Mc:()=>L});var i,n=r(58095),s=r(3085),o=r(9148),a=r(15631),u=r(15210),c=function(){function e(t,r,i,c,l,h,p){if(void 0===r&&(r=1),void 0===i&&(i=2),void 0===p&&(p=1),this._scaleLinesFactor=4,this._instanced=!1,this.scene=null,this.scaleLines=1,t=t||u.l.LastCreatedScene){if(this.scaleLines=r,!c){var d=new s.K("",t);d.disableLighting=!0,d.emissiveColor=a.Wo.Red().scale(.5),c=o.u._CreateArrow(t,d,p)}if(!l){var _=new s.K("",t);_.disableLighting=!0,_.emissiveColor=a.Wo.Green().scale(.5),l=o.u._CreateArrow(t,_,p)}if(!h){var f=new s.K("",t);f.disableLighting=!0,f.emissiveColor=a.Wo.Blue().scale(.5),h=o.u._CreateArrow(t,f,p)}this._xAxis=c,this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis=l,this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis=h,this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),null!=i&&(e._SetRenderingGroupId(this._xAxis,i),e._SetRenderingGroupId(this._yAxis,i),e._SetRenderingGroupId(this._zAxis,i)),this.scene=t,this.update(new n.P,n.P.Right(),n.P.Up(),n.P.Forward())}}return Object.defineProperty(e.prototype,"xAxis",{get:function(){return this._xAxis},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yAxis",{get:function(){return this._yAxis},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zAxis",{get:function(){return this._zAxis},enumerable:!1,configurable:!0}),e.prototype.update=function(e,t,r,i){this._xAxis.position.copyFrom(e),this._xAxis.setDirection(t),this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis.position.copyFrom(e),this._yAxis.setDirection(r),this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis.position.copyFrom(e),this._zAxis.setDirection(i),this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor)},e.prototype.createInstance=function(){var t=o.u._CreateArrowInstance(this.scene,this._xAxis),r=o.u._CreateArrowInstance(this.scene,this._yAxis),i=o.u._CreateArrowInstance(this.scene,this._zAxis),n=new e(this.scene,this.scaleLines,null,t,r,i);return n._instanced=!0,n},e.prototype.dispose=function(){this._xAxis&&this._xAxis.dispose(!1,!this._instanced),this._yAxis&&this._yAxis.dispose(!1,!this._instanced),this._zAxis&&this._zAxis.dispose(!1,!this._instanced),this.scene=null},e._SetRenderingGroupId=function(e,t){e.getChildMeshes().forEach((function(e){e.renderingGroupId=t}))},e}(),l=r(31191),h=r(43048),p=function(e){function t(t,r,i,s){void 0===s&&(s=1);var o=e.call(this,t,s)||this;return o.pos=n.P.Zero(),o.xaxis=n.P.Zero(),o.yaxis=n.P.Zero(),o.zaxis=n.P.Zero(),o.mesh=i,o.bone=r,o}return(0,l.ZT)(t,e),t.prototype.update=function(){if(this.mesh&&this.bone){var t=this.bone;t._markAsDirtyAndCompose(),t.getAbsolutePositionToRef(this.mesh,this.pos),t.getDirectionToRef(h.RD.X,this.mesh,this.xaxis),t.getDirectionToRef(h.RD.Y,this.mesh,this.yaxis),t.getDirectionToRef(h.RD.Z,this.mesh,this.zaxis),e.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},t.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,e.prototype.dispose.call(this))},t}(c),d=r(13514),_=r(62897),f=r(65273),g=r(37290);Object.defineProperty(f.x.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new m(this)),this._debugLayer},enumerable:!0,configurable:!0}),function(e){e[e.Properties=0]="Properties",e[e.Debug=1]="Debug",e[e.Statistics=2]="Statistics",e[e.Tools=3]="Tools",e[e.Settings=4]="Settings"}(i||(i={}));var m=function(){function e(e){var t=this;this.BJSINSPECTOR=this._getGlobalInspector(),this._scene=e||u.l.LastCreatedScene,this._scene&&this._scene.onDisposeObservable.add((function(){t._scene._debugLayer&&t._scene._debugLayer.hide()}))}return Object.defineProperty(e.prototype,"onPropertyChangedObservable",{get:function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector?this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable:(this._onPropertyChangedObservable||(this._onPropertyChangedObservable=new _.y$),this._onPropertyChangedObservable)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSelectionChangedObservable",{get:function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector?this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable:(this._onSelectionChangedObservable||(this._onSelectionChangedObservable=new _.y$),this._onSelectionChangedObservable)},enumerable:!1,configurable:!0}),e.prototype._createInspector=function(e){if(!this.isVisible()){if(this._onPropertyChangedObservable){for(var t=0,r=this._onPropertyChangedObservable.observers;t<r.length;t++){var i=r[t];this.BJSINSPECTOR.Inspector.OnPropertyChangedObservable.add(i)}this._onPropertyChangedObservable.clear(),this._onPropertyChangedObservable=void 0}if(this._onSelectionChangedObservable){for(var n=0,s=this._onSelectionChangedObservable.observers;n<s.length;n++){i=s[n];this.BJSINSPECTOR.Inspector.OnSelectionChangedObservable.add(i)}this._onSelectionChangedObservable.clear(),this._onSelectionChangedObservable=void 0}var o=(0,l.pi)({overlay:!1,showExplorer:!0,showInspector:!0,embedMode:!1,handleResize:!0,enablePopup:!0},e);this.BJSINSPECTOR=this.BJSINSPECTOR||this._getGlobalInspector(),this.BJSINSPECTOR.Inspector.Show(this._scene,o)}},e.prototype.select=function(e,t){this.BJSINSPECTOR&&(t&&("[object String]"==Object.prototype.toString.call(t)?this.BJSINSPECTOR.Inspector.MarkLineContainerTitleForHighlighting(t):this.BJSINSPECTOR.Inspector.MarkMultipleLineContainerTitlesForHighlighting(t)),this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable.notifyObservers(e))},e.prototype._getGlobalInspector=function(){return"undefined"!=typeof INSPECTOR?INSPECTOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.Inspector?BABYLON:void 0},e.prototype.isVisible=function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.IsVisible},e.prototype.hide=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.Hide()},e.prototype.setAsActiveScene=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector._SetNewScene(this._scene)},e.prototype.show=function(t){var r=this;return new Promise((function(i){if(void 0===r.BJSINSPECTOR){var n=t&&t.inspectorURL?t.inspectorURL:e.InspectorURL;d.w1.LoadScript(n,(function(){r._createInspector(t),i(r)}))}else r._createInspector(t),i(r)}))},e.InspectorURL="https://unpkg.com/babylonjs-inspector@".concat(g.D.Version,"/babylon.inspector.bundle.js"),e}(),E=r(91243),v=r(8451),T=r(48087),y=r(18737),b=r(85527),x=r(62845),S=r(6588),R=r(84318),A=function(){function e(e){if(this._impostors=[],this._meshes=[],this._numMeshes=0,this._debugMeshMeshes=new Array,this._scene=e||u.l.LastCreatedScene,this._scene){var t=this._scene.getPhysicsEngine();t&&(this._physicsEnginePlugin=t.getPhysicsPlugin()),this._utilityLayer=new b.x(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0}}return e.prototype._updateDebugMeshes=function(){for(var e=this._physicsEnginePlugin,t=0;t<this._numMeshes;t++){var r=this._impostors[t];if(r)if(r.isDisposed)this.hideImpostor(this._impostors[t--]);else{if(r.type===y.Q.MeshImpostor)continue;var i=this._meshes[t];i&&e&&e.syncMeshWithImpostor(i,r)}}},e.prototype.showImpostor=function(e,t){if(!this._scene)return null;for(var r=0;r<this._numMeshes;r++)if(this._impostors[r]==e)return null;var i=this._getDebugMesh(e,t);return i&&(this._impostors[this._numMeshes]=e,this._meshes[this._numMeshes]=i,0===this._numMeshes&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++),i},e.prototype.hideImpostor=function(e){if(e&&this._scene&&this._utilityLayer){for(var t=!1,r=this._utilityLayer.utilityLayerScene,i=0;i<this._numMeshes;i++)if(this._impostors[i]==e){var n=this._meshes[i];if(!n)continue;r.removeMesh(n),n.dispose();var s=this._debugMeshMeshes.indexOf(n);s>-1&&this._debugMeshMeshes.splice(s,1),this._numMeshes--,this._numMeshes>0?(this._meshes[i]=this._meshes[this._numMeshes],this._impostors[i]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),t=!0;break}t&&0===this._numMeshes&&this._scene.unregisterBeforeRender(this._renderFunction)}},e.prototype._getDebugMaterial=function(e){return this._debugMaterial||(this._debugMaterial=new s.K("",e),this._debugMaterial.wireframe=!0,this._debugMaterial.emissiveColor=a.Wo.White(),this._debugMaterial.disableLighting=!0),this._debugMaterial},e.prototype._getDebugBoxMesh=function(e){return this._debugBoxMesh||(this._debugBoxMesh=(0,v.NR)("physicsBodyBoxViewMesh",{size:1},e),this._debugBoxMesh.rotationQuaternion=n._f.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(e),this._debugBoxMesh.setEnabled(!1)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},e.prototype._getDebugSphereMesh=function(e){return this._debugSphereMesh||(this._debugSphereMesh=(0,T.Qk)("physicsBodySphereViewMesh",{diameter:1},e),this._debugSphereMesh.rotationQuaternion=n._f.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(e),this._debugSphereMesh.setEnabled(!1)),this._debugSphereMesh.createInstance("physicsBodySphereViewInstance")},e.prototype._getDebugCapsuleMesh=function(e){return this._debugCapsuleMesh||(this._debugCapsuleMesh=(0,S.iz)("physicsBodyCapsuleViewMesh",{height:1},e),this._debugCapsuleMesh.rotationQuaternion=n._f.Identity(),this._debugCapsuleMesh.material=this._getDebugMaterial(e),this._debugCapsuleMesh.setEnabled(!1)),this._debugCapsuleMesh.createInstance("physicsBodyCapsuleViewInstance")},e.prototype._getDebugCylinderMesh=function(e){return this._debugCylinderMesh||(this._debugCylinderMesh=(0,x.wf)("physicsBodyCylinderViewMesh",{diameterTop:1,diameterBottom:1,height:1},e),this._debugCylinderMesh.rotationQuaternion=n._f.Identity(),this._debugCylinderMesh.material=this._getDebugMaterial(e),this._debugCylinderMesh.setEnabled(!1)),this._debugCylinderMesh.createInstance("physicsBodyCylinderViewInstance")},e.prototype._getDebugMeshMesh=function(e,t){var r=new E.Kj(e.name,t,null,e);return r.setParent(e),r.position=n.P.Zero(),r.material=this._getDebugMaterial(t),this._debugMeshMeshes.push(r),r},e.prototype._getDebugMesh=function(e,t){var r=this;if(!this._utilityLayer)return null;if(t&&t.parent&&t.parent.physicsImpostor)return null;var i=null,n=this._utilityLayer.utilityLayerScene;if(!e.physicsBody)return R.Y.Warn("Unable to get physicsBody of impostor. It might be initialized later by its parent's impostor."),null;switch(e.type){case y.Q.BoxImpostor:i=this._getDebugBoxMesh(n),e.getBoxSizeToRef(i.scaling);break;case y.Q.SphereImpostor:i=this._getDebugSphereMesh(n);var s=e.getRadius();i.scaling.x=2*s,i.scaling.y=2*s,i.scaling.z=2*s;break;case y.Q.CapsuleImpostor:i=this._getDebugCapsuleMesh(n);var o=e.object.getBoundingInfo();i.scaling.x=2*(o.boundingBox.maximum.x-o.boundingBox.minimum.x)*e.object.scaling.x,i.scaling.y=(o.boundingBox.maximum.y-o.boundingBox.minimum.y)*e.object.scaling.y,i.scaling.z=2*(o.boundingBox.maximum.z-o.boundingBox.minimum.z)*e.object.scaling.z;break;case y.Q.MeshImpostor:t&&(i=this._getDebugMeshMesh(t,n));break;case y.Q.NoImpostor:if(t)t.getChildMeshes().filter((function(e){return e.physicsImpostor?1:0})).forEach((function(e){if(e.physicsImpostor&&"Mesh"===e.getClassName()){var t=e.getBoundingInfo(),s=t.boundingBox.minimum,o=t.boundingBox.maximum;switch(e.physicsImpostor.type){case y.Q.BoxImpostor:(i=r._getDebugBoxMesh(n)).position.copyFrom(s),i.position.addInPlace(o),i.position.scaleInPlace(.5);break;case y.Q.SphereImpostor:i=r._getDebugSphereMesh(n);break;case y.Q.CylinderImpostor:i=r._getDebugCylinderMesh(n);break;default:i=null}i&&(i.scaling.x=o.x-s.x,i.scaling.y=o.y-s.y,i.scaling.z=o.z-s.z,i.parent=e)}}));else R.Y.Warn("No target mesh parameter provided for NoImpostor. Skipping.");i=null;break;case y.Q.CylinderImpostor:i=this._getDebugCylinderMesh(n);o=e.object.getBoundingInfo();i.scaling.x=(o.boundingBox.maximum.x-o.boundingBox.minimum.x)*e.object.scaling.x,i.scaling.y=(o.boundingBox.maximum.y-o.boundingBox.minimum.y)*e.object.scaling.y,i.scaling.z=(o.boundingBox.maximum.z-o.boundingBox.minimum.z)*e.object.scaling.z}return i},e.prototype.dispose=function(){for(var e=this._numMeshes,t=0;t<e;t++)this.hideImpostor(this._impostors[0]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugCylinderMesh&&this._debugCylinderMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null,this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},e}(),C=r(9866),B=function(){function e(e){this.ray=e}return e.CreateAndShow=function(t,r,i){var n=new e(t);return n.show(r,i),n},e.prototype.show=function(e,t){if(!this._renderFunction&&this.ray){var r=this.ray;this._renderFunction=this._render.bind(this),this._scene=e,this._renderPoints=[r.origin,r.origin.add(r.direction.scale(r.length))],this._renderLine=(0,C.nL)("ray",{points:this._renderPoints,updatable:!0},e),this._renderLine.isPickable=!1,this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}t&&this._renderLine&&this._renderLine.color.copyFrom(t)},e.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},e.prototype._render=function(){var e,t=this.ray;if(t){var r=this._renderPoints[1],i=Math.min(t.length,1e6);r.copyFrom(t.direction),r.scaleInPlace(i),r.addInPlace(t.origin),this._renderPoints[0].copyFrom(t.origin),(0,C.nL)("ray",{points:this._renderPoints,updatable:!0,instance:this._renderLine},this._scene),null===(e=this._renderLine)||void 0===e||e.refreshBoundingInfo()}},e.prototype.attachToMesh=function(e,t,r,i){var s=this;this._attachedToMesh=e;var o=this.ray;o&&(o.direction||(o.direction=n.P.Zero()),o.origin||(o.origin=n.P.Zero()),i&&(o.length=i),r||(r=n.P.Zero()),t||(t=new n.P(0,0,-1)),this._scene||(this._scene=e.getScene()),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(t),this._meshSpaceOrigin.copyFrom(r)):(this._meshSpaceDirection=t.clone(),this._meshSpaceOrigin=r.clone()),this._onAfterRenderObserver||(this._onAfterRenderObserver=this._scene.onBeforeRenderObservable.add((function(){return s._updateToMesh()})),this._onAfterStepObserver=this._scene.onAfterStepObservable.add((function(){return s._updateToMesh()}))),this._attachedToMesh.computeWorldMatrix(!0),this._updateToMesh())},e.prototype.detachFromMesh=function(){this._attachedToMesh&&this._scene&&(this._onAfterRenderObserver&&(this._scene.onBeforeRenderObservable.remove(this._onAfterRenderObserver),this._scene.onAfterStepObservable.remove(this._onAfterStepObserver)),this._attachedToMesh=null,this._onAfterRenderObserver=null,this._onAfterStepObserver=null,this._scene=null)},e.prototype._updateToMesh=function(){var e=this.ray;this._attachedToMesh&&e&&(this._attachedToMesh.isDisposed()?this.detachFromMesh():(this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,e.direction),n.P.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),e.origin)))},e.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},e}(),P=r(98163),I=r(54067),D=r(93980),F=r(72208),U=r(9256),w=r(75159),L=function(){function e(t,r,i,n,s,o){var u,c,l,h,p,d,_,f,g,m,E,v,T,y;void 0===n&&(n=!0),void 0===s&&(s=3),void 0===o&&(o={}),this.skeleton=t,this.mesh=r,this.autoUpdateBonesMatrices=n,this.renderingGroupId=s,this.options=o,this.color=a.Wo.White(),this._debugLines=new Array,this._localAxes=null,this._isEnabled=!0,this._obs=null,this._scene=i,this._ready=!1,o.pauseAnimations=null===(u=o.pauseAnimations)||void 0===u||u,o.returnToRest=null!==(c=o.returnToRest)&&void 0!==c&&c,o.displayMode=null!==(l=o.displayMode)&&void 0!==l?l:e.DISPLAY_LINES,o.displayOptions=null!==(h=o.displayOptions)&&void 0!==h?h:{},o.displayOptions.midStep=null!==(p=o.displayOptions.midStep)&&void 0!==p?p:.235,o.displayOptions.midStepFactor=null!==(d=o.displayOptions.midStepFactor)&&void 0!==d?d:.155,o.displayOptions.sphereBaseSize=null!==(_=o.displayOptions.sphereBaseSize)&&void 0!==_?_:.15,o.displayOptions.sphereScaleUnit=null!==(f=o.displayOptions.sphereScaleUnit)&&void 0!==f?f:2,o.displayOptions.sphereFactor=null!==(g=o.displayOptions.sphereFactor)&&void 0!==g?g:.865,o.displayOptions.spurFollowsChild=null!==(m=o.displayOptions.spurFollowsChild)&&void 0!==m&&m,o.displayOptions.showLocalAxes=null!==(E=o.displayOptions.showLocalAxes)&&void 0!==E&&E,o.displayOptions.localAxesSize=null!==(v=o.displayOptions.localAxesSize)&&void 0!==v?v:.075,o.computeBonesUsingShaders=null===(T=o.computeBonesUsingShaders)||void 0===T||T,o.useAllBones=null===(y=o.useAllBones)||void 0===y||y;var x=r.getVerticesData(F.o.MatricesIndicesKind),S=r.getVerticesData(F.o.MatricesWeightsKind);if(this._boneIndices=new Set,!o.useAllBones&&x&&S)for(var R=0;R<x.length;++R){var A=x[R];0!==S[R]&&this._boneIndices.add(A)}this._utilityLayer=new b.x(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0;var C=this.options.displayMode||0;C>e.DISPLAY_SPHERE_AND_SPURS&&(C=e.DISPLAY_LINES),this.displayMode=C,this.update(),this._bindObs()}return e.CreateBoneWeightShader=function(e,t){var r,i,n,s,o,u,c=e.skeleton,l=null!==(r=e.colorBase)&&void 0!==r?r:a.Wo.Black(),h=null!==(i=e.colorZero)&&void 0!==i?i:a.Wo.Blue(),p=null!==(n=e.colorQuarter)&&void 0!==n?n:a.Wo.Green(),d=null!==(s=e.colorHalf)&&void 0!==s?s:a.Wo.Yellow(),_=null!==(o=e.colorFull)&&void 0!==o?o:a.Wo.Red(),f=null!==(u=e.targetBoneIndex)&&void 0!==u?u:0;U.Q.ShadersStore["boneWeights:"+c.name+"VertexShader"]="precision highp float;\n\n        attribute vec3 position;\n        attribute vec2 uv;\n\n        uniform mat4 view;\n        uniform mat4 projection;\n        uniform mat4 worldViewProjection;\n\n        #include<bonesDeclaration>\n        #if NUM_BONE_INFLUENCERS == 0\n            attribute vec4 matricesIndices;\n            attribute vec4 matricesWeights;\n        #endif\n        #include<bakedVertexAnimationDeclaration>\n\n        #include<instancesDeclaration>\n\n        varying vec3 vColor;\n\n        uniform vec3 colorBase;\n        uniform vec3 colorZero;\n        uniform vec3 colorQuarter;\n        uniform vec3 colorHalf;\n        uniform vec3 colorFull;\n\n        uniform float targetBoneIndex;\n\n        void main() {\n            vec3 positionUpdated = position;\n\n            #include<instancesVertex>\n            #include<bonesVertex>\n            #include<bakedVertexAnimation>\n\n            vec4 worldPos = finalWorld * vec4(positionUpdated, 1.0);\n\n            vec3 color = colorBase;\n            float totalWeight = 0.;\n            if(matricesIndices[0] == targetBoneIndex && matricesWeights[0] > 0.){\n                totalWeight += matricesWeights[0];\n            }\n            if(matricesIndices[1] == targetBoneIndex && matricesWeights[1] > 0.){\n                totalWeight += matricesWeights[1];\n            }\n            if(matricesIndices[2] == targetBoneIndex && matricesWeights[2] > 0.){\n                totalWeight += matricesWeights[2];\n            }\n            if(matricesIndices[3] == targetBoneIndex && matricesWeights[3] > 0.){\n                totalWeight += matricesWeights[3];\n            }\n\n            color = mix(color, colorZero, smoothstep(0., 0.25, totalWeight));\n            color = mix(color, colorQuarter, smoothstep(0.25, 0.5, totalWeight));\n            color = mix(color, colorHalf, smoothstep(0.5, 0.75, totalWeight));\n            color = mix(color, colorFull, smoothstep(0.75, 1.0, totalWeight));\n            vColor = color;\n\n        gl_Position = projection * view * worldPos;\n        }",U.Q.ShadersStore["boneWeights:"+c.name+"FragmentShader"]="\n            precision highp float;\n            varying vec3 vPosition;\n\n            varying vec3 vColor;\n\n            void main() {\n                vec4 color = vec4(vColor, 1.0);\n                gl_FragColor = color;\n            }\n        ";var g=new I.j("boneWeight:"+c.name,t,{vertex:"boneWeights:"+c.name,fragment:"boneWeights:"+c.name},{attributes:["position","normal","matricesIndices","matricesWeights"],uniforms:["world","worldView","worldViewProjection","view","projection","viewProjection","colorBase","colorZero","colorQuarter","colorHalf","colorFull","targetBoneIndex"]});return g.setColor3("colorBase",l),g.setColor3("colorZero",h),g.setColor3("colorQuarter",p),g.setColor3("colorHalf",d),g.setColor3("colorFull",_),g.setFloat("targetBoneIndex",f),g.getClassName=function(){return"BoneWeightShader"},g.transparencyMode=P.F.MATERIAL_OPAQUE,g},e.CreateSkeletonMapShader=function(t,r){var i,n=t.skeleton,s=null!==(i=t.colorMap)&&void 0!==i?i:[{color:new a.Wo(1,.38,.18),location:0},{color:new a.Wo(.59,.18,1),location:.2},{color:new a.Wo(.59,1,.18),location:.4},{color:new a.Wo(1,.87,.17),location:.6},{color:new a.Wo(1,.17,.42),location:.8},{color:new a.Wo(.17,.68,1),location:1}],o=n.bones.length+1,u=e._CreateBoneMapColorBuffer(o,s,r),c=new I.j("boneWeights:"+n.name,r,{vertexSource:"precision highp float;\n\n            attribute vec3 position;\n            attribute vec2 uv;\n\n            uniform mat4 view;\n            uniform mat4 projection;\n            uniform mat4 worldViewProjection;\n            uniform float colorMap["+4*n.bones.length+"];\n\n            #include<bonesDeclaration>\n            #if NUM_BONE_INFLUENCERS == 0\n                attribute vec4 matricesIndices;\n                attribute vec4 matricesWeights;\n            #endif\n            #include<bakedVertexAnimationDeclaration>\n            #include<instancesDeclaration>\n\n            varying vec3 vColor;\n\n            void main() {\n                vec3 positionUpdated = position;\n\n                #include<instancesVertex>\n                #include<bonesVertex>\n                #include<bakedVertexAnimation>\n\n                vec3 color = vec3(0.);\n                bool first = true;\n\n                for (int i = 0; i < 4; i++) {\n                    int boneIdx = int(matricesIndices[i]);\n                    float boneWgt = matricesWeights[i];\n\n                    vec3 c = vec3(colorMap[boneIdx * 4 + 0], colorMap[boneIdx * 4 + 1], colorMap[boneIdx * 4 + 2]);\n\n                    if (boneWgt > 0.) {\n                        if (first) {\n                            first = false;\n                            color = c;\n                        } else {\n                            color = mix(color, c, boneWgt);\n                        }\n                    }\n                }\n\n                vColor = color;\n\n                vec4 worldPos = finalWorld * vec4(positionUpdated, 1.0);\n\n                gl_Position = projection * view * worldPos;\n            }",fragmentSource:"\n            precision highp float;\n            varying vec3 vColor;\n\n            void main() {\n                vec4 color = vec4( vColor, 1.0 );\n                gl_FragColor = color;\n            }\n            "},{attributes:["position","normal","matricesIndices","matricesWeights"],uniforms:["world","worldView","worldViewProjection","view","projection","viewProjection","colorMap"]});return c.setFloats("colorMap",u),c.getClassName=function(){return"SkeletonMapShader"},c.transparencyMode=P.F.MATERIAL_OPAQUE,c},e._CreateBoneMapColorBuffer=function(e,t,r){var i=new D.c("temp",{width:e,height:1},r,!1),n=i.getContext(),s=n.createLinearGradient(0,0,e,0);t.forEach((function(e){s.addColorStop(e.location,e.color.toHexString())})),n.fillStyle=s,n.fillRect(0,0,e,1),i.update();for(var o=[],a=n.getImageData(0,0,e,1).data,u=0;u<a.length;u++)o.push(.00392156862745098*a[u]);return i.dispose(),o},Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"utilityLayer",{get:function(){return this._utilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return this._ready},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ready",{set:function(e){this._ready=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debugMesh",{get:function(){return this._debugMesh},set:function(e){this._debugMesh=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displayMode",{get:function(){return this.options.displayMode||e.DISPLAY_LINES},set:function(t){t>e.DISPLAY_SPHERE_AND_SPURS&&(t=e.DISPLAY_LINES),this.options.displayMode=t},enumerable:!1,configurable:!0}),e.prototype._bindObs=function(){var t=this;if(this.displayMode===e.DISPLAY_LINES)this._obs=this.scene.onBeforeRenderObservable.add((function(){t._displayLinesUpdate()}))},e.prototype.update=function(){switch(this.displayMode){case e.DISPLAY_LINES:this._displayLinesUpdate();break;case e.DISPLAY_SPHERES:this._buildSpheresAndSpurs(!0);break;case e.DISPLAY_SPHERE_AND_SPURS:this._buildSpheresAndSpurs(!1)}this._buildLocalAxes()},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this.isEnabled!==e&&(this._isEnabled=e,this.debugMesh&&this.debugMesh.setEnabled(e),e&&!this._obs?this._bindObs():!e&&this._obs&&(this.scene.onBeforeRenderObservable.remove(this._obs),this._obs=null))},enumerable:!1,configurable:!0}),e.prototype._getBonePosition=function(e,t,r,i,s,o){void 0===i&&(i=0),void 0===s&&(s=0),void 0===o&&(o=0);var a=n.jp.Matrix[0],u=t.getParent();if(a.copyFrom(t.getLocalMatrix()),0!==i||0!==s||0!==o){var c=n.jp.Matrix[1];n.y3.IdentityToRef(c),c.setTranslationFromFloats(i,s,o),c.multiplyToRef(a,a)}u&&a.multiplyToRef(u.getAbsoluteTransform(),a),a.multiplyToRef(r,a),e.x=a.m[12],e.y=a.m[13],e.z=a.m[14]},e.prototype._getLinesForBonesWithLength=function(e,t){for(var r=e.length,i=this.mesh.position,s=0,o=0;o<r;o++){var a=e[o],u=this._debugLines[s];-1!==a._index&&(this._boneIndices.has(a.getIndex())||this.options.useAllBones)&&(u||(u=[n.P.Zero(),n.P.Zero()],this._debugLines[s]=u),this._getBonePosition(u[0],a,t),this._getBonePosition(u[1],a,t,0,a.length,0),u[0].subtractInPlace(i),u[1].subtractInPlace(i),s++)}},e.prototype._getLinesForBonesNoLength=function(e){for(var t=e.length,r=0,i=this.mesh,s=i.position,o=t-1;o>=0;o--){var a=e[o],u=a.getParent();if(u&&(this._boneIndices.has(a.getIndex())||this.options.useAllBones)){var c=this._debugLines[r];c||(c=[n.P.Zero(),n.P.Zero()],this._debugLines[r]=c),a.getAbsolutePositionToRef(i,c[0]),u.getAbsolutePositionToRef(i,c[1]),c[0].subtractInPlace(s),c[1].subtractInPlace(s),r++}}},e.prototype._revert=function(e){this.options.pauseAnimations&&(this.scene.animationsEnabled=e,this.utilityLayer.utilityLayerScene.animationsEnabled=e)},e.prototype._getAbsoluteBindPoseToRef=function(e,t){null!==e&&-1!==e._index?(this._getAbsoluteBindPoseToRef(e.getParent(),t),e.getBaseMatrix().multiplyToRef(t,t)):t.copyFrom(n.y3.Identity())},e.prototype._buildSpheresAndSpurs=function(e){var t,r;void 0===e&&(e=!0),this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null,this.ready=!1),this._ready=!1;var i=null===(t=this.utilityLayer)||void 0===t?void 0:t.utilityLayerScene,s=this.skeleton.bones,o=[],a=[],u=this.scene.animationsEnabled;try{this.options.pauseAnimations&&(this.scene.animationsEnabled=!1,i.animationsEnabled=!1),this.options.returnToRest&&this.skeleton.returnToRest(),this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms();for(var c=Number.NEGATIVE_INFINITY,l=this.options.displayOptions||{},h=function(t){var r=s[t];if(-1===r._index||!p._boneIndices.has(r.getIndex())&&!p.options.useAllBones)return"continue";var u=new n.y3;p._getAbsoluteBindPoseToRef(r,u);var h=new n.P;u.decompose(void 0,void 0,h),r.children.forEach((function(t){var s=new n.y3;t.getBaseMatrix().multiplyToRef(u,s);var o=new n.P;s.decompose(void 0,void 0,o);var p=n.P.Distance(h,o);if(p>c&&(c=p),!e){for(var d=o.clone().subtract(h.clone()),_=d.length(),f=d.normalize().scale(_),g=l.midStep||.165,m=l.midStepFactor||.215,v=f.scale(g),T=(0,w.bC)("skeletonViewer",{shape:[new n.P(1,-1,0),new n.P(1,1,0),new n.P(-1,1,0),new n.P(-1,-1,0),new n.P(1,-1,0)],path:[n.P.Zero(),v,f],scaleFunction:function(e){switch(e){case 0:case 2:return 0;case 1:return _*m}return 0},sideOrientation:E.Kj.DEFAULTSIDE,updatable:!1},i),y=T.getTotalVertices(),b=[],x=[],S=0;S<y;S++)b.push(1,0,0,0),l.spurFollowsChild&&S>9?x.push(t.getIndex(),0,0,0):x.push(r.getIndex(),0,0,0);T.position=h.clone(),T.setVerticesData(F.o.MatricesWeightsKind,b,!1),T.setVerticesData(F.o.MatricesIndicesKind,x,!1),T.convertToFlatShadedMesh(),a.push(T)}}));for(var d=l.sphereBaseSize||.2,_=(0,T.Qk)("skeletonViewer",{segments:6,diameter:d,updatable:!0},i),f=_.getTotalVertices(),g=[],m=[],v=0;v<f;v++)g.push(1,0,0,0),m.push(r.getIndex(),0,0,0);_.setVerticesData(F.o.MatricesWeightsKind,g,!1),_.setVerticesData(F.o.MatricesIndicesKind,m,!1),_.position=h.clone(),o.push([_,r])},p=this,d=0;d<s.length;d++)h(d);var _=l.sphereScaleUnit||2,f=l.sphereFactor||.85,g=[];for(d=0;d<o.length;d++){for(var m=o[d],v=m[0],y=m[1],b=1/(_/c),x=0,S=y;S.getParent()&&-1!==S.getParent().getIndex();)x++,S=S.getParent();v.scaling.scaleInPlace(b*Math.pow(f,x)),g.push(v)}this.debugMesh=E.Kj.MergeMeshes(g.concat(a),!0,!0),this.debugMesh&&(this.debugMesh.renderingGroupId=this.renderingGroupId,this.debugMesh.skeleton=this.skeleton,this.debugMesh.parent=this.mesh,this.debugMesh.computeBonesUsingShaders=null===(r=this.options.computeBonesUsingShaders)||void 0===r||r,this.debugMesh.alwaysSelectAsActiveMesh=!0),this.utilityLayer._getSharedGizmoLight().intensity=.7,this._revert(u),this.ready=!0}catch(e){this._revert(u),this.dispose()}},e.prototype._buildLocalAxes=function(){var e;this._localAxes&&this._localAxes.dispose(),this._localAxes=null;var t=this.options.displayOptions||{};if(t.showLocalAxes){var r=this._utilityLayer.utilityLayerScene,i=t.localAxesSize||.075,s=[],o=[],u=new a.HE(1,0,0,1),c=new a.HE(0,1,0,1),l=new a.HE(0,0,1,1),h=[],p=[];for(var d in this.skeleton.bones){var _=this.skeleton.bones[d];if(-1!==_._index&&(this._boneIndices.has(_.getIndex())||this.options.useAllBones)){var f=new n.y3,g=new n.P;this._getAbsoluteBindPoseToRef(_,f),f.decompose(void 0,n.jp.Quaternion[0],g);var m=new n.y3;n.jp.Quaternion[0].toRotationMatrix(m);var E=n.P.TransformCoordinates(new n.P(0+i,0,0),m),v=n.P.TransformCoordinates(new n.P(0,0+i,0),m),T=n.P.TransformCoordinates(new n.P(0,0,0+i),m),y=[[g,g.add(E)],[g,g.add(v)],[g,g.add(T)]],b=[[u,u],[c,c],[l,l]];s.push.apply(s,y),o.push.apply(o,b);for(var x=0;x<6;x++)h.push(1,0,0,0),p.push(_.getIndex(),0,0,0)}}this._localAxes=(0,C.xW)("localAxes",{lines:s,colors:o,updatable:!0},r),this._localAxes.setVerticesData(F.o.MatricesWeightsKind,h,!1),this._localAxes.setVerticesData(F.o.MatricesIndicesKind,p,!1),this._localAxes.skeleton=this.skeleton,this._localAxes.renderingGroupId=this.renderingGroupId+1,this._localAxes.parent=this.mesh,this._localAxes.computeBonesUsingShaders=null===(e=this.options.computeBonesUsingShaders)||void 0===e||e}},e.prototype._displayLinesUpdate=function(){if(this._utilityLayer){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms(),void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones):this._getLinesForBonesWithLength(this.skeleton.bones,this.mesh.getWorldMatrix());var e=this._utilityLayer.utilityLayerScene;e&&(this._debugMesh?(0,C.xW)("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},e):(this._debugMesh=(0,C.xW)("",{lines:this._debugLines,updatable:!0,instance:null},e),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color)}},e.prototype.changeDisplayMode=function(e){var t=!!this.isEnabled;this.displayMode!==e&&(this.isEnabled=!1,this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null,this.ready=!1),this.displayMode=e,this.update(),this._bindObs(),this.isEnabled=t)},e.prototype.changeDisplayOptions=function(e,t){var r=!!this.isEnabled;this.options.displayOptions[e]=t,this.isEnabled=!1,this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null,this.ready=!1),this.update(),this._bindObs(),this.isEnabled=r},e.prototype.dispose=function(){this.isEnabled=!1,this._debugMesh&&(this._debugMesh.dispose(),this._debugMesh=null),this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null),this.ready=!1},e.DISPLAY_LINES=0,e.DISPLAY_SPHERES=1,e.DISPLAY_SPHERE_AND_SPURS=2,e}(),M=r(89209),O=r(30700),G=function(){function e(e,t){this._oldPosition=new n.P(Number.NaN,Number.NaN,Number.NaN),this._oldDirection=new n.P(Number.NaN,Number.NaN,Number.NaN),this._transparency=.3,this._showLines=!0,this._showPlanes=!0,this._scene=e.getScene(),this._light=e,this._camera=t,this._inverseViewMatrix=n.y3.Identity(),this._lightHelperFrustumMeshes=[],this._createGeometry(),this.show(),this.update()}return Object.defineProperty(e.prototype,"transparency",{get:function(){return this._transparency},set:function(e){this._transparency=e;for(var t=6;t<12;++t)this._lightHelperFrustumMeshes[t].material.alpha=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"showLines",{get:function(){return this._showLines},set:function(e){if(this._showLines!==e){this._showLines=e;for(var t=0;t<6;++t)this._lightHelperFrustumMeshes[t].setEnabled(e)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"showPlanes",{get:function(){return this._showPlanes},set:function(e){if(this._showPlanes!==e){this._showPlanes=e;for(var t=6;t<12;++t)this._lightHelperFrustumMeshes[t].setEnabled(e)}},enumerable:!1,configurable:!0}),e.prototype.show=function(){var e=this;this._lightHelperFrustumMeshes.forEach((function(t,r){t.setEnabled(r<6&&e._showLines||r>=6&&e._showPlanes)})),this._oldPosition.set(Number.NaN,Number.NaN,Number.NaN),this._visible=!0},e.prototype.hide=function(){this._lightHelperFrustumMeshes.forEach((function(e){e.setEnabled(!1)})),this._visible=!1},e.prototype.update=function(){var e,t,r,i,s,o;if(this._visible&&(!this._oldPosition.equals(this._light.position)||!this._oldDirection.equals(this._light.direction)||this._oldAutoCalc!==this._light.autoCalcShadowZBounds||this._oldMinZ!==this._light.shadowMinZ||this._oldMaxZ!==this._light.shadowMaxZ)){this._oldPosition.copyFrom(this._light.position),this._oldDirection.copyFrom(this._light.direction),this._oldAutoCalc=this._light.autoCalcShadowZBounds,this._oldMinZ=this._light.shadowMinZ,this._oldMaxZ=this._light.shadowMaxZ,n.jp.Vector3[0].set(this._light.orthoLeft,this._light.orthoBottom,void 0!==this._light.shadowMinZ?this._light.shadowMinZ:this._camera.minZ),n.jp.Vector3[1].set(this._light.orthoRight,this._light.orthoTop,void 0!==this._light.shadowMaxZ?this._light.shadowMaxZ:this._camera.maxZ);var a=this._getInvertViewMatrix();n.jp.Vector3[2].copyFromFloats(n.jp.Vector3[1].x,n.jp.Vector3[1].y,n.jp.Vector3[0].z),n.jp.Vector3[3].copyFromFloats(n.jp.Vector3[1].x,n.jp.Vector3[0].y,n.jp.Vector3[0].z),n.jp.Vector3[4].copyFromFloats(n.jp.Vector3[0].x,n.jp.Vector3[0].y,n.jp.Vector3[0].z),n.jp.Vector3[5].copyFromFloats(n.jp.Vector3[0].x,n.jp.Vector3[1].y,n.jp.Vector3[0].z),n.P.TransformCoordinatesToRef(n.jp.Vector3[2],a,n.jp.Vector3[2]),n.P.TransformCoordinatesToRef(n.jp.Vector3[3],a,n.jp.Vector3[3]),n.P.TransformCoordinatesToRef(n.jp.Vector3[4],a,n.jp.Vector3[4]),n.P.TransformCoordinatesToRef(n.jp.Vector3[5],a,n.jp.Vector3[5]),n.jp.Vector3[6].copyFromFloats(n.jp.Vector3[1].x,n.jp.Vector3[1].y,n.jp.Vector3[1].z),n.jp.Vector3[7].copyFromFloats(n.jp.Vector3[1].x,n.jp.Vector3[0].y,n.jp.Vector3[1].z),n.jp.Vector3[8].copyFromFloats(n.jp.Vector3[0].x,n.jp.Vector3[0].y,n.jp.Vector3[1].z),n.jp.Vector3[9].copyFromFloats(n.jp.Vector3[0].x,n.jp.Vector3[1].y,n.jp.Vector3[1].z),n.P.TransformCoordinatesToRef(n.jp.Vector3[6],a,n.jp.Vector3[6]),n.P.TransformCoordinatesToRef(n.jp.Vector3[7],a,n.jp.Vector3[7]),n.P.TransformCoordinatesToRef(n.jp.Vector3[8],a,n.jp.Vector3[8]),n.P.TransformCoordinatesToRef(n.jp.Vector3[9],a,n.jp.Vector3[9]),(0,C.nL)("nearlines",{updatable:!0,points:this._nearLinesPoints,instance:this._lightHelperFrustumMeshes[0]},this._scene),(0,C.nL)("farlines",{updatable:!0,points:this._farLinesPoints,instance:this._lightHelperFrustumMeshes[1]},this._scene),(0,C.nL)("trlines",{updatable:!0,points:this._trLinesPoints,instance:this._lightHelperFrustumMeshes[2]},this._scene),(0,C.nL)("brlines",{updatable:!0,points:this._brLinesPoints,instance:this._lightHelperFrustumMeshes[3]},this._scene),(0,C.nL)("tllines",{updatable:!0,points:this._tlLinesPoints,instance:this._lightHelperFrustumMeshes[4]},this._scene),(0,C.nL)("bllines",{updatable:!0,points:this._blLinesPoints,instance:this._lightHelperFrustumMeshes[5]},this._scene),n.jp.Vector3[2].toArray(this._nearPlaneVertices,0),n.jp.Vector3[3].toArray(this._nearPlaneVertices,3),n.jp.Vector3[4].toArray(this._nearPlaneVertices,6),n.jp.Vector3[5].toArray(this._nearPlaneVertices,9),null===(e=this._lightHelperFrustumMeshes[6].geometry)||void 0===e||e.updateVerticesDataDirectly("position",this._nearPlaneVertices,0),n.jp.Vector3[6].toArray(this._farPlaneVertices,0),n.jp.Vector3[7].toArray(this._farPlaneVertices,3),n.jp.Vector3[8].toArray(this._farPlaneVertices,6),n.jp.Vector3[9].toArray(this._farPlaneVertices,9),null===(t=this._lightHelperFrustumMeshes[7].geometry)||void 0===t||t.updateVerticesDataDirectly("position",this._farPlaneVertices,0),n.jp.Vector3[2].toArray(this._rightPlaneVertices,0),n.jp.Vector3[6].toArray(this._rightPlaneVertices,3),n.jp.Vector3[7].toArray(this._rightPlaneVertices,6),n.jp.Vector3[3].toArray(this._rightPlaneVertices,9),null===(r=this._lightHelperFrustumMeshes[8].geometry)||void 0===r||r.updateVerticesDataDirectly("position",this._rightPlaneVertices,0),n.jp.Vector3[5].toArray(this._leftPlaneVertices,0),n.jp.Vector3[9].toArray(this._leftPlaneVertices,3),n.jp.Vector3[8].toArray(this._leftPlaneVertices,6),n.jp.Vector3[4].toArray(this._leftPlaneVertices,9),null===(i=this._lightHelperFrustumMeshes[9].geometry)||void 0===i||i.updateVerticesDataDirectly("position",this._leftPlaneVertices,0),n.jp.Vector3[2].toArray(this._topPlaneVertices,0),n.jp.Vector3[6].toArray(this._topPlaneVertices,3),n.jp.Vector3[9].toArray(this._topPlaneVertices,6),n.jp.Vector3[5].toArray(this._topPlaneVertices,9),null===(s=this._lightHelperFrustumMeshes[10].geometry)||void 0===s||s.updateVerticesDataDirectly("position",this._topPlaneVertices,0),n.jp.Vector3[3].toArray(this._bottomPlaneVertices,0),n.jp.Vector3[7].toArray(this._bottomPlaneVertices,3),n.jp.Vector3[8].toArray(this._bottomPlaneVertices,6),n.jp.Vector3[4].toArray(this._bottomPlaneVertices,9),null===(o=this._lightHelperFrustumMeshes[11].geometry)||void 0===o||o.updateVerticesDataDirectly("position",this._bottomPlaneVertices,0)}},e.prototype.dispose=function(){this._lightHelperFrustumMeshes.forEach((function(e){var t;null===(t=e.material)||void 0===t||t.dispose(),e.dispose()})),this._rootNode.dispose()},e.prototype._createGeometry=function(){var e=this;this._rootNode=new O.Y("directionalLightHelperRoot_"+this._light.name,this._scene),this._rootNode.parent=this._light.parent,this._nearLinesPoints=[n.P.ZeroReadOnly,n.P.ZeroReadOnly,n.P.ZeroReadOnly,n.P.ZeroReadOnly,n.P.ZeroReadOnly];var t=(0,C.nL)("nearlines",{updatable:!0,points:this._nearLinesPoints},this._scene);t.parent=this._rootNode,t.alwaysSelectAsActiveMesh=!0,this._farLinesPoints=[n.P.ZeroReadOnly,n.P.ZeroReadOnly,n.P.ZeroReadOnly,n.P.ZeroReadOnly,n.P.ZeroReadOnly];var r=(0,C.nL)("farlines",{updatable:!0,points:this._farLinesPoints},this._scene);r.parent=this._rootNode,r.alwaysSelectAsActiveMesh=!0,this._trLinesPoints=[n.P.ZeroReadOnly,n.P.ZeroReadOnly];var i=(0,C.nL)("trlines",{updatable:!0,points:this._trLinesPoints},this._scene);i.parent=this._rootNode,i.alwaysSelectAsActiveMesh=!0,this._brLinesPoints=[n.P.ZeroReadOnly,n.P.ZeroReadOnly];var o=(0,C.nL)("brlines",{updatable:!0,points:this._brLinesPoints},this._scene);o.parent=this._rootNode,o.alwaysSelectAsActiveMesh=!0,this._tlLinesPoints=[n.P.ZeroReadOnly,n.P.ZeroReadOnly];var u=(0,C.nL)("tllines",{updatable:!0,points:this._tlLinesPoints},this._scene);u.parent=this._rootNode,u.alwaysSelectAsActiveMesh=!0,this._blLinesPoints=[n.P.ZeroReadOnly,n.P.ZeroReadOnly];var c=(0,C.nL)("bllines",{updatable:!0,points:this._blLinesPoints},this._scene);c.parent=this._rootNode,c.alwaysSelectAsActiveMesh=!0,this._lightHelperFrustumMeshes.push(t,r,i,o,u,c);var l=function(t,r,i){var n=new E.Kj(t+"plane",e._scene),o=new s.K(t+"PlaneMat",e._scene);n.material=o,n.parent=e._rootNode,n.alwaysSelectAsActiveMesh=!0,o.emissiveColor=r,o.alpha=e.transparency,o.backFaceCulling=!1,o.disableLighting=!0;var a=new M.x;a.positions=i,a.indices=[0,1,2,0,2,3],a.applyToMesh(n,!0),e._lightHelperFrustumMeshes.push(n)};this._nearPlaneVertices=[0,0,0,0,0,0,0,0,0,0,0,0],this._farPlaneVertices=[0,0,0,0,0,0,0,0,0,0,0,0],this._rightPlaneVertices=[0,0,0,0,0,0,0,0,0,0,0,0],this._leftPlaneVertices=[0,0,0,0,0,0,0,0,0,0,0,0],this._topPlaneVertices=[0,0,0,0,0,0,0,0,0,0,0,0],this._bottomPlaneVertices=[0,0,0,0,0,0,0,0,0,0,0,0],l("near",new a.Wo(1,0,0),this._nearPlaneVertices),l("far",new a.Wo(.3,0,0),this._farPlaneVertices),l("right",new a.Wo(0,1,0),this._rightPlaneVertices),l("left",new a.Wo(0,.3,0),this._leftPlaneVertices),l("top",new a.Wo(0,0,1),this._topPlaneVertices),l("bottom",new a.Wo(0,0,.3),this._bottomPlaneVertices),this._nearLinesPoints[0]=n.jp.Vector3[2],this._nearLinesPoints[1]=n.jp.Vector3[3],this._nearLinesPoints[2]=n.jp.Vector3[4],this._nearLinesPoints[3]=n.jp.Vector3[5],this._nearLinesPoints[4]=n.jp.Vector3[2],this._farLinesPoints[0]=n.jp.Vector3[6],this._farLinesPoints[1]=n.jp.Vector3[7],this._farLinesPoints[2]=n.jp.Vector3[8],this._farLinesPoints[3]=n.jp.Vector3[9],this._farLinesPoints[4]=n.jp.Vector3[6],this._trLinesPoints[0]=n.jp.Vector3[2],this._trLinesPoints[1]=n.jp.Vector3[6],this._brLinesPoints[0]=n.jp.Vector3[3],this._brLinesPoints[1]=n.jp.Vector3[7],this._tlLinesPoints[0]=n.jp.Vector3[4],this._tlLinesPoints[1]=n.jp.Vector3[8],this._blLinesPoints[0]=n.jp.Vector3[5],this._blLinesPoints[1]=n.jp.Vector3[9]},e.prototype._getInvertViewMatrix=function(){return n.y3.LookAtLHToRef(this._light.position,this._light.position.add(this._light.direction),n.P.UpReadOnly,this._inverseViewMatrix),this._inverseViewMatrix.invertToRef(this._inverseViewMatrix),this._inverseViewMatrix},e}()},33097:(e,t,r)=>{var i,n,s,o,a,u,c;r.d(t,{$i:()=>u,D_:()=>c,FP:()=>s,Fz:()=>n,V7:()=>o,Yi:()=>i,s2:()=>a}),function(e){e[e.Generic=0]="Generic",e[e.Keyboard=1]="Keyboard",e[e.Mouse=2]="Mouse",e[e.Touch=3]="Touch",e[e.DualShock=4]="DualShock",e[e.Xbox=5]="Xbox",e[e.Switch=6]="Switch",e[e.DualSense=7]="DualSense"}(i||(i={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.Move=12]="Move"}(n||(n={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.DeltaHorizontal=10]="DeltaHorizontal",e[e.DeltaVertical=11]="DeltaVertical"}(s||(s={})),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Share=8]="Share",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(o||(o={})),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Create=8]="Create",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(a||(a={})),function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LB=4]="LB",e[e.RB=5]="RB",e[e.LT=6]="LT",e[e.RT=7]="RT",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.LStickXAxis=17]="LStickXAxis",e[e.LStickYAxis=18]="LStickYAxis",e[e.RStickXAxis=19]="RStickXAxis",e[e.RStickYAxis=20]="RStickYAxis"}(u||(u={})),function(e){e[e.B=0]="B",e[e.A=1]="A",e[e.Y=2]="Y",e[e.X=3]="X",e[e.L=4]="L",e[e.R=5]="R",e[e.ZL=6]="ZL",e[e.ZR=7]="ZR",e[e.Minus=8]="Minus",e[e.Plus=9]="Plus",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.Capture=17]="Capture",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(c||(c={}))},76503:(e,t,r)=>{r.d(t,{p:()=>n});var i=r(62897),n=function(){function e(e,t,r){void 0===r&&(r=0),this.deviceType=t,this.deviceSlot=r,this.onInputChangedObservable=new i.y$,this._deviceInputSystem=e}return e.prototype.getInput=function(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)},e}()},38784:(e,t,r)=>{r.d(t,{U:()=>_});var i=r(33097),n=r(62897),s=r(49671),o=function(){function e(){}return e.CreateDeviceEvent=function(e,t,r,n,s,o){switch(e){case i.Yi.Keyboard:return this._CreateKeyboardEvent(r,n,s,o);case i.Yi.Mouse:if(r===i.Fz.MouseWheelX||r===i.Fz.MouseWheelY||r===i.Fz.MouseWheelZ)return this._CreateWheelEvent(e,t,r,n,s,o);case i.Yi.Touch:return this._CreatePointerEvent(e,t,r,n,s,o);default:throw"Unable to generate event for device ".concat(i.Yi[e])}},e._CreatePointerEvent=function(e,t,r,n,s,o){var a=this._CreateMouseEvent(e,t,r,n,s,o);return e===i.Yi.Mouse?(a.deviceType=i.Yi.Mouse,a.pointerId=1,a.pointerType="mouse"):(a.deviceType=i.Yi.Touch,a.pointerId=t,a.pointerType="touch"),r===i.Fz.Move?a.type="pointermove":r>=i.Fz.LeftClick&&r<=i.Fz.RightClick&&(a.type=1===n?"pointerdown":"pointerup",a.button=r-2),a},e._CreateWheelEvent=function(e,t,r,n,o,a){var u=this._CreateMouseEvent(e,t,r,n,o,a);switch(u.type="wheel",u.deltaMode=s.G.DOM_DELTA_PIXEL,u.deltaX=0,u.deltaY=0,u.deltaZ=0,r){case i.Fz.MouseWheelX:u.deltaX=n;break;case i.Fz.MouseWheelY:u.deltaY=n;break;case i.Fz.MouseWheelZ:u.deltaZ=n}return u},e._CreateMouseEvent=function(e,t,r,n,s,o){var a=this._CreateEvent(o),u=s.pollInput(e,t,i.Fz.Horizontal),c=s.pollInput(e,t,i.Fz.Vertical);return o?(a.movementX=0,a.movementY=0,a.offsetX=a.movementX-o.getBoundingClientRect().x,a.offsetY=a.movementY-o.getBoundingClientRect().y):(a.movementX=s.pollInput(e,t,i.FP.DeltaHorizontal),a.movementY=s.pollInput(e,t,i.FP.DeltaVertical),a.offsetX=0,a.offsetY=0),this._CheckNonCharacterKeys(a,s),a.clientX=u,a.clientY=c,a.x=u,a.y=c,a.deviceType=e,a.deviceSlot=t,a.inputIndex=r,a},e._CreateKeyboardEvent=function(e,t,r,n){var s=this._CreateEvent(n);return this._CheckNonCharacterKeys(s,r),s.deviceType=i.Yi.Keyboard,s.deviceSlot=0,s.inputIndex=e,s.type=1===t?"keydown":"keyup",s.key=String.fromCharCode(e),s.keyCode=e,s},e._CheckNonCharacterKeys=function(e,t){var r=t.isDeviceAvailable(i.Yi.Keyboard),n=r&&1===t.pollInput(i.Yi.Keyboard,0,18),s=r&&1===t.pollInput(i.Yi.Keyboard,0,17),o=r&&(1===t.pollInput(i.Yi.Keyboard,0,91)||1===t.pollInput(i.Yi.Keyboard,0,92)||1===t.pollInput(i.Yi.Keyboard,0,93)),a=r&&1===t.pollInput(i.Yi.Keyboard,0,16);e.altKey=n,e.ctrlKey=s,e.metaKey=o,e.shiftKey=a},e._CreateEvent=function(e){var t={preventDefault:function(){}};return t.target=e,t},e}(),a=function(){function e(e,t,r){var i=this;this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(e,t,(function(e,t,n,s){var a=o.CreateDeviceEvent(e,t,n,s,i);r(e,t,a)})):this._createDummyNativeInput()}return e.prototype.pollInput=function(e,t,r){return this._nativeInput.pollInput(e,t,r)},e.prototype.isDeviceAvailable=function(e){return e===i.Yi.Mouse||e===i.Yi.Touch},e.prototype.dispose=function(){this._nativeInput.dispose()},e.prototype._createDummyNativeInput=function(){return{pollInput:function(){return 0},isDeviceAvailable:function(){return!1},dispose:function(){}}},e}(),u=r(80352),c=r(13514),l=Object.keys(i.Fz).length/2,h=function(){function e(e,t,r,i){var n=this;this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=c.w1.IsSafari(),this._keyboardDownEvent=function(e){},this._keyboardUpEvent=function(e){},this._keyboardBlurEvent=function(e){},this._pointerMoveEvent=function(e){},this._pointerDownEvent=function(e){},this._pointerUpEvent=function(e){},this._pointerCancelEvent=function(e){},this._pointerWheelEvent=function(e){},this._pointerBlurEvent=function(e){},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=u.MZ.IsNavigatorAvailable()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=function(e){},this._gamepadDisconnectedEvent=function(e){},this._eventPrefix=c.w1.GetPointerPrefix(e),this._engine=e,this._onDeviceConnected=t,this._onDeviceDisconnected=r,this._onInputChanged=i,this._enableEvents(),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=function(){n._enableEvents()})}return e.prototype.pollInput=function(e,t,r){var n=this._inputs[e][t];if(!n)throw"Unable to find device ".concat(i.Yi[e]);e>=i.Yi.DualShock&&e<=i.Yi.DualSense&&navigator.getGamepads&&this._updateDevice(e,t,r);var s=n[r];if(void 0===s)throw"Unable to find input ".concat(r," for device ").concat(i.Yi[e]," in slot ").concat(t);return r===i.Fz.Move&&c.w1.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),s},e.prototype.isDeviceAvailable=function(e){return void 0!==this._inputs[e]},e.prototype.dispose=function(){this._onDeviceConnected=function(){},this._onDeviceDisconnected=function(){},this._onInputChanged=function(){},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()},e.prototype._enableEvents=function(){var e=null==this?void 0:this._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs)for(var t=0,r=this._inputs;t<r.length;t++){var i=r[t];if(i)for(var n in i){var s=i[+n];if(s)for(var o=0;o<s.length;o++)s[o]=0}}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}},e.prototype._disableEvents=function(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1},e.prototype._checkForConnectedDevices=function(){if(navigator.getGamepads)for(var e=0,t=navigator.getGamepads();e<t.length;e++){var r=t[e];r&&this._addGamePad(r)}"function"==typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(i.Yi.Mouse,0,0,0)},e.prototype._addGamePad=function(e){var t=this._getGamepadDeviceType(e.id),r=e.index;this._gamepads=this._gamepads||new Array(e.index+1),this._registerDevice(t,r,e.buttons.length+e.axes.length),this._gamepads[r]=t},e.prototype._addPointerDevice=function(e,t,r,i){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,l);var n=this._inputs[e][t];n[0]=r,n[1]=i},e.prototype._registerDevice=function(e,t,r){if(void 0===t)throw"Unable to register device ".concat(i.Yi[e]," to undefined slot.");if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){for(var n=new Array(r),s=0;s<r;s++)n[s]=0;this._inputs[e][t]=n,this._onDeviceConnected(e,t)}},e.prototype._unregisterDevice=function(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))},e.prototype._handleKeyActions=function(){var e=this;this._keyboardDownEvent=function(t){e._keyboardActive||(e._keyboardActive=!0,e._registerDevice(i.Yi.Keyboard,0,255));var r=e._inputs[i.Yi.Keyboard][0];if(r){r[t.keyCode]=1;var n=t;n.inputIndex=t.keyCode,e._onInputChanged(i.Yi.Keyboard,0,n)}},this._keyboardUpEvent=function(t){e._keyboardActive||(e._keyboardActive=!0,e._registerDevice(i.Yi.Keyboard,0,255));var r=e._inputs[i.Yi.Keyboard][0];if(r){r[t.keyCode]=0;var n=t;n.inputIndex=t.keyCode,e._onInputChanged(i.Yi.Keyboard,0,n)}},this._keyboardBlurEvent=function(){if(e._keyboardActive)for(var t=e._inputs[i.Yi.Keyboard][0],r=0;r<t.length;r++)if(0!==t[r]){t[r]=0;var n=o.CreateDeviceEvent(i.Yi.Keyboard,0,r,0,e,e._elementToAttachTo);e._onInputChanged(i.Yi.Keyboard,0,n)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)},e.prototype._handlePointerActions=function(){var e=this;this._maxTouchPoints=u.MZ.IsNavigatorAvailable()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(var t=0;t<this._maxTouchPoints;t++)this._activeTouchIds[t]=-1;this._pointerMoveEvent=function(t){var r=e._getPointerType(t),n=r===i.Yi.Mouse?0:e._activeTouchIds.indexOf(t.pointerId);e._inputs[r]||(e._inputs[r]={}),e._inputs[r][n]||e._addPointerDevice(r,n,t.clientX,t.clientY);var s=e._inputs[r][n];if(s){s[i.Fz.Horizontal]=t.clientX,s[i.Fz.Vertical]=t.clientY;var o=t;o.inputIndex=i.Fz.Move,e._onInputChanged(r,n,o),e._usingSafari||-1===t.button||(o.inputIndex=t.button+2,s[t.button+2]=s[t.button+2]?0:1,e._onInputChanged(r,n,o))}},this._pointerDownEvent=function(t){var r=e._getPointerType(t),n=r===i.Yi.Mouse?0:t.pointerId;if(r===i.Yi.Touch){var s=e._activeTouchIds.indexOf(-1);if(!(s>=0))return void c.w1.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(e._maxTouchPoints));n=s,e._activeTouchIds[s]=t.pointerId}e._inputs[r]||(e._inputs[r]={}),e._inputs[r][n]?r===i.Yi.Touch&&e._onDeviceConnected(r,n):e._addPointerDevice(r,n,t.clientX,t.clientY);var o=e._inputs[r][n];if(o){var a=o[i.Fz.Horizontal],u=o[i.Fz.Vertical];if(r===i.Yi.Mouse){if(-1===e._mouseId&&(void 0===t.pointerId?e._mouseId=e._isUsingFirefox?0:1:e._mouseId=t.pointerId),!document.pointerLockElement&&e._elementToAttachTo.hasPointerCapture)try{e._elementToAttachTo.setPointerCapture(e._mouseId)}catch(e){}}else if(t.pointerId&&!document.pointerLockElement&&e._elementToAttachTo.hasPointerCapture)try{e._elementToAttachTo.setPointerCapture(t.pointerId)}catch(e){}o[i.Fz.Horizontal]=t.clientX,o[i.Fz.Vertical]=t.clientY,o[t.button+2]=1;var l=t;l.inputIndex=t.button+2,e._onInputChanged(r,n,l),a===t.clientX&&u===t.clientY||(l.inputIndex=i.Fz.Move,e._onInputChanged(r,n,l))}},this._pointerUpEvent=function(t){var r,n,s,o,a,u=e._getPointerType(t),c=u===i.Yi.Mouse?0:e._activeTouchIds.indexOf(t.pointerId);if(u===i.Yi.Touch){if(-1===c)return;e._activeTouchIds[c]=-1}var l=null===(r=e._inputs[u])||void 0===r?void 0:r[c];if(l&&0!==l[t.button+2]){var h=l[i.Fz.Horizontal],p=l[i.Fz.Vertical];l[i.Fz.Horizontal]=t.clientX,l[i.Fz.Vertical]=t.clientY,l[t.button+2]=0;var d=t;h===t.clientX&&p===t.clientY||(d.inputIndex=i.Fz.Move,e._onInputChanged(u,c,d)),d.inputIndex=t.button+2,u===i.Yi.Mouse&&e._mouseId>=0&&(null===(s=(n=e._elementToAttachTo).hasPointerCapture)||void 0===s?void 0:s.call(n,e._mouseId))?e._elementToAttachTo.releasePointerCapture(e._mouseId):t.pointerId&&(null===(a=(o=e._elementToAttachTo).hasPointerCapture)||void 0===a?void 0:a.call(o,t.pointerId))&&e._elementToAttachTo.releasePointerCapture(t.pointerId),e._onInputChanged(u,c,d),u===i.Yi.Touch&&e._onDeviceDisconnected(u,c)}},this._pointerCancelEvent=function(t){var r,n,s,a;if("mouse"===t.pointerType){var u=e._inputs[i.Yi.Mouse][0];e._mouseId>=0&&(null===(n=(r=e._elementToAttachTo).hasPointerCapture)||void 0===n?void 0:n.call(r,e._mouseId))&&e._elementToAttachTo.releasePointerCapture(e._mouseId);for(var c=i.Fz.LeftClick;c<=i.Fz.BrowserForward;c++)if(1===u[c]){u[c]=0;var l=o.CreateDeviceEvent(i.Yi.Mouse,0,c,0,e,e._elementToAttachTo);e._onInputChanged(i.Yi.Mouse,0,l)}}else{var h=e._activeTouchIds.indexOf(t.pointerId);(null===(a=(s=e._elementToAttachTo).hasPointerCapture)||void 0===a?void 0:a.call(s,t.pointerId))&&e._elementToAttachTo.releasePointerCapture(t.pointerId),e._inputs[i.Yi.Touch][h][i.Fz.LeftClick]=0;l=o.CreateDeviceEvent(i.Yi.Touch,h,i.Fz.LeftClick,0,e,e._elementToAttachTo);e._onInputChanged(i.Yi.Touch,h,l),e._activeTouchIds[h]=-1,e._onDeviceDisconnected(i.Yi.Touch,h)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";var r=!1,n=function(){};try{var s={passive:{get:function(){r=!0}}};this._elementToAttachTo.addEventListener("test",n,s),this._elementToAttachTo.removeEventListener("test",n,s)}catch(e){}this._pointerBlurEvent=function(){var t,r,n,s,a;if(e.isDeviceAvailable(i.Yi.Mouse)){var u=e._inputs[i.Yi.Mouse][0];e._mouseId>=0&&(null===(r=(t=e._elementToAttachTo).hasPointerCapture)||void 0===r?void 0:r.call(t,e._mouseId))&&e._elementToAttachTo.releasePointerCapture(e._mouseId);for(var c=i.Fz.LeftClick;c<=i.Fz.BrowserForward;c++)if(1===u[c]){u[c]=0;var l=o.CreateDeviceEvent(i.Yi.Mouse,0,c,0,e,e._elementToAttachTo);e._onInputChanged(i.Yi.Mouse,0,l)}}if(e.isDeviceAvailable(i.Yi.Touch)){u=e._inputs[i.Yi.Touch];for(var h=0;h<e._activeTouchIds.length;h++){var p=e._activeTouchIds[h];if((null===(s=(n=e._elementToAttachTo).hasPointerCapture)||void 0===s?void 0:s.call(n,p))&&e._elementToAttachTo.releasePointerCapture(p),-1!==p&&1===(null===(a=u[h])||void 0===a?void 0:a[i.Fz.LeftClick])){u[h][i.Fz.LeftClick]=0;l=o.CreateDeviceEvent(i.Yi.Touch,h,i.Fz.LeftClick,0,e,e._elementToAttachTo);e._onInputChanged(i.Yi.Touch,h,l),e._activeTouchIds[h]=-1,e._onDeviceDisconnected(i.Yi.Touch,h)}}}},this._pointerWheelEvent=function(t){var r=i.Yi.Mouse;e._inputs[r]||(e._inputs[r]=[]),e._inputs[r][0]||(e._pointerActive=!0,e._registerDevice(r,0,l));var n=e._inputs[r][0];if(n){n[i.Fz.MouseWheelX]=t.deltaX||0,n[i.Fz.MouseWheelY]=t.deltaY||t.wheelDelta||0,n[i.Fz.MouseWheelZ]=t.deltaZ||0;var s=t;0!==n[i.Fz.MouseWheelX]&&(s.inputIndex=i.Fz.MouseWheelX,e._onInputChanged(r,0,s)),0!==n[i.Fz.MouseWheelY]&&(s.inputIndex=i.Fz.MouseWheelY,e._onInputChanged(r,0,s)),0!==n[i.Fz.MouseWheelZ]&&(s.inputIndex=i.Fz.MouseWheelZ,e._onInputChanged(r,0,s))}},this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!r&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((function(){if(e.isDeviceAvailable(i.Yi.Mouse)){var t=e._inputs[i.Yi.Mouse][0];t[i.Fz.MouseWheelX]=0,t[i.Fz.MouseWheelY]=0,t[i.Fz.MouseWheelZ]=0}}))},e.prototype._handleGamepadActions=function(){var e=this;this._gamepadConnectedEvent=function(t){e._addGamePad(t.gamepad)},this._gamepadDisconnectedEvent=function(t){if(e._gamepads){var r=e._getGamepadDeviceType(t.gamepad.id),i=t.gamepad.index;e._unregisterDevice(r,i),delete e._gamepads[i]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},e.prototype._updateDevice=function(e,t,r){var i=navigator.getGamepads()[t];if(i&&e===this._gamepads[t]){var n=this._inputs[e][t];r>=i.buttons.length?n[r]=i.axes[r-i.buttons.length].valueOf():n[r]=i.buttons[r].value}},e.prototype._getGamepadDeviceType=function(e){return-1!==e.indexOf("054c")?-1!==e.indexOf("0ce6")?i.Yi.DualSense:i.Yi.DualShock:-1!==e.indexOf("Xbox One")||-1!==e.search("Xbox 360")||-1!==e.search("xinput")?i.Yi.Xbox:-1!==e.indexOf("057e")?i.Yi.Switch:i.Yi.Generic},e.prototype._getPointerType=function(e){var t=i.Yi.Mouse;return("touch"===e.pointerType||"pen"===e.pointerType||e.touches)&&(t=i.Yi.Touch),t},e}(),p=r(76503),d=function(){function e(e){var t=this;this._registeredManagers=new Array,this._refCount=0,this.registerManager=function(e){for(var r=0;r<t._devices.length;r++){var i=t._devices[r];for(var n in i){var s=+n;e._addDevice(new p.p(t._deviceInputSystem,r,s))}}t._registeredManagers.push(e)},this.unregisterManager=function(e){var r=t._registeredManagers.indexOf(e);r>-1&&t._registeredManagers.splice(r,1)};var r=Object.keys(i.Yi).length/2;this._devices=new Array(r);var n=function(e,r){t._devices[e]||(t._devices[e]=new Array),t._devices[e][r]||(t._devices[e][r]=r);for(var i=0,n=t._registeredManagers;i<n.length;i++){var s=n[i],o=new p.p(t._deviceInputSystem,e,r);s._addDevice(o)}},s=function(e,r){var i;(null===(i=t._devices[e])||void 0===i?void 0:i[r])&&delete t._devices[e][r];for(var n=0,s=t._registeredManagers;n<s.length;n++){s[n]._removeDevice(e,r)}},o=function(e,r,i){if(i)for(var n=0,s=t._registeredManagers;n<s.length;n++){s[n]._onInputChanged(e,r,i)}};"undefined"!=typeof _native?this._deviceInputSystem=new a(n,s,o):this._deviceInputSystem=new h(e,n,s,o)}return e.prototype.dispose=function(){this._deviceInputSystem.dispose()},e}(),_=function(){function e(e){var t=this,r=Object.keys(i.Yi).length/2;this._devices=new Array(r),this._firstDevice=new Array(r),this._engine=e,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new d(e)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new n.y$((function(e){for(var r=0,i=t._devices;r<i.length;r++){var n=i[r];if(n)for(var s=0,o=n;s<o.length;s++){var a=o[s];a&&t.onDeviceConnectedObservable.notifyObserver(e,a)}}})),this.onDeviceDisconnectedObservable=new n.y$,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=e.onDisposeObservable.add((function(){t.dispose()}))}return e.prototype.getDeviceSource=function(e,t){if(void 0===t){if(void 0===this._firstDevice[e])return null;t=this._firstDevice[e]}return this._devices[e]&&void 0!==this._devices[e][t]?this._devices[e][t]:null},e.prototype.getDeviceSources=function(e){return this._devices[e].filter((function(e){return!!e}))},e.prototype.dispose=function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)},e.prototype._addDevice=function(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=new Array),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)},e.prototype._removeDevice=function(e,t){var r,i,n=null===(r=this._devices[e])||void 0===r?void 0:r[t];this.onDeviceDisconnectedObservable.notifyObservers(n),(null===(i=this._devices[e])||void 0===i?void 0:i[t])&&delete this._devices[e][t],this._updateFirstDevices(e)},e.prototype._onInputChanged=function(e,t,r){var i,n;null===(n=null===(i=this._devices[e])||void 0===i?void 0:i[t])||void 0===n||n.onInputChangedObservable.notifyObservers(r)},e.prototype._updateFirstDevices=function(e){switch(e){case i.Yi.Keyboard:case i.Yi.Mouse:this._firstDevice[e]=0;break;case i.Yi.Touch:case i.Yi.DualSense:case i.Yi.DualShock:case i.Yi.Xbox:case i.Yi.Switch:case i.Yi.Generic:delete this._firstDevice[e];var t=this._devices[e];if(t)for(var r=0;r<t.length;r++)if(t[r]){this._firstDevice[e]=r;break}}},e}()},5185:(e,t,r)=>{r.d(t,{pJ:()=>n.p,Uq:()=>s.U,Yi:()=>i.Yi,s2:()=>i.s2,V7:()=>i.V7,FP:()=>i.FP,Fz:()=>i.Fz,D_:()=>i.D_,$i:()=>i.$i});var i=r(33097),n=r(76503),s=r(38784)},21352:(e,t,r)=>{var i=r(61159);i.B.prototype.setAlphaConstants=function(e,t,r,i){this._alphaState.setAlphaBlendConstants(e,t,r,i)},i.B.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}},i.B.prototype.getAlphaMode=function(){return this._alphaMode},i.B.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=e}},i.B.prototype.getAlphaEquation=function(){return this._alphaEquation}},34435:(e,t,r)=>{r.d(t,{t:()=>i});var i,n=r(61159);!function(e){e[e.Texture=0]="Texture",e[e.StorageTexture=1]="StorageTexture",e[e.UniformBuffer=2]="UniformBuffer",e[e.StorageBuffer=3]="StorageBuffer",e[e.TextureWithoutSampler=4]="TextureWithoutSampler",e[e.Sampler=5]="Sampler"}(i||(i={})),n.B.prototype.createComputeEffect=function(e,t){throw new Error("createComputeEffect: This engine does not support compute shaders!")},n.B.prototype.createComputePipelineContext=function(){throw new Error("createComputePipelineContext: This engine does not support compute shaders!")},n.B.prototype.createComputeContext=function(){},n.B.prototype.computeDispatch=function(e,t,r,i,n,s,o){throw new Error("computeDispatch: This engine does not support compute shaders!")},n.B.prototype.areAllComputeEffectsReady=function(){return!0},n.B.prototype.releaseComputeEffects=function(){},n.B.prototype._prepareComputePipelineContext=function(e,t,r,i,n){},n.B.prototype._rebuildComputeEffects=function(){},n.B.prototype._executeWhenComputeStateIsCompiled=function(e,t){t()},n.B.prototype._releaseComputeEffect=function(e){},n.B.prototype._deleteComputePipelineContext=function(e){}},90052:(e,t,r)=>{var i=r(31191),n=r(61159),s=r(7949),o=r(84318),a=r(79245),u=r(54007);n.B.prototype._createDepthStencilCubeTexture=function(e,t,r){var n=new s.l(this,s.S.DepthStencil);if(n.isCube=!0,1===this.webGLVersion)return o.Y.Error("Depth cube texture is not supported by WebGL 1."),n;var a=(0,i.pi)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t),u=this._gl;this._bindTextureDirectly(u.TEXTURE_CUBE_MAP,n,!0),this._setupDepthStencilTexture(n,e,a.generateStencil,a.bilinearFiltering,a.comparisonFunction),r._depthStencilTexture=n,r._depthStencilTextureWithStencil=a.generateStencil;for(var c=0;c<6;c++)a.generateStencil?u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,u.DEPTH24_STENCIL8,e,e,0,u.DEPTH_STENCIL,u.UNSIGNED_INT_24_8,null):u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,u.DEPTH_COMPONENT24,e,e,0,u.DEPTH_COMPONENT,u.UNSIGNED_INT,null);return this._bindTextureDirectly(u.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(n),n},n.B.prototype._partialLoadFile=function(e,t,r,i,n){void 0===n&&(n=null);this._loadFile(e,(function(e){r[t]=e,r._internalCount++,6===r._internalCount&&i(r)}),void 0,void 0,!0,(function(e,t){n&&e&&n(e.status+" "+e.statusText,t)}))},n.B.prototype._cascadeLoadFiles=function(e,t,r,i){void 0===i&&(i=null);var n=[];n._internalCount=0;for(var s=0;s<6;s++)this._partialLoadFile(r[s],s,n,t,i)},n.B.prototype._cascadeLoadImgs=function(e,t,r,i,n,s){void 0===n&&(n=null);var o=[];o._internalCount=0;for(var a=0;a<6;a++)this._partialLoadImg(i[a],a,o,e,t,r,n,s)},n.B.prototype._partialLoadImg=function(e,t,r,i,n,s,o,c){void 0===o&&(o=null);var l=(0,u.f)();(0,a.r6)(e,(function(e){r[t]=e,r._internalCount++,i&&i._removePendingData(l),6===r._internalCount&&s&&s(n,r)}),(function(e,t){i&&i._removePendingData(l),o&&o(e,t)}),i?i.offlineProvider:null,c),i&&i._addPendingData(l)},n.B.prototype._setCubeMapTextureParams=function(e,t,r){var i=this._gl;i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,t?i.LINEAR_MIPMAP_LINEAR:i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),e.samplingMode=t?3:2,t&&this.getCaps().textureMaxLevel&&void 0!==r&&r>0&&(i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_LEVEL,r),e._maxLodLevel=r),this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null)},n.B.prototype.createCubeTextureBase=function(e,t,r,i,a,u,c,l,h,p,d,_,f,g,m){var E=this;void 0===a&&(a=null),void 0===u&&(u=null),void 0===l&&(l=null),void 0===h&&(h=!1),void 0===p&&(p=0),void 0===d&&(d=0),void 0===_&&(_=null),void 0===f&&(f=null),void 0===g&&(g=null),void 0===m&&(m=!1);var v=_||new s.l(this,s.S.Cube);v.isCube=!0,v.url=e,v.generateMipMaps=!i,v._lodGenerationScale=p,v._lodGenerationOffset=d,v._useSRGBBuffer=!!m&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||!!i),this._doNotHandleContextLost||(v._extension=l,v._files=r);var T=e;this._transformTextureUrl&&!_&&(e=this._transformTextureUrl(e));for(var y=e.lastIndexOf("."),b=l||(y>-1?e.substring(y).toLowerCase():""),x=null,S=0,R=n.B._TextureLoaders;S<R.length;S++){var A=R[S];if(A.canLoad(b)){x=A;break}}if(x){var C=function(e){f&&f(v,e),x.loadCubeData(e,v,h,a,u)};r&&6===r.length?x.supportCascades?this._cascadeLoadFiles(t,(function(e){return C(e.map((function(e){return new Uint8Array(e)})))}),r,u):u?u("Textures type does not support cascades."):o.Y.Warn("Texture loader does not support cascades."):this._loadFile(e,(function(e){return C(new Uint8Array(e))}),void 0,void 0,!0,(function(n,s){e===T?u&&n&&u(n.status+" "+n.statusText,s):(o.Y.Warn("Failed to load ".concat(e,", falling back to the ").concat(T)),E.createCubeTextureBase(T,t,r,!!i,a,u,c,l,h,p,d,v,f,g,m))}))}else{if(!r)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(t,v,(function(e,t){g&&g(e,t)}),r,u)}return this._internalTexturesCache.push(v),v},n.B.prototype.createCubeTexture=function(e,t,r,i,s,a,u,c,l,h,p,d,_,f){var g=this;void 0===s&&(s=null),void 0===a&&(a=null),void 0===c&&(c=null),void 0===l&&(l=!1),void 0===h&&(h=0),void 0===p&&(p=0),void 0===d&&(d=null),void 0===f&&(f=!1);var m=this._gl;return this.createCubeTextureBase(e,t,r,!!i,s,a,u,c,l,h,p,d,(function(e){return g._bindTextureDirectly(m.TEXTURE_CUBE_MAP,e,!0)}),(function(e,t){var r=g.needPOTTextures?n.B.GetExponentOfTwo(t[0].width,g._caps.maxCubemapTextureSize):t[0].width,a=r,c=[m.TEXTURE_CUBE_MAP_POSITIVE_X,m.TEXTURE_CUBE_MAP_POSITIVE_Y,m.TEXTURE_CUBE_MAP_POSITIVE_Z,m.TEXTURE_CUBE_MAP_NEGATIVE_X,m.TEXTURE_CUBE_MAP_NEGATIVE_Y,m.TEXTURE_CUBE_MAP_NEGATIVE_Z];g._bindTextureDirectly(m.TEXTURE_CUBE_MAP,e,!0),g._unpackFlipY(!1);var l=u?g._getInternalFormat(u,e._useSRGBBuffer):e._useSRGBBuffer?m.SRGB8_ALPHA8:m.RGBA,h=u?g._getInternalFormat(u):m.RGBA;e._useSRGBBuffer&&1===g.webGLVersion&&(h=l);for(var p=0;p<c.length;p++)if(t[p].width!==r||t[p].height!==a){if(g._prepareWorkingCanvas(),!g._workingCanvas||!g._workingContext)return void o.Y.Warn("Cannot create canvas to resize texture.");g._workingCanvas.width=r,g._workingCanvas.height=a,g._workingContext.drawImage(t[p],0,0,t[p].width,t[p].height,0,0,r,a),m.texImage2D(c[p],0,l,h,m.UNSIGNED_BYTE,g._workingCanvas)}else m.texImage2D(c[p],0,l,h,m.UNSIGNED_BYTE,t[p]);i||m.generateMipmap(m.TEXTURE_CUBE_MAP),g._setCubeMapTextureParams(e,!i),e.width=r,e.height=a,e.isReady=!0,u&&(e.format=u),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),s&&s()}),!!f)}},89553:(e,t,r)=>{var i=r(61159);i.B.prototype.updateDynamicIndexBuffer=function(e,t,r){var i;void 0===r&&(r=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),i=e.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},i.B.prototype.updateDynamicVertexBuffer=function(e,t,r,i){this.bindArrayBuffer(e),void 0===r&&(r=0);var n=t.byteLength||t.length;void 0===i||i>=n&&0===r?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(r,r+i)):(t=t instanceof ArrayBuffer?new Uint8Array(t,r,i):new Uint8Array(t.buffer,t.byteOffset+r,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()}},25008:(e,t,r)=>{var i=r(61159),n=r(7949);i.B.prototype.createDynamicTexture=function(e,t,r,s){var o=new n.l(this,n.S.Dynamic);return o.baseWidth=e,o.baseHeight=t,r&&(e=this.needPOTTextures?i.B.GetExponentOfTwo(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?i.B.GetExponentOfTwo(t,this._caps.maxTextureSize):t),o.width=e,o.height=t,o.isReady=!1,o.generateMipMaps=r,o.samplingMode=s,this.updateTextureSamplingMode(s,o),this._internalTexturesCache.push(o),o},i.B.prototype.updateDynamicTexture=function(e,t,r,i,n,s,o){if(void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),e){var a=this._gl,u=a.TEXTURE_2D,c=this._bindTextureDirectly(u,e,!0,s);this._unpackFlipY(void 0===r?e.invertY:r),i&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var l=this._getWebGLTextureType(e.type),h=this._getInternalFormat(n||e.format),p=this._getRGBABufferInternalSizedFormat(e.type,h);a.texImage2D(u,0,p,h,l,t),e.generateMipMaps&&a.generateMipmap(u),c||this._bindTextureDirectly(u,null),i&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.isReady=!0}}},17770:(e,t,r)=>{var i=r(7949),n=r(84318),s=r(61159);s.B.prototype.restoreSingleAttachment=function(){var e=this._gl;this.bindAttachments([e.BACK])},s.B.prototype.restoreSingleAttachmentForRenderTarget=function(){var e=this._gl;this.bindAttachments([e.COLOR_ATTACHMENT0])},s.B.prototype.buildTextureLayout=function(e){for(var t=this._gl,r=[],i=0;i<e.length;i++)e[i]?r.push(t["COLOR_ATTACHMENT"+i]):r.push(t.NONE);return r},s.B.prototype.bindAttachments=function(e){this._gl.drawBuffers(e)},s.B.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null;var i=this._gl,n=e._attachments,s=n.length;if(e._MSAAFramebuffer){i.bindFramebuffer(i.READ_FRAMEBUFFER,e._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e._framebuffer);for(var o=0;o<s;o++){for(var a=e.textures[o],u=0;u<s;u++)n[u]=i.NONE;n[o]=i[this.webGLVersion>1?"COLOR_ATTACHMENT"+o:"COLOR_ATTACHMENT"+o+"_WEBGL"],i.readBuffer(n[o]),i.drawBuffers(n),i.blitFramebuffer(0,0,a.width,a.height,0,0,a.width,a.height,i.COLOR_BUFFER_BIT,i.NEAREST)}for(o=0;o<s;o++)n[o]=i[this.webGLVersion>1?"COLOR_ATTACHMENT"+o:"COLOR_ATTACHMENT"+o+"_WEBGL"];i.drawBuffers(n)}for(o=0;o<s;o++){!(a=e.textures[o]).generateMipMaps||t||a.isCube||(this._bindTextureDirectly(i.TEXTURE_2D,a,!0),i.generateMipmap(i.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null))}r&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),r()),this._bindUnboundFramebuffer(null)},s.B.prototype.createMultipleRenderTarget=function(e,t,r){void 0===r&&(r=!0);var s=!1,o=!0,a=!1,u=!1,c=15,l=1,h=new Array,p=new Array,d=new Array,_=this._createHardwareRenderTargetWrapper(!0,!1,e);void 0!==t&&(s=void 0!==t.generateMipMaps&&t.generateMipMaps,o=void 0===t.generateDepthBuffer||t.generateDepthBuffer,a=void 0!==t.generateStencilBuffer&&t.generateStencilBuffer,u=void 0!==t.generateDepthTexture&&t.generateDepthTexture,l=t.textureCount||1,t.types&&(h=t.types),t.samplingModes&&(p=t.samplingModes),t.useSRGBBuffers&&(d=t.useSRGBBuffers),this.webGLVersion>1&&(13===t.depthTextureFormat||16===t.depthTextureFormat||14===t.depthTextureFormat)&&(c=t.depthTextureFormat));var f=this._gl,g=f.createFramebuffer();this._bindUnboundFramebuffer(g);var m=e.width||e,E=e.height||e,v=[],T=[],y=this.webGLVersion>1&&u&&13===t.depthTextureFormat,b=this._setupFramebufferDepthAttachments(!y&&a,!u&&o,m,E);_._framebuffer=g,_._depthStencilBuffer=b,_._generateDepthBuffer=!u&&o,_._generateStencilBuffer=!y&&a,_._attachments=T;for(var x=0;x<l;x++){var S=p[x]||3,R=h[x]||0,A=d[x]||false;(1!==R||this._caps.textureFloatLinearFiltering)&&(2!==R||this._caps.textureHalfFloatLinearFiltering)||(S=1);var C=this._getSamplingParameters(S,s);1!==R||this._caps.textureFloat||(R=0,n.Y.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),A=A&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU);var B=new i.l(this,i.S.MultiRenderTarget),P=f[this.webGLVersion>1?"COLOR_ATTACHMENT"+x:"COLOR_ATTACHMENT"+x+"_WEBGL"];v.push(B),T.push(P),f.activeTexture(f["TEXTURE"+x]),f.bindTexture(f.TEXTURE_2D,B._hardwareTexture.underlyingResource),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,C.mag),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,C.min),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);var I=this._getRGBABufferInternalSizedFormat(R,5,A);f.texImage2D(f.TEXTURE_2D,0,I,m,E,0,f.RGBA,this._getWebGLTextureType(R),null),f.framebufferTexture2D(f.DRAW_FRAMEBUFFER,P,f.TEXTURE_2D,B._hardwareTexture.underlyingResource,0),s&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(f.TEXTURE_2D,null),B.baseWidth=m,B.baseHeight=E,B.width=m,B.height=E,B.isReady=!0,B.samples=1,B.generateMipMaps=s,B.samplingMode=S,B.type=R,B._useSRGBBuffer=A,this._internalTexturesCache.push(B)}if(u&&this._caps.depthTextureExtension){var D=new i.l(this,i.S.Depth),F=5,U=f.DEPTH_COMPONENT16,w=f.DEPTH_COMPONENT,L=f.UNSIGNED_SHORT,M=f.DEPTH_ATTACHMENT;this.webGLVersion<2?U=f.DEPTH_COMPONENT:14===c?(F=1,L=f.FLOAT,U=f.DEPTH_COMPONENT32F):16===c?(F=0,L=f.UNSIGNED_INT,U=f.DEPTH_COMPONENT24,M=f.DEPTH_ATTACHMENT):13===c&&(F=12,L=f.UNSIGNED_INT_24_8,U=f.DEPTH24_STENCIL8,w=f.DEPTH_STENCIL,M=f.DEPTH_STENCIL_ATTACHMENT),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,D._hardwareTexture.underlyingResource),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texImage2D(f.TEXTURE_2D,0,U,m,E,0,w,L,null),f.framebufferTexture2D(f.FRAMEBUFFER,M,f.TEXTURE_2D,D._hardwareTexture.underlyingResource,0),D.baseWidth=m,D.baseHeight=E,D.width=m,D.height=E,D.isReady=!0,D.samples=1,D.generateMipMaps=s,D.samplingMode=1,D.format=c,D.type=F,v.push(D),this._internalTexturesCache.push(D)}return _.setTextures(v),r&&f.drawBuffers(T),this._bindUnboundFramebuffer(null),this.resetTextureCache(),_},s.B.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t,r){if(void 0===r&&(r=!0),this.webGLVersion<2||!e||!e.texture)return 1;if(e.samples===t)return t;var i=e._attachments.length;if(0===i)return 1;var n=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(n.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(n.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null);for(var s=0;s<i;s++){(null==(c=e.textures[s]._hardwareTexture)?void 0:c._MSAARenderBuffer)&&(n.deleteRenderbuffer(c._MSAARenderBuffer),c._MSAARenderBuffer=null)}if(t>1&&n.renderbufferStorageMultisample){var o=n.createFramebuffer();if(!o)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=o,this._bindUnboundFramebuffer(o);var a=[];for(s=0;s<i;s++){var u=e.textures[s],c=u._hardwareTexture,l=n[this.webGLVersion>1?"COLOR_ATTACHMENT"+s:"COLOR_ATTACHMENT"+s+"_WEBGL"],h=this._createRenderBuffer(u.width,u.height,t,-1,this._getRGBAMultiSampleBufferFormat(u.type),l);if(!h)throw new Error("Unable to create multi sampled framebuffer");c._MSAARenderBuffer=h,u.samples=t,a.push(l)}r&&n.drawBuffers(a)}else this._bindUnboundFramebuffer(e._framebuffer);return e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.texture.width,e.texture.height,t),this._bindUnboundFramebuffer(null),t}},74649:(e,t,r)=>{var i=r(2055),n=r(37290),s=r(65273),o=r(7949),a=r(58095),u=r(83353),c=r(19363),l=r(84319);function h(e,t){var r=new u.M(e,void 0,!0,t);return r.addUniform("viewProjection",16),r.addUniform("viewProjectionR",16),r.addUniform("view",16),r.addUniform("projection",16),r.addUniform("vEyePosition",4),r}n.D.prototype.createMultiviewRenderTargetTexture=function(e,t){var r=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";var i=this._createHardwareRenderTargetWrapper(!1,!1,{width:e,height:t});i._framebuffer=r.createFramebuffer();var n=new o.l(this,o.S.Unknown,!0);return n.width=e,n.height=t,n.isMultiview=!0,i._colorTextureArray=r.createTexture(),r.bindTexture(r.TEXTURE_2D_ARRAY,i._colorTextureArray),r.texStorage3D(r.TEXTURE_2D_ARRAY,1,r.RGBA8,e,t,2),i._depthStencilTextureArray=r.createTexture(),r.bindTexture(r.TEXTURE_2D_ARRAY,i._depthStencilTextureArray),r.texStorage3D(r.TEXTURE_2D_ARRAY,1,r.DEPTH24_STENCIL8,e,t,2),n.isReady=!0,i.setTextures(n),i._depthStencilTexture=n,i},n.D.prototype.bindMultiviewFramebuffer=function(e){var t=e,r=this._gl,i=this.getCaps().oculusMultiview||this.getCaps().multiview;if(this.bindFramebuffer(t,void 0,void 0,void 0,!0),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,t._framebuffer),!t._colorTextureArray||!t._depthStencilTextureArray)throw"Invalid multiview frame buffer";this.getCaps().oculusMultiview?(i.framebufferTextureMultisampleMultiviewOVR(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,t._colorTextureArray,0,t.samples,0,2),i.framebufferTextureMultisampleMultiviewOVR(r.DRAW_FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,t._depthStencilTextureArray,0,t.samples,0,2)):(i.framebufferTextureMultiviewOVR(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,t._colorTextureArray,0,0,2),i.framebufferTextureMultiviewOVR(r.DRAW_FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,t._depthStencilTextureArray,0,0,2))},i.V.prototype._useMultiviewToSingleView=!1,i.V.prototype._multiviewTexture=null,i.V.prototype._resizeOrCreateMultiviewTexture=function(e,t){this._multiviewTexture?this._multiviewTexture.getRenderWidth()==e&&this._multiviewTexture.getRenderHeight()==t||(this._multiviewTexture.dispose(),this._multiviewTexture=new c.x(this.getScene(),{width:e,height:t})):this._multiviewTexture=new c.x(this.getScene(),{width:e,height:t})};var p=s.x.prototype.createSceneUniformBuffer;s.x.prototype._transformMatrixR=a.y3.Zero(),s.x.prototype._multiviewSceneUbo=null,s.x.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=h(this.getEngine(),"scene_multiview")},s.x.prototype.createSceneUniformBuffer=function(e){return this._multiviewSceneUbo?h(this.getEngine(),e):p.bind(this)(e)},s.x.prototype._updateMultiviewUbo=function(e,t){e&&t&&e.multiplyToRef(t,this._transformMatrixR),e&&t&&(e.multiplyToRef(t,a.jp.Matrix[0]),l.i.GetRightPlaneToRef(a.jp.Matrix[0],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.updateMatrix("projection",this._projectionMatrix))},s.x.prototype._renderMultiviewToSingleView=function(e){e._resizeOrCreateMultiviewTexture(e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.width>0?e._rigPostProcess.width:this.getEngine().getRenderWidth(!0),e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.height>0?e._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),e.outputRenderTarget=e._multiviewTexture,this._renderForCamera(e),e.outputRenderTarget=null;for(var t=0;t<e._rigCameras.length;t++){var r=this.getEngine();this._activeCamera=e._rigCameras[t],r.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}}},51392:(e,t,r)=>{var i=r(7949),n=r(84318),s=r(13514),o=r(61159);function a(e,t,r,i){var n,s=1;1===i?n=new Float32Array(t*r*4):2===i?(n=new Uint16Array(t*r*4),s=15360):n=7===i?new Uint32Array(t*r*4):new Uint8Array(t*r*4);for(var o=0;o<t;o++)for(var a=0;a<r;a++){var u=3*(a*t+o),c=4*(a*t+o);n[c+0]=e[u+0],n[c+1]=e[u+1],n[c+2]=e[u+2],n[c+3]=s}return n}function u(e){return function(t,r,n,s,o,a,u,c,l,h){void 0===l&&(l=null),void 0===h&&(h=0);var p=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,d=e?i.S.Raw3D:i.S.Raw2DArray,_=new i.l(this,d);_.baseWidth=r,_.baseHeight=n,_.baseDepth=s,_.width=r,_.height=n,_.depth=s,_.format=o,_.type=h,_.generateMipMaps=a,_.samplingMode=c,e?_.is3D=!0:_.is2DArray=!0,this._doNotHandleContextLost||(_._bufferView=t),e?this.updateRawTexture3D(_,t,o,u,l,h):this.updateRawTexture2DArray(_,t,o,u,l,h),this._bindTextureDirectly(p,_,!0);var f=this._getSamplingParameters(c,a);return this._gl.texParameteri(p,this._gl.TEXTURE_MAG_FILTER,f.mag),this._gl.texParameteri(p,this._gl.TEXTURE_MIN_FILTER,f.min),a&&this._gl.generateMipmap(p),this._bindTextureDirectly(p,null),this._internalTexturesCache.push(_),_}}function c(e){return function(t,r,i,n,s,o){void 0===s&&(s=null),void 0===o&&(o=0);var a=e?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,u=this._getWebGLTextureType(o),c=this._getInternalFormat(i),l=this._getRGBABufferInternalSizedFormat(o,i);this._bindTextureDirectly(a,t,!0),this._unpackFlipY(void 0===n||!!n),this._doNotHandleContextLost||(t._bufferView=r,t.format=i,t.invertY=n,t._compression=s),t.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),s&&r?this._gl.compressedTexImage3D(a,0,this.getCaps().s3tc[s],t.width,t.height,t.depth,0,r):this._gl.texImage3D(a,0,l,t.width,t.height,t.depth,0,c,u,r),t.generateMipMaps&&this._gl.generateMipmap(a),this._bindTextureDirectly(a,null),t.isReady=!0}}o.B.prototype.updateRawTexture=function(e,t,r,i,n,s,o){if(void 0===n&&(n=null),void 0===s&&(s=0),void 0===o&&(o=!1),e){var a=this._getRGBABufferInternalSizedFormat(s,r,o),u=this._getInternalFormat(r),c=this._getWebGLTextureType(s);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===i||!!i),this._doNotHandleContextLost||(e._bufferView=t,e.format=r,e.type=s,e.invertY=i,e._compression=n),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),n&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[n],e.width,e.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,e.width,e.height,0,u,c,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}},o.B.prototype.createRawTexture=function(e,t,r,n,s,o,a,u,c,l,h){void 0===u&&(u=null),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=!1);var p=new i.l(this,i.S.Raw);p.baseWidth=t,p.baseHeight=r,p.width=t,p.height=r,p.format=n,p.generateMipMaps=s,p.samplingMode=a,p.invertY=o,p._compression=u,p.type=c,p._useSRGBBuffer=this._getUseSRGBBuffer(h,!s),this._doNotHandleContextLost||(p._bufferView=e),this.updateRawTexture(p,e,n,o,u,c,p._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,p,!0);var d=this._getSamplingParameters(a,s);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,d.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,d.min),s&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(p),p},o.B.prototype.createRawCubeTexture=function(e,t,r,o,a,u,c,l){void 0===l&&(l=null);var h=this._gl,p=new i.l(this,i.S.CubeRaw);p.isCube=!0,p.format=r,p.type=o,this._doNotHandleContextLost||(p._bufferViewArray=e);var d=this._getWebGLTextureType(o),_=this._getInternalFormat(r);_===h.RGB&&(_=h.RGBA),d!==h.FLOAT||this._caps.textureFloatLinearFiltering?d!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?d!==h.FLOAT||this._caps.textureFloatRender?d!==h.HALF_FLOAT||this._caps.colorBufferFloat||(a=!1,n.Y.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(a=!1,n.Y.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(a=!1,c=1,n.Y.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(a=!1,c=1,n.Y.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var f=t,g=f;p.width=f,p.height=g,!this.needPOTTextures||s.w1.IsExponentOfTwo(p.width)&&s.w1.IsExponentOfTwo(p.height)||(a=!1),e&&this.updateRawCubeTexture(p,e,r,o,u,l),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,p,!0),e&&a&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var m=this._getSamplingParameters(c,a);return h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,m.mag),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,m.min),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null),p.generateMipMaps=a,p.samplingMode=c,p},o.B.prototype.updateRawCubeTexture=function(e,t,r,i,n,o,u){void 0===o&&(o=null),void 0===u&&(u=0),e._bufferViewArray=t,e.format=r,e.type=i,e.invertY=n,e._compression=o;var c=this._gl,l=this._getWebGLTextureType(i),h=this._getInternalFormat(r),p=this._getRGBABufferInternalSizedFormat(i),d=!1;h===c.RGB&&(h=c.RGBA,d=!0),this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===n||!!n),e.width%4!=0&&c.pixelStorei(c.UNPACK_ALIGNMENT,1);for(var _=0;_<6;_++){var f=t[_];o?c.compressedTexImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_,u,this.getCaps().s3tc[o],e.width,e.height,0,f):(d&&(f=a(f,e.width,e.height,i)),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+_,u,p,e.width,e.height,0,h,l,f))}(!this.needPOTTextures||s.w1.IsExponentOfTwo(e.width)&&s.w1.IsExponentOfTwo(e.height))&&e.generateMipMaps&&0===u&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},o.B.prototype.createRawCubeTextureFromUrl=function(e,t,r,i,n,s,o,u,c,l,h,p){var d=this;void 0===c&&(c=null),void 0===l&&(l=null),void 0===h&&(h=3),void 0===p&&(p=!1);var _=this._gl,f=this.createRawCubeTexture(null,r,i,n,!s,p,h,null);null==t||t._addPendingData(f),f.url=e,this._internalTexturesCache.push(f);return this._loadFile(e,(function(e){!function(e){var r=f.width,s=o(e);if(s){if(u){var l=d._getWebGLTextureType(n),h=d._getInternalFormat(i),g=d._getRGBABufferInternalSizedFormat(n),m=!1;h===_.RGB&&(h=_.RGBA,m=!0),d._bindTextureDirectly(_.TEXTURE_CUBE_MAP,f,!0),d._unpackFlipY(!1);for(var E=u(s),v=0;v<E.length;v++)for(var T=r>>v,y=0;y<6;y++){var b=E[v][y];m&&(b=a(b,T,T,n)),_.texImage2D(y,v,g,T,T,0,h,l,b)}d._bindTextureDirectly(_.TEXTURE_CUBE_MAP,null)}else d.updateRawCubeTexture(f,s,i,n,p);f.isReady=!0,null==t||t._removePendingData(f),f.onLoadedObservable.notifyObservers(f),f.onLoadedObservable.clear(),c&&c()}}(e)}),void 0,null==t?void 0:t.offlineProvider,!0,(function(e,r){null==t||t._removePendingData(f),l&&e&&l(e.status+" "+e.statusText,r)})),f},o.B.prototype.createRawTexture2DArray=u(!1),o.B.prototype.createRawTexture3D=u(!0),o.B.prototype.updateRawTexture2DArray=c(!1),o.B.prototype.updateRawTexture3D=c(!0)},5382:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(61159);function n(e,t,r,i){switch(void 0===r&&(r=!1),e){case 3:var n=(ArrayBuffer,new Int8Array(t));return i&&n.set(new Int8Array(i)),n;case 0:var s=(ArrayBuffer,new Uint8Array(t));return i&&s.set(new Uint8Array(i)),s;case 4:var o=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(r?t/2:t);return i&&o.set(new Int16Array(i)),o;case 5:case 8:case 9:case 10:case 2:var a=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(r?t/2:t);return i&&a.set(new Uint16Array(i)),a;case 6:var u=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(r?t/4:t);return i&&u.set(new Int32Array(i)),u;case 7:case 11:case 12:case 13:case 14:case 15:var c=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(r?t/4:t);return i&&c.set(new Uint32Array(i)),c;case 1:var l=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(r?t/4:t);return i&&l.set(new Float32Array(i)),l}var h=(ArrayBuffer,new Uint8Array(t));return i&&h.set(new Uint8Array(i)),h}i.B.prototype._readTexturePixelsSync=function(e,t,r,i,s,o,a,u,c,l){var h,p;void 0===i&&(i=-1),void 0===s&&(s=0),void 0===o&&(o=null),void 0===a&&(a=!0),void 0===u&&(u=!1),void 0===c&&(c=0),void 0===l&&(l=0);var d=this._gl;if(!d)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var _=d.createFramebuffer();if(!_)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=_}d.bindFramebuffer(d.FRAMEBUFFER,this._dummyFramebuffer),i>-1?d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+i,null===(h=e._hardwareTexture)||void 0===h?void 0:h.underlyingResource,s):d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,null===(p=e._hardwareTexture)||void 0===p?void 0:p.underlyingResource,s);var f=void 0!==e.type?this._getWebGLTextureType(e.type):d.UNSIGNED_BYTE;if(u)o||(o=n(e.type,4*t*r));else if(f===d.UNSIGNED_BYTE)o||(o=new Uint8Array(4*t*r)),f=d.UNSIGNED_BYTE;else o||(o=new Float32Array(4*t*r)),f=d.FLOAT;return a&&this.flushFramebuffer(),d.readPixels(c,l,t,r,d.RGBA,f,o),d.bindFramebuffer(d.FRAMEBUFFER,this._currentFramebuffer),o},i.B.prototype._readTexturePixels=function(e,t,r,i,n,s,o,a,u,c){return void 0===i&&(i=-1),void 0===n&&(n=0),void 0===s&&(s=null),void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===u&&(u=0),void 0===c&&(c=0),Promise.resolve(this._readTexturePixelsSync(e,t,r,i,n,s,o,a,u,c))}},13534:(e,t,r)=>{var i=r(31191),n=r(7949),s=r(84318),o=r(61159),a=function(e){function t(t,r,i,n,s){var o=e.call(this,t,r,i,n)||this;return o._framebuffer=null,o._depthStencilBuffer=null,o._MSAAFramebuffer=null,o._colorTextureArray=null,o._depthStencilTextureArray=null,o._context=s,o}return(0,i.ZT)(t,e),t.prototype._cloneRenderTargetWrapper=function(){var t=null;return this._colorTextureArray&&this._depthStencilTextureArray?(t=this._engine.createMultiviewRenderTargetTexture(this.width,this.height)).texture.isReady=!0:t=e.prototype._cloneRenderTargetWrapper.call(this),t},t.prototype._swapRenderTargetWrapper=function(t){e.prototype._swapRenderTargetWrapper.call(this,t),t._framebuffer=this._framebuffer,t._depthStencilBuffer=this._depthStencilBuffer,t._MSAAFramebuffer=this._MSAAFramebuffer,t._colorTextureArray=this._colorTextureArray,t._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null},t.prototype._shareDepth=function(t){e.prototype._shareDepth.call(this,t);var r=this._context,i=this._depthStencilBuffer,n=t._framebuffer;t._depthStencilBuffer&&r.deleteRenderbuffer(t._depthStencilBuffer),t._depthStencilBuffer=this._depthStencilBuffer,this._engine._bindUnboundFramebuffer(n),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,i),this._engine._bindUnboundFramebuffer(null)},t.prototype._bindTextureRenderTarget=function(e,t,r,i){if(void 0===t&&(t=0),void 0===r&&(r=-1),void 0===i&&(i=0),e._hardwareTexture){var n=this._context,s=this._framebuffer,o=this._engine._currentFramebuffer;this._engine._bindUnboundFramebuffer(s);var a=n[this._engine.webGLVersion>1?"COLOR_ATTACHMENT"+t:"COLOR_ATTACHMENT"+t+"_WEBGL"],u=-1!==r?n.TEXTURE_CUBE_MAP_POSITIVE_X+r:n.TEXTURE_2D;n.framebufferTexture2D(n.FRAMEBUFFER,a,u,e._hardwareTexture.underlyingResource,i),this._engine._bindUnboundFramebuffer(o)}},t.prototype.setTexture=function(t,r,i){void 0===r&&(r=0),void 0===i&&(i=!0),e.prototype.setTexture.call(this,t,r,i),this._bindTextureRenderTarget(t,r)},t.prototype.dispose=function(t){void 0===t&&(t=!1);var r=this._context;t||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(r.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(r.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(r.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),e.prototype.dispose.call(this,t)},t}(r(73005).r);o.B.prototype._createHardwareRenderTargetWrapper=function(e,t,r){var i=new a(e,t,r,this,this._gl);return this._renderTargetWrapperCache.push(i),i},o.B.prototype.createRenderTargetTexture=function(e,t){var r=this._createHardwareRenderTargetWrapper(!1,!1,e),i={};void 0!==t&&"object"==typeof t?(i.generateDepthBuffer=!!t.generateDepthBuffer,i.generateStencilBuffer=!!t.generateStencilBuffer,i.noColorTarget=!!t.noColorTarget):(i.generateDepthBuffer=!0,i.generateStencilBuffer=!1,i.noColorTarget=!1);var s=i.noColorTarget?null:this._createInternalTexture(e,t,!0,n.S.RenderTarget),o=e.width||e,a=e.height||e,u=this._currentFramebuffer,c=this._gl,l=c.createFramebuffer();return this._bindUnboundFramebuffer(l),r._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!i.generateStencilBuffer,i.generateDepthBuffer,o,a),s&&!s.is2DArray&&c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,s._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(u),r._framebuffer=l,r._generateDepthBuffer=i.generateDepthBuffer,r._generateStencilBuffer=!!i.generateStencilBuffer,r.setTextures(s),r},o.B.prototype.createDepthStencilTexture=function(e,t,r){if(t.isCube){var i=e.width||e;return this._createDepthStencilCubeTexture(i,t,r)}return this._createDepthStencilTexture(e,t,r)},o.B.prototype._createDepthStencilTexture=function(e,t,r){var o=this._gl,a=e.layers||0,u=0!==a?o.TEXTURE_2D_ARRAY:o.TEXTURE_2D,c=new n.l(this,n.S.DepthStencil);if(!this._caps.depthTextureExtension)return s.Y.Error("Depth texture is not supported by your browser or hardware."),c;var l=(0,i.pi)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t);this._bindTextureDirectly(u,c,!0),this._setupDepthStencilTexture(c,e,l.generateStencil,0!==l.comparisonFunction&&l.bilinearFiltering,l.comparisonFunction),c.format=l.generateStencil?13:16,r._depthStencilTexture=c,r._depthStencilTextureWithStencil=l.generateStencil;var h=l.generateStencil?o.UNSIGNED_INT_24_8:o.UNSIGNED_INT,p=l.generateStencil?o.DEPTH_STENCIL:o.DEPTH_COMPONENT,d=p;return this.webGLVersion>1&&(d=l.generateStencil?o.DEPTH24_STENCIL8:o.DEPTH_COMPONENT24),c.is2DArray?o.texImage3D(u,0,d,c.width,c.height,a,0,p,h,null):o.texImage2D(u,0,d,c.width,c.height,0,p,h,null),this._bindTextureDirectly(u,null),this._internalTexturesCache.push(c),c},o.B.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e||!e.texture)return 1;if(e.samples===t)return t;var r=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(r.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(r.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null);var i=e.texture._hardwareTexture;if(i._MSAARenderBuffer&&(r.deleteRenderbuffer(i._MSAARenderBuffer),i._MSAARenderBuffer=null),t>1&&r.renderbufferStorageMultisample){var n=r.createFramebuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=n,this._bindUnboundFramebuffer(e._MSAAFramebuffer);var s=this._createRenderBuffer(e.texture.width,e.texture.height,t,-1,this._getRGBAMultiSampleBufferFormat(e.texture.type),r.COLOR_ATTACHMENT0,!1);if(!s)throw new Error("Unable to create multi sampled framebuffer");i._MSAARenderBuffer=s}else this._bindUnboundFramebuffer(e._framebuffer);return e.texture.samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.texture.width,e.texture.height,t),this._bindUnboundFramebuffer(null),t}},74500:(e,t,r)=>{var i=r(31191),n=r(7949),s=r(84318);r(61159).B.prototype.createRenderTargetCubeTexture=function(e,t){var r=this._createHardwareRenderTargetWrapper(!1,!0,e),o=(0,i.pi)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5},t);o.generateStencilBuffer=o.generateDepthBuffer&&o.generateStencilBuffer,(1!==o.type||this._caps.textureFloatLinearFiltering)&&(2!==o.type||this._caps.textureHalfFloatLinearFiltering)||(o.samplingMode=1);var a=this._gl,u=new n.l(this,n.S.RenderTarget);this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,u,!0);var c=this._getSamplingParameters(o.samplingMode,o.generateMipMaps);1!==o.type||this._caps.textureFloat||(o.type=0,s.Y.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,c.mag),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,c.min),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);for(var l=0;l<6;l++)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,this._getRGBABufferInternalSizedFormat(o.type,o.format),e,e,0,this._getInternalFormat(o.format),this._getWebGLTextureType(o.type),null);var h=a.createFramebuffer();return this._bindUnboundFramebuffer(h),r._depthStencilBuffer=this._setupFramebufferDepthAttachments(o.generateStencilBuffer,o.generateDepthBuffer,e,e),o.generateMipMaps&&a.generateMipmap(a.TEXTURE_CUBE_MAP),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),r._framebuffer=h,r._generateDepthBuffer=o.generateDepthBuffer,r._generateStencilBuffer=o.generateStencilBuffer,u.width=e,u.height=e,u.isReady=!0,u.isCube=!0,u.samples=1,u.generateMipMaps=o.generateMipMaps,u.samplingMode=o.samplingMode,u.type=o.type,u.format=o.format,this._internalTexturesCache.push(u),r.setTextures(u),r}},78459:(e,t,r)=>{var i=r(61159),n=r(21254);i.B.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");var r=new n.M(t);return this.bindUniformBuffer(r),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},i.B.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");var r=new n.M(t);return this.bindUniformBuffer(r),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},i.B.prototype.updateUniformBuffer=function(e,t,r,i){this.bindUniformBuffer(e),void 0===r&&(r=0),void 0===i?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,r,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,r,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(r,r+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(r,r+i)),this.bindUniformBuffer(null)},i.B.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},i.B.prototype.bindUniformBufferBase=function(e,t,r){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},i.B.prototype.bindUniformBlock=function(e,t,r){var i=e.program,n=this._gl.getUniformBlockIndex(i,t);4294967295!==n&&this._gl.uniformBlockBinding(i,n,r)}},52858:(e,t,r)=>{r(61159).B.prototype.updateVideoTexture=function(e,t,r){if(e&&!e._isDisabled){var i=this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0);this._unpackFlipY(!r);try{if(void 0===this._videoTextureSupported&&(this._gl.getError(),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);else{if(!e._workingCanvas){e._workingCanvas=this.createCanvas(e.width,e.height);var n=e._workingCanvas.getContext("2d");if(!n)throw new Error("Unable to get 2d context");e._workingContext=n,e._workingCanvas.width=e.width,e._workingCanvas.height=e.height}e._workingContext.clearRect(0,0,e.width,e.height),e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e.width,e.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)}e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),i||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}catch(t){e._isDisabled=!0}}}},99986:(e,t,r)=>{var i=r(31191),n=r(37290),s=r(76144),o=r(62897),a=r(13514),u=r(80352);Object.defineProperty(n.D.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),n.D.prototype._prepareVRComponent=function(){this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.onVRDisplayChangedObservable=new o.y$,this.onVRRequestPresentComplete=new o.y$,this.onVRRequestPresentStart=new o.y$},n.D.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},n.D.prototype.getVRDevice=function(){return this._vrDisplay},n.D.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},n.D.prototype.initWebVRAsync=function(){var e=this,t=function(){var t={vrDisplay:e._vrDisplay,vrSupported:e._vrSupported};e.onVRDisplayChangedObservable.notifyObservers(t),e._webVRInitPromise=new Promise((function(e){e(t)}))};if(!this._onVrDisplayConnect){this._onVrDisplayConnect=function(r){e._vrDisplay=r.display,t()},this._onVrDisplayDisconnect=function(){e._vrDisplay.cancelAnimationFrame(e._frameHandler),e._vrDisplay=void 0,e._frameHandler=n.D.QueueNewFrame(e._boundRenderFunction),t()},this._onVrDisplayPresentChange=function(){e._vrExclusivePointerMode=e._vrDisplay&&e._vrDisplay.isPresenting};var r=this.getHostWindow();r&&(r.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),r.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),r.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange))}return this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(t),this._webVRInitPromise},n.D.prototype._getVRDisplaysAsync=function(){var e=this;return new Promise((function(t){navigator.getVRDisplays?navigator.getVRDisplays().then((function(r){e._vrSupported=!0,e._vrDisplay=r[0],t({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported})})):(e._vrDisplay=void 0,e._vrSupported=!1,t({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported}))}))},n.D.prototype.enableVR=function(e){var t=this;if(this._vrDisplay&&!this._vrDisplay.isPresenting){this.onVRRequestPresentStart.notifyObservers(this);var r={highRefreshRate:!!this.vrPresentationAttributes&&this.vrPresentationAttributes.highRefreshRate,foveationLevel:this.vrPresentationAttributes?this.vrPresentationAttributes.foveationLevel:1,multiview:(this.getCaps().multiview||this.getCaps().oculusMultiview)&&e.useMultiview};this._vrDisplay.requestPresent([(0,i.pi)({source:this.getRenderingCanvas(),attributes:r},r)]).then((function(){t.onVRRequestPresentComplete.notifyObservers(!0),t._onVRFullScreenTriggered()})).catch((function(){t.onVRRequestPresentComplete.notifyObservers(!1)}))}},n.D.prototype._onVRFullScreenTriggered=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting){this._oldSize=new s.$(this.getRenderWidth(),this.getRenderHeight()),this._oldHardwareScaleFactor=this.getHardwareScalingLevel();var e=this._vrDisplay.getEyeParameters("left");this.setHardwareScalingLevel(1),this.setSize(2*e.renderWidth,e.renderHeight)}else this.setHardwareScalingLevel(this._oldHardwareScaleFactor),this.setSize(this._oldSize.width,this._oldSize.height)},n.D.prototype.disableVR=function(){var e=this;this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then((function(){return e._onVRFullScreenTriggered()})).catch((function(){return e._onVRFullScreenTriggered()})),(0,u.CG)()&&(window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null))},n.D.prototype._connectVREvents=function(e,t){var r=this;if(this._onVRDisplayPointerRestricted=function(){e&&e.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){if(t)t.exitPointerLock&&t.exitPointerLock();else{var e=r.getHostWindow();e.document&&e.document.exitPointerLock&&e.document.exitPointerLock()}},(0,u.CG)()){var i=this.getHostWindow();i.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),i.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1)}},n.D.prototype._submitVRFrame=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting)try{this._vrDisplay.submitFrame()}catch(e){a.w1.Warn("webVR submitFrame has had an unexpected failure: "+e)}},n.D.prototype.isVRPresenting=function(){return this._vrDisplay&&this._vrDisplay.isPresenting},n.D.prototype._requestVRFrame=function(){this._frameHandler=n.D.QueueNewFrame(this._boundRenderFunction,this._vrDisplay)}},72759:(e,t,r)=>{r.d(t,{e:()=>i});var i=function(){function e(){var t=this,r=new ArrayBuffer(e.DEFAULT_BUFFER_SIZE);this._uint32s=new Uint32Array(r),this._int32s=new Int32Array(r),this._float32s=new Float32Array(r),this._length=e.DEFAULT_BUFFER_SIZE/4,this._position=0,this._nativeDataStream=new _native.NativeDataStream((function(){t._flush()}))}return e.prototype.writeUint32=function(e){this._flushIfNecessary(1),this._uint32s[this._position++]=e},e.prototype.writeInt32=function(e){this._flushIfNecessary(1),this._int32s[this._position++]=e},e.prototype.writeFloat32=function(e){this._flushIfNecessary(1),this._float32s[this._position++]=e},e.prototype.writeUint32Array=function(e){this._flushIfNecessary(1+e.length),this._uint32s[this._position++]=e.length,this._uint32s.set(e,this._position),this._position+=e.length},e.prototype.writeInt32Array=function(e){this._flushIfNecessary(1+e.length),this._uint32s[this._position++]=e.length,this._int32s.set(e,this._position),this._position+=e.length},e.prototype.writeFloat32Array=function(e){this._flushIfNecessary(1+e.length),this._uint32s[this._position++]=e.length,this._float32s.set(e,this._position),this._position+=e.length},e.prototype.writeNativeData=function(e){this._flushIfNecessary(e.length),this._uint32s.set(e,this._position),this._position+=e.length},e.prototype.writeBoolean=function(e){this.writeUint32(e?1:0)},e.prototype._flushIfNecessary=function(e){this._position+e>this._length&&this._flush()},e.prototype._flush=function(){this._nativeDataStream.writeBuffer(this._uint32s.buffer,this._position),this._position=0},e.DEFAULT_BUFFER_SIZE=65536,e}()},57710:(e,t,r)=>{r.d(t,{Z:()=>n});var i=r(31259),n=function(){function e(e,t){void 0===t&&(t=20),this.debug=!1,this._sourceCode=e,this._numMaxIterations=t,this._functionDescr=[],this.inlineToken="#define inline"}return Object.defineProperty(e.prototype,"code",{get:function(){return this._sourceCode},enumerable:!1,configurable:!0}),e.prototype.processCode=function(){this.debug,this._collectFunctions(),this._processInlining(this._numMaxIterations),this.debug},e.prototype._collectFunctions=function(){for(var t=0;t<this._sourceCode.length;){var r=this._sourceCode.indexOf(this.inlineToken,t);if(r<0)break;var n=this._sourceCode.indexOf("(",r+this.inlineToken.length);if(n<0)this.debug,t=r+this.inlineToken.length;else{var s=e._RegexpFindFunctionNameAndType.exec(this._sourceCode.substring(r+this.inlineToken.length,n));if(s){var o=[s[3],s[4]],a=o[0],u=o[1],c=(0,i.vt)("(",")",this._sourceCode,n);if(c<0)this.debug,t=r+this.inlineToken.length;else{var l=this._sourceCode.substring(n+1,c),h=(0,i.Pm)(this._sourceCode,c+1);if(h!==this._sourceCode.length){var p=(0,i.vt)("{","}",this._sourceCode,h);if(p<0)this.debug,t=r+this.inlineToken.length;else{for(var d=this._sourceCode.substring(h,p+1),_=(0,i.Kt)(l).split(","),f=[],g=0;g<_.length;++g){var m=_[g].trim(),E=m.lastIndexOf(" ");E>=0&&f.push(m.substring(E+1))}"void"!==a&&f.push("return"),this._functionDescr.push({name:u,type:a,parameters:f,body:d,callIndex:0}),t=p+1;var v=r>0?this._sourceCode.substring(0,r):"",T=p+1<this._sourceCode.length-1?this._sourceCode.substring(p+1):"";this._sourceCode=v+T,t-=p+1-r}}else this.debug,t=r+this.inlineToken.length}}else this.debug,t=r+this.inlineToken.length}}this.debug},e.prototype._processInlining=function(e){for(void 0===e&&(e=20);e-- >=0&&this._replaceFunctionCallsByCode(););return this.debug,e>=0},e.prototype._replaceFunctionCallsByCode=function(){for(var e=!1,t=0,r=this._functionDescr;t<r.length;t++)for(var n=r[t],s=n.name,o=n.type,a=n.parameters,u=n.body,c=0;c<this._sourceCode.length;){var l=this._sourceCode.indexOf(s,c);if(l<0)break;if(0===l||(0,i.uA)(this._sourceCode.charAt(l-1)))c=l+s.length;else{var h=(0,i.Pm)(this._sourceCode,l+s.length);if(h!==this._sourceCode.length&&"("===this._sourceCode.charAt(h)){var p=(0,i.vt)("(",")",this._sourceCode,h);if(p<0)this.debug,c=l+s.length;else{var d=this._sourceCode.substring(h+1,p),_=function(e){for(var t=[],r=0,n=0;r<e.length;){if("("===e.charAt(r)){var s=(0,i.vt)("(",")",e,r);if(s<0)return null;r=s}else","===e.charAt(r)&&(t.push(e.substring(n,r)),n=r+1);r++}return n<r&&t.push(e.substring(n,r)),t}((0,i.Kt)(d));if(null!==_){for(var f=[],g=0;g<_.length;++g){var m=_[g].trim();f.push(m)}var E="void"!==o?s+"_"+n.callIndex++:null;if(E&&f.push(E+" ="),f.length===a.length){c=p+1;var v=this._replaceNames(u,a,f),T=l>0?this._sourceCode.substring(0,l):"",y=p+1<this._sourceCode.length-1?this._sourceCode.substring(p+1):"";if(E){var b=(0,i.wm)(this._sourceCode,l-1,"\n");T=this._sourceCode.substring(0,b+1);var x=this._sourceCode.substring(b+1,l);this._sourceCode=T+o+" "+E+";\n"+v+"\n"+x+E+y,this.debug}else this._sourceCode=T+v+y,c+=v.length-(p+1-l),this.debug;e=!0}else this.debug,c=l+s.length}else this.debug,c=l+s.length}}else c=l+s.length}}return e},e.prototype._replaceNames=function(e,t,r){for(var n=function(n){var s=new RegExp((0,i.AW)(t[n]),"g"),o=t[n].length,a=r[n];e=e.replace(s,(function(r){for(var s=[],u=1;u<arguments.length;u++)s[u-1]=arguments[u];var c=s[0];return(0,i.uA)(e.charAt(c-1))||(0,i.uA)(e.charAt(c+o))?t[n]:a}))},s=0;s<t.length;++s)n(s);return e},e._RegexpFindFunctionNameAndType=/((\s+?)(\w+)\s+(\w+)\s*?)$/,e}()},91153:(e,t,r)=>{r.d(t,{L:()=>E});var i=function(){function e(){this.children=[]}return e.prototype.isValid=function(e){return!0},e.prototype.process=function(e,t){var r="";if(this.line){var i=this.line,n=t.processor;if(n){if(n.lineProcessor&&(i=n.lineProcessor(i,t.isFragment,t.processingContext)),n.attributeProcessor&&this.line.startsWith("attribute"))i=n.attributeProcessor(this.line,e,t.processingContext);else if(n.varyingProcessor&&this.line.startsWith("varying"))i=n.varyingProcessor(this.line,t.isFragment,e,t.processingContext);else if(n.uniformProcessor&&n.uniformRegexp&&n.uniformRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(i=n.uniformProcessor(this.line,t.isFragment,e,t.processingContext));else if(n.uniformBufferProcessor&&n.uniformBufferRegexp&&n.uniformBufferRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(i=n.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0);else if(n.textureProcessor&&n.textureRegexp&&n.textureRegexp.test(this.line))i=n.textureProcessor(this.line,t.isFragment,e,t.processingContext);else if((n.uniformProcessor||n.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?n.uniformProcessor&&(i=n.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):n.uniformBufferProcessor&&(i=n.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)}t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,n.endOfUniformBufferProcessor&&(i=n.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}r+=i+"\r\n"}return this.children.forEach((function(i){r+=i.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),r},e}(),n=function(){function e(){}return Object.defineProperty(e.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,r=e;t<r.length;t++){var i=r[t];if("#"!==i[0])if(i.trim().startsWith("//"))this._lines.push(i);else for(var n=i.split(";"),s=0;s<n.length;s++){var o=n[s];(o=o.trim())&&this._lines.push(o+(s!==n.length-1?";":""))}else this._lines.push(i)}},enumerable:!1,configurable:!0}),e}(),s=r(31191),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype.process=function(e,t){for(var r=0;r<this.children.length;r++){var i=this.children[r];if(i.isValid(e))return i.process(e,t)}return""},t}(i),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype.isValid=function(e){return this.testExpression.isTrue(e)},t}(i),u=function(){function e(){}return e.prototype.isTrue=function(e){return!0},e.postfixToInfix=function(t){for(var r=[],i=0,n=t;i<n.length;i++){var s=n[i];if(void 0===e._OperatorPriority[s])r.push(s);else{var o=r[r.length-1],a=r[r.length-2];r.length-=2,r.push("(".concat(a).concat(s).concat(o,")"))}}return r[r.length-1]},e.infixToPostfix=function(t){for(var r=[],i=-1,n=function(){""!==(c=c.trim())&&(r.push(c),c="")},s=function(t){i<e._Stack.length-1&&(e._Stack[++i]=t)},o=function(){return e._Stack[i]},a=function(){return-1===i?"!!INVALID EXPRESSION!!":e._Stack[i--]},u=0,c="";u<t.length;){var l=t.charAt(u),h=u<t.length-1?t.substr(u,2):"";if("("===l)c="",s(l);else if(")"===l){for(n();-1!==i&&"("!==o();)r.push(a());a()}else if(e._OperatorPriority[h]>1){for(n();-1!==i&&e._OperatorPriority[o()]>=e._OperatorPriority[h];)r.push(a());s(h),u++}else c+=l;u++}for(n();-1!==i;)"("===o()?a():r.push(a());return r},e._OperatorPriority={")":0,"(":1,"||":2,"&&":3},e._Stack=["","","","","","","","","","","","","","","","","","","",""],e}(),c=function(e){function t(t,r){void 0===r&&(r=!1);var i=e.call(this)||this;return i.define=t,i.not=r,i}return(0,s.ZT)(t,e),t.prototype.isTrue=function(e){var t=void 0!==e[this.define];return this.not&&(t=!t),t},t}(u),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)},t}(u),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)},t}(u),p=function(e){function t(t,r,i){var n=e.call(this)||this;return n.define=t,n.operand=r,n.testValue=i,n}return(0,s.ZT)(t,e),t.prototype.isTrue=function(e){var t=e[this.define];void 0===t&&(t=this.define);var r=!1,i=parseInt(t),n=parseInt(this.testValue);switch(this.operand){case">":r=i>n;break;case"<":r=i<n;break;case"<=":r=i<=n;break;case">=":r=i>=n;break;case"==":r=i===n}return r},t}(u),d=r(77851),_=r(41659),f=/defined\s*?\((.+?)\)/g,g=/defined\s*?\[(.+?)\]/g,m=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,E=function(){function e(){}return e.Initialize=function(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)},e.Process=function(e,t,r,i){var n,s=this;(null===(n=t.processor)||void 0===n?void 0:n.preProcessShaderCode)&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,(function(e){t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e));var n=s._ProcessShaderConversion(e,t,i);r(n)}))},e.PreProcess=function(e,t,r,i){var n,s=this;(null===(n=t.processor)||void 0===n?void 0:n.preProcessShaderCode)&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,(function(e){t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e));var n=s._ApplyPreProcessing(e,t,i);r(n)}))},e.Finalize=function(e,t,r){return r.processor&&r.processor.finalizeShaders?r.processor.finalizeShaders(e,t,r.processingContext):{vertexCode:e,fragmentCode:t}},e._ProcessPrecision=function(e,t){var r;if(null===(r=t.processor)||void 0===r?void 0:r.noPrecision)return e;var i=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=i?"precision highp float;\n"+e:"precision mediump float;\n"+e:i||(e=e.replace("precision highp float","precision mediump float")),e},e._ExtractOperation=function(e){var t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new c(t[1].trim(),"!"===e[0]);for(var r="",i=0,n=0,s=["==",">=","<=","<",">"];n<s.length&&(r=s[n],!((i=e.indexOf(r))>-1));n++);if(-1===i)return new c(e);var o=e.substring(0,i).trim(),a=e.substring(i+r.length).trim();return new p(o,r,a)},e._BuildSubExpression=function(e){e=e.replace(f,"defined[$1]");for(var t=[],r=0,i=u.infixToPostfix(e);r<i.length;r++){var n=i[r];if("||"!==n&&"&&"!==n)t.push(n);else if(t.length>=2){var s=t[t.length-1],o=t[t.length-2];t.length-=2;var a="&&"==n?new h:new l;"string"==typeof s&&(s=s.replace(g,"defined($1)")),"string"==typeof o&&(o=o.replace(g,"defined($1)")),a.leftOperand="string"==typeof o?this._ExtractOperation(o):o,a.rightOperand="string"==typeof s?this._ExtractOperation(s):s,t.push(a)}}var c=t[t.length-1];return"string"==typeof c&&(c=c.replace(g,"defined($1)")),"string"==typeof c?this._ExtractOperation(c):c},e._BuildExpression=function(e,t){var r=new a,i=e.substring(0,t),n=e.substring(t);return n=n.substring(0,(n.indexOf("//")+1||n.length+1)-1).trim(),r.testExpression="#ifdef"===i?new c(n):"#ifndef"===i?new c(n,!0):this._BuildSubExpression(n),r},e._MoveCursorWithinIf=function(e,t,r){for(var n=e.currentLine;this._MoveCursor(e,r);){var s=(n=e.currentLine).substring(0,5).toLowerCase();if("#else"===s){var o=new i;return t.children.push(o),void this._MoveCursor(e,o)}if("#elif"===s){var a=this._BuildExpression(n,5);t.children.push(a),r=a}}},e._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var r=e.currentLine,n=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(r);if(n&&n.length){switch(n[0]){case"#ifdef":var s=new o;t.children.push(s);var a=this._BuildExpression(r,6);s.children.push(a),this._MoveCursorWithinIf(e,s,a);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":s=new o;t.children.push(s);a=this._BuildExpression(r,7);s.children.push(a),this._MoveCursorWithinIf(e,s,a);break;case"#if":s=new o,a=this._BuildExpression(r,3);t.children.push(s),s.children.push(a),this._MoveCursorWithinIf(e,s,a)}}else{var u=new i;if(u.line=r,t.children.push(u),"#"===r[0]&&"d"===r[1]){var c=r.replace(";","").split(" ");u.additionalDefineKey=c[1],3===c.length&&(u.additionalDefineValue=c[2])}}}return!1},e._EvaluatePreProcessors=function(e,t,r){var s=new i,o=new n;return o.lineIndex=-1,o.lines=e.split("\n"),this._MoveCursor(o,s),s.process(t,r)},e._PreparePreProcessors=function(e,t){for(var r,i={},n=0,s=e.defines;n<s.length;n++){var o=s[n].replace("#define","").replace(";","").trim().split(" ");i[o[0]]=o.length>1?o[1]:""}return(null===(r=e.processor)||void 0===r?void 0:r.shaderLanguage)===_.x.GLSL&&(i.GL_ES="true"),i.__VERSION__=e.version,i[e.platformName]="true",t._getGlobalDefines(i),i},e._ProcessShaderConversion=function(e,t,r){var i=this._ProcessPrecision(e,t);if(!t.processor)return i;if(t.processor.shaderLanguage===_.x.GLSL&&-1!==i.indexOf("#version 3"))return i.replace("#version 300 es","");var n=t.defines,s=this._PreparePreProcessors(t,r);return t.processor.preProcessor&&(i=t.processor.preProcessor(i,n,t.isFragment,t.processingContext)),i=this._EvaluatePreProcessors(i,s,t),t.processor.postProcessor&&(i=t.processor.postProcessor(i,n,t.isFragment,t.processingContext,r)),r._features.needShaderCodeInlining&&(i=r.inlineShaderCode(i)),i},e._ApplyPreProcessing=function(e,t,r){var i,n,s=e,o=t.defines,a=this._PreparePreProcessors(t,r);return(null===(i=t.processor)||void 0===i?void 0:i.preProcessor)&&(s=t.processor.preProcessor(s,o,t.isFragment,t.processingContext)),s=this._EvaluatePreProcessors(s,a,t),(null===(n=t.processor)||void 0===n?void 0:n.postProcessor)&&(s=t.processor.postProcessor(s,o,t.isFragment,t.processingContext,r)),r._features.needShaderCodeInlining&&(s=r.inlineShaderCode(s)),s},e._ProcessIncludes=function(t,r,i){for(var n=this,s=m.exec(t),o=new String(t),a=!1,u=function(){var u=s[1];if(-1!==u.indexOf("__decl__")&&(u=u.replace(/__decl__/,""),r.supportsUniformBuffers&&(u=(u=u.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),u+="Declaration"),!r.includesShadersStore[u]){var c=r.shadersRepository+"ShadersInclude/"+u+".fx";return e._FileToolsLoadFile(c,(function(e){r.includesShadersStore[u]=e,n._ProcessIncludes(o,r,i)})),{value:void 0}}var l=r.includesShadersStore[u];if(s[2])for(var h=s[3].split(","),p=0;p<h.length;p+=2){var d=new RegExp(h[p],"g"),_=h[p+1];l=l.replace(d,_)}if(s[4]){var f=s[5];if(-1!==f.indexOf("..")){var g=f.split(".."),E=parseInt(g[0]),v=parseInt(g[1]),T=l.slice(0);l="",isNaN(v)&&(v=r.indexParameters[g[1]]);for(var y=E;y<v;y++)r.supportsUniformBuffers||(T=T.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),l+=T.replace(/\{X\}/g,y.toString())+"\n"}else r.supportsUniformBuffers||(l=l.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),l=l.replace(/\{X\}/g,f)}o=o.replace(s[0],l),a=a||l.indexOf("#include<")>=0||l.indexOf("#include <")>=0,s=m.exec(t)};null!=s;){var c=u();if("object"==typeof c)return c.value}a?this._ProcessIncludes(o.toString(),r,i):i(o)},e._FileToolsLoadFile=function(e,t,r,i,n,s){throw(0,d.S)("FileTools")},e}()},48743:(e,t,r)=>{r.d(t,{C:()=>n});var i=r(41659),n=function(){function e(){this.shaderLanguage=i.x.GLSL}return e.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},e.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},e.prototype.postProcessor=function(e,t,r){var i=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),r)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(i?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e},e}()},61319:(e,t,r)=>{r.d(t,{B:()=>i});var i=function(){function e(e,t){if(void 0===e&&(e=null),this._MSAARenderBuffer=null,this._context=t,!e&&!(e=t.createTexture()))throw new Error("Unable to create webGL texture");this.set(e)}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return this._webGLTexture},enumerable:!1,configurable:!0}),e.prototype.setUsage=function(){},e.prototype.set=function(e){this._webGLTexture=e},e.prototype.reset=function(){this._webGLTexture=null,this._MSAARenderBuffer=null},e.prototype.release=function(){this._MSAARenderBuffer&&(this._context.deleteRenderbuffer(this._MSAARenderBuffer),this._MSAARenderBuffer=null),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()},e}()},86830:(e,t,r)=>{r.d(t,{y:()=>i});var i=function(){function e(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!1,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},e.prototype._fillEffectInformation=function(e,t,r,i,n,s,o,a){var u,c=this.engine;if(c.supportsUniformBuffers)for(var l in t)e.bindUniformBlock(l,t[l]);for(this.engine.getUniforms(this,r).forEach((function(e,t){i[r[t]]=e})),this._uniforms=i,u=0;u<n.length;u++){null==e.getUniform(n[u])&&(n.splice(u,1),u--)}n.forEach((function(e,t){s[e]=t}));for(var h=0,p=c.getAttributes(this,o);h<p.length;h++){var d=p[h];a.push(d)}},e.prototype.dispose=function(){this._uniforms={}},e.prototype._cacheMatrix=function(e,t){var r=this._valueCache[e],i=t.updateFlag;return(void 0===r||r!==i)&&(this._valueCache[e]=i,!0)},e.prototype._cacheFloat2=function(e,t,r){var i=this._valueCache[e];if(!i||2!==i.length)return i=[t,r],this._valueCache[e]=i,!0;var n=!1;return i[0]!==t&&(i[0]=t,n=!0),i[1]!==r&&(i[1]=r,n=!0),n},e.prototype._cacheFloat3=function(e,t,r,i){var n=this._valueCache[e];if(!n||3!==n.length)return n=[t,r,i],this._valueCache[e]=n,!0;var s=!1;return n[0]!==t&&(n[0]=t,s=!0),n[1]!==r&&(n[1]=r,s=!0),n[2]!==i&&(n[2]=i,s=!0),s},e.prototype._cacheFloat4=function(e,t,r,i,n){var s=this._valueCache[e];if(!s||4!==s.length)return s=[t,r,i,n],this._valueCache[e]=s,!0;var o=!1;return s[0]!==t&&(s[0]=t,o=!0),s[1]!==r&&(s[1]=r,o=!0),s[2]!==i&&(s[2]=i,o=!0),s[3]!==n&&(s[3]=n,o=!0),o},e.prototype.setInt=function(e,t){var r=this._valueCache[e];void 0!==r&&r===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)},e.prototype.setInt2=function(e,t,r){this._cacheFloat2(e,t,r)&&(this.engine.setInt2(this._uniforms[e],t,r)||(this._valueCache[e]=null))},e.prototype.setInt3=function(e,t,r,i){this._cacheFloat3(e,t,r,i)&&(this.engine.setInt3(this._uniforms[e],t,r,i)||(this._valueCache[e]=null))},e.prototype.setInt4=function(e,t,r,i,n){this._cacheFloat4(e,t,r,i,n)&&(this.engine.setInt4(this._uniforms[e],t,r,i,n)||(this._valueCache[e]=null))},e.prototype.setIntArray=function(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)},e.prototype.setIntArray2=function(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)},e.prototype.setIntArray3=function(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)},e.prototype.setIntArray4=function(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)},e.prototype.setArray=function(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)},e.prototype.setArray2=function(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)},e.prototype.setArray3=function(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)},e.prototype.setArray4=function(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)},e.prototype.setMatrices=function(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))},e.prototype.setMatrix=function(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.toArray())||(this._valueCache[e]=null))},e.prototype.setMatrix3x3=function(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)},e.prototype.setMatrix2x2=function(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)},e.prototype.setFloat=function(e,t){var r=this._valueCache[e];void 0!==r&&r===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)},e.prototype.setVector2=function(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))},e.prototype.setFloat2=function(e,t,r){this._cacheFloat2(e,t,r)&&(this.engine.setFloat2(this._uniforms[e],t,r)||(this._valueCache[e]=null))},e.prototype.setVector3=function(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))},e.prototype.setFloat3=function(e,t,r,i){this._cacheFloat3(e,t,r,i)&&(this.engine.setFloat3(this._uniforms[e],t,r,i)||(this._valueCache[e]=null))},e.prototype.setVector4=function(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))},e.prototype.setQuaternion=function(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))},e.prototype.setFloat4=function(e,t,r,i,n){this._cacheFloat4(e,t,r,i,n)&&(this.engine.setFloat4(this._uniforms[e],t,r,i,n)||(this._valueCache[e]=null))},e.prototype.setColor3=function(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))},e.prototype.setColor4=function(e,t,r){this._cacheFloat4(e,t.r,t.g,t.b,r)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,r)||(this._valueCache[e]=null))},e.prototype.setDirectColor4=function(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))},e.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},e.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},e}()},98619:(e,t,r)=>{r.d(t,{f:()=>n});var i=r(41659),n=function(){function e(){this.shaderLanguage=i.x.GLSL}return e.prototype.postProcessor=function(e,t,r,i,n){if(!n.getCaps().drawBuffersExtension){e=e.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")}return e},e}()},11564:(e,t,r)=>{r.d(t,{V:()=>a});var i=r(84157),n=r(80949),s=r(5382),o=r(8724),a=function(){function e(e){this._deferredReleaseBuffers=[],this._device=e}return e._IsGPUBuffer=function(e){return void 0===e.underlyingResource},e.prototype.createRawBuffer=function(e,t,r){void 0===r&&(r=!1);var i={mappedAtCreation:r,size:void 0!==e.byteLength?e.byteLength+3&-4:e+3&-4,usage:t};return this._device.createBuffer(i)},e.prototype.createBuffer=function(e,t){var r=void 0!==e.byteLength,n=this.createRawBuffer(e,t),s=new i.C(n);return s.references=1,s.capacity=r?e.byteLength:e,r&&this.setSubData(s,0,e),s},e.prototype.setRawData=function(e,t,r,i,n){this._device.queue.writeBuffer(e,t,r.buffer,i,n)},e.prototype.setSubData=function(e,t,r,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var s=e.underlyingResource;n=n||r.byteLength,n=Math.min(n,e.capacity-t);var o=r.byteOffset+i,a=o+n,u=n+3&-4;if(u!==n){var c=new Uint8Array(r.buffer.slice(o,a));(r=new Uint8Array(u)).set(c),i=0,o=0,a=u,n=u}for(var l=15728640,h=0;a-(o+h)>l;)this._device.queue.writeBuffer(s,t+h,r.buffer,o+h,l),h+=l;this._device.queue.writeBuffer(s,t+h,r.buffer,o+h,n-h)},e.prototype._getHalfFloatAsFloatRGBAArrayBuffer=function(e,t,r){r||(r=new Float32Array(e));for(var i=new Uint16Array(t);e--;)r[e]=(0,n.qZ)(i[e]);return r},e.prototype.readDataFromBuffer=function(e,t,r,i,n,a,u,c,l,h,p){var d=this;void 0===u&&(u=0),void 0===c&&(c=0),void 0===l&&(l=null),void 0===h&&(h=!0),void 0===p&&(p=!1);var _=1===u?2:2===u?1:0;return new Promise((function(r,f){e.mapAsync(o.gc.Read,c,t).then((function(){var o=e.getMappedRange(c,t),f=l;if(p)f=null===f?(0,s.A)(u,t,!0,o):(0,s.A)(u,f.buffer,void 0,o);else if(null===f)switch(_){case 0:(f=new Uint8Array(t)).set(new Uint8Array(o));break;case 1:f=d._getHalfFloatAsFloatRGBAArrayBuffer(t/2,o);break;case 2:(f=new Float32Array(t/4)).set(new Float32Array(o))}else switch(_){case 0:(f=new Uint8Array(f.buffer)).set(new Uint8Array(o));break;case 1:f=d._getHalfFloatAsFloatRGBAArrayBuffer(t/2,o,l);break;case 2:(f=new Float32Array(f.buffer)).set(new Float32Array(o))}if(n!==a){1!==_||p||(n*=2,a*=2);for(var g=new Uint8Array(f.buffer),m=n,E=0,v=1;v<i;++v){E=v*a;for(var T=0;T<n;++T)g[m++]=g[E++]}f=0===_||p?new Uint8Array(g.buffer,0,m):new Float32Array(g.buffer,0,m/4)}e.unmap(),h&&d.releaseBuffer(e),r(f)}),(function(e){return f(e)}))}))},e.prototype.releaseBuffer=function(t){return e._IsGPUBuffer(t)?(this._deferredReleaseBuffers.push(t),!0):(t.references--,0===t.references&&(this._deferredReleaseBuffers.push(t.underlyingResource),!0))},e.prototype.destroyDeferredBuffers=function(){for(var e=0;e<this._deferredReleaseBuffers.length;++e)this._deferredReleaseBuffers[e].destroy();this._deferredReleaseBuffers.length=0},e}()},81987:(e,t,r)=>{r.d(t,{GB:()=>a,fv:()=>i,fw:()=>u,kP:()=>o,me:()=>n,nt:()=>l,vr:()=>s});var i=function(){function e(e,t,r,i){this.x=Math.floor(e),this.y=Math.floor(t),this.w=Math.floor(r),this.h=Math.floor(i)}return e.prototype.run=function(e){e.setViewport(this.x,this.y,this.w,this.h,0,1)},e.prototype.clone=function(){return new e(this.x,this.y,this.w,this.h)},e}(),n=function(){function e(e,t,r,i){this.x=e,this.y=t,this.w=r,this.h=i}return e.prototype.run=function(e){e.setScissorRect(this.x,this.y,this.w,this.h)},e.prototype.clone=function(){return new e(this.x,this.y,this.w,this.h)},e}(),s=function(){function e(e){this.ref=e}return e.prototype.run=function(e){e.setStencilReference(this.ref)},e.prototype.clone=function(){return new e(this.ref)},e}(),o=function(){function e(e){this.color=e}return e.prototype.run=function(e){e.setBlendConstant(this.color)},e.prototype.clone=function(){return new e(this.color)},e}(),a=function(){function e(e){this.query=e}return e.prototype.run=function(e){e.beginOcclusionQuery(this.query)},e.prototype.clone=function(){return new e(this.query)},e}(),u=function(){function e(){}return e.prototype.run=function(e){e.endOcclusionQuery()},e.prototype.clone=function(){return new e},e}(),c=function(){function e(){this.bundles=[]}return e.prototype.run=function(e){e.executeBundles(this.bundles)},e.prototype.clone=function(){var t=new e;return t.bundles=this.bundles,t},e}(),l=function(){function e(e){this.numDrawCalls=0,this._device=e,this._list=new Array(10),this._listLength=0}return e.prototype.addBundle=function(e){if(!this._currentItemIsBundle){var t=new c;this._list[this._listLength++]=t,this._currentBundleList=t.bundles,this._currentItemIsBundle=!0}e&&this._currentBundleList.push(e)},e.prototype._finishBundle=function(){this._currentItemIsBundle&&this._bundleEncoder&&(this._currentBundleList.push(this._bundleEncoder.finish()),this._bundleEncoder=void 0,this._currentItemIsBundle=!1)},e.prototype.addItem=function(e){this._finishBundle(),this._list[this._listLength++]=e,this._currentItemIsBundle=!1},e.prototype.getBundleEncoder=function(e,t,r){return this._currentItemIsBundle||(this.addBundle(),this._bundleEncoder=this._device.createRenderBundleEncoder({colorFormats:e,depthStencilFormat:t,sampleCount:r})),this._bundleEncoder},e.prototype.close=function(){this._finishBundle()},e.prototype.run=function(e){this.close();for(var t=0;t<this._listLength;++t)this._list[t].run(e)},e.prototype.reset=function(){this._listLength=0,this._currentItemIsBundle=!1,this.numDrawCalls=0},e.prototype.clone=function(){this.close();var t=new e(this._device);t._list=new Array(this._listLength),t._listLength=this._listLength,t.numDrawCalls=this.numDrawCalls;for(var r=0;r<this._listLength;++r)t._list[r]=this._list[r].clone();return t},e}()},66970:(e,t,r)=>{r.d(t,{C:()=>s});var i=r(84318),n=function(){this.values={}},s=function(){function e(e,t,r){this.disabled=!1,this._device=e,this._cacheSampler=t,this._engine=r}return Object.defineProperty(e,"Statistics",{get:function(){return{totalCreated:e.NumBindGroupsCreatedTotal,lastFrameCreated:e.NumBindGroupsCreatedLastFrame,lookupLastFrame:e.NumBindGroupsLookupLastFrame,noLookupLastFrame:e.NumBindGroupsNoLookupLastFrame}},enumerable:!1,configurable:!0}),e.prototype.endFrame=function(){e.NumBindGroupsCreatedLastFrame=e._NumBindGroupsCreatedCurrentFrame,e.NumBindGroupsLookupLastFrame=e._NumBindGroupsLookupCurrentFrame,e.NumBindGroupsNoLookupLastFrame=e._NumBindGroupsNoLookupCurrentFrame,e._NumBindGroupsCreatedCurrentFrame=0,e._NumBindGroupsLookupCurrentFrame=0,e._NumBindGroupsNoLookupCurrentFrame=0},e.prototype.getBindGroups=function(t,r,s){var o,a,u,c,l,h,p,d,_,f,g=void 0,m=e._Cache,E=this.disabled||s.forceBindGroupCreation;if(!E){if(!r.isDirty(s.updateId)&&!s.isDirty)return e._NumBindGroupsNoLookupCurrentFrame++,r.bindGroups;for(var v=0,T=t.shaderProcessingContext.bufferNames;v<T.length;v++){var y=T[v],b=null!==(a=null===(o=r.buffers[y])||void 0===o?void 0:o.uniqueId)&&void 0!==a?a:0;(P=m.values[b])||(P=new n,m.values[b]=P),m=P}for(var x=0,S=t.shaderProcessingContext.samplerNames;x<S.length;x++){var R=S[x],A=null!==(c=null===(u=s.samplers[R])||void 0===u?void 0:u.hashCode)&&void 0!==c?c:0;(P=m.values[A])||(P=new n,m.values[A]=P),m=P}for(var C=0,B=t.shaderProcessingContext.textureNames;C<B.length;C++){var P,I=B[C],D=null!==(p=null===(h=null===(l=s.textures[I])||void 0===l?void 0:l.texture)||void 0===h?void 0:h.uniqueId)&&void 0!==p?p:0;(P=m.values[D])||(P=new n,m.values[D]=P),m=P}g=m.bindGroups}if(r.resetIsDirty(s.updateId),s.isDirty=!1,g)return r.bindGroups=g,e._NumBindGroupsLookupCurrentFrame++,g;g=[],r.bindGroups=g,E||(m.bindGroups=g),e.NumBindGroupsCreatedTotal++,e._NumBindGroupsCreatedCurrentFrame++;for(var F=t.bindGroupLayouts,U=0;U<t.shaderProcessingContext.bindGroupLayoutEntries.length;U++){for(var w=t.shaderProcessingContext.bindGroupLayoutEntries[U],L=t.shaderProcessingContext.bindGroupEntries[U],M=0;M<w.length;M++){var O=t.shaderProcessingContext.bindGroupLayoutEntries[U][M],G=t.shaderProcessingContext.bindGroupLayoutEntryInfo[U][O.binding],N=null!==(d=G.nameInArrayOfTexture)&&void 0!==d?d:G.name;if(O.sampler)if(X=s.samplers[N]){var V=X.sampler;if(!V){this._engine.dbgSanityChecks&&i.Y.Error("Trying to bind a null sampler! entry=".concat(JSON.stringify(O),", name=").concat(N,", bindingInfo=").concat(JSON.stringify(X,(function(e,t){return"texture"===e?"<no dump>":t})),", materialContext.uniqueId=").concat(s.uniqueId),50);continue}L[M].resource=this._cacheSampler.getSampler(V,!1,X.hashCode)}else i.Y.Error('Sampler "'.concat(N,'" could not be bound. entry=').concat(JSON.stringify(O),", materialContext=").concat(JSON.stringify(s,(function(e,t){return"texture"===e||"sampler"===e?"<no dump>":t}))),50);else if(O.texture||O.storageTexture){if(X=s.textures[N]){if(this._engine.dbgSanityChecks&&null===X.texture){i.Y.Error("Trying to bind a null texture! entry=".concat(JSON.stringify(O),", bindingInfo=").concat(JSON.stringify(X,(function(e,t){return"texture"===e?"<no dump>":t})),", materialContext.uniqueId=").concat(s.uniqueId),50);continue}var k=X.texture._hardwareTexture;if(this._engine.dbgSanityChecks&&(!k||O.texture&&!k.view||O.storageTexture&&!k.viewForWriting)){i.Y.Error("Trying to bind a null gpu texture or view! entry=".concat(JSON.stringify(O),", name=").concat(N,", bindingInfo=").concat(JSON.stringify(X,(function(e,t){return"texture"===e?"<no dump>":t})),", isReady=").concat(null===(_=X.texture)||void 0===_?void 0:_.isReady,", materialContext.uniqueId=").concat(s.uniqueId),50);continue}L[M].resource=O.storageTexture?k.viewForWriting:k.view}else i.Y.Error('Texture "'.concat(N,'" could not be bound. entry=').concat(JSON.stringify(O),", materialContext=").concat(JSON.stringify(s,(function(e,t){return"texture"===e||"sampler"===e?"<no dump>":t}))),50)}else if(O.externalTexture){var X;if(X=s.textures[N]){if(this._engine.dbgSanityChecks&&null===X.texture){i.Y.Error("Trying to bind a null external texture! entry=".concat(JSON.stringify(O),", name=").concat(N,", bindingInfo=").concat(JSON.stringify(X,(function(e,t){return"texture"===e?"<no dump>":t})),", materialContext.uniqueId=").concat(s.uniqueId),50);continue}var W=X.texture.underlyingResource;if(this._engine.dbgSanityChecks&&!W){i.Y.Error("Trying to bind a null gpu external texture! entry=".concat(JSON.stringify(O),", name=").concat(N,", bindingInfo=").concat(JSON.stringify(X,(function(e,t){return"texture"===e?"<no dump>":t})),", isReady=").concat(null===(f=X.texture)||void 0===f?void 0:f.isReady,", materialContext.uniqueId=").concat(s.uniqueId),50);continue}L[M].resource=this._device.importExternalTexture({source:W})}else i.Y.Error('Texture "'.concat(N,'" could not be bound. entry=').concat(JSON.stringify(O),", materialContext=").concat(JSON.stringify(s,(function(e,t){return"texture"===e||"sampler"===e?"<no dump>":t}))),50)}else if(O.buffer){var H=r.buffers[N];if(H){var Y=H.underlyingResource;L[M].resource.buffer=Y,L[M].resource.size=H.capacity}else i.Y.Error("Can't find buffer \"".concat(N,'". entry=').concat(JSON.stringify(O),", buffers=").concat(JSON.stringify(r.buffers),", drawContext.uniqueId=").concat(r.uniqueId),50)}}var z=F[U];g[U]=this._device.createBindGroup({layout:z,entries:L})}return g},e.NumBindGroupsCreatedTotal=0,e.NumBindGroupsCreatedLastFrame=0,e.NumBindGroupsLookupLastFrame=0,e.NumBindGroupsNoLookupLastFrame=0,e._Cache=new n,e._NumBindGroupsCreatedCurrentFrame=0,e._NumBindGroupsLookupCurrentFrame=0,e._NumBindGroupsNoLookupCurrentFrame=0,e}()},93052:(e,t,r)=>{r.d(t,{O:()=>l});var i,n=r(8724),s=r(72208),o=r(50113),a=r(72089);!function(e){e[e.StencilReadMask=0]="StencilReadMask",e[e.StencilWriteMask=1]="StencilWriteMask",e[e.DepthBias=2]="DepthBias",e[e.DepthBiasSlopeScale=3]="DepthBiasSlopeScale",e[e.DepthStencilState=4]="DepthStencilState",e[e.MRTAttachments1=5]="MRTAttachments1",e[e.MRTAttachments2=6]="MRTAttachments2",e[e.RasterizationState=7]="RasterizationState",e[e.ColorStates=8]="ColorStates",e[e.ShaderStage=9]="ShaderStage",e[e.TextureStage=10]="TextureStage",e[e.VertexState=11]="VertexState",e[e.NumStates=12]="NumStates"}(i||(i={}));var u={0:1,1:2,768:3,769:4,770:5,771:6,772:7,773:8,774:9,775:10,776:11,32769:12,32770:13,32771:12,32772:13},c={0:0,7680:1,7681:2,7682:3,7683:4,5386:5,34055:6,34056:7},l=function(){function e(e,t,r){this.mrtTextureCount=0,this._device=e,this._useTextureStage=r,this._states=new Array(30),this._statesLength=0,this._stateDirtyLowestIndex=0,this._emptyVertexBuffer=t,this._mrtFormats=[],this._parameter={token:void 0,pipeline:null},this.disabled=!1,this.vertexBuffers=[],this._kMaxVertexBufferStride=e.limits.maxVertexBufferArrayStride||2048,this.reset()}return e.prototype.reset=function(){this._isDirty=!0,this.vertexBuffers.length=0,this.setAlphaToCoverage(!1),this.resetDepthCullingState(),this.setClampDepth(!1),this.setDepthBias(0),this._webgpuColorFormat=[n.EV.BGRA8Unorm],this.setColorFormat(n.EV.BGRA8Unorm),this.setMRT([]),this.setAlphaBlendEnabled(!1),this.setAlphaBlendFactors([null,null,null,null],[null,null]),this.setWriteMask(15),this.setDepthStencilFormat(n.EV.Depth24PlusStencil8),this.setStencilEnabled(!1),this.resetStencilState(),this.setBuffers(null,null,null),this._setTextureState(0)},Object.defineProperty(e.prototype,"colorFormats",{get:function(){return this._mrtAttachments1>0?this._mrtFormats:this._webgpuColorFormat},enumerable:!1,configurable:!0}),e.prototype.getRenderPipeline=function(t,r,i,n){if(void 0===n&&(n=0),i>1&&(i=4),this.disabled){var s=e._GetTopology(t);return this._setVertexState(r),this._parameter.pipeline=this._createRenderPipeline(r,s,i),e.NumCacheMiss++,e._NumPipelineCreationCurrentFrame++,this._parameter.pipeline}if(this._setShaderStage(r.uniqueId),this._setRasterizationState(t,i),this._setColorStates(),this._setDepthStencilState(),this._setVertexState(r),this._setTextureState(n),this.lastStateDirtyLowestIndex=this._stateDirtyLowestIndex,!this._isDirty&&this._parameter.pipeline)return this._stateDirtyLowestIndex=this._statesLength,e.NumCacheHitWithoutHash++,this._parameter.pipeline;if(this._getRenderPipeline(this._parameter),this._isDirty=!1,this._stateDirtyLowestIndex=this._statesLength,this._parameter.pipeline)return e.NumCacheHitWithHash++,this._parameter.pipeline;var o=e._GetTopology(t);return this._parameter.pipeline=this._createRenderPipeline(r,o,i),this._setRenderPipeline(this._parameter),e.NumCacheMiss++,e._NumPipelineCreationCurrentFrame++,this._parameter.pipeline},e.prototype.endFrame=function(){e.NumPipelineCreationLastFrame=e._NumPipelineCreationCurrentFrame,e._NumPipelineCreationCurrentFrame=0},e.prototype.setAlphaToCoverage=function(e){this._alphaToCoverageEnabled=e},e.prototype.setFrontFace=function(e){this._frontFace=e},e.prototype.setCullEnabled=function(e){this._cullEnabled=e},e.prototype.setCullFace=function(e){this._cullFace=e},e.prototype.setClampDepth=function(e){this._clampDepth=e},e.prototype.resetDepthCullingState=function(){this.setDepthCullingState(!1,2,1,0,0,!0,!0,519)},e.prototype.setDepthCullingState=function(e,t,r,i,n,s,o,a){this._depthWriteEnabled=o,this._depthTestEnabled=s,this._depthCompare=(null!=a?a:519)-512,this._cullFace=r,this._cullEnabled=e,this._frontFace=t,this.setDepthBiasSlopeScale(i),this.setDepthBias(n)},e.prototype.setDepthBias=function(e){this._depthBias!==e&&(this._depthBias=e,this._states[i.DepthBias]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.DepthBias))},e.prototype.setDepthBiasSlopeScale=function(e){this._depthBiasSlopeScale!==e&&(this._depthBiasSlopeScale=e,this._states[i.DepthBiasSlopeScale]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.DepthBiasSlopeScale))},e.prototype.setColorFormat=function(e){this._webgpuColorFormat[0]=e,this._colorFormat=a.U[null!=e?e:""]},e.prototype.setMRTAttachments=function(e){this.mrtAttachments=e;for(var t=0,r=0;r<e.length;++r)0!==e[r]&&(t+=1<<r);this._mrtEnabledMask!==t&&(this._mrtEnabledMask=t,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.MRTAttachments1))},e.prototype.setMRT=function(e,t){var r,n;if((t=null!=t?t:e.length)>10)throw"Can't handle more than 10 attachments for a MRT in cache render pipeline!";this.mrtTextureArray=e,this.mrtTextureCount=t,this._mrtEnabledMask=65535;for(var s=[0,0],o=0,u=0,c=0,l=0;l<t;++l){var h=e[l],p=null==h?void 0:h._hardwareTexture;this._mrtFormats[c]=null!==(r=null==p?void 0:p.format)&&void 0!==r?r:this._webgpuColorFormat[0],s[o]+=a.U[null!==(n=this._mrtFormats[c])&&void 0!==n?n:""]<<u,c++,(u+=6)>=32&&(u=0,o++)}this._mrtFormats.length=c,this._mrtAttachments1===s[0]&&this._mrtAttachments2===s[1]||(this._mrtAttachments1=s[0],this._mrtAttachments2=s[1],this._states[i.MRTAttachments1]=s[0],this._states[i.MRTAttachments2]=s[1],this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.MRTAttachments1))},e.prototype.setAlphaBlendEnabled=function(e){this._alphaBlendEnabled=e},e.prototype.setAlphaBlendFactors=function(e,t){this._alphaBlendFuncParams=e,this._alphaBlendEqParams=t},e.prototype.setWriteMask=function(e){this._writeMask=e},e.prototype.setDepthStencilFormat=function(e){this._webgpuDepthStencilFormat=e,this._depthStencilFormat=void 0===e?0:a.U[e]},e.prototype.setDepthTestEnabled=function(e){this._depthTestEnabled=e},e.prototype.setDepthWriteEnabled=function(e){this._depthWriteEnabled=e},e.prototype.setDepthCompare=function(e){this._depthCompare=(null!=e?e:519)-512},e.prototype.setStencilEnabled=function(e){this._stencilEnabled=e},e.prototype.setStencilCompare=function(e){this._stencilFrontCompare=(null!=e?e:519)-512},e.prototype.setStencilDepthFailOp=function(e){this._stencilFrontDepthFailOp=null===e?1:c[e]},e.prototype.setStencilPassOp=function(e){this._stencilFrontPassOp=null===e?2:c[e]},e.prototype.setStencilFailOp=function(e){this._stencilFrontFailOp=null===e?1:c[e]},e.prototype.setStencilReadMask=function(e){this._stencilReadMask!==e&&(this._stencilReadMask=e,this._states[i.StencilReadMask]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.StencilReadMask))},e.prototype.setStencilWriteMask=function(e){this._stencilWriteMask!==e&&(this._stencilWriteMask=e,this._states[i.StencilWriteMask]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.StencilWriteMask))},e.prototype.resetStencilState=function(){this.setStencilState(!1,519,7680,7681,7680,255,255)},e.prototype.setStencilState=function(e,t,r,i,n,s,o){this._stencilEnabled=e,this._stencilFrontCompare=(null!=t?t:519)-512,this._stencilFrontDepthFailOp=null===r?1:c[r],this._stencilFrontPassOp=null===i?2:c[i],this._stencilFrontFailOp=null===n?1:c[n],this.setStencilReadMask(s),this.setStencilWriteMask(o)},e.prototype.setBuffers=function(e,t,r){this._vertexBuffers=e,this._overrideVertexBuffers=r,this._indexBuffer=t},e._GetTopology=function(e){switch(e){case 0:default:return n.YV.TriangleList;case 2:case 3:return n.YV.PointList;case 1:case 4:return n.YV.LineList;case 5:throw"LineLoop is an unsupported fillmode in WebGPU";case 6:return n.YV.LineStrip;case 7:return n.YV.TriangleStrip;case 8:throw"TriangleFan is an unsupported fillmode in WebGPU"}},e._GetAphaBlendOperation=function(e){switch(e){case 32774:default:return n.db.Add;case 32778:return n.db.Subtract;case 32779:return n.db.ReverseSubtract;case 32775:return n.db.Min;case 32776:return n.db.Max}},e._GetAphaBlendFactor=function(e){switch(e){case 0:return n.zi.Zero;case 1:default:return n.zi.One;case 768:return n.zi.Src;case 769:return n.zi.OneMinusSrc;case 770:return n.zi.SrcAlpha;case 771:return n.zi.OneMinusSrcAlpha;case 772:return n.zi.DstAlpha;case 773:return n.zi.OneMinusDstAlpha;case 774:return n.zi.Dst;case 775:return n.zi.OneMinusDst;case 776:return n.zi.SrcAlphaSaturated;case 32769:case 32771:return n.zi.Constant;case 32770:case 32772:return n.zi.OneMinusConstant}},e._GetCompareFunction=function(e){switch(e){case 0:return n.wb.Never;case 1:return n.wb.Less;case 2:return n.wb.Equal;case 3:return n.wb.LessEqual;case 4:return n.wb.Greater;case 5:return n.wb.NotEqual;case 6:return n.wb.GreaterEqual;case 7:return n.wb.Always}return n.wb.Never},e._GetStencilOpFunction=function(e){switch(e){case 0:return n.xS.Zero;case 1:return n.xS.Keep;case 2:return n.xS.Replace;case 3:return n.xS.IncrementClamp;case 4:return n.xS.DecrementClamp;case 5:return n.xS.Invert;case 6:return n.xS.IncrementWrap;case 7:return n.xS.DecrementWrap}return n.xS.Keep},e._GetVertexInputDescriptorFormat=function(e){var t=e.type,r=e.normalized,i=e.getSize();switch(t){case s.o.BYTE:switch(i){case 1:case 2:return r?n.gB.Snorm8x2:n.gB.Sint8x2;case 3:case 4:return r?n.gB.Snorm8x4:n.gB.Sint8x4}break;case s.o.UNSIGNED_BYTE:switch(i){case 1:case 2:return r?n.gB.Unorm8x2:n.gB.Uint8x2;case 3:case 4:return r?n.gB.Unorm8x4:n.gB.Uint8x4}break;case s.o.SHORT:switch(i){case 1:case 2:return r?n.gB.Snorm16x2:n.gB.Sint16x2;case 3:case 4:return r?n.gB.Snorm16x4:n.gB.Sint16x4}break;case s.o.UNSIGNED_SHORT:switch(i){case 1:case 2:return r?n.gB.Unorm16x2:n.gB.Uint16x2;case 3:case 4:return r?n.gB.Unorm16x4:n.gB.Uint16x4}break;case s.o.INT:switch(i){case 1:return n.gB.Sint32;case 2:return n.gB.Sint32x2;case 3:return n.gB.Sint32x3;case 4:return n.gB.Sint32x4}break;case s.o.UNSIGNED_INT:switch(i){case 1:return n.gB.Uint32;case 2:return n.gB.Uint32x2;case 3:return n.gB.Uint32x3;case 4:return n.gB.Uint32x4}break;case s.o.FLOAT:switch(i){case 1:return n.gB.Float32;case 2:return n.gB.Float32x2;case 3:return n.gB.Float32x3;case 4:return n.gB.Float32x4}}throw new Error("Invalid Format '".concat(e.getKind(),"' - type=").concat(t,", normalized=").concat(r,", size=").concat(i))},e.prototype._getAphaBlendState=function(){return this._alphaBlendEnabled?{srcFactor:e._GetAphaBlendFactor(this._alphaBlendFuncParams[2]),dstFactor:e._GetAphaBlendFactor(this._alphaBlendFuncParams[3]),operation:e._GetAphaBlendOperation(this._alphaBlendEqParams[1])}:null},e.prototype._getColorBlendState=function(){return this._alphaBlendEnabled?{srcFactor:e._GetAphaBlendFactor(this._alphaBlendFuncParams[0]),dstFactor:e._GetAphaBlendFactor(this._alphaBlendFuncParams[1]),operation:e._GetAphaBlendOperation(this._alphaBlendEqParams[0])}:null},e.prototype._setShaderStage=function(e){this._shaderId!==e&&(this._shaderId=e,this._states[i.ShaderStage]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.ShaderStage))},e.prototype._setRasterizationState=function(e,t){var r=this._frontFace-1+((this._cullEnabled?this._cullFace:0)<<1)+((this._clampDepth?1:0)<<3)+((this._alphaToCoverageEnabled?1:0)<<4)+(e<<5)+(t<<8);this._rasterizationState!==r&&(this._rasterizationState=r,this._states[i.RasterizationState]=this._rasterizationState,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.RasterizationState))},e.prototype._setColorStates=function(){var e=((this._writeMask?1:0)<<22)+(this._colorFormat<<23)+((this._depthWriteEnabled?1:0)<<29);this._alphaBlendEnabled&&(e+=((null===this._alphaBlendFuncParams[0]?2:u[this._alphaBlendFuncParams[0]])<<0)+((null===this._alphaBlendFuncParams[1]?2:u[this._alphaBlendFuncParams[1]])<<4)+((null===this._alphaBlendFuncParams[2]?2:u[this._alphaBlendFuncParams[2]])<<8)+((null===this._alphaBlendFuncParams[3]?2:u[this._alphaBlendFuncParams[3]])<<12)+((null===this._alphaBlendEqParams[0]?1:this._alphaBlendEqParams[0]-32773)<<16)+((null===this._alphaBlendEqParams[1]?1:this._alphaBlendEqParams[1]-32773)<<19)),e!==this._colorStates&&(this._colorStates=e,this._states[i.ColorStates]=this._colorStates,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.ColorStates))},e.prototype._setDepthStencilState=function(){var e=this._stencilEnabled?this._stencilFrontCompare+(this._stencilFrontDepthFailOp<<3)+(this._stencilFrontPassOp<<6)+(this._stencilFrontFailOp<<9):591,t=this._depthStencilFormat+((this._depthTestEnabled?this._depthCompare:7)<<6)+(e<<10);this._depthStencilState!==t&&(this._depthStencilState=t,this._states[i.DepthStencilState]=this._depthStencilState,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.DepthStencilState))},e.prototype._setVertexState=function(e){for(var t,r,n,s=this._statesLength,o=i.VertexState,a=e._pipelineContext,u=a.shaderProcessingContext.attributeNamesFromEffect,c=a.shaderProcessingContext.attributeLocationsFromEffect,l=0,h=0;h<u.length;h++){var p=c[h],d=null!==(t=this._overrideVertexBuffers&&this._overrideVertexBuffers[u[h]])&&void 0!==t?t:this._vertexBuffers[u[h]];d||(d=this._emptyVertexBuffer);var _=null===(r=d.getBuffer())||void 0===r?void 0:r.underlyingResource;if(void 0===d._validOffsetRange){var f=d.byteOffset,g=d.getSize(!0),m=d.byteStride;d._validOffsetRange=f<=this._kMaxVertexBufferStride-g&&(0===m||f+g<=m)}n&&n===_&&d._validOffsetRange||(this.vertexBuffers[l++]=d,n=d._validOffsetRange?_:null);var E=d.hashCode+(p<<7);this._isDirty=this._isDirty||this._states[o]!==E,this._states[o++]=E}this.vertexBuffers.length=l,this._statesLength=o,this._isDirty=this._isDirty||o!==s,this._isDirty&&(this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.VertexState))},e.prototype._setTextureState=function(e){this._textureState!==e&&(this._textureState=e,this._states[i.TextureStage]=this._textureState,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.TextureStage))},e.prototype._createPipelineLayout=function(e){if(this._useTextureStage)return this._createPipelineLayoutWithTextureStage(e);for(var t=[],r=e.shaderProcessingContext.bindGroupLayoutEntries,i=0;i<r.length;i++){var n=r[i];t[i]=this._device.createBindGroupLayout({entries:n})}return e.bindGroupLayouts=t,this._device.createPipelineLayout({bindGroupLayouts:t})},e.prototype._createPipelineLayoutWithTextureStage=function(e){for(var t,r=e.shaderProcessingContext,i=r.bindGroupLayoutEntries,s=1,a=0;a<i.length;a++)for(var u=i[a],c=0;c<u.length;c++){var l=i[a][c];if(l.texture){var h=r.bindGroupLayoutEntryInfo[a][l.binding].name,p=r.availableTextures[h],d=p.autoBindSampler?r.availableSamplers[h+o.e.AutoSamplerSuffix]:null,_=p.sampleType,f=null!==(t=null==d?void 0:d.type)&&void 0!==t?t:n.dV.Filtering;if(this._textureState&s&&_!==n.oD.Depth&&(p.autoBindSampler&&(f=n.dV.NonFiltering),_=n.oD.UnfilterableFloat),l.texture.sampleType=_,d){var g=r.bindGroupLayoutEntryInfo[d.binding.groupIndex][d.binding.bindingIndex].index;i[d.binding.groupIndex][g].sampler.type=f}s<<=1}}var m=[];for(a=0;a<i.length;++a)m[a]=this._device.createBindGroupLayout({entries:i[a]});return e.bindGroupLayouts=m,this._device.createPipelineLayout({bindGroupLayouts:m})},e.prototype._getVertexInputDescriptor=function(t){for(var r,i,s,o,a=[],u=t._pipelineContext,c=u.shaderProcessingContext.attributeNamesFromEffect,l=u.shaderProcessingContext.attributeLocationsFromEffect,h=0;h<c.length;h++){var p=l[h],d=null!==(r=this._overrideVertexBuffers&&this._overrideVertexBuffers[c[h]])&&void 0!==r?r:this._vertexBuffers[c[h]];d||(d=this._emptyVertexBuffer);var _=null===(i=d.getBuffer())||void 0===i?void 0:i.underlyingResource,f=d.byteOffset,g=!d._validOffsetRange;if(!s||!o||s!==_||g){var m={arrayStride:d.byteStride,stepMode:d.getIsInstanced()?n.V.Instance:n.V.Vertex,attributes:[]};a.push(m),o=m.attributes,g&&(f=0,_=null)}o.push({shaderLocation:p,offset:f,format:e._GetVertexInputDescriptorFormat(d)}),s=_}return a},e.prototype._createRenderPipeline=function(t,r,i){var s=t._pipelineContext,o=this._getVertexInputDescriptor(t),u=this._createPipelineLayout(s),c=[],l=this._getAphaBlendState(),h=this._getColorBlendState();if(this._mrtAttachments1>0)for(var p=0;p<this._mrtFormats.length;++p){var d=this._mrtFormats[p];if(d){var _={format:d,writeMask:0!=(this._mrtEnabledMask&1<<p)?this._writeMask:0};l&&h&&(_.blend={alpha:l,color:h}),c.push(_)}else c.push(null)}else if(this._webgpuColorFormat[0]){_={format:this._webgpuColorFormat[0],writeMask:this._writeMask};l&&h&&(_.blend={alpha:l,color:h}),c.push(_)}else c.push(null);var f={compare:e._GetCompareFunction(this._stencilEnabled?this._stencilFrontCompare:7),depthFailOp:e._GetStencilOpFunction(this._stencilEnabled?this._stencilFrontDepthFailOp:1),failOp:e._GetStencilOpFunction(this._stencilEnabled?this._stencilFrontFailOp:1),passOp:e._GetStencilOpFunction(this._stencilEnabled?this._stencilFrontPassOp:1)},g=void 0;r!==n.YV.LineStrip&&r!==n.YV.TriangleStrip||(g=!this._indexBuffer||this._indexBuffer.is32Bits?n.iD.Uint32:n.iD.Uint16);var m=!!this._webgpuDepthStencilFormat&&a.D.HasStencilAspect(this._webgpuDepthStencilFormat);return this._device.createRenderPipeline({layout:u,vertex:{module:s.stages.vertexStage.module,entryPoint:s.stages.vertexStage.entryPoint,buffers:o},primitive:{topology:r,stripIndexFormat:g,frontFace:1===this._frontFace?n.zX.CCW:n.zX.CW,cullMode:this._cullEnabled?2===this._cullFace?n.Wf.Front:n.Wf.Back:n.Wf.None},fragment:s.stages.fragmentStage?{module:s.stages.fragmentStage.module,entryPoint:s.stages.fragmentStage.entryPoint,targets:c}:void 0,multisample:{count:i},depthStencil:void 0===this._webgpuDepthStencilFormat?void 0:{depthWriteEnabled:this._depthWriteEnabled,depthCompare:this._depthTestEnabled?e._GetCompareFunction(this._depthCompare):n.wb.Always,format:this._webgpuDepthStencilFormat,stencilFront:this._stencilEnabled&&m?f:void 0,stencilBack:this._stencilEnabled&&m?f:void 0,stencilReadMask:this._stencilEnabled&&m?this._stencilReadMask:void 0,stencilWriteMask:this._stencilEnabled&&m?this._stencilWriteMask:void 0,depthBias:this._depthBias,depthBiasClamp:this._depthBiasClamp,depthBiasSlopeScale:this._depthBiasSlopeScale}})},e.NumCacheHitWithoutHash=0,e.NumCacheHitWithHash=0,e.NumCacheMiss=0,e.NumPipelineCreationLastFrame=0,e._NumPipelineCreationCurrentFrame=0,e}()},85801:(e,t,r)=>{r.d(t,{H:()=>o});var i=r(31191),n=r(93052),s=function(){function e(){this.values={}}return e.prototype.count=function(){var e=0,t=this.pipeline?1:0;for(var r in this.values){var i=this.values[r].count();e+=i[0],t+=i[1],e++}return[e,t]},e}(),o=function(e){function t(r,i,n){var s=e.call(this,r,i,n)||this;return s._nodeStack=[],s._nodeStack[0]=t._Cache,s}return(0,i.ZT)(t,e),t.GetNodeCounts=function(){var e=t._Cache.count();return{nodeCount:e[0],pipelineCount:e[1]}},t._GetPipelines=function(e,r,i,n){if(e.pipeline){var s=i.slice();s.length=n,r.push(s)}for(var o in e.values){var a=e.values[o];i[n]=parseInt(o),t._GetPipelines(a,r,i,n+1)}},t.GetPipelines=function(){var e=[];return t._GetPipelines(t._Cache,e,[],0),e},t.prototype._getRenderPipeline=function(e){for(var t=this._nodeStack[this._stateDirtyLowestIndex],r=this._stateDirtyLowestIndex;r<this._statesLength;++r){var i=t.values[this._states[r]];i||(i=new s,t.values[this._states[r]]=i),t=i,this._nodeStack[r+1]=t}e.token=t,e.pipeline=t.pipeline},t.prototype._setRenderPipeline=function(e){e.token.pipeline=e.pipeline},t._Cache=new s,t}(n.O)},20955:(e,t,r)=>{r.d(t,{W:()=>u});var i=r(31191),n=r(8724),s=[0,0,3,7,0,2,6,2,4,1,5,3,1],o=[0,64,32,96,16,80,48,112,8],a=[0,128,128,0,0,0,0,128,0,0,0,0,128],u=function(){function e(e){this._samplers={},this._device=e,this.disabled=!1}return e.GetSamplerHashCode=function(e){var t,r,i,n=e._cachedAnisotropicFilteringLevel&&e._cachedAnisotropicFilteringLevel>1?4:1;return s[e.samplingMode]+o[(e._comparisonFunction||514)-512+1]+a[e.samplingMode]+((null!==(t=e._cachedWrapU)&&void 0!==t?t:1)<<8)+((null!==(r=e._cachedWrapV)&&void 0!==r?r:1)<<10)+((null!==(i=e._cachedWrapR)&&void 0!==i?i:1)<<12)+((e.useMipMaps?1:0)<<14)+(n<<15)},e._GetSamplerFilterDescriptor=function(e,t){var r,i,s,o,a,u=e.useMipMaps;switch(e.samplingMode){case 11:r=n.X9.Linear,i=n.X9.Linear,s=n.X9.Nearest,u||(o=a=0);break;case 3:case 3:r=n.X9.Linear,i=n.X9.Linear,u?s=n.X9.Linear:(s=n.X9.Nearest,o=a=0);break;case 8:r=n.X9.Nearest,i=n.X9.Nearest,u?s=n.X9.Linear:(s=n.X9.Nearest,o=a=0);break;case 4:r=n.X9.Nearest,i=n.X9.Nearest,s=n.X9.Nearest,u||(o=a=0);break;case 5:r=n.X9.Nearest,i=n.X9.Linear,s=n.X9.Nearest,u||(o=a=0);break;case 6:r=n.X9.Nearest,i=n.X9.Linear,u?s=n.X9.Linear:(s=n.X9.Nearest,o=a=0);break;case 7:r=n.X9.Nearest,i=n.X9.Linear,s=n.X9.Nearest,o=a=0;break;case 1:case 1:default:r=n.X9.Nearest,i=n.X9.Nearest,s=n.X9.Nearest,o=a=0;break;case 9:r=n.X9.Linear,i=n.X9.Nearest,s=n.X9.Nearest,u||(o=a=0);break;case 10:r=n.X9.Linear,i=n.X9.Nearest,u?s=n.X9.Linear:(s=n.X9.Nearest,o=a=0);break;case 2:case 2:r=n.X9.Linear,i=n.X9.Linear,s=n.X9.Nearest,o=a=0;break;case 12:r=n.X9.Linear,i=n.X9.Nearest,s=n.X9.Nearest,o=a=0}return t>1&&(0!==o||0!==a)?{magFilter:n.X9.Linear,minFilter:n.X9.Linear,mipmapFilter:n.X9.Linear,anisotropyEnabled:!0}:{magFilter:r,minFilter:i,mipmapFilter:s,lodMinClamp:o,lodMaxClamp:a}},e._GetWrappingMode=function(e){switch(e){case 1:return n.OB.Repeat;case 0:return n.OB.ClampToEdge;case 2:return n.OB.MirrorRepeat}return n.OB.Repeat},e._GetSamplerWrappingDescriptor=function(e){return{addressModeU:this._GetWrappingMode(e._cachedWrapU),addressModeV:this._GetWrappingMode(e._cachedWrapV),addressModeW:this._GetWrappingMode(e._cachedWrapR)}},e._GetSamplerDescriptor=function(t){var r=t.useMipMaps&&t._cachedAnisotropicFilteringLevel&&t._cachedAnisotropicFilteringLevel>1?4:1,n=this._GetSamplerFilterDescriptor(t,r);return(0,i.pi)((0,i.pi)((0,i.pi)({},n),this._GetSamplerWrappingDescriptor(t)),{compare:t._comparisonFunction?e.GetCompareFunction(t._comparisonFunction):void 0,maxAnisotropy:n.anisotropyEnabled?r:1})},e.GetCompareFunction=function(e){switch(e){case 519:return n.wb.Always;case 514:return n.wb.Equal;case 516:return n.wb.Greater;case 518:return n.wb.GreaterEqual;case 513:default:return n.wb.Less;case 515:return n.wb.LessEqual;case 512:return n.wb.Never;case 517:return n.wb.NotEqual}},e.prototype.getSampler=function(t,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=0),this.disabled)return this._device.createSampler(e._GetSamplerDescriptor(t));r?i=0:0===i&&(i=e.GetSamplerHashCode(t));var n=r?void 0:this._samplers[i];return n||(n=this._device.createSampler(e._GetSamplerDescriptor(t)),r||(this._samplers[i]=n)),n},e}()},62274:(e,t,r)=>{r.d(t,{T:()=>o});var i=r(85801),n=r(94274),s=r(72089),o=(r(48736),r(72731),function(){function e(e,t,r){this._bindGroups={},this._bundleCache={},this._keyTemp=[],this._device=e,this._engine=t,this._cacheRenderPipeline=new i.H(this._device,r,!t._caps.textureFloatLinearFiltering),this._cacheRenderPipeline.setDepthTestEnabled(!1),this._cacheRenderPipeline.setStencilReadMask(255),this._effect=t.createEffect("clearQuad",[],["color","depthValue"])}return e.prototype.setDepthStencilFormat=function(e){this._depthTextureFormat=e,this._cacheRenderPipeline.setDepthStencilFormat(e)},e.prototype.setColorFormat=function(e){this._cacheRenderPipeline.setColorFormat(e)},e.prototype.setMRTAttachments=function(e,t,r){this._cacheRenderPipeline.setMRT(t,r),this._cacheRenderPipeline.setMRTAttachments(e)},e.prototype.clear=function(e,t,r,i,o){var a,u,c;void 0===o&&(o=1);var l,h=null,p=!!this._engine._currentRenderTarget;if(e)c=e;else{var d=0;this._keyTemp.length=0;for(var _=0;_<this._cacheRenderPipeline.colorFormats.length;++_)this._keyTemp[d++]=s.U[null!==(a=this._cacheRenderPipeline.colorFormats[_])&&void 0!==a?a:""];var f=s.U[null!==(u=this._depthTextureFormat)&&void 0!==u?u:0];if(this._keyTemp[d]=(t?t.r+256*t.g+256*t.b*256+256*t.a*256*256:0)+(r?Math.pow(2,32):0)+(i?Math.pow(2,33):0)+(this._engine.useReverseDepthBuffer?Math.pow(2,34):0)+(p?Math.pow(2,35):0)+(o>1?Math.pow(2,36):0)+f*Math.pow(2,37),l=this._keyTemp.join("_"),h=this._bundleCache[l])return h;c=this._device.createRenderBundleEncoder({colorFormats:this._cacheRenderPipeline.colorFormats,depthStencilFormat:this._depthTextureFormat,sampleCount:o})}this._cacheRenderPipeline.setDepthWriteEnabled(!!r),this._cacheRenderPipeline.setStencilEnabled(!!i&&!!this._depthTextureFormat&&s.D.HasStencilAspect(this._depthTextureFormat)),this._cacheRenderPipeline.setStencilWriteMask(i?255:0),this._cacheRenderPipeline.setStencilCompare(i?519:512),this._cacheRenderPipeline.setStencilPassOp(i?7681:7680),this._cacheRenderPipeline.setWriteMask(t?15:0);var g=this._cacheRenderPipeline.getRenderPipeline(7,this._effect,o),m=this._effect._pipelineContext;t&&this._effect.setDirectColor4("color",t),this._effect.setFloat("depthValue",this._engine.useReverseDepthBuffer?this._engine._clearReverseDepthValue:this._engine._clearDepthValue),m.uniformBuffer.update();var E=p?this._engine._ubInvertY:this._engine._ubDontInvertY,v=m.uniformBuffer.getBuffer(),T=v.uniqueId+"-"+E.uniqueId,y=this._bindGroups[T];if(!y){var b=m.bindGroupLayouts;(y=this._bindGroups[T]=[]).push(this._device.createBindGroup({layout:b[0],entries:[]})),n.d._SimplifiedKnownBindings||y.push(this._device.createBindGroup({layout:b[1],entries:[]})),y.push(this._device.createBindGroup({layout:b[n.d._SimplifiedKnownBindings?1:2],entries:[{binding:0,resource:{buffer:E.underlyingResource,size:E.capacity}},{binding:1,resource:{buffer:v.underlyingResource,size:v.capacity}}]}))}c.setPipeline(g);for(_=0;_<y.length;++_)c.setBindGroup(_,y[_]);return c.draw(4,1,0,0),e||(h=c.finish(),this._bundleCache[l]=h),h},e}())},8724:(e,t,r)=>{var i,n,s,o,a,u,c,l,h,p,d,_,f,g,m,E,v,T,y,b,x,S,R,A,C,B,P,I,D,F,U,w,L,M,O,G,N,V;r.d(t,{$X:()=>g,EG:()=>M,EV:()=>p,FB:()=>o,Gt:()=>T,H7:()=>h,HR:()=>U,Ie:()=>A,OB:()=>d,Rs:()=>m,V:()=>F,Wf:()=>R,Ws:()=>L,X9:()=>_,YV:()=>x,au:()=>w,cM:()=>n,dV:()=>E,db:()=>B,eS:()=>s,fu:()=>b,gB:()=>D,gc:()=>a,iD:()=>I,ju:()=>i,kd:()=>u,lx:()=>V,mj:()=>y,nw:()=>G,oD:()=>v,p_:()=>l,v2:()=>c,wS:()=>N,wb:()=>f,xL:()=>O,xS:()=>P,zX:()=>S,zi:()=>C}),function(e){e.SRGB="srgb"}(i||(i={})),function(e){e.LowPower="low-power",e.HighPerformance="high-performance"}(n||(n={})),function(e){e.DepthClipControl="depth-clip-control",e.Depth24UnormStencil8="depth24unorm-stencil8",e.Depth32FloatStencil8="depth32float-stencil8",e.TextureCompressionBC="texture-compression-bc",e.TextureCompressionETC2="texture-compression-etc2",e.TextureCompressionASTC="texture-compression-astc",e.TimestampQuery="timestamp-query",e.IndirectFirstInstance="indirect-first-instance",e.ShaderF16="shader-f16",e.BGRA8UnormStorage="bgra8unorm-storage"}(s||(s={})),function(e){e[e.MapRead=1]="MapRead",e[e.MapWrite=2]="MapWrite",e[e.CopySrc=4]="CopySrc",e[e.CopyDst=8]="CopyDst",e[e.Index=16]="Index",e[e.Vertex=32]="Vertex",e[e.Uniform=64]="Uniform",e[e.Storage=128]="Storage",e[e.Indirect=256]="Indirect",e[e.QueryResolve=512]="QueryResolve"}(o||(o={})),function(e){e[e.Read=1]="Read",e[e.Write=2]="Write"}(a||(a={})),function(e){e.E1d="1d",e.E2d="2d",e.E3d="3d"}(u||(u={})),function(e){e[e.CopySrc=1]="CopySrc",e[e.CopyDst=2]="CopyDst",e[e.TextureBinding=4]="TextureBinding",e[e.StorageBinding=8]="StorageBinding",e[e.RenderAttachment=16]="RenderAttachment"}(c||(c={})),function(e){e.E1d="1d",e.E2d="2d",e.E2dArray="2d-array",e.Cube="cube",e.CubeArray="cube-array",e.E3d="3d"}(l||(l={})),function(e){e.All="all",e.StencilOnly="stencil-only",e.DepthOnly="depth-only"}(h||(h={})),function(e){e.R8Unorm="r8unorm",e.R8Snorm="r8snorm",e.R8Uint="r8uint",e.R8Sint="r8sint",e.R16Uint="r16uint",e.R16Sint="r16sint",e.R16Float="r16float",e.RG8Unorm="rg8unorm",e.RG8Snorm="rg8snorm",e.RG8Uint="rg8uint",e.RG8Sint="rg8sint",e.R32Uint="r32uint",e.R32Sint="r32sint",e.R32Float="r32float",e.RG16Uint="rg16uint",e.RG16Sint="rg16sint",e.RG16Float="rg16float",e.RGBA8Unorm="rgba8unorm",e.RGBA8UnormSRGB="rgba8unorm-srgb",e.RGBA8Snorm="rgba8snorm",e.RGBA8Uint="rgba8uint",e.RGBA8Sint="rgba8sint",e.BGRA8Unorm="bgra8unorm",e.BGRA8UnormSRGB="bgra8unorm-srgb",e.RGB9E5UFloat="rgb9e5ufloat",e.RGB10A2Unorm="rgb10a2unorm",e.RG11B10UFloat="rg11b10ufloat",e.RG32Uint="rg32uint",e.RG32Sint="rg32sint",e.RG32Float="rg32float",e.RGBA16Uint="rgba16uint",e.RGBA16Sint="rgba16sint",e.RGBA16Float="rgba16float",e.RGBA32Uint="rgba32uint",e.RGBA32Sint="rgba32sint",e.RGBA32Float="rgba32float",e.Stencil8="stencil8",e.Depth16Unorm="depth16unorm",e.Depth24Plus="depth24plus",e.Depth24PlusStencil8="depth24plus-stencil8",e.Depth32Float="depth32float",e.BC1RGBAUnorm="bc1-rgba-unorm",e.BC1RGBAUnormSRGB="bc1-rgba-unorm-srgb",e.BC2RGBAUnorm="bc2-rgba-unorm",e.BC2RGBAUnormSRGB="bc2-rgba-unorm-srgb",e.BC3RGBAUnorm="bc3-rgba-unorm",e.BC3RGBAUnormSRGB="bc3-rgba-unorm-srgb",e.BC4RUnorm="bc4-r-unorm",e.BC4RSnorm="bc4-r-snorm",e.BC5RGUnorm="bc5-rg-unorm",e.BC5RGSnorm="bc5-rg-snorm",e.BC6HRGBUFloat="bc6h-rgb-ufloat",e.BC6HRGBFloat="bc6h-rgb-float",e.BC7RGBAUnorm="bc7-rgba-unorm",e.BC7RGBAUnormSRGB="bc7-rgba-unorm-srgb",e.ETC2RGB8Unorm="etc2-rgb8unorm",e.ETC2RGB8UnormSRGB="etc2-rgb8unorm-srgb",e.ETC2RGB8A1Unorm="etc2-rgb8a1unorm",e.ETC2RGB8A1UnormSRGB="etc2-rgb8a1unorm-srgb",e.ETC2RGBA8Unorm="etc2-rgba8unorm",e.ETC2RGBA8UnormSRGB="etc2-rgba8unorm-srgb",e.EACR11Unorm="eac-r11unorm",e.EACR11Snorm="eac-r11snorm",e.EACRG11Unorm="eac-rg11unorm",e.EACRG11Snorm="eac-rg11snorm",e.ASTC4x4Unorm="astc-4x4-unorm",e.ASTC4x4UnormSRGB="astc-4x4-unorm-srgb",e.ASTC5x4Unorm="astc-5x4-unorm",e.ASTC5x4UnormSRGB="astc-5x4-unorm-srgb",e.ASTC5x5Unorm="astc-5x5-unorm",e.ASTC5x5UnormSRGB="astc-5x5-unorm-srgb",e.ASTC6x5Unorm="astc-6x5-unorm",e.ASTC6x5UnormSRGB="astc-6x5-unorm-srgb",e.ASTC6x6Unorm="astc-6x6-unorm",e.ASTC6x6UnormSRGB="astc-6x6-unorm-srgb",e.ASTC8x5Unorm="astc-8x5-unorm",e.ASTC8x5UnormSRGB="astc-8x5-unorm-srgb",e.ASTC8x6Unorm="astc-8x6-unorm",e.ASTC8x6UnormSRGB="astc-8x6-unorm-srgb",e.ASTC8x8Unorm="astc-8x8-unorm",e.ASTC8x8UnormSRGB="astc-8x8-unorm-srgb",e.ASTC10x5Unorm="astc-10x5-unorm",e.ASTC10x5UnormSRGB="astc-10x5-unorm-srgb",e.ASTC10x6Unorm="astc-10x6-unorm",e.ASTC10x6UnormSRGB="astc-10x6-unorm-srgb",e.ASTC10x8Unorm="astc-10x8-unorm",e.ASTC10x8UnormSRGB="astc-10x8-unorm-srgb",e.ASTC10x10Unorm="astc-10x10-unorm",e.ASTC10x10UnormSRGB="astc-10x10-unorm-srgb",e.ASTC12x10Unorm="astc-12x10-unorm",e.ASTC12x10UnormSRGB="astc-12x10-unorm-srgb",e.ASTC12x12Unorm="astc-12x12-unorm",e.ASTC12x12UnormSRGB="astc-12x12-unorm-srgb",e.Depth24UnormStencil8="depth24unorm-stencil8",e.Depth32FloatStencil8="depth32float-stencil8"}(p||(p={})),function(e){e.ClampToEdge="clamp-to-edge",e.Repeat="repeat",e.MirrorRepeat="mirror-repeat"}(d||(d={})),function(e){e.Nearest="nearest",e.Linear="linear"}(_||(_={})),function(e){e.Never="never",e.Less="less",e.Equal="equal",e.LessEqual="less-equal",e.Greater="greater",e.NotEqual="not-equal",e.GreaterEqual="greater-equal",e.Always="always"}(f||(f={})),function(e){e[e.Vertex=1]="Vertex",e[e.Fragment=2]="Fragment",e[e.Compute=4]="Compute"}(g||(g={})),function(e){e.Uniform="uniform",e.Storage="storage",e.ReadOnlyStorage="read-only-storage"}(m||(m={})),function(e){e.Filtering="filtering",e.NonFiltering="non-filtering",e.Comparison="comparison"}(E||(E={})),function(e){e.Float="float",e.UnfilterableFloat="unfilterable-float",e.Depth="depth",e.Sint="sint",e.Uint="uint"}(v||(v={})),function(e){e.WriteOnly="write-only"}(T||(T={})),function(e){e.Error="error",e.Warning="warning",e.Info="info"}(y||(y={})),function(e){e.Auto="auto"}(b||(b={})),function(e){e.PointList="point-list",e.LineList="line-list",e.LineStrip="line-strip",e.TriangleList="triangle-list",e.TriangleStrip="triangle-strip"}(x||(x={})),function(e){e.CCW="ccw",e.CW="cw"}(S||(S={})),function(e){e.None="none",e.Front="front",e.Back="back"}(R||(R={})),function(e){e[e.Red=1]="Red",e[e.Green=2]="Green",e[e.Blue=4]="Blue",e[e.Alpha=8]="Alpha",e[e.All=15]="All"}(A||(A={})),function(e){e.Zero="zero",e.One="one",e.Src="src",e.OneMinusSrc="one-minus-src",e.SrcAlpha="src-alpha",e.OneMinusSrcAlpha="one-minus-src-alpha",e.Dst="dst",e.OneMinusDst="one-minus-dst",e.DstAlpha="dst-alpha",e.OneMinusDstAlpha="one-minus-dst-alpha",e.SrcAlphaSaturated="src-alpha-saturated",e.Constant="constant",e.OneMinusConstant="one-minus-constant"}(C||(C={})),function(e){e.Add="add",e.Subtract="subtract",e.ReverseSubtract="reverse-subtract",e.Min="min",e.Max="max"}(B||(B={})),function(e){e.Keep="keep",e.Zero="zero",e.Replace="replace",e.Invert="invert",e.IncrementClamp="increment-clamp",e.DecrementClamp="decrement-clamp",e.IncrementWrap="increment-wrap",e.DecrementWrap="decrement-wrap"}(P||(P={})),function(e){e.Uint16="uint16",e.Uint32="uint32"}(I||(I={})),function(e){e.Uint8x2="uint8x2",e.Uint8x4="uint8x4",e.Sint8x2="sint8x2",e.Sint8x4="sint8x4",e.Unorm8x2="unorm8x2",e.Unorm8x4="unorm8x4",e.Snorm8x2="snorm8x2",e.Snorm8x4="snorm8x4",e.Uint16x2="uint16x2",e.Uint16x4="uint16x4",e.Sint16x2="sint16x2",e.Sint16x4="sint16x4",e.Unorm16x2="unorm16x2",e.Unorm16x4="unorm16x4",e.Snorm16x2="snorm16x2",e.Snorm16x4="snorm16x4",e.Float16x2="float16x2",e.Float16x4="float16x4",e.Float32="float32",e.Float32x2="float32x2",e.Float32x3="float32x3",e.Float32x4="float32x4",e.Uint32="uint32",e.Uint32x2="uint32x2",e.Uint32x3="uint32x3",e.Uint32x4="uint32x4",e.Sint32="sint32",e.Sint32x2="sint32x2",e.Sint32x3="sint32x3",e.Sint32x4="sint32x4"}(D||(D={})),function(e){e.Vertex="vertex",e.Instance="instance"}(F||(F={})),function(e){e.Beginning="beginning",e.End="end"}(U||(U={})),function(e){e.Beginning="beginning",e.End="end"}(w||(w={})),function(e){e.Load="load",e.Clear="clear"}(L||(L={})),function(e){e.Store="store",e.Discard="discard"}(M||(M={})),function(e){e.Occlusion="occlusion",e.Timestamp="timestamp"}(O||(O={})),function(e){e.Opaque="opaque",e.Premultiplied="premultiplied"}(G||(G={})),function(e){e.Destroyed="destroyed"}(N||(N={})),function(e){e.OutOfMemory="out-of-memory",e.Validation="validation"}(V||(V={}))},58203:(e,t,r)=>{r.d(t,{K:()=>n});var i=r(31191),n=function(e){function t(t){var r=e.call(this,!1)||this;return r._cache=t,r.reset(),r}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0,this._cache.setDepthBiasSlopeScale(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zOffsetUnits",{get:function(){return this._zOffsetUnits},set:function(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0,this._cache.setDepthBias(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0,this._cache.setCullFace(null!=e?e:1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0,this._cache.setCullEnabled(!!e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0,this._cache.setDepthCompare(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0,this._cache.setDepthWriteEnabled(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0,this._cache.setDepthTestEnabled(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0,this._cache.setFrontFace(null!=e?e:2))},enumerable:!1,configurable:!0}),t.prototype.reset=function(){e.prototype.reset.call(this),this._cache.resetDepthCullingState()},t.prototype.apply=function(){},t}(r(29507).k)},59345:(e,t,r)=>{r.d(t,{g:()=>n});var i=r(8724),n=function(){function e(t){this._bufferManager=t,this.uniqueId=e._Counter++,this._useInstancing=!1,this._currentInstanceCount=0,this.reset()}return e.prototype.isDirty=function(e){return this._isDirty||this._materialContextUpdateId!==e},e.prototype.resetIsDirty=function(e){this._isDirty=!1,this._materialContextUpdateId=e},Object.defineProperty(e.prototype,"useInstancing",{get:function(){return this._useInstancing},set:function(e){this._useInstancing!==e&&(e?(this.indirectDrawBuffer=this._bufferManager.createRawBuffer(40,i.FB.CopyDst|i.FB.Indirect),this._indirectDrawData=new Uint32Array(5),this._indirectDrawData[3]=0,this._indirectDrawData[4]=0):(this.indirectDrawBuffer&&this._bufferManager.releaseBuffer(this.indirectDrawBuffer),this.indirectDrawBuffer=void 0,this._indirectDrawData=void 0),this._useInstancing=e,this._currentInstanceCount=-1)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.buffers={},this._isDirty=!0,this._materialContextUpdateId=0,this.fastBundle=void 0,this.bindGroups=void 0},e.prototype.setBuffer=function(e,t){var r;this._isDirty||(this._isDirty=(null==t?void 0:t.uniqueId)!==(null===(r=this.buffers[e])||void 0===r?void 0:r.uniqueId)),this.buffers[e]=t},e.prototype.setIndirectData=function(e,t,r){t!==this._currentInstanceCount&&this.indirectDrawBuffer&&this._indirectDrawData&&(this._currentInstanceCount=t,this._indirectDrawData[0]=e,this._indirectDrawData[1]=t,this._indirectDrawData[2]=r,this._bufferManager.setRawData(this.indirectDrawBuffer,0,this._indirectDrawData,0,20))},e.prototype.dispose=function(){this.indirectDrawBuffer&&(this._bufferManager.releaseBuffer(this.indirectDrawBuffer),this.indirectDrawBuffer=void 0,this._indirectDrawData=void 0),this.fastBundle=void 0,this.bindGroups=void 0,this.buffers=void 0},e._Counter=0,e}()},19015:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(7949),n=r(72739),s=r(8724),o=function(){function e(e){void 0===e&&(e=null),this.format=s.EV.RGBA8Unorm,this.textureUsages=0,this.textureAdditionalUsages=0,this._webgpuTexture=e,this._webgpuMSAATexture=null,this.view=null,this.viewForWriting=null}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return this._webgpuTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"msaaTexture",{get:function(){return this._webgpuMSAATexture},set:function(e){this._webgpuMSAATexture=e},enumerable:!1,configurable:!0}),e.prototype.set=function(e){this._webgpuTexture=e},e.prototype.setUsage=function(e,t,r,o,a){t=e!==i.S.RenderTarget&&t,this.createView({format:this.format,dimension:r?s.p_.Cube:s.p_.E2d,mipLevelCount:t?n.R.ILog2(Math.max(o,a))+1:1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:r?6:1,aspect:s.H7.All})},e.prototype.createView=function(e,t){if(void 0===t&&(t=!1),this.view=this._webgpuTexture.createView(e),t&&e){var r=e.mipLevelCount;e.mipLevelCount=1,this.viewForWriting=this._webgpuTexture.createView(e),e.mipLevelCount=r}},e.prototype.reset=function(){this._webgpuTexture=null,this._webgpuMSAATexture=null,this.view=null,this.viewForWriting=null},e.prototype.release=function(){var e,t,r;null===(e=this._webgpuTexture)||void 0===e||e.destroy(),null===(t=this._webgpuMSAATexture)||void 0===t||t.destroy(),null===(r=this._copyInvertYTempTexture)||void 0===r||r.destroy(),this.reset()},e}()},9460:(e,t,r)=>{r.d(t,{D:()=>s});var i=r(44919),n=r(20955),s=function(){function e(){this.uniqueId=e._Counter++,this.updateId=0,this.reset()}return Object.defineProperty(e.prototype,"forceBindGroupCreation",{get:function(){return this._numExternalTextures>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasFloatTextures",{get:function(){return this._numFloatTextures>0},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.samplers={},this.textures={},this.isDirty=!0,this._numFloatTextures=0,this._numExternalTextures=0},e.prototype.setSampler=function(e,t){var r=this.samplers[e],i=-1;r?i=r.hashCode:this.samplers[e]=r={sampler:t,hashCode:0},r.sampler=t,r.hashCode=t?n.W.GetSamplerHashCode(t):0;var s=i!==r.hashCode;s&&this.updateId++,this.isDirty||(this.isDirty=s)},e.prototype.setTexture=function(e,t){var r,n,s,o=this.textures[e],a=-1;o?a=null!==(n=null===(r=o.texture)||void 0===r?void 0:r.uniqueId)&&void 0!==n?n:-1:this.textures[e]=o={texture:t,isFloatTexture:!1,isExternalTexture:!1},o.isExternalTexture&&this._numExternalTextures--,o.isFloatTexture&&this._numFloatTextures--,t?(o.isFloatTexture=1===t.type,o.isExternalTexture=i.x.IsExternalTexture(t),o.isFloatTexture&&this._numFloatTextures++,o.isExternalTexture&&this._numExternalTextures++):(o.isFloatTexture=!1,o.isExternalTexture=!1),o.texture=t;var u=a!==(null!==(s=null==t?void 0:t.uniqueId)&&void 0!==s?s:-1);u&&this.updateId++,this.isDirty||(this.isDirty=u)},e._Counter=0,e}()},85900:(e,t,r)=>{r.d(t,{D:()=>s});var i=r(8724),n=r(22812),s=function(){function e(e,t,r,i,n){void 0===i&&(i=50),void 0===n&&(n=100),this._availableIndices=[],this._engine=e,this._device=t,this._bufferManager=r,this._frameLastBuffer=-1,this._currentTotalIndices=0,this._countIncrement=n,this._allocateNewIndices(i)}return Object.defineProperty(e.prototype,"querySet",{get:function(){return this._querySet.querySet},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasQueries",{get:function(){return this._currentTotalIndices!==this._availableIndices.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canBeginQuery",{get:function(){switch(this._engine._getCurrentRenderPassIndex()){case 0:return void 0!==this._engine._mainRenderPassWrapper.renderPassDescriptor.occlusionQuerySet;case 1:return void 0!==this._engine._rttRenderPassWrapper.renderPassDescriptor.occlusionQuerySet}return!1},enumerable:!1,configurable:!0}),e.prototype.createQuery=function(){0===this._availableIndices.length&&this._allocateNewIndices();var e=this._availableIndices[this._availableIndices.length-1];return this._availableIndices.length--,e},e.prototype.deleteQuery=function(e){this._availableIndices[this._availableIndices.length-1]=e},e.prototype.isQueryResultAvailable=function(e){return this._retrieveQueryBuffer(),!!this._lastBuffer&&e<this._lastBuffer.length},e.prototype.getQueryResult=function(e){var t,r;return Number(null!==(r=null===(t=this._lastBuffer)||void 0===t?void 0:t[e])&&void 0!==r?r:-1)},e.prototype._retrieveQueryBuffer=function(){var e=this;this._lastBuffer&&this._frameLastBuffer===this._engine.frameId||this._frameLastBuffer!==this._engine.frameId&&(this._frameLastBuffer=this._engine.frameId,this._querySet.readValues(0,this._currentTotalIndices).then((function(t){e._lastBuffer=t})))},e.prototype._allocateNewIndices=function(e){e=null!=e?e:this._countIncrement,this._delayQuerySetDispose();for(var t=0;t<e;++t)this._availableIndices.push(this._currentTotalIndices+t);this._currentTotalIndices+=e,this._querySet=new n.t(this._currentTotalIndices,i.xL.Occlusion,this._device,this._bufferManager,!1)},e.prototype._delayQuerySetDispose=function(){var e=this._querySet;e&&setTimeout((function(){return e.dispose}),1e3)},e.prototype.dispose=function(){var e;null===(e=this._querySet)||void 0===e||e.dispose(),this._availableIndices=[]},e}()},88934:(e,t,r)=>{r.d(t,{$:()=>s});var i=r(83353),n=r(50113),s=function(){function e(e,t){this._name="unnamed",this.shaderProcessingContext=e,this._leftOverUniformsByName={},this.engine=t}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.stages},enumerable:!1,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(){},e.prototype._fillEffectInformation=function(e,t,r,i,n,s,o,a){var u=this.engine;e._fragmentSourceCode="",e._vertexSourceCode="";var c,l=this.shaderProcessingContext.availableTextures;for(c=0;c<n.length;c++){var h=n[c],p=l[n[c]];null==p||null==p?(n.splice(c,1),c--):s[h]=c}for(var d=0,_=u.getAttributes(this,o);d<_.length;d++){var f=_[d];a.push(f)}this.buildUniformLayout();var g=[],m=[];for(c=0;c<o.length;c++){var E=a[c];E>=0&&(g.push(o[c]),m.push(E))}this.shaderProcessingContext.attributeNamesFromEffect=g,this.shaderProcessingContext.attributeLocationsFromEffect=m},e.prototype.buildUniformLayout=function(){if(this.shaderProcessingContext.leftOverUniforms.length){this.uniformBuffer=new i.M(this.engine,void 0,void 0,"leftOver-"+this._name);for(var e=0,t=this.shaderProcessingContext.leftOverUniforms;e<t.length;e++){var r=t[e],s=r.type.replace(/^(.*?)(<.*>)?$/,"$1"),o=n.e.UniformSizes[s];this.uniformBuffer.addUniform(r.name,o,r.length),this._leftOverUniformsByName[r.name]=r.type}this.uniformBuffer.create()}},e.prototype.dispose=function(){this.uniformBuffer&&this.uniformBuffer.dispose()},e.prototype.setInt=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateInt(e,t)},e.prototype.setInt2=function(e,t,r){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateInt2(e,t,r)},e.prototype.setInt3=function(e,t,r,i){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateInt3(e,t,r,i)},e.prototype.setInt4=function(e,t,r,i,n){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateInt4(e,t,r,i,n)},e.prototype.setIntArray=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateIntArray(e,t)},e.prototype.setIntArray2=function(e,t){this.setIntArray(e,t)},e.prototype.setIntArray3=function(e,t){this.setIntArray(e,t)},e.prototype.setIntArray4=function(e,t){this.setIntArray(e,t)},e.prototype.setArray=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateArray(e,t)},e.prototype.setArray2=function(e,t){this.setArray(e,t)},e.prototype.setArray3=function(e,t){this.setArray(e,t)},e.prototype.setArray4=function(e,t){this.setArray(e,t)},e.prototype.setMatrices=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateMatrices(e,t)},e.prototype.setMatrix=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateMatrix(e,t)},e.prototype.setMatrix3x3=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateMatrix3x3(e,t)},e.prototype.setMatrix2x2=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateMatrix2x2(e,t)},e.prototype.setFloat=function(e,t){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateFloat(e,t)},e.prototype.setVector2=function(e,t){this.setFloat2(e,t.x,t.y)},e.prototype.setFloat2=function(e,t,r){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateFloat2(e,t,r)},e.prototype.setVector3=function(e,t){this.setFloat3(e,t.x,t.y,t.z)},e.prototype.setFloat3=function(e,t,r,i){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateFloat3(e,t,r,i)},e.prototype.setVector4=function(e,t){this.setFloat4(e,t.x,t.y,t.z,t.w)},e.prototype.setQuaternion=function(e,t){this.setFloat4(e,t.x,t.y,t.z,t.w)},e.prototype.setFloat4=function(e,t,r,i,n){this.uniformBuffer&&this._leftOverUniformsByName[e]&&this.uniformBuffer.updateFloat4(e,t,r,i,n)},e.prototype.setColor3=function(e,t){this.setFloat3(e,t.r,t.g,t.b)},e.prototype.setColor4=function(e,t,r){this.setFloat4(e,t.r,t.g,t.b,r)},e.prototype.setDirectColor4=function(e,t){this.setFloat4(e,t.r,t.g,t.b,t.a)},e.prototype._getVertexShaderCode=function(){var e;return null===(e=this.sources)||void 0===e?void 0:e.vertex},e.prototype._getFragmentShaderCode=function(){var e;return null===(e=this.sources)||void 0===e?void 0:e.fragment},e}()},22812:(e,t,r)=>{r.d(t,{t:()=>s});var i=r(31191),n=r(8724),s=function(){function e(e,t,r,i,s){void 0===s&&(s=!0),this._dstBuffers=[],this._device=r,this._bufferManager=i,this._count=e,this._canUseMultipleBuffers=s,this._querySet=r.createQuerySet({type:t,count:e}),this._queryBuffer=i.createRawBuffer(8*e,n.FB.QueryResolve|n.FB.CopySrc),s||this._dstBuffers.push(this._bufferManager.createRawBuffer(8*this._count,n.FB.MapRead|n.FB.CopyDst))}return Object.defineProperty(e.prototype,"querySet",{get:function(){return this._querySet},enumerable:!1,configurable:!0}),e.prototype._getBuffer=function(e,t){if(!this._canUseMultipleBuffers&&0===this._dstBuffers.length)return null;var r,i=this._device.createCommandEncoder();return 0===this._dstBuffers.length?r=this._bufferManager.createRawBuffer(8*this._count,n.FB.MapRead|n.FB.CopyDst):(r=this._dstBuffers[this._dstBuffers.length-1],this._dstBuffers.length--),i.resolveQuerySet(this._querySet,e,t,this._queryBuffer,0),i.copyBufferToBuffer(this._queryBuffer,0,r,0,8*t),this._device.queue.submit([i.finish()]),r},e.prototype.readValues=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=1),(0,i.mG)(this,void 0,void 0,(function(){var r,s;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return null===(r=this._getBuffer(e,t))?[2,null]:[4,r.mapAsync(n.gc.Read)];case 1:return i.sent(),s=new BigUint64Array(r.getMappedRange()).slice(),r.unmap(),this._dstBuffers[this._dstBuffers.length]=r,[2,s]}}))}))},e.prototype.readValue=function(e){return void 0===e&&(e=0),(0,i.mG)(this,void 0,void 0,(function(){var t,r,s;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return null===(t=this._getBuffer(e,1))?[2,null]:[4,t.mapAsync(n.gc.Read)];case 1:return i.sent(),r=new BigUint64Array(t.getMappedRange()),s=Number(r[0]),t.unmap(),this._dstBuffers[this._dstBuffers.length]=t,[2,s]}}))}))},e.prototype.readTwoValuesAndSubtract=function(e){return void 0===e&&(e=0),(0,i.mG)(this,void 0,void 0,(function(){var t,r,s;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return null===(t=this._getBuffer(e,2))?[2,null]:[4,t.mapAsync(n.gc.Read)];case 1:return i.sent(),r=new BigUint64Array(t.getMappedRange()),s=Number(r[1]-r[0]),t.unmap(),this._dstBuffers[this._dstBuffers.length]=t,[2,s]}}))}))},e.prototype.dispose=function(){this._querySet.destroy(),this._bufferManager.releaseBuffer(this._queryBuffer);for(var e=0;e<this._dstBuffers.length;++e)this._bufferManager.releaseBuffer(this._dstBuffers[e])},e}()},54231:(e,t,r)=>{r.d(t,{B:()=>i});var i=function(){function e(){this.colorAttachmentGPUTextures=[],this.reset()}return e.prototype.reset=function(e){void 0===e&&(e=!1),this.renderPass=null,e&&(this.renderPassDescriptor=null,this.colorAttachmentViewDescriptor=null,this.depthAttachmentViewDescriptor=null,this.colorAttachmentGPUTextures=[],this.depthTextureFormat=void 0)},e}()},94274:(e,t,r)=>{r.d(t,{d:()=>n});var i={mat2:2,mat3:3,mat4:4,mat2x2:2,mat3x3:3,mat4x4:4},n=function(){function e(e){this.shaderLanguage=e,this._attributeNextLocation=0,this._varyingNextLocation=0,this.freeGroupIndex=0,this.freeBindingIndex=0,this.availableVaryings={},this.availableAttributes={},this.availableBuffers={},this.availableTextures={},this.availableSamplers={},this.orderedAttributes=[],this.bindGroupLayoutEntries=[],this.bindGroupLayoutEntryInfo=[],this.bindGroupEntries=[],this.bufferNames=[],this.textureNames=[],this.samplerNames=[],this.leftOverUniforms=[],this._findStartingGroupBinding()}return Object.defineProperty(e,"KnownUBOs",{get:function(){return e._SimplifiedKnownBindings?e._SimplifiedKnownUBOs:e._KnownUBOs},enumerable:!1,configurable:!0}),e.prototype._findStartingGroupBinding=function(){var t=e.KnownUBOs,r=[];for(var i in t){var n=t[i].binding;-1!==n.groupIndex&&(void 0===r[n.groupIndex]?r[n.groupIndex]=n.bindingIndex:r[n.groupIndex]=Math.max(r[n.groupIndex],n.bindingIndex))}this.freeGroupIndex=r.length-1,0===this.freeGroupIndex?(this.freeGroupIndex++,this.freeBindingIndex=0):this.freeBindingIndex=r[r.length-1]+1},e.prototype.getAttributeNextLocation=function(e,t){var r;void 0===t&&(t=0);var n=this._attributeNextLocation;return this._attributeNextLocation+=(null!==(r=i[e])&&void 0!==r?r:1)*(t||1),n},e.prototype.getVaryingNextLocation=function(e,t){var r;void 0===t&&(t=0);var n=this._varyingNextLocation;return this._varyingNextLocation+=(null!==(r=i[e])&&void 0!==r?r:1)*(t||1),n},e.prototype.getNextFreeUBOBinding=function(){return this._getNextFreeBinding(1)},e.prototype._getNextFreeBinding=function(e){if(this.freeBindingIndex>65536-e&&(this.freeGroupIndex++,this.freeBindingIndex=0),4===this.freeGroupIndex)throw"Too many textures or UBOs have been declared and it is not supported in WebGPU.";var t={groupIndex:this.freeGroupIndex,bindingIndex:this.freeBindingIndex};return this.freeBindingIndex+=e,t},e._SimplifiedKnownBindings=!0,e._SimplifiedKnownUBOs={Scene:{binding:{groupIndex:0,bindingIndex:0}},Light0:{binding:{groupIndex:-1,bindingIndex:-1}},Light1:{binding:{groupIndex:-1,bindingIndex:-1}},Light2:{binding:{groupIndex:-1,bindingIndex:-1}},Light3:{binding:{groupIndex:-1,bindingIndex:-1}},Light4:{binding:{groupIndex:-1,bindingIndex:-1}},Light5:{binding:{groupIndex:-1,bindingIndex:-1}},Light6:{binding:{groupIndex:-1,bindingIndex:-1}},Light7:{binding:{groupIndex:-1,bindingIndex:-1}},Light8:{binding:{groupIndex:-1,bindingIndex:-1}},Light9:{binding:{groupIndex:-1,bindingIndex:-1}},Light10:{binding:{groupIndex:-1,bindingIndex:-1}},Light11:{binding:{groupIndex:-1,bindingIndex:-1}},Light12:{binding:{groupIndex:-1,bindingIndex:-1}},Light13:{binding:{groupIndex:-1,bindingIndex:-1}},Light14:{binding:{groupIndex:-1,bindingIndex:-1}},Light15:{binding:{groupIndex:-1,bindingIndex:-1}},Light16:{binding:{groupIndex:-1,bindingIndex:-1}},Light17:{binding:{groupIndex:-1,bindingIndex:-1}},Light18:{binding:{groupIndex:-1,bindingIndex:-1}},Light19:{binding:{groupIndex:-1,bindingIndex:-1}},Light20:{binding:{groupIndex:-1,bindingIndex:-1}},Light21:{binding:{groupIndex:-1,bindingIndex:-1}},Light22:{binding:{groupIndex:-1,bindingIndex:-1}},Light23:{binding:{groupIndex:-1,bindingIndex:-1}},Light24:{binding:{groupIndex:-1,bindingIndex:-1}},Light25:{binding:{groupIndex:-1,bindingIndex:-1}},Light26:{binding:{groupIndex:-1,bindingIndex:-1}},Light27:{binding:{groupIndex:-1,bindingIndex:-1}},Light28:{binding:{groupIndex:-1,bindingIndex:-1}},Light29:{binding:{groupIndex:-1,bindingIndex:-1}},Light30:{binding:{groupIndex:-1,bindingIndex:-1}},Light31:{binding:{groupIndex:-1,bindingIndex:-1}},Material:{binding:{groupIndex:-1,bindingIndex:-1}},Mesh:{binding:{groupIndex:-1,bindingIndex:-1}},Internals:{binding:{groupIndex:-1,bindingIndex:-1}}},e._KnownUBOs={Scene:{binding:{groupIndex:0,bindingIndex:0}},Light0:{binding:{groupIndex:1,bindingIndex:0}},Light1:{binding:{groupIndex:1,bindingIndex:1}},Light2:{binding:{groupIndex:1,bindingIndex:2}},Light3:{binding:{groupIndex:1,bindingIndex:3}},Light4:{binding:{groupIndex:1,bindingIndex:4}},Light5:{binding:{groupIndex:1,bindingIndex:5}},Light6:{binding:{groupIndex:1,bindingIndex:6}},Light7:{binding:{groupIndex:1,bindingIndex:7}},Light8:{binding:{groupIndex:1,bindingIndex:8}},Light9:{binding:{groupIndex:1,bindingIndex:9}},Light10:{binding:{groupIndex:1,bindingIndex:10}},Light11:{binding:{groupIndex:1,bindingIndex:11}},Light12:{binding:{groupIndex:1,bindingIndex:12}},Light13:{binding:{groupIndex:1,bindingIndex:13}},Light14:{binding:{groupIndex:1,bindingIndex:14}},Light15:{binding:{groupIndex:1,bindingIndex:15}},Light16:{binding:{groupIndex:1,bindingIndex:16}},Light17:{binding:{groupIndex:1,bindingIndex:17}},Light18:{binding:{groupIndex:1,bindingIndex:18}},Light19:{binding:{groupIndex:1,bindingIndex:19}},Light20:{binding:{groupIndex:1,bindingIndex:20}},Light21:{binding:{groupIndex:1,bindingIndex:21}},Light22:{binding:{groupIndex:1,bindingIndex:22}},Light23:{binding:{groupIndex:1,bindingIndex:23}},Light24:{binding:{groupIndex:1,bindingIndex:24}},Light25:{binding:{groupIndex:1,bindingIndex:25}},Light26:{binding:{groupIndex:1,bindingIndex:26}},Light27:{binding:{groupIndex:1,bindingIndex:27}},Light28:{binding:{groupIndex:1,bindingIndex:28}},Light29:{binding:{groupIndex:1,bindingIndex:29}},Light30:{binding:{groupIndex:1,bindingIndex:30}},Light31:{binding:{groupIndex:1,bindingIndex:31}},Material:{binding:{groupIndex:2,bindingIndex:0}},Mesh:{binding:{groupIndex:2,bindingIndex:1}},Internals:{binding:{groupIndex:2,bindingIndex:2}}},e}()},50113:(e,t,r)=>{r.d(t,{e:()=>s});var i=r(41659),n=r(8724),s=function(){function e(){this.shaderLanguage=i.x.GLSL}return e.prototype._addUniformToLeftOverUBO=function(e,t,r){var i,n;e=(i=this._getArraySize(e,t,r))[0],t=i[1],n=i[2];for(var s=0;s<this._webgpuProcessingContext.leftOverUniforms.length;s++)if(this._webgpuProcessingContext.leftOverUniforms[s].name===e)return;this._webgpuProcessingContext.leftOverUniforms.push({name:e,type:t,length:n})},e.prototype._buildLeftOverUBO=function(){if(!this._webgpuProcessingContext.leftOverUniforms.length)return"";var t=e.LeftOvertUBOName,r=this._webgpuProcessingContext.availableBuffers[t];return r||(r={binding:this._webgpuProcessingContext.getNextFreeUBOBinding()},this._webgpuProcessingContext.availableBuffers[t]=r,this._addBufferBindingDescription(t,r,n.Rs.Uniform,!0),this._addBufferBindingDescription(t,r,n.Rs.Uniform,!1)),this._generateLeftOverUBOCode(t,r)},e.prototype._collectBindingNames=function(){for(var e=0;e<this._webgpuProcessingContext.bindGroupLayoutEntries.length;e++){var t=this._webgpuProcessingContext.bindGroupLayoutEntries[e];if(void 0!==t)for(var r=0;r<t.length;r++){var i=this._webgpuProcessingContext.bindGroupLayoutEntries[e][r],n=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[e][i.binding].name,s=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[e][i.binding].nameInArrayOfTexture;i&&(i.texture||i.externalTexture||i.storageTexture?this._webgpuProcessingContext.textureNames.push(s):i.sampler?this._webgpuProcessingContext.samplerNames.push(n):i.buffer&&this._webgpuProcessingContext.bufferNames.push(n))}else this._webgpuProcessingContext.bindGroupLayoutEntries[e]=[]}},e.prototype._preCreateBindGroupEntries=function(){for(var e=this._webgpuProcessingContext.bindGroupEntries,t=0;t<this._webgpuProcessingContext.bindGroupLayoutEntries.length;t++){for(var r=this._webgpuProcessingContext.bindGroupLayoutEntries[t],i=[],n=0;n<r.length;n++){var s=this._webgpuProcessingContext.bindGroupLayoutEntries[t][n];s.sampler||s.texture||s.storageTexture||s.externalTexture?i.push({binding:s.binding,resource:void 0}):s.buffer&&i.push({binding:s.binding,resource:{buffer:void 0,offset:0,size:0}})}e[t]=i}},e.prototype._addTextureBindingDescription=function(e,t,r,i,s,o){var a=t.textures[r],u=a.groupIndex,c=a.bindingIndex;if(this._webgpuProcessingContext.bindGroupLayoutEntries[u]||(this._webgpuProcessingContext.bindGroupLayoutEntries[u]=[],this._webgpuProcessingContext.bindGroupLayoutEntryInfo[u]=[]),!this._webgpuProcessingContext.bindGroupLayoutEntryInfo[u][c]){var l=void 0;l=null===i?this._webgpuProcessingContext.bindGroupLayoutEntries[u].push({binding:c,visibility:0,externalTexture:{}}):s?this._webgpuProcessingContext.bindGroupLayoutEntries[u].push({binding:c,visibility:0,storageTexture:{access:n.Gt.WriteOnly,format:s,viewDimension:i}}):this._webgpuProcessingContext.bindGroupLayoutEntries[u].push({binding:c,visibility:0,texture:{sampleType:t.sampleType,viewDimension:i,multisampled:!1}});var h=t.isTextureArray?e+r:e;this._webgpuProcessingContext.bindGroupLayoutEntryInfo[u][c]={name:e,index:l-1,nameInArrayOfTexture:h}}c=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[u][c].index,this._webgpuProcessingContext.bindGroupLayoutEntries[u][c].visibility|=o?n.$X.Vertex:n.$X.Fragment},e.prototype._addSamplerBindingDescription=function(e,t,r){var i=t.binding,s=i.groupIndex,o=i.bindingIndex;if(this._webgpuProcessingContext.bindGroupLayoutEntries[s]||(this._webgpuProcessingContext.bindGroupLayoutEntries[s]=[],this._webgpuProcessingContext.bindGroupLayoutEntryInfo[s]=[]),!this._webgpuProcessingContext.bindGroupLayoutEntryInfo[s][o]){var a=this._webgpuProcessingContext.bindGroupLayoutEntries[s].push({binding:o,visibility:0,sampler:{type:t.type}});this._webgpuProcessingContext.bindGroupLayoutEntryInfo[s][o]={name:e,index:a-1}}o=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[s][o].index,this._webgpuProcessingContext.bindGroupLayoutEntries[s][o].visibility|=r?n.$X.Vertex:n.$X.Fragment},e.prototype._addBufferBindingDescription=function(e,t,r,i){var s=t.binding,o=s.groupIndex,a=s.bindingIndex;if(this._webgpuProcessingContext.bindGroupLayoutEntries[o]||(this._webgpuProcessingContext.bindGroupLayoutEntries[o]=[],this._webgpuProcessingContext.bindGroupLayoutEntryInfo[o]=[]),!this._webgpuProcessingContext.bindGroupLayoutEntryInfo[o][a]){var u=this._webgpuProcessingContext.bindGroupLayoutEntries[o].push({binding:a,visibility:0,buffer:{type:r}});this._webgpuProcessingContext.bindGroupLayoutEntryInfo[o][a]={name:e,index:u-1}}a=this._webgpuProcessingContext.bindGroupLayoutEntryInfo[o][a].index,this._webgpuProcessingContext.bindGroupLayoutEntries[o][a].visibility|=i?n.$X.Vertex:n.$X.Fragment},e.prototype._injectStartingAndEndingCode=function(e,t,r,i){if(r){var n=e.indexOf(t);if(n>=0){for(;n++<e.length&&"{"!=e.charAt(n););if(n<e.length){for(;n++<e.length&&"\n"!=e.charAt(n););if(n<e.length){var s=e.substring(0,n+1),o=e.substring(n+1);e=s+r+o}}}}if(i){var a=e.lastIndexOf("}");e=e.substring(0,a),e+=i+"\n}"}return e},e.AutoSamplerSuffix="Sampler",e.LeftOvertUBOName="LeftOver",e.InternalsUBOName="Internals",e.UniformSizes={bool:1,int:1,float:1,vec2:2,ivec2:2,vec3:3,ivec3:3,vec4:4,ivec4:4,mat2:4,mat3:12,mat4:16,i32:1,u32:1,f32:1,mat2x2:4,mat3x3:12,mat4x4:16},e._SamplerFunctionByWebGLSamplerType={sampler2D:"sampler2D",sampler2DArray:"sampler2DArray",sampler2DShadow:"sampler2DShadow",sampler2DArrayShadow:"sampler2DArrayShadow",samplerCube:"samplerCube",sampler3D:"sampler3D"},e._TextureTypeByWebGLSamplerType={sampler2D:"texture2D",sampler2DArray:"texture2DArray",sampler2DShadow:"texture2D",sampler2DArrayShadow:"texture2DArray",samplerCube:"textureCube",samplerCubeArray:"textureCubeArray",sampler3D:"texture3D"},e._GpuTextureViewDimensionByWebGPUTextureType={textureCube:n.p_.Cube,textureCubeArray:n.p_.CubeArray,texture2D:n.p_.E2d,texture2DArray:n.p_.E2dArray,texture3D:n.p_.E3d},e._SamplerTypeByWebGLSamplerType={sampler2DShadow:"samplerShadow",sampler2DArrayShadow:"samplerShadow"},e._IsComparisonSamplerByWebGPUSamplerType={samplerShadow:!0,samplerArrayShadow:!0,sampler:!1},e}()},86937:(e,t,r)=>{r.d(t,{s:()=>c});var i=r(31191),n=r(94274),s=r(8724),o=r(84318),a=r(50113),u=r(41659),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._missingVaryings=[],t._textureArrayProcessing=[],t.shaderLanguage=u.x.GLSL,t}return(0,i.ZT)(t,e),t.prototype._getArraySize=function(e,t,r){var i=0,n=e.indexOf("["),s=e.indexOf("]");if(n>0&&s>0){var o=e.substring(n+1,s);i=+o,isNaN(i)&&(i=+r[o.trim()]),e=e.substr(0,n)}return[e,t,i]},t.prototype.initializeShaders=function(e){this._webgpuProcessingContext=e,this._missingVaryings.length=0,this._textureArrayProcessing.length=0},t.prototype.preProcessShaderCode=function(e,t){var r="uniform ".concat(a.e.InternalsUBOName," {\nfloat yFactor__;\nfloat textureOutputHeight__;\n};\n");return t?r+"##INJECTCODE##\n"+e:r+e},t.prototype.varyingProcessor=function(e,t,r){this._preProcessors=r;var i=/\s*varying\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm.exec(e);if(null!=i){var n,s=i[1],a=i[2];t?(n=this._webgpuProcessingContext.availableVaryings[a],this._missingVaryings[n]="",void 0===n&&o.Y.Warn('Invalid fragment shader: The varying named "'.concat(a,'" is not declared in the vertex shader! This declaration will be ignored.'))):(n=this._webgpuProcessingContext.getVaryingNextLocation(s,this._getArraySize(a,s,r)[2]),this._webgpuProcessingContext.availableVaryings[a]=n,this._missingVaryings[n]="layout(location = ".concat(n,") in ").concat(s," ").concat(a,";")),e=e.replace(i[0],void 0===n?"":"layout(location = ".concat(n,") ").concat(t?"in":"out"," ").concat(s," ").concat(a,";"))}return e},t.prototype.attributeProcessor=function(e,t){this._preProcessors=t;var r=/\s*attribute\s+(\S+)\s+(\S+)\s*;/gm.exec(e);if(null!=r){var i=r[1],n=r[2],s=this._webgpuProcessingContext.getAttributeNextLocation(i,this._getArraySize(n,i,t)[2]);this._webgpuProcessingContext.availableAttributes[n]=s,this._webgpuProcessingContext.orderedAttributes[s]=n,e=e.replace(r[0],"layout(location = ".concat(s,") in ").concat(i," ").concat(n,";"))}return e},t.prototype.uniformProcessor=function(e,t,r){var i,n;this._preProcessors=r;var o=/\s*uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm.exec(e);if(null!=o){var u=o[1],c=o[2];if(0===u.indexOf("sampler")||1===u.indexOf("sampler")){var l=0;c=(i=this._getArraySize(c,u,r))[0],u=i[1],l=i[2];var h=this._webgpuProcessingContext.availableTextures[c];if(!h){h={autoBindSampler:!0,isTextureArray:l>0,isStorageTexture:!1,textures:[],sampleType:s.oD.Float};for(var p=0;p<(l||1);++p)h.textures.push(this._webgpuProcessingContext.getNextFreeUBOBinding())}var d=null!==(n=a.e._SamplerTypeByWebGLSamplerType[u])&&void 0!==n?n:"sampler",_=!!a.e._IsComparisonSamplerByWebGPUSamplerType[d],f=_?s.dV.Comparison:s.dV.Filtering,g=c+a.e.AutoSamplerSuffix,m=this._webgpuProcessingContext.availableSamplers[g];m||(m={binding:this._webgpuProcessingContext.getNextFreeUBOBinding(),type:f});var E="u"===u.charAt(0)?"u":"i"===u.charAt(0)?"i":"";E&&(u=u.substr(1));var v=_?s.oD.Depth:"u"===E?s.oD.Uint:"i"===E?s.oD.Sint:s.oD.Float;h.sampleType=v;var T=l>0,y=m.binding.groupIndex,b=m.binding.bindingIndex,x=a.e._SamplerFunctionByWebGLSamplerType[u],S=a.e._TextureTypeByWebGLSamplerType[u],R=a.e._GpuTextureViewDimensionByWebGPUTextureType[S];if(T){var A=[];A.push("layout(set = ".concat(y,", binding = ").concat(b,") uniform ").concat(E).concat(d," ").concat(g,";")),e="\r\n";for(p=0;p<l;++p){var C=h.textures[p].groupIndex,B=h.textures[p].bindingIndex;A.push("layout(set = ".concat(C,", binding = ").concat(B,") uniform ").concat(S," ").concat(c,"Texture").concat(p,";")),e+="".concat(p>0?"\r\n":"","#define ").concat(c).concat(p," ").concat(E).concat(x,"(").concat(c,"Texture").concat(p,", ").concat(g,")")}e=A.join("\r\n")+e,this._textureArrayProcessing.push(c)}else l=1,e="layout(set = ".concat(y,", binding = ").concat(b,") uniform ").concat(E).concat(d," ").concat(g,";\n                        layout(set = ").concat(h.textures[0].groupIndex,", binding = ").concat(h.textures[0].bindingIndex,") uniform ").concat(S," ").concat(c,"Texture;\n                        #define ").concat(c," ").concat(E).concat(x,"(").concat(c,"Texture, ").concat(g,")");this._webgpuProcessingContext.availableTextures[c]=h,this._webgpuProcessingContext.availableSamplers[g]=m,this._addSamplerBindingDescription(g,m,!t);for(p=0;p<l;++p)this._addTextureBindingDescription(c,h,p,R,null,!t)}else this._addUniformToLeftOverUBO(c,u,r),e=""}return e},t.prototype.uniformBufferProcessor=function(e,t){var r=/uniform\s+(\w+)/gm.exec(e);if(null!=r){var i=r[1],o=this._webgpuProcessingContext.availableBuffers[i];if(!o){var a=n.d.KnownUBOs[i];o={binding:a&&-1!==a.binding.groupIndex?a.binding:this._webgpuProcessingContext.getNextFreeUBOBinding()},this._webgpuProcessingContext.availableBuffers[i]=o}this._addBufferBindingDescription(i,o,s.Rs.Uniform,!t),e=e.replace("uniform","layout(set = ".concat(o.binding.groupIndex,", binding = ").concat(o.binding.bindingIndex,") uniform"))}return e},t.prototype.postProcessor=function(e,t,r,i,n){var s=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),r){var o=e.indexOf("gl_FragCoord")>=0,a=o?"vec4 glFragCoord__;\n":"";e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/gl_FragCoord/g,"glFragCoord__")).replace(/void\s+?main\s*\(/g,(s?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")).replace(/dFdy/g,"(-yFactor__)*dFdy")).replace("##INJECTCODE##",a),o&&(e=this._injectStartingAndEndingCode(e,"void main","\n                glFragCoord__ = gl_FragCoord;\n                if (yFactor__ == 1.) {\n                    glFragCoord__.y = textureOutputHeight__ - glFragCoord__.y;\n                }\n            "))}else{if(e=(e=e.replace(/gl_InstanceID/g,"gl_InstanceIndex")).replace(/gl_VertexID/g,"gl_VertexIndex"),-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e}if(!r){var u=e.lastIndexOf("}");e=e.substring(0,u),e+="gl_Position.y *= yFactor__;\n",n.isNDCHalfZRange||(e+="gl_Position.z = (gl_Position.z + gl_Position.w) / 2.0;\n"),e+="}"}return e},t.prototype._applyTextureArrayProcessing=function(e,t){for(var r=new RegExp(t+"\\s*\\[(.+)?\\]","gm"),i=r.exec(e);null!=i;){var n=i[1],s=+n;this._preProcessors&&isNaN(s)&&(s=+this._preProcessors[n.trim()]),e=e.replace(i[0],t+s),i=r.exec(e)}return e},t.prototype._generateLeftOverUBOCode=function(e,t){for(var r="layout(set = ".concat(t.binding.groupIndex,", binding = ").concat(t.binding.bindingIndex,") uniform ").concat(e," {\n    "),i=0,n=this._webgpuProcessingContext.leftOverUniforms;i<n.length;i++){var s=n[i];s.length>0?r+="    ".concat(s.type," ").concat(s.name,"[").concat(s.length,"];\n"):r+="    ".concat(s.type," ").concat(s.name,";\n")}return r+="};\n\n"},t.prototype.finalizeShaders=function(e,t){for(var r=0;r<this._textureArrayProcessing.length;++r){var i=this._textureArrayProcessing[r];e=this._applyTextureArrayProcessing(e,i),t=this._applyTextureArrayProcessing(t,i)}for(r=0;r<this._missingVaryings.length;++r){var n=this._missingVaryings[r];n&&n.length>0&&(t=n+"\n"+t)}var s=this._buildLeftOverUBO();return e=s+e,t=s+t,this._collectBindingNames(),this._preCreateBindGroupEntries(),this._preProcessors=null,{vertexCode:e,fragmentCode:t}},t}(a.e)},15212:(e,t,r)=>{r.d(t,{o:()=>E});var i=r(31191),n=r(94274),s=r(8724),o=r(84318),a=r(50113),u=r(31259),c=(r(94112),r(27764),r(20349),r(74529),r(93350),r(99498),r(5932),r(55393),r(82618),r(64957),r(27880),r(7174),r(53223),r(95375),r(84825),r(38527),r(41659)),l="gl_VertexID",h="gl_InstanceID",p="gl_Position",d="gl_FragCoord",_="gl_FrontFacing",f="gl_FragDepth",g="gl_FragColor",m={texture_1d:s.p_.E1d,texture_2d:s.p_.E2d,texture_2d_array:s.p_.E2dArray,texture_3d:s.p_.E3d,texture_cube:s.p_.Cube,texture_cube_array:s.p_.CubeArray,texture_multisampled_2d:s.p_.E2d,texture_depth_2d:s.p_.E2d,texture_depth_2d_array:s.p_.E2dArray,texture_depth_cube:s.p_.Cube,texture_depth_cube_array:s.p_.CubeArray,texture_depth_multisampled_2d:s.p_.E2d,texture_storage_1d:s.p_.E1d,texture_storage_2d:s.p_.E2d,texture_storage_2d_array:s.p_.E2dArray,texture_storage_3d:s.p_.E3d,texture_external:null},E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.shaderLanguage=c.x.WGSL,t.uniformRegexp=/uniform\s+(\w+)\s*:\s*(.+)\s*;/,t.textureRegexp=/var\s+(\w+)\s*:\s*((array<\s*)?(texture_\w+)\s*(<\s*(.+)\s*>)?\s*(,\s*\w+\s*>\s*)?);/,t.noPrecision=!0,t}return(0,i.ZT)(t,e),t.prototype._getArraySize=function(e,t,r){var i=0,n=t.lastIndexOf(">");if(t.indexOf("array")>=0&&n>0){for(var s=n;s>0&&" "!==t.charAt(s)&&","!==t.charAt(s);)s--;var o=t.substring(s+1,n);for(i=+o,isNaN(i)&&(i=+r[o.trim()]);s>0&&(" "===t.charAt(s)||","===t.charAt(s));)s--;t=t.substring(t.indexOf("<")+1,s+1)}return[e,t,i]},t.prototype.initializeShaders=function(e){this._webgpuProcessingContext=e,this._attributesWGSL=[],this._attributesDeclWGSL=[],this._attributeNamesWGSL=[],this._varyingsWGSL=[],this._varyingsDeclWGSL=[],this._varyingNamesWGSL=[],this._stridedUniformArrays=[]},t.prototype.preProcessShaderCode=function(e){return"struct ".concat(a.e.InternalsUBOName," {\nyFactor__: f32,\ntextureOutputHeight__: f32,\n};\nvar<uniform> ").concat("internals"," : ").concat(a.e.InternalsUBOName,";\n")+(0,u.Kt)(e)},t.prototype.varyingProcessor=function(e,t,r){var i=/\s*varying\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s*:\s*(.+)\s*;/gm.exec(e);if(null!==i){var n,s=i[2],a=i[1];t?void 0===(n=this._webgpuProcessingContext.availableVaryings[a])&&o.Y.Warn('Invalid fragment shader: The varying named "'.concat(a,'" is not declared in the vertex shader! This declaration will be ignored.')):(n=this._webgpuProcessingContext.getVaryingNextLocation(s,this._getArraySize(a,s,r)[2]),this._webgpuProcessingContext.availableVaryings[a]=n,this._varyingsWGSL.push("@location(".concat(n,") ").concat(a," : ").concat(s,",")),this._varyingsDeclWGSL.push("var<private> ".concat(a," : ").concat(s,";")),this._varyingNamesWGSL.push(a)),e=""}return e},t.prototype.attributeProcessor=function(e,t){var r=/\s*attribute\s+(\S+)\s*:\s*(.+)\s*;/gm.exec(e);if(null!==r){var i=r[2],n=r[1],s=this._webgpuProcessingContext.getAttributeNextLocation(i,this._getArraySize(n,i,t)[2]);this._webgpuProcessingContext.availableAttributes[n]=s,this._webgpuProcessingContext.orderedAttributes[s]=n,this._attributesWGSL.push("@location(".concat(s,") ").concat(n," : ").concat(i,",")),this._attributesDeclWGSL.push("var<private> ".concat(n," : ").concat(i,";")),this._attributeNamesWGSL.push(n),e=""}return e},t.prototype.uniformProcessor=function(e,t,r){var i=this.uniformRegexp.exec(e);if(null!==i){var n=i[2],s=i[1];this._addUniformToLeftOverUBO(s,n,r),e=""}return e},t.prototype.textureProcessor=function(e,t,r){var i=this.textureRegexp.exec(e);if(null!==i){var n=i[1],o=i[2],a=!!i[3],u=i[4],c=u.indexOf("storage")>0,l=i[6],h=c?l.substring(0,l.indexOf(",")).trim():null,p=a?this._getArraySize(n,o,r)[2]:0,d=this._webgpuProcessingContext.availableTextures[n];if(d)p=d.textures.length;else{d={isTextureArray:p>0,isStorageTexture:c,textures:[],sampleType:s.oD.Float},p=p||1;for(var _=0;_<p;++_)d.textures.push(this._webgpuProcessingContext.getNextFreeUBOBinding())}this._webgpuProcessingContext.availableTextures[n]=d;var f=u.indexOf("depth")>0,g=m[u],E=f?s.oD.Depth:"u32"===l?s.oD.Uint:"i32"===l?s.oD.Sint:s.oD.Float;if(d.sampleType=E,void 0===g)throw"Can't get the texture dimension corresponding to the texture function \"".concat(u,'"!');for(_=0;_<p;++_){var v=d.textures[_],T=v.groupIndex,y=v.bindingIndex;0===_&&(e="@group(".concat(T,") @binding(").concat(y,") ").concat(e)),this._addTextureBindingDescription(n,d,_,g,h,!t)}}return e},t.prototype.postProcessor=function(e){return e},t.prototype.finalizeShaders=function(e,t){var r=t.indexOf("gl_FragCoord")>=0?"\n            if (internals.yFactor__ == 1.) {\n                gl_FragCoord.y = internals.textureOutputHeight__ - gl_FragCoord.y;\n            }\n        ":"";e=this._processSamplers(e,!0),t=this._processSamplers(t,!1),e=this._processCustomBuffers(e,!0),t=this._processCustomBuffers(t,!1);var i=this._buildLeftOverUBO();t=i+t,e=(e=i+e).replace(/#define /g,"//#define "),e=this._processStridedUniformArrays(e);var n=this._varyingsDeclWGSL.join("\n")+"\n",s="var<private> ".concat(l," : u32;\nvar<private> ").concat(h," : u32;\nvar<private> ").concat(p," : vec4<f32>;\n"),o=this._attributesDeclWGSL.join("\n")+"\n",a="struct VertexInputs {\n  @builtin(vertex_index) vertexIndex : u32,\n  @builtin(instance_index) instanceIndex : u32,\n";this._attributesWGSL.length>0&&(a+=this._attributesWGSL.join("\n")),a+="\n};\n";var u="struct FragmentInputs {\n  @builtin(position) position : vec4<f32>,\n";this._varyingsWGSL.length>0&&(u+=this._varyingsWGSL.join("\n")),e=s+a+o+(u+="\n};\n")+n+e;for(var c="  var output : FragmentInputs;\n  ".concat(l," = input.vertexIndex;\n  ").concat(h," = input.instanceIndex;\n"),m=0;m<this._attributeNamesWGSL.length;++m){var E=this._attributeNamesWGSL[m];c+="  ".concat(E," = input.").concat(E,";\n")}var v="  output.position = ".concat(p,";\n  output.position.y = output.position.y * internals.yFactor__;\n");for(m=0;m<this._varyingNamesWGSL.length;++m){var T=this._varyingNamesWGSL[m];v+="  output.".concat(T," = ").concat(T,";\n")}v+="  return output;",e=this._injectStartingAndEndingCode(e,"fn main",c,v),t=t.replace(/#define /g,"//#define "),t=(t=this._processStridedUniformArrays(t)).replace(/dpdy/g,"(-internals.yFactor__)*dpdy");var y="var<private> ".concat(d," : vec4<f32>;\nvar<private> ").concat(_," : bool;\nvar<private> ").concat(g," : vec4<f32>;\nvar<private> ").concat(f," : f32;\n"),b="struct FragmentInputs {\n  @builtin(position) position : vec4<f32>,\n  @builtin(front_facing) frontFacing : bool,\n";this._varyingsWGSL.length>0&&(b+=this._varyingsWGSL.join("\n")),b+="\n};\n";for(var x="struct FragmentOutputs {\n  @location(0) color : vec4<f32>,\n",S=!1,R=0;!(S||(R=t.indexOf(f,R))<0);){var A=R;for(S=!0;R>1&&"\n"!==t.charAt(R);){if("/"===t.charAt(R)&&"/"===t.charAt(R-1)){S=!1;break}R--}R=A+f.length}S&&(x+="  @builtin(frag_depth) fragDepth: f32,\n"),t=y+b+n+(x+="};\n")+t;var C="  var output : FragmentOutputs;\n  ".concat(d," = input.position;\n  ").concat(_," = input.frontFacing;\n")+r;for(m=0;m<this._varyingNamesWGSL.length;++m){var B=this._varyingNamesWGSL[m];C+="  ".concat(B," = input.").concat(B,";\n")}var P="  output.color = ".concat(g,";\n");return S&&(P+="  output.fragDepth = ".concat(f,";\n")),P+="  return output;",t=this._injectStartingAndEndingCode(t,"fn main",C,P),this._collectBindingNames(),this._preCreateBindGroupEntries(),{vertexCode:e,fragmentCode:t}},t.prototype._generateLeftOverUBOCode=function(e,t){for(var r="",i="struct ".concat(e," {\n"),n=0,s=this._webgpuProcessingContext.leftOverUniforms;n<s.length;n++){var o=s[n],u=o.type.replace(/^(.*?)(<.*>)?$/,"$1"),c=a.e.UniformSizes[u];if(o.length>0)if(c<=2){var l="".concat(e,"_").concat(this._stridedUniformArrays.length,"_strided_arr");r+="struct ".concat(l," {\n                        @size(16)\n                        el: ").concat(u,",\n                    }"),this._stridedUniformArrays.push(o.name),i+=" @align(16) ".concat(o.name," : array<").concat(l,", ").concat(o.length,">,\n")}else i+=" ".concat(o.name," : array<").concat(o.type,", ").concat(o.length,">,\n");else i+="  ".concat(o.name," : ").concat(o.type,",\n")}return i+="};\n",i="".concat(r,"\n").concat(i),i+="@group(".concat(t.binding.groupIndex,") @binding(").concat(t.binding.bindingIndex,") var<uniform> ").concat("uniforms"," : ").concat(e,";\n")},t.prototype._processSamplers=function(e,t){for(var r=/var\s+(\w+Sampler)\s*:\s*(sampler|sampler_comparison)\s*;/gm;;){var i=r.exec(e);if(null===i)break;var n=i[1],o=i[2],u=n.indexOf(a.e.AutoSamplerSuffix)===n.length-a.e.AutoSamplerSuffix.length?n.substring(0,n.indexOf(a.e.AutoSamplerSuffix)):null,c="sampler_comparison"===o?s.dV.Comparison:s.dV.Filtering;if(u){var l=this._webgpuProcessingContext.availableTextures[u];l&&(l.autoBindSampler=!0)}var h=this._webgpuProcessingContext.availableSamplers[n];h||(h={binding:this._webgpuProcessingContext.getNextFreeUBOBinding(),type:c},this._webgpuProcessingContext.availableSamplers[n]=h),this._addSamplerBindingDescription(n,h,t);var p=e.substring(0,i.index),d="@group(".concat(h.binding.groupIndex,") @binding(").concat(h.binding.bindingIndex,") "),_=e.substring(i.index);e=p+d+_,r.lastIndex+=d.length}return e},t.prototype._processCustomBuffers=function(e,t){for(var r=/var<\s*(uniform|storage)\s*(,\s*(read|read_write)\s*)?>\s+(\S+)\s*:\s*(\S+)\s*;/gm;;){var i=r.exec(e);if(null===i)break;var o=i[1],a=i[3],u=i[4],c=i[5],l=this._webgpuProcessingContext.availableBuffers[u];if(!l){var h="uniform"===o?n.d.KnownUBOs[c]:null,p=void 0;h?(u=c,-1===(p=h.binding).groupIndex&&(p=this._webgpuProcessingContext.getNextFreeUBOBinding())):p=this._webgpuProcessingContext.getNextFreeUBOBinding(),l={binding:p},this._webgpuProcessingContext.availableBuffers[u]=l}this._addBufferBindingDescription(u,this._webgpuProcessingContext.availableBuffers[u],"read_write"===a?s.Rs.Storage:"storage"===o?s.Rs.ReadOnlyStorage:s.Rs.Uniform,t);var d=l.binding.groupIndex,_=l.binding.bindingIndex,f=e.substring(0,i.index),g="@group(".concat(d,") @binding(").concat(_,") "),m=e.substring(i.index);e=f+g+m,r.lastIndex+=g.length}return e},t.prototype._processStridedUniformArrays=function(e){for(var t=0,r=this._stridedUniformArrays;t<r.length;t++){var i=r[t];e=e.replace(new RegExp("".concat(i,"\\s*\\[(.*)\\]"),"g"),"".concat(i,"[$1].el"))}return e},t}(a.e)},44344:(e,t,r)=>{r.d(t,{w:()=>i});var i=function(){function e(e,t,r,i){this._record=!1,this._play=!1,this._mainPassBundleList=[],this._enabled=!1,this._engine=e,this._mode=t,this._bundleList=r,this._bundleListRenderTarget=i}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._mainPassBundleList.length=0,this._record=this._enabled=e,this._play=!1,e&&(this._modeSaved=this._mode,this._mode=0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"play",{get:function(){return this._play},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"record",{get:function(){return this._record},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(e){this._record?this._modeSaved=e:this._mode=e},enumerable:!1,configurable:!0}),e.prototype.endMainRenderPass=function(){this._record&&this._mainPassBundleList.push(this._bundleList.clone())},e.prototype.endRenderTargetPass=function(e,t){var r,i,n,s;if(this._play)null===(i=null===(r=t._bundleLists)||void 0===r?void 0:r[t._currentLayer])||void 0===i||i.run(e),1===this._mode&&this._engine._reportDrawCall(null===(s=null===(n=t._bundleLists)||void 0===n?void 0:n[t._currentLayer])||void 0===s?void 0:s.numDrawCalls);else{if(!this._record)return!1;t._bundleLists||(t._bundleLists=[]),t._bundleLists[t._currentLayer]=this._bundleListRenderTarget.clone(),t._bundleLists[t._currentLayer].run(e),this._bundleListRenderTarget.reset()}return!0},e.prototype.endFrame=function(e){if(this._record&&(this._mainPassBundleList.push(this._bundleList.clone()),this._record=!1,this._play=!0,this._mode=this._modeSaved),null!==e&&this._play)for(var t=0;t<this._mainPassBundleList.length;++t)this._mainPassBundleList[t].run(e),1===this._mode&&this._engine._reportDrawCall(this._mainPassBundleList[t].numDrawCalls)},e.prototype.reset=function(){this.enabled=!1,this.enabled=!0},e}()},86980:(e,t,r)=>{r.d(t,{F:()=>n});var i=r(31191),n=function(e){function t(t){var r=e.call(this,!1)||this;return r._cache=t,r.reset(),r}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"func",{get:function(){return this._func},set:function(e){this._func!==e&&(this._func=e,this._cache.setStencilCompare(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"funcMask",{get:function(){return this._funcMask},set:function(e){this._funcMask!==e&&(this._funcMask=e,this._cache.setStencilReadMask(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._cache.setStencilFailOp(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._cache.setStencilDepthFailOp(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._cache.setStencilPassOp(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._cache.setStencilWriteMask(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._cache.setStencilEnabled(e))},enumerable:!1,configurable:!0}),t.prototype.reset=function(){e.prototype.reset.call(this),this._cache.resetStencilState()},t.prototype.apply=function(){var e,t=null===(e=this.stencilMaterial)||void 0===e?void 0:e.enabled;this.enabled=t?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.enabled&&(this.func=t?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=t?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=t?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=t?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=t?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=t?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=t?this.stencilMaterial.mask:this.stencilGlobal.mask)},t}(r(61625).C)},72089:(e,t,r)=>{r.d(t,{D:()=>h,U:()=>l});var i,n=r(8724),s=r(72739),o=r(7949),a=r(19015),u="\n    #extension GL_EXT_samplerless_texture_functions : enable\n\n    const vec2 pos[4] = vec2[4](vec2(-1.0f, 1.0f), vec2(1.0f, 1.0f), vec2(-1.0f, -1.0f), vec2(1.0f, -1.0f));\n    const vec2 tex[4] = vec2[4](vec2(0.0f, 0.0f), vec2(1.0f, 0.0f), vec2(0.0f, 1.0f), vec2(1.0f, 1.0f));\n\n    layout(set = 0, binding = 0) uniform texture2D img;\n\n    #ifdef INVERTY\n        layout(location = 0) out flat ivec2 vTextureSize;\n    #endif\n\n    void main() {\n        #ifdef INVERTY\n            vTextureSize = textureSize(img, 0);\n        #endif\n        gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n    }\n    ";!function(e){e[e.MipMap=0]="MipMap",e[e.InvertYPremultiplyAlpha=1]="InvertYPremultiplyAlpha",e[e.Clear=2]="Clear",e[e.InvertYPremultiplyAlphaWithOfst=3]="InvertYPremultiplyAlphaWithOfst"}(i||(i={}));var c=[{vertex:"\n    const vec2 pos[4] = vec2[4](vec2(-1.0f, 1.0f), vec2(1.0f, 1.0f), vec2(-1.0f, -1.0f), vec2(1.0f, -1.0f));\n    const vec2 tex[4] = vec2[4](vec2(0.0f, 0.0f), vec2(1.0f, 0.0f), vec2(0.0f, 1.0f), vec2(1.0f, 1.0f));\n\n    layout(location = 0) out vec2 vTex;\n\n    void main() {\n        vTex = tex[gl_VertexIndex];\n        gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n    }\n    ",fragment:"\n    layout(set = 0, binding = 0) uniform sampler imgSampler;\n    layout(set = 0, binding = 1) uniform texture2D img;\n\n    layout(location = 0) in vec2 vTex;\n    layout(location = 0) out vec4 outColor;\n\n    void main() {\n        outColor = texture(sampler2D(img, imgSampler), vTex);\n    }\n    "},{vertex:u,fragment:"\n    #extension GL_EXT_samplerless_texture_functions : enable\n\n    layout(set = 0, binding = 0) uniform texture2D img;\n\n    #ifdef INVERTY\n        layout(location = 0) in flat ivec2 vTextureSize;\n    #endif\n    layout(location = 0) out vec4 outColor;\n\n    void main() {\n    #ifdef INVERTY\n        vec4 color = texelFetch(img, ivec2(gl_FragCoord.x, vTextureSize.y - gl_FragCoord.y), 0);\n    #else\n        vec4 color = texelFetch(img, ivec2(gl_FragCoord.xy), 0);\n    #endif\n    #ifdef PREMULTIPLYALPHA\n        color.rgb *= color.a;\n    #endif\n        outColor = color;\n    }\n    "},{vertex:"\n    const vec2 pos[4] = vec2[4](vec2(-1.0f, 1.0f), vec2(1.0f, 1.0f), vec2(-1.0f, -1.0f), vec2(1.0f, -1.0f));\n\n    void main() {\n        gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n    }\n    ",fragment:"\n    layout(set = 0, binding = 0) uniform Uniforms {\n        uniform vec4 color;\n    };\n\n    layout(location = 0) out vec4 outColor;\n\n    void main() {\n        outColor = color;\n    }\n    "},{vertex:"\n    #extension GL_EXT_samplerless_texture_functions : enable\n\n    const vec2 pos[4] = vec2[4](vec2(-1.0f, 1.0f), vec2(1.0f, 1.0f), vec2(-1.0f, -1.0f), vec2(1.0f, -1.0f));\n    const vec2 tex[4] = vec2[4](vec2(0.0f, 0.0f), vec2(1.0f, 0.0f), vec2(0.0f, 1.0f), vec2(1.0f, 1.0f));\n\n    layout(set = 0, binding = 0) uniform texture2D img;\n\n    #ifdef INVERTY\n        layout(location = 0) out flat ivec2 vTextureSize;\n    #endif\n\n    void main() {\n        #ifdef INVERTY\n            vTextureSize = textureSize(img, 0);\n        #endif\n        gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n    }\n    ",fragment:"\n    #extension GL_EXT_samplerless_texture_functions : enable\n\n    layout(set = 0, binding = 0) uniform texture2D img;\n    layout(set = 0, binding = 1) uniform Params {\n        float ofstX;\n        float ofstY;\n        float width;\n        float height;\n    };\n\n    #ifdef INVERTY\n        layout(location = 0) in flat ivec2 vTextureSize;\n    #endif\n    layout(location = 0) out vec4 outColor;\n\n    void main() {\n        if (gl_FragCoord.x < ofstX || gl_FragCoord.x >= ofstX + width) {\n            discard;\n        }\n        if (gl_FragCoord.y < ofstY || gl_FragCoord.y >= ofstY + height) {\n            discard;\n        }\n    #ifdef INVERTY\n        vec4 color = texelFetch(img, ivec2(gl_FragCoord.x, ofstY + height - (gl_FragCoord.y - ofstY)), 0);\n    #else\n        vec4 color = texelFetch(img, ivec2(gl_FragCoord.xy), 0);\n    #endif\n    #ifdef PREMULTIPLYALPHA\n        color.rgb *= color.a;\n    #endif\n        outColor = color;\n    }\n    "}],l={"":0,r8unorm:1,r8uint:2,r8sint:3,r16uint:4,r16sint:5,r16float:6,rg8unorm:7,rg8uint:8,rg8sint:9,r32uint:10,r32sint:11,r32float:12,rg16uint:13,rg16sint:14,rg16float:15,rgba8unorm:16,"rgba8unorm-srgb":17,rgba8uint:18,rgba8sint:19,bgra8unorm:20,"bgra8unorm-srgb":21,rgb10a2unorm:22,rg32uint:23,rg32sint:24,rg32float:25,rgba16uint:26,rgba16sint:27,rgba16float:28,rgba32uint:29,rgba32sint:30,rgba32float:31,stencil8:32,depth16unorm:33,depth24plus:34,"depth24plus-stencil8":35,depth32float:36,"depth24unorm-stencil8":37,"depth32float-stencil8":38},h=function(){function e(e,t,r,i){this._pipelines={},this._compiledShaders=[],this._deferredReleaseTextures=[],this._device=e,this._glslang=t,this._tintWASM=r,this._bufferManager=i,this._mipmapSampler=e.createSampler({minFilter:n.X9.Linear}),this._ubCopyWithOfst=this._bufferManager.createBuffer(16,n.FB.Uniform|n.FB.CopyDst).underlyingResource,this._getPipeline(n.EV.RGBA8Unorm)}return e.ComputeNumMipmapLevels=function(e,t){return s.R.ILog2(Math.max(e,t))+1},e.prototype._getPipeline=function(e,t,r){void 0===t&&(t=i.MipMap);var s=t===i.MipMap?1:t===i.InvertYPremultiplyAlpha?((r.invertY?1:0)<<1)+((r.premultiplyAlpha?1:0)<<2):t===i.Clear?8:t===i.InvertYPremultiplyAlphaWithOfst?((r.invertY?1:0)<<4)+((r.premultiplyAlpha?1:0)<<5):0;this._pipelines[e]||(this._pipelines[e]=[]);var o=this._pipelines[e][s];if(!o){var a="#version 450\r\n";t!==i.InvertYPremultiplyAlpha&&t!==i.InvertYPremultiplyAlphaWithOfst||(r.invertY&&(a+="#define INVERTY\r\n"),r.premultiplyAlpha&&(a+="#define PREMULTIPLYALPHA\r\n"));var u=this._compiledShaders[s];if(!u){var l=this._glslang.compileGLSL(a+c[t].vertex,"vertex"),h=this._glslang.compileGLSL(a+c[t].fragment,"fragment");this._tintWASM&&(l=this._tintWASM.convertSpirV2WGSL(l),h=this._tintWASM.convertSpirV2WGSL(h));var p=this._device.createShaderModule({code:l}),d=this._device.createShaderModule({code:h});u=this._compiledShaders[s]=[p,d]}var _=this._device.createRenderPipeline({layout:n.fu.Auto,vertex:{module:u[0],entryPoint:"main"},fragment:{module:u[1],entryPoint:"main",targets:[{format:e}]},primitive:{topology:n.YV.TriangleStrip,stripIndexFormat:n.iD.Uint16}});o=this._pipelines[e][s]=[_,_.getBindGroupLayout(0)]}return o},e._GetTextureTypeFromFormat=function(e){switch(e){case n.EV.R8Unorm:case n.EV.R8Snorm:case n.EV.R8Uint:case n.EV.R8Sint:case n.EV.RG8Unorm:case n.EV.RG8Snorm:case n.EV.RG8Uint:case n.EV.RG8Sint:case n.EV.RGBA8Unorm:case n.EV.RGBA8UnormSRGB:case n.EV.RGBA8Snorm:case n.EV.RGBA8Uint:case n.EV.RGBA8Sint:case n.EV.BGRA8Unorm:case n.EV.BGRA8UnormSRGB:case n.EV.RGB10A2Unorm:case n.EV.RGB9E5UFloat:case n.EV.RG11B10UFloat:case n.EV.Depth24UnormStencil8:case n.EV.Depth32FloatStencil8:case n.EV.BC7RGBAUnorm:case n.EV.BC7RGBAUnormSRGB:case n.EV.BC6HRGBUFloat:case n.EV.BC6HRGBFloat:case n.EV.BC5RGUnorm:case n.EV.BC5RGSnorm:case n.EV.BC3RGBAUnorm:case n.EV.BC3RGBAUnormSRGB:case n.EV.BC2RGBAUnorm:case n.EV.BC2RGBAUnormSRGB:case n.EV.BC4RUnorm:case n.EV.BC4RSnorm:case n.EV.BC1RGBAUnorm:case n.EV.BC1RGBAUnormSRGB:case n.EV.ETC2RGB8Unorm:case n.EV.ETC2RGB8UnormSRGB:case n.EV.ETC2RGB8A1Unorm:case n.EV.ETC2RGB8A1UnormSRGB:case n.EV.ETC2RGBA8Unorm:case n.EV.ETC2RGBA8UnormSRGB:case n.EV.EACR11Unorm:case n.EV.EACR11Snorm:case n.EV.EACRG11Unorm:case n.EV.EACRG11Snorm:case n.EV.ASTC4x4Unorm:case n.EV.ASTC4x4UnormSRGB:case n.EV.ASTC5x4Unorm:case n.EV.ASTC5x4UnormSRGB:case n.EV.ASTC5x5Unorm:case n.EV.ASTC5x5UnormSRGB:case n.EV.ASTC6x5Unorm:case n.EV.ASTC6x5UnormSRGB:case n.EV.ASTC6x6Unorm:case n.EV.ASTC6x6UnormSRGB:case n.EV.ASTC8x5Unorm:case n.EV.ASTC8x5UnormSRGB:case n.EV.ASTC8x6Unorm:case n.EV.ASTC8x6UnormSRGB:case n.EV.ASTC8x8Unorm:case n.EV.ASTC8x8UnormSRGB:case n.EV.ASTC10x5Unorm:case n.EV.ASTC10x5UnormSRGB:case n.EV.ASTC10x6Unorm:case n.EV.ASTC10x6UnormSRGB:case n.EV.ASTC10x8Unorm:case n.EV.ASTC10x8UnormSRGB:case n.EV.ASTC10x10Unorm:case n.EV.ASTC10x10UnormSRGB:case n.EV.ASTC12x10Unorm:case n.EV.ASTC12x10UnormSRGB:case n.EV.ASTC12x12Unorm:case n.EV.ASTC12x12UnormSRGB:return 0;case n.EV.R16Uint:case n.EV.R16Sint:case n.EV.RG16Uint:case n.EV.RG16Sint:case n.EV.RGBA16Uint:case n.EV.RGBA16Sint:case n.EV.Depth16Unorm:return 5;case n.EV.R16Float:case n.EV.RG16Float:case n.EV.RGBA16Float:return 2;case n.EV.R32Uint:case n.EV.R32Sint:case n.EV.RG32Uint:case n.EV.RG32Sint:case n.EV.RGBA32Uint:case n.EV.RGBA32Sint:return 7;case n.EV.R32Float:case n.EV.RG32Float:case n.EV.RGBA32Float:case n.EV.Depth32Float:return 1;case n.EV.Stencil8:throw"No fixed size for Stencil8 format!";case n.EV.Depth24Plus:throw"No fixed size for Depth24Plus format!";case n.EV.Depth24PlusStencil8:throw"No fixed size for Depth24PlusStencil8 format!"}return 0},e._GetBlockInformationFromFormat=function(e){switch(e){case n.EV.R8Unorm:case n.EV.R8Snorm:case n.EV.R8Uint:case n.EV.R8Sint:return{width:1,height:1,length:1};case n.EV.R16Uint:case n.EV.R16Sint:case n.EV.R16Float:case n.EV.RG8Unorm:case n.EV.RG8Snorm:case n.EV.RG8Uint:case n.EV.RG8Sint:return{width:1,height:1,length:2};case n.EV.R32Uint:case n.EV.R32Sint:case n.EV.R32Float:case n.EV.RG16Uint:case n.EV.RG16Sint:case n.EV.RG16Float:case n.EV.RGBA8Unorm:case n.EV.RGBA8UnormSRGB:case n.EV.RGBA8Snorm:case n.EV.RGBA8Uint:case n.EV.RGBA8Sint:case n.EV.BGRA8Unorm:case n.EV.BGRA8UnormSRGB:case n.EV.RGB9E5UFloat:case n.EV.RGB10A2Unorm:case n.EV.RG11B10UFloat:return{width:1,height:1,length:4};case n.EV.RG32Uint:case n.EV.RG32Sint:case n.EV.RG32Float:case n.EV.RGBA16Uint:case n.EV.RGBA16Sint:case n.EV.RGBA16Float:return{width:1,height:1,length:8};case n.EV.RGBA32Uint:case n.EV.RGBA32Sint:case n.EV.RGBA32Float:return{width:1,height:1,length:16};case n.EV.Stencil8:throw"No fixed size for Stencil8 format!";case n.EV.Depth16Unorm:return{width:1,height:1,length:2};case n.EV.Depth24Plus:throw"No fixed size for Depth24Plus format!";case n.EV.Depth24PlusStencil8:throw"No fixed size for Depth24PlusStencil8 format!";case n.EV.Depth32Float:case n.EV.Depth24UnormStencil8:return{width:1,height:1,length:4};case n.EV.Depth32FloatStencil8:return{width:1,height:1,length:5};case n.EV.BC7RGBAUnorm:case n.EV.BC7RGBAUnormSRGB:case n.EV.BC6HRGBUFloat:case n.EV.BC6HRGBFloat:case n.EV.BC5RGUnorm:case n.EV.BC5RGSnorm:case n.EV.BC3RGBAUnorm:case n.EV.BC3RGBAUnormSRGB:case n.EV.BC2RGBAUnorm:case n.EV.BC2RGBAUnormSRGB:return{width:4,height:4,length:16};case n.EV.BC4RUnorm:case n.EV.BC4RSnorm:case n.EV.BC1RGBAUnorm:case n.EV.BC1RGBAUnormSRGB:case n.EV.ETC2RGB8Unorm:case n.EV.ETC2RGB8UnormSRGB:case n.EV.ETC2RGB8A1Unorm:case n.EV.ETC2RGB8A1UnormSRGB:case n.EV.EACR11Unorm:case n.EV.EACR11Snorm:return{width:4,height:4,length:8};case n.EV.ETC2RGBA8Unorm:case n.EV.ETC2RGBA8UnormSRGB:case n.EV.EACRG11Unorm:case n.EV.EACRG11Snorm:case n.EV.ASTC4x4Unorm:case n.EV.ASTC4x4UnormSRGB:return{width:4,height:4,length:16};case n.EV.ASTC5x4Unorm:case n.EV.ASTC5x4UnormSRGB:return{width:5,height:4,length:16};case n.EV.ASTC5x5Unorm:case n.EV.ASTC5x5UnormSRGB:return{width:5,height:5,length:16};case n.EV.ASTC6x5Unorm:case n.EV.ASTC6x5UnormSRGB:return{width:6,height:5,length:16};case n.EV.ASTC6x6Unorm:case n.EV.ASTC6x6UnormSRGB:return{width:6,height:6,length:16};case n.EV.ASTC8x5Unorm:case n.EV.ASTC8x5UnormSRGB:return{width:8,height:5,length:16};case n.EV.ASTC8x6Unorm:case n.EV.ASTC8x6UnormSRGB:return{width:8,height:6,length:16};case n.EV.ASTC8x8Unorm:case n.EV.ASTC8x8UnormSRGB:return{width:8,height:8,length:16};case n.EV.ASTC10x5Unorm:case n.EV.ASTC10x5UnormSRGB:return{width:10,height:5,length:16};case n.EV.ASTC10x6Unorm:case n.EV.ASTC10x6UnormSRGB:return{width:10,height:6,length:16};case n.EV.ASTC10x8Unorm:case n.EV.ASTC10x8UnormSRGB:return{width:10,height:8,length:16};case n.EV.ASTC10x10Unorm:case n.EV.ASTC10x10UnormSRGB:return{width:10,height:10,length:16};case n.EV.ASTC12x10Unorm:case n.EV.ASTC12x10UnormSRGB:return{width:12,height:10,length:16};case n.EV.ASTC12x12Unorm:case n.EV.ASTC12x12UnormSRGB:return{width:12,height:12,length:16}}return{width:1,height:1,length:4}},e._IsHardwareTexture=function(e){return!!e.release},e._IsInternalTexture=function(e){return!!e.dispose},e.IsImageBitmap=function(e){return void 0!==e.close},e.IsImageBitmapArray=function(e){return Array.isArray(e)&&void 0!==e[0].close},e.prototype.setCommandEncoder=function(e){this._commandEncoderForCreation=e},e.IsCompressedFormat=function(e){switch(e){case n.EV.BC7RGBAUnormSRGB:case n.EV.BC7RGBAUnorm:case n.EV.BC6HRGBFloat:case n.EV.BC6HRGBUFloat:case n.EV.BC5RGSnorm:case n.EV.BC5RGUnorm:case n.EV.BC4RSnorm:case n.EV.BC4RUnorm:case n.EV.BC3RGBAUnormSRGB:case n.EV.BC3RGBAUnorm:case n.EV.BC2RGBAUnormSRGB:case n.EV.BC2RGBAUnorm:case n.EV.BC1RGBAUnormSRGB:case n.EV.BC1RGBAUnorm:case n.EV.ETC2RGB8Unorm:case n.EV.ETC2RGB8UnormSRGB:case n.EV.ETC2RGB8A1Unorm:case n.EV.ETC2RGB8A1UnormSRGB:case n.EV.ETC2RGBA8Unorm:case n.EV.ETC2RGBA8UnormSRGB:case n.EV.EACR11Unorm:case n.EV.EACR11Snorm:case n.EV.EACRG11Unorm:case n.EV.EACRG11Snorm:case n.EV.ASTC4x4Unorm:case n.EV.ASTC4x4UnormSRGB:case n.EV.ASTC5x4Unorm:case n.EV.ASTC5x4UnormSRGB:case n.EV.ASTC5x5Unorm:case n.EV.ASTC5x5UnormSRGB:case n.EV.ASTC6x5Unorm:case n.EV.ASTC6x5UnormSRGB:case n.EV.ASTC6x6Unorm:case n.EV.ASTC6x6UnormSRGB:case n.EV.ASTC8x5Unorm:case n.EV.ASTC8x5UnormSRGB:case n.EV.ASTC8x6Unorm:case n.EV.ASTC8x6UnormSRGB:case n.EV.ASTC8x8Unorm:case n.EV.ASTC8x8UnormSRGB:case n.EV.ASTC10x5Unorm:case n.EV.ASTC10x5UnormSRGB:case n.EV.ASTC10x6Unorm:case n.EV.ASTC10x6UnormSRGB:case n.EV.ASTC10x8Unorm:case n.EV.ASTC10x8UnormSRGB:case n.EV.ASTC10x10Unorm:case n.EV.ASTC10x10UnormSRGB:case n.EV.ASTC12x10Unorm:case n.EV.ASTC12x10UnormSRGB:case n.EV.ASTC12x12Unorm:case n.EV.ASTC12x12UnormSRGB:return!0}return!1},e.GetWebGPUTextureFormat=function(e,t,r){switch(void 0===r&&(r=!1),t){case 15:return n.EV.Depth16Unorm;case 16:return n.EV.Depth24Plus;case 13:return n.EV.Depth24PlusStencil8;case 14:return n.EV.Depth32Float;case 17:return n.EV.Depth24UnormStencil8;case 18:return n.EV.Depth32FloatStencil8;case 36492:return r?n.EV.BC7RGBAUnormSRGB:n.EV.BC7RGBAUnorm;case 36495:return n.EV.BC6HRGBUFloat;case 36494:return n.EV.BC6HRGBFloat;case 33779:return r?n.EV.BC3RGBAUnormSRGB:n.EV.BC3RGBAUnorm;case 33778:return r?n.EV.BC2RGBAUnormSRGB:n.EV.BC2RGBAUnorm;case 33777:case 33776:return r?n.EV.BC1RGBAUnormSRGB:n.EV.BC1RGBAUnorm;case 37808:return r?n.EV.ASTC4x4UnormSRGB:n.EV.ASTC4x4Unorm;case 36196:case 37492:return r?n.EV.ETC2RGB8UnormSRGB:n.EV.ETC2RGB8Unorm;case 37496:return r?n.EV.ETC2RGBA8UnormSRGB:n.EV.ETC2RGBA8Unorm}switch(e){case 3:switch(t){case 6:return n.EV.R8Snorm;case 7:return n.EV.RG8Snorm;case 4:throw"RGB format not supported in WebGPU";case 8:return n.EV.R8Sint;case 9:return n.EV.RG8Sint;case 10:throw"RGB_INTEGER format not supported in WebGPU";case 11:return n.EV.RGBA8Sint;default:return n.EV.RGBA8Snorm}case 0:switch(t){case 6:return n.EV.R8Unorm;case 7:return n.EV.RG8Unorm;case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";case 5:return r?n.EV.RGBA8UnormSRGB:n.EV.RGBA8Unorm;case 12:return r?n.EV.BGRA8UnormSRGB:n.EV.BGRA8Unorm;case 8:return n.EV.R8Uint;case 9:return n.EV.RG8Uint;case 10:throw"RGB_INTEGER format not supported in WebGPU";case 11:return n.EV.RGBA8Uint;case 0:throw"TEXTUREFORMAT_ALPHA format not supported in WebGPU";case 1:throw"TEXTUREFORMAT_LUMINANCE format not supported in WebGPU";case 2:throw"TEXTUREFORMAT_LUMINANCE_ALPHA format not supported in WebGPU";default:return n.EV.RGBA8Unorm}case 4:switch(t){case 8:return n.EV.R16Sint;case 9:return n.EV.RG16Sint;case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";default:return n.EV.RGBA16Sint}case 5:switch(t){case 8:return n.EV.R16Uint;case 9:return n.EV.RG16Uint;case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";default:return n.EV.RGBA16Uint}case 6:switch(t){case 8:return n.EV.R32Sint;case 9:return n.EV.RG32Sint;case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";default:return n.EV.RGBA32Sint}case 7:switch(t){case 8:return n.EV.R32Uint;case 9:return n.EV.RG32Uint;case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";default:return n.EV.RGBA32Uint}case 1:switch(t){case 6:return n.EV.R32Float;case 7:return n.EV.RG32Float;case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";default:return n.EV.RGBA32Float}case 2:switch(t){case 6:return n.EV.R16Float;case 7:return n.EV.RG16Float;case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";default:return n.EV.RGBA16Float}case 10:throw"TEXTURETYPE_UNSIGNED_SHORT_5_6_5 format not supported in WebGPU";case 13:throw"TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV format not supported in WebGPU";case 14:throw"TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV format not supported in WebGPU";case 8:throw"TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 format not supported in WebGPU";case 9:throw"TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 format not supported in WebGPU";case 11:switch(t){case 5:default:return n.EV.RGB10A2Unorm;case 11:throw"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV"}}return r?n.EV.RGBA8UnormSRGB:n.EV.RGBA8Unorm},e.GetNumChannelsFromWebGPUTextureFormat=function(e){switch(e){case n.EV.R8Unorm:case n.EV.R8Snorm:case n.EV.R8Uint:case n.EV.R8Sint:case n.EV.BC4RUnorm:case n.EV.BC4RSnorm:case n.EV.R16Uint:case n.EV.R16Sint:case n.EV.Depth16Unorm:case n.EV.R16Float:case n.EV.R32Uint:case n.EV.R32Sint:case n.EV.R32Float:case n.EV.Depth32Float:case n.EV.Stencil8:case n.EV.Depth24Plus:case n.EV.EACR11Unorm:case n.EV.EACR11Snorm:return 1;case n.EV.RG8Unorm:case n.EV.RG8Snorm:case n.EV.RG8Uint:case n.EV.RG8Sint:case n.EV.Depth24UnormStencil8:case n.EV.Depth32FloatStencil8:case n.EV.BC5RGUnorm:case n.EV.BC5RGSnorm:case n.EV.RG16Uint:case n.EV.RG16Sint:case n.EV.RG16Float:case n.EV.RG32Uint:case n.EV.RG32Sint:case n.EV.RG32Float:case n.EV.Depth24PlusStencil8:case n.EV.EACRG11Unorm:case n.EV.EACRG11Snorm:return 2;case n.EV.RGB9E5UFloat:case n.EV.RG11B10UFloat:case n.EV.BC6HRGBUFloat:case n.EV.BC6HRGBFloat:case n.EV.ETC2RGB8Unorm:case n.EV.ETC2RGB8UnormSRGB:return 3;case n.EV.RGBA8Unorm:case n.EV.RGBA8UnormSRGB:case n.EV.RGBA8Snorm:case n.EV.RGBA8Uint:case n.EV.RGBA8Sint:case n.EV.BGRA8Unorm:case n.EV.BGRA8UnormSRGB:case n.EV.RGB10A2Unorm:case n.EV.BC7RGBAUnorm:case n.EV.BC7RGBAUnormSRGB:case n.EV.BC3RGBAUnorm:case n.EV.BC3RGBAUnormSRGB:case n.EV.BC2RGBAUnorm:case n.EV.BC2RGBAUnormSRGB:case n.EV.BC1RGBAUnorm:case n.EV.BC1RGBAUnormSRGB:case n.EV.RGBA16Uint:case n.EV.RGBA16Sint:case n.EV.RGBA16Float:case n.EV.RGBA32Uint:case n.EV.RGBA32Sint:case n.EV.RGBA32Float:case n.EV.ETC2RGB8A1Unorm:case n.EV.ETC2RGB8A1UnormSRGB:case n.EV.ETC2RGBA8Unorm:case n.EV.ETC2RGBA8UnormSRGB:case n.EV.ASTC4x4Unorm:case n.EV.ASTC4x4UnormSRGB:case n.EV.ASTC5x4Unorm:case n.EV.ASTC5x4UnormSRGB:case n.EV.ASTC5x5Unorm:case n.EV.ASTC5x5UnormSRGB:case n.EV.ASTC6x5Unorm:case n.EV.ASTC6x5UnormSRGB:case n.EV.ASTC6x6Unorm:case n.EV.ASTC6x6UnormSRGB:case n.EV.ASTC8x5Unorm:case n.EV.ASTC8x5UnormSRGB:case n.EV.ASTC8x6Unorm:case n.EV.ASTC8x6UnormSRGB:case n.EV.ASTC8x8Unorm:case n.EV.ASTC8x8UnormSRGB:case n.EV.ASTC10x5Unorm:case n.EV.ASTC10x5UnormSRGB:case n.EV.ASTC10x6Unorm:case n.EV.ASTC10x6UnormSRGB:case n.EV.ASTC10x8Unorm:case n.EV.ASTC10x8UnormSRGB:case n.EV.ASTC10x10Unorm:case n.EV.ASTC10x10UnormSRGB:case n.EV.ASTC12x10Unorm:case n.EV.ASTC12x10UnormSRGB:case n.EV.ASTC12x12Unorm:case n.EV.ASTC12x12UnormSRGB:return 4}throw"Unknown format ".concat(e,"!")},e.HasStencilAspect=function(e){switch(e){case n.EV.Stencil8:case n.EV.Depth24UnormStencil8:case n.EV.Depth32FloatStencil8:case n.EV.Depth24PlusStencil8:return!0}return!1},e.HasDepthAndStencilAspects=function(e){switch(e){case n.EV.Depth24UnormStencil8:case n.EV.Depth32FloatStencil8:case n.EV.Depth24PlusStencil8:return!0}return!1},e.prototype.invertYPreMultiplyAlpha=function(t,r,s,o,a,u,c,l,h,p,d,_,f,g,m){var E,v,T,y,b,x;void 0===a&&(a=!1),void 0===u&&(u=!1),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=1),void 0===p&&(p=0),void 0===d&&(d=0),void 0===_&&(_=0),void 0===f&&(f=0);var S,R=0!==_,A=void 0===g,C=this._getPipeline(o,R?i.InvertYPremultiplyAlphaWithOfst:i.InvertYPremultiplyAlpha,{invertY:a,premultiplyAlpha:u}),B=C[0],P=C[1];if(c=Math.max(c,0),A&&(g=this._device.createCommandEncoder({})),null===(v=(E=g).pushDebugGroup)||void 0===v||v.call(E,"internal process texture - invertY=".concat(a," premultiplyAlpha=").concat(u)),e._IsHardwareTexture(t)?(S=t.underlyingResource,a&&!u&&1===h&&0===c||(t=void 0)):(S=t,t=void 0),S){R&&this._bufferManager.setRawData(this._ubCopyWithOfst,0,new Float32Array([p,d,_,f]),0,16);var I=t,D=null!==(T=null==I?void 0:I._copyInvertYTempTexture)&&void 0!==T?T:this.createTexture({width:r,height:s,layers:1},!1,!1,!1,!1,!1,o,1,g,n.v2.CopySrc|n.v2.RenderAttachment|n.v2.TextureBinding),F=null!==(y=null==I?void 0:I._copyInvertYRenderPassDescr)&&void 0!==y?y:{colorAttachments:[{view:D.createView({format:o,dimension:n.p_.E2d,baseMipLevel:0,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:0}),loadOp:n.Ws.Load,storeOp:n.EG.Store}]},U=g.beginRenderPass(F),w=R?null==I?void 0:I._copyInvertYBindGroupWithOfst:null==I?void 0:I._copyInvertYBindGroup;if(!w){var L={layout:P,entries:[{binding:0,resource:S.createView({format:o,dimension:n.p_.E2d,baseMipLevel:l,mipLevelCount:1,arrayLayerCount:h,baseArrayLayer:c})}]};R&&L.entries.push({binding:1,resource:{buffer:this._ubCopyWithOfst}}),w=this._device.createBindGroup(L)}U.setPipeline(B),U.setBindGroup(0,w),U.draw(4,1,0,0),U.end(),g.copyTextureToTexture({texture:D},{texture:S,mipLevel:l,origin:{x:0,y:0,z:c}},{width:r,height:s,depthOrArrayLayers:1}),I?(I._copyInvertYTempTexture=D,I._copyInvertYRenderPassDescr=F,R?I._copyInvertYBindGroupWithOfst=w:I._copyInvertYBindGroup=w):this._deferredReleaseTextures.push([D,null]),null===(x=(b=g).popDebugGroup)||void 0===x||x.call(b),A&&(this._device.queue.submit([g.finish()]),g=null)}},e.prototype.copyWithInvertY=function(e,t,r,n){var s,o,a,u,c=void 0===n,l=this._getPipeline(t,i.InvertYPremultiplyAlpha,{invertY:!0,premultiplyAlpha:!1}),h=l[0],p=l[1];c&&(n=this._device.createCommandEncoder({})),null===(o=(s=n).pushDebugGroup)||void 0===o||o.call(s,"internal copy texture with invertY");var d=n.beginRenderPass(r),_=this._device.createBindGroup({layout:p,entries:[{binding:0,resource:e}]});d.setPipeline(h),d.setBindGroup(0,_),d.draw(4,1,0,0),d.end(),null===(u=(a=n).popDebugGroup)||void 0===u||u.call(a),c&&(this._device.queue.submit([n.finish()]),n=null)},e.prototype.createTexture=function(t,r,i,s,o,a,u,c,l,h,p){void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===a&&(a=!1),void 0===u&&(u=n.EV.RGBA8Unorm),void 0===c&&(c=1),void 0===h&&(h=-1),void 0===p&&(p=0),c>1&&(c=4);var d=t.layers||1,_={width:t.width,height:t.height,depthOrArrayLayers:d},f=e.IsCompressedFormat(u),g=r?e.ComputeNumMipmapLevels(t.width,t.height):1,m=h>=0?h:n.v2.CopySrc|n.v2.CopyDst|n.v2.TextureBinding;p|=r&&!f?n.v2.CopySrc|n.v2.RenderAttachment:0,f||a||(p|=n.v2.RenderAttachment|n.v2.CopyDst);var E=this._device.createTexture({size:_,dimension:a?n.kd.E3d:n.kd.E2d,format:u,usage:m|p,sampleCount:c,mipLevelCount:g});return e.IsImageBitmap(t)&&(this.updateTexture(t,E,t.width,t.height,d,u,0,0,s,o,0,0),r&&i&&this.generateMipmaps(E,u,g,0,l)),E},e.prototype.createCubeTexture=function(t,r,i,s,o,a,u,c,l,h){void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===a&&(a=n.EV.RGBA8Unorm),void 0===u&&(u=1),void 0===l&&(l=-1),void 0===h&&(h=0),u>1&&(u=4);var p=e.IsImageBitmapArray(t)?t[0].width:t.width,d=e.IsImageBitmapArray(t)?t[0].height:t.height,_=e.IsCompressedFormat(a),f=r?e.ComputeNumMipmapLevels(p,d):1,g=l>=0?l:n.v2.CopySrc|n.v2.CopyDst|n.v2.TextureBinding;h|=r&&!_?n.v2.CopySrc|n.v2.RenderAttachment:0,_||(h|=n.v2.RenderAttachment|n.v2.CopyDst);var m=this._device.createTexture({size:{width:p,height:d,depthOrArrayLayers:6},dimension:n.kd.E2d,format:a,usage:g|h,sampleCount:u,mipLevelCount:f});return e.IsImageBitmapArray(t)&&(this.updateCubeTextures(t,m,p,d,a,s,o,0,0),r&&i&&this.generateCubeMipmaps(m,a,f,c)),m},e.prototype.generateCubeMipmaps=function(e,t,r,i){var n,s,o,a,u=void 0===i;u&&(i=this._device.createCommandEncoder({})),null===(s=(n=i).pushDebugGroup)||void 0===s||s.call(n,"create cube mipmaps - ".concat(r," levels"));for(var c=0;c<6;++c)this.generateMipmaps(e,t,r,c,i);null===(a=(o=i).popDebugGroup)||void 0===a||a.call(o),u&&(this._device.queue.submit([i.finish()]),i=null)},e.prototype.generateMipmaps=function(t,r,i,s,o){var a,u,c,l,h,p,d,_;void 0===s&&(s=0);var f,g=void 0===o,m=this._getPipeline(r),E=m[0],v=m[1];if(s=Math.max(s,0),g&&(o=this._device.createCommandEncoder({})),null===(u=(a=o).pushDebugGroup)||void 0===u||u.call(a,"create mipmaps for face #".concat(s," - ").concat(i," levels")),e._IsHardwareTexture(t)?(f=t.underlyingResource,t._mipmapGenRenderPassDescr=t._mipmapGenRenderPassDescr||[],t._mipmapGenBindGroup=t._mipmapGenBindGroup||[]):(f=t,t=void 0),f){for(var T=t,y=1;y<i;++y){var b=null!==(l=null===(c=null==T?void 0:T._mipmapGenRenderPassDescr[s])||void 0===c?void 0:c[y-1])&&void 0!==l?l:{colorAttachments:[{view:f.createView({format:r,dimension:n.p_.E2d,baseMipLevel:y,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:s}),loadOp:n.Ws.Load,storeOp:n.EG.Store}]};T&&(T._mipmapGenRenderPassDescr[s]=T._mipmapGenRenderPassDescr[s]||[],T._mipmapGenRenderPassDescr[s][y-1]=b);var x=o.beginRenderPass(b),S=null!==(p=null===(h=null==T?void 0:T._mipmapGenBindGroup[s])||void 0===h?void 0:h[y-1])&&void 0!==p?p:this._device.createBindGroup({layout:v,entries:[{binding:0,resource:this._mipmapSampler},{binding:1,resource:f.createView({format:r,dimension:n.p_.E2d,baseMipLevel:y-1,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:s})}]});T&&(T._mipmapGenBindGroup[s]=T._mipmapGenBindGroup[s]||[],T._mipmapGenBindGroup[s][y-1]=S),x.setPipeline(E),x.setBindGroup(0,S),x.draw(4,1,0,0),x.end()}null===(_=(d=o).popDebugGroup)||void 0===_||_.call(d),g&&(this._device.queue.submit([o.finish()]),o=null)}},e.prototype.createGPUTextureForInternalTexture=function(t,r,i,s,u){t._hardwareTexture||(t._hardwareTexture=new a.Z),void 0===r&&(r=t.width),void 0===i&&(i=t.height),void 0===s&&(s=t.depth);var c=t._hardwareTexture,l=0!=(1&(null!=u?u:0));c.format=e.GetWebGPUTextureFormat(t.type,t.format,t._useSRGBBuffer),c.textureUsages=t._source===o.S.RenderTarget||t.source===o.S.MultiRenderTarget?n.v2.TextureBinding|n.v2.CopySrc|n.v2.RenderAttachment:t._source===o.S.DepthStencil?n.v2.TextureBinding|n.v2.RenderAttachment:-1,c.textureAdditionalUsages=l?n.v2.StorageBinding:0;var h,p=t.generateMipMaps,d=s||1;if(h=null!==t._maxLodLevel?t._maxLodLevel:p?e.ComputeNumMipmapLevels(r,i):1,t.isCube){var _=this.createCubeTexture({width:r,height:i},t.generateMipMaps,t.generateMipMaps,t.invertY,!1,c.format,1,this._commandEncoderForCreation,c.textureUsages,c.textureAdditionalUsages);c.set(_),c.createView({format:c.format,dimension:n.p_.Cube,mipLevelCount:h,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:6,aspect:e.HasDepthAndStencilAspects(c.format)?n.H7.DepthOnly:n.H7.All},l)}else{_=this.createTexture({width:r,height:i,layers:d},t.generateMipMaps,t.generateMipMaps,t.invertY,!1,t.is3D,c.format,1,this._commandEncoderForCreation,c.textureUsages,c.textureAdditionalUsages);c.set(_),c.createView({format:c.format,dimension:t.is2DArray?n.p_.E2dArray:t.is3D?n.kd.E3d:n.p_.E2d,mipLevelCount:h,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:t.is3D?1:d,aspect:e.HasDepthAndStencilAspects(c.format)?n.H7.DepthOnly:n.H7.All},l)}return t.width=t.baseWidth=r,t.height=t.baseHeight=i,t.depth=t.baseDepth=s,this.createMSAATexture(t,t.samples),c},e.prototype.createMSAATexture=function(e,t){var r=e._hardwareTexture;if((null==r?void 0:r.msaaTexture)&&(this.releaseTexture(r.msaaTexture),r.msaaTexture=null),r&&!((null!=t?t:1)<=1)){var i=e.width,n=e.height,s=e.depth||1;if(e.isCube){var o=this.createCubeTexture({width:i,height:n},!1,!1,e.invertY,!1,r.format,t,this._commandEncoderForCreation,r.textureUsages,r.textureAdditionalUsages);r.msaaTexture=o}else{o=this.createTexture({width:i,height:n,layers:s},!1,!1,e.invertY,!1,e.is3D,r.format,t,this._commandEncoderForCreation,r.textureUsages,r.textureAdditionalUsages);r.msaaTexture=o}}},e.prototype.updateCubeTextures=function(e,t,r,i,n,s,o,a,u){void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===u&&(u=0);for(var c=[0,3,1,4,2,5],l=0;l<c.length;++l){var h=e[c[l]];this.updateTexture(h,t,r,i,1,n,l,0,s,o,a,u)}},e.prototype.updateTexture=function(t,r,i,s,o,a,u,c,l,h,p,d,_){void 0===u&&(u=0),void 0===c&&(c=0),void 0===l&&(l=!1),void 0===h&&(h=!1),void 0===p&&(p=0),void 0===d&&(d=0);var f=e._IsInternalTexture(r)?r._hardwareTexture.underlyingResource:r,g=e._GetBlockInformationFromFormat(a),m=e._IsInternalTexture(r)?r._hardwareTexture:r,E={texture:f,origin:{x:p,y:d,z:Math.max(u,0)},mipLevel:c,premultipliedAlpha:h},v={width:Math.ceil(i/g.width)*g.width,height:Math.ceil(s/g.height)*g.height,depthOrArrayLayers:o||1};if(void 0!==t.byteLength){var T=Math.ceil(i/g.width)*g.length;if(256*Math.ceil(T/256)===T){var y=this._device.createCommandEncoder({}),b=this._bufferManager.createRawBuffer(t.byteLength,n.FB.MapWrite|n.FB.CopySrc,!0),x=b.getMappedRange();new Uint8Array(x).set(t),b.unmap(),y.copyBufferToTexture({buffer:b,offset:0,bytesPerRow:T,rowsPerImage:s},E,v),this._device.queue.submit([y.finish()]),this._bufferManager.releaseBuffer(b)}else this._device.queue.writeTexture(E,t,{offset:0,bytesPerRow:T,rowsPerImage:s},v);if(l||h){if(!e._IsInternalTexture(r))throw"updateTexture: Can't process the texture data because a GPUTexture was provided instead of an InternalTexture!";var S=0===p&&0===d&&i===r.width&&s===r.height;this.invertYPreMultiplyAlpha(m,r.width,r.height,a,l,h,u,c,o||1,p,d,S?0:i,S?0:s,void 0,_)}}else if(l)if(E.premultipliedAlpha=!1,e._IsInternalTexture(r)&&0===p&&0===d&&i===r.width&&s===r.height)this._device.queue.copyExternalImageToTexture({source:t},E,v),this.invertYPreMultiplyAlpha(m,i,s,a,l,h,u,c,o||1,0,0,0,0,void 0,_);else{y=this._device.createCommandEncoder({});var R=this.createTexture({width:i,height:s,layers:1},!1,!1,!1,!1,!1,a,1,y,n.v2.CopySrc|n.v2.TextureBinding);this._deferredReleaseTextures.push([R,null]),v.depthOrArrayLayers=1,this._device.queue.copyExternalImageToTexture({source:t},{texture:R},v),v.depthOrArrayLayers=o||1,this.invertYPreMultiplyAlpha(R,i,s,a,l,h,u,c,o||1,0,0,0,0,y,_),y.copyTextureToTexture({texture:R},E,v),this._device.queue.submit([y.finish()])}else this._device.queue.copyExternalImageToTexture({source:t},E,v)},e.prototype.readPixels=function(t,r,i,s,o,a,u,c,l,h){void 0===u&&(u=0),void 0===c&&(c=0),void 0===l&&(l=null),void 0===h&&(h=!1);var p=e._GetBlockInformationFromFormat(a),d=Math.ceil(s/p.width)*p.length,_=256*Math.ceil(d/256),f=_*o,g=this._bufferManager.createRawBuffer(f,n.FB.MapRead|n.FB.CopyDst),m=this._device.createCommandEncoder({});return m.copyTextureToBuffer({texture:t,mipLevel:c,origin:{x:r,y:i,z:Math.max(u,0)}},{buffer:g,offset:0,bytesPerRow:_},{width:s,height:o,depthOrArrayLayers:1}),this._device.queue.submit([m.finish()]),this._bufferManager.readDataFromBuffer(g,f,s,o,d,_,e._GetTextureTypeFromFormat(a),0,l,!0,h)},e.prototype.releaseTexture=function(t){if(e._IsInternalTexture(t)){var r=t._hardwareTexture,i=t._irradianceTexture;this._deferredReleaseTextures.push([r,i])}else this._deferredReleaseTextures.push([t,null])},e.prototype.destroyDeferredTextures=function(){for(var t=0;t<this._deferredReleaseTextures.length;++t){var r=this._deferredReleaseTextures[t],i=r[0],n=r[1];i&&(e._IsHardwareTexture(i)?i.release():i.destroy()),null==n||n.dispose()}this._deferredReleaseTextures.length=0},e}()},73750:(e,t,r)=>{r.d(t,{b:()=>a});var i=r(31191),n=r(8724),s=r(82577),o=r(22812),a=function(){function e(e,t){this._enabled=!1,this._gpuFrameTimeCounter=new s.z,this._measureDurationState=0,this._device=e,this._bufferManager=t}return Object.defineProperty(e.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTimeCounter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enable",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._measureDurationState=0,e?this._measureDuration=new u(this._device,this._bufferManager):this._measureDuration.dispose())},enumerable:!1,configurable:!0}),e.prototype.startFrame=function(e){this._enabled&&0===this._measureDurationState&&(this._measureDuration.start(e),this._measureDurationState=1)},e.prototype.endFrame=function(e){var t=this;1===this._measureDurationState&&(this._measureDurationState=2,this._measureDuration.stop(e).then((function(e){null!==e&&e>=0&&(t._gpuFrameTimeCounter.fetchNewFrame(),t._gpuFrameTimeCounter.addCount(e,!0)),t._measureDurationState=0})))},e}(),u=function(){function e(e,t){this._querySet=new o.t(2,n.xL.Timestamp,e,t)}return e.prototype.start=function(e){e.writeTimestamp(this._querySet.querySet,0)},e.prototype.stop=function(e){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){return e.writeTimestamp(this._querySet.querySet,1),[2,this._querySet.readTwoValuesAndSubtract(0)]}))}))},e.prototype.dispose=function(){this._querySet.dispose()},e}()},59412:(e,t,r)=>{r.d(t,{S:()=>o});var i=r(31191),n=r(80352),s=r(13514),o=function(){function e(){this._twgsl=null}return e.prototype.initTwgsl=function(t){return(0,i.mG)(this,void 0,void 0,(function(){var r;return(0,i.Jh)(this,(function(o){switch(o.label){case 0:return t=t||{},(t=(0,i.pi)((0,i.pi)({},e._TWgslDefaultOptions),t)).twgsl?(this._twgsl=t.twgsl,[2,Promise.resolve()]):t.jsPath&&t.wasmPath?(0,n.CG)()?[4,s.w1.LoadScriptAsync(t.jsPath)]:[3,2]:[3,3];case 1:return o.sent(),[3,3];case 2:importScripts(t.jsPath),o.label=3;case 3:return self.twgsl?(r=this,[4,self.twgsl(t.wasmPath)]):[3,5];case 4:return r._twgsl=o.sent(),[2,Promise.resolve()];case 5:return[2,Promise.reject("twgsl is not available.")]}}))}))},e.prototype.convertSpirV2WGSL=function(e){return this._twgsl.convertSpirV2WGSL(e)},e._TWgslDefaultOptions={jsPath:"https://preview.babylonjs.com/twgsl/twgsl.js",wasmPath:"https://preview.babylonjs.com/twgsl/twgsl.wasm"},e}()},34941:(e,t,r)=>{r.d(t,{g:()=>i});var i=function(){function e(){}return e.ALPHA_DISABLE=0,e.ALPHA_ADD=1,e.ALPHA_COMBINE=2,e.ALPHA_SUBTRACT=3,e.ALPHA_MULTIPLY=4,e.ALPHA_MAXIMIZED=5,e.ALPHA_ONEONE=6,e.ALPHA_PREMULTIPLIED=7,e.ALPHA_PREMULTIPLIED_PORTERDUFF=8,e.ALPHA_INTERPOLATE=9,e.ALPHA_SCREENMODE=10,e.ALPHA_ONEONE_ONEONE=11,e.ALPHA_ALPHATOCOLOR=12,e.ALPHA_REVERSEONEMINUS=13,e.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,e.ALPHA_ONEONE_ONEZERO=15,e.ALPHA_EXCLUSION=16,e.ALPHA_LAYER_ACCUMULATE=17,e.ALPHA_EQUATION_ADD=0,e.ALPHA_EQUATION_SUBSTRACT=1,e.ALPHA_EQUATION_REVERSE_SUBTRACT=2,e.ALPHA_EQUATION_MAX=3,e.ALPHA_EQUATION_MIN=4,e.ALPHA_EQUATION_DARKEN=5,e.DELAYLOADSTATE_NONE=0,e.DELAYLOADSTATE_LOADED=1,e.DELAYLOADSTATE_LOADING=2,e.DELAYLOADSTATE_NOTLOADED=4,e.NEVER=512,e.ALWAYS=519,e.LESS=513,e.EQUAL=514,e.LEQUAL=515,e.GREATER=516,e.GEQUAL=518,e.NOTEQUAL=517,e.KEEP=7680,e.ZERO=0,e.REPLACE=7681,e.INCR=7682,e.DECR=7683,e.INVERT=5386,e.INCR_WRAP=34055,e.DECR_WRAP=34056,e.TEXTURE_CLAMP_ADDRESSMODE=0,e.TEXTURE_WRAP_ADDRESSMODE=1,e.TEXTURE_MIRROR_ADDRESSMODE=2,e.TEXTURE_CREATIONFLAG_STORAGE=1,e.TEXTUREFORMAT_ALPHA=0,e.TEXTUREFORMAT_LUMINANCE=1,e.TEXTUREFORMAT_LUMINANCE_ALPHA=2,e.TEXTUREFORMAT_RGB=4,e.TEXTUREFORMAT_RGBA=5,e.TEXTUREFORMAT_RED=6,e.TEXTUREFORMAT_R=6,e.TEXTUREFORMAT_RG=7,e.TEXTUREFORMAT_RED_INTEGER=8,e.TEXTUREFORMAT_R_INTEGER=8,e.TEXTUREFORMAT_RG_INTEGER=9,e.TEXTUREFORMAT_RGB_INTEGER=10,e.TEXTUREFORMAT_RGBA_INTEGER=11,e.TEXTUREFORMAT_BGRA=12,e.TEXTUREFORMAT_DEPTH24_STENCIL8=13,e.TEXTUREFORMAT_DEPTH32_FLOAT=14,e.TEXTUREFORMAT_DEPTH16=15,e.TEXTUREFORMAT_DEPTH24=16,e.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,e.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,e.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,e.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,e.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,e.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,e.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,e.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,e.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,e.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,e.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,e.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,e.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,e.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,e.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,e.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,e.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,e.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,e.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,e.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,e.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,e.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,e.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,e.TEXTURETYPE_UNSIGNED_BYTE=0,e.TEXTURETYPE_UNSIGNED_INT=0,e.TEXTURETYPE_FLOAT=1,e.TEXTURETYPE_HALF_FLOAT=2,e.TEXTURETYPE_BYTE=3,e.TEXTURETYPE_SHORT=4,e.TEXTURETYPE_UNSIGNED_SHORT=5,e.TEXTURETYPE_INT=6,e.TEXTURETYPE_UNSIGNED_INTEGER=7,e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,e.TEXTURETYPE_UNSIGNED_INT_24_8=12,e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,e.TEXTURETYPE_UNDEFINED=16,e.TEXTURE_NEAREST_SAMPLINGMODE=1,e.TEXTURE_NEAREST_NEAREST=1,e.TEXTURE_BILINEAR_SAMPLINGMODE=2,e.TEXTURE_LINEAR_LINEAR=2,e.TEXTURE_TRILINEAR_SAMPLINGMODE=3,e.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,e.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,e.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,e.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,e.TEXTURE_NEAREST_LINEAR=7,e.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,e.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,e.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,e.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,e.TEXTURE_LINEAR_NEAREST=12,e.TEXTURE_EXPLICIT_MODE=0,e.TEXTURE_SPHERICAL_MODE=1,e.TEXTURE_PLANAR_MODE=2,e.TEXTURE_CUBIC_MODE=3,e.TEXTURE_PROJECTION_MODE=4,e.TEXTURE_SKYBOX_MODE=5,e.TEXTURE_INVCUBIC_MODE=6,e.TEXTURE_EQUIRECTANGULAR_MODE=7,e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,e.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,e.TEXTURE_FILTERING_QUALITY_HIGH=64,e.TEXTURE_FILTERING_QUALITY_MEDIUM=16,e.TEXTURE_FILTERING_QUALITY_LOW=8,e.SCALEMODE_FLOOR=1,e.SCALEMODE_NEAREST=2,e.SCALEMODE_CEILING=3,e.MATERIAL_TextureDirtyFlag=1,e.MATERIAL_LightDirtyFlag=2,e.MATERIAL_FresnelDirtyFlag=4,e.MATERIAL_AttributesDirtyFlag=8,e.MATERIAL_MiscDirtyFlag=16,e.MATERIAL_PrePassDirtyFlag=32,e.MATERIAL_AllDirtyFlag=63,e.MATERIAL_TriangleFillMode=0,e.MATERIAL_WireFrameFillMode=1,e.MATERIAL_PointFillMode=2,e.MATERIAL_PointListDrawMode=3,e.MATERIAL_LineListDrawMode=4,e.MATERIAL_LineLoopDrawMode=5,e.MATERIAL_LineStripDrawMode=6,e.MATERIAL_TriangleStripDrawMode=7,e.MATERIAL_TriangleFanDrawMode=8,e.MATERIAL_ClockWiseSideOrientation=0,e.MATERIAL_CounterClockWiseSideOrientation=1,e.ACTION_NothingTrigger=0,e.ACTION_OnPickTrigger=1,e.ACTION_OnLeftPickTrigger=2,e.ACTION_OnRightPickTrigger=3,e.ACTION_OnCenterPickTrigger=4,e.ACTION_OnPickDownTrigger=5,e.ACTION_OnDoublePickTrigger=6,e.ACTION_OnPickUpTrigger=7,e.ACTION_OnPickOutTrigger=16,e.ACTION_OnLongPressTrigger=8,e.ACTION_OnPointerOverTrigger=9,e.ACTION_OnPointerOutTrigger=10,e.ACTION_OnEveryFrameTrigger=11,e.ACTION_OnIntersectionEnterTrigger=12,e.ACTION_OnIntersectionExitTrigger=13,e.ACTION_OnKeyDownTrigger=14,e.ACTION_OnKeyUpTrigger=15,e.PARTICLES_BILLBOARDMODE_Y=2,e.PARTICLES_BILLBOARDMODE_ALL=7,e.PARTICLES_BILLBOARDMODE_STRETCHED=8,e.MESHES_CULLINGSTRATEGY_STANDARD=0,e.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,e.SCENELOADER_NO_LOGGING=0,e.SCENELOADER_MINIMAL_LOGGING=1,e.SCENELOADER_SUMMARY_LOGGING=2,e.SCENELOADER_DETAILED_LOGGING=3,e.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,e.PREPASS_POSITION_TEXTURE_TYPE=1,e.PREPASS_VELOCITY_TEXTURE_TYPE=2,e.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,e.PREPASS_COLOR_TEXTURE_TYPE=4,e.PREPASS_DEPTH_TEXTURE_TYPE=5,e.PREPASS_NORMAL_TEXTURE_TYPE=6,e.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,e.BUFFER_CREATIONFLAG_READ=1,e.BUFFER_CREATIONFLAG_WRITE=2,e.BUFFER_CREATIONFLAG_READWRITE=3,e.BUFFER_CREATIONFLAG_UNIFORM=4,e.BUFFER_CREATIONFLAG_VERTEX=8,e.BUFFER_CREATIONFLAG_INDEX=16,e.BUFFER_CREATIONFLAG_STORAGE=32,e.RENDERPASS_MAIN=0,e.INPUT_ALT_KEY=18,e.INPUT_CTRL_KEY=17,e.INPUT_META_KEY1=91,e.INPUT_META_KEY2=92,e.INPUT_META_KEY3=93,e.INPUT_SHIFT_KEY=16,e.SNAPSHOTRENDERING_STANDARD=0,e.SNAPSHOTRENDERING_FAST=1,e.PERSPECTIVE_CAMERA=0,e.ORTHOGRAPHIC_CAMERA=1,e.FOVMODE_VERTICAL_FIXED=0,e.FOVMODE_HORIZONTAL_FIXED=1,e.RIG_MODE_NONE=0,e.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,e.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,e.RIG_MODE_STEREOSCOPIC_INTERLACED=14,e.RIG_MODE_VR=20,e.RIG_MODE_WEBVR=21,e.RIG_MODE_CUSTOM=22,e.MAX_SUPPORTED_UV_SETS=6,e.GL_ALPHA_EQUATION_ADD=32774,e.GL_ALPHA_EQUATION_MIN=32775,e.GL_ALPHA_EQUATION_MAX=32776,e.GL_ALPHA_EQUATION_SUBTRACT=32778,e.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,e.GL_ALPHA_FUNCTION_SRC=768,e.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,e.GL_ALPHA_FUNCTION_SRC_ALPHA=770,e.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,e.GL_ALPHA_FUNCTION_DST_ALPHA=772,e.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,e.GL_ALPHA_FUNCTION_DST_COLOR=774,e.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,e.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,e.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,e.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,e.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,e.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,e.SnippetUrl="https://snippet.babylonjs.com",e}()},37290:(e,t,r)=>{r.d(t,{D:()=>f});var i=r(31191),n=r(62897),s=r(7949),o=r(80352),a=r(15210),u=r(77851),c=r(61159),l=r(31700),h=r(82577),p=r(21254),d=r(84318),_=r(61319),f=(r(21352),r(5382),r(89553),function(e){function t(r,i,s,a){void 0===a&&(a=!1);var u=e.call(this,r,i,s,a)||this;if(u.enableOfflineSupport=!1,u.disableManifestCheck=!1,u.scenes=new Array,u._virtualScenes=new Array,u.onNewSceneAddedObservable=new n.y$,u.postProcesses=new Array,u.isPointerLock=!1,u.onResizeObservable=new n.y$,u.onCanvasBlurObservable=new n.y$,u.onCanvasFocusObservable=new n.y$,u.onCanvasPointerOutObservable=new n.y$,u.onBeginFrameObservable=new n.y$,u.customAnimationFrameRequester=null,u.onEndFrameObservable=new n.y$,u.onBeforeShaderCompilationObservable=new n.y$,u.onAfterShaderCompilationObservable=new n.y$,u._deterministicLockstep=!1,u._lockstepMaxSteps=4,u._timeStep=1/60,u._fps=60,u._deltaTime=0,u._drawCalls=new h.z,u.canvasTabIndex=1,u.disablePerformanceMonitorInBackground=!1,u._performanceMonitor=new l.A,u._compatibilityMode=!0,u.currentRenderPassId=0,u._renderPassNames=["main"],t.Instances.push(u),!r)return u;if(u._features.supportRenderPasses=!0,s=u._creationOptions,r.getContext){var c=r;if(u._sharedInit(c,!!s.doNotHandleTouchAction,s.audioEngine),(0,o.CG)()){var p=document;u._onFullscreenChange=function(){void 0!==p.fullscreen?u.isFullscreen=p.fullscreen:void 0!==p.mozFullScreen?u.isFullscreen=p.mozFullScreen:void 0!==p.webkitIsFullScreen?u.isFullscreen=p.webkitIsFullScreen:void 0!==p.msIsFullScreen&&(u.isFullscreen=p.msIsFullScreen),u.isFullscreen&&u._pointerLockRequested&&c&&t._RequestPointerlock(c)},document.addEventListener("fullscreenchange",u._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",u._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",u._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",u._onFullscreenChange,!1),u._onPointerLockChange=function(){u.isPointerLock=p.mozPointerLockElement===c||p.webkitPointerLockElement===c||p.msPointerLockElement===c||p.pointerLockElement===c},document.addEventListener("pointerlockchange",u._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",u._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",u._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",u._onPointerLockChange,!1),!t.audioEngine&&s.audioEngine&&t.AudioEngineFactory&&(t.audioEngine=t.AudioEngineFactory(u.getRenderingCanvas(),u.getAudioContext(),u.getAudioDestination()))}u._connectVREvents(),u.enableOfflineSupport=void 0!==t.OfflineProviderFactory,u._deterministicLockstep=!!s.deterministicLockstep,u._lockstepMaxSteps=s.lockstepMaxSteps||0,u._timeStep=s.timeStep||1/60}return u._prepareVRComponent(),s.autoEnableWebVR&&u.initWebVR(),u}return(0,i.ZT)(t,e),Object.defineProperty(t,"NpmPackage",{get:function(){return c.B.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Version",{get:function(){return c.B.Version},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Instances",{get:function(){return a.l.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LastCreatedEngine",{get:function(){return a.l.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LastCreatedScene",{get:function(){return a.l.LastCreatedScene},enumerable:!1,configurable:!0}),t.prototype._createImageBitmapFromSource=function(e,t){var r=this;return new Promise((function(i,n){var s=new Image;s.onload=function(){s.decode().then((function(){r.createImageBitmap(s,t).then((function(e){i(e)}))}))},s.onerror=function(){n("Error loading image ".concat(s.src))},s.src=e}))},t.prototype.createImageBitmap=function(e,t){return createImageBitmap(e,t)},t.prototype.resizeImageBitmap=function(e,t,r){var i=this.createCanvas(t,r).getContext("2d");if(!i)throw new Error("Unable to get 2d context for resizeImageBitmap");return i.drawImage(e,0,0),i.getImageData(0,0,t,r).data},t.MarkAllMaterialsAsDirty=function(e,r){for(var i=0;i<t.Instances.length;i++)for(var n=t.Instances[i],s=0;s<n.scenes.length;s++)n.scenes[s].markAllMaterialsAsDirty(e,r)},t.DefaultLoadingScreenFactory=function(e){throw(0,u.S)("LoadingScreen")},Object.defineProperty(t.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!t._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"compatibilityMode",{get:function(){return this._compatibilityMode},set:function(e){this._compatibilityMode=!0},enumerable:!1,configurable:!0}),t.prototype.getInputElement=function(){return this._renderingCanvas},t.prototype._sharedInit=function(r,i,n){var s=this;if(e.prototype._sharedInit.call(this,r,i,n),this._onCanvasFocus=function(){s.onCanvasFocusObservable.notifyObservers(s)},this._onCanvasBlur=function(){s.onCanvasBlurObservable.notifyObservers(s)},r.addEventListener("focus",this._onCanvasFocus),r.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){s.disablePerformanceMonitorInBackground&&s._performanceMonitor.disable(),s._windowIsBackground=!0},this._onFocus=function(){s.disablePerformanceMonitorInBackground&&s._performanceMonitor.enable(),s._windowIsBackground=!1},this._onCanvasPointerOut=function(e){document.elementFromPoint(e.clientX,e.clientY)!==r&&s.onCanvasPointerOutObservable.notifyObservers(e)},(0,o.CG)()){var a=this.getHostWindow();a&&(a.addEventListener("blur",this._onBlur),a.addEventListener("focus",this._onFocus))}r.addEventListener("pointerout",this._onCanvasPointerOut),i||this._disableTouchAction(),!t.audioEngine&&n&&t.AudioEngineFactory&&(t.audioEngine=t.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination()))},t.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var r=e.viewport;return this.getRenderWidth(t)*r.width/(this.getRenderHeight(t)*r.height)},t.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},t.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},t.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},t.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},t.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},t.prototype.getTimeStep=function(){return 1e3*this._timeStep},t.prototype.generateMipMapsForCubemap=function(e,t){if(void 0===t&&(t=!0),e.generateMipMaps){var r=this._gl;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,e,!0),r.generateMipmap(r.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null)}},t.prototype.getDepthBuffer=function(){return this._depthCullingState.depthTest},t.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},t.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},t.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},t.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},t.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},t.prototype.getStencilMask=function(){return this._stencilState.stencilMask},t.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},t.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},t.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},t.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},t.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},t.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},t.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},t.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},t.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},t.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},t.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},t.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},t.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},t.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},t.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},t.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},t.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},t.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},t.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},t.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},t.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},t.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},t.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},t.prototype.setDirectViewport=function(e,t,r,i){var n=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,r,i),n},t.prototype.scissorClear=function(e,t,r,i,n){this.enableScissor(e,t,r,i),this.clear(n,!0,!0,!0),this.disableScissor()},t.prototype.enableScissor=function(e,t,r,i){var n=this._gl;n.enable(n.SCISSOR_TEST),n.scissor(e,t,r,i)},t.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},t.prototype._reportDrawCall=function(e){void 0===e&&(e=1),this._drawCalls.addCount(e,!1)},t.prototype.initWebVR=function(){throw(0,u.S)("WebVRCamera")},t.prototype._prepareVRComponent=function(){},t.prototype._connectVREvents=function(e,t){},t.prototype._submitVRFrame=function(){},t.prototype.disableVR=function(){},t.prototype.isVRPresenting=function(){return!1},t.prototype._requestVRFrame=function(){},t.prototype._loadFileAsync=function(e,t,r){var i=this;return new Promise((function(n,s){i._loadFile(e,(function(e){n(e)}),void 0,t,r,(function(e,t){s(t)}))}))},t.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},t.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},t.prototype.setDepthStencilTexture=function(e,t,r,i){void 0!==e&&(t&&(this._boundUniforms[e]=t),r&&r.depthStencilTexture?this._setTexture(e,r,!1,!0,i):this._setTexture(e,null,void 0,void 0,i))},t.prototype.setTextureFromPostProcess=function(e,t,r){var i,n=null;t&&(t._textures.data[t._currentRenderTextureInd]?n=t._textures.data[t._currentRenderTextureInd]:t._forcedOutputTexture&&(n=t._forcedOutputTexture)),this._bindTexture(e,null!==(i=null==n?void 0:n.texture)&&void 0!==i?i:null,r)},t.prototype.setTextureFromPostProcessOutput=function(e,t,r){var i,n;this._bindTexture(e,null!==(n=null===(i=null==t?void 0:t._outputTexture)||void 0===i?void 0:i.texture)&&void 0!==n?n:null,r)},t.prototype._rebuildBuffers=function(){for(var t=0,r=this.scenes;t<r.length;t++){(s=r[t]).resetCachedMaterial(),s._rebuildGeometries(),s._rebuildTextures()}for(var i=0,n=this._virtualScenes;i<n.length;i++){var s;(s=n[i]).resetCachedMaterial(),s._rebuildGeometries(),s._rebuildTextures()}e.prototype._rebuildBuffers.call(this)},t.prototype._renderFrame=function(){for(var e=0;e<this._activeRenderLoops.length;e++){(0,this._activeRenderLoops[e])()}},t.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},t.prototype._renderViews=function(){return!1},t.prototype.switchFullscreen=function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)},t.prototype.enterFullscreen=function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&t._RequestFullscreen(this._renderingCanvas))},t.prototype.exitFullscreen=function(){this.isFullscreen&&t._ExitFullscreen()},t.prototype.enterPointerlock=function(){this._renderingCanvas&&t._RequestPointerlock(this._renderingCanvas)},t.prototype.exitPointerlock=function(){t._ExitPointerlock()},t.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),e.prototype.beginFrame.call(this)},t.prototype.endFrame=function(){e.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},t.prototype.resize=function(t){void 0===t&&(t=!1),this.isVRPresenting()||e.prototype.resize.call(this,t)},t.prototype.setSize=function(t,r,i){if(void 0===i&&(i=!1),!this._renderingCanvas)return!1;if(!e.prototype.setSize.call(this,t,r,i))return!1;if(this.scenes){for(var n=0;n<this.scenes.length;n++)for(var s=this.scenes[n],o=0;o<s.cameras.length;o++){s.cameras[o]._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},t.prototype._deletePipelineContext=function(t){var r=t;r&&r.program&&r.transformFeedback&&(this.deleteTransformFeedback(r.transformFeedback),r.transformFeedback=null),e.prototype._deletePipelineContext.call(this,t)},t.prototype.createShaderProgram=function(t,r,i,n,s,o){void 0===o&&(o=null),s=s||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var a=e.prototype.createShaderProgram.call(this,t,r,i,n,s,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),a},t.prototype._createShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null);var s=i.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");if(i.attachShader(s,t),i.attachShader(s,r),this.webGLVersion>1&&n){var o=this.createTransformFeedback();this.bindTransformFeedback(o),this.setTranformFeedbackVaryings(s,n),e.transformFeedback=o}return i.linkProgram(s),this.webGLVersion>1&&n&&this.bindTransformFeedback(null),e.context=i,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),s},t.prototype._releaseTexture=function(t){e.prototype._releaseTexture.call(this,t)},t.prototype._releaseRenderTargetWrapper=function(t){e.prototype._releaseRenderTargetWrapper.call(this,t),this.scenes.forEach((function(e){e.postProcesses.forEach((function(e){e._outputTexture===t&&(e._outputTexture=null)})),e.cameras.forEach((function(e){e._postProcesses.forEach((function(e){e&&e._outputTexture===t&&(e._outputTexture=null)}))}))}))},t.prototype.getRenderPassNames=function(){return this._renderPassNames},t.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},t.prototype.createRenderPassId=function(e){var r=++t._RenderPassIdCounter;return this._renderPassNames[r]=null!=e?e:"NONAME",r},t.prototype.releaseRenderPassId=function(e){this._renderPassNames[e]=void 0;for(var t=0;t<this.scenes.length;++t)for(var r=this.scenes[t],i=0;i<r.meshes.length;++i){var n=r.meshes[i];if(n.subMeshes)for(var s=0;s<n.subMeshes.length;++s){n.subMeshes[s]._removeDrawWrapper(e)}}},t.prototype._rescaleTexture=function(e,r,i,n,s){var o=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var a=this.createRenderTargetTexture({width:r.width,height:r.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&t._RescalePostProcessFactory&&(this._rescalePostProcess=t._RescalePostProcessFactory(this)),this._rescalePostProcess.externalTextureSamplerBinding=!0,this._rescalePostProcess.getEffect().executeWhenCompiled((function(){o._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)};var t=i;t||(t=o.scenes[o.scenes.length-1]),t.postProcessManager.directRender([o._rescalePostProcess],a,!0),o._bindTextureDirectly(o._gl.TEXTURE_2D,r,!0),o._gl.copyTexImage2D(o._gl.TEXTURE_2D,0,n,0,0,r.width,r.height,0),o.unBindFramebuffer(a),a.dispose(),s&&s()}))},t.prototype.getFps=function(){return this._fps},t.prototype.getDeltaTime=function(){return this._deltaTime},t.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},t.prototype.wrapWebGLTexture=function(e){var t=new _.B(e,this._gl),r=new s.l(this,s.S.Unknown,!0);return r._hardwareTexture=t,r.isReady=!0,r},t.prototype._uploadImageToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,s=this._getWebGLTextureType(e.type),o=this._getInternalFormat(e.format),a=this._getRGBABufferInternalSizedFormat(e.type,o),u=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(u,e,!0),this._unpackFlipY(e.invertY);var c=n.TEXTURE_2D;e.isCube&&(c=n.TEXTURE_CUBE_MAP_POSITIVE_X+r),n.texImage2D(c,i,a,o,s,t),this._bindTextureDirectly(u,null,!0)},t.prototype.updateTextureComparisonFunction=function(e,t){if(1!==this.webGLVersion){var r=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,515),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,t),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,515),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}else d.Y.Error("WebGL 1 does not support texture comparison.")},t.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");var r=new p.M(t);return r.capacity=e,this.bindArrayBuffer(r),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),r.references=1,r},t.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},t.prototype._clientWaitAsync=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=10);var i=this._gl;return new Promise((function(n,s){var o=function(){var a=i.clientWaitSync(e,t,0);a!=i.WAIT_FAILED?a!=i.TIMEOUT_EXPIRED?n():setTimeout(o,r):s()};o()}))},t.prototype._readPixelsAsync=function(e,t,r,i,n,s,o){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var a=this._gl,u=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,u),a.bufferData(a.PIXEL_PACK_BUFFER,o.byteLength,a.STREAM_READ),a.readPixels(e,t,r,i,n,s,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);var c=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);return c?(a.flush(),this._clientWaitAsync(c,0,10).then((function(){return a.deleteSync(c),a.bindBuffer(a.PIXEL_PACK_BUFFER,u),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,o),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteBuffer(u),o}))):null},t.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();1===t.Instances.length&&t.audioEngine&&(t.audioEngine.dispose(),t.audioEngine=null),this.disableVR(),(0,o.CG)()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),(0,o.n5)()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),e.prototype.dispose.call(this);var r=t.Instances.indexOf(this);r>=0&&t.Instances.splice(r,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},t.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none",this._renderingCanvas.style.webkitTapHighlightColor="transparent")},t.prototype.displayLoadingUI=function(){if((0,o.CG)()){var e=this.loadingScreen;e&&e.displayLoadingUI()}},t.prototype.hideLoadingUI=function(){if((0,o.CG)()){var e=this._loadingScreen;e&&e.hideLoadingUI()}},Object.defineProperty(t.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=t.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!1,configurable:!0}),t.prototype.createVideoElement=function(e){return document.createElement("video")},t._RequestPointerlock=function(e){e.requestPointerLock=e.requestPointerLock||e.msRequestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock&&(e.requestPointerLock(),e.focus())},t._ExitPointerlock=function(){var e=document;document.exitPointerLock=document.exitPointerLock||e.msExitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},t._RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},t._ExitFullscreen=function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()},t.prototype.getFontOffset=function(e){var t=document.createElement("span");t.innerHTML="Hg",t.setAttribute("style","font: ".concat(e," !important"));var r=document.createElement("div");r.style.display="inline-block",r.style.width="1px",r.style.height="0px",r.style.verticalAlign="bottom";var i=document.createElement("div");i.style.whiteSpace="nowrap",i.appendChild(t),i.appendChild(r),document.body.appendChild(i);var n=0,s=0;try{s=r.getBoundingClientRect().top-t.getBoundingClientRect().top,r.style.verticalAlign="baseline",n=r.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(i)}return{ascent:n,height:s,descent:s-n}},t.ALPHA_DISABLE=0,t.ALPHA_ADD=1,t.ALPHA_COMBINE=2,t.ALPHA_SUBTRACT=3,t.ALPHA_MULTIPLY=4,t.ALPHA_MAXIMIZED=5,t.ALPHA_ONEONE=6,t.ALPHA_PREMULTIPLIED=7,t.ALPHA_PREMULTIPLIED_PORTERDUFF=8,t.ALPHA_INTERPOLATE=9,t.ALPHA_SCREENMODE=10,t.DELAYLOADSTATE_NONE=0,t.DELAYLOADSTATE_LOADED=1,t.DELAYLOADSTATE_LOADING=2,t.DELAYLOADSTATE_NOTLOADED=4,t.NEVER=512,t.ALWAYS=519,t.LESS=513,t.EQUAL=514,t.LEQUAL=515,t.GREATER=516,t.GEQUAL=518,t.NOTEQUAL=517,t.KEEP=7680,t.REPLACE=7681,t.INCR=7682,t.DECR=7683,t.INVERT=5386,t.INCR_WRAP=34055,t.DECR_WRAP=34056,t.TEXTURE_CLAMP_ADDRESSMODE=0,t.TEXTURE_WRAP_ADDRESSMODE=1,t.TEXTURE_MIRROR_ADDRESSMODE=2,t.TEXTUREFORMAT_ALPHA=0,t.TEXTUREFORMAT_LUMINANCE=1,t.TEXTUREFORMAT_LUMINANCE_ALPHA=2,t.TEXTUREFORMAT_RGB=4,t.TEXTUREFORMAT_RGBA=5,t.TEXTUREFORMAT_RED=6,t.TEXTUREFORMAT_R=6,t.TEXTUREFORMAT_RG=7,t.TEXTUREFORMAT_RED_INTEGER=8,t.TEXTUREFORMAT_R_INTEGER=8,t.TEXTUREFORMAT_RG_INTEGER=9,t.TEXTUREFORMAT_RGB_INTEGER=10,t.TEXTUREFORMAT_RGBA_INTEGER=11,t.TEXTURETYPE_UNSIGNED_BYTE=0,t.TEXTURETYPE_UNSIGNED_INT=0,t.TEXTURETYPE_FLOAT=1,t.TEXTURETYPE_HALF_FLOAT=2,t.TEXTURETYPE_BYTE=3,t.TEXTURETYPE_SHORT=4,t.TEXTURETYPE_UNSIGNED_SHORT=5,t.TEXTURETYPE_INT=6,t.TEXTURETYPE_UNSIGNED_INTEGER=7,t.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,t.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,t.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,t.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,t.TEXTURETYPE_UNSIGNED_INT_24_8=12,t.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,t.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,t.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,t.TEXTURE_NEAREST_SAMPLINGMODE=1,t.TEXTURE_BILINEAR_SAMPLINGMODE=2,t.TEXTURE_TRILINEAR_SAMPLINGMODE=3,t.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,t.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,t.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,t.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,t.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,t.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,t.TEXTURE_NEAREST_LINEAR=7,t.TEXTURE_NEAREST_NEAREST=1,t.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,t.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,t.TEXTURE_LINEAR_LINEAR=2,t.TEXTURE_LINEAR_NEAREST=12,t.TEXTURE_EXPLICIT_MODE=0,t.TEXTURE_SPHERICAL_MODE=1,t.TEXTURE_PLANAR_MODE=2,t.TEXTURE_CUBIC_MODE=3,t.TEXTURE_PROJECTION_MODE=4,t.TEXTURE_SKYBOX_MODE=5,t.TEXTURE_INVCUBIC_MODE=6,t.TEXTURE_EQUIRECTANGULAR_MODE=7,t.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,t.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,t.SCALEMODE_FLOOR=1,t.SCALEMODE_NEAREST=2,t.SCALEMODE_CEILING=3,t._RescalePostProcessFactory=null,t._RenderPassIdCounter=0,t}(c.B))},15210:(e,t,r)=>{r.d(t,{l:()=>i});var i=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),e.Instances=new Array,e._LastCreatedScene=null,e.UseFallbackTexture=!0,e.FallbackTexture="",e}()},94360:(e,t,r)=>{r.d(t,{LN:()=>v.LN,OB:()=>S.OB,fu:()=>S.fu,zi:()=>S.zi,db:()=>S.db,Rs:()=>S.Rs,FB:()=>S.FB,nw:()=>S.nw,Ie:()=>S.Ie,wb:()=>S.wb,mj:()=>S.mj,t2:()=>f.t,HR:()=>S.HR,gT:()=>i.g,Wf:()=>S.Wf,wS:()=>S.wS,D4:()=>s.D,ud:()=>Y,lL:()=>o.l,Rc:()=>d,lx:()=>S.lx,eS:()=>S.eS,X9:()=>S.X9,zX:()=>S.zX,iD:()=>S.iD,V:()=>S.V,Ws:()=>S.Ws,gc:()=>S.gc,et:()=>m.e,I6:()=>v.I6,Sj:()=>a.S,r8:()=>a.r,Z2:()=>H.Z,cM:()=>S.cM,ju:()=>S.ju,YV:()=>S.YV,xL:()=>S.xL,Oz:()=>v.Oz,au:()=>S.au,r0:()=>F.r,dV:()=>S.dV,Zq:()=>W.Z,$X:()=>S.$X,vG:()=>z.v,xS:()=>S.xS,Gt:()=>S.Gt,EG:()=>S.EG,H7:()=>S.H7,kd:()=>S.kd,EV:()=>S.EV,oD:()=>S.oD,v2:()=>S.v2,p_:()=>S.p_,B6:()=>n.B,ld:()=>T,gB:()=>S.gB,CE:()=>X.C,Bm:()=>L.B,yM:()=>w.y,C4:()=>G.C,OD:()=>M.O,Hv:()=>O.H,W5:()=>N.W,gk:()=>V.g,fW:()=>y.f,Sk:()=>k.S,if:()=>h,QT:()=>p,A8:()=>_.A});var i=r(34941),n=(r(62457),r(61159)),s=r(37290),o=r(15210),a=r(79488);r(21352);n.B.prototype._debugPushGroup=function(e,t){},n.B.prototype._debugPopGroup=function(e){},n.B.prototype._debugInsertMarker=function(e,t){},n.B.prototype._debugFlushPendingCommands=function(){};var u=r(71419),c=r(98467),l=r(82577),h=function(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=u.x.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=u.x.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE,this.forceRenderingWhenOccluded=!1};s.D.prototype.createQuery=function(){return this._gl.createQuery()},s.D.prototype.deleteQuery=function(e){return this._gl.deleteQuery(e),this},s.D.prototype.isQueryResultAvailable=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE)},s.D.prototype.getQueryResult=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT)},s.D.prototype.beginOcclusionQuery=function(e,t){var r=this._getGlAlgorithmType(e);return this._gl.beginQuery(r,t),!0},s.D.prototype.endOcclusionQuery=function(e){var t=this._getGlAlgorithmType(e);return this._gl.endQuery(t),this},s.D.prototype._createTimeQuery=function(){var e=this.getCaps().timerQuery;return e.createQueryEXT?e.createQueryEXT():this.createQuery()},s.D.prototype._deleteTimeQuery=function(e){var t=this.getCaps().timerQuery;t.deleteQueryEXT?t.deleteQueryEXT(e):this.deleteQuery(e)},s.D.prototype._getTimeQueryResult=function(e){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT):this.getQueryResult(e)},s.D.prototype._getTimeQueryAvailability=function(e){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(e)},s.D.prototype.startTimeQuery=function(){var e=this.getCaps(),t=e.timerQuery;if(!t)return null;var r=new c.W;if(this._gl.getParameter(t.GPU_DISJOINT_EXT),e.canUseTimestampForTimerQuery)r._startTimeQuery=this._createTimeQuery(),t.queryCounterEXT(r._startTimeQuery,t.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;r._timeElapsedQuery=this._createTimeQuery(),t.beginQueryEXT?t.beginQueryEXT(t.TIME_ELAPSED_EXT,r._timeElapsedQuery):this._gl.beginQuery(t.TIME_ELAPSED_EXT,r._timeElapsedQuery),this._currentNonTimestampToken=r}return r},s.D.prototype.endTimeQuery=function(e){var t=this.getCaps(),r=t.timerQuery;if(!r||!e)return-1;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery)return-1;e._endTimeQuery||(e._endTimeQuery=this._createTimeQuery(),r.queryCounterEXT(e._endTimeQuery,r.TIMESTAMP_EXT))}else if(!e._timeElapsedQueryEnded){if(!e._timeElapsedQuery)return-1;r.endQueryEXT?r.endQueryEXT(r.TIME_ELAPSED_EXT):this._gl.endQuery(r.TIME_ELAPSED_EXT),e._timeElapsedQueryEnded=!0}var i=this._gl.getParameter(r.GPU_DISJOINT_EXT),n=!1;if(e._endTimeQuery?n=this._getTimeQueryAvailability(e._endTimeQuery):e._timeElapsedQuery&&(n=this._getTimeQueryAvailability(e._timeElapsedQuery)),n&&!i){var s=0;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery||!e._endTimeQuery)return-1;var o=this._getTimeQueryResult(e._startTimeQuery);s=this._getTimeQueryResult(e._endTimeQuery)-o,this._deleteTimeQuery(e._startTimeQuery),this._deleteTimeQuery(e._endTimeQuery),e._startTimeQuery=null,e._endTimeQuery=null}else{if(!e._timeElapsedQuery)return-1;s=this._getTimeQueryResult(e._timeElapsedQuery),this._deleteTimeQuery(e._timeElapsedQuery),e._timeElapsedQuery=null,e._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return s}return-1},s.D.prototype._captureGPUFrameTime=!1,s.D.prototype._gpuFrameTime=new l.z,s.D.prototype.getGPUFrameTimeCounter=function(){return this._gpuFrameTime},s.D.prototype.captureGPUFrameTime=function(e){var t=this;e!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=e,e?(this._onBeginFrameObserver=this.onBeginFrameObservable.add((function(){t._gpuFrameTimeToken||(t._gpuFrameTimeToken=t.startTimeQuery())})),this._onEndFrameObserver=this.onEndFrameObservable.add((function(){if(t._gpuFrameTimeToken){var e=t.endTimeQuery(t._gpuFrameTimeToken);e>-1&&(t._gpuFrameTimeToken=null,t._gpuFrameTime.fetchNewFrame(),t._gpuFrameTime.addCount(e,!0))}}))):(this.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},s.D.prototype._getGlAlgorithmType=function(e){return e===u.x.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Object.defineProperty(u.x.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},set:function(e){this._occlusionDataStorage.isOcclusionQueryInProgress=e},enumerable:!1,configurable:!0}),Object.defineProperty(u.x.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new h),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(u.x.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(e){this._occlusionDataStorage.isOccluded=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.x.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(e){this._occlusionDataStorage.occlusionQueryAlgorithmType=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.x.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(e){this._occlusionDataStorage.occlusionType=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.x.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(e){this._occlusionDataStorage.occlusionRetryCount=e},enumerable:!0,configurable:!0}),Object.defineProperty(u.x.prototype,"forceRenderingWhenOccluded",{get:function(){return this._occlusionDataStorage.forceRenderingWhenOccluded},set:function(e){this._occlusionDataStorage.forceRenderingWhenOccluded=e},enumerable:!0,configurable:!0}),u.x.prototype._checkOcclusionQuery=function(){var e=this._occlusionDataStorage;if(e.occlusionType===u.x.OCCLUSION_TYPE_NONE)return e.isOccluded=!1,!1;var t=this.getEngine();if(!t.getCaps().supportOcclusionQuery)return e.isOccluded=!1,!1;if(!t.isQueryResultAvailable)return e.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(t.isQueryResultAvailable(this._occlusionQuery)){var r=t.getQueryResult(this._occlusionQuery);e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=!(r>0)}else{if(e.occlusionInternalRetryCounter++,!(-1!==e.occlusionRetryCount&&e.occlusionInternalRetryCounter>e.occlusionRetryCount))return e.occlusionType!==u.x.OCCLUSION_TYPE_OPTIMISTIC&&e.isOccluded;e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=e.occlusionType!==u.x.OCCLUSION_TYPE_OPTIMISTIC&&e.isOccluded}var i=this.getScene();if(i.getBoundingBoxRenderer){var n=i.getBoundingBoxRenderer();null===this._occlusionQuery&&(this._occlusionQuery=t.createQuery()),t.beginOcclusionQuery(e.occlusionQueryAlgorithmType,this._occlusionQuery)&&(n.renderOcclusionBoundingBox(this),t.endOcclusionQuery(e.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0)}return e.isOccluded};var p=!0;s.D.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},s.D.prototype.deleteTransformFeedback=function(e){this._gl.deleteTransformFeedback(e)},s.D.prototype.bindTransformFeedback=function(e){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,e)},s.D.prototype.beginTransformFeedback=function(e){void 0===e&&(e=!0),this._gl.beginTransformFeedback(e?this._gl.POINTS:this._gl.TRIANGLES)},s.D.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},s.D.prototype.setTranformFeedbackVaryings=function(e,t){this._gl.transformFeedbackVaryings(e,t,this._gl.INTERLEAVED_ATTRIBS)},s.D.prototype.bindTransformFeedbackBuffer=function(e){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e?e.underlyingResource:null)};r(74649),r(51392),r(25008);n.B.prototype.createExternalTexture=function(e){return null},n.B.prototype.setExternalTexture=function(e,t){throw new Error("setExternalTexture: This engine does not support external textures!")};r(52858),r(17770),r(90052),r(13534),r(74500);n.B.prototype.setTextureSampler=function(e,t){throw new Error("setTextureSampler: This engine does not support separate texture sampler objects!")};r(99986),r(78459),r(89553);var d=function(){};Object.defineProperty(s.D.prototype,"inputElement",{get:function(){return this._inputElement},set:function(e){var t;this._inputElement!==e&&(this._inputElement=e,null===(t=this._onEngineViewChanged)||void 0===t||t.call(this))}}),s.D.prototype.getInputElement=function(){return this.inputElement||this.getRenderingCanvas()},s.D.prototype.registerView=function(e,t,r){var i=this;this.views||(this.views=[]);for(var n=0,s=this.views;n<s.length;n++){var o=s[n];if(o.target===e)return o}var a=this.getRenderingCanvas();a&&(e.width=a.width,e.height=a.height);var u={target:e,camera:t,clearBeforeCopy:r,enabled:!0};return this.views.push(u),t&&t.onDisposeObservable.add((function(){i.unRegisterView(e)})),u},s.D.prototype.unRegisterView=function(e){if(!this.views)return this;for(var t=0,r=this.views;t<r.length;t++){var i=r[t];if(i.target===e){var n=this.views.indexOf(i);-1!==n&&this.views.splice(n,1);break}}return this},s.D.prototype._renderViews=function(){if(!this.views)return!1;var e=this.getRenderingCanvas();if(!e)return!1;for(var t=0,r=this.views;t<r.length;t++){var i=r[t];if(i.enabled){var n=i.target,s=n.getContext("2d");if(s){var o=i.camera,a=null,u=null;if(o){if((u=o.getScene()).activeCameras&&u.activeCameras.length)continue;this.activeView=i,a=u.activeCamera,u.activeCamera=o}if(i.customResize)i.customResize(n);else{var c=Math.floor(n.clientWidth/this._hardwareScalingLevel),l=Math.floor(n.clientHeight/this._hardwareScalingLevel),h=c!==n.width||e.width!==n.width||l!==n.height||e.height!==n.height;n.clientWidth&&n.clientHeight&&h&&(n.width=c,n.height=l,this.setSize(c,l))}if(!e.width||!e.height)return!1;this._renderFrame(),this.flushFramebuffer(),i.clearBeforeCopy&&s.clearRect(0,0,e.width,e.height),s.drawImage(e,0,0),a&&u&&(u.activeCamera=a)}}}return this.activeView=null,!0};var _=r(5382),f=r(34435);function g(e){if(this._excludedCompressedTextures&&this._excludedCompressedTextures.some((function(t){var r="\\b"+t+"\\b";return e&&(e===t||e.match(new RegExp(r,"g")))})))return e;var t=e.lastIndexOf("."),r=e.lastIndexOf("?"),i=r>-1?e.substring(r,e.length):"";return(t>-1?e.substring(0,t):e)+this._textureFormatInUse+i}n.B.prototype.createStorageBuffer=function(e,t){throw new Error("createStorageBuffer: Unsupported method in this engine!")},n.B.prototype.updateStorageBuffer=function(e,t,r,i){},n.B.prototype.readFromStorageBuffer=function(e,t,r,i){throw new Error("readFromStorageBuffer: Unsupported method in this engine!")},n.B.prototype.setStorageBuffer=function(e,t){throw new Error("setStorageBuffer: Unsupported method in this engine!")},Object.defineProperty(s.D.prototype,"texturesSupported",{get:function(){var e=new Array;return this._caps.astc&&e.push("-astc.ktx"),this._caps.s3tc&&e.push("-dxt.ktx"),this._caps.pvrtc&&e.push("-pvrtc.ktx"),this._caps.etc2&&e.push("-etc2.ktx"),this._caps.etc1&&e.push("-etc1.ktx"),e},enumerable:!0,configurable:!0}),Object.defineProperty(s.D.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse||null},enumerable:!0,configurable:!0}),s.D.prototype.setCompressedTextureExclusions=function(e){this._excludedCompressedTextures=e},s.D.prototype.setTextureFormatToUse=function(e){for(var t=this.texturesSupported,r=0,i=t.length;r<i;r++)for(var n=0,s=e.length;n<s;n++)if(t[r]===e[n].toLowerCase())return this._transformTextureUrl=g.bind(this),this._textureFormatInUse=t[r];return this._textureFormatInUse="",this._transformTextureUrl=null,null};var m=r(72759),E=r(31191),v=r(49576);v.I6._createNativeDataStream=function(){return _native.NativeDataStream.VALIDATION_ENABLED?new T:new m.e};var T=function(e){function t(){return e.call(this)||this}return(0,E.ZT)(t,e),t.prototype.writeUint32=function(t){e.prototype.writeUint32.call(this,_native.NativeDataStream.VALIDATION_UINT_32),e.prototype.writeUint32.call(this,t)},t.prototype.writeInt32=function(t){e.prototype.writeUint32.call(this,_native.NativeDataStream.VALIDATION_INT_32),e.prototype.writeInt32.call(this,t)},t.prototype.writeFloat32=function(t){e.prototype.writeUint32.call(this,_native.NativeDataStream.VALIDATION_FLOAT_32),e.prototype.writeFloat32.call(this,t)},t.prototype.writeUint32Array=function(t){e.prototype.writeUint32.call(this,_native.NativeDataStream.VALIDATION_UINT_32_ARRAY),e.prototype.writeUint32Array.call(this,t)},t.prototype.writeInt32Array=function(t){e.prototype.writeUint32.call(this,_native.NativeDataStream.VALIDATION_INT_32_ARRAY),e.prototype.writeInt32Array.call(this,t)},t.prototype.writeFloat32Array=function(t){e.prototype.writeUint32.call(this,_native.NativeDataStream.VALIDATION_FLOAT_32_ARRAY),e.prototype.writeFloat32Array.call(this,t)},t.prototype.writeNativeData=function(t){e.prototype.writeUint32.call(this,_native.NativeDataStream.VALIDATION_NATIVE_DATA),e.prototype.writeNativeData.call(this,t)},t.prototype.writeBoolean=function(t){e.prototype.writeUint32.call(this,_native.NativeDataStream.VALIDATION_BOOLEAN),e.prototype.writeBoolean.call(this,t)},t}(m.e),y=r(60100);y.f.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e||!(0===e&&!this._alphaState.alphaBlend||0!==e&&this._alphaState.alphaBlend)){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(1,771,1,1),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(1,771,1,771),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(770,771,1,1),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(1,1,0,1),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(770,1,0,1),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(0,769,1,1),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(774,0,1,1),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(770,769,1,1),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(32769,32770,32771,32772),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(1,769,1,771),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(1,1,1,1),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(772,1,0,0),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(775,769,773,771),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(1,1,1,0),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(775,769,0,1),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(770,771,1,771),this._alphaState.alphaBlend=!0}t||(this.setDepthWrite(e===s.D.ALPHA_DISABLE),this._cacheRenderPipeline.setDepthWriteEnabled(e===s.D.ALPHA_DISABLE)),this._alphaMode=e,this._cacheRenderPipeline.setAlphaBlendEnabled(this._alphaState.alphaBlend),this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters,this._alphaState._blendEquationParameters)}},y.f.prototype.setAlphaEquation=function(e){s.D.prototype.setAlphaEquation.call(this,e),this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters,this._alphaState._blendEquationParameters)};var b=r(27154),x=r(84318),S=r(8724),R=function(){function e(t,r){this._device=t,this._cacheSampler=r,this.uniqueId=e._Counter++,this._bindGroupEntries=[],this.clear()}return e.prototype.getBindGroups=function(e,t,r){if(!r)throw new Error("WebGPUComputeContext.getBindGroups: bindingsMapping is required until browsers support reflection for wgsl shaders!");if(0===this._bindGroups.length){var i=this._bindGroupEntries.length>0;for(var n in e){var s=e[n],o=r[n],a=o.group,u=o.binding,c=s.type,l=s.object,h=s.indexInGroupEntries;switch((v=this._bindGroupEntries[a])||(v=this._bindGroupEntries[a]=[]),c){case f.t.Sampler:var p=l;void 0!==h&&i?v[h].resource=this._cacheSampler.getSampler(p):(s.indexInGroupEntries=v.length,v.push({binding:u,resource:this._cacheSampler.getSampler(p)}));break;case f.t.Texture:case f.t.TextureWithoutSampler:var d=(_=l)._texture._hardwareTexture;void 0!==h&&i?(c===f.t.Texture&&(v[h++].resource=this._cacheSampler.getSampler(_._texture)),v[h].resource=d.view):(s.indexInGroupEntries=v.length,c===f.t.Texture&&v.push({binding:u-1,resource:this._cacheSampler.getSampler(_._texture)}),v.push({binding:u,resource:d.view}));break;case f.t.StorageTexture:var _;0==((d=(_=l)._texture._hardwareTexture).textureAdditionalUsages&S.v2.StorageBinding)&&x.Y.Error("computeDispatch: The texture (name=".concat(_.name,", uniqueId=").concat(_.uniqueId,") is not a storage texture!"),50),void 0!==h&&i?v[h].resource=d.viewForWriting:(s.indexInGroupEntries=v.length,v.push({binding:u,resource:d.viewForWriting}));break;case f.t.UniformBuffer:case f.t.StorageBuffer:var g=(f.t.UniformBuffer,l).getBuffer(),m=g.underlyingResource;void 0!==h&&i?(v[h].resource.buffer=m,v[h].resource.size=g.capacity):(s.indexInGroupEntries=v.length,v.push({binding:u,resource:{buffer:m,offset:0,size:g.capacity}}))}}for(var E=0;E<this._bindGroupEntries.length;++E){var v;(v=this._bindGroupEntries[E])?this._bindGroups[E]=this._device.createBindGroup({layout:t.getBindGroupLayout(E),entries:v}):this._bindGroups[E]=void 0}this._bindGroups.length=this._bindGroupEntries.length}return this._bindGroups},e.prototype.clear=function(){this._bindGroups=[]},e._Counter=0,e}(),A=function(){function e(e){this._name="unnamed",this.engine=e}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.stage},enumerable:!1,configurable:!0}),e.prototype._getComputeShaderCode=function(){var e;return null===(e=this.sources)||void 0===e?void 0:e.compute},e.prototype.dispose=function(){},e}();y.f.prototype.createComputeContext=function(){return new R(this._device,this._cacheSampler)},y.f.prototype.createComputeEffect=function(e,t){var r=(e.computeElement||e.compute||e.computeToken||e.computeSource||e)+"@"+t.defines;if(this._compiledComputeEffects[r]){var i=this._compiledComputeEffects[r];return t.onCompiled&&i.isReady()&&t.onCompiled(i),i}var n=new b.n(e,t,this,r);return this._compiledComputeEffects[r]=n,n},y.f.prototype.createComputePipelineContext=function(){return new A(this)},y.f.prototype.areAllComputeEffectsReady=function(){for(var e in this._compiledComputeEffects){if(!this._compiledComputeEffects[e].isReady())return!1}return!0},y.f.prototype.computeDispatch=function(e,t,r,i,n,s,o){var a=this;if(this._currentRenderTarget)this._onAfterUnbindFrameBufferObservable.addOnce((function(){a.computeDispatch(e,t,r,i,n,s,o)}));else{var u=e._pipelineContext,c=t;u.computePipeline||(u.computePipeline=this._device.createComputePipeline({layout:S.fu.Auto,compute:u.stage}));var l=this._renderTargetEncoder.beginComputePass();l.setPipeline(u.computePipeline);for(var h=c.getBindGroups(r,u.computePipeline,o),p=0;p<h.length;++p){var d=h[p];d&&l.setBindGroup(p,d)}l.dispatchWorkgroups(i,n,s),l.end()}},y.f.prototype.releaseComputeEffects=function(){for(var e in this._compiledComputeEffects){var t=this._compiledComputeEffects[e].getPipelineContext();this._deleteComputePipelineContext(t)}this._compiledComputeEffects={}},y.f.prototype._prepareComputePipelineContext=function(e,t,r,i,n){var s=e;this.dbgShowShaderCode,s.sources={compute:t,rawCompute:r},s.stage=this._createComputePipelineStageDescriptor(t,i,n)},y.f.prototype._releaseComputeEffect=function(e){this._compiledComputeEffects[e._key]&&(delete this._compiledComputeEffects[e._key],this._deleteComputePipelineContext(e.getPipelineContext()))},y.f.prototype._rebuildComputeEffects=function(){for(var e in this._compiledComputeEffects){var t=this._compiledComputeEffects[e];t._pipelineContext=null,t._wasPreviouslyReady=!1,t._prepareEffect()}},y.f.prototype._deleteComputePipelineContext=function(e){e&&e.dispose()},y.f.prototype._createComputePipelineStageDescriptor=function(e,t,r){return t=t?"//"+t.split("\n").join("\n//")+"\n":"",{module:this._device.createShaderModule({code:t+e}),entryPoint:r}};var C=r(7949);y.f.prototype._createDepthStencilCubeTexture=function(e,t){var r=new C.l(this,C.S.DepthStencil);r.isCube=!0;var i=(0,E.pi)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,samples:1},t);return r.format=i.generateStencil?13:14,this._setupDepthStencilTexture(r,e,i.generateStencil,i.bilinearFiltering,i.comparisonFunction,i.samples),this._textureHelper.createGPUTextureForInternalTexture(r),this._internalTexturesCache.push(r),r},y.f.prototype.createCubeTexture=function(e,t,r,i,n,s,o,a,u,c,l,h,p){var d=this;return void 0===n&&(n=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===u&&(u=!1),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=null),void 0===p&&(p=!1),this.createCubeTextureBase(e,t,r,!!i,n,s,o,a,u,c,l,h,null,(function(e,t){var r=t,s=r[0].width,a=s;d._setCubeMapTextureParams(e,!i),e.format=null!=o?o:-1;var u=d._textureHelper.createGPUTextureForInternalTexture(e,s,a);d._textureHelper.updateCubeTextures(r,u.underlyingResource,s,a,u.format,!1,!1,0,0),i||d._generateMipmaps(e,d._uploadEncoder),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),n&&n()}),!!p)},y.f.prototype._setCubeMapTextureParams=function(e,t,r){e.samplingMode=t?3:2,e._cachedWrapU=0,e._cachedWrapV=0,r&&(e._maxLodLevel=r)},y.f.prototype._debugPushGroup=function(e,t){this._options.enableGPUDebugMarkers&&(0===t||1===t?(0===t?this._renderEncoder:this._renderTargetEncoder).pushDebugGroup(e):this._currentRenderPass?this._currentRenderPass.pushDebugGroup(e):this._pendingDebugCommands.push(["push",e]))},y.f.prototype._debugPopGroup=function(e){this._options.enableGPUDebugMarkers&&(0===e||1===e?(0===e?this._renderEncoder:this._renderTargetEncoder).popDebugGroup():this._currentRenderPass?this._currentRenderPass.popDebugGroup():this._pendingDebugCommands.push(["pop",null]))},y.f.prototype._debugInsertMarker=function(e,t){this._options.enableGPUDebugMarkers&&(0===t||1===t?(0===t?this._renderEncoder:this._renderTargetEncoder).insertDebugMarker(e):this._currentRenderPass?this._currentRenderPass.insertDebugMarker(e):this._pendingDebugCommands.push(["insert",e]))},y.f.prototype._debugFlushPendingCommands=function(){for(var e=0;e<this._pendingDebugCommands.length;++e){var t=this._pendingDebugCommands[e],r=t[0],i=t[1];switch(r){case"push":this._debugPushGroup(i);break;case"pop":this._debugPopGroup();break;case"insert":this._debugInsertMarker(i)}}this._pendingDebugCommands.length=0},y.f.prototype.updateDynamicIndexBuffer=function(e,t,r){void 0===r&&(r=0);var i,n=e;i=e.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._bufferManager.setSubData(n,r,i)},y.f.prototype.updateDynamicVertexBuffer=function(e,t,r,i){var n,s=e;void 0===r&&(r=0),void 0===i?i=(n=t instanceof Array?new Float32Array(t):t instanceof ArrayBuffer?new Uint8Array(t):t).byteLength:n=t instanceof Array?new Float32Array(t):t instanceof ArrayBuffer?new Uint8Array(t):t,this._bufferManager.setSubData(s,r,n,0,i)},y.f.prototype.updateDynamicTexture=function(e,t,r,i,n,s,o){var a;if(void 0===i&&(i=!1),e){var u=t.width,c=t.height,l=e._hardwareTexture;(null===(a=e._hardwareTexture)||void 0===a?void 0:a.underlyingResource)||(l=this._textureHelper.createGPUTextureForInternalTexture(e,u,c)),this._textureHelper.updateTexture(t,e,u,c,e.depth,l.format,0,0,r,i,0,0,o),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder),e.isReady=!0}};var B=function(e){function t(t){return e.call(this,t)||this}return(0,E.ZT)(t,e),t}(r(44919).x),P=r(9256);P.Q.prototype.setExternalTexture=function(e,t){this._engine.setExternalTexture(e,t)},y.f.prototype.createExternalTexture=function(e){return new B(e)},y.f.prototype.setExternalTexture=function(e,t){t?this._setInternalTexture(e,t):this._currentMaterialContext.setTexture(e,null)},y.f.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t,r){void 0===t&&(t=!1),r&&r();var i=e._attachments.length;this._currentRenderPass&&this._currentRenderPass!==this._mainRenderPassWrapper.renderPass&&this._endRenderTargetRenderPass();for(var n=0;n<i;n++){var s=e.textures[n];!s.generateMipMaps||t||s.isCube||this._generateMipmaps(s)}this._currentRenderTarget=null,this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments),this._currentRenderPass=this._mainRenderPassWrapper.renderPass,this._setDepthTextureFormat(this._mainRenderPassWrapper),this._setColorFormat(this._mainRenderPassWrapper)},y.f.prototype.createMultipleRenderTarget=function(e,t,r){var i,n=!1,s=!0,o=!1,a=!1,u=15,c=1,l=new Array,h=new Array,p=new Array,d=this._createHardwareRenderTargetWrapper(!0,!1,e);void 0!==t&&(n=void 0!==t.generateMipMaps&&t.generateMipMaps,s=void 0===t.generateDepthBuffer||t.generateDepthBuffer,o=void 0!==t.generateStencilBuffer&&t.generateStencilBuffer,a=void 0!==t.generateDepthTexture&&t.generateDepthTexture,c=t.textureCount||1,u=null!==(i=t.depthTextureFormat)&&void 0!==i?i:15,t.types&&(l=t.types),t.samplingModes&&(h=t.samplingModes),t.useSRGBBuffers&&(p=t.useSRGBBuffers));var _=e.width||e,f=e.height||e,g=null;(s||o||a)&&(g=d.createDepthStencilTexture(0,!1,o,1,u));var m=[],E=[],v=[];d._generateDepthBuffer=s,d._generateStencilBuffer=o,d._attachments=E,d._defaultAttachments=v;for(var T=0;T<c;T++){var y=h[T]||3,b=l[T]||0,S=p[T]||false;(1!==b||this._caps.textureFloatLinearFiltering)&&(2!==b||this._caps.textureHalfFloatLinearFiltering)||(y=1),1!==b||this._caps.textureFloat||(b=0,x.Y.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var R=new C.l(this,C.S.MultiRenderTarget);m.push(R),E.push(T+1),v.push(r?T+1:0===T?1:0),R.baseWidth=_,R.baseHeight=f,R.width=_,R.height=f,R.isReady=!0,R.samples=1,R.generateMipMaps=n,R.samplingMode=y,R.type=b,R._cachedWrapU=0,R._cachedWrapV=0,R._useSRGBBuffer=S,this._internalTexturesCache.push(R),this._textureHelper.createGPUTextureForInternalTexture(R)}return g&&(g.incrementReferences(),m.push(g),this._internalTexturesCache.push(g)),d.setTextures(m),d},y.f.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t){if(!e||!e.textures||e.textures[0].samples===t)return t;var r=e.textures.length;if(0===r)return 1;t=Math.min(t,this.getCaps().maxMSAASamples);for(var i=0;i<r;++i){var n=e.textures[i];this._textureHelper.createMSAATexture(n,t),n.samples=t}return e._depthStencilTexture&&e._depthStencilTexture!==e.textures[e.textures.length-1]&&(this._textureHelper.createMSAATexture(e._depthStencilTexture,t),e._depthStencilTexture.samples=t),t},y.f.prototype.bindAttachments=function(e){0!==e.length&&this._currentRenderTarget&&(this._mrtAttachments=e,this._currentRenderPass&&this._cacheRenderPipeline.setMRTAttachments(e))},y.f.prototype.buildTextureLayout=function(e){for(var t=[],r=0;r<e.length;r++)e[r]?t.push(r+1):t.push(0);return t},y.f.prototype.restoreSingleAttachment=function(){},y.f.prototype.restoreSingleAttachmentForRenderTarget=function(){};var I=r(81987);function D(e,t,r,i){var n,s=1;1===i?n=new Float32Array(t*r*4):2===i?(n=new Uint16Array(t*r*4),s=15360):n=7===i?new Uint32Array(t*r*4):new Uint8Array(t*r*4);for(var o=0;o<t;o++)for(var a=0;a<r;a++){var u=3*(a*t+o),c=4*(a*t+o);n[c+0]=e[u+0],n[c+1]=e[u+1],n[c+2]=e[u+2],n[c+3]=s}return n}y.f.prototype.getGPUFrameTimeCounter=function(){return this._timestampQuery.gpuFrameTimeCounter},y.f.prototype.captureGPUFrameTime=function(e){this._timestampQuery.enable=e&&!!this._caps.timerQuery},y.f.prototype.createQuery=function(){return this._occlusionQuery.createQuery()},y.f.prototype.deleteQuery=function(e){return this._occlusionQuery.deleteQuery(e),this},y.f.prototype.isQueryResultAvailable=function(e){return this._occlusionQuery.isQueryResultAvailable(e)},y.f.prototype.getQueryResult=function(e){return this._occlusionQuery.getQueryResult(e)},y.f.prototype.beginOcclusionQuery=function(e,t){var r;return this.compatibilityMode?!!this._occlusionQuery.canBeginQuery&&(null===(r=this._currentRenderPass)||void 0===r||r.beginOcclusionQuery(t),!0):((0===this._getCurrentRenderPassIndex()?this._bundleList:this._bundleListRenderTarget).addItem(new I.GB(t)),!0)},y.f.prototype.endOcclusionQuery=function(){var e;this.compatibilityMode?null===(e=this._currentRenderPass)||void 0===e||e.endOcclusionQuery():(0===this._getCurrentRenderPassIndex()?this._bundleList:this._bundleListRenderTarget).addItem(new I.fw);return this},y.f.prototype.createRawTexture=function(e,t,r,i,n,s,o,a,u,c,l){void 0===a&&(a=null),void 0===u&&(u=0),void 0===c&&(c=0),void 0===l&&(l=!1);var h=new C.l(this,C.S.Raw);return h.baseWidth=t,h.baseHeight=r,h.width=t,h.height=r,h.format=i,h.generateMipMaps=n,h.samplingMode=o,h.invertY=s,h._compression=a,h.type=u,h._useSRGBBuffer=l,this._doNotHandleContextLost||(h._bufferView=e),this._textureHelper.createGPUTextureForInternalTexture(h,t,r,void 0,c),this.updateRawTexture(h,e,i,s,a,u,l),this._internalTexturesCache.push(h),h},y.f.prototype.updateRawTexture=function(e,t,r,i,n,s,o){if(void 0===n&&(n=null),void 0===s&&(s=0),void 0===o&&(o=!1),e){if(this._doNotHandleContextLost||(e._bufferView=t,e.invertY=i,e._compression=n,e._useSRGBBuffer=o),t){var a=e._hardwareTexture;4===r&&(t=D(t,e.width,e.height,s));var u=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(u,e,e.width,e.height,e.depth,a.format,0,0,i,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder)}e.isReady=!0}},y.f.prototype.createRawCubeTexture=function(e,t,r,i,n,s,o,a){void 0===a&&(a=null);var u=new C.l(this,C.S.CubeRaw);return 1!==i||this._caps.textureFloatLinearFiltering?2!==i||this._caps.textureHalfFloatLinearFiltering?1!==i||this._caps.textureFloatRender?2!==i||this._caps.colorBufferFloat||(n=!1,x.Y.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(n=!1,x.Y.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(n=!1,o=1,x.Y.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(n=!1,o=1,x.Y.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")),u.isCube=!0,u.format=4===r?5:r,u.type=i,u.generateMipMaps=n,u.width=t,u.height=t,u.samplingMode=o,this._doNotHandleContextLost||(u._bufferViewArray=e),u._cachedWrapU=0,u._cachedWrapV=0,this._textureHelper.createGPUTextureForInternalTexture(u),e&&this.updateRawCubeTexture(u,e,r,i,s,a),u},y.f.prototype.updateRawCubeTexture=function(e,t,r,i,n,s){void 0===s&&(s=null),e._bufferViewArray=t,e.invertY=n,e._compression=s;for(var o=e._hardwareTexture,a=4===r,u=[],c=0;c<t.length;++c){var l=t[c];a&&(l=D(t[c],e.width,e.height,i)),u.push(new Uint8Array(l.buffer,l.byteOffset,l.byteLength))}this._textureHelper.updateCubeTextures(u,o.underlyingResource,e.width,e.height,o.format,n,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder),e.isReady=!0},y.f.prototype.createRawCubeTextureFromUrl=function(e,t,r,i,n,s,o,a,u,c,l,h){var p=this;void 0===u&&(u=null),void 0===c&&(c=null),void 0===l&&(l=3),void 0===h&&(h=!1);var d=this.createRawCubeTexture(null,r,i,n,!s,h,l,null);null==t||t._addPendingData(d),d.url=e,this._internalTexturesCache.push(d);return this._loadFile(e,(function(e){!function(e){var r=d.width,s=o(e);if(s){var c=[0,2,4,1,3,5];if(a)for(var l=4===i,_=a(s),f=d._hardwareTexture,g=[0,1,2,3,4,5],m=0;m<_.length;m++){for(var E=r>>m,v=[],T=0;T<6;T++){var y=_[m][g[T]];l&&(y=D(y,E,E,n)),v.push(new Uint8Array(y.buffer,y.byteOffset,y.byteLength))}p._textureHelper.updateCubeTextures(v,f.underlyingResource,E,E,f.format,h,!1,0,0)}else{for(v=[],T=0;T<6;T++)v.push(s[c[T]]);p.updateRawCubeTexture(d,v,i,n,h)}d.isReady=!0,null==t||t._removePendingData(d),u&&u()}}(e)}),void 0,null==t?void 0:t.offlineProvider,!0,(function(e,r){null==t||t._removePendingData(d),c&&e&&c(e.status+" "+e.statusText,r)})),d},y.f.prototype.createRawTexture3D=function(e,t,r,i,n,s,o,a,u,c,l){void 0===u&&(u=null),void 0===c&&(c=0),void 0===l&&(l=0);var h=C.S.Raw3D,p=new C.l(this,h);return p.baseWidth=t,p.baseHeight=r,p.baseDepth=i,p.width=t,p.height=r,p.depth=i,p.format=n,p.type=c,p.generateMipMaps=s,p.samplingMode=a,p.is3D=!0,this._doNotHandleContextLost||(p._bufferView=e),this._textureHelper.createGPUTextureForInternalTexture(p,t,r,void 0,l),this.updateRawTexture3D(p,e,n,o,u,c),this._internalTexturesCache.push(p),p},y.f.prototype.updateRawTexture3D=function(e,t,r,i,n,s){if(void 0===n&&(n=null),void 0===s&&(s=0),this._doNotHandleContextLost||(e._bufferView=t,e.format=r,e.invertY=i,e._compression=n),t){var o=e._hardwareTexture;4===r&&(t=D(t,e.width,e.height,s));var a=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(a,e,e.width,e.height,e.depth,o.format,0,0,i,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder)}e.isReady=!0},y.f.prototype.createRawTexture2DArray=function(e,t,r,i,n,s,o,a,u,c,l){void 0===u&&(u=null),void 0===c&&(c=0),void 0===l&&(l=0);var h=C.S.Raw2DArray,p=new C.l(this,h);return p.baseWidth=t,p.baseHeight=r,p.baseDepth=i,p.width=t,p.height=r,p.depth=i,p.format=n,p.type=c,p.generateMipMaps=s,p.samplingMode=a,p.is2DArray=!0,this._doNotHandleContextLost||(p._bufferView=e),this._textureHelper.createGPUTextureForInternalTexture(p,t,r,i,l),this.updateRawTexture2DArray(p,e,n,o,u,c),this._internalTexturesCache.push(p),p},y.f.prototype.updateRawTexture2DArray=function(e,t,r,i,n,s){if(void 0===n&&(n=null),void 0===s&&(s=0),this._doNotHandleContextLost||(e._bufferView=t,e.format=r,e.invertY=i,e._compression=n),t){var o=e._hardwareTexture;4===r&&(t=D(t,e.width,e.height,s));var a=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(a,e,e.width,e.height,e.depth,o.format,0,0,i,!1,0,0),e.generateMipMaps&&this._generateMipmaps(e,this._uploadEncoder)}e.isReady=!0},y.f.prototype._readTexturePixels=function(e,t,r,i,n,s,o,a,u,c){void 0===i&&(i=-1),void 0===n&&(n=0),void 0===s&&(s=null),void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===u&&(u=0),void 0===c&&(c=0);var l=e._hardwareTexture;return o&&this.flushFramebuffer(),this._textureHelper.readPixels(l.underlyingResource,u,c,t,r,l.format,i,n,s,a)},y.f.prototype._readTexturePixelsSync=function(){throw"_readTexturePixelsSync is unsupported in WebGPU!"};var F=r(73005),U=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,E.ZT)(t,e),t}(F.r);y.f.prototype._createHardwareRenderTargetWrapper=function(e,t,r){var i=new U(e,t,r,this);return this._renderTargetWrapperCache.push(i),i},y.f.prototype.createRenderTargetTexture=function(e,t){var r,i=this._createHardwareRenderTargetWrapper(!1,!1,e),n={};void 0!==t&&"object"==typeof t?(n.generateMipMaps=t.generateMipMaps,n.generateDepthBuffer=void 0===t.generateDepthBuffer||t.generateDepthBuffer,n.generateStencilBuffer=n.generateDepthBuffer&&t.generateStencilBuffer,n.samplingMode=void 0===t.samplingMode?3:t.samplingMode,n.creationFlags=null!==(r=t.creationFlags)&&void 0!==r?r:0,n.noColorTarget=!!t.noColorTarget):(n.generateMipMaps=t,n.generateDepthBuffer=!0,n.generateStencilBuffer=!1,n.samplingMode=3,n.creationFlags=0,n.noColorTarget=!1);var s=n.noColorTarget?null:this._createInternalTexture(e,t,!0,C.S.RenderTarget);return i._generateDepthBuffer=n.generateDepthBuffer,i._generateStencilBuffer=!!n.generateStencilBuffer,i.setTextures(s),(i._generateDepthBuffer||i._generateStencilBuffer)&&i.createDepthStencilTexture(0,void 0===n.samplingMode||2===n.samplingMode||2===n.samplingMode||3===n.samplingMode||3===n.samplingMode||5===n.samplingMode||6===n.samplingMode||7===n.samplingMode||11===n.samplingMode,i._generateStencilBuffer,i.samples),s&&(void 0!==t&&"object"==typeof t&&t.createMipMaps&&!n.generateMipMaps&&(s.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(s,void 0,void 0,void 0,n.creationFlags),void 0!==t&&"object"==typeof t&&t.createMipMaps&&!n.generateMipMaps&&(s.generateMipMaps=!1)),i},y.f.prototype._createDepthStencilTexture=function(e,t){var r=new C.l(this,C.S.DepthStencil),i=(0,E.pi)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,samples:1,depthTextureFormat:t.generateStencil?13:14},t);return r.format=i.depthTextureFormat,this._setupDepthStencilTexture(r,e,i.generateStencil,i.bilinearFiltering,i.comparisonFunction,i.samples),this._textureHelper.createGPUTextureForInternalTexture(r),this._internalTexturesCache.push(r),r},y.f.prototype._setupDepthStencilTexture=function(e,t,r,i,n,s){void 0===s&&(s=1);var o=t.width||t,a=t.height||t,u=t.layers||0;e.baseWidth=o,e.baseHeight=a,e.width=o,e.height=a,e.is2DArray=u>0,e.depth=u,e.isReady=!0,e.samples=s,e.generateMipMaps=!1,e.samplingMode=i?2:1,e.type=1,e._comparisonFunction=n,e._cachedWrapU=0,e._cachedWrapV=0},y.f.prototype.updateRenderTargetTextureSampleCount=function(e,t){return e&&e.texture&&e.samples!==t?(t=Math.min(t,this.getCaps().maxMSAASamples),this._textureHelper.createMSAATexture(e.texture,t),e._depthStencilTexture&&(this._textureHelper.createMSAATexture(e._depthStencilTexture,t),e._depthStencilTexture.samples=t),e.texture.samples=t,t):t},y.f.prototype.createRenderTargetCubeTexture=function(e,t){var r=this._createHardwareRenderTargetWrapper(!1,!0,e),i=(0,E.pi)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,samples:1},t);i.generateStencilBuffer=i.generateDepthBuffer&&i.generateStencilBuffer,r._generateDepthBuffer=i.generateDepthBuffer,r._generateStencilBuffer=i.generateStencilBuffer;var n=new C.l(this,C.S.RenderTarget);return n.width=e,n.height=e,n.depth=0,n.isReady=!0,n.isCube=!0,n.samples=i.samples,n.generateMipMaps=i.generateMipMaps,n.samplingMode=i.samplingMode,n.type=i.type,n.format=i.format,this._internalTexturesCache.push(n),r.setTextures(n),(r._generateDepthBuffer||r._generateStencilBuffer)&&r.createDepthStencilTexture(0,void 0===i.samplingMode||2===i.samplingMode||2===i.samplingMode||3===i.samplingMode||3===i.samplingMode||5===i.samplingMode||6===i.samplingMode||7===i.samplingMode||11===i.samplingMode,r._generateStencilBuffer,r.samples),t&&t.createMipMaps&&!i.generateMipMaps&&(n.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(n),t&&t.createMipMaps&&!i.generateMipMaps&&(n.generateMipMaps=!1),r},P.Q.prototype.setTextureSampler=function(e,t){this._engine.setTextureSampler(e,t)},y.f.prototype.setTextureSampler=function(e,t){var r;null===(r=this._currentMaterialContext)||void 0===r||r.setSampler(e,t)},P.Q.prototype.setStorageBuffer=function(e,t){this._engine.setStorageBuffer(e,t)},y.f.prototype.createStorageBuffer=function(e,t){return this._createBuffer(e,32|t)},y.f.prototype.updateStorageBuffer=function(e,t,r,i){var n,s=e;void 0===r&&(r=0),void 0===i?i=(n=t instanceof Array?new Float32Array(t):t instanceof ArrayBuffer?new Uint8Array(t):t).byteLength:n=t instanceof Array?new Float32Array(t):t instanceof ArrayBuffer?new Uint8Array(t):t,this._bufferManager.setSubData(s,r,n,0,i)},y.f.prototype.readFromStorageBuffer=function(e,t,r,i){var n=this;r=r||e.capacity;var s=this._bufferManager.createRawBuffer(r,S.FB.MapRead|S.FB.CopyDst);return this._renderTargetEncoder.copyBufferToBuffer(e.underlyingResource,null!=t?t:0,s,0,r),new Promise((function(e,t){n.onEndFrameObservable.addOnce((function(){s.mapAsync(S.gc.Read,0,r).then((function(){var t=s.getMappedRange(0,r),o=i;if(void 0===o)(o=new Uint8Array(r)).set(new Uint8Array(t));else{var a=o.constructor;(o=new a(o.buffer)).set(new a(t))}s.unmap(),n._bufferManager.releaseBuffer(s),e(o)}),(function(e){return t(e)}))}))}))},y.f.prototype.setStorageBuffer=function(e,t){var r,i;null===(r=this._currentDrawContext)||void 0===r||r.setBuffer(e,null!==(i=null==t?void 0:t.getBuffer())&&void 0!==i?i:null)},y.f.prototype.createUniformBuffer=function(e){var t;return t=e instanceof Array?new Float32Array(e):e,this._bufferManager.createBuffer(t,S.FB.Uniform|S.FB.CopyDst)},y.f.prototype.createDynamicUniformBuffer=function(e){return this.createUniformBuffer(e)},y.f.prototype.updateUniformBuffer=function(e,t,r,i){void 0===r&&(r=0);var n,s=e;void 0===i?i=(n=t instanceof Float32Array?t:new Float32Array(t)).byteLength:n=t instanceof Float32Array?t:new Float32Array(t),this._bufferManager.setSubData(s,r,n,0,i)},y.f.prototype.bindUniformBufferBase=function(e,t,r){this._currentDrawContext.setBuffer(r,e)},y.f.prototype.bindUniformBlock=function(){},y.f.prototype.updateVideoTexture=function(e,t,r){var i,n=this;if(e&&!e._isDisabled){void 0===this._videoTextureSupported&&(this._videoTextureSupported=!0);var s=e._hardwareTexture;(null===(i=e._hardwareTexture)||void 0===i?void 0:i.underlyingResource)||(s=this._textureHelper.createGPUTextureForInternalTexture(e)),this.createImageBitmap(t).then((function(t){n._textureHelper.updateTexture(t,e,e.width,e.height,e.depth,s.format,0,0,!r,!1,0,0),e.generateMipMaps&&n._generateMipmaps(e,n._uploadEncoder),e.isReady=!0})).catch((function(){e.isReady=!0}))}};var w=r(86830),L=r(61319),M=r(93052),O=r(85801),G=r(66970),N=r(20955),V=r(59345),k=r(59412),X=r(48743),W=r(57710),H=r(20298),Y=function(){function e(){}return e.CreateAsync=function(e,t){return y.f.IsSupportedAsync.then((function(r){return r?y.f.CreateAsync(e,t):s.D.IsSupported?new Promise((function(r){r(new s.D(e,void 0,t))})):new Promise((function(e){e(new a.S(t))}))}))},e}(),z=r(69543)}}]);