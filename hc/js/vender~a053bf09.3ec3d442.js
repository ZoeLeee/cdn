"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6170],{9224:(e,t,n)=>{n.d(t,{Z:()=>he});var i=n(52351),o=n(93517),r=n(90868),s=n(17497),a=n(55077),c=n(6785),u=n(51138),l=n(44990),h=n(88779),d=n(54485),p=n(90332),m=n(22874),f=n(71118),_=n(53513),Z=n(74408),g=n(84473),y=n(21514),b=n(7004),S=n(31328),T=n(36627),C=n(71087),w=n(1577),v=n(74064),x=n(17426),E=n(46801),D=n(7034),P=n(995),I=n(18272),R=n(10613),A=n(95189),O=n(44804),L=n(17932),M=n(18061),N=n(49616),B=n(77493),F=n(52561),z=n(84067);const k=0,V=1,U=2,H=3;function W(e){s.Z.typeOf.object("options",e),s.Z.typeOf.object("options.arrayBuffer",e.arrayBuffer),this._parsedContent=void 0,this._drawCommand=void 0,this._isTranslucent=!1,this._styleTranslucent=!1,this._constantColor=c.Z.clone(c.Z.DARKGRAY),this._highlightColor=c.Z.clone(c.Z.WHITE),this._pointSize=1,this._rtcCenter=void 0,this._quantizedVolumeScale=void 0,this._quantizedVolumeOffset=void 0,this._styleableShaderAttributes=void 0,this._isQuantized=!1,this._isOctEncoded16P=!1,this._isRGB565=!1,this._hasColors=!1,this._hasNormals=!1,this._hasBatchIds=!1,this._decodingState=U,this._dequantizeInShader=!0,this._isQuantizedDraco=!1,this._isOctEncodedDraco=!1,this._quantizedRange=0,this._octEncodedRange=0,this.backFaceCulling=!1,this._backFaceCulling=!1,this.normalShading=!0,this._normalShading=!0,this._opaqueRenderState=void 0,this._translucentRenderState=void 0,this._mode=void 0,this._ready=!1,this._pointsLength=0,this._geometryByteLength=0,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._batchTableLoaded=e.batchTableLoaded,this._pickIdLoaded=e.pickIdLoaded,this._opaquePass=(0,h.Z)(e.opaquePass,w.Z.OPAQUE),this._cull=(0,h.Z)(e.cull,!0),this.style=void 0,this._style=void 0,this.styleDirty=!1,this.modelMatrix=f.Z.clone(f.Z.IDENTITY),this._modelMatrix=f.Z.clone(f.Z.IDENTITY),this.time=0,this.shadows=N.Z.ENABLED,this._boundingSphere=void 0,this.clippingPlanes=void 0,this.isClipped=!1,this.clippingPlanesDirty=!1,this.clippingPlanesOriginMatrix=void 0,this.attenuation=!1,this._attenuation=!1,this.geometricError=0,this.geometricErrorScale=1,this.maximumAttenuation=this._pointSize,this.splitDirection=(0,h.Z)(e.splitDirection,B.Z.NONE),this._splittingEnabled=!1,this._resolveReadyPromise=void 0,this._rejectReadyPromise=void 0,this._readyPromise=function(e,t){const n=L.Z.parse(t.arrayBuffer,t.byteOffset);e._parsedContent=n,e._rtcCenter=n.rtcCenter,e._hasNormals=n.hasNormals,e._hasColors=n.hasColors,e._hasBatchIds=n.hasBatchIds,e._isTranslucent=n.isTranslucent,!n.hasBatchIds&&(0,d.Z)(n.batchTableBinary)&&(n.styleableProperties=I.Z.getBinaryProperties(n.pointsLength,n.batchTableJson,n.batchTableBinary));if((0,d.Z)(n.draco)){const t=n.draco;e._decodingState=k,t.dequantizeInShader=e._dequantizeInShader}const i=n.positions;(0,d.Z)(i)&&(e._isQuantized=i.isQuantized,e._quantizedVolumeScale=i.quantizedVolumeScale,e._quantizedVolumeOffset=i.quantizedVolumeOffset,e._quantizedRange=i.quantizedRange);const o=n.normals;(0,d.Z)(o)&&(e._isOctEncoded16P=o.octEncoded);const r=n.colors;(0,d.Z)(r)&&((0,d.Z)(r.constantColor)&&(e._constantColor=c.Z.clone(r.constantColor,e._constantColor),e._hasColors=!1),e._isRGB565=r.isRGB565);const s=n.batchIds;(0,d.Z)(n.batchIds)&&(s.name="BATCH_ID",s.semantic="BATCH_ID",s.setIndex=void 0);n.hasBatchIds&&e._batchTableLoaded(n.batchLength,n.batchTableJson,n.batchTableBinary);return e._pointsLength=n.pointsLength,new Promise((function(t,n){e._resolveReadyPromise=function(){e._ready=!0,t(e)},e._rejectReadyPromise=n}))}(this,e)}Object.defineProperties(W.prototype,{pointsLength:{get:function(){return this._pointsLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},color:{get:function(){return c.Z.clone(this._highlightColor)},set:function(e){this._highlightColor=c.Z.clone(e,this._highlightColor)}},boundingSphere:{get:function(){if((0,d.Z)(this._drawCommand))return this._drawCommand.boundingVolume},set:function(e){this._boundingSphere=i.Z.clone(e,this._boundingSphere)}}});const j=new o.Z,G=new o.Z,q=new o.Z;let $,Y;function Q(e){if(!(0,d.Z)(Y)){$=new D.Z(0),Y=new Array(e);for(let t=0;t<e;++t)Y[t]=$.random()}return Y}function X(e,t){const n=l.Z.fromTypedArray(e);return n===l.Z.INT||n===l.Z.UNSIGNED_INT||n===l.Z.DOUBLE?((0,_.Z)("Cast pnts property to floats",`Point cloud property "${t}" will be casted to a float array because INT, UNSIGNED_INT, and DOUBLE are not valid WebGL vertex attribute types. Some precision may be lost.`),new Float32Array(e)):e}const K=new r.Z,J=new r.Z,ee=new c.Z,te=new f.Z,ne=new f.Z;function ie(e,t){const n=t.context,r=e._parsedContent,s=e._pointsLength,a=r.positions,c=r.colors,u=r.normals,h=r.batchIds,p=r.styleableProperties,_=(0,d.Z)(p),Z=e._isQuantized,y=e._isQuantizedDraco,b=e._isOctEncoded16P,x=e._isOctEncodedDraco,D=e._quantizedRange,I=e._octEncodedRange,R=e._isRGB565,A=e._isTranslucent,O=e._hasColors,L=e._hasNormals,M=e._hasBatchIds;let N,B;const F=[],k={};if(e._styleableShaderAttributes=k,_){let t=4;for(const i in p)if(p.hasOwnProperty(i)){const o=p[i],r=X(o.typedArray,i);N=o.componentCount,B=l.Z.fromTypedArray(r);const s=S.Z.createVertexBuffer({context:n,typedArray:r,usage:T.Z.STATIC_DRAW});e._geometryByteLength+=s.sizeInBytes;const a={index:t,vertexBuffer:s,componentsPerAttribute:N,componentDatatype:B,normalize:!1,offsetInBytes:0,strideInBytes:0};F.push(a),k[i]={location:t,componentCount:N},++t}}const V=S.Z.createVertexBuffer({context:n,typedArray:a.typedArray,usage:T.Z.STATIC_DRAW});let U,H,W;e._geometryByteLength+=V.sizeInBytes,O&&(U=S.Z.createVertexBuffer({context:n,typedArray:c.typedArray,usage:T.Z.STATIC_DRAW}),e._geometryByteLength+=U.sizeInBytes),L&&(H=S.Z.createVertexBuffer({context:n,typedArray:u.typedArray,usage:T.Z.STATIC_DRAW}),e._geometryByteLength+=H.sizeInBytes),M&&(h.typedArray=X(h.typedArray,"batchIds"),W=S.Z.createVertexBuffer({context:n,typedArray:h.typedArray,usage:T.Z.STATIC_DRAW}),e._geometryByteLength+=W.sizeInBytes);let $=[];if(B=Z?l.Z.UNSIGNED_SHORT:y?D<=255?l.Z.UNSIGNED_BYTE:l.Z.UNSIGNED_SHORT:l.Z.FLOAT,$.push({index:0,vertexBuffer:V,componentsPerAttribute:3,componentDatatype:B,normalize:!1,offsetInBytes:0,strideInBytes:0}),e._cull&&(e._boundingSphere=Z||y?i.Z.fromCornerPoints(o.Z.ZERO,e._quantizedVolumeScale):function(e){const t=e.length/3,n=Math.min(t,20),r=Q(20),s=Number.MAX_VALUE,a=-Number.MAX_VALUE,c=o.Z.fromElements(s,s,s,j),u=o.Z.fromElements(a,a,a,G);for(let i=0;i<n;++i){const n=Math.floor(r[i]*t),s=o.Z.unpack(e,3*n,q);o.Z.minimumByComponent(c,s,c),o.Z.maximumByComponent(u,s,u)}const l=i.Z.fromCornerPoints(c,u);return l.radius+=m.Z.EPSILON2,l}(a.typedArray)),O)if(R)$.push({index:1,vertexBuffer:U,componentsPerAttribute:1,componentDatatype:l.Z.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0});else{const e=A?4:3;$.push({index:1,vertexBuffer:U,componentsPerAttribute:e,componentDatatype:l.Z.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0})}L&&(b?(N=2,B=l.Z.UNSIGNED_BYTE):x?(N=2,B=I<=255?l.Z.UNSIGNED_BYTE:l.Z.UNSIGNED_SHORT):(N=3,B=l.Z.FLOAT),$.push({index:2,vertexBuffer:H,componentsPerAttribute:N,componentDatatype:B,normalize:!1,offsetInBytes:0,strideInBytes:0})),M&&$.push({index:3,vertexBuffer:W,componentsPerAttribute:1,componentDatatype:l.Z.fromTypedArray(h.typedArray),normalize:!1,offsetInBytes:0,strideInBytes:0}),_&&($=$.concat(F));const Y=new E.Z({context:n,attributes:$}),K={depthTest:{enabled:!0}},J={depthTest:{enabled:!0},depthMask:!1,blending:P.Z.ALPHA_BLEND};e._opaquePass===w.Z.CESIUM_3D_TILE&&(K.stencilTest=z.Z.setCesium3DTileBit(),K.stencilMask=z.Z.CESIUM_3D_TILE_MASK,J.stencilTest=z.Z.setCesium3DTileBit(),J.stencilMask=z.Z.CESIUM_3D_TILE_MASK),e._opaqueRenderState=v.Z.fromCache(K),e._translucentRenderState=v.Z.fromCache(J),e._drawCommand=new C.Z({boundingVolume:new i.Z,cull:e._cull,modelMatrix:new f.Z,primitiveType:g.Z.POINTS,vertexArray:Y,count:s,shaderProgram:void 0,uniformMap:void 0,renderState:A?e._translucentRenderState:e._opaqueRenderState,pass:A?w.Z.TRANSLUCENT:e._opaquePass,owner:e,castShadows:!1,receiveShadows:!1,pickId:e._pickIdLoaded()})}function oe(e,t){const n=/czm_3dtiles_property_(\d+)/g;let i=n.exec(e);for(;null!==i;){const o=parseInt(i[1]);-1===t.indexOf(o)&&t.push(o),i=n.exec(e)}}function re(e,t){e=e.slice(e.indexOf("\n"));const n=/czm_3dtiles_builtin_property_(\w+)/g;let i=n.exec(e);for(;null!==i;){const o=i[1];-1===t.indexOf(o)&&t.push(o),i=n.exec(e)}}function se(e,t){const n=e.numberOfAttributes;for(let i=0;i<n;++i){const n=e.getAttribute(i);if(n.index===t)return n}}const ae={POSITION:"czm_3dtiles_builtin_property_POSITION",POSITION_ABSOLUTE:"czm_3dtiles_builtin_property_POSITION_ABSOLUTE",COLOR:"czm_3dtiles_builtin_property_COLOR",NORMAL:"czm_3dtiles_builtin_property_NORMAL"};function ce(e,t,n){let i,r,s;const l=t.context,p=(0,d.Z)(n),m=e._isQuantized,_=e._isQuantizedDraco,g=e._isOctEncoded16P,b=e._isOctEncodedDraco,S=e._isRGB565,T=e._isTranslucent,C=e._hasColors,w=e._hasNormals,v=e._hasBatchIds,E=e._backFaceCulling,D=e._normalShading,P=e._drawCommand.vertexArray,I=e.clippingPlanes,R=e._attenuation;let L,N,z,k=T;const V=(0,a.Z)(ae),U={},H=e._styleableShaderAttributes;for(r in H)H.hasOwnProperty(r)&&(s=H[r],V[r]=`czm_3dtiles_property_${s.location}`,U[s.location]=s);if(p){const e={translucent:!1},t="(vec3 czm_3dtiles_builtin_property_POSITION, vec3 czm_3dtiles_builtin_property_POSITION_ABSOLUTE, vec4 czm_3dtiles_builtin_property_COLOR, vec3 czm_3dtiles_builtin_property_NORMAL)";L=n.getColorShaderFunction(`getColorFromStyle${t}`,V,e),N=n.getShowShaderFunction(`getShowFromStyle${t}`,V,e),z=n.getPointSizeShaderFunction(`getPointSizeFromStyle${t}`,V,e),(0,d.Z)(L)&&e.translucent&&(k=!0)}e._styleTranslucent=k;const W=(0,d.Z)(L),j=(0,d.Z)(N),G=(0,d.Z)(z),q=e.isClipped,$=[],Y=[];W&&(oe(L,$),re(L,Y)),j&&(oe(N,$),re(N,Y)),G&&(oe(z,$),re(z,Y));const Q=Y.indexOf("COLOR")>=0,X=Y.indexOf("NORMAL")>=0;if(X&&!w)throw new y.Z("Style references the NORMAL semantic but the point cloud does not have normals");for(r in H)if(H.hasOwnProperty(r)){s=H[r];const e=$.indexOf(s.location)>=0;se(P,s.location).enabled=e}const ie=C&&(!W||Q);if(C){se(P,1).enabled=ie}const ce=w&&(D||E||X);if(w){se(P,2).enabled=ce}const ue={a_position:0};ie&&(ue.a_color=1),ce&&(ue.a_normal=2),v&&(ue.a_batchId=3);let le="";const he=$.length;for(i=0;i<he;++i){const e=$[i];s=U[e];const t=s.componentCount,n=`czm_3dtiles_property_${e}`;let o;o=1===t?"float":`vec${t}`,le+=`attribute ${o} ${n}; \n`,ue[n]=s.location}!function(e,t){const n=t.context,i=e._isQuantized,r=e._isQuantizedDraco,s=e._isOctEncodedDraco;let a={u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier:function(){const i=K;if(i.x=e._attenuation?e.maximumAttenuation:e._pointSize,i.x*=t.pixelRatio,i.y=e.time,e._attenuation){const o=t.camera.frustum;let r;r=t.mode===M.Z.SCENE2D||o instanceof Z.Z?Number.POSITIVE_INFINITY:n.drawingBufferHeight/t.camera.frustum.sseDenominator,i.z=e.geometricError*e.geometricErrorScale,i.w=r}return i},u_highlightColor:function(){return e._highlightColor},u_constantColor:function(){return e._constantColor},u_clippingPlanes:function(){const t=e.clippingPlanes;return e.isClipped?t.texture:n.defaultTexture},u_clippingPlanesEdgeStyle:function(){const t=e.clippingPlanes;if(!(0,d.Z)(t))return c.Z.TRANSPARENT;const n=c.Z.clone(t.edgeColor,ee);return n.alpha=t.edgeWidth,n},u_clippingPlanesMatrix:function(){const t=e.clippingPlanes;if(!(0,d.Z)(t))return f.Z.IDENTITY;const i=(0,h.Z)(e.clippingPlanesOriginMatrix,e._modelMatrix);f.Z.multiply(n.uniformState.view3D,i,te);const o=f.Z.multiply(te,t.modelMatrix,te);return f.Z.inverseTranspose(o,ne)}};F.Z.addUniforms(e,a),(i||r||s)&&(a=(0,u.Z)(a,{u_quantizedVolumeScaleAndOctEncodedRange:function(){const t=J;if((0,d.Z)(e._quantizedVolumeScale)){const n=o.Z.clone(e._quantizedVolumeScale,t);o.Z.divideByScalar(n,e._quantizedRange,t)}return t.w=e._octEncodedRange,t}})),(0,d.Z)(e._uniformMapLoaded)&&(a=e._uniformMapLoaded(a)),e._drawCommand.uniformMap=a}(e,t);let de="attribute vec3 a_position; \nvarying vec4 v_color; \nuniform vec4 u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier; \nuniform vec4 u_constantColor; \nuniform vec4 u_highlightColor; \n";de+="float u_pointSize; \nfloat u_time; \n",R&&(de+="float u_geometricError; \nfloat u_depthMultiplier; \n"),de+=le,ie&&(de+=T?"attribute vec4 a_color; \n":S?"attribute float a_color; \nconst float SHIFT_RIGHT_11 = 1.0 / 2048.0; \nconst float SHIFT_RIGHT_5 = 1.0 / 32.0; \nconst float SHIFT_LEFT_11 = 2048.0; \nconst float SHIFT_LEFT_5 = 32.0; \nconst float NORMALIZE_6 = 1.0 / 64.0; \nconst float NORMALIZE_5 = 1.0 / 32.0; \n":"attribute vec3 a_color; \n"),ce&&(de+=g||b?"attribute vec2 a_normal; \n":"attribute vec3 a_normal; \n"),v&&(de+="attribute float a_batchId; \n"),(m||_||b)&&(de+="uniform vec4 u_quantizedVolumeScaleAndOctEncodedRange; \n"),W&&(de+=L),j&&(de+=N),G&&(de+=z),de+="void main() \n{ \n    u_pointSize = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.x; \n    u_time = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.y; \n",R&&(de+="    u_geometricError = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.z; \n    u_depthMultiplier = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.w; \n"),de+=ie?T?"    vec4 color = a_color; \n":S?"    float compressed = a_color; \n    float r = floor(compressed * SHIFT_RIGHT_11); \n    compressed -= r * SHIFT_LEFT_11; \n    float g = floor(compressed * SHIFT_RIGHT_5); \n    compressed -= g * SHIFT_LEFT_5; \n    float b = compressed; \n    vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5); \n    vec4 color = vec4(rgb, 1.0); \n":"    vec4 color = vec4(a_color, 1.0); \n":"    vec4 color = u_constantColor; \n",de+=m||_?"    vec3 position = a_position * u_quantizedVolumeScaleAndOctEncodedRange.xyz; \n":"    vec3 position = a_position; \n",de+="    vec3 position_absolute = vec3(czm_model * vec4(position, 1.0)); \n",ce?(de+=g?"    vec3 normal = czm_octDecode(a_normal); \n":b?"    vec3 normal = czm_octDecode(a_normal, u_quantizedVolumeScaleAndOctEncodedRange.w).zxy; \n":"    vec3 normal = a_normal; \n",de+="    vec3 normalEC = czm_normal * normal; \n"):de+="    vec3 normal = vec3(1.0); \n",W&&(de+="    color = getColorFromStyle(position, position_absolute, color, normal); \n"),j&&(de+="    float show = float(getShowFromStyle(position, position_absolute, color, normal)); \n"),de+=G?"    gl_PointSize = getPointSizeFromStyle(position, position_absolute, color, normal) * czm_pixelRatio; \n":R?"    vec4 positionEC = czm_modelView * vec4(position, 1.0); \n    float depth = -positionEC.z; \n    gl_PointSize = min((u_geometricError / depth) * u_depthMultiplier, u_pointSize); \n":"    gl_PointSize = u_pointSize; \n",de+="    color = color * u_highlightColor; \n",ce&&D&&(de+="    float diffuseStrength = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC); \n    diffuseStrength = max(diffuseStrength, 0.4); \n    color.xyz *= diffuseStrength * czm_lightColor; \n"),de+="    v_color = color; \n    gl_Position = czm_modelViewProjection * vec4(position, 1.0); \n",ce&&E&&(de+="    float visible = step(-normalEC.z, 0.0); \n    gl_Position *= visible; \n    gl_PointSize *= visible; \n"),j&&(de+="    gl_Position.w *= float(show); \n    gl_PointSize *= float(show); \n"),de+="} \n";let pe="varying vec4 v_color; \n";q&&(pe+="uniform highp sampler2D u_clippingPlanes; \nuniform mat4 u_clippingPlanesMatrix; \nuniform vec4 u_clippingPlanesEdgeStyle; \n",pe+="\n",pe+=(0,O.Z)(I,l),pe+="\n"),pe+="void main() \n{ \n    gl_FragColor = czm_gammaCorrect(v_color); \n",q&&(pe+=(0,A.Z)("u_clippingPlanes","u_clippingPlanesMatrix","u_clippingPlanesEdgeStyle")),pe+="} \n",e.splitDirection!==B.Z.NONE&&(pe=F.Z.modifyFragmentShader(pe)),(0,d.Z)(e._vertexShaderLoaded)&&(de=e._vertexShaderLoaded(de)),(0,d.Z)(e._fragmentShaderLoaded)&&(pe=e._fragmentShaderLoaded(pe));const me=e._drawCommand;(0,d.Z)(me.shaderProgram)&&me.shaderProgram.destroy(),me.shaderProgram=x.Z.fromCache({context:l,vertexShaderSource:de,fragmentShaderSource:pe,attributeLocations:ue});try{me.shaderProgram._bind()}catch(e){throw new y.Z("Error generating style shader: this may be caused by a type mismatch, index out-of-bounds, or other syntax error.")}}const ue=new r.Z,le=new o.Z;W.prototype.update=function(e){const t=function(e,t){if(e._decodingState===U)return!1;if(e._decodingState===k){const n=e._parsedContent,i=n.draco,r=R.Z.decodePointCloud(i,t);(0,d.Z)(r)&&(e._decodingState=V,r.then((function(t){e._decodingState=U;const r=(0,d.Z)(t.POSITION)?t.POSITION.array:void 0,s=(0,d.Z)(t.RGB)?t.RGB.array:void 0,a=(0,d.Z)(t.RGBA)?t.RGBA.array:void 0,c=(0,d.Z)(t.NORMAL)?t.NORMAL.array:void 0,u=(0,d.Z)(t.BATCH_ID)?t.BATCH_ID.array:void 0,l=(0,d.Z)(r)&&(0,d.Z)(t.POSITION.data.quantization),p=(0,d.Z)(c)&&(0,d.Z)(t.NORMAL.data.quantization);if(l){const n=t.POSITION.data.quantization,i=n.range;e._quantizedVolumeScale=o.Z.fromElements(i,i,i),e._quantizedVolumeOffset=o.Z.unpack(n.minValues),e._quantizedRange=(1<<n.quantizationBits)-1,e._isQuantizedDraco=!0}p&&(e._octEncodedRange=(1<<t.NORMAL.data.quantization.quantizationBits)-1,e._isOctEncodedDraco=!0);let m=n.styleableProperties;const f=i.batchTableProperties;for(const e in f)if(f.hasOwnProperty(e)){const n=t[e];(0,d.Z)(m)||(m={}),m[e]={typedArray:n.array,componentCount:n.data.componentsPerAttribute}}(0,d.Z)(r)&&(n.positions={typedArray:r});const _=(0,h.Z)(a,s);(0,d.Z)(_)&&(n.colors={typedArray:_}),(0,d.Z)(c)&&(n.normals={typedArray:c}),(0,d.Z)(u)&&(n.batchIds={typedArray:u}),n.styleableProperties=m})).catch((function(t){e._decodingState=H,e._rejectReadyPromise(t)})))}return!0}(this,e.context);if(t)return;let n=!1,s=!f.Z.equals(this._modelMatrix,this.modelMatrix);if(this._mode!==e.mode&&(this._mode=e.mode,s=!0),(0,d.Z)(this._drawCommand)||(ie(this,e),s=!0,n=!0,this._resolveReadyPromise(),this._parsedContent=void 0),s){f.Z.clone(this.modelMatrix,this._modelMatrix);const t=this._drawCommand.modelMatrix;if(f.Z.clone(this._modelMatrix,t),(0,d.Z)(this._rtcCenter)&&f.Z.multiplyByTranslation(t,this._rtcCenter,t),(0,d.Z)(this._quantizedVolumeOffset)&&f.Z.multiplyByTranslation(t,this._quantizedVolumeOffset,t),e.mode!==M.Z.SCENE3D){const n=e.mapProjection,i=f.Z.getColumn(t,3,ue);r.Z.equals(i,r.Z.UNIT_W)||b.Z.basisTo2D(n,t,t)}const n=this._drawCommand.boundingVolume;if(i.Z.clone(this._boundingSphere,n),this._cull){const e=n.center;f.Z.multiplyByPoint(t,e,e);const i=f.Z.getScale(t,le);n.radius*=o.Z.maximumComponent(i)}}this.clippingPlanesDirty&&(this.clippingPlanesDirty=!1,n=!0),this._attenuation!==this.attenuation&&(this._attenuation=this.attenuation,n=!0),this.backFaceCulling!==this._backFaceCulling&&(this._backFaceCulling=this.backFaceCulling,n=!0),this.normalShading!==this._normalShading&&(this._normalShading=this.normalShading,n=!0),(this._style!==this.style||this.styleDirty)&&(this._style=this.style,this.styleDirty=!1,n=!0);const a=this.splitDirection!==B.Z.NONE;this._splittingEnabled!==a&&(this._splittingEnabled=a,n=!0),n&&ce(this,e,this._style),this._drawCommand.castShadows=N.Z.castShadows(this.shadows),this._drawCommand.receiveShadows=N.Z.receiveShadows(this.shadows);const c=this._highlightColor.alpha<1||this._constantColor.alpha<1||this._styleTranslucent;this._drawCommand.renderState=c?this._translucentRenderState:this._opaqueRenderState,this._drawCommand.pass=c?w.Z.TRANSLUCENT:this._opaquePass;const u=e.commandList,l=e.passes;(l.render||l.pick)&&u.push(this._drawCommand)},W.prototype.isDestroyed=function(){return!1},W.prototype.destroy=function(){const e=this._drawCommand;return(0,d.Z)(e)&&(e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy()),(0,p.Z)(this)};const he=W},41614:(e,t,n)=>{n.d(t,{Z:()=>C});var i=n(6785),o=n(51138),r=n(88779),s=n(54485),a=n(90332),c=n(20176),u=n(22874),l=n(1577),h=n(18272),d=n(96059),p=n(65606),m=n(9224),f=n(85803),_=n(18061);function Z(e,t,n,i,o){var r;this._tileset=e,this._tile=t,this._resource=n,this._metadata=void 0,this._pickId=void 0,this._batchTable=void 0,this._styleDirty=!1,this._features=void 0,this.featurePropertiesDirty=!1,this._group=void 0,this._pointCloud=new m.Z({arrayBuffer:i,byteOffset:o,cull:!1,opaquePass:l.Z.CESIUM_3D_TILE,vertexShaderLoaded:(r=this,function(e){return(0,s.Z)(r._batchTable)?r._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(e):e}),fragmentShaderLoaded:g(this),uniformMapLoaded:y(this),batchTableLoaded:b(this),pickIdLoaded:S(this)})}function g(e){return function(t){return(0,s.Z)(e._batchTable)?e._batchTable.getFragmentShaderCallback(!1,void 0,!1)(t):`uniform vec4 czm_pickColor;\n${t}`}}function y(e){return function(t){return(0,s.Z)(e._batchTable)?e._batchTable.getUniformMapCallback()(t):(0,o.Z)(t,{czm_pickColor:function(){return e._pickId.color}})}}function b(e){return function(t,n,i){e._batchTable=new h.Z(e,t,n,i)}}function S(e){return function(){return(0,s.Z)(e._batchTable)?e._batchTable.getPickId():"czm_pickColor"}}Object.defineProperties(Z.prototype,{featuresLength:{get:function(){return(0,s.Z)(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return this._pointCloud.pointsLength}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return this._pointCloud.geometryByteLength}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return(0,s.Z)(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._pointCloud.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},batchTable:{get:function(){return this._batchTable}},group:{get:function(){return this._group},set:function(e){this._group=e}}}),Z.prototype.hasProperty=function(e,t){return!!(0,s.Z)(this._batchTable)&&this._batchTable.hasProperty(e,t)},Z.prototype.getFeature=function(e){if(!(0,s.Z)(this._batchTable))return;const t=this.featuresLength;if(!(0,s.Z)(e)||e<0||e>=t)throw new c.Z(`batchId is required and between zero and featuresLength - 1 (${t-1}).`);return function(e){const t=e.featuresLength;if(!(0,s.Z)(e._features)&&t>0){const n=new Array(t);for(let i=0;i<t;++i)n[i]=new d.Z(e,i);e._features=n}}(this),this._features[e]},Z.prototype.applyDebugSettings=function(e,t){this._pointCloud.color=e?t:i.Z.WHITE},Z.prototype.applyStyle=function(e){(0,s.Z)(this._batchTable)?this._batchTable.applyStyle(e):this._styleDirty=!0};const T=new f.Z;Z.prototype.update=function(e,t){const n=this._pointCloud,i=(0,r.Z)(e.pointCloudShading,T),o=this._tile,a=this._batchTable,c=t.mode,l=e.clippingPlanes;let h;(0,s.Z)(this._pickId)||(0,s.Z)(a)||(this._pickId=t.context.createPickId({primitive:e,content:this})),(0,s.Z)(a)&&a.update(e,t),h=(0,s.Z)(o._contentBoundingVolume)?c===_.Z.SCENE3D?o._contentBoundingVolume.boundingSphere:o._contentBoundingVolume2D.boundingSphere:c===_.Z.SCENE3D?o._boundingVolume.boundingSphere:o._boundingVolume2D.boundingSphere;const d=this._styleDirty;this._styleDirty=!1,n.clippingPlanesOriginMatrix=e.clippingPlanesOriginMatrix,n.style=(0,s.Z)(a)?void 0:e.style,n.styleDirty=d,n.modelMatrix=o.computedTransform,n.time=e.timeSinceLoad,n.shadows=e.shadows,n.boundingSphere=h,n.clippingPlanes=l,n.isClipped=(0,s.Z)(l)&&l.enabled&&o._isClipped,n.clippingPlanesDirty=o.clippingPlanesDirty,n.attenuation=i.attenuation,n.backFaceCulling=i.backFaceCulling,n.normalShading=i.normalShading,n.geometricError=function(e){const t=e._tileset.pointCloudShading,n=e._tile.contentBoundingVolume.boundingSphere.volume(),i=u.Z.cbrt(n/e.pointsLength);let o=e._tile.geometricError;return 0===o&&(o=(0,s.Z)(t)&&(0,s.Z)(t.baseResolution)?t.baseResolution:i),o}(this),n.geometricErrorScale=i.geometricErrorScale,n.splitDirection=e.splitDirection,(0,s.Z)(i)&&(0,s.Z)(i.maximumAttenuation)?n.maximumAttenuation=i.maximumAttenuation:o.refine===p.Z.ADD?n.maximumAttenuation=5:n.maximumAttenuation=e.maximumScreenSpaceError,n.update(t)},Z.prototype.isDestroyed=function(){return!1},Z.prototype.destroy=function(){return this._pickId=this._pickId&&this._pickId.destroy(),this._pointCloud=this._pointCloud&&this._pointCloud.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),(0,a.Z)(this)};const C=Z},83714:(e,t,n)=>{n.d(t,{Z:()=>T});var i=n(59015),o=n(6785),r=n(54485),s=n(90332),a=n(84473),c=n(74366),u=n(71087),l=n(37791),h=n(1577),d=n(74064),p=n(7048),m=n(995),f=n(84067),_=n(56967);function Z(){this._framebuffer=new l.Z({colorAttachmentsLength:2,depth:!0,supportsDepthTexture:!0}),this._drawCommand=void 0,this._clearCommand=void 0,this._strength=1,this._radius=1}Object.defineProperties(Z.prototype,{framebuffer:{get:function(){return this._framebuffer.framebuffer}},colorGBuffer:{get:function(){return this._framebuffer.getColorTexture(0)}},depthGBuffer:{get:function(){return this._framebuffer.getColorTexture(1)}}});const g=new i.Z;function y(e,t){const n=t.drawingBufferWidth,i=t.drawingBufferHeight;e._framebuffer.update(t,n,i),function(e,t){const n=new p.Z({defines:["LOG_DEPTH_WRITE"],sources:[_.Z]}),i={u_pointCloud_colorGBuffer:function(){return e.colorGBuffer},u_pointCloud_depthGBuffer:function(){return e.depthGBuffer},u_distanceAndEdlStrength:function(){return g.x=e._radius,g.y=e._strength,g}},r=d.Z.fromCache({blending:m.Z.ALPHA_BLEND,depthMask:!0,depthTest:{enabled:!0},stencilTest:f.Z.setCesium3DTileBit(),stencilMask:f.Z.CESIUM_3D_TILE_MASK});e._drawCommand=t.createViewportQuadCommand(n,{uniformMap:i,renderState:r,pass:h.Z.CESIUM_3D_TILE,owner:e}),e._clearCommand=new c.Z({framebuffer:e.framebuffer,color:new o.Z(0,0,0,0),depth:1,renderState:d.Z.fromCache(),pass:h.Z.CESIUM_3D_TILE,owner:e})}(e,t)}function b(e){return e.drawBuffers&&e.fragmentDepth}function S(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,"EC");if(!(0,r.Z)(n)){const i=t._attributeLocations,o=t.fragmentShaderSource.clone();o.sources=o.sources.map((function(e){return e=(e=p.Z.replaceMain(e,"czm_point_cloud_post_process_main")).replace(/gl_FragColor/g,"gl_FragData[0]")})),o.sources.unshift("#extension GL_EXT_draw_buffers : enable \n"),o.sources.push("void main() \n{ \n    czm_point_cloud_post_process_main(); \n#ifdef LOG_DEPTH\n    czm_writeLogDepth();\n    gl_FragData[1] = czm_packDepth(gl_FragDepthEXT); \n#else\n    gl_FragData[1] = czm_packDepth(gl_FragCoord.z);\n#endif\n}"),n=e.shaderCache.createDerivedShaderProgram(t,"EC",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:o,attributeLocations:i})}return n}Z.isSupported=b,Z.prototype.update=function(e,t,n,i){if(!b(e.context))return;let o;this._strength=n.eyeDomeLightingStrength,this._radius=n.eyeDomeLightingRadius*e.pixelRatio,y(this,e.context);const s=e.commandList,c=s.length;for(o=t;o<c;++o){const t=s[o];if(t.primitiveType!==a.Z.POINTS||t.pass===h.Z.TRANSLUCENT)continue;let n,i,c=t.derivedCommands.pointCloudProcessor;(0,r.Z)(c)&&(n=c.command,i=c.originalShaderProgram),(0,r.Z)(n)&&!t.dirty&&i===t.shaderProgram&&n.framebuffer===this.framebuffer||(n=u.Z.shallowClone(t,n),n.framebuffer=this.framebuffer,n.shaderProgram=S(e.context,t.shaderProgram),n.castShadows=!1,n.receiveShadows=!1,(0,r.Z)(c)||(c={command:n,originalShaderProgram:t.shaderProgram},t.derivedCommands.pointCloudProcessor=c),c.originalShaderProgram=t.shaderProgram),s[o]=n}const l=this._clearCommand,d=this._drawCommand;d.boundingVolume=i,s.push(d),s.push(l)},Z.prototype.isDestroyed=function(){return!1},Z.prototype.destroy=function(){var e;return(e=this)._framebuffer.destroy(),e._drawCommand=void 0,e._clearCommand=void 0,(0,s.Z)(this)};const T=Z},85803:(e,t,n)=>{n.d(t,{Z:()=>s});var i=n(88779),o=n(83714);function r(e){const t=(0,i.Z)(e,{});this.attenuation=(0,i.Z)(t.attenuation,!1),this.geometricErrorScale=(0,i.Z)(t.geometricErrorScale,1),this.maximumAttenuation=t.maximumAttenuation,this.baseResolution=t.baseResolution,this.eyeDomeLighting=(0,i.Z)(t.eyeDomeLighting,!0),this.eyeDomeLightingStrength=(0,i.Z)(t.eyeDomeLightingStrength,1),this.eyeDomeLightingRadius=(0,i.Z)(t.eyeDomeLightingRadius,1),this.backFaceCulling=(0,i.Z)(t.backFaceCulling,!1),this.normalShading=(0,i.Z)(t.normalShading,!0)}r.isSupported=function(e){return o.Z.isSupported(e.context)};const s=r},61588:(e,t,n)=>{n.d(t,{Z:()=>I});var i=n(23114),o=n(59015),r=n(93517),s=n(90868),a=n(6785),c=n(88779),u=n(54485),l=n(20176),h=n(51178),d=n(71118),p=n(14633),m=n(18061),f=n(53640);function _(e,t){if(e=(0,c.Z)(e,c.Z.EMPTY_OBJECT),(0,u.Z)(e.disableDepthTestDistance)&&e.disableDepthTestDistance<0)throw new l.Z("disableDepthTestDistance must be greater than or equal to 0.0.");let n=e.translucencyByDistance,i=e.scaleByDistance,o=e.distanceDisplayCondition;if((0,u.Z)(n)){if(n.far<=n.near)throw new l.Z("translucencyByDistance.far must be greater than translucencyByDistance.near.");n=p.Z.clone(n)}if((0,u.Z)(i)){if(i.far<=i.near)throw new l.Z("scaleByDistance.far must be greater than scaleByDistance.near.");i=p.Z.clone(i)}if((0,u.Z)(o)){if(o.far<=o.near)throw new l.Z("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");o=h.Z.clone(o)}this._show=(0,c.Z)(e.show,!0),this._position=r.Z.clone((0,c.Z)(e.position,r.Z.ZERO)),this._actualPosition=r.Z.clone(this._position),this._color=a.Z.clone((0,c.Z)(e.color,a.Z.WHITE)),this._outlineColor=a.Z.clone((0,c.Z)(e.outlineColor,a.Z.TRANSPARENT)),this._outlineWidth=(0,c.Z)(e.outlineWidth,0),this._pixelSize=(0,c.Z)(e.pixelSize,10),this._scaleByDistance=i,this._translucencyByDistance=n,this._distanceDisplayCondition=o,this._disableDepthTestDistance=(0,c.Z)(e.disableDepthTestDistance,0),this._id=e.id,this._collection=(0,c.Z)(e.collection,t),this._clusterShow=!0,this._pickId=void 0,this._pointPrimitiveCollection=t,this._dirty=!1,this._index=-1}const Z=_.SHOW_INDEX=0,g=_.POSITION_INDEX=1,y=_.COLOR_INDEX=2,b=_.OUTLINE_COLOR_INDEX=3,S=_.OUTLINE_WIDTH_INDEX=4,T=_.PIXEL_SIZE_INDEX=5,C=_.SCALE_BY_DISTANCE_INDEX=6,w=_.TRANSLUCENCY_BY_DISTANCE_INDEX=7,v=_.DISTANCE_DISPLAY_CONDITION_INDEX=8,x=_.DISABLE_DEPTH_DISTANCE_INDEX=9;function E(e,t){const n=e._pointPrimitiveCollection;(0,u.Z)(n)&&(n._updatePointPrimitive(e,t),e._dirty=!0)}_.NUMBER_OF_PROPERTIES=10,Object.defineProperties(_.prototype,{show:{get:function(){return this._show},set:function(e){if(!(0,u.Z)(e))throw new l.Z("value is required.");this._show!==e&&(this._show=e,E(this,Z))}},position:{get:function(){return this._position},set:function(e){if(!(0,u.Z)(e))throw new l.Z("value is required.");const t=this._position;r.Z.equals(t,e)||(r.Z.clone(e,t),r.Z.clone(e,this._actualPosition),E(this,g))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){if((0,u.Z)(e)&&e.far<=e.near)throw new l.Z("far distance must be greater than near distance.");const t=this._scaleByDistance;p.Z.equals(t,e)||(this._scaleByDistance=p.Z.clone(e,t),E(this,C))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){if((0,u.Z)(e)&&e.far<=e.near)throw new l.Z("far distance must be greater than near distance.");const t=this._translucencyByDistance;p.Z.equals(t,e)||(this._translucencyByDistance=p.Z.clone(e,t),E(this,w))}},pixelSize:{get:function(){return this._pixelSize},set:function(e){if(!(0,u.Z)(e))throw new l.Z("value is required.");this._pixelSize!==e&&(this._pixelSize=e,E(this,T))}},color:{get:function(){return this._color},set:function(e){if(!(0,u.Z)(e))throw new l.Z("value is required.");const t=this._color;a.Z.equals(t,e)||(a.Z.clone(e,t),E(this,y))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){if(!(0,u.Z)(e))throw new l.Z("value is required.");const t=this._outlineColor;a.Z.equals(t,e)||(a.Z.clone(e,t),E(this,b))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){if(!(0,u.Z)(e))throw new l.Z("value is required.");this._outlineWidth!==e&&(this._outlineWidth=e,E(this,S))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if((0,u.Z)(e)&&e.far<=e.near)throw new l.Z("far must be greater than near");h.Z.equals(this._distanceDisplayCondition,e)||(this._distanceDisplayCondition=h.Z.clone(e,this._distanceDisplayCondition),E(this,v))}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){if(this._disableDepthTestDistance!==e){if(!(0,u.Z)(e)||e<0)throw new l.Z("disableDepthTestDistance must be greater than or equal to 0.0.");this._disableDepthTestDistance=e,E(this,x)}}},id:{get:function(){return this._id},set:function(e){this._id=e,(0,u.Z)(this._pickId)&&(this._pickId.object.id=e)}},pickId:{get:function(){return this._pickId}},clusterShow:{get:function(){return this._clusterShow},set:function(e){this._clusterShow!==e&&(this._clusterShow=e,E(this,Z))}}}),_.prototype.getPickId=function(e){return(0,u.Z)(this._pickId)||(this._pickId=e.createPickId({primitive:this,collection:this._collection,id:this._id})),this._pickId},_.prototype._getActualPosition=function(){return this._actualPosition},_.prototype._setActualPosition=function(e){r.Z.clone(e,this._actualPosition),E(this,g)};const D=new s.Z;_._computeActualPosition=function(e,t,n){return t.mode===m.Z.SCENE3D?e:(d.Z.multiplyByPoint(n,e,D),f.Z.computeActualWgs84Position(t,D))};const P=new s.Z;_._computeScreenSpacePosition=function(e,t,n,i){const o=d.Z.multiplyByVector(e,s.Z.fromElements(t.x,t.y,t.z,1,P),P);return f.Z.wgs84ToWindowCoordinates(n,o,i)},_.prototype.computeScreenSpacePosition=function(e,t){const n=this._pointPrimitiveCollection;if((0,u.Z)(t)||(t=new o.Z),!(0,u.Z)(n))throw new l.Z("PointPrimitive must be in a collection.");if(!(0,u.Z)(e))throw new l.Z("scene is required.");const i=n.modelMatrix,r=_._computeScreenSpacePosition(i,this._actualPosition,e,t);if((0,u.Z)(r))return r.y=e.canvas.clientHeight-r.y,r},_.getScreenSpaceBoundingBox=function(e,t,n){const o=e.pixelSize,r=.5*o,s=t.x-r,a=t.y-r,c=o,l=o;return(0,u.Z)(n)||(n=new i.Z),n.x=s,n.y=a,n.width=c,n.height=l,n},_.prototype.equals=function(e){return this===e||(0,u.Z)(e)&&this._id===e._id&&r.Z.equals(this._position,e._position)&&a.Z.equals(this._color,e._color)&&this._pixelSize===e._pixelSize&&this._outlineWidth===e._outlineWidth&&this._show===e._show&&a.Z.equals(this._outlineColor,e._outlineColor)&&p.Z.equals(this._scaleByDistance,e._scaleByDistance)&&p.Z.equals(this._translucencyByDistance,e._translucencyByDistance)&&h.Z.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance},_.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._pointPrimitiveCollection=void 0};const I=_},9068:(e,t,n)=>{n.d(t,{Z:()=>te});var i=n(52351),o=n(6785),r=n(44990),s=n(88779),a=n(54485),c=n(90332),u=n(20176),l=n(88173),h=n(22874),d=n(71118),p=n(84473),m=n(95411),f=n(36627),_=n(85834),Z=n(71087),g=n(1577),y=n(74064),b=n(17426),S=n(7048),T=n(19695),C=n(53123),w=n(67380),v=n(995),x=n(12471),E=n(61588),D=n(18061);const P=E.Z.SHOW_INDEX,I=E.Z.POSITION_INDEX,R=E.Z.COLOR_INDEX,A=E.Z.OUTLINE_COLOR_INDEX,O=E.Z.OUTLINE_WIDTH_INDEX,L=E.Z.PIXEL_SIZE_INDEX,M=E.Z.SCALE_BY_DISTANCE_INDEX,N=E.Z.TRANSLUCENCY_BY_DISTANCE_INDEX,B=E.Z.DISTANCE_DISPLAY_CONDITION_INDEX,F=E.Z.DISABLE_DEPTH_DISTANCE_INDEX,z=E.Z.NUMBER_OF_PROPERTIES,k={positionHighAndSize:0,positionLowAndOutline:1,compressedAttribute0:2,compressedAttribute1:3,scaleByDistance:4,distanceDisplayConditionAndDisableDepth:5};function V(e){e=(0,s.Z)(e,s.Z.EMPTY_OBJECT),this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._pointPrimitives=[],this._pointPrimitivesToUpdate=[],this._pointPrimitivesToUpdateIndex=0,this._pointPrimitivesRemoved=!1,this._createVertexArray=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._propertiesChanged=new Uint32Array(z),this._maxPixelSize=1,this._baseVolume=new i.Z,this._baseVolumeWC=new i.Z,this._baseVolume2D=new i.Z,this._boundingVolume=new i.Z,this._boundingVolumeDirty=!1,this._colorCommands=[],this.show=(0,s.Z)(e.show,!0),this.modelMatrix=d.Z.clone((0,s.Z)(e.modelMatrix,d.Z.IDENTITY)),this._modelMatrix=d.Z.clone(d.Z.IDENTITY),this.debugShowBoundingVolume=(0,s.Z)(e.debugShowBoundingVolume,!1),this.blendOption=(0,s.Z)(e.blendOption,x.Z.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=D.Z.SCENE3D,this._maxTotalPointSize=1,this._buffersUsage=[f.Z.STATIC_DRAW,f.Z.STATIC_DRAW,f.Z.STATIC_DRAW,f.Z.STATIC_DRAW,f.Z.STATIC_DRAW,f.Z.STATIC_DRAW,f.Z.STATIC_DRAW,f.Z.STATIC_DRAW,f.Z.STATIC_DRAW];const t=this;this._uniforms={u_maxTotalPointSize:function(){return t._maxTotalPointSize}}}function U(e){const t=e.length;for(let n=0;n<t;++n)e[n]&&e[n]._destroy()}function H(e){if(e._pointPrimitivesRemoved){e._pointPrimitivesRemoved=!1;const t=[],n=e._pointPrimitives,i=n.length;for(let e=0,o=0;e<i;++e){const i=n[e];i&&(i._index=o++,t.push(i))}e._pointPrimitives=t}}Object.defineProperties(V.prototype,{length:{get:function(){return H(this),this._pointPrimitives.length}}}),V.prototype.add=function(e){const t=new E.Z(e,this);return t._index=this._pointPrimitives.length,this._pointPrimitives.push(t),this._createVertexArray=!0,t},V.prototype.remove=function(e){return!!this.contains(e)&&(this._pointPrimitives[e._index]=null,this._pointPrimitivesRemoved=!0,this._createVertexArray=!0,e._destroy(),!0)},V.prototype.removeAll=function(){U(this._pointPrimitives),this._pointPrimitives=[],this._pointPrimitivesToUpdate=[],this._pointPrimitivesToUpdateIndex=0,this._pointPrimitivesRemoved=!1,this._createVertexArray=!0},V.prototype._updatePointPrimitive=function(e,t){e._dirty||(this._pointPrimitivesToUpdate[this._pointPrimitivesToUpdateIndex++]=e),++this._propertiesChanged[t]},V.prototype.contains=function(e){return(0,a.Z)(e)&&e._pointPrimitiveCollection===this},V.prototype.get=function(e){if(!(0,a.Z)(e))throw new u.Z("index is required.");return H(this),this._pointPrimitives[e]},V.prototype.computeNewBuffersUsage=function(){const e=this._buffersUsage;let t=!1;const n=this._propertiesChanged;for(let i=0;i<z;++i){const o=0===n[i]?f.Z.STATIC_DRAW:f.Z.STREAM_DRAW;t=t||e[i]!==o,e[i]=o}return t};const W=new l.Z;function j(e,t,n,o){const r=o._index,s=o._getActualPosition();e._mode===D.Z.SCENE3D&&(i.Z.expand(e._baseVolume,s,e._baseVolume),e._boundingVolumeDirty=!0),l.Z.fromCartesian(s,W);const a=o.pixelSize,c=o.outlineWidth;e._maxPixelSize=Math.max(e._maxPixelSize,a+c);const u=n[k.positionHighAndSize],h=W.high;u(r,h.x,h.y,h.z,a);const d=n[k.positionLowAndOutline],p=W.low;d(r,p.x,p.y,p.z,c)}const G=65536,q=256;function $(e,t,n,i){const r=i._index,s=i.color,a=i.getPickId(t).color,c=i.outlineColor;let u=o.Z.floatToByte(s.red),l=o.Z.floatToByte(s.green),h=o.Z.floatToByte(s.blue);const d=u*G+l*q+h;u=o.Z.floatToByte(c.red),l=o.Z.floatToByte(c.green),h=o.Z.floatToByte(c.blue);const p=u*G+l*q+h;u=o.Z.floatToByte(a.red),l=o.Z.floatToByte(a.green),h=o.Z.floatToByte(a.blue);const m=u*G+l*q+h,f=o.Z.floatToByte(s.alpha)*G+o.Z.floatToByte(c.alpha)*q+o.Z.floatToByte(a.alpha);(0,n[k.compressedAttribute0])(r,d,p,m,f)}function Y(e,t,n,i){const o=i._index;let r=0,s=1,c=1,u=1;const l=i.translucencyByDistance;(0,a.Z)(l)&&(r=l.near,s=l.nearValue,c=l.far,u=l.farValue,1===s&&1===u||(e._shaderTranslucencyByDistance=!0));let d=i.show&&i.clusterShow;0===i.color.alpha&&0===i.outlineColor.alpha&&(d=!1),s=h.Z.clamp(s,0,1),s=1===s?255:255*s|0;const p=(d?1:0)*q+s;u=h.Z.clamp(u,0,1),u=1===u?255:255*u|0;const m=u;(0,n[k.compressedAttribute1])(o,p,m,r,c)}function Q(e,t,n,i){const o=i._index,r=n[k.scaleByDistance];let s=0,c=1,u=1,l=1;const h=i.scaleByDistance;(0,a.Z)(h)&&(s=h.near,c=h.nearValue,u=h.far,l=h.farValue,1===c&&1===l||(e._shaderScaleByDistance=!0)),r(o,s,c,u,l)}function X(e,t,n,i){const o=i._index,r=n[k.distanceDisplayConditionAndDisableDepth];let s=0,c=Number.MAX_VALUE;const u=i.distanceDisplayCondition;(0,a.Z)(u)&&(s=u.near,c=u.far,s*=s,c*=c,e._shaderDistanceDisplayCondition=!0);let l=i.disableDepthTestDistance;l*=l,l>0&&(e._shaderDisableDepthDistance=!0,l===Number.POSITIVE_INFINITY&&(l=-1)),r(o,s,c,l)}function K(e,t,n,i){j(e,0,n,i),$(0,t,n,i),Y(e,0,n,i),Q(e,0,n,i),X(e,0,n,i)}function J(e,t,n,o,r,s){let c;o.mode===D.Z.SCENE3D?(c=e._baseVolume,e._boundingVolumeDirty=!0):c=e._baseVolume2D;const u=[];for(let e=0;e<n;++e){const n=t[e],l=n.position,h=E.Z._computeActualPosition(l,o,r);(0,a.Z)(h)&&(n._setActualPosition(h),s?u.push(h):i.Z.expand(c,h,c))}s&&i.Z.fromPoints(u,c)}const ee=[];V.prototype.update=function(e){if(H(this),!this.show)return;this._maxTotalPointSize=_.Z.maximumAliasedPointSize,function(e,t){const n=t.mode,i=e._pointPrimitives,o=e._pointPrimitivesToUpdate,r=e._modelMatrix;e._createVertexArray||e._mode!==n||n!==D.Z.SCENE3D&&!d.Z.equals(r,e.modelMatrix)?(e._mode=n,d.Z.clone(e.modelMatrix,r),e._createVertexArray=!0,n!==D.Z.SCENE3D&&n!==D.Z.SCENE2D&&n!==D.Z.COLUMBUS_VIEW||J(e,i,i.length,t,r,!0)):n===D.Z.MORPHING?J(e,i,i.length,t,r,!0):n!==D.Z.SCENE2D&&n!==D.Z.COLUMBUS_VIEW||J(e,o,e._pointPrimitivesToUpdateIndex,t,r,!1)}(this,e);const t=this._pointPrimitives.length,n=this._pointPrimitivesToUpdate,o=this._pointPrimitivesToUpdateIndex,s=this._propertiesChanged,c=this._createVertexArray;let u;const l=e.context,h=e.passes,f=h.pick;if(c||!f&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(let e=0;e<z;++e)s[e]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),t>0){this._vaf=function(e,t,n){return new T.Z(e,[{index:k.positionHighAndSize,componentsPerAttribute:4,componentDatatype:r.Z.FLOAT,usage:n[I]},{index:k.positionLowAndShow,componentsPerAttribute:4,componentDatatype:r.Z.FLOAT,usage:n[I]},{index:k.compressedAttribute0,componentsPerAttribute:4,componentDatatype:r.Z.FLOAT,usage:n[R]},{index:k.compressedAttribute1,componentsPerAttribute:4,componentDatatype:r.Z.FLOAT,usage:n[N]},{index:k.scaleByDistance,componentsPerAttribute:4,componentDatatype:r.Z.FLOAT,usage:n[M]},{index:k.distanceDisplayConditionAndDisableDepth,componentsPerAttribute:3,componentDatatype:r.Z.FLOAT,usage:n[B]}],t)}(l,t,this._buffersUsage),u=this._vaf.writers;for(let e=0;e<t;++e){const t=this._pointPrimitives[e];t._dirty=!1,K(this,l,u,t)}this._vaf.commit()}this._pointPrimitivesToUpdateIndex=0}else if(o>0){const e=ee;e.length=0,(s[I]||s[O]||s[L])&&e.push(j),(s[R]||s[A])&&e.push($),(s[P]||s[N])&&e.push(Y),s[M]&&e.push(Q),(s[B]||s[F])&&e.push(X);const i=e.length;if(u=this._vaf.writers,o/t>.1){for(let t=0;t<o;++t){const o=n[t];o._dirty=!1;for(let t=0;t<i;++t)e[t](this,l,u,o)}this._vaf.commit()}else{for(let t=0;t<o;++t){const o=n[t];o._dirty=!1;for(let t=0;t<i;++t)e[t](this,l,u,o);this._vaf.subCommit(o._index,1)}this._vaf.endSubCommits()}this._pointPrimitivesToUpdateIndex=0}if(o>1.5*t&&(n.length=t),!(0,a.Z)(this._vaf)||!(0,a.Z)(this._vaf.va))return;let E;this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,i.Z.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));let V=d.Z.IDENTITY;e.mode===D.Z.SCENE3D?(V=this.modelMatrix,E=i.Z.clone(this._baseVolumeWC,this._boundingVolume)):E=i.Z.clone(this._baseVolume2D,this._boundingVolume),function(e,t,n){const i=t.camera.getPixelSize(n,t.context.drawingBufferWidth,t.context.drawingBufferHeight)*e._maxPixelSize;n.radius+=i}(this,e,E);const U=this._blendOption!==this.blendOption;let W,G,q,te,ne,ie;this._blendOption=this.blendOption,U&&(this._blendOption===x.Z.OPAQUE||this._blendOption===x.Z.OPAQUE_AND_TRANSLUCENT?this._rsOpaque=y.Z.fromCache({depthTest:{enabled:!0,func:m.Z.LEQUAL},depthMask:!0}):this._rsOpaque=void 0,this._blendOption===x.Z.TRANSLUCENT||this._blendOption===x.Z.OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=y.Z.fromCache({depthTest:{enabled:!0,func:m.Z.LEQUAL},depthMask:!1,blending:v.Z.ALPHA_BLEND}):this._rsTranslucent=void 0),this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||0!==e.minimumDisableDepthTestDistance,(U||this._shaderScaleByDistance&&!this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance&&!this._compiledShaderTranslucencyByDistance||this._shaderDistanceDisplayCondition&&!this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance)&&(W=new S.Z({sources:[w.Z]}),this._shaderScaleByDistance&&W.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&W.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderDistanceDisplayCondition&&W.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&W.defines.push("DISABLE_DEPTH_DISTANCE"),this._blendOption===x.Z.OPAQUE_AND_TRANSLUCENT&&(G=new S.Z({defines:["OPAQUE"],sources:[C.Z]}),this._sp=b.Z.replaceCache({context:l,shaderProgram:this._sp,vertexShaderSource:W,fragmentShaderSource:G,attributeLocations:k}),G=new S.Z({defines:["TRANSLUCENT"],sources:[C.Z]}),this._spTranslucent=b.Z.replaceCache({context:l,shaderProgram:this._spTranslucent,vertexShaderSource:W,fragmentShaderSource:G,attributeLocations:k})),this._blendOption===x.Z.OPAQUE&&(G=new S.Z({sources:[C.Z]}),this._sp=b.Z.replaceCache({context:l,shaderProgram:this._sp,vertexShaderSource:W,fragmentShaderSource:G,attributeLocations:k})),this._blendOption===x.Z.TRANSLUCENT&&(G=new S.Z({sources:[C.Z]}),this._spTranslucent=b.Z.replaceCache({context:l,shaderProgram:this._spTranslucent,vertexShaderSource:W,fragmentShaderSource:G,attributeLocations:k})),this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance);const oe=e.commandList;if(h.render||f){const e=this._colorCommands,t=this._blendOption===x.Z.OPAQUE,n=this._blendOption===x.Z.OPAQUE_AND_TRANSLUCENT;q=this._vaf.va,te=q.length,e.length=te;const i=n?2*te:te;for(ie=0;ie<i;++ie){const i=t||n&&ie%2==0;ne=e[ie],(0,a.Z)(ne)||(ne=e[ie]=new Z.Z),ne.primitiveType=p.Z.POINTS,ne.pass=i||!n?g.Z.OPAQUE:g.Z.TRANSLUCENT,ne.owner=this;const o=n?Math.floor(ie/2):ie;ne.boundingVolume=E,ne.modelMatrix=V,ne.shaderProgram=i?this._sp:this._spTranslucent,ne.uniformMap=this._uniforms,ne.vertexArray=q[o].va,ne.renderState=i?this._rsOpaque:this._rsTranslucent,ne.debugShowBoundingVolume=this.debugShowBoundingVolume,ne.pickId="v_pickColor",oe.push(ne)}}},V.prototype.isDestroyed=function(){return!1},V.prototype.destroy=function(){return this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),U(this._pointPrimitives),(0,c.Z)(this)};const te=V},95069:(e,t,n)=>{n.d(t,{Z:()=>C});var i=n(55993),o=n(52351),r=n(93517),s=n(6785),a=n(88779),c=n(54485),u=n(20176),l=n(51178),h=n(71118),d=n(5316),p=n(7063);function m(e,t){e=(0,a.Z)(e,a.Z.EMPTY_OBJECT),this._show=(0,a.Z)(e.show,!0),this._width=(0,a.Z)(e.width,1),this._loop=(0,a.Z)(e.loop,!1),this._distanceDisplayCondition=e.distanceDisplayCondition,this._material=e.material,(0,c.Z)(this._material)||(this._material=p.Z.fromType(p.Z.ColorType,{color:new s.Z(1,1,1,1)}));let n,u=e.positions;(0,c.Z)(u)||(u=[]),this._positions=u,this._actualPositions=(0,i.Z)(u,r.Z.equalsEpsilon),this._loop&&this._actualPositions.length>2&&(this._actualPositions===this._positions&&(this._actualPositions=u.slice()),this._actualPositions.push(r.Z.clone(this._actualPositions[0]))),this._length=this._actualPositions.length,this._id=e.id,(0,c.Z)(t)&&(n=h.Z.clone(t.modelMatrix)),this._modelMatrix=n,this._segments=d.Z.wrapLongitude(this._actualPositions,n),this._actualLength=void 0,this._propertiesChanged=new Uint32Array(S),this._polylineCollection=t,this._dirty=!1,this._pickId=void 0,this._boundingVolume=o.Z.fromPoints(this._actualPositions),this._boundingVolumeWC=o.Z.transform(this._boundingVolume,this._modelMatrix),this._boundingVolume2D=new o.Z}const f=m.POSITION_INDEX=0,_=m.SHOW_INDEX=1,Z=m.WIDTH_INDEX=2,g=m.MATERIAL_INDEX=3,y=m.POSITION_SIZE_INDEX=4,b=m.DISTANCE_DISPLAY_CONDITION=5,S=m.NUMBER_OF_PROPERTIES=6;function T(e,t){++e._propertiesChanged[t];const n=e._polylineCollection;(0,c.Z)(n)&&(n._updatePolyline(e,t),e._dirty=!0)}Object.defineProperties(m.prototype,{show:{get:function(){return this._show},set:function(e){if(!(0,c.Z)(e))throw new u.Z("value is required.");e!==this._show&&(this._show=e,T(this,_))}},positions:{get:function(){return this._positions},set:function(e){if(!(0,c.Z)(e))throw new u.Z("value is required.");let t=(0,i.Z)(e,r.Z.equalsEpsilon);this._loop&&t.length>2&&(t===e&&(t=e.slice()),t.push(r.Z.clone(t[0]))),this._actualPositions.length===t.length&&this._actualPositions.length===this._length||T(this,y),this._positions=e,this._actualPositions=t,this._length=t.length,this._boundingVolume=o.Z.fromPoints(this._actualPositions,this._boundingVolume),this._boundingVolumeWC=o.Z.transform(this._boundingVolume,this._modelMatrix,this._boundingVolumeWC),T(this,f),this.update()}},material:{get:function(){return this._material},set:function(e){if(!(0,c.Z)(e))throw new u.Z("material is required.");this._material!==e&&(this._material=e,T(this,g))}},width:{get:function(){return this._width},set:function(e){if(!(0,c.Z)(e))throw new u.Z("value is required.");e!==this._width&&(this._width=e,T(this,Z))}},loop:{get:function(){return this._loop},set:function(e){if(!(0,c.Z)(e))throw new u.Z("value is required.");if(e!==this._loop){let t=this._actualPositions;e?t.length>2&&!r.Z.equals(t[0],t[t.length-1])&&(t.length===this._positions.length&&(this._actualPositions=t=this._positions.slice()),t.push(r.Z.clone(t[0]))):t.length>2&&r.Z.equals(t[0],t[t.length-1])&&(t.length-1===this._positions.length?this._actualPositions=this._positions:t.pop()),this._loop=e,T(this,y)}}},id:{get:function(){return this._id},set:function(e){this._id=e,(0,c.Z)(this._pickId)&&(this._pickId.object.id=e)}},pickId:{get:function(){return this._pickId}},isDestroyed:{get:function(){return!(0,c.Z)(this._polylineCollection)}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if((0,c.Z)(e)&&e.far<=e.near)throw new u.Z("far distance must be greater than near distance.");l.Z.equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=l.Z.clone(e,this._distanceDisplayCondition),T(this,b))}}}),m.prototype.update=function(){let e=h.Z.IDENTITY;(0,c.Z)(this._polylineCollection)&&(e=this._polylineCollection.modelMatrix);const t=this._segments.positions.length,n=this._segments.lengths,i=this._propertiesChanged[f]>0||this._propertiesChanged[y]>0;if(h.Z.equals(e,this._modelMatrix)&&!i||(this._segments=d.Z.wrapLongitude(this._actualPositions,e),this._boundingVolumeWC=o.Z.transform(this._boundingVolume,e,this._boundingVolumeWC)),this._modelMatrix=h.Z.clone(e,this._modelMatrix),this._segments.positions.length!==t)T(this,y);else{const e=n.length;for(let t=0;t<e;++t)if(n[t]!==this._segments.lengths[t]){T(this,y);break}}},m.prototype.getPickId=function(e){return(0,c.Z)(this._pickId)||(this._pickId=e.createPickId({primitive:this,collection:this._polylineCollection,id:this._id})),this._pickId},m.prototype._clean=function(){this._dirty=!1;const e=this._propertiesChanged;for(let t=0;t<S-1;++t)e[t]=0},m.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._material=this._material&&this._material.destroy(),this._polylineCollection=void 0};const C=m},13830:(e,t,n)=>{n.d(t,{Z:()=>Pe});var i=n(52351),o=n(59015),r=n(93517),s=n(90868),a=n(66866),c=n(6785),u=n(51138),l=n(44990),h=n(88779),d=n(54485),p=n(90332),m=n(20176),f=n(88173),_=n(74834),Z=n(39172),g=n(3169),y=n(22874),b=n(71118),S=n(30445),T=n(21514),C=n(31328),w=n(36627),v=n(85834),x=n(71087),E=n(1577),D=n(74064),P=n(17426),I=n(7048),R=n(47334),A=n(46801),O=n(85975),L=n(53183),M=n(90564),N=n(98570),B=n(995),F=n(7063),z=n(95069),k=n(18061);const V=z.Z.SHOW_INDEX,U=z.Z.WIDTH_INDEX,H=z.Z.POSITION_INDEX,W=z.Z.MATERIAL_INDEX,j=z.Z.POSITION_SIZE_INDEX,G=z.Z.DISTANCE_DISPLAY_CONDITION,q=z.Z.NUMBER_OF_PROPERTIES,$={texCoordExpandAndBatchIndex:0,position3DHigh:1,position3DLow:2,position2DHigh:3,position2DLow:4,prevPosition3DHigh:5,prevPosition3DLow:6,prevPosition2DHigh:7,prevPosition2DLow:8,nextPosition3DHigh:9,nextPosition3DLow:10,nextPosition2DHigh:11,nextPosition2DLow:12};function Y(e){e=(0,h.Z)(e,h.Z.EMPTY_OBJECT),this.show=(0,h.Z)(e.show,!0),this.modelMatrix=b.Z.clone((0,h.Z)(e.modelMatrix,b.Z.IDENTITY)),this._modelMatrix=b.Z.clone(b.Z.IDENTITY),this.debugShowBoundingVolume=(0,h.Z)(e.debugShowBoundingVolume,!1),this._opaqueRS=void 0,this._translucentRS=void 0,this._colorCommands=[],this._polylinesUpdated=!1,this._polylinesRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(q),this._polylines=[],this._polylineBuckets={},this._positionBufferUsage={bufferUsage:w.Z.STATIC_DRAW,frameCount:0},this._mode=void 0,this._polylinesToUpdate=[],this._vertexArrays=[],this._positionBuffer=void 0,this._texCoordExpandAndBatchIndexBuffer=void 0,this._batchTable=void 0,this._createBatchTable=!1,this._useHighlightColor=!1,this._highlightColor=c.Z.clone(c.Z.WHITE);const t=this;this._uniformMap={u_highlightColor:function(){return t._highlightColor}}}Object.defineProperties(Y.prototype,{length:{get:function(){return se(this),this._polylines.length}}}),Y.prototype.add=function(e){const t=new z.Z(e,this);return t._index=this._polylines.length,this._polylines.push(t),this._createVertexArray=!0,this._createBatchTable=!0,t},Y.prototype.remove=function(e){if(this.contains(e)){if(this._polylinesRemoved=!0,this._createVertexArray=!0,this._createBatchTable=!0,(0,d.Z)(e._bucket)){const t=e._bucket;t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()}return e._destroy(),!0}return!1},Y.prototype.removeAll=function(){ae(this),ue(this),this._polylineBuckets={},this._polylinesRemoved=!1,this._polylines.length=0,this._polylinesToUpdate.length=0,this._createVertexArray=!0},Y.prototype.contains=function(e){return(0,d.Z)(e)&&e._polylineCollection===this},Y.prototype.get=function(e){if(!(0,d.Z)(e))throw new m.Z("index is required.");return se(this),this._polylines[e]};const Q=new f.Z,X=new s.Z,K=new o.Z;Y.prototype.update=function(e){if(se(this),0===this._polylines.length||!this.show)return;!function(e,t){const n=t.mode;e._mode===n&&b.Z.equals(e._modelMatrix,e.modelMatrix)||(e._mode=n,e._modelMatrix=b.Z.clone(e.modelMatrix),e._createVertexArray=!0)}(this,e);const t=e.context,n=e.mapProjection;let r,a=this._propertiesChanged;if(this._createBatchTable){if(0===v.Z.maximumVertexTextureImageUnits)throw new T.Z("Vertex texture fetch support is required to render polylines. The maximum number of vertex texture image units must be greater than zero.");!function(e,t){(0,d.Z)(e._batchTable)&&e._batchTable.destroy();const n=[{functionName:"batchTable_getWidthAndShow",componentDatatype:l.Z.UNSIGNED_BYTE,componentsPerAttribute:2},{functionName:"batchTable_getPickColor",componentDatatype:l.Z.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0},{functionName:"batchTable_getCenterHigh",componentDatatype:l.Z.FLOAT,componentsPerAttribute:3},{functionName:"batchTable_getCenterLowAndRadius",componentDatatype:l.Z.FLOAT,componentsPerAttribute:4},{functionName:"batchTable_getDistanceDisplayCondition",componentDatatype:l.Z.FLOAT,componentsPerAttribute:2}];e._batchTable=new N.Z(t,n,e._polylines.length)}(this,t),this._createBatchTable=!1}if(this._createVertexArray||function(e){let t=!1;const n=e._propertiesChanged,i=e._positionBufferUsage;n[H]?i.bufferUsage!==w.Z.STREAM_DRAW?(t=!0,i.bufferUsage=w.Z.STREAM_DRAW,i.frameCount=100):i.frameCount=100:i.bufferUsage!==w.Z.STATIC_DRAW&&(0===i.frameCount?(t=!0,i.bufferUsage=w.Z.STATIC_DRAW):i.frameCount--);return t}(this))ne(this,t,n);else if(this._polylinesUpdated){const i=this._polylinesToUpdate;if(this._mode!==k.Z.SCENE3D){const e=i.length;for(let t=0;t<e;++t)r=i[t],r.update()}if(a[j]||a[W])ne(this,t,n);else{const t=i.length,c=this._polylineBuckets;for(let u=0;u<t;++u){r=i[u],a=r._propertiesChanged;const t=r._bucket;let l=0;for(const e in c)if(c.hasOwnProperty(e)){if(c[e]===t){a[H]&&t.writeUpdate(l,r,this._positionBuffer,n);break}l+=c[e].lengthOfPositions}if((a[V]||a[U])&&this._batchTable.setBatchedAttribute(r._index,0,new o.Z(r._width,r._show)),this._batchTable.attributes.length>2){if(a[H]||a[j]){const t=e.mode===k.Z.SCENE2D?r._boundingVolume2D:r._boundingVolumeWC,n=f.Z.fromCartesian(t.center,Q),i=s.Z.fromElements(n.low.x,n.low.y,n.low.z,t.radius,X);this._batchTable.setBatchedAttribute(r._index,2,n.high),this._batchTable.setBatchedAttribute(r._index,3,i)}if(a[G]){const e=K;e.x=0,e.y=Number.MAX_VALUE;const t=r.distanceDisplayCondition;(0,d.Z)(t)&&(e.x=t.near,e.y=t.far),this._batchTable.setBatchedAttribute(r._index,4,e)}}r._clean()}}i.length=0,this._polylinesUpdated=!1}a=this._propertiesChanged;for(let e=0;e<q;++e)a[e]=0;let c=b.Z.IDENTITY;e.mode===k.Z.SCENE3D&&(c=this.modelMatrix);const h=e.passes,p=0!==e.morphTime;if((0,d.Z)(this._opaqueRS)&&this._opaqueRS.depthTest.enabled===p||(this._opaqueRS=D.Z.fromCache({depthMask:p,depthTest:{enabled:p}})),(0,d.Z)(this._translucentRS)&&this._translucentRS.depthTest.enabled===p||(this._translucentRS=D.Z.fromCache({blending:B.Z.ALPHA_BLEND,depthMask:!p,depthTest:{enabled:p}})),this._batchTable.update(e),h.render||h.pick){!function(e,t,n,o){const r=t.context,s=t.commandList,a=n.length;let c=0,l=!0;const h=e._vertexArrays,p=e.debugShowBoundingVolume,m=e._batchTable.getUniformMapCallback(),f=h.length;for(let _=0;_<f;++_){const f=h[_],Z=f.buckets,g=Z.length;for(let h=0;h<g;++h){const _=Z[h];let g=_.offset;const y=_.bucket.shaderProgram,b=_.bucket.polylines,S=b.length;let T,C,w,v,D=0;for(let h=0;h<S;++h){const Z=b[h],S=re(Z._material);if(S!==T){if((0,d.Z)(T)&&D>0){const t=C.isTranslucent();c>=a?(w=new x.Z({owner:e}),n.push(w)):w=n[c],++c,v=(0,u.Z)(m(C._uniforms),e._uniformMap),w.boundingVolume=i.Z.clone(J,w.boundingVolume),w.modelMatrix=o,w.shaderProgram=y,w.vertexArray=f.va,w.renderState=t?e._translucentRS:e._opaqueRS,w.pass=t?E.Z.TRANSLUCENT:E.Z.OPAQUE,w.debugShowBoundingVolume=p,w.pickId="v_pickColor",w.uniformMap=v,w.count=D,w.offset=g,g+=D,D=0,l=!0,s.push(w)}C=Z._material,C.update(r),T=S}const P=Z._locatorBuckets,I=P.length;for(let e=0;e<I;++e){const t=P[e];t.locator===_&&(D+=t.count)}let R;t.mode===k.Z.SCENE3D?R=Z._boundingVolumeWC:t.mode===k.Z.COLUMBUS_VIEW?R=Z._boundingVolume2D:t.mode===k.Z.SCENE2D?(0,d.Z)(Z._boundingVolume2D)&&(R=i.Z.clone(Z._boundingVolume2D,ee),R.center.x=0):(0,d.Z)(Z._boundingVolumeWC)&&(0,d.Z)(Z._boundingVolume2D)&&(R=i.Z.union(Z._boundingVolumeWC,Z._boundingVolume2D,ee)),l?(l=!1,i.Z.clone(R,J)):i.Z.union(R,J,J)}(0,d.Z)(T)&&D>0&&(c>=a?(w=new x.Z({owner:e}),n.push(w)):w=n[c],++c,v=(0,u.Z)(m(C._uniforms),e._uniformMap),w.boundingVolume=i.Z.clone(J,w.boundingVolume),w.modelMatrix=o,w.shaderProgram=y,w.vertexArray=f.va,w.renderState=C.isTranslucent()?e._translucentRS:e._opaqueRS,w.pass=C.isTranslucent()?E.Z.TRANSLUCENT:E.Z.OPAQUE,w.debugShowBoundingVolume=p,w.pickId="v_pickColor",w.uniformMap=v,w.count=D,w.offset=g,l=!0,s.push(w)),T=void 0}}n.length=c}(this,e,this._colorCommands,c)}};const J=new i.Z,ee=new i.Z;Y.prototype.isDestroyed=function(){return!1},Y.prototype.destroy=function(){return ce(this),ae(this),ue(this),this._batchTable=this._batchTable&&this._batchTable.destroy(),(0,p.Z)(this)};const te=[0,0,0];function ne(e,t,n){e._createVertexArray=!1,ae(e),ce(e),function(e){const t=e._mode,n=e._modelMatrix,i=e._polylineBuckets={},o=e._polylines,r=o.length;for(let e=0;e<r;++e){const r=o[e];if(r._actualPositions.length>1){r.update();const e=r.material;let o=i[e.type];(0,d.Z)(o)||(o=i[e.type]=new he(e,t,n)),o.addPolyline(r)}}}(e);const i=[[]];let o=i[0];const r=e._batchTable,s=e._useHighlightColor,a=[0];let c=0;const u=[[]];let h=0;const p=e._polylineBuckets;let m,f;for(m in p)p.hasOwnProperty(m)&&(f=p[m],f.updateShader(t,r,s),h+=f.lengthOfPositions);if(h>0){const s=e._mode,_=new Float32Array(6*h*3),g=new Float32Array(4*h);let b,S=0,T=0,v=0;for(m in p)if(p.hasOwnProperty(m)){f=p[m],f.write(_,g,S,T,v,r,t,n),s===k.Z.MORPHING&&((0,d.Z)(b)||(b=new Float32Array(6*h*3)),f.writeForMorph(b,S));const e=f.lengthOfPositions;S+=6*e*3,T+=4*e,v+=4*e,c=f.updateIndices(i,a,u,c)}const x=e._positionBufferUsage.bufferUsage,E=w.Z.STATIC_DRAW;let D;e._positionBuffer=C.Z.createVertexBuffer({context:t,typedArray:_,usage:x}),(0,d.Z)(b)&&(D=C.Z.createVertexBuffer({context:t,typedArray:b,usage:x})),e._texCoordExpandAndBatchIndexBuffer=C.Z.createVertexBuffer({context:t,typedArray:g,usage:E});const P=3*Float32Array.BYTES_PER_ELEMENT,I=4*Float32Array.BYTES_PER_ELEMENT;let R=0;const O=i.length;for(let n=0;n<O;++n)if(o=i[n],o.length>0){const i=new Uint16Array(o),r=C.Z.createIndexBuffer({context:t,typedArray:i,usage:w.Z.STATIC_DRAW,indexDatatype:Z.Z.UNSIGNED_SHORT});R+=a[n];const c=6*(n*(P*y.Z.SIXTY_FOUR_KILOBYTES)-R*P),h=P+c,d=P+h,p=P+d,m=P+p,f=P+m,_=n*(I*y.Z.SIXTY_FOUR_KILOBYTES)-R*I,g=[{index:$.position3DHigh,componentsPerAttribute:3,componentDatatype:l.Z.FLOAT,offsetInBytes:c,strideInBytes:6*P},{index:$.position3DLow,componentsPerAttribute:3,componentDatatype:l.Z.FLOAT,offsetInBytes:h,strideInBytes:6*P},{index:$.position2DHigh,componentsPerAttribute:3,componentDatatype:l.Z.FLOAT,offsetInBytes:c,strideInBytes:6*P},{index:$.position2DLow,componentsPerAttribute:3,componentDatatype:l.Z.FLOAT,offsetInBytes:h,strideInBytes:6*P},{index:$.prevPosition3DHigh,componentsPerAttribute:3,componentDatatype:l.Z.FLOAT,offsetInBytes:d,strideInBytes:6*P},{index:$.prevPosition3DLow,componentsPerAttribute:3,componentDatatype:l.Z.FLOAT,offsetInBytes:p,strideInBytes:6*P},{index:$.prevPosition2DHigh,componentsPerAttribute:3,componentDatatype:l.Z.FLOAT,offsetInBytes:d,strideInBytes:6*P},{index:$.prevPosition2DLow,componentsPerAttribute:3,componentDatatype:l.Z.FLOAT,offsetInBytes:p,strideInBytes:6*P},{index:$.nextPosition3DHigh,componentsPerAttribute:3,componentDatatype:l.Z.FLOAT,offsetInBytes:m,strideInBytes:6*P},{index:$.nextPosition3DLow,componentsPerAttribute:3,componentDatatype:l.Z.FLOAT,offsetInBytes:f,strideInBytes:6*P},{index:$.nextPosition2DHigh,componentsPerAttribute:3,componentDatatype:l.Z.FLOAT,offsetInBytes:m,strideInBytes:6*P},{index:$.nextPosition2DLow,componentsPerAttribute:3,componentDatatype:l.Z.FLOAT,offsetInBytes:f,strideInBytes:6*P},{index:$.texCoordExpandAndBatchIndex,componentsPerAttribute:4,componentDatatype:l.Z.FLOAT,vertexBuffer:e._texCoordExpandAndBatchIndexBuffer,offsetInBytes:_}];let b,S,T,v;s===k.Z.SCENE3D?(S=e._positionBuffer,b="vertexBuffer",T=te,v="value"):s===k.Z.SCENE2D||s===k.Z.COLUMBUS_VIEW?(S=te,b="value",T=e._positionBuffer,v="vertexBuffer"):(S=D,b="vertexBuffer",T=e._positionBuffer,v="vertexBuffer"),g[0][b]=S,g[1][b]=S,g[2][v]=T,g[3][v]=T,g[4][b]=S,g[5][b]=S,g[6][v]=T,g[7][v]=T,g[8][b]=S,g[9][b]=S,g[10][v]=T,g[11][v]=T;const x=new A.Z({context:t,attributes:g,indexBuffer:r});e._vertexArrays.push({va:x,buckets:u[n]})}}}function ie(e,t){return t instanceof R.Z?t.id:t}const oe=[];function re(e){const t=F.Z._uniformList[e.type],n=t.length;oe.length=2*n;let i=0;for(let o=0;o<n;++o){const n=t[o];oe[i]=n,oe[i+1]=e._uniforms[n](),i+=2}return`${e.type}:${JSON.stringify(oe,ie)}`}function se(e){if(e._polylinesRemoved){e._polylinesRemoved=!1;const t=[],n=[];let i,o=0;const r=e._polylines.length;for(let s=0;s<r;++s)i=e._polylines[s],i.isDestroyed||(i._index=o++,n.push(i),t.push(i));e._polylines=t,e._polylinesToUpdate=n}}function ae(e){const t=e._polylines,n=t.length;for(let e=0;e<n;++e)if(!t[e].isDestroyed){const n=t[e]._bucket;(0,d.Z)(n)&&(n.shaderProgram=n.shaderProgram&&n.shaderProgram.destroy())}}function ce(e){const t=e._vertexArrays.length;for(let n=0;n<t;++n)e._vertexArrays[n].va.destroy();e._vertexArrays.length=0}function ue(e){const t=e._polylines,n=t.length;for(let e=0;e<n;++e)t[e].isDestroyed||t[e]._destroy()}function le(e,t,n){this.count=e,this.offset=t,this.bucket=n}function he(e,t,n){this.polylines=[],this.lengthOfPositions=0,this.material=e,this.shaderProgram=void 0,this.mode=t,this.modelMatrix=n}function de(e){return r.Z.dot(r.Z.UNIT_X,e._boundingVolume.center)<0||e._boundingVolume.intersectPlane(S.Z.ORIGIN_ZX_PLANE)===g.Z.INTERSECTING}Y.prototype._updatePolyline=function(e,t){this._polylinesUpdated=!0,e._dirty||this._polylinesToUpdate.push(e),++this._propertiesChanged[t]},he.prototype.addPolyline=function(e){this.polylines.push(e),e._actualLength=this.getPolylinePositionsLength(e),this.lengthOfPositions+=e._actualLength,e._bucket=this},he.prototype.updateShader=function(e,t,n){if((0,d.Z)(this.shaderProgram))return;const i=["DISTANCE_DISPLAY_CONDITION"];n&&i.push("VECTOR_TILE"),-1!==this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)&&i.push("POLYLINE_DASH"),_.Z.isInternetExplorer()||i.push("CLIP_POLYLINE");const o=new I.Z({defines:i,sources:["varying vec4 v_pickColor;\n",this.material.shaderSource,L.Z]}),r=t.getVertexShaderCallback()(M.Z),s=new I.Z({defines:i,sources:[O.Z,r]});this.shaderProgram=P.Z.fromCache({context:e,vertexShaderSource:s,fragmentShaderSource:o,attributeLocations:$})},he.prototype.getPolylinePositionsLength=function(e){let t;if(this.mode===k.Z.SCENE3D||!de(e))return t=e._actualPositions.length,4*t-4;let n=0;const i=e._segments.lengths;t=i.length;for(let e=0;e<t;++e)n+=4*i[e]-4;return n};const pe=new r.Z,me=new r.Z,fe=new r.Z,_e=new r.Z,Ze=new s.Z,ge=new o.Z;he.prototype.write=function(e,t,n,i,o,a,u,l){const h=this.mode,p=l.ellipsoid.maximumRadius*y.Z.PI,m=this.polylines,_=m.length;for(let i=0;i<_;++i){const _=m[i],Z=_.width,g=_.show&&Z>0,y=_._index,b=this.getSegments(_,l),S=b.positions,T=b.lengths,C=S.length,w=_.getPickId(u).color;let v,x=0,E=0;for(let i=0;i<C;++i){0===i?_._loop?v=S[C-2]:(v=_e,r.Z.subtract(S[0],S[1],v),r.Z.add(S[0],v,v)):v=S[i-1],r.Z.clone(v,me),r.Z.clone(S[i],pe),i===C-1?_._loop?v=S[1]:(v=_e,r.Z.subtract(S[C-1],S[C-2],v),r.Z.add(S[C-1],v,v)):v=S[i+1],r.Z.clone(v,fe);const s=T[x];i===E+s&&(E+=s,++x);const a=i-E==0,c=i===E+T[x]-1;h===k.Z.SCENE2D&&(me.z=0,pe.z=0,fe.z=0),h!==k.Z.SCENE2D&&h!==k.Z.MORPHING||(a||c)&&p-Math.abs(pe.x)<1&&((pe.x<0&&me.x>0||pe.x>0&&me.x<0)&&r.Z.clone(pe,me),(pe.x<0&&fe.x>0||pe.x>0&&fe.x<0)&&r.Z.clone(pe,fe));const u=c?2:4;for(let r=a?2:0;r<u;++r){f.Z.writeElements(pe,e,n),f.Z.writeElements(me,e,n+6),f.Z.writeElements(fe,e,n+12);const s=r-2<0?-1:1;t[o]=i/(C-1),t[o+1]=r%2*2-1,t[o+2]=s,t[o+3]=y,n+=18,o+=4}}const D=Ze;D.x=c.Z.floatToByte(w.red),D.y=c.Z.floatToByte(w.green),D.z=c.Z.floatToByte(w.blue),D.w=c.Z.floatToByte(w.alpha);const P=ge;P.x=Z,P.y=g?1:0;const I=h===k.Z.SCENE2D?_._boundingVolume2D:_._boundingVolumeWC,R=f.Z.fromCartesian(I.center,Q),A=R.high,O=s.Z.fromElements(R.low.x,R.low.y,R.low.z,I.radius,X),L=K;L.x=0,L.y=Number.MAX_VALUE;const M=_.distanceDisplayCondition;(0,d.Z)(M)&&(L.x=M.near,L.y=M.far),a.setBatchedAttribute(y,0,P),a.setBatchedAttribute(y,1,D),a.attributes.length>2&&(a.setBatchedAttribute(y,2,A),a.setBatchedAttribute(y,3,O),a.setBatchedAttribute(y,4,L))}};const ye=new r.Z,be=new r.Z,Se=new r.Z,Te=new r.Z;he.prototype.writeForMorph=function(e,t){const n=this.modelMatrix,i=this.polylines,o=i.length;for(let s=0;s<o;++s){const o=i[s],a=o._segments.positions,c=o._segments.lengths,u=a.length;let l=0,h=0;for(let i=0;i<u;++i){let s;0===i?o._loop?s=a[u-2]:(s=Te,r.Z.subtract(a[0],a[1],s),r.Z.add(a[0],s,s)):s=a[i-1],s=b.Z.multiplyByPoint(n,s,be);const d=b.Z.multiplyByPoint(n,a[i],ye);let p;i===u-1?o._loop?p=a[1]:(p=Te,r.Z.subtract(a[u-1],a[u-2],p),r.Z.add(a[u-1],p,p)):p=a[i+1],p=b.Z.multiplyByPoint(n,p,Se);const m=c[l];i===h+m&&(h+=m,++l);const _=i-h==0,Z=i===h+c[l]-1?2:4;for(let n=_?2:0;n<Z;++n)f.Z.writeElements(d,e,t),f.Z.writeElements(s,e,t+6),f.Z.writeElements(p,e,t+12),t+=18}}};const Ce=new Array(1);he.prototype.updateIndices=function(e,t,n,i){let o=n.length-1,r=new le(0,i,this);n[o].push(r);let s=0,a=e[e.length-1],c=0;a.length>0&&(c=a[a.length-1]+1);const u=this.polylines,l=u.length;for(let h=0;h<l;++h){const l=u[h];let d;if(l._locatorBuckets=[],this.mode===k.Z.SCENE3D){d=Ce;const e=l._actualPositions.length;if(!(e>0))continue;d[0]=e}else d=l._segments.lengths;const p=d.length;if(p>0){let u=0;for(let h=0;h<p;++h){const p=d[h]-1;for(let h=0;h<p;++h)c+4>y.Z.SIXTY_FOUR_KILOBYTES&&(l._locatorBuckets.push({locator:r,count:u}),u=0,t.push(4),a=[],e.push(a),c=0,r.count=s,s=0,i=0,r=new le(0,0,this),n[++o]=[r]),a.push(c,c+2,c+1),a.push(c+1,c+2,c+3),u+=6,s+=6,i+=6,c+=4}l._locatorBuckets.push({locator:r,count:u}),c+4>y.Z.SIXTY_FOUR_KILOBYTES&&(t.push(0),a=[],e.push(a),c=0,r.count=s,i=0,s=0,r=new le(0,0,this),n[++o]=[r])}l._clean()}return r.count=s,i},he.prototype.getPolylineStartIndex=function(e){const t=this.polylines;let n=0;const i=t.length;for(let o=0;o<i;++o){const i=t[o];if(i===e)break;n+=i._actualLength}return n};const we={positions:void 0,lengths:void 0},ve=new Array(1),xe=new r.Z,Ee=new a.Z;let De;he.prototype.getSegments=function(e,t){let n=e._actualPositions;if(this.mode===k.Z.SCENE3D)return ve[0]=n.length,we.positions=n,we.lengths=ve,we;de(e)&&(n=e._segments.positions);const o=t.ellipsoid,s=[],a=this.modelMatrix,c=n.length;let u,l=xe;for(let e=0;e<c;++e)u=n[e],l=b.Z.multiplyByPoint(a,u,l),s.push(t.project(o.cartesianToCartographic(l,Ee)));if(s.length>0){e._boundingVolume2D=i.Z.fromPoints(s,e._boundingVolume2D);const t=e._boundingVolume2D.center;e._boundingVolume2D.center=new r.Z(t.z,t.x,t.y)}return we.positions=s,we.lengths=e._segments.lengths,we},he.prototype.writeUpdate=function(e,t,n,i){const o=this.mode,s=i.ellipsoid.maximumRadius*y.Z.PI;let a=t._actualLength;if(a){e+=this.getPolylineStartIndex(t);let c=De;const u=6*a*3;!(0,d.Z)(c)||c.length<u?c=De=new Float32Array(u):c.length>u&&(c=new Float32Array(c.buffer,0,u));const l=this.getSegments(t,i),h=l.positions,p=l.lengths;let m,_=0,Z=0,g=0;a=h.length;for(let e=0;e<a;++e){0===e?t._loop?m=h[a-2]:(m=_e,r.Z.subtract(h[0],h[1],m),r.Z.add(h[0],m,m)):m=h[e-1],r.Z.clone(m,me),r.Z.clone(h[e],pe),e===a-1?t._loop?m=h[1]:(m=_e,r.Z.subtract(h[a-1],h[a-2],m),r.Z.add(h[a-1],m,m)):m=h[e+1],r.Z.clone(m,fe);const n=p[Z];e===g+n&&(g+=n,++Z);const i=e-g==0,u=e===g+p[Z]-1;o===k.Z.SCENE2D&&(me.z=0,pe.z=0,fe.z=0),o!==k.Z.SCENE2D&&o!==k.Z.MORPHING||(i||u)&&s-Math.abs(pe.x)<1&&((pe.x<0&&me.x>0||pe.x>0&&me.x<0)&&r.Z.clone(pe,me),(pe.x<0&&fe.x>0||pe.x>0&&fe.x<0)&&r.Z.clone(pe,fe));const l=u?2:4;for(let e=i?2:0;e<l;++e)f.Z.writeElements(pe,c,_),f.Z.writeElements(me,c,_+6),f.Z.writeElements(fe,c,_+12),_+=18}n.copyFromArrayView(c,18*Float32Array.BYTES_PER_ELEMENT*e)}};const Pe=Y},69154:(e,t,n)=>{n.d(t,{Z:()=>p});var i=n(88779),o=n(74834),r=n(25225),s=n(73175),a=n(11103),c=n(85975),u=n(58466);let l=`${c.Z}\n${a.Z}`;const h=s.Z;function d(e){e=(0,i.Z)(e,i.Z.EMPTY_OBJECT);const t=(0,i.Z)(e.translucent,!0),n=d.VERTEX_FORMAT;this.material=void 0,this.translucent=t,this._vertexShaderSource=(0,i.Z)(e.vertexShaderSource,l),this._fragmentShaderSource=(0,i.Z)(e.fragmentShaderSource,h),this._renderState=u.Z.getDefaultRenderState(t,false,e.renderState),this._closed=false,this._vertexFormat=n}o.Z.isInternetExplorer()||(l=`#define CLIP_POLYLINE \n${l}`),Object.defineProperties(d.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}}),d.VERTEX_FORMAT=r.Z.POSITION_ONLY,d.prototype.getFragmentShaderSource=u.Z.prototype.getFragmentShaderSource,d.prototype.isTranslucent=u.Z.prototype.isTranslucent,d.prototype.getRenderState=u.Z.prototype.getRenderState;const p=d},11922:(e,t,n)=>{n.d(t,{Z:()=>f});var i=n(88779),o=n(54485),r=n(74834),s=n(25225),a=n(3159),c=n(85975),u=n(53183),l=n(58466),h=n(7063);let d=`${c.Z}\n${a.Z}`;const p=u.Z;function m(e){e=(0,i.Z)(e,i.Z.EMPTY_OBJECT);const t=(0,i.Z)(e.translucent,!0),n=m.VERTEX_FORMAT;this.material=(0,o.Z)(e.material)?e.material:h.Z.fromType(h.Z.ColorType),this.translucent=t,this._vertexShaderSource=(0,i.Z)(e.vertexShaderSource,d),this._fragmentShaderSource=(0,i.Z)(e.fragmentShaderSource,p),this._renderState=l.Z.getDefaultRenderState(t,false,e.renderState),this._closed=false,this._vertexFormat=n}r.Z.isInternetExplorer()||(d=`#define CLIP_POLYLINE \n${d}`),Object.defineProperties(m.prototype,{vertexShaderSource:{get:function(){let e=this._vertexShaderSource;return-1!==this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)&&(e=`#define POLYLINE_DASH\n${e}`),e}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}}),m.VERTEX_FORMAT=s.Z.POSITION_AND_ST,m.prototype.getFragmentShaderSource=l.Z.prototype.getFragmentShaderSource,m.prototype.isTranslucent=l.Z.prototype.isTranslucent,m.prototype.getRenderState=l.Z.prototype.getRenderState;const f=m},84260:(e,t,n)=>{n.d(t,{Z:()=>A});var i=n(23114),o=n(17497),r=n(6785),s=n(51138),a=n(93737),c=n(88779),u=n(54485),l=n(90332),h=n(20176),d=n(91166),p=n(67197),m=n(59434),f=n(27400),_=n(74064),Z=n(28696),g=n(7048),y=n(47334),b=n(92106),S=n(48867),T=n(91373),C=n(26330);function w(e){const t=(e=(0,c.Z)(e,c.Z.EMPTY_OBJECT)).fragmentShader,n=(0,c.Z)(e.textureScale,1),s=(0,c.Z)(e.pixelFormat,d.Z.RGBA);if(o.Z.typeOf.string("options.fragmentShader",t),o.Z.typeOf.number.greaterThan("options.textureScale",n,0),o.Z.typeOf.number.lessThanOrEquals("options.textureScale",n,1),!d.Z.isColorFormat(s))throw new h.Z("options.pixelFormat must be a color format.");this._fragmentShader=t,this._uniforms=e.uniforms,this._textureScale=n,this._forcePowerOfTwo=(0,c.Z)(e.forcePowerOfTwo,!1),this._sampleMode=(0,c.Z)(e.sampleMode,C.Z.NEAREST),this._pixelFormat=s,this._pixelDatatype=(0,c.Z)(e.pixelDatatype,f.Z.UNSIGNED_BYTE),this._clearColor=(0,c.Z)(e.clearColor,r.Z.BLACK),this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._idTexture=void 0,this._actualUniforms={},this._dirtyUniforms=[],this._texturesToRelease=[],this._texturesToCreate=[],this._texturePromise=void 0;const l=new m.Z;l.scissorTest={enabled:!0,rectangle:(0,u.Z)(e.scissorRectangle)?i.Z.clone(e.scissorRectangle):new i.Z},this._passState=l,this._ready=!1;let p=e.name;(0,u.Z)(p)||(p=(0,a.Z)()),this._name=p,this._logDepthChanged=void 0,this._useLogDepth=void 0,this._selectedIdTexture=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0,this._textureCache=void 0,this._index=void 0,this.enabled=!0,this._enabled=!0}Object.defineProperties(w.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},fragmentShader:{get:function(){return this._fragmentShader}},uniforms:{get:function(){return this._uniforms}},textureScale:{get:function(){return this._textureScale}},forcePowerOfTwo:{get:function(){return this._forcePowerOfTwo}},sampleMode:{get:function(){return this._sampleMode}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},clearColor:{get:function(){return this._clearColor}},scissorRectangle:{get:function(){return this._passState.scissorTest.rectangle}},outputTexture:{get:function(){if((0,u.Z)(this._textureCache)){const e=this._textureCache.getFramebuffer(this._name);if((0,u.Z)(e))return e.getColorTexture(0)}}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}});const v=/uniform\s+sampler2D\s+depthTexture/g;function x(e,t,n){const i=t[n];return("string"==typeof i||i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof ImageData)&&e._dirtyUniforms.push(n),{get:function(){return t[n]},set:function(i){const o=t[n];t[n]=i;const r=e._actualUniforms,s=r[n];(0,u.Z)(s)&&s!==o&&s instanceof y.Z&&!(0,u.Z)(e._textureCache.getStageByName(n))&&(e._texturesToRelease.push(s),delete r[n],delete r[`${n}Dimensions`]),o instanceof y.Z&&e._texturesToRelease.push(o),"string"==typeof i||i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof ImageData?e._dirtyUniforms.push(n):r[n]=i}}}function E(e,t){return function(){const n=e._actualUniforms[t];return"function"==typeof n?n():n}}function D(e,t){return function(){const n=e[t]();if((0,u.Z)(n))return n.dimensions}}function P(e,t){return function(n){e._texturesToCreate.push({name:t,source:n})}}function I(e,t){return function(){return e._textureCache.getOutputTexture(t)}}function R(e){(0,u.Z)(e._command)&&(e._command.shaderProgram=e._command.shaderProgram&&e._command.shaderProgram.destroy(),e._command=void 0),e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy();const t=e._textureCache;if(!(0,u.Z)(t))return;const n=e._uniforms,i=e._actualUniforms;for(const o in i)i.hasOwnProperty(o)&&i[o]instanceof y.Z&&((0,u.Z)(t.getStageByName(n[o]))||i[o].destroy(),e._dirtyUniforms.push(o))}w.prototype._isSupported=function(e){return!v.test(this._fragmentShader)||e.depthTexture},w.prototype.update=function(e,t){if(this.enabled===this._enabled||this.enabled||R(this),this._enabled=this.enabled,!this._enabled)return;if(this._logDepthChanged=t!==this._useLogDepth,this._useLogDepth=t,this._selectedDirty=function(e){let t=(0,u.Z)(e._selected)?e._selected.length:0;const n=(0,u.Z)(e._parentSelected)?e._parentSelected:0;let i=e._selected!==e._selectedShadow||t!==e._selectedLength;if(i=i||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength,(0,u.Z)(e._selected)&&(0,u.Z)(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):(0,u.Z)(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&(0,u.Z)(e._combinedSelected)){if(!(0,u.Z)(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(let n=0;n<t;++n)if(e._combinedSelected[n]!==e._combinedSelectedShadow[n])return!0}return i}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=(0,u.Z)(this._selected)?this._selected.length:0,this._parentSelectedLength=(0,u.Z)(this._parentSelected)?this._parentSelected.length:0,function(e,t){if(!e._selectedDirty)return;e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy(),e._selectedIdTexture=void 0;const n=e._combinedSelected;if(!(0,u.Z)(n))return;let i,o,s=0;const a=n.length;for(i=0;i<a;++i)o=n[i],(0,u.Z)(o.pickIds)?s+=o.pickIds.length:(0,u.Z)(o.pickId)&&++s;if(0===a||0===s){const n=new Uint8Array(4);return n[0]=255,n[1]=255,n[2]=255,n[3]=255,void(e._selectedIdTexture=new y.Z({context:t,pixelFormat:d.Z.RGBA,pixelDatatype:f.Z.UNSIGNED_BYTE,source:{arrayBufferView:n,width:1,height:1},sampler:Z.Z.NEAREST}))}let c,l=0;const h=new Uint8Array(4*s);for(i=0;i<a;++i)if(o=n[i],(0,u.Z)(o.pickIds)){const e=o.pickIds,t=e.length;for(let n=0;n<t;++n)c=e[n].color,h[l]=r.Z.floatToByte(c.red),h[l+1]=r.Z.floatToByte(c.green),h[l+2]=r.Z.floatToByte(c.blue),h[l+3]=r.Z.floatToByte(c.alpha),l+=4}else(0,u.Z)(o.pickId)&&(c=o.pickId.color,h[l]=r.Z.floatToByte(c.red),h[l+1]=r.Z.floatToByte(c.green),h[l+2]=r.Z.floatToByte(c.blue),h[l+3]=r.Z.floatToByte(c.alpha),l+=4);e._selectedIdTexture=new y.Z({context:t,pixelFormat:d.Z.RGBA,pixelDatatype:f.Z.UNSIGNED_BYTE,source:{arrayBufferView:h,width:s,height:1},sampler:Z.Z.NEAREST})}(this,e),function(e){if((0,u.Z)(e._uniformMap))return;const t={},n={},i=e._uniforms,o=e._actualUniforms;for(const r in i)if(i.hasOwnProperty(r)){"function"!=typeof i[r]?(t[r]=E(e,r),n[r]=x(e,i,r)):(t[r]=i[r],n[r]=i[r]),o[r]=i[r];const s=t[r]();("string"==typeof s||s instanceof y.Z||s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement)&&(t[`${r}Dimensions`]=D(t,r))}e._uniforms={},Object.defineProperties(e._uniforms,n),e._uniformMap=(0,s.Z)(t,{colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions},depthTexture:function(){return e._depthTexture},depthTextureDimensions:function(){return e._depthTexture.dimensions},czm_idTexture:function(){return e._idTexture},czm_selectedIdTexture:function(){return e._selectedIdTexture},czm_selectedIdTextureStep:function(){return 1/e._selectedIdTexture.width}})}(this),function(e,t){let n,i,o;const r=e._texturesToRelease;let s=r.length;for(n=0;n<s;++n)i=r[n],i=i&&i.destroy();r.length=0;const a=e._texturesToCreate;for(s=a.length,n=0;n<s;++n){const i=a[n];o=i.name;const r=i.source;e._actualUniforms[o]=new y.Z({context:t,source:r})}a.length=0;const c=e._dirtyUniforms;if(0===c.length&&!(0,u.Z)(e._texturePromise))return void(e._ready=!0);if(0===c.length||(0,u.Z)(e._texturePromise))return;s=c.length;const l=e._uniforms,h=[];for(n=0;n<s;++n){o=c[n];const t=l[o],i=e._textureCache.getStageByName(t);if((0,u.Z)(i))e._actualUniforms[o]=I(e,t);else if("string"==typeof t){const n=new p.Z({url:t});h.push(n.fetchImage().then(P(e,o)))}else e._texturesToCreate.push({name:o,source:t})}c.length=0,h.length>0?(e._ready=!1,e._texturePromise=Promise.all(h).then((function(){e._ready=!0,e._texturePromise=void 0}))):e._ready=!0}(this,e),function(e,t){if((0,u.Z)(e._command)&&!e._logDepthChanged&&!e._selectedDirty)return;let n=e._fragmentShader;if((0,u.Z)(e._selectedIdTexture)){const t=e._selectedIdTexture.width;n=n.replace(/varying\s+vec2\s+v_textureCoordinates;/g,""),n=`#define CZM_SELECTED_FEATURE \nuniform sampler2D czm_idTexture; \nuniform sampler2D czm_selectedIdTexture; \nuniform float czm_selectedIdTextureStep; \nvarying vec2 v_textureCoordinates; \nbool czm_selected(vec2 offset) \n{ \n    bool selected = false;\n    vec4 id = texture2D(czm_idTexture, v_textureCoordinates + offset); \n    for (int i = 0; i < ${t}; ++i) \n    { \n        vec4 selectedId = texture2D(czm_selectedIdTexture, vec2((float(i) + 0.5) * czm_selectedIdTextureStep, 0.5)); \n        if (all(equal(id, selectedId))) \n        { \n            return true; \n        } \n    } \n    return false; \n} \n\nbool czm_selected() \n{ \n    return czm_selected(vec2(0.0)); \n} \n\n${n}`}const i=new g.Z({defines:[e._useLogDepth?"LOG_DEPTH":""],sources:[n]});e._command=t.createViewportQuadCommand(i,{uniformMap:e._uniformMap,owner:e})}(this,e),function(e){let t,n;e._sampleMode===C.Z.LINEAR?(t=S.Z.LINEAR,n=b.Z.LINEAR):(t=S.Z.NEAREST,n=b.Z.NEAREST);const i=e._sampler;(0,u.Z)(i)&&i.minificationFilter===t&&i.magnificationFilter===n||(e._sampler=new Z.Z({wrapS:T.Z.CLAMP_TO_EDGE,wrapT:T.Z.CLAMP_TO_EDGE,minificationFilter:t,magnificationFilter:n}))}(this),this._selectedDirty=!1,!this._ready)return;const n=this._textureCache.getFramebuffer(this._name);if(this._command.framebuffer=n,!(0,u.Z)(n))return;const o=n.getColorTexture(0);let a;o.width===e.drawingBufferWidth&&o.height===e.drawingBufferHeight||(a=this._renderState,(0,u.Z)(a)&&o.width===a.viewport.width&&o.height===a.viewport.height||(this._renderState=_.Z.fromCache({viewport:new i.Z(0,0,o.width,o.height)}))),this._command.renderState=a},w.prototype.execute=function(e,t,n,i){if(!((0,u.Z)(this._command)&&(0,u.Z)(this._command.framebuffer)&&this._ready&&this._enabled))return;this._colorTexture=t,this._depthTexture=n,this._idTexture=i,Z.Z.equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler);const o=this.scissorRectangle.width>0&&this.scissorRectangle.height>0?this._passState:void 0;(0,u.Z)(o)&&(o.context=e),this._command.execute(e,o)},w.prototype.isDestroyed=function(){return!1},w.prototype.destroy=function(){return R(this),(0,l.Z)(this)};const A=w},81684:(e,t,n)=>{n.d(t,{Z:()=>w});var i=n(35742),o=n(17497),r=n(54485),s=n(90332),a=n(20176),c=n(91166),u=n(27400),l=n(28696),h=n(47334),d=n(92106),p=n(48867),m=n(91373),f=n(2312),_=n(78474),Z=n(87421),g=n(83936);const y=[];function b(){const e=_.Z.createFXAAStage(),t=_.Z.createAmbientOcclusionStage(),n=_.Z.createBloomStage();this._autoExposureEnabled=!1,this._autoExposure=_.Z.createAutoExposureStage(),this._tonemapping=void 0,this._tonemapper=void 0,this.tonemapper=g.Z.ACES;const i=this._tonemapping;e.enabled=!1,t.enabled=!1,n.enabled=!1,i.enabled=!1;const o=new Z.Z(this),s={},a=y;for(a.push(e,t,n,i);a.length>0;){const e=a.pop();s[e.name]=e,e._textureCache=o;const t=e.length;if((0,r.Z)(t))for(let n=0;n<t;++n)a.push(e.get(n))}this._stages=[],this._activeStages=[],this._previousActiveStages=[],this._randomTexture=void 0;const c=this;t.uniforms.randomTexture=function(){return c._randomTexture},this._ao=t,this._bloom=n,this._fxaa=e,this._aoEnabled=void 0,this._bloomEnabled=void 0,this._tonemappingEnabled=void 0,this._fxaaEnabled=void 0,this._activeStagesChanged=!1,this._stagesRemoved=!1,this._textureCacheDirty=!1,this._stageNames=s,this._textureCache=o}function S(e){if(!e._stagesRemoved)return;e._stagesRemoved=!1;const t=[],n=e._stages,i=n.length;for(let e=0,o=0;e<i;++e){const i=n[e];i&&(i._index=o++,t.push(i))}e._stages=t}function T(e){for(;(0,r.Z)(e.length);)e=e.get(e.length-1);return e.outputTexture}function C(e,t,n,i,o){if((0,r.Z)(e.execute))return void e.execute(t,n,i,o);const s=e.length;let a;if(e.inputPreviousStageTexture)for(C(e.get(0),t,n,i,o),a=1;a<s;++a)C(e.get(a),t,T(e.get(a-1)),i,o);else for(a=0;a<s;++a)C(e.get(a),t,n,i,o)}Object.defineProperties(b.prototype,{ready:{get:function(){let e=!1;const t=this._stages;for(let n=t.length-1;n>=0;--n){const i=t[n];e=e||i.ready&&i.enabled}const n=this._fxaa,i=this._ao,o=this._bloom,r=this._tonemapping;return e=e||n.ready&&n.enabled,e=e||i.ready&&i.enabled,e=e||o.ready&&o.enabled,e=e||r.ready&&r.enabled,e}},fxaa:{get:function(){return this._fxaa}},ambientOcclusion:{get:function(){return this._ao}},bloom:{get:function(){return this._bloom}},length:{get:function(){return S(this),this._stages.length}},outputTexture:{get:function(){const e=this._fxaa;if(e.enabled&&e.ready)return this.getOutputTexture(e.name);const t=this._stages;for(let e=t.length-1;e>=0;--e){const n=t[e];if((0,r.Z)(n)&&n.ready&&n.enabled)return this.getOutputTexture(n.name)}const n=this._tonemapping;if(n.enabled&&n.ready)return this.getOutputTexture(n.name);const i=this._bloom;if(i.enabled&&i.ready)return this.getOutputTexture(i.name);const o=this._ao;return o.enabled&&o.ready?this.getOutputTexture(o.name):void 0}},hasSelected:{get:function(){const e=(0,i.Z)(this._stages);for(;e.length>0;){const t=e.pop();if(!(0,r.Z)(t))continue;if((0,r.Z)(t.selected))return!0;const n=t.length;if((0,r.Z)(n))for(let i=0;i<n;++i)e.push(t.get(i))}return!1}},tonemapper:{get:function(){return this._tonemapper},set:function(e){if(this._tonemapper===e)return;if(!g.Z.validate(e))throw new a.Z("tonemapper was set to an invalid value.");(0,r.Z)(this._tonemapping)&&(delete this._stageNames[this._tonemapping.name],this._tonemapping.destroy());const t=this._autoExposureEnabled;let n;switch(e){case g.Z.REINHARD:n=_.Z.createReinhardTonemappingStage(t);break;case g.Z.MODIFIED_REINHARD:n=_.Z.createModifiedReinhardTonemappingStage(t);break;case g.Z.FILMIC:n=_.Z.createFilmicTonemappingStage(t);break;default:n=_.Z.createAcesTonemappingStage(t)}if(t){const e=this._autoExposure;n.uniforms.autoExposure=function(){return e.outputTexture}}this._tonemapper=e,this._tonemapping=n,(0,r.Z)(this._stageNames)&&(this._stageNames[n.name]=n,n._textureCache=this._textureCache),this._textureCacheDirty=!0}}}),b.prototype.add=function(e){o.Z.typeOf.object("stage",e);const t=this._stageNames,n=y;for(n.push(e);n.length>0;){const e=n.pop();if((0,r.Z)(t[e.name]))throw new a.Z(`${e.name} has already been added to the collection or does not have a unique name.`);t[e.name]=e,e._textureCache=this._textureCache;const i=e.length;if((0,r.Z)(i))for(let t=0;t<i;++t)n.push(e.get(t))}const i=this._stages;return e._index=i.length,i.push(e),this._textureCacheDirty=!0,e},b.prototype.remove=function(e){if(!this.contains(e))return!1;const t=this._stageNames,n=y;for(n.push(e);n.length>0;){const e=n.pop();delete t[e.name];const i=e.length;if((0,r.Z)(i))for(let t=0;t<i;++t)n.push(e.get(t))}return this._stages[e._index]=void 0,this._stagesRemoved=!0,this._textureCacheDirty=!0,e._index=void 0,e._textureCache=void 0,e.destroy(),!0},b.prototype.contains=function(e){return(0,r.Z)(e)&&(0,r.Z)(e._index)&&e._textureCache===this._textureCache},b.prototype.get=function(e){S(this);const t=this._stages,n=t.length;return o.Z.typeOf.number.greaterThanOrEquals("stages length",n,0),o.Z.typeOf.number.greaterThanOrEquals("index",e,0),o.Z.typeOf.number.lessThan("index",e,n),t[e]},b.prototype.removeAll=function(){const e=this._stages,t=e.length;for(let n=0;n<t;++n)this.remove(e[n]);e.length=0},b.prototype.getStageByName=function(e){return this._stageNames[e]},b.prototype.update=function(e,t,n){S(this);const i=this._activeStages,o=this._activeStages=this._previousActiveStages;this._previousActiveStages=i;const s=this._stages;let a,f,_=o.length=s.length,Z=0;for(a=0;a<_;++a)f=s[a],f.ready&&f.enabled&&f._isSupported(e)&&(o[Z++]=f);o.length=Z;let g=Z!==i.length;if(!g)for(a=0;a<Z;++a)if(o[a]!==i[a]){g=!0;break}const y=this._ao,b=this._bloom,T=this._autoExposure,C=this._tonemapping,w=this._fxaa;C.enabled=n;const v=y.enabled&&y._isSupported(e),x=b.enabled&&b._isSupported(e),E=C.enabled&&C._isSupported(e),D=w.enabled&&w._isSupported(e);if((g||this._textureCacheDirty||v!==this._aoEnabled||x!==this._bloomEnabled||E!==this._tonemappingEnabled||D!==this._fxaaEnabled)&&(this._textureCache.updateDependencies(),this._aoEnabled=v,this._bloomEnabled=x,this._tonemappingEnabled=E,this._fxaaEnabled=D,this._textureCacheDirty=!1),(0,r.Z)(this._randomTexture)&&!v&&(this._randomTexture.destroy(),this._randomTexture=void 0),!(0,r.Z)(this._randomTexture)&&v){_=196608;const t=new Uint8Array(_);for(a=0;a<_;a+=3)t[a]=Math.floor(255*Math.random());this._randomTexture=new h.Z({context:e,pixelFormat:c.Z.RGB,pixelDatatype:u.Z.UNSIGNED_BYTE,source:{arrayBufferView:t,width:256,height:256},sampler:new l.Z({wrapS:m.Z.REPEAT,wrapT:m.Z.REPEAT,minificationFilter:p.Z.NEAREST,magnificationFilter:d.Z.NEAREST})})}for(this._textureCache.update(e),w.update(e,t),y.update(e,t),b.update(e,t),C.update(e,t),this._autoExposureEnabled&&T.update(e,t),_=s.length,a=0;a<_;++a)s[a].update(e,t);for(Z=0,a=0;a<_;++a)f=s[a],f.ready&&f.enabled&&f._isSupported(e)&&Z++;g=Z!==o.length,g&&this.update(e,t,n)},b.prototype.clear=function(e){this._textureCache.clear(e),this._autoExposureEnabled&&this._autoExposure.clear(e)},b.prototype.getOutputTexture=function(e){const t=this.getStageByName(e);if((0,r.Z)(t))return T(t)},b.prototype.execute=function(e,t,n,i){const o=this._activeStages,r=o.length,s=this._fxaa,a=this._ao,c=this._bloom,u=this._autoExposure,l=this._tonemapping,h=a.enabled&&a._isSupported(e),d=c.enabled&&c._isSupported(e),p=this._autoExposureEnabled,m=l.enabled&&l._isSupported(e),f=s.enabled&&s._isSupported(e);if(!(f||h||d||m||0!==r))return;let _=t;h&&a.ready&&(C(a,e,_,n,i),_=T(a)),d&&c.ready&&(C(c,e,_,n,i),_=T(c)),p&&u.ready&&C(u,e,_,n,i),m&&l.ready&&(C(l,e,_,n,i),_=T(l));let Z=_;if(r>0){C(o[0],e,_,n,i);for(let t=1;t<r;++t)C(o[t],e,T(o[t-1]),n,i);Z=T(o[r-1])}f&&s.ready&&C(s,e,Z,n,i)},b.prototype.copy=function(e,t){if(!(0,r.Z)(this._copyColorCommand)){const t=this;this._copyColorCommand=e.createViewportQuadCommand(f.Z,{uniformMap:{colorTexture:function(){return t.outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)},b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){return this._fxaa.destroy(),this._ao.destroy(),this._bloom.destroy(),this._autoExposure.destroy(),this._tonemapping.destroy(),this.removeAll(),this._textureCache=this._textureCache&&this._textureCache.destroy(),(0,s.Z)(this)};const w=b},51541:(e,t,n)=>{n.d(t,{Z:()=>u});var i=n(17497),o=n(93737),r=n(88779),s=n(54485),a=n(90332);function c(e){e=(0,r.Z)(e,r.Z.EMPTY_OBJECT),i.Z.defined("options.stages",e.stages),i.Z.typeOf.number.greaterThan("options.stages.length",e.stages.length,0),this._stages=e.stages,this._inputPreviousStageTexture=(0,r.Z)(e.inputPreviousStageTexture,!0);let t=e.name;(0,s.Z)(t)||(t=(0,o.Z)()),this._name=t,this._uniforms=e.uniforms,this._textureCache=void 0,this._index=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0}Object.defineProperties(c.prototype,{ready:{get:function(){const e=this._stages,t=e.length;for(let n=0;n<t;++n)if(!e[n].ready)return!1;return!0}},name:{get:function(){return this._name}},enabled:{get:function(){return this._stages[0].enabled},set:function(e){const t=this._stages,n=t.length;for(let i=0;i<n;++i)t[i].enabled=e}},uniforms:{get:function(){return this._uniforms}},inputPreviousStageTexture:{get:function(){return this._inputPreviousStageTexture}},length:{get:function(){return this._stages.length}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}}),c.prototype._isSupported=function(e){const t=this._stages,n=t.length;for(let i=0;i<n;++i)if(!t[i]._isSupported(e))return!1;return!0},c.prototype.get=function(e){return i.Z.typeOf.number.greaterThanOrEquals("index",e,0),i.Z.typeOf.number.lessThan("index",e,this.length),this._stages[e]},c.prototype.update=function(e,t){this._selectedDirty=function(e){let t=(0,s.Z)(e._selected)?e._selected.length:0;const n=(0,s.Z)(e._parentSelected)?e._parentSelected:0;let i=e._selected!==e._selectedShadow||t!==e._selectedLength;if(i=i||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength,(0,s.Z)(e._selected)&&(0,s.Z)(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):(0,s.Z)(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&(0,s.Z)(e._combinedSelected)){if(!(0,s.Z)(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(let n=0;n<t;++n)if(e._combinedSelected[n]!==e._combinedSelectedShadow[n])return!0}return i}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=(0,s.Z)(this._selected)?this._selected.length:0,this._parentSelectedLength=(0,s.Z)(this._parentSelected)?this._parentSelected.length:0;const n=this._stages,i=n.length;for(let o=0;o<i;++o){const i=n[o];this._selectedDirty&&(i.parentSelected=this._combinedSelected),i.update(e,t)}},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){const e=this._stages,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return(0,a.Z)(this)};const u=c},78474:(e,t,n)=>{n.d(t,{Z:()=>L});var i=n(25914),o=n(6785),r=n(93737),s=n(54485),a=n(99996),c=n(81802),u=n(73519),l=n(16836),h=n(91882),d=n(86311),p=n(61609),m=n(48461),f=n(31751),_=n(9957),Z=n(63832),g=n(92046),y=n(93709),b=n(9812),S=n(39979),T=n(32914),C=n(56695),w=n(13597),v=n(63042),x=n(64270),E=n(42315),D=n(84260),P=n(51541),I=n(26330);const R={};function A(e){const t=`#define USE_STEP_SIZE\n${b.Z}`,n=new D.Z({name:`${e}_x_direction`,fragmentShader:t,uniforms:{delta:1,sigma:2,stepSize:1,direction:0},sampleMode:I.Z.LINEAR}),i=new D.Z({name:`${e}_y_direction`,fragmentShader:t,uniforms:{delta:1,sigma:2,stepSize:1,direction:1},sampleMode:I.Z.LINEAR}),o={};return Object.defineProperties(o,{delta:{get:function(){return n.uniforms.delta},set:function(e){const t=n.uniforms,o=i.uniforms;t.delta=o.delta=e}},sigma:{get:function(){return n.uniforms.sigma},set:function(e){const t=n.uniforms,o=i.uniforms;t.sigma=o.sigma=e}},stepSize:{get:function(){return n.uniforms.stepSize},set:function(e){const t=n.uniforms,o=i.uniforms;t.stepSize=o.stepSize=e}}}),new P.Z({name:e,stages:[n,i],uniforms:o})}R.createBlurStage=function(){return A("czm_blur")},R.createDepthOfFieldStage=function(){const e=A("czm_depth_of_field_blur"),t=new D.Z({name:"czm_depth_of_field_composite",fragmentShader:f.Z,uniforms:{focalDistance:5,blurTexture:e.name}}),n={};return Object.defineProperties(n,{focalDistance:{get:function(){return t.uniforms.focalDistance},set:function(e){t.uniforms.focalDistance=e}},delta:{get:function(){return e.uniforms.delta},set:function(t){e.uniforms.delta=t}},sigma:{get:function(){return e.uniforms.sigma},set:function(t){e.uniforms.sigma=t}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(t){e.uniforms.stepSize=t}}}),new P.Z({name:"czm_depth_of_field",stages:[e,t],inputPreviousStageTexture:!1,uniforms:n})},R.isDepthOfFieldSupported=function(e){return e.context.depthTexture},R.createEdgeDetectionStage=function(){const e=(0,r.Z)();return new D.Z({name:`czm_edge_detection_${e}`,fragmentShader:Z.Z,uniforms:{length:.25,color:o.Z.clone(o.Z.BLACK)}})},R.isEdgeDetectionSupported=function(e){return e.context.depthTexture},R.createSilhouetteStage=function(e){const t=function(e){if(!(0,s.Z)(e))return R.createEdgeDetectionStage();const t=new P.Z({name:"czm_edge_detection_multiple",stages:e,inputPreviousStageTexture:!1}),n={};let i="",o="";for(let t=0;t<e.length;++t)i+=`uniform sampler2D edgeTexture${t}; \n`,o+=`        vec4 edge${t} = texture2D(edgeTexture${t}, v_textureCoordinates); \n        if (edge${t}.a > 0.0) \n        { \n            color = edge${t}; \n            break; \n        } \n`,n[`edgeTexture${t}`]=e[t].name;const r=`${i}varying vec2 v_textureCoordinates; \nvoid main() { \n    vec4 color = vec4(0.0); \n    for (int i = 0; i < ${e.length}; i++) \n    { \n${o}    } \n    gl_FragColor = color; \n} \n`,a=new D.Z({name:"czm_edge_detection_combine",fragmentShader:r,uniforms:n});return new P.Z({name:"czm_edge_detection_composite",stages:[t,a]})}(e),n=new D.Z({name:"czm_silhouette_color_edges",fragmentShader:v.Z,uniforms:{silhouetteTexture:t.name}});return new P.Z({name:"czm_silhouette",stages:[t,n],inputPreviousStageTexture:!1,uniforms:t.uniforms})},R.isSilhouetteSupported=function(e){return e.context.depthTexture},R.createBloomStage=function(){const e=new D.Z({name:"czm_bloom_contrast_bias",fragmentShader:m.Z,uniforms:{contrast:128,brightness:-.3}}),t=A("czm_bloom_blur"),n=new P.Z({name:"czm_bloom_contrast_bias_blur",stages:[e,t]}),i=new D.Z({name:"czm_bloom_generate_composite",fragmentShader:d.Z,uniforms:{glowOnly:!1,bloomTexture:n.name}}),o={};return Object.defineProperties(o,{glowOnly:{get:function(){return i.uniforms.glowOnly},set:function(e){i.uniforms.glowOnly=e}},contrast:{get:function(){return e.uniforms.contrast},set:function(t){e.uniforms.contrast=t}},brightness:{get:function(){return e.uniforms.brightness},set:function(t){e.uniforms.brightness=t}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},stepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}}}),new P.Z({name:"czm_bloom",stages:[n,i],inputPreviousStageTexture:!1,uniforms:o})},R.createAmbientOcclusionStage=function(){const e=new D.Z({name:"czm_ambient_occlusion_generate",fragmentShader:u.Z,uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1e3,randomTexture:void 0}}),t=A("czm_ambient_occlusion_blur");t.uniforms.stepSize=.86;const n=new P.Z({name:"czm_ambient_occlusion_generate_blur",stages:[e,t]}),i=new D.Z({name:"czm_ambient_occlusion_composite",fragmentShader:l.Z,uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:n.name}}),o={};return Object.defineProperties(o,{intensity:{get:function(){return e.uniforms.intensity},set:function(t){e.uniforms.intensity=t}},bias:{get:function(){return e.uniforms.bias},set:function(t){e.uniforms.bias=t}},lengthCap:{get:function(){return e.uniforms.lengthCap},set:function(t){e.uniforms.lengthCap=t}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(t){e.uniforms.stepSize=t}},frustumLength:{get:function(){return e.uniforms.frustumLength},set:function(t){e.uniforms.frustumLength=t}},randomTexture:{get:function(){return e.uniforms.randomTexture},set:function(t){e.uniforms.randomTexture=t}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},blurStepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}},ambientOcclusionOnly:{get:function(){return i.uniforms.ambientOcclusionOnly},set:function(e){i.uniforms.ambientOcclusionOnly=e}}}),new P.Z({name:"czm_ambient_occlusion",stages:[n,i],inputPreviousStageTexture:!1,uniforms:o})},R.isAmbientOcclusionSupported=function(e){return e.context.depthTexture};const O=`#define FXAA_QUALITY_PRESET 39 \n${x.Z}\n${y.Z}`;R.createFXAAStage=function(){return new D.Z({name:"czm_FXAA",fragmentShader:O,sampleMode:I.Z.LINEAR})},R.createAcesTonemappingStage=function(e){let t=e?"#define AUTO_EXPOSURE\n":"";return t+=c.Z,new D.Z({name:"czm_aces",fragmentShader:t,uniforms:{autoExposure:void 0}})},R.createFilmicTonemappingStage=function(e){let t=e?"#define AUTO_EXPOSURE\n":"";return t+=g.Z,new D.Z({name:"czm_filmic",fragmentShader:t,uniforms:{autoExposure:void 0}})},R.createReinhardTonemappingStage=function(e){let t=e?"#define AUTO_EXPOSURE\n":"";return t+=w.Z,new D.Z({name:"czm_reinhard",fragmentShader:t,uniforms:{autoExposure:void 0}})},R.createModifiedReinhardTonemappingStage=function(e){let t=e?"#define AUTO_EXPOSURE\n":"";return t+=T.Z,new D.Z({name:"czm_modified_reinhard",fragmentShader:t,uniforms:{white:o.Z.WHITE,autoExposure:void 0}})},R.createAutoExposureStage=function(){return new E.Z},R.createBlackAndWhiteStage=function(){return new D.Z({name:"czm_black_and_white",fragmentShader:h.Z,uniforms:{gradations:5}})},R.createBrightnessStage=function(){return new D.Z({name:"czm_brightness",fragmentShader:p.Z,uniforms:{brightness:.5}})},R.createNightVisionStage=function(){return new D.Z({name:"czm_night_vision",fragmentShader:C.Z})},R.createDepthViewStage=function(){return new D.Z({name:"czm_depth_view",fragmentShader:_.Z})},R.createLensFlareStage=function(){return new D.Z({name:"czm_lens_flare",fragmentShader:S.Z,uniforms:{dirtTexture:(0,i.Z)("Assets/Textures/LensFlare/DirtMask.jpg"),starTexture:(0,i.Z)("Assets/Textures/LensFlare/StarBurst.jpg"),intensity:2,distortion:10,ghostDispersal:.4,haloWidth:.4,dirtAmount:.4,earthRadius:a.Z.WGS84.maximumRadius}})};const L=R},26330:(e,t,n)=>{n.d(t,{Z:()=>i});const i={NEAREST:0,LINEAR:1}},87421:(e,t,n)=>{n.d(t,{Z:()=>_});var i=n(6785),o=n(54485),r=n(90332),s=n(22874),a=n(74366),c=n(37791);function u(e){this._collection=e,this._framebuffers=[],this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0,this._updateDependencies=!1}function l(e){for(;(0,o.Z)(e.length);)e=e.get(e.length-1);return e.name}function h(e,t,n,i,r){if(!i.enabled||!i._isSupported(t))return r;const s=n[i.name]={};if((0,o.Z)(r)){s[l(e.getStageByName(r))]=!0}const a=i.uniforms;if((0,o.Z)(a)){const t=Object.getOwnPropertyNames(a),n=t.length;for(let i=0;i<n;++i){const n=a[t[i]];if("string"==typeof n){const t=e.getStageByName(n);(0,o.Z)(t)&&(s[l(t)]=!0)}}}return i.name}function d(e,t,n,i,r){if((0,o.Z)(i.enabled)&&!i.enabled||(0,o.Z)(i._isSupported)&&!i._isSupported(t))return r;const s=r,a=!(0,o.Z)(i.inputPreviousStageTexture)||i.inputPreviousStageTexture;let c=r;const u=i.length;for(let s=0;s<u;++s){const u=i.get(s);c=(0,o.Z)(u.length)?d(e,t,n,u,r):h(e,t,n,u,r),a&&(r=c)}let p,m;if(a)for(p=1;p<u;++p)m=l(i.get(p)),(0,o.Z)(n[m])||(n[m]={}),n[m][s]=!0;else for(p=1;p<u;++p){m=l(i.get(p));const e=n[m];for(let t=0;t<p;++t)e[l(i.get(t))]=!0}return c}function p(e,t,n){const r=e._collection.getStageByName(t),s=r._textureScale,a=r._forcePowerOfTwo,u=r._pixelFormat,l=r._pixelDatatype,h=r._clearColor;let d,p;const m=e._framebuffers,f=m.length;for(d=0;d<f;++d){if(p=m[d],s!==p.textureScale||a!==p.forcePowerOfTwo||u!==p.pixelFormat||l!==p.pixelDatatype||!i.Z.equals(h,p.clearColor))continue;const e=p.stages,t=e.length;let o=!1;for(let i=0;i<t;++i)if(n[e[i]]){o=!0;break}if(!o)break}return(0,o.Z)(p)&&d<f?(p.stages.push(t),p):(p={textureScale:s,forcePowerOfTwo:a,pixelFormat:u,pixelDatatype:l,clearColor:h,stages:[t],buffer:new c.Z({pixelFormat:u,pixelDatatype:l}),clear:void 0},m.push(p),p)}function m(e,t){const n=function(e,t){const n={};if((0,o.Z)(e.ambientOcclusion)){const i=e.ambientOcclusion,o=e.bloom,r=e._tonemapping,s=e.fxaa;let a=d(e,t,n,i,void 0);a=d(e,t,n,o,a),a=h(e,t,n,r,a),a=d(e,t,n,e,a),h(e,t,n,s,a)}else d(e,t,n,e,void 0);return n}(e._collection,t);for(const t in n)n.hasOwnProperty(t)&&(e._stageNameToFramebuffer[t]=p(e,t,n[t]))}function f(e){const t=e._framebuffers,n=t.length;for(let e=0;e<n;++e){t[e].buffer.destroy()}}u.prototype.updateDependencies=function(){this._updateDependencies=!0},u.prototype.update=function(e){const t=this._collection,n=this._updateDependencies,i=(0,o.Z)(t.ambientOcclusion)&&t.ambientOcclusion.enabled&&t.ambientOcclusion._isSupported(e),r=(0,o.Z)(t.bloom)&&t.bloom.enabled&&t.bloom._isSupported(e),c=(0,o.Z)(t._tonemapping)&&t._tonemapping.enabled&&t._tonemapping._isSupported(e),u=(0,o.Z)(t.fxaa)&&t.fxaa.enabled&&t.fxaa._isSupported(e),l=!(0,o.Z)(t._activeStages)||t._activeStages.length>0||i||r||c||u;if((n||!l&&this._framebuffers.length>0)&&(f(this),this._framebuffers.length=0,this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0),!n&&!l)return;0===this._framebuffers.length&&m(this,e);const h=e.drawingBufferWidth,d=e.drawingBufferHeight,p=this._width!==h||this._height!==d;(n||p)&&(this._width=h,this._height=d,this._updateDependencies=!1,f(this),function(e,t){const n=e._width,i=e._height,o=e._framebuffers,r=o.length;for(let e=0;e<r;++e){const r=o[e],c=r.textureScale;let u=Math.ceil(n*c),l=Math.ceil(i*c),h=Math.min(u,l);r.forcePowerOfTwo&&(s.Z.isPowerOfTwo(h)||(h=s.Z.nextPowerOfTwo(h)),u=h,l=h),r.buffer.update(t,u,l),r.clear=new a.Z({color:r.clearColor,framebuffer:r.buffer.framebuffer})}}(this,e))},u.prototype.clear=function(e){const t=this._framebuffers;for(let n=0;n<t.length;++n)t[n].clear.execute(e)},u.prototype.getStageByName=function(e){return this._collection.getStageByName(e)},u.prototype.getOutputTexture=function(e){return this._collection.getOutputTexture(e)},u.prototype.getFramebuffer=function(e){const t=this._stageNameToFramebuffer[e];if((0,o.Z)(t))return t.buffer.framebuffer},u.prototype.isDestroyed=function(){return!1},u.prototype.destroy=function(){return f(this),(0,r.Z)(this)};const _=u},27401:(e,t,n)=>{n.d(t,{Z:()=>Pe});var i=n(52351),o=n(59015),r=n(93517),s=n(90868),a=n(66866),c=n(55077),u=n(6785),l=n(51138),h=n(44990),d=n(88779),p=n(58587),m=n(54485),f=n(90332),_=n(20176),Z=n(88173),g=n(74834),y=n(97845),b=n(94061),S=n(77683),T=n(97029),C=n(3169),w=n(71118),v=n(30445),x=n(21514),E=n(88597),D=n(7612),P=n(36627),I=n(85834),R=n(71087),A=n(1577),O=n(74064),L=n(17426),M=n(7048),N=n(46801),B=n(98570),F=n(28075),z=n(86672),k=n(22631),V=n(6739),U=n(18061),H=n(49616);function W(e){if(e=(0,d.Z)(e,d.Z.EMPTY_OBJECT),this.geometryInstances=e.geometryInstances,this.appearance=e.appearance,this._appearance=void 0,this._material=void 0,this.depthFailAppearance=e.depthFailAppearance,this._depthFailAppearance=void 0,this._depthFailMaterial=void 0,this.modelMatrix=w.Z.clone((0,d.Z)(e.modelMatrix,w.Z.IDENTITY)),this._modelMatrix=new w.Z,this.show=(0,d.Z)(e.show,!0),this._vertexCacheOptimize=(0,d.Z)(e.vertexCacheOptimize,!1),this._interleave=(0,d.Z)(e.interleave,!1),this._releaseGeometryInstances=(0,d.Z)(e.releaseGeometryInstances,!0),this._allowPicking=(0,d.Z)(e.allowPicking,!0),this._asynchronous=(0,d.Z)(e.asynchronous,!0),this._compressVertices=(0,d.Z)(e.compressVertices,!0),this.cull=(0,d.Z)(e.cull,!0),this.debugShowBoundingVolume=(0,d.Z)(e.debugShowBoundingVolume,!1),this.rtcCenter=e.rtcCenter,(0,m.Z)(this.rtcCenter)&&(!(0,m.Z)(this.geometryInstances)||Array.isArray(this.geometryInstances)&&1!==this.geometryInstances.length))throw new _.Z("Relative-to-center rendering only supports one geometry instance.");this.shadows=(0,d.Z)(e.shadows,H.Z.DISABLED),this._translucent=void 0,this._state=V.Z.READY,this._geometries=[],this._error=void 0,this._numberOfInstances=0,this._boundingSpheres=[],this._boundingSphereWC=[],this._boundingSphereCV=[],this._boundingSphere2D=[],this._boundingSphereMorph=[],this._perInstanceAttributeCache=[],this._instanceIds=[],this._lastPerInstanceAttributeIndex=0,this._va=[],this._attributeLocations=void 0,this._primitiveType=void 0,this._frontFaceRS=void 0,this._backFaceRS=void 0,this._sp=void 0,this._depthFailAppearance=void 0,this._spDepthFail=void 0,this._frontFaceDepthFailRS=void 0,this._backFaceDepthFailRS=void 0,this._pickIds=[],this._colorCommands=[],this._pickCommands=[],this._createBoundingVolumeFunction=e._createBoundingVolumeFunction,this._createRenderStatesFunction=e._createRenderStatesFunction,this._createShaderProgramFunction=e._createShaderProgramFunction,this._createCommandsFunction=e._createCommandsFunction,this._updateAndQueueCommandsFunction=e._updateAndQueueCommandsFunction,this._createPickOffsets=e._createPickOffsets,this._pickOffsets=void 0,this._createGeometryResults=void 0,this._ready=!1,this._readyPromise=(0,p.Z)(),this._batchTable=void 0,this._batchTableAttributeIndices=void 0,this._offsetInstanceExtend=void 0,this._batchTableOffsetAttribute2DIndex=void 0,this._batchTableOffsetsUpdated=!1,this._instanceBoundingSpheres=void 0,this._instanceBoundingSpheresCV=void 0,this._tempBoundingSpheres=void 0,this._recomputeBoundingSpheres=!1,this._batchTableBoundingSpheresUpdated=!1,this._batchTableBoundingSphereAttributeIndices=void 0}Object.defineProperties(W.prototype,{vertexCacheOptimize:{get:function(){return this._vertexCacheOptimize}},interleave:{get:function(){return this._interleave}},releaseGeometryInstances:{get:function(){return this._releaseGeometryInstances}},allowPicking:{get:function(){return this._allowPicking}},asynchronous:{get:function(){return this._asynchronous}},compressVertices:{get:function(){return this._compressVertices}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}});const j=new o.Z,G=new r.Z,q=new s.Z;function $(e){const t=e.length;return 1===t?e[0]:2===t?o.Z.unpack(e,0,j):3===t?r.Z.unpack(e,0,G):4===t?s.Z.unpack(e,0,q):void 0}function Y(e,t){const n=e.geometryInstances,i=Array.isArray(n)?n:[n],o=i.length;if(0===o)return;const r=function(e){const t=e.length,n=[],i=e[0].attributes;let o;for(o in i)if(i.hasOwnProperty(o)&&(0,m.Z)(i[o])){const r=i[o];let s=!0;for(let n=1;n<t;++n){const t=e[n].attributes[o];if(!(0,m.Z)(t)||r.componentDatatype!==t.componentDatatype||r.componentsPerAttribute!==t.componentsPerAttribute||r.normalize!==t.normalize){s=!1;break}}s&&n.push(o)}return n}(i),s=r.length,a=[],c={},l={};let p;let f,_,Z,g=i[0].attributes;for(f=0;f<s;++f)_=r[f],Z=g[_],c[_]=f,a.push({functionName:`czm_batchTable_${_}`,componentDatatype:Z.componentDatatype,componentsPerAttribute:Z.componentsPerAttribute,normalize:Z.normalize});-1!==r.indexOf("distanceDisplayCondition")&&(a.push({functionName:"czm_batchTable_boundingSphereCenter3DHigh",componentDatatype:h.Z.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter3DLow",componentDatatype:h.Z.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DHigh",componentDatatype:h.Z.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DLow",componentDatatype:h.Z.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereRadius",componentDatatype:h.Z.FLOAT,componentsPerAttribute:1}),l.center3DHigh=a.length-5,l.center3DLow=a.length-4,l.center2DHigh=a.length-3,l.center2DLow=a.length-2,l.radius=a.length-1),-1!==r.indexOf("offset")&&(a.push({functionName:"czm_batchTable_offset2D",componentDatatype:h.Z.FLOAT,componentsPerAttribute:3}),p=a.length-1),a.push({functionName:"czm_batchTable_pickColor",componentDatatype:h.Z.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0});const y=a.length,b=new B.Z(t,a,o);for(f=0;f<o;++f){const n=i[f];g=n.attributes;for(let e=0;e<s;++e){_=r[e],Z=g[_];const t=$(Z.value),n=c[_];b.setBatchedAttribute(f,n,t)}const o={primitive:(0,d.Z)(n.pickPrimitive,e)};(0,m.Z)(n.id)&&(o.id=n.id);const a=t.createPickId(o);e._pickIds.push(a);const l=a.color,h=q;h.x=u.Z.floatToByte(l.red),h.y=u.Z.floatToByte(l.green),h.z=u.Z.floatToByte(l.blue),h.w=u.Z.floatToByte(l.alpha),b.setBatchedAttribute(f,y-1,h)}e._batchTable=b,e._batchTableAttributeIndices=c,e._batchTableBoundingSphereAttributeIndices=l,e._batchTableOffsetAttribute2DIndex=p}function Q(e){let t;return t=Array.isArray(e.values)?e.values.slice(0):new e.values.constructor(e.values),new b.Z({componentDatatype:e.componentDatatype,componentsPerAttribute:e.componentsPerAttribute,normalize:e.normalize,values:t})}function X(e){const t=e.attributes,n=new S.Z;for(const e in t)t.hasOwnProperty(e)&&(0,m.Z)(t[e])&&(n[e]=Q(t[e]));let o;if((0,m.Z)(e.indices)){const t=e.indices;o=Array.isArray(t)?t.slice(0):new t.constructor(t)}return new y.Z({attributes:n,indices:o,primitiveType:e.primitiveType,boundingSphere:i.Z.clone(e.boundingSphere)})}function K(e,t){return{geometry:t,attributes:e.attributes,modelMatrix:w.Z.clone(e.modelMatrix),pickPrimitive:e.pickPrimitive,id:e.id}}const J=/attribute\s+vec(?:3|4)\s+(.*)3DHigh;/g;function ee(e){return`${M.Z.replaceMain(e,"czm_non_pick_main")}\nvarying vec4 v_pickColor; \nvoid main() \n{ \n    czm_non_pick_main(); \n    v_pickColor = czm_batchTable_pickColor(batchId); \n}`}function te(e){return`varying vec4 v_pickColor;\n${e}`}function ne(e,t){if(!e.compressVertices)return t;const n=-1!==t.search(/attribute\s+vec3\s+normal;/g),i=-1!==t.search(/attribute\s+vec2\s+st;/g);if(!n&&!i)return t;const o=-1!==t.search(/attribute\s+vec3\s+tangent;/g),r=-1!==t.search(/attribute\s+vec3\s+bitangent;/g);let s=i&&n?2:1;s+=o||r?1:0;const a="compressedAttributes",c=`attribute ${s>1?`vec${s}`:"float"} ${a};`;let u="",l="";if(i){u+="vec2 st;\n";l+=`    st = czm_decompressTextureCoordinates(${s>1?`${a}.x`:a});\n`}n&&o&&r?(u+="vec3 normal;\nvec3 tangent;\nvec3 bitangent;\n",l+=`    czm_octDecode(${a}.${i?"yz":"xy"}, normal, tangent, bitangent);\n`):(n&&(u+="vec3 normal;\n",l+=`    normal = czm_octDecode(${a}${s>1?"."+(i?"y":"x"):""});\n`),o&&(u+="vec3 tangent;\n",l+=`    tangent = czm_octDecode(${a}.${i&&n?"z":"y"});\n`),r&&(u+="vec3 bitangent;\n",l+=`    bitangent = czm_octDecode(${a}.${i&&n?"z":"y"});\n`));let h=t;h=h.replace(/attribute\s+vec3\s+normal;/g,""),h=h.replace(/attribute\s+vec2\s+st;/g,""),h=h.replace(/attribute\s+vec3\s+tangent;/g,""),h=h.replace(/attribute\s+vec3\s+bitangent;/g,""),h=M.Z.replaceMain(h,"czm_non_compressed_main");return[c,u,h,`void main() \n{ \n${l}    czm_non_compressed_main(); \n}`].join("\n")}function ie(e,t){const n=e.vertexAttributes;for(const e in n)if(n.hasOwnProperty(e)&&!(0,m.Z)(t[e]))throw new _.Z(`Appearance/Geometry mismatch.  The appearance requires vertex shader attribute input '${e}', which was not computed as part of the Geometry.  Use the appearance's vertexFormat property when constructing the geometry.`)}function oe(e,t){return function(){return e[t]}}W._modifyShaderPosition=function(e,t,n){let i,o="",r="",s="";for(;null!==(i=J.exec(t));){const a=i[1],c=`vec4 czm_compute${a[0].toUpperCase()}${a.substr(1)}()`;"vec4 czm_computePosition()"!==c&&(o+=`${c};\n`),(0,m.Z)(e.rtcCenter)?(o+="uniform mat4 u_modifiedModelView;\n",r+="attribute vec4 position;\n",s+=`${c}\n{\n    return u_modifiedModelView * position;\n}\n\n`,t=(t=(t=(t=t.replace(/attribute\s+vec(?:3|4)\s+position3DHigh;/g,"")).replace(/attribute\s+vec(?:3|4)\s+position3DLow;/g,"")).replace(/czm_modelViewRelativeToEye\s+\*\s+/g,"")).replace(/czm_modelViewProjectionRelativeToEye/g,"czm_projection")):n?s+=`${c}\n{\n    return czm_translateRelativeToEye(${a}3DHigh, ${a}3DLow);\n}\n\n`:(r+=`attribute vec3 ${a}2DHigh;\nattribute vec3 ${a}2DLow;\n`,s+=`${c}\n{\n    vec4 p;\n    if (czm_morphTime == 1.0)\n    {\n        p = czm_translateRelativeToEye(${a}3DHigh, ${a}3DLow);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        p = czm_translateRelativeToEye(${a}2DHigh.zxy, ${a}2DLow.zxy);\n    }\n    else\n    {\n        p = czm_columbusViewMorph(\n                czm_translateRelativeToEye(${a}2DHigh.zxy, ${a}2DLow.zxy),\n                czm_translateRelativeToEye(${a}3DHigh, ${a}3DLow),\n                czm_morphTime);\n    }\n    return p;\n}\n\n`)}return[o,r,t,s].join("\n")},W._appendShowToShader=function(e,t){if(!(0,m.Z)(e._batchTableAttributeIndices.show))return t;return`${M.Z.replaceMain(t,"czm_non_show_main")}\nvoid main() \n{ \n    czm_non_show_main(); \n    gl_Position *= czm_batchTable_show(batchId); \n}`},W._updateColorAttribute=function(e,t,n){if(!(0,m.Z)(e._batchTableAttributeIndices.color)&&!(0,m.Z)(e._batchTableAttributeIndices.depthFailColor))return t;if(-1===t.search(/attribute\s+vec4\s+color;/g))return t;if(n&&!(0,m.Z)(e._batchTableAttributeIndices.depthFailColor))throw new _.Z("A depthFailColor per-instance attribute is required when using a depth fail appearance that uses a color attribute.");let i=t;return i=i.replace(/attribute\s+vec4\s+color;/g,""),i=n?i.replace(/(\b)color(\b)/g,"$1czm_batchTable_depthFailColor(batchId)$2"):i.replace(/(\b)color(\b)/g,"$1czm_batchTable_color(batchId)$2"),i},W._updatePickColorAttribute=function(e){let t=e.replace(/attribute\s+vec4\s+pickColor;/g,"");return t=t.replace(/(\b)pickColor(\b)/g,"$1czm_batchTable_pickColor(batchId)$2"),t},W._appendOffsetToShader=function(e,t){if(!(0,m.Z)(e._batchTableAttributeIndices.offset))return t;let n="attribute float batchId;\n";n+="attribute float applyOffset;";let i=t.replace(/attribute\s+float\s+batchId;/g,"attribute float batchId;\nattribute float applyOffset;"),o="vec4 $1 = czm_computePosition();\n";return o+="    if (czm_sceneMode == czm_sceneMode3D)\n",o+="    {\n",o+="        $1 = $1 + vec4(czm_batchTable_offset(batchId) * applyOffset, 0.0);",o+="    }\n",o+="    else\n",o+="    {\n",o+="        $1 = $1 + vec4(czm_batchTable_offset2D(batchId) * applyOffset, 0.0);",o+="    }\n",i=i.replace(/vec4\s+([A-Za-z0-9_]+)\s+=\s+czm_computePosition\(\);/g,"vec4 $1 = czm_computePosition();\n    if (czm_sceneMode == czm_sceneMode3D)\n    {\n        $1 = $1 + vec4(czm_batchTable_offset(batchId) * applyOffset, 0.0);    }\n    else\n    {\n        $1 = $1 + vec4(czm_batchTable_offset2D(batchId) * applyOffset, 0.0);    }\n"),i},W._appendDistanceDisplayConditionToShader=function(e,t,n){if(!(0,m.Z)(e._batchTableAttributeIndices.distanceDisplayCondition))return t;let i="void main() \n{ \n    czm_non_distanceDisplayCondition_main(); \n    vec2 distanceDisplayCondition = czm_batchTable_distanceDisplayCondition(batchId);\n    vec3 boundingSphereCenter3DHigh = czm_batchTable_boundingSphereCenter3DHigh(batchId);\n    vec3 boundingSphereCenter3DLow = czm_batchTable_boundingSphereCenter3DLow(batchId);\n    float boundingSphereRadius = czm_batchTable_boundingSphereRadius(batchId);\n";return i+=n?"    vec4 centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n":"    vec3 boundingSphereCenter2DHigh = czm_batchTable_boundingSphereCenter2DHigh(batchId);\n    vec3 boundingSphereCenter2DLow = czm_batchTable_boundingSphereCenter2DLow(batchId);\n    vec4 centerRTE;\n    if (czm_morphTime == 1.0)\n    {\n        centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        centerRTE = czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy);\n    }\n    else\n    {\n        centerRTE = czm_columbusViewMorph(\n                czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy),\n                czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow),\n                czm_morphTime);\n    }\n",i+="    float radiusSq = boundingSphereRadius * boundingSphereRadius; \n    float distanceSq; \n    if (czm_sceneMode == czm_sceneMode2D) \n    { \n        distanceSq = czm_eyeHeight2D.y - radiusSq; \n    } \n    else \n    { \n        distanceSq = dot(centerRTE.xyz, centerRTE.xyz) - radiusSq; \n    } \n    distanceSq = max(distanceSq, 0.0); \n    float nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x; \n    float farSq = distanceDisplayCondition.y * distanceDisplayCondition.y; \n    float show = (distanceSq >= nearSq && distanceSq <= farSq) ? 1.0 : 0.0; \n    gl_Position *= show; \n}",`${M.Z.replaceMain(t,"czm_non_distanceDisplayCondition_main")}\n${i}`};const re=Math.max(g.Z.hardwareConcurrency-1,1);let se;const ae=new D.Z("combineGeometry");const ce=new Z.Z,ue=new a.Z,le=new r.Z,he=new i.Z;const de=new r.Z,pe=new r.Z;function me(e,t){if(!(0,m.Z)(e._batchTableAttributeIndices.offset)||e._batchTableOffsetsUpdated||t.scene3DOnly)return;const n=e._batchTableOffsetAttribute2DIndex,o=t.mapProjection,s=o.ellipsoid,a=e._batchTable,c=e._instanceBoundingSpheres,u=c.length;for(let t=0;t<u;++t){let u=c[t];if(!(0,m.Z)(u))continue;const l=a.getBatchedAttribute(t,e._batchTableAttributeIndices.offset);if(r.Z.equals(l,r.Z.ZERO)){a.setBatchedAttribute(t,n,r.Z.ZERO);continue}const h=e.modelMatrix;(0,m.Z)(h)&&(u=i.Z.transform(u,h,he));let d=u.center;d=s.scaleToGeodeticSurface(d,pe);let p=s.cartesianToCartographic(d,ue);const f=o.project(p,le),_=r.Z.add(l,d,de);p=s.cartesianToCartographic(_,p);const Z=o.project(p,de),g=r.Z.subtract(Z,f,de),y=g.x;g.x=g.z,g.z=g.y,g.y=y,a.setBatchedAttribute(t,n,g)}e._batchTableOffsetsUpdated=!0}function fe(e,t,n,i){let o,r=n.getRenderState();i?(o=(0,c.Z)(r,!1),o.cull={enabled:!0,face:F.Z.BACK},e._frontFaceRS=O.Z.fromCache(o),o.cull.face=F.Z.FRONT,e._backFaceRS=O.Z.fromCache(o)):(e._frontFaceRS=O.Z.fromCache(r),e._backFaceRS=e._frontFaceRS),o=(0,c.Z)(r,!1),(0,m.Z)(e._depthFailAppearance)&&(o.depthTest.enabled=!1),(0,m.Z)(e._depthFailAppearance)&&(r=e._depthFailAppearance.getRenderState(),o=(0,c.Z)(r,!1),o.depthTest.func=z.Z.GREATER,i?(o.cull={enabled:!0,face:F.Z.BACK},e._frontFaceDepthFailRS=O.Z.fromCache(o),o.cull.face=F.Z.FRONT,e._backFaceDepthFailRS=O.Z.fromCache(o)):(e._frontFaceDepthFailRS=O.Z.fromCache(o),e._backFaceDepthFailRS=e._frontFaceRS))}function _e(e,t,n){const i=t.context,o=e._attributeLocations;let r=e._batchTable.getVertexShaderCallback()(n.vertexShaderSource);r=W._appendOffsetToShader(e,r),r=W._appendShowToShader(e,r),r=W._appendDistanceDisplayConditionToShader(e,r,t.scene3DOnly),r=ee(r),r=W._updateColorAttribute(e,r,!1),r=ne(e,r),r=W._modifyShaderPosition(e,r,t.scene3DOnly);let s=n.getFragmentShaderSource();s=te(s),e._sp=L.Z.replaceCache({context:i,shaderProgram:e._sp,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:o}),ie(e._sp,o),(0,m.Z)(e._depthFailAppearance)&&(r=e._batchTable.getVertexShaderCallback()(e._depthFailAppearance.vertexShaderSource),r=W._appendShowToShader(e,r),r=W._appendDistanceDisplayConditionToShader(e,r,t.scene3DOnly),r=ee(r),r=W._updateColorAttribute(e,r,!0),r=ne(e,r),r=W._modifyShaderPosition(e,r,t.scene3DOnly),r=function(e){let t=M.Z.replaceMain(e,"czm_non_depth_clamp_main");return t+="void main() {\n    czm_non_depth_clamp_main();\n    gl_Position = czm_depthClamp(gl_Position);}\n",t}(r),s=e._depthFailAppearance.getFragmentShaderSource(),s=te(s),s=function(e){let t=M.Z.replaceMain(e,"czm_non_depth_clamp_main");return t+="void main() {\n    czm_non_depth_clamp_main();\n#if defined(GL_EXT_frag_depth)\n    #if defined(LOG_DEPTH)\n        czm_writeLogDepth();\n    #else\n        czm_writeDepthClamp();\n    #endif\n#endif\n}\n",t=`#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n${t}`,t}(s),e._spDepthFail=L.Z.replaceCache({context:i,shaderProgram:e._spDepthFail,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:o}),ie(e._spDepthFail,o))}const Ze=new w.Z,ge=new r.Z;function ye(e,t,n,i){const o=(0,m.Z)(n)?n._uniforms:void 0,r={},s=t.uniforms;if((0,m.Z)(s))for(const e in s)if(s.hasOwnProperty(e)){if((0,m.Z)(o)&&(0,m.Z)(o[e]))throw new _.Z(`Appearance and material have a uniform with the same name: ${e}`);r[e]=oe(s,e)}let a=(0,l.Z)(r,o);return a=e._batchTable.getUniformMapCallback()(a),(0,m.Z)(e.rtcCenter)&&(a.u_modifiedModelView=function(){const t=i.context.uniformState.view;return w.Z.multiply(t,e._modelMatrix,Ze),w.Z.multiplyByPoint(Ze,e.rtcCenter,ge),w.Z.setTranslation(Ze,ge,Ze),Ze}),a}function be(e,t,n,i,o,r,s,a){const c=ye(e,t,n,a);let u;(0,m.Z)(e._depthFailAppearance)&&(u=ye(e,e._depthFailAppearance,e._depthFailAppearance.material,a));const l=i?A.Z.TRANSLUCENT:A.Z.OPAQUE;let h=o?2:1;h*=(0,m.Z)(e._depthFailAppearance)?2:1,r.length=e._va.length*h;const d=r.length;let p=0;for(let t=0;t<d;++t){let n;o&&(n=r[t],(0,m.Z)(n)||(n=r[t]=new R.Z({owner:e,primitiveType:e._primitiveType})),n.vertexArray=e._va[p],n.renderState=e._backFaceRS,n.shaderProgram=e._sp,n.uniformMap=c,n.pass=l,++t),n=r[t],(0,m.Z)(n)||(n=r[t]=new R.Z({owner:e,primitiveType:e._primitiveType})),n.vertexArray=e._va[p],n.renderState=e._frontFaceRS,n.shaderProgram=e._sp,n.uniformMap=c,n.pass=l,(0,m.Z)(e._depthFailAppearance)&&(o&&(++t,n=r[t],(0,m.Z)(n)||(n=r[t]=new R.Z({owner:e,primitiveType:e._primitiveType})),n.vertexArray=e._va[p],n.renderState=e._backFaceDepthFailRS,n.shaderProgram=e._spDepthFail,n.uniformMap=u,n.pass=l),++t,n=r[t],(0,m.Z)(n)||(n=r[t]=new R.Z({owner:e,primitiveType:e._primitiveType})),n.vertexArray=e._va[p],n.renderState=e._frontFaceDepthFailRS,n.shaderProgram=e._spDepthFail,n.uniformMap=u,n.pass=l),++p}}function Se(e,t,n,i,o,r,s,a){if(t.mode!==U.Z.SCENE3D&&!w.Z.equals(o,w.Z.IDENTITY))throw new _.Z("Primitive.modelMatrix is only supported in 3D mode.");let c;W._updateBoundingVolumes(e,t,o),t.mode===U.Z.SCENE3D?c=e._boundingSphereWC:t.mode===U.Z.COLUMBUS_VIEW?c=e._boundingSphereCV:t.mode===U.Z.SCENE2D&&(0,m.Z)(e._boundingSphere2D)?c=e._boundingSphere2D:(0,m.Z)(e._boundingSphereMorph)&&(c=e._boundingSphereMorph);const u=t.commandList,l=t.passes;if(l.render||l.pick){const t=e.allowPicking,i=H.Z.castShadows(e.shadows),l=H.Z.receiveShadows(e.shadows),h=n.length;let d=a?2:1;d*=(0,m.Z)(e._depthFailAppearance)?2:1;for(let e=0;e<h;++e){const a=Math.floor(e/d),h=n[e];h.modelMatrix=o,h.boundingVolume=c[a],h.cull=r,h.debugShowBoundingVolume=s,h.castShadows=i,h.receiveShadows=l,h.pickId=t?"v_pickColor":void 0,u.push(h)}}}W._updateBoundingVolumes=function(e,t,n,o){let r,s,a;if(o||!w.Z.equals(n,e._modelMatrix))for(w.Z.clone(n,e._modelMatrix),s=e._boundingSpheres.length,r=0;r<s;++r)a=e._boundingSpheres[r],(0,m.Z)(a)&&(e._boundingSphereWC[r]=i.Z.transform(a,n,e._boundingSphereWC[r]),t.scene3DOnly||(e._boundingSphere2D[r]=i.Z.clone(e._boundingSphereCV[r],e._boundingSphere2D[r]),e._boundingSphere2D[r].center.x=0,e._boundingSphereMorph[r]=i.Z.union(e._boundingSphereWC[r],e._boundingSphereCV[r])));const c=e.appearance.pixelSize;if((0,m.Z)(c))for(s=e._boundingSpheres.length,r=0;r<s;++r){a=e._boundingSpheres[r];const n=e._boundingSphereWC[r],i=t.camera.getPixelSize(a,t.context.drawingBufferWidth,t.context.drawingBufferHeight)*c;n.radius=a.radius+i}},W.prototype.update=function(e){if(!(0,m.Z)(this.geometryInstances)&&0===this._va.length||(0,m.Z)(this.geometryInstances)&&Array.isArray(this.geometryInstances)&&0===this.geometryInstances.length||!(0,m.Z)(this.appearance)||e.mode!==U.Z.SCENE3D&&e.scene3DOnly||!e.passes.render&&!e.passes.pick)return;if((0,m.Z)(this._error))throw this._error;if((0,m.Z)(this.rtcCenter)&&!e.scene3DOnly)throw new _.Z("RTC rendering is only available for 3D only scenes.");if(this._state===V.Z.FAILED)return;const t=e.context;if((0,m.Z)(this._batchTable)||Y(this,t),this._batchTable.attributes.length>0){if(0===I.Z.maximumVertexTextureImageUnits)throw new x.Z("Vertex texture fetch support is required to render primitives with per-instance attributes. The maximum number of vertex texture image units must be greater than zero.");this._batchTable.update(e)}if(this._state!==V.Z.COMPLETE&&this._state!==V.Z.COMBINED&&(this.asynchronous?function(e,t){let n,i,o,r;const s=e._instanceIds;if(e._state===V.Z.READY){n=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances];const a=e._numberOfInstances=n.length,c=[];let u,l=[];for(o=0;o<a;++o){if(i=n[o].geometry,s.push(n[o].id),!(0,m.Z)(i._workerName))throw new _.Z("_workerName must be defined for asynchronous geometry.");l.push({moduleName:i._workerName,geometry:i})}if(!(0,m.Z)(se))for(se=new Array(re),o=0;o<re;o++)se[o]=new D.Z("createGeometry");for(l=(0,E.Z)(l,re),o=0;o<l.length;o++){let e=0;const t=l[o],n=t.length;for(r=0;r<n;++r)u=t[r],i=u.geometry,(0,m.Z)(i.constructor.pack)&&(u.offset=e,e+=(0,d.Z)(i.constructor.packedLength,i.packedLength));let s;if(e>0){const o=new Float64Array(e);for(s=[o.buffer],r=0;r<n;++r)u=t[r],i=u.geometry,(0,m.Z)(i.constructor.pack)&&(i.constructor.pack(i,o,u.offset),u.geometry=o)}c.push(se[o].scheduleTask({subTasks:l[o]},s))}e._state=V.Z.CREATING,Promise.all(c).then((function(t){e._createGeometryResults=t,e._state=V.Z.CREATED})).catch((function(n){De(e,t,V.Z.FAILED,n)}))}else if(e._state===V.Z.CREATED){const i=[];n=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances];const o=t.scene3DOnly,r=t.mapProjection,s=ae.scheduleTask(k.Z.packCombineGeometryParameters({createGeometryResults:e._createGeometryResults,instances:n,ellipsoid:r.ellipsoid,projection:r,elementIndexUintSupported:t.context.elementIndexUint,scene3DOnly:o,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e._createPickOffsets},i),i);e._createGeometryResults=void 0,e._state=V.Z.COMBINING,Promise.resolve(s).then((function(n){const i=k.Z.unpackCombineGeometryResults(n);e._geometries=i.geometries,e._attributeLocations=i.attributeLocations,e.modelMatrix=w.Z.clone(i.modelMatrix,e.modelMatrix),e._pickOffsets=i.pickOffsets,e._offsetInstanceExtend=i.offsetInstanceExtend,e._instanceBoundingSpheres=i.boundingSpheres,e._instanceBoundingSpheresCV=i.boundingSpheresCV,(0,m.Z)(e._geometries)&&e._geometries.length>0?(e._recomputeBoundingSpheres=!0,e._state=V.Z.COMBINED):De(e,t,V.Z.FAILED,void 0)})).catch((function(n){De(e,t,V.Z.FAILED,n)}))}}(this,e):function(e,t){const n=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances],i=e._numberOfInstances=n.length,o=new Array(i),r=e._instanceIds;let s,a,c=0;for(a=0;a<i;a++){s=n[a];const e=s.geometry;let t;t=(0,m.Z)(e.attributes)&&(0,m.Z)(e.primitiveType)?X(e):e.constructor.createGeometry(e),o[c++]=K(s,t),r.push(s.id)}o.length=c;const u=t.scene3DOnly,l=t.mapProjection,h=k.Z.combineGeometry({instances:o,ellipsoid:l.ellipsoid,projection:l,elementIndexUintSupported:t.context.elementIndexUint,scene3DOnly:u,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e._createPickOffsets});e._geometries=h.geometries,e._attributeLocations=h.attributeLocations,e.modelMatrix=w.Z.clone(h.modelMatrix,e.modelMatrix),e._pickOffsets=h.pickOffsets,e._offsetInstanceExtend=h.offsetInstanceExtend,e._instanceBoundingSpheres=h.boundingSpheres,e._instanceBoundingSpheresCV=h.boundingSpheresCV,(0,m.Z)(e._geometries)&&e._geometries.length>0?(e._recomputeBoundingSpheres=!0,e._state=V.Z.COMBINED):De(e,t,V.Z.FAILED,void 0)}(this,e)),this._state===V.Z.COMBINED&&(function(e,t){if(!(0,m.Z)(e._batchTableAttributeIndices.distanceDisplayCondition)||e._batchTableBoundingSpheresUpdated)return;const n=e._batchTableBoundingSphereAttributeIndices,o=n.center3DHigh,r=n.center3DLow,s=n.center2DHigh,a=n.center2DLow,c=n.radius,u=t.mapProjection,l=u.ellipsoid,h=e._batchTable,d=e._instanceBoundingSpheres,p=d.length;for(let n=0;n<p;++n){let p=d[n];if(!(0,m.Z)(p))continue;const f=e.modelMatrix;(0,m.Z)(f)&&(p=i.Z.transform(p,f,he));const _=p.center,g=p.radius;let y=Z.Z.fromCartesian(_,ce);if(h.setBatchedAttribute(n,o,y.high),h.setBatchedAttribute(n,r,y.low),!t.scene3DOnly){const e=l.cartesianToCartographic(_,ue),t=u.project(e,le);y=Z.Z.fromCartesian(t,ce),h.setBatchedAttribute(n,s,y.high),h.setBatchedAttribute(n,a,y.low)}h.setBatchedAttribute(n,c,g)}e._batchTableBoundingSpheresUpdated=!0}(this,e),me(this,e),function(e,t){const n=e._attributeLocations,o=e._geometries,r=t.scene3DOnly,s=t.context,a=[],c=o.length;for(let u=0;u<c;++u){const c=o[u];if(a.push(N.Z.fromGeometry({context:s,geometry:c,attributeLocations:n,bufferUsage:P.Z.STATIC_DRAW,interleave:e._interleave})),(0,m.Z)(e._createBoundingVolumeFunction))e._createBoundingVolumeFunction(t,c);else if(e._boundingSpheres.push(i.Z.clone(c.boundingSphere)),e._boundingSphereWC.push(new i.Z),!r){const t=c.boundingSphereCV.center,n=t.x,o=t.y,r=t.z;t.x=r,t.y=n,t.z=o,e._boundingSphereCV.push(i.Z.clone(c.boundingSphereCV)),e._boundingSphere2D.push(new i.Z),e._boundingSphereMorph.push(new i.Z)}}e._va=a,e._primitiveType=o[0].primitiveType,e.releaseGeometryInstances&&(e.geometryInstances=void 0),e._geometries=void 0,De(e,t,V.Z.COMPLETE,void 0)}(this,e)),!this.show||this._state!==V.Z.COMPLETE)return;this._batchTableOffsetsUpdated||me(this,e),this._recomputeBoundingSpheres&&function(e,t){const n=e._batchTableAttributeIndices.offset;if(!e._recomputeBoundingSpheres||!(0,m.Z)(n))return void(e._recomputeBoundingSpheres=!1);let o;const s=e._offsetInstanceExtend,a=e._instanceBoundingSpheres,c=a.length;let u=e._tempBoundingSpheres;if(!(0,m.Z)(u)){for(u=new Array(c),o=0;o<c;o++)u[o]=new i.Z;e._tempBoundingSpheres=u}for(o=0;o<c;++o){let t=u[o];const i=e._batchTable.getBatchedAttribute(o,n,new r.Z);t=a[o].clone(t),we(t,i,s[o])}const l=[],h=[],d=[];for(o=0;o<c;++o){const e=u[o];e.center.x-e.radius>0||i.Z.intersectPlane(e,v.Z.ORIGIN_ZX_PLANE)!==C.Z.INTERSECTING?l.push(e):(h.push(e),d.push(e))}let p=l[0],f=d[0],_=h[0];for(o=1;o<l.length;o++)p=i.Z.union(p,l[o]);for(o=1;o<d.length;o++)f=i.Z.union(f,d[o]);for(o=1;o<h.length;o++)_=i.Z.union(_,h[o]);const Z=[];for((0,m.Z)(p)&&Z.push(p),(0,m.Z)(f)&&Z.push(f),(0,m.Z)(_)&&Z.push(_),o=0;o<Z.length;o++){const n=Z[o].clone(e._boundingSpheres[o]);e._boundingSpheres[o]=n,e._boundingSphereCV[o]=i.Z.projectTo2D(n,t.mapProjection,e._boundingSphereCV[o])}W._updateBoundingVolumes(e,t,e.modelMatrix,!0),e._recomputeBoundingSpheres=!1}(this,e);const n=this.appearance,o=n.material;let s=!1,a=!1;this._appearance!==n?(this._appearance=n,this._material=o,s=!0,a=!0):this._material!==o&&(this._material=o,a=!0);const c=this.depthFailAppearance,u=(0,m.Z)(c)?c.material:void 0;this._depthFailAppearance!==c?(this._depthFailAppearance=c,this._depthFailMaterial=u,s=!0,a=!0):this._depthFailMaterial!==u&&(this._depthFailMaterial=u,a=!0);const l=this._appearance.isTranslucent();this._translucent!==l&&(this._translucent=l,s=!0),(0,m.Z)(this._material)&&this._material.update(t);const h=n.closed&&l;if(s){(0,d.Z)(this._createRenderStatesFunction,fe)(this,t,n,h)}if(a){(0,d.Z)(this._createShaderProgramFunction,_e)(this,e,n)}if(s||a){(0,d.Z)(this._createCommandsFunction,be)(this,n,o,l,h,this._colorCommands,this._pickCommands,e)}(0,d.Z)(this._updateAndQueueCommandsFunction,Se)(this,e,this._colorCommands,this._pickCommands,this.modelMatrix,this.cull,this.debugShowBoundingVolume,h)};const Te=new i.Z,Ce=new i.Z;function we(e,t,n){if(n===T.Z.TOP){const n=i.Z.clone(e,Te),o=i.Z.clone(e,Ce);o.center=r.Z.add(o.center,t,o.center),e=i.Z.union(n,o,e)}else n===T.Z.ALL&&(e.center=r.Z.add(e.center,t,e.center));return e}function ve(e,t,n){return function(){const i=e.getBatchedAttribute(t,n),o=e.attributes[n],r=o.componentsPerAttribute,s=h.Z.createTypedArray(o.componentDatatype,r);return(0,m.Z)(i.constructor.pack)?i.constructor.pack(i,s,0):s[0]=i,s}}function xe(e,t,n,i,o){return function(r){if(!(0,m.Z)(r)||!(0,m.Z)(r.length)||r.length<1||r.length>4)throw new _.Z("value must be and array with length between 1 and 4.");const s=$(r);e.setBatchedAttribute(t,n,s),"offset"===o&&(i._recomputeBoundingSpheres=!0,i._batchTableOffsetsUpdated=!1)}}const Ee=new r.Z;function De(e,t,n,i){e._error=i,e._state=n,t.afterRender.push((function(){e._ready=e._state===V.Z.COMPLETE||e._state===V.Z.FAILED,(0,m.Z)(i)?e._readyPromise.reject(i):e._readyPromise.resolve(e)}))}W.prototype.getGeometryInstanceAttributes=function(e){if(!(0,m.Z)(e))throw new _.Z("id is required");if(!(0,m.Z)(this._batchTable))throw new _.Z("must call update before calling getGeometryInstanceAttributes");let t=-1;const n=this._lastPerInstanceAttributeIndex,o=this._instanceIds,s=o.length;for(let i=0;i<s;++i){const r=(n+i)%s;if(e===o[r]){t=r;break}}if(-1===t)return;let a=this._perInstanceAttributeCache[t];if((0,m.Z)(a))return a;const c=this._batchTable,u=this._batchTableAttributeIndices;a={};const l={};for(const e in u)if(u.hasOwnProperty(e)){const n=u[e];l[e]={get:ve(c,t,n),set:xe(c,t,n,this,e)}}return function(e,t,n){t.boundingSphere={get:function(){let o=e._instanceBoundingSpheres[n];if((0,m.Z)(o)){o=o.clone();const s=e.modelMatrix,a=t.offset;(0,m.Z)(a)&&we(o,r.Z.fromArray(a.get(),0,Ee),e._offsetInstanceExtend[n]),(0,m.Z)(s)&&(o=i.Z.transform(o,s))}return o}},t.boundingSphereCV={get:function(){return e._instanceBoundingSpheresCV[n]}}}(this,l,t),function(e,t,n){t.pickId={get:function(){return e._pickIds[n]}}}(this,l,t),Object.defineProperties(a,l),this._lastPerInstanceAttributeIndex=t,this._perInstanceAttributeCache[t]=a,a},W.prototype.isDestroyed=function(){return!1},W.prototype.destroy=function(){let e,t;this._sp=this._sp&&this._sp.destroy(),this._spDepthFail=this._spDepthFail&&this._spDepthFail.destroy();const n=this._va;for(e=n.length,t=0;t<e;++t)n[t].destroy();this._va=void 0;const i=this._pickIds;for(e=i.length,t=0;t<e;++t)i[t].destroy();return this._pickIds=void 0,this._batchTable=this._batchTable&&this._batchTable.destroy(),this._instanceIds=void 0,this._perInstanceAttributeCache=void 0,this._attributeLocations=void 0,(0,f.Z)(this)};const Pe=W},87613:(e,t,n)=>{n.d(t,{Z:()=>l});var i=n(93737),o=n(88779),r=n(54485),s=n(90332),a=n(20176);function c(e){e=(0,o.Z)(e,o.Z.EMPTY_OBJECT),this._primitives=[],this._guid=(0,i.Z)(),this._zIndex=void 0,this.show=(0,o.Z)(e.show,!0),this.destroyPrimitives=(0,o.Z)(e.destroyPrimitives,!0)}function u(e,t){if(!e.contains(t))throw new a.Z("primitive is not in this collection.");return e._primitives.indexOf(t)}Object.defineProperties(c.prototype,{length:{get:function(){return this._primitives.length}}}),c.prototype.add=function(e,t){const n=(0,r.Z)(t);if(!(0,r.Z)(e))throw new a.Z("primitive is required.");if(n){if(t<0)throw new a.Z("index must be greater than or equal to zero.");if(t>this._primitives.length)throw new a.Z("index must be less than or equal to the number of primitives.")}const i=e._external=e._external||{};return(i._composites=i._composites||{})[this._guid]={collection:this},n?this._primitives.splice(t,0,e):this._primitives.push(e),e},c.prototype.remove=function(e){if(this.contains(e)){const t=this._primitives.indexOf(e);if(-1!==t)return this._primitives.splice(t,1),delete e._external._composites[this._guid],this.destroyPrimitives&&e.destroy(),!0}return!1},c.prototype.removeAndDestroy=function(e){const t=this.remove(e);return t&&!this.destroyPrimitives&&e.destroy(),t},c.prototype.removeAll=function(){const e=this._primitives,t=e.length;for(let n=0;n<t;++n)delete e[n]._external._composites[this._guid],this.destroyPrimitives&&e[n].destroy();this._primitives=[]},c.prototype.contains=function(e){return!!((0,r.Z)(e)&&e._external&&e._external._composites&&e._external._composites[this._guid])},c.prototype.raise=function(e){if((0,r.Z)(e)){const t=u(this,e),n=this._primitives;if(t!==n.length-1){const e=n[t];n[t]=n[t+1],n[t+1]=e}}},c.prototype.raiseToTop=function(e){if((0,r.Z)(e)){const t=u(this,e),n=this._primitives;t!==n.length-1&&(n.splice(t,1),n.push(e))}},c.prototype.lower=function(e){if((0,r.Z)(e)){const t=u(this,e),n=this._primitives;if(0!==t){const e=n[t];n[t]=n[t-1],n[t-1]=e}}},c.prototype.lowerToBottom=function(e){if((0,r.Z)(e)){const t=u(this,e),n=this._primitives;0!==t&&(n.splice(t,1),n.unshift(e))}},c.prototype.get=function(e){if(!(0,r.Z)(e))throw new a.Z("index is required.");return this._primitives[e]},c.prototype.update=function(e){if(!this.show)return;const t=this._primitives;for(let n=0;n<t.length;++n)t[n].update(e)},c.prototype.prePassesUpdate=function(e){const t=this._primitives;for(let n=0;n<t.length;++n){const i=t[n];(0,r.Z)(i.prePassesUpdate)&&i.prePassesUpdate(e)}},c.prototype.updateForPass=function(e,t){const n=this._primitives;for(let i=0;i<n.length;++i){const o=n[i];(0,r.Z)(o.updateForPass)&&o.updateForPass(e,t)}},c.prototype.postPassesUpdate=function(e){const t=this._primitives;for(let n=0;n<t.length;++n){const i=t[n];(0,r.Z)(i.postPassesUpdate)&&i.postPassesUpdate(e)}},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return this.removeAll(),(0,s.Z)(this)};const l=c},22631:(e,t,n)=>{n.d(t,{Z:()=>x});var i=n(52351),o=n(44990),r=n(88779),s=n(54485),a=n(20176),c=n(99996),u=n(64729),l=n(97845),h=n(94061),d=n(77683),p=n(45050),m=n(39172),f=n(71118),_=n(6206),Z=n(65412);function g(e,t){const n=e.attributes,i=n.position,r=i.values.length/i.componentsPerAttribute;n.batchId=new h.Z({componentDatatype:o.Z.FLOAT,componentsPerAttribute:1,values:new Float32Array(r)});const s=n.batchId.values;for(let e=0;e<r;++e)s[e]=t}function y(e){const t=e.instances,n=e.projection,r=e.elementIndexUintSupported,c=e.scene3DOnly,u=e.vertexCacheOptimize,l=e.compressVertices,h=e.modelMatrix;let d,m,_,Z=t.length;for(d=0;d<Z;++d)if((0,s.Z)(t[d].geometry)){_=t[d].geometry.primitiveType;break}for(d=1;d<Z;++d)if((0,s.Z)(t[d].geometry)&&t[d].geometry.primitiveType!==_)throw new a.Z("All instance geometries must have the same primitiveType.");if(function(e,t,n){let i=!n;const o=e.length;let r;if(!i&&o>1){const t=e[0].modelMatrix;for(r=1;r<o;++r)if(!f.Z.equals(t,e[r].modelMatrix)){i=!0;break}}if(i)for(r=0;r<o;++r)(0,s.Z)(e[r].geometry)&&p.Z.transformToWorldCoordinates(e[r]);else f.Z.multiplyTransformation(t,e[0].modelMatrix,t)}(t,h,c),!c)for(d=0;d<Z;++d)(0,s.Z)(t[d].geometry)&&p.Z.splitLongitude(t[d]);if(function(e){const t=e.length;for(let n=0;n<t;++n){const t=e[n];(0,s.Z)(t.geometry)?g(t.geometry,n):(0,s.Z)(t.westHemisphereGeometry)&&(0,s.Z)(t.eastHemisphereGeometry)&&(g(t.westHemisphereGeometry,n),g(t.eastHemisphereGeometry,n))}}(t),u)for(d=0;d<Z;++d){const e=t[d];(0,s.Z)(e.geometry)?(p.Z.reorderForPostVertexCache(e.geometry),p.Z.reorderForPreVertexCache(e.geometry)):(0,s.Z)(e.westHemisphereGeometry)&&(0,s.Z)(e.eastHemisphereGeometry)&&(p.Z.reorderForPostVertexCache(e.westHemisphereGeometry),p.Z.reorderForPreVertexCache(e.westHemisphereGeometry),p.Z.reorderForPostVertexCache(e.eastHemisphereGeometry),p.Z.reorderForPreVertexCache(e.eastHemisphereGeometry))}let y=p.Z.combineInstances(t);for(Z=y.length,d=0;d<Z;++d){m=y[d];const e=m.attributes;if(c)for(const t in e)e.hasOwnProperty(t)&&e[t].componentDatatype===o.Z.DOUBLE&&p.Z.encodeAttribute(m,t,`${t}3DHigh`,`${t}3DLow`);else for(const t in e)if(e.hasOwnProperty(t)&&e[t].componentDatatype===o.Z.DOUBLE){const e=`${t}3D`,o=`${t}2D`;p.Z.projectTo2D(m,t,e,o,n),(0,s.Z)(m.boundingSphere)&&"position"===t&&(m.boundingSphereCV=i.Z.fromVertices(m.attributes.position2D.values)),p.Z.encodeAttribute(m,e,`${e}High`,`${e}Low`),p.Z.encodeAttribute(m,o,`${o}High`,`${o}Low`)}l&&p.Z.compressVertices(m)}if(!r){let e=[];for(Z=y.length,d=0;d<Z;++d)m=y[d],e=e.concat(p.Z.fitToUnsignedShortIndices(m));y=e}return y}function b(e,t,n,i){let o,r,a;const c=i.length-1;if(c>=0){const e=i[c];o=e.offset+e.count,a=e.index,r=n[a].indices.length}else o=0,a=0,r=n[a].indices.length;const u=e.length;for(let c=0;c<u;++c){const u=e[c][t];if(!(0,s.Z)(u))continue;const l=u.indices.length;o+l>r&&(o=0,r=n[++a].indices.length),i.push({index:a,offset:o,count:l}),o+=l}}const S={};function T(e,t){const n=e.attributes;for(const e in n)if(n.hasOwnProperty(e)){const i=n[e];(0,s.Z)(i)&&(0,s.Z)(i.values)&&t.push(i.values.buffer)}(0,s.Z)(e.indices)&&t.push(e.indices.buffer)}function C(e,t){const n=e.length,i=new Float64Array(1+19*n);let o=0;i[o++]=n;for(let t=0;t<n;t++){const n=e[t];if(f.Z.pack(n.modelMatrix,i,o),o+=f.Z.packedLength,(0,s.Z)(n.attributes)&&(0,s.Z)(n.attributes.offset)){const e=n.attributes.offset.value;i[o]=e[0],i[o+1]=e[1],i[o+2]=e[2]}o+=3}return t.push(i.buffer),i}function w(e){const t=e.length,n=1+(i.Z.packedLength+1)*t,o=new Float32Array(n);let r=0;o[r++]=t;for(let n=0;n<t;++n){const t=e[n];(0,s.Z)(t)?(o[r++]=1,i.Z.pack(e[n],o,r)):o[r++]=0,r+=i.Z.packedLength}return o}function v(e){const t=new Array(e[0]);let n=0,o=1;for(;o<e.length;)1===e[o++]&&(t[n]=i.Z.unpack(e,o)),++n,o+=i.Z.packedLength;return t}S.combineGeometry=function(e){let t,n;const o=e.instances,r=o.length;let a,c,u=!1;r>0&&(t=y(e),t.length>0&&(n=p.Z.createAttributeLocations(t[0]),e.createPickOffsets&&(a=function(e,t){const n=[];return b(e,"geometry",t,n),b(e,"westHemisphereGeometry",t,n),b(e,"eastHemisphereGeometry",t,n),n}(o,t))),(0,s.Z)(o[0].attributes)&&(0,s.Z)(o[0].attributes.offset)&&(c=new Array(r),u=!0));const l=new Array(r),h=new Array(r);for(let e=0;e<r;++e){const t=o[e],n=t.geometry;(0,s.Z)(n)&&(l[e]=n.boundingSphere,h[e]=n.boundingSphereCV,u&&(c[e]=t.geometry.offsetAttribute));const r=t.eastHemisphereGeometry,a=t.westHemisphereGeometry;(0,s.Z)(r)&&(0,s.Z)(a)&&((0,s.Z)(r.boundingSphere)&&(0,s.Z)(a.boundingSphere)&&(l[e]=i.Z.union(r.boundingSphere,a.boundingSphere)),(0,s.Z)(r.boundingSphereCV)&&(0,s.Z)(a.boundingSphereCV)&&(h[e]=i.Z.union(r.boundingSphereCV,a.boundingSphereCV)))}return{geometries:t,modelMatrix:e.modelMatrix,attributeLocations:n,pickOffsets:a,offsetInstanceExtend:c,boundingSpheres:l,boundingSpheresCV:h}},S.packCreateGeometryResults=function(e,t){const n=new Float64Array(function(e){let t=1;const n=e.length;for(let o=0;o<n;o++){const n=e[o];if(++t,!(0,s.Z)(n))continue;const r=n.attributes;t+=7+2*i.Z.packedLength+((0,s.Z)(n.indices)?n.indices.length:0);for(const e in r)r.hasOwnProperty(e)&&(0,s.Z)(r[e])&&(t+=5+r[e].values.length)}return t}(e)),o=[],a={},c=e.length;let u=0;n[u++]=c;for(let t=0;t<c;t++){const c=e[t],l=(0,s.Z)(c);if(n[u++]=l?1:0,!l)continue;n[u++]=c.primitiveType,n[u++]=c.geometryType,n[u++]=(0,r.Z)(c.offsetAttribute,-1);const h=(0,s.Z)(c.boundingSphere)?1:0;n[u++]=h,h&&i.Z.pack(c.boundingSphere,n,u),u+=i.Z.packedLength;const d=(0,s.Z)(c.boundingSphereCV)?1:0;n[u++]=d,d&&i.Z.pack(c.boundingSphereCV,n,u),u+=i.Z.packedLength;const p=c.attributes,m=[];for(const e in p)p.hasOwnProperty(e)&&(0,s.Z)(p[e])&&(m.push(e),(0,s.Z)(a[e])||(a[e]=o.length,o.push(e)));n[u++]=m.length;for(let e=0;e<m.length;e++){const t=m[e],i=p[t];n[u++]=a[t],n[u++]=i.componentDatatype,n[u++]=i.componentsPerAttribute,n[u++]=i.normalize?1:0,n[u++]=i.values.length,n.set(i.values,u),u+=i.values.length}const f=(0,s.Z)(c.indices)?c.indices.length:0;n[u++]=f,f>0&&(n.set(c.indices,u),u+=f)}return t.push(n.buffer),{stringTable:o,packedData:n}},S.unpackCreateGeometryResults=function(e){const t=e.stringTable,n=e.packedData;let r;const s=new Array(n[0]);let a=0,c=1;for(;c<n.length;){if(!(1===n[c++])){s[a++]=void 0;continue}const e=n[c++],u=n[c++];let p,f,_=n[c++];-1===_&&(_=void 0);1===n[c++]&&(p=i.Z.unpack(n,c)),c+=i.Z.packedLength;let Z,g,y;1===n[c++]&&(f=i.Z.unpack(n,c)),c+=i.Z.packedLength;const b=new d.Z,S=n[c++];for(r=0;r<S;r++){const e=t[n[c++]],i=n[c++];y=n[c++];const r=0!==n[c++];Z=n[c++],g=o.Z.createTypedArray(i,Z);for(let e=0;e<Z;e++)g[e]=n[c++];b[e]=new h.Z({componentDatatype:i,componentsPerAttribute:y,normalize:r,values:g})}let T;if(Z=n[c++],Z>0){const e=g.length/y;for(T=m.Z.createTypedArray(e,Z),r=0;r<Z;r++)T[r]=n[c++]}s[a++]=new l.Z({primitiveType:e,geometryType:u,boundingSphere:p,boundingSphereCV:f,indices:T,attributes:b,offsetAttribute:_})}return s},S.packCombineGeometryParameters=function(e,t){const n=e.createGeometryResults,i=n.length;for(let e=0;e<i;e++)t.push(n[e].packedData.buffer);return{createGeometryResults:e.createGeometryResults,packedInstances:C(e.instances,t),ellipsoid:e.ellipsoid,isGeographic:e.projection instanceof u.Z,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e.createPickOffsets}},S.unpackCombineGeometryParameters=function(e){const t=function(e){const t=e,n=new Array(t[0]);let i=0,o=1;for(;o<t.length;){const e=f.Z.unpack(t,o);let r;o+=f.Z.packedLength,(0,s.Z)(t[o])&&(r={offset:new _.Z(t[o],t[o+1],t[o+2])}),o+=3,n[i++]={modelMatrix:e,attributes:r}}return n}(e.packedInstances),n=e.createGeometryResults,i=n.length;let o=0;for(let e=0;e<i;e++){const i=S.unpackCreateGeometryResults(n[e]),r=i.length;for(let e=0;e<r;e++){const n=i[e];t[o].geometry=n,++o}}const r=c.Z.clone(e.ellipsoid);return{instances:t,ellipsoid:r,projection:e.isGeographic?new u.Z(r):new Z.Z(r),elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:f.Z.clone(e.modelMatrix),createPickOffsets:e.createPickOffsets}},S.packCombineGeometryResults=function(e,t){(0,s.Z)(e.geometries)&&function(e,t){const n=e.length;for(let i=0;i<n;++i)T(e[i],t)}(e.geometries,t);const n=w(e.boundingSpheres),i=w(e.boundingSpheresCV);return t.push(n.buffer,i.buffer),{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:n,boundingSpheresCV:i}},S.unpackCombineGeometryResults=function(e){return{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:v(e.boundingSpheres),boundingSpheresCV:v(e.boundingSpheresCV)}};const x=S},6739:(e,t,n)=>{n.d(t,{Z:()=>i});const i=Object.freeze({READY:0,CREATING:1,CREATED:2,COMBINING:3,COMBINED:4,COMPLETE:5,FAILED:6})},87335:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(17497),o=n(88779),r=n(54485),s=n(36294);function a(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).propertyAttribute,n=e.class;i.Z.typeOf.object("options.propertyAttribute",t),i.Z.typeOf.object("options.class",n);const a={};if((0,r.Z)(t.properties))for(const e in t.properties)t.properties.hasOwnProperty(e)&&(a[e]=new s.Z({property:t.properties[e],classProperty:n.properties[e]}));this._name=e.name,this._id=e.id,this._class=n,this._properties=a,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(a.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},class:{get:function(){return this._class}},properties:{get:function(){return this._properties}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),a.prototype.getProperty=function(e){return i.Z.typeOf.string("propertyId",e),this._properties[e]}},36294:(e,t,n)=>{n.d(t,{Z:()=>s});var i=n(17497),o=n(88779),r=n(54485);function s(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).property,n=e.classProperty;i.Z.typeOf.object("options.property",t),i.Z.typeOf.object("options.classProperty",n),this._attribute=t.attribute,this._classProperty=n,this._min=t.min,this._max=t.max;let s=t.offset,a=t.scale;const c=n.hasValueTransform||(0,r.Z)(s)||(0,r.Z)(a);s=(0,o.Z)(s,n.offset),a=(0,o.Z)(a,n.scale),s=n.unpackVectorAndMatrixTypes(s),a=n.unpackVectorAndMatrixTypes(a),this._offset=s,this._scale=a,this._hasValueTransform=c,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(s.prototype,{attribute:{get:function(){return this._attribute}},hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}})},41184:(e,t,n)=>{n.d(t,{Z:()=>c});var i=n(17497),o=n(88779),r=n(54485);function s(e){e=(0,o.Z)(e,o.Z.EMPTY_OBJECT),i.Z.typeOf.number("options.count",e.count),this._name=e.name,this._id=e.id,this._count=e.count,this._extras=e.extras,this._extensions=e.extensions,this._metadataTable=e.metadataTable,this._jsonMetadataTable=e.jsonMetadataTable,this._batchTableHierarchy=e.batchTableHierarchy}Object.defineProperties(s.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},count:{get:function(){return this._count}},class:{get:function(){if((0,r.Z)(this._metadataTable))return this._metadataTable.class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),s.prototype.hasProperty=function(e,t){return i.Z.typeOf.number("index",e),i.Z.typeOf.string("propertyId",t),!(!(0,r.Z)(this._metadataTable)||!this._metadataTable.hasProperty(t))||(!(!(0,r.Z)(this._jsonMetadataTable)||!this._jsonMetadataTable.hasProperty(t))||!(!(0,r.Z)(this._batchTableHierarchy)||!this._batchTableHierarchy.hasProperty(e,t)))},s.prototype.hasPropertyBySemantic=function(e,t){return i.Z.typeOf.number("index",e),i.Z.typeOf.string("semantic",t),!!(0,r.Z)(this._metadataTable)&&this._metadataTable.hasPropertyBySemantic(t)},s.prototype.propertyExists=function(e){return i.Z.typeOf.string("propertyId",e),!(!(0,r.Z)(this._metadataTable)||!this._metadataTable.hasProperty(e))||(!(!(0,r.Z)(this._jsonMetadataTable)||!this._jsonMetadataTable.hasProperty(e))||!(!(0,r.Z)(this._batchTableHierarchy)||!this._batchTableHierarchy.propertyExists(e)))},s.prototype.propertyExistsBySemantic=function(e){return i.Z.typeOf.string("semantic",e),!!(0,r.Z)(this._metadataTable)&&this._metadataTable.hasPropertyBySemantic(e)};const a=[];s.prototype.getPropertyIds=function(e,t){return(t=(0,r.Z)(t)?t:[]).length=0,(0,r.Z)(this._metadataTable)&&t.push.apply(t,this._metadataTable.getPropertyIds(a)),(0,r.Z)(this._jsonMetadataTable)&&t.push.apply(t,this._jsonMetadataTable.getPropertyIds(a)),(0,r.Z)(this._batchTableHierarchy)&&t.push.apply(t,this._batchTableHierarchy.getPropertyIds(e,a)),t},s.prototype.getProperty=function(e,t){let n;return(0,r.Z)(this._metadataTable)&&(n=this._metadataTable.getProperty(e,t),(0,r.Z)(n))||(0,r.Z)(this._jsonMetadataTable)&&(n=this._jsonMetadataTable.getProperty(e,t),(0,r.Z)(n))||(0,r.Z)(this._batchTableHierarchy)&&(n=this._batchTableHierarchy.getProperty(e,t),(0,r.Z)(n))?n:void 0},s.prototype.setProperty=function(e,t,n){return!(!(0,r.Z)(this._metadataTable)||!this._metadataTable.setProperty(e,t,n))||(!(!(0,r.Z)(this._jsonMetadataTable)||!this._jsonMetadataTable.setProperty(e,t,n))||(0,r.Z)(this._batchTableHierarchy)&&this._batchTableHierarchy.setProperty(e,t,n))},s.prototype.getPropertyBySemantic=function(e,t){if((0,r.Z)(this._metadataTable))return this._metadataTable.getPropertyBySemantic(e,t)},s.prototype.setPropertyBySemantic=function(e,t,n){return!!(0,r.Z)(this._metadataTable)&&this._metadataTable.setPropertyBySemantic(e,t,n)},s.prototype.getPropertyTypedArray=function(e){if(i.Z.typeOf.string("propertyId",e),(0,r.Z)(this._metadataTable))return this._metadataTable.getPropertyTypedArray(e)},s.prototype.getPropertyTypedArrayBySemantic=function(e){if(i.Z.typeOf.string("semantic",e),(0,r.Z)(this._metadataTable))return this._metadataTable.getPropertyTypedArrayBySemantic(e)};const c=s},5512:(e,t,n)=>{n.d(t,{Z:()=>c});var i=n(17497),o=n(88779),r=n(54485),s=n(91057);function a(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).propertyTexture,n=e.class,a=e.textures;i.Z.typeOf.object("options.propertyTexture",t),i.Z.typeOf.object("options.class",n),i.Z.typeOf.object("options.textures",a);const c=t.extensions,u=t.extras,l={};if((0,r.Z)(t.properties))for(const e in t.properties)t.properties.hasOwnProperty(e)&&(l[e]=new s.Z({property:t.properties[e],classProperty:n.properties[e],textures:a}));this._name=e.name,this._id=e.id,this._class=n,this._properties=l,this._extras=u,this._extensions=c}Object.defineProperties(a.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},class:{get:function(){return this._class}},properties:{get:function(){return this._properties}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),a.prototype.getProperty=function(e){return i.Z.typeOf.string("propertyId",e),this._properties[e]};const c=a},91057:(e,t,n)=>{n.d(t,{Z:()=>d});var i=n(17497),o=n(88779),r=n(54485),s=n(76274),a=n(82837),c=n(76336);function u(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).property,n=e.classProperty,a=e.textures;i.Z.typeOf.object("options.property",t),i.Z.typeOf.object("options.classProperty",n),i.Z.typeOf.object("options.textures",a);const c=t,u=s.Z.createModelTextureReader({textureInfo:c,channels:(l=t.channels,l.map((function(e){return"rgba".charAt(e)})).join("")),texture:a[c.index]});var l;this._min=t.min,this._max=t.max;let h=t.offset,d=t.scale;const p=n.hasValueTransform||(0,r.Z)(h)||(0,r.Z)(d);h=(0,o.Z)(h,n.offset),d=(0,o.Z)(d,n.scale),h=n.unpackVectorAndMatrixTypes(h),d=n.unpackVectorAndMatrixTypes(d),this._offset=h,this._scale=d,this._hasValueTransform=p,this._textureReader=u,this._classProperty=n,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(u.prototype,{textureReader:{get:function(){return this._textureReader}},hasValueTransform:{get:function(){return this._hasValueTransform}},offset:{get:function(){return this._offset}},scale:{get:function(){return this._scale}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}}),u.prototype.isGpuCompatible=function(){const e=this._classProperty,t=e.type,n=e.componentType;return e.isArray?!e.isVariableLengthArray&&e.arrayLength<=4&&t===a.Z.SCALAR&&n===c.Z.UINT8:!(!a.Z.isVectorType(t)&&t!==a.Z.SCALAR)&&n===c.Z.UINT8};const l=[void 0,"float","vec2","vec3","vec4"],h=[void 0,"int","ivec2","ivec3","ivec4"];u.prototype.getGlslType=function(){const e=this._classProperty;let t=a.Z.getComponentCount(e.type);return e.isArray&&(t=e.arrayLength),e.normalized?l[t]:h[t]},u.prototype.unpackInShader=function(e){if(this._classProperty.normalized)return e;return`${this.getGlslType()}(255.0 * ${e})`};const d=u},58106:(e,t,n)=>{n.d(t,{Z:()=>s});var i=n(93517),o=n(83674);function r(e){this._ellipsoid=new o.Z(e.ellipsoid,i.Z.ZERO)}Object.defineProperties(r.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});const s=r},87795:(e,t,n)=>{n.d(t,{Z:()=>H});var i=n(93517),o=n(66866),r=n(88779),s=n(54485),a=n(20176),c=n(92893),u=n(41780),l=n(22874),h=n(71118),d=n(74408),p=n(16587),m=n(43262),f=n(34152),_=n(33374),Z=n(58106),g=n(69297),y=n(36242),b=n(18061),S=n(20850),T=n(29159);function C(e){if(!(0,s.Z)(e)||!(0,s.Z)(e.tileProvider))throw new a.Z("options.tileProvider is required.");if((0,s.Z)(e.tileProvider.quadtree))throw new a.Z("A QuadtreeTileProvider can only be used with a single QuadtreePrimitive");this._tileProvider=e.tileProvider,this._tileProvider.quadtree=this,this._debug={enableDebugOutput:!1,maxDepth:0,maxDepthVisited:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastMaxDepthVisited:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1};const t=this._tileProvider.tilingScheme.ellipsoid;this._tilesToRender=[],this._tileLoadQueueHigh=[],this._tileLoadQueueMedium=[],this._tileLoadQueueLow=[],this._tileReplacementQueue=new S.Z,this._levelZeroTiles=void 0,this._loadQueueTimeSlice=5,this._tilesInvalidated=!1,this._addHeightCallbacks=[],this._removeHeightCallbacks=[],this._tileToUpdateHeights=[],this._lastTileIndex=0,this._updateHeightsTimeSlice=2,this._cameraPositionCartographic=void 0,this._cameraReferenceFrameOriginCartographic=void 0,this.maximumScreenSpaceError=(0,r.Z)(e.maximumScreenSpaceError,2),this.tileCacheSize=(0,r.Z)(e.tileCacheSize,100),this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this._occluders=new Z.Z({ellipsoid:t}),this._tileLoadProgressEvent=new c.Z,this._lastTileLoadQueueLength=0,this._lastSelectionFrameNumber=void 0}function w(e){const t=e._debug;t.maxDepth=0,t.maxDepthVisited=0,t.tilesVisited=0,t.tilesCulled=0,t.tilesRendered=0,t.tilesWaitingForChildren=0,e._tileLoadQueueHigh.length=0,e._tileLoadQueueMedium.length=0,e._tileLoadQueueLow.length=0}let v;Object.defineProperties(C.prototype,{tileProvider:{get:function(){return this._tileProvider}},tileLoadProgressEvent:{get:function(){return this._tileLoadProgressEvent}},occluders:{get:function(){return this._occluders}}}),C.prototype.invalidateAllTiles=function(){this._tilesInvalidated=!0},C.prototype.forEachLoadedTile=function(e){let t=this._tileReplacementQueue.head;for(;(0,s.Z)(t);)t.state!==y.Z.START&&e(t),t=t.replacementNext},C.prototype.forEachRenderedTile=function(e){const t=this._tilesToRender;for(let n=0,i=t.length;n<i;++n)e(t[n])},C.prototype.updateHeight=function(e,t){const n=this,i={positionOnEllipsoidSurface:void 0,positionCartographic:e,level:-1,callback:t,removeFunc:function(){const e=n._addHeightCallbacks,t=e.length;for(let n=0;n<t;++n)if(e[n]===i){e.splice(n,1);break}n._removeHeightCallbacks.push(i),i.callback&&(i.callback=void 0)}};return n._addHeightCallbacks.push(i),i.removeFunc},C.prototype.update=function(e){(0,s.Z)(this._tileProvider.update)&&this._tileProvider.update(e)},C.prototype.beginFrame=function(e){e.passes.render&&(this._tilesInvalidated&&(!function(e){const t=e._tileReplacementQueue;t.head=void 0,t.tail=void 0,t.count=0,w(e);const n=e._levelZeroTiles;if((0,s.Z)(n))for(let t=0;t<n.length;++t){const i=n[t].customData,o=i.length;for(let t=0;t<o;++t){const n=i[t];n.level=0,e._addHeightCallbacks.push(n)}n[t].freeResources()}e._levelZeroTiles=void 0,e._tileProvider.cancelReprojections()}(this),this._tilesInvalidated=!1),this._tileProvider.initialize(e),w(this),this._debug.suspendLodUpdate||this._tileReplacementQueue.markStartOfRenderFrame())},C.prototype.render=function(e){const t=e.passes,n=this._tileProvider;t.render&&(n.beginUpdate(e),function(e,t){const n=e._debug;if(n.suspendLodUpdate)return;let i;e._tilesToRender.length=0;const o=e._tileProvider;if(!(0,s.Z)(e._levelZeroTiles)){if(!o.ready)return;{const t=o.tilingScheme;e._levelZeroTiles=g.Z.createLevelZeroTiles(t);const n=e._levelZeroTiles.length;if(P.length<n)for(P=new Array(n),i=0;i<n;++i)void 0===P[i]&&(P[i]=new R)}}let r;e._occluders.ellipsoid.cameraPosition=t.camera.positionWC;const a=e._levelZeroTiles,c=a.length>1?e._occluders:void 0;v=t.camera.positionCartographic,a.sort(E);const u=e._addHeightCallbacks,l=e._removeHeightCallbacks,d=t.frameNumber;let p;if(u.length>0||l.length>0){for(i=0,p=a.length;i<p;++i)r=a[i],r._updateCustomData(d,u,l);u.length=0,l.length=0}const m=t.camera;e._cameraPositionCartographic=m.positionCartographic;const f=h.Z.getTranslation(m.transform,D);for(e._cameraReferenceFrameOriginCartographic=e.tileProvider.tilingScheme.ellipsoid.cartesianToCartographic(f,e._cameraReferenceFrameOriginCartographic),i=0,p=a.length;i<p;++i)r=a[i],e._tileReplacementQueue.markTileRendered(r),r.renderable?M(e,r,o,t,c,!1,P[i]):(I(e,e._tileLoadQueueHigh,r,t),++n.tilesWaitingForChildren);e._lastSelectionFrameNumber=d}(this,e),function(e,t){const n=e._tileProvider,i=e._tilesToRender;for(let e=0,o=i.length;e<o;++e){const o=i[e];n.showTileThisFrame(o,t)}}(this,e),n.endUpdate(e)),t.pick&&this._tilesToRender.length>0&&n.updateForPick(e)},C.prototype.endFrame=function(e){e.passes.render&&e.mode!==b.Z.MORPHING&&(function(e,t){const n=e._tileLoadQueueHigh,i=e._tileLoadQueueMedium,o=e._tileLoadQueueLow;if(0===n.length&&0===i.length&&0===o.length)return;e._tileReplacementQueue.trimTiles(e.tileCacheSize);const r=(0,u.Z)()+e._loadQueueTimeSlice,s=e._tileProvider;let a=F(e,t,s,r,n,!1);a=F(e,t,s,r,i,a),F(e,t,s,r,o,a)}(this,e),function(e,t){if(!e.tileProvider.ready)return;const n=U;n.length=0;const r=e._tileToUpdateHeights,a=(0,u.Z)(),c=e._updateHeightsTimeSlice,l=a+c,h=t.mode,d=t.mapProjection,p=e.tileProvider.tilingScheme.ellipsoid;let m;for(;r.length>0;){const t=r[0];if(!(0,s.Z)(t.data)||!(0,s.Z)(t.data.mesh)){const i=t._lastSelectionResultFrame===e._lastSelectionFrameNumber?t._lastSelectionResult:T.Z.NONE;i!==T.Z.RENDERED&&i!==T.Z.CULLED_BUT_NEEDED||n.push(t),r.shift(),e._lastTileIndex=0;continue}const a=t.customData,c=a.length;let f=!1;for(m=e._lastTileIndex;m<c;++m){const e=a[m],n=t.data.terrainData,r=(0,s.Z)(n)&&n.wasCreatedByUpsampling();if(t.level>e.level&&!r){if((0,s.Z)(e.positionOnEllipsoidSurface)||(e.positionOnEllipsoidSurface=i.Z.fromRadians(e.positionCartographic.longitude,e.positionCartographic.latitude,0,p)),h===b.Z.SCENE3D){const n=p.geodeticSurfaceNormal(e.positionOnEllipsoidSurface,z.direction),o=p.getSurfaceNormalIntersectionWithZAxis(e.positionOnEllipsoidSurface,11500,z.origin);if(!(0,s.Z)(o)){let o=0;(0,s.Z)(t.data.tileBoundingRegion)&&(o=t.data.tileBoundingRegion.minimumHeight);const r=Math.min(o,-11500),a=i.Z.multiplyByScalar(n,Math.abs(r)+1,V);i.Z.subtract(e.positionOnEllipsoidSurface,a,z.origin)}}else o.Z.clone(e.positionCartographic,k),k.height=-11500,d.project(k,V),i.Z.fromElements(V.z,V.x,V.y,V),i.Z.clone(V,z.origin),i.Z.clone(i.Z.UNIT_X,z.direction);const n=t.data.pick(z,h,d,!1,V);(0,s.Z)(n)&&((0,s.Z)(e.callback)&&e.callback(n),e.level=t.level)}if((0,u.Z)()>=l){f=!0;break}}if(f){e._lastTileIndex=m;break}e._lastTileIndex=0,r.shift()}for(m=0;m<n.length;m++)r.push(n[m])}(this,e),function(e,t){const n=e._tileLoadQueueHigh.length+e._tileLoadQueueMedium.length+e._tileLoadQueueLow.length;(n!==e._lastTileLoadQueueLength||e._tilesInvalidated)&&(t.afterRender.push(c.Z.prototype.raiseEvent.bind(e._tileLoadProgressEvent,n)),e._lastTileLoadQueueLength=n);const i=e._debug;i.enableDebugOutput&&!i.suspendLodUpdate&&(i.maxDepth=e._tilesToRender.reduce((function(e,t){return Math.max(e,t.level)}),-1),i.tilesRendered=e._tilesToRender.length,i.tilesVisited===i.lastTilesVisited&&i.tilesRendered===i.lastTilesRendered&&i.tilesCulled===i.lastTilesCulled&&i.maxDepth===i.lastMaxDepth&&i.tilesWaitingForChildren===i.lastTilesWaitingForChildren&&i.maxDepthVisited===i.lastMaxDepthVisited||(i.lastTilesVisited=i.tilesVisited,i.lastTilesRendered=i.tilesRendered,i.lastTilesCulled=i.tilesCulled,i.lastMaxDepth=i.maxDepth,i.lastTilesWaitingForChildren=i.tilesWaitingForChildren,i.lastMaxDepthVisited=i.maxDepthVisited))}(this,e))},C.prototype.isDestroyed=function(){return!1},C.prototype.destroy=function(){this._tileProvider=this._tileProvider&&this._tileProvider.destroy()};const x=new o.Z;function E(e,t){let n=f.Z.center(e.rectangle,x);const i=n.longitude-v.longitude,o=n.latitude-v.latitude;n=f.Z.center(t.rectangle,x);const r=n.longitude-v.longitude,s=n.latitude-v.latitude;return i*i+o*o-(r*r+s*s)}const D=new i.Z;let P=[];function I(e,t,n,i){n.needsLoading&&(void 0!==e.tileProvider.computeTileLoadPriority&&(n._loadPriority=e.tileProvider.computeTileLoadPriority(n,i)),t.push(n))}function R(){this.allAreRenderable=!0,this.anyWereRenderedLastFrame=!1,this.notYetRenderableCount=0}function A(){this.southwest=new R,this.southeast=new R,this.northwest=new R,this.northeast=new R}A.prototype.combine=function(e){const t=this.southwest,n=this.southeast,i=this.northwest,o=this.northeast;e.allAreRenderable=t.allAreRenderable&&n.allAreRenderable&&i.allAreRenderable&&o.allAreRenderable,e.anyWereRenderedLastFrame=t.anyWereRenderedLastFrame||n.anyWereRenderedLastFrame||i.anyWereRenderedLastFrame||o.anyWereRenderedLastFrame,e.notYetRenderableCount=t.notYetRenderableCount+n.notYetRenderableCount+i.notYetRenderableCount+o.notYetRenderableCount};const O=new Array(31);for(let e=0;e<O.length;++e)O[e]=new A;function L(e,t,n,i,o){const r=e._debug;++r.tilesVisited,e._tileReplacementQueue.markTileRendered(n),n._updateCustomData(t.frameNumber),n.level>r.maxDepthVisited&&(r.maxDepthVisited=n.level);const a=function(e,t,n){if(t.mode===b.Z.SCENE2D||t.camera.frustum instanceof d.Z||t.camera.frustum instanceof p.Z)return function(e,t,n){let i=t.camera.frustum;(0,s.Z)(i._offCenterFrustum)&&(i=i._offCenterFrustum);const o=t.context,r=o.drawingBufferWidth,a=o.drawingBufferHeight,c=e._tileProvider.getLevelMaximumGeometricError(n.level),u=Math.max(i.top-i.bottom,i.right-i.left)/Math.max(r,a);let h=c/u;t.fog.enabled&&t.mode!==b.Z.SCENE2D&&(h-=l.Z.fog(n._distance,t.fog.density)*t.fog.sse);return h/=t.pixelRatio,h}(e,t,n);const i=e._tileProvider.getLevelMaximumGeometricError(n.level),o=n._distance,r=t.context.drawingBufferHeight,a=t.camera.frustum.sseDenominator;let c=i*r/(o*a);t.fog.enabled&&(c-=l.Z.fog(o,t.fog.density)*t.fog.sse);return c/=t.pixelRatio,c}(e,t,n)<e.maximumScreenSpaceError,c=n.southwestChild,u=n.southeastChild,h=n.northwestChild,m=n.northeastChild,f=e._lastSelectionFrameNumber,_=n._lastSelectionResultFrame===f?n._lastSelectionResult:T.Z.NONE,Z=e.tileProvider;if(a||i){const r=T.Z.originalResult(_)===T.Z.RENDERED,c=T.Z.originalResult(_)===T.Z.CULLED||_===T.Z.NONE,u=n.state===y.Z.DONE;let l=r||c||u;if(l||(0,s.Z)(Z.canRenderWithoutLosingDetail)&&(l=Z.canRenderWithoutLosingDetail(n)),l)return a&&I(e,e._tileLoadQueueMedium,n,t),N(e,n),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=_===T.Z.RENDERED,o.notYetRenderableCount=n.renderable?0:1,n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=T.Z.RENDERED,void(o.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(n));i=!0,a&&I(e,e._tileLoadQueueHigh,n,t)}if(Z.canRefine(n)){if(c.upsampledFromParent&&u.upsampledFromParent&&h.upsampledFromParent&&m.upsampledFromParent)return N(e,n),I(e,e._tileLoadQueueMedium,n,t),e._tileReplacementQueue.markTileRendered(c),e._tileReplacementQueue.markTileRendered(u),e._tileReplacementQueue.markTileRendered(h),e._tileReplacementQueue.markTileRendered(m),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=_===T.Z.RENDERED,o.notYetRenderableCount=n.renderable?0:1,n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=T.Z.RENDERED,void(o.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(n));n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=T.Z.REFINED;const s=e._tilesToRender.length,a=e._tileLoadQueueLow.length,l=e._tileLoadQueueMedium.length,d=e._tileLoadQueueHigh.length,p=e._tileToUpdateHeights.length;if(function(e,t,n,i,o,r,s,a){const c=r.camera.positionCartographic,u=e._tileProvider,l=e._occluders,h=O[t.level],d=h.southwest,p=h.southeast,m=h.northwest,f=h.northeast;c.longitude<t.rectangle.east?c.latitude<t.rectangle.north?(M(e,t,u,r,l,s,d),M(e,n,u,r,l,s,p),M(e,i,u,r,l,s,m),M(e,o,u,r,l,s,f)):(M(e,i,u,r,l,s,m),M(e,t,u,r,l,s,d),M(e,o,u,r,l,s,f),M(e,n,u,r,l,s,p)):c.latitude<t.rectangle.north?(M(e,n,u,r,l,s,p),M(e,t,u,r,l,s,d),M(e,o,u,r,l,s,f),M(e,i,u,r,l,s,m)):(M(e,o,u,r,l,s,f),M(e,i,u,r,l,s,m),M(e,n,u,r,l,s,p),M(e,t,u,r,l,s,d));h.combine(a)}(e,c,u,h,m,t,i,o),s!==e._tilesToRender.length){const i=o.allAreRenderable,c=o.anyWereRenderedLastFrame,u=o.notYetRenderableCount;let h=!1;if(!i&&!c){const i=e._tilesToRender;for(let e=s;e<i.length;++e){let t=i[e];for(;void 0!==t&&t._lastSelectionResult!==T.Z.KICKED&&t!==n;)t._lastSelectionResult=T.Z.kick(t._lastSelectionResult),t=t.parent}e._tilesToRender.length=s,e._tileToUpdateHeights.length=p,N(e,n),n._lastSelectionResult=T.Z.RENDERED;const c=_===T.Z.RENDERED;!c&&u>e.loadingDescendantLimit&&(e._tileLoadQueueLow.length=a,e._tileLoadQueueMedium.length=l,e._tileLoadQueueHigh.length=d,I(e,e._tileLoadQueueMedium,n,t),o.notYetRenderableCount=n.renderable?0:1,h=!0),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=c,c||e._tileToUpdateHeights.push(n),++r.tilesWaitingForChildren}e.preloadAncestors&&!h&&I(e,e._tileLoadQueueLow,n,t)}}else n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=T.Z.RENDERED,N(e,n),I(e,e._tileLoadQueueHigh,n,t),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=_===T.Z.RENDERED,o.notYetRenderableCount=n.renderable?0:1}function M(e,t,n,i,o,r,a){if(n.computeTileVisibility(t,i,o)!==_.Z.NONE)return L(e,i,t,r,a);if(++e._debug.tilesCulled,e._tileReplacementQueue.markTileRendered(t),a.allAreRenderable=!0,a.anyWereRenderedLastFrame=!1,a.notYetRenderableCount=0,function(e,t){const n=t.rectangle;return(0,s.Z)(e._cameraPositionCartographic)&&f.Z.contains(n,e._cameraPositionCartographic)||(0,s.Z)(e._cameraReferenceFrameOriginCartographic)&&f.Z.contains(n,e._cameraReferenceFrameOriginCartographic)}(e,t)){(0,s.Z)(t.data)&&(0,s.Z)(t.data.vertexArray)||I(e,e._tileLoadQueueMedium,t,i);const n=e._lastSelectionFrameNumber,o=t._lastSelectionResultFrame===n?t._lastSelectionResult:T.Z.NONE;o!==T.Z.CULLED_BUT_NEEDED&&o!==T.Z.RENDERED&&e._tileToUpdateHeights.push(t),t._lastSelectionResult=T.Z.CULLED_BUT_NEEDED}else e.preloadSiblings||0===t.level?(I(e,e._tileLoadQueueLow,t,i),t._lastSelectionResult=T.Z.CULLED):t._lastSelectionResult=T.Z.CULLED;t._lastSelectionResultFrame=i.frameNumber}function N(e,t){e._tilesToRender.push(t)}function B(e,t){return e._loadPriority-t._loadPriority}function F(e,t,n,i,o,r){void 0!==n.computeTileLoadPriority&&o.sort(B);for(let s=0,a=o.length;s<a&&((0,u.Z)()<i||!r);++s){const i=o[s];e._tileReplacementQueue.markTileRendered(i),n.loadTile(t,i),r=!0}return r}const z=new m.Z,k=new o.Z,V=new i.Z,U=[];const H=C},69297:(e,t,n)=>{n.d(t,{Z:()=>l});var i=n(54485),o=n(20176),r=n(34152),s=n(36242),a=n(29159);function c(e){if(!(0,i.Z)(e))throw new o.Z("options is required.");if(!(0,i.Z)(e.x))throw new o.Z("options.x is required.");if(!(0,i.Z)(e.y))throw new o.Z("options.y is required.");if(e.x<0||e.y<0)throw new o.Z("options.x and options.y must be greater than or equal to zero.");if(!(0,i.Z)(e.level))throw new o.Z("options.level is required and must be greater than or equal to zero.");if(!(0,i.Z)(e.tilingScheme))throw new o.Z("options.tilingScheme is required.");this._tilingScheme=e.tilingScheme,this._x=e.x,this._y=e.y,this._level=e.level,this._parent=e.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this.replacementPrevious=void 0,this.replacementNext=void 0,this._distance=0,this._loadPriority=0,this._customData=[],this._frameUpdated=void 0,this._lastSelectionResult=a.Z.NONE,this._lastSelectionResultFrame=void 0,this._loadedCallbacks={},this.state=s.Z.START,this.renderable=!1,this.upsampledFromParent=!1,this.data=void 0}function u(e){(0,i.Z)(e)&&e.freeResources()}c.createLevelZeroTiles=function(e){if(!(0,i.Z)(e))throw new o.Z("tilingScheme is required.");const t=e.getNumberOfXTilesAtLevel(0),n=e.getNumberOfYTilesAtLevel(0),r=new Array(t*n);let s=0;for(let i=0;i<n;++i)for(let n=0;n<t;++n)r[s++]=new c({tilingScheme:e,x:n,y:i,level:0});return r},c.prototype._updateCustomData=function(e,t,n){let o,s,a,c=this.customData;if((0,i.Z)(t)&&(0,i.Z)(n)){for(c=c.filter((function(e){return-1===n.indexOf(e)})),this._customData=c,a=this._rectangle,o=0;o<t.length;++o)s=t[o],r.Z.contains(a,s.positionCartographic)&&c.push(s);this._frameUpdated=e}else{const e=this._parent;if((0,i.Z)(e)&&this._frameUpdated!==e._frameUpdated){c.length=0,a=this._rectangle;const t=e.customData;for(o=0;o<t.length;++o)s=t[o],r.Z.contains(a,s.positionCartographic)&&c.push(s);this._frameUpdated=e._frameUpdated}}},Object.defineProperties(c.prototype,{tilingScheme:{get:function(){return this._tilingScheme}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},level:{get:function(){return this._level}},parent:{get:function(){return this._parent}},rectangle:{get:function(){return this._rectangle}},children:{get:function(){return[this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}},southwestChild:{get:function(){return(0,i.Z)(this._southwestChild)||(this._southwestChild=new c({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y+1,level:this.level+1,parent:this})),this._southwestChild}},southeastChild:{get:function(){return(0,i.Z)(this._southeastChild)||(this._southeastChild=new c({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y+1,level:this.level+1,parent:this})),this._southeastChild}},northwestChild:{get:function(){return(0,i.Z)(this._northwestChild)||(this._northwestChild=new c({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y,level:this.level+1,parent:this})),this._northwestChild}},northeastChild:{get:function(){return(0,i.Z)(this._northeastChild)||(this._northeastChild=new c({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y,level:this.level+1,parent:this})),this._northeastChild}},customData:{get:function(){return this._customData}},needsLoading:{get:function(){return this.state<s.Z.DONE}},eligibleForUnloading:{get:function(){let e=!0;return(0,i.Z)(this.data)&&(e=this.data.eligibleForUnloading,(0,i.Z)(e)||(e=!0)),e}}}),c.prototype.findLevelZeroTile=function(e,t,n){const i=this.tilingScheme.getNumberOfXTilesAtLevel(0);if(t<0?t+=i:t>=i&&(t-=i),!(n<0||n>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return e.filter((function(e){return e.x===t&&e.y===n}))[0]},c.prototype.findTileToWest=function(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x-1,this.y);if(t.southeastChild===this)return t.southwestChild;if(t.northeastChild===this)return t.northwestChild;const n=t.findTileToWest(e);return void 0!==n?t.southwestChild===this?n.southeastChild:n.northeastChild:void 0},c.prototype.findTileToEast=function(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x+1,this.y);if(t.southwestChild===this)return t.southeastChild;if(t.northwestChild===this)return t.northeastChild;const n=t.findTileToEast(e);return void 0!==n?t.southeastChild===this?n.southwestChild:n.northwestChild:void 0},c.prototype.findTileToSouth=function(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y+1);if(t.northwestChild===this)return t.southwestChild;if(t.northeastChild===this)return t.southeastChild;const n=t.findTileToSouth(e);return void 0!==n?t.southwestChild===this?n.northwestChild:n.northeastChild:void 0},c.prototype.findTileToNorth=function(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y-1);if(t.southwestChild===this)return t.northwestChild;if(t.southeastChild===this)return t.northeastChild;const n=t.findTileToNorth(e);return void 0!==n?t.northwestChild===this?n.southwestChild:n.southeastChild:void 0},c.prototype.freeResources=function(){this.state=s.Z.START,this.renderable=!1,this.upsampledFromParent=!1,(0,i.Z)(this.data)&&(0,i.Z)(this.data.freeResources)&&this.data.freeResources(),u(this._southwestChild),this._southwestChild=void 0,u(this._southeastChild),this._southeastChild=void 0,u(this._northwestChild),this._northwestChild=void 0,u(this._northeastChild),this._northeastChild=void 0};const l=c},36242:(e,t,n)=>{n.d(t,{Z:()=>i});const i=Object.freeze({START:0,LOADING:1,DONE:2,FAILED:3})},40168:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(20176);function o(){i.Z.throwInstantiationError()}o.computeDefaultLevelZeroMaximumGeometricError=function(e){return 2*e.ellipsoid.maximumRadius*Math.PI*.25/(65*e.getNumberOfXTilesAtLevel(0))},Object.defineProperties(o.prototype,{quadtree:{get:i.Z.throwInstantiationError,set:i.Z.throwInstantiationError},ready:{get:i.Z.throwInstantiationError},tilingScheme:{get:i.Z.throwInstantiationError},errorEvent:{get:i.Z.throwInstantiationError}}),o.prototype.update=i.Z.throwInstantiationError,o.prototype.beginUpdate=i.Z.throwInstantiationError,o.prototype.endUpdate=i.Z.throwInstantiationError,o.prototype.getLevelMaximumGeometricError=i.Z.throwInstantiationError,o.prototype.loadTile=i.Z.throwInstantiationError,o.prototype.computeTileVisibility=i.Z.throwInstantiationError,o.prototype.showTileThisFrame=i.Z.throwInstantiationError,o.prototype.computeDistanceToTile=i.Z.throwInstantiationError,o.prototype.isDestroyed=i.Z.throwInstantiationError,o.prototype.destroy=i.Z.throwInstantiationError;const r=o},22128:(e,t,n)=>{n.d(t,{Z:()=>y});var i=n(17497),o=n(88779),r=n(54485),s=n(20176),a=n(44584),c=n(43284),u=n(37757),l=n(10537),h=n(72724),d=n(34817),p=n(23960),m=n(88651),f=n(26593),_=n(71294);function Z(){}function g(e){this.referenceCount=1,this.resourceLoader=e}Z.cacheEntries={},Z.get=function(e){i.Z.typeOf.string("cacheKey",e);const t=Z.cacheEntries[e];if((0,r.Z)(t))return++t.referenceCount,t.resourceLoader},Z.load=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).resourceLoader;i.Z.typeOf.object("options.resourceLoader",t);const n=t.cacheKey;if(i.Z.typeOf.string("options.resourceLoader.cacheKey",n),(0,r.Z)(Z.cacheEntries[n]))throw new s.Z(`Resource with this cacheKey is already in the cache: ${n}`);Z.cacheEntries[n]=new g(t),t.load()},Z.unload=function(e){i.Z.typeOf.object("resourceLoader",e);const t=e.cacheKey,n=Z.cacheEntries[t];if(!(0,r.Z)(n))throw new s.Z(`Resource is not in the cache: ${t}`);--n.referenceCount,0===n.referenceCount&&(e.destroy(),delete Z.cacheEntries[t])},Z.loadSchema=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).schema,n=e.resource;if((0,r.Z)(t)===(0,r.Z)(n))throw new s.Z("One of options.schema and options.resource must be defined.");const i=_.Z.getSchemaCacheKey({schema:t,resource:n});let a=Z.get(i);return(0,r.Z)(a)||(a=new f.Z({schema:t,resource:n,cacheKey:i}),Z.load({resourceLoader:a})),a},Z.loadEmbeddedBuffer=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).parentResource,n=e.bufferId,s=e.typedArray;i.Z.typeOf.object("options.parentResource",t),i.Z.typeOf.number("options.bufferId",n);const c=_.Z.getEmbeddedBufferCacheKey({parentResource:t,bufferId:n});let u=Z.get(c);return(0,r.Z)(u)||(i.Z.typeOf.object("options.typedArray",s),u=new a.Z({typedArray:s,cacheKey:c}),Z.load({resourceLoader:u})),u},Z.loadExternalBuffer=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).resource;i.Z.typeOf.object("options.resource",t);const n=_.Z.getExternalBufferCacheKey({resource:t});let s=Z.get(n);return(0,r.Z)(s)||(s=new a.Z({resource:t,cacheKey:n}),Z.load({resourceLoader:s})),s},Z.loadGltfJson=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltfResource,n=e.baseResource,s=e.typedArray,a=e.gltfJson;i.Z.typeOf.object("options.gltfResource",t),i.Z.typeOf.object("options.baseResource",n);const c=_.Z.getGltfCacheKey({gltfResource:t});let u=Z.get(c);return(0,r.Z)(u)||(u=new d.Z({resourceCache:Z,gltfResource:t,baseResource:n,typedArray:s,gltfJson:a,cacheKey:c}),Z.load({resourceLoader:u})),u},Z.loadBufferView=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltf,n=e.bufferViewId,s=e.gltfResource,a=e.baseResource;i.Z.typeOf.object("options.gltf",t),i.Z.typeOf.number("options.bufferViewId",n),i.Z.typeOf.object("options.gltfResource",s),i.Z.typeOf.object("options.baseResource",a);const u=_.Z.getBufferViewCacheKey({gltf:t,bufferViewId:n,gltfResource:s,baseResource:a});let l=Z.get(u);return(0,r.Z)(l)||(l=new c.Z({resourceCache:Z,gltf:t,bufferViewId:n,gltfResource:s,baseResource:a,cacheKey:u}),Z.load({resourceLoader:l})),l},Z.loadDraco=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltf,n=e.draco,s=e.gltfResource,a=e.baseResource;i.Z.typeOf.object("options.gltf",t),i.Z.typeOf.object("options.draco",n),i.Z.typeOf.object("options.gltfResource",s),i.Z.typeOf.object("options.baseResource",a);const c=_.Z.getDracoCacheKey({gltf:t,draco:n,gltfResource:s,baseResource:a});let l=Z.get(c);return(0,r.Z)(l)||(l=new u.Z({resourceCache:Z,gltf:t,draco:n,gltfResource:s,baseResource:a,cacheKey:c}),Z.load({resourceLoader:l})),l},Z.loadVertexBuffer=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltf,n=e.gltfResource,a=e.baseResource,c=e.bufferViewId,u=e.draco,l=e.attributeSemantic,h=e.accessorId,d=(0,o.Z)(e.asynchronous,!0),p=(0,o.Z)(e.dequantize,!1),f=(0,o.Z)(e.loadBuffer,!1),g=(0,o.Z)(e.loadTypedArray,!1);if(i.Z.typeOf.object("options.gltf",t),i.Z.typeOf.object("options.gltfResource",n),i.Z.typeOf.object("options.baseResource",a),!f&&!g)throw new s.Z("At least one of loadBuffer and loadTypedArray must be true.");const y=(0,r.Z)(c),b=(0,r.Z)(u),S=(0,r.Z)(l),T=(0,r.Z)(h);if(y===b)throw new s.Z("One of options.bufferViewId and options.draco must be defined.");if(b&&!S)throw new s.Z("When options.draco is defined options.attributeSemantic must also be defined.");if(b&&!T)throw new s.Z("When options.draco is defined options.haAccessorId must also be defined.");b&&(i.Z.typeOf.object("options.draco",u),i.Z.typeOf.string("options.attributeSemantic",l),i.Z.typeOf.number("options.accessorId",h));const C=_.Z.getVertexBufferCacheKey({gltf:t,gltfResource:n,baseResource:a,bufferViewId:c,draco:u,attributeSemantic:l,dequantize:p,loadBuffer:f,loadTypedArray:g});let w=Z.get(C);return(0,r.Z)(w)||(w=new m.Z({resourceCache:Z,gltf:t,gltfResource:n,baseResource:a,bufferViewId:c,draco:u,attributeSemantic:l,accessorId:h,cacheKey:C,asynchronous:d,dequantize:p,loadBuffer:f,loadTypedArray:g}),Z.load({resourceLoader:w})),w},Z.loadIndexBuffer=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltf,n=e.accessorId,a=e.gltfResource,c=e.baseResource,u=e.draco,l=(0,o.Z)(e.asynchronous,!0),d=(0,o.Z)(e.loadBuffer,!1),p=(0,o.Z)(e.loadTypedArray,!1);if(i.Z.typeOf.object("options.gltf",t),i.Z.typeOf.number("options.accessorId",n),i.Z.typeOf.object("options.gltfResource",a),i.Z.typeOf.object("options.baseResource",c),!d&&!p)throw new s.Z("At least one of loadBuffer and loadTypedArray must be true.");const m=_.Z.getIndexBufferCacheKey({gltf:t,accessorId:n,gltfResource:a,baseResource:c,draco:u,loadBuffer:d,loadTypedArray:p});let f=Z.get(m);return(0,r.Z)(f)||(f=new h.Z({resourceCache:Z,gltf:t,accessorId:n,gltfResource:a,baseResource:c,draco:u,cacheKey:m,asynchronous:l,loadBuffer:d,loadTypedArray:p}),Z.load({resourceLoader:f})),f},Z.loadImage=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltf,n=e.imageId,s=e.gltfResource,a=e.baseResource;i.Z.typeOf.object("options.gltf",t),i.Z.typeOf.number("options.imageId",n),i.Z.typeOf.object("options.gltfResource",s),i.Z.typeOf.object("options.baseResource",a);const c=_.Z.getImageCacheKey({gltf:t,imageId:n,gltfResource:s,baseResource:a});let u=Z.get(c);return(0,r.Z)(u)||(u=new l.Z({resourceCache:Z,gltf:t,imageId:n,gltfResource:s,baseResource:a,cacheKey:c}),Z.load({resourceLoader:u})),u},Z.loadTexture=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltf,n=e.textureInfo,s=e.gltfResource,a=e.baseResource,c=e.supportedImageFormats,u=(0,o.Z)(e.asynchronous,!0);i.Z.typeOf.object("options.gltf",t),i.Z.typeOf.object("options.textureInfo",n),i.Z.typeOf.object("options.gltfResource",s),i.Z.typeOf.object("options.baseResource",a);const l=_.Z.getTextureCacheKey({gltf:t,textureInfo:n,gltfResource:s,baseResource:a,supportedImageFormats:c});let h=Z.get(l);return(0,r.Z)(h)||(h=new p.Z({resourceCache:Z,gltf:t,textureInfo:n,gltfResource:s,baseResource:a,supportedImageFormats:c,cacheKey:l,asynchronous:u}),Z.load({resourceLoader:h})),h},Z.clearForSpecs=function(){const e=[m.Z,h.Z,u.Z,p.Z,l.Z,c.Z,a.Z,f.Z,d.Z];let t;const n=Z.cacheEntries,i=[];for(t in n)n.hasOwnProperty(t)&&i.push(n[t]);i.sort((function(t,n){return e.indexOf(t.resourceLoader.constructor)-e.indexOf(n.resourceLoader.constructor)}));const o=i.length;for(let e=0;e<o;++e){const o=i[e];t=o.resourceLoader.cacheKey,(0,r.Z)(n[t])&&(o.resourceLoader.destroy(),delete n[t])}};const y=Z},71294:(e,t,n)=>{n.d(t,{Z:()=>g});var i=n(17497),o=n(88779),r=n(54485),s=n(20176),a=n(35395),c=n(76274),u=n(30271);const l={};function h(e){return(0,a.Z)(e.url)}function d(e){let t=e.byteOffset,n=e.byteLength;if((0,u.Z)(e,"EXT_meshopt_compression")){const i=e.extensions.EXT_meshopt_compression;t=(0,o.Z)(i.byteOffset,0),n=i.byteLength}return`${t}-${t+n}`}function p(e){return h(e)}function m(e,t){return`${h(e)}-buffer-id-${t}`}function f(e,t,n,i){if((0,r.Z)(e.uri)){return p(i.getDerivedResource({url:e.uri}))}return m(n,t)}function _(e,t,n,i){const o=t.bufferView,r=e.bufferViews[o],s=r.buffer;return`${f(e.buffers[s],s,n,i)}-range-${d(r)}`}function Z(e,t,n,i){const o=e.images[t],s=o.bufferView,a=o.uri;if((0,r.Z)(a)){return h(i.getDerivedResource({url:a}))}const c=e.bufferViews[s],u=c.buffer;return`${f(e.buffers[u],u,n,i)}-range-${d(c)}`}l.getSchemaCacheKey=function(e){const t=e.schema,n=e.resource;if((0,r.Z)(t)===(0,r.Z)(n))throw new s.Z("One of options.schema and options.resource must be defined.");return(0,r.Z)(t)?`embedded-schema:${JSON.stringify(t)}`:`external-schema:${h(n)}`},l.getExternalBufferCacheKey=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).resource;return i.Z.typeOf.object("options.resource",t),`external-buffer:${p(t)}`},l.getEmbeddedBufferCacheKey=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).parentResource,n=e.bufferId;return i.Z.typeOf.object("options.parentResource",t),i.Z.typeOf.number("options.bufferId",n),`embedded-buffer:${m(t,n)}`},l.getGltfCacheKey=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltfResource;return i.Z.typeOf.object("options.gltfResource",t),`gltf:${h(t)}`},l.getBufferViewCacheKey=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltf,n=e.bufferViewId,r=e.gltfResource,s=e.baseResource;i.Z.typeOf.object("options.gltf",t),i.Z.typeOf.number("options.bufferViewId",n),i.Z.typeOf.object("options.gltfResource",r),i.Z.typeOf.object("options.baseResource",s);const a=t.bufferViews[n];let c=a.buffer;const l=t.buffers[c];if((0,u.Z)(a,"EXT_meshopt_compression")){c=a.extensions.EXT_meshopt_compression.buffer}return`buffer-view:${f(l,c,r,s)}-range-${d(a)}`},l.getDracoCacheKey=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltf,n=e.draco,r=e.gltfResource,s=e.baseResource;return i.Z.typeOf.object("options.gltf",t),i.Z.typeOf.object("options.draco",n),i.Z.typeOf.object("options.gltfResource",r),i.Z.typeOf.object("options.baseResource",s),`draco:${_(t,n,r,s)}`},l.getVertexBufferCacheKey=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltf,n=e.gltfResource,a=e.baseResource,c=e.bufferViewId,u=e.draco,l=e.attributeSemantic,h=(0,o.Z)(e.dequantize,!1),p=(0,o.Z)(e.loadBuffer,!1),m=(0,o.Z)(e.loadTypedArray,!1);i.Z.typeOf.object("options.gltf",t),i.Z.typeOf.object("options.gltfResource",n),i.Z.typeOf.object("options.baseResource",a);const Z=(0,r.Z)(c),g=(0,r.Z)(u),y=(0,r.Z)(l);if(Z===g)throw new s.Z("One of options.bufferViewId and options.draco must be defined.");if(g&&!y)throw new s.Z("When options.draco is defined options.attributeSemantic must also be defined.");if(g&&(i.Z.typeOf.object("options.draco",u),i.Z.typeOf.string("options.attributeSemantic",l)),!p&&!m)throw new s.Z("At least one of loadBuffer and loadTypedArray must be true.");let b="";if(h&&(b+="-dequantize"),p&&(b+="-buffer"),m&&(b+="-typed-array"),(0,r.Z)(u)){return`vertex-buffer:${_(t,u,n,a)}-draco-${l}${b}`}const S=t.bufferViews[c],T=S.buffer;return`vertex-buffer:${f(t.buffers[T],T,n,a)}-range-${d(S)}${b}`},l.getIndexBufferCacheKey=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltf,n=e.accessorId,a=e.gltfResource,c=e.baseResource,u=e.draco,l=(0,o.Z)(e.loadBuffer,!1),h=(0,o.Z)(e.loadTypedArray,!1);if(i.Z.typeOf.object("options.gltf",t),i.Z.typeOf.number("options.accessorId",n),i.Z.typeOf.object("options.gltfResource",a),i.Z.typeOf.object("options.baseResource",c),!l&&!h)throw new s.Z("At least one of loadBuffer and loadTypedArray must be true.");let d="";if(l&&(d+="-buffer"),h&&(d+="-typed-array"),(0,r.Z)(u)){return`index-buffer:${_(t,u,a,c)}-draco${d}`}const p=t.accessors[n],m=p.bufferView,Z=t.bufferViews[m],g=Z.buffer,y=f(t.buffers[g],g,a,c),b=function(e,t){return`${t.byteOffset+e.byteOffset}-${e.componentType}-${e.type}-${e.count}`}(p,Z);return`index-buffer:${y}-accessor-${b}${d}`},l.getImageCacheKey=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltf,n=e.imageId,r=e.gltfResource,s=e.baseResource;i.Z.typeOf.object("options.gltf",t),i.Z.typeOf.number("options.imageId",n),i.Z.typeOf.object("options.gltfResource",r),i.Z.typeOf.object("options.baseResource",s);return`image:${Z(t,n,r,s)}`},l.getTextureCacheKey=function(e){const t=(e=(0,o.Z)(e,o.Z.EMPTY_OBJECT)).gltf,n=e.textureInfo,r=e.gltfResource,s=e.baseResource,a=e.supportedImageFormats;i.Z.typeOf.object("options.gltf",t),i.Z.typeOf.object("options.textureInfo",n),i.Z.typeOf.object("options.gltfResource",r),i.Z.typeOf.object("options.baseResource",s),i.Z.typeOf.object("options.supportedImageFormats",a);const u=n.index,l=Z(t,c.Z.getImageIdFromTexture({gltf:t,textureId:u,supportedImageFormats:a}),r,s),h=function(e,t){const n=c.Z.createSampler({gltf:e,textureInfo:t});return`${n.wrapS}-${n.wrapT}-${n.minificationFilter}-${n.magnificationFilter}`}(t,n);return`texture:${l}-sampler-${h}`};const g=l},39226:(e,t,n)=>{n.d(t,{Z:()=>c});var i=n(17497),o=n(54485),r=n(90332),s=n(20176),a=n(21514);function c(){}Object.defineProperties(c.prototype,{promise:{get:function(){s.Z.throwInstantiationError()}},cacheKey:{get:function(){s.Z.throwInstantiationError()}}}),c.prototype.load=function(){s.Z.throwInstantiationError()},c.prototype.unload=function(){},c.prototype.process=function(e){},c.prototype.getError=function(e,t){return i.Z.typeOf.string("errorMessage",e),(0,o.Z)(t)&&(e+=`\n${t.message}`),new a.Z(e)},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return this.unload(),(0,r.Z)(this)}},5955:(e,t,n)=>{n.d(t,{Z:()=>i});const i=Object.freeze({UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,FAILED:4})},53102:(e,t,n)=>{n.d(t,{Z:()=>i});const i=Object.freeze({FONT_SIZE:48,PADDING:10,RADIUS:8,CUTOFF:.25})},61125:(e,t,n)=>{n.d(t,{Z:()=>pt});var i=n(23114),o=n(52351),r=n(33365),s=n(93517),a=n(66866),c=n(55077),u=n(6785),l=n(41631),h=n(93737),d=n(37337),p=n(88779),m=n(54485),f=n(90332),_=n(20176),Z=n(31161),g=n(92893),y=n(64729),b=n(78224),S=n(45050),T=n(3169),C=n(97262),w=n(22874),v=n(71118),x=n(93988),E=n(11248),D=n(74408),P=n(16587),I=n(84929),R=n(87823),A=n(59736),O=n(7612),L=n(7004),M=n(74366),N=n(93029),B=n(6365),F=n(85834),z=n(1577),k=n(74064),V=n(71300),U=n(38268),H=n(28176),W=n(71097),j=n(48556),G=n(40543),q=n(1966),$=n(85337),Y=n(66133),Q=n(8036),X=n(71309),K=n(86553),J=n(91986),ee=n(22151),te=n(50445),ne=n(9257),ie=n(5428),oe=n(73020),re=n(60898),se=n(81684),ae=n(27401),ce=n(87613),ue=n(18061),le=n(53640),he=n(64852),de=n(7678),pe=n(3582),me=n(84067),fe=n(66406),_e=n(48690),Ze=n(92287),ge=n(70230),ye=n(22763);const be=function(e){return function(){e.frameState.afterRender.push((function(){e.requestRender()}))}};function Se(e){const t=(e=(0,p.Z)(e,p.Z.EMPTY_OBJECT)).canvas;let n=e.creditContainer,o=e.creditViewport,r=(0,c.Z)(e.contextOptions);if((0,m.Z)(r)||(r={}),(0,m.Z)(r.webgl)||(r.webgl={}),r.webgl.powerPreference=(0,p.Z)(r.webgl.powerPreference,"high-performance"),!(0,m.Z)(t))throw new _.Z("options and options.canvas are required.");const s=(0,m.Z)(n),a=new B.Z(t,r);s||(n=document.createElement("div"),n.style.position="absolute",n.style.bottom="0",n.style["text-shadow"]="0 0 2px #000000",n.style.color="#ffffff",n.style["font-size"]="10px",n.style["padding-right"]="5px",t.parentNode.appendChild(n)),(0,m.Z)(o)||(o=t.parentNode),this._id=(0,h.Z)(),this._jobScheduler=new ee.Z,this._frameState=new X.Z(a,new j.Z(n," \u2022 ",o),this._jobScheduler),this._frameState.scene3DOnly=(0,p.Z)(e.scene3DOnly,!1),this._removeCreditContainer=!s,this._creditContainer=n,this._canvas=t,this._context=a,this._computeEngine=new N.Z(a),this._globe=void 0,this._globeTranslucencyState=new K.Z,this._primitives=new ce.Z,this._groundPrimitives=new ce.Z,this._globeHeight=void 0,this._cameraUnderground=!1,this._logDepthBuffer=a.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new Ze.Z,this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=(0,p.Z)(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new q.Z(e.depthPlaneEllipsoidOffset),this._clearColorCommand=new M.Z({color:new u.Z,stencil:0,owner:this}),this._depthClearCommand=new M.Z({depth:1,owner:this}),this._stencilClearCommand=new M.Z({stencil:0}),this._classificationStencilClearCommand=new M.Z({stencil:0,renderState:k.Z.fromCache({stencilMask:me.Z.CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new he.Z(this),this._preUpdate=new g.Z,this._postUpdate=new g.Z,this._renderError=new g.Z,this._preRender=new g.Z,this._postRender=new g.Z,this._minimumDisableDepthTestDistance=0,this._debugInspector=new ye.Z,this._msaaSamples=(0,p.Z)(e.msaaSamples,1),this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new g.Z,this.morphComplete=new g.Z,this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=u.Z.clone(u.Z.BLACK),this._mode=ue.Z.SCENE3D,this._mapProjection=(0,m.Z)(e.mapProjection)?e.mapProjection:new y.Z,this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.fog=new Q.Z,this._shadowMapCamera=new U.Z(this),this.shadowMap=new pe.Z({context:a,lightCamera:this._shadowMapCamera,enabled:(0,p.Z)(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=u.Z.clone(u.Z.WHITE),this._actualInvertClassificationColor=u.Z.clone(this._invertClassificationColor),this._invertClassification=new J.Z,this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new se.Z,this._brdfLutGenerator=new V.Z,this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new de.Z(this),this._cameraUnderground=!1,this._mapMode2D=(0,p.Z)(e.mapMode2D,te.Z.INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=(0,p.Z)(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=(0,p.Z)(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=A.Z.requestCompletedEvent.addEventListener(be(this)),this._removeTaskProcessorListenerCallback=O.Z.taskCompletedEvent.addEventListener(be(this)),this._removeGlobeCallbacks=[];const l=new i.Z(0,0,a.drawingBufferWidth,a.drawingBufferHeight),d=new U.Z(this);this._logDepthBuffer&&(d.frustum.near=.1,d.frustum.far=1e10),this.preloadFlightCamera=new U.Z(this),this.preloadFlightCullingVolume=void 0,this._picking=new re.Z(this),this._defaultView=new ge.Z(this,d,l),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,this.light=new fe.Z,Pe(this,0,C.Z.now()),this.updateFrameState(),this.initializeFrame()}function Te(e,t,n){const i=e._frameState,o=e._context,r=e._view.oit,s=i.shadowState.lightShadowMaps,a=i.shadowState.lightShadowsEnabled;let c=t.derivedCommands;(0,m.Z)(t.pickId)&&(c.picking=$.Z.createPickDerivedCommand(e,t,o,c.picking)),t.pickOnly||(c.depth=$.Z.createDepthOnlyDerivedCommand(e,t,o,c.depth)),c.originalCommand=t,e._hdr&&(c.hdr=$.Z.createHdrCommand(t,o,c.hdr),c=(t=c.hdr.command).derivedCommands),a&&t.receiveShadows&&(c.shadows=pe.Z.createReceiveDerivedCommand(s,t,n,o,c.shadows)),t.pass===z.Z.TRANSLUCENT&&(0,m.Z)(r)&&r.isSupported()&&(a&&t.receiveShadows?(c.oit=(0,m.Z)(c.oit)?c.oit:{},c.oit.shadows=r.createDerivedCommands(c.shadows.receiveCommand,o,c.oit.shadows)):c.oit=r.createDerivedCommands(t,o,c.oit))}Object.defineProperties(Se.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return F.Z.maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return F.Z.maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return ne.Z.isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,function(e,t){for(let t=0;t<e._removeGlobeCallbacks.length;++t)e._removeGlobeCallbacks[t]();e._removeGlobeCallbacks.length=0;const n=[];(0,m.Z)(t)&&(n.push(t.imageryLayersUpdatedEvent.addEventListener(be(e))),n.push(t.terrainProviderChanged.addEventListener(be(e)))),e._removeGlobeCallbacks=n}(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if((0,m.Z)(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if((0,m.Z)(this.globe))return this.globe.terrainProvider},set:function(e){(0,m.Z)(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if((0,m.Z)(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){if(this.scene3DOnly&&e!==ue.Z.SCENE3D)throw new _.Z("Only SceneMode.SCENE3D is valid when scene3DOnly is true.");if(e===ue.Z.SCENE2D)this.morphTo2D(0);else if(e===ue.Z.SCENE3D)this.morphTo3D(0);else{if(e!==ue.Z.COLUMBUS_VIEW)throw new _.Z("value must be a valid SceneMode enumeration.");this.morphToColumbusView(0)}this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},useWebVR:{get:function(){return this._useWebVR},set:function(e){if(this.camera.frustum instanceof D.Z)throw new _.Z("VR is unsupported with an orthographic projection.");this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new U.Z(this),(0,m.Z)(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new Y.Z(this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},splitPosition:{get:function(){return this._frameState.splitPosition},set:function(e){this._frameState.splitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){if(!(0,m.Z)(e)||e<0)throw new _.Z("minimumDisableDepthTestDistance must be greater than or equal to 0.0.");this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){const t=this._context,n=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=n!==this._hdr,this._hdr=n}},highDynamicRangeSupported:{get:function(){const e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},cameraUnderground:{get:function(){return this._cameraUnderground}},msaaSamples:{get:function(){return this._msaaSamples},set:function(e){e=Math.min(e,F.Z.maximumSamples),this._msaaSamples=e}},msaaSupported:{get:function(){return this._context.msaa}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return.9999}},globeHeight:{get:function(){return this._globeHeight}}}),Se.prototype.getCompressedTextureFormatSupported=function(e){const t=this.context;return("WEBGL_compressed_texture_s3tc"===e||"s3tc"===e)&&t.s3tc||("WEBGL_compressed_texture_pvrtc"===e||"pvrtc"===e)&&t.pvrtc||("WEBGL_compressed_texture_etc"===e||"etc"===e)&&t.etc||("WEBGL_compressed_texture_etc1"===e||"etc1"===e)&&t.etc1||("WEBGL_compressed_texture_astc"===e||"astc"===e)&&t.astc||("EXT_texture_compression_bptc"===e||"bc7"===e)&&t.bc7},Se.prototype.updateDerivedCommands=function(e){if(!(0,m.Z)(e.derivedCommands))return;const t=this._frameState,n=this._context;let i=!1;const o=t.shadowState.lastDirtyTime;e.lastDirtyTime!==o&&(e.lastDirtyTime=o,e.dirty=!0,i=!0);const r=t.useLogDepth,s=this._hdr,a=e.derivedCommands,c=(0,m.Z)(a.logDepth),u=(0,m.Z)(a.hdr),l=(0,m.Z)(a.originalCommand),h=r&&!c,d=s&&!u,p=!(r&&s||l);if(e.dirty=e.dirty||h||d||p,e.dirty){e.dirty=!1;const o=t.shadowState.shadowMaps;t.shadowState.shadowsEnabled&&e.castShadows&&(a.shadows=pe.Z.createCastDerivedCommand(o,e,i,n,a.shadows)),(c||h)&&(a.logDepth=$.Z.createLogDepthCommand(e,n,a.logDepth),Te(this,a.logDepth.command,i)),(l||p)&&Te(this,e,i)}};const Ce=new W.Z({pass:H.Z.RENDER}),we=new W.Z({pass:H.Z.PRELOAD}),ve=new W.Z({pass:H.Z.PRELOAD_FLIGHT}),xe=new W.Z({pass:H.Z.REQUEST_RENDER_MODE_DEFER_CHECK}),Ee=new o.Z;let De;function Pe(e,t,n){const i=e._frameState;i.frameNumber=t,i.time=C.Z.clone(n,i.time)}Se.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1},Se.prototype.updateFrameState=function(){const e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=function(e){const t=e.globe;if(e._mode===ue.Z.SCENE3D&&(0,m.Z)(t)&&t.show&&!e._cameraUnderground&&!e._globeTranslucencyState.translucent){const n=t.ellipsoid,i=e.frameState.minimumTerrainHeight;return Ee.radius=n.minimumRadius+i,De=E.Z.fromBoundingSphere(Ee,e.camera.positionWC,De),De}}(this),t.minimumTerrainHeight=0,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof D.Z||this.camera.frustum instanceof P.Z),t.light=this.light,t.cameraUnderground=this._cameraUnderground,t.globeTranslucencyState=this._globeTranslucencyState,(0,m.Z)(this.globe)&&(t.terrainExaggeration=this.globe.terrainExaggeration,t.terrainExaggerationRelativeHeight=this.globe.terrainExaggerationRelativeHeight),(0,m.Z)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(t.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=u.Z.clone(this.invertClassificationColor,this._actualInvertClassificationColor),J.Z.isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,(0,m.Z)(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0},Se.prototype.isVisible=function(e,t,n){return(0,m.Z)(e)&&(!(0,m.Z)(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==T.Z.OUTSIDE&&(!(0,m.Z)(n)||!e.occlude||!e.boundingVolume.isOccluded(n)))};let Ie=new v.Z(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);function Re(e,t,n,i,o){const a=t._frameState;if((0,m.Z)(t.debugCommandFilter)&&!t.debugCommandFilter(e))return;if(e instanceof M.Z)return void e.execute(n,i);e.debugShowBoundingVolume&&(0,m.Z)(e.boundingVolume)&&function(e,t,n,i){const o=t._frameState,a=o.context,c=e.boundingVolume;let u;(0,m.Z)(t._debugVolume)&&t._debugVolume.destroy();let h=s.Z.clone(c.center);if(o.mode!==ue.Z.SCENE3D){h=v.Z.multiplyByPoint(Ie,h,h);const e=o.mapProjection,t=e.unproject(h);h=e.ellipsoid.cartographicToCartesian(t)}if((0,m.Z)(c.radius)){const e=c.radius;u=S.Z.toWireframe(Z.Z.createGeometry(new Z.Z({radii:new s.Z(e,e,e),vertexFormat:oe.Z.FLAT_VERTEX_FORMAT}))),t._debugVolume=new ae.Z({geometryInstances:new b.Z({geometry:u,modelMatrix:v.Z.fromTranslation(h),attributes:{color:new l.Z(1,0,0,1)}}),appearance:new oe.Z({flat:!0,translucent:!1}),asynchronous:!1})}else{const e=c.halfAxes;u=S.Z.toWireframe(r.Z.createGeometry(r.Z.fromDimensions({dimensions:new s.Z(2,2,2),vertexFormat:oe.Z.FLAT_VERTEX_FORMAT}))),t._debugVolume=new ae.Z({geometryInstances:new b.Z({geometry:u,modelMatrix:v.Z.fromRotationTranslation(e,h,new v.Z),attributes:{color:new l.Z(1,0,0,1)}}),appearance:new oe.Z({flat:!0,translucent:!1}),asynchronous:!1})}const d=o.commandList,p=o.commandList=[];t._debugVolume.update(o),e=p[0],o.useLogDepth&&(e=$.Z.createLogDepthCommand(e,a).command);let f;(0,m.Z)(i)&&(f=n.framebuffer,n.framebuffer=i),e.execute(a,n),(0,m.Z)(f)&&(n.framebuffer=f),o.commandList=d}(e,t,i,o),a.useLogDepth&&(0,m.Z)(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);const c=a.passes;if(!c.pick&&!c.depth&&t._hdr&&(0,m.Z)(e.derivedCommands)&&(0,m.Z)(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),c.pick||c.depth){if(c.pick&&!c.depth&&(0,m.Z)(e.derivedCommands.picking))return void(e=e.derivedCommands.picking.pickCommand).execute(n,i);if((0,m.Z)(e.derivedCommands.depth))return void(e=e.derivedCommands.depth.depthOnlyCommand).execute(n,i)}t.debugShowCommands||t.debugShowFrustums?t._debugInspector.executeDebugShowFrustumsCommand(t,e,i):a.shadowState.lightShadowsEnabled&&e.receiveShadows&&(0,m.Z)(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(n,i):e.execute(n,i)}function Ae(e,t,n,i){const o=t._frameState;let r=e.derivedCommands;(0,m.Z)(r)&&(o.useLogDepth&&(0,m.Z)(r.logDepth)&&(e=r.logDepth.command),r=e.derivedCommands,(0,m.Z)(r.picking)?(e=r.picking.pickCommand).execute(n,i):(0,m.Z)(r.depth)&&(e=r.depth.depthOnlyCommand).execute(n,i))}function Oe(e,t,n){return t.boundingVolume.distanceSquaredTo(n)-e.boundingVolume.distanceSquaredTo(n)}function Le(e,t,n){return e.boundingVolume.distanceSquaredTo(n)-t.boundingVolume.distanceSquaredTo(n)+w.Z.EPSILON12}function Me(e,t,n,i,o){const r=e.context;(0,x.Z)(i,Oe,e.camera.positionWC),(0,m.Z)(o)&&t(o.unclassifiedCommand,e,r,n);const s=i.length;for(let o=0;o<s;++o)t(i[o],e,r,n)}function Ne(e,t,n,i,o){const r=e.context;(0,x.Z)(i,Le,e.camera.positionWC),(0,m.Z)(o)&&t(o.unclassifiedCommand,e,r,n);const s=i.length;for(let o=0;o<s;++o)t(i[o],e,r,n)}Ie=v.Z.inverseTransformation(Ie,Ie);const Be=new I.Z,Fe=new R.Z,ze=new D.Z,ke=new P.Z;function Ve(e,t){const n=e.camera,i=e.context,o=e.frameState,r=i.uniformState;let s;r.updateCamera(n),s=(0,m.Z)(n.frustum.fov)?n.frustum.clone(Be):(0,m.Z)(n.frustum.infiniteProjectionMatrix)?n.frustum.clone(Fe):(0,m.Z)(n.frustum.width)?n.frustum.clone(ze):n.frustum.clone(ke),s.near=n.frustum.near,s.far=n.frustum.far,r.updateFrustum(s),r.updatePass(z.Z.ENVIRONMENT);const a=o.passes,c=a.pick,u=e._environmentState,l=e._view,h=u.renderTranslucentDepthForPick,d=u.useWebVR;if(!c){const n=u.skyBoxCommand;if((0,m.Z)(n)&&Re(n,e,i,t),u.isSkyAtmosphereVisible&&Re(u.skyAtmosphereCommand,e,i,t),u.isSunVisible&&(u.sunDrawCommand.execute(i,t),e.sunBloom&&!d)){let n;n=u.useGlobeDepthFramebuffer?l.globeDepth.framebuffer:u.usePostProcess?l.sceneFramebuffer.framebuffer:u.originalFramebuffer,e._sunPostProcess.execute(i),e._sunPostProcess.copy(i,n),t.framebuffer=n}u.isMoonVisible&&u.moonCommand.execute(i,t)}let p;u.useOIT?((0,m.Z)(e._executeOITFunction)||(e._executeOITFunction=function(e,t,n,o,r){l.globeDepth.prepareColorTextures(i),l.oit.executeCommands(e,t,n,o,r)}),p=e._executeOITFunction):p=a.render?Me:Ne;const f=l.frustumCommandsList,_=f.length,Z=u.clearGlobeDepth,g=u.useDepthPlane,y=e._globeTranslucencyState,b=y.translucent,S=e._view.globeTranslucencyFramebuffer,T=e._depthClearCommand,C=e._stencilClearCommand,w=e._classificationStencilClearCommand,v=e._depthPlane,x=u.usePostProcessSelected,E=n.position.z;let D;for(let a=0;a<_;++a){const d=_-a-1,P=f[d];e.mode===ue.Z.SCENE2D?(n.position.z=E-P.near+1,s.far=Math.max(1,P.far-P.near),s.near=1,r.update(o),r.updateFrustum(s)):(s.near=0!==d?P.near*e.opaqueFrustumNearOffset:P.near,s.far=P.far,r.updateFrustum(s)),T.execute(i,t),i.stencilBuffer&&C.execute(i,t),r.updatePass(z.Z.GLOBE);let I=P.commands[z.Z.GLOBE],R=P.indices[z.Z.GLOBE];if(b)y.executeGlobeCommands(P,Re,S,e,t);else for(D=0;D<R;++D)Re(I[D],e,i,t);const A=l.globeDepth;if((0,m.Z)(A)&&u.useGlobeDepthFramebuffer&&A.executeCopyDepth(i,t),!u.renderTranslucentDepthForPick)if(r.updatePass(z.Z.TERRAIN_CLASSIFICATION),I=P.commands[z.Z.TERRAIN_CLASSIFICATION],R=P.indices[z.Z.TERRAIN_CLASSIFICATION],b)y.executeGlobeClassificationCommands(P,Re,S,e,t);else for(D=0;D<R;++D)Re(I[D],e,i,t);if(Z&&(T.execute(i,t),g&&v.execute(i,t)),!u.useInvertClassification||c||u.renderTranslucentDepthForPick){for(r.updatePass(z.Z.CESIUM_3D_TILE),I=P.commands[z.Z.CESIUM_3D_TILE],R=P.indices[z.Z.CESIUM_3D_TILE],D=0;D<R;++D)Re(I[D],e,i,t);if(R>0&&((0,m.Z)(A)&&u.useGlobeDepthFramebuffer&&(A.prepareColorTextures(i,Z),A.executeUpdateDepth(i,t,Z,A.depthStencilTexture)),!u.renderTranslucentDepthForPick))for(r.updatePass(z.Z.CESIUM_3D_TILE_CLASSIFICATION),I=P.commands[z.Z.CESIUM_3D_TILE_CLASSIFICATION],R=P.indices[z.Z.CESIUM_3D_TILE_CLASSIFICATION],D=0;D<R;++D)Re(I[D],e,i,t)}else{e._invertClassification.clear(i,t);const n=t.framebuffer;for(t.framebuffer=e._invertClassification._fbo.framebuffer,r.updatePass(z.Z.CESIUM_3D_TILE),I=P.commands[z.Z.CESIUM_3D_TILE],R=P.indices[z.Z.CESIUM_3D_TILE],D=0;D<R;++D)Re(I[D],e,i,t);for((0,m.Z)(A)&&u.useGlobeDepthFramebuffer&&(e._invertClassification.prepareTextures(i),A.executeUpdateDepth(i,t,Z,e._invertClassification._fbo.getDepthStencilTexture())),r.updatePass(z.Z.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),I=P.commands[z.Z.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],R=P.indices[z.Z.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],D=0;D<R;++D)Re(I[D],e,i,t);for(t.framebuffer=n,e._invertClassification.executeClassified(i,t),1===o.invertClassificationColor.alpha&&e._invertClassification.executeUnclassified(i,t),R>0&&i.stencilBuffer&&w.execute(i,t),r.updatePass(z.Z.CESIUM_3D_TILE_CLASSIFICATION),I=P.commands[z.Z.CESIUM_3D_TILE_CLASSIFICATION],R=P.indices[z.Z.CESIUM_3D_TILE_CLASSIFICATION],D=0;D<R;++D)Re(I[D],e,i,t)}for(R>0&&i.stencilBuffer&&C.execute(i,t),r.updatePass(z.Z.OPAQUE),I=P.commands[z.Z.OPAQUE],R=P.indices[z.Z.OPAQUE],D=0;D<R;++D)Re(I[D],e,i,t);let O;0!==d&&e.mode!==ue.Z.SCENE2D&&(s.near=P.near,r.updateFrustum(s)),!c&&u.useInvertClassification&&o.invertClassificationColor.alpha<1&&(O=e._invertClassification),r.updatePass(z.Z.TRANSLUCENT),I=P.commands[z.Z.TRANSLUCENT],I.length=P.indices[z.Z.TRANSLUCENT],p(e,Re,t,I,O);if(P.indices[z.Z.CESIUM_3D_TILE_CLASSIFICATION]>0&&l.translucentTileClassification.isSupported()&&(l.translucentTileClassification.executeTranslucentCommands(e,Re,t,I,A.depthStencilTexture),l.translucentTileClassification.executeClassificationCommands(e,Re,t,P)),i.depthTexture&&e.useDepthPicking&&(u.useGlobeDepthFramebuffer||h)){const n=A.depthStencilTexture,o=e._picking.getPickDepth(e,d);o.update(i,n),o.executeCopyDepth(i,t)}if(c||!x)continue;const L=t.framebuffer;if(t.framebuffer=l.sceneFramebuffer.getIdFramebuffer(),s.near=0!==d?P.near*e.opaqueFrustumNearOffset:P.near,s.far=P.far,r.updateFrustum(s),r.updatePass(z.Z.GLOBE),I=P.commands[z.Z.GLOBE],R=P.indices[z.Z.GLOBE],b)y.executeGlobeCommands(P,Ae,S,e,t);else for(D=0;D<R;++D)Ae(I[D],e,i,t);for(Z&&(T.framebuffer=t.framebuffer,T.execute(i,t),T.framebuffer=void 0),Z&&g&&v.execute(i,t),r.updatePass(z.Z.CESIUM_3D_TILE),I=P.commands[z.Z.CESIUM_3D_TILE],R=P.indices[z.Z.CESIUM_3D_TILE],D=0;D<R;++D)Ae(I[D],e,i,t);for(r.updatePass(z.Z.OPAQUE),I=P.commands[z.Z.OPAQUE],R=P.indices[z.Z.OPAQUE],D=0;D<R;++D)Ae(I[D],e,i,t);for(r.updatePass(z.Z.TRANSLUCENT),I=P.commands[z.Z.TRANSLUCENT],R=P.indices[z.Z.TRANSLUCENT],D=0;D<R;++D)Ae(I[D],e,i,t);t.framebuffer=L}}function Ue(e){e.context.uniformState.updatePass(z.Z.COMPUTE);const t=e._environmentState.sunComputeCommand;(0,m.Z)(t)&&t.execute(e._computeEngine);const n=e._computeCommandList,i=n.length;for(let t=0;t<i;++t)n[t].execute(e._computeEngine)}function He(e,t,n){const i=n.shadowMapCullingVolume,o=n.isPointLight,r=n.passes,s=r.length,a=t.length;for(let n=0;n<a;++n){const a=t[n];if(e.updateDerivedCommands(a),a.castShadows&&(a.pass===z.Z.GLOBE||a.pass===z.Z.CESIUM_3D_TILE||a.pass===z.Z.OPAQUE||a.pass===z.Z.TRANSLUCENT)&&e.isVisible(a,i))if(o)for(let e=0;e<s;++e)r[e].commandList.push(a);else if(1===s)r[0].commandList.push(a);else{let t=!1;for(let n=s-1;n>=0;--n){const i=r[n].cullingVolume;if(e.isVisible(a,i))r[n].commandList.push(a),t=!0;else if(t)break}}}}function We(e){const t=e.frameState,n=t.shadowState.shadowMaps,i=n.length;if(!t.shadowState.shadowsEnabled)return;const o=e.context,r=o.uniformState;for(let t=0;t<i;++t){const i=n[t];if(i.outOfView)continue;const s=i.passes,a=s.length;for(let e=0;e<a;++e)s[e].commandList.length=0;He(e,e.frameState.commandList,i);for(let n=0;n<a;++n){const s=i.passes[n];r.updateCamera(s.camera),i.updatePass(o,n);const a=s.commandList.length;for(let n=0;n<a;++n){const i=s.commandList[n];r.updatePass(i.pass),Re(i.derivedCommands.shadows.castCommands[t],e,o,s.passState)}}}}const je=new s.Z;Se.prototype.updateAndExecuteCommands=function(e,t){const n=this._frameState.mode;this._environmentState.useWebVR?function(e,t,n){const i=e._view,o=i.camera,r=e._environmentState.renderTranslucentDepthForPick;it(e,t,n),nt(e),i.createPotentiallyVisibleSet(e),Ue(e),r||We(e);const a=t.viewport;a.x=0,a.y=0,a.width=.5*a.width;const c=U.Z.clone(o,e._cameraVR);c.frustum=o.frustum;const u=o.frustum.near,l=u*(0,p.Z)(e.focalLength,5),h=(0,p.Z)(e.eyeSeparation,l/30),d=s.Z.multiplyByScalar(c.right,.5*h,je);o.frustum.aspectRatio=a.width/a.height;const m=.5*h*u/l;s.Z.add(c.position,d,o.position),o.frustum.xOffset=m,Ve(e,t),a.x=a.width,s.Z.subtract(c.position,d,o.position),o.frustum.xOffset=-m,Ve(e,t),U.Z.clone(c,o)}(this,e,t):n!==ue.Z.SCENE2D||this._mapMode2D===te.Z.ROTATE?et(!0,this,e,t):(it(this,e,t),function(e,t){const n=e.context,o=e.frameState,r=e.camera,a=t.viewport,c=i.Z.clone(a,Je);t.viewport=c;const u=Ge,l=qe;e.mapProjection.project(u,l);const h=s.Z.clone(r.position,$e),d=v.Z.clone(r.transform,Qe),p=r.frustum.clone();r._setTransform(v.Z.IDENTITY);const m=v.Z.computeViewportTransformation(c,0,1,Ye),f=r.frustum.projectionMatrix,_=r.positionWC.y,Z=s.Z.fromElements(w.Z.sign(_)*l.x-_,0,-r.positionWC.x,Xe),g=L.Z.pointToGLWindowCoordinates(f,m,Z,Ke);g.x=Math.floor(g.x);const y=c.x,b=c.width;if(0===_||g.x<=y||g.x>=y+b)et(!0,e,t);else if(Math.abs(y+.5*b-g.x)<1)c.width=g.x-c.x,r.position.x*=w.Z.sign(r.position.x),r.frustum.right=0,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),n.uniformState.update(o),et(!0,e,t),c.x=g.x,r.position.x=-r.position.x,r.frustum.right=-r.frustum.left,r.frustum.left=0,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),n.uniformState.update(o),et(!1,e,t);else if(g.x>y+.5*b){c.width=g.x-y;const i=r.frustum.right;r.frustum.right=l.x-_,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),n.uniformState.update(o),et(!0,e,t),c.x=g.x,c.width=y+b-g.x,r.position.x=-r.position.x,r.frustum.left=-r.frustum.right,r.frustum.right=i-2*r.frustum.right,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),n.uniformState.update(o),et(!1,e,t)}else{c.x=g.x,c.width=y+b-g.x;const i=r.frustum.left;r.frustum.left=-l.x-_,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),n.uniformState.update(o),et(!0,e,t),c.x=y,c.width=g.x-y,r.position.x=-r.position.x,r.frustum.right=-r.frustum.left,r.frustum.left=i-2*r.frustum.left,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),n.uniformState.update(o),et(!1,e,t)}r._setTransform(d),s.Z.clone(h,r.position),r.frustum=p.clone(),t.viewport=a}(this,e))};const Ge=new a.Z(Math.PI,w.Z.PI_OVER_TWO),qe=new s.Z,$e=new s.Z,Ye=new v.Z,Qe=new v.Z,Xe=new s.Z,Ke=new s.Z,Je=new i.Z;function et(e,t,n,i){const o=t._environmentState,r=t._view,s=o.renderTranslucentDepthForPick;e||(t.frameState.commandList.length=0),nt(t),r.createPotentiallyVisibleSet(t),e&&((0,m.Z)(i)&&it(t,n,i),Ue(t),s||We(t)),Ve(t,n)}const tt=new d.Z;function nt(e){const t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),function(e){const t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new G.Z({camera:e.camera,updateOnChange:!1,frustumSplits:t.frustumSplits}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),(0,m.Z)(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}(e),function(e){const t=e._frameState,n=t.shadowMaps,i=n.length,o=i>0&&!t.passes.pick&&e.mode===ue.Z.SCENE3D;if(o!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=o),t.shadowState.lightShadowsEnabled=!1,o){for(let e=0;e<i;++e)if(n[e]!==t.shadowState.shadowMaps[e]){++t.shadowState.lastDirtyTime;break}t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0;for(let e=0;e<i;++e){const i=n[e];i.update(t),t.shadowState.shadowMaps.push(i),i.fromLightSource&&(t.shadowState.lightShadowMaps.push(i),t.shadowState.lightShadowsEnabled=!0),i.dirty&&(++t.shadowState.lastDirtyTime,i.dirty=!1)}}}(e),e._globe&&e._globe.render(t)}function it(e,t,n){const i=e._context,o=e._frameState,r=e._environmentState,s=e._view,a=e._frameState.passes.pick;(0,m.Z)(s.globeDepth)&&(s.globeDepth.picking=a);const c=r.useWebVR;r.originalFramebuffer=t.framebuffer,(0,m.Z)(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!c?e._sunPostProcess=new _e.Z:(0,m.Z)(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!(0,m.Z)(e.sun)&&(0,m.Z)(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);const l=e._clearColorCommand;u.Z.clone(n,l.color),l.execute(i,t);const h=r.useGlobeDepthFramebuffer=(0,m.Z)(s.globeDepth);h&&(s.globeDepth.update(i,t,s.viewport,e.msaaSamples,e._hdr,r.clearGlobeDepth),s.globeDepth.clear(i,t,n));const d=s.oit,p=r.useOIT=!a&&(0,m.Z)(d)&&d.isSupported();p&&(d.update(i,t,s.globeDepth.colorFramebufferManager,e._hdr,e.msaaSamples),d.clear(i,t,n),r.useOIT=d.isSupported());const f=e.postProcessStages;let _=r.usePostProcess=!a&&(e._hdr||f.length>0||f.ambientOcclusion.enabled||f.fxaa.enabled||f.bloom.enabled);r.usePostProcessSelected=!1,_&&(s.sceneFramebuffer.update(i,s.viewport,e._hdr,e.msaaSamples),s.sceneFramebuffer.clear(i,t,n),f.update(i,o.useLogDepth,e._hdr),f.clear(i),_=r.usePostProcess=f.ready,r.usePostProcessSelected=_&&f.hasSelected),r.isSunVisible&&e.sunBloom&&!c?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(i,t,n)):h?t.framebuffer=s.globeDepth.framebuffer:_&&(t.framebuffer=s.sceneFramebuffer.framebuffer),(0,m.Z)(t.framebuffer)&&l.execute(i,t);if(r.useInvertClassification=!a&&(0,m.Z)(t.framebuffer)&&e.invertClassification){let n;if(1===e.frameState.invertClassificationColor.alpha&&r.useGlobeDepthFramebuffer&&(n=s.globeDepth.framebuffer),(0,m.Z)(n)||i.depthTexture){if(e._invertClassification.previousFramebuffer=n,e._invertClassification.update(i,e.msaaSamples,s.globeDepth.colorFramebufferManager),e._invertClassification.clear(i,t),e.frameState.invertClassificationColor.alpha<1&&p){const t=e._invertClassification.unclassifiedCommand,n=t.derivedCommands;n.oit=d.createDerivedCommands(t,i,n.oit)}}else r.useInvertClassification=!1}e._globeTranslucencyState.translucent&&s.globeTranslucencyFramebuffer.updateAndClear(e._hdr,s.viewport,i,t)}function ot(e){e._jobScheduler.resetBudgets();const t=e._frameState;e.primitives.prePassesUpdate(t),(0,m.Z)(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function rt(e){const t=e._frameState;e.primitives.postPassesUpdate(t),A.Z.update()}Se.prototype.updateEnvironment=function(){const e=this._frameState,t=this._view,n=this._environmentState,i=e.passes.render,o=e.passes.offscreen,r=this.skyAtmosphere,s=this.globe,a=this._globeTranslucencyState;if(!i||this._mode!==ue.Z.SCENE2D&&t.camera.frustum instanceof D.Z||!a.environmentVisible)n.skyAtmosphereCommand=void 0,n.skyBoxCommand=void 0,n.sunDrawCommand=void 0,n.sunComputeCommand=void 0,n.moonCommand=void 0;else{(0,m.Z)(r)?((0,m.Z)(s)&&(r.setDynamicAtmosphereColor(s.enableLighting&&s.dynamicAtmosphereLighting,s.dynamicAtmosphereLightingFromSun),n.isReadyForAtmosphere=n.isReadyForAtmosphere||s._surface._tilesToRender.length>0),n.skyAtmosphereCommand=r.update(e,s),(0,m.Z)(n.skyAtmosphereCommand)&&this.updateDerivedCommands(n.skyAtmosphereCommand)):n.skyAtmosphereCommand=void 0,n.skyBoxCommand=(0,m.Z)(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;const i=(0,m.Z)(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;n.sunDrawCommand=(0,m.Z)(i)?i.drawCommand:void 0,n.sunComputeCommand=(0,m.Z)(i)?i.computeCommand:void 0,n.moonCommand=(0,m.Z)(this.moon)?this.moon.update(e):void 0}const c=n.clearGlobeDepth=(0,m.Z)(s)&&s.show&&(!s.depthTestAgainstTerrain||this.mode===ue.Z.SCENE2D);(n.useDepthPlane=c&&this.mode===ue.Z.SCENE3D&&a.useDepthPlane)&&this._depthPlane.update(e),n.renderTranslucentDepthForPick=!1,n.useWebVR=this._useWebVR&&this.mode!==ue.Z.SCENE2D&&!o;const u=e.mode!==ue.Z.SCENE3D||a.sunVisibleThroughGlobe?void 0:e.occluder;let l=e.cullingVolume;const h=tt.planes;for(let e=0;e<5;++e)h[e]=l.planes[e];l=tt,n.isSkyAtmosphereVisible=(0,m.Z)(n.skyAtmosphereCommand)&&n.isReadyForAtmosphere,n.isSunVisible=this.isVisible(n.sunDrawCommand,l,u),n.isMoonVisible=this.isVisible(n.moonCommand,l,u);const d=this.specularEnvironmentMaps;let p=this._specularEnvironmentMapAtlas;!(0,m.Z)(d)||(0,m.Z)(p)&&p.url===d?!(0,m.Z)(d)&&(0,m.Z)(p)&&(p.destroy(),this._specularEnvironmentMapAtlas=void 0):(p=p&&p.destroy(),this._specularEnvironmentMapAtlas=new ne.Z(d)),(0,m.Z)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e)},Se.prototype.resolveFramebuffers=function(e){const t=this._context,n=this._environmentState,i=this._view,o=i.globeDepth;(0,m.Z)(o)&&o.prepareColorTextures(t);const r=n.useOIT,s=n.useGlobeDepthFramebuffer,a=n.usePostProcess,c=n.originalFramebuffer,u=s?o.colorFramebufferManager:void 0,l=i.sceneFramebuffer._colorFramebuffer,h=i.sceneFramebuffer.idFramebuffer;r&&(e.framebuffer=a?l.framebuffer:c,i.oit.execute(t,e));const d=i.translucentTileClassification;if(d.hasTranslucentDepth&&d.isSupported()&&d.execute(this,e),a){i.sceneFramebuffer.prepareColorTextures(t);let e=l;s&&!r&&(e=u);const n=this.postProcessStages,o=e.getColorTexture(0),a=h.getColorTexture(0),d=(0,p.Z)(u,l).getDepthStencilTexture();n.execute(t,o,d,a),n.copy(t,c)}r||a||!s||(e.framebuffer=c,o.executeCopyColor(t,e))},Se.prototype.initializeFrame=function(){120==this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._globeHeight=function(e){const t=e._globe,n=e.camera.positionCartographic;if((0,m.Z)(t)&&t.show&&(0,m.Z)(n))return t.getHeight(n)}(this),this._cameraUnderground=function(e){const t=e.camera,n=e._mode,i=e.globe,o=e._screenSpaceCameraController,r=t.positionCartographic;if(!(0,m.Z)(r))return!1;if(!o.onMap()&&r.height<0)return!0;if(!(0,m.Z)(i)||!i.show||n===ue.Z.SCENE2D||n===ue.Z.MORPHING)return!1;const s=e._globeHeight;return(0,m.Z)(s)&&r.height<s}(this),this._globeTranslucencyState.update(this),this._screenSpaceCameraController.update(),(0,m.Z)(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};const st=new u.Z;function at(e){const t=e._frameState,n=e.context,o=n.uniformState,r=e._defaultView;e._view=r,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=Ce;let a=(0,p.Z)(e.backgroundColor,u.Z.BLACK);e._hdr&&(a=u.Z.clone(a,st),a.red=Math.pow(a.red,e.gamma),a.green=Math.pow(a.green,e.gamma),a.blue=Math.pow(a.blue,e.gamma)),t.backgroundColor=a,e.fog.update(t),o.update(t);const c=e.shadowMap;(0,m.Z)(c)&&c.enabled&&(!(0,m.Z)(e.light)||e.light instanceof fe.Z?s.Z.negate(o.sunDirectionWC,e._shadowMapCamera.direction):s.Z.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(c)),e._computeCommandList.length=0,e._overlayCommandList.length=0;const l=r.viewport;l.x=0,l.y=0,l.width=n.drawingBufferWidth,l.height=n.drawingBufferHeight;const h=r.passState;h.framebuffer=void 0,h.blendingEnabled=void 0,h.scissorTest=void 0,h.viewport=i.Z.clone(l,h.viewport),(0,m.Z)(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(h,a),e.resolveFramebuffers(h),h.framebuffer=void 0,function(e,t){e.context.uniformState.updatePass(z.Z.OVERLAY);const n=e.context,i=e._overlayCommandList,o=i.length;for(let e=0;e<o;++e)i[e].execute(n,t)}(e,h),(0,m.Z)(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),n.endFrame()}function ct(e,t){try{t(e)}catch(t){if(e._renderError.raiseEvent(e,t),e.rethrowRenderErrors)throw t}}function ut(e){return e._picking.updateMostDetailedRayPicks(e)}function lt(e){const t=e._frameState;we.camera=t.camera,we.cullingVolume=t.cullingVolume;e.primitives.updateForPass(t,we)}function ht(e){const t=e._frameState;if(!t.camera.canPreloadFlight())return;ve.camera=e.preloadFlightCamera,ve.cullingVolume=e.preloadFlightCullingVolume;e.primitives.updateForPass(t,ve)}function dt(e){e.primitives.updateForPass(e._frameState,xe)}Se.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);const t=this._frameState;t.newFrame=!1,(0,m.Z)(e)||(e=C.Z.now());const n=this._view.checkForCameraUpdates(this);let i=!this.requestRenderMode||this._renderRequested||n||this._logDepthBufferDirty||this._hdrDirty||this.mode===ue.Z.MORPHING;if(!i&&(0,m.Z)(this.maximumRenderTimeChange)&&(0,m.Z)(this._lastRenderTime)){const t=Math.abs(C.Z.secondsDifference(this._lastRenderTime,e));i=i||t>this.maximumRenderTimeChange}if(i){this._lastRenderTime=C.Z.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1;Pe(this,w.Z.incrementWrap(t.frameNumber,15e6,1),e),t.newFrame=!0}ct(this,ot),this.primitives.show&&(ct(this,ut),ct(this,lt),ct(this,ht),i||ct(this,dt)),this._postUpdate.raiseEvent(this,e),i&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),ct(this,at)),function(e,t){if(e.debugShowFramesPerSecond){if(!(0,m.Z)(e._performanceDisplay)){const t=document.createElement("div");t.className="cesium-performanceDisplay-defaultContainer",e._canvas.parentNode.appendChild(t);const n=new ie.Z({container:t});e._performanceDisplay=n,e._performanceContainer=t}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else(0,m.Z)(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}(this,i),ct(this,rt),function(e){const t=e._frameState.afterRender;for(let n=0,i=t.length;n<i;++n)t[n](),e.requestRender();t.length=0}(this),i&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())},Se.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)},Se.prototype.requestRender=function(){this._renderRequested=!0},Se.prototype.clampLineWidth=function(e){return Math.max(F.Z.minimumAliasedLineWidth,Math.min(e,F.Z.maximumAliasedLineWidth))},Se.prototype.pick=function(e,t,n){return this._picking.pick(this,e,t,n)},Se.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)},Se.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)},Se.prototype.drillPick=function(e,t,n,i){return this._picking.drillPick(this,e,t,n,i)},Se.prototype.pickFromRay=function(e,t,n){return this._picking.pickFromRay(this,e,t,n)},Se.prototype.drillPickFromRay=function(e,t,n,i){return this._picking.drillPickFromRay(this,e,t,n,i)},Se.prototype.pickFromRayMostDetailed=function(e,t,n){return this._picking.pickFromRayMostDetailed(this,e,t,n)},Se.prototype.drillPickFromRayMostDetailed=function(e,t,n,i){return this._picking.drillPickFromRayMostDetailed(this,e,t,n,i)},Se.prototype.sampleHeight=function(e,t,n){return this._picking.sampleHeight(this,e,t,n)},Se.prototype.clampToHeight=function(e,t,n,i){return this._picking.clampToHeight(this,e,t,n,i)},Se.prototype.sampleHeightMostDetailed=function(e,t,n){return this._picking.sampleHeightMostDetailed(this,e,t,n)},Se.prototype.clampToHeightMostDetailed=function(e,t,n){return this._picking.clampToHeightMostDetailed(this,e,t,n)},Se.prototype.cartesianToCanvasCoordinates=function(e,t){return le.Z.wgs84ToWindowCoordinates(this,e,t)},Se.prototype.completeMorph=function(){this._transitioner.completeMorph()},Se.prototype.morphTo2D=function(e){let t;const n=this.globe;t=(0,m.Z)(n)?n.ellipsoid:this.mapProjection.ellipsoid,e=(0,p.Z)(e,2),this._transitioner.morphTo2D(e,t)},Se.prototype.morphToColumbusView=function(e){let t;const n=this.globe;t=(0,m.Z)(n)?n.ellipsoid:this.mapProjection.ellipsoid,e=(0,p.Z)(e,2),this._transitioner.morphToColumbusView(e,t)},Se.prototype.morphTo3D=function(e){let t;const n=this.globe;t=(0,m.Z)(n)?n.ellipsoid:this.mapProjection.ellipsoid,e=(0,p.Z)(e,2),this._transitioner.morphTo3D(e,t)},Se.prototype.isDestroyed=function(){return!1},Se.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),(0,m.Z)(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(let e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,(0,f.Z)(this)};const pt=Se},98196:(e,t,n)=>{n.d(t,{Z:()=>u});var i=n(6785),o=n(90332),r=n(74366),s=n(37791),a=n(27400);function c(){this._numSamples=1,this._colorFramebuffer=new s.Z({depthStencil:!0,supportsDepthTexture:!0}),this._idFramebuffer=new s.Z({depthStencil:!0,supportsDepthTexture:!0}),this._idClearColor=new i.Z(0,0,0,0),this._clearCommand=new r.Z({color:new i.Z(0,0,0,0),depth:1,owner:this})}Object.defineProperties(c.prototype,{framebuffer:{get:function(){return this._colorFramebuffer.framebuffer}},idFramebuffer:{get:function(){return this._idFramebuffer.framebuffer}},depthStencilTexture:{get:function(){return this._colorFramebuffer.getDepthStencilTexture()}}}),c.prototype.update=function(e,t,n,i){const o=t.width,r=t.height,s=n?e.halfFloatingPointTexture?a.Z.HALF_FLOAT:a.Z.FLOAT:a.Z.UNSIGNED_BYTE;this._numSamples=i,this._colorFramebuffer.update(e,o,r,i,s),this._idFramebuffer.update(e,o,r)},c.prototype.clear=function(e,t,n){i.Z.clone(n,this._clearCommand.color),i.Z.clone(this._idClearColor,this._clearCommand.color),this._colorFramebuffer.clear(e,this._clearCommand,t),this._idFramebuffer.clear(e,this._clearCommand,t)},c.prototype.getFramebuffer=function(){return this._colorFramebuffer.framebuffer},c.prototype.getIdFramebuffer=function(){return this._idFramebuffer.framebuffer},c.prototype.prepareColorTextures=function(e){this._numSamples>1&&this._colorFramebuffer.prepareTextures(e)},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){var e;return(e=this)._colorFramebuffer.destroy(),e._idFramebuffer.destroy(),(0,o.Z)(this)};const u=c},18061:(e,t,n)=>{n.d(t,{Z:()=>o});const i={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3,getMorphTime:function(e){return e===i.SCENE3D?1:e!==i.MORPHING?0:void 0}},o=Object.freeze(i)},53640:(e,t,n)=>{n.d(t,{Z:()=>M});var i=n(23114),o=n(59015),r=n(93517),s=n(90868),a=n(66866),c=n(54485),u=n(20176),l=n(22874),h=n(71118),d=n(74408),p=n(16587),m=n(7004),f=n(18061);const _={},Z=new s.Z(0,0,0,1);let g=new s.Z;const y=new i.Z,b=new o.Z,S=new o.Z;_.wgs84ToWindowCoordinates=function(e,t,n){return _.wgs84WithEyeOffsetToWindowCoordinates(e,t,r.Z.ZERO,n)};const T=new s.Z,C=new r.Z;function w(e,t,n,i){const o=n.viewMatrix,a=h.Z.multiplyByVector(o,s.Z.fromElements(e.x,e.y,e.z,1,T),T),c=r.Z.multiplyComponents(t,r.Z.normalize(a,C),C);return a.x+=t.x+c.x,a.y+=t.y+c.y,a.z+=c.z,h.Z.multiplyByVector(n.frustum.projectionMatrix,a,i)}const v=new a.Z(Math.PI,l.Z.PI_OVER_TWO),x=new r.Z,E=new r.Z;_.wgs84WithEyeOffsetToWindowCoordinates=function(e,t,n,i){if(!(0,c.Z)(e))throw new u.Z("scene is required.");if(!(0,c.Z)(t))throw new u.Z("position is required.");const s=e.frameState,a=_.computeActualWgs84Position(s,t,Z);if(!(0,c.Z)(a))return;const T=e.canvas,C=y;C.x=0,C.y=0,C.width=T.clientWidth,C.height=T.clientHeight;const D=e.camera;let P=!1;if(s.mode===f.Z.SCENE2D){const t=e.mapProjection,s=v,c=t.project(s,x),u=r.Z.clone(D.position,E),d=D.frustum.clone(),p=h.Z.computeViewportTransformation(C,0,1,new h.Z),f=D.frustum.projectionMatrix,Z=D.positionWC.y,y=r.Z.fromElements(l.Z.sign(Z)*c.x-Z,0,-D.positionWC.x),I=m.Z.pointToGLWindowCoordinates(f,p,y);if(0===Z||I.x<=0||I.x>=T.clientWidth)P=!0;else{if(I.x>.5*T.clientWidth){C.width=I.x,D.frustum.right=c.x-Z,g=w(a,n,D,g),_.clipToGLWindowCoordinates(C,g,b),C.x+=I.x,D.position.x=-D.position.x;const e=D.frustum.right;D.frustum.right=-D.frustum.left,D.frustum.left=-e,g=w(a,n,D,g),_.clipToGLWindowCoordinates(C,g,S)}else{C.x+=I.x,C.width-=I.x,D.frustum.left=-c.x-Z,g=w(a,n,D,g),_.clipToGLWindowCoordinates(C,g,b),C.x=C.x-C.width,D.position.x=-D.position.x;const e=D.frustum.left;D.frustum.left=-D.frustum.right,D.frustum.right=-e,g=w(a,n,D,g),_.clipToGLWindowCoordinates(C,g,S)}r.Z.clone(u,D.position),D.frustum=d.clone(),((i=o.Z.clone(b,i)).x<0||i.x>T.clientWidth)&&(i.x=S.x)}}if(s.mode!==f.Z.SCENE2D||P){if(g=w(a,n,D,g),g.z<0&&!(D.frustum instanceof d.Z)&&!(D.frustum instanceof p.Z))return;i=_.clipToGLWindowCoordinates(C,g,i)}return i.y=T.clientHeight-i.y,i},_.wgs84ToDrawingBufferCoordinates=function(e,t,n){if(n=_.wgs84ToWindowCoordinates(e,t,n),(0,c.Z)(n))return _.transformWindowToDrawingBuffer(e,n,n)};const D=new r.Z,P=new a.Z;_.computeActualWgs84Position=function(e,t,n){const i=e.mode;if(i===f.Z.SCENE3D)return r.Z.clone(t,n);const o=e.mapProjection,s=o.ellipsoid.cartesianToCartographic(t,P);if(!(0,c.Z)(s))return;if(o.project(s,D),i===f.Z.COLUMBUS_VIEW)return r.Z.fromElements(D.z,D.x,D.y,n);if(i===f.Z.SCENE2D)return r.Z.fromElements(0,D.x,D.y,n);const a=e.morphTime;return r.Z.fromElements(l.Z.lerp(D.z,t.x,a),l.Z.lerp(D.x,t.y,a),l.Z.lerp(D.y,t.z,a),n)};const I=new r.Z,R=new r.Z,A=new h.Z;_.clipToGLWindowCoordinates=function(e,t,n){return r.Z.divideByScalar(t,t.w,I),h.Z.computeViewportTransformation(e,0,1,A),h.Z.multiplyByPoint(A,I,R),o.Z.fromCartesian3(R,n)},_.transformWindowToDrawingBuffer=function(e,t,n){const i=e.canvas,r=e.drawingBufferWidth/i.clientWidth,s=e.drawingBufferHeight/i.clientHeight;return o.Z.fromElements(t.x*r,t.y*s,n)};const O=new s.Z,L=new s.Z;_.drawingBufferToWgs84Coordinates=function(e,t,n,i){const o=e.context.uniformState,a=o.currentFrustum,u=a.x,l=a.y;if(e.frameState.useLogDepth){const e=n*o.log2FarDepthFromNearPlusOne;n=l*(1-u/(Math.pow(2,e)-1+u))/(l-u)}const d=e.view.passState.viewport,p=s.Z.clone(s.Z.UNIT_W,O);let m;p.x=(t.x-d.x)/d.width*2-1,p.y=(t.y-d.y)/d.height*2-1,p.z=2*n-1,p.w=1;let f=e.camera.frustum;if((0,c.Z)(f.fovy)){m=h.Z.multiplyByVector(o.inverseViewProjection,p,L);const e=1/m.w;r.Z.multiplyByScalar(m,e,m)}else(0,c.Z)(f._offCenterFrustum)&&(f=f._offCenterFrustum),m=L,m.x=.5*(p.x*(f.right-f.left)+f.left+f.right),m.y=.5*(p.y*(f.top-f.bottom)+f.bottom+f.top),m.z=.5*(p.z*(u-l)-u-l),m.w=1,m=h.Z.multiplyByVector(o.inverseView,m,m);return r.Z.fromCartesian4(m,i)};const M=_},64852:(e,t,n)=>{n.d(t,{Z:()=>ve});var i=n(93517),o=n(66866),r=n(17497),s=n(54485),a=n(90332),c=n(45971),u=n(22874),l=n(71118),h=n(74408),d=n(16587),p=n(84929),m=n(43262),f=n(87036),_=n(61234),Z=n(7004),g=n(38268),y=n(18061);function b(e){r.Z.typeOf.object("scene",e),this._scene=e,this._currentTweens=[],this._morphHandler=void 0,this._morphCancelled=!1,this._completeMorph=void 0,this._morphToOrthographic=!1}b.prototype.completeMorph=function(){(0,s.Z)(this._completeMorph)&&this._completeMorph()},b.prototype.morphTo2D=function(e,t){(0,s.Z)(this._completeMorph)&&this._completeMorph();const n=this._scene;this._previousMode=n.mode,this._morphToOrthographic=n.camera.frustum instanceof h.Z,this._previousMode!==y.Z.SCENE2D&&this._previousMode!==y.Z.MORPHING&&(this._scene.morphStart.raiseEvent(this,this._previousMode,y.Z.SCENE2D,!0),n._mode=y.Z.MORPHING,n.camera._setTransform(l.Z.IDENTITY),this._previousMode===y.Z.COLUMBUS_VIEW?function(e,t){t*=.5;const n=e._scene,o=n.camera,r=i.Z.clone(o.position,ie),a=i.Z.clone(o.direction,oe),u=i.Z.clone(o.up,re),h=i.Z.negate(i.Z.UNIT_Z,ae),d=i.Z.clone(i.Z.UNIT_Y,ce),p=se;if(t>0)i.Z.clone(i.Z.ZERO,se),p.z=5*n.mapProjection.ellipsoid.maximumRadius;else{i.Z.clone(r,se);const e=le;l.Z.multiplyByPoint(g.Z.TRANSFORM_2D,r,e.origin),l.Z.multiplyByPointAsVector(g.Z.TRANSFORM_2D,a,e.direction);const t=n.globe;if((0,s.Z)(t)){const o=t.pickWorldCoordinates(e,n,!0,he);(0,s.Z)(o)&&(l.Z.multiplyByPoint(g.Z.TRANSFORM_2D_INVERSE,o,p),p.z+=i.Z.distance(r,p))}}const m=ue;m.right=.5*p.z,m.left=-m.right,m.top=m.right*(n.drawingBufferHeight/n.drawingBufferWidth),m.bottom=-m.top;const f=de;f.position=p,f.direction=h,f.up=d,f.frustum=m;const _=we(f);function Z(e){te(r,p,e.time,o.position),te(a,h,e.time,o.direction),te(u,d,e.time,o.up),i.Z.cross(o.direction,o.up,o.right),i.Z.normalize(o.right,o.right),o._adjustOrthographicFrustum(!0)}function y(e,t){e.position.z=t}M(e,_);const b=n.tweens.add({duration:t,easingFunction:c.Z.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:Z,complete:function(){ne(e,t,f,y,_)}});e._currentTweens.push(b)}(this,e):function(e,t,n){t*=.5;const o=e._scene,r=o.camera,a=me;if(t>0)i.Z.clone(i.Z.ZERO,a.position),a.position.z=5*n.maximumRadius,i.Z.negate(i.Z.UNIT_Z,a.direction),i.Z.clone(i.Z.UNIT_Y,a.up);else{n.cartesianToCartographic(r.positionWC,pe),o.mapProjection.project(pe,a.position),i.Z.negate(i.Z.UNIT_Z,a.direction),i.Z.clone(i.Z.UNIT_Y,a.up);const e=Ze;i.Z.clone(a.position2D,e.origin);const t=i.Z.clone(r.directionWC,e.direction),c=n.scaleToGeodeticSurface(r.positionWC,ye),u=Z.Z.eastNorthUpToFixedFrame(c,n,ge);l.Z.inverseTransformation(u,u),l.Z.multiplyByPointAsVector(u,t,t),l.Z.multiplyByPointAsVector(g.Z.TRANSFORM_2D,t,t);const h=o.globe;if((0,s.Z)(h)){const t=h.pickWorldCoordinates(e,o,!0,_e);if((0,s.Z)(t)){const e=i.Z.distance(a.position2D,t);t.x+=e,i.Z.clone(t,a.position2D)}}}function c(e,t){e.position.x=t}l.Z.multiplyByPoint(g.Z.TRANSFORM_2D,a.position,a.position2D),l.Z.multiplyByPointAsVector(g.Z.TRANSFORM_2D,a.direction,a.direction2D),l.Z.multiplyByPointAsVector(g.Z.TRANSFORM_2D,a.up,a.up2D);const u=a.frustum;u.right=.5*a.position.z,u.left=-u.right,u.top=u.right*(o.drawingBufferHeight/o.drawingBufferWidth),u.bottom=-u.top;const h=fe;l.Z.multiplyByPoint(g.Z.TRANSFORM_2D_INVERSE,a.position2D,h.position),i.Z.clone(a.direction,h.direction),i.Z.clone(a.up,h.up),h.frustum=u;const d=we(h);function p(){ne(e,t,a,c,d)}M(e,d),Se(e,t,a,p)}(this,e,t),0===e&&(0,s.Z)(this._completeMorph)&&this._completeMorph())};const S=new i.Z,T=new i.Z,C=new i.Z,w=new i.Z,v=new i.Z,x=new i.Z,E=new i.Z,D=new o.Z,P=new l.Z,I=new p.Z,R=new h.Z,A={position:void 0,direction:void 0,up:void 0,position2D:void 0,direction2D:void 0,up2D:void 0,frustum:void 0};b.prototype.morphToColumbusView=function(e,t){(0,s.Z)(this._completeMorph)&&this._completeMorph();const n=this._scene;if(this._previousMode=n.mode,this._previousMode===y.Z.COLUMBUS_VIEW||this._previousMode===y.Z.MORPHING)return;this._scene.morphStart.raiseEvent(this,this._previousMode,y.Z.COLUMBUS_VIEW,!0),n.camera._setTransform(l.Z.IDENTITY);let o=S;const r=T,a=C;if(e>0)o.x=0,o.y=-1,o.z=1,o=i.Z.multiplyByScalar(i.Z.normalize(o,o),5*t.maximumRadius,o),i.Z.negate(i.Z.normalize(o,r),r),i.Z.cross(i.Z.UNIT_X,r,a);else{const e=n.camera;if(this._previousMode===y.Z.SCENE2D)i.Z.clone(e.position,o),o.z=e.frustum.right-e.frustum.left,i.Z.negate(i.Z.UNIT_Z,r),i.Z.clone(i.Z.UNIT_Y,a);else{i.Z.clone(e.positionWC,o),i.Z.clone(e.directionWC,r),i.Z.clone(e.upWC,a);const s=t.scaleToGeodeticSurface(o,E),c=Z.Z.eastNorthUpToFixedFrame(s,t,P);l.Z.inverseTransformation(c,c),n.mapProjection.project(t.cartesianToCartographic(o,D),o),l.Z.multiplyByPointAsVector(c,r,r),l.Z.multiplyByPointAsVector(c,a,a)}}let h;this._morphToOrthographic?(h=R,h.width=n.camera.frustum.right-n.camera.frustum.left,h.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight):(h=I,h.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight,h.fov=u.Z.toRadians(60));const d=A;d.position=o,d.direction=r,d.up=a,d.frustum=h;const p=function(e){return function(t){const n=t._scene;n._mode=y.Z.COLUMBUS_VIEW,n.morphTime=y.Z.getMorphTime(y.Z.COLUMBUS_VIEW),N(t);const o=n.camera;(t._previousModeMode!==y.Z.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,i.Z.clone(e.position,o.position),i.Z.clone(e.direction,o.direction),i.Z.clone(e.up,o.up),i.Z.cross(o.direction,o.up,o.right),i.Z.normalize(o.right,o.right));const r=o.frustum;n.frameState.useLogDepth&&(r.near=.1,r.far=1e10);const a=(0,s.Z)(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,y.Z.COLUMBUS_VIEW,a)}}(d);M(this,p),this._previousMode===y.Z.SCENE2D?function(e,t,n,o){t*=.5;const r=e._scene,s=r.camera,a=i.Z.clone(n.position,K),u=i.Z.clone(n.direction,J),l=i.Z.clone(n.up,ee);function h(){s.frustum=n.frustum.clone();const h=i.Z.clone(s.position,Y),d=i.Z.clone(s.direction,Q),p=i.Z.clone(s.up,X);function m(e){te(h,a,e.time,s.position),te(d,u,e.time,s.direction),te(p,l,e.time,s.up),i.Z.cross(s.direction,s.up,s.right),i.Z.normalize(s.right,s.right)}h.z=a.z;const f=r.tweens.add({duration:t,easingFunction:c.Z.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:m,complete:function(){o(e)}});e._currentTweens.push(f)}r._mode=y.Z.MORPHING,e._morphToOrthographic?h():be(e,0,n,h)}(this,e,d,p):(d.position2D=l.Z.multiplyByPoint(g.Z.TRANSFORM_2D,o,w),d.direction2D=l.Z.multiplyByPointAsVector(g.Z.TRANSFORM_2D,r,v),d.up2D=l.Z.multiplyByPointAsVector(g.Z.TRANSFORM_2D,a,x),n._mode=y.Z.MORPHING,Se(this,e,d,p)),0===e&&(0,s.Z)(this._completeMorph)&&this._completeMorph()};const O={position:new i.Z,direction:new i.Z,up:new i.Z,frustum:void 0},L=new p.Z;function M(e,t){if(e._scene.completeMorphOnUserInput){e._morphHandler=new f.Z(e._scene.canvas);const n=function(){e._morphCancelled=!0,e._scene.camera.cancelFlight(),t(e)};e._completeMorph=n,e._morphHandler.setInputAction(n,_.Z.LEFT_DOWN),e._morphHandler.setInputAction(n,_.Z.MIDDLE_DOWN),e._morphHandler.setInputAction(n,_.Z.RIGHT_DOWN),e._morphHandler.setInputAction(n,_.Z.WHEEL)}}function N(e){const t=e._currentTweens;for(let e=0;e<t.length;++e)t[e].cancelTween();e._currentTweens.length=0,e._morphHandler=e._morphHandler&&e._morphHandler.destroy()}b.prototype.morphTo3D=function(e,t){(0,s.Z)(this._completeMorph)&&this._completeMorph();const n=this._scene;if(this._previousMode=n.mode,this._previousMode!==y.Z.SCENE3D&&this._previousMode!==y.Z.MORPHING){if(this._scene.morphStart.raiseEvent(this,this._previousMode,y.Z.SCENE3D,!0),n._mode=y.Z.MORPHING,n.camera._setTransform(l.Z.IDENTITY),this._previousMode===y.Z.SCENE2D)!function(e,t,n){t/=3;const o=e._scene,r=o.camera;let s,a;t>0?(s=O,i.Z.fromDegrees(0,0,5*n.maximumRadius,n,s.position),i.Z.negate(s.position,s.direction),i.Z.normalize(s.direction,s.direction),i.Z.clone(i.Z.UNIT_Z,s.up)):(r.position.z=r.frustum.right-r.frustum.left,s=k(e,n));e._morphToOrthographic?(a=$,a.aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,a.width=r.frustum.right-r.frustum.left):(a=L,a.aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,a.fov=u.Z.toRadians(60));s.frustum=a;const c=Ce(s);let l;M(e,c),l=e._morphToOrthographic?function(){q(e,t,s,c)}:function(){be(e,t,s,(function(){q(e,t,s,c)}))};t>0?(o._mode=y.Z.SCENE2D,r.flyTo({duration:t,destination:i.Z.fromDegrees(0,0,5*n.maximumRadius,n,K),complete:function(){o._mode=y.Z.MORPHING,l()}})):l()}(this,e,t);else{let o,r;e>0?(o=O,i.Z.fromDegrees(0,0,5*t.maximumRadius,t,o.position),i.Z.negate(o.position,o.direction),i.Z.normalize(o.direction,o.direction),i.Z.clone(i.Z.UNIT_Z,o.up)):o=k(this,t);const s=n.camera;s.frustum instanceof h.Z?r=s.frustum.clone():(r=L,r.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight,r.fov=u.Z.toRadians(60)),o.frustum=r;const a=Ce(o);M(this,a),q(this,e,o,a)}0===e&&(0,s.Z)(this._completeMorph)&&this._completeMorph()}},b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){return N(this),(0,a.Z)(this)};const B=new o.Z,F=new i.Z,z=new l.Z;function k(e,t){const n=e._scene,i=n.camera,o=O,r=o.position,s=o.direction,a=o.up,c=n.mapProjection.unproject(i.position,B);t.cartographicToCartesian(c,r);const u=t.scaleToGeodeticSurface(r,F),h=Z.Z.eastNorthUpToFixedFrame(u,t,z);return l.Z.multiplyByPointAsVector(h,i.direction,s),l.Z.multiplyByPointAsVector(h,i.up,a),o}const V=new i.Z,U=new i.Z,H=new i.Z,W=new i.Z,j=new i.Z,G=new i.Z;function q(e,t,n,o){t*=.5;const r=e._scene,s=r.camera,a=i.Z.clone(s.position,V),u=i.Z.clone(s.direction,U),h=i.Z.clone(s.up,H),d=l.Z.multiplyByPoint(g.Z.TRANSFORM_2D_INVERSE,n.position,W),p=l.Z.multiplyByPointAsVector(g.Z.TRANSFORM_2D_INVERSE,n.direction,j),m=l.Z.multiplyByPointAsVector(g.Z.TRANSFORM_2D_INVERSE,n.up,G);const f=r.tweens.add({duration:t,easingFunction:c.Z.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){te(a,d,e.time,s.position),te(u,p,e.time,s.direction),te(h,m,e.time,s.up),i.Z.cross(s.direction,s.up,s.right),i.Z.normalize(s.right,s.right)},complete:function(){Te(e,r,0,1,t,o)}});e._currentTweens.push(f)}const $=new h.Z,Y=new i.Z,Q=new i.Z,X=new i.Z,K=new i.Z,J=new i.Z,ee=new i.Z;function te(e,t,n,o){return i.Z.lerp(e,t,n,o)}function ne(e,t,n,i,o){const r=e._scene,s=r.camera;if(s.frustum instanceof h.Z)return;const a=s.frustum.fov,l=.5*u.Z.RADIANS_PER_DEGREE,d=n.position.z*Math.tan(.5*a);s.frustum.far=d/Math.tan(.5*l)+1e7;const p=r.tweens.add({duration:t,easingFunction:c.Z.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){s.frustum.fov=u.Z.lerp(a,l,e.time);const t=d/Math.tan(.5*s.frustum.fov);i(s,t)},complete:function(){s.frustum=n.frustum.clone(),o(e)}});e._currentTweens.push(p)}const ie=new i.Z,oe=new i.Z,re=new i.Z,se=new i.Z,ae=new i.Z,ce=new i.Z,ue=new d.Z,le=new m.Z,he=new i.Z,de={position:void 0,direction:void 0,up:void 0,frustum:void 0};const pe=new o.Z,me={position:new i.Z,direction:new i.Z,up:new i.Z,position2D:new i.Z,direction2D:new i.Z,up2D:new i.Z,frustum:new d.Z},fe={position:new i.Z,direction:new i.Z,up:new i.Z,frustum:void 0},_e=new i.Z,Ze=new m.Z,ge=new l.Z,ye=new i.Z;function be(e,t,n,i){const o=e._scene,r=o.camera,s=r.frustum.right-r.frustum.left;r.frustum=n.frustum.clone();const a=r.frustum.fov,l=.5*u.Z.RADIANS_PER_DEGREE,h=s*Math.tan(.5*a);r.frustum.far=h/Math.tan(.5*l)+1e7,r.frustum.fov=l;const d=o.tweens.add({duration:t,easingFunction:c.Z.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){r.frustum.fov=u.Z.lerp(l,a,e.time),r.position.z=h/Math.tan(.5*r.frustum.fov)},complete:function(){i(e)}});e._currentTweens.push(d)}function Se(e,t,n,o){const r=e._scene,s=r.camera,a=i.Z.clone(s.position,Y),u=i.Z.clone(s.direction,Q),l=i.Z.clone(s.up,X),h=i.Z.clone(n.position2D,K),d=i.Z.clone(n.direction2D,J),p=i.Z.clone(n.up2D,ee);const m=r.tweens.add({duration:t,easingFunction:c.Z.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){te(a,h,e.time,s.position),te(u,d,e.time,s.direction),te(l,p,e.time,s.up),i.Z.cross(s.direction,s.up,s.right),i.Z.normalize(s.right,s.right),s._adjustOrthographicFrustum(!0)},complete:function(){Te(e,r,1,0,t,o)}});e._currentTweens.push(m)}function Te(e,t,n,i,o,r){const a={object:t,property:"morphTime",startValue:n,stopValue:i,duration:o,easingFunction:c.Z.QUARTIC_OUT};(0,s.Z)(r)&&(a.complete=function(){r(e)});const u=t.tweens.addProperty(a);e._currentTweens.push(u)}function Ce(e){return function(t){const n=t._scene;n._mode=y.Z.SCENE3D,n.morphTime=y.Z.getMorphTime(y.Z.SCENE3D),N(t);const o=n.camera;(t._previousMode!==y.Z.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,i.Z.clone(e.position,o.position),i.Z.clone(e.direction,o.direction),i.Z.clone(e.up,o.up),i.Z.cross(o.direction,o.up,o.right),i.Z.normalize(o.right,o.right),o.frustum=e.frustum.clone());const r=o.frustum;n.frameState.useLogDepth&&(r.near=.1,r.far=1e10);const a=(0,s.Z)(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,y.Z.SCENE3D,a)}}function we(e){return function(t){const n=t._scene;n._mode=y.Z.SCENE2D,n.morphTime=y.Z.getMorphTime(y.Z.SCENE2D),N(t);const o=n.camera;i.Z.clone(e.position,o.position),o.position.z=2*n.mapProjection.ellipsoid.maximumRadius,i.Z.clone(e.direction,o.direction),i.Z.clone(e.up,o.up),i.Z.cross(o.direction,o.up,o.right),i.Z.normalize(o.right,o.right),o.frustum=e.frustum.clone();const r=(0,s.Z)(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,y.Z.SCENE2D,r)}}const ve=b},7678:(e,t,n)=>{n.d(t,{Z:()=>Kt});var i=n(59015),o=n(93517),r=n(90868),s=n(66866),a=n(88779),c=n(54485),u=n(90332),l=n(20176),h=n(99996),d=n(55264),p=n(14090),m=n(77407),f=n(22874),_=n(39109),Z=n(71118),g=n(74408),y=n(30445),b=n(20291),S=n(43262),T=n(91571),C=n(7004),w=n(66470),v=n(88125),x=n(50445),E=n(18061),D=n(53640),P=n(92287);function I(e){if(!(0,c.Z)(e))throw new l.Z("scene is required.");this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=v.Z.LEFT_DRAG,this.zoomEventTypes=[v.Z.RIGHT_DRAG,v.Z.WHEEL,v.Z.PINCH],this.rotateEventTypes=v.Z.LEFT_DRAG,this.tiltEventTypes=[v.Z.MIDDLE_DRAG,v.Z.PINCH,{eventType:v.Z.LEFT_DRAG,modifier:m.Z.CTRL},{eventType:v.Z.RIGHT_DRAG,modifier:m.Z.CTRL}],this.lookEventTypes={eventType:v.Z.LEFT_DRAG,modifier:m.Z.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=e,this._globe=void 0,this._ellipsoid=void 0,this._aggregator=new w.Z(e.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._inertiaDisablers={_lastInertiaZoomMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement","_lastInertiaTiltMovement"],_lastInertiaTiltMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement"]},this._tweens=new P.Z,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new i.Z(-1,-1),this._tiltCenter=new o.Z,this._rotateMousePosition=new i.Z(-1,-1),this._rotateStartPosition=new o.Z,this._strafeStartPosition=new o.Z,this._strafeMousePosition=new i.Z,this._strafeEndMousePosition=new i.Z,this._zoomMouseStart=new i.Z(-1,-1),this._zoomWorldPosition=new o.Z,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._zoomingUnderground=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1,this._cameraUnderground=!1;const t=e.mapProjection;this._maxCoord=t.project(new s.Z(Math.PI,f.Z.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3,this._minimumUndergroundPickDistance=2e3,this._maximumUndergroundPickDistance=1e4}function R(e,t,n,o,r,s,a){let u=s[a];(0,c.Z)(u)||(u=s[a]={startPosition:new i.Z,endPosition:new i.Z,motion:new i.Z,inertiaEnabled:!0});const l=e.getButtonPressTime(t,n),h=e.getButtonReleaseTime(t,n),d=l&&h&&(h.getTime()-l.getTime())/1e3,p=new Date,m=h&&(p.getTime()-h.getTime())/1e3;if(l&&h&&d<.4){const a=function(e,t){if(e<0)return 0;const n=25*(1-t);return Math.exp(-n*e)}(m,o),l=e.getLastMovement(t,n);if(!(0,c.Z)(l)||(_=l,i.Z.equalsEpsilon(_.startPosition,_.endPosition,f.Z.EPSILON14))||!u.inertiaEnabled)return;if(u.motion.x=.5*(l.endPosition.x-l.startPosition.x),u.motion.y=.5*(l.endPosition.y-l.startPosition.y),u.startPosition=i.Z.clone(l.startPosition,u.startPosition),u.endPosition=i.Z.multiplyByScalar(u.motion,a,u.endPosition),u.endPosition=i.Z.add(u.startPosition,u.endPosition,u.endPosition),isNaN(u.endPosition.x)||isNaN(u.endPosition.y)||i.Z.distance(u.startPosition,u.endPosition)<.5)return;if(!e.isButtonDown(t,n)){r(s,e.getStartMousePosition(t,n),u)}}var _}function A(e,t){if((0,c.Z)(t)){let n=e[t];(0,c.Z)(n)&&(n.inertiaEnabled=!0);const i=e._inertiaDisablers[t];if((0,c.Z)(i)){const t=i.length;for(let o=0;o<t;++o)n=e[i[o]],(0,c.Z)(n)&&(n.inertiaEnabled=!1)}}}const O=[];function L(e,t,n,i,o,r){if(!(0,c.Z)(n))return;const s=e._aggregator;Array.isArray(n)||(O[0]=n,n=O);const a=n.length;for(let u=0;u<a;++u){const a=n[u],l=(0,c.Z)(a.eventType)?a.eventType:a,h=a.modifier,d=s.isMoving(l,h)&&s.getMovement(l,h),p=s.getStartMousePosition(l,h);e.enableInputs&&t&&(d?(i(e,p,d),A(e,r)):o<1&&R(s,l,h,o,i,e,r))}}const M=new S.Z,N=new o.Z,B=new i.Z,F=new o.Z,z=new i.Z,k=new o.Z,V=new o.Z,U=new o.Z,H=new o.Z,W=new o.Z,j=new o.Z,G=new o.Z,q=new o.Z,$=new o.Z,Y=new o.Z,Q=new o.Z,X=new o.Z,K=new o.Z,J=new o.Z,ee=new o.Z,te=new o.Z,ne=new o.Z,ie=new o.Z,oe={orientation:new d.Z};function re(e,t,n,r,s,a){let u=1;(0,c.Z)(a)&&(u=f.Z.clamp(Math.abs(a),.25,1));const l=n.endPosition.y-n.startPosition.y,h=l>0?e.minimumZoomDistance*u:0,d=e.maximumZoomDistance;let p=r*(s-h);p=f.Z.clamp(p,e._minimumZoomRate,e._maximumZoomRate);let m=l/e._scene.canvas.clientHeight;m=Math.min(m,e.maximumMovementRatio);let _=p*m;if(e.enableCollisionDetection||0===e.minimumZoomDistance||!(0,c.Z)(e._globe)){if(_>0&&Math.abs(s-h)<1)return;if(_<0&&Math.abs(s-d)<1)return;s-_<h?_=s-h-1:s-_>d&&(_=s-d)}const Z=e._scene,y=Z.camera,b=Z.mode,S=oe.orientation;if(S.heading=y.heading,S.pitch=y.pitch,S.roll=y.roll,y.frustum instanceof g.Z)return void(Math.abs(_)>0&&(y.zoomIn(_),y._adjustOrthographicFrustum()));const T=i.Z.equals(t,e._zoomMouseStart);let C,w=e._zoomingOnVector,v=e._rotatingZoom;if(T||(e._zoomMouseStart=i.Z.clone(t,e._zoomMouseStart),(0,c.Z)(e._globe)&&(b===E.Z.SCENE2D?(C=y.getPickRay(t,M).origin,C=o.Z.fromElements(C.y,C.z,C.x)):C=Ze(e,t,N)),(0,c.Z)(C)?(e._useZoomWorldPosition=!0,e._zoomWorldPosition=o.Z.clone(C,e._zoomWorldPosition)):e._useZoomWorldPosition=!1,w=e._zoomingOnVector=!1,v=e._rotatingZoom=!1,e._zoomingUnderground=e._cameraUnderground),!e._useZoomWorldPosition)return void y.zoomIn(_);let x=b===E.Z.COLUMBUS_VIEW;if(y.positionCartographic.height<2e6&&(v=!0),!T||v){if(b===E.Z.SCENE2D){const n=e._zoomWorldPosition,i=y.position;if(!o.Z.equals(n,i)&&y.positionCartographic.height<2*e._maxCoord.x){const r=y.position.x,s=o.Z.subtract(n,i,F);o.Z.normalize(s,s);const a=o.Z.distance(n,i)*_/(.5*y.getMagnitude());y.move(s,.5*a),(y.position.x<0&&r>0||y.position.x>0&&r<0)&&(C=y.getPickRay(t,M).origin,C=o.Z.fromElements(C.y,C.z,C.x),e._zoomWorldPosition=o.Z.clone(C,e._zoomWorldPosition))}}else if(b===E.Z.SCENE3D){const t=o.Z.normalize(y.position,W);if(e._cameraUnderground||e._zoomingUnderground||y.positionCartographic.height<3e3&&Math.abs(o.Z.dot(y.direction,t))<.6)x=!0;else{const n=Z.canvas,i=z;i.x=n.clientWidth/2,i.y=n.clientHeight/2;const r=Ze(e,i,k);if((0,c.Z)(r))if(y.positionCartographic.height<1e6){if(!(o.Z.dot(y.direction,t)>=-.5)){const n=G;o.Z.clone(y.position,n);const i=e._zoomWorldPosition;let r=j;if(r=o.Z.normalize(i,r),o.Z.dot(r,t)<0)return;const s=ee,a=Y;o.Z.clone(y.direction,a),o.Z.add(n,o.Z.multiplyByScalar(a,1e3,te),s);const c=Q,u=X;o.Z.subtract(i,n,c),o.Z.normalize(c,u);const l=o.Z.dot(t,u);if(l>=0)return void(e._zoomMouseStart.x=-1);const h=Math.acos(-l),d=o.Z.magnitude(n),p=o.Z.magnitude(i),m=d-_,Z=o.Z.magnitude(c),g=Math.asin(f.Z.clamp(Z/p*Math.sin(h),-1,1))-Math.asin(f.Z.clamp(m/p*Math.sin(h),-1,1))+h,b=q;o.Z.normalize(n,b);let S=$;S=o.Z.cross(u,b,S),S=o.Z.normalize(S,S),o.Z.normalize(o.Z.cross(b,S,te),a),o.Z.multiplyByScalar(o.Z.normalize(s,te),o.Z.magnitude(s)-_,s),o.Z.normalize(n,n),o.Z.multiplyByScalar(n,m,n);const T=K;o.Z.multiplyByScalar(o.Z.add(o.Z.multiplyByScalar(b,Math.cos(g)-1,ne),o.Z.multiplyByScalar(a,Math.sin(g),ie),te),m,T),o.Z.add(n,T,n),o.Z.normalize(s,b),o.Z.normalize(o.Z.cross(b,S,te),a);const C=J;return o.Z.multiplyByScalar(o.Z.add(o.Z.multiplyByScalar(b,Math.cos(g)-1,ne),o.Z.multiplyByScalar(a,Math.sin(g),ie),te),o.Z.magnitude(s),C),o.Z.add(s,C,s),o.Z.clone(n,y.position),o.Z.normalize(o.Z.subtract(s,n,te),y.direction),o.Z.clone(y.direction,y.direction),o.Z.cross(y.direction,y.up,y.right),o.Z.cross(y.right,y.direction,y.up),void y.setView(oe)}x=!0}else{const t=o.Z.normalize(r,V),n=o.Z.normalize(e._zoomWorldPosition,U),i=o.Z.dot(n,t);if(i>0&&i<1){const e=f.Z.acosClamped(i),r=o.Z.cross(n,t,H),s=_/(Math.abs(e)>f.Z.toRadians(20)?.75*y.positionCartographic.height:y.positionCartographic.height-_);y.rotate(r,e*s)}}else x=!0}}e._rotatingZoom=!x}if(!T&&x||w){let n;const r=D.Z.wgs84ToWindowCoordinates(Z,e._zoomWorldPosition,B);n=b!==E.Z.COLUMBUS_VIEW&&i.Z.equals(t,e._zoomMouseStart)&&(0,c.Z)(r)?y.getPickRay(r,M):y.getPickRay(t,M);const s=n.direction;b!==E.Z.COLUMBUS_VIEW&&b!==E.Z.SCENE2D||o.Z.fromElements(s.y,s.z,s.x,s),y.move(s,_),e._zoomingOnVector=!0}else y.zoomIn(_);e._cameraUnderground||y.setView(oe)}const se=new S.Z,ae=new S.Z,ce=new o.Z;function ue(e,t,n){const i=e._scene.camera;let r=i.getPickRay(n.startPosition,se).origin,s=i.getPickRay(n.endPosition,ae).origin;r=o.Z.fromElements(r.y,r.z,r.x,r),s=o.Z.fromElements(s.y,s.z,s.x,s);const a=o.Z.subtract(r,s,ce),c=o.Z.magnitude(a);c>0&&(o.Z.normalize(a,a),i.move(a,c))}function le(e,t,n){(0,c.Z)(n.distance)&&(n=n.distance);const i=e._scene.camera;re(e,t,n,e._zoomFactor,i.getMagnitude())}const he=new i.Z,de=new i.Z;function pe(e,t,n){if((0,c.Z)(n.angleAndHeight))return void function(e,t,n){let i=e._rotateFactor*e._rotateRateRangeAdjustment;i>e._maximumRotateRate&&(i=e._maximumRotateRate);i<e._minimumRotateRate&&(i=e._minimumRotateRate);const o=e._scene,r=o.camera,s=o.canvas;let a=(n.endPosition.x-n.startPosition.x)/s.clientWidth;a=Math.min(a,e.maximumMovementRatio);const c=i*a*Math.PI*4;r.twistRight(c)}(e,0,n.angleAndHeight);const o=e._scene,r=o.camera,s=o.canvas,a=s.clientWidth,u=s.clientHeight;let l=he;l.x=2/a*n.startPosition.x-1,l.y=2/u*(u-n.startPosition.y)-1,l=i.Z.normalize(l,l);let h=de;h.x=2/a*n.endPosition.x-1,h.y=2/u*(u-n.endPosition.y)-1,h=i.Z.normalize(h,h);let d=f.Z.acosClamped(l.x);l.y<0&&(d=f.Z.TWO_PI-d);let p=f.Z.acosClamped(h.x);h.y<0&&(p=f.Z.TWO_PI-p);const m=p-d;r.twistRight(m)}const me=new S.Z,fe=new o.Z,_e=new o.Z;function Ze(e,t,n){const i=e._scene,r=e._globe,s=i.camera;if(!(0,c.Z)(r))return;const a=!e._cameraUnderground;let u;i.pickPositionSupported&&(u=i.pickPositionWorldCoordinates(t,fe));const l=s.getPickRay(t,me),h=r.pickWorldCoordinates(l,i,a,_e);return((0,c.Z)(u)?o.Z.distance(u,s.positionWC):Number.POSITIVE_INFINITY)<((0,c.Z)(h)?o.Z.distance(h,s.positionWC):Number.POSITIVE_INFINITY)?o.Z.clone(u,n):o.Z.clone(h,n)}const ge=new s.Z;function ye(e){const t=e._ellipsoid,n=e._scene,i=n.camera;let o=0;if(n.mode===E.Z.SCENE3D){const e=t.cartesianToCartographic(i.position,ge);(0,c.Z)(e)&&(o=e.height)}else o=i.position.z;const r=(0,a.Z)(e._scene.globeHeight,0);return Math.abs(r-o)}const be=new o.Z;function Se(e,t){const n=t.origin,i=t.direction,r=ye(e),s=o.Z.normalize(n,be);let a=Math.abs(o.Z.dot(s,i));return a=2*Math.max(a,.5),r*a}function Te(e,t,n,i){let r=o.Z.distance(t.origin,n);const s=ye(e);return r>f.Z.clamp(5*s,e._minimumUndergroundPickDistance,e._maximumUndergroundPickDistance)&&(r=Math.min(r,s/5),r=Math.max(r,100)),S.Z.getPoint(t,r,i)}function Ce(e,t,n,i){let r;return(0,c.Z)(n)?(r=o.Z.distance(t.origin,n),r>e._maximumUndergroundPickDistance&&(r=ye(e))):r=ye(e),S.Z.getPoint(t,r,i)}const we=new i.Z;function ve(e,t){const n=t.endPosition,o=i.Z.subtract(t.endPosition,t.startPosition,we),r=e._strafeEndMousePosition;i.Z.add(r,o,r),t.endPosition=r,st(e,t,e._strafeStartPosition),t.endPosition=n}const xe=new S.Z,Ee=new S.Z,De=new o.Z,Pe=new o.Z,Ie=new o.Z,Re=new o.Z,Ae=new y.Z(o.Z.UNIT_X,0),Oe=new i.Z,Le=new i.Z;function Me(e,t,n){if(o.Z.equals(t,e._translateMousePosition)||(e._looking=!1),o.Z.equals(t,e._strafeMousePosition)||(e._strafing=!1),e._looking)return void Gt(e,t,n);if(e._strafing)return void ve(e,n);const r=e._scene.camera,s=e._cameraUnderground,a=i.Z.clone(n.startPosition,Oe),u=i.Z.clone(n.endPosition,Le);let l=r.getPickRay(a,xe);const h=o.Z.clone(o.Z.ZERO,Re),d=o.Z.UNIT_X;let m;if(r.position.z<e._minimumPickingTerrainHeight&&(m=Ze(e,a,De),(0,c.Z)(m)&&(h.x=m.x)),s||h.x>r.position.z&&(0,c.Z)(m)){let r=m;return s&&(r=Ce(e,l,m,De)),i.Z.clone(t,e._strafeMousePosition),i.Z.clone(t,e._strafeEndMousePosition),o.Z.clone(r,e._strafeStartPosition),e._strafing=!0,void st(e,n,e._strafeStartPosition)}const _=y.Z.fromPointNormal(h,d,Ae);l=r.getPickRay(a,xe);const Z=p.Z.rayPlane(l,_,De),g=r.getPickRay(u,Ee),b=p.Z.rayPlane(g,_,Pe);if(!(0,c.Z)(Z)||!(0,c.Z)(b))return e._looking=!0,Gt(e,t,n),void i.Z.clone(t,e._translateMousePosition);const S=o.Z.subtract(Z,b,Ie),T=S.x;S.x=S.y,S.y=S.z,S.z=T;const C=o.Z.magnitude(S);C>f.Z.EPSILON6&&(o.Z.normalize(S,S),r.move(S,C))}const Ne=new i.Z,Be=new S.Z,Fe=new o.Z,ze=new o.Z,ke=new Z.Z,Ve=new Z.Z,Ue=new o.Z,He=new y.Z(o.Z.UNIT_X,0),We=new o.Z,je=new s.Z,Ge=new Z.Z,qe=new b.Z,$e=new _.Z,Ye=new o.Z;function Qe(e,t,n){if((0,c.Z)(n.angleAndHeight)&&(n=n.angleAndHeight),i.Z.equals(t,e._tiltCenterMousePosition)||(e._tiltCVOffMap=!1,e._looking=!1),e._looking)return void Gt(e,t,n);const r=e._scene.camera;e._tiltCVOffMap||!e.onMap()||Math.abs(r.position.z)>e._minimumPickingTerrainHeight?(e._tiltCVOffMap=!0,function(e,t,n){const r=e._scene,s=r.camera,a=r.canvas,u=Ne;u.x=a.clientWidth/2,u.y=a.clientHeight/2;const l=s.getPickRay(u,Be),d=o.Z.UNIT_X,p=l.origin,m=l.direction;let _;const g=o.Z.dot(d,m);Math.abs(g)>f.Z.EPSILON6&&(_=-o.Z.dot(d,p)/g);if(!(0,c.Z)(_)||_<=0)return e._looking=!0,Gt(e,t,n),void i.Z.clone(t,e._tiltCenterMousePosition);const y=o.Z.multiplyByScalar(m,_,Fe);o.Z.add(p,y,y);const b=r.mapProjection,S=b.ellipsoid;o.Z.fromElements(y.y,y.z,y.x,y);const T=b.unproject(y,je);S.cartographicToCartesian(T,y);const w=C.Z.eastNorthUpToFixedFrame(y,S,ke),v=e._globe,x=e._ellipsoid;e._globe=void 0,e._ellipsoid=h.Z.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;const E=Z.Z.clone(s.transform,Ge);s._setTransform(w),mt(e,t,n,o.Z.UNIT_Z),s._setTransform(E),e._globe=v,e._ellipsoid=x;const D=x.maximumRadius;e._rotateFactor=1/D,e._rotateRateRangeAdjustment=D}(e,t,n)):function(e,t,n){const r=e._scene,s=r.camera,a=e._cameraUnderground;let u,l;const d=o.Z.UNIT_X;if(i.Z.equals(t,e._tiltCenterMousePosition))u=o.Z.clone(e._tiltCenter,Fe);else{if(s.position.z<e._minimumPickingTerrainHeight&&(u=Ze(e,t,Fe)),!(0,c.Z)(u)){l=s.getPickRay(t,Be);const r=l.origin,a=l.direction;let h;const p=o.Z.dot(d,a);if(Math.abs(p)>f.Z.EPSILON6&&(h=-o.Z.dot(d,r)/p),!(0,c.Z)(h)||h<=0)return e._looking=!0,Gt(e,t,n),void i.Z.clone(t,e._tiltCenterMousePosition);u=o.Z.multiplyByScalar(a,h,Fe),o.Z.add(r,u,u)}a&&((0,c.Z)(l)||(l=s.getPickRay(t,Be)),Te(e,l,u,u)),i.Z.clone(t,e._tiltCenterMousePosition),o.Z.clone(u,e._tiltCenter)}const m=r.canvas,g=Ne;g.x=m.clientWidth/2,g.y=e._tiltCenterMousePosition.y,l=s.getPickRay(g,Be);const S=o.Z.clone(o.Z.ZERO,Ue);S.x=u.x;const T=y.Z.fromPointNormal(S,d,He),w=p.Z.rayPlane(l,T,ze),v=s._projection,x=v.ellipsoid;o.Z.fromElements(u.y,u.z,u.x,u);let E=v.unproject(u,je);x.cartographicToCartesian(E,u);const D=C.Z.eastNorthUpToFixedFrame(u,x,ke);let P;(0,c.Z)(w)?(o.Z.fromElements(w.y,w.z,w.x,w),E=v.unproject(w,je),x.cartographicToCartesian(E,w),P=C.Z.eastNorthUpToFixedFrame(w,x,Ve)):P=D;const I=e._globe,R=e._ellipsoid;e._globe=void 0,e._ellipsoid=h.Z.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;let A=o.Z.UNIT_Z;const O=Z.Z.clone(s.transform,Ge);s._setTransform(D);const L=o.Z.cross(o.Z.UNIT_Z,o.Z.normalize(s.position,We),We),M=o.Z.dot(s.right,L);if(mt(e,t,n,A,!1,!0),s._setTransform(P),M<0){const i=n.startPosition.y-n.endPosition.y;(a&&i<0||!a&&i>0)&&(A=void 0);const o=s.constrainedAxis;s.constrainedAxis=void 0,mt(e,t,n,A,!0,!1),s.constrainedAxis=o}else mt(e,t,n,A,!0,!1);if((0,c.Z)(s.constrainedAxis)){const e=o.Z.cross(s.direction,s.constrainedAxis,Ye);o.Z.equalsEpsilon(e,o.Z.ZERO,f.Z.EPSILON6)||(o.Z.dot(e,s.right)<0&&o.Z.negate(e,e),o.Z.cross(e,s.direction,s.up),o.Z.cross(s.direction,s.up,s.right),o.Z.normalize(s.up,s.up),o.Z.normalize(s.right,s.right))}s._setTransform(O),e._globe=I,e._ellipsoid=R;const N=R.maximumRadius;e._rotateFactor=1/N,e._rotateRateRangeAdjustment=N;const B=o.Z.clone(s.positionWC,We);e.enableCollisionDetection&&Yt(e);if(!o.Z.equals(s.positionWC,B)){s._setTransform(P),s.worldToCameraCoordinatesPoint(B,B);const e=o.Z.magnitudeSquared(B);o.Z.magnitudeSquared(s.position)>e&&(o.Z.normalize(s.position,s.position),o.Z.multiplyByScalar(s.position,Math.sqrt(e),s.position));const t=o.Z.angleBetween(B,s.position),n=o.Z.cross(B,s.position,B);o.Z.normalize(n,n);const i=b.Z.fromAxisAngle(n,t,qe),r=_.Z.fromQuaternion(i,$e);_.Z.multiplyByVector(r,s.direction,s.direction),_.Z.multiplyByVector(r,s.up,s.up),o.Z.cross(s.direction,s.up,s.right),o.Z.cross(s.right,s.direction,s.up),s._setTransform(O)}}(e,t,n)}const Xe=new i.Z,Ke=new S.Z,Je=new o.Z;function et(e,t,n){(0,c.Z)(n.distance)&&(n=n.distance);const i=e._scene,r=i.camera,s=i.canvas,a=e._cameraUnderground;let u;a?u=t:(u=Xe,u.x=s.clientWidth/2,u.y=s.clientHeight/2);const l=r.getPickRay(u,Ke),h=l.origin,d=l.direction,p=r.position.z;let m,f;if(p<e._minimumPickingTerrainHeight&&(m=Ze(e,u,Je)),(0,c.Z)(m)&&(f=o.Z.distance(h,m)),a){const t=Se(e,l);f=(0,c.Z)(f)?Math.min(f,t):t}if(!(0,c.Z)(f)){const e=o.Z.UNIT_X;f=-o.Z.dot(e,h)/o.Z.dot(e,d)}re(e,t,n,e._zoomFactor,f)}const tt=new S.Z,nt=new y.Z(o.Z.UNIT_X,0),it=new o.Z,ot=new o.Z,rt=new o.Z;function st(e,t,n){const i=e._scene,r=i.camera,s=r.getPickRay(t.endPosition,tt);let a=o.Z.clone(r.direction,ot);i.mode===E.Z.COLUMBUS_VIEW&&o.Z.fromElements(a.z,a.x,a.y,a);const u=y.Z.fromPointNormal(n,a,nt),l=p.Z.rayPlane(s,u,it);(0,c.Z)(l)&&(a=o.Z.subtract(n,l,a),i.mode===E.Z.COLUMBUS_VIEW&&o.Z.fromElements(a.y,a.z,a.x,a),o.Z.add(r.position,a,r.position))}const at=new o.Z,ct=new s.Z,ut=new o.Z,lt=new h.Z,ht=new o.Z,dt=new o.Z;function pt(e,t,n){const r=e._scene.camera,s=e._cameraUnderground;let a,u,l=e._ellipsoid;if(!Z.Z.equals(r.transform,Z.Z.IDENTITY))return void mt(e,t,n);const d=l.geodeticSurfaceNormal(r.position,ht);if(i.Z.equals(t,e._rotateMousePosition)){if(e._looking)Gt(e,t,n,d);else if(e._rotating)mt(e,t,n);else if(e._strafing)ve(e,n);else{if(o.Z.magnitude(r.position)<o.Z.magnitude(e._rotateStartPosition))return;a=o.Z.magnitude(e._rotateStartPosition),u=ut,u.x=u.y=u.z=a,l=h.Z.fromCartesian3(u,lt),Ct(e,t,n,l)}return}e._looking=!1,e._rotating=!1,e._strafing=!1;const p=l.cartesianToCartographic(r.positionWC,ct).height,m=e._globe;if((0,c.Z)(m)&&p<e._minimumPickingTerrainHeight){const p=Ze(e,n.startPosition,rt);if((0,c.Z)(p)){let c=!1;const d=r.getPickRay(n.startPosition,me);if(s)c=!0,Ce(e,d,p,p);else{const e=l.geodeticSurfaceNormal(p,dt);c=!!(Math.abs(o.Z.dot(d.direction,e))<.05)||o.Z.magnitude(r.position)<o.Z.magnitude(p)}c?(i.Z.clone(t,e._strafeEndMousePosition),o.Z.clone(p,e._strafeStartPosition),e._strafing=!0,st(e,n,e._strafeStartPosition)):(a=o.Z.magnitude(p),u=ut,u.x=u.y=u.z=a,l=h.Z.fromCartesian3(u,lt),Ct(e,t,n,l),o.Z.clone(p,e._rotateStartPosition))}else e._looking=!0,Gt(e,t,n,d)}else(0,c.Z)(r.pickEllipsoid(n.startPosition,e._ellipsoid,at))?(Ct(e,t,n,e._ellipsoid),o.Z.clone(at,e._rotateStartPosition)):p>e._minimumTrackBallHeight?(e._rotating=!0,mt(e,t,n)):(e._looking=!0,Gt(e,t,n,d));i.Z.clone(t,e._rotateMousePosition)}function mt(e,t,n,i,r,s){r=(0,a.Z)(r,!1),s=(0,a.Z)(s,!1);const u=e._scene,l=u.camera,h=u.canvas,d=l.constrainedAxis;(0,c.Z)(i)&&(l.constrainedAxis=i);const p=o.Z.magnitude(l.position);let m=e._rotateFactor*(p-e._rotateRateRangeAdjustment);m>e._maximumRotateRate&&(m=e._maximumRotateRate),m<e._minimumRotateRate&&(m=e._minimumRotateRate);let f=(n.startPosition.x-n.endPosition.x)/h.clientWidth,_=(n.startPosition.y-n.endPosition.y)/h.clientHeight;f=Math.min(f,e.maximumMovementRatio),_=Math.min(_,e.maximumMovementRatio);const Z=m*f*Math.PI*2,g=m*_*Math.PI;r||l.rotateRight(Z),s||l.rotateUp(g),l.constrainedAxis=d}const ft=r.Z.clone(r.Z.UNIT_W),_t=r.Z.clone(r.Z.UNIT_W),Zt=new o.Z,gt=new o.Z,yt=new o.Z,bt=new o.Z,St=new i.Z,Tt=new i.Z;function Ct(e,t,n,r){const s=e._scene.camera,a=i.Z.clone(n.startPosition,St),u=i.Z.clone(n.endPosition,Tt);let l=s.pickEllipsoid(a,r,ft),h=s.pickEllipsoid(u,r,_t);if(!(0,c.Z)(l)||!(0,c.Z)(h))return e._rotating=!0,void mt(e,0,n);if(l=s.worldToCameraCoordinates(l,l),h=s.worldToCameraCoordinates(h,h),(0,c.Z)(s.constrainedAxis)){const e=s.constrainedAxis,t=o.Z.mostOrthogonalAxis(e,Zt);o.Z.cross(t,e,t),o.Z.normalize(t,t);const n=o.Z.cross(e,t,gt),i=o.Z.magnitude(l),r=o.Z.dot(e,l),a=Math.acos(r/i),c=o.Z.multiplyByScalar(e,r,yt);o.Z.subtract(l,c,c),o.Z.normalize(c,c);const u=o.Z.magnitude(h),d=o.Z.dot(e,h),p=Math.acos(d/u),m=o.Z.multiplyByScalar(e,d,bt);o.Z.subtract(h,m,m),o.Z.normalize(m,m);let _=Math.acos(o.Z.dot(c,t));o.Z.dot(c,n)<0&&(_=f.Z.TWO_PI-_);let Z=Math.acos(o.Z.dot(m,t));o.Z.dot(m,n)<0&&(Z=f.Z.TWO_PI-Z);const g=_-Z;let y;y=o.Z.equalsEpsilon(e,s.position,f.Z.EPSILON2)?s.right:o.Z.cross(e,s.position,Zt);const b=o.Z.cross(e,y,Zt),S=o.Z.dot(b,o.Z.subtract(l,e,gt)),T=o.Z.dot(b,o.Z.subtract(h,e,gt));let C;C=S>0&&T>0?p-a:S>0&&T<=0?o.Z.dot(s.position,e)>0?-a-p:a+p:a-p,s.rotateRight(g),s.rotateUp(C)}else{o.Z.normalize(l,l),o.Z.normalize(h,h);const e=o.Z.dot(l,h),t=o.Z.cross(l,h,Zt);if(e<1&&!o.Z.equalsEpsilon(t,o.Z.ZERO,f.Z.EPSILON14)){const n=Math.acos(e);s.rotate(t,n)}}}const wt=new o.Z,vt=new s.Z;function xt(e,t,n){(0,c.Z)(n.distance)&&(n=n.distance);const i=e._ellipsoid,r=e._scene,s=r.camera,a=r.canvas,u=e._cameraUnderground;let l;u?l=t:(l=Xe,l.x=a.clientWidth/2,l.y=a.clientHeight/2);const h=s.getPickRay(l,Ke);let d;const p=i.cartesianToCartographic(s.position,vt).height;let m;if(p<e._minimumPickingTerrainHeight&&(d=Ze(e,l,Je)),(0,c.Z)(d)&&(m=o.Z.distance(h.origin,d)),u){const t=Se(e,h);m=(0,c.Z)(m)?Math.min(m,t):t}(0,c.Z)(m)||(m=p);const f=o.Z.normalize(s.position,wt);re(e,t,n,e._zoomFactor,m,o.Z.dot(f,s.direction))}const Et=new i.Z,Dt=new S.Z,Pt=new o.Z,It=new o.Z,Rt=new Z.Z,At=new Z.Z,Ot=new Z.Z,Lt=new b.Z,Mt=new _.Z,Nt=new s.Z,Bt=new o.Z;function Ft(e,t,n){const r=e._scene.camera;if(!Z.Z.equals(r.transform,Z.Z.IDENTITY))return;if((0,c.Z)(n.angleAndHeight)&&(n=n.angleAndHeight),i.Z.equals(t,e._tiltCenterMousePosition)||(e._tiltOnEllipsoid=!1,e._looking=!1),e._looking){const i=e._ellipsoid.geodeticSurfaceNormal(r.position,Bt);return void Gt(e,t,n,i)}const s=e._ellipsoid.cartesianToCartographic(r.position,Nt);e._tiltOnEllipsoid||s.height>e._minimumCollisionTerrainHeight?(e._tiltOnEllipsoid=!0,function(e,t,n){const r=e._ellipsoid,s=e._scene,a=s.camera,u=.25*e.minimumZoomDistance,l=r.cartesianToCartographic(a.positionWC,zt).height;if(l-u-1<f.Z.EPSILON3&&n.endPosition.y-n.startPosition.y<0)return;const d=s.canvas,m=Et;m.x=d.clientWidth/2,m.y=d.clientHeight/2;const _=a.getPickRay(m,Dt);let g;const y=p.Z.rayEllipsoid(_,r);if((0,c.Z)(y))g=S.Z.getPoint(_,y.start,Pt);else{if(!(l>e._minimumTrackBallHeight)){e._looking=!0;const o=e._ellipsoid.geodeticSurfaceNormal(a.position,Bt);return Gt(e,t,n,o),void i.Z.clone(t,e._tiltCenterMousePosition)}{const e=p.Z.grazingAltitudeLocation(_,r);if(!(0,c.Z)(e))return;const t=r.cartesianToCartographic(e,Nt);t.height=0,g=r.cartographicToCartesian(t,Pt)}}const b=C.Z.eastNorthUpToFixedFrame(g,r,Rt),T=e._globe,w=e._ellipsoid;e._globe=void 0,e._ellipsoid=h.Z.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;const v=Z.Z.clone(a.transform,Ot);a._setTransform(b),mt(e,0,n,o.Z.UNIT_Z),a._setTransform(v),e._globe=T,e._ellipsoid=w;const x=w.maximumRadius;e._rotateFactor=1/x,e._rotateRateRangeAdjustment=x}(e,t,n)):function(e,t,n){const r=e._ellipsoid,s=e._scene,a=s.camera,u=e._cameraUnderground;let l,d,m;if(i.Z.equals(t,e._tiltCenterMousePosition))l=o.Z.clone(e._tiltCenter,Pt);else{if(l=Ze(e,t,Pt),!(0,c.Z)(l)){if(d=a.getPickRay(t,Dt),m=p.Z.rayEllipsoid(d,r),!(0,c.Z)(m)){if(r.cartesianToCartographic(a.position,Nt).height<=e._minimumTrackBallHeight){e._looking=!0;const o=e._ellipsoid.geodeticSurfaceNormal(a.position,Bt);Gt(e,t,n,o),i.Z.clone(t,e._tiltCenterMousePosition)}return}l=S.Z.getPoint(d,m.start,Pt)}u&&((0,c.Z)(d)||(d=a.getPickRay(t,Dt)),Te(e,d,l,l)),i.Z.clone(t,e._tiltCenterMousePosition),o.Z.clone(l,e._tiltCenter)}const g=s.canvas,y=Et;y.x=g.clientWidth/2,y.y=e._tiltCenterMousePosition.y,d=a.getPickRay(y,Dt);const T=o.Z.magnitude(l),w=o.Z.fromElements(T,T,T,ut),v=h.Z.fromCartesian3(w,lt);if(m=p.Z.rayEllipsoid(d,v),!(0,c.Z)(m))return;const x=o.Z.magnitude(d.origin)>T?m.start:m.stop,E=S.Z.getPoint(d,x,It),D=C.Z.eastNorthUpToFixedFrame(l,r,Rt),P=C.Z.eastNorthUpToFixedFrame(E,v,At),I=e._globe,R=e._ellipsoid;e._globe=void 0,e._ellipsoid=h.Z.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;let A=o.Z.UNIT_Z;const O=Z.Z.clone(a.transform,Ot);a._setTransform(P);const L=o.Z.cross(E,a.positionWC,Ye);if(o.Z.dot(a.rightWC,L)<0){const t=n.startPosition.y-n.endPosition.y;(u&&t<0||!u&&t>0)&&(A=void 0);const i=a.constrainedAxis;a.constrainedAxis=void 0,mt(e,0,n,A,!0,!1),a.constrainedAxis=i}else mt(e,0,n,A,!0,!1);if(a._setTransform(D),mt(e,0,n,A,!1,!0),(0,c.Z)(a.constrainedAxis)){const e=o.Z.cross(a.direction,a.constrainedAxis,Ye);o.Z.equalsEpsilon(e,o.Z.ZERO,f.Z.EPSILON6)||(o.Z.dot(e,a.right)<0&&o.Z.negate(e,e),o.Z.cross(e,a.direction,a.up),o.Z.cross(a.direction,a.up,a.right),o.Z.normalize(a.up,a.up),o.Z.normalize(a.right,a.right))}a._setTransform(O),e._globe=I,e._ellipsoid=R;const M=R.maximumRadius;e._rotateFactor=1/M,e._rotateRateRangeAdjustment=M;const N=o.Z.clone(a.positionWC,Ye);e.enableCollisionDetection&&Yt(e);if(!o.Z.equals(a.positionWC,N)){a._setTransform(P),a.worldToCameraCoordinatesPoint(N,N);const e=o.Z.magnitudeSquared(N);o.Z.magnitudeSquared(a.position)>e&&(o.Z.normalize(a.position,a.position),o.Z.multiplyByScalar(a.position,Math.sqrt(e),a.position));const t=o.Z.angleBetween(N,a.position),n=o.Z.cross(N,a.position,N);o.Z.normalize(n,n);const i=b.Z.fromAxisAngle(n,t,Lt),r=_.Z.fromQuaternion(i,Mt);_.Z.multiplyByVector(r,a.direction,a.direction),_.Z.multiplyByVector(r,a.up,a.up),o.Z.cross(a.direction,a.up,a.right),o.Z.cross(a.right,a.direction,a.up),a._setTransform(O)}}(e,t,n)}const zt=new s.Z;const kt=new i.Z,Vt=new i.Z,Ut=new S.Z,Ht=new S.Z,Wt=new o.Z,jt=new o.Z;function Gt(e,t,n,i){const r=e._scene.camera,s=kt;s.x=n.startPosition.x,s.y=0;const u=Vt;u.x=n.endPosition.x,u.y=0;let l,h,d=r.getPickRay(s,Ut),p=r.getPickRay(u,Ht),m=0;r.frustum instanceof g.Z?(l=d.origin,h=p.origin,o.Z.add(r.direction,l,l),o.Z.add(r.direction,h,h),o.Z.subtract(l,r.position,l),o.Z.subtract(h,r.position,h),o.Z.normalize(l,l),o.Z.normalize(h,h)):(l=d.direction,h=p.direction);let _=o.Z.dot(l,h);_<1&&(m=Math.acos(_)),m=n.startPosition.x>n.endPosition.x?-m:m;const Z=e._horizontalRotationAxis;if((0,c.Z)(i)?r.look(i,-m):(0,c.Z)(Z)?r.look(Z,-m):r.lookLeft(m),s.x=0,s.y=n.startPosition.y,u.x=0,u.y=n.endPosition.y,d=r.getPickRay(s,Ut),p=r.getPickRay(u,Ht),m=0,r.frustum instanceof g.Z?(l=d.origin,h=p.origin,o.Z.add(r.direction,l,l),o.Z.add(r.direction,h,h),o.Z.subtract(l,r.position,l),o.Z.subtract(h,r.position,h),o.Z.normalize(l,l),o.Z.normalize(h,h)):(l=d.direction,h=p.direction),_=o.Z.dot(l,h),_<1&&(m=Math.acos(_)),m=n.startPosition.y>n.endPosition.y?-m:m,i=(0,a.Z)(i,Z),(0,c.Z)(i)){const e=r.direction,t=o.Z.negate(i,Wt),n=o.Z.equalsEpsilon(e,i,f.Z.EPSILON2),s=o.Z.equalsEpsilon(e,t,f.Z.EPSILON2);if(n||s)(n&&m<0||s&&m>0)&&r.look(r.right,-m);else{_=o.Z.dot(e,i);let n=f.Z.acosClamped(_);m>0&&m>n&&(m=n-f.Z.EPSILON4),_=o.Z.dot(e,t),n=f.Z.acosClamped(_),m<0&&-m>n&&(m=-n+f.Z.EPSILON4);const s=o.Z.cross(i,e,jt);r.look(s,m)}}else r.lookUp(m)}const qt=new Z.Z,$t=new s.Z;function Yt(e){e._adjustedHeightForTerrain=!0;const t=e._scene,n=t.mode,i=t.globe;if(!(0,c.Z)(i)||n===E.Z.SCENE2D||n===E.Z.MORPHING)return;const r=t.camera,s=i.ellipsoid,a=t.mapProjection;let u,l;Z.Z.equals(r.transform,Z.Z.IDENTITY)||(u=Z.Z.clone(r.transform,qt),l=o.Z.magnitude(r.position),r._setTransform(Z.Z.IDENTITY));const h=$t;n===E.Z.SCENE3D?s.cartesianToCartographic(r.position,h):a.unproject(r.position,h);let d=!1;if(h.height<e._minimumCollisionTerrainHeight){const t=e._scene.globeHeight;if((0,c.Z)(t)){const i=t+e.minimumZoomDistance;h.height<i&&(h.height=i,n===E.Z.SCENE3D?s.cartographicToCartesian(h,r.position):a.project(h,r.position),d=!0)}}(0,c.Z)(u)&&(r._setTransform(u),d&&(o.Z.normalize(r.position,r.position),o.Z.negate(r.position,r.direction),o.Z.multiplyByScalar(r.position,Math.max(l,e.minimumZoomDistance),r.position),o.Z.normalize(r.direction,r.direction),o.Z.cross(r.direction,r.up,r.right),o.Z.cross(r.right,r.direction,r.up)))}I.prototype.onMap=function(){const e=this._scene,t=e.mode,n=e.camera;return t!==E.Z.COLUMBUS_VIEW||Math.abs(n.position.x)-this._maxCoord.x<0&&Math.abs(n.position.y)-this._maxCoord.y<0};const Qt=new o.Z,Xt=new o.Z;I.prototype.update=function(){const e=this._scene,t=e.camera,n=e.globe,i=e.mode;Z.Z.equals(t.transform,Z.Z.IDENTITY)?(this._globe=n,this._ellipsoid=(0,c.Z)(this._globe)?this._globe.ellipsoid:e.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=h.Z.UNIT_SPHERE);const r=(0,c.Z)(this._globe)?this._globe.terrainExaggeration:1,s=(0,c.Z)(this._globe)?this._globe.terrainExaggerationRelativeHeight:0;this._minimumCollisionTerrainHeight=T.Z.getHeight(this.minimumCollisionTerrainHeight,r,s),this._minimumPickingTerrainHeight=T.Z.getHeight(this.minimumPickingTerrainHeight,r,s),this._minimumTrackBallHeight=T.Z.getHeight(this.minimumTrackBallHeight,r,s),this._cameraUnderground=e.cameraUnderground&&(0,c.Z)(this._globe);const a=this._ellipsoid.maximumRadius;this._rotateFactor=1/a,this._rotateRateRangeAdjustment=a,this._adjustedHeightForTerrain=!1;const u=o.Z.clone(t.positionWC,Qt),l=o.Z.clone(t.directionWC,Xt);var d;if(i===E.Z.SCENE2D?function(e){const t=e._scene.mapMode2D===x.Z.ROTATE;Z.Z.equals(Z.Z.IDENTITY,e._scene.camera.transform)?(L(e,e.enableTranslate,e.translateEventTypes,ue,e.inertiaTranslate,"_lastInertiaTranslateMovement"),L(e,e.enableZoom,e.zoomEventTypes,le,e.inertiaZoom,"_lastInertiaZoomMovement"),t&&L(e,e.enableRotate,e.tiltEventTypes,pe,e.inertiaSpin,"_lastInertiaTiltMovement")):(L(e,e.enableZoom,e.zoomEventTypes,le,e.inertiaZoom,"_lastInertiaZoomMovement"),t&&L(e,e.enableRotate,e.translateEventTypes,pe,e.inertiaSpin,"_lastInertiaSpinMovement"))}(this):i===E.Z.COLUMBUS_VIEW?(this._horizontalRotationAxis=o.Z.UNIT_Z,function(e){const t=e._scene.camera;if(Z.Z.equals(Z.Z.IDENTITY,t.transform)){const n=e._tweens;if(e._aggregator.anyButtonDown&&n.removeAll(),L(e,e.enableTilt,e.tiltEventTypes,Qe,e.inertiaSpin,"_lastInertiaTiltMovement"),L(e,e.enableTranslate,e.translateEventTypes,Me,e.inertiaTranslate,"_lastInertiaTranslateMovement"),L(e,e.enableZoom,e.zoomEventTypes,et,e.inertiaZoom,"_lastInertiaZoomMovement"),L(e,e.enableLook,e.lookEventTypes,Gt),!e._aggregator.anyButtonDown&&!n.contains(e._tween)){const i=t.createCorrectPositionTween(e.bounceAnimationTime);(0,c.Z)(i)&&(e._tween=n.add(i))}n.update()}else L(e,e.enableRotate,e.rotateEventTypes,mt,e.inertiaSpin,"_lastInertiaSpinMovement"),L(e,e.enableZoom,e.zoomEventTypes,xt,e.inertiaZoom,"_lastInertiaZoomMovement")}(this)):i===E.Z.SCENE3D&&(this._horizontalRotationAxis=void 0,L(d=this,d.enableRotate,d.rotateEventTypes,pt,d.inertiaSpin,"_lastInertiaSpinMovement"),L(d,d.enableZoom,d.zoomEventTypes,xt,d.inertiaZoom,"_lastInertiaZoomMovement"),L(d,d.enableTilt,d.tiltEventTypes,Ft,d.inertiaSpin,"_lastInertiaTiltMovement"),L(d,d.enableLook,d.lookEventTypes,Gt)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain){(!o.Z.equals(u,t.positionWC)||!o.Z.equals(l,t.directionWC))&&Yt(this)}this._aggregator.reset()},I.prototype.isDestroyed=function(){return!1},I.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),(0,u.Z)(this)};const Kt=I}}]);