"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1461],{84315:(e,t,n)=>{n.d(t,{M:()=>P});var i=n(31191),r=n(89592),o=n(89762),a=n(96979),c=n(90360),s=n(70848),u=n(69958),l=n(62976),p=n(48620),d=n(12746),h=n(12352),f=n(93682),m=n(55159),g=n(73556),b=n(46110),_=n(23680),y=n(69890),v=n(24278),N=n(91878),S=function(e){function t(n){var i=e.call(this,n,s.u.Fragment)||this;return i._isUnique=!0,i.registerInput("intensity",o.E.Float,!0,s.u.Fragment),i.registerInput("indexOfRefraction",o.E.Float,!0,s.u.Fragment),i.registerInput("thickness",o.E.Float,!0,s.u.Fragment),i.registerOutput("iridescence",o.E.Object,s.u.Fragment,new f.C("iridescence",i,a.Ab.Output,t,"IridescenceBlock")),i}return(0,i.ZT)(t,e),t.prototype.initialize=function(e){e._excludeVariableName("iridescenceOut"),e._excludeVariableName("vIridescenceParams")},t.prototype.getClassName=function(){return"IridescenceBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thickness",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iridescence",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(){if(!this.intensity.isConnected){var e=new l.S("Iridescence intensity",s.u.Fragment,o.E.Float);e.value=1,e.output.connectTo(this.intensity);var t=new l.S("Iridescence ior",s.u.Fragment,o.E.Float);t.value=1.3,t.output.connectTo(this.indexOfRefraction);var n=new l.S("Iridescence thickness",s.u.Fragment,o.E.Float);n.value=400,n.output.connectTo(this.thickness)}},t.prototype.prepareDefines=function(t,n,i){e.prototype.prepareDefines.call(this,t,n,i),i.setValue("IRIDESCENCE",!0,!0),i.setValue("IRIDESCENCE_TEXTURE",!1,!0),i.setValue("IRIDESCENCE_THICKNESS_TEXTURE",!1,!0)},t.GetCode=function(e){var t="",n=(null==e?void 0:e.intensity.isConnected)?e.intensity.associatedVariableName:"1.",i=(null==e?void 0:e.indexOfRefraction.isConnected)?e.indexOfRefraction.associatedVariableName:N.B._DefaultIndexOfRefraction,r=(null==e?void 0:e.thickness.isConnected)?e.thickness.associatedVariableName:N.B._DefaultMaximumThickness;return t+="iridescenceOutParams iridescenceOut;\n\n        #ifdef IRIDESCENCE\n            iridescenceBlock(\n                vec4(".concat(n,", ").concat(i,", 1., ").concat(r,"),\n                NdotV,\n                specularEnvironmentR0,\n                #ifdef CLEARCOAT\n                    NdotVUnclamped,\n                #endif\n                iridescenceOut\n            );\n\n            float iridescenceIntensity = iridescenceOut.iridescenceIntensity;\n            specularEnvironmentR0 = iridescenceOut.specularEnvironmentR0;\n        #endif\r\n")},t.prototype._buildBlock=function(e){return e.target===s.u.Fragment&&(e.sharedData.bindableBlocks.push(this),e.sharedData.blocksWithDefines.push(this)),this},t.prototype.serialize=function(){return e.prototype.serialize.call(this)},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i)},t}(r.k);(0,p.H)("BABYLON.IridescenceBlock",S);var O=n(76882),C=n(15631),E={ambientClr:["finalAmbient",""],diffuseDir:["finalDiffuse",""],specularDir:["finalSpecularScaled","!defined(UNLIT) && defined(SPECULARTERM)"],clearcoatDir:["finalClearCoatScaled","!defined(UNLIT) && defined(CLEARCOAT)"],sheenDir:["finalSheenScaled","!defined(UNLIT) && defined(SHEEN)"],diffuseInd:["finalIrradiance","!defined(UNLIT) && defined(REFLECTION)"],specularInd:["finalRadianceScaled","!defined(UNLIT) && defined(REFLECTION)"],clearcoatInd:["clearcoatOut.finalClearCoatRadianceScaled","!defined(UNLIT) && defined(REFLECTION) && defined(CLEARCOAT)"],sheenInd:["sheenOut.finalSheenRadianceScaled","!defined(UNLIT) && defined(REFLECTION) && defined(SHEEN) && defined(ENVIRONMENTBRDF)"],refraction:["subSurfaceOut.finalRefraction","!defined(UNLIT) && defined(SS_REFRACTION)"],lighting:["finalColor.rgb",""],shadow:["shadow",""],alpha:["alpha",""]},P=function(e){function t(t){var n=e.call(this,t,s.u.VertexAndFragment)||this;return n._environmentBRDFTexture=null,n._metallicReflectanceColor=C.Wo.White(),n._metallicF0Factor=1,n.directIntensity=1,n.environmentIntensity=1,n.specularIntensity=1,n.lightFalloff=0,n.useAlphaTest=!1,n.alphaTestCutoff=.5,n.useAlphaBlending=!1,n.useRadianceOverAlpha=!0,n.useSpecularOverAlpha=!0,n.enableSpecularAntiAliasing=!1,n.realTimeFiltering=!1,n.realTimeFilteringQuality=8,n.useEnergyConservation=!0,n.useRadianceOcclusion=!0,n.useHorizonOcclusion=!0,n.unlit=!1,n.forceNormalForward=!1,n.debugMode=0,n.debugLimit=0,n.debugFactor=1,n._isUnique=!0,n.registerInput("worldPosition",o.E.Vector4,!1,s.u.Vertex),n.registerInput("worldNormal",o.E.Vector4,!1,s.u.Fragment),n.registerInput("view",o.E.Matrix,!1),n.registerInput("cameraPosition",o.E.Vector3,!1,s.u.Fragment),n.registerInput("perturbedNormal",o.E.Vector4,!0,s.u.Fragment),n.registerInput("baseColor",o.E.Color3,!0,s.u.Fragment),n.registerInput("metallic",o.E.Float,!1,s.u.Fragment),n.registerInput("roughness",o.E.Float,!1,s.u.Fragment),n.registerInput("ambientOcc",o.E.Float,!0,s.u.Fragment),n.registerInput("opacity",o.E.Float,!0,s.u.Fragment),n.registerInput("indexOfRefraction",o.E.Float,!0,s.u.Fragment),n.registerInput("ambientColor",o.E.Color3,!0,s.u.Fragment),n.registerInput("reflection",o.E.Object,!0,s.u.Fragment,new f.C("reflection",n,a.Ab.Input,y.J,"ReflectionBlock")),n.registerInput("clearcoat",o.E.Object,!0,s.u.Fragment,new f.C("clearcoat",n,a.Ab.Input,v.N,"ClearCoatBlock")),n.registerInput("sheen",o.E.Object,!0,s.u.Fragment,new f.C("sheen",n,a.Ab.Input,m.g,"SheenBlock")),n.registerInput("subsurface",o.E.Object,!0,s.u.Fragment,new f.C("subsurface",n,a.Ab.Input,O.l,"SubSurfaceBlock")),n.registerInput("anisotropy",o.E.Object,!0,s.u.Fragment,new f.C("anisotropy",n,a.Ab.Input,_.p,"AnisotropyBlock")),n.registerInput("iridescence",o.E.Object,!0,s.u.Fragment,new f.C("iridescence",n,a.Ab.Input,S,"IridescenceBlock")),n.registerOutput("ambientClr",o.E.Color3,s.u.Fragment),n.registerOutput("diffuseDir",o.E.Color3,s.u.Fragment),n.registerOutput("specularDir",o.E.Color3,s.u.Fragment),n.registerOutput("clearcoatDir",o.E.Color3,s.u.Fragment),n.registerOutput("sheenDir",o.E.Color3,s.u.Fragment),n.registerOutput("diffuseInd",o.E.Color3,s.u.Fragment),n.registerOutput("specularInd",o.E.Color3,s.u.Fragment),n.registerOutput("clearcoatInd",o.E.Color3,s.u.Fragment),n.registerOutput("sheenInd",o.E.Color3,s.u.Fragment),n.registerOutput("refraction",o.E.Color3,s.u.Fragment),n.registerOutput("lighting",o.E.Color3,s.u.Fragment),n.registerOutput("shadow",o.E.Float,s.u.Fragment),n.registerOutput("alpha",o.E.Float,s.u.Fragment),n}return(0,i.ZT)(t,e),t.prototype.initialize=function(e){e._excludeVariableName("vLightingIntensity"),e._excludeVariableName("geometricNormalW"),e._excludeVariableName("normalW"),e._excludeVariableName("faceNormal"),e._excludeVariableName("albedoOpacityOut"),e._excludeVariableName("surfaceAlbedo"),e._excludeVariableName("alpha"),e._excludeVariableName("aoOut"),e._excludeVariableName("baseColor"),e._excludeVariableName("reflectivityOut"),e._excludeVariableName("microSurface"),e._excludeVariableName("roughness"),e._excludeVariableName("NdotVUnclamped"),e._excludeVariableName("NdotV"),e._excludeVariableName("alphaG"),e._excludeVariableName("AARoughnessFactors"),e._excludeVariableName("environmentBrdf"),e._excludeVariableName("ambientMonochrome"),e._excludeVariableName("seo"),e._excludeVariableName("eho"),e._excludeVariableName("environmentRadiance"),e._excludeVariableName("irradianceVector"),e._excludeVariableName("environmentIrradiance"),e._excludeVariableName("diffuseBase"),e._excludeVariableName("specularBase"),e._excludeVariableName("preInfo"),e._excludeVariableName("info"),e._excludeVariableName("shadow"),e._excludeVariableName("finalDiffuse"),e._excludeVariableName("finalAmbient"),e._excludeVariableName("ambientOcclusionForDirectDiffuse"),e._excludeVariableName("finalColor"),e._excludeVariableName("vClipSpacePosition"),e._excludeVariableName("vDebugMode")},t.prototype.getClassName=function(){return"PBRMetallicRoughnessBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"perturbedNormal",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metallic",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roughness",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ambientOcc",{get:function(){return this._inputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opacity",{get:function(){return this._inputs[9]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return this._inputs[10]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._inputs[11]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflection",{get:function(){return this._inputs[12]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoat",{get:function(){return this._inputs[13]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheen",{get:function(){return this._inputs[14]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subsurface",{get:function(){return this._inputs[15]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anisotropy",{get:function(){return this._inputs[16]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"iridescence",{get:function(){return this._inputs[17]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ambientClr",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseDir",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularDir",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoatDir",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheenDir",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseInd",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"specularInd",{get:function(){return this._outputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearcoatInd",{get:function(){return this._outputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheenInd",{get:function(){return this._outputs[8]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refraction",{get:function(){return this._outputs[9]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lighting",{get:function(){return this._outputs[10]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadow",{get:function(){return this._outputs[11]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._outputs[12]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.cameraPosition.isConnected){var t=e.getInputBlockByPredicate((function(e){return e.systemValue===u.$.CameraPosition}));t||(t=new l.S("cameraPosition")).setAsSystemValue(u.$.CameraPosition),t.output.connectTo(this.cameraPosition)}if(!this.view.isConnected){var n=e.getInputBlockByPredicate((function(e){return e.systemValue===u.$.View}));n||(n=new l.S("view")).setAsSystemValue(u.$.View),n.output.connectTo(this.view)}},t.prototype.prepareDefines=function(e,t,n){n.setValue("PBR",!0),n.setValue("METALLICWORKFLOW",!0),n.setValue("DEBUGMODE",this.debugMode,!0),n.setValue("NORMALXYSCALE",!0),n.setValue("BUMP",this.perturbedNormal.isConnected,!0),n.setValue("LODBASEDMICROSFURACE",this._scene.getEngine().getCaps().textureLOD),n.setValue("ALBEDO",!1,!0),n.setValue("OPACITY",this.opacity.isConnected,!0),n.setValue("AMBIENT",!0,!0),n.setValue("AMBIENTINGRAYSCALE",!1,!0),n.setValue("REFLECTIVITY",!1,!0),n.setValue("AOSTOREINMETALMAPRED",!1,!0),n.setValue("METALLNESSSTOREINMETALMAPBLUE",!1,!0),n.setValue("ROUGHNESSSTOREINMETALMAPALPHA",!1,!0),n.setValue("ROUGHNESSSTOREINMETALMAPGREEN",!1,!0),this.lightFalloff===d.m.LIGHTFALLOFF_STANDARD?(n.setValue("USEPHYSICALLIGHTFALLOFF",!1),n.setValue("USEGLTFLIGHTFALLOFF",!1)):this.lightFalloff===d.m.LIGHTFALLOFF_GLTF?(n.setValue("USEPHYSICALLIGHTFALLOFF",!1),n.setValue("USEGLTFLIGHTFALLOFF",!0)):(n.setValue("USEPHYSICALLIGHTFALLOFF",!0),n.setValue("USEGLTFLIGHTFALLOFF",!1));var i=this.alphaTestCutoff.toString();n.setValue("ALPHABLEND",this.useAlphaBlending,!0),n.setValue("ALPHAFROMALBEDO",!1,!0),n.setValue("ALPHATEST",this.useAlphaTest,!0),n.setValue("ALPHATESTVALUE",i.indexOf(".")<0?i+".":i,!0),n.setValue("OPACITYRGB",!1,!0),n.setValue("RADIANCEOVERALPHA",this.useRadianceOverAlpha,!0),n.setValue("SPECULAROVERALPHA",this.useSpecularOverAlpha,!0),n.setValue("SPECULARAA",this._scene.getEngine().getCaps().standardDerivatives&&this.enableSpecularAntiAliasing,!0),n.setValue("REALTIME_FILTERING",this.realTimeFiltering,!0);var r=e.getScene();if(r.getEngine()._features.needTypeSuffixInShaderConstants?n.setValue("NUM_SAMPLES",this.realTimeFilteringQuality+"u",!0):n.setValue("NUM_SAMPLES",""+this.realTimeFilteringQuality,!0),n.setValue("BRDF_V_HEIGHT_CORRELATED",!0),n.setValue("MS_BRDF_ENERGY_CONSERVATION",this.useEnergyConservation,!0),n.setValue("RADIANCEOCCLUSION",this.useRadianceOcclusion,!0),n.setValue("HORIZONOCCLUSION",this.useHorizonOcclusion,!0),n.setValue("UNLIT",this.unlit,!0),n.setValue("FORCENORMALFORWARD",this.forceNormalForward,!0),this._environmentBRDFTexture&&b.k.ReflectionTextureEnabled?(n.setValue("ENVIRONMENTBRDF",!0),n.setValue("ENVIRONMENTBRDF_RGBD",this._environmentBRDFTexture.isRGBD,!0)):(n.setValue("ENVIRONMENTBRDF",!1),n.setValue("ENVIRONMENTBRDF_RGBD",!1)),n._areImageProcessingDirty&&t.imageProcessingConfiguration&&t.imageProcessingConfiguration.prepareDefines(n),n._areLightsDirty)if(this.light){var o={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};c.G.PrepareDefinesForLight(r,e,this.light,this._lightId,n,!0,o),o.needRebuild&&n.rebuild()}else c.G.PrepareDefinesForLights(r,e,n,!0,t.maxSimultaneousLights),n._needNormals=!0,c.G.PrepareDefinesForMultiview(r,n)},t.prototype.updateUniformsAndSamples=function(e,t,n,i){for(var r=0;r<t.maxSimultaneousLights&&n["LIGHT"+r];r++){var o=e.uniforms.indexOf("vLightData"+r)>=0;c.G.PrepareUniformsAndSamplersForLight(r,e.uniforms,e.samplers,n["PROJECTEDLIGHTTEXTURE"+r],i,o)}},t.prototype.isReady=function(e,t,n){return!(this._environmentBRDFTexture&&!this._environmentBRDFTexture.isReady())&&!(n._areImageProcessingDirty&&t.imageProcessingConfiguration&&!t.imageProcessingConfiguration.isReady())},t.prototype.bind=function(e,t,n){var i,r;if(n){var o=n.getScene();this.light?c.G.BindLight(this.light,this._lightId,o,e,!0):c.G.BindLights(o,n,e,!0,t.maxSimultaneousLights),e.setTexture(this._environmentBrdfSamplerName,this._environmentBRDFTexture),e.setFloat2("vDebugMode",this.debugLimit,this.debugFactor);var a=this._scene.ambientColor;a&&e.setColor3("ambientFromScene",a);var s=o.useRightHandedSystem===(null!=o._mirroredCameraPosition);e.setFloat(this._invertNormalName,s?-1:1),e.setFloat4("vLightingIntensity",this.directIntensity,1,this.environmentIntensity*this._scene.environmentIntensity,this.specularIntensity);var u=null!==(r=null===(i=this.indexOfRefraction.connectInputBlock)||void 0===i?void 0:i.value)&&void 0!==r?r:1.5,l=Math.pow((u-1)/(u+1),2);this._metallicReflectanceColor.scaleToRef(l*this._metallicF0Factor,C.zZ.Color3[0]);var p=this._metallicF0Factor;e.setColor4(this._vMetallicReflectanceFactorsName,C.zZ.Color3[0],p),t.imageProcessingConfiguration&&t.imageProcessingConfiguration.bind(e)}},t.prototype._injectVertexCode=function(e){var t,n,i=this.worldPosition,r="//".concat(this.name);this.light?(this._lightId=(void 0!==e.counters.lightCounter?e.counters.lightCounter:-1)+1,e.counters.lightCounter=this._lightId,e._emitFunctionFromInclude(e.supportUniformBuffers?"lightVxUboDeclaration":"lightVxFragmentDeclaration",r,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(e._emitFunctionFromInclude(e.supportUniformBuffers?"lightVxUboDeclaration":"lightVxFragmentDeclaration",r,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,e.sharedData.dynamicUniformBlocks.push(this));var o="v_"+i.associatedVariableName;e._emitVaryingFromString(o,"vec4")&&(e.compilationString+="".concat(o," = ").concat(i.associatedVariableName,";\r\n"));var a=this.reflection.isConnected?null===(t=this.reflection.connectedPoint)||void 0===t?void 0:t.ownerBlock:null;a&&(a.viewConnectionPoint=this.view),e.compilationString+=null!==(n=null==a?void 0:a.handleVertexSide(e))&&void 0!==n?n:"",e._emitUniformFromString("vDebugMode","vec2","defined(IGNORE) || DEBUGMODE > 0"),e._emitUniformFromString("ambientFromScene","vec3"),e._emitVaryingFromString("vClipSpacePosition","vec4","defined(IGNORE) || DEBUGMODE > 0")&&(e._injectAtEnd+="#if DEBUGMODE > 0\r\n",e._injectAtEnd+="vClipSpacePosition = gl_Position;\r\n",e._injectAtEnd+="#endif\r\n"),this.light?e.compilationString+=e._emitCodeFromInclude("shadowsVertex",r,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:i.associatedVariableName}]}):(e.compilationString+="vec4 worldPos = ".concat(i.associatedVariableName,";\r\n"),this.view.isConnected&&(e.compilationString+="mat4 view = ".concat(this.view.associatedVariableName,";\r\n")),e.compilationString+=e._emitCodeFromInclude("shadowsVertex",r,{repeatKey:"maxSimultaneousLights"}))},t.prototype._getAlbedoOpacityCode=function(){var e="albedoOpacityOutParams albedoOpacityOut;\r\n",t=this.baseColor.isConnected?this.baseColor.associatedVariableName:"vec3(1.)",n=this.opacity.isConnected?this.opacity.associatedVariableName:"1.";return e+="albedoOpacityBlock(\n                vec4(".concat(t,", 1.),\n            #ifdef ALBEDO\n                vec4(1.),\n                vec2(1., 1.),\n            #endif\n            #ifdef OPACITY\n                vec4(").concat(n,"),\n                vec2(1., 1.),\n            #endif\n                albedoOpacityOut\n            );\n\n            vec3 surfaceAlbedo = albedoOpacityOut.surfaceAlbedo;\n            float alpha = albedoOpacityOut.alpha;\r\n")},t.prototype._getAmbientOcclusionCode=function(){var e="ambientOcclusionOutParams aoOut;\r\n",t=this.ambientOcc.isConnected?this.ambientOcc.associatedVariableName:"1.";return e+="ambientOcclusionBlock(\n            #ifdef AMBIENT\n                vec3(".concat(t,"),\n                vec4(0., 1.0, 1.0, 0.),\n            #endif\n                aoOut\n            );\r\n")},t.prototype._getReflectivityCode=function(e){var t="reflectivityOutParams reflectivityOut;\r\n";return this._vMetallicReflectanceFactorsName=e._getFreeVariableName("vMetallicReflectanceFactors"),e._emitUniformFromString(this._vMetallicReflectanceFactorsName,"vec4"),t+="vec3 baseColor = surfaceAlbedo;\n\n            reflectivityBlock(\n                vec4(".concat(this.metallic.associatedVariableName,", ").concat(this.roughness.associatedVariableName,", 0., 0.),\n            #ifdef METALLICWORKFLOW\n                surfaceAlbedo,\n                ").concat(this._vMetallicReflectanceFactorsName,",\n            #endif\n            #ifdef REFLECTIVITY\n                vec3(0., 0., ").concat("1.","),\n                vec4(1.),\n            #endif\n            #if defined(METALLICWORKFLOW) && defined(REFLECTIVITY)  && defined(AOSTOREINMETALMAPRED)\n                aoOut.ambientOcclusionColor,\n            #endif\n            #ifdef MICROSURFACEMAP\n                microSurfaceTexel, <== not handled!\n            #endif\n                reflectivityOut\n            );\n\n            float microSurface = reflectivityOut.microSurface;\n            float roughness = reflectivityOut.roughness;\n\n            #ifdef METALLICWORKFLOW\n                surfaceAlbedo = reflectivityOut.surfaceAlbedo;\n            #endif\n            #if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n                aoOut.ambientOcclusionColor = reflectivityOut.ambientOcclusionColor;\n            #endif\r\n")},t.prototype._buildBlock=function(t){var n,i,r,o,a,c,u,l,p,h,f,m,b,_,y,N,C,P,I,x,A,T,V,F,B,R,z,k,D,w,L,M,j,U,H,K,G,W,Y,Z,X;e.prototype._buildBlock.call(this,t),this._scene=t.sharedData.scene,this._environmentBRDFTexture||(this._environmentBRDFTexture=(0,g.$)(this._scene));var q=this.reflection.isConnected?null===(n=this.reflection.connectedPoint)||void 0===n?void 0:n.ownerBlock:null;if(q&&(q.worldPositionConnectionPoint=this.worldPosition,q.cameraPositionConnectionPoint=this.cameraPosition,q.worldNormalConnectionPoint=this.worldNormal),t.target!==s.u.Fragment)return this._injectVertexCode(t),this;t.sharedData.forcedBindableBlocks.push(this),t.sharedData.blocksWithDefines.push(this),t.sharedData.blockingBlocks.push(this);var Q="//".concat(this.name),$="v_"+this.worldPosition.associatedVariableName,J=this.perturbedNormal;this._environmentBrdfSamplerName=t._getFreeVariableName("environmentBrdfSampler"),t._emit2DSampler(this._environmentBrdfSamplerName),t.sharedData.hints.needAlphaBlending=t.sharedData.hints.needAlphaBlending||this.useAlphaBlending,t.sharedData.hints.needAlphaTesting=t.sharedData.hints.needAlphaTesting||this.useAlphaTest,t._emitExtension("lod","#extension GL_EXT_shader_texture_lod : enable","defined(LODBASEDMICROSFURACE)"),t._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable"),t.uniforms.push("exposureLinear"),t.uniforms.push("contrast"),t.uniforms.push("vInverseScreenSize"),t.uniforms.push("vignetteSettings1"),t.uniforms.push("vignetteSettings2"),t.uniforms.push("vCameraColorCurveNegative"),t.uniforms.push("vCameraColorCurveNeutral"),t.uniforms.push("vCameraColorCurvePositive"),t.uniforms.push("txColorTransform"),t.uniforms.push("colorTransformSettings"),this.light?t._emitFunctionFromInclude(t.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",Q,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):t._emitFunctionFromInclude(t.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",Q,{repeatKey:"maxSimultaneousLights"}),t._emitFunctionFromInclude("helperFunctions",Q),t._emitFunctionFromInclude("importanceSampling",Q),t._emitFunctionFromInclude("pbrHelperFunctions",Q),t._emitFunctionFromInclude("imageProcessingDeclaration",Q),t._emitFunctionFromInclude("imageProcessingFunctions",Q),t._emitFunctionFromInclude("shadowsFragmentFunctions",Q,{replaceStrings:[{search:/vPositionW/g,replace:$+".xyz"}]}),t._emitFunctionFromInclude("pbrDirectLightingSetupFunctions",Q,{replaceStrings:[{search:/vPositionW/g,replace:$+".xyz"}]}),t._emitFunctionFromInclude("pbrDirectLightingFalloffFunctions",Q),t._emitFunctionFromInclude("pbrBRDFFunctions",Q,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:null!==(i=null==q?void 0:q._defineSkyboxName)&&void 0!==i?i:"REFLECTIONMAP_SKYBOX"}]}),t._emitFunctionFromInclude("hdrFilteringFunctions",Q),t._emitFunctionFromInclude("pbrDirectLightingFunctions",Q,{replaceStrings:[{search:/vPositionW/g,replace:$+".xyz"}]}),t._emitFunctionFromInclude("pbrIBLFunctions",Q),t._emitFunctionFromInclude("pbrBlockAlbedoOpacity",Q),t._emitFunctionFromInclude("pbrBlockReflectivity",Q),t._emitFunctionFromInclude("pbrBlockAmbientOcclusion",Q),t._emitFunctionFromInclude("pbrBlockAlphaFresnel",Q),t._emitFunctionFromInclude("pbrBlockAnisotropic",Q),t._emitUniformFromString("vLightingIntensity","vec4"),this._vNormalWName=t._getFreeVariableName("vNormalW"),t.compilationString+="vec4 ".concat(this._vNormalWName," = normalize(").concat(this.worldNormal.associatedVariableName,");\r\n"),t._registerTempVariable("viewDirectionW")&&(t.compilationString+="vec3 viewDirectionW = normalize(".concat(this.cameraPosition.associatedVariableName," - ").concat($,".xyz);\r\n")),t.compilationString+="vec3 geometricNormalW = ".concat(this._vNormalWName,".xyz;\r\n"),t.compilationString+="vec3 normalW = ".concat(J.isConnected?"normalize("+J.associatedVariableName+".xyz)":"geometricNormalW",";\r\n"),this._invertNormalName=t._getFreeVariableName("invertNormal"),t._emitUniformFromString(this._invertNormalName,"float"),t.compilationString+=t._emitCodeFromInclude("pbrBlockNormalFinal",Q,{replaceStrings:[{search:/vPositionW/g,replace:$+".xyz"},{search:/vEyePosition.w/g,replace:this._invertNormalName}]}),t.compilationString+=this._getAlbedoOpacityCode(),t.compilationString+=t._emitCodeFromInclude("depthPrePass",Q),t.compilationString+=this._getAmbientOcclusionCode(),t.compilationString+=t._emitCodeFromInclude("pbrBlockLightmapInit",Q),t.compilationString+="#ifdef UNLIT\n                vec3 diffuseBase = vec3(1., 1., 1.);\n            #else\r\n",t.compilationString+=this._getReflectivityCode(t),t.compilationString+=t._emitCodeFromInclude("pbrBlockGeometryInfo",Q,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:null!==(r=null==q?void 0:q._defineSkyboxName)&&void 0!==r?r:"REFLECTIONMAP_SKYBOX"},{search:/REFLECTIONMAP_3D/g,replace:null!==(o=null==q?void 0:q._define3DName)&&void 0!==o?o:"REFLECTIONMAP_3D"}]});var ee=this.anisotropy.isConnected?null===(a=this.anisotropy.connectedPoint)||void 0===a?void 0:a.ownerBlock:null;ee&&(ee.worldPositionConnectionPoint=this.worldPosition,ee.worldNormalConnectionPoint=this.worldNormal,t.compilationString+=ee.getCode(t,!this.perturbedNormal.isConnected)),q&&q.hasTexture&&(t.compilationString+=q.getCode(t,ee?"anisotropicOut.anisotropicNormal":"normalW")),t._emitFunctionFromInclude("pbrBlockReflection",Q,{replaceStrings:[{search:/computeReflectionCoords/g,replace:"computeReflectionCoordsPBR"},{search:/REFLECTIONMAP_3D/g,replace:null!==(c=null==q?void 0:q._define3DName)&&void 0!==c?c:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:null!==(u=null==q?void 0:q._defineOppositeZ)&&void 0!==u?u:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:null!==(l=null==q?void 0:q._defineProjectionName)&&void 0!==l?l:"REFLECTIONMAP_PROJECTION"},{search:/REFLECTIONMAP_SKYBOX/g,replace:null!==(p=null==q?void 0:q._defineSkyboxName)&&void 0!==p?p:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:null!==(h=null==q?void 0:q._defineLODReflectionAlpha)&&void 0!==h?h:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:null!==(f=null==q?void 0:q._defineLinearSpecularReflection)&&void 0!==f?f:"LINEARSPECULARREFLECTION"},{search:/vReflectionFilteringInfo/g,replace:null!==(m=null==q?void 0:q._vReflectionFilteringInfoName)&&void 0!==m?m:"vReflectionFilteringInfo"}]}),t.compilationString+=t._emitCodeFromInclude("pbrBlockReflectance0",Q,{replaceStrings:[{search:/metallicReflectanceFactors/g,replace:this._vMetallicReflectanceFactorsName}]});var te=this.sheen.isConnected?null===(b=this.sheen.connectedPoint)||void 0===b?void 0:b.ownerBlock:null;te&&(t.compilationString+=te.getCode(q)),t._emitFunctionFromInclude("pbrBlockSheen",Q,{replaceStrings:[{search:/REFLECTIONMAP_3D/g,replace:null!==(_=null==q?void 0:q._define3DName)&&void 0!==_?_:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_SKYBOX/g,replace:null!==(y=null==q?void 0:q._defineSkyboxName)&&void 0!==y?y:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:null!==(N=null==q?void 0:q._defineLODReflectionAlpha)&&void 0!==N?N:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:null!==(C=null==q?void 0:q._defineLinearSpecularReflection)&&void 0!==C?C:"LINEARSPECULARREFLECTION"}]});var ne=this.iridescence.isConnected?null===(P=this.iridescence.connectedPoint)||void 0===P?void 0:P.ownerBlock:null;t.compilationString+=S.GetCode(ne),t._emitFunctionFromInclude("pbrBlockIridescence",Q,{replaceStrings:[]});var ie=this.clearcoat.isConnected?null===(I=this.clearcoat.connectedPoint)||void 0===I?void 0:I.ownerBlock:null,re=!this.perturbedNormal.isConnected&&!this.anisotropy.isConnected,oe=this.perturbedNormal.isConnected&&(null===(A=(null===(x=this.perturbedNormal.connectedPoint)||void 0===x?void 0:x.ownerBlock).worldTangent)||void 0===A?void 0:A.isConnected),ae=this.anisotropy.isConnected&&(null===(T=this.anisotropy.connectedPoint)||void 0===T?void 0:T.ownerBlock).worldTangent.isConnected,ce=oe||!this.perturbedNormal.isConnected&&ae;t.compilationString+=v.N.GetCode(t,ie,q,$,re,ce,this.worldNormal.associatedVariableName),re&&(ce=null!==(V=null==ie?void 0:ie.worldTangent.isConnected)&&void 0!==V&&V),t._emitFunctionFromInclude("pbrBlockClearcoat",Q,{replaceStrings:[{search:/computeReflectionCoords/g,replace:"computeReflectionCoordsPBR"},{search:/REFLECTIONMAP_3D/g,replace:null!==(F=null==q?void 0:q._define3DName)&&void 0!==F?F:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:null!==(B=null==q?void 0:q._defineOppositeZ)&&void 0!==B?B:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:null!==(R=null==q?void 0:q._defineProjectionName)&&void 0!==R?R:"REFLECTIONMAP_PROJECTION"},{search:/REFLECTIONMAP_SKYBOX/g,replace:null!==(z=null==q?void 0:q._defineSkyboxName)&&void 0!==z?z:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:null!==(k=null==q?void 0:q._defineLODReflectionAlpha)&&void 0!==k?k:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:null!==(D=null==q?void 0:q._defineLinearSpecularReflection)&&void 0!==D?D:"LINEARSPECULARREFLECTION"},{search:/defined\(TANGENT\)/g,replace:ce?"defined(TANGENT)":"defined(IGNORE)"}]}),t.compilationString+=t._emitCodeFromInclude("pbrBlockReflectance",Q,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:null!==(w=null==q?void 0:q._defineSkyboxName)&&void 0!==w?w:"REFLECTIONMAP_SKYBOX"},{search:/REFLECTIONMAP_3D/g,replace:null!==(L=null==q?void 0:q._define3DName)&&void 0!==L?L:"REFLECTIONMAP_3D"}]});var se=this.subsurface.isConnected?null===(M=this.subsurface.connectedPoint)||void 0===M?void 0:M.ownerBlock:null,ue=this.subsurface.isConnected?null===(U=(null===(j=this.subsurface.connectedPoint)||void 0===j?void 0:j.ownerBlock).refraction.connectedPoint)||void 0===U?void 0:U.ownerBlock:null;ue&&(ue.viewConnectionPoint=this.view,ue.indexOfRefractionConnectionPoint=this.indexOfRefraction),t.compilationString+=O.l.GetCode(t,se,q,$),t._emitFunctionFromInclude("pbrBlockSubSurface",Q,{replaceStrings:[{search:/REFLECTIONMAP_3D/g,replace:null!==(H=null==q?void 0:q._define3DName)&&void 0!==H?H:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:null!==(K=null==q?void 0:q._defineOppositeZ)&&void 0!==K?K:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:null!==(G=null==q?void 0:q._defineProjectionName)&&void 0!==G?G:"REFLECTIONMAP_PROJECTION"},{search:/SS_REFRACTIONMAP_3D/g,replace:null!==(W=null==ue?void 0:ue._define3DName)&&void 0!==W?W:"SS_REFRACTIONMAP_3D"},{search:/SS_LODINREFRACTIONALPHA/g,replace:null!==(Y=null==ue?void 0:ue._defineLODRefractionAlpha)&&void 0!==Y?Y:"SS_LODINREFRACTIONALPHA"},{search:/SS_LINEARSPECULARREFRACTION/g,replace:null!==(Z=null==ue?void 0:ue._defineLinearSpecularRefraction)&&void 0!==Z?Z:"SS_LINEARSPECULARREFRACTION"},{search:/SS_REFRACTIONMAP_OPPOSITEZ/g,replace:null!==(X=null==ue?void 0:ue._defineOppositeZ)&&void 0!==X?X:"SS_REFRACTIONMAP_OPPOSITEZ"}]}),t.compilationString+=t._emitCodeFromInclude("pbrBlockDirectLighting",Q),this.light?t.compilationString+=t._emitCodeFromInclude("lightFragment",Q,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):t.compilationString+=t._emitCodeFromInclude("lightFragment",Q,{repeatKey:"maxSimultaneousLights"}),t.compilationString+=t._emitCodeFromInclude("pbrBlockFinalLitComponents",Q),t.compilationString+="#endif\r\n";var le=this.ambientColor.isConnected?this.ambientColor.associatedVariableName:"vec3(0., 0., 0.)",pe=d.m.DEFAULT_AO_ON_ANALYTICAL_LIGHTS.toString();-1===pe.indexOf(".")&&(pe+="."),t.compilationString+=t._emitCodeFromInclude("pbrBlockFinalUnlitComponents",Q,{replaceStrings:[{search:/vec3 finalEmissive[\s\S]*?finalEmissive\*=vLightingIntensity\.y;/g,replace:""},{search:/vAmbientColor/g,replace:le+" * ambientFromScene"},{search:/vAmbientInfos\.w/g,replace:pe}]}),t.compilationString+=t._emitCodeFromInclude("pbrBlockFinalColorComposition",Q,{replaceStrings:[{search:/finalEmissive/g,replace:"vec3(0.)"}]}),t.compilationString+=t._emitCodeFromInclude("pbrBlockImageProcessing",Q,{replaceStrings:[{search:/visibility/g,replace:"1."}]}),t.compilationString+=t._emitCodeFromInclude("pbrDebug",Q,{replaceStrings:[{search:/vNormalW/g,replace:this._vNormalWName},{search:/vPositionW/g,replace:$},{search:/albedoTexture\.rgb;/g,replace:"vec3(1.);\r\ngl_FragColor.rgb = toGammaSpace(gl_FragColor.rgb);\r\n"}]});for(var de=0,he=this._outputs;de<he.length;de++){var fe=he[de];if(fe.hasEndpoints){var me=E[fe.name];if(me){var ge=me[0],be=me[1];be&&(t.compilationString+="#if ".concat(be,"\r\n")),t.compilationString+="".concat(this._declareOutput(fe,t)," = ").concat(ge,";\r\n"),be&&(t.compilationString+="#else\r\n",t.compilationString+="".concat(this._declareOutput(fe,t)," = vec3(0.);\r\n"),t.compilationString+="#endif\r\n")}}}return this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);return t+="".concat(this._codeVariableName,".lightFalloff = ").concat(this.lightFalloff,";\r\n"),t+="".concat(this._codeVariableName,".useAlphaTest = ").concat(this.useAlphaTest,";\r\n"),t+="".concat(this._codeVariableName,".alphaTestCutoff = ").concat(this.alphaTestCutoff,";\r\n"),t+="".concat(this._codeVariableName,".useAlphaBlending = ").concat(this.useAlphaBlending,";\r\n"),t+="".concat(this._codeVariableName,".useRadianceOverAlpha = ").concat(this.useRadianceOverAlpha,";\r\n"),t+="".concat(this._codeVariableName,".useSpecularOverAlpha = ").concat(this.useSpecularOverAlpha,";\r\n"),t+="".concat(this._codeVariableName,".enableSpecularAntiAliasing = ").concat(this.enableSpecularAntiAliasing,";\r\n"),t+="".concat(this._codeVariableName,".realTimeFiltering = ").concat(this.realTimeFiltering,";\r\n"),t+="".concat(this._codeVariableName,".realTimeFilteringQuality = ").concat(this.realTimeFilteringQuality,";\r\n"),t+="".concat(this._codeVariableName,".useEnergyConservation = ").concat(this.useEnergyConservation,";\r\n"),t+="".concat(this._codeVariableName,".useRadianceOcclusion = ").concat(this.useRadianceOcclusion,";\r\n"),t+="".concat(this._codeVariableName,".useHorizonOcclusion = ").concat(this.useHorizonOcclusion,";\r\n"),t+="".concat(this._codeVariableName,".unlit = ").concat(this.unlit,";\r\n"),t+="".concat(this._codeVariableName,".forceNormalForward = ").concat(this.forceNormalForward,";\r\n"),t+="".concat(this._codeVariableName,".debugMode = ").concat(this.debugMode,";\r\n"),t+="".concat(this._codeVariableName,".debugLimit = ").concat(this.debugLimit,";\r\n"),t+="".concat(this._codeVariableName,".debugFactor = ").concat(this.debugFactor,";\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return this.light&&(t.lightId=this.light.id),t.lightFalloff=this.lightFalloff,t.useAlphaTest=this.useAlphaTest,t.alphaTestCutoff=this.alphaTestCutoff,t.useAlphaBlending=this.useAlphaBlending,t.useRadianceOverAlpha=this.useRadianceOverAlpha,t.useSpecularOverAlpha=this.useSpecularOverAlpha,t.enableSpecularAntiAliasing=this.enableSpecularAntiAliasing,t.realTimeFiltering=this.realTimeFiltering,t.realTimeFilteringQuality=this.realTimeFilteringQuality,t.useEnergyConservation=this.useEnergyConservation,t.useRadianceOcclusion=this.useRadianceOcclusion,t.useHorizonOcclusion=this.useHorizonOcclusion,t.unlit=this.unlit,t.forceNormalForward=this.forceNormalForward,t.debugMode=this.debugMode,t.debugLimit=this.debugLimit,t.debugFactor=this.debugFactor,t},t.prototype._deserialize=function(t,n,i){var r,o;e.prototype._deserialize.call(this,t,n,i),t.lightId&&(this.light=n.getLightById(t.lightId)),this.lightFalloff=null!==(r=t.lightFalloff)&&void 0!==r?r:0,this.useAlphaTest=t.useAlphaTest,this.alphaTestCutoff=t.alphaTestCutoff,this.useAlphaBlending=t.useAlphaBlending,this.useRadianceOverAlpha=t.useRadianceOverAlpha,this.useSpecularOverAlpha=t.useSpecularOverAlpha,this.enableSpecularAntiAliasing=t.enableSpecularAntiAliasing,this.realTimeFiltering=!!t.realTimeFiltering,this.realTimeFilteringQuality=null!==(o=t.realTimeFilteringQuality)&&void 0!==o?o:8,this.useEnergyConservation=t.useEnergyConservation,this.useRadianceOcclusion=t.useRadianceOcclusion,this.useHorizonOcclusion=t.useHorizonOcclusion,this.unlit=t.unlit,this.forceNormalForward=!!t.forceNormalForward,this.debugMode=t.debugMode,this.debugLimit=t.debugLimit,this.debugFactor=t.debugFactor},(0,i.gn)([(0,h.p)("Direct lights",h.U.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"directIntensity",void 0),(0,i.gn)([(0,h.p)("Environment lights",h.U.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"environmentIntensity",void 0),(0,i.gn)([(0,h.p)("Specular highlights",h.U.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"specularIntensity",void 0),(0,i.gn)([(0,h.p)("Light falloff",h.U.List,"LIGHTING & COLORS",{notifiers:{update:!0},options:[{label:"Physical",value:d.m.LIGHTFALLOFF_PHYSICAL},{label:"GLTF",value:d.m.LIGHTFALLOFF_GLTF},{label:"Standard",value:d.m.LIGHTFALLOFF_STANDARD}]})],t.prototype,"lightFalloff",void 0),(0,i.gn)([(0,h.p)("Alpha Testing",h.U.Boolean,"OPACITY")],t.prototype,"useAlphaTest",void 0),(0,i.gn)([(0,h.p)("Alpha CutOff",h.U.Float,"OPACITY",{min:0,max:1,notifiers:{update:!0}})],t.prototype,"alphaTestCutoff",void 0),(0,i.gn)([(0,h.p)("Alpha blending",h.U.Boolean,"OPACITY")],t.prototype,"useAlphaBlending",void 0),(0,i.gn)([(0,h.p)("Radiance over alpha",h.U.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"useRadianceOverAlpha",void 0),(0,i.gn)([(0,h.p)("Specular over alpha",h.U.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"useSpecularOverAlpha",void 0),(0,i.gn)([(0,h.p)("Specular anti-aliasing",h.U.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"enableSpecularAntiAliasing",void 0),(0,i.gn)([(0,h.p)("Realtime filtering",h.U.Boolean,"RENDERING",{notifiers:{update:!0}})],t.prototype,"realTimeFiltering",void 0),(0,i.gn)([(0,h.p)("Realtime filtering quality",h.U.List,"RENDERING",{notifiers:{update:!0},options:[{label:"Low",value:8},{label:"Medium",value:16},{label:"High",value:64}]})],t.prototype,"realTimeFilteringQuality",void 0),(0,i.gn)([(0,h.p)("Energy Conservation",h.U.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useEnergyConservation",void 0),(0,i.gn)([(0,h.p)("Radiance occlusion",h.U.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useRadianceOcclusion",void 0),(0,i.gn)([(0,h.p)("Horizon occlusion",h.U.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useHorizonOcclusion",void 0),(0,i.gn)([(0,h.p)("Unlit",h.U.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"unlit",void 0),(0,i.gn)([(0,h.p)("Force normal forward",h.U.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"forceNormalForward",void 0),(0,i.gn)([(0,h.p)("Debug mode",h.U.List,"DEBUG",{notifiers:{update:!0},options:[{label:"None",value:0},{label:"Normalized position",value:1},{label:"Normals",value:2},{label:"Tangents",value:3},{label:"Bitangents",value:4},{label:"Bump Normals",value:5},{label:"ClearCoat Normals",value:8},{label:"ClearCoat Tangents",value:9},{label:"ClearCoat Bitangents",value:10},{label:"Anisotropic Normals",value:11},{label:"Anisotropic Tangents",value:12},{label:"Anisotropic Bitangents",value:13},{label:"Env Refraction",value:40},{label:"Env Reflection",value:41},{label:"Env Clear Coat",value:42},{label:"Direct Diffuse",value:50},{label:"Direct Specular",value:51},{label:"Direct Clear Coat",value:52},{label:"Direct Sheen",value:53},{label:"Env Irradiance",value:54},{label:"Surface Albedo",value:60},{label:"Reflectance 0",value:61},{label:"Metallic",value:62},{label:"Metallic F0",value:71},{label:"Roughness",value:63},{label:"AlphaG",value:64},{label:"NdotV",value:65},{label:"ClearCoat Color",value:66},{label:"ClearCoat Roughness",value:67},{label:"ClearCoat NdotV",value:68},{label:"Transmittance",value:69},{label:"Refraction Transmittance",value:70},{label:"SEO",value:80},{label:"EHO",value:81},{label:"Energy Factor",value:82},{label:"Specular Reflectance",value:83},{label:"Clear Coat Reflectance",value:84},{label:"Sheen Reflectance",value:85},{label:"Luminance Over Alpha",value:86},{label:"Alpha",value:87}]})],t.prototype,"debugMode",void 0),(0,i.gn)([(0,h.p)("Split position",h.U.Float,"DEBUG",{min:-1,max:1,notifiers:{update:!0}})],t.prototype,"debugLimit",void 0),(0,i.gn)([(0,h.p)("Output factor",h.U.Float,"DEBUG",{min:0,max:5,notifiers:{update:!0}})],t.prototype,"debugFactor",void 0),t}(r.k);(0,p.H)("BABYLON.PBRMetallicRoughnessBlock",P)},69890:(e,t,n)=>{n.d(t,{J:()=>h});var i=n(31191),r=n(89762),o=n(96979),a=n(70848),c=n(48620),s=n(93682),u=n(44264),l=n(73803),p=n(12352),d=n(72739),h=function(e){function t(n){var i=e.call(this,n)||this;return i.useSphericalHarmonics=!0,i.forceIrradianceInFragment=!1,i._isUnique=!0,i.registerInput("position",r.E.Vector3,!1,a.u.Vertex),i.registerInput("world",r.E.Matrix,!1,a.u.Vertex),i.registerInput("color",r.E.Color3,!0,a.u.Fragment),i.registerOutput("reflection",r.E.Object,a.u.Fragment,new s.C("reflection",i,o.Ab.Output,t,"ReflectionBlock")),i}return(0,i.ZT)(t,e),t.prototype.getClassName=function(){return"ReflectionBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this.worldPositionConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this.worldNormalConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this.cameraPositionConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this.viewConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflection",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasTexture",{get:function(){return!!this._getTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionColor",{get:function(){return this.color.isConnected?this.color.associatedVariableName:"vec3(1., 1., 1.)"},enumerable:!1,configurable:!0}),t.prototype._getTexture=function(){return this.texture?this.texture:this._scene.environmentTexture},t.prototype.prepareDefines=function(t,n,i){e.prototype.prepareDefines.call(this,t,n,i);var r=this._getTexture(),o=r&&r.getTextureMatrix;i.setValue("REFLECTION",o,!0),o&&(i.setValue(this._defineLODReflectionAlpha,r.lodLevelInAlpha,!0),i.setValue(this._defineLinearSpecularReflection,r.linearSpecularLOD,!0),i.setValue(this._defineOppositeZ,this._scene.useRightHandedSystem?!r.invertZ:r.invertZ,!0),i.setValue("SPHERICAL_HARMONICS",this.useSphericalHarmonics,!0),i.setValue("GAMMAREFLECTION",r.gammaSpace,!0),i.setValue("RGBDREFLECTION",r.isRGBD,!0),r&&r.coordinatesMode!==l.x.SKYBOX_MODE&&r.isCube&&(i.setValue("USESPHERICALFROMREFLECTIONMAP",!0),i.setValue("USEIRRADIANCEMAP",!1),this.forceIrradianceInFragment||this._scene.getEngine().getCaps().maxVaryingVectors<=8?i.setValue("USESPHERICALINVERTEX",!1):i.setValue("USESPHERICALINVERTEX",!0)))},t.prototype.bind=function(t,n,i,r){e.prototype.bind.call(this,t,n,i);var o=this._getTexture();if(o&&r){o.isCube?t.setTexture(this._cubeSamplerName,o):t.setTexture(this._2DSamplerName,o);var a=o.getSize().width;t.setFloat3(this._vReflectionMicrosurfaceInfosName,a,o.lodGenerationScale,o.lodGenerationOffset),t.setFloat2(this._vReflectionFilteringInfoName,a,d.R.Log2(a));var c=r.materialDefines,s=o.sphericalPolynomial;if(c.USESPHERICALFROMREFLECTIONMAP&&s)if(c.SPHERICAL_HARMONICS){var u=s.preScaledHarmonics;t.setVector3("vSphericalL00",u.l00),t.setVector3("vSphericalL1_1",u.l1_1),t.setVector3("vSphericalL10",u.l10),t.setVector3("vSphericalL11",u.l11),t.setVector3("vSphericalL2_2",u.l2_2),t.setVector3("vSphericalL2_1",u.l2_1),t.setVector3("vSphericalL20",u.l20),t.setVector3("vSphericalL21",u.l21),t.setVector3("vSphericalL22",u.l22)}else t.setFloat3("vSphericalX",s.x.x,s.x.y,s.x.z),t.setFloat3("vSphericalY",s.y.x,s.y.y,s.y.z),t.setFloat3("vSphericalZ",s.z.x,s.z.y,s.z.z),t.setFloat3("vSphericalXX_ZZ",s.xx.x-s.zz.x,s.xx.y-s.zz.y,s.xx.z-s.zz.z),t.setFloat3("vSphericalYY_ZZ",s.yy.x-s.zz.x,s.yy.y-s.zz.y,s.yy.z-s.zz.z),t.setFloat3("vSphericalZZ",s.zz.x,s.zz.y,s.zz.z),t.setFloat3("vSphericalXY",s.xy.x,s.xy.y,s.xy.z),t.setFloat3("vSphericalYZ",s.yz.x,s.yz.y,s.yz.z),t.setFloat3("vSphericalZX",s.zx.x,s.zx.y,s.zx.z)}},t.prototype.handleVertexSide=function(t){var n=e.prototype.handleVertexSide.call(this,t);t._emitFunctionFromInclude("harmonicsFunctions","//".concat(this.name),{replaceStrings:[{search:/uniform vec3 vSphericalL00;[\s\S]*?uniform vec3 vSphericalL22;/g,replace:""},{search:/uniform vec3 vSphericalX;[\s\S]*?uniform vec3 vSphericalZX;/g,replace:""}]});var i=t._getFreeVariableName("reflectionVector");return this._vEnvironmentIrradianceName=t._getFreeVariableName("vEnvironmentIrradiance"),t._emitVaryingFromString(this._vEnvironmentIrradianceName,"vec3","defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)"),t._emitUniformFromString("vSphericalL00","vec3","SPHERICAL_HARMONICS"),t._emitUniformFromString("vSphericalL1_1","vec3","SPHERICAL_HARMONICS"),t._emitUniformFromString("vSphericalL10","vec3","SPHERICAL_HARMONICS"),t._emitUniformFromString("vSphericalL11","vec3","SPHERICAL_HARMONICS"),t._emitUniformFromString("vSphericalL2_2","vec3","SPHERICAL_HARMONICS"),t._emitUniformFromString("vSphericalL2_1","vec3","SPHERICAL_HARMONICS"),t._emitUniformFromString("vSphericalL20","vec3","SPHERICAL_HARMONICS"),t._emitUniformFromString("vSphericalL21","vec3","SPHERICAL_HARMONICS"),t._emitUniformFromString("vSphericalL22","vec3","SPHERICAL_HARMONICS"),t._emitUniformFromString("vSphericalX","vec3","SPHERICAL_HARMONICS",!0),t._emitUniformFromString("vSphericalY","vec3","SPHERICAL_HARMONICS",!0),t._emitUniformFromString("vSphericalZ","vec3","SPHERICAL_HARMONICS",!0),t._emitUniformFromString("vSphericalXX_ZZ","vec3","SPHERICAL_HARMONICS",!0),t._emitUniformFromString("vSphericalYY_ZZ","vec3","SPHERICAL_HARMONICS",!0),t._emitUniformFromString("vSphericalZZ","vec3","SPHERICAL_HARMONICS",!0),t._emitUniformFromString("vSphericalXY","vec3","SPHERICAL_HARMONICS",!0),t._emitUniformFromString("vSphericalYZ","vec3","SPHERICAL_HARMONICS",!0),t._emitUniformFromString("vSphericalZX","vec3","SPHERICAL_HARMONICS",!0),n+="#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\n                vec3 ".concat(i," = vec3(").concat(this._reflectionMatrixName," * vec4(normalize(").concat(this.worldNormal.associatedVariableName,").xyz, 0)).xyz;\n                #ifdef ").concat(this._defineOppositeZ,"\n                    ").concat(i,".z *= -1.0;\n                #endif\n                ").concat(this._vEnvironmentIrradianceName," = computeEnvironmentIrradiance(").concat(i,");\n            #endif\r\n")},t.prototype.getCode=function(e,t){var n="";this.handleFragmentSideInits(e),e._emitFunctionFromInclude("harmonicsFunctions","//".concat(this.name),{replaceStrings:[{search:/uniform vec3 vSphericalL00;[\s\S]*?uniform vec3 vSphericalL22;/g,replace:""},{search:/uniform vec3 vSphericalX;[\s\S]*?uniform vec3 vSphericalZX;/g,replace:""}]}),e._emitFunction("sampleReflection","\n            #ifdef ".concat(this._define3DName,"\n                #define sampleReflection(s, c) textureCube(s, c)\n            #else\n                #define sampleReflection(s, c) texture2D(s, c)\n            #endif\r\n"),"//".concat(this.name)),e._emitFunction("sampleReflectionLod","\n            #ifdef ".concat(this._define3DName,"\n                #define sampleReflectionLod(s, c, l) textureCubeLodEXT(s, c, l)\n            #else\n                #define sampleReflectionLod(s, c, l) texture2DLodEXT(s, c, l)\n            #endif\r\n"),"//".concat(this.name));var i="\n            vec3 computeReflectionCoordsPBR(vec4 worldPos, vec3 worldNormal) {\n                ".concat(this.handleFragmentSideCodeReflectionCoords("worldNormal","worldPos",!0,!0),"\n                return ").concat(this._reflectionVectorName,";\n            }\r\n");return e._emitFunction("computeReflectionCoordsPBR",i,"//".concat(this.name)),this._vReflectionMicrosurfaceInfosName=e._getFreeVariableName("vReflectionMicrosurfaceInfos"),e._emitUniformFromString(this._vReflectionMicrosurfaceInfosName,"vec3"),this._vReflectionInfosName=e._getFreeVariableName("vReflectionInfos"),this._vReflectionFilteringInfoName=e._getFreeVariableName("vReflectionFilteringInfo"),e._emitUniformFromString(this._vReflectionFilteringInfoName,"vec2"),n+="#ifdef REFLECTION\n            vec2 ".concat(this._vReflectionInfosName," = vec2(1., 0.);\n\n            reflectionOutParams reflectionOut;\n\n            reflectionBlock(\n                ").concat("v_"+this.worldPosition.associatedVariableName+".xyz",",\n                ").concat(t,",\n                alphaG,\n                ").concat(this._vReflectionMicrosurfaceInfosName,",\n                ").concat(this._vReflectionInfosName,",\n                ").concat(this.reflectionColor,",\n            #ifdef ANISOTROPIC\n                anisotropicOut,\n            #endif\n            #if defined(").concat(this._defineLODReflectionAlpha,") && !defined(").concat(this._defineSkyboxName,")\n                NdotVUnclamped,\n            #endif\n            #ifdef ").concat(this._defineLinearSpecularReflection,"\n                roughness,\n            #endif\n            #ifdef ").concat(this._define3DName,"\n                ").concat(this._cubeSamplerName,",\n            #else\n                ").concat(this._2DSamplerName,",\n            #endif\n            #if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n                ").concat(this._vEnvironmentIrradianceName,",\n            #endif\n            #ifdef USESPHERICALFROMREFLECTIONMAP\n                #if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n                    ").concat(this._reflectionMatrixName,",\n                #endif\n            #endif\n            #ifdef USEIRRADIANCEMAP\n                irradianceSampler, // ** not handled **\n            #endif\n            #ifndef LODBASEDMICROSFURACE\n                #ifdef ").concat(this._define3DName,"\n                    ").concat(this._cubeSamplerName,",\n                    ").concat(this._cubeSamplerName,",\n                #else\n                    ").concat(this._2DSamplerName,",\n                    ").concat(this._2DSamplerName,",\n                #endif\n            #endif\n            #ifdef REALTIME_FILTERING\n                ").concat(this._vReflectionFilteringInfoName,",\n            #endif\n                reflectionOut\n            );\n        #endif\r\n")},t.prototype._buildBlock=function(e){return this._scene=e.sharedData.scene,e.target!==a.u.Fragment&&(this._defineLODReflectionAlpha=e._getFreeDefineName("LODINREFLECTIONALPHA"),this._defineLinearSpecularReflection=e._getFreeDefineName("LINEARSPECULARREFLECTION")),this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);return this.texture&&(t+="".concat(this._codeVariableName,".texture.gammaSpace = ").concat(this.texture.gammaSpace,";\r\n")),t+="".concat(this._codeVariableName,".useSphericalHarmonics = ").concat(this.useSphericalHarmonics,";\r\n"),t+="".concat(this._codeVariableName,".forceIrradianceInFragment = ").concat(this.forceIrradianceInFragment,";\r\n")},t.prototype.serialize=function(){var t,n,i=e.prototype.serialize.call(this);return i.useSphericalHarmonics=this.useSphericalHarmonics,i.forceIrradianceInFragment=this.forceIrradianceInFragment,i.gammaSpace=null===(n=null===(t=this.texture)||void 0===t?void 0:t.gammaSpace)||void 0===n||n,i},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),this.useSphericalHarmonics=t.useSphericalHarmonics,this.forceIrradianceInFragment=t.forceIrradianceInFragment,this.texture&&(this.texture.gammaSpace=t.gammaSpace)},(0,i.gn)([(0,p.p)("Spherical Harmonics",p.U.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useSphericalHarmonics",void 0),(0,i.gn)([(0,p.p)("Force irradiance in fragment",p.U.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"forceIrradianceInFragment",void 0),t}(u.W);(0,c.H)("BABYLON.ReflectionBlock",h)},45073:(e,t,n)=>{n.d(t,{b:()=>g});var i=n(31191),r=n(89762),o=n(96979),a=n(70848),c=n(48620),s=n(62976),u=n(93682),l=n(12352),p=n(89592),d=n(44394),h=n(73803),f=n(69958),m=n(72739),g=function(e){function t(n){var i=e.call(this,n,a.u.Fragment)||this;return i.linkRefractionWithTransparency=!1,i.invertRefractionY=!1,i.useThicknessAsDepth=!1,i._isUnique=!0,i.registerInput("intensity",r.E.Float,!1,a.u.Fragment),i.registerInput("tintAtDistance",r.E.Float,!0,a.u.Fragment),i.registerInput("volumeIndexOfRefraction",r.E.Float,!0,a.u.Fragment),i.registerOutput("refraction",r.E.Object,a.u.Fragment,new u.C("refraction",i,o.Ab.Output,t,"RefractionBlock")),i}return(0,i.ZT)(t,e),t.prototype.initialize=function(e){e._excludeVariableName("vRefractionPosition"),e._excludeVariableName("vRefractionSize")},t.prototype.getClassName=function(){return"RefractionBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintAtDistance",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volumeIndexOfRefraction",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this.viewConnectionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refraction",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasTexture",{get:function(){return!!this._getTexture()},enumerable:!1,configurable:!0}),t.prototype._getTexture=function(){return this.texture?this.texture:this._scene.environmentTexture},t.prototype.autoConfigure=function(e){if(!this.intensity.isConnected){var t=new s.S("Refraction intensity",a.u.Fragment,r.E.Float);t.value=1,t.output.connectTo(this.intensity)}if(this.view&&!this.view.isConnected){var n=e.getInputBlockByPredicate((function(e){return e.systemValue===f.$.View}));n||(n=new s.S("view")).setAsSystemValue(f.$.View),n.output.connectTo(this.view)}},t.prototype.prepareDefines=function(t,n,i){e.prototype.prepareDefines.call(this,t,n,i);var r=this._getTexture(),o=r&&r.getTextureMatrix;i.setValue("SS_REFRACTION",o,!0),o&&(i.setValue(this._define3DName,r.isCube,!0),i.setValue(this._defineLODRefractionAlpha,r.lodLevelInAlpha,!0),i.setValue(this._defineLinearSpecularRefraction,r.linearSpecularLOD,!0),i.setValue(this._defineOppositeZ,this._scene.useRightHandedSystem?!r.invertZ:r.invertZ,!0),i.setValue("SS_LINKREFRACTIONTOTRANSPARENCY",this.linkRefractionWithTransparency,!0),i.setValue("SS_GAMMAREFRACTION",r.gammaSpace,!0),i.setValue("SS_RGBDREFRACTION",r.isRGBD,!0),i.setValue("SS_USE_LOCAL_REFRACTIONMAP_CUBIC",!!r.boundingBoxSize,!0),i.setValue("SS_USE_THICKNESS_AS_DEPTH",this.useThicknessAsDepth,!0))},t.prototype.isReady=function(){var e=this._getTexture();return!(e&&!e.isReadyOrNotBlocking())},t.prototype.bind=function(t,n,i){var r,o,a,c;e.prototype.bind.call(this,t,n,i);var s=this._getTexture();if(s){s.isCube?t.setTexture(this._cubeSamplerName,s):t.setTexture(this._2DSamplerName,s),t.setMatrix(this._refractionMatrixName,s.getReflectionTextureMatrix());var u=1;s.isCube||s.depth&&(u=s.depth);var l=null!==(c=null!==(o=null===(r=this.volumeIndexOfRefraction.connectInputBlock)||void 0===r?void 0:r.value)&&void 0!==o?o:null===(a=this.indexOfRefractionConnectionPoint.connectInputBlock)||void 0===a?void 0:a.value)&&void 0!==c?c:1.5;t.setFloat4(this._vRefractionInfosName,s.level,1/l,u,this.invertRefractionY?-1:1),t.setFloat4(this._vRefractionMicrosurfaceInfosName,s.getSize().width,s.lodGenerationScale,s.lodGenerationOffset,1/l);var p=s.getSize().width;if(t.setFloat2(this._vRefractionFilteringInfoName,p,m.R.Log2(p)),s.boundingBoxSize){var d=s;t.setVector3("vRefractionPosition",d.boundingBoxPosition),t.setVector3("vRefractionSize",d.boundingBoxSize)}}},t.prototype.getCode=function(e){return e.sharedData.blockingBlocks.push(this),e.sharedData.textureBlocks.push(this),this._cubeSamplerName=e._getFreeVariableName(this.name+"CubeSampler"),e.samplers.push(this._cubeSamplerName),this._2DSamplerName=e._getFreeVariableName(this.name+"2DSampler"),e.samplers.push(this._2DSamplerName),this._define3DName=e._getFreeDefineName("SS_REFRACTIONMAP_3D"),e._samplerDeclaration+="#ifdef ".concat(this._define3DName,"\r\n"),e._samplerDeclaration+="uniform samplerCube ".concat(this._cubeSamplerName,";\r\n"),e._samplerDeclaration+="#else\r\n",e._samplerDeclaration+="uniform sampler2D ".concat(this._2DSamplerName,";\r\n"),e._samplerDeclaration+="#endif\r\n",e.sharedData.blocksWithDefines.push(this),e.sharedData.bindableBlocks.push(this),this._defineLODRefractionAlpha=e._getFreeDefineName("SS_LODINREFRACTIONALPHA"),this._defineLinearSpecularRefraction=e._getFreeDefineName("SS_LINEARSPECULARREFRACTION"),this._defineOppositeZ=e._getFreeDefineName("SS_REFRACTIONMAP_OPPOSITEZ"),this._refractionMatrixName=e._getFreeVariableName("refractionMatrix"),e._emitUniformFromString(this._refractionMatrixName,"mat4"),e._emitFunction("sampleRefraction","\n            #ifdef ".concat(this._define3DName,"\n                #define sampleRefraction(s, c) textureCube(s, c)\n            #else\n                #define sampleRefraction(s, c) texture2D(s, c)\n            #endif\r\n"),"//".concat(this.name)),e._emitFunction("sampleRefractionLod","\n            #ifdef ".concat(this._define3DName,"\n                #define sampleRefractionLod(s, c, l) textureCubeLodEXT(s, c, l)\n            #else\n                #define sampleRefractionLod(s, c, l) texture2DLodEXT(s, c, l)\n            #endif\r\n"),"//".concat(this.name)),this._vRefractionMicrosurfaceInfosName=e._getFreeVariableName("vRefractionMicrosurfaceInfos"),e._emitUniformFromString(this._vRefractionMicrosurfaceInfosName,"vec4"),this._vRefractionInfosName=e._getFreeVariableName("vRefractionInfos"),e._emitUniformFromString(this._vRefractionInfosName,"vec4"),this._vRefractionFilteringInfoName=e._getFreeVariableName("vRefractionFilteringInfo"),e._emitUniformFromString(this._vRefractionFilteringInfoName,"vec2"),e._emitUniformFromString("vRefractionPosition","vec3"),e._emitUniformFromString("vRefractionSize","vec3"),""},t.prototype._buildBlock=function(e){return this._scene=e.sharedData.scene,this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);return this.texture&&(t=this.texture.isCube?"".concat(this._codeVariableName,'.texture = new BABYLON.CubeTexture("').concat(this.texture.name,'");\r\n'):"".concat(this._codeVariableName,'.texture = new BABYLON.Texture("').concat(this.texture.name,'");\r\n'),t+="".concat(this._codeVariableName,".texture.coordinatesMode = ").concat(this.texture.coordinatesMode,";\r\n")),t+="".concat(this._codeVariableName,".linkRefractionWithTransparency = ").concat(this.linkRefractionWithTransparency,";\r\n"),t+="".concat(this._codeVariableName,".invertRefractionY = ").concat(this.invertRefractionY,";\r\n"),t+="".concat(this._codeVariableName,".useThicknessAsDepth = ").concat(this.useThicknessAsDepth,";\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return this.texture&&!this.texture.isRenderTarget&&(t.texture=this.texture.serialize()),t.linkRefractionWithTransparency=this.linkRefractionWithTransparency,t.invertRefractionY=this.invertRefractionY,t.useThicknessAsDepth=this.useThicknessAsDepth,t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),t.texture&&(i=0===t.texture.url.indexOf("data:")?"":i,t.texture.isCube?this.texture=d.B.Parse(t.texture,n,i):this.texture=h.x.Parse(t.texture,n,i)),this.linkRefractionWithTransparency=t.linkRefractionWithTransparency,this.invertRefractionY=t.invertRefractionY,this.useThicknessAsDepth=!!t.useThicknessAsDepth},(0,i.gn)([(0,l.p)("Link refraction to transparency",l.U.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"linkRefractionWithTransparency",void 0),(0,i.gn)([(0,l.p)("Invert refraction Y",l.U.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"invertRefractionY",void 0),(0,i.gn)([(0,l.p)("Use thickness as depth",l.U.Boolean,"ADVANCED",{notifiers:{update:!0}})],t.prototype,"useThicknessAsDepth",void 0),t}(p.k);(0,c.H)("BABYLON.RefractionBlock",g)},55159:(e,t,n)=>{n.d(t,{g:()=>p});var i=n(31191),r=n(89592),o=n(89762),a=n(96979),c=n(70848),s=n(48620),u=n(12352),l=n(93682),p=function(e){function t(n){var i=e.call(this,n,c.u.Fragment)||this;return i.albedoScaling=!1,i.linkSheenWithAlbedo=!1,i._isUnique=!0,i.registerInput("intensity",o.E.Float,!0,c.u.Fragment),i.registerInput("color",o.E.Color3,!0,c.u.Fragment),i.registerInput("roughness",o.E.Float,!0,c.u.Fragment),i.registerOutput("sheen",o.E.Object,c.u.Fragment,new l.C("sheen",i,a.Ab.Output,t,"SheenBlock")),i}return(0,i.ZT)(t,e),t.prototype.initialize=function(e){e._excludeVariableName("sheenOut"),e._excludeVariableName("sheenMapData"),e._excludeVariableName("vSheenColor"),e._excludeVariableName("vSheenRoughness")},t.prototype.getClassName=function(){return"SheenBlock"},Object.defineProperty(t.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roughness",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sheen",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.prepareDefines=function(t,n,i){e.prototype.prepareDefines.call(this,t,n,i),i.setValue("SHEEN",!0),i.setValue("SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE",!0,!0),i.setValue("SHEEN_LINKWITHALBEDO",this.linkSheenWithAlbedo,!0),i.setValue("SHEEN_ROUGHNESS",this.roughness.isConnected,!0),i.setValue("SHEEN_ALBEDOSCALING",this.albedoScaling,!0)},t.prototype.getCode=function(e){var t=this.color.isConnected?this.color.associatedVariableName:"vec3(1.)",n=this.intensity.isConnected?this.intensity.associatedVariableName:"1.",i=this.roughness.isConnected?this.roughness.associatedVariableName:"0.";return"#ifdef SHEEN\n            sheenOutParams sheenOut;\n\n            vec4 vSheenColor = vec4(".concat(t,", ").concat(n,");\n\n            sheenBlock(\n                vSheenColor,\n            #ifdef SHEEN_ROUGHNESS\n                ").concat(i,",\n            #endif\n                roughness,\n            #ifdef SHEEN_TEXTURE\n                ").concat("vec4(0.)",",\n                1.0,\n            #endif\n                reflectance,\n            #ifdef SHEEN_LINKWITHALBEDO\n                baseColor,\n                surfaceAlbedo,\n            #endif\n            #ifdef ENVIRONMENTBRDF\n                NdotV,\n                environmentBrdf,\n            #endif\n            #if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n                AARoughnessFactors,\n                ").concat(null==e?void 0:e._vReflectionMicrosurfaceInfosName,",\n                ").concat(null==e?void 0:e._vReflectionInfosName,",\n                ").concat(null==e?void 0:e.reflectionColor,",\n                vLightingIntensity,\n                #ifdef ").concat(null==e?void 0:e._define3DName,"\n                    ").concat(null==e?void 0:e._cubeSamplerName,",\n                #else\n                    ").concat(null==e?void 0:e._2DSamplerName,",\n                #endif\n                reflectionOut.reflectionCoords,\n                NdotVUnclamped,\n                #ifndef LODBASEDMICROSFURACE\n                    #ifdef ").concat(null==e?void 0:e._define3DName,"\n                        ").concat(null==e?void 0:e._cubeSamplerName,",\n                        ").concat(null==e?void 0:e._cubeSamplerName,",\n                    #else\n                        ").concat(null==e?void 0:e._2DSamplerName,",\n                        ").concat(null==e?void 0:e._2DSamplerName,",\n                    #endif\n                #endif\n                #if !defined(").concat(null==e?void 0:e._defineSkyboxName,") && defined(RADIANCEOCCLUSION)\n                    seo,\n                #endif\n                #if !defined(").concat(null==e?void 0:e._defineSkyboxName,") && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(").concat(null==e?void 0:e._define3DName,")\n                    eho,\n                #endif\n            #endif\n                sheenOut\n            );\n\n            #ifdef SHEEN_LINKWITHALBEDO\n                surfaceAlbedo = sheenOut.surfaceAlbedo;\n            #endif\n        #endif\r\n")},t.prototype._buildBlock=function(e){return e.target===c.u.Fragment&&e.sharedData.blocksWithDefines.push(this),this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);return t+="".concat(this._codeVariableName,".albedoScaling = ").concat(this.albedoScaling,";\r\n"),t+="".concat(this._codeVariableName,".linkSheenWithAlbedo = ").concat(this.linkSheenWithAlbedo,";\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.albedoScaling=this.albedoScaling,t.linkSheenWithAlbedo=this.linkSheenWithAlbedo,t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),this.albedoScaling=t.albedoScaling,this.linkSheenWithAlbedo=t.linkSheenWithAlbedo},(0,i.gn)([(0,u.p)("Albedo scaling",u.U.Boolean,"PROPERTIES",{notifiers:{update:!0}})],t.prototype,"albedoScaling",void 0),(0,i.gn)([(0,u.p)("Link sheen with albedo",u.U.Boolean,"PROPERTIES",{notifiers:{update:!0}})],t.prototype,"linkSheenWithAlbedo",void 0),t}(r.k);(0,s.H)("BABYLON.SheenBlock",p)},76882:(e,t,n)=>{n.d(t,{l:()=>d});var i=n(31191),r=n(89592),o=n(89762),a=n(96979),c=n(70848),s=n(48620),u=n(62976),l=n(93682),p=n(45073),d=function(e){function t(n){var i=e.call(this,n,c.u.Fragment)||this;return i._isUnique=!0,i.registerInput("thickness",o.E.Float,!1,c.u.Fragment),i.registerInput("tintColor",o.E.Color3,!0,c.u.Fragment),i.registerInput("translucencyIntensity",o.E.Float,!0,c.u.Fragment),i.registerInput("translucencyDiffusionDist",o.E.Color3,!0,c.u.Fragment),i.registerInput("refraction",o.E.Object,!0,c.u.Fragment,new l.C("refraction",i,a.Ab.Input,p.b,"RefractionBlock")),i.registerOutput("subsurface",o.E.Object,c.u.Fragment,new l.C("subsurface",i,a.Ab.Output,t,"SubSurfaceBlock")),i}return(0,i.ZT)(t,e),t.prototype.initialize=function(e){e._excludeVariableName("subSurfaceOut"),e._excludeVariableName("vThicknessParam"),e._excludeVariableName("vTintColor"),e._excludeVariableName("vSubSurfaceIntensity")},t.prototype.getClassName=function(){return"SubSurfaceBlock"},Object.defineProperty(t.prototype,"thickness",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tintColor",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"translucencyIntensity",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"translucencyDiffusionDist",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refraction",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subsurface",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(){if(!this.thickness.isConnected){var e=new u.S("SubSurface thickness",c.u.Fragment,o.E.Float);e.value=0,e.output.connectTo(this.thickness)}},t.prototype.prepareDefines=function(t,n,i){e.prototype.prepareDefines.call(this,t,n,i);var r=this.translucencyDiffusionDist.isConnected||this.translucencyIntensity.isConnected;i.setValue("SUBSURFACE",r||this.refraction.isConnected,!0),i.setValue("SS_TRANSLUCENCY",r,!0),i.setValue("SS_THICKNESSANDMASK_TEXTURE",!1,!0),i.setValue("SS_REFRACTIONINTENSITY_TEXTURE",!1,!0),i.setValue("SS_TRANSLUCENCYINTENSITY_TEXTURE",!1,!0),i.setValue("SS_MASK_FROM_THICKNESS_TEXTURE",!1,!0),i.setValue("SS_USE_GLTF_TEXTURES",!1,!0)},t.GetCode=function(e,t,n,i){var r,o,a,c,s,u,l,p,d,h,f,m,g,b,_,y,v="",N=(null==t?void 0:t.thickness.isConnected)?t.thickness.associatedVariableName:"0.",S=(null==t?void 0:t.tintColor.isConnected)?t.tintColor.associatedVariableName:"vec3(1.)",O=(null==t?void 0:t.translucencyIntensity.isConnected)?null==t?void 0:t.translucencyIntensity.associatedVariableName:"1.",C=(null==t?void 0:t.translucencyDiffusionDist.isConnected)?null==t?void 0:t.translucencyDiffusionDist.associatedVariableName:"vec3(1.)",E=(null==t?void 0:t.refraction.isConnected)?null===(r=null==t?void 0:t.refraction.connectedPoint)||void 0===r?void 0:r.ownerBlock:null,P=(null==E?void 0:E.tintAtDistance.isConnected)?E.tintAtDistance.associatedVariableName:"1.",I=(null==E?void 0:E.intensity.isConnected)?E.intensity.associatedVariableName:"1.",x=(null==E?void 0:E.view.isConnected)?E.view.associatedVariableName:"";return v+=null!==(o=null==E?void 0:E.getCode(e))&&void 0!==o?o:"",v+="subSurfaceOutParams subSurfaceOut;\n\n        #ifdef SUBSURFACE\n            vec2 vThicknessParam = vec2(0., ".concat(N,");\n            vec4 vTintColor = vec4(").concat(S,", ").concat(P,");\n            vec3 vSubSurfaceIntensity = vec3(").concat(I,", ").concat(O,", 0.);\n\n            subSurfaceBlock(\n                vSubSurfaceIntensity,\n                vThicknessParam,\n                vTintColor,\n                normalW,\n                specularEnvironmentReflectance,\n            #ifdef SS_THICKNESSANDMASK_TEXTURE\n                vec4(0.),\n            #endif\n            #ifdef REFLECTION\n                #ifdef SS_TRANSLUCENCY\n                    ").concat(null==n?void 0:n._reflectionMatrixName,",\n                    #ifdef USESPHERICALFROMREFLECTIONMAP\n                        #if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n                            reflectionOut.irradianceVector,\n                        #endif\n                        #if defined(REALTIME_FILTERING)\n                            ").concat(null==n?void 0:n._cubeSamplerName,",\n                            ").concat(null==n?void 0:n._vReflectionFilteringInfoName,",\n                        #endif\n                        #endif\n                    #ifdef USEIRRADIANCEMAP\n                        irradianceSampler,\n                    #endif\n                #endif\n            #endif\n            #if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\n                surfaceAlbedo,\n            #endif\n            #ifdef SS_REFRACTION\n                ").concat(i,".xyz,\n                viewDirectionW,\n                ").concat(x,",\n                ").concat(null!==(a=null==E?void 0:E._vRefractionInfosName)&&void 0!==a?a:"",",\n                ").concat(null!==(c=null==E?void 0:E._refractionMatrixName)&&void 0!==c?c:"",",\n                ").concat(null!==(s=null==E?void 0:E._vRefractionMicrosurfaceInfosName)&&void 0!==s?s:"",",\n                vLightingIntensity,\n                #ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n                    alpha,\n                #endif\n                #ifdef ").concat(null!==(u=null==E?void 0:E._defineLODRefractionAlpha)&&void 0!==u?u:"IGNORE","\n                    NdotVUnclamped,\n                #endif\n                #ifdef ").concat(null!==(l=null==E?void 0:E._defineLinearSpecularRefraction)&&void 0!==l?l:"IGNORE","\n                    roughness,\n                #endif\n                alphaG,\n                #ifdef ").concat(null!==(p=null==E?void 0:E._define3DName)&&void 0!==p?p:"IGNORE","\n                    ").concat(null!==(d=null==E?void 0:E._cubeSamplerName)&&void 0!==d?d:"",",\n                #else\n                    ").concat(null!==(h=null==E?void 0:E._2DSamplerName)&&void 0!==h?h:"",",\n                #endif\n                #ifndef LODBASEDMICROSFURACE\n                    #ifdef ").concat(null!==(f=null==E?void 0:E._define3DName)&&void 0!==f?f:"IGNORE","\n                        ").concat(null!==(m=null==E?void 0:E._cubeSamplerName)&&void 0!==m?m:"",",\n                        ").concat(null!==(g=null==E?void 0:E._cubeSamplerName)&&void 0!==g?g:"",",\n                    #else\n                        ").concat(null!==(b=null==E?void 0:E._2DSamplerName)&&void 0!==b?b:"",",\n                        ").concat(null!==(_=null==E?void 0:E._2DSamplerName)&&void 0!==_?_:"",",\n                    #endif\n                #endif\n                #ifdef ANISOTROPIC\n                    anisotropicOut,\n                #endif\n                #ifdef REALTIME_FILTERING\n                    ").concat(null!==(y=null==E?void 0:E._vRefractionFilteringInfoName)&&void 0!==y?y:"",",\n                #endif\n                #ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\n                    vRefractionPosition,\n                    vRefractionSize,\n                #endif\n            #endif\n            #ifdef SS_TRANSLUCENCY\n                ").concat(C,",\n            #endif\n                subSurfaceOut\n            );\n\n            #ifdef SS_REFRACTION\n                surfaceAlbedo = subSurfaceOut.surfaceAlbedo;\n                #ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n                    alpha = subSurfaceOut.alpha;\n                #endif\n            #endif\n        #else\n            subSurfaceOut.specularEnvironmentReflectance = specularEnvironmentReflectance;\n        #endif\r\n")},t.prototype._buildBlock=function(e){return e.target===c.u.Fragment&&e.sharedData.blocksWithDefines.push(this),this},t}(r.k);(0,s.H)("BABYLON.SubSurfaceBlock",d)},71477:(e,t,n)=>{n.d(t,{D:()=>s});var i=n(31191),r=n(89592),o=n(89762),a=n(70848),c=n(48620),s=function(e){function t(t){var n=e.call(this,t,a.u.Fragment)||this;return n._isUnique=!0,n.registerInput("color",o.E.Color4,!1,a.u.Fragment),n.registerInput("alphaTexture",o.E.Float,!1,a.u.Fragment),n.registerInput("alphaColor",o.E.Float,!1,a.u.Fragment),n.registerOutput("blendColor",o.E.Color4,a.u.Fragment),n}return(0,i.ZT)(t,e),t.prototype.getClassName=function(){return"ParticleBlendMultiplyBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alphaTexture",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alphaColor",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendColor",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("sourceAlpha")},t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),t.target!==a.u.Vertex)return t.compilationString+="\n            #ifdef BLENDMULTIPLYMODE\n                ".concat(this._declareOutput(this.blendColor,t),";\n                float sourceAlpha = ").concat(this.alphaColor.associatedVariableName," * ").concat(this.alphaTexture.associatedVariableName,";\n                ").concat(this.blendColor.associatedVariableName,".rgb = ").concat(this.color.associatedVariableName,".rgb * sourceAlpha + vec3(1.0) * (1.0 - sourceAlpha);\n                ").concat(this.blendColor.associatedVariableName,".a = ").concat(this.color.associatedVariableName,".a;\n            #else\n                ").concat(this._declareOutput(this.blendColor,t)," = ").concat(this.color.associatedVariableName,";\n            #endif\n        "),this},t}(r.k);(0,c.H)("BABYLON.ParticleBlendMultiplyBlock",s)},17962:(e,t,n)=>{n.d(t,{p:()=>s});var i=n(31191),r=n(89592),o=n(89762),a=n(70848),c=n(48620),s=function(e){function t(t){var n=e.call(this,t,a.u.Fragment)||this;return n._isUnique=!0,n.registerInput("color",o.E.Color4,!1,a.u.Fragment),n.registerOutput("rampColor",o.E.Color4,a.u.Fragment),n}return(0,i.ZT)(t,e),t.prototype.getClassName=function(){return"ParticleRampGradientBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rampColor",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("remapRanges"),e._excludeVariableName("rampSampler"),e._excludeVariableName("baseColor"),e._excludeVariableName("alpha"),e._excludeVariableName("remappedColorIndex"),e._excludeVariableName("rampColor"),e._excludeVariableName("finalAlpha")},t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),t.target!==a.u.Vertex)return t._emit2DSampler("rampSampler"),t._emitVaryingFromString("remapRanges","vec4","RAMPGRADIENT"),t.compilationString+="\n            #ifdef RAMPGRADIENT\n                vec4 baseColor = ".concat(this.color.associatedVariableName,";\n                float alpha = ").concat(this.color.associatedVariableName,".a;\n\n                float remappedColorIndex = clamp((alpha - remapRanges.x) / remapRanges.y, 0.0, 1.0);\n\n                vec4 rampColor = texture2D(rampSampler, vec2(1.0 - remappedColorIndex, 0.));\n                baseColor.rgb *= rampColor.rgb;\n\n                // Remapped alpha\n                float finalAlpha = baseColor.a;\n                baseColor.a = clamp((alpha * rampColor.a - remapRanges.z) / remapRanges.w, 0.0, 1.0);\n\n                ").concat(this._declareOutput(this.rampColor,t)," = baseColor;\n            #else\n                ").concat(this._declareOutput(this.rampColor,t)," = ").concat(this.color.associatedVariableName,";\n            #endif\n        "),this},t}(r.k);(0,c.H)("BABYLON.ParticleRampGradientBlock",s)},28361:(e,t,n)=>{n.d(t,{P:()=>l});var i=n(31191),r=n(89592),o=n(89762),a=n(70848),c=n(62976),s=n(48620),u=n(73803),l=function(e){function t(t){var n=e.call(this,t,a.u.Fragment)||this;return n._samplerName="diffuseSampler",n.convertToGammaSpace=!1,n.convertToLinearSpace=!1,n._isUnique=!1,n.registerInput("uv",o.E.Vector2,!1,a.u.VertexAndFragment),n.registerOutput("rgba",o.E.Color4,a.u.Neutral),n.registerOutput("rgb",o.E.Color3,a.u.Neutral),n.registerOutput("r",o.E.Float,a.u.Neutral),n.registerOutput("g",o.E.Float,a.u.Neutral),n.registerOutput("b",o.E.Float,a.u.Neutral),n.registerOutput("a",o.E.Float,a.u.Neutral),n._inputs[0].acceptedConnectionPointTypes.push(o.E.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(o.E.Vector4),n}return(0,i.ZT)(t,e),t.prototype.getClassName=function(){return"ParticleTextureBlock"},Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("diffuseSampler")},t.prototype.autoConfigure=function(e){if(!this.uv.isConnected){var t=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"particle_uv"===e.name}));t||(t=new c.S("uv")).setAsAttribute("particle_uv"),t.output.connectTo(this.uv)}},t.prototype.prepareDefines=function(e,t,n){n.setValue(this._linearDefineName,this.convertToGammaSpace,!0),n.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)},t.prototype.isReady=function(){return!(this.texture&&!this.texture.isReadyOrNotBlocking())},t.prototype._writeOutput=function(e,t,n){e.compilationString+="".concat(this._declareOutput(t,e)," = ").concat(this._tempTextureRead,".").concat(n,";\r\n"),e.compilationString+="#ifdef ".concat(this._linearDefineName,"\r\n"),e.compilationString+="".concat(t.associatedVariableName," = toGammaSpace(").concat(t.associatedVariableName,");\r\n"),e.compilationString+="#endif\r\n",e.compilationString+="#ifdef ".concat(this._gammaDefineName,"\r\n"),e.compilationString+="".concat(t.associatedVariableName," = toLinearSpace(").concat(t.associatedVariableName,");\r\n"),e.compilationString+="#endif\r\n"},t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),t.target!==a.u.Vertex){this._tempTextureRead=t._getFreeVariableName("tempTextureRead"),t._emit2DSampler(this._samplerName),t.sharedData.blockingBlocks.push(this),t.sharedData.textureBlocks.push(this),t.sharedData.blocksWithDefines.push(this),this._linearDefineName=t._getFreeDefineName("ISLINEAR"),this._gammaDefineName=t._getFreeDefineName("ISGAMMA");var n="//".concat(this.name);t._emitFunctionFromInclude("helperFunctions",n),t.compilationString+="vec4 ".concat(this._tempTextureRead," = texture2D(").concat(this._samplerName,", ").concat(this.uv.associatedVariableName,");\r\n");for(var i=0,r=this._outputs;i<r.length;i++){var o=r[i];o.hasEndpoints&&this._writeOutput(t,o,o.name)}return this}},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.convertToGammaSpace=this.convertToGammaSpace,t.convertToLinearSpace=this.convertToLinearSpace,this.texture&&!this.texture.isRenderTarget&&(t.texture=this.texture.serialize()),t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),this.convertToGammaSpace=t.convertToGammaSpace,this.convertToLinearSpace=!!t.convertToLinearSpace,t.texture&&(i=0===t.texture.url.indexOf("data:")?"":i,this.texture=u.x.Parse(t.texture,n,i))},t}(r.k);(0,s.H)("BABYLON.ParticleTextureBlock",l)},32709:(e,t,n)=>{n.d(t,{t:()=>s});var i=n(31191),r=n(89592),o=n(89762),a=n(70848),c=n(48620),s=function(e){function t(t){var n=e.call(this,t,a.u.Vertex,!0)||this;return n.registerInput("vector",o.E.Vector4),n}return(0,i.ZT)(t,e),t.prototype.getClassName=function(){return"VertexOutputBlock"},Object.defineProperty(t.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),t.prototype._isLogarithmicDepthEnabled=function(e){for(var t=0,n=e;t<n.length;t++){if(n[t].useLogarithmicDepth)return!0}return!1},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this.vector;return t.compilationString+="gl_Position = ".concat(n.associatedVariableName,";\r\n"),this._isLogarithmicDepthEnabled(t.sharedData.fragmentOutputNodes)&&(t._emitUniformFromString("logarithmicDepthConstant","float"),t._emitVaryingFromString("vFragmentDepth","float"),t.compilationString+="vFragmentDepth = 1.0 + gl_Position.w;\r\n",t.compilationString+="gl_Position.z = log2(max(0.000001, vFragmentDepth)) * logarithmicDepthConstant;\r\n"),this},t}(r.k);(0,c.H)("BABYLON.VertexOutputBlock",s)},4482:(e,t,n)=>{n.d(t,{v:()=>s});var i=n(31191),r=n(89592),o=n(89762),a=n(70848),c=n(48620),s=function(e){function t(t){var n=e.call(this,t,a.u.Neutral)||this;return n.registerInput("rgba",o.E.Color4,!0),n.registerInput("rgb ",o.E.Color3,!0),n.registerOutput("rgb",o.E.Color3),n.registerOutput("r",o.E.Float),n.registerOutput("g",o.E.Float),n.registerOutput("b",o.E.Float),n.registerOutput("a",o.E.Float),n.inputsAreExclusive=!0,n}return(0,i.ZT)(t,e),t.prototype.getClassName=function(){return"ColorSplitterBlock"},Object.defineProperty(t.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgbIn",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgbOut",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),t.prototype._inputRename=function(e){return"rgb "===e?"rgbIn":e},t.prototype._outputRename=function(e){return"rgb"===e?"rgbOut":e},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this.rgba.isConnected?this.rgba:this.rgbIn;if(n.isConnected){var i=this._outputs[0],r=this._outputs[1],o=this._outputs[2],a=this._outputs[3],c=this._outputs[4];return i.hasEndpoints&&(t.compilationString+=this._declareOutput(i,t)+" = ".concat(n.associatedVariableName,".rgb;\r\n")),r.hasEndpoints&&(t.compilationString+=this._declareOutput(r,t)+" = ".concat(n.associatedVariableName,".r;\r\n")),o.hasEndpoints&&(t.compilationString+=this._declareOutput(o,t)+" = ".concat(n.associatedVariableName,".g;\r\n")),a.hasEndpoints&&(t.compilationString+=this._declareOutput(a,t)+" = ".concat(n.associatedVariableName,".b;\r\n")),c.hasEndpoints&&(t.compilationString+=this._declareOutput(c,t)+" = ".concat(n.associatedVariableName,".a;\r\n")),this}},t}(r.k);(0,c.H)("BABYLON.ColorSplitterBlock",s)},66897:(e,t,n)=>{n.d(t,{U:()=>s});var i=n(31191),r=n(89592),o=n(89762),a=n(70848),c=n(48620),s=function(e){function t(t){var n=e.call(this,t,a.u.Neutral)||this;return n.registerInput("left",o.E.AutoDetect),n.registerInput("right",o.E.AutoDetect),n.registerOutput("output",o.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return(0,i.ZT)(t,e),t.prototype.getClassName=function(){return"MultiplyBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = ".concat(this.left.associatedVariableName," * ").concat(this.right.associatedVariableName,";\r\n"),this},t}(r.k);(0,c.H)("BABYLON.MultiplyBlock",s)},61878:(e,t,n)=>{n.d(t,{w:()=>l});var i=n(31191),r=n(89592),o=n(89762),a=n(70848),c=n(48620),s=n(58095),u=n(12352),l=function(e){function t(t){var n=e.call(this,t,a.u.Neutral)||this;return n.sourceRange=new s.FM(-1,1),n.targetRange=new s.FM(0,1),n.registerInput("input",o.E.AutoDetect),n.registerInput("sourceMin",o.E.Float,!0),n.registerInput("sourceMax",o.E.Float,!0),n.registerInput("targetMin",o.E.Float,!0),n.registerInput("targetMax",o.E.Float,!0),n.registerOutput("output",o.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return(0,i.ZT)(t,e),t.prototype.getClassName=function(){return"RemapBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceMin",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceMax",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"targetMin",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"targetMax",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0],i=this.sourceMin.isConnected?this.sourceMin.associatedVariableName:this._writeFloat(this.sourceRange.x),r=this.sourceMax.isConnected?this.sourceMax.associatedVariableName:this._writeFloat(this.sourceRange.y),o=this.targetMin.isConnected?this.targetMin.associatedVariableName:this._writeFloat(this.targetRange.x),a=this.targetMax.isConnected?this.targetMax.associatedVariableName:this._writeFloat(this.targetRange.y);return t.compilationString+=this._declareOutput(n,t)+" = ".concat(o," + (").concat(this._inputs[0].associatedVariableName," - ").concat(i,") * (").concat(a," - ").concat(o,") / (").concat(r," - ").concat(i,");\r\n"),this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this)+"".concat(this._codeVariableName,".sourceRange = new BABYLON.Vector2(").concat(this.sourceRange.x,", ").concat(this.sourceRange.y,");\r\n");return t+="".concat(this._codeVariableName,".targetRange = new BABYLON.Vector2(").concat(this.targetRange.x,", ").concat(this.targetRange.y,");\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.sourceRange=this.sourceRange.asArray(),t.targetRange=this.targetRange.asArray(),t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),this.sourceRange=s.FM.FromArray(t.sourceRange),this.targetRange=s.FM.FromArray(t.targetRange)},(0,i.gn)([(0,u.p)("From",u.U.Vector2)],t.prototype,"sourceRange",void 0),(0,i.gn)([(0,u.p)("To",u.U.Vector2)],t.prototype,"targetRange",void 0),t}(r.k);(0,c.H)("BABYLON.RemapBlock",l)},73702:(e,t,n)=>{n.d(t,{m:()=>s});var i=n(31191),r=n(89592),o=n(89762),a=n(70848),c=n(48620),s=function(e){function t(t){var n=e.call(this,t,a.u.Neutral)||this;return n.complementW=1,n.complementZ=0,n.target=a.u.Vertex,n.registerInput("vector",o.E.AutoDetect),n.registerInput("transform",o.E.Matrix),n.registerOutput("output",o.E.Vector4),n.registerOutput("xyz",o.E.Vector3),n._inputs[0].onConnectionObservable.add((function(e){if(e.ownerBlock.isInput){var t=e.ownerBlock;"normal"!==t.name&&"tangent"!==t.name||(n.complementW=0)}})),n}return(0,i.ZT)(t,e),t.prototype.getClassName=function(){return"TransformBlock"},Object.defineProperty(t.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transform",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this.vector,i=this.transform;if(n.connectedPoint){if(0===this.complementW){var r="//".concat(this.name);t._emitFunctionFromInclude("helperFunctions",r),t.sharedData.blocksWithDefines.push(this);var a=t._getFreeVariableName("".concat(i.associatedVariableName,"_NUS"));switch(t.compilationString+="mat3 ".concat(a," = mat3(").concat(i.associatedVariableName,");\r\n"),t.compilationString+="#ifdef NONUNIFORMSCALING\r\n",t.compilationString+="".concat(a," = transposeMat3(inverseMat3(").concat(a,"));\r\n"),t.compilationString+="#endif\r\n",n.connectedPoint.type){case o.E.Vector2:t.compilationString+=this._declareOutput(this.output,t)+" = vec4(".concat(a," * vec3(").concat(n.associatedVariableName,", ").concat(this._writeFloat(this.complementZ),"), ").concat(this._writeFloat(this.complementW),");\r\n");break;case o.E.Vector3:case o.E.Color3:t.compilationString+=this._declareOutput(this.output,t)+" = vec4(".concat(a," * ").concat(n.associatedVariableName,", ").concat(this._writeFloat(this.complementW),");\r\n");break;default:t.compilationString+=this._declareOutput(this.output,t)+" = vec4(".concat(a," * ").concat(n.associatedVariableName,".xyz, ").concat(this._writeFloat(this.complementW),");\r\n")}}else{a=i.associatedVariableName;switch(n.connectedPoint.type){case o.E.Vector2:t.compilationString+=this._declareOutput(this.output,t)+" = ".concat(a," * vec4(").concat(n.associatedVariableName,", ").concat(this._writeFloat(this.complementZ),", ").concat(this._writeFloat(this.complementW),");\r\n");break;case o.E.Vector3:case o.E.Color3:t.compilationString+=this._declareOutput(this.output,t)+" = ".concat(a," * vec4(").concat(n.associatedVariableName,", ").concat(this._writeFloat(this.complementW),");\r\n");break;default:t.compilationString+=this._declareOutput(this.output,t)+" = ".concat(a," * ").concat(n.associatedVariableName,";\r\n")}}this.xyz.hasEndpoints&&(t.compilationString+=this._declareOutput(this.xyz,t)+" = ".concat(this.output.associatedVariableName,".xyz;\r\n"))}return this},t.prototype.prepareDefines=function(e,t,n){e.nonUniformScaling&&n.setValue("NONUNIFORMSCALING",!0)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.complementZ=this.complementZ,t.complementW=this.complementW,t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),this.complementZ=void 0!==t.complementZ?t.complementZ:0,this.complementW=void 0!==t.complementW?t.complementW:1},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this)+"".concat(this._codeVariableName,".complementZ = ").concat(this.complementZ,";\r\n");return t+="".concat(this._codeVariableName,".complementW = ").concat(this.complementW,";\r\n")},t}(r.k);(0,c.H)("BABYLON.TransformBlock",s)},94018:(e,t,n)=>{n.d(t,{S:()=>u,p:()=>i});var i,r=n(31191),o=n(89592),a=n(89762),c=n(70848),s=n(48620);!function(e){e[e.Cos=0]="Cos",e[e.Sin=1]="Sin",e[e.Abs=2]="Abs",e[e.Exp=3]="Exp",e[e.Exp2=4]="Exp2",e[e.Round=5]="Round",e[e.Floor=6]="Floor",e[e.Ceiling=7]="Ceiling",e[e.Sqrt=8]="Sqrt",e[e.Log=9]="Log",e[e.Tan=10]="Tan",e[e.ArcTan=11]="ArcTan",e[e.ArcCos=12]="ArcCos",e[e.ArcSin=13]="ArcSin",e[e.Fract=14]="Fract",e[e.Sign=15]="Sign",e[e.Radians=16]="Radians",e[e.Degrees=17]="Degrees"}(i||(i={}));var u=function(e){function t(t){var n=e.call(this,t,c.u.Neutral)||this;return n.operation=i.Cos,n.registerInput("input",a.E.AutoDetect),n.registerOutput("output",a.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return(0,r.ZT)(t,e),t.prototype.getClassName=function(){return"TrigonometryBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0],r="";switch(this.operation){case i.Cos:r="cos";break;case i.Sin:r="sin";break;case i.Abs:r="abs";break;case i.Exp:r="exp";break;case i.Exp2:r="exp2";break;case i.Round:r="round";break;case i.Floor:r="floor";break;case i.Ceiling:r="ceil";break;case i.Sqrt:r="sqrt";break;case i.Log:r="log";break;case i.Tan:r="tan";break;case i.ArcTan:r="atan";break;case i.ArcCos:r="acos";break;case i.ArcSin:r="asin";break;case i.Fract:r="fract";break;case i.Sign:r="sign";break;case i.Radians:r="radians";break;case i.Degrees:r="degrees"}return t.compilationString+=this._declareOutput(n,t)+" = ".concat(r,"(").concat(this.input.associatedVariableName,");\r\n"),this},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.operation=this.operation,t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),this.operation=t.operation},t.prototype._dumpPropertiesCode=function(){return e.prototype._dumpPropertiesCode.call(this)+"".concat(this._codeVariableName,".operation = BABYLON.TrigonometryBlockOperations.").concat(i[this.operation],";\r\n")},t}(o.k);(0,s.H)("BABYLON.TrigonometryBlock",u)},72868:(e,t,n)=>{n.d(t,{t:()=>s});var i=n(31191),r=n(89592),o=n(89762),a=n(70848),c=n(48620),s=function(e){function t(t){var n=e.call(this,t,a.u.Neutral)||this;return n.xSwizzle="x",n.ySwizzle="y",n.zSwizzle="z",n.wSwizzle="w",n.registerInput("xyzw ",o.E.Vector4,!0),n.registerInput("xyz ",o.E.Vector3,!0),n.registerInput("xy ",o.E.Vector2,!0),n.registerInput("zw ",o.E.Vector2,!0),n.registerInput("x",o.E.Float,!0),n.registerInput("y",o.E.Float,!0),n.registerInput("z",o.E.Float,!0),n.registerInput("w",o.E.Float,!0),n.registerOutput("xyzw",o.E.Vector4),n.registerOutput("xyz",o.E.Vector3),n.registerOutput("xy",o.E.Vector2),n.registerOutput("zw",o.E.Vector2),n}return(0,i.ZT)(t,e),t.prototype.getClassName=function(){return"VectorMergerBlock"},Object.defineProperty(t.prototype,"xyzwIn",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzIn",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyIn",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zwIn",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzOut",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyOut",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zwOut",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xy",{get:function(){return this.xyOut},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this.xyzOut},enumerable:!1,configurable:!0}),t.prototype._inputRename=function(e){return"xyzw "===e?"xyzwIn":"xyz "===e?"xyzIn":"xy "===e?"xyIn":"zw "===e?"zwIn":e},t.prototype._buildSwizzle=function(e){return"."+(this.xSwizzle+this.ySwizzle+this.zSwizzle+this.wSwizzle).substr(0,e)},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this.x,i=this.y,r=this.z,o=this.w,a=this.xyIn,c=this.zwIn,s=this.xyzIn,u=this.xyzwIn,l=this._outputs[0],p=this._outputs[1],d=this._outputs[2],h=this._outputs[3];return u.isConnected?(l.hasEndpoints&&(t.compilationString+=this._declareOutput(l,t)+" = ".concat(u.associatedVariableName).concat(this._buildSwizzle(4),";\r\n")),p.hasEndpoints&&(t.compilationString+=this._declareOutput(p,t)+" = ".concat(u.associatedVariableName).concat(this._buildSwizzle(3),";\r\n")),d.hasEndpoints&&(t.compilationString+=this._declareOutput(d,t)+" = ".concat(u.associatedVariableName).concat(this._buildSwizzle(2),";\r\n"))):s.isConnected?(l.hasEndpoints&&(t.compilationString+=this._declareOutput(l,t)+" = vec4(".concat(s.associatedVariableName,", ").concat(o.isConnected?this._writeVariable(o):"0.0",")").concat(this._buildSwizzle(4),";\r\n")),p.hasEndpoints&&(t.compilationString+=this._declareOutput(p,t)+" = ".concat(s.associatedVariableName).concat(this._buildSwizzle(3),";\r\n")),d.hasEndpoints&&(t.compilationString+=this._declareOutput(d,t)+" = ".concat(s.associatedVariableName).concat(this._buildSwizzle(2),";\r\n"))):a.isConnected?(l.hasEndpoints&&(c.isConnected?t.compilationString+=this._declareOutput(l,t)+" = vec4(".concat(a.associatedVariableName,", ").concat(c.associatedVariableName,")").concat(this._buildSwizzle(4),";\r\n"):t.compilationString+=this._declareOutput(l,t)+" = vec4(".concat(a.associatedVariableName,", ").concat(r.isConnected?this._writeVariable(r):"0.0",", ").concat(o.isConnected?this._writeVariable(o):"0.0",")").concat(this._buildSwizzle(4),";\r\n")),p.hasEndpoints&&(t.compilationString+=this._declareOutput(p,t)+" = vec3(".concat(a.associatedVariableName,", ").concat(r.isConnected?this._writeVariable(r):"0.0",")").concat(this._buildSwizzle(3),";\r\n")),d.hasEndpoints&&(t.compilationString+=this._declareOutput(d,t)+" = ".concat(a.associatedVariableName).concat(this._buildSwizzle(2),";\r\n")),h.hasEndpoints&&(c.isConnected?t.compilationString+=this._declareOutput(h,t)+" = ".concat(c.associatedVariableName).concat(this._buildSwizzle(2),";\r\n"):t.compilationString+=this._declareOutput(h,t)+" = vec2(".concat(r.isConnected?this._writeVariable(r):"0.0",", ").concat(o.isConnected?this._writeVariable(o):"0.0",")").concat(this._buildSwizzle(2),";\r\n"))):(l.hasEndpoints&&(c.isConnected?t.compilationString+=this._declareOutput(l,t)+" = vec4(".concat(n.isConnected?this._writeVariable(n):"0.0",", ").concat(i.isConnected?this._writeVariable(i):"0.0",", ").concat(c.associatedVariableName,")").concat(this._buildSwizzle(4),";\r\n"):t.compilationString+=this._declareOutput(l,t)+" = vec4(".concat(n.isConnected?this._writeVariable(n):"0.0",", ").concat(i.isConnected?this._writeVariable(i):"0.0",", ").concat(r.isConnected?this._writeVariable(r):"0.0",", ").concat(o.isConnected?this._writeVariable(o):"0.0",")").concat(this._buildSwizzle(4),";\r\n")),p.hasEndpoints&&(t.compilationString+=this._declareOutput(p,t)+" = vec3(".concat(n.isConnected?this._writeVariable(n):"0.0",", ").concat(i.isConnected?this._writeVariable(i):"0.0",", ").concat(r.isConnected?this._writeVariable(r):"0.0",")").concat(this._buildSwizzle(3),";\r\n")),d.hasEndpoints&&(t.compilationString+=this._declareOutput(d,t)+" = vec2(".concat(n.isConnected?this._writeVariable(n):"0.0",", ").concat(i.isConnected?this._writeVariable(i):"0.0",")").concat(this._buildSwizzle(2),";\r\n")),h.hasEndpoints&&(c.isConnected?t.compilationString+=this._declareOutput(h,t)+" = ".concat(c.associatedVariableName).concat(this._buildSwizzle(2),";\r\n"):t.compilationString+=this._declareOutput(h,t)+" = vec2(".concat(r.isConnected?this._writeVariable(r):"0.0",", ").concat(o.isConnected?this._writeVariable(o):"0.0",")").concat(this._buildSwizzle(2),";\r\n"))),this},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.xSwizzle=this.xSwizzle,t.ySwizzle=this.ySwizzle,t.zSwizzle=this.zSwizzle,t.wSwizzle=this.wSwizzle,t},t.prototype._deserialize=function(t,n,i){var r,o,a,c;e.prototype._deserialize.call(this,t,n,i),this.xSwizzle=null!==(r=t.xSwizzle)&&void 0!==r?r:"x",this.ySwizzle=null!==(o=t.ySwizzle)&&void 0!==o?o:"y",this.zSwizzle=null!==(a=t.zSwizzle)&&void 0!==a?a:"z",this.wSwizzle=null!==(c=t.wSwizzle)&&void 0!==c?c:"w"},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);return t+="".concat(this._codeVariableName,'.xSwizzle = "').concat(this.xSwizzle,'";\r\n'),t+="".concat(this._codeVariableName,'.ySwizzle = "').concat(this.ySwizzle,'";\r\n'),t+="".concat(this._codeVariableName,'.zSwizzle = "').concat(this.zSwizzle,'";\r\n'),t+="".concat(this._codeVariableName,'.wSwizzle = "').concat(this.wSwizzle,'";\r\n')},t}(r.k);(0,c.H)("BABYLON.VectorMergerBlock",s)},88215:(e,t,n)=>{var i;n.d(t,{M:()=>i}),function(e){e[e.Uniform=0]="Uniform",e[e.Attribute=1]="Attribute",e[e.Varying=2]="Varying",e[e.Undefined=3]="Undefined"}(i||(i={}))},89762:(e,t,n)=>{var i;n.d(t,{E:()=>i}),function(e){e[e.Float=1]="Float",e[e.Int=2]="Int",e[e.Vector2=4]="Vector2",e[e.Vector3=8]="Vector3",e[e.Vector4=16]="Vector4",e[e.Color3=32]="Color3",e[e.Color4=64]="Color4",e[e.Matrix=128]="Matrix",e[e.Object=256]="Object",e[e.AutoDetect=1024]="AutoDetect",e[e.BasedOnInput=2048]="BasedOnInput"}(i||(i={}))},70848:(e,t,n)=>{var i;n.d(t,{u:()=>i}),function(e){e[e.Vertex=1]="Vertex",e[e.Fragment=2]="Fragment",e[e.Neutral=4]="Neutral",e[e.VertexAndFragment=3]="VertexAndFragment"}(i||(i={}))},44337:(e,t,n)=>{var i;n.d(t,{a:()=>i}),function(e){e[e.Material=0]="Material",e[e.PostProcess=1]="PostProcess",e[e.Particle=2]="Particle",e[e.ProceduralTexture=3]="ProceduralTexture"}(i||(i={}))},69958:(e,t,n)=>{var i;n.d(t,{$:()=>i}),function(e){e[e.World=1]="World",e[e.View=2]="View",e[e.Projection=3]="Projection",e[e.ViewProjection=4]="ViewProjection",e[e.WorldView=5]="WorldView",e[e.WorldViewProjection=6]="WorldViewProjection",e[e.CameraPosition=7]="CameraPosition",e[e.FogColor=8]="FogColor",e[e.DeltaTime=9]="DeltaTime",e[e.CameraParameters=10]="CameraParameters",e[e.MaterialAlpha=11]="MaterialAlpha"}(i||(i={}))},16943:(e,t,n)=>{n.d(t,{SX:()=>I,cU:()=>E.c,pk:()=>Ne.pk,xD:()=>ne,Qc:()=>b,K0:()=>T,N_:()=>Ne.N_,x1:()=>C.x1,QT:()=>Te,d_:()=>w,vF:()=>M.v,T0:()=>Ae,GL:()=>Pe,Ks:()=>V,LP:()=>C.K0,wx:()=>F,mH:()=>O.mH,qi:()=>ve,el:()=>O.el,y:()=>Q,x4:()=>H,OR:()=>B,Ko:()=>Fe,rY:()=>C.rY,Mk:()=>O.Mk,gc:()=>O.gc,fM:()=>Z,RK:()=>O.RK,ut:()=>de,Uy:()=>pe,rE:()=>O.rE,SV:()=>C.SV,S7:()=>E.S,DA:()=>_,u0:()=>$,JL:()=>U,bl:()=>C.bl,FT:()=>S,cL:()=>xe,Ku:()=>X,dl:()=>q,jK:()=>Ee,Ut:()=>v,U5:()=>P.U,fg:()=>he,Db:()=>J,Oi:()=>p.O,kn:()=>l.k,MX:()=>o.M,Ep:()=>r.E,uW:()=>i.u,VT:()=>u.VT,WS:()=>u.WS,CB:()=>s.C,Ab:()=>u.Ab,nO:()=>p.n,a8:()=>c.a,wS:()=>Be,$l:()=>a.$,Dt:()=>ge,AQ:()=>k,m8:()=>W,MA:()=>Ne.MA,DG:()=>Ce.D,p:()=>Oe.p,PV:()=>Se.P,hB:()=>O.hB,Ye:()=>ce,Fw:()=>ee,UL:()=>A.U,VZ:()=>te,xS:()=>re,sH:()=>_e,Jc:()=>Ne.Jc,TB:()=>C.TB,YF:()=>ye,bc:()=>Ne.bc,wz:()=>z.w,zC:()=>oe,tc:()=>be,ao:()=>x,r0:()=>C.r0,eG:()=>O.eG,EH:()=>O.EH,gm:()=>Ne.gm,r2:()=>me,Hp:()=>ie,nL:()=>G,lr:()=>Ne.lr,FF:()=>K,vB:()=>O.vB,Mc:()=>C.Mc,mM:()=>R.m,SY:()=>D.S,pF:()=>D.p,tO:()=>O.tO,tv:()=>L.t,Rx:()=>j,tG:()=>d.t,dC:()=>Y,rv:()=>Ve,Ik:()=>se,g5:()=>ae,Eu:()=>fe,pv:()=>A.p});var i=n(70848),r=n(89762),o=n(88215),a=n(69958),c=n(44337),s=n(93682),u=n(96979),l=n(89592),p=n(97163),d=n(32709),h=n(31191),f=n(90360),m=n(62976),g=n(48620),b=(n(51802),n(59725),function(e){function t(t){var n=e.call(this,t,i.u.Vertex)||this;return n.registerInput("matricesIndices",r.E.Vector4),n.registerInput("matricesWeights",r.E.Vector4),n.registerInput("matricesIndicesExtra",r.E.Vector4,!0),n.registerInput("matricesWeightsExtra",r.E.Vector4,!0),n.registerInput("world",r.E.Matrix),n.registerOutput("output",r.E.Matrix),n}return(0,h.ZT)(t,e),t.prototype.initialize=function(e){e._excludeVariableName("boneSampler"),e._excludeVariableName("boneTextureWidth"),e._excludeVariableName("mBones"),e._excludeVariableName("BonesPerMesh")},t.prototype.getClassName=function(){return"BonesBlock"},Object.defineProperty(t.prototype,"matricesIndices",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matricesWeights",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matricesIndicesExtra",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matricesWeightsExtra",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.matricesIndices.isConnected){var t=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"matricesIndices"===e.name}));t||(t=new m.S("matricesIndices")).setAsAttribute("matricesIndices"),t.output.connectTo(this.matricesIndices)}if(!this.matricesWeights.isConnected){var n=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"matricesWeights"===e.name}));n||(n=new m.S("matricesWeights")).setAsAttribute("matricesWeights"),n.output.connectTo(this.matricesWeights)}if(!this.world.isConnected){var i=e.getInputBlockByPredicate((function(e){return e.systemValue===a.$.World}));i||(i=new m.S("world")).setAsSystemValue(a.$.World),i.output.connectTo(this.world)}},t.prototype.provideFallbacks=function(e,t){e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton&&t.addCPUSkinningFallback(0,e)},t.prototype.bind=function(e,t,n){f.G.BindBonesParameters(n,e)},t.prototype.prepareDefines=function(e,t,n){n._areAttributesDirty&&f.G.PrepareDefinesForBones(e,n)},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t),t.sharedData.blocksWithFallbacks.push(this),t.sharedData.forcedBindableBlocks.push(this),t.sharedData.blocksWithDefines.push(this),t.uniforms.push("boneTextureWidth"),t.uniforms.push("mBones"),t.samplers.push("boneSampler");var n="//".concat(this.name);t._emitFunctionFromInclude("bonesDeclaration",n,{removeAttributes:!0,removeUniforms:!1,removeVaryings:!0,removeIfDef:!1});var i=t._getFreeVariableName("influence");t.compilationString+=t._emitCodeFromInclude("bonesVertex",n,{replaceStrings:[{search:/finalWorld=finalWorld\*influence;/,replace:""},{search:/influence/gm,replace:i}]});var r=this._outputs[0],o=this.world;return t.compilationString+="#if NUM_BONE_INFLUENCERS>0\r\n",t.compilationString+=this._declareOutput(r,t)+" = ".concat(o.associatedVariableName," * ").concat(i,";\r\n"),t.compilationString+="#else\r\n",t.compilationString+=this._declareOutput(r,t)+" = ".concat(o.associatedVariableName,";\r\n"),t.compilationString+="#endif\r\n",this},t}(l.k));(0,g.H)("BABYLON.BonesBlock",b);var _=function(e){function t(t){var n=e.call(this,t,i.u.Vertex)||this;return n.registerInput("world0",r.E.Vector4),n.registerInput("world1",r.E.Vector4),n.registerInput("world2",r.E.Vector4),n.registerInput("world3",r.E.Vector4),n.registerInput("world",r.E.Matrix,!0),n.registerOutput("output",r.E.Matrix),n.registerOutput("instanceID",r.E.Float),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"InstancesBlock"},Object.defineProperty(t.prototype,"world0",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world1",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world2",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world3",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"instanceID",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.world0.connectedPoint){var t=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"world0"===e.name}));t||(t=new m.S("world0")).setAsAttribute("world0"),t.output.connectTo(this.world0)}if(!this.world1.connectedPoint){var n=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"world1"===e.name}));n||(n=new m.S("world1")).setAsAttribute("world1"),n.output.connectTo(this.world1)}if(!this.world2.connectedPoint){var i=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"world2"===e.name}));i||(i=new m.S("world2")).setAsAttribute("world2"),i.output.connectTo(this.world2)}if(!this.world3.connectedPoint){var r=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"world3"===e.name}));r||(r=new m.S("world3")).setAsAttribute("world3"),r.output.connectTo(this.world3)}if(!this.world.connectedPoint){var o=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"world"===e.name}));o||(o=new m.S("world")).setAsSystemValue(a.$.World),o.output.connectTo(this.world)}this.world.define="!INSTANCES || THIN_INSTANCES"},t.prototype.prepareDefines=function(e,t,n,i,r){void 0===i&&(i=!1);var o=!1;n.INSTANCES!==i&&(n.setValue("INSTANCES",i),o=!0),r&&n.THIN_INSTANCES!==!!(null==r?void 0:r.getRenderingMesh().hasThinInstances)&&(n.setValue("THIN_INSTANCES",!!(null==r?void 0:r.getRenderingMesh().hasThinInstances)),o=!0),o&&n.markAsUnprocessed()},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=t.sharedData.scene.getEngine();t.sharedData.blocksWithDefines.push(this);var i=this._outputs[0],r=this._outputs[1],o=this.world0,a=this.world1,c=this.world2,s=this.world3;return t.compilationString+="#ifdef INSTANCES\r\n",t.compilationString+=this._declareOutput(i,t)+" = mat4(".concat(o.associatedVariableName,", ").concat(a.associatedVariableName,", ").concat(c.associatedVariableName,", ").concat(s.associatedVariableName,");\r\n"),t.compilationString+="#ifdef THIN_INSTANCES\r\n",t.compilationString+="".concat(i.associatedVariableName," = ").concat(this.world.associatedVariableName," * ").concat(i.associatedVariableName,";\r\n"),t.compilationString+="#endif\r\n",n._caps.canUseGLInstanceID?t.compilationString+=this._declareOutput(r,t)+" = float(gl_InstanceID);\r\n":t.compilationString+=this._declareOutput(r,t)+" = 0.0;\r\n",t.compilationString+="#else\r\n",t.compilationString+=this._declareOutput(i,t)+" = ".concat(this.world.associatedVariableName,";\r\n"),t.compilationString+=this._declareOutput(r,t)+" = 0.0;\r\n",t.compilationString+="#endif\r\n",this},t}(l.k);(0,g.H)("BABYLON.InstancesBlock",_);var y=n(72208),v=(n(43440),n(93608),function(e){function t(t){var n=e.call(this,t,i.u.Vertex)||this;return n.registerInput("position",r.E.Vector3),n.registerInput("normal",r.E.Vector3),n.registerInput("tangent",r.E.Vector4),n.tangent.acceptedConnectionPointTypes.push(r.E.Vector3),n.registerInput("uv",r.E.Vector2),n.registerOutput("positionOutput",r.E.Vector3),n.registerOutput("normalOutput",r.E.Vector3),n.registerOutput("tangentOutput",r.E.Vector4),n.registerOutput("uvOutput",r.E.Vector2),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"MorphTargetsBlock"},Object.defineProperty(t.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangent",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"positionOutput",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalOutput",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangentOutput",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uvOutput",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),t.prototype.initialize=function(e){e._excludeVariableName("morphTargetInfluences")},t.prototype.autoConfigure=function(e){if(!this.position.isConnected){var t=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"position"===e.name}));t||(t=new m.S("position")).setAsAttribute(),t.output.connectTo(this.position)}if(!this.normal.isConnected){var n=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"normal"===e.name}));n||(n=new m.S("normal")).setAsAttribute("normal"),n.output.connectTo(this.normal)}if(!this.tangent.isConnected){var i=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"tangent"===e.name}));i||(i=new m.S("tangent")).setAsAttribute("tangent"),i.output.connectTo(this.tangent)}if(!this.uv.isConnected){var r=e.getInputBlockByPredicate((function(e){return e.isAttribute&&"uv"===e.name}));r||(r=new m.S("uv")).setAsAttribute("uv"),r.output.connectTo(this.uv)}},t.prototype.prepareDefines=function(e,t,n){if(e.morphTargetManager){var i=e.morphTargetManager;(null==i?void 0:i.isUsingTextureForTargets)&&i.numInfluencers!==n.NUM_MORPH_INFLUENCERS&&n.markAsAttributesDirty()}n._areAttributesDirty&&f.G.PrepareDefinesForMorphTargets(e,n)},t.prototype.bind=function(e,t,n){n&&n.morphTargetManager&&n.morphTargetManager.numInfluencers>0&&(f.G.BindMorphTargetParameters(n,e),n.morphTargetManager.isUsingTextureForTargets&&n.morphTargetManager._bind(e))},t.prototype.replaceRepeatableContent=function(e,t,n,i){var o=this.position,a=this.normal,c=this.tangent,s=this.uv,u=this.positionOutput,l=this.normalOutput,p=this.tangentOutput,d=this.uvOutput,h=e,f=i.NUM_MORPH_INFLUENCERS,m=n.morphTargetManager,g=m&&m.supportsNormals&&i.NORMAL,b=m&&m.supportsTangents&&i.TANGENT,_=m&&m.supportsUVs&&i.UV1,v="";(null==m?void 0:m.isUsingTextureForTargets)&&f>0&&(v+="float vertexID;\r\n");for(var N=0;N<f;N++)v+="#ifdef MORPHTARGETS\r\n",(null==m?void 0:m.isUsingTextureForTargets)?(v+="vertexID = float(gl_VertexID) * morphTargetTextureInfo.x;\r\n",v+="".concat(u.associatedVariableName," += (readVector3FromRawSampler(").concat(N,", vertexID) - ").concat(o.associatedVariableName,") * morphTargetInfluences[").concat(N,"];\r\n"),v+="vertexID += 1.0;\r\n"):v+="".concat(u.associatedVariableName," += (position").concat(N," - ").concat(o.associatedVariableName,") * morphTargetInfluences[").concat(N,"];\r\n"),g&&(v+="#ifdef MORPHTARGETS_NORMAL\r\n",(null==m?void 0:m.isUsingTextureForTargets)?(v+="".concat(l.associatedVariableName," += (readVector3FromRawSampler(").concat(N,", vertexID) - ").concat(a.associatedVariableName,") * morphTargetInfluences[").concat(N,"];\r\n"),v+="vertexID += 1.0;\r\n"):v+="".concat(l.associatedVariableName," += (normal").concat(N," - ").concat(a.associatedVariableName,") * morphTargetInfluences[").concat(N,"];\r\n"),v+="#endif\r\n"),_&&(v+="#ifdef MORPHTARGETS_UV\r\n",(null==m?void 0:m.isUsingTextureForTargets)?(v+="".concat(d.associatedVariableName," += (readVector3FromRawSampler(").concat(N,", vertexID).xy - ").concat(s.associatedVariableName,") * morphTargetInfluences[").concat(N,"];\r\n"),v+="vertexID += 1.0;\r\n"):v+="".concat(d.associatedVariableName,".xy += (uv_").concat(N," - ").concat(s.associatedVariableName,".xy) * morphTargetInfluences[").concat(N,"];\r\n"),v+="#endif\r\n"),b&&(v+="#ifdef MORPHTARGETS_TANGENT\r\n",(null==m?void 0:m.isUsingTextureForTargets)?v+="".concat(p.associatedVariableName,".xyz += (readVector3FromRawSampler(").concat(N,", vertexID) - ").concat(c.associatedVariableName,".xyz) * morphTargetInfluences[").concat(N,"];\r\n"):v+="".concat(p.associatedVariableName,".xyz += (tangent").concat(N," - ").concat(c.associatedVariableName,".xyz) * morphTargetInfluences[").concat(N,"];\r\n"),c.type===r.E.Vector4?v+="".concat(p.associatedVariableName,".w = ").concat(c.associatedVariableName,".w;\r\n"):v+="".concat(p.associatedVariableName,".w = 1.;\r\n"),v+="#endif\r\n"),v+="#endif\r\n";if(h.compilationString=h.compilationString.replace(this._repeatableContentAnchor,v),f>0)for(N=0;N<f;N++)h.attributes.push(y.o.PositionKind+N),g&&h.attributes.push(y.o.NormalKind+N),b&&h.attributes.push(y.o.TangentKind+N),_&&h.attributes.push(y.o.UVKind+"_"+N)},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t),t.sharedData.blocksWithDefines.push(this),t.sharedData.bindableBlocks.push(this),t.sharedData.repeatableContentBlocks.push(this);var n=this.position,i=this.normal,r=this.tangent,o=this.uv,a=this.positionOutput,c=this.normalOutput,s=this.tangentOutput,u=this.uvOutput,l="//".concat(this.name);return t.uniforms.push("morphTargetInfluences"),t.uniforms.push("morphTargetTextureInfo"),t.uniforms.push("morphTargetTextureIndices"),t.samplers.push("morphTargets"),t._emitFunctionFromInclude("morphTargetsVertexGlobalDeclaration",l),t._emitFunctionFromInclude("morphTargetsVertexDeclaration",l,{repeatKey:"maxSimultaneousMorphTargets"}),t.compilationString+="".concat(this._declareOutput(a,t)," = ").concat(n.associatedVariableName,";\r\n"),t.compilationString+="#ifdef NORMAL\r\n",t.compilationString+="".concat(this._declareOutput(c,t)," = ").concat(i.associatedVariableName,";\r\n"),t.compilationString+="#else\r\n",t.compilationString+="".concat(this._declareOutput(c,t)," = vec3(0., 0., 0.);\r\n"),t.compilationString+="#endif\r\n",t.compilationString+="#ifdef TANGENT\r\n",t.compilationString+="".concat(this._declareOutput(s,t)," = ").concat(r.associatedVariableName,";\r\n"),t.compilationString+="#else\r\n",t.compilationString+="".concat(this._declareOutput(s,t)," = vec4(0., 0., 0., 0.);\r\n"),t.compilationString+="#endif\r\n",t.compilationString+="#ifdef UV1\r\n",t.compilationString+="".concat(this._declareOutput(u,t)," = ").concat(o.associatedVariableName,";\r\n"),t.compilationString+="#else\r\n",t.compilationString+="".concat(this._declareOutput(u,t)," = vec2(0., 0.);\r\n"),t.compilationString+="#endif\r\n",this._repeatableContentAnchor=t._repeatableContentAnchor,t.compilationString+=this._repeatableContentAnchor,this},t}(l.k));(0,g.H)("BABYLON.MorphTargetsBlock",v);var N=n(65064),S=function(e){function t(t){var n=e.call(this,t,i.u.Vertex)||this;return n.registerInput("worldPosition",r.E.Vector4,!1,i.u.Vertex),n.registerOutput("direction",r.E.Vector3),n.registerOutput("color",r.E.Color3),n.registerOutput("intensity",r.E.Float),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"LightInformationBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype.bind=function(e,t,n){if(n){this.light&&this.light.isDisposed&&(this.light=null);var i=this.light,r=t.getScene();if(!i&&r.lights.length&&(i=this.light=r.lights[0],this._forcePrepareDefines=!0),!i||!i.isEnabled)return e.setFloat3(this._lightDataUniformName,0,0,0),void e.setFloat4(this._lightColorUniformName,0,0,0,0);i.transferToNodeMaterialEffect(e,this._lightDataUniformName),e.setColor4(this._lightColorUniformName,i.diffuse,i.intensity)}},t.prototype.prepareDefines=function(e,t,n){if(n._areLightsDirty||this._forcePrepareDefines){this._forcePrepareDefines=!1;var i=this.light;n.setValue(this._lightTypeDefineName,!!(i&&i instanceof N.c),!0)}},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t),t.sharedData.bindableBlocks.push(this),t.sharedData.blocksWithDefines.push(this);var n=this.direction,i=this.color,r=this.intensity;return this._lightDataUniformName=t._getFreeVariableName("lightData"),this._lightColorUniformName=t._getFreeVariableName("lightColor"),this._lightTypeDefineName=t._getFreeDefineName("LIGHTPOINTTYPE"),t._emitUniformFromString(this._lightDataUniformName,"vec3"),t._emitUniformFromString(this._lightColorUniformName,"vec4"),t.compilationString+="#ifdef ".concat(this._lightTypeDefineName,"\r\n"),t.compilationString+=this._declareOutput(n,t)+" = normalize(".concat(this.worldPosition.associatedVariableName,".xyz - ").concat(this._lightDataUniformName,");\r\n"),t.compilationString+="#else\r\n",t.compilationString+=this._declareOutput(n,t)+" = ".concat(this._lightDataUniformName,";\r\n"),t.compilationString+="#endif\r\n",t.compilationString+=this._declareOutput(i,t)+" = ".concat(this._lightColorUniformName,".rgb;\r\n"),t.compilationString+=this._declareOutput(r,t)+" = ".concat(this._lightColorUniformName,".a;\r\n"),this},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return this.light&&(t.lightId=this.light.id),t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),t.lightId&&(this.light=n.getLightById(t.lightId))},t}(l.k);(0,g.H)("BABYLON.LightInformationBlock",S);var O=n(4670),C=n(33325),E=n(32247),P=n(66897),I=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("left",r.E.AutoDetect),n.registerInput("right",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"AddBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = ".concat(this.left.associatedVariableName," + ").concat(this.right.associatedVariableName,";\r\n"),this},t}(l.k);(0,g.H)("BABYLON.AddBlock",I);var x=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("input",r.E.AutoDetect),n.registerInput("factor",r.E.Float),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"ScaleBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"factor",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = ".concat(this.input.associatedVariableName," * ").concat(this.factor.associatedVariableName,";\r\n"),this},t}(l.k);(0,g.H)("BABYLON.ScaleBlock",x);var A=n(12352),T=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.minimum=0,n.maximum=1,n.registerInput("value",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"ClampBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = clamp(".concat(this.value.associatedVariableName,", ").concat(this._writeFloat(this.minimum),", ").concat(this._writeFloat(this.maximum),");\r\n"),this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this)+"".concat(this._codeVariableName,".minimum = ").concat(this.minimum,";\r\n");return t+="".concat(this._codeVariableName,".maximum = ").concat(this.maximum,";\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.minimum=this.minimum,t.maximum=this.maximum,t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),this.minimum=t.minimum,this.maximum=t.maximum},(0,h.gn)([(0,A.p)("Minimum",A.U.Float)],t.prototype,"minimum",void 0),(0,h.gn)([(0,A.p)("Maximum",A.U.Float)],t.prototype,"maximum",void 0),t}(l.k);(0,g.H)("BABYLON.ClampBlock",T);var V=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("left",r.E.AutoDetect),n.registerInput("right",r.E.AutoDetect),n.registerOutput("output",r.E.Vector3),n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(r.E.Float),n._inputs[0].excludedConnectionPointTypes.push(r.E.Matrix),n._inputs[0].excludedConnectionPointTypes.push(r.E.Vector2),n._inputs[1].excludedConnectionPointTypes.push(r.E.Float),n._inputs[1].excludedConnectionPointTypes.push(r.E.Matrix),n._inputs[1].excludedConnectionPointTypes.push(r.E.Vector2),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"CrossBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = cross(".concat(this.left.associatedVariableName,".xyz, ").concat(this.right.associatedVariableName,".xyz);\r\n"),this},t}(l.k);(0,g.H)("BABYLON.CrossBlock",V);var F=function(e){function t(t){return e.call(this,t)||this}return(0,h.ZT)(t,e),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},set:function(e){this._deserializeOptions(e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"CustomBlock"},t.prototype._buildBlock=function(t){var n=this;e.prototype._buildBlock.call(this,t);var i=this._code,r=this._options.functionName;this._inputs.forEach((function(e){var n=new RegExp("\\{TYPE_"+e.name+"\\}","gm"),o=t._getGLType(e.type);i=i.replace(n,o),r=r.replace(n,o)})),this._outputs.forEach((function(e){var n=new RegExp("\\{TYPE_"+e.name+"\\}","gm"),o=t._getGLType(e.type);i=i.replace(n,o),r=r.replace(n,o)})),t._emitFunction(r,i,""),this._outputs.forEach((function(e){t.compilationString+=n._declareOutput(e,t)+";\r\n"})),t.compilationString+=r+"(";var o=!1;return this._inputs.forEach((function(e,n){n>0&&(t.compilationString+=", "),t.compilationString+=e.associatedVariableName,o=!0})),this._outputs.forEach((function(e,n){(n>0||o)&&(t.compilationString+=", "),t.compilationString+=e.associatedVariableName})),t.compilationString+=");\r\n",this},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);return t+="".concat(this._codeVariableName,".options = ").concat(JSON.stringify(this._options),";\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.options=this._options,t},t.prototype._deserialize=function(t,n,i){this._deserializeOptions(t.options),e.prototype._deserialize.call(this,t,n,i)},t.prototype._deserializeOptions=function(e){var t,n,o,a=this;this._options=e,this._code=e.code.join("\r\n")+"\r\n",this.name=this.name||e.name,this.target=i.u[e.target],null===(t=e.inParameters)||void 0===t||t.forEach((function(e,t){var n=r.E[e.type];a.registerInput(e.name,n),Object.defineProperty(a,e.name,{get:function(){return this._inputs[t]},enumerable:!0,configurable:!0})})),null===(n=e.outParameters)||void 0===n||n.forEach((function(e,t){a.registerOutput(e.name,r.E[e.type]),Object.defineProperty(a,e.name,{get:function(){return this._outputs[t]},enumerable:!0,configurable:!0}),"BasedOnInput"===e.type&&(a._outputs[t]._typeConnectionSource=a._findInputByName(e.typeFromInput)[0])})),null===(o=e.inLinkedConnectionTypes)||void 0===o||o.forEach((function(e){a._linkConnectionTypes(a._findInputByName(e.input1)[1],a._findInputByName(e.input2)[1])}))},t.prototype._findInputByName=function(e){if(!e)return null;for(var t=0;t<this._inputs.length;t++)if(this._inputs[t].name===e)return[this._inputs[t],t];return null},t}(l.k);(0,g.H)("BABYLON.CustomBlock",F);var B=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("left",r.E.AutoDetect),n.registerInput("right",r.E.AutoDetect),n.registerOutput("output",r.E.Float),n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(r.E.Float),n._inputs[0].excludedConnectionPointTypes.push(r.E.Matrix),n._inputs[1].excludedConnectionPointTypes.push(r.E.Float),n._inputs[1].excludedConnectionPointTypes.push(r.E.Matrix),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"DotBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = dot(".concat(this.left.associatedVariableName,", ").concat(this.right.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.DotBlock",B);var R=n(73702),z=n(61878),k=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("input",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._inputs[0].excludedConnectionPointTypes.push(r.E.Float),n._inputs[0].excludedConnectionPointTypes.push(r.E.Matrix),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"NormalizeBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0],i=this._inputs[0];return t.compilationString+=this._declareOutput(n,t)+" = normalize(".concat(i.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.NormalizeBlock",k);var D=n(94018),w=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.rSwizzle="r",n.gSwizzle="g",n.bSwizzle="b",n.aSwizzle="a",n.registerInput("rgb ",r.E.Color3,!0),n.registerInput("r",r.E.Float,!0),n.registerInput("g",r.E.Float,!0),n.registerInput("b",r.E.Float,!0),n.registerInput("a",r.E.Float,!0),n.registerOutput("rgba",r.E.Color4),n.registerOutput("rgb",r.E.Color3),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"ColorMergerBlock"},Object.defineProperty(t.prototype,"rgbIn",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgbOut",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return this.rgbOut},enumerable:!1,configurable:!0}),t.prototype._inputRename=function(e){return"rgb "===e?"rgbIn":e},t.prototype._buildSwizzle=function(e){return"."+(this.rSwizzle+this.gSwizzle+this.bSwizzle+this.aSwizzle).substr(0,e)},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this.r,i=this.g,r=this.b,o=this.a,a=this.rgbIn,c=this._outputs[0],s=this._outputs[1];return a.isConnected?(c.hasEndpoints&&(t.compilationString+=this._declareOutput(c,t)+" = vec4(".concat(a.associatedVariableName,", ").concat(o.isConnected?this._writeVariable(o):"0.0",")").concat(this._buildSwizzle(4),";\r\n")),s.hasEndpoints&&(t.compilationString+=this._declareOutput(s,t)+" = ".concat(a.associatedVariableName).concat(this._buildSwizzle(3),";\r\n"))):(c.hasEndpoints&&(t.compilationString+=this._declareOutput(c,t)+" = vec4(".concat(n.isConnected?this._writeVariable(n):"0.0",", ").concat(i.isConnected?this._writeVariable(i):"0.0",", ").concat(r.isConnected?this._writeVariable(r):"0.0",", ").concat(o.isConnected?this._writeVariable(o):"0.0",")").concat(this._buildSwizzle(4),";\r\n")),s.hasEndpoints&&(t.compilationString+=this._declareOutput(s,t)+" = vec3(".concat(n.isConnected?this._writeVariable(n):"0.0",", ").concat(i.isConnected?this._writeVariable(i):"0.0",", ").concat(r.isConnected?this._writeVariable(r):"0.0",")").concat(this._buildSwizzle(3),";\r\n"))),this},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.rSwizzle=this.rSwizzle,t.gSwizzle=this.gSwizzle,t.bSwizzle=this.bSwizzle,t.aSwizzle=this.aSwizzle,t},t.prototype._deserialize=function(t,n,i){var r,o,a,c;e.prototype._deserialize.call(this,t,n,i),this.rSwizzle=null!==(r=t.rSwizzle)&&void 0!==r?r:"r",this.gSwizzle=null!==(o=t.gSwizzle)&&void 0!==o?o:"g",this.bSwizzle=null!==(a=t.bSwizzle)&&void 0!==a?a:"b",this.aSwizzle=null!==(c=t.aSwizzle)&&void 0!==c?c:"a"},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);return t+="".concat(this._codeVariableName,".rSwizzle = ").concat(this.rSwizzle,";\r\n"),t+="".concat(this._codeVariableName,".gSwizzle = ").concat(this.gSwizzle,";\r\n"),t+="".concat(this._codeVariableName,".bSwizzle = ").concat(this.bSwizzle,";\r\n"),t+="".concat(this._codeVariableName,".aSwizzle = ").concat(this.aSwizzle,";\r\n")},t}(l.k);(0,g.H)("BABYLON.ColorMergerBlock",w);var L=n(72868),M=n(4482),j=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("xyzw",r.E.Vector4,!0),n.registerInput("xyz ",r.E.Vector3,!0),n.registerInput("xy ",r.E.Vector2,!0),n.registerOutput("xyz",r.E.Vector3),n.registerOutput("xy",r.E.Vector2),n.registerOutput("zw",r.E.Vector2),n.registerOutput("x",r.E.Float),n.registerOutput("y",r.E.Float),n.registerOutput("z",r.E.Float),n.registerOutput("w",r.E.Float),n.inputsAreExclusive=!0,n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"VectorSplitterBlock"},Object.defineProperty(t.prototype,"xyzw",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzIn",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyIn",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyzOut",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyOut",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zw",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._outputs[6]},enumerable:!1,configurable:!0}),t.prototype._inputRename=function(e){switch(e){case"xy ":return"xyIn";case"xyz ":return"xyzIn";default:return e}},t.prototype._outputRename=function(e){switch(e){case"xy":return"xyOut";case"xyz":return"xyzOut";default:return e}},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this.xyzw.isConnected?this.xyzw:this.xyzIn.isConnected?this.xyzIn:this.xyIn,i=this._outputs[0],r=this._outputs[1],o=this._outputs[2],a=this._outputs[3],c=this._outputs[4],s=this._outputs[5],u=this._outputs[6];return i.hasEndpoints&&(n===this.xyIn?t.compilationString+=this._declareOutput(i,t)+" = vec3(".concat(n.associatedVariableName,", 0.0);\r\n"):t.compilationString+=this._declareOutput(i,t)+" = ".concat(n.associatedVariableName,".xyz;\r\n")),o.hasEndpoints&&this.xyzw.isConnected&&(t.compilationString+=this._declareOutput(o,t)+" = ".concat(this.xyzw.associatedVariableName,".zw;\r\n")),r.hasEndpoints&&(t.compilationString+=this._declareOutput(r,t)+" = ".concat(n.associatedVariableName,".xy;\r\n")),a.hasEndpoints&&(t.compilationString+=this._declareOutput(a,t)+" = ".concat(n.associatedVariableName,".x;\r\n")),c.hasEndpoints&&(t.compilationString+=this._declareOutput(c,t)+" = ".concat(n.associatedVariableName,".y;\r\n")),s.hasEndpoints&&(t.compilationString+=this._declareOutput(s,t)+" = ".concat(n.associatedVariableName,".z;\r\n")),u.hasEndpoints&&(t.compilationString+=this._declareOutput(u,t)+" = ".concat(n.associatedVariableName,".w;\r\n")),this},t}(l.k);(0,g.H)("BABYLON.VectorSplitterBlock",j);var U=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("left",r.E.AutoDetect),n.registerInput("right",r.E.AutoDetect),n.registerInput("gradient",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._linkConnectionTypes(1,2,!0),n._inputs[2].acceptedConnectionPointTypes.push(r.E.Float),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"LerpBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = mix(".concat(this.left.associatedVariableName," , ").concat(this.right.associatedVariableName,", ").concat(this.gradient.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.LerpBlock",U);var H=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("left",r.E.AutoDetect),n.registerInput("right",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"DivideBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = ".concat(this.left.associatedVariableName," / ").concat(this.right.associatedVariableName,";\r\n"),this},t}(l.k);(0,g.H)("BABYLON.DivideBlock",H);var K=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("left",r.E.AutoDetect),n.registerInput("right",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"SubtractBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = ".concat(this.left.associatedVariableName," - ").concat(this.right.associatedVariableName,";\r\n"),this},t}(l.k);(0,g.H)("BABYLON.SubtractBlock",K);var G=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("value",r.E.Float),n.registerInput("edge",r.E.Float),n.registerOutput("output",r.E.Float),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"StepBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edge",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = step(".concat(this.edge.associatedVariableName,", ").concat(this.value.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.StepBlock",G);var W=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("input",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._outputs[0].excludedConnectionPointTypes.push(r.E.Matrix),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"OneMinusBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = 1. - ".concat(this.input.associatedVariableName,";\r\n"),this},t}(l.k);(0,g.H)("BABYLON.OneMinusBlock",W),(0,g.H)("BABYLON.OppositeBlock",W);var Y=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("worldPosition",r.E.Vector4),n.registerInput("cameraPosition",r.E.Vector3),n.registerOutput("output",r.E.Vector3),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"ViewDirectionBlock"},Object.defineProperty(t.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraPosition",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.cameraPosition.isConnected){var t=e.getInputBlockByPredicate((function(e){return e.systemValue===a.$.CameraPosition}));t||(t=new m.S("cameraPosition")).setAsSystemValue(a.$.CameraPosition),t.output.connectTo(this.cameraPosition)}},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = normalize(".concat(this.cameraPosition.associatedVariableName," - ").concat(this.worldPosition.associatedVariableName,".xyz);\r\n"),this},t}(l.k);(0,g.H)("BABYLON.ViewDirectionBlock",Y);n(63885);var Z=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("worldNormal",r.E.Vector4),n.registerInput("viewDirection",r.E.Vector3),n.registerInput("bias",r.E.Float),n.registerInput("power",r.E.Float),n.registerOutput("fresnel",r.E.Float),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"FresnelBlock"},Object.defineProperty(t.prototype,"worldNormal",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewDirection",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bias",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fresnel",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(e){if(!this.viewDirection.isConnected){var t=new Y("View direction");t.output.connectTo(this.viewDirection),t.autoConfigure(e)}if(!this.bias.isConnected){var n=new m.S("bias");n.value=0,n.output.connectTo(this.bias)}if(!this.power.isConnected){var i=new m.S("power");i.value=1,i.output.connectTo(this.power)}},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n="//".concat(this.name);return t._emitFunctionFromInclude("fresnelFunction",n,{removeIfDef:!0}),t.compilationString+=this._declareOutput(this.fresnel,t)+" = computeFresnelTerm(".concat(this.viewDirection.associatedVariableName,".xyz, ").concat(this.worldNormal.associatedVariableName,".xyz, ").concat(this.bias.associatedVariableName,", ").concat(this.power.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.FresnelBlock",Z);var X=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("left",r.E.AutoDetect),n.registerInput("right",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"MaxBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = max(".concat(this.left.associatedVariableName,", ").concat(this.right.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.MaxBlock",X);var q=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("left",r.E.AutoDetect),n.registerInput("right",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"MinBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = min(".concat(this.left.associatedVariableName,", ").concat(this.right.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.MinBlock",q);var Q=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("left",r.E.AutoDetect),n.registerInput("right",r.E.AutoDetect),n.registerOutput("output",r.E.Float),n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(r.E.Float),n._inputs[0].excludedConnectionPointTypes.push(r.E.Matrix),n._inputs[1].excludedConnectionPointTypes.push(r.E.Float),n._inputs[1].excludedConnectionPointTypes.push(r.E.Matrix),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"DistanceBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = length(".concat(this.left.associatedVariableName," - ").concat(this.right.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.DistanceBlock",Q);var $=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("value",r.E.AutoDetect),n.registerOutput("output",r.E.Float),n._inputs[0].excludedConnectionPointTypes.push(r.E.Float),n._inputs[0].excludedConnectionPointTypes.push(r.E.Matrix),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"LengthBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = length(".concat(this.value.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.LengthBlock",$);var J=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("value",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"NegateBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = -1.0 * ".concat(this.value.associatedVariableName,";\r\n"),this},t}(l.k);(0,g.H)("BABYLON.NegateBlock",J);var ee=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("value",r.E.AutoDetect),n.registerInput("power",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"PowBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = pow(".concat(this.value.associatedVariableName,", ").concat(this.power.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.PowBlock",ee);n(54081);var te=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("seed",r.E.Vector2),n.registerOutput("output",r.E.Float),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Color3),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Color4),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"RandomNumberBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0],i="//".concat(this.name);return t._emitFunctionFromInclude("helperFunctions",i),t.compilationString+=this._declareOutput(n,t)+" = getRand(".concat(this.seed.associatedVariableName,".xy);\r\n"),this},t}(l.k);(0,g.H)("BABYLON.RandomNumberBlock",te);var ne=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("x",r.E.Float),n.registerInput("y",r.E.Float),n.registerOutput("output",r.E.Float),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"ArcTan2Block"},Object.defineProperty(t.prototype,"x",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = atan(".concat(this.x.associatedVariableName,", ").concat(this.y.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.ArcTan2Block",ne);var ie=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("value",r.E.AutoDetect),n.registerInput("edge0",r.E.Float),n.registerInput("edge1",r.E.Float),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"SmoothStepBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edge0",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"edge1",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = smoothstep(".concat(this.edge0.associatedVariableName,", ").concat(this.edge1.associatedVariableName,", ").concat(this.value.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.SmoothStepBlock",ie);var re=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("input",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._outputs[0].excludedConnectionPointTypes.push(r.E.Matrix),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"ReciprocalBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = 1. / ".concat(this.input.associatedVariableName,";\r\n"),this},t}(l.k);(0,g.H)("BABYLON.ReciprocalBlock",re);var oe=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("value",r.E.AutoDetect),n.registerInput("reference",r.E.AutoDetect),n.registerInput("distance",r.E.Float),n.registerInput("replacement",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._linkConnectionTypes(0,3),n._inputs[0].excludedConnectionPointTypes.push(r.E.Float),n._inputs[0].excludedConnectionPointTypes.push(r.E.Matrix),n._inputs[1].excludedConnectionPointTypes.push(r.E.Float),n._inputs[1].excludedConnectionPointTypes.push(r.E.Matrix),n._inputs[3].excludedConnectionPointTypes.push(r.E.Float),n._inputs[3].excludedConnectionPointTypes.push(r.E.Matrix),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"ReplaceColorBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reference",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"replacement",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+";\r\n",t.compilationString+="if (length(".concat(this.value.associatedVariableName," - ").concat(this.reference.associatedVariableName,") < ").concat(this.distance.associatedVariableName,") {\r\n"),t.compilationString+="".concat(n.associatedVariableName," = ").concat(this.replacement.associatedVariableName,";\r\n"),t.compilationString+="} else {\r\n",t.compilationString+="".concat(n.associatedVariableName," = ").concat(this.value.associatedVariableName,";\r\n"),t.compilationString+="}\r\n",this},t}(l.k);(0,g.H)("BABYLON.ReplaceColorBlock",oe);var ae,ce=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("value",r.E.AutoDetect),n.registerInput("steps",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._inputs[0].excludedConnectionPointTypes.push(r.E.Matrix),n._inputs[1].excludedConnectionPointTypes.push(r.E.Matrix),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"PosterizeBlock"},Object.defineProperty(t.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"steps",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = floor(".concat(this.value.associatedVariableName," / (1.0 / ").concat(this.steps.associatedVariableName,")) * (1.0 / ").concat(this.steps.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.PosterizeBlock",ce),function(e){e[e.SawTooth=0]="SawTooth",e[e.Square=1]="Square",e[e.Triangle=2]="Triangle"}(ae||(ae={}));var se=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.kind=ae.SawTooth,n.registerInput("input",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._inputs[0].excludedConnectionPointTypes.push(r.E.Matrix),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"WaveBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];switch(this.kind){case ae.SawTooth:t.compilationString+=this._declareOutput(n,t)+" = ".concat(this.input.associatedVariableName," - floor(0.5 + ").concat(this.input.associatedVariableName,");\r\n");break;case ae.Square:t.compilationString+=this._declareOutput(n,t)+" = 1.0 - 2.0 * round(fract(".concat(this.input.associatedVariableName,"));\r\n");break;case ae.Triangle:t.compilationString+=this._declareOutput(n,t)+" = 2.0 * abs(2.0 * (".concat(this.input.associatedVariableName," - floor(0.5 + ").concat(this.input.associatedVariableName,"))) - 1.0;\r\n")}return this},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.kind=this.kind,t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),this.kind=t.kind},t}(l.k);(0,g.H)("BABYLON.WaveBlock",se);var ue=n(15631),le=n(62897),pe=function(){function e(e,t){this.step=e,this.color=t}return Object.defineProperty(e.prototype,"step",{get:function(){return this._step},set:function(e){this._step=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e},enumerable:!1,configurable:!0}),e}(),de=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.colorSteps=[new pe(0,ue.Wo.Black()),new pe(1,ue.Wo.White())],n.onValueChangedObservable=new le.y$,n.registerInput("gradient",r.E.Float),n.registerOutput("output",r.E.Color3),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Vector2),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Color3),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Color4),n}return(0,h.ZT)(t,e),t.prototype.colorStepsUpdated=function(){this.onValueChangedObservable.notifyObservers(this)},t.prototype.getClassName=function(){return"GradientBlock"},Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._writeColorConstant=function(e){var t=this.colorSteps[e];return"vec3(".concat(t.color.r,", ").concat(t.color.g,", ").concat(t.color.b,")")},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];if(this.colorSteps.length&&this.gradient.connectedPoint){var i=t._getFreeVariableName("gradientTempColor"),o=t._getFreeVariableName("gradientTempPosition");t.compilationString+="vec3 ".concat(i," = ").concat(this._writeColorConstant(0),";\r\n"),t.compilationString+="float ".concat(o,";\r\n");var a=this.gradient.associatedVariableName;this.gradient.connectedPoint.type!==r.E.Float&&(a+=".x");for(var c=1;c<this.colorSteps.length;c++){var s=this.colorSteps[c],u=this.colorSteps[c-1];t.compilationString+="".concat(o," = clamp((").concat(a," - ").concat(t._emitFloat(u.step),") / (").concat(t._emitFloat(s.step)," -  ").concat(t._emitFloat(u.step),"), 0.0, 1.0) * step(").concat(t._emitFloat(c),", ").concat(t._emitFloat(this.colorSteps.length-1),");\r\n"),t.compilationString+="".concat(i," = mix(").concat(i,", ").concat(this._writeColorConstant(c),", ").concat(o,");\r\n")}return t.compilationString+=this._declareOutput(n,t)+" = ".concat(i,";\r\n"),this}t.compilationString+=this._declareOutput(n,t)+" = vec3(0., 0., 0.);\r\n"},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);t.colorSteps=[];for(var n=0,i=this.colorSteps;n<i.length;n++){var r=i[n];t.colorSteps.push({step:r.step,color:{r:r.color.r,g:r.color.g,b:r.color.b}})}return t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),this.colorSteps=[];for(var r=0,o=t.colorSteps;r<o.length;r++){var a=o[r];this.colorSteps.push(new pe(a.step,new ue.Wo(a.color.r,a.color.g,a.color.b)))}},t.prototype._dumpPropertiesCode=function(){var t=e.prototype._dumpPropertiesCode.call(this);t+="".concat(this._codeVariableName,".colorSteps = [];\r\n");for(var n=0,i=this.colorSteps;n<i.length;n++){var r=i[n];t+="".concat(this._codeVariableName,".colorSteps.push(new BABYLON.GradientBlockColorStep(").concat(r.step,", new BABYLON.Color3(").concat(r.color.r,", ").concat(r.color.g,", ").concat(r.color.b,")));\r\n")}return t},t}(l.k);(0,g.H)("BABYLON.GradientBlock",de);var he=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("left",r.E.AutoDetect),n.registerInput("right",r.E.AutoDetect),n.registerInput("gradient",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n._linkConnectionTypes(1,2,!0),n._inputs[2].acceptedConnectionPointTypes.push(r.E.Float),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"NLerpBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gradient",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = normalize(mix(".concat(this.left.associatedVariableName," , ").concat(this.right.associatedVariableName,", ").concat(this.gradient.associatedVariableName,"));\r\n"),this},t}(l.k);(0,g.H)("BABYLON.NLerpBlock",he);var fe=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.manhattanDistance=!1,n.registerInput("seed",r.E.Vector3),n.registerInput("jitter",r.E.Float),n.registerOutput("output",r.E.Vector2),n.registerOutput("x",r.E.Float),n.registerOutput("y",r.E.Float),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"WorleyNoise3DBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"jitter",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),this.seed.isConnected&&(this.output.hasEndpoints||this.x.hasEndpoints||this.y.hasEndpoints)){"    return mod((34.0 * x + 1.0) * x, 289.0);\r\n","}\r\n\r\n","vec3 dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance){\r\n","    return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);\r\n","}\r\n\r\n","vec2 worley(vec3 P, float jitter, bool manhattanDistance){\r\n","    float K = 0.142857142857; // 1/7\r\n","    float Ko = 0.428571428571; // 1/2-K/2\r\n","    float  K2 = 0.020408163265306; // 1/(7*7)\r\n","    float Kz = 0.166666666667; // 1/6\r\n","    float Kzo = 0.416666666667; // 1/2-1/6*2\r\n","\r\n","    vec3 Pi = mod(floor(P), 289.0);\r\n","    vec3 Pf = fract(P) - 0.5;\r\n","\r\n","    vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\r\n","    vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\r\n","    vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\r\n","\r\n","    vec3 p = permute(Pi.x + vec3(-1.0, 0.0, 1.0));\r\n","    vec3 p1 = permute(p + Pi.y - 1.0);\r\n","    vec3 p2 = permute(p + Pi.y);\r\n","    vec3 p3 = permute(p + Pi.y + 1.0);\r\n","\r\n","    vec3 p11 = permute(p1 + Pi.z - 1.0);\r\n","    vec3 p12 = permute(p1 + Pi.z);\r\n","    vec3 p13 = permute(p1 + Pi.z + 1.0);\r\n","\r\n","    vec3 p21 = permute(p2 + Pi.z - 1.0);\r\n","    vec3 p22 = permute(p2 + Pi.z);\r\n","    vec3 p23 = permute(p2 + Pi.z + 1.0);\r\n","\r\n","    vec3 p31 = permute(p3 + Pi.z - 1.0);\r\n","    vec3 p32 = permute(p3 + Pi.z);\r\n","    vec3 p33 = permute(p3 + Pi.z + 1.0);\r\n","\r\n","    vec3 ox11 = fract(p11*K) - Ko;\r\n","    vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\r\n","    vec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed\r\n","\r\n","    vec3 ox12 = fract(p12*K) - Ko;\r\n","    vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\r\n","    vec3 oz12 = floor(p12*K2)*Kz - Kzo;\r\n","\r\n","    vec3 ox13 = fract(p13*K) - Ko;\r\n","    vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\r\n","    vec3 oz13 = floor(p13*K2)*Kz - Kzo;\r\n","\r\n","    vec3 ox21 = fract(p21*K) - Ko;\r\n","    vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\r\n","    vec3 oz21 = floor(p21*K2)*Kz - Kzo;\r\n","\r\n","    vec3 ox22 = fract(p22*K) - Ko;\r\n","    vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\r\n","    vec3 oz22 = floor(p22*K2)*Kz - Kzo;\r\n","\r\n","    vec3 ox23 = fract(p23*K) - Ko;\r\n","    vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\r\n","    vec3 oz23 = floor(p23*K2)*Kz - Kzo;\r\n","\r\n","    vec3 ox31 = fract(p31*K) - Ko;\r\n","    vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\r\n","    vec3 oz31 = floor(p31*K2)*Kz - Kzo;\r\n","\r\n","    vec3 ox32 = fract(p32*K) - Ko;\r\n","    vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\r\n","    vec3 oz32 = floor(p32*K2)*Kz - Kzo;\r\n","\r\n","    vec3 ox33 = fract(p33*K) - Ko;\r\n","    vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\r\n","    vec3 oz33 = floor(p33*K2)*Kz - Kzo;\r\n","\r\n","    vec3 dx11 = Pfx + jitter*ox11;\r\n","    vec3 dy11 = Pfy.x + jitter*oy11;\r\n","    vec3 dz11 = Pfz.x + jitter*oz11;\r\n","\r\n","    vec3 dx12 = Pfx + jitter*ox12;\r\n","    vec3 dy12 = Pfy.x + jitter*oy12;\r\n","    vec3 dz12 = Pfz.y + jitter*oz12;\r\n","\r\n","    vec3 dx13 = Pfx + jitter*ox13;\r\n","    vec3 dy13 = Pfy.x + jitter*oy13;\r\n","    vec3 dz13 = Pfz.z + jitter*oz13;\r\n","\r\n","    vec3 dx21 = Pfx + jitter*ox21;\r\n","    vec3 dy21 = Pfy.y + jitter*oy21;\r\n","    vec3 dz21 = Pfz.x + jitter*oz21;\r\n","\r\n","    vec3 dx22 = Pfx + jitter*ox22;\r\n","    vec3 dy22 = Pfy.y + jitter*oy22;\r\n","    vec3 dz22 = Pfz.y + jitter*oz22;\r\n","\r\n","    vec3 dx23 = Pfx + jitter*ox23;\r\n","    vec3 dy23 = Pfy.y + jitter*oy23;\r\n","    vec3 dz23 = Pfz.z + jitter*oz23;\r\n","\r\n","    vec3 dx31 = Pfx + jitter*ox31;\r\n","    vec3 dy31 = Pfy.z + jitter*oy31;\r\n","    vec3 dz31 = Pfz.x + jitter*oz31;\r\n","\r\n","    vec3 dx32 = Pfx + jitter*ox32;\r\n","    vec3 dy32 = Pfy.z + jitter*oy32;\r\n","    vec3 dz32 = Pfz.y + jitter*oz32;\r\n","\r\n","    vec3 dx33 = Pfx + jitter*ox33;\r\n","    vec3 dy33 = Pfy.z + jitter*oy33;\r\n","    vec3 dz33 = Pfz.z + jitter*oz33;\r\n","\r\n","    vec3 d11 = dist(dx11, dy11, dz11, manhattanDistance);\r\n","    vec3 d12 =dist(dx12, dy12, dz12, manhattanDistance);\r\n","    vec3 d13 = dist(dx13, dy13, dz13, manhattanDistance);\r\n","    vec3 d21 = dist(dx21, dy21, dz21, manhattanDistance);\r\n","    vec3 d22 = dist(dx22, dy22, dz22, manhattanDistance);\r\n","    vec3 d23 = dist(dx23, dy23, dz23, manhattanDistance);\r\n","    vec3 d31 = dist(dx31, dy31, dz31, manhattanDistance);\r\n","    vec3 d32 = dist(dx32, dy32, dz32, manhattanDistance);\r\n","    vec3 d33 = dist(dx33, dy33, dz33, manhattanDistance);\r\n","\r\n","    vec3 d1a = min(d11, d12);\r\n","    d12 = max(d11, d12);\r\n","    d11 = min(d1a, d13); // Smallest now not in d12 or d13\r\n","    d13 = max(d1a, d13);\r\n","    d12 = min(d12, d13); // 2nd smallest now not in d13\r\n","    vec3 d2a = min(d21, d22);\r\n","    d22 = max(d21, d22);\r\n","    d21 = min(d2a, d23); // Smallest now not in d22 or d23\r\n","    d23 = max(d2a, d23);\r\n","    d22 = min(d22, d23); // 2nd smallest now not in d23\r\n","    vec3 d3a = min(d31, d32);\r\n","    d32 = max(d31, d32);\r\n","    d31 = min(d3a, d33); // Smallest now not in d32 or d33\r\n","    d33 = max(d3a, d33);\r\n","    d32 = min(d32, d33); // 2nd smallest now not in d33\r\n","    vec3 da = min(d11, d21);\r\n","    d21 = max(d11, d21);\r\n","    d11 = min(da, d31); // Smallest now in d11\r\n","    d31 = max(da, d31); // 2nd smallest now not in d31\r\n","    d11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;\r\n","    d11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest\r\n","    d12 = min(d12, d21); // 2nd smallest now not in d21\r\n","    d12 = min(d12, d22); // nor in d22\r\n","    d12 = min(d12, d31); // nor in d31\r\n","    d12 = min(d12, d32); // nor in d32\r\n","    d11.yz = min(d11.yz,d12.xy); // nor in d12.yz\r\n","    d11.y = min(d11.y,d12.z); // Only two more to go\r\n","    d11.y = min(d11.y,d11.z); // Done! (Phew!)\r\n","    return sqrt(d11.xy); // F1, F2\r\n","}\r\n\r\n",t._emitFunction("worley3D","vec3 permute(vec3 x){\r\n    return mod((34.0 * x + 1.0) * x, 289.0);\r\n}\r\n\r\nvec3 dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance){\r\n    return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);\r\n}\r\n\r\nvec2 worley(vec3 P, float jitter, bool manhattanDistance){\r\n    float K = 0.142857142857; // 1/7\r\n    float Ko = 0.428571428571; // 1/2-K/2\r\n    float  K2 = 0.020408163265306; // 1/(7*7)\r\n    float Kz = 0.166666666667; // 1/6\r\n    float Kzo = 0.416666666667; // 1/2-1/6*2\r\n\r\n    vec3 Pi = mod(floor(P), 289.0);\r\n    vec3 Pf = fract(P) - 0.5;\r\n\r\n    vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\r\n    vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\r\n    vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\r\n\r\n    vec3 p = permute(Pi.x + vec3(-1.0, 0.0, 1.0));\r\n    vec3 p1 = permute(p + Pi.y - 1.0);\r\n    vec3 p2 = permute(p + Pi.y);\r\n    vec3 p3 = permute(p + Pi.y + 1.0);\r\n\r\n    vec3 p11 = permute(p1 + Pi.z - 1.0);\r\n    vec3 p12 = permute(p1 + Pi.z);\r\n    vec3 p13 = permute(p1 + Pi.z + 1.0);\r\n\r\n    vec3 p21 = permute(p2 + Pi.z - 1.0);\r\n    vec3 p22 = permute(p2 + Pi.z);\r\n    vec3 p23 = permute(p2 + Pi.z + 1.0);\r\n\r\n    vec3 p31 = permute(p3 + Pi.z - 1.0);\r\n    vec3 p32 = permute(p3 + Pi.z);\r\n    vec3 p33 = permute(p3 + Pi.z + 1.0);\r\n\r\n    vec3 ox11 = fract(p11*K) - Ko;\r\n    vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\r\n    vec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed\r\n\r\n    vec3 ox12 = fract(p12*K) - Ko;\r\n    vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\r\n    vec3 oz12 = floor(p12*K2)*Kz - Kzo;\r\n\r\n    vec3 ox13 = fract(p13*K) - Ko;\r\n    vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\r\n    vec3 oz13 = floor(p13*K2)*Kz - Kzo;\r\n\r\n    vec3 ox21 = fract(p21*K) - Ko;\r\n    vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\r\n    vec3 oz21 = floor(p21*K2)*Kz - Kzo;\r\n\r\n    vec3 ox22 = fract(p22*K) - Ko;\r\n    vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\r\n    vec3 oz22 = floor(p22*K2)*Kz - Kzo;\r\n\r\n    vec3 ox23 = fract(p23*K) - Ko;\r\n    vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\r\n    vec3 oz23 = floor(p23*K2)*Kz - Kzo;\r\n\r\n    vec3 ox31 = fract(p31*K) - Ko;\r\n    vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\r\n    vec3 oz31 = floor(p31*K2)*Kz - Kzo;\r\n\r\n    vec3 ox32 = fract(p32*K) - Ko;\r\n    vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\r\n    vec3 oz32 = floor(p32*K2)*Kz - Kzo;\r\n\r\n    vec3 ox33 = fract(p33*K) - Ko;\r\n    vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\r\n    vec3 oz33 = floor(p33*K2)*Kz - Kzo;\r\n\r\n    vec3 dx11 = Pfx + jitter*ox11;\r\n    vec3 dy11 = Pfy.x + jitter*oy11;\r\n    vec3 dz11 = Pfz.x + jitter*oz11;\r\n\r\n    vec3 dx12 = Pfx + jitter*ox12;\r\n    vec3 dy12 = Pfy.x + jitter*oy12;\r\n    vec3 dz12 = Pfz.y + jitter*oz12;\r\n\r\n    vec3 dx13 = Pfx + jitter*ox13;\r\n    vec3 dy13 = Pfy.x + jitter*oy13;\r\n    vec3 dz13 = Pfz.z + jitter*oz13;\r\n\r\n    vec3 dx21 = Pfx + jitter*ox21;\r\n    vec3 dy21 = Pfy.y + jitter*oy21;\r\n    vec3 dz21 = Pfz.x + jitter*oz21;\r\n\r\n    vec3 dx22 = Pfx + jitter*ox22;\r\n    vec3 dy22 = Pfy.y + jitter*oy22;\r\n    vec3 dz22 = Pfz.y + jitter*oz22;\r\n\r\n    vec3 dx23 = Pfx + jitter*ox23;\r\n    vec3 dy23 = Pfy.y + jitter*oy23;\r\n    vec3 dz23 = Pfz.z + jitter*oz23;\r\n\r\n    vec3 dx31 = Pfx + jitter*ox31;\r\n    vec3 dy31 = Pfy.z + jitter*oy31;\r\n    vec3 dz31 = Pfz.x + jitter*oz31;\r\n\r\n    vec3 dx32 = Pfx + jitter*ox32;\r\n    vec3 dy32 = Pfy.z + jitter*oy32;\r\n    vec3 dz32 = Pfz.y + jitter*oz32;\r\n\r\n    vec3 dx33 = Pfx + jitter*ox33;\r\n    vec3 dy33 = Pfy.z + jitter*oy33;\r\n    vec3 dz33 = Pfz.z + jitter*oz33;\r\n\r\n    vec3 d11 = dist(dx11, dy11, dz11, manhattanDistance);\r\n    vec3 d12 =dist(dx12, dy12, dz12, manhattanDistance);\r\n    vec3 d13 = dist(dx13, dy13, dz13, manhattanDistance);\r\n    vec3 d21 = dist(dx21, dy21, dz21, manhattanDistance);\r\n    vec3 d22 = dist(dx22, dy22, dz22, manhattanDistance);\r\n    vec3 d23 = dist(dx23, dy23, dz23, manhattanDistance);\r\n    vec3 d31 = dist(dx31, dy31, dz31, manhattanDistance);\r\n    vec3 d32 = dist(dx32, dy32, dz32, manhattanDistance);\r\n    vec3 d33 = dist(dx33, dy33, dz33, manhattanDistance);\r\n\r\n    vec3 d1a = min(d11, d12);\r\n    d12 = max(d11, d12);\r\n    d11 = min(d1a, d13); // Smallest now not in d12 or d13\r\n    d13 = max(d1a, d13);\r\n    d12 = min(d12, d13); // 2nd smallest now not in d13\r\n    vec3 d2a = min(d21, d22);\r\n    d22 = max(d21, d22);\r\n    d21 = min(d2a, d23); // Smallest now not in d22 or d23\r\n    d23 = max(d2a, d23);\r\n    d22 = min(d22, d23); // 2nd smallest now not in d23\r\n    vec3 d3a = min(d31, d32);\r\n    d32 = max(d31, d32);\r\n    d31 = min(d3a, d33); // Smallest now not in d32 or d33\r\n    d33 = max(d3a, d33);\r\n    d32 = min(d32, d33); // 2nd smallest now not in d33\r\n    vec3 da = min(d11, d21);\r\n    d21 = max(d11, d21);\r\n    d11 = min(da, d31); // Smallest now in d11\r\n    d31 = max(da, d31); // 2nd smallest now not in d31\r\n    d11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;\r\n    d11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest\r\n    d12 = min(d12, d21); // 2nd smallest now not in d21\r\n    d12 = min(d12, d22); // nor in d22\r\n    d12 = min(d12, d31); // nor in d31\r\n    d12 = min(d12, d32); // nor in d32\r\n    d11.yz = min(d11.yz,d12.xy); // nor in d12.yz\r\n    d11.y = min(d11.y,d12.z); // Only two more to go\r\n    d11.y = min(d11.y,d11.z); // Done! (Phew!)\r\n    return sqrt(d11.xy); // F1, F2\r\n}\r\n\r\n","// Worley3D");var n=t._getFreeVariableName("worleyTemp");return t.compilationString+="vec2 ".concat(n," = worley(").concat(this.seed.associatedVariableName,", ").concat(this.jitter.associatedVariableName,", ").concat(this.manhattanDistance,");\r\n"),this.output.hasEndpoints&&(t.compilationString+=this._declareOutput(this.output,t)+" = ".concat(n,";\r\n")),this.x.hasEndpoints&&(t.compilationString+=this._declareOutput(this.x,t)+" = ".concat(n,".x;\r\n")),this.y.hasEndpoints&&(t.compilationString+=this._declareOutput(this.y,t)+" = ".concat(n,".y;\r\n")),this}},t.prototype._dumpPropertiesCode=function(){return e.prototype._dumpPropertiesCode.call(this)+"".concat(this._codeVariableName,".manhattanDistance = ").concat(this.manhattanDistance,";\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.manhattanDistance=this.manhattanDistance,t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),this.manhattanDistance=t.manhattanDistance},(0,h.gn)([(0,A.p)("Use Manhattan Distance",A.U.Boolean,"PROPERTIES",{notifiers:{update:!1}})],t.prototype,"manhattanDistance",void 0),t}(l.k);(0,g.H)("BABYLON.WorleyNoise3DBlock",fe);var me=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("seed",r.E.Vector3),n.registerOutput("output",r.E.Float),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"SimplexPerlin3DBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),this.seed.isConnected&&this._outputs[0].hasEndpoints){return"const float UNSKEWFACTOR = 1.0/6.0;\r\n","const float SIMPLEX_CORNER_POS = 0.5;\r\n","const float SIMPLEX_TETRAHADRON_HEIGHT = 0.70710678118654752440084436210485;\r\n","float SimplexPerlin3D( vec3 P ){\r\n","    P.x = P == vec3(0., 0., 0.) ? 0.00001 : P.x;\r\n","    P *= SIMPLEX_TETRAHADRON_HEIGHT;\r\n","    vec3 Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );","    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\r\n","    vec3 g = step(x0.yzx, x0.xyz);\r\n","    vec3 l = 1.0 - g;\r\n","    vec3 Pi_1 = min( g.xyz, l.zxy );\r\n","    vec3 Pi_2 = max( g.xyz, l.zxy );\r\n","    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\r\n","    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\r\n","    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\r\n","    vec4 v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\r\n","    vec4 v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\r\n","    vec4 v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\r\n","    Pi.xyz = Pi.xyz - floor(Pi.xyz * ( 1.0 / 69.0 )) * 69.0;\r\n","    vec3 Pi_inc1 = step( Pi, vec3( 69.0 - 1.5 ) ) * ( Pi + 1.0 );\r\n","    vec4 Pt = vec4( Pi.xy, Pi_inc1.xy ) + vec2( 50.0, 161.0 ).xyxy;\r\n","    Pt *= Pt;\r\n","    vec4 V1xy_V2xy = mix( Pt.xyxy, Pt.zwzw, vec4( Pi_1.xy, Pi_2.xy ) );\r\n","    Pt = vec4( Pt.x, V1xy_V2xy.xz, Pt.z ) * vec4( Pt.y, V1xy_V2xy.yw, Pt.w );\r\n","    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\r\n","    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\r\n","    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi.zzz * ZINC.xyz ) );\r\n","    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi_inc1.zzz * ZINC.xyz ) );\r\n","    Pi_1 = ( Pi_1.z < 0.5 ) ? lowz_mods : highz_mods;\r\n","    Pi_2 = ( Pi_2.z < 0.5 ) ? lowz_mods : highz_mods;\r\n","    vec4 hash_0 = fract( Pt * vec4( lowz_mods.x, Pi_1.x, Pi_2.x, highz_mods.x ) ) - 0.49999;\r\n","    vec4 hash_1 = fract( Pt * vec4( lowz_mods.y, Pi_1.y, Pi_2.y, highz_mods.y ) ) - 0.49999;\r\n","    vec4 hash_2 = fract( Pt * vec4( lowz_mods.z, Pi_1.z, Pi_2.z, highz_mods.z ) ) - 0.49999;\r\n","    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\r\n","    const float FINAL_NORMALIZATION = 37.837227241611314102871574478976;\r\n","    vec4 kernel_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\r\n","    kernel_weights = max(0.5 - kernel_weights, 0.0);\r\n","    kernel_weights = kernel_weights*kernel_weights*kernel_weights;\r\n","    return dot( kernel_weights, grad_results ) * FINAL_NORMALIZATION;\r\n","}\r\n",t._emitFunction("SimplexPerlin3D","const float SKEWFACTOR = 1.0/3.0;\r\nconst float UNSKEWFACTOR = 1.0/6.0;\r\nconst float SIMPLEX_CORNER_POS = 0.5;\r\nconst float SIMPLEX_TETRAHADRON_HEIGHT = 0.70710678118654752440084436210485;\r\nfloat SimplexPerlin3D( vec3 P ){\r\n    P.x = P == vec3(0., 0., 0.) ? 0.00001 : P.x;\r\n    P *= SIMPLEX_TETRAHADRON_HEIGHT;\r\n    vec3 Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\r\n    vec3 g = step(x0.yzx, x0.xyz);\r\n    vec3 l = 1.0 - g;\r\n    vec3 Pi_1 = min( g.xyz, l.zxy );\r\n    vec3 Pi_2 = max( g.xyz, l.zxy );\r\n    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\r\n    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\r\n    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\r\n    vec4 v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\r\n    vec4 v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\r\n    vec4 v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\r\n    Pi.xyz = Pi.xyz - floor(Pi.xyz * ( 1.0 / 69.0 )) * 69.0;\r\n    vec3 Pi_inc1 = step( Pi, vec3( 69.0 - 1.5 ) ) * ( Pi + 1.0 );\r\n    vec4 Pt = vec4( Pi.xy, Pi_inc1.xy ) + vec2( 50.0, 161.0 ).xyxy;\r\n    Pt *= Pt;\r\n    vec4 V1xy_V2xy = mix( Pt.xyxy, Pt.zwzw, vec4( Pi_1.xy, Pi_2.xy ) );\r\n    Pt = vec4( Pt.x, V1xy_V2xy.xz, Pt.z ) * vec4( Pt.y, V1xy_V2xy.yw, Pt.w );\r\n    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\r\n    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\r\n    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi.zzz * ZINC.xyz ) );\r\n    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi_inc1.zzz * ZINC.xyz ) );\r\n    Pi_1 = ( Pi_1.z < 0.5 ) ? lowz_mods : highz_mods;\r\n    Pi_2 = ( Pi_2.z < 0.5 ) ? lowz_mods : highz_mods;\r\n    vec4 hash_0 = fract( Pt * vec4( lowz_mods.x, Pi_1.x, Pi_2.x, highz_mods.x ) ) - 0.49999;\r\n    vec4 hash_1 = fract( Pt * vec4( lowz_mods.y, Pi_1.y, Pi_2.y, highz_mods.y ) ) - 0.49999;\r\n    vec4 hash_2 = fract( Pt * vec4( lowz_mods.z, Pi_1.z, Pi_2.z, highz_mods.z ) ) - 0.49999;\r\n    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\r\n    const float FINAL_NORMALIZATION = 37.837227241611314102871574478976;\r\n    vec4 kernel_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\r\n    kernel_weights = max(0.5 - kernel_weights, 0.0);\r\n    kernel_weights = kernel_weights*kernel_weights*kernel_weights;\r\n    return dot( kernel_weights, grad_results ) * FINAL_NORMALIZATION;\r\n}\r\n","// SimplexPerlin3D"),t.compilationString+=this._declareOutput(this._outputs[0],t)+" = SimplexPerlin3D(".concat(this.seed.associatedVariableName,");\r\n"),this}},t}(l.k);(0,g.H)("BABYLON.SimplexPerlin3DBlock",me);var ge=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("normalMap0",r.E.Vector3),n.registerInput("normalMap1",r.E.Vector3),n.registerOutput("output",r.E.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Color3),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Color4),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Vector4),n._inputs[1].acceptedConnectionPointTypes.push(r.E.Color3),n._inputs[1].acceptedConnectionPointTypes.push(r.E.Color4),n._inputs[1].acceptedConnectionPointTypes.push(r.E.Vector4),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"NormalBlendBlock"},Object.defineProperty(t.prototype,"normalMap0",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normalMap1",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0],i=this._inputs[0],r=this._inputs[1],o=t._getFreeVariableName("stepR"),a=t._getFreeVariableName("stepG");return t.compilationString+="float ".concat(o," = step(0.5, ").concat(i.associatedVariableName,".r);\r\n"),t.compilationString+="float ".concat(a," = step(0.5, ").concat(i.associatedVariableName,".g);\r\n"),t.compilationString+=this._declareOutput(n,t)+";\r\n",t.compilationString+="".concat(n.associatedVariableName,".r = (1.0 - ").concat(o,") * ").concat(i.associatedVariableName,".r * ").concat(r.associatedVariableName,".r * 2.0 + ").concat(o," * (1.0 - (1.0 - ").concat(i.associatedVariableName,".r) * (1.0 - ").concat(r.associatedVariableName,".r) * 2.0);\r\n"),t.compilationString+="".concat(n.associatedVariableName,".g = (1.0 - ").concat(a,") * ").concat(i.associatedVariableName,".g * ").concat(r.associatedVariableName,".g * 2.0 + ").concat(a," * (1.0 - (1.0 - ").concat(i.associatedVariableName,".g) * (1.0 - ").concat(r.associatedVariableName,".g) * 2.0);\r\n"),t.compilationString+="".concat(n.associatedVariableName,".b = ").concat(i.associatedVariableName,".b * ").concat(r.associatedVariableName,".b;\r\n"),this},t}(l.k);(0,g.H)("BABYLON.NormalBlendBlock",ge);var be=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("input",r.E.Vector2),n.registerInput("angle",r.E.Float),n.registerOutput("output",r.E.Vector2),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"Rotate2dBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(){if(!this.angle.isConnected){var e=new m.S("angle");e.value=0,e.output.connectTo(this.angle)}},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0],i=this.angle,r=this.input;return t.compilationString+=this._declareOutput(n,t)+" = vec2(cos(".concat(i.associatedVariableName,") * ").concat(r.associatedVariableName,".x - sin(").concat(i.associatedVariableName,") * ").concat(r.associatedVariableName,".y, sin(").concat(i.associatedVariableName,") * ").concat(r.associatedVariableName,".x + cos(").concat(i.associatedVariableName,") * ").concat(r.associatedVariableName,".y);\r\n"),this},t}(l.k);(0,g.H)("BABYLON.Rotate2dBlock",be);var _e=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("incident",r.E.Vector3),n.registerInput("normal",r.E.Vector3),n.registerOutput("output",r.E.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Color3),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Color4),n._inputs[1].acceptedConnectionPointTypes.push(r.E.Vector4),n._inputs[1].acceptedConnectionPointTypes.push(r.E.Color3),n._inputs[1].acceptedConnectionPointTypes.push(r.E.Color4),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"ReflectBlock"},Object.defineProperty(t.prototype,"incident",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = reflect(".concat(this.incident.associatedVariableName,".xyz, ").concat(this.normal.associatedVariableName,".xyz);\r\n"),this},t}(l.k);(0,g.H)("BABYLON.ReflectBlock",_e);var ye=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("incident",r.E.Vector3),n.registerInput("normal",r.E.Vector3),n.registerInput("ior",r.E.Float),n.registerOutput("output",r.E.Vector3),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Vector4),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Color3),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Color4),n._inputs[1].acceptedConnectionPointTypes.push(r.E.Vector4),n._inputs[1].acceptedConnectionPointTypes.push(r.E.Color3),n._inputs[1].acceptedConnectionPointTypes.push(r.E.Color4),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"RefractBlock"},Object.defineProperty(t.prototype,"incident",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ior",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = refract(".concat(this.incident.associatedVariableName,".xyz, ").concat(this.normal.associatedVariableName,".xyz, ").concat(this.ior.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.RefractBlock",ye);var ve=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("color",r.E.Color3),n.registerInput("level",r.E.Float),n.registerOutput("output",r.E.Color3),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"DesaturateBlock"},Object.defineProperty(t.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0],i=this.color.associatedVariableName,r=t._getFreeVariableName("colorMin"),o=t._getFreeVariableName("colorMax"),a=t._getFreeVariableName("colorMerge");return t.compilationString+="float ".concat(r," = min(min(").concat(i,".x, ").concat(i,".y), ").concat(i,".z);\r\n"),t.compilationString+="float ".concat(o," = max(max(").concat(i,".x, ").concat(i,".y), ").concat(i,".z);\r\n"),t.compilationString+="float ".concat(a," = 0.5 * (").concat(r," + ").concat(o,");\r\n"),t.compilationString+=this._declareOutput(n,t)+" = mix(".concat(i,", vec3(").concat(a,", ").concat(a,", ").concat(a,"), ").concat(this.level.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.DesaturateBlock",ve);var Ne=n(63881),Se=n(28361),Oe=n(17962),Ce=n(71477),Ee=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("left",r.E.AutoDetect),n.registerInput("right",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n._linkConnectionTypes(0,1),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"ModBlock"},Object.defineProperty(t.prototype,"left",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0];return t.compilationString+=this._declareOutput(n,t)+" = mod(".concat(this.left.associatedVariableName,", ").concat(this.right.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.ModBlock",Ee);var Pe,Ie=n(58095),xe=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("row0",r.E.Vector4),n.registerInput("row1",r.E.Vector4),n.registerInput("row2",r.E.Vector4),n.registerInput("row3",r.E.Vector4),n.registerOutput("output",r.E.Matrix),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"MatrixBuilder"},Object.defineProperty(t.prototype,"row0",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"row1",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"row2",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"row3",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype.autoConfigure=function(){if(!this.row0.isConnected){var e=new m.S("row0");e.value=new Ie.Lt(1,0,0,0),e.output.connectTo(this.row0)}if(!this.row1.isConnected){var t=new m.S("row1");t.value=new Ie.Lt(0,1,0,0),t.output.connectTo(this.row1)}if(!this.row2.isConnected){var n=new m.S("row2");n.value=new Ie.Lt(0,0,1,0),n.output.connectTo(this.row2)}if(!this.row3.isConnected){var i=new m.S("row3");i.value=new Ie.Lt(0,0,0,1),i.output.connectTo(this.row3)}},t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0],i=this.row0,r=this.row1,o=this.row2,a=this.row3;return t.compilationString+=this._declareOutput(n,t)+" = mat4(".concat(i.associatedVariableName,", ").concat(r.associatedVariableName,", ").concat(o.associatedVariableName,", ").concat(a.associatedVariableName,");\r\n"),this},t}(l.k);(0,g.H)("BABYLON.MatrixBuilder",xe),function(e){e[e.Equal=0]="Equal",e[e.NotEqual=1]="NotEqual",e[e.LessThan=2]="LessThan",e[e.GreaterThan=3]="GreaterThan",e[e.LessOrEqual=4]="LessOrEqual",e[e.GreaterOrEqual=5]="GreaterOrEqual",e[e.Xor=6]="Xor",e[e.Or=7]="Or",e[e.And=8]="And"}(Pe||(Pe={}));var Ae=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.condition=Pe.LessThan,n.registerInput("a",r.E.Float),n.registerInput("b",r.E.Float),n.registerInput("true",r.E.AutoDetect,!0),n.registerInput("false",r.E.AutoDetect,!0),n.registerOutput("output",r.E.BasedOnInput),n._linkConnectionTypes(2,3),n._outputs[0]._typeConnectionSource=n._inputs[2],n._outputs[0]._defaultConnectionPointType=r.E.Float,n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"ConditionalBlock"},Object.defineProperty(t.prototype,"a",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"true",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"false",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0],i=this.true.isConnected?this.true.associatedVariableName:"1.0",r=this.false.isConnected?this.false.associatedVariableName:"0.0";switch(this.condition){case Pe.Equal:t.compilationString+=this._declareOutput(n,t)+" = ".concat(this.a.associatedVariableName," == ").concat(this.b.associatedVariableName," ? ").concat(i," : ").concat(r,";\r\n");break;case Pe.NotEqual:t.compilationString+=this._declareOutput(n,t)+" = ".concat(this.a.associatedVariableName," != ").concat(this.b.associatedVariableName," ? ").concat(i," : ").concat(r,";\r\n");break;case Pe.LessThan:t.compilationString+=this._declareOutput(n,t)+" = ".concat(this.a.associatedVariableName," < ").concat(this.b.associatedVariableName," ? ").concat(i," : ").concat(r,";\r\n");break;case Pe.LessOrEqual:t.compilationString+=this._declareOutput(n,t)+" = ".concat(this.a.associatedVariableName," <= ").concat(this.b.associatedVariableName," ? ").concat(i," : ").concat(r,";\r\n");break;case Pe.GreaterThan:t.compilationString+=this._declareOutput(n,t)+" = ".concat(this.a.associatedVariableName," > ").concat(this.b.associatedVariableName," ? ").concat(i," : ").concat(r,";\r\n");break;case Pe.GreaterOrEqual:t.compilationString+=this._declareOutput(n,t)+" = ".concat(this.a.associatedVariableName," >= ").concat(this.b.associatedVariableName," ? ").concat(i," : ").concat(r,";\r\n");break;case Pe.Xor:t.compilationString+=this._declareOutput(n,t)+" = (mod(".concat(this.a.associatedVariableName," + ").concat(this.b.associatedVariableName,", 2.0) > 0.0) ? ").concat(i," : ").concat(r,";\r\n");break;case Pe.Or:t.compilationString+=this._declareOutput(n,t)+" = (min(".concat(this.a.associatedVariableName," + ").concat(this.b.associatedVariableName,", 1.0) > 0.0) ? ").concat(i," : ").concat(r,";\r\n");break;case Pe.And:t.compilationString+=this._declareOutput(n,t)+" = (".concat(this.a.associatedVariableName," * ").concat(this.b.associatedVariableName," > 0.0)  ? ").concat(i," : ").concat(r,";\r\n")}return this},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.condition=this.condition,t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),this.condition=t.condition},t.prototype._dumpPropertiesCode=function(){return e.prototype._dumpPropertiesCode.call(this)+"".concat(this._codeVariableName,".condition = BABYLON.ConditionalBlockConditions.").concat(Pe[this.condition],";\r\n")},t}(l.k);(0,g.H)("BABYLON.ConditionalBlock",Ae);var Te=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.octaves=6,n.registerInput("seed",r.E.AutoDetect),n.registerInput("chaos",r.E.AutoDetect,!0),n.registerInput("offsetX",r.E.Float,!0),n.registerInput("offsetY",r.E.Float,!0),n.registerInput("offsetZ",r.E.Float,!0),n.registerOutput("output",r.E.Float),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Vector2),n._inputs[0].acceptedConnectionPointTypes.push(r.E.Vector3),n._linkConnectionTypes(0,1),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"CloudBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chaos",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetX",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetZ",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){var n,i;if(e.prototype._buildBlock.call(this,t),this.seed.isConnected&&this._outputs[0].hasEndpoints){var o="fbm".concat(this.octaves);t._emitFunction("CloudBlockCode","\n\n        float cloudRandom(in float p) { p = fract(p * 0.011); p *= p + 7.5; p *= p + p; return fract(p); }\n\n        // Based on Morgan McGuire @morgan3d\n        // https://www.shadertoy.com/view/4dS3Wd\n        float cloudNoise(in vec2 x, in vec2 chaos) {\n            vec2 step = chaos * vec2(75., 120.) + vec2(75., 120.);\n\n            vec2 i = floor(x);\n            vec2 f = fract(x);\n\n            float n = dot(i, step);\n\n            vec2 u = f * f * (3.0 - 2.0 * f);\n            return mix(\n                    mix(cloudRandom(n + dot(step, vec2(0, 0))), cloudRandom(n + dot(step, vec2(1, 0))), u.x),\n                    mix(cloudRandom(n + dot(step, vec2(0, 1))), cloudRandom(n + dot(step, vec2(1, 1))), u.x),\n                    u.y\n                );\n        }\n\n        float cloudNoise(in vec3 x, in vec3 chaos) {\n            vec3 step = chaos * vec3(60., 120., 75.) + vec3(60., 120., 75.);\n\n            vec3 i = floor(x);\n            vec3 f = fract(x);\n\n            float n = dot(i, step);\n\n            vec3 u = f * f * (3.0 - 2.0 * f);\n            return mix(mix(mix( cloudRandom(n + dot(step, vec3(0, 0, 0))), cloudRandom(n + dot(step, vec3(1, 0, 0))), u.x),\n                           mix( cloudRandom(n + dot(step, vec3(0, 1, 0))), cloudRandom(n + dot(step, vec3(1, 1, 0))), u.x), u.y),\n                       mix(mix( cloudRandom(n + dot(step, vec3(0, 0, 1))), cloudRandom(n + dot(step, vec3(1, 0, 1))), u.x),\n                           mix( cloudRandom(n + dot(step, vec3(0, 1, 1))), cloudRandom(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);\n        }","// CloudBlockCode"),t._emitFunction("CloudBlockCodeFBM"+this.octaves,"\n        float fbm(in vec2 st, in vec2 chaos) {\n            // Initial values\n            float value = 0.0;\n            float amplitude = .5;\n            float frequency = 0.;\n\n            // Loop of octaves\n            for (int i = 0; i < OCTAVES; i++) {\n                value += amplitude * cloudNoise(st, chaos);\n                st *= 2.0;\n                amplitude *= 0.5;\n            }\n            return value;\n        }\n\n        float fbm(in vec3 x, in vec3 chaos) {\n            // Initial values\n            float value = 0.0;\n            float amplitude = 0.5;\n            for (int i = 0; i < OCTAVES; ++i) {\n                value += amplitude * cloudNoise(x, chaos);\n                x = x * 2.0;\n                amplitude *= 0.5;\n            }\n            return value;\n        }".replace(/fbm/gi,o).replace(/OCTAVES/gi,(0|this.octaves).toString()),"// CloudBlockCode FBM");var a=t._getFreeVariableName("st"),c=(null===(n=this.seed.connectedPoint)||void 0===n?void 0:n.type)===r.E.Vector2?"vec2":"vec3";t.compilationString+="".concat(c," ").concat(a," = ").concat(this.seed.associatedVariableName,";\r\n"),this.offsetX.isConnected&&(t.compilationString+="".concat(a,".x += 0.1 * ").concat(this.offsetX.associatedVariableName,";\r\n")),this.offsetY.isConnected&&(t.compilationString+="".concat(a,".y += 0.1 * ").concat(this.offsetY.associatedVariableName,";\r\n")),this.offsetZ.isConnected&&"vec3"===c&&(t.compilationString+="".concat(a,".z += 0.1 * ").concat(this.offsetZ.associatedVariableName,";\r\n"));var s="";return s=this.chaos.isConnected?this.chaos.associatedVariableName:(null===(i=this.seed.connectedPoint)||void 0===i?void 0:i.type)===r.E.Vector2?"vec2(0., 0.)":"vec3(0., 0., 0.)",t.compilationString+=this._declareOutput(this._outputs[0],t)+" = ".concat(o,"(").concat(a,", ").concat(s,");\r\n"),this}},t.prototype._dumpPropertiesCode=function(){return e.prototype._dumpPropertiesCode.call(this)+"".concat(this._codeVariableName,".octaves = ").concat(this.octaves,";\r\n")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.octaves=this.octaves,t},t.prototype._deserialize=function(t,n,i){e.prototype._deserialize.call(this,t,n,i),this.octaves=t.octaves},(0,h.gn)([(0,A.p)("Octaves",A.U.Int)],t.prototype,"octaves",void 0),t}(l.k);(0,g.H)("BABYLON.CloudBlock",Te);var Ve=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("seed",r.E.Vector2),n.registerInput("offset",r.E.Float),n.registerInput("density",r.E.Float),n.registerOutput("output",r.E.Float),n.registerOutput("cells",r.E.Float),n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"VoronoiNoiseBlock"},Object.defineProperty(t.prototype,"seed",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offset",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"density",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cells",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){if(e.prototype._buildBlock.call(this,t),this.seed.isConnected){var n="vec2 voronoiRandom(vec2 seed, float offset){\n            mat2 m = mat2(15.27, 47.63, 99.41, 89.98);\n            vec2 uv = fract(sin(m * seed) * 46839.32);\n            return vec2(sin(uv.y * offset) * 0.5 + 0.5, cos(uv.x * offset) * 0.5 + 0.5);\n        }\n        ";t._emitFunction("voronoiRandom",n,"// Voronoi random generator"),n="void voronoi(vec2 seed, float offset, float density, out float outValue, out float cells){\n            vec2 g = floor(seed * density);\n            vec2 f = fract(seed * density);\n            float t = 8.0;\n            vec3 res = vec3(8.0, 0.0, 0.0);\n\n            for(int y=-1; y<=1; y++)\n            {\n                for(int x=-1; x<=1; x++)\n                {\n                    vec2 lattice = vec2(x,y);\n                    vec2 randomOffset = voronoiRandom(lattice + g, offset);\n                    float d = distance(lattice + randomOffset, f);\n                    if(d < res.x)\n                    {\n                        res = vec3(d, randomOffset.x, randomOffset.y);\n                        outValue = res.x;\n                        cells = res.y;\n                    }\n                }\n            }\n        }\n        ",t._emitFunction("voronoi",n,"// Voronoi");var i=t._getFreeVariableName("tempOutput"),r=t._getFreeVariableName("tempCells");return t.compilationString+="float ".concat(i," = 0.0;\r\n"),t.compilationString+="float ".concat(r," = 0.0;\r\n"),t.compilationString+="voronoi(".concat(this.seed.associatedVariableName,", ").concat(this.offset.associatedVariableName,", ").concat(this.density.associatedVariableName,", ").concat(i,", ").concat(r,");\r\n"),this.output.hasEndpoints&&(t.compilationString+=this._declareOutput(this.output,t)+" = ".concat(i,";\r\n")),this.cells.hasEndpoints&&(t.compilationString+=this._declareOutput(this.cells,t)+" = ".concat(r,";\r\n")),this}},t}(l.k);(0,g.H)("BABYLON.VoronoiNoiseBlock",Ve);var Fe=function(e){function t(t){var n=e.call(this,t,i.u.Neutral)||this;return n.registerInput("input",r.E.AutoDetect),n.registerOutput("output",r.E.BasedOnInput),n._outputs[0]._typeConnectionSource=n._inputs[0],n}return(0,h.ZT)(t,e),t.prototype.getClassName=function(){return"ElbowBlock"},Object.defineProperty(t.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var e=this._inputs[0];if(e.isConnected&&e.connectedPoint.ownerBlock.isInput)return i.u.Vertex;return this._target},set:function(e){0==(this._target&e)&&(this._target=e)},enumerable:!1,configurable:!0}),t.prototype._buildBlock=function(t){e.prototype._buildBlock.call(this,t);var n=this._outputs[0],i=this._inputs[0];return t.compilationString+=this._declareOutput(n,t)+" = ".concat(i.associatedVariableName,";\r\n"),this},t}(l.k);(0,g.H)("BABYLON.ElbowBlock",Fe);var Be=function(){function e(){}return e.prototype.optimize=function(e,t){},e}()},97163:(e,t,n)=>{n.d(t,{O:()=>W,n:()=>G});var i=n(31191),r=n(74375),o=n(71419),a=n(58095),c=n(15631),s=n(37290),u=n(89762),l=n(70848),p=n(9256),d=function(){function e(){this.supportUniformBuffers=!1,this.attributes=new Array,this.uniforms=new Array,this.constants=new Array,this.samplers=new Array,this.functions={},this.extensions={},this.counters={},this._attributeDeclaration="",this._uniformDeclaration="",this._constantDeclaration="",this._samplerDeclaration="",this._varyingTransfer="",this._injectAtEnd="",this._repeatableContentAnchorIndex=0,this._builtCompilationString="",this.compilationString=""}return e.prototype.finalize=function(e){var t=e.sharedData.emitComments,n=this.target===l.u.Fragment;this.compilationString="\r\n".concat(t?"//Entry point\r\n":"","void main(void) {\r\n").concat(this.compilationString),this._constantDeclaration&&(this.compilationString="\r\n".concat(t?"//Constants\r\n":"").concat(this._constantDeclaration,"\r\n").concat(this.compilationString));var i="";for(var r in this.functions)i+=this.functions[r]+"\r\n";for(var o in this.compilationString="\r\n".concat(i,"\r\n").concat(this.compilationString),!n&&this._varyingTransfer&&(this.compilationString="".concat(this.compilationString,"\r\n").concat(this._varyingTransfer)),this._injectAtEnd&&(this.compilationString="".concat(this.compilationString,"\r\n").concat(this._injectAtEnd)),this.compilationString="".concat(this.compilationString,"\r\n}"),this.sharedData.varyingDeclaration&&(this.compilationString="\r\n".concat(t?"//Varyings\r\n":"").concat(this.sharedData.varyingDeclaration,"\r\n").concat(this.compilationString)),this._samplerDeclaration&&(this.compilationString="\r\n".concat(t?"//Samplers\r\n":"").concat(this._samplerDeclaration,"\r\n").concat(this.compilationString)),this._uniformDeclaration&&(this.compilationString="\r\n".concat(t?"//Uniforms\r\n":"").concat(this._uniformDeclaration,"\r\n").concat(this.compilationString)),this._attributeDeclaration&&!n&&(this.compilationString="\r\n".concat(t?"//Attributes\r\n":"").concat(this._attributeDeclaration,"\r\n").concat(this.compilationString)),this.compilationString="precision highp float;\r\n"+this.compilationString,this.extensions){var a=this.extensions[o];this.compilationString="\r\n".concat(a,"\r\n").concat(this.compilationString)}this._builtCompilationString=this.compilationString},Object.defineProperty(e.prototype,"_repeatableContentAnchor",{get:function(){return"###___ANCHOR".concat(this._repeatableContentAnchorIndex++,"___###")},enumerable:!1,configurable:!0}),e.prototype._getFreeVariableName=function(e){return e=e.replace(/[^a-zA-Z_]+/g,""),void 0===this.sharedData.variableNames[e]?(this.sharedData.variableNames[e]=0,"output"===e||"texture"===e?e+this.sharedData.variableNames[e]:e):(this.sharedData.variableNames[e]++,e+this.sharedData.variableNames[e])},e.prototype._getFreeDefineName=function(e){return void 0===this.sharedData.defineNames[e]?this.sharedData.defineNames[e]=0:this.sharedData.defineNames[e]++,e+this.sharedData.defineNames[e]},e.prototype._excludeVariableName=function(e){this.sharedData.variableNames[e]=0},e.prototype._emit2DSampler=function(e){this.samplers.indexOf(e)<0&&(this._samplerDeclaration+="uniform sampler2D ".concat(e,";\r\n"),this.samplers.push(e))},e.prototype._getGLType=function(e){switch(e){case u.E.Float:return"float";case u.E.Int:return"int";case u.E.Vector2:return"vec2";case u.E.Color3:case u.E.Vector3:return"vec3";case u.E.Color4:case u.E.Vector4:return"vec4";case u.E.Matrix:return"mat4"}return""},e.prototype._emitExtension=function(e,t,n){void 0===n&&(n=""),this.extensions[e]||(n&&(t="#if ".concat(n,"\r\n").concat(t,"\r\n#endif")),this.extensions[e]=t)},e.prototype._emitFunction=function(e,t,n){this.functions[e]||(this.sharedData.emitComments&&(t=n+"\r\n"+t),this.functions[e]=t)},e.prototype._emitCodeFromInclude=function(e,t,n){if(n&&n.repeatKey)return"#include<".concat(e,">[0..").concat(n.repeatKey,"]\r\n");var i=p.Q.IncludesShadersStore[e]+"\r\n";if(this.sharedData.emitComments&&(i=t+"\r\n"+i),!n)return i;if(n.replaceStrings)for(var r=0;r<n.replaceStrings.length;r++){var o=n.replaceStrings[r];i=i.replace(o.search,o.replace)}return i},e.prototype._emitFunctionFromInclude=function(e,t,n,i){void 0===i&&(i="");var r=e+i;if(!this.functions[r]){if(!(n&&(n.removeAttributes||n.removeUniforms||n.removeVaryings||n.removeIfDef||n.replaceStrings)))return n&&n.repeatKey?this.functions[r]="#include<".concat(e,">[0..").concat(n.repeatKey,"]\r\n"):this.functions[r]="#include<".concat(e,">\r\n"),void(this.sharedData.emitComments&&(this.functions[r]=t+"\r\n"+this.functions[r]));if(this.functions[r]=p.Q.IncludesShadersStore[e],this.sharedData.emitComments&&(this.functions[r]=t+"\r\n"+this.functions[r]),n.removeIfDef&&(this.functions[r]=this.functions[r].replace(/^\s*?#ifdef.+$/gm,""),this.functions[r]=this.functions[r].replace(/^\s*?#endif.*$/gm,""),this.functions[r]=this.functions[r].replace(/^\s*?#else.*$/gm,""),this.functions[r]=this.functions[r].replace(/^\s*?#elif.*$/gm,"")),n.removeAttributes&&(this.functions[r]=this.functions[r].replace(/^\s*?attribute.+$/gm,"")),n.removeUniforms&&(this.functions[r]=this.functions[r].replace(/^\s*?uniform.+$/gm,"")),n.removeVaryings&&(this.functions[r]=this.functions[r].replace(/^\s*?varying.+$/gm,"")),n.replaceStrings)for(var o=0;o<n.replaceStrings.length;o++){var a=n.replaceStrings[o];this.functions[r]=this.functions[r].replace(a.search,a.replace)}}},e.prototype._registerTempVariable=function(e){return-1===this.sharedData.temps.indexOf(e)&&(this.sharedData.temps.push(e),!0)},e.prototype._emitVaryingFromString=function(e,t,n,i){return void 0===n&&(n=""),void 0===i&&(i=!1),-1===this.sharedData.varyings.indexOf(e)&&(this.sharedData.varyings.push(e),n&&(n.startsWith("defined(")?this.sharedData.varyingDeclaration+="#if ".concat(n,"\r\n"):this.sharedData.varyingDeclaration+="".concat(i?"#ifndef":"#ifdef"," ").concat(n,"\r\n")),this.sharedData.varyingDeclaration+="varying ".concat(t," ").concat(e,";\r\n"),n&&(this.sharedData.varyingDeclaration+="#endif\r\n"),!0)},e.prototype._emitUniformFromString=function(e,t,n,i){void 0===n&&(n=""),void 0===i&&(i=!1),-1===this.uniforms.indexOf(e)&&(this.uniforms.push(e),n&&(n.startsWith("defined(")?this._uniformDeclaration+="#if ".concat(n,"\r\n"):this._uniformDeclaration+="".concat(i?"#ifndef":"#ifdef"," ").concat(n,"\r\n")),this._uniformDeclaration+="uniform ".concat(t," ").concat(e,";\r\n"),n&&(this._uniformDeclaration+="#endif\r\n"))},e.prototype._emitFloat=function(e){return e.toString()===e.toFixed(0)?"".concat(e,".0"):e.toString()},e}(),h=n(62897),f=function(){function e(){this.temps=new Array,this.varyings=new Array,this.varyingDeclaration="",this.inputBlocks=new Array,this.textureBlocks=new Array,this.bindableBlocks=new Array,this.forcedBindableBlocks=new Array,this.blocksWithFallbacks=new Array,this.blocksWithDefines=new Array,this.repeatableContentBlocks=new Array,this.dynamicUniformBlocks=new Array,this.blockingBlocks=new Array,this.animatedInputs=new Array,this.variableNames={},this.defineNames={},this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1},this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:new Array},this.allowEmptyVertexProgram=!1,this.variableNames.position=0,this.variableNames.normal=0,this.variableNames.tangent=0,this.variableNames.uv=0,this.variableNames.uv2=0,this.variableNames.uv3=0,this.variableNames.uv4=0,this.variableNames.uv5=0,this.variableNames.uv6=0,this.variableNames.color=0,this.variableNames.matricesIndices=0,this.variableNames.matricesWeights=0,this.variableNames.matricesIndicesExtra=0,this.variableNames.matricesWeightsExtra=0,this.variableNames.diffuseBase=0,this.variableNames.specularBase=0,this.variableNames.worldPos=0,this.variableNames.shadow=0,this.variableNames.view=0,this.variableNames.vTBN=0,this.defineNames.MAINUV0=0,this.defineNames.MAINUV1=0,this.defineNames.MAINUV2=0,this.defineNames.MAINUV3=0,this.defineNames.MAINUV4=0,this.defineNames.MAINUV5=0,this.defineNames.MAINUV6=0,this.defineNames.MAINUV7=0}return e.prototype.emitErrors=function(){var e="";this.checks.emitVertex||this.allowEmptyVertexProgram||(e+="NodeMaterial does not have a vertex output. You need to at least add a block that generates a glPosition value.\r\n"),this.checks.emitFragment||(e+="NodeMaterial does not have a fragment output. You need to at least add a block that generates a glFragColor value.\r\n");for(var t=0,n=this.checks.notConnectedNonOptionalInputs;t<n.length;t++){var i=n[t];e+="input ".concat(i.name," from block ").concat(i.ownerBlock.name,"[").concat(i.ownerBlock.getClassName(),"] is not connected and is not optional.\r\n")}if(e)throw"Build of NodeMaterial failed:\r\n"+e},e}(),m=n(64849),g=n(72208),b=n(13514),_=n(73702),y=n(32709),v=n(62374),N=n(62976),S=n(48620),O=n(96969),C=n(853),E=n(28361),P=n(17962),I=n(71477),x=n(38309),A=n(51912),T=n(16142),V=n(72868),F=n(61878),B=n(66897),R=n(44337),z=n(73803),k=n(25846),D=n(4482),w=n(44335),L=n(91062),M=n(97425),j=n(94018),U=n(69958),H=n(15210),K={effect:null,subMesh:null},G=function(e){function t(){var t=e.call(this)||this;return t.NORMAL=!1,t.TANGENT=!1,t.UV1=!1,t.UV2=!1,t.UV3=!1,t.UV4=!1,t.UV5=!1,t.UV6=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.BONETEXTURE=!1,t.MORPHTARGETS=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_UV=!1,t.NUM_MORPH_INFLUENCERS=0,t.MORPHTARGETS_TEXTURE=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.SKIPFINALCOLORCLAMP=!1,t.BUMPDIRECTUV=0,t.rebuild(),t}return(0,i.ZT)(t,e),t.prototype.setValue=function(e,t,n){void 0===n&&(n=!1),void 0===this[e]&&this._keys.push(e),n&&this[e]!==t&&this.markAsUnprocessed(),this[e]=t},t}(m.H),W=function(e){function t(n,r,o){void 0===o&&(o={});var c=e.call(this,n,r||H.l.LastCreatedScene)||this;return c._buildId=t._BuildIdGenerator++,c._buildWasSuccessful=!1,c._cachedWorldViewMatrix=new a.y3,c._cachedWorldViewProjectionMatrix=new a.y3,c._optimizers=new Array,c._animationFrame=-1,c.BJSNODEMATERIALEDITOR=c._getGlobalNodeMaterialEditor(),c.editorData=null,c.ignoreAlpha=!1,c.maxSimultaneousLights=4,c.onBuildObservable=new h.y$,c._vertexOutputNodes=new Array,c._fragmentOutputNodes=new Array,c.attachedBlocks=new Array,c._mode=R.a.Material,c.forceAlphaBlending=!1,c._options=(0,i.pi)({emitComments:!1},o),c._attachImageProcessingConfiguration(null),c}return(0,i.ZT)(t,e),t.prototype._getGlobalNodeMaterialEditor=function(){return"undefined"!=typeof NODEEDITOR?NODEEDITOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.NodeEditor?BABYLON:void 0},Object.defineProperty(t.prototype,"options",{get:function(){return this._options},set:function(e){this._options=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buildId",{get:function(){return this._buildId},set:function(e){this._buildId=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"NodeMaterial"},t.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){t._markAllSubMeshesAsImageProcessingDirty()}))))},t.prototype.getBlockByName=function(e){for(var t=null,n=0,i=this.attachedBlocks;n<i.length;n++){var r=i[n];if(r.name===e){if(t)return b.w1.Warn("More than one block was found with the name `"+e+"`"),t;t=r}}return t},t.prototype.getBlockByPredicate=function(e){for(var t=0,n=this.attachedBlocks;t<n.length;t++){var i=n[t];if(e(i))return i}return null},t.prototype.getInputBlockByPredicate=function(e){for(var t=0,n=this.attachedBlocks;t<n.length;t++){var i=n[t];if(i.isInput&&e(i))return i}return null},t.prototype.getInputBlocks=function(){for(var e=[],t=0,n=this.attachedBlocks;t<n.length;t++){var i=n[t];i.isInput&&e.push(i)}return e},t.prototype.registerOptimizer=function(e){if(!(this._optimizers.indexOf(e)>-1))return this._optimizers.push(e),this},t.prototype.unregisterOptimizer=function(e){var t=this._optimizers.indexOf(e);if(-1!==t)return this._optimizers.splice(t,1),this},t.prototype.addOutputNode=function(e){if(null===e.target)throw"This node is not meant to be an output node. You may want to explicitly set its target value.";return 0!=(e.target&l.u.Vertex)&&this._addVertexOutputNode(e),0!=(e.target&l.u.Fragment)&&this._addFragmentOutputNode(e),this},t.prototype.removeOutputNode=function(e){return null===e.target||(0!=(e.target&l.u.Vertex)&&this._removeVertexOutputNode(e),0!=(e.target&l.u.Fragment)&&this._removeFragmentOutputNode(e)),this},t.prototype._addVertexOutputNode=function(e){if(-1===this._vertexOutputNodes.indexOf(e))return e.target=l.u.Vertex,this._vertexOutputNodes.push(e),this},t.prototype._removeVertexOutputNode=function(e){var t=this._vertexOutputNodes.indexOf(e);if(-1!==t)return this._vertexOutputNodes.splice(t,1),this},t.prototype._addFragmentOutputNode=function(e){if(-1===this._fragmentOutputNodes.indexOf(e))return e.target=l.u.Fragment,this._fragmentOutputNodes.push(e),this},t.prototype._removeFragmentOutputNode=function(e){var t=this._fragmentOutputNodes.indexOf(e);if(-1!==t)return this._fragmentOutputNodes.splice(t,1),this},t.prototype.needAlphaBlending=function(){return!this.ignoreAlpha&&(this.forceAlphaBlending||this.alpha<1||this._sharedData&&this._sharedData.hints.needAlphaBlending)},t.prototype.needAlphaTesting=function(){return this._sharedData&&this._sharedData.hints.needAlphaTesting},t.prototype._initializeBlock=function(e,t,n,i){if(void 0===i&&(i=!0),e.initialize(t),i&&e.autoConfigure(this),e._preparationId=this._buildId,-1===this.attachedBlocks.indexOf(e)){if(e.isUnique)for(var r=e.getClassName(),o=0,a=this.attachedBlocks;o<a.length;o++){if(a[o].getClassName()===r)throw"Cannot have multiple blocks of type ".concat(r," in the same NodeMaterial")}this.attachedBlocks.push(e)}for(var c=0,s=e.inputs;c<s.length;c++){var u=s[c];u.associatedVariableName="";var p=u.connectedPoint;if(p){var d=p.ownerBlock;d!==e&&((d.target===l.u.VertexAndFragment||t.target===l.u.Fragment&&d.target===l.u.Vertex&&d._preparationId!==this._buildId)&&n.push(d),this._initializeBlock(d,t,n,i))}}for(var h=0,f=e.outputs;h<f.length;h++){f[h].associatedVariableName=""}},t.prototype._resetDualBlocks=function(e,t){e.target===l.u.VertexAndFragment&&(e.buildId=t);for(var n=0,i=e.inputs;n<i.length;n++){var r=i[n].connectedPoint;if(r){var o=r.ownerBlock;o!==e&&this._resetDualBlocks(o,t)}}},t.prototype.removeBlock=function(e){var t=this.attachedBlocks.indexOf(e);t>-1&&this.attachedBlocks.splice(t,1),e.isFinalMerger&&this.removeOutputNode(e)},t.prototype.build=function(e,n,i){void 0===e&&(e=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),this._buildWasSuccessful=!1;var r=this.getScene().getEngine(),o=this._mode===R.a.Particle;if(0===this._vertexOutputNodes.length&&!o)throw"You must define at least one vertexOutputNode";if(0===this._fragmentOutputNodes.length)throw"You must define at least one fragmentOutputNode";this._vertexCompilationState=new d,this._vertexCompilationState.supportUniformBuffers=r.supportsUniformBuffers,this._vertexCompilationState.target=l.u.Vertex,this._fragmentCompilationState=new d,this._fragmentCompilationState.supportUniformBuffers=r.supportsUniformBuffers,this._fragmentCompilationState.target=l.u.Fragment,this._sharedData=new f,this._sharedData.fragmentOutputNodes=this._fragmentOutputNodes,this._vertexCompilationState.sharedData=this._sharedData,this._fragmentCompilationState.sharedData=this._sharedData,this._sharedData.buildId=this._buildId,this._sharedData.emitComments=this._options.emitComments,this._sharedData.verbose=e,this._sharedData.scene=this.getScene(),this._sharedData.allowEmptyVertexProgram=o;for(var a=[],c=[],s=0,u=this._vertexOutputNodes;s<u.length;s++){var p=u[s];a.push(p),this._initializeBlock(p,this._vertexCompilationState,c,i)}for(var h=0,m=this._fragmentOutputNodes;h<m.length;h++){var g=m[h];c.push(g),this._initializeBlock(g,this._fragmentCompilationState,a,i)}this.optimize();for(var b=0,_=a;b<_.length;b++){(p=_[b]).build(this._vertexCompilationState,a)}this._fragmentCompilationState.uniforms=this._vertexCompilationState.uniforms.slice(0),this._fragmentCompilationState._uniformDeclaration=this._vertexCompilationState._uniformDeclaration,this._fragmentCompilationState._constantDeclaration=this._vertexCompilationState._constantDeclaration,this._fragmentCompilationState._vertexState=this._vertexCompilationState;for(var y=0,v=c;y<v.length;y++){g=v[y];this._resetDualBlocks(g,this._buildId-1)}for(var N=0,S=c;N<S.length;N++){(g=S[N]).build(this._fragmentCompilationState,c)}this._vertexCompilationState.finalize(this._vertexCompilationState),this._fragmentCompilationState.finalize(this._fragmentCompilationState),n&&(this._buildId=t._BuildIdGenerator++),this._sharedData.emitErrors(),this._buildWasSuccessful=!0,this.onBuildObservable.notifyObservers(this);for(var O=0,C=this.getScene().meshes;O<C.length;O++){var E=C[O];if(E.subMeshes)for(var P=0,I=E.subMeshes;P<I.length;P++){var x=I[P];if(x.getMaterial()===this&&x.materialDefines){var A=x.materialDefines;A.markAllAsDirty(),A.reset()}}}},t.prototype.optimize=function(){for(var e=0,t=this._optimizers;e<t.length;e++){t[e].optimize(this._vertexOutputNodes,this._fragmentOutputNodes)}},t.prototype._prepareDefinesForAttributes=function(e,t){var n=t.NORMAL,i=t.TANGENT;t.NORMAL=e.isVerticesDataPresent(g.o.NormalKind),t.TANGENT=e.isVerticesDataPresent(g.o.TangentKind);for(var r=!1,o=1;o<=6;++o){var a=t["UV"+o];t["UV"+o]=e.isVerticesDataPresent("uv".concat(1===o?"":o)),r=r||t["UV"+o]!==a}(n!==t.NORMAL||i!==t.TANGENT||r)&&t.markAsAttributesDirty()},t.prototype.createPostProcess=function(e,t,n,i,r,o,a){return void 0===t&&(t=1),void 0===n&&(n=1),void 0===o&&(o=0),void 0===a&&(a=5),this.mode!==R.a.PostProcess?null:this._createEffectForPostProcess(null,e,t,n,i,r,o,a)},t.prototype.createEffectForPostProcess=function(e){this._createEffectForPostProcess(e)},t.prototype._createEffectForPostProcess=function(e,t,n,i,r,a,c,s){var u=this;void 0===n&&(n=1),void 0===i&&(i=1),void 0===c&&(c=0),void 0===s&&(s=5);var l=this.name+this._buildId,d=new G,h=new o.x(l+"PostProcess",this.getScene()),f=this._buildId;return this._processDefines(h,d),p.Q.RegisterShader(l,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString),e?e.updateEffect(d.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,l,l):e=new T.D(this.name+"PostProcess",l,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,n,t,i,r,a,d.toString(),c,l,{maxSimultaneousLights:this.maxSimultaneousLights},!1,s),e.nodeMaterialSource=this,e.onApplyObservable.add((function(t){f!==u._buildId&&(delete p.Q.ShadersStore[l+"VertexShader"],delete p.Q.ShadersStore[l+"PixelShader"],l=u.name+u._buildId,d.markAllAsDirty(),f=u._buildId),u._processDefines(h,d)&&(p.Q.RegisterShader(l,u._fragmentCompilationState._builtCompilationString,u._vertexCompilationState._builtCompilationString),w.Q.SetImmediate((function(){return e.updateEffect(d.toString(),u._fragmentCompilationState.uniforms,u._fragmentCompilationState.samplers,{maxSimultaneousLights:u.maxSimultaneousLights},void 0,void 0,l,l)}))),u._checkInternals(t)})),e},t.prototype.createProceduralTexture=function(e,t){var n=this;if(this.mode!==R.a.ProceduralTexture)return null;var i=this.name+this._buildId,r=new L.g(i,e,null,t),a=new o.x(i+"Procedural",this.getScene());a.reservedDataStore={hidden:!0};var c=new G,s=this._processDefines(a,c);p.Q.RegisterShader(i,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString);var u=this.getScene().getEngine().createEffect({vertexElement:i,fragmentElement:i},[g.o.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,c.toString(),null==s?void 0:s.fallbacks,void 0);r.nodeMaterialSource=this,r._setEffect(u);var l=this._buildId;return r.onBeforeGenerationObservable.add((function(){l!==n._buildId&&(delete p.Q.ShadersStore[i+"VertexShader"],delete p.Q.ShadersStore[i+"PixelShader"],i=n.name+n._buildId,c.markAllAsDirty(),l=n._buildId);var e=n._processDefines(a,c);e&&(p.Q.RegisterShader(i,n._fragmentCompilationState._builtCompilationString,n._vertexCompilationState._builtCompilationString),w.Q.SetImmediate((function(){u=n.getScene().getEngine().createEffect({vertexElement:i,fragmentElement:i},[g.o.PositionKind],n._fragmentCompilationState.uniforms,n._fragmentCompilationState.samplers,c.toString(),null==e?void 0:e.fallbacks,void 0),r._setEffect(u)}))),n._checkInternals(u)})),r},t.prototype._createEffectForParticles=function(e,t,n,i,r,a,c,s){var u=this;void 0===s&&(s="");var l=this.name+this._buildId+"_"+t;a||(a=new G),c||(c=this.getScene().getMeshByName(this.name+"Particle"))||((c=new o.x(this.name+"Particle",this.getScene())).reservedDataStore={hidden:!0});var d=this._buildId,h=[],f=s;if(!r){var m=this._processDefines(c,a);p.Q.RegisterShader(l,this._fragmentCompilationState._builtCompilationString),e.fillDefines(h,t),f=h.join("\n"),r=this.getScene().getEngine().createEffectForParticles(l,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,a.toString()+"\n"+f,null==m?void 0:m.fallbacks,n,i,e),e.setCustomEffect(r,t)}r.onBindObservable.add((function(r){d!==u._buildId&&(delete p.Q.ShadersStore[l+"PixelShader"],l=u.name+u._buildId+"_"+t,a.markAllAsDirty(),d=u._buildId),h.length=0,e.fillDefines(h,t);var o=h.join("\n");o!==f&&(a.markAllAsDirty(),f=o);var m=u._processDefines(c,a);if(m)return p.Q.RegisterShader(l,u._fragmentCompilationState._builtCompilationString),r=u.getScene().getEngine().createEffectForParticles(l,u._fragmentCompilationState.uniforms,u._fragmentCompilationState.samplers,a.toString()+"\n"+f,null==m?void 0:m.fallbacks,n,i,e),e.setCustomEffect(r,t),void u._createEffectForParticles(e,t,n,i,r,a,c,s);u._checkInternals(r)}))},t.prototype._checkInternals=function(e){if(this._sharedData.animatedInputs){var t=this.getScene(),n=t.getFrameId();if(this._animationFrame!==n){for(var i=0,r=this._sharedData.animatedInputs;i<r.length;i++){r[i].animate(t)}this._animationFrame=n}}for(var o=0,a=this._sharedData.bindableBlocks;o<a.length;o++){a[o].bind(e,this)}for(var c=0,s=this._sharedData.inputBlocks;c<s.length;c++){s[c]._transmit(e,this.getScene(),this)}},t.prototype.createEffectForParticles=function(e,t,n){this.mode===R.a.Particle&&(this._createEffectForParticles(e,k.U.BLENDMODE_ONEONE,t,n),this._createEffectForParticles(e,k.U.BLENDMODE_MULTIPLY,t,n))},t.prototype._processDefines=function(e,t,n,i){var r=this;void 0===n&&(n=!1);var o=null;if(this._sharedData.blocksWithDefines.forEach((function(i){i.initializeDefines(e,r,t,n)})),this._sharedData.blocksWithDefines.forEach((function(o){o.prepareDefines(e,r,t,n,i)})),t.isDirty){var a=t._areLightsDisposed;t.markAsProcessed(),this._vertexCompilationState.compilationString=this._vertexCompilationState._builtCompilationString,this._fragmentCompilationState.compilationString=this._fragmentCompilationState._builtCompilationString,this._sharedData.repeatableContentBlocks.forEach((function(n){n.replaceRepeatableContent(r._vertexCompilationState,r._fragmentCompilationState,e,t)}));var c=[];this._sharedData.dynamicUniformBlocks.forEach((function(e){e.updateUniformsAndSamples(r._vertexCompilationState,r,t,c)}));var s=this._vertexCompilationState.uniforms;this._fragmentCompilationState.uniforms.forEach((function(e){-1===s.indexOf(e)&&s.push(e)}));var u=this._vertexCompilationState.samplers;this._fragmentCompilationState.samplers.forEach((function(e){-1===u.indexOf(e)&&u.push(e)}));var l=new x.L;this._sharedData.blocksWithFallbacks.forEach((function(t){t.provideFallbacks(e,l)})),o={lightDisposed:a,uniformBuffers:c,mergedUniforms:s,mergedSamplers:u,fallbacks:l}}return o},t.prototype.isReadyForSubMesh=function(e,t,n){var i=this;if(void 0===n&&(n=!1),!this._buildWasSuccessful)return!1;var r=this.getScene();if(this._sharedData.animatedInputs){var o=r.getFrameId();if(this._animationFrame!==o){for(var a=0,c=this._sharedData.animatedInputs;a<c.length;a++){c[a].animate(r)}this._animationFrame=o}}if(t.effect&&this.isFrozen&&t.effect._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new G);var s=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;var u=r.getEngine();if(this._prepareDefinesForAttributes(e,s),this._sharedData.blockingBlocks.some((function(t){return!t.isReady(e,i,s,n)})))return!1;var l=this._processDefines(e,s,n,t);if(l){var p=t.effect,d=s.toString(),h=u.createEffect({vertex:"nodeMaterial"+this._buildId,fragment:"nodeMaterial"+this._buildId,vertexSource:this._vertexCompilationState.compilationString,fragmentSource:this._fragmentCompilationState.compilationString},{attributes:this._vertexCompilationState.attributes,uniformsNames:l.mergedUniforms,uniformBuffersNames:l.uniformBuffers,samplers:l.mergedSamplers,defines:d,fallbacks:l.fallbacks,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights,maxSimultaneousMorphTargets:s.NUM_MORPH_INFLUENCERS}},u);if(h)if(this._onEffectCreatedObservable&&(K.effect=h,K.subMesh=t,this._onEffectCreatedObservable.notifyObservers(K)),this.allowShaderHotSwapping&&p&&!h.isReady()){if(h=p,s.markAsUnprocessed(),l.lightDisposed)return s._areLightsDisposed=!0,!1}else r.resetCachedMaterial(),t.setEffect(h,s,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(s._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},Object.defineProperty(t.prototype,"compiledShaders",{get:function(){return"// Vertex shader\r\n".concat(this._vertexCompilationState.compilationString,"\r\n\r\n// Fragment shader\r\n").concat(this._fragmentCompilationState.compilationString)},enumerable:!1,configurable:!0}),t.prototype.bindOnlyWorldMatrix=function(e){var t=this.getScene();if(this._activeEffect){var n=this._sharedData.hints;n.needWorldViewMatrix&&e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),n.needWorldViewProjectionMatrix&&e.multiplyToRef(t.getTransformMatrix(),this._cachedWorldViewProjectionMatrix);for(var i=0,r=this._sharedData.inputBlocks;i<r.length;i++){r[i]._transmitWorld(this._activeEffect,e,this._cachedWorldViewMatrix,this._cachedWorldViewProjectionMatrix)}}},t.prototype.bindForSubMesh=function(e,t,n){var i=this.getScene(),r=n.effect;if(r){this._activeEffect=r,this.bindOnlyWorldMatrix(e);var o=this._mustRebind(i,r,t.visibility),a=this._sharedData;if(o){for(var c=0,s=a.bindableBlocks;c<s.length;c++){s[c].bind(r,this,t,n)}for(var u=0,l=a.forcedBindableBlocks;u<l.length;u++){l[u].bind(r,this,t,n)}for(var p=0,d=a.inputBlocks;p<d.length;p++){d[p]._transmit(r,i,this)}}else if(!this.isFrozen)for(var h=0,f=a.forcedBindableBlocks;h<f.length;h++){f[h].bind(r,this,t,n)}this._afterBind(t,this._activeEffect)}},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._sharedData&&t.push.apply(t,this._sharedData.textureBlocks.filter((function(e){return e.texture})).map((function(e){return e.texture}))),t},t.prototype.getTextureBlocks=function(){return this._sharedData?this._sharedData.textureBlocks:[]},t.prototype.hasTexture=function(t){if(e.prototype.hasTexture.call(this,t))return!0;if(!this._sharedData)return!1;for(var n=0,i=this._sharedData.textureBlocks;n<i.length;n++){if(i[n].texture===t)return!0}return!1},t.prototype.dispose=function(t,n,i){if(n)for(var r=0,o=this.getTextureBlocks().filter((function(e){return e.texture})).map((function(e){return e.texture}));r<o.length;r++){o[r].dispose()}for(var a=0,c=this.attachedBlocks;a<c.length;a++){c[a].dispose()}this.attachedBlocks=[],this._sharedData=null,this._vertexCompilationState=null,this._fragmentCompilationState=null,this.onBuildObservable.clear(),this._imageProcessingObserver&&(this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingObserver=null),e.prototype.dispose.call(this,t,n,i)},t.prototype._createNodeEditor=function(){this.BJSNODEMATERIALEDITOR.NodeEditor.Show({nodeMaterial:this})},t.prototype.edit=function(e){var n=this;return new Promise((function(i){if(n.BJSNODEMATERIALEDITOR=n.BJSNODEMATERIALEDITOR||n._getGlobalNodeMaterialEditor(),void 0===n.BJSNODEMATERIALEDITOR){var r=e&&e.editorURL?e.editorURL:t.EditorURL;b.w1.LoadScript(r,(function(){n.BJSNODEMATERIALEDITOR=n.BJSNODEMATERIALEDITOR||n._getGlobalNodeMaterialEditor(),n._createNodeEditor(),i()}))}else n._createNodeEditor(),i()}))},t.prototype.clear=function(){this._vertexOutputNodes=[],this._fragmentOutputNodes=[],this.attachedBlocks=[]},t.prototype.setToDefault=function(){this.clear(),this.editorData=null;var e=new N.S("Position");e.setAsAttribute("position");var t=new N.S("World");t.setAsSystemValue(U.$.World);var n=new _.m("WorldPos");e.connectTo(n),t.connectTo(n);var i=new N.S("ViewProjection");i.setAsSystemValue(U.$.ViewProjection);var r=new _.m("WorldPos * ViewProjectionTransform");n.connectTo(r),i.connectTo(r);var o=new y.t("VertexOutput");r.connectTo(o);var a=new N.S("color");a.value=new c.HE(.8,.8,.8,1);var s=new v.g("FragmentOutput");a.connectTo(s),this.addOutputNode(o),this.addOutputNode(s),this._mode=R.a.Material},t.prototype.setToDefaultPostProcess=function(){this.clear(),this.editorData=null;var e=new N.S("Position");e.setAsAttribute("position2d");var t=new N.S("Constant1");t.isConstant=!0,t.value=1;var n=new V.t("Position3D");e.connectTo(n),t.connectTo(n,{input:"w"});var i=new y.t("VertexOutput");n.connectTo(i);var r=new N.S("Scale");r.visibleInInspector=!0,r.value=new a.FM(1,1);var o=new F.w("uv0");e.connectTo(o);var c=new B.U("UV scale");o.connectTo(c),r.connectTo(c);var s=new C.K("CurrentScreen");c.connectTo(s),s.texture=new z.x("https://assets.babylonjs.com/nme/currentScreenPostProcess.png",this.getScene());var u=new v.g("FragmentOutput");s.connectTo(u,{output:"rgba"}),this.addOutputNode(i),this.addOutputNode(u),this._mode=R.a.PostProcess},t.prototype.setToDefaultProceduralTexture=function(){this.clear(),this.editorData=null;var e=new N.S("Position");e.setAsAttribute("position2d");var t=new N.S("Constant1");t.isConstant=!0,t.value=1;var n=new V.t("Position3D");e.connectTo(n),t.connectTo(n,{input:"w"});var i=new y.t("VertexOutput");n.connectTo(i);var r=new N.S("Time");r.value=0,r.min=0,r.max=0,r.isBoolean=!1,r.matrixMode=0,r.animationType=M.c.Time,r.isConstant=!1;var o=new N.S("Color3");o.value=new c.Wo(1,1,1),o.isConstant=!1;var a=new v.g("FragmentOutput"),s=new V.t("VectorMerger");s.visibleInInspector=!1;var u=new j.S("Cos");u.operation=j.p.Cos,e.connectTo(s),r.output.connectTo(u.input),u.output.connectTo(s.z),s.xyzOut.connectTo(a.rgb),this.addOutputNode(i),this.addOutputNode(a),this._mode=R.a.ProceduralTexture},t.prototype.setToDefaultParticle=function(){this.clear(),this.editorData=null;var e=new N.S("uv");e.setAsAttribute("particle_uv");var t=new E.P("ParticleTexture");e.connectTo(t);var n=new N.S("Color");n.setAsAttribute("particle_color");var i=new B.U("Texture * Color");t.connectTo(i),n.connectTo(i);var r=new P.p("ParticleRampGradient");i.connectTo(r);var o=new D.v("ColorSplitter");n.connectTo(o);var a=new I.D("ParticleBlendMultiply");r.connectTo(a),t.connectTo(a,{output:"a"}),o.connectTo(a,{output:"a"});var c=new v.g("FragmentOutput");a.connectTo(c),this.addOutputNode(c),this._mode=R.a.Particle},t.prototype.loadAsync=function(e,t){var n=this;return void 0===t&&(t=""),this.getScene()._loadFileAsync(e).then((function(e){var i=JSON.parse(e);n.loadFromSerialization(i,t)}))},t.prototype._gatherBlocks=function(e,t){if(-1===t.indexOf(e)){t.push(e);for(var n=0,i=e.inputs;n<i.length;n++){var r=i[n].connectedPoint;if(r){var o=r.ownerBlock;o!==e&&this._gatherBlocks(o,t)}}}},t.prototype.generateCode=function(){for(var e=[],t=[],n=["const","var","let"],i=0,r=this._vertexOutputNodes;i<r.length;i++){var o=r[i];this._gatherBlocks(o,t)}for(var a=[],c=0,s=this._fragmentOutputNodes;c<s.length;c++){o=s[c];this._gatherBlocks(o,a)}for(var u='var nodeMaterial = new BABYLON.NodeMaterial("'.concat(this.name||"node material",'");\r\n'),l=0,p=t;l<p.length;l++){(v=p[l]).isInput&&-1===e.indexOf(v)&&(u+=v._dumpCode(n,e))}for(var d=0,h=a;d<h.length;d++){(v=h[d]).isInput&&-1===e.indexOf(v)&&(u+=v._dumpCode(n,e))}e=[],u+="\r\n// Connections\r\n";for(var f=0,m=this._vertexOutputNodes;f<m.length;f++){u+=(v=m[f])._dumpCodeForOutputConnections(e)}for(var g=0,b=this._fragmentOutputNodes;g<b.length;g++){u+=(v=b[g])._dumpCodeForOutputConnections(e)}u+="\r\n// Output nodes\r\n";for(var _=0,y=this._vertexOutputNodes;_<y.length;_++){var v=y[_];u+="nodeMaterial.addOutputNode(".concat(v._codeVariableName,");\r\n")}for(var N=0,S=this._fragmentOutputNodes;N<S.length;N++){v=S[N];u+="nodeMaterial.addOutputNode(".concat(v._codeVariableName,");\r\n")}return u+="nodeMaterial.build();\r\n"},t.prototype.serialize=function(e){var t=e?{}:O.p4.Serialize(this);t.editorData=JSON.parse(JSON.stringify(this.editorData));var n=[];if(e)n=e;else{t.customType="BABYLON.NodeMaterial",t.outputNodes=[];for(var i=0,r=this._vertexOutputNodes;i<r.length;i++){var o=r[i];this._gatherBlocks(o,n),t.outputNodes.push(o.uniqueId)}for(var a=0,c=this._fragmentOutputNodes;a<c.length;a++){o=c[a];this._gatherBlocks(o,n),-1===t.outputNodes.indexOf(o.uniqueId)&&t.outputNodes.push(o.uniqueId)}}t.blocks=[];for(var s=0,u=n;s<u.length;s++){var l=u[s];t.blocks.push(l.serialize())}if(!e)for(var p=0,d=this.attachedBlocks;p<d.length;p++){l=d[p];-1===n.indexOf(l)&&t.blocks.push(l.serialize())}return t},t.prototype._restoreConnections=function(e,t,n){for(var i=0,r=e.outputs;i<r.length;i++)for(var o=r[i],a=0,c=t.blocks;a<c.length;a++){var s=c[a],u=n[s.id];if(u)for(var l=0,p=s.inputs;l<p.length;l++){var d=p[l];if(n[d.targetBlockId]!==e||d.targetConnectionName!==o.name);else{var h=u.getInputByName(d.inputName);if(!h||h.isConnected)continue;o.connectTo(h,!0),this._restoreConnections(u,t,n)}}}},t.prototype.loadFromSerialization=function(e,t,n){var i;void 0===t&&(t=""),void 0===n&&(n=!1),n||this.clear();for(var r={},o=0,a=e.blocks;o<a.length;o++){var c=a[o],s=(0,S.q)(c.customType);if(s)(l=new s)._deserialize(c,this.getScene(),t),r[c.id]=l,this.attachedBlocks.push(l)}for(var u=0;u<e.blocks.length;u++){var l;(l=r[(c=e.blocks[u]).id])&&(l.inputs.length&&!n||this._restoreConnections(l,e,r))}if(e.outputNodes)for(var p=0,d=e.outputNodes;p<d.length;p++){var h=d[p];this.addOutputNode(r[h])}if(e.locations||e.editorData&&e.editorData.locations){for(var f=e.locations||e.editorData.locations,m=0,g=f;m<g.length;m++){var b=g[m];r[b.blockId]&&(b.blockId=r[b.blockId].uniqueId)}n&&this.editorData&&this.editorData.locations&&f.concat(this.editorData.locations),e.locations?this.editorData={locations:f}:(this.editorData=e.editorData,this.editorData.locations=f);var _=[];for(var y in r)_[y]=r[y].uniqueId;this.editorData.map=_}this.comment=e.comment,void 0!==e.forceAlphaBlending&&(this.forceAlphaBlending=e.forceAlphaBlending),n||(this._mode=null!==(i=e.mode)&&void 0!==i?i:R.a.Material)},t.prototype.clone=function(e,n){var i=this;void 0===n&&(n=!1);var r=this.serialize(),o=O.p4.Clone((function(){return new t(e,i.getScene(),i.options)}),this);return o.id=e,o.name=e,o.loadFromSerialization(r),o._buildId=this._buildId,o.build(!1,!n),o},t.Parse=function(e,n,i){void 0===i&&(i="");var r=O.p4.Parse((function(){return new t(e.name,n)}),e,n,i);return r.loadFromSerialization(e,i),r.build(),r},t.ParseFromFileAsync=function(e,n,i,r,o){void 0===r&&(r=""),void 0===o&&(o=!1);var a=new t(e,i);return new Promise((function(e,t){return a.loadAsync(n,r).then((function(){o||a.build(),e(a)})).catch(t)}))},t.ParseFromSnippetAsync=function(e,n,i,r,o){var a=this;return void 0===n&&(n=H.l.LastCreatedScene),void 0===i&&(i=""),void 0===o&&(o=!1),"_BLANK"===e?Promise.resolve(this.CreateDefault("blank",n)):new Promise((function(c,s){var u=new A.g;u.addEventListener("readystatechange",(function(){if(4==u.readyState)if(200==u.status){var a=JSON.parse(JSON.parse(u.responseText).jsonPayload),l=JSON.parse(a.nodeMaterial);r||((r=O.p4.Parse((function(){return new t(e,n)}),l,n,i)).uniqueId=n.getUniqueId()),r.loadFromSerialization(l),r.snippetId=e;try{o||r.build(),c(r)}catch(e){s(e)}}else s("Unable to load the snippet "+e)})),u.open("GET",a.SnippetUrl+"/"+e.replace(/#/g,"/")),u.send()}))},t.CreateDefault=function(e,n){var i=new t(e,n);return i.setToDefault(),i.build(),i},t._BuildIdGenerator=0,t.EditorURL="https://unpkg.com/babylonjs-node-editor@".concat(s.D.Version,"/babylon.nodeEditor.js"),t.SnippetUrl="https://snippet.babylonjs.com",t.IgnoreTexturesAtLoadTime=!1,(0,i.gn)([(0,O.qC)()],t.prototype,"ignoreAlpha",void 0),(0,i.gn)([(0,O.qC)()],t.prototype,"maxSimultaneousLights",void 0),(0,i.gn)([(0,O.qC)("mode")],t.prototype,"_mode",void 0),(0,i.gn)([(0,O.qC)("comment")],t.prototype,"comment",void 0),(0,i.gn)([(0,O.qC)()],t.prototype,"forceAlphaBlending",void 0),t}(r.a);(0,S.H)("BABYLON.NodeMaterial",W)},89592:(e,t,n)=>{n.d(t,{k:()=>s});var i=n(89762),r=n(96979),o=n(70848),a=n(46310),c=n(48620),s=function(){function e(e,t,n,i){void 0===t&&(t=o.u.Vertex),void 0===n&&(n=!1),void 0===i&&(i=!1),this._isFinalMerger=!1,this._isInput=!1,this._name="",this._isUnique=!1,this.inputsAreExclusive=!1,this._codeVariableName="",this._inputs=new Array,this._outputs=new Array,this.comments="",this.visibleInInspector=!1,this.visibleOnFrame=!1,this._target=t,this._originalTargetIsNeutral=t===o.u.Neutral,this._isFinalMerger=n,this._isInput=i,this._name=e,this.uniqueId=a.K.UniqueId}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this.validateBlockName(e)&&(this._name=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUnique",{get:function(){return this._isUnique},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFinalMerger",{get:function(){return this._isFinalMerger},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInput",{get:function(){return this._isInput},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buildId",{get:function(){return this._buildId},set:function(e){this._buildId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(e){0==(this._target&e)&&(this._target=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this._inputs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs},enumerable:!1,configurable:!0}),e.prototype.getInputByName=function(e){var t=this._inputs.filter((function(t){return t.name===e}));return t.length?t[0]:null},e.prototype.getOutputByName=function(e){var t=this._outputs.filter((function(t){return t.name===e}));return t.length?t[0]:null},e.prototype.initialize=function(e){},e.prototype.bind=function(e,t,n,i){},e.prototype._declareOutput=function(e,t){return"".concat(t._getGLType(e.type)," ").concat(e.associatedVariableName)},e.prototype._writeVariable=function(e){return e.connectedPoint?"".concat(e.associatedVariableName):"0."},e.prototype._writeFloat=function(e){var t=e.toString();return-1===t.indexOf(".")&&(t+=".0"),"".concat(t)},e.prototype.getClassName=function(){return"NodeMaterialBlock"},e.prototype.registerInput=function(e,t,n,i,o){return void 0===n&&(n=!1),(o=null!=o?o:new r.VT(e,this,r.Ab.Input)).type=t,o.isOptional=n,i&&(o.target=i),this._inputs.push(o),this},e.prototype.registerOutput=function(e,t,n,i){return(i=null!=i?i:new r.VT(e,this,r.Ab.Output)).type=t,n&&(i.target=n),this._outputs.push(i),this},e.prototype.getFirstAvailableInput=function(e){void 0===e&&(e=null);for(var t=0,n=this._inputs;t<n.length;t++){var r=n[t];if(!(r.connectedPoint||e&&e.type!==r.type&&r.type!==i.E.AutoDetect))return r}return null},e.prototype.getFirstAvailableOutput=function(e){void 0===e&&(e=null);for(var t=0,n=this._outputs;t<n.length;t++){var i=n[t];if(!e||!e.target||e.target===o.u.Neutral||0!=(e.target&i.target))return i}return null},e.prototype.getSiblingOutput=function(e){var t=this._outputs.indexOf(e);return-1===t||t>=this._outputs.length?null:this._outputs[t+1]},e.prototype.isAnAncestorOf=function(e){for(var t=0,n=this._outputs;t<n.length;t++){var i=n[t];if(i.hasEndpoints)for(var r=0,o=i.endpoints;r<o.length;r++){var a=o[r];if(a.ownerBlock===e)return!0;if(a.ownerBlock.isAnAncestorOf(e))return!0}}return!1},e.prototype.connectTo=function(e,t){if(0!==this._outputs.length){for(var n=t&&t.output?this.getOutputByName(t.output):this.getFirstAvailableOutput(e),i=!0;i;){var r=t&&t.input?e.getInputByName(t.input):e.getFirstAvailableInput(n);if(n&&r&&n.canConnectTo(r))n.connectTo(r),i=!1;else{if(!n)throw"Unable to find a compatible match";n=this.getSiblingOutput(n)}}return this}},e.prototype._buildBlock=function(e){},e.prototype.updateUniformsAndSamples=function(e,t,n,i){},e.prototype.provideFallbacks=function(e,t){},e.prototype.initializeDefines=function(e,t,n,i){void 0===i&&(i=!1)},e.prototype.prepareDefines=function(e,t,n,i,r){void 0===i&&(i=!1)},e.prototype.autoConfigure=function(e){},e.prototype.replaceRepeatableContent=function(e,t,n,i){},Object.defineProperty(e.prototype,"willBeGeneratedIntoVertexShaderFromFragmentShader",{get:function(){return!this.isInput&&!this.isFinalMerger&&(!this._outputs.some((function(e){return e.isDirectlyConnectedToVertexOutput}))&&(this.target!==o.u.Vertex&&!(this.target!==o.u.VertexAndFragment&&this.target!==o.u.Neutral||!this._outputs.some((function(e){return e.isConnectedInVertexShader})))))},enumerable:!1,configurable:!0}),e.prototype.isReady=function(e,t,n,i){return void 0===i&&(i=!1),!0},e.prototype._linkConnectionTypes=function(e,t,n){void 0===n&&(n=!1),n?this._inputs[t]._acceptedConnectionPointType=this._inputs[e]:this._inputs[e]._linkedConnectionSource=this._inputs[t],this._inputs[t]._linkedConnectionSource=this._inputs[e]},e.prototype._processBuild=function(e,t,n,i){e.build(t,i);var r=null!=t._vertexState,a=e._buildTarget===o.u.Vertex&&e.target!==o.u.VertexAndFragment;if(r&&(0==(e.target&e._buildTarget)||0==(e.target&n.target)||this.target!==o.u.VertexAndFragment&&a)&&(!e.isInput&&t.target!==e._buildTarget||e.isInput&&e.isAttribute&&!e._noContextSwitch)){var c=n.connectedPoint;t._vertexState._emitVaryingFromString("v_"+c.associatedVariableName,t._getGLType(c.type))&&(t._vertexState.compilationString+="".concat("v_"+c.associatedVariableName," = ").concat(c.associatedVariableName,";\r\n")),n.associatedVariableName="v_"+c.associatedVariableName,n._enforceAssociatedVariableName=!0}},e.prototype.validateBlockName=function(e){for(var t=0,n=["position","normal","tangent","particle_positionw","uv","uv2","uv3","uv4","uv5","uv6","position2d","particle_uv","matricesIndices","matricesWeights","world0","world1","world2","world3","particle_color","particle_texturemask"];t<n.length;t++){if(e===n[t])return!1}return!0},e.prototype.build=function(e,t){if(this._buildId===e.sharedData.buildId)return!0;if(!this.isInput)for(var n=0,i=this._outputs;n<i.length;n++){(l=i[n]).associatedVariableName||(l.associatedVariableName=e._getFreeVariableName(l.name))}for(var r=0,a=this._inputs;r<a.length;r++){var c=a[r];if(c.connectedPoint){if(this.target!==o.u.Neutral){if(0==(c.target&this.target))continue;if(0==(c.target&e.target))continue}(h=c.connectedPoint.ownerBlock)&&h!==this&&this._processBuild(h,e,c,t)}else c.isOptional||e.sharedData.checks.notConnectedNonOptionalInputs.push(c)}if(this._buildId===e.sharedData.buildId)return!0;if(e.sharedData.verbose,this.isFinalMerger)switch(e.target){case o.u.Vertex:e.sharedData.checks.emitVertex=!0;break;case o.u.Fragment:e.sharedData.checks.emitFragment=!0}!this.isInput&&e.sharedData.emitComments&&(e.compilationString+="\r\n//".concat(this.name,"\r\n")),this._buildBlock(e),this._buildId=e.sharedData.buildId,this._buildTarget=e.target;for(var s=0,u=this._outputs;s<u.length;s++){var l;if(0!=((l=u[s]).target&e.target))for(var p=0,d=l.endpoints;p<d.length;p++){var h,f=d[p];(h=f.ownerBlock)&&0!=(h.target&e.target)&&-1!==t.indexOf(h)&&this._processBuild(h,e,f,t)}}return!1},e.prototype._inputRename=function(e){return e},e.prototype._outputRename=function(e){return e},e.prototype._dumpPropertiesCode=function(){var e=this._codeVariableName;return"".concat(e,".visibleInInspector = ").concat(this.visibleInInspector,";\r\n").concat(e,".visibleOnFrame = ").concat(this.visibleOnFrame,";\r\n").concat(e,".target = ").concat(this.target,";\r\n")},e.prototype._dumpCode=function(e,t){var n;t.push(this);var i=this.name.replace(/[^A-Za-z_]+/g,"");if(this._codeVariableName=i||"".concat(this.getClassName(),"_").concat(this.uniqueId),-1!==e.indexOf(this._codeVariableName)){var r=0;do{r++,this._codeVariableName=i+r}while(-1!==e.indexOf(this._codeVariableName))}e.push(this._codeVariableName),n="\r\n// ".concat(this.getClassName(),"\r\n"),this.comments&&(n+="// ".concat(this.comments,"\r\n")),n+="var ".concat(this._codeVariableName," = new BABYLON.").concat(this.getClassName(),'("').concat(this.name,'");\r\n'),n+=this._dumpPropertiesCode();for(var o=0,a=this.inputs;o<a.length;o++){var c=a[o];if(c.isConnected){var s=c.connectedPoint.ownerBlock;-1===t.indexOf(s)&&(n+=s._dumpCode(e,t))}}for(var u=0,l=this.outputs;u<l.length;u++){var p=l[u];if(p.hasEndpoints)for(var d=0,h=p.endpoints;d<h.length;d++){(s=h[d].ownerBlock)&&-1===t.indexOf(s)&&(n+=s._dumpCode(e,t))}}return n},e.prototype._dumpCodeForOutputConnections=function(e){var t="";if(-1!==e.indexOf(this))return t;e.push(this);for(var n=0,i=this.inputs;n<i.length;n++){var r=i[n];if(r.isConnected){var o=r.connectedPoint,a=o.ownerBlock;t+=a._dumpCodeForOutputConnections(e),t+="".concat(a._codeVariableName,".").concat(a._outputRename(o.name),".connectTo(").concat(this._codeVariableName,".").concat(this._inputRename(r.name),");\r\n")}}return t},e.prototype.clone=function(e,t){void 0===t&&(t="");var n=this.serialize(),i=(0,c.q)(n.customType);if(i){var r=new i;return r._deserialize(n,e,t),r}return null},e.prototype.serialize=function(){var e={};e.customType="BABYLON."+this.getClassName(),e.id=this.uniqueId,e.name=this.name,e.comments=this.comments,e.visibleInInspector=this.visibleInInspector,e.visibleOnFrame=this.visibleOnFrame,e.target=this.target,e.inputs=[],e.outputs=[];for(var t=0,n=this.inputs;t<n.length;t++){var i=n[t];e.inputs.push(i.serialize())}for(var r=0,o=this.outputs;r<o.length;r++){var a=o[r];e.outputs.push(a.serialize(!1))}return e},e.prototype._deserialize=function(e,t,n){var i;this.name=e.name,this.comments=e.comments,this.visibleInInspector=!!e.visibleInInspector,this.visibleOnFrame=!!e.visibleOnFrame,this._target=null!==(i=e.target)&&void 0!==i?i:this.target,this._deserializePortDisplayNamesAndExposedOnFrame(e)},e.prototype._deserializePortDisplayNamesAndExposedOnFrame=function(e){var t=this,n=e.inputs,i=e.outputs;n&&n.forEach((function(e,n){e.displayName&&(t.inputs[n].displayName=e.displayName),e.isExposedOnFrame&&(t.inputs[n].isExposedOnFrame=e.isExposedOnFrame,t.inputs[n].exposedPortPosition=e.exposedPortPosition)})),i&&i.forEach((function(e,n){e.displayName&&(t.outputs[n].displayName=e.displayName),e.isExposedOnFrame&&(t.outputs[n].isExposedOnFrame=e.isExposedOnFrame,t.outputs[n].exposedPortPosition=e.exposedPortPosition)}))},e.prototype.dispose=function(){for(var e=0,t=this.inputs;e<t.length;e++){t[e].dispose()}for(var n=0,i=this.outputs;n<i.length;n++){i[n].dispose()}},e}()},96979:(e,t,n)=>{n.d(t,{Ab:()=>r,VT:()=>s,WS:()=>i});var i,r,o=n(89762),a=n(70848),c=n(62897);!function(e){e[e.Compatible=0]="Compatible",e[e.TypeIncompatible=1]="TypeIncompatible",e[e.TargetIncompatible=2]="TargetIncompatible",e[e.HierarchyIssue=3]="HierarchyIssue"}(i||(i={})),function(e){e[e.Input=0]="Input",e[e.Output=1]="Output"}(r||(r={}));var s=function(){function e(e,t,n){this._connectedPoint=null,this._endpoints=new Array,this._typeConnectionSource=null,this._defaultConnectionPointType=null,this._linkedConnectionSource=null,this._acceptedConnectionPointType=null,this._type=o.E.Float,this._enforceAssociatedVariableName=!1,this.needDualDirectionValidation=!1,this.acceptedConnectionPointTypes=new Array,this.excludedConnectionPointTypes=new Array,this.onConnectionObservable=new c.y$,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this._prioritizeVertex=!1,this._target=a.u.VertexAndFragment,this._ownerBlock=t,this.name=e,this._direction=n}return e.AreEquivalentTypes=function(e,t){switch(e){case o.E.Vector3:if(t===o.E.Color3)return!0;break;case o.E.Vector4:if(t===o.E.Color4)return!0;break;case o.E.Color3:if(t===o.E.Vector3)return!0;break;case o.E.Color4:if(t===o.E.Vector4)return!0}return!1},Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"associatedVariableName",{get:function(){return this._ownerBlock.isInput?this._ownerBlock.associatedVariableName:this._enforceAssociatedVariableName&&this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.associatedVariableName},set:function(e){this._associatedVariableName=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"innerType",{get:function(){return this._linkedConnectionSource&&this._linkedConnectionSource.isConnected?this.type:this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){if(this._type===o.E.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource&&this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type}if(this._type===o.E.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type},set:function(e){this._type=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._prioritizeVertex&&this._ownerBlock?this._target!==a.u.VertexAndFragment?this._target:this._ownerBlock.target===a.u.Fragment?a.u.Fragment:a.u.Vertex:this._target},set:function(e){this._target=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnected",{get:function(){return null!==this.connectedPoint||this.hasEndpoints},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnectedToInputBlock",{get:function(){return null!==this.connectedPoint&&this.connectedPoint.ownerBlock.isInput},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectInputBlock",{get:function(){return this.isConnectedToInputBlock?this.connectedPoint.ownerBlock:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectedPoint",{get:function(){return this._connectedPoint},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ownerBlock",{get:function(){return this._ownerBlock},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sourceBlock",{get:function(){return this._connectedPoint?this._connectedPoint.ownerBlock:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectedBlocks",{get:function(){return 0===this._endpoints.length?[]:this._endpoints.map((function(e){return e.ownerBlock}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endpoints",{get:function(){return this._endpoints},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasEndpoints",{get:function(){return this._endpoints&&this._endpoints.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDirectlyConnectedToVertexOutput",{get:function(){if(!this.hasEndpoints)return!1;for(var e=0,t=this._endpoints;e<t.length;e++){var n=t[e];if(n.ownerBlock.target===a.u.Vertex)return!0;if((n.ownerBlock.target===a.u.Neutral||n.ownerBlock.target===a.u.VertexAndFragment)&&n.ownerBlock.outputs.some((function(e){return e.isDirectlyConnectedToVertexOutput})))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnectedInVertexShader",{get:function(){if(this.target===a.u.Vertex)return!0;if(!this.hasEndpoints)return!1;for(var e=0,t=this._endpoints;e<t.length;e++){var n=t[e];if(n.ownerBlock.target===a.u.Vertex)return!0;if(n.target===a.u.Vertex)return!0;if((n.ownerBlock.target===a.u.Neutral||n.ownerBlock.target===a.u.VertexAndFragment)&&n.ownerBlock.outputs.some((function(e){return e.isConnectedInVertexShader})))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnectedInFragmentShader",{get:function(){if(this.target===a.u.Fragment)return!0;if(!this.hasEndpoints)return!1;for(var e=0,t=this._endpoints;e<t.length;e++){var n=t[e];if(n.ownerBlock.target===a.u.Fragment)return!0;if((n.ownerBlock.target===a.u.Neutral||n.ownerBlock.target===a.u.VertexAndFragment)&&n.ownerBlock.outputs.some((function(e){return e.isConnectedInFragmentShader})))return!0}return!1},enumerable:!1,configurable:!0}),e.prototype.createCustomInputBlock=function(){return null},e.prototype.getClassName=function(){return"NodeMaterialConnectionPoint"},e.prototype.canConnectTo=function(e){return this.checkCompatibilityState(e)===i.Compatible},e.prototype.checkCompatibilityState=function(t){var n=this._ownerBlock,c=t.ownerBlock;if(n.target===a.u.Fragment){if(c.target===a.u.Vertex)return i.TargetIncompatible;for(var s=0,u=c.outputs;s<u.length;s++){var l=u[s];if(l.ownerBlock.target!=a.u.Neutral&&l.isConnectedInVertexShader)return i.TargetIncompatible}}if(this.type!==t.type&&t.innerType!==o.E.AutoDetect)return e.AreEquivalentTypes(this.type,t.type)||t.acceptedConnectionPointTypes&&-1!==t.acceptedConnectionPointTypes.indexOf(this.type)||t._acceptedConnectionPointType&&e.AreEquivalentTypes(t._acceptedConnectionPointType.type,this.type)?i.Compatible:i.TypeIncompatible;if(t.excludedConnectionPointTypes&&-1!==t.excludedConnectionPointTypes.indexOf(this.type))return i.TypeIncompatible;var p=c,d=n;return this.direction===r.Input&&(p=n,d=c),p.isAnAncestorOf(d)?i.HierarchyIssue:i.Compatible},e.prototype.connectTo=function(e,t){if(void 0===t&&(t=!1),!t&&!this.canConnectTo(e))throw"Cannot connect these two connectors.";return this._endpoints.push(e),e._connectedPoint=this,this._enforceAssociatedVariableName=!1,this.onConnectionObservable.notifyObservers(e),e.onConnectionObservable.notifyObservers(this),this},e.prototype.disconnectFrom=function(e){var t=this._endpoints.indexOf(e);return-1===t||(this._endpoints.splice(t,1),e._connectedPoint=null,this._enforceAssociatedVariableName=!1,e._enforceAssociatedVariableName=!1),this},e.prototype.serialize=function(e){void 0===e&&(e=!0);var t={};return t.name=this.name,t.displayName=this.displayName,e&&this.connectedPoint&&(t.inputName=this.name,t.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,t.targetConnectionName=this.connectedPoint.name,t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(t.isExposedOnFrame=!0,t.exposedPortPosition=this.exposedPortPosition),t},e.prototype.dispose=function(){this.onConnectionObservable.clear()},e}()},93682:(e,t,n)=>{n.d(t,{C:()=>o});var i=n(31191),r=n(96979),o=function(e){function t(t,n,i,r,o,a){var c=e.call(this,t,n,i)||this;return c._blockType=r,c._blockName=o,c._nameForCheking=a,c._nameForCheking||(c._nameForCheking=t),c.needDualDirectionValidation=!0,c}return(0,i.ZT)(t,e),t.prototype.checkCompatibilityState=function(e){return e instanceof t&&e.name===this._nameForCheking?r.WS.Compatible:r.WS.TypeIncompatible},t.prototype.createCustomInputBlock=function(){return[new this._blockType(this._blockName),this.name]},t}(r.VT)},12352:(e,t,n)=>{var i;function r(e,t,n,r){return void 0===t&&(t=i.Boolean),void 0===n&&(n="PROPERTIES"),function(i,o){var a=i._propStore;a||(a=[],i._propStore=a),a.push({propertyName:o,displayName:e,type:t,groupName:n,options:null!=r?r:{}})}}n.d(t,{U:()=>i,p:()=>r}),function(e){e[e.Boolean=0]="Boolean",e[e.Float=1]="Float",e[e.Int=2]="Int",e[e.Vector2=3]="Vector2",e[e.List=4]="List"}(i||(i={}))},74995:(e,t,n)=>{n.d(t,{o:()=>a});var i=n(31191),r=n(15631),o=n(54067),a=(n(77018),n(81654),function(e){function t(t,n){var i=e.call(this,t,n,"color",{attributes:["position"],uniforms:["world","viewProjection","color"]})||this;return i.disableColorWrite=!0,i.forceDepthWrite=!0,i.setColor4("color",new r.HE(0,0,0,1)),i}return(0,i.ZT)(t,e),t}(o.j))}}]);